{"total":13828,"page":1,"pagesize":100,"questions":[{"tags":["c++","winapi","serial-port"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13297254,"title":"Does WaitCommEvent() report data that has already been received?","body":"<p>I have a program that performs overlapped I/O on a serial port and I am seeing cases where data that has been received is not being read by the application.  My code is using <code>SetCommMask()</code> and <code>WaitCommEvent()</code> as follows:</p>\n\n<pre><code>if(!waiting_for_comm_event)\n{\n   comm_event_ready = false;\n   if(!SetCommMask(port_handle, EV_RXCHAR | EV_ERR | EV_RLSD))\n      throw OsException(my_strings[strid_set_comm_mask_failed].c_str());\n   rcd = WaitCommEvent(port_handle, &amp;event_mask, &amp;event_control);\n   last_error = GetLastError();\n   if(rcd &amp;&amp; event_mask != 0)\n       comm_event_ready = true;\n   else if(last_error != ERROR_IO_PENDING)\n       throw OsException(my_strings[strid_wait_comm_event_failed].c_str());\n   else\n       waiting_for_comm_event = true;\n  }\n</code></pre>\n\n<p>This code is invoked after I have written any data in my output buffer.  There is a possibility that data could be received while this writing is taking place.  Will <code>WaitCommEvent()</code> report the condition where there is already data waiting to be read?</p>\n"},{"tags":["c","winapi","assembly"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13297452,"title":"x86 Code Injection into an x86 Process from a x64 Process","body":"<p>I realize the title's a bit convoluted, so let me explain what I'm trying to do:</p>\n\n<p>I just finished writing a simple DLL injector for a proof of concept I'm trying to write. The program takes a snapshot of the current processes, enumerates the process tree, and injects a DLL into its direct parent process. Now, under ideal conditions, that works fine: the 32-bit version of the injector can inject into 32-bit parent processes, and the 64-bit version of the injector can inject into the 64-bit parent processes.</p>\n\n<p>What I'm now looking to do, though, is to inject a 32-bit DLL into 32-bit parent process from the x64 injector. Once that DLL is injected, I was hoping to then inject a call to one of the functions exported by the injected DLL. I'm not sure, though, if that's actually possible to do. (I've already put together some code to identify whether the parent process is a 32-bit process or a 64-bit process, so that won't be an issue)</p>\n\n<p>Now, I've already found some code that seems to do the first part by <a href=\"https://github.com/adoxa/ansicon/blob/master/ansicon.c\" rel=\"nofollow\">injecting precompiled machine code into the process</a>. (At least, I think that's what it's doing) Normally, after injecting the call to LoadLibraryW, I'd get the address returned by that call, add the relative offset to the exported function I want to call, and inject a call to that function. In this case though, I can't load the 32-bit library into my 64-bit injector, so I can't find the relative offset of the function by using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms683212%28v=vs.85%29.aspx\" rel=\"nofollow\">GetProcAddress</a> like I normally would. I got past this issue by doing the following:</p>\n\n<p>Since I can't find the function offset of the 32-bit DLL using normal means, I'm currently reading the file into a buffer, using that buffer to populate a <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms680336%28v=vs.85%29.aspx\" rel=\"nofollow\">IMAGE_NT_HEADERS32</a> struct, and enumerating the IMAGE_EXPORT_DIRECTORY to find the names and relative offsets of all exported functions.</p>\n\n<p>So at this point, I have the following:</p>\n\n<ul>\n<li>The 32-bit DLL loaded into the 32-bit Process</li>\n<li>A value that is the equivalent of funcAddr when running the following code in the 32-bit process:</li>\n</ul>\n\n<p>Code:\n</p>\n\n<pre><code>HMODULE hInjectedDLL = LoadLibrary(\"mydll.dll\");\nDWORD funcAddr = (DWORD)GetProcAddress(hInjectedDLL, \"ExportedFunc\") - (DWORD)hInjectedDLL;\n</code></pre>\n\n<p>Theoretically, all I need now is the value of hInjectedDLL, and I should be able to make a call to that function. Unfortunately, though, I don't really know enough about assembly or machine code to know how to go about getting that value, though.</p>\n\n<p>Any ideas?</p>\n\n<p>(Also, I'm aware that I could save myself a lot of trouble by just compiling two versions of the injector, and having one run the other when the parent process's processor architecture doesn't match up. I'm trying to avoid going this route, though.) </p>\n"},{"tags":["c++","winapi","file-mapping"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1219,"score":0,"question_id":9889557,"title":"Mapping large files using MapViewOfFile","body":"<p>I have a very large file and I need to read it in small pieces and then process each piece. I'm using MapViewOfFile function to map a piece in memory, but after reading first part I can't read the second. It throws  when I'm trying to map it.</p>\n\n<pre><code>    char *tmp_buffer = new char[bufferSize];\n    LPCWSTR input = L\"input\";   \n    OFSTRUCT tOfStr;\n    tOfStr.cBytes = sizeof tOfStr;\n\n    HANDLE inputFile = (HANDLE)OpenFile(inputFileName, &amp;tOfStr, OF_READ); \n    HANDLE fileMap = CreateFileMapping(inputFile, NULL, PAGE_READONLY, 0, 0, input);\n\n    while (offset &lt; fileSize)\n    {\n        long k = 0;\n        bool cutted = false;\n        offset -= tempBufferSize;\n\n        if (fileSize - offset &lt;= bufferSize)\n        {\n            bufferSize = fileSize - offset;\n        }\n\n        char *buffer = new char[bufferSize + tempBufferSize];\n\n        for(int i = 0; i &lt; tempBufferSize; i++)\n        {\n            buffer[i] = tempBuffer[i];\n        }\n\n        char *tmp_buffer = new char[bufferSize];\n        LPCWSTR input = L\"input\";\n        HANDLE inputFile;\n        OFSTRUCT tOfStr;\n        tOfStr.cBytes = sizeof tOfStr;\n\n        long long offsetHigh = ((offset &gt;&gt; 32) &amp; 0xFFFFFFFF);\n        long long offsetLow = (offset &amp; 0xFFFFFFFF);\n\n        tmp_buffer = (char *)MapViewOfFile(fileMap, FILE_MAP_READ, (int)offsetHigh, (int)offsetLow, bufferSize);\n\n        memcpy(&amp;buffer[tempBufferSize], &amp;tmp_buffer[0], bufferSize);\n\n        UnmapViewOfFile(tmp_buffer);\n\n        offset += bufferSize;\n        offsetHigh = ((offset &gt;&gt; 32) &amp; 0xFFFFFFFF);\n        offsetLow = (offset &amp; 0xFFFFFFFF);\n\n        if (offset &lt; fileSize)\n        {\n            char *next;\n            next = (char *)MapViewOfFile(fileMap, FILE_MAP_READ, (int)offsetHigh, (int)offsetLow, 1);\n\n            if (next[0] &gt;= '0' &amp;&amp; next[0] &lt;= '9')\n            {\n                cutted = true;\n            }\n\n            UnmapViewOfFile(next);\n        }\n\n        ostringstream path_stream;\n        path_stream &lt;&lt; tempPath &lt;&lt; splitNum;\n\n        ProcessChunk(buffer, path_stream.str(), cutted, bufferSize);\n\n        delete buffer;\n\n        cout &lt;&lt; (splitNum + 1) &lt;&lt; \" file(s) sorted\" &lt;&lt; endl;\n        splitNum++;\n    }\n</code></pre>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13296819,"title":"C++ coloring console output","body":"<p>How can I colorate a specific item from an array of characters ?  So I have someting like : \nchar a[50] where a[4] = \"c\". How can I colorate that character ? I only know how to colorate all characters using something like this : </p>\n\n<pre><code>HANDLE hConsole;\nhConsole = GetStdHandle (STD_OUTPUT_HANDLE);\nSetConsoleTextAttribute\n(hConsole, FOREGROUND_RED | FOREGROUND_INTENSITY);\n</code></pre>\n"},{"tags":["winapi","networking","wmi","inno-setup","wmi-query"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":10,"score":1,"question_id":13295277,"title":"Check on avaiable port using wmi win32 class?","body":"<p>I am using inno setup to make an installation file. It required to pull local ip address (which I able to do by querying Win32_NetworkAdapterConfiguration) and check if a specific port is open for the software to run on (which I am currently looking for an answer).</p>\n\n<p>I realize that WMI Win32 classes contain so many useful information. So I wonder which Win32 class should I use to check on this port given that if it is possible to do that?</p>\n\n<p>Thank you,  </p>\n"},{"tags":["c++","winapi","windows-7"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":19,"score":0,"question_id":13287983,"title":"Windows 7 : task dialog, copy content","body":"<p>what code should I use to let user copy contents of indirect task dialog in Windows 7 WinAPI32? I need user to be able to copy content of TaskDialogIndirect window. Evidently, it means that if user makes right click, there is a context menu appeared or user can use Ctrl+C shortcut</p>\n"},{"tags":["windows","winapi","icons","folder"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13295728,"title":"How to determine, if folder has custom icon?","body":"<p>How to determine, if the folder of given path has the generic folder icon, or rather custom one, set by user? I would like to use only Win32 API calls.</p>\n\n<p>I know, that I can check, if there is a desktop.ini file inside, but this method is not always available (program may not have permissions to list folder's contents) and slow, because requires parsing the ini file each time (icon may not be changed).</p>\n"},{"tags":["winapi","mouse-cursor"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":432,"score":1,"question_id":1699666,"title":"How do I know the size of a HCURSOR object","body":"<p>I want to get the height and width of a .cur file without look into its format.</p>\n\n<p>I try to use LoadCursorFromFile() to get a HCURSOR, I suppose there is a API function to obtain the HCURSOR infos, but I find that GetCursorInfo() is not I want at all.</p>\n\n<p>Is there any way to get the height and width of a HCURSOR object?</p>\n"},{"tags":["windows","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":10,"score":1,"question_id":13295220,"title":"Windows 8: Activating an app using Background task","body":"<p>I am doing a windows 8 App using c#. the app goes to suspend state if its inactive, I am trying to bring the app to front based on external events. So I used a background task with this app which monitors the external event. Once the event occurs I am able to send updates to the app but not able to bring it to front. any pointers will be helpful.</p>\n"},{"tags":["c++","string","winapi","stl","c++03"],"answer_count":5,"favorite_count":3,"up_vote_count":21,"down_vote_count":1,"view_count":1338,"score":20,"question_id":2256160,"title":"Is it reasonable to use std::basic_string<t> as a contiguous buffer when targeting C++03?","body":"<p>I know that in C++03, technically the <code>std::basic_string</code> template is not required to have contiguous memory. However, I'm curious how many implementations exist for modern compilers that actually take advantage of this freedom. For example, if one wants to use <code>basic_string</code> to receive the results of some C API (like the example below), it seems silly to allocate a vector just to turn it into a string immediately.</p>\n\n<p>Example:</p>\n\n<pre><code>DWORD valueLength = 0;\nDWORD type;\nLONG errorCheck = RegQueryValueExW(\n        hWin32,\n        value.c_str(),\n        NULL,\n        &amp;type,\n        NULL,\n        &amp;valueLength);\n\nif (errorCheck != ERROR_SUCCESS)\n    WindowsApiException::Throw(errorCheck);\nelse if (valueLength == 0)\n    return std::wstring();\n\nstd::wstring buffer;\ndo\n{\n    buffer.resize(valueLength/sizeof(wchar_t));\n    errorCheck = RegQueryValueExW(\n            hWin32,\n            value.c_str(),\n            NULL,\n            &amp;type,\n            &amp;buffer[0],\n            &amp;valueLength);\n} while (errorCheck == ERROR_MORE_DATA);\n\nif (errorCheck != ERROR_SUCCESS)\n    WindowsApiException::Throw(errorCheck);\n\nreturn buffer;\n</code></pre>\n\n<p>I know code like this might slightly reduce portability because it implies that <code>std::wstring</code> is contiguous -- but I'm wondering just how unportable that makes this code. Put another way, how may compilers actually take advantage of the freedom having noncontiguous memory allows?</p>\n\n<hr>\n\n<p>EDIT: I updated this question to mention C++03. Readers should note that when targeting C++11, the standard now requires that <code>basic_string</code> be contiguous, so the above question is a non issue when targeting that standard.</p>\n"},{"tags":["c++","winapi","recursion","delete","directory"],"answer_count":7,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":3114,"score":3,"question_id":1468774,"title":"Why am I having problems recursively deleting directories?","body":"<p>I've written an application that uses the WIN32 api to create a temporarily directory hierarchy. Now, when wanting to delete the directories when shutting down the application I'm running into some problems. </p>\n\n<p>So lets say I have a directory hierarchy: C:\\temp\\directory\\subdirectory\\</p>\n\n<p>I'm using this recursive function:</p>\n\n<pre><code>bool Dir::deleteDirectory(std::string&amp; directoryname, int flags)\n{\n    if(directoryname.at(directoryname.size()-1) !=  '\\\\') directoryname += '\\\\';\n\n    if ((flags &amp; CONTENTS) == CONTENTS)\n    {\n        WIN32_FIND_DATAA fdata;\n        HANDLE dhandle;\n\n        directoryname += \"\\\\*\";\n        dhandle = FindFirstFileA(directoryname.c_str(), &amp;fdata);\n\n        // Loop through all the files in the main directory and delete files &amp; make a list of directories\n        while(true)\n        {\n            if(FindNextFileA(dhandle, &amp;fdata))\n            {\n                std::string filename = fdata.cFileName;\n                if(filename.compare(\"..\") != 0)\n                {\n                    std::string filelocation = directoryname.substr(0, directoryname.size()-2) + StringManip::reverseSlashes(filename);\n\n                    // If we've encountered a directory then recall this function for that specific folder.\n                    if(!isDirectory(filelocation))  DeleteFileA(filename.c_str());\n                    else deleteDirectory(filelocation, DIRECTORY_AND_CONTENTS);\n                }\n            } else if(GetLastError() == ERROR_NO_MORE_FILES)    break;\n        }\n        directoryname = directoryname.substr(0, directoryname.size()-2);\n    }\n\n    if ((flags &amp; DIRECTORY) == DIRECTORY)\n    {\n        HANDLE DirectoryHandle;\n        DirectoryHandle = CreateFileA(directoryname.c_str(),\n                                FILE_LIST_DIRECTORY,\n                                FILE_SHARE_READ | FILE_SHARE_WRITE | FILE_SHARE_DELETE,\n                                NULL,\n                                OPEN_EXISTING,\n                                FILE_FLAG_BACKUP_SEMANTICS | FILE_FLAG_OVERLAPPED,\n                                NULL);\n        bool DeletionResult = (RemoveDirectoryA(directoryname.c_str()) != 0)?true:false;\n        CloseHandle(DirectoryHandle);\n        return DeletionResult;\n    }\n\n     return true;\n}\n</code></pre>\n\n<p>This function iterates over the directory contents of the temp directory; and for each directory in the temp directory it keeps recalling itself until it's at the lowest directory; subdirectory in the example.</p>\n\n<p>There are also 3 flags defined</p>\n\n<pre><code> enum DirectoryDeletion\n {\n    CONTENTS = 0x1,\n    DIRECTORY = 0x2,\n    DIRECTORY_AND_CONTENTS = (0x1 | 0x2)\n };\n</code></pre>\n\n<p>When using this function, it only removes the lowest subdirectory and I can't remove the ones higher in hierarchy because it says that the directory is not empty. When I go and look to the directory 'subdirectory' is only removed after the application ends. However, when I try to encapsulate this in a non recursive simple main application I have no problems at all with deleting the directories. </p>\n"},{"tags":["c++","c","windows","winapi","unix"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":51,"score":0,"question_id":13292452,"title":"Saving image without compressing","body":"<p>I know that JPG, BMP, GIF and others formats compress image. But can I get snapshot of display and save it without compressing(in binary file) in programming way (using c/c++ for example or other stuff)? </p>\n"},{"tags":["c#",".net","winapi","directshow"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":2,"view_count":1144,"score":1,"question_id":7887910,"title":"take picture from webcam c#","body":"<p>I'm streaming video to my Window Form with DirectShowLib. I also want to save image when i press button \"Save\" for example. How to get picture from webcam with DirectShowLib methods or with WIN32 API methods? </p>\n"},{"tags":["c#",".net","winapi","internet","webcam"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":3,"view_count":322,"score":-2,"question_id":9176926,"title":"How to share desktop using a webcam driver?","body":"<p>I want to create a desktop sharing app. I think the best way is to use a webcam emulation on the desktop and share the stream. But are there any free drivers that do that emulation?</p>\n\n<p>EDIT: Thanks for downvoting. I don't think the question was stupid.</p>\n"},{"tags":["c#","winforms","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13292355,"title":"Getting USB info using SetupDiGetDevicePropertyW","body":"<p>I am trying to get the SetupDiGetDevicePropertyW method to work but without success.</p>\n\n<p>The P/Invoke is declared as:</p>\n\n<pre><code>// Device Property\n[StructLayout(LayoutKind.Sequential)]\ninternal struct DEVPROPKEY\n{\n    public Guid fmtid;\n    public UInt32 pid;\n}\n/// &lt;summary&gt;\n/// Provides details about a single USB device.\n/// &lt;/summary&gt;\n[StructLayout(LayoutKind.Sequential, Pack = 1)]\ninternal struct DeviceInterfaceData\n{\n    public int Size;\n    public Guid InterfaceClassGuid;\n    public int Flags;\n    public UIntPtr Reserved;\n}\n\n[DllImport(\"setupapi.dll\", SetLastError = true)]\ninternal static extern bool SetupDiGetDevicePropertyW(\n        IntPtr deviceInfoSet,\n        ref DeviceInterfaceData DeviceInfoData,\n        ref DEVPROPKEY propertyKey,\n        out UInt64 propertyType, // or Uint32 ?\n        IntPtr propertyBuffer, // or byte[]\n        uint propertyBufferSize,\n        out uint requiredSize,\n        UInt32 flags);\n\n/// &lt;summary&gt;\n/// Gets a new key for the bus reported device description.\n/// &lt;/summary&gt;\ninternal static DEVPROPKEY DEVPKEY_Device_BusReportedDeviceDesc\n{\n    get\n    {\n        DEVPROPKEY key = new DEVPROPKEY();\n        key.pid = 4;\n        key.fmtid = new Guid((uint)0x540b947e, (ushort)0x8b40, (ushort)0x45bc, 0xa8, 0xa2, 0x6a, 0x0b, 0x89, 0x4c, 0xbd, 0xa2);\n        return key;\n    }\n}\n</code></pre>\n\n<p>I am calling with:</p>\n\n<pre><code>uint propertyRegDataType = 0;\nuint requiredSize = 0;\nIntPtr buffer = Marshal.AllocHGlobal(1024);\nif (UnsafeNativeMethods.SetupDiGetDevicePropertyW(infoSet, ref deviceInterfaceData, ref devicePropertyKey, out propertyType, buffer, 1024, out requiredSize, 0))\n{\n}\nelse\n{\n    int test = Marshal.GetLastWin32Error(); // returns 87 - invalid parameter\n}\n</code></pre>\n\n<p>infoSet has a value from:</p>\n\n<pre><code>IntPtr infoSet = UnsafeNativeMethods.SetupDiGetClassDevs(ref hidGuid, null, IntPtr.Zero, DIGCF_DEVICEINTERFACE | DIGCF_PRESENT);\n</code></pre>\n\n<p>deviceInterfaceData has values including a GUID for the interface and that comes from:</p>\n\n<pre><code>UnsafeNativeMethods.SetupDiEnumDeviceInterfaces(infoSet, 0, ref hidGuid, (uint)i, ref deviceInterfaceData);\n</code></pre>\n\n<p>hidGuid is from (where result is a Guid object:</p>\n\n<pre><code>UnsafeNativeMethods.HidD_GetHidGuid(out result);\n</code></pre>\n\n<p>What am I doing wrong here?</p>\n"},{"tags":["winapi","localization","internationalization"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12376219,"title":"GetDateFormat() fails on dates before 1/1/1601","body":"<p>i am trying to format a date using Windows <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd318086%28v=vs.85%29.aspx\" rel=\"nofollow\">GetDateFormat API</a> function:</p>\n\n<pre><code>nResult = GetDateFormat(\n      localeId,   //0x409 for en-US, or LOCALE_USER_DEFAULT if you're not testing\n      0,          //flags\n      dt,         //a SYSTEMTIME structure\n      \"M/d/yyyy\", //the format we require\n      null,       //the output buffer to contain string (null for now while we get the length)\n      0);         //the length of the output buffer (zero while we get the length)\n</code></pre>\n\n<p>Now we pass it a date/time:</p>\n\n<pre><code>SYSTEMTIME dt;\ndt.wYear = 1600;\ndt.wMonth = 12;\ndt.wDay = 31;\n</code></pre>\n\n<p>In this case nResult returns zero:</p>\n\n<blockquote>\n  <p>The function returns 0 if it does not succeed. To get extended error information, the application can call GetLastError, which can return one of the following error codes:</p>\n  \n  <ul>\n  <li>ERROR_INSUFFICIENT_BUFFER. A supplied buffer size was not large enough, or it was incorrectly set to NULL.</li>\n  <li>ERROR_INVALID_FLAGS. The values supplied for flags were not valid.</li>\n  <li>ERROR_INVALID_PARAMETER. Any of the parameter values was invalid.</li>\n  </ul>\n</blockquote>\n\n<p>If, however, i return a date one day later:</p>\n\n<pre><code>SYSTEMTIME dt;\ndt.wYear = 1601;\ndt.wMonth = 1;\ndt.wDay = 1;\n</code></pre>\n\n<p>Then it works.</p>\n\n<p>What am i doing wrong? How do i format dates?</p>\n\n<p>e.g. the date of <a href=\"http://www.youtube.com/watch?v=2KokXbUV_SU\" rel=\"nofollow\">the birth of Christ</a>:</p>\n\n<pre><code>12/25/0000\n</code></pre>\n\n<p>or <a href=\"http://en.wikipedia.org/wiki/James_Ussher\" rel=\"nofollow\">the date when the universe started</a>:</p>\n\n<pre><code>-10/22/4004 6:00 PM\n</code></pre>\n\n<p>or the date Caesar died:</p>\n\n<pre><code>-3/15/44\n</code></pre>\n\n<hr>\n\n<h2>Bonus Reading</h2>\n\n<ul>\n<li><strong>Sorting It All Out</strong>: <a href=\"http://blogs.msdn.com/b/michkap/archive/2005/01/14/353216.aspx\" rel=\"nofollow\">GetDateFormat is Gregorian based</a></li>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd318088%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>GetDateFormatEx</code> function</a></li>\n</ul>\n"},{"tags":["winapi","filesystems","windows-explorer"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12552188,"title":"Using custom file formats as Windows Explorer file systems","body":"<p>Are there any tutorials on how to load custom archive file formats as file systems in Windows Explorer, similar to CAB and ZIP files?</p>\n\n<p>I tried searching for namespace extensions tutorials, but it appears to be a different thing.</p>\n"},{"tags":["c","windows","security","winapi","token"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13292043,"title":"Getting Token Information","body":"<p>I have the following program written in C:</p>\n\n<pre><code>#include \"stdafx.h\"\n#include &lt;Windows.h&gt;\n\nvoid main()\n{\n    char buffer[1000];\n    int size = sizeof(buffer);\n    PDWORD required_size;\n\n    printf(\"----Application Privileges----\\n\\n\");\n    printf(\"In this program, we are going to obtain information about the application privileges\\n\\n\");\n\n    HANDLE process = OpenProcess(SYNCHRONIZE, FALSE, GetCurrentProcessId()); //Opening the current process\n    HANDLE token; //Creating a handle for the token\n    OpenProcessToken(process, TOKEN_ADJUST_PRIVILEGES, &amp;token); //Opening the process token\n\n    GetTokenInformation(token, TokenPrivileges, buffer, size, required_size); //Obtaining the token information\n    printf(\"The following information was obtained with regards to the token privileges: \\n\\n\");\n    printf(\"%s\\n\\n\", buffer);\n\n    printf(\"Press enter to exit the program\");\n    getchar();\n\n}\n</code></pre>\n\n<p>Now, I am relatively new to the use of tokens.  When I try to execute the program, the following error comes up:</p>\n\n<blockquote>\n  <p>Run-Time Check Failure #3 - The variable 'required_size' is being used without being initialized.</p>\n</blockquote>\n\n<p>How can I solve this problem please?  What I want to do is to display information about the token privileges of the current process to the user.</p>\n\n<p>I don't know exactly what the last variable (ReturnLength [out]) in the GetTokenInformation method does.  I tried reading the msdn documentation but did not understand its use.</p>\n"},{"tags":["c++","winapi","dll","version","exe"],"answer_count":7,"favorite_count":2,"up_vote_count":15,"down_vote_count":0,"view_count":7289,"score":15,"question_id":940707,"title":"How do I programatically get the version of a DLL or EXE file?","body":"<p>I need to get the product version and file version for a DLL or EXE file using Win32 native APIs in C or C++. I'm <em>not</em> looking for the Windows version, but the version numbers that you see by right-clicking on a DLL file, selecting \"Properties\", then looking at the \"Details\" tab. This is usually a four-part dotted version number x.x.x.x.</p>\n"},{"tags":["c++","winapi","drop-down-menu"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13224099,"title":"How to update context menu already displayed with TrackPopupMenu in C++","body":"<p>Say, if I display a popup context menu using TrackPopupMenu() API with TPM_RETURNCMD flag. While the context menu is displayed I need to see if Shift or Ctrl key is pressed on the keyboard and depending on that update some menu items from the context menu. Is that possible?</p>\n"},{"tags":["c++","winapi","mfc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13286178,"title":"Get item names from a .NET applications list controll using winapi or mfc","body":"<p>So basically i have this software which outputs data in a list form. Thanks to the comments here we have understood that it is most likely written in .NET.</p>\n\n<p>I want to scan the list so i can do some algorithms on the data. </p>\n\n<p>Using Spy++ i found that what holds this list is titled \"Panel2\" and i can get the handle to this (its class is \"WindowsForms10.Window.8.app\") using EnumChildWindows.</p>\n\n<p>However i don't know how to get to the list itself so i can read its items. I have tried EnumChildWindows on the \"Panel2\" handle and outputting the caption of all those windows but they are all empty.</p>\n\n<p>Can panel2 be the actuall list? If so could i just cast it to (CListCtrl*) ?</p>\n\n<p>Axilles mentions in the comments that it probably is written in .NET, wold it be possible to get the controlID / handle to the list using something like <a href=\"http://reflector.red-gate.com/download.aspx?TreatAsUpdate=1\" rel=\"nofollow\">http://reflector.red-gate.com/download.aspx?TreatAsUpdate=1</a> ?</p>\n\n<pre><code>   CWnd* mainWindow;\n    CWnd* panel;\n    CListCtrl* list;\n\n\n\nBOOL CALLBACK findWindow( HWND hwnd,LPARAM lParam)\n{\n    char text[8];\n    GetWindowText(hwnd,text,8);\n\n    if(strcmp(text,\"Fetcher\") == 0)\n    {\n        mainWindow= CWnd::FromHandle(hwnd);\n\n        return false;\n    }\n\n    return true;\n}\n\nBOOL CALLBACK findPanel(HWND hwnd,LPARAM lParam)\n{\n\n    char text[7];\n    GetWindowText(hwnd,text,7);\n\n    if(strcmp(text,\"Panel2\") == 0)\n    {\n        panel = CWnd::FromHandle(hwnd);\n\n        return false;\n    }\n\n    return true;\n}\n\n\nvoid CAnalyzeDlg::OnBnClickedButton1()\n{\n    mainWindow = 0;\n\n    while(mainWindow == 0)\n    {\n    ::EnumWindows(findWindow,0);\n    }\n\n    mainWindow -&gt;ActivateTopParent();\n\n    while(panel == 0) ::EnumChildWindows(mainWindow -&gt;m_hWnd,findPanel,0);\n\n    CWnd* pointTest = NULL;\n\n    CString text = \"\";\n\n    int xx = 337;\n    int yy = 95;\n\n    while(yy &lt; 1024 &amp;&amp; (pointTest == NULL || strcmp(text,\"\") == 0 || strcmp(text,\"Panel2\") == 0))\n    {\n        pointTest = mainWindow-&gt;ChildWindowFromPoint(CPoint(xx,yy));\n        yy++;\n        if(pointTest != 0)\n            pointTest-&gt;GetWindowTextA(text);\n    }\n\n\n\n    if(strcmp(text,\"\") != 0)\n        MessageBox(0,text,0); // This never shows\n\n}\n</code></pre>\n"},{"tags":["winapi","windows-8"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13288452,"title":"What is the purpose of the win32 CreateFile2 api call?","body":"<p>They have added a new API call in windows 8 called CreateFile2 which as far as I can tell does exactly the same as the existing CreateFile function only it packages up it's parameters somewhat differently.</p>\n\n<p>What has been added to make this necessary, as I can't see anything in the documentation.</p>\n"},{"tags":["windows","winapi","rdp"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13288207,"title":"Create Windows session programmatically","body":"<p>I have a service running in the Windows services (0) session.\nUpon connection from a client I need to create a new Windows session for given user credentials, log in that user and start an application into this new session.</p>\n\n<p>Is there a way to programmatically create a user session for given user credentials?</p>\n"},{"tags":["python","winapi","map","hadoop","reduce"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":433,"score":2,"question_id":6585885,"title":"Alternatives to Hadoop / Map-reduce framework for win32 platform","body":"<p>I'm finding Hadoop on Windows somewhat frustrating: I want to know if there are any serious alternatives to Hadoop for Win32 users. The features I most value are:</p>\n\n<ul>\n<li>Ease of initial setup &amp; deployment on a smallish network (I'd be astonished if we ever got more than 20 worker-PCs assigned to this project)</li>\n<li>Ease of management - the ideal framework should have web/GUI based administration system so that I do not have to write one myself.</li>\n<li>Something popular &amp; stable. Bonuses depend on us getting this project delivered in time.</li>\n</ul>\n\n<p><strong>BACKGROUND:</strong></p>\n\n<p>The company I work for wants to build a new grid system to run some financial calculations. </p>\n\n<p>The first framework I have been evaluating is Hadoop. This seemed to do exactly what was intended except that it's very UNIX oriented. I was able to get all of the tutorials up &amp; running on an Ubuntu VirtualBox. Unfortunately nothing seems to run easily on Win32.</p>\n\n<p>Yes... Win32: Our company has a policy that everything has to run on Windows. None of the server admins (or anybody outside of select few developers) know anything about Linux. I'd probably get in trouble if they found my virtual Ubuntu environment! The sad fact is that our grid needs to be hosted on Win32 (since all the test PCs run Windows XP 32bit), with an option to upgrade to Win64 at sometime in the future.</p>\n\n<p>To complicate matters - 95% of what we want to run are Python scripts with C++ Windows 32bit DLL add ons. Our calculation library is overwhelmingly written in Python. Our calculation libraries will not run on anything other than Windows... I do not really have a choice </p>\n"},{"tags":["c++","winapi","gdi"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13286078,"title":"use InvalideRect() to change a GDI shape","body":"<p>I asked my question yesterday but could not get a correct answer. now ill ask it more clearly.\nusing win api I created a window and a button. infront of the button there is a circle drawn in green color. once the button is pressed the circle should turn to red color.</p>\n\n<p>(I'm using C++, and mingw compiler.)</p>\n\n<p>here is my code</p>\n\n<pre><code>LRESULT CALLBACK WinProc(HWND hWnd,UINT msg,WPARAM wParam,LPARAM lParam)\n{\n PAINTSTRUCT ps;\n HDC hDC;\n HBRUSH brusha;\n brusha=CreateSolidBrush(RGB(0,255,0));\n\n switch(msg)\n{\n    case WM_CREATE:\n    {\n\n        b=CreateWindowEx(WS_EX_CLIENTEDGE,\n            \"BUTTON\",\n            \"red\",\n            WS_CHILD|WS_VISIBLE|\n            BS_DEFPUSHBUTTON,\n            350,\n            100,\n            100,\n            40,\n            hWnd,\n            (HMENU)BUTTON,\n            GetModuleHandle(NULL),\n            NULL);\n    }\n    break;\n\n\n    case WM_PAINT:\n    {\n\n\n    hDC=BeginPaint(hWnd,&amp;ps);\n    SelectObject(hDC,brusha);\n    Ellipse(hDC, 20, 20, 100, 100);\n    EndPaint(hWnd, &amp;ps);\n\n    }\n\n    case WM_COMMAND:\n      switch(LOWORD(wParam))\n        {\n            case BUTTON:\n            {\n            brusha=CreatSolideBrush(RGB(255,0,0));\n            InvalidateRect( hWnd,0,false);\n\n            }\n        }\n  break;\n\n\n      case WM_DESTROY:\n    {\n        PostQuitMessage(0);\n        return 0;\n    }\n    break;\n}\n\nreturn DefWindowProc(hWnd,msg,wParam,lParam);\n\n  }\n</code></pre>\n\n<p>this compiles without errors. but nothing happens on button click</p>\n"},{"tags":["c++","c","winapi","wildcard","glob"],"answer_count":5,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":2698,"score":2,"question_id":1214930,"title":"Win32 API to do wildcard string match","body":"<p>I am looking for a wildcard string match API (not regex match). I cannot use anything other than Win32 APIs.</p>\n"},{"tags":["c++","winapi","treeview","common-controls","lparam"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13285126,"title":"TVITEM LPARAM to store string","body":"<p>I've got a treeview listing files that are dropped upon it.</p>\n\n<p>When I make a new treeview item, I'd like to store the address of the file as a string in that item, and retrieve it for various nefarious purposes at a later point in time.</p>\n\n<p>Looking at the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb773456%28v=vs.85%29.aspx\" rel=\"nofollow\">TVITEM structure</a> in Microsoft docs, apparently <code>LPARAM</code> is the place to store a value:</p>\n\n<blockquote>\n  <p>lParam</p>\n\n<pre><code>Type: LPARAM\n\nA value to associate with the item.\n</code></pre>\n</blockquote>\n\n<p>So, I have gone ahead and done that:</p>\n\n<pre><code>TVITEM tvi;\ntvi.mask = TVIF_TEXT;\ntvi.pszText = const_cast&lt;char *&gt; (str0.c_str());\ntvi.cchTextMax = sizeof(tvi.pszText);\ntvi.lParam = (LPARAM) foo;  // SETTING LPARAM HERE, foo IS A const char * \n\nTVINSERTSTRUCT tvis;\ntvis.item = tvi;\ntvis.hInsertAfter = 0;\ntvis.hParent = hti0;\n\n// Send message to update tree, and return tree item.\nreturn TreeView_InsertItem(tvw_filelist_, &amp;tvis);\n</code></pre>\n\n<p>Then, when I try to retrieve my value...</p>\n\n<pre><code>HTREEITEM htiSel = TreeView_GetSelection(tvw_filelist_);\n\nTVITEM tvItem;\ntvItem.hItem = htiSel;\n\nTreeView_GetItem(tvw_filelist_, &amp;tvItem);\nconst char * info = (const char *) tvItem.lParam;\nMessageBox(NULL, info, \"Alert\", MB_OK);\n</code></pre>\n\n<p>...I just get garbage, indicating my pointer went out of scope or is taking a nap or something.  The size of that pointer is always 4.</p>\n\n<p>Is this the right way to do what I'm trying to do? If so, what's going on?</p>\n"},{"tags":["c#","winapi","resize","winamp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13157381,"title":"c# resize Winamp main window","body":"<p>I have a problem:\nI found this:</p>\n\n<pre><code>[DllImport(\"user32.dll\")]\n    static extern bool MoveWindow(IntPtr hWnd, int X, int Y, int nWidth, int nHeight, bool bRepaint);\n    [DllImport(\"user32.dll\")]\n    static extern bool GetWindowRect(IntPtr hWnd, out RECT rect);\n\n    static void resize()\n    {\n        Process p = new Process();\n        p.StartInfo.FileName = \"winamp.exe\";\n        p.Start();\n        p.WaitForInputIdle();\n        Thread.Sleep(2000);\n        IntPtr hWnd = p.MainWindowHandle;\n        RECT rect;\n        GetWindowRect(hWnd, out rect);\n        int width = rect.right - rect.left;\n        int height = rect.bottom - rect.top;\n        MoveWindow(hWnd, 0, 0, width, height, true);\n    }\n</code></pre>\n\n<p>This code snippet works with all processes that I tested, except Winamp.\nAnyone an idea how to get it working with Winamp?</p>\n"},{"tags":["c++","winapi","direct2d"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13281964,"title":"GDI versus Direct2D","body":"<p>im programming a simulation at the moment and i want to port my application from using GDI to using Direct2D. But my Direct2D code is way more slower than my GDI code. I render alot of ellipses on the screen. In my GDI application i draw to a memory device context and than use BitBlt to draw on the windows device context. With Direct2D I draw onto a ID2D1HwndRenderTarget. My Problem is when using GDI i can draw easily 400+ Ellipses and still have 400 FPS. When I do the same amount of ellipses with Direct2D my FPS drops down to 30FPS. I allready switched antialiasing off but it doesnt really help. The interesting thing is that drawing just a few ellipses is faster in Direct2D compared to GDI. Is there anything I can do to improve the performance in Direct2D or should I keep my application using GDI? Here is my drawing code using GDI:</p>\n\n<pre><code>VOID Begin() {\n    SelectObject(this-&gt;MemDeviceContext, this-&gt;MemoryBitmap);\n    this-&gt;BackgroundBrush = CreateSolidBrush(this-&gt;BackgroundColor);\n    HBRUSH OldBrush = (HBRUSH)SelectObject(this-&gt;MemDeviceContext, this-&gt;BackgroundBrush);\n    Rectangle(this-&gt;MemDeviceContext, -1, -1, 801, 601);\n    SelectObject(this-&gt;MemDeviceContext, OldBrush);\n    DeleteObject(this-&gt;BackgroundBrush);\n    SetViewportOrgEx(this-&gt;MemDeviceContext, 400, 300, &amp;this-&gt;OldOrigin);\n}\nVOID End() {\n    SetViewportOrgEx(this-&gt;MemDeviceContext, this-&gt;OldOrigin.x, this-&gt;OldOrigin.y, 0);\n    BitBlt(this-&gt;DeviceContext, 0, 0, 800, 600, this-&gt;MemDeviceContext, 0, 0, SRCCOPY);\n}\n</code></pre>\n\n<p>Between my Begin and End function i draw my ellipses the standard GDI way. Here is my begin and end function using Direct2D.</p>\n\n<pre><code>VOID BeginDrawing() {\n    this-&gt;RenderTarget-&gt;BeginDraw();\n    RenderTarget-&gt;Clear(D2D1::ColorF(D2D1::ColorF::CornflowerBlue));\n    RenderTarget-&gt;SetTransform(this-&gt;ScalingMatrix * this-&gt;TranslateMatrix);\n}\nVOID EndDrawing() {\n    this-&gt;RenderTarget-&gt;EndDraw();\n}\n</code></pre>\n\n<p>And here is how i setup my direct2D interfaces. Its all wrapped in class thats why i cant post the full code:</p>\n\n<pre><code>    if(D2D1CreateFactory(D2D1_FACTORY_TYPE_SINGLE_THREADED, &amp;Direct2DFactory) != S_OK)\n        throw std::runtime_error(\"RENDERWINDOW::InitializeDirect2D: Failed to create a factory interface.\");\n    RECT WindowRect;\n    memset(&amp;WindowRect, 0, sizeof(RECT));\n    GetClientRect(this-&gt;WndHandle, &amp;WindowRect);\n    D2D1_SIZE_U WindowSize = D2D1::SizeU(WindowRect.right, WindowRect.bottom);\n    Direct2DFactory-&gt;CreateHwndRenderTarget(D2D1::RenderTargetProperties(D2D1_RENDER_TARGET_TYPE_HARDWARE), \n    D2D1::HwndRenderTargetProperties(this-&gt;WndHandle, WindowSize, D2D1_PRESENT_OPTIONS_IMMEDIATELY), &amp;RenderTarget);\n</code></pre>\n\n<p>Thank You in advance.</p>\n"},{"tags":["c++",".net","winapi","browser","bho"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13098801,"title":"browser helper object in c++","body":"<p>i am new to win api ,this is what i was using in my code </p>\n\n<p><code>SINK_ENTRY_EX(1, DIID_DWebBrowserEvents2, DISPID_DOCUMENTCOMPLETE, OnDocumentComplete)</code></p>\n\n<p>this is perfectly working</p>\n\n<p><strong>note</strong> :</p>\n\n<p><code>OnDocumentComplete</code>-function pointer </p>\n\n<p><code>DISPID_DOCUMENTCOMPLETE</code> --display id (call the function pointed by function pointer when this event occur)</p>\n\n<p>i just tried the below one which will call the event on changing status bar of browser hide or appear but its not working .</p>\n\n<p><code>SINK_ENTRY_EX(1, DIID_DWebBrowserEvents2, DISPID_ONSTATUSBAR,OnDocumentComplete)</code></p>\n\n<p>can any body tell me what's wrong with this?</p>\n"},{"tags":["windows","winapi"],"answer_count":5,"favorite_count":4,"up_vote_count":3,"down_vote_count":0,"view_count":2261,"score":3,"question_id":613513,"title":"How can I make a child process window to appear modal in my process?","body":"<p>I have an application that calls some other utility application to set some settings for a particular device. That utility application is called using ShellExecuteEx.</p>\n\n<p>So as not to confuse the user, it would be better to made the window of the utility application modal to my main window. How does one do this?</p>\n\n<p>Things I've tried:</p>\n\n<ol>\n<li>WaitForSingleObjectEx on the process after ShellExecuteEx, INFINITE TIMEOUT - window is modal, but main application does not repaint (because it's waiting for the single object!)</li>\n<li>WaitForSingleObjectEx on the process after ShellExecuteEx, some small timeout, then call Peekmessage and DispatchMessage - repaint now works, but utility application is no longer \"modal\". The main application responds to mouse clicks, button clicks, etc</li>\n<li>EnableWindow(FALSE), then do method #2, then EnableWindow(TRUE) - WORKS!!!, but after this, the z-order of my application changed. (it's now below some other window). why?!</li>\n</ol>\n"},{"tags":["c#","winapi","time","clickonce","administrator"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":3307,"score":2,"question_id":5713825,"title":"Run as administrator: requireAdministrator & ClickOnce + emulating system time","body":"<p>My app uses ClickOnce  tehcnology. Today I needed to run it as administrator. I modified the manifest file from</p>\n\n<pre><code>&lt;requestedExecutionLevel  level=\"asInvoker\" uiAccess=\"false\" /&gt;\n</code></pre>\n\n<p>to</p>\n\n<pre><code>&lt;requestedExecutionLevel  level=\"requireAdministrator\" uiAccess=\"false\" /&gt;\n</code></pre>\n\n<p>However VS cannot compile the project:</p>\n\n<blockquote>\n  <p>Error 35  ClickOnce does not support the request execution level 'requireAdministrator'.  </p>\n</blockquote>\n\n<p>I think it's impossible to use them at once. Isn't it? I need to change the system time, can I do that in application level? Can I emulate it, so app. can do what I want. I change time +2 hours then put back for a second. I got a few dlls and they ask for time.</p>\n"},{"tags":["c++","multithreading","winapi","synchronization","critical-section"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13279987,"title":"Leaving critical section after thread crash","body":"<p>I've got thread executing commands from list</p>\n\n<pre><code>do\n{\n    commandExec-&gt;criticalSection.EnterCS();\n    if (!commandExec-&gt;commands.empty())\n    {\n        commandExec-&gt;ExecuteCommand(commandExec-&gt;commands.front());\n        commandExec-&gt;commands.pop_front();\n    }\n    else\n        commandExec-&gt;criticalSection.SuspendThread();\n    commandExec-&gt;criticalSection.LeaveCS();\n} while (commandExec-&gt;maintainCommandExecution);\n</code></pre>\n\n<p>and second thread which adds commands to list:</p>\n\n<pre><code>criticalSection.EnterCS();\ncommands.push_back(Command(code, parameters));\ncriticalSection.LeaveCS();\ncriticalSection.ResumeThread();\n</code></pre>\n\n<p>First thread could crash while executing command, therefore critical section could not be accessed by second thread:</p>\n\n<blockquote>\n  <p>If a thread terminates while it has ownership of a critical section, the state of the critical section is undefined.\n  <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms682608%28v=vs.85%29.aspx\" rel=\"nofollow\">Source</a></p>\n</blockquote>\n\n<p><strong>So, what's the good way to handle this problem?</strong> \nI could think of some solutions, but they seems tricky (adding third thread, second critical section, etc.)</p>\n\n<p>(criticalSection it's just simple wrapper for CRITICAL_SECTION)</p>\n"},{"tags":["c++","winapi","system-tray"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":36,"score":2,"question_id":13280191,"title":"How to refresh system tray icons from a C++ code?","body":"<p>During un-installation, when the app crashes, if it had a system tray icon, the icon remains on the system tray and is not removed along with the crashed process. Is there a way to refresh system tray from a C++ code to remove this artifact?</p>\n\n<p>PS. I'm not the one who wrote the app that crashes, so I cannot fix that.</p>\n"},{"tags":["winapi","sleep"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13275974,"title":"How precise is WinAPI's Sleep()?","body":"<p>And I don't mean precision to one millisecond, I'm asking about a situation when I want a delay of an hour using <code>Sleep(60 * 60 * 1000)</code>. Will it be an hour and not like 55 or 70 minutes? Is thread guaranteed to wake up and not sleep forever? </p>\n"},{"tags":["c++","windows","winapi","boot"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13277837,"title":"Windows 7 boot information","body":"<p>I'm looking for a way to obtain the boot information in W7 (using C++ and the windows API), for instance:</p>\n\n<ul>\n<li>The Services that have been started during the boot.</li>\n<li>The Drivers loaded at boot time.</li>\n<li>The programs started at boot time.</li>\n<li>Performance of boot.</li>\n</ul>\n\n<p>I know it's possible to read the Diagnostics-Performance logs to access some information, but I would like to know if a way to access more detailed information is available. Of course, the programs that are configured to start with Windows are configured on the \"Start\" folder of the user, and the registry contains information (a bit cryptic) about the boot. So far, I've found the following:</p>\n\n<ul>\n<li>Service Control Manager, part of the Windows Management Instrumentation, exposes methods to manipulate services and drivers, but doesn't seem to have the data I'm looking for.</li>\n<li>Boot Configuration Data has the information about the configuration of the boot, mostly used to configure the boot of multiple OS, but doesn't seem to have the data I'm looking for either.</li>\n</ul>\n\n<p>What I like to do is something similar to what the <a href=\"http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx\" rel=\"nofollow\">Process Monitor</a> and <a href=\"http://www.softpedia.com/get/System/System-Info/WinBootInfo.shtml\" rel=\"nofollow\">this other tool</a> do, gathering information about the boot of the system.</p>\n\n<p>It appears as if the boot information in W7 cannot be accessed easily, and the process itself is somewhat obscure.</p>\n\n<p>Can anyone point me to the appropriate documentation? Does anyone know if it is possible to user the WinAPI for this, and point me to the API I can use to access the boot information?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c++","winapi","gdi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13274458,"title":"Create or remove GDI shapes on command","body":"<p>I'm creating a win32 application. on the main window there are 5 buttons. in front of each button there is a small circle drawn. (using GDI tools. in case WM_PAINT). now when I press on a button the circle in front of it should colour in red colour. how can I do this.</p>\n\n<p>If we create a edit box any time we can change the text on it using SendMessege to it. like that is it possible to change the colour on shapes drawn earlier. </p>\n\n<p>Please can someone give me an advice.</p>\n\n<pre><code>case WM_PAINT:\n    {\n    PAINTSTRUCT ps;\n    HDC hDC;\n    HBRUSH brusha;\n\n    hDC=BeginPaint(hWnd,&amp;ps);       \n    brusha=CreateSolidBrush(RGB(0,255,0));\n    SelectObject(hDC,brusha);\n    Ellipse(hDC, 20, 20, 50, 50);\n    DeleteObject(brusha);\n    EndPaint(hWnd, &amp;ps);\n    }\n\n case WM_COMMAND:\n      switch(LOWORD(wParam))\n        {\n            case BUTTON:\n            {\n             //here I need to change the above drawn corcle to be red.\n            }\n        }\n</code></pre>\n"},{"tags":["c#",".net","winapi","cracking","detours"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":13276741,"title":"Prevent detouring functions. Avoid cracking","body":"<p>There is an application that checks for activation using DLL <code>Check</code> function. <code>Check</code> returns 1 if application is activated and 0 otherwise. I create simple application and DLL containing function <code>MyCheck</code> (which always returns 1) with the same signature and detoured <code>Check</code> function with my version using MS detours lib for function hooking. Obviously it works and the application is successfully cracked, so I need to avoid it.</p>\n\n<ol>\n<li><p>I tried to call <code>Check</code> function directly (by specifying exact address), without even using <code>GetProcAddress</code>, but looks like detours lib is modifying the function body itself, not export table.</p>\n\n<pre><code>[UnmanagedFunctionPointer(CallingConvention.StdCall)]\nprivate delegate bool CheckFunctionDelegate();\n\nstatic void Main(string[] args)\n{\n    ProcessModule module = Process.GetCurrentProcess().Modules\n        .Cast&lt;ProcessModule&gt;()\n        .First(m =&gt; m.ModuleName == \"licensing_check.dll\");\n\n\n    IntPtr procedurePtr = IntPtr.Add(module.BaseAddress, 0x00003FF0);\n\n    // Calling validation function by pointer\n    CheckFunctionDelegate checkFunction = (CheckFunctionDelegate)\n        Marshal.GetDelegateForFunctionPointer(procedurePtr, typeof(CheckFunctionDelegate));\n\n    if (checkFunction())\n    {\n        // do some stuff\n    }\n}\n</code></pre>\n\n<p>}</p></li>\n<li><p>Then I tried to read function body and I see that after detour MD5 checksum differs from the original one. So I'm trying to read entire contents of DLL in memory and check it to confirm that DLL contents are not changed, but it doesn't work either. It throws <code>AccessViolationException</code>.</p>\n\n<p>Process.EnterDebugMode();</p>\n\n<p>ProcessModule module = Process.GetCurrentProcess().MainModule;\nbyte[] data = new byte[module.ModuleMemorySize];\nMarshal.Copy(module.BaseAddress, data, 0, module.ModuleMemorySize);</p></li>\n</ol>\n\n<p>I used MainModule here, but it gives the same error for each module in <code>Process.GetCurrentProcess().Modules</code> collection.</p>\n\n<p>I would appreciate any help on this, I'm not necessarily expecting to solve it in one of the ways I describe, any good solution is acceptable.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c++","winapi","hwnd"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":54,"score":3,"question_id":13272307,"title":"Setting a HWND's lpfnWndProc from another process","body":"<p>I have a win32 main application that spawns a child process.</p>\n\n<p>At the moment I use CreateWindowEx to create a HWND in the main application followed by spawning a child process. The child process then looks up the HWND using FindWindow. I would like to handle the Window messages (e.g. WM_SIZE, WM_SETFOCUS etc) for this HWND in the child process, therefore I tried setting the GWLP_WNDPROC attribute in the child process but I'm getting an access denied error, which is reasonable.</p>\n\n<p>I thought about creating a HWND directly in the child process instead but when the window is clicked on, the main application loses focus which is not acceptable for my use case.</p>\n\n<p>Does anyone have a suggestion on what to do to keep the focus on the main application, while having the child process handling the messages?</p>\n"},{"tags":["c#","winapi","modal","outlook-2007","inspector"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":754,"score":3,"question_id":5784237,"title":"How to : Given HWND, discover if window is Modal or not","body":"<p>For any given window I handle, I need a way to find out whether or not the given window is Modal.</p>\n\n<p>Far as I can tell, there are no methods that do exactly that, which is why I need some clever workaround to work this out!</p>\n\n<p>Help is appreciated!</p>\n\n<p>EDIT : Why is my GetWindow(,GW_OWNER) failing? :(</p>\n\n<pre><code>    [DllImport(\"user32.dll\", SetLastError = true, CharSet = CharSet.Auto)]\n    internal static extern IntPtr FindWindow(string lpClassName, string lpWindowName);\n    [DllImport(\"user32.dll\", SetLastError = true)]\n    internal static extern IntPtr GetWindow(IntPtr hWnd, GetWindow_Cmd uCmd);\n    [DllImport(\"user32.dll\", ExactSpelling = true)]\n    internal static extern IntPtr GetAncestor(IntPtr hwnd, GetAncestor_Flags gaFlags);\n    [DllImport(\"user32.dll\", SetLastError = false)]\n    internal static extern IntPtr GetDesktopWindow();\n    [DllImport(\"user32.dll\", SetLastError = true)]\n    internal static extern int GetWindowLong(IntPtr hWnd, int nIndex);\n\n    const UInt32 WS_DISABLED = 0x8000000;\n\n\n    internal enum GetAncestor_Flags\n    {\n        GetParent = 1,\n        GetRoot = 2,\n        GetRootOwner = 3\n    }\n\n    internal enum GetWindow_Cmd : uint\n    {\n        GW_HWNDFIRST = 0,\n        GW_HWNDLAST = 1,\n        GW_HWNDNEXT = 2,\n        GW_HWNDPREV = 3,\n        GW_OWNER = 4,\n        GW_CHILD = 5,\n        GW_ENABLEDPOPUP = 6\n    }\n\n\n\nIntPtr _inspHwnd = FindWindow(\"rctrl_renwnd32\", inspector.Caption); // searching for a window with this name\n        if (_inspHwnd.ToInt32() != 0) // found window with this name\n        {\n            IntPtr _ownerHwnd = GetWindow(_inspHwnd, GetWindow_Cmd.GW_OWNER);\n            if (_ownerHwnd.ToInt32() != 0)\n            {\n                IntPtr _ancestorHwnd = GetAncestor(_ownerHwnd, GetAncestor_Flags.GetParent);\n                if (_ancestorHwnd == GetDesktopWindow())\n                {\n                    if (GetWindowLong(_ancestorHwnd, -16) == WS_DISABLED) \n                    { \n                        // inspector is probably modal if you got all the way here\n                        MessageBox.Show(\"modal flag tripped\");\n                    }\n                }\n            }\n        }\n</code></pre>\n"},{"tags":["windows","winapi","statusbar"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":107,"score":3,"question_id":11519524,"title":"Purpose of style 0x00000010","body":"<p>After spying Windows XP Regedit with Spy++, I found then status bar is used unknown style <strong>0x00000010</strong>.</p>\n\n<p>I try make own status bar with or without this value, but I cant see difference.</p>\n\n<p>I think, this style is missing <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb775498%28v=vs.85%29.aspx\" rel=\"nofollow\">Common Control Styles</a> value, because this value is missing in <em>commctrl.h</em>.</p>\n\n<p>Can someone explain purpose of this value?</p>\n"},{"tags":["windows","winapi","explorer","windows-shell","shell-extensions"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12260634,"title":"Shell namespace extension adding barricade","body":"<p>I implemented namespace extension using default shell view in <strong>Windows XP</strong>.\nEverything works fine, but I want add barricade (<a href=\"http://support.microsoft.com/kb/272963\" rel=\"nofollow\">A Description of Protected Folders</a> - also applicable to Windows XP).\nIs possible this using documented/undocumented functions (SFVM messages), or this feature is hard-coded ?</p>\n"},{"tags":["windows","winapi","dll","samba","smb"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13272929,"title":"Is netapi32.dll exclusively for Windows platforms?","body":"<p>When I tried <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa370623%28v=vs.85%29.aspx\" rel=\"nofollow\">NetServerEnum</a> function for finding out available servers on the network, to my surprise it only listed servers running on windows platform family. Specifically it listed servers having PLATFORM_ID_NT=500(The Windows NT platform). </p>\n\n<p>May be the network didn't have any other servers(platforms) running. I was quite sure that one linux machine was running on the same network. Instead my need was to locate this server(running samba), but the function didn't list that machine details.</p>\n\n<p>So is this netapi32.dll exclusively used over windows network only?</p>\n"},{"tags":["c++","winapi","null","folder","case"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":13268142,"title":"C++ - Creating folder method","body":"<p>I have the following method in C++:</p>\n\n<p>In case the folder already exists, the correct message is displayed on the screen.  However, if the folder does NOT exist, nothing is displayed on the screen, that is, the part identified by case NULL is not executed.  How can I solve this problem?</p>\n\n<p>In other words, how can I get the code after the case NULL to run if the folder does not exist?</p>\n"},{"tags":["c++","c","windows","winapi","sprintf"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":13269146,"title":"What is StringCbprintf and how's this different than general sprintf?","body":"<p>I am going through a previously written code and I found <code>StringCbPrintf()</code> function</p>\n\n<p>I found declaration on <code>msdn</code> site like this :</p>\n\n<pre><code>HRESULT StringCbPrintf(\n  _Out_  LPTSTR pszDest,\n  _In_   size_t cbDest,\n  _In_   LPCTSTR pszFormat,\n  _In_    ...\n);\n</code></pre>\n\n<p>What is <code>_in_</code> and <code>_out_</code> here ?</p>\n\n<p>And why is it needed when we already have <code>sprintf()</code> ?</p>\n"},{"tags":["c++","qt","winapi","unicode","filenames"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13267667,"title":"FILE_NOTIFY_INFORMATION doesn't support Utf-8 file name","body":"<p>I am trying to watch a folder changes and notify the added filename so here is my code</p>\n\n<pre><code>bool FileWatcher::NotifyChange()\n{\n    // Read the asynchronous result of the previous call to ReadDirectory\n    DWORD dwNumberbytes;\n    GetOverlappedResult(hDir, &amp;overl, &amp;dwNumberbytes, FALSE);\n\n    // Browse the list of FILE_NOTIFY_INFORMATION entries\n\n    FILE_NOTIFY_INFORMATION *pFileNotify = (FILE_NOTIFY_INFORMATION *)buffer[curBuffer];\n    // Switch the 2 buffers\n    curBuffer = (curBuffer + 1) % (sizeof(buffer)/(sizeof(buffer[0])));\n    SecureZeroMemory(buffer[curBuffer], sizeof(buffer[curBuffer]));\n    // start a new asynchronous call to ReadDirectory in the alternate buffer\n    ReadDirectoryChangesW(\n         hDir, /* handle to directory */\n         &amp;buffer[curBuffer], /* read results buffer */\n         sizeof(buffer[curBuffer]), /* length of buffer */\n         FALSE, /* monitoring option */\n         FILE_NOTIFY_CHANGE_FILE_NAME  ,\n         //FILE_NOTIFY_CHANGE_LAST_WRITE, /* filter conditions */\n         NULL, /* bytes returned */\n         &amp;overl, /* overlapped buffer */\n         NULL); /* completion routine */    \n\n    for (;;) {\n         (pFileNotify-&gt;Action == FILE_ACTION_ADDED)\n        {\n                qDebug()&lt;&lt;\"in NotifyChange if \";\n                char szAction[42];\n                char szFilename[MAX_PATH] ;\n                memset(szFilename,'\\0',sizeof( szFilename));\n                strcpy(szAction,\"added\");\n                wcstombs( szFilename, pFileNotify-&gt;FileName, MAX_PATH);\n                qDebug()&lt;&lt;\"pFileNotify-&gt;FileName : \"&lt;&lt;QString::fromWCharArray(pFileNotify-&gt;FileName)&lt;&lt;\"\\nszFilename : \"&lt;&lt;QString(szFilename);                       \n\n        }\n\n        // step to the next entry if there is one\n        if (!pFileNotify-&gt;NextEntryOffset)\n            return false;\n        pFileNotify = (FILE_NOTIFY_INFORMATION *)((PBYTE)pFileNotify + pFileNotify-&gt;NextEntryOffset);\n    }\n    pFileNotify=NULL;\n    return true;\n}\n</code></pre>\n\n<p>It works fine unless a file with Arabic name was added so I get</p>\n\n<pre><code>pFileNotify-&gt;FileName :  \"???  ???????.txt\" \nszFilename :  \"\"  \n</code></pre>\n\n<p>How can I support the UTF-8 code file name ???\nany idea please.</p>\n"},{"tags":["c","windows","winapi","ddk"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":13254487,"title":"Why am I getting Error Code 6 on StartService?","body":"<p>For my purposes, I need to write a kernel mode driver for Windows. Currently I am attempting to make it work under Windows 7 x64.</p>\n\n<p>I created a simple project in Visual Studio 2012 with default code for a KMDF driver. I compiled the code with test-signing on. The driver was compiled and signed. \nI also have Test-Signing ON enabled as clearly displayed on the bottom left corner of my Desktop.</p>\n\n<p>Upon trying to start the driver as a service, I always get an Error Code 6: Invalid Handle error.(I have since simplified the code to just try and start it but still did not work;default code did not work either)</p>\n\n<p>Basically, I am having the same problem as the question asked here</p>\n\n<p><a href=\"http://stackoverflow.com/questions/12080157/startservice-error-6\">StartService Error 6</a> </p>\n\n<p>unfortunately he was never answered. I tried the provided solution, but it didn't help either.</p>\n\n<p>My code that tries to start the driver is </p>\n\n<pre><code>int _cdecl main(void)\n{\n    HANDLE hSCManager;\n    HANDLE hService;\n    SERVICE_STATUS ss;\n\n    hSCManager = OpenSCManager(NULL, NULL, SC_MANAGER_CREATE_SERVICE);\n\n    printf(\"Load Driver\\n\");\n\n    if(hSCManager)\n    {\n        printf(\"Create Service\\n\");\n\n        hService = CreateService(hSCManager, \"Example\", \n                             \"Example Driver\", \n                              SERVICE_ALL_ACCESS | SERVICE_START | DELETE | SERVICE_STOP , \n                              SERVICE_KERNEL_DRIVER,\n                              SERVICE_DEMAND_START, \n                              SERVICE_ERROR_IGNORE, \n                              \"\\\\path\\\\to\\\\driver\\\\KMDFDriver1.sys\", \n                              NULL, NULL, NULL, NULL, NULL);\n\n        if(!hService)\n        {\n            hService = OpenService(hSCManager, \"Example\", \n                   SERVICE_ALL_ACCESS | SERVICE_START | DELETE | SERVICE_STOP);\n\n            if(!hService)\n            {\n                // If initial startup of the driver failed, it will fail here.\n                process_error();\n                return 0;\n            }\n        }\n\n        if(hService)\n        {\n            printf(\"Start Service\\n\");\n\n            if(StartService(hService, 0, NULL) == 0)\n            {\n              // Start service ALWAYS returns 0. Only when executed for the first time. Next time it fails on OpenService.\n                process_error();\n                printf(\"Did not start!\\n\");\n            }\n            printf(\"Press Enter to close service\\r\\n\");\n            getchar();\n            ControlService(hService, SERVICE_CONTROL_STOP, &amp;ss);\n            DeleteService(hService);\n            CloseServiceHandle(hService);   \n        }\n\n        CloseServiceHandle(hSCManager);\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>And this is the driver code</p>\n\n<pre><code>DRIVER_INITIALIZE DriverEntry;\n#ifdef ALLOC_PRAGMA\n#pragma alloc_text (INIT, DriverEntry)\n#endif\n\nNTSTATUS\nDriverEntry(\n    _In_ PDRIVER_OBJECT  DriverObject,\n    _In_ PUNICODE_STRING RegistryPath\n    )\n{\n\n    WDF_DRIVER_CONFIG config;\n    NTSTATUS status;\n\n    DbgPrint(\"Hello World!\\n\");\n    WDF_DRIVER_CONFIG_INIT(&amp;config,\n                       NULL\n                       );\n\n    config.DriverInitFlags = WdfDriverInitNonPnpDriver;\n\n    status = WdfDriverCreate(DriverObject,\n                         RegistryPath,\n                         WDF_NO_OBJECT_ATTRIBUTES,\n                         &amp;config,\n                         WDF_NO_HANDLE\n                         );\n\n    if (!NT_SUCCESS(status)) {\n        KdPrint( (\"WdfDriverCreate failed with \"\n              \"status 0x%x\\n\", status));\n    }\n\n    return status;\n}\n</code></pre>\n\n<p>The function <code>process_error()</code> is a wrapper around <code>GetLastError()</code> which in addition to providing the numeric value, displays a text version of the error code.\nI have exhausted all options provided to me to solve this issue. A google search revealed only one occurrence of this problem, and the question was asked here.</p>\n\n<p>What could the problem be?</p>\n\n<p>Extra notes: The driver was compiled with Visual Studio 2012 Ultimate, while my startup code was compiled with MinGW-W64(using GCC). But the startup code shouldn't matter as much as the driver.</p>\n\n<p>Extra notes 2: After wondering for a long time what could be wrong I started thinking if it's the test-sign certificate, because I tried driver source code provided from MSDN, and upon successful compilation, I still got ERROR_INVALID_HANDLE(Error Code 6) when trying to start it.\nI have still not found a solution.</p>\n"},{"tags":["delphi","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":13157412,"title":"How do I convert a relative PIDL into an absolute PIDL?","body":"<p>I want to use <code>SHGetFileInfo</code>  to get windows control panel icon,I use Shell to get windows control panel \nCode:</p>\n\n<pre><code>var\n  psfDeskTop: IShellFolder;\n  psfWork: IShellFolder;\n\n  pidworkDir: PITEMIDLIST;\n  pidChild: PITEMIDLIST;\n\n  pEnumList: IEnumIDList;\n  celtFetched: ULONG;\n  //chEaten, dwAttributes: ULONG;\n  FileInfo: SHFILEINFOW;\n\n  //conGUID: string;\n  StrRetName: TStrRet;\n  Name: PChar;\n\nbegin\n\n  SHGetDesktopFolder(psfDeskTop);\n  SHGetSpecialFolderLocation(0, CSIDL_CONTROLS, pidworkDir);\n  psfDeskTop.BindToObject(pidworkDir, nil, IID_IShellFolder, psfWork);\n  psfWork.EnumObjects(0, SHCONTF_NONFOLDERS or SHCONTF_FOLDERS or SHCONTF_INCLUDEHIDDEN, pEnumList);\n\n  while pEnumList.Next(1, pidChild, celtFetched) = 0 do\n  begin\n\n    //here I want to use SHGetFileInfo to get file icon\n    //but , SHGetFileInfo need a absolute PIDL,IEnumIDList enumerates relative PIDL\n\n  end  \n\nend;\n</code></pre>\n\n<p>I found a function called <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb773321%28v=vs.85%29.aspx\" rel=\"nofollow\">ILCombine</a> in MSDN to do that , but I can't found in Delphi , I wonder if possible to combine pidworkDir and pidChild to get a absolute PIDL in Delphi?</p>\n\n<p>Or is there any other way to get a file's icon?   </p>\n"},{"tags":["c++","winapi","dll"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13269238,"title":"Work Station Lock Notification","body":"<p>I am trying to write a dll which has a feature of calculating time the workstation was locked (Workstation lock as in pressing windows key + L). Now, I tried search a way for implementing this, the answer I got was listening for notifications from WTSRegisterSessionNotification. <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa383841%28v=vs.85%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/aa383841%28v=vs.85%29.aspx</a></p>\n\n<p>how can get these notifications from withing a DLL?</p>\n\n<p>Example I read was :\n<a href=\"http://msdn.microsoft.com/en-us/library/ms775296%28v=vs.85%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms775296%28v=vs.85%29.aspx</a></p>\n\n<p>But couldn't understand how to use from wo=ithin a DLL.</p>\n"},{"tags":["c++","winapi","user32"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":43,"score":0,"question_id":13268746,"title":"How to get quick launch bar size in Windows XP?","body":"<p>I want to get quick launch bar size, but my code returns false, where is the problem?</p>\n\n<pre><code>REBARBANDINFOW prbi;\nmemset(&amp;prbi, 0, sizeof(REBARBANDINFOW));\n\nprbi.cbSize = sizeof(REBARBANDINFOW);\nprbi.fMask = 892;\n\nHWND hWndTray = ::FindWindow(L\"Shell_TrayWnd\", 0);\nHWND hRebar = ::FindWindowEx(hWndTray, NULL, L\"ReBarWindow32\", 0);\nint i = ::SendMessage(hRebar, RB_GETBANDINFOW, 0, (LPARAM)(LPREBARBANDINFOW)&amp;prbi);\n</code></pre>\n"},{"tags":["c++","security","winapi","directory"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13268625,"title":"Security Attributes when creating folder","body":"<p>I have the following line of code:</p>\n\n<pre><code>CreateDirectory(full_folder, attr);\n</code></pre>\n\n<p>Now the attr variable is of type LPSECURITY_ATRRIBUTES and is currently set to NULL.  Can anyone please provide me with a list of all the keywords that are accepted by this variable.  I have searched over the internet but I can't seem to find a proper list.  Maybe I am not searching correctly.</p>\n\n<p>Thanks :)</p>\n"},{"tags":["c++","winapi","magnification-api"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":12571317,"title":"Drawing over magnifier window (Magnification API)","body":"<p>I′m creating an app by using windows magnification API and need to draw over there, but have no idea HOW.\nI was try to draw on DC, but it not work.</p>\n"},{"tags":["c++","windows","winapi","active-directory","adsi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13265181,"title":"How to convert Variant Safe Array into Char using C++ win32 API?","body":"<p>Hai i want to convert the <code>&amp;var</code> values into char array.\nhow can i achieve this?\ni am using C++ Win32 API. \n   <img src=\"http://i.stack.imgur.com/rMl3K.png\" alt=\"Safe Array to Char\"></p>\n\n<p>Open image in another tab,you will get clear View.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["internet-explorer","winapi","visual-c++","browser","bho"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13267670,"title":"On Download Complete event with BHO","body":"<p>Can any one help me i am struct here.\ni want to implement OnDownloadComplete event but when this function got hit its not showing web page in browser why is not displaying any thing the below piece of code may help you to understand my problem i hope </p>\n\n<pre><code>BEGIN_SINK_MAP(CHelloWorldBHO)\nSINK_ENTRY_EX(1, DIID_DWebBrowserEvents2, DISPID_DOWNLOADCOMPLETE, OnDownloadComplete)\nEND_SINK_MAP()\n\nvoid STDMETHODCALLTYPE CHelloWorldBHO::OnDownloadComplete( )\n{\nLPCWSTR location_url;\nm_spWebBrowser-&gt;get_LocationURL((BSTR*)&amp;location_url);\nMessageBox(NULL, location_url , L\"BHO\", MB_OK);\n wchar_t* ext = L\".in\";\nif (wcsstr(location_url, ext))\nMessageBox(NULL, L\"suku OnDownloadComplete .in !\", L\"BHO\", MB_OK);\nelse\nMessageBox(NULL, L\"suku OnDownloadComplete something !\", L\"BHO\", MB_OK);\n}\n</code></pre>\n\n<p>it just display the dialogbox but not webpage .please tell me where i am wrong or what should i do to display webpage</p>\n"},{"tags":["windows","internet-explorer","winapi","visual-c++","bho"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5,"score":0,"question_id":13266864,"title":"FileDownload Event in Internet Explorer","body":"<p>can any one give me good example of file download event.i tried the below code\nfor not displaying download dialogbox for only pdf but its not even downloading any of the webpage can any one tell me where i am wrong</p>\n\n<pre><code>void STDMETHODCALLTYPE CHelloWorldBHO::OnFileDownload( VARIANT_BOOL active_doc,      VARIANT_BOOL* cancel)\n{\nLPCWSTR location_url;\nm_spWebBrowser-&gt;get_LocationURL((BSTR*)&amp;location_url);\nMessageBox(NULL, location_url , L\"BHO\", MB_OK);\nwchar_t* ext = L\".pdf\";\nif (wcsstr(location_url, ext))\n{\nMessageBox(NULL, L\"file download begins .in !\", L\"BHO\", MB_OK);\n*cancel=false;\n}\nelse\n{\nMessageBox(NULL, L\"file download begins  something!\", L\"BHO\", MB_OK);\n*cancel=true;\n}\n\n}\n</code></pre>\n"},{"tags":["c#",".net","wpf","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2962,"score":0,"question_id":1776382,"title":"How do I remove the icon and title from a WPF Window but display it in the taskbar?","body":"<p>I'm trying to create a WPF window, which has no icon and no title displayed in the titlebar.</p>\n\n<p>I already found some examples how the icon can be removed (for example <a href=\"http://www.danrigsby.com/blog/index.php/2008/05/26/remove-icon-from-wpf-window/\" rel=\"nofollow\">here</a>), but all these solutions work if I'm debugging the application in Visual Studio but they don't work when I'm just running the executable.</p>\n\n<p>I would also like the title not to be shown. Of course I could leave the title blank, but I would like the title to be disyplayed in the taskbar (similiar to what Windows Explorer does in Vista/7)</p>\n"},{"tags":["delphi","winapi","delphi-2009"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":13264626,"title":"Handle of TComponent instance","body":"<p>I have an instance of <code>TComponent</code> class and need to interact with the respective control via WinAPI calls.</p>\n\n<p>In order to do this, I need a handle of the control represented by <code>TComponent</code> instance.</p>\n\n<p>How can I get that handle from <code>TComponent</code>?</p>\n"},{"tags":["c++","winapi","visual-c++"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":371,"score":0,"question_id":4497031,"title":"c++ create text fits edit box","body":"<p>Well..  I know that title is not that clear, I couldn't think of better one.<br>\nI wanna know how to do this...<br>\nwhen you have edit box and it only can show 10 characters.<br>\nSomething like this</p>\n\n<hr>\n\n<p>ssssssssss</p>\n\n<hr>\n\n<p>let just say i have more than 10 characters.  Some of them will go in the back.<br>\nLike we have this string \"123456789010\" it will show just these ones \"3456789010\".<br>\nMy problem is that some characters are small and don't take that much space and some do.<br>\nSo i can't find a way to break the string and get some characters in the back.<br>\nany idea?</p>\n"},{"tags":["c++","winapi","background","treeview","common-controls"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13264378,"title":"TVM_SETBKCOLOR and TreeView_SetBkColor not declared in this scope?","body":"<p>I'm getting the strange scope error: <code>'TVM_SETBKCOLOR' was not declared in this scope</code> and similar <code>'TreeView_SetBkColor' was not declared in this scope</code>.  I can't figure out why this is happening:</p>\n\n<ul>\n<li>I have included <code>commctrl.h</code></li>\n<li>Other treeview macros work fine (like <code>TreeView_DeleteItem</code>)</li>\n<li>Autocomplete recognizes and finishes <code>TreeView_SetBkColor</code> so it's not a spelling problem</li>\n<li>I read the documentation pretty well</li>\n</ul>\n\n<hr>\n\n<p>Here's a snippet from the applicable window.  Everything is working fine, until I try to change the background of the <code>tvw_filelist_</code> variable.</p>\n\n<pre><code>void PnlTree::Init(HWND hwnd0, const char * superclassname0) {\n    tvw_filelist_ = CreateWindowEx (0,\n            superclassname0, NULL,\n            TVS_HASLINES | TVS_LINESATROOT | TVS_HASBUTTONS | WS_CHILD | WS_VISIBLE,\n            0, 0, 0, 0,\n            hwnd0, (HMENU) IDC_TVWFILELIST, NULL, NULL\n            );\n\n    txt_blurb0_ = CreateWindowEx (0,\n            TEXT(\"STATIC\"), \"Drag files and folders into this pane.\",\n            SS_CENTER | SS_CENTERIMAGE | WS_CHILD | WS_VISIBLE,\n            0, 0, 0, 0,\n            hwnd0, NULL, NULL, NULL\n            );\n\n    txt_blurb1_ = CreateWindowEx (0,\n            TEXT(\"STATIC\"), \"Press DELETE to remove an entry.\",\n            SS_CENTER | SS_CENTERIMAGE | WS_CHILD | WS_VISIBLE,\n            0, 0, 0, 0,\n            hwnd0, NULL, NULL, NULL\n            );\n\n    HFONT hFont = CreateFont(15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \"Segoe UI\");\n\n    ::SendMessage(txt_blurb0_, WM_SETFONT, (WPARAM) hFont, 0);\n    ::SendMessage(txt_blurb1_, WM_SETFONT, (WPARAM) hFont, 0);\n\n    // Everything works perfectly, if this line is commented out.\n    TreeView_SetBkColor(tvw_filelist_, RGB(235, 235, 235));\n}\n\n//\n//\n//\nvoid PnlTree::RemoveItem(WPARAM wParam) {\n    if (wParam == VK_DELETE) {\n        TreeView_DeleteItem(tvw_filelist_, TreeView_GetSelection(tvw_filelist_));\n    }\n}\n</code></pre>\n\n<p>I've also tried</p>\n\n<pre><code>::SendMessage(tvw_filelist_, TVM_SETBKCOLOR, 0, RGB(235, 235, 235));\n</code></pre>\n\n<p>but I get the same error.  What's going on?</p>\n\n<p><em>(Environment: Code::Blocks, MinGW, Win7 x64)</em></p>\n"},{"tags":["c++","windows","winapi","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13263166,"title":"Using GDI+ vs HTML page","body":"<p>I am working on an application which is UI intensive (i.e. we need to customize all the control to look different). </p>\n\n<p>For this is I planned to use GDI+ in win32. But one of the suggestion form our team member is,\nInstead of using GDI+ he asked me to have a web browser control, in that he asked me to display local html.That html page contains customized controls. </p>\n\n<p>Form his suggestion I created a web control and used some UI intensive local html pages. That looks good.</p>\n\n<p>But my question is, is it is a good idea to use web control to solve this?</p>\n"},{"tags":["windows","winapi","visual-c++","crash-dumps","wer"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":17,"score":0,"question_id":13263695,"title":"How to collect Application Crash Dumps","body":"<p>I need to collect the crash dumps for some specific applications. I have gone through this <a href=\"http://msdn.microsoft.com/en-us/library/bb787181%28VS.85%29.aspx\" rel=\"nofollow\">article</a> but can't say it helped me much.</p>\n\n<p><strong>Platform::</strong> WinXP, Vista &amp; Win7.</p>\n\n<p>Seems that WinXP and above versions collect the dumps differently. For Example, say if I want to collect all dump files for IE, what would be the steps I should follow?</p>\n"},{"tags":["winapi","graphics","3d","directx"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":37,"score":3,"question_id":13262541,"title":"Disable GPU Boost","body":"<p>I'm programming a game and I want to be able to disable GPU boost in my GTX 680 card from the source code, i.e. with c++ or assembly. I know this question might be a little odd, but I can't think of any other way to word it.</p>\n\n<p>I'm reading a book on dx11 programming (Frank De Lunas), and I am getting really low frame rates in one of the advanced examples. I monitored my gpu speed and it was running at idle speeds (324 Mhz). The problem is probably how the demo was coded, but it may me think that regardless of that I will like to have the ability of turning GPU boost off.</p>\n"},{"tags":["c++","windows","winapi","ldap","adsi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13253293,"title":"How to set and get multiple values(array values) to Single attribute in Active Directory using C++ win32 API?","body":"<p>i am using C++ Win32 API.</p>\n\n<p>i have done to connect AD using ldap functions &amp; create a attribute.</p>\n\n<p>i done to set &amp; get single values to attributes from AD.</p>\n\n<p>Now,i want to set multiple values in myown attribute.the attribute name is \n\"UsrAttrib\".</p>\n\n<p>how to set array of value into this attribute?</p>\n\n<p>And i already tried to get \"objectClass\" attribute value,using below code.</p>\n\n<pre><code>usrValue = ldap_get_values(\n                          pLdapConnection,  // Session Handle\n                          pEntry,           // Current entry\n                          \"ObjectClass\");\n</code></pre>\n\n<p>the attribute actual value is <code>top;person;organizationalPerson;user</code></p>\n\n<p>But <code>usrValue</code> only gives <code>top</code> only.</p>\n\n<p>and i check using <code>ldap_count_values</code> it gives <code>4</code>.</p>\n\n<p>How to i get all values from that attribute?</p>\n"},{"tags":["visual-studio","winapi","assembly","linker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13261881,"title":"Cannot link with system32.dll using visual studio command prompt","body":"<p>Using link.exe with the visual studio command prompt:</p>\n\n<pre><code>link.exe \"C:\\Users\\Jon\\Desktop\\euler\\asm\\test\" kernel32.dll\n</code></pre>\n\n<p>provides the ever helpful: <code>LINK : fatal error LNK1181: cannot open input file 'kernel32.dll'</code>\nWhy can't it link against a system dll?</p>\n\n<p>I moved on to GoLink:</p>\n\n<pre><code>\"C:\\Program Files (x86)\\nasm\\golink.exe\" /console test.obj Kernel32.dll\n</code></pre>\n\n<p>Which links just fine, but crashes as soon as I run it.\nI'm using NASM <code>\"C:\\Program Files (x86)\\nasm\\nasm.exe\" -fwin64 \"test.asm\"</code></p>\n\n<p>Here's my assembler <a href=\"http://pastebin.com/q8ucpUBu\" rel=\"nofollow\">Pastebin</a></p>\n"},{"tags":["c++","winapi","dll","absolute-path","loadlibrary"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":13255845,"title":"LoadLibrary with Absolute Path returns Incorrect HMODULE with No Error","body":"<p>I have some code which is trying to load a Dll. </p>\n\n<p>I have encountered an odd 'error' with this. When trying to load the dll from an absolute path, I get a Non-Null HMODULE that gives no windows error codes on a GetLastError call (i.e. GetLastError returns '0' or success according to <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms681382%28v=vs.85%29.aspx\" rel=\"nofollow\">msdn</a>). When calling into a function in this dll, I get incorrect values.</p>\n\n<p>This behavior is peculiar, because if, instead, I switch the current directory to be that of my current dll using SetCurrentDirectory and use a relative path call to LoadLibrary, I get correct values.</p>\n\n<p>Here is a snippet describing the situation:</p>\n\n<p>Using absolute path:</p>\n\n<pre><code>std::string libLoc = get_dll_location(); // Get the directory of this dll\nHMODULE myDLL = LoadLibraryA(libLoc.c_str()); // Non-null value\nDWORD lastError = GetLastError(); // returns 0\n\nMyObj * value = UseDLL(myDLL); // bad value\n</code></pre>\n\n<p>Using relative path:</p>\n\n<pre><code>SetCurrentDirectory(\"c:\\\\path\\\\containing\\\\dll\\\\\"); // hard coded path to dll's folder\nHMODULE myDLL = LoadLibrary(\"myDll.dll\");  // Non-null value\nMyObj * value = UseDLL(myDLL);  // Good value\n</code></pre>\n\n<p>I'd really like to avoid having to use SetCurrentDirectory, because the application using this Dll may be multi-threaded and require that the directory stays the same. </p>\n\n<p>Any insight on this issue would be much appreciated. Hopefully, this is just a minor bug on my part.</p>\n\n<p><strong>Update</strong>: Using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms684179%28v=vs.85%29.aspx\" rel=\"nofollow\">LoadLibraryEx</a> seems to be out of the question, as the LOAD_LIBRARY_SEARCH_* flags don't appear to be available to me (I've already tried installing the <a href=\"http://support.microsoft.com/kb/2533623\" rel=\"nofollow\">KB2533623 update</a>).</p>\n"},{"tags":[".net","winapi","rdp"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1897,"score":0,"question_id":579209,"title":"How can I initiate a Remote Assistance session in .NET?","body":"<p>I'm writing a help desk application and would like to allow my users to initiate a Remote Assistance session on a remote PC.  This can be done via Help in Windows XP, but I haven't been able to find any code sample in .NET.   Thanks!</p>\n"},{"tags":["c++","windows","winapi","hash","md5"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":13256446,"title":"Compute MD5 hash value by c++ WinAPI","body":"<p>My c++ app needs to compute MD5 hash value, currently it done by OpenSSL and I want to move it to use WinAPI - to avoid dependence in external libraries.<br>\nI wrote this code:</p>\n\n<pre><code>HCRYPTPROV hCryptProv = NULL;\nHCRYPTHASH hHash = NULL;\nHCRYPTHASH hHexHash = NULL;\nHASH HA1;\nHASHHEX HA1HEX;\nDWORD data = HASHLEN;\n\n// Get a handle to a cryptography provider context.\nif(!CryptAcquireContext(&amp;hCryptProv, NULL, NULL, PROV_RSA_FULL, 0))\n{\n    goto err;\n}\n\n// Acquire a hash object handle.\nif(!CryptCreateHash(hCryptProv, CALG_MD5, 0, 0, &amp;hHash))\n{\n    goto err;\n}\n\nCryptHashData(hHash, (const BYTE *)str, strlen(str), 0);\n</code></pre>\n\n<p>now, the strange thing is that somtimes it works well but in other times the CryptAcquireContext return with error NTE_BAD_KEYSET that according MSDN: </p>\n\n<blockquote>\n  <p>The key container could not be opened. A common cause of this error is that the key container does not exist. To create a key container, call CryptAcquireContext using the CRYPT_NEWKEYSET flag. This error code can also indicate that access to an existing key container is denied. Access rights to the container can be granted by the key set creator by using CryptSetProvParam.</p>\n  \n  <p>Blockquote</p>\n</blockquote>\n\n<p>Now my questions are:</p>\n\n<ol>\n<li>if I call to CryptSetProvParam, what exceactly does it do? is it normal that simple application will change the OS settings?</li>\n<li>is there any less difficult way to do compute MD5 in c++ windows?</li>\n</ol>\n\n<p>I'll appriciate if someone will be able to get me a good advice to what to do.<br>\nThanks</p>\n"},{"tags":["c","windows","winapi","client-server","message-queue"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13259499,"title":"WinAPI Message Queue example","body":"<p>Does anyone know where can I find a simple client/server WinAPI message queue example?</p>\n\n<p>I'd like to create a program that sends data from a client to a server using message queues and I can't find anything useful on the web.</p>\n\n<p>Thank you.</p>\n"},{"tags":["winapi","visual-c++","webbrowser","mime-types","bho"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13247476,"title":"Determine MIME type of a file while opening in browser using c++ and browser helper object","body":"<p>when i click a link on browser which opens a file (. PDFs ,.doc,....) how to find the mime type of that file which is getting opened using browser helper object? i am new please help me \nthanks in advance.</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13253285,"title":"How to add a message handler to a wndproc","body":"<p>I have an acrobat plugin which spins up a thread. From that thread I somehow need to get back onto the UI thread. I do have the HWND but if I do a <code>PostMessage</code> how do I get the host application's WNDPROC to sort of call bank into an handler I own. I guess my question is, is there anyway to conceptually do something like  </p>\n\n<pre><code>RegisterWndMsgHandler( HWND, MSG, CALLBACK );\n</code></pre>\n"},{"tags":["winapi","visual-c++","atl","dhtml","bho"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13245703,"title":"Event control on PDFs using Browser Helper Object","body":"<p>i am new to Browser helper object i got the below link <a href=\"http://www.codeproject.com/Articles/37044/Writing-a-BHO-in-Plain-C\" rel=\"nofollow\">http://www.codeproject.com/Articles/37044/Writing-a-BHO-in-Plain-C</a>  which helps me to understand BHO but using this how can i acheive --in internet explorer when i open a PDFs file it has to throw an event and i need to catch it and find what extension it is trying to open and if its is PDFs then raise a popup message. </p>\n"},{"tags":["c++","visual-studio-2010","winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13255313,"title":"CHOOSECOLOR undeclared identifier","body":"<p>I'm creating a win32 project and for some weird reason Visual studio doesn't recognize the CHOOSECOLOR function. I keep getting the \" choosecolor' :undeclared identifier\" error. what do I do??</p>\n\n<p>my current code that causing the error.</p>\n\n<pre><code>void cColor(HWND hwnd, int select)\n{\nCHOOSECOLOR cc; //common dialog box structure\n\n\n\n\n}\n</code></pre>\n\n<p>any help on how i can resolve this problem, would be very much appreciated.</p>\n"},{"tags":["winapi","windows-8"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":49,"score":0,"question_id":13245079,"title":"GetRandomRgn() Api does not work as expected in Windows 8","body":"<p>I am using GetRandomRgn() API to get the visible region of the window.</p>\n\n<p>This API works fine in Windows Xp and Windows 7 but same API is not giving the same</p>\n\n<p>result in Windows 8.</p>\n\n<p>Is there is any other function available in windows 8 to give me the same result?</p>\n\n<p>Please do reply.</p>\n\n<p>Best Regards,</p>\n\n<p>Sharad</p>\n"},{"tags":["c#","winapi","windows-mobile"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1379,"score":2,"question_id":8603564,"title":"Install/Execute a CAb file[Windows Mobile application file] from C# Code?","body":"<p>I am developing a Windows Mobile application for Framework 6. I want to add functionality to upgrade a patch with the application currently running on a device.</p>\n\n<p>While Windows Mobile application works, it should check asynchronously for any new version available in a server database. If the patch exists, the program should download the .cab (Windows Mobile installer) file and install/run it automatically.</p>\n\n<p>Mainly, I have doubts on these:</p>\n\n<ol>\n<li>How to download a cab file to device's particular folder.</li>\n<li>How to install the cab file programmatically. (Programmatically trigger cab file installation without user intervention)</li>\n</ol>\n\n<p>How could it be done?</p>\n\n<p>Please help me on this.....</p>\n"},{"tags":["winapi","core-audio"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13254178,"title":"how to get process id from IAudioSessionManager2","body":"<p>Background: enum all active sessions that are using system audio.</p>\n\n<p>I am trying to get process information from IAudioSessionManager2. But I can't find such function. Does anyone know how to get it?</p>\n\n<p>Sample code:\n<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd368281(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/dd368281(v=vs.85).aspx</a></p>\n\n<p>IAudioSessionControl only provides such methods: GetDisplayName, but the display name I got is just null.</p>\n"},{"tags":["c++","winapi","syntax-error"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13253033,"title":"#define - Expected and Expression C ++","body":"<p>I'm writing an application hat will use the same form defaults on most of the forms, so i decided to macro the WNDClASSEX and call it when needed:</p>\n\n<pre><code>#pragma once\n\n#ifndef WNDCLASSEX_H\n#define WNDCLASSEX_H\n\n#include &lt;windows.h&gt;\n\n//MAIN FORM / LOADER WNDCLASSEX\n#define MainLoaderWnd(Size, WindowsProcess, hInstance, Title)\\\n{\\\n    return new WNDCLASSEX{\\\n    size,\\\n    CS_DBLCLKS,\\\n    WindowsProcess,\\\n    0,\\\n    0,\\\n    hInstance,\\\n    LoadIcon(NULL, IDI_APPLICATION),\\\n    LoadCursor(NULL, IDC_ARROW),\\\n    (HBRUSH)(COLOR_WINDOW),\\\n    NULL,\\\n    L(Title),\\\n    LoadIcon(NULL, IDI_APPLICATION)\\\n};\\\n}\n\n#endif\n</code></pre>\n\n<p>however, when i add this into the file \"loader.cpp\", i get the following:</p>\n\n<pre><code>WNDCLASSEX wcex = MainLoaderWnd(sizeof(WNDCLASSEX), WndProc, hInstance, L\"Your Text Here\");\n//Intellisense error: Expression Expected\n</code></pre>\n\n<p>Ideas/ can't see why his error occurs. :/</p>\n"},{"tags":["windows","winapi","vba"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13251622,"title":"Access an (already opened) OpenFileDialog using VBA","body":"<p>I am doing some web scraping using excel vba.</p>\n\n<p>At one point in my program my internet explorer instance opens an OpenFileDialog. I need to access this dialog and provide it with a filename. Is there a way to do this in vba? </p>\n\n<p>My idea was to get the window handle (I've already done that) and then somehow get the object using the handle, but i cannot find a way to use the handle to access the window.</p>\n"},{"tags":["winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13137363,"title":"Is it possible to link WM_INPUT with WM_KEYDOWN message or just distinguish it (WM_KEYDOWNs) by devices?","body":"<p>I've done some research (with single input device altrough) in this field and discovered that in most situations messages are sent by pair, first WM_INPUT and then WM_KEYDOWN. So it's merely possible to link them together for filtering, i.e. WM_INPUT flags that it's corresponding WM_KEYDOWN shoudn't be sent to reciever (in my case first i discard all WM_KEYDOWN and then decide whenever i need to send them back to their recipients). I just assume that all next WM_KEYDOWN are belong to last WM_INPUT.</p>\n\n<p>My question exactly: can i seriously rely on that principle? Won't those messages mix up if i use multiple input devices? </p>\n\n<p>There are some serious questions about its reliability already:\n1. How do i distinguish repeating input from multiple devices (answer is obvious - i can't). \n2. Would WM_INPUT-WM_KEYDOWN pairs mix up in case of input from multiple devices? i.e. form an cortege like WM_INPUT, WM_INPUT, WM_KEYDOWN, WM_KEYDOWN?</p>\n\n<p>Also maybe it is possible to just discard all WM_KEYDOWN and generate all keyboard events by myself? Altrough it would be technically quite difficult, because there may be multiple WM_KEYDOWNs from one WM_INPUT (key repeatence work that way, multiple WM_KEYDOWN, one WM_KEYUP). </p>\n\n<p>Just in case, here's what i need to achieve: \nI need to filter all messages by time between them. All user input gets filtered by time interval between keypresses. If two messages were sent with interval &lt;50ms i discard first message and second awaits while its TTL exceeds and if so, it sent to its recipient.\nDifficulty is that there can be multiple input devices and those timings will mess up with each other. </p>\n"},{"tags":["c++","winapi","transparency"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1699,"score":2,"question_id":7245169,"title":"Creating a text label with a transparent background using WinAPI","body":"<p>Is it possible to create a label with a transparent background within a window using only WinAPI commands?</p>\n\n<p>I am trying to add an image to a Dialog window that will serve as a background image and then display text upon that image. Everything I have tried so far shows the text label on top of the background image with a grey rectangle drawn around it.</p>\n\n<p>This is an example of my code so far (showing the entire message handler for the dialog):</p>\n\n<pre><code>INT_PTR CALLBACK OfferWindowProc(HWND hDlg, UINT message, WPARAM wParam, LPARAM lParam)\n{       \n    HWND hWndBackground;\n    HWND hWndLabel;\n    HBRUSH hLabelBackColour = NULL;\n      HFONT hfFont;\n      HWND hWndTitleLabel;\n    HDC hdcStatic = NULL;\n\n    UNREFERENCED_PARAMETER(lParam);\n    switch (message)\n    {\n    case WM_INITDIALOG:             \n\n        //Load the background image\n        HANDLE hBitmap;\n        hBitmap = LoadImage(NULL, L\"C:\\\\Users\\\\DavidHall\\\\Documents\\\\bg.bmp\", IMAGE_BITMAP, 0, 0, LR_LOADFROMFILE);\n        if (hBitmap != NULL)\n        {\n            hWndBackground = CreateWindow(L\"STATIC\", L\"image box\", WS_CHILD | WS_VISIBLE | SS_BITMAP, 0, 0, 100, 100, hDlg, (HMENU) 2000, NULL, NULL);          \n            SendMessage(hWndBackground, STM_SETIMAGE, IMAGE_BITMAP, LPARAM(hBitmap));\n        }           \n\n        // Create the label using CreateWindowEx\n        hfFont = CreateFont(20, 0, 0, 0, fontWeight, FALSE, FALSE, FALSE, DEFAULT_CHARSET, OUT_DEFAULT_PRECIS, CLIP_DEFAULT_PRECIS, ANTIALIASED_QUALITY,\n            DEFAULT_PITCH, L\"Verdana\");\n\n        hWndTitleLabel = CreateWindowEx( WS_EX_TRANSPARENT, L\"STATIC\", L\"\", WS_CHILD | WS_VISIBLE | SS_LEFT | WS_SYSMENU , xPos, yPos, width, height, hwnd, (HMENU) id, hInst, NULL);           \n\n        SendMessage(hWndTitleLabel, WM_SETTEXT, NULL, (LPARAM) labelText.c_str());\n\n        SendMessage(hWndTitleLabel, WM_SETFONT, (WPARAM)hfFont, NULL);  \n\n        return (INT_PTR)TRUE;   \n\n    case WM_CLOSE:\n        EndDialog(hDlg, LOWORD(wParam));    \n\n        // Delete the brush - is that correct?\n        DeleteObject(hLabelBackColour);\n        return (INT_PTR)TRUE;\n\n    case WM_COMMAND:\n        if (LOWORD(wParam) == IDCANCEL)\n        {\n            EndDialog(hDlg, LOWORD(wParam));\n            return (INT_PTR)TRUE;\n        }\n        break;\n    default:\n        break;\n    }\n    return (INT_PTR)FALSE;\n}\n</code></pre>\n\n<p>I've tried various combinations of things including:</p>\n\n<ul>\n<li><code>SetLayeredWindowAttributes</code></li>\n<li><code>SetBkMode(hdc, TRANSPARENT)</code></li>\n<li>Handling the <code>WM_CTLCOLORSTATIC</code> message</li>\n</ul>\n"},{"tags":["c++","c","winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":47,"score":0,"question_id":13249606,"title":"How to compare strstr(LPCWSTR, CHAR*);","body":"<pre><code>LPCWSTR location_url;\nm_spWebBrowser-&gt;get_LocationURL((BSTR*)&amp;location_url);\n</code></pre>\n\n<p>How do I compare <code>LPCWSTR</code>  with <code>const char *</code> in <code>strstr</code> ?</p>\n\n<p>Example: </p>\n\n<pre><code>if(strstr((location_url, \".html\"))\n</code></pre>\n"},{"tags":["winapi","visual-c++","embedded-resource"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13248465,"title":"Setting executable icon in Visual C++ 2010 Express","body":"<p>I'm rather unfamiliar with programming tools in Windows but have been forced to use VC++ 2010 Express for a project recently. We have been working on a piece of software that we didn't start and now we are reaching the finish line. Only problem is that I want to be able to set the executable icon.</p>\n\n<p>Since the project is written mostly in SDL we have set the titlebar icon using the SDL_WM_SetIcon call as recommende on several sites but I still can't find any references to how to set the executable icon. All my google searches has turned up results about Visual Studio 2010 and Visual C++ 2008, neither of which seems appicable.</p>\n"},{"tags":["c","windows","winapi","visual-c++","hook"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":54,"score":1,"question_id":13227793,"title":"Detection Of User-Mode Hooks","body":"<p>Is there a way (programmatically) to detect the <strong>List of User-Mode Hooks</strong> ? I have tried reading some articles related but could not get through. Any pointers or ideas or samples would be of great help. As I have not till now started the code, so feel free to help me either in C or C++. TIA.</p>\n\n<p><strong>EDIT::</strong> I am trying with an approach to enumerate all the processes currently running and then again enumerating all the modules each of the process uses. What I really want to try(as explained by some experts) is to compare the enumerated list of all modules currently loaded into memory and the list of modules on the disk of each process to check for hooking. Would somebody please shed light on this? I do not know what my question is but if you got what my confusion is, please help me out here.</p>\n"},{"tags":["winapi","synchronization","critical-section"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4,"score":0,"question_id":13249031,"title":"WakeConditionVariable before or after LeaveCriticalSection","body":"<p>It seems odd to me to see in examples in msdn that WakeConditionVariable is called after exiting the Critical Section, but I have seen examples that shown the opposite.</p>\n\n<p>Is it the same, or is there a right way to do it?</p>\n"},{"tags":["c#","winapi","unmanaged"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":217,"score":4,"question_id":4164599,"title":"What is the best way to capture an application window in C#?","body":"<p>I've developed a simple windows forms application to capture the windows of a video chat application (inbound, aka Remote, and outbound, aka Local).\nI use unmanaged Windows API code for this. Here is the Capture code:</p>\n\n<pre><code>// Set Local Window\nlocalHandle = FindWindow(null, \"local\");\n// Backup parent window for local\nprevLocalHandle = GetParent(localHandle);\nSetParent(localHandle, this.pBoxLocal.Handle);\nSetWindowLong(localHandle, GWL_STYLE, WS_VISIBLE + (WS_MAXIMIZE | WS_BORDER | WS_DISABLED));\nMoveWindow(localHandle, 0, -TOP_BAR_HEIGHT, this.pBoxLocal.Width, this.pBoxLocal.Height + LOWER_BAR_HEIGHT, true);\n\n// Set Remote Window\nremoteHandle = FindWindow(null, \"remote\");\n// Backup parent window for remote\nprevRemoteHandle = GetParent(remoteHandle);\nSetParent(remoteHandle, this.pBoxRemote.Handle);\nSetWindowLong(remoteHandle, GWL_STYLE, WS_VISIBLE + (WS_MAXIMIZE | WS_BORDER | WS_DISABLED));\nMoveWindow(remoteHandle, 0, -TOP_BAR_HEIGHT, this.pBoxRemote.Width, this.pBoxRemote.Height + LOWER_BAR_HEIGHT, true);\n</code></pre>\n\n<p>Here is the Return code:</p>\n\n<pre><code>// Return Windows\nSetParent(localHandle, prevLocalHandle);\nSetWindowLong(localHandle, GWL_STYLE, (WS_OVERLAPPED | WS_CAPTION | WS_SYSMENU | WS_THICKFRAME | WS_MINIMIZEBOX | WS_MAXIMIZEBOX));\nMoveWindow(localHandle, 0, 0, NORMAL_WIDTH, NORMAL_HEIGHT, true);\n\nSetParent(remoteHandle, prevRemoteHandle);\nSetWindowLong(remoteHandle, GWL_STYLE, (WS_OVERLAPPED | WS_CAPTION | WS_SYSMENU | WS_THICKFRAME | WS_MINIMIZEBOX | WS_MAXIMIZEBOX));\nMoveWindow(remoteHandle, 0, 0, NORMAL_WIDTH, NORMAL_HEIGHT, true);\n</code></pre>\n\n<p>The goal is to go from this:\n<img src=\"http://i.stack.imgur.com/8D8HI.png\" alt=\"alt text\"></p>\n\n<p>To this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/yd72N.png\" alt=\"alt text\"></p>\n\n<p>And then back again! :)</p>\n\n<p>There are currently two issues with my way of doing things:</p>\n\n<ul>\n<li><p>first of all, when I return the windows to the video chat application, ocasionally a black rectangle is left on my top-left corner of the screen. It disappears when I refresh the area.</p></li>\n<li><p>second and most important of all, there are times that when I capture the window of the application, I also capture its toolbars (although the measurements I supply are just the ones regarding the video area of the window).</p></li>\n</ul>\n\n<p>Is there a better way of doing this? Even if its just better functions! Remember: I want to obtain the windows of the video chat application and return them afterwards.</p>\n\n<p>Thanks in advance for any tips!</p>\n"},{"tags":["c++","c","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":6,"view_count":116,"score":-5,"question_id":13216671,"title":"How to get size of a loaded icon in c++ winapi","body":"<p>i have loaded an icon <code>(\"c:\\test.ico\")</code> using <code>LoadImage()</code> function\nhow can i get the size of this icon? (number of bytes in it)\ni am using c++ &amp; winapi</p>\n\n<pre><code>HRSRC hRes = LoadImage ( NULL, icon, IMAGE_ICON, 0, 0, LR_LOADFROMFILE );\nLPVOID lpResLock = LockResource(hRes);\n</code></pre>\n\n<p>(more precisely, size of data pointed to by \"lpResLock\")</p>\n\n<p>========update======\ni know about <code>sizeofresource()</code> But the problem is, its to load resource from an executable files. As i shown in my question, i am loading a standalone- local resource from disk file. Second issue is, the <code>hResInfo</code> parameter must have to be created using <code>FindResource</code> function, in my case i am using <code>LoadImage()</code>.. So this cant be of help</p>\n"},{"tags":["winapi","graph","gdi+","edge"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13245057,"title":"How to detect a click on an edge of a multigraph?","body":"<p>I have written a win32 api-based GUI app which uses GDI+ features such as DrawCurve() and DrawLine().</p>\n\n<p>This app draws lines and curves that represent a multigraph.</p>\n\n<p>The data structure for the edge is simply a struct of five int's. (x1, y1, x2, y2, and id)</p>\n\n<p>If there is only one edge between two vertices, a straight line segment is drawn using DrawLine().\nIf there are more than one edges, curves are drawn using DrawCurve() -- Here, I <em>spread</em> straight-line edges about the midpoint of two vertices, making them curves. A point some unit pixels apart from it is calculated using the normal line equation. If more edges are added then a pixel two unit pixels apart from the midpoint is selected, then next time 3 unit pixels, and so on.</p>\n\n<p>Now I have two questions on detecting the click on edges.</p>\n\n<ol>\n<li><p>In finding straight-line edges, to minimize the search time, what should I do?<br>\nIt's quite simple to check if the pixel clicked is on the line segment but comparing all edges would be inefficient if the number of edges large. It seems possible to do it in O(log n), where n is the number of edges.<br>\nEDIT: at this point the edges (class Edge) are stored in std::map that maps edge id (int)'s \nto Edge objects and I'm considering declaring another container that maps pixels to edge id's.<br>\nI'm considering using binary search trees but what can be the key? Or should I use just a 2D pixel array?</p></li>\n<li><p>Can I get the array of points used by DrawCurve()? If this is impossible, then I should re-calculate the cardinal spline, get the array of points, and check if the point clicked by the user matches any point in that array.</p></li>\n</ol>\n"},{"tags":["c++","windows","winapi","dialog","gina"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":40,"score":-1,"question_id":13229132,"title":"How to show Last Logon UserName in a logon dialogbox using C++ win32 API?","body":"<p>i am using  C++ win32 API.</p>\n\n<p>i have a gina logon dialogbox.</p>\n\n<p>it contains a username textbox.</p>\n\n<p>i want to show the last logon username in that textbox,when the system after restarted.</p>\n\n<p>How can i get it?</p>\n"},{"tags":[".net","c","winapi"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":31,"score":2,"question_id":13244584,"title":"Adding a new network interface tab/adapter?","body":"<p>How to add a new network interface adapter/tab via coding?\nlike VPN clients do...</p>\n"},{"tags":["c","winapi","visual-c++","wrapper","wndproc"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":441,"score":2,"question_id":8780700,"title":"How to wrap a win32 WndProc into a C++ class?","body":"<p>Is this even possible? For example, let's say I have the following:</p>\n\n<pre><code>class Window {\nprivate:\n    WNDCLASSEX wc;\npublic:\n    inline WNDCLASSEX getWindowClass() {\n        return wc;\n    }\n    Window();\n    LRESULT CALLBACK WndProc(HWND hwnd, UINT message, LPARAM lParam, WPARAM wParam);\n}\n\nvoid RegisterWindow(Window win) {\n    WNDCLASSEX* wc = win.getWindowClass();\n    RegisterClassEx(wc);\n\n}\n</code></pre>\n\n<p>Now, somewhere there is going to be a section (probably in the constructor of the <code>Window</code> class, where it's necessary to assign the <code>WNDCLASSEX</code> a <code>WndProc</code>, which is noted in the <code>Window</code> class. The only issue is that, because it's a part of a class, there an error will be raised. Thus, how is this achieved? Is it made static? Even so, if the class wraps it it is still part of the class in some way. If I create it outside of the class, that simply obliterates the point.</p>\n"},{"tags":["c++","winapi","organization","hwnd","winmain"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13243343,"title":"WinAPI - how to organize lots of HWND objects?","body":"<p>As I push forward my first winapi UI, I find myself creating large, uncomfortable stacks of HWND variables in my WinMain file:</p>\n\n<pre><code>HWND foo;\nHWND bar;\nHWND baz;\nHWND etc;\n\nint WINAPI WinMain(...) {}\n</code></pre>\n\n<p>Of course, these variables are used in the functions in the rest of the file - the message loop, for example - so they must be accessible.</p>\n\n<p>For my relatively small UI, I'll have something like 30 HWNDs piled up so they're in a visible scope.  This makes me very suspicious that I'm doing it wrong.</p>\n\n<p>Is this what should be happening, or is there a more practical way to organize this?</p>\n"},{"tags":["delphi","winapi","shortcut"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":13228527,"title":"I open a shortcut when shortcut don't exist , why not show this dialog?","body":"<p>I use <code>ShellExecute</code> to open a shortcut </p>\n\n<p>Code :</p>\n\n<pre><code>ShellExecute(Handle, 'open', 'C:\\Users\\hi2012\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\xxx.gif.lnk', nil, nil, SW_SHOWNORMAL)\n</code></pre>\n\n<p>if <strong>xxx.gif</strong> exist that code can open it , if not it don't give anything. </p>\n\n<p>but , when I open it with windows explorer it will show this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/Artq2.png\" alt=\"enter image description here\"></p>\n\n<p>I want when I use code to open a not nonexistent shortcut it also can show that , what can I do ?</p>\n\n<p>is this a wrong way to use <code>ShellExecute</code> to open a shortcut ?</p>\n"},{"tags":["c#","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13241747,"title":"How do I get a window caption?","body":"<p>I would like to get a Window Caption as given by spy++ (highlighted in red)</p>\n\n<p><img src=\"http://i.stack.imgur.com/etevC.png\" alt=\"enter image description here\"></p>\n\n<p>I have code to get the window caption.  It does this by enumerating all windows via a callback which checks the window caption by invoking <code>GetWindowText</code>.  If the window with caption = <code>\"window title | my application\"</code> is Open then I expect the window caption to be included in the enumeration and discovered.  </p>\n\n<p>If the window count is not 1 then the function releases any window handles and returns null.  In the case where null is returned this is considered a failure.  In one test case where I ran this code 100 times I had a fail count of 99. </p>\n\n<pre><code>public delegate bool EnumDelegate(IntPtr hWnd, int lParam);\n\n        [DllImport(\"user32.dll\")]\n        [return: MarshalAs(UnmanagedType.Bool)]\n        static extern bool IsWindowVisible(IntPtr hWnd);\n\n        [DllImport(\"user32.dll\", EntryPoint = \"GetWindowText\", ExactSpelling = false, CharSet = CharSet.Auto, SetLastError = true)]\n        static extern int GetWindowText(IntPtr hWnd, StringBuilder lpWindowText, int nMaxCount);\n\n        [DllImport(\"user32.dll\", EntryPoint = \"EnumDesktopWindows\", ExactSpelling = false, CharSet = CharSet.Auto, SetLastError = true)]\n        static extern bool EnumDesktopWindows(IntPtr hDesktop, EnumDelegate lpEnumCallbackFunction, IntPtr lParam);\n\n        static List&lt;NativeWindow&gt; collection = new List&lt;NativeWindow&gt;();\n\npublic static NativeWindow GetAppNativeMainWindow()\n        {            \n            GetNativeWindowHelper.EnumDelegate filter = delegate(IntPtr hWnd, int lParam)\n            {\n                StringBuilder strbTitle = new StringBuilder(255);\n                int nLength = GetNativeWindowHelper.GetWindowText(hWnd, strbTitle, strbTitle.Capacity + 1);\n                string strTitle = strbTitle.ToString();\n\n                if (!string.IsNullOrEmpty(strTitle))\n                {\n                    if (strTitle.ToLower().StartsWith(\"window title | my application\"))\n                    {\n                        NativeWindow window = new NativeWindow();\n                        window.AssignHandle(hWnd);\n                        collection.Add(window);\n                        return false;//stop enumerating\n                    }\n                }\n                return true;//continue enumerating\n            };\n\n            GetNativeWindowHelper.EnumDesktopWindows(IntPtr.Zero, filter, IntPtr.Zero);\n            if (collection.Count != 1)\n            {\n                //log error\n\n                ReleaseWindow();\n                return null;\n            }                    \n            else\n                return collection[0];\n        }\n\n        public static void ReleaseWindow()\n        {\n            foreach (var item in collection)\n            {\n                item.ReleaseHandle();\n            }\n        }\n</code></pre>\n\n<p>Note that I have streamed all values of <code>\"strTitle\"</code> into a file.  Then performed a text base search for keywords in my caption and was unsuccessful.  Why does the enumeration not find the window I'm looking for in some cases yet it does in other cases?</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13241940,"title":"Get cursor type from HCURSOR","body":"<p>I get a HCURSOR from another process. I would like to find its type.\nIts resource is of these <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms648391%28v=vs.85%29.aspx\" rel=\"nofollow\">LoadCursor</a>.</p>\n\n<p>I looked around in MSDN site did not found any info about how to get resource id of the HCURSOR.\nHow do i do that?</p>\n\n<p>Thank you.</p>\n"},{"tags":["winapi","registry","64bit","32bit","wow64"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":59,"score":4,"question_id":13239049,"title":"What's the correct way to redirect registry access when using NtOpenKey?","body":"<p>The code I'm working on has both 32-bit and 64-bit components and they need to share information in the registry. Because of this, I'm trying to control registry redirection when using the <code>NtOpenKey</code> function (the user-mode equivalent of <a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff567014%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>ZwOpenKey</code></a>) - I need to call this function from 64-bit code but access the 32-bit registry. (The code used to be 32-bit only and now it's getting upgraded to 64-bit so I'd prefer using as much of the existing code as possible - this is to say I'd prefer not to rewrite everything to use <code>RegOpenKeyEx</code>.)</p>\n\n<p>Naturally, <code>NtOpenKey</code> doesn't recognize the <code>KEY_WOW64_32KEY</code> access flag, unlike high-level registry functions so there's no way to specify redirection.</p>\n\n<p>At this point the only solution I can think of is to explicitly hardcode <code>Wow6432Node</code> in the key names when accessing the registry; something like:</p>\n\n<p><code>\\Registry\\Machine\\Software\\Wow6432Node\\MyCompanyKey\\MyKey</code></p>\n\n<p>Unfortunately, this is more of a hack and it's specifically discouraged by Microsoft.</p>\n\n<p>Is there a correct solution to this problem? Reading through the documentation didn't help and I couldn't find any relevant search results either. </p>\n\n<p><strong>Edit</strong>: just a bit of extra detail: I need to support Windows Server 2003 32-bit/64-bit, Windows 7/8 and Windows Server 2008 32-bit/64-bit. (Basically all server flavors starting with Windows Server 2003 + Windows 7 and over.)</p>\n"},{"tags":["c++","winapi","mouse","move"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":526,"score":0,"question_id":11276233,"title":"How to move mouse with c++","body":"<p>I want to move the mouse cursor with a c++ script. I am using Visual C++ 2010 Express in a Windows 7 inside Parallels and I created a console application.</p>\n\n<p>I know SetCursorPos method but it is just not working (it does nothing).</p>\n\n<p>I managed to simulate clicks with SendInput but it does not actually move the mouse.</p>\n\n<p>This is my code:</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;Tlhelp32.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string&gt;\n#include &lt;iostream&gt;\n#include &lt;fstream&gt;\n#include &lt;sstream&gt;\n#include &lt;time.h&gt;\n\nvoid mouseLeftClick(const int x, const int y);\n\n// window\nHWND hWindow;\n\nint main()\n{\n    // find window\n    hWindow = FindWindow(NULL, \"Calculadora\");\n\n    if (NULL == hWindow) {\n        OutputDebugStringA(\"Couldn't find application.\");\n    }else{\n\n        if (!SetForegroundWindow(hWindow)) {\n            OutputDebugStringA(\"Couldn't set application to foreground.\");\n        }else{\n            // click on 1\n            mouseLeftClick(20 265));\n            Sleep(500);\n            // click on 2\n            mouseLeftClick(60, 265);\n            Sleep(500);\n        }\n    }\n    return 0;\n}\n\nvoid mouseLeftClick(const int x, const int y)\n{ \n    // get the window position\n    RECT rect;\n    GetWindowRect(hWindow, &amp;rect);\n\n    // calculate scale factor\n    const double XSCALEFACTOR = 65535 / (GetSystemMetrics(SM_CXSCREEN) - 1);\n    const double YSCALEFACTOR = 65535 / (GetSystemMetrics(SM_CYSCREEN) - 1);\n\n    // get current position\n    POINT cursorPos;\n    GetCursorPos(&amp;cursorPos);\n    double cx = cursorPos.x * XSCALEFACTOR;\n    double cy = cursorPos.y * YSCALEFACTOR;\n\n    // calculate target position relative to application\n    double nx = (x + rect.left) * XSCALEFACTOR;\n    double ny = (y + rect.top) * YSCALEFACTOR;\n\n    INPUT Input={0};\n    Input.type = INPUT_MOUSE;\n\n    Input.mi.dx = (LONG)nx;\n    Input.mi.dy = (LONG)ny;\n\n    // set move cursor directly and left click\n    Input.mi.dwFlags = MOUSEEVENTF_MOVE | MOUSEEVENTF_ABSOLUTE | MOUSEEVENTF_LEFTDOWN | MOUSEEVENTF_LEFTUP;\n\n    SendInput(1,&amp;Input,sizeof(INPUT));\n}\n</code></pre>\n"},{"tags":["windows","winapi","windows-8","microsoft-metro","c++-cx"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13064575,"title":"Can I use weak references as instance variables in Windows RT/8?","body":"<p>I'm implementing a tree in one of my projects. Each node contains a vector with zero or more child nodes in it. Each node also contains a reference to its parent (the root's parent reference being nullptr). Here's an example of the class definition:</p>\n\n<pre><code>ref class TreeNode {\n    ...\n\n    TreeNode^ _parentNode;\n    Platform::Collections::Vector&lt;TreeNode^&gt;^ _childNodes;\n}\n</code></pre>\n\n<p>First, will this cause a memory leak? I'm assuming these are strong references in both directions and thus the ref counts on the objects will remain above zero.</p>\n\n<p>I've seen examples of Platform::WeakReference, but never as instance variables. Is this possible? What would the syntax look like?</p>\n"},{"tags":["winapi","cryptography","cryptoapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13240220,"title":"Adding a CA certificate for client certificates","body":"<p>I'm writing a server application that uses CryptoAPI and Schannel for setting up a secure SSL connection to clients. The server requires the clients to submit a certificate for verification (by setting the <code>ASC_REQ_MUTUAL_AUTH</code> flag in <code>AcceptSecurityContext</code>).</p>\n\n<p>The problem I have is that some clients (namely clients using <code>javax.net.ssl</code>) does not pass along their client certificate (even though it's been configured to do so). I suspect this is because the CA certificate used for signing the client certificates are not in the list of CA's passed to the client during the handshake.</p>\n\n<p>I've tried to do variations of the following to add the CA certificate to this list:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>PCERT_CONTEXT caCertContext = ...; /* Imported from a DER formatted file */\n\nHCERTSTORE systemStore = CertOpenStore(\n                CERT_STORE_PROV_SYSTEM,\n                0,\n                0,\n                CERT_STORE_OPEN_EXISTING_FLAG |\n                    CERT_SYSTEM_STORE_LOCAL_MACHINE,\n                L\"ROOT\");\n\nbool ok = CertAddCertificateContextToStore(\n                systemStore,\n                caCertContext,\n                CERT_STORE_ADD_USE_EXISTING,\n                NULL);\n\nif (!ok)\n{\n    std::cerr &lt;&lt; \"Could not add certificate to system store!\" &lt;&lt; std::endl;\n}\n</code></pre>\n\n<p>In the above example <code>CertAddCertificateContextToStore</code>always fails. If I change <code>CERT_SYSTEM_STORE_LOCAL_MACHINE</code>to <code>CERT_SYSTEM_STORE_CURRENT_USER</code> I am presented with a popup asking me to confirm the certificate, but even if I accept the CA certificate will not appear in the list sent to the client.</p>\n\n<p>I also tried extending the system store collection with a temporary memory store (something I picked up from <a href=\"http://stackoverflow.com/questions/1557710/winhttp-how-to-use-a-temporary-certificate-store\">here</a>) but to no avail.</p>\n\n<p>Anyone know of a way to solve this? Ideally programmatically without using any GUI or external tool?</p>\n"},{"tags":["c++","winapi","createprocess"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":53,"score":3,"question_id":13238536,"title":"Client/Server applications communication over the command line with threads c++","body":"<p>I have two applications one is a client the other is a server. The server launches the client as a sub thread. The client then outputs its commands via its standard out. The server waits for a command and responses accordingly. </p>\n\n<p>Basically client server via the standard out. </p>\n\n<p>For example:</p>\n\n<pre><code>client &gt;&gt; Move north\nServer &gt;&gt; Your new location is {2,3} \nclient &gt;&gt; Move north\nServer &gt;&gt; Your new location is {2,2} \nclient &gt;&gt; Shoot east \nServer &gt;&gt; Projectile 66638 heading east {3,2}\n</code></pre>\n\n<p>The problem is that i don't know how to connect the two applications together so the server and read and response to the client application. </p>\n\n<p>The reason that I would like to use the command line as the communication layer is that I want to keep the creation of the client as easy as possible. </p>\n\n<p>Also there may be more then one client at a time, The clients should be able to communicate with the server interdependently of each other. (they should not be able to see each others communications) </p>\n\n<p>Currently I am launching the application via the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms682425%28v=vs.85%29.aspx\" rel=\"nofollow\">CreateProccess</a>() function. This function makes it easy to set up the initial command line parameters of the application. just not the communication afterwards. </p>\n\n<p>My Question is: </p>\n\n<ul>\n<li>How does a server application that launches a client application as a thread, read/writes the clients standard output? </li>\n</ul>\n"},{"tags":["c++","visual-studio","gui","winapi","visual-editor"],"answer_count":12,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":20786,"score":4,"question_id":488837,"title":"How do I create a GUI for a windows application using C++?","body":"<p>I am deciding on how to develop a GUI for a small c++/win32 api project (working Visual Studio C++ 2008). The project will only need a few components to start off the main process so it will be very light weight (just 1 button and a text box pretty much...). My question is this:</p>\n\n<p>I don't have experience developing GUIs on windows but I can learn easily. So, what should I use? A Visual editor (drag and drop code generationg: my preference for desktop GUI designing by far (java/swing)). Or should I use a speicific library? Either way, WHICH library or visual editor should I use? I heard someone mention writing the GUI in C#, then calling the C++ code... the thing is, that this is such a simple GUI I would find it easier to just keep it all in C++, but I'm open to whatever the best suggestion is.</p>\n"},{"tags":["c++","c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13238632,"title":"WinAPI menu freezes after some clicks","body":"<p>I have an application in win32 that has a top menu in its main window, this menu has 2 options with submenus in each. </p>\n\n<p>The problem is..after some clicks on its options it suddenly freezes. The rest of the application keeps responding normally, but when i click on the menu options, the buttons go down like pressed and the submenus just doesnt appear, and i need to restart the application or it wont work anymore.</p>\n\n<p>I thik it is something related to memory allocation, maybe i need to free some allocation, but since im new to this kind of programming, i can say just looking at it.</p>\n\n<p>Some code..i think its in the window procedure where i manipulate the WM_COMMAND that theres something wrong:</p>\n\n<pre><code>LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n\nint wmId, wmEvent;\nPAINTSTRUCT ps;\nHDC hdc;\n\nHMENU hMenubar = CreateMenu();\nHMENU hFile = CreateMenu();\nHMENU hEDIT = CreateMenu();\nHMENU hHelp = CreateMenu();     \n\n\n\nswitch (message)\n{\n\n\ncase WM_COMMAND:\n    wmId    = LOWORD(wParam);\n    wmEvent = HIWORD(wParam);\n\n    // Parse the menu selections:\n\n    switch (wmId)\n    {\n    case ID_FILE_DIALOG2:\n        DialogBox(hInst, MAKEINTRESOURCE(IDD_DIALOG2), hWnd, Add);\n        break;\n\n    case ID_FILE_TESTE:\n\n    Check();\n\n    break;\n\n    case ID_FILE_DIALOG1:\n        DialogBox(hInst, MAKEINTRESOURCE(IDD_DIALOG1), hWnd, Conf);\n        break;\n\n    case ID_OPEN:\n        Open();\n        break;\n\n    case IDM_ABOUT:\n        DialogBox(hInst, MAKEINTRESOURCE(IDD_ABOUTBOX), hWnd, About);\n        break;\n\n    case IDM_EXIT:\n        DestroyWindow(hWnd);\n        PostQuitMessage(0);\n        break;\n\n    default:\n        return DefWindowProc(hWnd, message, wParam, lParam);\n\n    }\n    break;\n\ncase WM_PAINT:\n\n    break;\n\ncase WM_CLOSE:\n    DestroyWindow(hWnd);\n        PostQuitMessage(0);\nbreak;\n\ncase WM_DESTROY:\n\nbreak;\n\ndefault: \n    return DefWindowProc(hWnd, message, wParam, lParam);\n\n}\nreturn 0;\n}\n</code></pre>\n"}]}
{"total":13828,"page":2,"pagesize":100,"questions":[{"tags":["winapi","mfc","screen-capture"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13238153,"title":"MFC Screenshot Every Second","body":"<p>I'm working on an MFC application where I take a screenshot every <em>n</em> milliseconds using a CDialogEx timer.  The problem is I can't seem to get a screen capture at all.  Here is my capture code (modified version of <a href=\"http://www.codeproject.com/Articles/101272/Creation-of-Multi-monitor-Screenshots-Using-WinAPI\" rel=\"nofollow\">http://www.codeproject.com/Articles/101272/Creation-of-Multi-monitor-Screenshots-Using-WinAPI</a> and using <a href=\"http://www.codeproject.com/Articles/3690/MFC-classes-for-multiple-monitors\" rel=\"nofollow\">http://www.codeproject.com/Articles/3690/MFC-classes-for-multiple-monitors</a> for CMonitor):</p>\n\n<pre><code>void CWinTesterAlphaDlg::CaptureDesktop( CMonitor&amp; monitor, CBitmap&amp; bitmap, CRect *rect )\n{\n    CDC capture;\n    //HGDIOBJ original;\n    HDC monitorDC = monitor.CreateDCA( );\n    unsigned int width = GetDeviceCaps( monitorDC, HORZRES );\n    unsigned int height = GetDeviceCaps( monitorDC, VERTRES );\n    monitor.GetMonitorRect(rect);\n\n    HDC captureDC = CreateCompatibleDC( monitorDC );\n    if ( !captureDC ) throw new std::exception(\"Couldn't create a capture device context\");\n    if ( capture.GetSafeHdc() != captureDC )  {\n        capture.DeleteDC();\n        capture.Attach(captureDC);\n    }\n\n    CDC monitorCDC;\n    monitorCDC.Attach(monitorDC);\n    if ( bitmap.CreateCompatibleBitmap( &amp;monitorCDC, width, height ) == FALSE ) throw new std::exception(\"Couldn't create capture bitmap\");\n\n    capture.SelectObject(&amp;bitmap);\n    //original = SelectObject( capture.GetSafeHdc(), bitmap.GetSafeHandle() );\n    //if ( !original || original == (HBITMAP)GDI_ERROR ) throw new std::exception(\"Couldn't capture using SelectObject\");\n\n    if ( !BitBlt( captureDC, 0, 0, width, height, monitorDC, rect-&gt;left, rect-&gt;top, SRCCOPY|CAPTUREBLT ) ) throw new std::exception(\"Could not blit desktop image onto bitmap\");\n\n    monitorCDC.DeleteDC();\n    capture.DeleteDC();\n}\n</code></pre>\n\n<p>I run this function in try/catch blocks, and I don't get any exceptions thrown, but there still may be an issue here.</p>\n\n<p>Here is my timer function in my mfc application:</p>\n\n<pre><code>void CWinTesterAlphaDlg::OnTimer(UINT nIDEvent)\n{\n    CRect rect;\n    CBitmap bmp;\n\n    try {\n        this-&gt;CaptureDesktop( this-&gt;monitor, bmp, &amp;rect );\n    } catch(std::exception&amp; exc1) {\n        std::string msg;\n        msg = \"Couldn't get desktop capture;\";\n        msg += exc1.what();\n        this-&gt;MessageBoxA(msg.c_str(), \"Oh no!\");\n        return;\n    }\n\n    CDC pixels;\n    if ( pixels.SelectObject(bmp.GetSafeHandle()) ) {\n        unsigned char *screen = new unsigned char[ rect.Width() * rect.Height() * 3 ];\n        int p = 0;\n        try {\n            for(int x=0; x &lt; rect.Width(); x++) {\n                for(int y=0; y &lt; rect.Height(); y++) {\n                    COLORREF c = pixels.GetPixel(x, y);\n                    screen[p+0] = (unsigned char)GetRValue(c);\n                    screen[p+1] = (unsigned char)GetGValue(c);\n                    screen[p+2] = (unsigned char)GetBValue(c);\n                    p += 3;\n                }\n            }\n            this-&gt;captureEnc-&gt;encodeFrame( screen, true );\n        } catch( std::exception&amp; exc) {\n            // Do nothing...\n            this-&gt;MessageBoxA( exc.what(), \"Desktop Capture Issue\", MB_ICONERROR );\n        }\n        pixels.DeleteDC();\n        bmp.DeleteObject();\n    } else {\n        this-&gt;endRecording();\n        this-&gt;MessageBoxA( \"Couldn't get pixel data from desktop screen capture\", \"Desktop Capture Issue\", MB_ICONERROR );\n    }\n\n    CDialogEx::OnTimer(nIDEvent);\n}\n</code></pre>\n\n<p>My <code>if ( pixels.SelectObject(bmp.GetSafeHandle()) ) {</code> line always returns false, but I can't seem to figure out why.</p>\n\n<p>Can anyone point out why my code doesn't work?</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":1,"view_count":154,"score":3,"question_id":13144803,"title":"What is a signing catalog file member tag?","body":"<p>I'm filling out the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa388203.aspx\" rel=\"nofollow\">WINTRUST_CATALOG_INFO</a> structure. I've calculated the hash for a file and found the catalog file to use.</p>\n\n<p>There's one member I don't know how to fill out though:</p>\n\n<pre><code>pcwszMemberTag\n    Tag of a member file to be verified.\n</code></pre>\n\n<p>Most of the example code for this I've seen around on the internet seems to turn the file hash into a hex-encoded version of itself, and pass that as the member tag. I'm not sure why that would be though.</p>\n"},{"tags":["java","windows","winapi","jna"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13236746,"title":"Silently catch windows error popups when calling System.load() in java","body":"<p>I have a Java Swing application, which needs to load some native libraries in windows.</p>\n\n<p>The problem is that the client could have different versions of those libraries. In one recent version, either the names changed or the order on which the libraries must be loaded changed.</p>\n\n<p>To keep up, we iterated over all possible library names but some fail to load (due to it's nonexistence or because another must be loaded previously). This idea works on older Windows but on latter ones it shows a error popup.</p>\n\n<p>I saw on <a href=\"http://stackoverflow.com/questions/4058303/silently-catch-windows-error-popups-when-calling-loadlibrary\">question 4058303</a> (Silently catch windows error popups when calling LoadLibrary) that I need to call <code>SetErrorMode</code> but I am not sure how to call <code>SetErrorMode</code> from <code>jna</code>. I tried to follow the idea from <a href=\"http://stackoverflow.com/questions/11038595/java-call-for-windows-api-getshortpathname\">question 11038595</a> but I am not sure how to proceed.</p>\n\n<pre><code>public interface CKernel32 extends Kernel32 {\n\n    CKernel32 INSTANCE = (CKernel32) Native.loadLibrary(\"kernel32\", CKernel32.class);\n\n    // TODO: HELP: HOW define the SetErrorMode function\n}\n</code></pre>\n\n<p>How do I define (from <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms680621%28v=vs.85%29.aspx\" rel=\"nofollow\">the SetErrorMode documentation</a>):</p>\n\n<pre><code>UINT WINAPI SetErrorMode(\n  _In_  UINT uMode\n);\n</code></pre>\n\n<p>in the line marked as <code>TODO: HELP:</code>?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["winapi","service"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13214502,"title":"Why isn't SvcShutdown() being called by my service?","body":"<p>I cannot figure out why <code>SvcShutdown()</code> is not being called in my win32 service <strong>when Windows shuts down</strong>. Everything else works perfectly (stopping, pause/continue etc). After scouring the 'Net for hours, I find nothing.</p>\n\n<p>Any help would be very, VERY appreciated!!</p>\n\n<p>Thanks in advance,</p>\n\n<p>James</p>\n\n<pre><code>import win32serviceutil\nimport servicemanager\nimport win32service\nimport win32event\nimport win32api\n\nimport datetime\n\nLOGINFO = 0\nLOGWARNING = 1\nLOGERROR = 2\n\nclass MyService(win32serviceutil.ServiceFramework):\n_svc_name_ = 'MyService'\n_svc_display_name_ = 'MyService service'\n\ndef __init__(self, *args):\n    win32serviceutil.ServiceFramework.__init__(self, *args)\n    # Create events for service stop, pause &amp; continue\n    # CreateEvent(securityAttrs, bManualReset, bInitialState, name)\n    self.evStop = win32event.CreateEvent(None, 0, 0, None)\n    self.evPause = win32event.CreateEvent(None, 0, 0, None)\n    self.evContinue = win32event.CreateEvent(None, 0, 0, None)\n\n    # Create event list for WaitForMultipleObjects()\n    self.evhandles = self.evStop, self.evPause, self.evContinue\n    # sigStatus must be this range for a valid SCM event\n    self.validSignals = range(win32event.WAIT_OBJECT_0, \n                              win32event.MAXIMUM_WAIT_OBJECTS)\n\n    # Signal ID returned from WFMO() else None\n    self.sigStatus = None\n    # Service run state. False means pausing/paused or stopping\n    self.runState = True\n\ndef logEvent(self, msg, logtype=LOGINFO, logcategory=None):\n    import servicemanager\n\n    if logtype == LOGINFO:\n        servicemanager.LogInfoMsg(str(msg))\n    elif logtype == LOGWARNING:\n        servicemanager.LogWarningMsg(str(msg))\n    elif logtype == LOGERROR:\n        servicemanager.LogErrorMsg(str(msg))\n\ndef sleep(self, sec):\n    '''A delay method sympathetic to SCM notifications.'''\n\n    while sec &gt; 0:\n        # SCM event has taken place?\n        if self.notificationFromSCM():\n            break\n        win32api.Sleep(1000)\n        sec = sec -1\n\ndef notificationFromSCM(self):\n    '''Returns True if SCM notification(s) have taken place.\n\n    sigStatus has the value.\n    Note: that calls to WaitForMultipleObjects() only returns the event\n    status ONCE, after which it's reset (ie. calling it may return\n    WAIT_OBJECT_0 and an immediate subsequent call will yield WAIT_TIMEOUT\n    or similar.'''\n\n    if self.sigStatus is not None:\n        # Still have a live SCM event to process, so exit\n        return True\n\n    # WaitForMultipleObjects(handles, bWaitAll, dwMilliseconds)\n    self.sigStatus = win32event.WaitForMultipleObjects(self.evhandles, 0, 0)\n    if self.sigStatus in self.validSignals:\n        return True\n    else:\n        # Timeout signal or similar, so MUST reset sigStatus\n        self.sigStatus = None\n        return False\n\ndef SvcDoRun(self):\n    self.ReportServiceStatus(win32service.SERVICE_START_PENDING)\n    self.logEvent('Starting {0} Service...'.format(self._svc_display_name_))\n    self.ReportServiceStatus(win32service.SERVICE_RUNNING)\n    self.logEvent('{0} Service started.'.format(self._svc_display_name_))\n\n    while True:         \n        if self.runState:\n            try:\n                # Insert service work activity here...\n                self.logEvent('Working: {0}'.format(datetime.datetime.now()))\n                self.sleep(10)\n            except Exception as x:\n                self.logEvent('Exception : {0}'.format(x), LOGERROR)\n        else:\n            self.sleep(30)\n\n        # SCM notification?\n        if self.notificationFromSCM():\n            if self.sigStatus == self.evhandles.index(self.evStop):\n                # STOP event\n                self.logEvent('Stopping {0} Service...'.format(self._svc_display_name_))\n                break\n            elif self.sigStatus == self.evhandles.index(self.evPause):\n                # PAUSE event\n                self.logEvent('Pausing {0} Service...'.format(self._svc_display_name_))\n                self.runState = False\n                # Other cleanup code here...\n                self.logEvent('{0} Service paused.'.format(self._svc_display_name_))\n                self.ReportServiceStatus(win32service.SERVICE_PAUSED)\n            elif self.sigStatus == self.evhandles.index(self.evContinue):\n                # CONTINUE event\n                self.logEvent('Resuming {0} service...'.format(self._svc_display_name_))\n                self.runState = True\n                # Reset pause &amp; continue to non-signaled state\n                win32event.ResetEvent(self.evPause)\n                win32event.ResetEvent(self.evContinue)\n                # Other cleanup code here...\n                self.logEvent('{0} Service started.'.format(self._svc_display_name_))\n                self.ReportServiceStatus(win32service.SERVICE_RUNNING)\n\n            # Clear signal flag\n            self.sigStatus = None\n\n    # If we get here, then service has been stopped/shutdown\n    self.logEvent('{0} Service stopped.'.format(self._svc_display_name_))\n    self.ReportServiceStatus(win32service.SERVICE_STOPPED)\n\ndef SvcStop(self):\n    self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)\n    # Signal STOP event\n    win32event.SetEvent(self.evStop)\n\ndef SvcPause(self):\n    self.ReportServiceStatus(win32service.SERVICE_PAUSE_PENDING)\n    # Signal PAUSE event\n    win32event.SetEvent(self.evPause)\n\ndef SvcContinue(self):\n    self.ReportServiceStatus(win32service.SERVICE_CONTINUE_PENDING)\n    # Signal CONTINUE event\n    win32event.SetEvent(self.evContinue)\n\ndef SvcShutdown(self):\n    self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)\n    self.logEvent('**SvcShutdown event**')\n    # Shutdown code here...\n    win32event.SetEvent(self.evStop)\n</code></pre>\n"},{"tags":["c++","winapi","mfc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13232169,"title":"In a MFC GUI Application, I want to display the information of on-going process in a console window. Help me out on this","body":"<p>The simplified form of the work is given in a button click handler. Sample output not displayed in the window. Help me on this..</p>\n\n<pre><code>    void CConsoleWriteExDlg::OnBnClickedButtonConsole()\n    {\n        if (::AllocConsole())\n        {\n            HANDLE hOutConsole = ::GetStdHandle(STD_OUTPUT_HANDLE);\n            DWORD bytes_written;\n            ::WriteConsole(hOutConsole, \"Sample Output\", sizeof(TCHAR) * strlen(\"Sample Output\"), &amp;bytes_written, NULL);\n            ::FreeConsole();\n        }\n    }\n</code></pre>\n"},{"tags":["winapi","windowless"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13233084,"title":"win32 windowless application using timer using message loop and without using cpu consuming while loops","body":"<p>How to write a program with no window, with no window class, with no cpu consuming while loops, no console yet using the message loop which will consume less cpu? </p>\n\n<p>I am explaining my requirements below.</p>\n\n<p>I am writing a win32 api program which uses timer and which does not need a window.</p>\n\n<ol>\n<li><p>According to the manuals the default message loop runs only if there is window associated with it.</p></li>\n<li><p>I gone through other stackoverflow content which clearly states to prevent while loop and sleep functions which will cause too much load to the cpu.</p></li>\n<li><p>I want to run this program like a background program without a window.</p></li>\n<li><p>I am using a callback function as the last parameter for the setTimer function so i dont have to have a window procedure.</p></li>\n<li><p>i heard about event/objects to use in the default message loop which will keep the program running yet will not overload the cpu. is this the only way? yet i dont know how to use this option.</p></li>\n</ol>\n\n<p>What are all the possible ways to write this kind of app without costing the CPU and other resources?</p>\n\n<p>Your suggestions and references would really help.</p>\n\n<p>Here is the code i have now which will exit because no windows is associated as said by other discussions.</p>\n\n<pre><code>#include &lt;windows.h&gt;\n\nvoid getidle();\n\nint WINAPI WinMain (HINSTANCE hThisInstance, HINSTANCE hPrevInstance, LPSTR lpszArgument, int nFunsterStil)\n{\n\n    SetTimer(NULL, 1, 5000, (TIMERPROC) getidle);\n    MSG msg;\n\n\n    while (GetMessage (&amp;msg, NULL, 0, 0))\n    {\n        TranslateMessage(&amp;msg);\n        DispatchMessage(&amp;msg);\n    }\n\n    return 0;\n}\n\nvoid getidle()\n{\n  //some code here\n}\n</code></pre>\n\n<p>So i need to use a different kind of message loop and i am not sure of how to use it. something like MsgWaitForMultipleObjects or WaitForSingleObject . ? .</p>\n\n<p><em>Besides, by doing the above mentioned way like msgwait... waitforsigle... or event objects if and only if these could consume more resources that just hiding the window then please specify that also cause i will go with that simple way...</em></p>\n\n<p><strong>It is working</strong></p>\n\n<p>I really wonder how it works cause i read people saying it will not run.\nI was searching the net for more information and it had been working...\nI don't know.</p>\n\n<p>Is it ok? is it a proper way? confused.</p>\n"},{"tags":["c#","winapi","gdi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13229206,"title":"DrawString with origin left/baseline","body":"<p>When I use <code>Graphics.DrawString(... myPoint)</code>  the left/ top of the first letter of the string is at myPoint.</p>\n\n<p>Can I combine DrawString with win32 SetTextAlign to set text origin  <code>TA_LEFT|TA_BASELINE</code> or is there some .NET equivalent?</p>\n\n<p>If I draw a Rectangle at (100,100) and a string at (100, 100) I want the string to be above the rectangle (not inside at the top/left corner)</p>\n"},{"tags":["windows","delphi","winapi"],"answer_count":1,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":294,"score":5,"question_id":9224693,"title":"How can I display the \"open with\" dialog for an unregistered file extension?","body":"<p>I want to let the user select an association (open with) for an currently unregistered file extension.</p>\n\n<p>Currently I'm telling the API to open the file by using <code>ShellExecute</code> and it returns an <code>ERROR_NO_ASSOCIATION</code> error code.</p>\n\n<p>Is there a way to tell the API that it should let the user select a new association?</p>\n"},{"tags":["delphi","winapi"],"answer_count":1,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":141,"score":4,"question_id":13226510,"title":"How popup \"Connect To\" dialog?","body":"<p><img src=\"http://i.stack.imgur.com/68BiW.png\" alt=\"enter image description here\"></p>\n\n<p>how to popup this form use delphi ?\nis <code>ShellExecuteEx</code> or <code>ShellExecute</code>  can do this?</p>\n"},{"tags":["c++","winapi","active-directory","adsi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13194624,"title":"How to check ADuser \"Password never expires\" properties check or not using C++ Win32API?","body":"<p>i am using C++ Win32 API...</p>\n\n<p>i want to know the user password policies properties value...</p>\n\n<p>that is \"Password never expires\" ,how to check this property is checked or not using C++ Win32 API?</p>\n"},{"tags":["c","json","winapi","api"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":515,"score":1,"question_id":5449197,"title":"Does win32 have a \"native\" JSON API that can be called from C?","body":"<p>Is there a native C implementation of JSON in the Windows API?</p>\n\n<p>If not, is there such a JSON API for .NET or C# that can still be used from plain old C code?</p>\n\n<p>Failing that, is there any JSON library or implementation that is \"most popular\" among developers on the Windows platform using C-like languages?</p>\n"},{"tags":["winapi","treeview","directory"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13188825,"title":"Win32API treeview show directory","body":"<p>Is there a fast way to \"dump\" a directory tree into a treeview using classic Win32 API, or do I have to insert each item explicitly?</p>\n"},{"tags":["winapi","c++-cli","ms-media-foundation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12948015,"title":"How to prevent MF_E_CANNOT_CREATE_SINK?","body":"<p>I have a C++/CLI module doing some Media Foundation work. When I create a topology for a windows media file but with no audio device I get this MF_E_CANNOT_CREATE_SINK event. The problem is this event occurs asynchronously after the topology has \"successfully\" been added to the IMFMediaSession.</p>\n\n<p>I'd like to detect the lack of an audio device/driver if possible and disable the audio stream so I can still play the video stream.</p>\n\n<p>At the moment I do not receive topology events when this MF_E_CANNOT_CREATE_SINK event occurs so cannot start playback.</p>\n"},{"tags":["c++","winapi","dialog","window"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13226107,"title":"How to show domain value is default in combobox using C++ Win32 API?","body":"<p>i am using C++ Win32 API.</p>\n\n<p>i have a logondialogbox.its have a username textbox,password textbox,domainname combobox.</p>\n\n<p>when i start the system,how can i show the domainname in combobox default?</p>\n\n<p>in example:</p>\n\n<p>raja is systemname\ntechserve is domainname</p>\n\n<p>i already tried </p>\n\n<p><code>ComboBox_SetCurSel(GetDlgItem(_hwnd, IDC_COMBO), 1);</code></p>\n\n<p>But in other users like,</p>\n\n<p>udhay is systemname\ntechserve is domainname</p>\n\n<p>it shows systemname,that is udhay.</p>\n\n<p>So,How can show techserve(domainname) is default value for Combobox?</p>\n"},{"tags":["c++","windows","winapi","active-directory","adsi"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13225883,"title":"ADSI functions sometimes Not Working?","body":"<p>i am using c++ WIN32 API,i have ADSI functions</p>\n\n<pre><code>    CoInitialize(NULL); \n    LPWSTR pszADsPath=NULL;\n    pszADsPath= L\"LDAP://CN=hari,CN=Users,DC=jegan,DC=com\";\n    hr = ADsGetObject(pszADsPath, IID_IADsUser, (void**)&amp;pUser);\n</code></pre>\n\n<p>Sometimes it works fine,but most of the times hr gives <strong><code>8007054b</code></strong>.</p>\n\n<p>how to resolve it?</p>\n"},{"tags":["c++","windows","winapi","exception-handling"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13224844,"title":"Inside exception handler, MessageBox() successfully returns IDOK but never shows","body":"<p>I'm using a self written exception class called windows_error that inherits from std::runtime_error, which I use to, well, properly handle unexpected errors from Windows API functions.</p>\n\n<p>All the way on the bottom of the callstack, at the end of my WinMain function, I catch all windows_error exceptions that haven't been dealt with yet. I intend to handle them by display an error message right before the program terminates, like so:</p>\n\n<pre><code>int WINAPI wWinMain(HINSTANCE inst, HINSTANCE prev, wchar_t *cmdline, int winshow)\n{\n    // Initialize result to EXIT_FAILURE in case the program terminates due to\n    // an exception.\n    int result = EXIT_FAILURE;\n\n    try {\n        result = sIRC()();\n    }\n    catch (windows_error &amp;e) {\n        e.basicHandler();\n    }\n\n    return result;\n}\n</code></pre>\n\n<p>The basicHandler member function looks like this:</p>\n\n<pre><code>void windows_error::basicHandler() const\n{\n    std::wostringstream ss;\n\n    ss &lt;&lt; L\"An unexpected error has occurred in a Windows function.\\n\\n\" \\\n          L\"Function \" &lt;&lt; m_api &lt;&lt; L\" was called by \" &lt;&lt; m_caller &lt;&lt; L\" in \" &lt;&lt; m_srcFile &lt;&lt; L\" at line \" &lt;&lt; m_srcLine &lt;&lt; L\". \" \\\n          L\"It returned error \" &lt;&lt; m_error &lt;&lt; L\":\\n\\n\" &lt;&lt; m_errorMessage;\n\n#ifdef _CONSOLE\n    std::wcout &lt;&lt; L\"\\n\" &lt;&lt; ss.str();\n#else\n    auto result = MessageBox(HWND_DESKTOP, ss.str().c_str(), L\"Windows error!\", MB_ICONERROR);\n    result = result; // I added this line so I can put a breakpoint in the debugger\n#endif // _CONSOLE\n}\n</code></pre>\n\n<p>When I started out with the program I'm working on, this worked beautifully. But now the program is starting to grow. While trying out new code I noticed the program seemed to terminate unexpectedly. By running it in the Visual C++ 2010 debugger, I noticed a windows_error exception being thrown. By stepping through the basicHandler function, I could see that the MessageBox function returns 1 (IDOK) without actually showing the message box...</p>\n\n<p>What could cause this behavior?</p>\n\n<p>I know my description is a little vague, but I have no idea what else to add... I couldn't find anything on MSDN that would suggest this behavior is even possible. There is no parent window handle I could pass to MessageBox, since they're all being destroyed during stack unwinding. I'm also positive that the stack is not unwound through a window procedure or any other Windows callback.</p>\n\n<p>Any hint at all would be appreciated.</p>\n"},{"tags":["c++","qt","winapi","kinect","bstr"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":13224445,"title":"Why BSTR and how to convert it to QString?","body":"<p>I'm working with a Microsoft Kinect SDK where functions return BSTR. I need to get a QString or std::string.</p>\n\n<p>Here's what I've tried:</p>\n\n<pre><code>BSTR bstr = s-&gt;NuiUniqueId();\n\n// QString qs((QChar*)bstr, SysStringLen(bstr));\n\nstd::wstring ws(bstr);\n\nui-&gt;lblDetails-&gt;setText(QString::fromStdWString(ws));\n</code></pre>\n\n<p>With this solution the program crashes. With the line that is commented out I get \"unresolved external symbol SysStringLen\".</p>\n\n<p>Is SysStringLen the way to go, but I need to add some additional libraries (wouldn't the API include it already) or is there another solution?</p>\n\n<hr>\n\n<p>Additional question: why does Microsoft do it? I mean:</p>\n\n<pre><code>#if !defined(_NATIVE_WCHAR_T_DEFINED)\ntypedef unsigned short WCHAR;\n#else\ntypedef wchar_t WCHAR;\n#endif\ntypedef WCHAR OLECHAR;\ntypedef OLECHAR* BSTR;\ntypedef BSTR* LPBSTR;\n</code></pre>\n\n<p>What's the reason behind stuff like this? And even if they find it beneficial to use it internally, couldn't they just use normal char array or std::(w)string in the API to make other's life easier?</p>\n"},{"tags":["c++","api","winapi","console"],"answer_count":6,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2274,"score":3,"question_id":1937163,"title":"Drawing in a Win32 Console on C++?","body":"<p><strong>What is the best way to draw things in the Console Window on the Win 32 platform using C++?</strong></p>\n\n<p><em>I know that you can draw simple art using symbols but is there a way of doing something more complex like circles or even bitmaps?</em></p>\n"},{"tags":["winapi","ubuntu","samba","file-sharing","smb"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13206254,"title":"Client disconnection and automatically releasing its resources in SMB server","body":"<p>Here is the Scenario.</p>\n\n<p>I have a Server running with several files in it shared over network by <code>SMB</code> protocol on top of <code>TCP</code> protocol. My problem is, when client opens a file using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa363858%28v=vs.85%29.aspx\" rel=\"nofollow\">CreateFile</a> API with <code>dwShareMode</code> set 0, upon disconnection of client before closing the handle, the file seems to be locked indefinitely on the server, which makes it inaccessible to all other clients. After googling, I found out some workarounds for unlocking it. </p>\n\n<ol>\n<li><p>Restarting the server - Not viable.</p></li>\n<li><p>Killing the individual process that caused indefinite lock on the server - Tedious task. In network having 1000s of clients seems not practical.</p></li>\n<li><p>Reducing the the timeout of tcp to 1 minute from its default 2 hours 11 minutes by changing keepalive parameters(<a href=\"http://tldp.org/HOWTO/TCP-Keepalive-HOWTO/usingkeepalive.html\" rel=\"nofollow\">tcp_keepalive_probes, tcp_keepalive_time, tcp_keepalive_intvl</a>). Which means it drops an idle(disconnected in this context) connection, after 1 minute. - Seems the only option I have. But have following issues.</p>\n\n<p>a. If any other client, say client B tries to lock the same file(by createfile api) in that 1 minute timeout interval, even after that 1 minute interval, the initial client (client A) connection doesn't get dropped. After the re-connection, the file is not even accessible to the client A.</p>\n\n<p>b. Leave the timeout issue. If Client A gets disconnected after locking a file, And before Client A gets reconnected, it closes the file handle (Os queues this message to be sent upon re-connection). And when it gets reconnected, the file is unlocked at server (As OS sends the message upon re-connection). But, if Client B tries to acquire lock of same file before Client A gets re-connected, the file is not released even after Client A is reconnected making the file indefinitely locked.</p></li>\n</ol>\n\n<p>So is there any solution for this issue. Is there any possibility to unlock a locked file by another client or by any means?. Or is there any server side possibility?  </p>\n\n<p>Any workaround or hint to them is highly appreciated!</p>\n\n<p>Note: Clients are all windows machines, Server is on ubuntu.</p>\n"},{"tags":["c++","winapi","io","disk"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":37,"score":-1,"question_id":13217970,"title":"Is (disklike) IO asynchronic by nature (or synchronic)?","body":"<p>I wonder if IO disk api operations (like reading files or writing files) can be (are) performed with only marginal cpu usage (so for example it could be done in events (start.done) way with no cpu consumption) or not and they consume amounts of cpu when reading and writing files takes place. Could someone clear this? tnx</p>\n"},{"tags":["winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13217448,"title":"How to get the hardware info without using WMI?","body":"<p>I am programming an activation code for my application, I need to provide the key file with information about the licensed computer, I need to retrieve information about some devices like processor ID and DiskDrive Serial number, and the BIOS Serial as well ,, and so on with some devices, but these are the major ones.</p>\n\n<p>I need to combine the method with another application programmed by another language so I cannot use WMI, but I can use winapi.</p>\n\n<p>is there a way to fetch the physical data using winapi?if so, then how?</p>\n"},{"tags":["delphi","winapi","delphi-xe2","ribbon"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":13217347,"title":"Restrict window movement to parent window area","body":"<p>I'm working on a delphi program using the TRibbon and launching separate exe files.\nOnce I have executed the external application (with CreateProcessA() ) I set its parent as the form with the ribbon:</p>\n\n<pre><code>wHandle := FindWindow('MainRibbonForm');\nWinapi.Windows.SetParent(wHandle,self.Handle);\n</code></pre>\n\n<p>All considered, this works alright, but the problem is that the application forms can be moved over the TRibbon in the main form. I was thinking about restricting the form's movement within the main application but how can I take into account the ribbon?</p>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13213959,"title":"Getting local My Documents folder path","body":"<p>In my C++/WinAPI application I get the My Documents folder path using this code:</p>\n\n<pre><code>wchar_t path[MAX_PATH];\nSHGetFolderPathW(NULL,CSIDL_PERSONAL,NULL,SHGFP_TYPE_CURRENT,path);\n</code></pre>\n\n<p>One of the users runs my program on a pc connected to his corporate network. He has the My Documents folder on a network. So my code returns something like\n\\\\paq\\user.name$\\My Documents\nThough he says he has a local copy of My Documents.\nThe problem is that when he 'swaps VPN', the online My Documents becomes unavailable and my program crashes with the system error code 64 \"The specified network name is no longer available\" ( it tries to write to the file opened in the online my docs folder).</p>\n\n<p>How can I always get the local My Documents folder path using C++/WinAPI?</p>\n"},{"tags":["c++","windows","winapi","windows-7","interface"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":51,"score":-1,"question_id":13215648,"title":"handling external executable files on Windows with C++","body":"<p>I am trying to develop an interface in C++ which will invoke (with system()) several other executable files in an iterative way. The executables are only available on Windows. So far, I have implemented the interface and it behaves as it should be for a number of iterations. However, on the long run (after 7 hrs running) the memory runs flat and then the whole system crashes and I can only bring it back in operation again by manually reboot.\nThe executables are probably implemented in Fortran (unknown which version) but not 100% sure.\nI have profiled my code several times (with valgrind, obviously on linux). My code is cross-platform (in fact I only use STL just to avoid any other problems). Only Sleep() and sleep() change between both versions. So, I guess it is not a issue of the operating system I use (windows 7 64bit, i7-2720QM CPU @ 2.20GHz with 16GB RAM + 2GB paging). \nAs I said before after 3000 invocations 18GB of memory diminish!\nSo, the question is.... How can I read with C++ if the executables cause memory leaks? and if they do, how can I clear their \"uncleaned mesh/leftovers\" (I don't have the source of the executables)</p>\n\n<p>PS. Currently, I am trying to use ShellExecute() and CreateProcess() but I feel that this is not the source of my problem.</p>\n\n<p>ETA\nI was experimenting with wine 1.4.1 (so as to make to models to work on linux and use valgrid to profile the execution). Apparently one executable requires .NET 4.0 (or greater) and the other is Fortran90. Does this ring any bell?</p>\n\n<p>Any ideas are more than welcome\nThanks in advance for reading</p>\n"},{"tags":["python","windows","winapi","file-io","hidden-files"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":81,"score":6,"question_id":13215716,"title":"IOError: [Errno 13] Permission denied when trying to open hidden file in \"w\" mode","body":"<p>I want to replace the contents of a hidden file, so I attempted to open it in <code>w</code> mode so it would be erased/truncated:</p>\n\n<pre><code>&gt;&gt;&gt; import os\n&gt;&gt;&gt; ini_path = '.picasa.ini'\n&gt;&gt;&gt; os.path.exists(ini_path)\nTrue\n&gt;&gt;&gt; os.access(ini_path, os.W_OK)\nTrue\n&gt;&gt;&gt; ini_handle = open(ini_path, 'w')\n</code></pre>\n\n<p>But this resulted in a traceback:</p>\n\n<pre><code>IOError: [Errno 13] Permission denied: '.picasa.ini'\n</code></pre>\n\n<p>However, I was able to achieve the intended result with <code>r+</code> mode:</p>\n\n<pre><code>&gt;&gt;&gt; ini_handle = open(ini_path, 'r+')\n&gt;&gt;&gt; ini_handle.truncate()\n&gt;&gt;&gt; ini_handle.write(ini_new)\n&gt;&gt;&gt; ini_handle.close()\n</code></pre>\n\n<p><strong>Q.</strong> What is the difference between the <code>w</code> and <code>r+</code> modes, such that one has \"permission denied\" but the other works fine?</p>\n\n<p><strong>UPDATE:</strong> I am on win7 x64 using Python 2.6.6, and the target file has its hidden attribute set. When I tried turning off the hidden attribute, <code>w</code> mode succeeds. But when I turn it back on, it fails again.</p>\n\n<p><strong>Q.</strong> Why does <code>w</code> mode fail on hidden files? Is this known behaviour?</p>\n"},{"tags":["perl","winapi","ppm"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":2772,"score":-2,"question_id":2092784,"title":"How can I properly install Win32::GuiTest?","body":"<p>I am trying to use <a href=\"http://search.cpan.org/perldoc/Win32%3A%3AGuiTest\" rel=\"nofollow\">Win32::GuiTest</a> and with Windows XP and <code>perl</code> version 5.8.6.</p>\n\n<p>I am getting the following error:</p>\n\n<pre>\nCan't locate loadable object for module Win32::GuiTest in @INC (@INC contains: \nC:/Perl/lib C:/Perl/site/lib .) at E:\\a\\simply.pl line 259\n  Compilation failed in require at E:\\a\\simply.pl line 259.\n  BEGIN failed--compilation aborted at E:\\a\\simply.pl line 259\n</pre>\n\n<p>I tried following the instructions for <a href=\"http://search.cpan.org/dist/Win32-GuiTest-1.3/\" rel=\"nofollow\">Win32-GuiTest-1.3</a>. I tried to install:</p>\n\n<p>I created <code>C:\\TEMP</code> and I downloaded the zip file and extracted  the contents and placed in <code>C:\\TEMP</code> and gave the command</p>\n\n<pre><code>C:\\TEMP&gt;ppm\nppm&gt; install C:\\temp\\win32-guitest.ppd\n</code></pre>\n\n<p>It is giving an error as...</p>\n\n<pre>\nError: no suitable installation target found for package Win32-GuiTest.\n</pre>\n\n<p>If I use the package <code>Win32-GuiTest-1.56</code>, it is giving the error</p>\n\n<pre>\nError: Package 'win32-guitest' not found. Please 'search' for it first.\n</pre>\n\n<p>and if i use the command</p>\n\n<pre>\nC:\\temp>ppm\nppm> install Win32::GuiTest\n</pre>\n\n<p>i get the error as...</p>\n\n<pre>\nError: No valid repositories:\nError: 501 Protocol scheme '' is not supported\nError: 501 Protocol scheme '' is not supported\n</pre>\n\n<p>i downloaded from \n<strong>http://search.cpan.org/~erngui/Win32-GuiTest-1.3/GuiTest.pm</strong> for package <code>Win32-GuiTest-1.3</code>\nand \n<strong>http://search.cpan.org/dist/Win32-GuiTest/lib/Win32/GuiTest.pm</strong> for package <code>Win32-GuiTest-1.56</code></p>\n"},{"tags":["c++","winapi","event-log"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13214873,"title":"Writing to the Windows Security Log with C++","body":"<p>I have been tasked with writing entries to the Windows security log. The entire project is Win32 C++ code. I have already written (with help from various online resources) a logging class that handles registration, deregistration, and code for executing the ReportEvent() call. Also, I've done the mc.exe and rc.exe steps for my event logging, if that helps establish where I'm at in the project.<br>\n<br>\nMy question is a multi-parter:<br>\n1) I've noticed at <a href=\"http://stackoverflow.com/questions/4095455/filling-windows-xp-security-event-log\">Filling Windows XP Security Event Log</a> that there are some who believe this is not allowed by Windows. Others ( <a href=\"http://stackoverflow.com/questions/11794013/how-to-write-log-to-security-event-log-in-c\">How to write log to SECURITY event Log in C#?</a> ) imply otherwise. Possible or not?<br>\n2) If it is possible, how to get it to write to the security log. Is it as simple as specifying \"Security\" as my source name when calling RegisterEventSource()?<br>\n3) As far as deregistration, when should that occur? When the app is uninstalled? When the app closes? When the log entry is written?<br>\n4) How do I look up my log entries? I look in the Windows Event Viewer, but I don't see the entries I add with my test app, despite all the appropriate return values from the system calls. Where would I look up the events that I specified with a source name of \"yarp\" when I made my call to RegisterEventSource()?</p>\n"},{"tags":["python","winapi","service","pywin32"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":338,"score":2,"question_id":8795703,"title":"Windows Service written in python, not detecting shutdown events and stopping gracefully","body":"<p>I've written a service for Windows XP+ in python using the <a href=\"http://timgolden.me.uk/python/win32_how_do_i/track-session-events.html\" rel=\"nofollow\">With Extended Service Notifications</a> example code.  It works great for detecting user logon/logoff lock screen, and other events.  The problem is that it never executes shutdown events and gracefully stops the service upon reboot/shutdown.  It stays alive through logon/logoff events as well as starting up again after the reboot.  Any help would be appreciated.</p>\n\n<p>I don't want to use RegisterServiceCtrlHandlerEx and handle console signals if I can help it--services have this functionality built in, I've just mangled it somehow.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>from os.path import splitext, abspath\nfrom sys import modules\n\nimport win32serviceutil\nimport win32service\nimport win32event\nimport win32api\nimport win32security\nimport win32ts\n\nclass Service(win32serviceutil.ServiceFramework):\n  _svc_name_ = '_unNamed'\n  _svc_display_name_ = '_Service Template'\n\n  def __init__(self, *args):\n    win32serviceutil.ServiceFramework.__init__(self, *args)\n    self.log('Initializing Service')\n    self.stop_event = win32event.CreateEvent(None, 0, 0, None)\n    self.server = None\n\n  def log(self, msg):\n    import servicemanager\n    servicemanager.LogInfoMsg(str(msg))\n  def logErr(self, msg):\n    import servicemanager\n    servicemanager.LogErrorMsg(str(msg))\n  def logWarn(self, msg):\n    import servicemanager\n    servicemanager.LogWarningMsg(str(msg))\n\n  def sleep(self, sec):\n    win32api.Sleep(sec*1000, True)\n\n  def GetAcceptedControls(self):\n    # Accept SESSION_CHANGE control\n    rc = win32serviceutil.ServiceFramework.GetAcceptedControls(self)\n    rc |= win32service.SERVICE_ACCEPT_SESSIONCHANGE\n    rc |= win32service.SERVICE_ACCEPT_SHUTDOWN\n    return rc\n\n  def GetUserInfo(self, sess_id):\n    sessions = win32security.LsaEnumerateLogonSessions()[:-5]\n    for sn in sessions:\n      sn_info = win32security.LsaGetLogonSessionData(sn)\n      if sn_info['Session'] == sess_id:\n        return sn_info\n\n  def getUserSessionInfo(self, sess_id):\n    msg = \"\"\n    try:\n      for key, val in self.GetUserInfo(sess_id).items():\n        msg += '%s : %s\\n'%(key, val)\n        if key == \"UserName\":\n          self.server.username = val\n    except Exception, e:\n      msg += '%s'%e\n    return msg\n\n  # All extra events are sent via SvcOtherEx (SvcOther remains as a\n  # function taking only the first args for backwards compatability)\n  def SvcOtherEx(self, control, event_type, data):\n      # This is only showing a few of the extra events - see the MSDN\n      # docs for \"HandlerEx callback\" for more info.\n      if control == win32service.SERVICE_CONTROL_SESSIONCHANGE:\n          sess_id = data[0]\n          msg = \"\"\n          if event_type == 5: # logon\n            msg = \"Logon event: type=%s, sessionid=%s\\n\" % (event_type, sess_id)\n#            user_token = win32ts.WTSQueryUserToken(int(sess_id))\n            self.server.status = 1 #logon event\n            self.getUserSessionInfo(sess_id)\n            self.sendHeartbeat()\n            self.server.status = 2 #active user\n          elif event_type == 6: # logoff\n            msg = \"Logoff event: type=%s, sessionid=%s\\n\" % (event_type, sess_id)\n            self.server.status = 3 #logoff event\n            self.sendHeartbeat()\n            self.server.username = \"\"\n            self.server.status = 0 #no user\n          elif event_type == 7: # lock\n            msg = \"Lock event: type=%s, sessionid=%s\\n\" % (event_type, sess_id)\n            self.server.status = 1 #logon event\n            self.getUserSessionInfo(sess_id)\n            self.sendHeartbeat()\n            self.server.status = 2 #active user\n          elif event_type == 8: # unlock\n            self.server.status = 3 #logoff event\n            self.server.username = \"\"\n            self.sendHeartbeat()\n            self.server.status = 0 #no user\n          else:\n            msg = \"Other session event: type=%s, sessionid=%s\\n\" % (event_type, sess_id)\n\n#          msg += self.getUserSessionInfo(sess_id)\n          self.log(msg)\n#      elif control == win32service.SERVICE_CONTROL_SHUTDOWN:\n#        msg = \"Server being shutdown...\"\n#        self.log(msg)\n\n  def SvcDoRun(self):\n    self.ReportServiceStatus(win32service.SERVICE_START_PENDING)\n    try:\n      self.ReportServiceStatus(win32service.SERVICE_RUNNING)\n      self.log('Starting Service')\n      self.start()\n      self.log('Waiting')\n      win32event.WaitForSingleObject(self.stop_event, win32event.INFINITE)\n      self.log('Done')\n    except Exception, x:\n      self.logErr('Exception : %s' % x)\n      self.SvcStop()\n\n  def SvcStop(self):\n    self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)\n    self.log('Stopping Service')\n    self.stop()\n    self.log('Stopped')\n    win32event.SetEvent(self.stop_event)\n    self.ReportServiceStatus(win32service.SERVICE_STOPPED)\n\n  def sendHeartbeat(self):\n    # 0 = no user, standard beat (format: 0||hostname)\n    # 1 = login event (format: 1|username|hostname)\n    # 2 = active user session\n    # 3 = logout event (format: 2|username|hostname)\n    # 4 = Service exception (format 3||hostname)\n    return self.server.sendHeartbeat(category=self.server.status, username=self.server.username)\n\n  def start(self): pass\n  # to be overridden\n  def stop(self): pass\n  # to be overridden\n\n  #reboot/halt makes a different call than 'net stop mytestservice'\n  def SvcShutdown(self):\n    msg = \"Server being shutdown...\"\n    self.log(msg)\n    self.SvcStop()\n\n\ndef instart(cls, name, display_name=None, stay_alive=True, exe_name=\"caedmSAM.exe\"):\n    '''\n        Install and  Start (auto) a Service\n\n            cls : the class (derived from Service) that implement the Service\n            name : Service name\n            display_name : the name displayed in the service manager\n            stay_alive : Service will stop on logout if False\n    '''\n    cls._svc_name_ = name\n    cls._svc_display_name_ = display_name or name\n    cls._exe_name_ = exe_name\n    cls._svc_description_ = \"CAEDM SAM Server registration and montioring service\"\n    try:\n        module_path=modules[cls.__module__].__file__\n    except AttributeError:\n        # maybe py2exe went by\n        from sys import executable\n        module_path=executable\n    module_file=splitext(abspath(module_path))[0]\n    cls._svc_reg_class_ = '%s.%s' % (module_file, cls.__name__)\n    if stay_alive: win32api.SetConsoleCtrlHandler(lambda x: True, True)\n    try:\n        win32serviceutil.InstallService(\n                cls._svc_reg_class_,\n                cls._svc_name_,\n                cls._svc_display_name_,\n                startType=win32service.SERVICE_AUTO_START\n                )\n#        print 'Install: OK'\n        win32serviceutil.StartService(\n                cls._svc_name_\n                )\n#        print 'Start: OK'\n    except Exception, x:\n        print str(x)\n</code></pre>\n"},{"tags":["c++","windows","winapi","windows-7","windows-services"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":59,"score":1,"question_id":13199628,"title":"CreateProcessWithLogonW : unable to start process","body":"<p>Hi I am completely new to programming. And please someone help me.</p>\n\n<p>I am trying to start a pocess from a service. \nI need to start the new process by prompting user to enter admin credentials.</p>\n\n<p>I was trying to use <code>CreateProcessWithLogonW()</code>.</p>\n\n<p>Am I using the right function. \nI tried to give input username, password, domain as localhost. I gave full pathe to the .exe file that i need to start.</p>\n\n<p>Here is the piece of code.</p>\n\n<pre><code>CreateProcessWithLogonW(L\"Administrator\",\n                        L\"localhost\",\n                        L\"password\",\n                        0,\n                        NULL,\n                        L\"c:\\myupdates\\myapp.exe\",\n                        NORMAL_PRIORITY_CLASS | CREATE_CONSOLE,\n                        NULL,\n                        NULL,\n                        &amp;si,\n                        &amp;pi);\n\nSi.cb = sizeof(si);\nSi.lpDesktop = L\"winsta0\\\\default\";\n</code></pre>\n\n<p>But the process never started. Can you guys tell me what I am doing wrong.\nAnd what do I need to do to promt user to enter credentials of administrator instead of hardcoding it. </p>\n"},{"tags":["winapi","sd-card"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3435,"score":0,"question_id":1616488,"title":"Retrieve SD Card serial number on Windows XP/Vista/7?","body":"<p>There is a manufacturer's serial number on SD cards, and there are a number of pages on the 'net that describe how to retrieve it on various mobile devices (including <a href=\"http://stackoverflow.com/questions/552681/compact-framework-get-storage-card-serial-number\">this one</a>). But I need to retrieve it under <em>desktop</em> versions of Windows, and the code that works for mobile versions of Windows doesn't seem to translate.</p>\n\n<p>The question: how do you programmatically retrieve the SD card manufacturer's serial number from an SD card under desktop Windows?</p>\n\n<p>EDIT: From what I gather, this can be done using the <code>DeviceIoControl</code>'s <code>IOCTL_SFFDISK_DEVICE_COMMAND</code> to send command 10 from the SD Card specs, but it's unreliable -- it only works with certain non-USB card readers, and only with certain drivers for those readers. That makes it useless for our purposes. Maybe someone else can get some use from the information.</p>\n"},{"tags":["c#","c++","actionscript-3","flex","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13212609,"title":"Send file over SOCKET","body":"<p>I'm creating simple Socket server. Flex application will be client for this server. On special request I need to transfer image file (jpeg) from server to client over socket.</p>\n\n<p>I already wrote server on C# for test purposes - and it works fine with my flex app.</p>\n\n<p>C# code, which sends image:</p>\n\n<pre><code>private void sendImage(Socket client)\n        {\n            Bitmap data = new Bitmap(\"assets/sphere.jpg\");\n            Image img = data;\n            MemoryStream ms = new MemoryStream();\n            img.Save(ms, System.Drawing.Imaging.ImageFormat.Jpeg);\n            byte[] buffer = ms.ToArray();\n            sendInt(client, buffer.Length);\n            client.Send(buffer);\n            Console.WriteLine(\"Image sent\");\n        }\n</code></pre>\n\n<p>C++ code, which sends the same image:</p>\n\n<pre><code>void SocketServer::sendFile(SOCKET &amp;client, std::string filename)\n{\n    std::ifstream file (filename, std::ios::ate);\n    if (file.is_open())\n    {\n        std::ifstream::pos_type size = file.tellg();\n        char * memblock = new char [size];\n        file.seekg (0, std::ios::beg);\n        file.read (memblock, size);\n        file.close();\n        sendInt(client, size);\n        send(client, memblock, size, 0);\n        delete[] memblock;\n    }\n}\n</code></pre>\n\n<p><code>send</code> method returns proper image size as sent value.</p>\n\n<p>For some reason I can't debug in Adobe Flash Builder 4.6 on Windows 8, so I created output widget where I can view transfer result as string</p>\n\n<p>C# transfered result:\n<img src=\"http://i.stack.imgur.com/AUB80.png\" alt=\"enter image description here\"></p>\n\n<p>C++ transfered result:\n<img src=\"http://i.stack.imgur.com/0H3sb.png\" alt=\"enter image description here\"></p>\n\n<p>As you can see 500 or so first characters are the same. The rest of C++ one are those 'i' symbols. The strange thing is that if I read file into string using this code for example:</p>\n\n<pre><code>std::ifstream ifs(\"sphere.jpg\");\nstd::string str((std::istreambuf_iterator&lt;char&gt;(ifs)), std::istreambuf_iterator&lt;char&gt;());\n</code></pre>\n\n<p>my string will be ~500 characters instead of 124Kbytes (~124k chars, image file size).</p>\n\n<p>Here is C++ image result:\n<img src=\"http://i.stack.imgur.com/BIp9a.png\" alt=\"enter image description here\"></p>\n\n<p>So I don't really know why socket transfer only very small part of <code>jpeg</code> correctly and the rest is wrong? As I mentioned - there is no problems if I transfer byte array from C# to Flex, so I assume that everything fine on Flex side.</p>\n"},{"tags":["c++","winapi","visual-c++","visual-studio-2012","version"],"answer_count":2,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":98,"score":6,"question_id":13209853,"title":"How do I correctly version a program?","body":"<p>I always see programs that say things like, <code>Version: 1.5.6</code>, or something. My question is, how do I properly determine the version? </p>\n\n<p>I'm a C++ programmer, so I would think this is kind of important. I also use Visual Studio Ultimate 2012.</p>\n\n<p>EDIT:\nHow do I add the version in the code as well?</p>\n"},{"tags":["windows","multithreading","winapi","suspend"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2508,"score":4,"question_id":3444190,"title":"Windows SuspendThread doesn't? (GetThreadContext fails)","body":"<p>We have an Windows32 application in which one thread can stop another to inspect its \nstate [PC, etc.], by doing SuspendThread/GetThreadContext/ResumeThread.</p>\n\n<pre><code>if (SuspendThread((HANDLE)hComputeThread[threadId])&lt;0)  // freeze thread\n   ThreadOperationFault(\"SuspendThread\",\"InterruptGranule\");\nCONTEXT Context, *pContext;\nContext.ContextFlags = (CONTEXT_INTEGER | CONTEXT_CONTROL);\nif (!GetThreadContext((HANDLE)hComputeThread[threadId],&amp;Context))\n   ThreadOperationFault(\"GetThreadContext\",\"InterruptGranule\");\n</code></pre>\n\n<p>Extremely rarely, on a multicore system, GetThreadContext returns error code 5 (Windows system error code \"Access  Denied\").</p>\n\n<p>The SuspendThread documentation seems to clearly indicate that the targeted thread is suspended, if no error is returned. We are checking the return status of SuspendThread and ResumeThread; they aren't complaining, ever.</p>\n\n<p>How can it be the case that I can suspend a thread, but can't access its context?</p>\n\n<p>This blog\n<a href=\"http://www.dcl.hpi.uni-potsdam.de/research/WRK/2009/01/what-does-suspendthread-really-do/\" rel=\"nofollow\">http://www.dcl.hpi.uni-potsdam.de/research/WRK/2009/01/what-does-suspendthread-really-do/</a></p>\n\n<p>suggests that SuspendThread, when it returns, may have <em>started</em> the \nsuspension of the other thread, but that thread hasn't yet suspended.  In this case, I can kind of see how GetThreadContext would be problematic, but this seems like a stupid way to define SuspendThread. (How would the call of SuspendThread know when the target thread was actually suspended?)</p>\n\n<p>EDIT: <em>I lied.</em> I said this was for Windows. </p>\n\n<p>Well, the strange truth is that I don't see this behavior under Windows XP 64 (at least not in the last week and I don't really know what happened before that)... but we have been testing this Windows application under Wine on Ubuntu 10.x.  The <a href=\"http://source.winehq.org/source/dlls/ntdll/thread.c#L766\" rel=\"nofollow\">Wine source for the guts of GetThreadContext</a> contains\nan Access Denied return response on line 819 when an attempt to grab the thread state fails for some reason. I'm guessing, but it appears that Wine GetThreadStatus believes that a thread just might not be accessible repeatedly.  Why that would be true after a SuspendThead is beyond me, but there's the code.  Thoughts?</p>\n\n<p>EDIT2: <em>I lied again</em>.  I said we only saw the behavior on Wine.  Nope... we have now found a Vista Ultimate system that seems to produce the same error (again, rarely).   So, it appears that Wine and Windows agree on an obscure case. It also appears that the mere enabling of the Sysinternals Process monitor program aggravates the situation and causes the problem to appear on Windows XP 64; I suspect a Heisenbug.  (The Process Monitor\ndoesn't even exist on the Wine-tasting (:-) machine or the XP 64 system I use for development).</p>\n\n<p>What on earth is it?</p>\n\n<p>EDIT3: Sept 15 2010.  I've added careful checking to the error return status, without otherwise disturbing the code, for SuspendThread, ResumeThread, and GetContext.  I haven't seen <em>any</em> hint of this behavior on Windows systems since I did that.  Haven't gotten back to the Wine experiment.</p>\n\n<p>Nov 2010: Strange.  It seems that if I compile this under VisualStudio 2005, it fails on Windows Vista and 7, but not earlier OSes.  If I compile under VisualStudio 2010, it doesn't fail anywhere.  One might point a finger at VisualStudio2005, but I'm suspicious of a location-sensitivve problem, and different optimizers in VS 2005 and VS 2010 place the code a slightly different places.</p>\n\n<p>Nov 2012: Saga continues.  We see this failure on a number of XP and Windows 7 machines, at a pretty low rate (once every several thousand runs).  Our Suspend activities are applied to threads that mostly execute pure computational code but that sometimes make calls into Windows.    I don't recall seeing this issue when the PC of the thread was in our computational code.   Of course, I can't see the PC of the thread when it hangs because GetContext won't give it to me, so I can't directly confirm that the problem only happens when executing system calls.  But, all our system calls are channeled through one point, and so far the evidence is that point was executed when we get the hang. So the indirect evidence suggests GetContext on a thread only fails if a system call is being executed by that thread.    I haven't had the energy to build a critical experiment to test this hypothesis yet.</p>\n"},{"tags":[".net","web-services","delphi","winapi","com"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":598,"score":4,"question_id":5881070,"title":"How to access a .Net web service from a Delphi Win32 application?","body":"<p>What options do I have if I want to enable a Delphi Win32 application to consume a .Net webservice?</p>\n\n<p>Is it possible to interact directly? Or do I have to resort to a middleman-software communicating to the Delphi application per COM for instance?</p>\n\n<p>The Delphi application in question is written in Delphi 2006 but is planned to be updated to Delphi XE soon.</p>\n"},{"tags":["winapi","controlpanel"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1303,"score":3,"question_id":503636,"title":"How to programmatically open control panel?","body":"<p>How do I open a custom control panel programmatically, like custom.cpl? Specifically, how do I open a 64-bit cpl when running as 32-bit application?</p>\n"},{"tags":["c++","winapi","rc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13206294,"title":"C++ Win32 TextBox Add String","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12537456/how-to-append-text-to-a-textbox\">How to append text to a TextBox?</a>  </p>\n</blockquote>\n\n\n\n<p>I didn't programing C++ For a long long time ..\nAnd I forgot how to add string to the TextBox ..\nIn Past I used function call 'SendMessage()'\nBut what do I need to use if I want to Add String, and not to edit the all TextBox ..\nThanks ..</p>\n"},{"tags":["winapi","skinning","clipping","direct2d","layered-windows"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":295,"score":0,"question_id":6003275,"title":"A skinning engine in Windows: draw “dirty” regions only or the whole window at once?","body":"<p>I want to make a skinning engine capable of drawing custom-shaped windows with alpha blending. That is, it'll use layered windows (<em>UpdateLayeredWindow</em>). A typical window will contain among its background a couple dozens of other bitmaps ranging from 10×10 to, say, 300×150 pixels. In the worst case most of these elements will have smooth animation up to 30 fps. Everything will be alpha-blended and I am going to use Direct2D for this (yes, I know older Windows versions doesn't support it). In general, Winamp's modern skin engine is the closest example.</p>\n\n<p>Given all this and taking in account modern PCs performance, can I just redraw the whole window every single frame or do I have to constrain to some sort of clip rectangle?</p>\n"},{"tags":["winapi","gdi+"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13196480,"title":"How to save DDB to file?","body":"<p>I wanted to ask if it is possible to save DDB to file ? I know that you can save DIB, so it means that I would need to convert DDB to DIB before saving. Is there any other way ? thx </p>\n"},{"tags":["c++","api","winapi","jpg"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":109,"score":0,"question_id":13192731,"title":"win32 API open a jpg in a picture control c++","body":"<p>i want to know if there's a way to print a jpg onto a picture control rectangle (that i build with ResEdit) the action that should print the image is  case IDC_BUTTON1: and the target i want to view the image is in a picture control with the id: IDC_STATIC</p>\n\n<pre><code>BOOL CALLBACK AppDlgProc(HWND hDlg, UINT uMsg, WPARAM wParam, LPARAM lParam)\n{\n  switch(uMsg)\n  {\n\n  case WM_INITDIALOG:\n      DragAcceptFiles(hDlg,true);\n    SetClassLongPtr(hDlg, GCLP_HICON, (long)LoadIcon(0, IDI_APPLICATION));\n    return 1;\n  case WM_COMMAND:\n   switch(wParam)\n    {\n    case IDOK:\n  return 0;\ncase IDCANCEL:\n  EndDialog(hDlg, 0);\n}\n switch(wParam)\n        {\n            case IDC_BUTTON1:\n               ShellExecute(hDlg,\n         \"open\",\n         \"C:\\immagine1.jpg\",\n         NULL,\n         NULL,\n         SW_SHOWDEFAULT);\n            break;\n        }\n\n  switch(wParam)\n        {\n            case IDC_BUTTON4:\n               ShellExecute(hDlg,\n         \"open\",\n         \"C:\\log.txt\",\n         NULL,\n         NULL,\n         SW_SHOWDEFAULT);\n            break;\n        }\n\n\n\n\n\n\n  }\n  return 0;\n}\n</code></pre>\n\n<p>instead of using shell execute that open the default viewer thank you all</p>\n"},{"tags":["c++","windows","winapi","dialog"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13189791,"title":"Disable X-Button Icon on the top of the right in Messagebox Using C++ Win32 API?","body":"<p>i am using C++ win32 API...</p>\n\n<p>i have a Windows messagebox contain <code>OKCANCEL</code> Button...</p>\n\n<p>the messagebox have a close(X-Button) on the right top...</p>\n\n<p><code>retun1=MessageBox(hDlg,TEXT(\"Your password will expired,you must change the password\"),TEXT(\"Logon Message\"),MB_OK | MB_ICONINFORMATION);</code></p>\n\n<p>i only want to close the messagebox using the <code>CANCEL</code> Button...</p>\n\n<p>So,i want to disable the X-Button Icon...</p>\n\n<p>i am already try <code>MB_ICONMASK</code> <code>MB_MODEMASK</code> Somethink like that.</p>\n\n<p>But i cant get it,what i need...</p>\n\n<p>How can i Resolve it?</p>\n"},{"tags":["c#",".net","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2996,"score":0,"question_id":4518397,"title":"Send Click Message to another application process","body":"<p>I have a scenario, i need to send click events to an independent application. I started that application with the following code.</p>\n\n<pre><code>private Process app;\napp = new Process();\napp.StartInfo.FileName = app_path;\napp.StartInfo.WorkingDirectory = dir_path;\napp.Start();\n</code></pre>\n\n<p>Now i want to send Mouse click message to that applicaiton, I have specific coordinates in relative to application window. How can i do it using Windows Messaging or any other technique.</p>\n\n<p>I used</p>\n\n<pre><code>[DllImport(\"user32.dll\")]\nprivate static extern void mouse_event(UInt32 dwFlags, UInt32 dx, UInt32 dy, UInt32 dwData, IntPtr dwExtraInfo);\n</code></pre>\n\n<p>It works well but cause the pointer to move as well. So not fit for my need.</p>\n\n<p>Then i use.</p>\n\n<pre><code>[DllImport(\"user32.dll\", CharSet = CharSet.Auto, SetLastError = false)]\nstatic extern IntPtr SendMessage(IntPtr hWnd, int Msg, int wParam, int lParam);\n</code></pre>\n\n<p>It works well for minimize maximize, but do not work for mouse events.</p>\n\n<p>The codes for mousevents i am using are,</p>\n\n<pre><code>WM_LBUTTONDOWN = 0x201, //Left mousebutton down\nWM_LBUTTONUP = 0x202,   //Left mousebutton up\nWM_LBUTTONDBLCLK = 0x203, //Left mousebutton doubleclick\nWM_RBUTTONDOWN = 0x204, //Right mousebutton down\nWM_RBUTTONUP = 0x205,   //Right mousebutton up\nWM_RBUTTONDBLCLK = 0x206, //Right mousebutton do\n</code></pre>\n\n<p>Thanks for the help in advance, and waiting for feedback.</p>\n"},{"tags":["c++","winapi","mdi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":11,"score":0,"question_id":13199921,"title":"How to add menu inside MDI window?","body":"<p>How can I add menu inside one of the Multiple Document Interface windows in my application? </p>\n"},{"tags":["windows","winapi","service","shell32"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":985,"score":1,"question_id":202031,"title":"Using SHFileOperation within a Windows service","body":"<p>It's possible, but is it appropriate to use SHFileOperation within a Windows service?  All those SHxxx API functions in shell32.dll seem to have been written with user level programs in mind.  Can I be certain SHFileOperation won't display GUI ever?</p>\n"},{"tags":["c#",".net","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13195363,"title":"How can listen accesses to Windows APIs by proccesses","body":"<p>I want to make a simple program in <code>.Net</code> that it watches the accesses to the <code>Win API</code> functions (like <code>System.IO.FileSystemWatcher</code> for file system) and it let me know which proccess has access to which API.</p>\n\n<p>Is there any interrupt approach or per-build component in <code>.Net Framework</code> to do this?</p>\n\n<p>with many thanks.</p>\n"},{"tags":["c#","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":259,"score":0,"question_id":11484528,"title":"Get path of current active window using window handle","body":"<p>I'd like to know how to grab the Path of the current active window using C#.   </p>\n\n<p>i get handle of currnet active window </p>\n\n<pre><code>        const int nChars = 256;\n        int handle = 0;\n        StringBuilder Buff = new StringBuilder(nChars);\n\n        handle = GetForegroundWindow(); \n</code></pre>\n\n<p>now how do i get path of this window?  </p>\n\n<p>i.e: Path of \"my document\" window is </p>\n\n<pre><code>C:\\Users\\User\\Documents\n</code></pre>\n\n<p><strong>-=-=-==-=-=edit-=-=-=-=-=-</strong><br>\ni want to wirte program to monitor \"windows explorer\" and see Where the user goes?<br>\n(i.e:user go to c:\\ and then go to program files and then go to Internet Explorer and i want to get this path:C:\\Program Files\\Internet Explorer.\n<img src=\"http://i.stack.imgur.com/P4GAv.png\" alt=\"enter image description here\">  </p>\n"},{"tags":["c++","winapi","process","pid"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13193719,"title":"Kill process started with ShellExecuteEx","body":"<p>1) I started a process with ShellExecuteEx</p>\n\n<p>2) retrieve the PID with </p>\n\n<pre><code>GetProcessId(shellExInfo.hProcess)\n</code></pre>\n\n<p>Sample Code:</p>\n\n<pre><code>SHELLEXECUTEINFO shellExInfo;\n\nshellExInfo.cbSize = sizeof(SHELLEXECUTEINFO);\nshellExInfo.fMask = SEE_MASK_NOCLOSEPROCESS;\nshellExInfo.hwnd = NULL;\nshellExInfo.lpVerb = \"open\";\nshellExInfo.lpFile = processToStart.c_str();\nshellExInfo.lpParameters = processParams.c_str();\nshellExInfo.lpDirectory = NULL;\nshellExInfo.nShow = SW_SHOW;\nshellExInfo.hInstApp = NULL;\n\nShellExecuteEx(&amp;shellExInfo); // start process\n\nGetProcessId(shellExInfo.hProcess); // retrieve PID\n</code></pre>\n\n<p>Now I want to kill the started process with given PID! How is this possible?</p>\n\n<p>Thx</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13176662,"title":"How to calculate days between two dates using C++ Win32 API?","body":"<p>i am using C++ win32 API...</p>\n\n<p>i have these values.</p>\n\n<blockquote>\n  <p>pwdlastset date(ex:25-9-2012), current date(ex:1-11-2012),  maxpwdage\n  count(ex 54 days) pwdwarningdays(14 days)...</p>\n</blockquote>\n\n<p>Now i want to calculate password expiry date...</p>\n\n<p>i have try the below code...</p>\n\n<pre><code>if(lastpwdchmon==currentMonth)\n                        {\n                        lCount=currentDay-lastpwdchday;\n                        }\n                        else if(lastpwdchmon&lt;currentMonth)\n                        {\n                            lCount=((currentDay+30)-lastpwdchday);\n                        }\n</code></pre>\n\n<p>but,i have a problem...</p>\n\n<p>i mean,just i need to calculate how many days between the currentdate &amp; pwdlastset date?</p>\n\n<p>How to achieve this?</p>\n"},{"tags":["python","windows","winapi","automation","pywin32"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":273,"score":0,"question_id":5487263,"title":"Python bindings for Microsoft UI Automation?","body":"<p>Anybody know of any Python bindings for Microsoft UI Automation?</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/ms747327.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms747327.aspx</a></p>\n\n<p>without having to use IronPython. I am aware of the excellent pywin32 work, but Microsoft UI Automation is supposed to be the successor of the Active Accessibility layer, which I have been using on Windows XP. I need to migrate of the \"Active Accessibility\" functionality (event triggers on open windows, focus controls, etc.) to a Windows 7 platform.</p>\n\n<p>Thanks!</p>\n"},{"tags":["c++","winapi","windows-7","serial-port"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":51,"score":3,"question_id":13191777,"title":"Invalid handle error when connecting to COM port higher than 10 on Windows 7","body":"<p>I have developed a simple serial port application that works fine with COM ports lower than 10 (COM9, COM8, ...  COM1). But when my device is attached on a port higher than 10, such as COM11, it doesn't connect and I get an INVALID_HANDLE. My code is:</p>\n\n<pre><code>comport = CreateFileA(comPortName.toAscii(), GENERIC_READ|GENERIC_WRITE,\n                      FILE_SHARE_READ|FILE_SHARE_WRITE, NULL, OPEN_EXISTING, 0, NULL);\n\nif(comport == INVALID_HANDLE_VALUE)\n{\n    //Write exception code here\n    connectionStatus = CONNECTION_STATUS_DISCONNECTED;\n}\n</code></pre>\n\n<p>What's wrong with my code? Is there any solution?</p>\n"},{"tags":["c++","windows","winapi","registry"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13187339,"title":"Access Guest account System Registry hive from a service application","body":"<p>I need to modify settings of a user-mode program from a local service application using C++ and WinAPIs. With most user accounts, I can access them by reading the following registry keys:</p>\n\n<blockquote>\n  <p>HKEY_USERS\\ [UserSID] \\Software</p>\n</blockquote>\n\n<p>But I can't seem to find a user hive for a built-in Guest account. Any idea where it's settings are stored in the Registry?</p>\n\n<p>PS. The local service is a 32-bit application.</p>\n"},{"tags":["c++","winapi","hook","window-messages"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":39,"score":0,"question_id":13190390,"title":"How to intercept Sendmessage API","body":"<p>I need to intercept SendMessage API to prevent someone getting text from a particular window by sending WM_GETTEXT  . so please suggest me how to do this </p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13190568,"title":"Win32 get the HWND of the object which sent the event from the Window WndProc","body":"<p>I'm unsure how to get the HWND of the control that sent the event from the WndProc of the parent Window. The reason I need the HWND is because some metadata about the control is stored in one of its user-defined slots (information about wrapper function pointers, and such) however after some fiddling it seems I need to filter and dispatch events from the parent window.</p>\n\n<p>ie: the user clicks a button, but the event is sent to WM_COMMAND of the buttons parent Window. How can I get the HWND of the button from here?</p>\n\n<p>Any help is appreciated.</p>\n"},{"tags":["visual-studio-2010","winapi","windows-7","windows-xp","gdi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12792352,"title":"UpdateLayeredWindow and 16bit display color depth","body":"<p>Works fine with 32bit colors.\nWhen switching to 16bit, window that was painted with UpdateLayeredWindow gets messed. You can click through and/or colors get changed.</p>\n\n<p>Works bad with my own source code and also with others. For example:\n<a href=\"http://www.codeproject.com/Articles/20758/Alpha-Blended-Windows-Forms\" rel=\"nofollow\">http://www.codeproject.com/Articles/20758/Alpha-Blended-Windows-Forms</a></p>\n\n<p>Tested on Windows7 and XP.</p>\n\n<p>How to rid of this behaviour. Is there any workaround?</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13187453,"title":"Load window icon dynamically","body":"<p>When registering a window class <code>WNDCLASSEX wcex</code>, I use <code>wcex.hIcon = LoadIcon( hInstance, (LPCTSTR) IDI_APPLICATION )</code> to set the icon of the window.</p>\n\n<p>Is there a way to dynamically load the icon from a file for registering the window?\nSomething like <code>LoadIcon ( hInstance, \"iconfile.ico\" )</code> or may be create the Icon Resource using the file.</p>\n"},{"tags":["windows","winapi","windows-8","winrt","winapp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":32,"score":-2,"question_id":13186465,"title":"Windows 8 equivalent for windows phone marketplacesearchtask","body":"<p>Does anyone know if there is an equivalent of the <code>MarketplaceSearchTask</code> of window phone for <code>Windows 8</code>? <BR>\nI'm going to launch a series of applications onto the windows 8 marketplace and I would like to users could push it somewhere else. Then you would be able link it to the marketplace i.e. to your own account so they could see all your applications.</p>\n\n<p>I've searched for a long time, but I haven't found anything. Does someone here know an answer to it?</p>\n"},{"tags":["c++","winapi","win32gui"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13182325,"title":"change background colour in parent window","body":"<p>I'm very new to win32api programming. I have 3 questions. </p>\n\n<p>how to change the background colour in the parent window. i did it as folows but it dont work</p>\n\n<pre><code>wClass.hbrBackground=(HBRUSH)(RGB(255,255,255));\n</code></pre>\n\n<p>second question is, I use to add text in the window as follows. the text is in bold font and with a background colour. I want the text to be in normal and without background colour.</p>\n\n<pre><code>PAINTSTRUCT ps;\n    HDC hDC;\n    char szBuffer[]=\"Hello, World!\";\n    hDC=BeginPaint(hWnd,&amp;ps);\n    TextOut(hDC,10,10,szBuffer,strlen(szBuffer));\n</code></pre>\n\n<p>third question is how to add group boxes in the parent window. i searched it in the internet but this was discribed how to add group boxes on dialog boxes using resources.\npls some one help me with these isue...</p>\n"},{"tags":["c++","windows","winapi","sid"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13186603,"title":"Get local Windows user name from a SID with C++","body":"<p>If I have a list of Windows account SIDs (strings like \"S-1-5-21-16217043-3088031003-1644254475-1001\") how can I get the name of Windows user accounts from them (stuff like \"John Doe\") using C++ and WinAPIs?</p>\n"},{"tags":["windows","winapi","iocp"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":79,"score":4,"question_id":13178248,"title":"Does an IO completetion port spawn a new thread before or after the completion port has something to report?","body":"<p>I am a bit confused as to what actually happens when an IO completion port completes.</p>\n\n<p>I presume that the Win API allows access to an IOCP queue that somehow is able to queue (or stack) a callback reference with a specific handle (let's say a socket).\nWhen windows receives an interrupt from the NIC, then it at some point gets to the IOCP queue for the NIC and executes the callbacks on its <em>own</em> (IOCP) thread pool. </p>\n\n<p>My question is, is this thread from the thread pool spawned upon the interrupt being received, or is it in fact spawned when the call to the Win API is made, effectively having the thread in a wait state until it is then woken by the IOCP queue?</p>\n\n<p><strong>EDIT:</strong><br>\nI found  this: <a href=\"http://msmvps.com/blogs/luisabreu/archive/2009/06/04/multithreading-i-o-and-the-thread-pool.aspx\" rel=\"nofollow\">http://msmvps.com/blogs/luisabreu/archive/2009/06/04/multithreading-i-o-and-the-thread-pool.aspx</a> where is states: <em>\"Whenever that operation completes, it will queue a packet on that I/O completion port. The port will then proceed and use one of the thread pool’s thread to run the callback you’ve specified.\"</em></p>\n"},{"tags":["winapi","bitmap","save"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13169895,"title":"Win32 How do I save a bitmap to a file","body":"<p>I know this question might have been asked alot but I am having problems with it. Basically my program allows for you to paint on the screen using various pens. I have a case statement for save button all setup, I just don't know how to save a copy of what is painted on the window to My Documents.</p>\n\n<p>Here's some of what I have at the moment:</p>\n\n<pre><code>RECT client;\nGetClientRect(hWnd, &amp;client);\n\nint width = client.right - client.left;\nint hight = client.bottom - client.top;\n\nhdc = BeginPaint(hWnd,&amp;ps);\n\nHDC backDC = CreateCompatibleDC(hdc);\nHBITMAP backbuffer = CreateCompatibleBitmap(hdc, width, hight);\n\nRectangle(backDC, client.left, client.top, client.right, client.bottom);\n\nBitBlt(hdc, 0,0,width,hight, backDC, 0,0,SRCCOPY);\n\nDeleteDC(backDC);\nDeleteObject(backbuffer);\nReleaseDC(hWnd, hdc);\n</code></pre>\n"},{"tags":["database","windows","winapi","extensible-storage-engine"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":10509636,"title":"in ESE, can I use JET_coltypDateTime safely to hold an unsigned 64 bit value?","body":"<p>I'm using ESE on an older OS (JET_VERSION = 0x0501).  I need to store an unsigned 64 int</p>\n\n<p>can I safely cast this int to a JET_coltyDateTime or JET_coltypCurrency?   am I missing anything, does ESE do any kind of conversion/limits on the ranges?</p>\n\n<p>note that for my purposes sorting order doesnt matter unless it somehow messes up the ability to search</p>\n"},{"tags":["c++","visual-studio-2010","winapi","visual-c++","c++11"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":13177696,"title":"Life management of std::function/std::bind (passing a functor as lparam in Windows PostMessage)","body":"<p>This only seems like a Windows question, but the essence of my question is really a C++11 (or MS C++0x TR1). It is about passing <code>std::function</code> objects and their life cycle.</p>\n\n<p>I want to have a generic framework for asynchronous execution via Windows <code>PostMessage</code> API. This is when circumstances forces me to exit from the current message handling and register the task in the message queue.</p>\n\n<p>The framework is working fine with pointers to static function (in <code>WPARAM</code>) and pointer to context (in <code>LPARAM</code>) which contains a 'this' pointer as well as other context.</p>\n\n<p>I want to take it to next level and using the bind and function structure. I'm on Visual Studio 2010 (i.e. <code>std::function</code> exists but TR1).</p>\n\n<p>So far this is what I've:</p>\n\n<p>I'm registering the <code>WM_ASYNC_TASK</code> a by the text book, and my windows procedure (I'm actually using WTL) is working fine. <code>PostMessage</code> works fine, and message will eventually reach <code>onAsyncTask</code> with <code>wparam</code> and <code>lparam</code>, correctly and as expected.</p>\n\n<pre><code>const UINT WM_ASYNC_TASK = RegisterWindowMessage(L\"Async-Task\");\n</code></pre>\n\n<p>I've a <code>CPlugin</code>, which is where I want to send the send the task. I've <code>CHiddenWindow</code> which is the Window implementation that gets the message. I would like the <code>onAsyncTask</code> to forward the function back to <code>CPlugin</code>. <code>hwnd</code> is a handle to the window.</p>\n\n<p>In <code>CPlugin</code> I've:</p>\n\n<pre><code>void CPlugin::ShowMessageBox( void* arg ) {\n    wchar_t* text = (wchar_t*)arg;\n    MessageBox( NULL, text, L\"Title\", MB_OK )\n}\n\nvoid CPlugin::Sender( ) {\n    std::function&lt;void(void*)&gt; f = std::bind( &amp;CPlug::ShowMessagebox, \n                                              this, \n                                              std::placeholders::_1 );\n    PostMessage( hwnd, WM_ASYNC_TASK, (WPARAM)f, (LPARAM)\"Hello!!\" );\n}\n</code></pre>\n\n<p>In CHiddenWindow at the handler of WM_ASYNC_TASK message I've:</p>\n\n<pre><code>void CHiddinWindow::onAsyncTask( WPARAM wparam, LPARAM lparam, /* more arguments */ )\n{\n    std::function&lt;void(void*)&gt; f = (std::function&lt;void(void*)&gt;)wparam;\n    void* arg = lparam;\n    f( arg );\n}\n</code></pre>\n\n<p><b>Questions</b>:</p>\n\n<ol>\n<li>Currently, the compiler complains when I'm trying to cast f to WPARAM, within <code>PostMessage</code> (<code>WPARAM</code> is basically a long).</li>\n<li>I'm OK if I'm taking the address of <code>f</code>: <code>(WPARAM)&amp;f</code>.</li>\n<li>Which raise another question about the life cycle of f. How do I keep it?</li>\n<li>When passing <code>&amp;f</code> (keeping <code>f</code> outside <code>Sender()</code> - not my desire), I'm getting access violation in <code>onAsyncHandler</code>, when trying to dereference <code>f</code>.</li>\n<li>About the life cycle, can I put f under the control of <code>std::shared_ptr</code> somehow?</li>\n<li>There is no real reason to pass the argument to my function (in my case - the text) in wparam. I think there should be a way to have the text part of the <code>std::function</code> object, but fail with the syntax.</li>\n</ol>\n\n<p>As I said, I'm on VS 2010 before variadic templates. Microsoft has TR1 implementation of C++0x. I'm looking for a solution that doesn't include boost as it isn't available for me right now.</p>\n\n<p>Thank you!</p>\n"},{"tags":["windows","performance","winapi","delay","clock"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13183350,"title":"So is Sleep() and this the same?","body":"<p>So, are these two the same?\nUsing delay CPU usage is crazy in task manager.. is this the same case as the System Idle Process?</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;time.h&gt;\n//#include &lt;windows.h&gt;\n\nint delay(long int time)\n{\n    clock_t beginning = clock();\n    while(clock() - beginning &lt; time) {}\n    return 0;\n}\n\nint main()\n{\n    clock_t beginning = clock();\n\n    begin:\n\n    std::cout &lt;&lt; \"delay this by 1000ms\\n\";\n\n    //Sleep(1000);\n    delay(1000);\n\n    goto begin; //i know, i know\n\n    return 0;\n}\n</code></pre>\n"},{"tags":["c++","winapi","jpeg","win32gui"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":62,"score":-5,"question_id":13180450,"title":"view jpeg image in win32","body":"<p>I'm building a application to store information of peoples. i will give a specific number for a person. so when i enter a number the program should display a small image of the person and then his name, b'day, age ...ect. (im very very new to win 32 API, so i need someones help to build this. im using code blocks, mingw compiler and c++) all the images will be saved in a jpeg format in a folder. they will be 3.2MP or 2MP. i need not to resize the photos. i need to know a very simple way to load the image as folows,</p>\n\n<pre><code>LoadImage(hWnd,\"file.jpeg\",x-position,y-position,width,height);\n</code></pre>\n\n<p>can someone point out me how to do this pls...\nin the internet i was unable to find a good way, they say GDI+, using dll's but i dont understand those methods.</p>\n"},{"tags":["c++","api","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13179327,"title":"open jpeg with win32 api c++","body":"<p>i've a simple dialog created with ResEdit</p>\n\n<pre><code>BOOL CALLBACK AppDlgProc(HWND hDlg, UINT uMsg, WPARAM wParam, LPARAM lParam)\n{\n  switch(uMsg)\n  {\n\n  case WM_INITDIALOG:\n    SetClassLongPtr(hDlg, GCLP_HICON, (long)LoadIcon(0, IDI_APPLICATION));\n    return 1;\n  case WM_COMMAND:\n    switch(wParam)\n    {\n    case IDOK:\n      return 0;\n    case IDCANCEL:\n      EndDialog(hDlg, 0);\n    }\n     switch(wParam)\n            {\n                 case IDC_BUTTON1:\n                    MessageBox(hDlg, \"Hello, World!\", \"Bottone premuto\", MB_OK);\n                break;\n            }\n\n\n  }\n  return 0;\n}\n</code></pre>\n\n<p>i want to know if there's a way to push a button and display a JPG image.</p>\n"},{"tags":["c++","windows","qt","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13172257,"title":"Replace system menu popup on windows","body":"<p>I want to replace the default sys menu(Restore, Move, Size etc.) with my custom entries. The menu I'm talking about can be opened either by clicking left button on window icon or by clicking right button on window title.\nI can remove all the items and populate this menu with my own entries. But if I remove all entries then minimize, maximize and close buttons become inactive. So they depend on those menu items.</p>\n\n<p>I want to have min, max, close buttons working as usual but system menu which contains my own items(like it is done in Windows Media Player).\nI'm using Qt, but I'm almost sure it can't be done with it so any solution would be appreciated.</p>\n"},{"tags":["c","winapi","windows-8"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":253,"score":3,"question_id":12076140,"title":"Can't set clock using SetSystemTime on Windows 8","body":"<p>My app uses <code>SetSystemTime()</code> to set the PC clock from a GPS source.  This works fine in Windows 7 with User Account Control disabled, but in Windows 8, even with UAC disabled, it fails.  The error I get back is <code>ERROR_PRIVILEGE_NOT_HELD</code>.  The user logged into the machine is in the Administrators group.  I can only get it to work if I run the application as \"Run as Administrator\" from the file's context menu in Explorer - but the logged-in user IS an Administrator.</p>\n\n<p>So... what do I need to do differently on Windows 8 to get <code>SetSysytemTime()</code> to work?  Do I need even more elevated privileges than the current users' Administrator rights?  If so, what has higher privileges than Administrator?  Or do I need to set the user account up differently to allow these kinds of calls to work on Windows 8?</p>\n\n<p>EDIT: As noted in the comments, manually attempting to enable the <code>SE_SYSTEMTIME_NAME</code> privilege doesn't work.  Neither does trying to add the privilege using the suggested MSDN method of <code>LsaAddAccountRights</code>.</p>\n"},{"tags":["c#","wpf","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13172282,"title":"How to hide a combo box in an externally controlled application","body":"<p>I have an application A (.NET/WPF), which controls application B via WinAPI calls.</p>\n\n<p>According to the requirements, application A must always be the topmost window. This means that</p>\n\n<ul>\n<li>if the window of application A is located at the same position as the window of application B,</li>\n<li>then the window of application A should be visible, and</li>\n<li>the window of application B must not be visible.</li>\n</ul>\n\n<p>This requirement is satisfied in all cases except one. When application A programmatically selects an element from a combo box in application B, that combo box becomes visible for a moment. After an element is selected, it is hidden again.</p>\n\n<p>But the combo box being visible (even for a few moments) is a violation of the requirements.</p>\n\n<p>How can I make sure that the window of appliation A is <strong>always</strong> the topmost window (even during selection of a combo box item) ?</p>\n\n<p>Note: Application A takes back focus (activates itself) every 200 milliseconds. I tried to reduce that interval to 100 milliseconds, but it didn't help.</p>\n\n<p><strong>Update 1:</strong> The combo box item is selected using following WinAPI calls.</p>\n\n<pre><code>SendMessage(Self.MyFlightComboBox, CB_SHOWDROPDOWN, WPARAM(true), 0);\n\nItemIndex := SendMessage(Self.MyFlightComboBox, CB_FINDSTRING, -1, integer(@MyValue[1]));\n\nOutputDebugString(PChar('ItemIndex: ' + IntToStr(ItemIndex)));\n\n\nSendMessage(Self.MyFlightComboBox, CB_SETCURSEL, ItemIndex, 0);\nSendMessage(Self.MyFlightComboBox, CN_COMMAND, MakeWParam(0, CBN_SELCHANGE), 0);\n\n\nSendMessage(Self.MyFlightComboBox, WM_LBUTTONDOWN, 0, -1);\nSendMessage(Self.MyFlightComboBox, WM_LBUTTONUP, 0, -1);\n</code></pre>\n"},{"tags":["c++","windows","winapi","dialog"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13175424,"title":"How to hide my current window,when i click the ok button using C++ win32 API?","body":"<p>i am using C++ win32  API...</p>\n\n<p>i have a window(dialogbox),that windows has some buttons...</p>\n\n<p>if,i enter one of the OK button,one messagebox will appear...</p>\n\n<p>at that time,i want to hide the background window(Dialogbox)...</p>\n\n<p>How to i achieve that?</p>\n"},{"tags":["c++","winapi","mingw"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":114,"score":4,"question_id":10697633,"title":"Interlocked Singly Linked Lists (SList) with MinGW","body":"<p>When I try to port my Win32 code from Microsoft toolchain to MinGW, most code compiles fine, but there are few exceptions. One particular API which seems to be missing in MinGW is <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms684121%28v=vs.85%29.aspx\" rel=\"nofollow\">SList API</a> (including InitializeSListHead, InterlockedPushEntrySList) - when I compile my sources, I get error about those functions being not defined. What can I do to have this \nAPI available under MinGW? Is there some Win32 SDK I could update, or something like that?</p>\n"},{"tags":["c++","windows","winapi","dialog"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13172187,"title":"How to use IWinLogon in static function using c++ win32 API?","body":"<p>i am using C++ win32 API...</p>\n\n<p>i have use <code>IWinLogon*-&gt;wlxmessagebox</code> in  a function...</p>\n\n<p>But that function make a static function,<code>IWinLogon*</code> identifier can't work.</p>\n\n<pre><code>_pWinLogon-&gt;wlxMessageBox(hDlg,(LPCWSTR)msg1,TEXT(\"Logon Message\"), MB_OKCANCEL| MB_ICONWARNING);\nit gives \nerror C2227: left of '-&gt;wlxMessageBox' must point to class/struct/union/generic type\n</code></pre>\n\n<p>if i am using non static function,it works...but i want that in a static function?</p>\n\n<p>how can i achieve this?</p>\n"},{"tags":["c++","windows","winapi","dialog"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13171488,"title":"How to display dialogboxparam dialog through the Messagebox ButtonClick?","body":"<p>i have using C++ win32 API.</p>\n\n<p>i already craeate a dialogbox within a dialogbox using dailogboxparam function in bb class...</p>\n\n<pre><code>INT_PTR bb::DialogProc(UINT msg, WPARAM wp, LPARAM lp)\n {\n//some case and...\n\ncase IDC_OK:\nDialogBoxParam(hInst,MAKEINTRESOURCE(IDD_DIALOG),_hwnd,myfunctionDlgProc,lp);\nbreak;\n}\n\nint CALLBACK bb::myfunctionDlgProc(HWND hDlg,UINT msg,WPARAM  wp, LPARAM lParam)\n{\n\n//some code...\n}\n</code></pre>\n\n<p>when i press the OK button in dialogbox...it shows myfunctionDlgProc Dialogbox...</p>\n\n<p>Now,i want the same thing in my other aa class,now i am using messagebox..it have 2 buttons OK and Cancel...</p>\n\n<p>if when i press messagebox ok button,i want to show the myfunctionDlgProc Dialogbox...</p>\n\n<pre><code>    int retun;\n\n        retun = MessageBox(hDlg,(LPCWSTR)\"\",TEXT(\"Logon Message\"), MB_OKCANCEL| MB_ICONWARNING);\n\n        if(retun=1)\n       {\nDialogBoxParam(hInst,MAKEINTRESOURCE(IDD_DIALOG),_hwnd,myfunctionDlgProc ,lp);\n        }\n</code></pre>\n\n<p>i try it...but how to i pass the <code>lp</code> value in this code...</p>\n\n<p><code>DialogBoxParam(hInst,MAKEINTRESOURCE(IDD_DIALOG),_hwnd,myfunctionDlgProc,lp);</code></p>\n\n<p>Did u get my issue?</p>\n\n<p>How can i achieve this?</p>\n"},{"tags":["winapi","visual-c++"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":9360908,"title":"Getting windows login information from the client system","body":"<p>I have no idea and i am stuck up in this issue. </p>\n\n<p>Is there any way of collecting the login information of a user in a client system? </p>\n\n<p>In a client system a snippet which works as a console application and that should gather login and logout information of the user, and stores it in a file which can be accessed and stored in the server database. I am trying out with Visual c++ 2010. I have idea where should i start and what way i should follow. Can any one guide me in the way that i complete the process.</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":482,"score":2,"question_id":7538883,"title":"Multiple WndProc functions in Win32","body":"<p>This might be a dumb question, but can you register multiple WndProc functions in Win32? e.g. a framework catches some messages and my app is interested in other ones - how do I catch them without modifying the framework code?</p>\n"},{"tags":["c++","winapi","visual-c++","console","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13168298,"title":"Have a user close a process' allocated console without exiting the process?","body":"<p>Using the Win32 API in Visual C++, I want to create a program under the Windows subsystem that allocates a console with <code>AllocConsole</code> and writes to it with <code>WriteConsole</code>. However, if the user closes the console, the process should keep running in the background. As it stands, I can't get that to happen. When X is pressed on the console title bar, the process exits.</p>\n\n<p>Is there any particular way of doing this?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["delphi","winapi","unicode","delphi-xe2","ansi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":13168169,"title":"winapinameA vs winapinameW - Unicode vs Ansi - Delphi XE2","body":"<p>I am using Delphi XE2 and importing SHGetFolderPath from Shell32.dll. I am running windows vista x64. When running SHGetFolderPathA The result is unclear.</p>\n\n<p>I.E.:</p>\n\n<pre><code>uses\n  Windows;\n\nfunction SHGetFolderPath(hwnd: Cardinal; csidl: Integer; hToken: Cardinal; dwFlags: Cardinal; pszPath: PChar): Cardinal; stdcall;external 'Shell32.dll' name 'SHGetFolderPathA';\n\nVar\n  Path:Array [0..MAX_PATH] of Char;\n  AppData:String;\n\nbegin\n  SHGetFolderPath(0,$001A,0,0,@path[0]);\n  MessageBox(0,Path,'a',0);\nend.\n</code></pre>\n\n<p>The result is:</p>\n\n<p><img src=\"http://i.stack.imgur.com/jN0qA.png\" alt=\"enter image description here\"></p>\n\n<p>Versus using SHGetFolderPathW:</p>\n\n<p>uses\n      Windows;</p>\n\n<pre><code>function SHGetFolderPath(hwnd: Cardinal; csidl: Integer; hToken: Cardinal; dwFlags: Cardinal; pszPath: PChar): Cardinal; stdcall;external 'Shell32.dll' name 'SHGetFolderPathW';\n\nVar\n  Path:Array [0..MAX_PATH] of Char;\n  AppData:String;\n\nbegin\n  SHGetFolderPath(0,$001A,0,0,@path[0]);\n  MessageBox(0,Path,'a',0);\nend.\n</code></pre>\n\n<p>The result clearly states the path to my AppData folder with no issue.</p>\n\n<p>When running this same code on x32 Vista when using SHGetFolderPathA works just fine.</p>\n\n<p>If someone could shine some light on why this is? I was under the impression the \"W\" api was usually for use on Unicode machines...?</p>\n\n<hr>\n\n<p>Edit:</p>\n\n<p>I am now using the following code, with the same error:</p>\n\n<pre><code>uses\n  Windows;\n\nfunction SHGetFolderPath(hwnd: HWND; csidl: Integer; hToken: THandle; dwFlags: DWord; pszPath: PAnsiChar): HRESULT; stdcall; external 'SHFolder.dll' name 'SHGetFolderPathA';\n\nvar\n  path: array[0..MAX_PATH] of char;\nbegin\n  SHGetFolderPath(0,$001A,0,0, @path[0]);\n  MessageBox(0,path,'a',0);\nend.\n</code></pre>\n\n<hr>\n\n<p>Final Edit:</p>\n\n<p>Thank you all for the responses. The above declaration of SHGetFolderPath is fine. After looking through all responses, and taking in the information in each, I have come up with the following result:</p>\n\n<pre><code>uses\n  Windows;\n\nfunction SHGetFolderPath(hwnd: HWND; csidl: Integer; hToken: THandle; dwFlags: DWord; pszPath: PAnsiChar): HRESULT; stdcall; external 'shell32.dll' name 'SHGetFolderPathA';\n\nvar\n  path: array[0..MAX_PATH] of ansichar;\n  xRes:String;\nbegin\n  If SHGetFolderPath(0,$001A,0,0, @path[0]) = S_OK Then Begin\n    xRes := Path;\n    MessageBox(0,PWideChar(xRes),'Result',0);\n  End Else\n    MessageBox(0,'An error has occurred.','Result',0);\nend.\n</code></pre>\n\n<p>The resulting messagebox correctly displays the path to my AppData path.</p>\n\n<p>Thanks again for all of the responses.</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13168589,"title":"Win32: Add text to a specifed region of the window","body":"<p>I wish for my program to take the coordinates of the window on click, then allow for text to be typed onto the screen. I have searched around but cannot find any tutorials on this, can anyone help?</p>\n\n<p>Thanks</p>\n\n<p>The problem is: storing the text typed by the user. What should I place in WM_CASE? I figure it's being called every time a key is pressed, however I need to read whatever key is pressed and add it onto a string. Every time another key is pressed it will be added to the end of the string untill the user hits 'ENTER' then the string will be completed and the text will be placed onto the screen using TextOut(backDC, Xcor, yCor, storedText, Length);</p>\n"},{"tags":["c++","debugging","winapi","vc6"],"answer_count":6,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":2880,"score":5,"question_id":451749,"title":"Is there a TRACE statement for basic win32 C++?","body":"<p>In MFC C++ (Visual Studio 6) I am used to using the TRACE macro for debugging.  Is there an equivalent statement for plain win32?</p>\n"},{"tags":["c++","winapi","logoff"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13168289,"title":"Do I need SE_SHUTDOWN_NAME privilege to log off a user?","body":"<p>I need to log off a user from a C++ program. I use <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa376868%28v=vs.85%29.aspx\" rel=\"nofollow\">ExitWindowsEx</a> API for that, but I'm not sure from the documentation if I need any special privileges for that?</p>\n"},{"tags":["winapi","return-code","openprocess"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13167063,"title":"how GetExitCodeProcess get exit code when the process is not there anymore","body":"<p>I first get handle to a process by using OpenProcess.\nThen I call GetExitCodeProcess in a loop to see if the process is running.\nBut how does GetExitCodeProcess get exit code? Does Windows store exit code of all processes that ran in the past 30 minute or something?\nAs soon as the application exits, any information regarding the process is wiped out from Windows.\nI don't know how GetExitCodeProcess can get exit code of something that no longer exists...</p>\n"},{"tags":["windows","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13166670,"title":"Who is allowed to write to an allocated address?","body":"<p>I am using VirtualAllocEx in Delphi to reserve memory in a foreign process like this:</p>\n\n<pre><code>var\n p : pointer;\nbegin\n p := VirtualAllocEx(Process, nil, SizeOf(Integer), MEM_COMMIT or MEM_RESERVE, PAGE_EXECUTE_READWRITE);\nend;\n</code></pre>\n\n<p>The ProcessHandle has been opened with <code>PROCESS_ALL_ACCESS</code> before.</p>\n\n<p>After that my program writes a simple integer value to the allocated address like this:</p>\n\n<pre><code>WriteProcessMemory(Process, p, @MyInteger, SizeOf(Integer), BytesWritten);\n</code></pre>\n\n<p>Since the address is stored in <code>p</code> - I can save the address to use it for another application. The other application has to open the foreign process again to access/write the address in the foreign process.</p>\n\n<p>My question is now: Who/What can read/write to this address in the foreign procces?</p>\n\n<p>Is every process allowed to write?\nIs every process allowed to read?\nDo only have processes with admin rights the right to read/write?</p>\n\n<p>Thanks for your answer.</p>\n"},{"tags":["c#","winapi","registry"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":69,"score":0,"question_id":13166234,"title":"C# RegistryKey.GetValue doesn't return blank lines","body":"<p>So I'm writing some code and using <code>RegistryKey.GetValue</code> and I can't seem to get it to return the proper string array.  I would use RegSaveKeyEx except I need to change the location of where the keys are being saved to in the reg file I'm creating.</p>\n\n<p>The MultiString I'm querying has two lines in it, <code>:</code> and a blank line.  Regedit gives <code>hex(7):3a,00,00,00,00,00</code> for the reg file export of said value.  This is correct.  3a would be <code>:</code>, then a null, two nulls for the blank line and finally two more nulls to signify the end of the value.  My code is giving <code>hex(7):3a,00,00,00</code>, which would be a <code>:</code> and the double-null EOL characters on a MultiString.  When imported back into the registry <code>hex(7):3a,00,00,00</code> is only a <code>:</code>, the blank line is missing.</p>\n\n<p>If I import <code>hex(7):3a,00,00,00,00,00</code> then view the value in regedit, I see <code>:</code> and a blank line. This is correct and this is what I want my code to do.</p>\n\n<p>When I query this value with <code>RegistryKey.GetValue</code> in C# 4.0 I get the a <code>string[]</code> with just one element, the <code>:</code>.</p>\n\n<p>For other MultiString values I get an array containing an element for every line, as I would expect.</p>\n\n<p><code>RegistryKey.GetValue</code> doesn't return anything for the blank line.  It doesn't return a null, a blank string in the array, nothing.</p>\n\n<p>On everything except blank lines it returns exactly the same result as regedit export.  What needs to be changed to have it return an array that includes the blank line?</p>\n\n<p>Here's my code if that's helpful:</p>\n\n<pre><code>private static string RegMultiStringExtraction(RegistryKey UsersSubKey, string Key)\n    {\n        string[] InputStrs = (string[])UsersSubKey.GetValue(Key, Environment.NewLine, RegistryValueOptions.DoNotExpandEnvironmentNames);\n        StringBuilder sb = new StringBuilder();\n        foreach (string str in InputStrs)\n        {\n            char[] Values = str.ToCharArray();\n            foreach (char letter in Values)\n            {\n                int ValueInt = Convert.ToInt32(letter);\n                sb.Append(ValueInt.ToString(\"x\"));\n                sb.Append(\",00,\");\n                if (Values.Length == 0)\n                {\n                    if (sb.Length == 0)\n                    {\n                        sb.Append(\"00,\");\n                    }\n                    else if (sb.Length &gt; 1)\n                    {\n                        sb.Append(\",00,\");\n                    }\n                }\n            }\n            sb.Append(\"00,00,\");\n        }\n\n        string Value = ('\"' + Key.ToString() + @\"\"\"=\" + \"hex(7):\" + sb.ToString().TrimEnd(','));\n        return Value;\n    }\n</code></pre>\n"},{"tags":["winapi","alternate-data-stream"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13065133,"title":"How can I know whether a particular file on a Windows machine supports Alternate Data Streams?","body":"<p>Using the raw Windows programming API from C/C++ and a file handle or a path to a file, folder, link, etc; how can I programmatically decide whether the file (etc) supports <code>ADS</code> (Alternate Data Streams)?</p>\n\n<p>I assume one thing I have to know is whether the file is on an NTFS partition, but then again for all I know it might be possible to mount some kind of Mac or *nix filesystems which support data forks or alternate data streams of some kind, and all such cases might be covered by a single API call or data structure.</p>\n\n<p>Secondly I'm not sure whether every kind of object that can exist on an NTFS partition can have ADSs - such as folders, symlinks, hardlinks, anything else?</p>\n\n<p>What API etc can handle all cases to tell me whether a given file etc has the ability to have ADSs?</p>\n\n<p>(For this question I'm not looking for whether files <em>have</em> ADSs, just whether its possible for files to have them. It could include a file I've just created for instance.)</p>\n"},{"tags":["c#","windows","security","winapi","windows-authentication"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12950089,"title":"Why does LogonUser always return error code 1008?","body":"<p>I'm using LogonUserA function to authenticate user in a ASP.NET 4.0 web application that running on IIS7/Win2008. It works well if user enters correct user name and password, but in case user name or password is wrong, LogonUserA always return a same error code 1008 that translate to a vague message \"An attempt was made to reference a token that does not exist\". Of course if LogonUserA failed then there'll be no valid token, so what does this error mean? Is there any specific error code for typical login errors? and how can I get it?</p>\n\n<p>Below is my code:</p>\n\n<pre><code>[DllImport(\"advapi32.dll\", SetLastError = true)]\npublic static extern int LogonUserA(string lpszUserName,\n    string lpszDomain,\n    string lpszPassword,\n    int dwLogonType,\n    int dwLogonProvider,\n    ref IntPtr phToken);\n\nif (0 != LogonUserA(userName, domain, newPassword, Logon32LogonInteractive, Logon32ProviderDefault, ref token))\n{\n    // error is always 1008 if user name of password is incorrect.\n    int error = Marshal.GetLastWin32Error();\n\n    var exception = new Win32Exception(error);\n\n    // What I got in error log for above Win32Exception is:\n    // System.ComponentModel.Win32Exception (0x80004005): An attempt was made to reference a token that does not exist\n}\n</code></pre>\n"},{"tags":["c++","winapi","hook"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13165501,"title":"Windows Global Hook C++","body":"<p>i've been reading posts all over and trying different approaches, but i cant make this work.</p>\n\n<p>I want to be able to track the last window before the user clicks on my application. This way i can bring it to the front and send a copy command to retrieve whatever the user has selected.</p>\n\n<p>I thought about using hooks to receive notifications of activated windows, but it is not working as expected. Im using <strong>HSHELL_WINDOWACTIVATED</strong> global hook to keep track of the current and last active window, but i always get both handles to be the same, pointing to my application.</p>\n\n<p>The code looks like:</p>\n\n<pre><code>#pragma data_seg(\"ASEG\")  \n  HWND lastWindow = 0;\n  HWND currentWindow = 0;\n#pragma data_seg()  \n#pragma comment(linker, \"/section:ASEG,RWS\") \n\nHINSTANCE dllHandle;  \n\nBOOL APIENTRY DllMain(    \n         HINSTANCE hinstDLL,  \n         DWORD fdwReason,  \n         PVOID lpReserved )  \n{ \n    switch( fdwReason )  \n    {  \n    case DLL_PROCESS_ATTACH:    \n        dllHandle = hinstDLL;    \n        return TRUE;  \n        break;  \n    }  \n}  \n\nLRESULT CALLBACK ShellHookProc(int nCode, WPARAM wParam, LPARAM lParam)   \n{  \n    if (nCode &gt; 0)\n    {\n        switch (nCode)\n        {\n        case HSHELL_WINDOWACTIVATED: lastWindow = currentWindow;\n                         currentWindow = (HWND)wParam;\n                         break;\n        }\n    }\n\n    return ::CallNextHookEx(NULL, nCode,wParam,lParam);\n}\n\nextern \"C\" {\n\n__declspec(dllexport) void Init()\n{   \n    SetWindowsHookEx(WH_SHELL, ShellHookProc, dllHandle, 0);    \n}\n\n}\n</code></pre>\n\n<p>Later on i would use the lastWindow to bring that window to the front and send a Ctrl+C command.</p>\n\n<p>If you call GetWindowTextA(..) for each handle, the first time you activate a diferent window and go back to the application, lastWindow retrieves blank and currentWindow my application name. Any consecutive activations retrieve always the name of my application for both lastWindow and currentWindow. \nI dont quite understand why this is happening. Any ideas?</p>\n\n<p>Thanks!</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13163954,"title":"SS_NOTIFY and WM_SETCURSOR","body":"<p>I'm trying to imitate a hyperlink on a dialog using C++.</p>\n\n<p>I'm using a static control with SS_NOTIFY set so that a user can click the control and go to a webpage:</p>\n\n<pre><code> LTEXT           \"Caption2\",IDC_SETTINGS,9,36,219,13,SS_NOTIFY\n</code></pre>\n\n<p>With SS_NOTIFY set I can intercept the click, as it's registered against the static:</p>\n\n<pre><code>case IDC_STC_URL:\nShellExecute(NULL, \"open\", \"http://google.co.uk\", NULL, NULL, SW_SHOWNORMAL);\nreturn TRUE;\n</code></pre>\n\n<p>I'm also changing the cursor to a hand by intercepting the WM_SETCURSOR message:</p>\n\n<pre><code>case WM_SETCURSOR:\nPOINT pt;\nRECT rect;\n\nGetCursorPos( &amp;pt );\nGetWindowRect( GetDlgItem(hwnd,IDC_SETTINGS), &amp;rect );\n\nif (PtInRect(&amp;rect, pt))\n{\n    SetCursor(LoadCursor(NULL, IDC_HAND));\n}\nelse\n{\n    SetCursor(LoadCursor(NULL, IDC_ARROW));\n}\nreturn TRUE;\n</code></pre>\n\n<p>However, when SS_NOTIFY is set the cursor change doesn't work. When SS_NOTIFY is disabeled it does. But then the click isn't registered against the static so ShellExecute() doesn't get to open the URL.</p>\n\n<p>Does anyone have a suggestion as to what I'm doing wrong?</p>\n\n<p>thanks,\nofer.</p>\n"},{"tags":["winapi","gdi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13158759,"title":"How to re-size the client area when double buffering?","body":"<p>Given I implement double buffering in GDI:</p>\n\n<pre><code>static HDC hdc;\nstatic HDC backDC;\nstatic HBITMAP backBuffer;\nstatic HGDIOBJ oldBitmap;\nstatic RECT client;\n\ncase WM_CREATE:     \n     hdc=GetDC(hWnd);\n    GetClientRect(hWnd, &amp;client);\n    backDC=CreateCompatibleDC(hdc);         \n    backBuffer=CreateCompatibleBitmap(hdc,client.right,client.bottom);\n    oldBitmap=SelectObject(backDC,backBuffer);\n    ReleaseDC(hWnd,hdc);\n\ncase WM_PAINT:\n\n\nRectangle(backDC, 0, 0,client.right,client.bottom); // displays rectangle the\n size of client to draw on it\n      hdc = BeginPaint(hWnd, &amp;ps);  \n      BitBlt(hdc,0,0,client.right,client.bottom,backDC,0,0,SRCCOPY);\n    // TODO: Add any drawing code here...\n       EndPaint(hWnd, &amp;ps);\n</code></pre>\n\n<p>How do I handle the resize ? One thing I have tried to do is</p>\n\n<pre><code>case WM_SIZE:   \nclient.right=LOWORD(lParam);\nclient.bottom=HIWORD(lParam);\n    SendMessage(hWnd,WM_CREATE,NULL,NULL);\n</code></pre>\n\n<p>What it does is, once I get resize message with new client coordinates it sends message to WM_CREATE and it actually works.... HOWEVER ! It creates massive leak, because I basically create a new bitmap every time without destroying it. Can someone tell me if there is a better way to do it ? Thx</p>\n"},{"tags":["c++",".net","winapi","server-administration"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13163039,"title":"Is there the way to programmatically change Windows Server password ignoring Local Password Policy using Admin account?","body":"<p>I have Admin account and want to change password for a specific user on a local Windows Server 2008 machine. Is there possibility to programmatically change the password ignoring Local Password Policy (complexity, history, minimum password age)?</p>\n\n<p>I tried NetUserChnagePassword but it does not allow to ignore Password Policy.</p>\n"},{"tags":["c++","c","winapi","datetime"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":13123322,"title":"What does a negative dwLowDateTime mean in the FILETIME structure?","body":"<p>I know that <code>FILETIME</code> structure formed datetime value in 100 nanosecond step from 1st of Jan 1601. But what does mean <code>dwLowDateTime</code>'s value that less then 0???</p>\n"},{"tags":[".net","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12803024,"title":"Calling SetParent stops a form using the modern window colours","body":"<p>I call these User32.DLL API calls to embed a windows forms form as a child window of another window...</p>\n\n<pre><code>SetWindowLong(frm.Handle.ToInt32, GWL_STYLE, WS_CHILD Or WS_DLGFRAME Or WS_BORDER)\nSetParent(frm.Handle.ToInt32, m_intOldParent)\n</code></pre>\n\n<p>I've noticed in windows 8 that the style of these windows that have had SetParent called look a bit odd, they seem to be using the old SystemColors.ActiveCaption and SystemColors.ActiveCaptionGradient colours to display the Titlebar and not the new Windows 8 colour.</p>\n\n<p>This makes my child windows look a bit odd.</p>\n\n<p>Anyone any ideas how I can get the windows 8 style in my child windows?</p>\n\n<p>NOTE: Think it's also the same in windows 7 too.</p>\n\n<p>Many thanks</p>\n"},{"tags":["c++","c","string","winapi"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":77,"score":-1,"question_id":13157276,"title":"using wsprintf with malloc","body":"<p>Is there any mistake to write a code such:</p>\n\n<pre><code>char* sp=(char*)malloc(128);\nint x=22;\n\nwsprintf(sp,\"%d\",x);\ncout&lt;&lt;sp;\n</code></pre>\n\n<p>I am asking specially about security mistakes?</p>\n"},{"tags":["c#","winapi","shell","localization","globalization"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":68,"score":2,"question_id":13151623,"title":"How to get the localized special folder name?","body":"<p>I use <code>SHGetFileInfo()</code> or <code>GetDisplayNameOf()</code> to get the name of a special folder.</p>\n\n<p>If a localized operating system to change the setting \"Current language for non-Unicode programs\", these functions return a value \"??? ?????????\". </p>\n\n<p>This combination of settings encountered by users.</p>\n\n<p>shell32 is not fully unicode compatible?</p>\n\n<pre><code>Shell32.STRRET STRRET;\nSTRRET.uType = (uint)Shell32.STRRET_TYPE.STRRET_WSTR;\nif (Windows.S_OK != ishellfolder_parent.GetDisplayNameOf(ptr_pidllast, (uint)Shell32.SHGNO.SHGDN_NORMAL | (uint)Shell32.SHGNO.SHGDN_INFOLDER, out STRRET))\n                return null;\n\nStringBuilder sbuilder = new StringBuilder(260);\nShell32.StrRetToBuf(ref STRRET, ptr_pidllast, sbuilder, (uint)sbuilder.Capacity);\n</code></pre>\n\n<p>what is wrong?</p>\n\n<p>***added later\nAnother example to demonstrate my question:</p>\n\n<pre><code>public static partial class Program\n{\n    const Int32 CSIDL_DESKTOP = (0x0000);\n    const uint SHGFI_DISPLAYNAME = 0x000000200;     // get display name\n    const uint SHGFI_PIDL = 0x000000008;     // pszPath is a pidl\n\n    [StructLayout(LayoutKind.Sequential)]\n    public struct SHFILEINFO\n    {\n        public static int NAMESIZE = 80;\n        public IntPtr hIcon;\n        public int iIcon;\n        public uint dwAttributes;\n        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 260)]\n        public string szDisplayName;\n        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 80)]\n        public string szTypeName;\n    };\n\n    [DllImport(\"shell32.dll\")]\n    static extern IntPtr SHGetFileInfo(IntPtr pidl, uint dwFileAttributes, ref SHFILEINFO psfi, uint cbFileInfo, uint uFlags);\n    [DllImport(\"shell32.dll\")]\n    public static extern IntPtr SHCloneSpecialIDList(IntPtr hwnd, Int32 CSIDL, bool create);\n\n\n    [STAThread]\n    static void Main(string[] args)\n    {\n        IntPtr pidl = SHCloneSpecialIDList(IntPtr.Zero, CSIDL_DESKTOP, false);\n        SHFILEINFO shfi = new SHFILEINFO();\n        if (IntPtr.Zero != SHGetFileInfo(\n                    pidl,\n                    0,\n                    ref shfi,\n                    (uint)Marshal.SizeOf(typeof(SHFILEINFO)),\n                    SHGFI_PIDL | SHGFI_DISPLAYNAME))\n        {\n            System.Windows.Forms.MessageBox.Show(shfi.szDisplayName);\n        }\n</code></pre>\n\n<p>This code not correct. Some cases wrong return values, described above.\nCan anyone help me with an example of the correct code, fully compatible with Unicode and works with non-default system settings?</p>\n\n<hr>\n\n<p>Thank you all! After some experiments, and found a solution. My error was here:</p>\n\n<pre><code>Shell32.StrRetToBuf(ref STRRET, ptr_pidllast, sbuilder, (uint)sbuilder.Capacity);\n</code></pre>\n\n<p>The signature should be:</p>\n\n<pre><code>[DllImport(\"shlwapi.dll\", CharSet=CharSet.Unicode, EntryPoint=\"StrRetToBufW\")]\npublic static extern Int32 StrRetToBufW( ...\n</code></pre>\n"},{"tags":["c++","winapi","pointers","casting","struct"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13154292,"title":"CPP, WinAPI - WM_CREATE proper way to get CREATESTRUCT* from lParam","body":"<p>A certain tutorial for the Win32 API uses this line to transform the <code>lParam</code> argument from a <code>WM_CREATE</code> message in the main window procedure into a <code>CREATESTRUCT*</code>:</p>\n\n<pre><code>reinterpret_cast&lt;CREATESTRUCT*&gt;(lParam)  // Method 1\n</code></pre>\n\n<p>I've read elsewhere that <code>reinterpret_cast</code> is dangerous and results in undefined behavior, lightning bolts, and whatnot.</p>\n\n<hr>\n\n<p>I've used a more conventional cast which the compiler doesn't complain about:</p>\n\n<pre><code>(CREATESTRUCT*) lParam // Method 2\n</code></pre>\n\n<p>Is there a reason the author of the tutorial did it their way?  </p>\n\n<p>And, I'm sure there's a better way than mine?</p>\n"},{"tags":["c++","windows","winapi","gdi+","gdi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13151956,"title":"GDI+ initialization crashes the app, why?","body":"<p>I have the following C++ line that obtains the GDI+ handle out of GDI's device context:</p>\n\n<pre><code>//HDC hDC = device context from GDI\nif(hDC)\n{\n    //Obtain graphics handle for GDI++\n    Graphics* pgrpx = new Graphics(hDC);    //I get invalid memory exception here\n\n    //Code continues\n    //...\n\n    //Free object\n    delete pgrpx;\n    pgrpx = NULL;\n}\n</code></pre>\n\n<p>It works just fine in my tests.</p>\n\n<p>But recently I received a crash dump for the app, with the \"thread referenced memory location that it has no access to\" exception at the line I pointed above in the code -- right where the Graphics object is supposed to be initialized.</p>\n\n<p>What could be the issue here? And how to address it?</p>\n"},{"tags":["c++","winapi","visual-c++","console","stdin"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":13074435,"title":"Getting line input from a AllocConsole C++","body":"<p>A team member added the <a href=\"http://dslweb.nwnexus.com/~ast/dload/guicon.htm\" rel=\"nofollow\" title=\"Adding Console I/O to a Win32 GUI App\">following code</a> to our GUI Ogre project to add a console (so that we are able to see cout as we are debugging...</p>\n\n<p>We are now running way behind time, and we need text interaction with the game, I was going to make a console, but it is plausibly a big time hole... So I thought hey! Why not use the console he attached!! unfortunatly, I was inable to type into it when I attempted, thus I wouldn't be able to send a command to the console :\\</p>\n\n<p>Is there any way to enable writing into the console (atm the way he's done it if you hit any key (as such as 'a') nothing goes into the console, therefore I can't wait for enter and then phase the string typed into the win32 console)</p>\n\n<p>Here's his code (I also added the link encase somone has a rough idea, but they want to read about it again, I don't know the exact guide he followed, but it was very simular)</p>\n\n<pre><code>void showWin32Console()\n{\n    static const WORD MAX_CONSOLE_LINES = 1000;\n    int hConHandle;\n    long lStdHandle;\n    CONSOLE_SCREEN_BUFFER_INFO coninfo;\n    FILE *fp;\n\n    // allocate a console for this app\n    AllocConsole();\n\n    // set the screen buffer to be big enough to let us scroll text\n    GetConsoleScreenBufferInfo(GetStdHandle(STD_OUTPUT_HANDLE), &amp;coninfo);\n    coninfo.dwSize.Y = MAX_CONSOLE_LINES;\n    SetConsoleScreenBufferSize(GetStdHandle(STD_OUTPUT_HANDLE), coninfo.dwSize);\n\n    // redirect unbuffered STDOUT to the console\n    lStdHandle = (long)GetStdHandle(STD_OUTPUT_HANDLE);\n    hConHandle = _open_osfhandle(lStdHandle, _O_TEXT);\n    fp = _fdopen( hConHandle, \"w\" );\n    *stdout = *fp;\n    setvbuf( stdout, NULL, _IONBF, 0 );\n\n    // redirect unbuffered STDIN to the console\n    lStdHandle = (long)GetStdHandle(STD_INPUT_HANDLE);\n    hConHandle = _open_osfhandle(lStdHandle, _O_TEXT);\n    fp = _fdopen( hConHandle, \"r\" );\n    *stdin = *fp;\n    setvbuf( stdin, NULL, _IONBF, 0 );\n\n    // redirect unbuffered STDERR to the console\n    lStdHandle = (long)GetStdHandle(STD_ERROR_HANDLE);\n    hConHandle = _open_osfhandle(lStdHandle, _O_TEXT);\n    fp = _fdopen( hConHandle, \"w\" );\n    *stderr = *fp;\n    setvbuf( stderr, NULL, _IONBF, 0 );\n\n    // make cout, wcout, cin, wcin, wcerr, cerr, wclog and clog\n    // point to console as well\n    std::ios::sync_with_stdio();\n}\n</code></pre>\n"},{"tags":["winapi","antivirus","trojan"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":53,"score":2,"question_id":13144216,"title":"AVG detected my program as a virus. What's wrong here?","body":"<p>AVG says that the executable compiled from the code below is a high priority \"Trojan horse PSW.Agent.AYRW\".  Is something wrong here, or is this just a false alarm?  </p>\n\n<pre><code>#include &lt;windows.h&gt;\n\nconst char g_szClassName[] = \"myWindowClass\";\n\nLRESULT CALLBACK WndProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)\n{\n    switch(msg)\n    {\n        case WM_LBUTTONDOWN:\n        {\n            char szFileName[MAX_PATH];\n            HINSTANCE hInstance = GetModuleHandle(NULL);\n\n            GetModuleFileName(hInstance, szFileName, MAX_PATH);\n            MessageBox(hwnd, szFileName, \"This program is:\", MB_OK | MB_ICONINFORMATION);\n        }\n        break;\n        case WM_CLOSE:\n            DestroyWindow(hwnd);\n        break;\n        case WM_DESTROY:\n            PostQuitMessage(0);\n        break;\n        default:\n            return DefWindowProc(hwnd, msg, wParam, lParam);\n    }\n    return 0;\n}\n\nint WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance,\n    LPSTR lpCmdLine, int nCmdShow)\n{\n    WNDCLASSEX wc;\n    HWND hwnd;\n    MSG Msg;\n\n    wc.cbSize        = sizeof(WNDCLASSEX);\n    wc.style         = 0;\n    wc.lpfnWndProc   = WndProc;\n    wc.cbClsExtra    = 0;\n    wc.cbWndExtra    = 0;\n    wc.hInstance     = hInstance;\n    wc.hIcon         = LoadIcon(NULL, IDI_APPLICATION);\n    wc.hCursor       = LoadCursor(NULL, IDC_ARROW);\n    wc.hbrBackground = (HBRUSH)(COLOR_WINDOW+1);\n    wc.lpszMenuName  = NULL;\n    wc.lpszClassName = g_szClassName;\n    wc.hIconSm       = LoadIcon(NULL, IDI_APPLICATION);\n\n    if(!RegisterClassEx(&amp;wc))\n    {\n        MessageBox(NULL, \"Window Registration Failed!\", \"Error!\",\n            MB_ICONEXCLAMATION | MB_OK);\n        return 0;\n    }\n\n    hwnd = CreateWindowEx(\n        WS_EX_CLIENTEDGE,\n        g_szClassName,\n        \"The title of my window\",\n        WS_OVERLAPPEDWINDOW,\n        CW_USEDEFAULT, CW_USEDEFAULT, 240, 120,\n        NULL, NULL, hInstance, NULL);\n\n    if(hwnd == NULL)\n    {\n        MessageBox(NULL, \"Window Creation Failed!\", \"Error!\",\n            MB_ICONEXCLAMATION | MB_OK);\n        return 0;\n    }\n\n    ShowWindow(hwnd, nCmdShow);\n    UpdateWindow(hwnd);\n\n    while(GetMessage(&amp;Msg, NULL, 0, 0) &gt; 0)\n    {\n        TranslateMessage(&amp;Msg);\n        DispatchMessage(&amp;Msg);\n    }\n    return Msg.wParam;\n}\n</code></pre>\n\n<p>Is this really creating a virus?</p>\n\n<p>Edit:  this is now that much more important because I can't even compile the program to its original location anymore without windows restricting my access.  Grumble... AVG 2012 was so much better.</p>\n"},{"tags":["c++","windows","winapi","registry"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":61,"score":-5,"question_id":13152708,"title":"How to retrieve values and data from registry?","body":"<p>have any of you out there ever used the <code>RegQueryMultipleValues</code> function? </p>\n\n<p>What I need to do is to create a function that will read all of the values ,data for the <code>HKEY_LOCAL_MACHINE\\SOFTWARE\\ALGORITHM</code> key entries.</p>\n\n<p>How do i use this function and after getting all the values and corresponding data ,how would i copy it into a XML file Can ANybody please help me out?\nHere is the code </p>\n\n<pre><code>void GetAlgorithmList()\n{\n    HKEY hKey=0;\n\n    LPCTSTR sk = TEXT(\"SOFTWARE\\\\ALGORITHM\");\n\n    /*char   buffer[MAX_PATH];*/\n    /*LONG openRes = RegOpenKey ( HKEY_LOCAL_MACHINE, \n                                sk,\n                                &amp;hKey);*/\n    RegOpenKeyEx (HKEY_LOCAL_MACHINE,sk,NULL,KEY_READ,&amp;hKey);\n    //HKEY hKeyRes;\n    long lret;\n    PVALENT val_list=0;\n    /*char *szValueBuf;*/\n    unsigned long totalsize = 1000;\n    lret = 0;\n    /**szValueBuf = \"xxx\";*/\n    LPWSTR szValueBuf=NULL;\n\n    lret = RegQueryMultipleValues(hKey,val_list,totalsize,szValueBuf,&amp;totalsize);\n    if (lret == ERROR_SUCCESS)\n    {\n        printf(\"Success 1\");\n    }\n    FILE* pFile = fopen(\"D:\\\\logFile.txt\", \"a+\");\n    fopen(\"D:\\\\logFile.txt\", \"a+\");\n    fprintf(pFile, \"%d\\n\",szValueBuf);\n    fclose(pFile);\n}\n</code></pre>\n"},{"tags":["c++","windows","winapi","dialog"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13151947,"title":"How to concate values in messagebox text using C++ win32 API?","body":"<p>i want to show the messsagebox using win32 API...</p>\n\n<p><code>int pwdexpirydays=5;\nMessageBox(hdlg,(LPCSTR)(\"Your password will expire in %d days\",&amp;pwdexpirydays),(LPCSTR)\"Logon Message\",MB_OK | MB_ICONINFORMATION);</code></p>\n\n<p>But i cant get the value...</p>\n\n<p>How to i concate the <code>pwdexpirydays</code> values into  <code>\"Your password will expire in %d days\"</code> this string.</p>\n"},{"tags":["c","winapi","visual-c++"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13106131,"title":"NtFsControlFile function error","body":"<p>I have this code:</p>\n\n<pre><code>// page1.h\n\nNTSTATUS (__stdcall *NtFsControlFile)( \n                    HANDLE FileHandle,\n                    HANDLE Event,                   \n                    PIO_APC_ROUTINE ApcRoutine,     \n                    PVOID ApcContext,               \n                    PIO_STATUS_BLOCK IoStatusBlock, \n                    ULONG FsControlCode,\n                    PVOID InputBuffer,              \n                    ULONG InputBufferLength,\n                    PVOID OutputBuffer,     \n                    ULONG OutputBufferLength\n            );\n\n\nULONG (__stdcall *RtlNtStatusToDosError) (\n        IN NTSTATUS Status\n        );\n</code></pre>\n\n<p>Then at <em>page2.cpp</em>:</p>\n\n<pre><code>page2.cpp\nVOID LocateNativeEntryPoints()\n{\n    //\n    // If we're on Win9x, just return\n    //\n    if( GetVersion() &gt;= 0x80000000) return;\n\n    //\n    // Load the NTDLL entry point we need\n    //\n    if( !(NtFsControlFile = (void *) GetProcAddress( GetModuleHandle(TEXT(\"ntdll.dll\")),\n            \"NtFsControlFile\" )) ) {\n\n        _tprintf(TEXT(\"\\nCould not find NtFsControlFile entry point in NTDLL.DLL\\n\"));\n        exit(1);\n    }\n    if( !(RtlNtStatusToDosError = (void *) GetProcAddress( GetModuleHandle(TEXT(\"ntdll.dll\")),\n                            \"RtlNtStatusToDosError\" )) ) {\n\n        _tprintf(TEXT(\"\\nCould not find RtlNtStatusToDosError entry point in NTDLL.DLL\\n\"));\n        exit(1);\n    }\n}\n</code></pre>\n\n<p>I have these errors at <code>if(!NtFsControlFile =  and if( !(RtlNtStatusToDosError =</code>,</p>\n\n<pre><code>error C2440: '=' : cannot convert from 'void *' to 'NTSTATUS (__stdcall *)(HANDLE,HANDLE,PIO_APC_ROUTINE,PVOID,PIO_STATUS_BLOCK,ULONG,PVOID,ULONG,PVOID,ULONG)'\n         Conversion from 'void*' to pointer to non-'void' requires an explicit cast\n\nerror C2440: '=' : cannot convert from 'void *' to 'ULONG (__stdcall *)(NTSTATUS)'\n         Conversion from 'void*' to pointer to non-'void' requires an explicit cast\n</code></pre>\n\n<p>The original <em>page2</em> was  C language file. I need to cast that and how to do it or how can I resolve the problem.</p>\n\n<p>Thanks a lot.</p>\n\n<p>SOLUTION THAT SEEMS TO WORK(NO AUTOMATICALLY CAST LIKE C LANGUAGE):</p>\n\n<pre><code>     // a typedef to make casting easier\n\n    typedef NTSTATUS (__stdcall *NtFsControlFilePtr)(\n        HANDLE FileHandle,\n        HANDLE Event,\n        PIO_APC_ROUTINE ApcRoutine,\n        PVOID ApcContext,\n        PIO_STATUS_BLOCK IoStatusBlock,\n        ULONG FsControlCode,\n        PVOID InputBuffer,\n        ULONG InputBufferLength,\n        PVOID OutputBuffer,\n        ULONG OutputBufferLength);\n\n// the actual pointer to function\n\nNtFsControlFilePtr NtFsControlFile;\n\n// and the GetProcAddress call\n\n    if( !(NtFsControlFile = reinterpret_cast&lt;NtFsControlFilePtr&gt;( GetProcAddress( GetModuleHandle(TEXT(\"ntdll.dll\")),\n            \"NtFsControlFile\" ))) ) {\n\n        _tprintf(TEXT(\"\\nCould not find NtFsControlFile entry point in NTDLL.DLL\\n\"));\n        exit(1);\n    }\n</code></pre>\n\n<p>THIS SOLUTION WORKS BUT  YOU GET:</p>\n\n<p>C4191: 'reinterpret_cast' : unsafe conversion</p>\n\n<p>with /WALL</p>\n\n<p>to avoid warning:</p>\n\n<pre><code>if( !(NtFsControlFile = reinterpret_cast&lt;NtFsControlFilePtr&gt;( reinterpret_cast&lt; void* &gt;( GetProcAddress( GetModuleHandle(TEXT(\"ntdll.dll\")), \n        \"NtFsControlFile\" )))))  {\n\n        _tprintf(TEXT(\"\\nCould not find NtFsControlFile entry point in NTDLL.DLL\\n\"));\n        exit(1);\n    }\n\n   if( !(RtlNtStatusToDosError = reinterpret_cast&lt;RtlNtStatusToDosErrorPtr&gt;( reinterpret_cast&lt; void* &gt;( GetProcAddress( GetModuleHandle(TEXT(\"ntdll.dll\")), \n        \"NtFsControlFile\" )))))  {\n\n        _tprintf(TEXT(\"\\nCould not find NtFsControlFile entry point in NTDLL.DLL\\n\"));\n        exit(1);\n    }\n</code></pre>\n"},{"tags":["c++","winapi","visual-c++","exception"],"answer_count":1,"favorite_count":1,"up_vote_count":10,"down_vote_count":0,"view_count":92,"score":10,"question_id":13148065,"title":"Can I decode a C++ exception from a Windows SEH exception? (And if so, how?)","body":"<p>In the event of an unhandled C++ exception I want to print:</p>\n\n<ol>\n<li>The message (<code>what()</code>) of the C++ exception</li>\n<li>A stack trace.</li>\n</ol>\n\n<p>In order to get the stack trace, I'm using <code>SetUnhandledExceptionFilter</code> in combination with the <a href=\"http://www.codeproject.com/Articles/11132/Walking-the-callstack\">StackWalker</a> library:</p>\n\n<pre><code>struct FooStackWalker : StackWalker\n{\n    virtual void OnCallstackEntry(CallstackEntryType, CallstackEntry &amp;entry) override\n    {\n        std::cerr &lt;&lt; entry.lineFileName &lt;&lt; \" (\" &lt;&lt; entry.lineNumber &lt;&lt; \"): \" &lt;&lt; entry.undFullName &lt;&lt; std::endl;\n    }\n};\n\nLONG WINAPI UnhandledExceptionHandler(LPEXCEPTION_POINTERS pointers)\n{\n    FooStackWalker walker;\n    walker.ShowCallstack(::GetCurrentThread(), pointers-&gt;ContextRecord);\n    ::TerminateProcess(::GetCurrentProcess(), 1);\n}\n\n\nint main()\n{\n    ::SetUnhandledExceptionFilter(UnhandledExceptionHandler);\n}\n</code></pre>\n\n<p>I've gotten the stack trace to print just fine, but now getting <code>what</code> is difficult.</p>\n\n<p>Is there some way I can decode the SEH exception as a C++ exception in order to call this member function before termination?</p>\n"},{"tags":["c#","sql","winapi","registry"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":53,"score":-1,"question_id":10661136,"title":"Registry and a Database","body":"<p>I've got an application that currently filters through a users Registry; if it finds one of the specific <code>UninstallString msiexec /x</code> then it runs a separate process to either uninstall or repair.</p>\n\n<p>So I've created a local SQL database; that upon install will have them stored in the database.  I'm having difficulty comparing the data read from SQL to the object containing all the Registry Keys.</p>\n\n<p>Any thoughts?  </p>\n\n<pre><code>RegistryKey rk = Registry.LocalMachine.OpenSubKey(@\"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall\");\nString [] rSK = rk.GetSubKeyNames();\nforeach (string r in rSK)\n{\nif (msiSQL = r)\n{\n\n// Process to Repair / Uninstall.\n}\n}\n</code></pre>\n\n<p>I know the <code>if</code> Statement can't work like that, it has to be set as a String Compare.  But that general process should work?  Any thoughts?</p>\n\n<p>Essentially my office helps customers; but there are several different versions that may be installed on the client machine.  Example: Software 2011, Software 2012, Software 2013.  There is a new version each year; so I'm trying to simplify by having this support application to automatically find it and repair or uninstall.</p>\n\n<p>If you have an easier method rather then deploying a local database; I'm all ears for that as well.</p>\n\n<p><em><strong></em> Edited October 30th, 2012 <em>*</em></strong>\nHello,</p>\n\n<p>I apologize I'm a few months late on this post.  This project was pushed to the side due to a higher priority one; the issue.</p>\n\n<p>When you recursively search through the Registry you can find the software version; I found the solution to recursively search the Registry for a given key.  The issue came when trying to find a clean way to uninstall at that point.</p>\n\n<p>Example:\nCustomer 1: Software 2011\nCustomer 2: Software 2012\nCustomer 3: Software 2013</p>\n\n<p>Pulling the GUID is possible; but I couldn't find a clean design pattern to be able to uninstall whatever the version is.  I'm not sure what result the customer will have installed; but I need to get it removed.</p>\n\n<p>So my original thought was to create a text-file, have the application load a database, or link to a web-service to compare a master file that contains all our application GUID's then just find the one that matches then uninstall.</p>\n\n<p>But that seemed very, very clunky and wasteful in time.  As every year the database will need to be updated.  Was trying to find a cleaner solution to find the application, then uninstall the application. </p>\n\n<p>Hopefully that clarifies the issue.  I'll check back frequently to try and stay up to date so there aren't any delays.  Also I apologize for the long delay and the lack of concise details in explaining the problem.  </p>\n\n<p>I'd still love to know the answer though.</p>\n"}]}
{"total":13828,"page":3,"pagesize":100,"questions":[{"tags":["c++","c","multithreading","winapi"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":4,"view_count":87,"score":-3,"question_id":13147243,"title":"I want to make the execution order of threads sequentially one after another","body":"<pre><code>#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\nusing namespace std;\n\nint count = 0;\n\nDWORD WINAPI Tf1 ( LPVOID n )\n{\n    HANDLE hEvent = OpenEvent ( EVENT_ALL_ACCESS , false, (LPCWSTR)\"MyEvent\" );\n    if ( !hEvent ) { return -1; }\n    // Loop through and wait for an event to occur\n    for ( ;; )\n    {\n        // Wait for the Event\n        WaitForSingleObject ( hEvent, INFINITE );\n        count++;\n        printf(\"In function1, Counter value: %d\\n\",count);\n        //    No need to Reset the event as its become non signaled as soon as\n        //    some thread catches the event.\n        if( count &gt; 7 ) return 0;\n    }\n    CloseHandle(hEvent);\n    return 0;\n}\n\nDWORD WINAPI Tf2 ( LPVOID n )\n{\n\n    HANDLE hEvent = OpenEvent ( EVENT_MODIFY_STATE , false, (LPCWSTR)\"MyEvent\" );\n    if ( !hEvent ) return -1; \n\n    for ( ;; )\n    {\n        if( count % 2 == 0) \n            SetEvent (hEvent);\n        else\n        {\n            count++;\n            printf(\"In function2, Counter value: %d\\n\",count);\n        }\n        //    No need to Reset the event as its become non signaled as soon as\n        //    some thread catches the event.\n        if( count &gt; 7 ) return 0;\n    }\n    CloseHandle(hEvent);\n    return 0;\n}\n\nint main()\n{\n    //    Create an Auto Reset Event which automatically reset to \n    //    Non Signalled state after being signalled\n    HANDLE     hEvent = CreateEvent ( NULL , false , false , (LPCWSTR)\"MyEvent\" );\n    if ( !hEvent ) return -1;\n    //    Create a Thread Which will wait for the events to occur\n    HANDLE mutex = CreateMutex(NULL, FALSE, NULL);\n\n    DWORD Id;\n    HANDLE hThrd1 = CreateThread ( NULL, 0, (LPTHREAD_START_ROUTINE)Tf1,0,0,&amp;Id );\n    HANDLE hThrd2 = CreateThread ( NULL, 0, (LPTHREAD_START_ROUTINE)Tf2,0,0,&amp;Id );\n\n    if ( !hThrd1 ) { CloseHandle (hEvent); return -1; }\n    if ( !hThrd2 ) { CloseHandle (hEvent); return -1; }\n    // Wait for a while before continuing....\n    Sleep ( 1000 );\n    // Give the signal twice as the thread is waiting for 2 signals to occur\n\n    // Wait for the Thread to Die\n    WaitForSingleObject ( hThrd1, INFINITE );\n    WaitForSingleObject ( hThrd2, INFINITE );\n\n    CloseHandle ( hThrd1 );\n    CloseHandle ( hThrd2 );\n    CloseHandle ( hEvent );\n\n    system ( \"PAUSE\" );\n    return 0;\n}\n</code></pre>\n\n<p><strong>O/P:</strong></p>\n\n<pre><code>In function1, Counter value: 1\nIn function1, Counter value: 3\nIn function2, Counter value: 2\nIn function2, Counter value: 4\nIn function2, Counter value: 6\nIn function1, Counter value: 5\nIn function1, Counter value: 7\nIn function2, Counter value: 8\n</code></pre>\n\n<p><strong>Desired O/P:</strong></p>\n\n<pre><code>In function1, Counter value: 1\nIn function2, Counter value: 2\nIn function1, Counter value: 3\nIn function2, Counter value: 4\nIn function1, Counter value: 5\nIn function2, Counter value: 6\nIn function1, Counter value: 7\nIn function2, Counter value: 8\n</code></pre>\n\n<p>I know i am not utilizing the power of threads. But my requirement is like this. How can i achieve this?</p>\n"},{"tags":["c++","winapi","taskbar","system-tray","visual-c++-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13146607,"title":"How to make a taksbar (system tray) application in Windows","body":"<p>The only way I know to launch a windows application is through <code>CreateWindow</code>. Unfortunately, there is not a <a href=\"http://msdn.microsoft.com/en-us/library/ms632600.aspx\" rel=\"nofollow\">window style</a> for a taskbar application, and I was wondering how to make a one. I did find <a href=\"http://alanbondo.wordpress.com/2008/06/22/creating-a-system-tray-app-with-c/\" rel=\"nofollow\">this explanation</a> in C#, but I am looking for a solution able to be compiled with VC++ 2008. Any solutions?</p>\n"},{"tags":["c++","winapi","dll","32bit-64bit","injection"],"answer_count":3,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":992,"score":0,"question_id":8776437,"title":"C++: Injecting 32 bit targets from 64 bit process","body":"<p>I have written a DLL-Injector in C++ recently, for which the requirements were the following</p>\n\n<ul>\n<li>The <strong>INJECTING PROCESS</strong> (let's call it the 'Injector') as well as the <strong>DLL TO BE INJECTED</strong> (Injection) exist in 64 and 32 bit variants. Depending on the target, the matching version of the injection is tried to be injected.</li>\n<li>It must be possible to inject target processes that are 32 bit (WOW64) even with the Injector running in 64 bit</li>\n</ul>\n\n<p>It came quickly to my notice, that the call of <strong>GetProcAddress(\"LoadLibraryA\")</strong> in the Injector returns an \"unusable\" handle as the 32 bit target has another kernel32.dll loaded and the address of the function there is different, so injection fails (The remote thread can not be started using the returned address/handle). Furthermore, the 32 bit process has the kernel32.dll loaded at a different base address, which makes creation of the remote thread even more impossible.</p>\n\n<p>To make clear what I mean, the following happens:</p>\n\n<ul>\n<li>Injector has 64 bit version of <strong>kernel32.dll</strong> loaded at 0x12340000</li>\n<li>Injector retrieves handle for <strong>LoadLibraryA</strong> 0x00005678 from this kernel32.dll</li>\n<li>Target has 32 bit version of <strong>kernel32.dll</strong> loaded at 0xABCD0000</li>\n<li>The handle for <strong>LoadLibrary</strong> of this kernel32.dll is expected to be 0x0000EFAB</li>\n<li>Injector tries to start remote thread in target with function 0x12345678, but 0xABCDEFAB is expected</li>\n</ul>\n\n<p>When injecting a 64 bit process from a 64 bit process, and 32 bit from 32 bit, there is usually no problem, as the kernel32.dll is (most likely) loaded at the same base address and the same function address can be used - that's my unterstanding so far. In this case however the conditions differ.</p>\n\n<p>To overcome the problem I did the following steps:</p>\n\n<ul>\n<li>64 bit Injector retrieves address of kernel32.dll loaded by 32 bit target using <strong>EnumProcessModulesEx()</strong> (should be 0xABCD000)</li>\n<li>Get filename of that <strong>kernel32.dll</strong>, parse the PE header and get the RVA of <strong>LoadLibraryA</strong> (should be 0x000EFAB)</li>\n<li>At this point, we know where <strong>kernel32.dll</strong> is loaded in the 32 bit target and the address of the function from this DLL.</li>\n<li>64 bit Injector starts remote thread in 32 bit target with <strong>ImageBase + Function RVA</strong>, in this case the magical 0xABCDEFAB</li>\n</ul>\n\n<p>This approach actually works very well, but I can't get rid of the thought that this is total overhead and there must be a more simpler solution to inject 32 bit targets from 64 bit injectors.</p>\n\n<p>I have two questions, for which I am very grateful if they could be answered here:</p>\n\n<ol>\n<li>Is there a more simple way to achieve this kind of injection?</li>\n<li>Are there possible problems with the approach I've been taking that I haven't thought about?</li>\n</ol>\n\n<p>Any answers are very much appreciated, thanks!</p>\n\n<p>EDIT: Oh my gosh... I just realized, that I described the situation wrong in my initial post. The INJECTOR is 64 bit, and the TARGET is 32 bit (Initially it was the other way around, but I already corrected it). Ben Voigt's comments down below are totally true, the call to EnumProcessModulesEx would fail. A big big BIG sorry for that confusion :(</p>\n"},{"tags":["winapi","spy++","findwindow","ida-pro"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13144805,"title":"How to `FindWindow` a window that doesn't show up in Spy++?","body":"<p>I'm debugging a Windows application with IDA Pro and I see that at one point it calls <code>FindWindowA</code> and successfully locates a window with the given class name.</p>\n\n<p>However when I use Spy++ to locate the windows with the given class name, it just doesn't seem to exist anywhere and I can't find it.</p>\n\n<p>I wonder how could I find this same window that application internally somehow finds when it calls <code>FindWindowA</code>? I wonder why my external application can't find the same window...</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13144749,"title":"enable mouse wheel scroll in WC_LISTBOX window","body":"<p>i am creating a child window of class WC_LISTBOX.</p>\n\n<p>then i populate the list with strings. sometimes the list height is smaller than the amount of items. and i get scroll bar at the side of the list.</p>\n\n<p>however, the WM_MOUSEWHEEL message is not implemented by WC_LISTBOX.</p>\n\n<p>so i made a local Proc to handle WM_MOUSEWHEEL... however, this message is never called to the WC_LISTBOX window and its only called for the parent window even if the cursor is on the list.</p>\n\n<p>here is my code:</p>\n\n<pre><code>m_hDDWnd =CreateWindowEx(WS_EX_CLIENTEDGE,WC_LISTBOX,NULL,WS_CHILD|WS_VISIBLE|LBS_NOTIFY|WS_VSCROLL,x,y,width,height,getWnd(),NULL,hInstance,NULL);\n....\ng_wpOrigListBoxProc = (WNDPROC)SetWindowLong(m_hDDWnd, GWL_WNDPROC, (long) WndProcListBox ); \n</code></pre>\n\n<p>the WM_MOUSEWHEEL never arrives to WndProcListBox.</p>\n\n<p>do anyone knows how to enable mouse wheel scroll inside WC_LISTBOX window...</p>\n\n<p>thanks,\nguy</p>\n"},{"tags":["c#",".net","windows","winapi","windows-phone-7"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":190,"score":1,"question_id":11599293,"title":"How to add external non windows phone class library project reference to a windows phone project?","body":"<p>Hi there I am new to the windows phone development and I am trying to build a data driven application in which I have Created my BLL and EL and DAL ,which are all of windows phone class library type project.\nI have also an extra project of type class library in my solution in which I have added the Reference to \"MyGeneration.dOOdads.dll\" file .\nNow I want this project to be referenced in the windows phone app project.But when I try to add a reference ,The VS 2010 says...<strong><em>.\"Unable to add the selected project refernce.The project reference must be another silver light for windows phone project that is the same or the lower version \"</em></strong>.\n.\n.\n.\nKindly help me in this scenario. Thanks </p>\n"},{"tags":["c++","winapi","windows-8","winrt","visual-studio-2012"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":1573,"score":4,"question_id":9106048,"title":"How to print to console/log in Visual Studio 11 in C++ in a Metro app?","body":"<p>I am attempting to figure out how to print to the debugger console/log in a Visual Studio 11 C++ Metro app. I have tried a number of methods to print to the log in a C++ Metro application (cout, Windows.System.Diagnostics, the documentation on MSDN and the Metro development site).</p>\n\n<p>How do I print to the console?</p>\n"},{"tags":["c++","qt","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13138594,"title":"Qt equivalent to winapi InterlockedIncrement?","body":"<p>i try to find equivalent in Qt c++ to winapi InterlockedIncrement\ni was reading : \n<a href=\"http://harmattan-dev.nokia.com/docs/library/html/qt4/qatomicint.html\" rel=\"nofollow\">http://harmattan-dev.nokia.com/docs/library/html/qt4/qatomicint.html</a><br>\nbut i didnt understand it , can someone please give me simple example </p>\n"},{"tags":["c++","c","winapi","dll"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":13131261,"title":"GetProcAddress() returning null for my Hello World function","body":"<p>Alright, so my simple DLL Hellow World function</p>\n\n<pre><code>#include \"stdafx.h\"\n\nextern \"C\" void HelloWorld()\n{\n   MessageBox( NULL, TEXT(\"Hello World\"), \n            TEXT(\"In a DLL\"), MB_OK);\n}\n</code></pre>\n\n<p>isn't getting called by my simple hello world app:</p>\n\n<pre><code>case IDM_ABOUT:\n\n            hinstDLL = LoadLibrary(L\"phantasyhook.dll\");\n            if (hinstDLL != NULL)\n            {\n                HelloWorld = (FARPROC) GetProcAddress(hinstDLL, \"HelloWorld\");\n\n                if (HelloWorld != NULL)\n                    HelloWorld();\n\n                else\n                    MessageBox(NULL, L\"is null\", L\"dll Error\", MB_OK);\n\n                FreeLibrary(hinstDLL);\n            }\n\n            break;\n</code></pre>\n\n<p>It opens the \"is null\" MessageBox, thought it should open up the Hello World one. What am I doing wrong?</p>\n"},{"tags":["windows","winapi","kernel32"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13139414,"title":"CreateToolhelp32Snapshot could not be located in kernel32.dll error message","body":"<p>When launching my application in Windows NT machine (Ver. 4.0 SP6), I get the below error message and the application does not get launched. However, the same app gets launched on Windows XP and works fine.</p>\n\n<p>The Message reads as below:</p>\n\n<p><em><strong>\"The procedure entry point CreateToolhelp32Snapshot could not be located in the dynamic link library KERNEL32.dll\"</em></strong></p>\n\n<p>Any idea/fix? Please help</p>\n\n<p>Thanks,</p>\n\n<p>Nayan</p>\n"},{"tags":["c++","windows","winapi","active-directory","adsi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13135747,"title":"how to get pwdexpirydate using pwdlastset value and maxpwdage value in C++ win32 API?","body":"<p>i get the maxpwdage value and pwdlastset value using ADSI..</p>\n\n<p>Now i want to check the password expiry date...</p>\n\n<p><code>hr = pDomain-&gt;get_MaxPasswordAge(&amp;ret);</code></p>\n\n<p>maxpwdage gives 432000...</p>\n\n<p><code>hr = pUser-&gt;get_PasswordLastChanged(&amp;expirationDate);</code></p>\n\n<p>pwdlastset gives 41176.470196759263...</p>\n\n<p>how to achieve the password expiry date using this value?</p>\n"},{"tags":["c++",".net","winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13135518,"title":"Get IStorage from ComTypes.STGMEDIUM in C++","body":"<p>I got a <a href=\"http://msdn.microsoft.com/en-us/library/7hfcbw59%28v=vs.100%29.aspx\" rel=\"nofollow\">ComTypes.STGMEDIUM</a> object and I want to get its IStorage. From <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms683812%28v=vs.85%29.aspx\" rel=\"nofollow\">STGMEDIUM struct</a> you can get it with the help of the pstg member. The <a href=\"http://msdn.microsoft.com/en-us/library/7hfcbw59%28v=vs.100%29.aspx\" rel=\"nofollow\">ComTypes.STGMEDIUM</a> class is missing such an member.  </p>\n"},{"tags":["c++","windows","winapi","active-directory"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13123075,"title":"How to get maxpwdAge attribute value in ActiveDirectory using C++?","body":"<p>i am working with AD Server,i want to get the <strong>maxpwdAge attribute</strong> value...</p>\n\n<p>i already try ADSi for that,but it gives an issue.</p>\n\n<pre><code>VARIANT var;\nbsNamingContext=L\"maxpwdAge\";\n\nhr = ADsGetObject(pszADsPath, IID_IADsUser, (void**) &amp;pUser);\nif(SUCCEEDED(hr))\n{\nVariantInit(&amp;var);\nhr = pUser-&gt;Get(bsNamingContext, &amp;var);  \n}\n</code></pre>\n\n<p>but,it gives -2147463155 (8000500d) error...</p>\n\n<p>but i am using  <code>bsNamingContext=L\"cn\";</code>\nit gives the CN values correctly...</p>\n\n<p>anyone can resolve it?</p>\n"},{"tags":["c++","winapi","windows-shell","shellexecute"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":132,"score":3,"question_id":10446675,"title":"Display property sheets for multiple shell objects","body":"<p>I have to display properties window for specified items: folders and files. </p>\n\n<p>For one item displaying properties windows is very easy - just set .lpFile field. But I can't get how to display properties window for several items. </p>\n\n<p>1) Enumerating files in .lpFile like \"\"file1.txt\" \"file2.txt\"\" and so on doesn't work. Even if it works its not applicable, because file list can be too huge.</p>\n\n<p>2) Working via PIDLIST_ABSOLUTE did not bring any results. Can create PIDLIST_ABSOLUTE for single file via ILCreateFromPath, but can't merge several PIDLIST_ABSOLUTEs into one.</p>\n\n<p>Does anyone have any workaround? Any answers will be appreciated</p>\n\n<p>PS: As i've recently understood, PIDLIST_ABSOLUTE is unique-created for concrete unique object. So two or more PIDLIST_ABSOLUTE could not be concatenated. But the question is still actual.</p>\n"},{"tags":["perl","winapi","fork","http-daemon"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13132438,"title":"HTTP::Daemon crashing when I stop the loop","body":"<p>I'm working on an adhoc GUI so that I can easily view a bunch of data from the VMWare Perl SDK without having to setup a bunch of scripts under IIS.  The basic idea is to start up the script, and have it fork two processes.  One is the HTTP::Daemon web server, and then two seconds later its the Win32::IEAutomation run browser.  It's not pretty, I admit, but I'm slightly comfortable with the VMPerlSDK than the VMCOMSDK.  Plus I'm kind of curious to see if I can get this to work.</p>\n\n<p>As far as I can tell, the program starts okay.  The fork works.  The little URI parser works.  The only problem is whenever I try to call /quit to shutdown the server, the script explodes.</p>\n\n<p>Any suggestions (aside from how this should be done with IIS and AutoIT, I know, I know) would be appreciated.  Thanks!</p>\n\n<pre><code>#!/usr/bin/perl -w\nuse Data::Dumper;\nuse HTTP::Daemon;\nuse HTTP::Status;\nuse HTTP::Response;\nuse strict;\nuse warnings;\nuse Win32::IEAutomation;\n\nsub MainPage {\n    return&lt;&lt;eol\n&lt;html&gt;\n&lt;head&gt;&lt;title&gt;Test&lt;/title&gt;&lt;/head&gt;\n&lt;body&gt;\n&lt;h3&gt;Home&lt;/h3&gt;\n&lt;p&gt;&lt;a href=\"/quit\"&gt;Quit&lt;/a&gt;&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\neol\n}\n\n# Parses out web variables\nsub WebParse {\n    my ($wstring) = @_;\n    my %webs = ();\n    # gets key/value data\n    my @pairs = split(/&amp;/, $wstring);\n\n    # puts the key name into an array\n    foreach my $pair (@pairs) {\n            my ($kname, $kval) = split (/=/, $pair);\n            $kval =~ tr/+/ /;\n            $kval =~ s/%([a-fA-F0-9][a-fA-F0-9])/pack(\"C\", hex($1))/eg;\n            $webs{$kname} = $kval;\n    }\n\n    return(%webs);\n}\n\nsub StartServer {\n    my $PORT = shift;\n    my $ALLOWED = shift;\n\n    my $d = HTTP::Daemon-&gt;new(ReuseAddr =&gt; 1, LocalAddr =&gt; $ALLOWED, LocalPort =&gt; $PORT) || die;\n\n    # Prints a startup message\n    print \"Please contact me at: &lt;URL:\", $d-&gt;url, \"&gt;\\n\";\n    my $xt = 0;\n\n    BLOOP: while (my $c = $d-&gt;accept) {\n        while (my $r = $c-&gt;get_request) {\n            # Handles requests with the GET or POST methods\n            if ($r-&gt;method =~ m/GET/i || $r-&gt;method =~ m/POST/i) {\n                my $uri = $r-&gt;uri; my %ENV = ();\n\n                $ENV{REQUEST_METHOD} = $r-&gt;method;\n                $ENV{CONTENT_TYPE}   = join('; ', $r-&gt;content_type);\n                $ENV{CONTENT_LENGTH} = $r-&gt;content_length || '';\n                $ENV{SCRIPT_NAME}    = $uri-&gt;path || 1;\n                $ENV{REMOTE_ADDR}    = $c-&gt;peerhost();\n\n                if ($r-&gt;method =~ m/GET/i) {\n                    $ENV{QUERY_STRING}   = $uri-&gt;query || '';\n                }\n                elsif ($r-&gt;method =~ m/POST/i) {\n                    $ENV{QUERY_STRING}   = $r-&gt;{\"_content\"} || '';\n                }\n\n                my %q = &amp;WebParse($ENV{QUERY_STRING});\n\n                my $res = HTTP::Response-&gt;new(\"200\");\n\n                if ($uri =~ m/quit/i) {\n                    $res-&gt;content(\"Goodbye\");\n                    $xt=1;\n                }\n                else {\n                    $res-&gt;content(MainPage());\n                }\n\n                $c-&gt;send_response($res);\n            }\n            # Otherwise\n            else {\n                $c-&gt;send_error(\"This server only accepts GET or POST methods\");\n            }\n\n            if ($xt == 1) {\n                sleep(2);\n                $c-&gt;force_last_request();\n                last BLOOP;\n            }\n\n            $c-&gt;close;\n        }\n        undef($c);\n    }\n    $d-&gt;close;\n    undef($d);\n    exit;\n}\n\nsub StartInterface {\n    my $PORT = shift;\n    my $ALLOWED = shift;\n    my $ie = Win32::IEAutomation-&gt;new(visible =&gt; 1, maximize =&gt; 1);\n    $ie-&gt;gotoURL(\"http://\".$ALLOWED.\":\".$PORT.\"/\");\n    exit;\n}\n\n# Return Status\nmy $STATUS = 1;\n\n# Server port number\nmy $PORT = 9005;\n\n# The server that's allowed to talk to this one\nmy $ALLOWED = \"127.0.0.1\";\n\nmy $pid = fork();\n\nif ($pid == 0) {\n    StartServer($PORT, $ALLOWED);\n} else {\n    sleep(2);\n    StartInterface($PORT, $ALLOWED);\n}\n\nexit;\n</code></pre>\n"},{"tags":["c++","windows","winapi","resources","dialog"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":324,"score":1,"question_id":5059613,"title":"Syntax Error in dialog resource","body":"<p>I have a Win32 GUI application and in my resource.rc file I'm trying to create a dialog, but I get a syntax error in my code.</p>\n\n<pre><code>IDD_ABOUT DIALOG 0, 0, 239, 66\nSTYLE DS_MODALFRAME | WS_CAPTION | WS_POPUP | WS_SYSMENU // error here\nCAPTION \"About\"\nFONT 8, \"MS Sans Serif\"\nBEGIN\n   DEFPUSHBUTTON \"&amp;OK\", IDOK, 174, 27, 50, 14\n   GROUPBOX \"Blahblah...\", IDC_STATIC, 7, 7, 225, 52\n   CTEXT \"Name: Blahblah\\r\\nVersion: blahblahblah\\r\\nAuthor: blahblahblah\\r\\nDescription: blahblahblah\", IDC_STATIC, 15, 18, 144, 33\nEND\n</code></pre>\n\n<p>(Of course, it doesn't really say blahblahblah.)\nI Google'd around and found some similar questions, but they were all to do with the groupbox line and IDC_STATIC not being declared.  IDC_STATIC isn't declared in mine either and if I hover over it, the 'tooltip' it gives is all the lines of my menu resource.  But I don't think this has anything to do with it, because its a different line that's causing the problem.</p>\n\n<p>What am I doing wrong?</p>\n\n<p>(In case its needed, I'm using CodeBlocks with MinGW on Windows 7)</p>\n"},{"tags":["c++","c","winapi","visual-c++"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":288,"score":0,"question_id":6907564,"title":"Create multiple files using multi threading in C++ using Win32 API","body":"<p>I am trying to create files in a pen drive. If the pen drive is not present, threads should suspend. When it is inserted it should resume. Here is the code I tried but it's not working properly. Can any one help me?</p>\n\n<pre><code> #include \"stdafx.h\"\n    #include &lt;Windows.h&gt;\n    #include &lt;Strsafe.h&gt;\n    #include &lt;WinBase.h&gt;\n\n\n        LPCTSTR Disk=L\"E:\\\";\n\n        LPTSTR drive_Name=L\"E:\\\\demo\";\n\n        CRITICAL_SECTION section;\n\n\n         #define BUFFER_SIZE 1024\n         #define count 10\n\n        HANDLE Write_Handle[10],Open_Handle[10],read_Handle[10] ;\n\n        DWORD WINAPI check_Thread(LPVOID lpParameter)\n\n        {\n\n        int *nThreadNo = (int*)lpParameter;\n\n        while(1)\n\n        {\n\n                if(GetDiskFreeSpaceExW(Disk,NULL,NULL,NULL))\n\n                {\n\n                    ResumeThread(Write_Handle[*nThreadNo]);\n                    ResumeThread(read_Handle[*nThreadNo]);\n                }\n                else\n                {\n                    SuspendThread(Write_Handle[*nThreadNo]);\n                    SuspendThread(read_Handle[*nThreadNo]);\n                }\n            }\n\n        }\n\n\n        DWORD  WINAPI Write_Thread(LPVOID lpParameter)\n        {\n            DWORD g_tid = GetCurrentThreadId();\n            _tprintf(_T(\" write thread id %d\\n\"),g_tid);\n            LPCWSTR  filename=(LPCWSTR)lpParameter;\n            HANDLE ofile;\n            EnterCriticalSection(&amp;section);\n            ofile=CreateFileW(filename,GENERIC_WRITE,FILE_SHARE_READ,NULL,OPEN_ALWAYS,NULL, NULL);\n            int d;\n                d=GetLastError();\n                if(ERROR_SUCCESS!=GetLastError())\n                {\n                    _tprintf(_T(\"error values in open thread %d \\n\"),GetLastError());\n                    _tprintf(_T(\"filename %s \\n\"),filename);\n                }\n\n            const int filesizeinKB = 1024;\n            BOOL bError;\n            DWORD dwBytesWritten=0;\n             WCHAR ReadBuffer[BUFFER_SIZE] = {0};\n            int i;\n\n\n            for(i = 0; i &lt;= BUFFER_SIZE; i++)\n            {\n                ReadBuffer[i] = (char)(i%26 + 'a');\n            }\n            for (i = 0; i &lt;= filesizeinKB; i++)\n            {\n                SetLastError(0);\n                bError= WriteFile(ofile, ReadBuffer-1, BUFFER_SIZE,&amp;dwBytesWritten, NULL);\n                bError=GetLastError();\n\n                if (ERROR_SUCCESS!=GetLastError())\n                {   _tprintf(_T(\"error value in write %d\\n\"),GetLastError());\n                    _tprintf(_T(\" Write Error...\\n\"));\n                        return 1;\n                }\n\n            }\n            SetLastError(0);\n            CloseHandle(ofile);\n            _tprintf(_T(\"write close error values %d\\n\"),GetLastError());\n            LeaveCriticalSection(&amp;section);\n            return 1;\n        }\n\n\n        DWORD WINAPI Read_Thread(LPVOID lpParameter)\n        {\n            HANDLE ofile;\n            DWORD g_tid = GetCurrentThreadId();\n            _tprintf(_T(\" write thread id %d\\n\"),g_tid);\n            LPCWSTR  filename=(LPCWSTR)lpParameter;\n            EnterCriticalSection(&amp;section);\n            ofile=CreateFileW(filename,GENERIC_READ,FILE_SHARE_READ,NULL,OPEN_ALWAYS,NULL, NULL);\n            int d;\n                d=GetLastError();\n                if(ERROR_SUCCESS!=GetLastError())\n                {\n                    _tprintf(_T(\"error values in open thread %d \\n\"),GetLastError());\n                    _tprintf(_T(\"filename %s \\n\"),filename);\n                }\n\n            DWORD dwBytesRead=0;\n             WCHAR ReadBuffer[BUFFER_SIZE] = {0};\n            _tprintf(_T(\" read thread \\n\"));\n            SetLastError(0);\n            int err;\n\n            ReadFile(ofile, ReadBuffer, (BUFFER_SIZE-1), &amp;dwBytesRead, NULL);\n\n                err=GetLastError();\n                _tprintf(_T(\"read error values %d \\n\"),GetLastError());\n                if(ERROR_SUCCESS!=GetLastError())\n                {\n                    _tprintf(L\"reading failed \\n\");\n                    return 0;\n                }\n                SetLastError(0);\n                CloseHandle(ofile);\n                err=GetLastError();\n                _tprintf(_T(\"close error values %d\\n\"),GetLastError());\n                LeaveCriticalSection(&amp;section);\n                return 1;\n        }\n\n\n        int _tmain(int argc, _TCHAR* argv[])\n        {\n\n            unsigned int myCounter = 0;\n            DWORD WritethreadID,OpenThreadID,ReadthreadID;\n            HANDLE check_Handle;\n             DWORD exThread;\n            TCHAR filename[100];\n            HANDLE hfile;\n            INT bsize=100;\n            int i=0;\n\n            InitializeCriticalSection (&amp;section);\n            CreateDirectory(drive_Name,NULL);\n\n            for(i=0;i&lt;5;i++)\n            {\n                SetLastError(0);\n                StringCchPrintf(filename,bsize, TEXT(\"%s\\\\file_%d.txt\"),drive_Name,i );\n                hfile=CreateFileW(filename,GENERIC_WRITE|GENERIC_READ,NULL,NULL,CREATE_ALWAYS,FILE_ATTRIBUTE_NORMAL,NULL);\n\n                if (hfile == INVALID_HANDLE_VALUE) \n                { \n                    _tprintf(_T(\"invalid handle \\n\" ));\n\n                }\n                _tprintf(_T(\"file created %s\\n\"),filename);\n                CloseHandle(hfile);\n\n                Write_Handle[i] =CreateThread(0, 0, Write_Thread, filename, CREATE_SUSPENDED, &amp;WritethreadID);\n                SetThreadPriority(Write_Handle[i],2);\n                _tprintf(_T(\"write thread id is %d\\n\"),WritethreadID);\n                read_Handle[i]=CreateThread(0, 0, Read_Thread, filename, CREATE_SUSPENDED, &amp;ReadthreadID);\n                SetThreadPriority(read_Handle[i],1);\n                _tprintf(_T(\"read thread id is %d\\n \"),ReadthreadID);\n                check_Handle =CreateThread(0, 0, check_Thread,(void*)&amp;i ,0,&amp;OpenThreadID);\n            }   \n            for (i=0; i&lt;count; ++i)\n            {\n                WaitForSingleObject(Write_Handle[i],INFINITE); \n                if ( !GetExitCodeThread(Write_Handle, &amp;exThread) ) \n                {  \n                    _tprintf(_T(\"close thread %08X\\n\"),GetLastError()); \n\n                }\n                SetLastError(0);\n                CloseHandle(Write_Handle[i]);\n                _tprintf(_T(\"close thread %08X\\n\"),GetLastError()); \n                WaitForSingleObject(read_Handle[i],INFINITE); \n                if ( !GetExitCodeThread(read_Handle, &amp;exThread) ) \n                {  \n                    _tprintf(_T(\"GetExitCodeThread %08X\\n\"),GetLastError()); \n                } \n                SetLastError(0);\n                CloseHandle(read_Handle[i]);\n                _tprintf(_T(\"GetExitCodeThread %08X\\n\"),GetLastError()); \n\n                CloseHandle(check_Thread);\n\n            }\n\n            DeleteCriticalSection(&amp;section);\n            return 1;\n\n        }\n</code></pre>\n"},{"tags":["c++","c","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13131754,"title":"_ttoi win c++ assertion failure","body":"<p>i have this code:</p>\n\n<pre><code>BOOLEAN   Recurse = FALSE;\nDWORD     NumPasses = 1;\n\n\nint _tmain( int argc, TCHAR *argv[] ) \n{\n\n    BOOL        foundFileArg = FALSE;\n    int         i;\n\n   if( argc &lt; 2 ) {\n\n        return Usage( argv[0] );\n    }\n\n\n    for( i = 1; i &lt; argc; i++ ) {\n\n        if( !_tcsicmp( argv[i], TEXT(\"/s\") ) ||\n            !_tcsicmp( argv[i], TEXT(\"-s\") )) {\n\n            Recurse = TRUE;\n\n    } else if( !_tcsicmp( argv[i], TEXT(\"/p\") ) ||\n                   !_tcsicmp( argv[i], TEXT(\"-p\") )) {\n\n                   // assertion failure \n            NumPasses = argc &gt; i ? _ttoi( argv[i+1] ) : 1;\n            if( !NumPasses ) return Usage( argv[0] );\n            i++;\n\n\n        } else {\n\n            if( foundFileArg ) return Usage( argv[0] );\n            foundFileArg = TRUE;\n        }\n    }\n\n\n    return 0;\n\n}\n</code></pre>\n\n<p>i get assertion failure,\nPlease suggest where the problem might be and where to look. Is it some problem with _ttoi function i'm using when it fails,\nif i have to allocate a buffer,\nhow can i resolve it</p>\n\n<p>thanks</p>\n"},{"tags":["winapi","critical-section"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13117687,"title":"Can a Windows CRITICAL_SECTION object be configured to deny recursive access?","body":"<p>By default, a CRITICAL_SECTION object is recursive. Can this behaviour be configured like a pthread mutex to enable or disable recursive thread access?</p>\n\n<p>To clarify in response to the comments: I am referring specifically to a Windows CRITICAL_SECTION object, not a Windows mutex.</p>\n"},{"tags":["delphi","winapi","process","dump"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":13129312,"title":"RunPE dump process","body":"<p>Is it possible to dump its own process when it got started from runpe?</p>\n\n<p>Where would be the startaddress of the process, etc.?</p>\n\n<p>EDIT:</p>\n\n<p>I have this unit to run an executable from memory:</p>\n\n<pre><code>unit uExecFromMem;\n\ninterface\n\nuses Windows;\n\nfunction ExecuteFromMem(szFilePath:string; pFile:Pointer):DWORD;\n\ntype\n  PImageBaseRelocation = ^TImageBaseRelocation;\n  TImageBaseRelocation = packed record\n     VirtualAddress: DWORD;\n     SizeOfBlock: DWORD;\n  end;\n\nfunction NtUnmapViewOfSection(ProcessHandle:DWORD; BaseAddress:Pointer):DWORD; stdcall; external 'ntdll';\n\nimplementation\n\nprocedure PerformBaseRelocation(f_module: Pointer; INH:PImageNtHeaders; f_delta: Cardinal); stdcall;\nvar\n  l_i: Cardinal;\n  l_codebase: Pointer;\n  l_relocation: PImageBaseRelocation;\n  l_dest: Pointer;\n  l_relInfo: ^Word;\n  l_patchAddrHL: ^DWord;\n  l_type, l_offset: integer;\nbegin\n  l_codebase := f_module;\n  if INH^.OptionalHeader.DataDirectory[5].Size &gt; 0 then\n  begin\n    l_relocation := PImageBaseRelocation(Cardinal(l_codebase) + INH^.OptionalHeader.DataDirectory[5].VirtualAddress);\n    while l_relocation.VirtualAddress &gt; 0 do\n    begin\n      l_dest := Pointer((Cardinal(l_codebase) + l_relocation.VirtualAddress));\n      l_relInfo := Pointer(Cardinal(l_relocation) + 8);\n      for l_i := 0 to (trunc(((l_relocation.SizeOfBlock - 8) / 2)) - 1) do\n      begin\n        l_type := (l_relInfo^ shr 12);\n        l_offset := l_relInfo^ and $FFF;\n        if l_type = 3 then\n        begin\n          l_patchAddrHL := Pointer(Cardinal(l_dest) + Cardinal(l_offset));\n          l_patchAddrHL^ := l_patchAddrHL^ + f_delta;\n        end;\n        inc(l_relInfo);\n      end;\n      l_relocation := Pointer(cardinal(l_relocation) + l_relocation.SizeOfBlock);\n    end;\n  end;\nend;\n\nfunction AlignImage(pImage:Pointer):Pointer;\nvar\n  IDH:          PImageDosHeader;\n  INH:          PImageNtHeaders;\n  ISH:          PImageSectionHeader;\n  i:            WORD;\nbegin\n  IDH := pImage;\n  INH := Pointer(DWORD(pImage) + IDH^._lfanew);\n  GetMem(Result, INH^.OptionalHeader.SizeOfImage);\n  ZeroMemory(Result, INH^.OptionalHeader.SizeOfImage);\n  CopyMemory(Result, pImage, INH^.OptionalHeader.SizeOfHeaders);\n  for i := 0 to INH^.FileHeader.NumberOfSections - 1 do\n  begin\n    ISH := Pointer(DWORD(pImage) + IDH^._lfanew + 248 + i * 40);\n    CopyMemory(Pointer(DWORD(Result) + ISH^.VirtualAddress), Pointer(DWORD(pImage) + ISH^.PointerToRawData), ISH^.SizeOfRawData);\n  end;\nend;\n\nfunction ExecuteFromMem(szFilePath:string; pFile:Pointer):DWORD;\nvar\n  PI:           TProcessInformation;\n  SI:           TStartupInfo;\n  CT:           TContext;\n  IDH:          PImageDosHeader;\n  INH:          PImageNtHeaders;\n  dwImageBase:  DWORD;\n  pModule:      Pointer;\n  dwNull:       DWORD;\nbegin\n  Result := 0;\n  IDH := pFile;\n  if IDH^.e_magic = IMAGE_DOS_SIGNATURE then\n  begin\n    INH := Pointer(DWORD(pFile) + IDH^._lfanew);\n    if INH^.Signature = IMAGE_NT_SIGNATURE then\n    begin\n      FillChar(SI, SizeOf(TStartupInfo), #0);\n      FillChar(PI, SizeOf(TProcessInformation), #0);\n      SI.cb := SizeOf(TStartupInfo);\n      if CreateProcess(nil, PChar(szFilePath), nil, nil, FALSE, CREATE_SUSPENDED, nil, nil, SI, PI) then\n      begin\n        CT.ContextFlags := CONTEXT_FULL;\n        if GetThreadContext(PI.hThread, CT) then\n        begin\n          ReadProcessMemory(PI.hProcess, Pointer(CT.Ebx + 8), @dwImageBase, 4, dwNull);\n          if dwImageBase = INH^.OptionalHeader.ImageBase then\n          begin\n            if NtUnmapViewOfSection(PI.hProcess, Pointer(INH^.OptionalHeader.ImageBase)) = 0 then\n              pModule := VirtualAllocEx(PI.hProcess, Pointer(INH^.OptionalHeader.ImageBase), INH^.OptionalHeader.SizeOfImage, MEM_COMMIT or MEM_RESERVE, PAGE_EXECUTE_READWRITE)\n            else\n              pModule := VirtualAllocEx(PI.hProcess, nil, INH^.OptionalHeader.SizeOfImage, MEM_COMMIT or MEM_RESERVE, PAGE_EXECUTE_READWRITE);\n          end\n          else\n            pModule := VirtualAllocEx(PI.hProcess, Pointer(INH^.OptionalHeader.ImageBase), INH^.OptionalHeader.SizeOfImage, MEM_COMMIT or MEM_RESERVE, PAGE_EXECUTE_READWRITE);\n          if pModule &lt;&gt; nil then\n          begin\n            pFile := AlignImage(pFile);\n            if DWORD(pModule) &lt;&gt; INH^.OptionalHeader.ImageBase then\n            begin\n              PerformBaseRelocation(pFile, INH, (DWORD(pModule) - INH^.OptionalHeader.ImageBase));\n              INH^.OptionalHeader.ImageBase := DWORD(pModule);\n              CopyMemory(Pointer(DWORD(pFile) + IDH^._lfanew), INH, 248);\n            end;\n            WriteProcessMemory(PI.hProcess, pModule, pFile, INH.OptionalHeader.SizeOfImage, dwNull);\n            WriteProcessMemory(PI.hProcess, Pointer(CT.Ebx + 8), @pModule, 4, dwNull);\n            CT.Eax := DWORD(pModule) + INH^.OptionalHeader.AddressOfEntryPoint;\n            SetThreadContext(PI.hThread, CT);\n            ResumeThread(PI.hThread);\n            FreeMem(pFile, INH^.OptionalHeader.SizeOfImage);\n            Result := PI.hThread;\n          end;\n        end;\n      end;\n    end;\n  end;\nend;\n\nend.\n</code></pre>\n\n<p>Then I have Application1 and Application2.</p>\n\n<p>Application1 has Application2 (the complete executable) stored in memory.\nThen Application1 starts Application2 from memory like this: </p>\n\n<pre><code>ExecuteFromMem(paramstr(0), @Application2InMemory) // uses Application1 as Host\n</code></pre>\n\n<p>Now Application2 is loaded in memory and is started!\nHow can Application2 get the it's data (the Application2.exe) back to the disk (or back to a var)?</p>\n"},{"tags":["c","windows","winapi","named-pipes"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13129891,"title":"WinAPI Named Pipe location","body":"<pre><code>HANDLE pipe = CreateFile( L\"\\\\\\\\.\\\\pipe\\\\my_pipe\",\n                              GENERIC_READ, // only need read access\n                              FILE_SHARE_READ | FILE_SHARE_WRITE,\n                              NULL,\n                              OPEN_EXISTING,\n                              FILE_ATTRIBUTE_NORMAL,\n                              NULL );\n</code></pre>\n\n<p>I'm new to win api and i'd like to know where is the \"my_pipe\" file created on the hard disk?\nI can't find it anywhere near the binary or sources</p>\n"},{"tags":["winapi","raw-input","setwindowshookex","wh-keyboard-ll"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13128692,"title":"WH_KEYBOARD_LL hook doesn't capture input in own process","body":"<p>I'm using a low-level keyboard hook (WH_KEYBOARD_LL) to disable certain input, such as Alt-Tab. I create the hook on a thread with a message pump, so I can properly handle the notifications.</p>\n\n<p>The hook's callback function is able to process keyboard events whenever I'm not focused in the window that created the hook (i.e. my main window), but as soon as I activate that window, no events show up in the hook until I deactivate the window again and the input instead propagates to the window's WindowProc.</p>\n\n<p>Does anybody have any clue what's going on here?</p>\n\n<p><strong>UPDATE:</strong> So, it turns out this behavior is caused by also registering for raw input in the same process. Apparently, using raw input causes my low-level keyboard hook to be disabled whenever my process’s window is focused. Does anybody know why and how to work around this?</p>\n"},{"tags":["c++","winapi","wmi","disk"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":33,"score":2,"question_id":13123719,"title":"When an encrypted USB drive is plugged, how can I use WMI to find the 'launcher' logical disk?","body":"<p>I am using WMI to determine when various forms of media are plugged/put in (USB drives, CDs, etc). However, encrypted drives such as 'SanDisk Enterprise FIPS USB' do something funky: it looks like they represent themselves as a CD drive from which an unlocking application can be launched. When the unlocking utility is finished, the new USB logical disk is available for read/write.  So the order of events as I am seeing them from WMI is:</p>\n\n<ol>\n<li>USB is inserted</li>\n<li>Win32_DiskDrive object is created (see \\.\\PHYSICALDRIVE2 below)</li>\n<li>distinct Win32_LogicalDisks are created, one I copied below (G:), and holds the launcher, the other (M:, in my case) is the drive that will eventually be accessable.</li>\n</ol>\n\n<p><strong>BUT</strong>, no Win32_DiskDriveToDiskPartition entries exist until after the utility has run, which is the usual way to locate volumes from a hardware ID. After much googleing and <a href=\"http://savant7.com/wp-content/uploads/2009/02/keyboardsmasher.gif\" rel=\"nofollow\">some trial and error</a>, I haven't been able to find an architecturally sound method of associating PHYSICALDRIVE2 to G:. The general consensus online is that you shouldn't expect such mappings to exist, because physical media need not have partitions or volumes, etc, but in my case I basically know it <em>does</em> exist, and would error out in some meaningful way if the expected mapping were missing.</p>\n\n<p>At this point, my only strategy is to enumerate all the volumes and just look for the appropriate file in all CD drives, maybe keeping track of any such devices that have been recognized after my encrypted USB drive was connected. Obviously this is an ugly hack. Suggestions?</p>\n\n<pre><code>TargetInstance = \ninstance of Win32_LogicalDisk\n{\n    Caption = \"G:\";\n    CreationClassName = \"Win32_LogicalDisk\";\n    Description = \"CD-ROM Disc\";\n    DeviceID = \"G:\";\n    DriveType = 5;\n    MediaType = 11;\n    Name = \"G:\";\n    SystemCreationClassName = \"Win32_ComputerSystem\";\n};\n\ninstance of Win32_DiskDrive\n{\n    Caption = \"SanDisk Enterprise FIPS USB Device\";\n    ConfigManagerErrorCode = 0;\n    ConfigManagerUserConfig = FALSE;\n    CreationClassName = \"Win32_DiskDrive\";\n    Description = \"Disk drive\";\n    DeviceID = \"\\\\\\\\.\\\\PHYSICALDRIVE2\";\n    FirmwareRevision = \"6.61\";\n    Index = 2;\n    InterfaceType = \"USB\";\n    Manufacturer = \"(Standard disk drives)\";\n    MediaLoaded = TRUE;\n    Model = \"SanDisk Enterprise FIPS USB Device\";\n    Name = \"\\\\\\\\.\\\\PHYSICALDRIVE2\";\n    Partitions = 0;\n    SerialNumber = \"u\";\n    Signature = 0;\n    Status = \"OK\";\n    SystemCreationClassName = \"Win32_ComputerSystem\";\n};\n</code></pre>\n"},{"tags":["c++","oop","winapi","modularity"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":83,"score":-1,"question_id":13092901,"title":"MFC Best practice and modularity","body":"<p>In MFC, certain mechanisms provided allow the programmer to bypass modularity and encapsulation and information hiding, arguable the most desirable features of an Object Oriented framework. </p>\n\n<p>One (of many) examples is Owner Drawn controls: \nyou can choose to either implement <code>DrawItem</code> in a child control subclass and do all of that control's drawing in that subclass, making it appear more modular:</p>\n\n<pre><code>class CustomButton: CButton{\n     // --- Lots of stuff, DECLARE_DYNAMIC etc\n\n     virtual void DrawItem(LPDRAWITEMSTRUCT lpdis){\n          // Drawing code for this button in the button's subclass\n     }\n};\n</code></pre>\n\n<p>...or you can choose handle the <code>WM_DRAWITEM</code> message in a parent Window class via OnDrawItem</p>\n\n<pre><code>class MainFrame: CFrameWnd{\n     // --- Lots of stuff, DECLARE_DYNAMIC etc\n\n     CustomButton button; \n\n     afx_msg void OnDrawItem(LPDRAWITEMSTRUCT lpdis, UINT id){\n\n          if(id == CUSTOM_BUTTON_ID){     \n               // Drawing code for this button in the button's subclass\n          }\n     }\n};\n</code></pre>\n\n<p>In the later situation, the drawing of the control is outside of the control subclass, meaning that the concept that <a href=\"http://en.wikipedia.org/wiki/Object-oriented_programming#Overview\" rel=\"nofollow\">\"OOP data structures tend to carry their own operators around with them\"</a> is undermined.. right?</p>\n\n<p>So my question is: which one is considered 'best practice'? There must be a reason that the second one exists - can anyone suggest a circumstance in which undermining modularity would be a better option?</p>\n"},{"tags":["c","winapi","shell","explorer"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":405,"score":0,"question_id":1791601,"title":"What does explorer use to open a file?","body":"<p>I'm attempting to hook into whatever explorer calls when a file is opened (double-click, context menu open, etc.), however I can't figure out which function that is.</p>\n\n<p>Originally, I thought it was ShellExecute, as that does the same thing as far as I can tell, but after hooking into it I learned that it's only used when a new explorer window is opened.</p>\n\n<p>Any ideas which function I should be hooking?</p>\n"},{"tags":["linux","winapi","rpc","dcom"],"answer_count":1,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":144,"score":5,"question_id":13087092,"title":"RPC from Windows to linux","body":"<p>Is there some (working) example how to create RPC from windows to linux?</p>\n\n<p>Client should be windows NT application, server is linux.</p>\n\n<p>It <strong>needs</strong> to be <a href=\"http://en.wikipedia.org/wiki/Microsoft_RPC\" rel=\"nofollow\">MSRPC</a>. </p>\n\n<p>No Corba, no XML-RPC, SUN-RPC etc</p>\n\n<p>MSDN says <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa378651%28v=vs.85%29.aspx\" rel=\"nofollow\">this</a>:</p>\n\n<blockquote>\n  <p>RPC can be used in all client/server applications based on Windows\n  operating systems. It can also be used to create client and server\n  programs for heterogeneous network environments that include such\n  operating systems as <strong>Unix and Apple.</strong></p>\n</blockquote>\n\n<p>Unfortunately after spending few hours on google I'm giving up.</p>\n\n<p><strong>My expectation:</strong></p>\n\n<ul>\n<li>Linux node should have samba installed, because their MSRPC implementation works.</li>\n<li>Using IDL file I generate stubs for both client and server</li>\n<li>Client is built using MSVC</li>\n<li>Server is build using gcc with some includes/libraries from samba (or other libs)</li>\n<li>Linux node must have such RPC port mapper</li>\n</ul>\n\n<p>Can someone point me out?</p>\n"},{"tags":["c++","winapi","mfc","tabs","ctabctrl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13126085,"title":"Making an MFC CTabCtrl not use the full control width for drawing tabs","body":"<p>We have a somewhat involved request for a change in our application, which is to make one of our tab controls only have access to part of the width of the control for the purposes of drawing the tabs, so that we can stick some additional status text in the remaining area on the side.</p>\n\n<p>A picture would probably help:</p>\n\n<p><img src=\"http://i.stack.imgur.com/kcTaq.png\" alt=\"Complex UI Request\"></p>\n\n<p>As you can see, the tab control extends all the way to the right of the dialog, but we want a reserved area for \"Total Inventory Cost\", and we want to make sure that additional tabs (which are common) don't encroach onto that area.</p>\n\n<p>I'm open to pretty much any means of implementing this, short of completely rewriting the application.  We can switch tab controls if there's one out there that works better, or otherwise change the implementation of the tab setup within reason.</p>\n\n<p>I would have thought that one could separately set the client area and the tab drawing rectangle areas separately, but that doesn't seem to be the case.  Please correct me if I'm wrong.</p>\n\n<p>Any help appreciated!</p>\n"},{"tags":["c++","qt","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":192,"score":1,"question_id":11813782,"title":"Using Win32 API in QT for Windows","body":"<p>i'm migrating from .net C# to QT C++, and I'm trying to use this Win32 function to emulate drive in QT:</p>\n\n<pre><code>[DllImport(\"kernel32.dll\", CharSet = CharSet.Auto, SetLastError = true)]\nprivate static extern bool DefineDosDevice(int flags, string devname, string path);\n\n[DllImport(\"kernel32.dll\", CharSet = CharSet.Auto, SetLastError = true)]\nprivate static extern int QueryDosDevice(string devname, StringBuilder buffer, int bufSize);\n</code></pre>\n\n<p>The code above is in C# but i'm have no idea how to use them in QT, someone can give me an example how to do this and how to use any Win32 API in QT?</p>\n"},{"tags":["c++","winapi","com","directshow"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13124130,"title":"Seeking within different streams in DirectShow","body":"<p>In an application which I develop I play several layers of video using VMR9. The problem is that I need to be able to navigate within each video stream independently.</p>\n\n<p>Has anyone implemented something similar or know how to do it?</p>\n"},{"tags":["winapi","filesystems"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":347,"score":0,"question_id":6892117,"title":"How to get modified date in UTC","body":"<p><code>GetFileAttributesEx</code> returns the date that the filesystem returns, unmodified. NTFS stores dates in UTC, and FAT stores them in the local time zone. Without knowing the time zone, a date is pretty worthless.</p>\n\n<p><strong>What is the best way to reliably get the last modified date of a file in UTC?</strong> Is the best way really to just check for NTFS vs. FAT? What if you are using a different filesystem? Is there a different API I can use? Is there some elegant code someone can post here?</p>\n"},{"tags":["c++","windows","winapi","active-directory"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13116505,"title":"How to get password expiry date using C++ win32 API?","body":"<p>I am using C++ with the win32 Api and I want to get the password expiry date for a user using ADSI.</p>\n\n<pre><code>CoInitialize(NULL);\n\nLPWSTR pszADsPath=L\"LDAP://CN=arjun,CN=Users,DC=raja,DC=com\";\n//HRESULT hr;\nIADsUser *pUser;\n\nhr = ADsGetObject(pszADsPath, IID_IADsUser, (void**) &amp;pUser);\nif(SUCCEEDED(hr))\n{\n    DATE expirationDate;\n    VariantInit(&amp;var);\n    hr = pUser-&gt;get_PasswordLastChanged(&amp;expirationDate);\n    hr = pUser-&gt;get_PasswordExpirationDate(&amp;expirationDate);\n\n    if (SUCCEEDED(hr))\n        VariantTimeToSystemTime(expirationDate,&amp;lpExpirationDate);\n\n    pUser-&gt;Release();\n}\n</code></pre>\n\n<p>Calling <code>get_PasswordLastChanged</code> will give success and return last changed password date, but I need the expiration date.</p>\n\n<p>Using <code>get_PasswordExpirationDate</code>, I get <code>S_OK</code> (success) but it also gives an error code of <code>-2147463155</code>.</p>\n\n<p>Can anyone explain what is going wrong?</p>\n"},{"tags":["windows","security","api","debugging","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13109513,"title":"RPC integrity privilege in processs","body":"<p>I have 2 processes running in my system (Windows 7 )one of them is with medium integrity level and the second is with a low integrity level.</p>\n\n<p>if my medium integrity send an RPC call to the low integrity process does the code get execute in a low or medium integrity level ?</p>\n"},{"tags":["wpf","multithreading","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":10102757,"title":"What is alternative to C# WPF Dispatcher.Invoke(...) when using C function pointers and hooks?","body":"<p>How can do the same thing as C# WPF Dispatcher.Invoke(...) does in terms of C function pointers and Winapi hooks/messages?</p>\n\n<p>I want ask Windows C message loop to invoke my function pointer. I PostThreadMessage user defined message(WM_USER+XXX) from worker thread and invoke function  pointer in WH_GETMESSAGE hook. But seems my message is not handled or arrived to hook. Standard messages I post DO.</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13115983,"title":"RegSetValueExW creates a key instead of modifying / creating a value","body":"<p>I have a program that queries a key in the registry, appends some text to it and then writes it back.</p>\n\n<p>I got the querying part but when writing back the new text, this API <code>RegSetValueExW</code> actually creates a key under the opened key.</p>\n\n<p><code>RegSetValueExW(hKey,pValue,NULL,REG_SZ,(const LPBYTE)pPath.c_str(),pPath.size() * sizeof(WCHAR));</code></p>\n\n<p>As you can see above, the key is named <em><code>pValue</code></em>. If I omit the second parameter it writes to the <em><code>Default</code></em> value.</p>\n\n<p><strong>OS: Windows 7 Ultimate, 64-bit</strong></p>\n\n<p>Anybody know why this is happening?</p>\n"},{"tags":["c++","c","multithreading","winapi","console"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":13109805,"title":"Win32 Where is the console code running? Console hang when used from multiple threads","body":"<p>I have a Win32 app in C++ that uses two threads.\nThread A creates a console window using <code>AllocConsole()</code>.\nThread B prints into this console using <code>WriteFile</code> into the console handle (got from <code>GetStdHandle</code>).</p>\n\n<p>For some reason, when both threads print simultaniously to the console my process hangs.</p>\n\n<p>How can I fix this hang? What causes it?\nI want to debug the message loop for the console (It's a window right? So it should have messages) but I don't know how to access it?</p>\n"},{"tags":["c#",".net","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13104936,"title":"EVENT_OBJECT_DESTROY from Notepad on lost focus?","body":"<p>I'm trying to get alerted as to when an external application is closed.  For my test i've retrieved Notepad's hwnd and set it into my monitor.  Strangely, i get the system event whenever i click from notepad onto some other application even though notepad hasn't closed. Does anyone have any idea why?</p>\n\n<p>some quick example calling code:</p>\n\n<pre><code>uint EVENT_OBJECT_DESTROY = 0x8001;\nIntPtr notepadHwnd = &lt;your pointer&gt;\nvar mon = new WindowMonitor(notepadHwnd, EVENT_OBJECT_DESTROY);\nmon.EventOccurred += (sender, args) =&gt; Console.WriteLine(\"closed\");\n</code></pre>\n\n<p>The monitor:</p>\n\n<pre><code>  public class WindowMonitor : IDisposable\n  {\n    //store delegate to prevent GC\n    private User32.WinEventDelegate dEvent;\n\n    private IntPtr _hook;\n    private readonly IntPtr _window;\n    private readonly List&lt;uint&gt; _watchedEvents = new List&lt;uint&gt;();\n\n    public event EventHandler&lt;AccessibleEventTypeEventArgs&gt; EventOccurred;\n\n    public WindowMonitor(IntPtr windowToMonitor, params User32.AccessibleEventType[] eventsToMonitor)\n    {\n      //prevent junk\n      if (eventsToMonitor == null || eventsToMonitor.Length == 0)\n        throw new ArgumentNullException(\"eventsToMonitor\", \"Must specify events to monitor\");\n      if (windowToMonitor == IntPtr.Zero)\n        throw new ArgumentNullException(\"windowToMonitor\", \"Must specify a valid window handle to monitor\");\n\n      _window = windowToMonitor;\n\n      //cast them now so we dont have to cast each one when evaluting events\n      uint lowest = (uint) User32.AccessibleEventType.EVENT_MAX;\n      uint highest = (uint) User32.AccessibleEventType.EVENT_MIN;\n      foreach (User32.AccessibleEventType eventType in eventsToMonitor)\n      {\n        var castType = (uint) eventType;\n        _watchedEvents.Add(castType);\n\n        //need the range of events to subscribe to\n        if (castType &gt; highest)\n          highest = castType;\n        if (castType &lt; lowest)\n          lowest = castType;\n      }\n\n      //sign up for the event\n      dEvent = this.winEvent;\n      _hook = User32.SetWinEventHook(lowest, highest, IntPtr.Zero, dEvent, 0, 0, User32.WINEVENT_OUTOFCONTEXT);\n\n      //ensure it worked\n      if (IntPtr.Zero.Equals(_hook)) throw new Win32Exception();\n\n      //no kill callback\n      GC.KeepAlive(dEvent);\n    }\n\n    private void winEvent(IntPtr hWinEventHook, uint eventType, IntPtr hWnd, int idObject, int idChild, uint dwEventThread, uint dwmsEventTime)\n    {\n      //only care about the events for the specified window\n      if (hWnd != _window)\n        return;\n\n      if (_watchedEvents.Contains(eventType))\n      {\n        if (EventOccurred != null)\n          EventOccurred(this, new AccessibleEventTypeEventArgs((User32.AccessibleEventType) eventType));\n      }\n    }\n\n    public void Dispose()\n    {\n      //unhook the listener\n      if (!IntPtr.Zero.Equals(_hook))\n        User32.UnhookWinEvent(_hook);\n\n      //clear variables\n      _hook = IntPtr.Zero;\n      dEvent = null;\n\n      //kill any event listeners\n      EventOccurred = null;\n\n      GC.SuppressFinalize(this);\n    }\n  }\n</code></pre>\n\n<p>and some winapi (i omitted the list of event consts):</p>\n\n<pre><code>public delegate void WinEventDelegate(IntPtr hWinEventHook, uint eventType, IntPtr hwnd,\n  int idObject, int idChild, uint dwEventThread, uint dwmsEventTime);\n\n[DllImport(\"user32.dll\")]\npublic static extern IntPtr SetWinEventHook(uint eventMin, uint eventMax, IntPtr hmodWinEventProc,\n  WinEventDelegate lpfnWinEventProc, uint idProcess, uint idThread, uint dwFlags);\n\n[DllImport(\"user32.dll\")]\npublic static extern bool UnhookWinEvent(IntPtr hWinEventHook);\n</code></pre>\n"},{"tags":["c++","winapi","com","directx","direct2d"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":214,"score":0,"question_id":9979848,"title":"IWICImagingFactory::CreateDecoderFromStream() fails, error message message is not helpful","body":"<p>I'm trying to load a ID2D1Bitmap from a bitmap resource. To do so, I consulted an <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd756685%28v=vs.85%29.aspx\" rel=\"nofollow\">MSDN guide</a> which told me to use the Windows Imaging Component (IWIC) to process the image before Direct2D uses it.</p>\n\n<p>However, it fails when I call <code>CreateDecoderFromStream()</code>, and it returns a strange error message – <code>0x88982f50</code> – that tells me nothing. I've searched Google and used DirectX Error Lookup. The DirectX Error Lookup tool only tells me this:</p>\n\n<pre><code>HRESULT: 0x88982f50 (2291674960)\nName: Unknown\nDescription: n/a\nSeverity code: Failed\nFacility Code: FACILITY_DWRITE (2200)\nError Code: 0x2f50 (12112)\n</code></pre>\n\n<p>This is the code I'm using to try and load an ID2D1Bitmap from a resource:</p>\n\n<pre><code>int LoadBitmapFromResource( IWICImagingFactory *pIWICFactory, ID2D1RenderTarget *pRT, int resID, ID2D1Bitmap **ppD2DBitmap )\n{\n    int errmsg;\n\n    HRSRC hbmp;\n    HGLOBAL hbmpdata;\n    void *pbmp; //system memory pointer to bitmap resource\n    DWORD bmpsize;\n    IWICStream *pStream;\n    IWICBitmapDecoder *pbmpdecoder;\n    IWICBitmapFrameDecode *pSource;\n    IWICFormatConverter *pConverter;\n\n    hbmp = FindResourceW( GetModuleHandleW(NULL), MAKEINTRESOURCEW(resID), RT_BITMAP );\n    if( NULL == hbmp )\n    {\n        printf(\"LoadBitmapFromResource::FindResourceW() error: %d\\r\\n\", GetLastError() );\n        return GetLastError();\n    }\n\n    hbmpdata = LoadResource( GetModuleHandleW(NULL), hbmp );\n    if( NULL == hbmpdata )\n    {\n        printf(\"LoadBitmapFromResource::LoadResource() error: %d\\r\\n\", GetLastError() );\n        return GetLastError();\n    }\n\n    pbmp = LockResource( hbmpdata );\n    if( NULL == pbmp )\n    {\n        printf(\"LoadBitmapFromResource::LockResource() error: %d\\r\\n\", GetLastError() );\n        return GetLastError();\n    }\n\n    bmpsize = SizeofResource( GetModuleHandleW(NULL), hbmp );\n    if( NULL == bmpsize )\n    {\n        printf(\"LoadBitmapFromResource::SizeofResource() error: %d\\r\\n\", GetLastError() );\n        return GetLastError();\n    }\n\n    errmsg = pIWICFactory-&gt;CreateStream( &amp;pStream );\n    if( !SUCCEEDED(errmsg) )\n    {\n        printf(\"LoadBitmapFromResource::CreateStream() error: %x\\r\\n\", errmsg );\n        return errmsg;\n    }\n\n    errmsg = pStream-&gt;InitializeFromMemory( (BYTE*)pbmp, bmpsize );\n    if( !SUCCEEDED(errmsg) )\n    {\n        printf(\"LoadBitmapFromResource::InitializeFromMemory() error: %x\\r\\n\", errmsg );\n        return errmsg;\n    }\n\n    errmsg = pIWICFactory-&gt;CreateDecoderFromStream( pStream, NULL, WICDecodeMetadataCacheOnLoad, &amp;pbmpdecoder );\n    if( !SUCCEEDED(errmsg) )\n    {\n        printf(\"LoadBitmapFromResource::CreateDecoderFromStream() error: %x\\r\\n\", errmsg );\n        return errmsg;\n    }\n\n    errmsg = pbmpdecoder-&gt;GetFrame( 0, &amp;pSource );\n    if( !SUCCEEDED(errmsg) )\n    {\n        printf(\"LoadBitmapFromResource::GetFrame() error: %x\\r\\n\", errmsg );\n        return errmsg;\n    }\n\n    errmsg = pIWICFactory-&gt;CreateFormatConverter( &amp;pConverter );\n    if( !SUCCEEDED(errmsg) )\n    {\n        printf(\"LoadBitmapFromResource::CreateFormatConverter() error: %x\\r\\n\", errmsg );\n        return errmsg;\n    }\n\n    errmsg = pConverter-&gt;Initialize( pSource, GUID_WICPixelFormat32bppPBGRA, WICBitmapDitherTypeNone, NULL, 0.0f, WICBitmapPaletteTypeMedianCut );\n    if( !SUCCEEDED(errmsg) )\n    {\n        printf(\"LoadBitmapFromResource::Initialize() error: %x\\r\\n\", errmsg );\n        return errmsg;\n    }\n\n    errmsg = pRT-&gt;CreateBitmapFromWicBitmap( pConverter, ppD2DBitmap );\n    if( !SUCCEEDED(errmsg) )\n    {\n        printf(\"LoadBitmapFromResource::CreateBitmapFromWicBitmap() error: %x\\r\\n\", errmsg );\n        return errmsg;\n    }\n\n    pConverter-&gt;Release();\n    pSource-&gt;Release();\n    pbmpdecoder-&gt;Release();\n    pStream-&gt;Release();\n\n    return 0;\n}\n</code></pre>\n"},{"tags":["c#","winforms","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":37,"score":0,"question_id":13112586,"title":"Receiving system messages for window created by 'CreateWindowEx' function (API)","body":"<p>I create control by 'CreateWindowEx' function, and I want to get system messages (mouse, keyboard, etc.) of this window, how do I write the function that gets the messages? </p>\n"},{"tags":["delphi","winapi","alpha","vcl"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":92,"score":2,"question_id":13109267,"title":"How can I create alpha blended icon/cursor (indirect) from the TBitmap instance of 32 bpp w/o making an temporary DIB section?","body":"<p>According to <a href=\"http://support.microsoft.com/kb/318876\" rel=\"nofollow\">MS KB entry</a>, there is a quirk in <code>CreateIconIndirect</code> which recognizes <code>HBITMAP</code>s been created with <code>BITMAPV5HEADER</code> passed to <code>CreateDIBSection</code> (and BGRA channel layout). </p>\n\n<p>However,  <code>TBitmap</code> instances with <code>(PixelFormat = pf32bit) and (AlphaFormat = afDefined)</code> (behaving as alpha blended for the other purposes) when referred by its <code>Handle</code>s are not being recognized as valid alpha blended bitmaps for creation of icons or cursors.</p>\n\n<p>Currently, I have to create a full copy of TBitmap using described API calls (<a href=\"http://support.microsoft.com/kb/318876\" rel=\"nofollow\">see</a>) to make <code>CreateIconIndirect</code> accept a bitmap handle as alpha blended. How do I overcome this clumsiness?</p>\n"},{"tags":[".net","windows","winapi","windows-identity"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":65,"score":3,"question_id":13094142,"title":"How to get the current Windows user's *network* identity, not their interactive log-on identity?","body":"<p><strong>Question</strong>:</p>\n\n<p>What is the .NET (or p/invoke to an unmanaged Windows API) method call to get the current process's <strong>network identity</strong> that is used to connect to SSPI-authenticated network services, such as SQL Server?</p>\n\n<hr>\n\n<p>The specific use-case I have in mind is where one can work on a non-domain-joined machine and use <code>runas /noprofile /netonly /USER:DOMAIN\\username</code> to launch a process which uses that <code>DOMAIN\\username</code> identity for network authentication instead of their local <code>MACHINE\\username</code> logged-on identity.</p>\n\n<p>I want the method call that gives me the <code>DOMAIN\\username</code> identity passed to <code>RUNAS</code> here.</p>\n\n<p>Thanks!</p>\n\n<hr>\n\n<p>To be clear, I am <em>NOT</em> looking for the method call to get the current user's locally logged on identity (which may be different than the network identity). This <em>excludes</em> <code>System.Security.Principal.WindowsIdentity.GetCurrent().Name</code> and <code>Environment.UserName</code> and probably <code>System.Threading.Thread.CurrentPrincipal.Identity.Name</code> from being accepted answers. I will downvote any answer that incorrectly indicates any of these to be the solution, unless I am shown to be wrong here of course. :)</p>\n"},{"tags":["perl","scripting","winapi","cmd"],"answer_count":5,"favorite_count":4,"up_vote_count":3,"down_vote_count":0,"view_count":2548,"score":3,"question_id":1695188,"title":"How do I make Perl scripts recognize parameters in the Win32 cmd console?","body":"<p>When I invoke my Perl scripts in the Windows environment without invoking <code>perl</code> first, the parameters are not passed to my script.</p>\n\n<p>For example,</p>\n\n<pre><code>C:\\&gt; C:\\my-perl-scripts\\foo.pl bar\n</code></pre>\n\n<p>invokes <code>foo.pl</code> but doesn't recognize <code>bar</code> as a parameter (<code>@ARGV</code> is empty). However, </p>\n\n<pre><code>C:\\&gt; perl C:\\my-perl-scripts\\foo.pl bar\n</code></pre>\n\n<p>works as expected.</p>\n\n<p>Is this a configuration issue?</p>\n\n<p>Ideally, I'd like to be able to distribute some perl scripts, have the user add <code>C:\\my-perl-scripts\\</code> to the path and then just be able to invoke <code>foo.pl</code> from anywhere while running cmd.</p>\n\n<p>If they have to specify perl first, then they'll always have to give a complete path.</p>\n\n<p>Any ideas or recommendations?</p>\n\n<p><strong>Edit:</strong> To show that the assoc and ftype are correct on my system, I executed the following commands.</p>\n\n<pre><code>C:\\&gt;assoc .pl\n.pl=Perl\n\nC:\\&gt;ftype Perl\nPerl=\"C:\\Perl\\bin\\perl.exe\" \"%1\" %*\n\nC:\\&gt;more t.pl\nprint \"'$_'\\n\" for @ARGV;\n\nC:\\&gt;t a b\n\nC:\\&gt;perl t.pl a b\n'a'\n'b'\n\nC:\\&gt;t.pl a b\n\nC:\\&gt;\n</code></pre>\n\n<p>I included both the output of t and t.pl to show it's not a %PATHEXT% problem. Both outputted nothing as originally described whereas invoking perl first gave the expected response.</p>\n\n<p>I'm not sure where to look next, but thanks for the suggestions so far. They have been very helpful.    </p>\n\n<p><strong>Edit 2:</strong> The problem appears to be on my vista business box. On my xp pro box, it works as expected. Both have ActivePerl 5.8.9. I have another vista home box that I have not yet tried yet. I'll post back if I discover anything.</p>\n\n<p><strong>Edit 3:</strong> I found the answer (posted below). I found it by running a registry cleaner, removing perl, running the registry cleaner again. On 2nd cleaning, only one invalid entry remained - the one that was causing the problem (probably left over from a previous installation).</p>\n"},{"tags":["c#","winapi","mime-types","mime","urlmon"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":337,"score":3,"question_id":6622015,"title":"Why does FindMimeFromData recognize image/tiff on one host, but doesn't on another one?","body":"<p>I'm using <code>FindMimeFromData</code> from <code>urlmon.dll</code> for sniffing uploaded files' MIME type. According to <a href=\"http://msdn.microsoft.com/en-us/library/ms775147%28VS.85%29.aspx#Known_MimeTypes\" rel=\"nofollow\">MIME Type Detection in Internet Explorer</a>, <code>image/tiff</code> is one of the recognized MIME types. It works fine on my development machine (Windows 7 64bit, IE9), but doesn't work on the test env (Windows Server 2003 R2 64bit, IE8) - it returns <code>application/octet-stream</code> instead of <code>image/tiff</code>.</p>\n\n<p>The above article describes the exact steps taken to determine the MIME type, but since <code>image/tiff</code> is one of the 26 recognized types, it should end on step 2 (sniffing the actual data), so that file extensions and registered applications (and other registry stuff) shouldn't matter.</p>\n\n<p>Oh and by the way, TIFF files actually <strong>are</strong> associated with a program (Windows Picture and Fax Viewer) on the test server. It's not that any reference to TIFF is absent in Windows registry.</p>\n\n<p>Any ideas why it doesn't work as expected?</p>\n\n<p><strong>EDIT:</strong> FindMimeFromData is used like this:</p>\n\n<pre><code>public class MimeUtil\n{\n    [DllImport(\"urlmon.dll\", CharSet = CharSet.Unicode, ExactSpelling = true, SetLastError = false)]\n    private static extern int FindMimeFromData(\n        IntPtr pBC,\n        [MarshalAs(UnmanagedType.LPWStr)] string pwzUrl,\n        [MarshalAs(UnmanagedType.LPArray, ArraySubType = UnmanagedType.I1, SizeParamIndex = 3)] byte[] pBuffer,\n        int cbSize,\n        [MarshalAs(UnmanagedType.LPWStr)] string pwzMimeProposed,\n        int dwMimeFlags,\n        out IntPtr ppwzMimeOut,\n        int dwReserved);\n\n    public static string GetMimeFromData(byte[] data)\n    {\n        IntPtr mimetype = IntPtr.Zero;\n        try\n        {\n            const int flags = 0x20; // FMFD_RETURNUPDATEDIMGMIMES\n            int res = FindMimeFromData(IntPtr.Zero, null, data, data.Length, null, flags, out mimetype, 0);\n            switch (res)\n            {\n                case 0:\n                    string mime = Marshal.PtrToStringUni(mimetype);\n                    return mime;\n                // snip - error handling\n                // ...\n                default:\n                    throw new Exception(\"Unexpected HRESULT \" + res + \" returned by FindMimeFromData (in urlmon.dll)\");\n            }\n        }\n        finally\n        {\n            if (mimetype != IntPtr.Zero)\n                Marshal.FreeCoTaskMem(mimetype);\n        }\n    }\n}\n</code></pre>\n\n<p>which is then called like this:</p>\n\n<pre><code>protected void uploader_FileUploaded(object sender, FileUploadedEventArgs e)\n{\n    int bsize = Math.Min(e.File.ContentLength, 256);\n    byte[] buffer = new byte[bsize];\n    int nbytes = e.File.InputStream.Read(buffer, 0, bsize);\n    if (nbytes &gt; 0)\n        string mime = MimeUtil.GetMimeFromData(buffer);\n    // ...\n}\n</code></pre>\n"},{"tags":["winapi"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13108210,"title":"How to redirect an abitrary window to be rendered to an in-memory backbuffer?","body":"<p>I am experimenting with a home-grown application hosting framework, and I'd like to abstract the input/output so I can gracefully handle crashes. Chrome uses a very similar model.</p>\n\n<p>Is there any way I can take an arbitrary window handle, and persuaded it to start rendering to a back-buffer?  Or should I create my own window first, and then reparent the client app into it?</p>\n"},{"tags":["c++","winapi","microsoft","crypt"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":24,"score":-1,"question_id":13106688,"title":"CryptAcquireContextA randomly hang","body":"<p>It's been almost a month that I'm hunting this bug and I found out this.</p>\n\n<p>I have 8 IOCP threads pumping incoming packets from clients.</p>\n\n<p>After awhile 7 threads hung in the same critical section while the 8th thread hung in <code>CryptAcquireContextA()</code>.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>static bool Decrypt(BYTE* Buffer, char* Key, int length)\n{\n    EnterCriticalSection(&amp;mProtocolCSection); // 7 threads hangs here\n\n    HCRYPTPROV pCryptprov;\n    HCRYPTHASH pCryptHash;\n    HCRYPTKEY  pCryptKey;\n\n    if (CryptAcquireContextA(&amp;pCryptprov, NULL, \n            \"Microsoft Enhanced Cryptographic Provider v1.0\", \n            PROV_RSA_FULL, CRYPT_NEWKEYSET) == 0) // 8th thread hangs here\n    {\n        ...\n    }\n\n    LeaveCriticalSection(&amp;mProtocolCSection);\n}\n</code></pre>\n\n<p>Here is the current stack of when the 8th thread is hanged: <a href=\"http://i45.tinypic.com/ixzg52.png\" rel=\"nofollow\">http://i45.tinypic.com/ixzg52.png</a></p>\n\n<p><img src=\"http://i.stack.imgur.com/ILmDE.png\" alt=\"enter image description here\"></p>\n\n<p>It's stuck at <code>NtWaitForSingleObject(0xB4, 0, 0);</code>.</p>\n\n<p>Why would <code>CryptAcquireContextA</code> suddenly call that after 2 hours of perfect running time?</p>\n"},{"tags":["python","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13106589,"title":"Using Win32 api from python","body":"<p>Following code has been given in the activestate python help file. This code is for recursively deleting a files in folder followed by deleting the folder itself. Please point out the error in it because I want to use win32 api using python</p>\n\n<pre>\nimport win32con\nimport win32api\nimport os\n\ndef del_dir(path):\n    for file_or_dir in os.listdir(path):\n        if os.path.isdir(file_or_dir) and not os.path.islink(file_or_dir):\n            del_dir(file_or_dir) #recursive call to function again\n        else:\n            try:\n                os.remove(file_or_dir) #it's a file,delete is\n            except:\n                #probably failed because it is not a normal file\n                win32api.SetFileAttributes(file_or_dir,win32con.FILE_ATTRIBUTE_NORMAL)\n                os.remove(file_or_dir) #it's a file delete it\n\n        os.rmdir(path)#delete the directory here\n</pre>\n"},{"tags":["winapi","wininet"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":305,"score":0,"question_id":8680551,"title":"InternetReadFile() reads data but returns false and sets number of bytes read to zero","body":"<p>Making an asynchronous request with Wininet, when the status callback function is called with INTERNET_STATUS_REQUEST_COMPLETE, I get the http status code.</p>\n\n<pre><code>result = HttpQueryInfo(\n    this-&gt;requestHandle,\n    HTTP_QUERY_STATUS_CODE | HTTP_QUERY_FLAG_NUMBER,\n    &amp;value,\n    &amp;sizeofDword,\n    &amp;index);\n</code></pre>\n\n<p>The status code returned is 200. After that, I call InternetReadFile(). </p>\n\n<pre><code>result = InternetReadFile(\n    this-&gt;requestHandle,\n    ((char*)(this-&gt;buffer)) + this-&gt;totalBytesReceived,\n    this-&gt;bufferSize - this-&gt;totalBytesReceived,\n    &amp;bytesRead);\n\nthis-&gt;totalBytesReceived += bytesRead;\n</code></pre>\n\n<p>It returns true and sets lpNumberOfBytesRead to zero. GetLastError() returns ERROR_IO_PENDING, then I wait the callback function is called again with INTERNET_STATUS_REQUEST_COMPLETE. </p>\n\n<p>When that occurs, InternetReadFile() returns true and again sets lpNumberOfBytesRead to zero.</p>\n\n<p>If I debug the application, I can see after the first InternetReadFile() that the response data is already on the lpBuffer. Moreover, if I call Sleep() for one second before InternetReadFile(), InternetReadFile() works correctly.</p>\n\n<pre><code>Sleep(1000);\n\nresult = InternetReadFile( ...\n</code></pre>\n\n<p>Am I missing any step? </p>\n"},{"tags":["c","windows","winapi","messagebox"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":626,"score":0,"question_id":5455111,"title":"How can I cause my MessageBox to pop up on top of all forms?","body":"<p>I am currently providing information to the user with a message box in my C program, but the message box is appearing behind all other forms of my application.</p>\n\n<p>How can I bring it forward so that it appears in front of all my forms, or set its parent?</p>\n\n<p>Here is the code I'm currently using to show the message box:</p>\n\n<pre><code>MessageBox(0,error_msg, \"Error - No Algorithm\", MB_OK );\n</code></pre>\n"},{"tags":["c++","winapi","selection","clistctrl"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2985,"score":1,"question_id":1729260,"title":"How to set an item in CListCtrl as selected?","body":"<p>ClistCtrl is set to single selection &amp; single column in report view with no header.  </p>\n\n<p>I have tried <code>SetItemState(0,LVIS_SELECTED,LVIF_STATE)</code> and<br>\n <code>SetSelectionMark(int index)</code> but these don't work.</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13105099,"title":"How do I store the objects created with the polyline function?","body":"<p>I am using the polyline function to draw triangles in c++. I am having problems in getting the triangles to store in a struct (for them to be repainted when the window is invaldiated)</p>\n\n<pre><code>#define MAX_OBJECTS 10000\n\ntypedef struct\n{\nunsigned int topCornerX;\nunsigned int topCornerY;\nunsigned int RightX;\nunsigned int RightY;\nunsigned int LeftX;\nunsigned int LeftY;\n\n}Triangles;\n\nint mouse_down_x = 0;\nint mouse_down_y = 0;\n\n\n\nTriangles triangleList[MAX_OBJECTS];\nTriangles temp_tri;\nint current_tri_count = 0;\nint t = 0;\n\nLRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\nint wmId, wmEvent;\nPAINTSTRUCT ps;\nHDC hdc;\nPOINT Pt[4];\nPOINT pT[4];\n</code></pre>\n\n<p>I am using this one to draw the temp triangle</p>\n\n<pre><code>Pt[0].x = temp_tri.topCornerX;  Pt[0].y = temp_tri.topCornerY;\nPt[1].x = temp_tri.LeftX; Pt[1].y = temp_tri.LeftY;\nPt[2].x = temp_tri.RightX; Pt[2].y = temp_tri.RightY;\nPt[3].x = temp_tri.topCornerX; Pt[3].y = temp_tri.topCornerY;\n</code></pre>\n\n<p>this one is to redraw all the previous triangles, however it isn't working</p>\n\n<pre><code>pT[0].x = triangleList[t].topCornerX;\npT[0].y = triangleList[t].topCornerX;\npT[1].x = triangleList[t].LeftX;\npT[1].y = triangleList[t].LeftY;\npT[2].x = triangleList[t].RightX;\npT[2].y = triangleList[t].RightY;\npT[3].x = triangleList[t].topCornerX;\npT[3].y = triangleList[t].topCornerY;\n\ncase WM_PAINT:\n    hdc = BeginPaint(hWnd, &amp;ps);\n\nPolyline(hdc, Pt, 4); // using this one to draw the temp triangle as the object is drawn by user\n\nwhile (t &lt; current_tri_count) // should be redrawing the old ones\n    {\n        Polyline(hdc,pT,4);\n        t++;\n\n\n    }\n\n\ncase WM_LBUTTONDOWN:\n\nmouse_down_x = LOWORD(lParam);\n        mouse_down_y = HIWORD(lParam);\n\n        temp_tri.topCornerX = mouse_down_x;\n        temp_tri.topCornerY = mouse_down_y;\n\n        mouse_down = true;\n\nbreak;\n\ncase WM_MOUSEMOVE:\n\nif(mouse_down)\n        {\n            temp_tri.LeftX = LOWORD(lParam);\n            temp_tri.LeftY = HIWORD(lParam);\n            temp_tri.RightX = LOWORD(lParam) + 90;\n            temp_tri.RightY = HIWORD(lParam) + 90;\n            mouse_down = true;\n\n        }\n        InvalidateRect(hWnd, NULL, true);\n\nbreak;\n\ncase WM_LBUTTONUP:\n\n                          temp_tri.LeftX = LOWORD(lParam);\n        temp_tri.LeftY = HIWORD(lParam);\n        temp_tri.RightX = LOWORD(lParam) + 90;\n        temp_tri.RightY = HIWORD(lParam) + 90;\n\n        triangleList[current_tri_count] = temp_tri;\n\n        current_tri_count ++;\n        mouse_down = false;\n\nbreak;\n</code></pre>\n"},{"tags":["winapi","dll","windows-7","injection","createremotethread"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1053,"score":0,"question_id":9456228,"title":"CreateRemoteThread returning ERROR_ACCESS_DENIED - Windows 7 DLL Injection","body":"<p>I'm trying to write a program that uses <code>CreateRemoteThread</code> to inject a dll.</p>\n\n<p>The problem is that CreateRemoteThread is refusing to work. GetLastError() is returning 5 which is ERROR_ACCESS_DENIED. I cant figure why!</p>\n\n<p>I am working from this video <a href=\"http://www.youtube.com/watch?v=H3O3hmXkt1I\" rel=\"nofollow\">http://www.youtube.com/watch?v=H3O3hmXkt1I</a> . </p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;direct.h&gt;\n#include &lt;Windows.h&gt;\n#include &lt;TlHelp32.h&gt;\n\nusing namespace std;\n\n\nchar* GetCurrentDir()\n{\n    char*   szRet = (char*)malloc(MAX_PATH);\n    _getcwd(szRet, MAX_PATH);\n    return szRet;\n}\n\nLPCTSTR SzToLPCTSTR(char* szString)\n{\n    LPTSTR  lpszRet;\n    size_t  size = strlen(szString)+1;\n\n    lpszRet = (LPTSTR)malloc(MAX_PATH);\n    mbstowcs_s(NULL, lpszRet, size, szString, _TRUNCATE);\n\n    return lpszRet;\n}\n\nvoid WaitForProcessToAppear(LPCTSTR lpcszProc, DWORD dwDelay)\n{\n    HANDLE          hSnap;\n    PROCESSENTRY32  peProc;\n    BOOL            bAppeared = FALSE;\n\n    while(!bAppeared)\n    {\n        if((hSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0)) != INVALID_HANDLE_VALUE)\n        {\n            peProc.dwSize = sizeof(PROCESSENTRY32);\n            if(Process32First(hSnap, &amp;peProc))\n                while(Process32Next(hSnap, &amp;peProc) &amp;&amp; !bAppeared)\n                    if(!lstrcmp(lpcszProc, peProc.szExeFile))\n                        bAppeared = TRUE;\n        }\n        CloseHandle(hSnap);\n        Sleep(dwDelay);\n    }\n}\n\nDWORD GetProcessIdByName(LPCTSTR lpcszProc)\n{\n    HANDLE          hSnap;\n    PROCESSENTRY32  peProc;\n    DWORD           dwRet = -1;\n\n    if((hSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0)) != INVALID_HANDLE_VALUE)\n    {\n        peProc.dwSize = sizeof(PROCESSENTRY32);\n        if(Process32First(hSnap, &amp;peProc))\n            while(Process32Next(hSnap, &amp;peProc))\n                if(!lstrcmp(lpcszProc, peProc.szExeFile))\n                    dwRet = peProc.th32ProcessID;\n    }\n    CloseHandle(hSnap);\n\n    return dwRet;\n}\n\nBOOL InjectDll(DWORD dwPid, char* szDllPath)\n{\n    DWORD   dwMemSize;\n    HANDLE  hProc;\n    LPVOID  lpRemoteMem, lpLoadLibrary;\n    BOOL    bRet = FALSE;\n\n    if((hProc = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid)) != NULL)\n    {\n        dwMemSize = strlen(szDllPath);\n        if((lpRemoteMem = VirtualAllocEx(hProc, NULL, dwMemSize, MEM_COMMIT, PAGE_READWRITE)) != NULL)\n            if(WriteProcessMemory(hProc, lpRemoteMem, szDllPath, dwMemSize, NULL))\n            {\n                lpLoadLibrary = GetProcAddress(GetModuleHandleA(\"kernel32.dll\"), \"LoadLibraryA\");\n                if(CreateRemoteThread(hProc, NULL, 0, (LPTHREAD_START_ROUTINE)lpLoadLibrary, lpRemoteMem, 0, NULL) != NULL)\n                {\n                    bRet = TRUE;\n                }\n                cout &lt;&lt; GetLastError();\n            }\n    }\n    CloseHandle(hProc);\n\n    return bRet;\n}\n\nint main()\n{\n    char    szProc[MAX_PATH], szDll[MAX_PATH];\n    char*   szDllPath = (char*)malloc(MAX_PATH);\n    LPTSTR  lpszProc = NULL;\n\n    for(;;)\n    {\n        cout &lt;&lt; \"Process: \";\n        cin &gt;&gt; szProc;\n        cout &lt;&lt; \"DLL: \";\n        cin &gt;&gt; szDll;\n\n        szDllPath = GetCurrentDir();\n        strcat_s(szDllPath, MAX_PATH, \"\\\\\");\n        strcat_s(szDllPath, MAX_PATH, szDll);\n\n        cout &lt;&lt; \"Waiting for process.. .\" &lt;&lt; szDllPath &lt;&lt; \" \" &lt;&lt; szDll &lt;&lt; endl;\n        WaitForProcessToAppear(SzToLPCTSTR(szProc), 100);\n        if(InjectDll(GetProcessIdByName(SzToLPCTSTR(szProc)), szDllPath))\n            cout &lt;&lt; \"Injection Succeeded!\" &lt;&lt; endl;\n        else\n            cout &lt;&lt; \"Injection Failed!\" &lt;&lt; endl;\n        cout &lt;&lt; \"\\n\";\n\n    }\n\n    return 0;\n</code></pre>\n\n<p>After a fair amount of googling I cant find a reason why this should not be working.</p>\n\n<p>Does CreateRemoteThread not work under Windows 7 ? \nIf it does, have I made any obvious mistakes ?</p>\n"},{"tags":["ruby","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":309,"score":1,"question_id":8694658,"title":"Screen capture using Ruby","body":"<p>I am trying to capture the screen using ruby while running on a windows system, I have tried Win32::Screenshot and cannot get it to compile using ruby 1.9.3 as the development tools are not working. I need an array of either RGB values for each pixel on the screen or an array of unique colour values from the same source - I have tried the below code but it is far too slow - I need a capture time of ~100ms and this code takes about 1.5-2s on my machine 1920x1200 resolution.</p>\n\n<pre><code>require 'Win32API'\n\nmodule Foo\n  GetSystemMetrics = Win32API.new \"User32.dll\", \"GetSystemMetrics\", [\"L\"], \"L\"\n  GetDC = Win32API.new \"User32.dll\", \"GetDC\", [\"L\"], \"L\"\n  GetDesktopWindow = Win32API.new \"User32.dll\", \"GetDesktopWindow\", [], \"L\"\n  CreateCompatibleDC = Win32API.new \"Gdi32.dll\", \"CreateCompatibleDC\", [\"L\"], \"L\"\n  CreateCompatibleBitmap = Win32API.new \"Gdi32.dll\", \"CreateCompatibleBitmap\", [\"L\",\"L\",\"L\"], \"L\"\n  SelectObject = Win32API.new \"Gdi32.dll\",\"SelectObject\", [\"L\",\"L\"], \"L\"\n  BitBlt = Win32API.new \"Gdi32.dll\",\"BitBlt\", [\"L\",\"L\",\"L\",\"L\",\"L\",\"L\",\"L\",\"L\",\"L\"], \"L\"\n  CAPTUREBLT = 0x40000000 \n  SRCCOPY = 0x00CC0020\n  GetDIBits = Win32API.new \"Gdi32.dll\",\"GetDIBits\", [\"L\",\"L\",\"L\",\"L\",\"P\",\"P\",\"L\"], \"L\"\n  DIB_RGB_COLORS = 0\n  BI_RGB = 0\n\n  def self.getscreen\n    width = GetSystemMetrics.call 0\n    height = GetSystemMetrics.call 1    \n    puts \"Screen width: #{width}\"\n    puts \"Screen height: #{height}\"\n\n    desktop_handle = GetDesktopWindow.call\n    raise \"GetDesktopWindow failed\" if desktop_handle == 0\n    hddc = GetDC.call desktop_handle\n    raise \"Get DC failed.\" if hddc == 0\n    hcdc = CreateCompatibleDC.call hddc\n    raise \"CreateCompatibleDC failed\" if hcdc == 0\n\n    hbitmap = CreateCompatibleBitmap.call hddc, width, height\n    raise \"CreateCompatibleBitmap failed\" if hbitmap == 0\n    result = SelectObject.call hcdc, hbitmap\n    raise \"SelectObject failed\" if result == 0   # not sure if this is right\n\n    result = BitBlt.call hcdc, 0, 0, width, height, hddc, 0, 0, SRCCOPY | CAPTUREBLT\n    raise \"BitBlt failed\" if result == 0\n\n    SelectObject.call hcdc, 0   # attempt to deselect the bitmap because GetDIBits requires it?\n\n    size_in_bytes = width*height*4\n    bitmap_info = [\n      40, #biSize\n      width,\n      height,\n      1, #biPlanes\n      32, #biBitCount\n      BI_RGB, #biCompression\n      size_in_bytes,\n      2000, #biXPelsPerMeter: not used?\n      2000, #biYPelsPerMeter: not used?\n      0, # biClrUsed\n      0 # biClrImportant\n    ].pack(\"LLLSSLLLLLL\") #+ [0,0,0,0].pack(\"LLLL\")\n\n    buffer = (\" \" * size_in_bytes).force_encoding(\"BINARY\")\n\n    result = GetDIBits.call hcdc, hbitmap, 0, height, buffer, bitmap_info, DIB_RGB_COLORS\n    raise \"GetDIBits failed.\" if result == 0\n    puts \"Number of scan lines copied: #{result}\"\n    puts \"buffer contents: \" + buffer.strip.inspect[0,100] + \" ...\"\n    puts \"First pixel = %02x,%02x,%02x,%02x\" % [buffer[0].ord, buffer[1].ord, buffer[2].ord, buffer[3].ord]\n\n    return buffer\n  end\nend\n\nFoo.getscreen\n</code></pre>\n\n<p>Can anyone assist with some ruby code that will provide the required array (either RGB or non RGB) within the required timeframe (something fast should be possible but I have no idea how to implement it) </p>\n"},{"tags":["winapi","windows-8","hotkey","registerhotkey"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":175,"score":0,"question_id":11767458,"title":"How do you register a custom Win+V hotkey on Windows 8?","body":"<p>It was possible to register the Win+V hotkey on versions of Windows prior to Windows 8. An example application using this combination is <a href=\"http://www.stevemiller.net/puretext/\" rel=\"nofollow\">PureText</a>. </p>\n\n<p>With the Windows 8 Release Preview I've noticed that Windows 8 has taken control of a lot of hotkeys involving Windows key, but Win+V doesn't appear to be used. The following code will allow me to register a hotkey for Win+CTRL+V:</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n\nint _tmain(int argc, _TCHAR* argv[])\n{\n    if (RegisterHotKey(\n        NULL,\n        1,\n        MOD_WIN | MOD_NOREPEAT | MOD_CONTROL,\n        0x56))  // 0x56 is 'v'\n    {\n        _tprintf(_T(\"Hotkey 'CTRL+WIN+V' registered, using MOD_NOREPEAT flag\\n\"));\n    }\n\n    MSG msg = {0};\n    while (GetMessage(&amp;msg, NULL, 0, 0) != 0)\n    {\n        if (msg.message == WM_HOTKEY)\n        {\n            _tprintf(_T(\"WM_HOTKEY received\\n\"));            \n        }\n    } \n\n    return 0;\n}\n</code></pre>\n\n<p>If I modify it to register just Win+V then it'll fail to register:</p>\n\n<pre><code>if (RegisterHotKey(\n    NULL,\n    1,\n    MOD_WIN | MOD_NOREPEAT,\n    0x56))  // 0x56 is 'v'\n{\n    _tprintf(_T(\"Hotkey 'WIN+V' registered, using MOD_NOREPEAT flag\\n\"));\n}\n</code></pre>\n\n<p>Is there a way to force registration of the Windows+V hotkey? I assume that there might be a way to do this with Win32 API hooking but it has been a while since I've looked at that. More easily supported options for achieving this would be appreciated.</p>\n"},{"tags":["c++","windows","winapi","visual-c++","win32gui"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13104242,"title":"Windows-specic types and Native types C++","body":"<p>I'm starting to learn windows programming in C++. I've been coding c++ console applications for some time. My question is, if I have a class:</p>\n\n<pre><code>class Example\n{\n    int x;\n    char* y;\n};\n</code></pre>\n\n<p>And want to use it in my GUI application. Should I change the types of Example members to the \nWindows-specic types? Or should I use windows type only in the parts of the program that are directed related to the GUI? Which is the best practice?</p>\n"},{"tags":["python","windows","winapi","automation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13102875,"title":"How to simulate a HOLD keydown event using pywin32?","body":"<p>I am trying to get this piece of python code to work on windows:</p>\n\n<pre><code>import win32process, win32con, win32gui, win32api, time\n\nHWND = win32gui.GetActiveWindow()\nwin32api.PostMessage(HWND, win32con.WM_KEYDOWN, win32con.VK_SPACE, 0)\ntime.sleep(6)\nwin32api.PostMessage(HWND, win32con.WM_KEYUP, win32con.VK_SPACE, 0)\n</code></pre>\n\n<p>It is supposed to simulate someone holding down the space key, but it does not work and does not provide any sort of error message. I believe I may be doing something wrong with HWND, but I am not sure if that is the case.. I would like the event to be sent to any active window that I select to choose.</p>\n\n<p>Can you help?</p>\n\n<hr>\n\n<p>Solved my problem by using ctypes and the user32.keybd_event method.</p>\n\n<pre><code>ctypes.windll.user32.keybd_event(hexx[key], 0, 0, 0)      #Key is down\nctypes.windll.user32.keybd_event(hexx[key], 0, 0x0002, 0) #Key is up\n</code></pre>\n"},{"tags":["c++","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13103751,"title":"Can't create shortcut to All Users Startup","body":"<p>I am using some basic code to be used in an installer for my program. To make my program run on startup, I am creating a .lnk in the All Users Startup folder. </p>\n\n<p>The code I have works to create a shortcut, but I keep getting an error code 5 (priv error). I have tried right clicking and running this code as Admin, and it doesn't work, returns error code 5. I have also used the code to create shortcuts in other parts of the file system with no problem.</p>\n\n<p>I have also used 3rd party programs, mainly \"elevate.exe\" to run my program, and that still doesn't work, it continues to return error code 5. </p>\n\n<p>My question is, how can I use the code below to create a shortcut in the All User's Startup folder without UAC in my way?</p>\n\n<pre><code> int main () \n {\n\n CoInitialize(NULL);\n\n IShellLink* pShellLink = NULL;\n\n HRESULT hres;\n\n hres = CoCreateInstance(CLSID_ShellLink, NULL, CLSCTX_ALL, IID_IShellLink,   (void**)&amp;pShellLink);\n\n  if (SUCCEEDED(hres))\n\n  {\n    pShellLink-&gt;SetPath(\"C:\\\\Windows\\\\System32\\\\testinstall\\\\test.exe\");  // Path to the object we are referring to\n\n    pShellLink-&gt;SetDescription(\"This is a test\");\n\n    pShellLink-&gt;SetIconLocation(\"C:\\\\Windows\\\\System32\\\\testinstall\\\\test.exe\", 0);\n\n    IPersistFile *pPersistFile;\n\n    hres = pShellLink-&gt;QueryInterface(IID_IPersistFile, (void**)&amp;pPersistFile);\n\n    if (SUCCEEDED(hres))\n\n    {\n        hres = pPersistFile-&gt;Save(L\"C:\\\\ProgramData\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\", TRUE);\n\n        pPersistFile-&gt;Release();\n    }\n\n    else\n    {\n        cout &lt;&lt; \"Error 2\" &lt;&lt; endl;\n\n        return 2;\n    }\n\n    pShellLink-&gt;Release();\n\n    }\n\n    else\n    {\n\n    cout &lt;&lt; \"Error 1\" &lt;&lt; endl;\n\n    return 1;\n\n    }\n\n    cout &lt;&lt; GetLastError ();\n\n    _getch ();\n\n    return 0;\n\n    }\n</code></pre>\n"},{"tags":["winapi","ioctl","mount-point"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":122,"score":2,"question_id":5573322,"title":"The Uniqueness of IOCTL_MOUNTDEV_QUERY_UNIQUE_ID","body":"<p>The documentation on <a href=\"http://msdn.microsoft.com/en-us/library/ff560441.aspx\" rel=\"nofollow\"><code>IOCTL_MOUNTDEV_QUERY_UNIQUE_ID</code></a> is a bit confusing... exactly <em>what</em> kind of ID should be returned in the <code>MOUNTDEV_UNIQUE_ID</code> structure?</p>\n\n<p>The documentation for</p>\n\n<pre><code>typedef struct _MOUNTDEV_UNIQUE_ID {\n  USHORT  UniqueIdLength;\n  UCHAR  UniqueId[1];\n} MOUNTDEV_UNIQUE_ID, *PMOUNTDEV_UNIQUE_ID;\n</code></pre>\n\n<p>says:</p>\n\n<blockquote>\n  <p><code>UniqueIdLength</code></p>\n  \n  <ul>\n  <li>Contains the length of unique volume ID. </li>\n  </ul>\n  \n  <p><code>UniqueId</code></p>\n  \n  <ul>\n  <li>Contains the unique volume ID. The format for unique volume names is <code>\"\\??\\Volume{GUID}\\\"</code>, where GUID is a globally unique identifier that identifies the volume. </li>\n  </ul>\n</blockquote>\n\n<p>However, there's something weird here: What should be the exact format of <code>UniqueId</code>? If it's meant to be in the <code>\\??\\Volume{GUID}\\</code> format, then what's the point of the <code>UniqueIdLength</code> field -- aren't they all the same size? Otherwise, what format does the device ID need to be in?</p>\n\n<p>Furthermore, is this a <em>device</em> ID or a <em>volume</em> ID? In other words, is this supposed to be unique per <em>medium</em> (e.g. CD) or per <em>device</em> (CD drive)?</p>\n"},{"tags":["windows","winapi","session","authentication","windows-nt"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13102750,"title":"How I can query logon type of the running process?","body":"<p>I want at least to distinguish cases when my software is being ran as batch job (<code>LOGON32_LOGON_BATCH</code>) from being ran interactively (<code>LOGON32_LOGON_INTERACTIVE</code>).</p>\n"},{"tags":["winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13101479,"title":"How to correctly populate a WIN32_FIND_DATA struct from a ULONGLONG","body":"<p>How do I correctly set the <strong>nFileSizeHigh</strong> and <strong>nFileSizeLow</strong> components of a <strong>WIN32_FIND_DATA</strong> structure when  all I have is a file size in ULONGLONG bytes.</p>\n\n<p>Direct casting causes the compiler to complain about possible data loss.</p>\n\n<pre><code>WIN32_FIND_DATA wfd;\nwfd.nFileSizeLow = (DWORD)totalBytes;\n</code></pre>\n"},{"tags":["windows","winapi","input","mouse"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13100375,"title":"simple mouse move detection (but without cursor movement) in winapi","body":"<p>I need to obtain the mouse move event values (id est mouse_delta_x,\nmouse_delta_y) but without moving the mouse cursor (should off It at all)\nJust need to use mouse movement but without side effect of moving the \nwindows cursor. I know I could possibly do it with RawInput but I am seeking for easiest way. Can it be done easy in winapi?</p>\n\n<p>(It is needed for moving camera in 3d game)</p>\n"},{"tags":["c#","winapi","timing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":13101767,"title":"Windows API equivalent of Stopwatch::ElapsedTicks?","body":"<p>I am calling into an API that needs the elapsed ticks between 2 points. In a C# version, I use <code>Stopwatch</code> and utilize the <code>ElapsedTicks</code> method (this seems to be different than <code>ElapsedMilliseconds</code> obviously). </p>\n\n<p>In Windows API I see <code>GetTickCount()</code>. However this seems to return the elapsed milliseconds, not ticks. How can I accomplish the equivalent with Windows API? (Prefer language agnostic since I might be writing a few wrappers for this).</p>\n"},{"tags":["c#","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12992251,"title":"Use function SetTextJustification (API)","body":"<p>I am trying to use the <code>SetTextJustification</code> function, but it does not work as expected.  </p>\n\n<p>If I set the argument value of nBreakExtra to 40 or to 10 the output is the same, why is this?  </p>\n\n<p>Here is my code:</p>\n\n<pre><code>      private void button1_Click(object sender, EventArgs e)\n      {\n          IntPtr hdc = richTextBox1.CreateGraphics().GetHdc();\n          string str = \"aaa bbb ccc ddd eee fff\";\n          SetTextJustification(hdc, 40, 5);\n          TextOut(hdc, 20, 20, str, str.Length);\n          SetTextJustification(hdc, 10, 5);\n          TextOut(hdc, 20, 50, str, str.Length);\n      }\n\n      [DllImport(\"gdi32.dll\")]\n      static extern bool SetTextJustification(IntPtr hdc, int nBreakExtra, int nBreakCount);\n\n      [DllImport(\"gdi32.dll\", CharSet = CharSet.Auto)]\n      static extern bool TextOut(IntPtr hdc, int nXStart, int nYStart, string lpString, int cbString);\n</code></pre>\n\n<p>the output is displayed as:\n<img src=\"http://i.stack.imgur.com/lLx45.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["c++","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":13082019,"title":"Identify if object is allocated in static memory block (or how to avoid data race conditions)","body":"<p>Preface:</p>\n\n<p>this question is closely related to these ones:  ... <br/>\n- <a href=\"http://stackoverflow.com/questions/9203841/c-avoiding-static-initialization-order-problems-and-race-conditions-simultane\">C++: Avoiding Static Initialization Order Problems and Race Conditions Simultaneously</a> <br/>\n- <a href=\"http://stackoverflow.com/questions/5924595/how-to-detect-where-a-block-of-memory-was-allocated\">How to detect where a block of memory was allocated?</a> <br/>\n... but they have NO positive solution and my actual target use-case is slightly different.</p>\n\n<p>During construction of the object I need to know if it is initialized in static memory bock ( <a href=\"http://stackoverflow.com/questions/93039/where-are-static-variables-stored-in-c-c\">BSS</a>) or is it instantiated in Heap.</p>\n\n<p>The reasons are follow:</p>\n\n<ul>\n<li><p>Object by itself is designed to be initialized to \"all zeros\" in constructor - therefore no initialization is needed if object is statically initialized - entire block with all objects is already set to zeros when program is loaded.</p></li>\n<li><p>Static instances of <em>the object</em> can be used by other statically allocated objects and alter some member variables of <em>the object</em></p></li>\n<li><p>Order of initialization of static variables  <a href=\"http://stackoverflow.com/questions/211237/static-variables-initialisation-order\">is not pre-determined</a> - i.e. my target object can be invoked before its constructor is invoked, thus altering some of its data, and constructor can be invoked later according to some unknown order of initialization of statics <strong>thus clearing already altered data</strong>. That is why I'd like to disable code in constructor for statically allocated objects.</p></li>\n<li><p>Note: in some scenarios Object is the subject for severe multi-threaded access (it has some InterlockedIncrement/Decrement logic), and it has to be completely initialized before any thread can touch it - what i can guaranteed if i explicitly allocate it in Heep, but not in static area (but i need it for static objects too).</p></li>\n</ul>\n\n<p>Sample piece of code to illustrate the case:</p>\n\n<pre><code>struct MyObject\n{\n    long counter;\n\n    MyObject() {\n        if( !isStaticallyAllocated() ) {\n            counter = 0;\n        }\n    }\n    void startSomething() { InterlockedIncrement(&amp;counter); }\n    void endSomething() { InterlockedDecrement(&amp;counter); }\n};\n</code></pre>\n\n<p>At the moment I'm trying to check if 'this' pointer in some predefined range, but this does not work reliably.</p>\n\n<pre><code>LONG_PTR STATIC_START = 0x00400000;\nLONG_PTR STATIC_END   = 0x02000000;\nbool isStatic = (((LONG_PTR)this &gt;= STATIC_START) &amp;&amp; (LONG_PTR)this &lt; STATIC_END));\n</code></pre>\n\n<p><b>Update:</b>\nsample use-case where explicit new operator is not applicable. Code is 'pseudo code', just to illustrate the use-case.</p>\n\n<pre><code>struct SyncObject() {\n    long counter;\n    SyncObject() { \n        if( !isStaticallyAllocated() ) {\n            counter = 0;\n        } }\n    void enter() { while( counter &gt; 0 ) sleep(); counter++; }\n    void leave() { counter--; }\n}\n\ntemplate &lt;class TEnum&gt;\nstruct ConstWrapper {\n    SyncObject syncObj;\n    TEnum m_value;\n\n    operator TEnum() const { return m_value; }\n    LPCTSTR getName() {\n        syncObj.enter();\n        if( !initialized ) {\n            loadNames();\n            intialized = true;\n        }\n        syncObj.leave();\n        return names[m_value];\n    }\n}\n\nConstWrapper&lt;MyEnum&gt; MyEnumValue1(MyEnum::Value1); \n</code></pre>\n"},{"tags":["windows","winapi","gui","registry","windows-themes"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":622,"score":0,"question_id":7114747,"title":"Change theme in Windows XP or Windows 7 (silently)","body":"<p>could you please help me?</p>\n\n<p>What I need is a method to change the theme on a Windows machine without prompting the user with the display properties (personalization) window. The themechange should apply a .theme file from the c:\\windows\\resources\\themes\\ directory and NOT apply a new .msstyles. Method should only apply a .theme file.  I have just been unable to find a way to apply the theme without causing the personalization window to appear. To emphasize, I dont want to solve this via scripts or macros. And also, closing the window via \"sendkeys\" is not an option, because it will still be seen momentarily. </p>\n\n<p>Maybe there is a way out through WINAPI function or simple registry hack? Please, give me advice. Thank you.</p>\n\n<p>Best regards</p>\n"},{"tags":["c++","winapi","raii"],"answer_count":4,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":1267,"score":6,"question_id":1562421,"title":"Making a HANDLE RAII-compliant using shared_ptr with a custom deleter","body":"<p>I've recently posted a general question about RAII at <a href=\"http://stackoverflow.com/questions/1556168/making-a-non-object-resource-raii-compliant\">SO</a>.\nHowever, I still have some implementation issues with my HANDLE example.</p>\n\n<p>A <code>HANDLE</code> is typedeffed to <code>void *</code> in <code>windows.h</code>. Therefore, the correct <code>shared_ptr</code> definition needs to be </p>\n\n<pre><code>std::tr1::shared_ptr&lt;void&gt; myHandle (INVALID_HANDLE_VALUE, CloseHandle);\n</code></pre>\n\n<p><strong>Example 1</strong> <code>CreateToolhelp32Snapshot</code>: returns <code>HANDLE</code> and works.</p>\n\n<pre><code>const std::tr1::shared_ptr&lt;void&gt; h\n    (CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, NULL), CloseHandle);\n</code></pre>\n\n<p>As I use <code>void</code> in the definition (what is the correct way?) problems go on, when I try to call some more winapi commands with this pointer. They functionally work, but are ugly and I am sure that there has to be a better solution.</p>\n\n<p>In the following examples, <code>h</code> is a pointer which was created via the definition at the top.</p>\n\n<p><strong>Example 2</strong> <code>OpenProcessToken</code>: last argument is a <code>PHANDLE</code>. medium ugly with the cast.</p>\n\n<pre><code>OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY,\n    (PHANDLE)&amp;h);\n</code></pre>\n\n<p><strong>Example 3</strong> <code>Process32First</code>: first argument is a <code>HANDLE</code>. REALLY ugly.</p>\n\n<pre><code>Process32First(*((PHANDLE)&amp;h), &amp;pEntry);\n</code></pre>\n\n<p><strong>Example 4</strong> simple comparison with a constant <code>HANDLE</code>. REALLY ugly.</p>\n\n<pre><code>if (*((PHANDLE)&amp;h) == INVALID_HANDLE) { /* do something */ }\n</code></pre>\n\n<p>What is the correct way to create a proper shared_ptr for a HANDLE?</p>\n"},{"tags":["c#","c++","delphi","winapi","windows-7"],"answer_count":1,"favorite_count":6,"up_vote_count":11,"down_vote_count":0,"view_count":160,"score":11,"question_id":12849341,"title":"How can I create a menu in the start menu for my program?","body":"<p>This may be an easy question but I am not even sure of the terminology to search, so I have to ask. I want my program to have a menu when it is hovered over if it is pinned to the start menu. I am attaching a screenshot where windows powershell illustrates this function, and presents a list of tasks.  </p>\n\n<p><img src=\"http://i.stack.imgur.com/h0gU2.png\" alt=\"enter image description here\"></p>\n\n<p>Other programs sometimes use this to list recently opened files, etc. I am sure this is standard enough that there is a tutorial on it somewhere, would someone mind pointing me to it, or explaining how to do this? I hope that it doesn't matter too much what language is used, but I am proficient in Delphi, C++, and C#.</p>\n"},{"tags":["delphi","winapi","system32"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":153,"score":1,"question_id":12849939,"title":"Can not get msconfig .exe to run in the system32 folder shellexecute Delphi","body":"<p>Im on Win 7  64b.\nIm trying to run msconfig from my delphi app.\nThe msconfig.exe file is in the system32 folder .\nI copied the msconfig.exe to the c:\\ and it works great.\nThis looks like some kind of permission issue.</p>\n\n<pre><code>var\nerrorcode: integer;\n begin\n   errorcode :=\nShellExecute(0, 'open', pchar('C:\\Windows\\System\\msconfig.exe'), nil, nil, SW_NORMAL);\nif errorcode &lt;= 32 then\nShowMessage(SysErrorMessage(errorcode));\nend;\n</code></pre>\n\n<p>Has anyone seen this and figured out how to run the msconfig.exe from the sys32 .</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":13078719,"title":"Win32 api programming - wm_paint after resizing","body":"<p>I want to redraw window on every window resize, but I dont want to call WM_PAINT until resizing is finished. I tried it using WM_EXITSIZEMOVE message, but I unsuccessfully. Is there any way to, for example paint TextOut on every resize (on every mouse up after resizing)?</p>\n\n<p>Thanks</p>\n"},{"tags":["c++","c","winapi","windows"],"answer_count":5,"favorite_count":0,"up_vote_count":6,"down_vote_count":1,"view_count":7262,"score":5,"question_id":2620409,"title":"Getting HWND of current Process","body":"<p>I have a process in c++ in which I am using window API. I want to get the HWND of own process. Kindly guide me how can I make it possible.</p>\n"},{"tags":["winapi","windows-7","com","taskbar"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13093331,"title":"ITaskbarList3 hook or replacement","body":"<p>I'm trying to create a Windows 7 taskbar replacement. Builtin taskbar has some nice features which I'd like to reimplement, specifically a progress bar hosted in a taskbar button (<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd391698%28v=vs.85%29.aspx\" rel=\"nofollow\">ITaskbarList3</a>).</p>\n\n<p>Since other applications communicate with system taskbar by obtaining its interface instance by calling <code>CoCreateInstance(CLSID_TaskbarList, ...)</code> I need either to replace COM-object CLSID_TaskbarList or setup some sort of hook for <code>ITaskbarList3::SetProgressValue</code> and <code>ITaskbarList3::SetProgressState</code> to be able to show progress on my own window. Any ideas how to do this?</p>\n\n<p>(It's not the same as <a href=\"http://stackoverflow.com/questions/6330355/get-itaskbarlist3-data-of-specific-window\">that</a>)</p>\n"},{"tags":["python","winapi","com","autodesk"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":165,"score":1,"question_id":8730971,"title":"Python Dictionary Method Calls win32com","body":"<p>I have run makepy on Autodesk Inventor to be able to script certain tasks.  I am having trouble understanding the appropriate protocol for using properties/methods stored in class dictionaries.  I have read a lot about this, including the other stackoverflow question regarding _prop_map_get_ but for some reason, don't get it.  Here is an example:</p>\n\n<ul>\n<li>two classes in question, <strong>AssemblyComponentDefinition</strong>, and <strong>WorkPoints</strong></li>\n</ul>\n\n<p>These two classes are excerpt from makepy:</p>\n\n<pre><code>class AssemblyComponentDefinition**(DispatchBaseClass):\n\"\"\"Assembly Component Definition Object\"\"\"\nCLSID = IID('{AA044AA1-D685-11D3-B7A0-0060B0F159EF}')\ncoclass_clsid = None\n\n    _prop_map_get_ = {\n    # Method 'WorkAxes' returns object of type 'WorkAxes'\n    \"WorkAxes\": (100663817, 2, (9, 0), (), \"WorkAxes\", '{28DD48B5-8D70-11D4-8DDE-0010B541CAA8}'),\n    # Method 'WorkPlanes' returns object of type 'WorkPlanes'\n    \"WorkPlanes\": (100663816, 2, (9, 0), (), \"WorkPlanes\", '{46785C3B-7F4A-11D4-8DDB-0010B541CAA8}'),\n    # Method 'WorkPoints' returns object of type 'WorkPoints'\n    \"WorkPoints\": (100663818, 2, (9, 0), (), \"WorkPoints\", '{28DD48C7-8D70-11D4-8DDE-0010B541CAA8}'),   \n}\n\nclass WorkPoints(DispatchBaseClass):\n\"\"\"WorkPoints Collection Object\"\"\"\nCLSID = IID('{28DD48C7-8D70-11D4-8DDE-0010B541CAA8}')\ncoclass_clsid = None\n\n# Result is of type WorkPoint\ndef AddFixed**(self, Point=defaultNamedNotOptArg, Construction=False):\n    \"\"\"Creates a new work point at the position specified by the input point\"\"\"\n    ret = self._oleobj_.InvokeTypes(83893254, LCID, 1, (9, 0), ((9, 1), (11, 49)),Point\n        , Construction)\n    if ret is not None:\n        ret = Dispatch(ret, 'AddFixed', '{28DD48C9-8D70-11D4-8DDE-0010B541CAA8}')\n    return ret\n\n# Result is of type WorkPoint\n# The method Item is actually a property, but must be used as a method to correctly pass the arguments\ndef Item(self, Index=defaultNamedNotOptArg):\n    \"\"\"Allows integer-indexed access to items in the collection\"\"\"\n    ret = self._oleobj_.InvokeTypes(0, LCID, 2, (9, 0), ((12, 1),),Index\n        )\n    if ret is not None:\n        ret = Dispatch(ret, 'Item', '{28DD48C9-8D70-11D4-8DDE-0010B541CAA8}')\n    return ret\n\n_prop_map_get_ = {\n    \"Application\": (2130706433, 2, (9, 0), (), \"Application\", None),\n    \"Count\": (2130706438, 2, (3, 0), (), \"Count\", None),\n    # Method 'Parent' returns object of type 'ComponentDefinition'\n    \"Parent\": (2130706434, 2, (9, 0), (), \"Parent\", '{5DF8601E-6B16-11D3-B794-0060B0F159EF}'),\n    \"Type\": (2130706435, 2, (3, 0), (), \"Type\", None),\n}\n_prop_map_put_ = {\n}\n# Default method for this class is 'Item'\ndef __call__(self, Index=defaultNamedNotOptArg):\n    \"\"\"Allows integer-indexed access to items in the collection\"\"\"\n    ret = self._oleobj_.InvokeTypes(0, LCID, 2, (9, 0), ((12, 1),),Index\n        )\n    if ret is not None:\n        ret = Dispatch(ret, '__call__', '{28DD48C9-8D70-11D4-8DDE-0010B541CAA8}')\n    return ret\n\ndef __str__(self, *args):\n    return str(self.__call__(*args))\ndef __int__(self, *args):\n    return int(self.__call__(*args))\ndef __iter__(self):\n    \"Return a Python iterator for this object\"\n    ob = self._oleobj_.InvokeTypes(-4,LCID,2,(13, 10),())\n    return win32com.client.util.Iterator(ob, '{28DD48C9-8D70-11D4-8DDE-0010B541CAA8}')\ndef _NewEnum(self):\n    \"Create an enumerator from this object\"\n    return win32com.client.util.WrapEnum(self._oleobj_.InvokeTypes(-4,LCID,2,(13, 10),()),'{28DD48C9-8D70-11D4-8DDE-0010B541CAA8}')\ndef __getitem__(self, index):\n    \"Allow this class to be accessed as a collection\"\n    if '_enum_' not in self.__dict__:\n        self.__dict__['_enum_'] = self._NewEnum()\n    return self._enum_.__getitem__(index)\n#This class has Count() property - allow len(ob) to provide this\ndef __len__(self):\n    return self._ApplyTypes_(*(2130706438, 2, (3, 0), (), \"Count\", None))\n#This class has a __len__ - this is needed so 'if object:' always returns TRUE.\ndef __nonzero__(self):\n    return True   \n</code></pre>\n\n<p>This is some code I have tried to have an object of type WorkPoints returned through the <strong>AssemblyComponentDefinition</strong> class. </p>\n\n<pre><code>    import win32com.client\n    from win32com.client import constants\n    oApp = win32com.client.Dispatch('Inventor.Application')\n    oApp.Visible=True #makes Inventor Application visible\n    from win32com.client import gencache\n    mod = gencache.EnsureModule('{D98A091D-3A0F-4C3E-B36E-61F62068D488}', 0, 1, 0) \n    oApp=mod.Application(oApp) \n    oAssemblyDoc=oApp.Documents.Add(constants.kAssemblyDocumentObject, \"\", True)\n    oAss = oAssemblyDoc.Activate\n    oTG = oApp.TransientGeometry\n    oPoint = oTG.CreatePoint(XCoord=1.2, YCoord=3.4, ZCoord=5.3) #this works\n    z=mod.AssemblyComponentDefinition('WorkPoints') \n</code></pre>\n\n<p>This returns z as a class object of <strong>AssemblyComponentDefinition</strong>.  What I really want to do is to say (I know this is the naive way to think of this):</p>\n\n<pre><code>newpoint = mod.AssemblyComponentDefinition.WorkPoints.AddFixed(oPoint)\n</code></pre>\n\n<p>I get an error that <strong>AssemblyComponentDefinition</strong> has no attribute '<strong>WorkPoints</strong>'.  Again, I need help understanding how to use the _prop_map_get_ part to be able to create a Work Point in my file and then run <strong>WorkPoints</strong> method <strong>AddFixed</strong>.  </p>\n"},{"tags":["winapi","64bit"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13092192,"title":"Native' has exited with code -1073741701 (0xc000007b). when upgrade win32 application to x64","body":"<p>I tried to upgrade my application from win32 to x64. After replaced all 32bit library files by 64bit files, my application compiled successfully and exe file generated.</p>\n\n<p>The error popped out when I ran the exe file.</p>\n\n<p>\"Native' has exited with code -1073741701 (0xc000007b). when upgrade win32 application to x64\"</p>\n\n<p>I checked this error online. Someone say it may caused by loading 32-bit dll in 64-bit application. How can I change my dll loading directory to syswow64?</p>\n\n<p>Thank you </p>\n"},{"tags":["c++","winapi","loops","message","message-pump"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13092043,"title":"Win32 message pump, does DispatchMessage() handle entire message queue or just top message?","body":"<p>So i've been reading up on the Win32 message pump and I was curious if the DispatchMessage() function deals with the entire message queue, or just the message at the top of the queue?</p>\n\n<p>For example, i've seen loops such as:</p>\n\n<pre><code>while(true) \n{\n\n    MSG  msg;\n\n    if (PeekMessage(&amp;msg, NULL, 0, 0, PM_REMOVE))\n    {\n        if (msg.message == WM_QUIT) \n        {\n            break;\n        } \n        else \n        {\n            TranslateMessage(&amp;msg);\n            DispatchMessage(&amp;msg);\n        }\n    } \n\n    do \n    {   \n    } while (clock.getTimeDeltaMilliseconds() &lt; 1.66f); // cap at 60 fps\n\n    // run frame code here\n}\n</code></pre>\n\n<p>In this example would every message get processed or does this loop structure cause only one message to be processed per frame?</p>\n\n<p>If it does deal with only one message at a time, should I change the if(PeekMessage) statement to a while loop to ensure all messages are handled?:</p>\n\n<pre><code>while(true) \n{\n\n    MSG  msg;\n\n    while (PeekMessage(&amp;msg, NULL, 0, 0, PM_REMOVE))\n    {\n        if (msg.message == WM_QUIT) \n        {\n            return;\n        } \n        else \n        {\n            TranslateMessage(&amp;msg);\n            DispatchMessage(&amp;msg);\n        }\n    } \n\n    do \n    {   \n    } while (clock.getTimeDeltaMilliseconds() &lt; 1.66f); // cap at 60 fps\n\n    // run frame code here\n}\n</code></pre>\n"},{"tags":["c++","c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13066450,"title":"Inspecting end of file during reading the file by ReadFile() function","body":"<p>How can I inspect end of file in next code. I try to write function that can read wchar_t symbols one by one while some define earlier symbol be read, but if EOF be read function must stop.</p>\n\n<pre><code>wchar_t wchr[1];    \nBOOL b = TRUE;\n\ndo\n{\n    b = ReadFile(hReadFile, wchr, sizeof(wchar_t), &amp;dw, NULL);\n    if(!b)break;         //it doesn't work\n    tempGetLine[size] = wchr[0];\n    size++;\n}while(wchr[0] != endSymbol);\n</code></pre>\n"},{"tags":["c++","winapi","postmessage","office-automation","comaddin"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13089675,"title":"MS Word COM addin can't receive messages in XP","body":"<p>From inside my COM addin I create a dialog, and I then send messages to it from an external process. I use <code>HWND_BROADCAST</code> and <code>RegisterWindowMessage</code>.</p>\n\n<p>But those messages are never received by the dialog proc of the COM addin. I know this because I log all the messages received by the dialog proc, and also the value returned by <code>RegisterWindowMessage</code>.</p>\n\n<p>From the external process:</p>\n\n<pre><code>static UINT nCloseMessage = 0;\nif (!nCloseMessage)\n    nCloseMessage = RegisterWindowMessage(_T(\"MyCloseMessage\"));    \nPostMessage(HWND_BROADCAST, nCloseMessage, 0, 0);\n</code></pre>\n\n<p>From the COM add-in:</p>\n\n<pre><code>INT_PTR CALLBACK ProgressDialogProc(__in  HWND hwndDlg,__in  UINT uMsg,__in  WPARAM wParam,__in  LPARAM lParam)\n{\n    static UINT nCloseMessage = 0;\n    if (!nCloseMessage)\n        nCloseMessage = RegisterWindowMessage(_T(\"MyCloseMessage\"));    \n    if (uMsg == nCloseMessage)\n        MessageBox(0,_T(\"Caught\"),0,0);\n\n    return FALSE;\n}\n</code></pre>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":13060110,"title":"Store a value from text field in a .txt","body":"<p>My problem is very simple (at least i think it is). I'd like to capture a value from a text input and store it inside a txt file. Right now i'm using this code, and the action button is intended to write the content in file when clicked. But i'm getting the value of button registered in the file instead.</p>\n\n<pre><code>    case WM_CREATE:{\n        CreateWindow(\n            TEXT(\"EDIT\"), TEXT(\"value\"), \n            WS_VISIBLE | WS_CHILD | WS_BORDER, \n            190, 50, 50, 20,\n            hwnd, (HMENU) NULL, NULL, NULL \n        );\n\n        CreateWindow(\n            TEXT(\"BUTTON\"), TEXT(\"Ok\"), \n            WS_VISIBLE | WS_CHILD, \n            250, 10, 30, 20,\n            hwnd, (HMENU) ID_BTN, NULL, NULL \n        );\n\n        break;\n    }\n\n    case WM_COMMAND: {\n        if (LOWORD(wParam) == ID_BTN) {\n            std::ofstream outfile;\n            outfile.open(\"C:\\\\file.txt\", std::ios_base::app);\n            outfile &lt;&lt; ID_BTN;\n            outfile.close();\n            MessageBox(hwnd, \"Done!\", \"Title\", MB_ICONINFORMATION);\n              return 0;\n         }\n         break;\n    }\n</code></pre>\n\n<p>Thanks.</p>\n\n<hr>\n\n<p><strong>EDIT</strong>: @ZanLynx, I tried to do what you have said, but compiler keep saying hwndText wasn't declared, when it was.</p>\n\n<pre><code>107 `hwndText' undeclared (first use this function)\n</code></pre>\n\n<p>Here's the code</p>\n\n<pre><code>#define ID_BTN 1\n#define ID_TXT 2\n\nLRESULT CALLBACK WindowProcedure (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    switch (message)\n    {\n        case WM_CREATE:\n        {\n\n            HWND hwndText = CreateWindow(\n                TEXT(\"Edit\"), TEXT(\"Write here\"), \n                WS_VISIBLE | WS_CHILD | WS_BORDER | ES_AUTOHSCROLL | ES_AUTOVSCROLL,  \n                190, 10, 100, 20, \n                hwnd, (HMENU) ID_TXT, NULL, NULL\n            );\n\n            CreateWindow(\n                TEXT(\"BUTTON\"), TEXT(\"OK\"), \n                WS_VISIBLE | WS_CHILD, \n                250, 10, 30, 20,\n                hwnd, (HMENU) ID_BTN, NULL, NULL\n            );\n\n            break;\n        }\n\n        case WM_COMMAND: \n        {\n\n            if (LOWORD(wParam) == ID_BTN) \n            {\n                LRESULT iTextSize = SendMessage(hwndText, EM_GETLIMITTEXT, 0, 0);\n                char *szText = new char[iTextSize];\n                SendMessage(hwndText, WM_GETTEXT, iTextSize, (LPARAM)szText);\n\n                std::ofstream outfile;\n                outfile.open(\"C:\\\\f.txt\", std::ios_base::app);\n                outfile &lt;&lt; szText;\n                outfile.close();\n\n                MessageBox(hwnd, \"Done!\", \"Title\", MB_ICONINFORMATION);\n                return 0;\n            };  \n\n            break;\n        }\n\n        case WM_DESTROY:\n            PostQuitMessage (0);\n            break;\n\n        default:\n            return DefWindowProc (hwnd, message, wParam, lParam);\n    }\n\n    return 0;\n}\n</code></pre>\n"},{"tags":["c#","c++",".net","winforms","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":84,"score":2,"question_id":13074421,"title":"C# equivalent of MessageBoxA(HWND_DESKTOP, msg, \"Alarm\", MB_OK | MB_ICONWARNING | MB_SYSTEMMODAL | MB_SETFOREGROUND);","body":"<p>I am writing an alarm program in C# that displays a system modal dialog with a user-specified message at a specified time. However, I can't seem to find the C# equivalent of</p>\n\n<pre><code>MessageBoxA(HWND_DESKTOP, msg, \"Alarm\",\n   MB_OK | MB_ICONWARNING | MB_SYSTEMMODAL | MB_SETFOREGROUND);\n</code></pre>\n\n<p><strong>Edit:</strong> I am trying to learn C# and the .NET libraries. I thought writing programs equivalent to some small programs that I have written in C or C++ would be a good place to start.</p>\n"},{"tags":["c++","winapi","sessionid"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13079796,"title":"Are session IDs obtained by WTSEnumerateSessions API unique?","body":"<p>Say, if at one point in time I call <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa383833%28v=vs.85%29.aspx\" rel=\"nofollow\">WTSEnumerateSessions</a> from a local service application and obtain the list of current user session IDs. So if at some later time I need to know if some particular user session is still in the same state, can I rely on <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa383864%28v=vs.85%29.aspx\" rel=\"nofollow\">WTS_SESSION_INFO::SessionId</a> to be unique? And if not, how to do this?</p>\n"},{"tags":["winapi","mouse","gdi","pass-through"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":48,"score":3,"question_id":13069717,"title":"Letting the mouse pass through Windows C++","body":"<p>I am working on an Win32 C++ application where I want to ignore the mouse events and let is pass through to the window beneath my window. Basically the window below mine will handle the mouse event. I would prefer not to send the mouse message using SendMessage to the window beneath mine or use SetCapture. Is there a way basically to ignore the mouse event and let it pass through with Windows APIs or with styles? Note that my window is not transparent. </p>\n\n<p>Thanks in advance for the help.</p>\n"},{"tags":[".net","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13088656,"title":"API to change/edit Windows \"host\" or \"lmhost\" files","body":"<p>I was wondering if there is a .Net or even a native API that would allow us to edit the Windows host file. The reasons for preferring an API to raw access would be not having to deal with multiple locations for the file and validation, of course.</p>\n\n<p>Thanks!</p>\n"},{"tags":["winapi","audio"],"answer_count":2,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":2337,"score":4,"question_id":1449162,"title":"Get the full name of a waveIn device","body":"<p>I have been using <a href=\"http://msdn.microsoft.com/en-us/library/dd743841%28VS.85%29.aspx\" rel=\"nofollow\">waveInGetDevCaps</a> to get the name of waveIn devices, but the <a href=\"http://msdn.microsoft.com/en-us/library/dd743839%28VS.85%29.aspx\" rel=\"nofollow\">WAVEINCAPS</a> structure only supports 31 characters plus a null, meaning that on my computer, the device names I get back are truncated:</p>\n\n<pre><code>Microphone / Line In (SigmaTel \nMicrophone Array (SigmaTel High,\n</code></pre>\n\n<p>I am sure that there must be a way of getting the full device name, but does anyone know what that is?</p>\n"},{"tags":["c#","winapi","getclientrect"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":34,"score":0,"question_id":13086927,"title":"Call GetClientRect winAPI","body":"<p>I am having an issues trying to call the GetClientRect and passing in a Stuct to get populated with the values that are returned.  Here is the code I have. </p>\n\n<pre><code>[return: MarshalAs(UnmanagedType.Bool)]\n        [DllImport(\"user32.dll\")]\n        internal static extern bool GetClientRect(IntPtr hwnd, ref RECT lpRect);\n\n        [StructLayout(LayoutKind.Sequential)]\n        internal struct RECT\n        {\n            internal int left;\n            internal int top;\n            internal int right;\n            internal int bottom;\n        }\n     RECT rect = new RECT();\n\n     GetClientRect(PApplication.Instance.MdiMain.Handle, ref rect);\n</code></pre>\n\n<p>I keep getting the error on the RECT saysing Error  1   Embedded statement cannot be a declaration or labeled statement.</p>\n\n<p>I just need help getting back the left top right bottome values from the GetClientRect</p>\n"},{"tags":["windows","multithreading","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":13086831,"title":"Instruct win32 threads to run on a single processor core","body":"<p>I have a test program which would be much simpler if it could rely on threads being scheduled in strict priority order on Windows.  I'm seeing a low priority thread running alongside higher priority threads and wonder if this is happening because the different threads are being scheduled on different processor cores.</p>\n\n<p>Is there a way to force all Win32 threads in a process to use a single processor core?  <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms686247%28v=vs.85%29.aspx\" rel=\"nofollow\">SetThreadAffinityMask</a> looks like it might be interesting but its docs aren't entirely clear and I'm not sure how to use it.</p>\n"},{"tags":["windows","performance","winapi","file-io","io"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":383,"score":2,"question_id":7430959,"title":"How to make CreateFile as fast as possible","body":"<p>I need to read the contents of several thousands of small files at startup. On linux, just using fopen and reading is very fast. On Windows, this happens very slowly.</p>\n\n<p>I have switched to using Overlapped I/O (Asynchronous I/O) using ReadFileEx, where Windows does a callback when data is ready to read.</p>\n\n<p>However, the actual thousands of calls to CreateFile itself are still a bottleneck. Note that I supply my own buffers, turn on the NO_BUFFERING flag, give the SERIAL hint, etc. However, the calls to CreateFile take several 10s of seconds, whereas on linux everything is done much faster.</p>\n\n<p>Is there anything that can be done to get these files ready for reading more quickly?</p>\n\n<p>The call to CreateFile is:</p>\n\n<pre><code>            hFile = CreateFile(szFullFileName,\n                GENERIC_READ,\n                FILE_SHARE_READ | FILE_SHARE_WRITE,\n                NULL,\n                OPEN_EXISTING,\n                FILE_ATTRIBUTE_NORMAL | FILE_FLAG_OVERLAPPED | FILE_FLAG_NO_BUFFERING | FILE_FLAG_SEQUENTIAL_SCAN,\n                NULL);\n</code></pre>\n"},{"tags":["c++","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":12591358,"title":"What is XcvPort (used in OpenPrinter function)","body":"<p>I'm usin the OpenPrinter function and the first parameter the function gets called \"pPrinterName\"\nand that's it's MSDN description:</p>\n\n<blockquote>\n  <p>[in] Pointer to a null-terminated string that specifies the name of the printer or print server, the printer object, the XcvMonitor, or the XcvPort. \n  For a printer object use: PrinterName,Job xxxx. For an XcvMonitor, use: ServerName,XcvMonitor MonitorName. <strong>For an XcvPort, use: ServerName,XcvPort PortName</strong>.</p>\n</blockquote>\n\n<p>Obviously I'm interested in the bold part. What exactly is XcvPort? I know it seems like a question of lazy person but I really couldn't find info abou this concept. If I would like to open a printer on port ABC I should write:\n\"<strong>\\\\MySrever,XcvPort ABC</strong>\"?</p>\n"},{"tags":["c++","c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":52,"score":0,"question_id":13085974,"title":"Very simple example with Listbox in winapi","body":"<p>How can I display in MessageBox text selected in ListBox? I try to use next code, but it display only blank MessageBox</p>\n\n<pre><code>wchar_t listBoxStr[15];\nHWND hWndList;\n\n      switch (message)\n     {\n     case WM_CREATE:\nhWndList = CreateWindowEx(WS_EX_CLIENTEDGE, TEXT(\"listbox\"), \"\", WS_CHILD | WS_VISIBLE | WS_VSCROLL | ES_AUTOVSCROLL, 240, 40, 150, 20, hwnd, (HMENU)105, NULL, NULL);\n        SendMessage(hWndList, LB_ADDSTRING, 0, (LPARAM)\"name\");\n        SendMessage(hWndList, LB_ADDSTRING, 0, (LPARAM)\"extension\");\n        SendMessage(hWndList, LB_ADDSTRING, 0, (LPARAM)\"date\");\n        SendMessage(hWndList, LB_ADDSTRING, 0, (LPARAM)\"size\");\n        CreateWindowEx(NULL, TEXT(\"button\"), TEXT(\"FIND\"), WS_VISIBLE | WS_CHILD, 410, 40, 50, 20, hwnd, (HMENU)106, NULL, NULL);\n        return 0 ;\n          return 0 ;\n     case WM_COMMAND:\n         switch(LOWORD(wParam))\n         {\n         case 106:\n             SendMessageW(hWndList, LB_GETTEXT,0,(LPARAM)listBoxStr);\n             MessageBoxW(NULL, listBoxStr, L\"\", NULL);\n             return 0;\n         }\n         return 0;\n     case WM_PAINT:\n          hdc = BeginPaint (hwnd, &amp;ps);\n          GetClientRect (hwnd, &amp;rect) ;\n          EndPaint (hwnd, &amp;ps) ;\n          return 0 ;\n     case WM_DESTROY:\n          PostQuitMessage (0) ;\n          return 0 ;\n     }\n</code></pre>\n"},{"tags":["c++","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12599905,"title":"ERROR_INVALID_PRINT_MONITOR when using OpenPrinter","body":"<p>I'm using OpenPrinter on a remote printer port like this:</p>\n\n<pre><code>OpenPrinter(\"\\\\\\\\10.0.0.3\\\\,XcvPort USB001\",&amp;printer,NULL);\n</code></pre>\n\n<p>It result with ERROR_INVALID_PRINT_MONITOR(error code 3007). Here is the error MSDN description:</p>\n\n<blockquote>\n  <p>The specified print monitor does not have the required functions.</p>\n</blockquote>\n"},{"tags":["c++","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13084939,"title":"ReadDirectoryChangesW not recognize more than 1 file addition","body":"<p>I'm trying to monitor a directory using ReadDirectoryChangesW. Whenever a new file is added to the directory I monitor the application should print it's name. The application works fine if I copy one file at a time, but if I try,lets say 2 files at a time, it recognize only one of them.</p>\n\n<p>I'm using this function synchronously.</p>\n\n<p>Here is the code:</p>\n\n<p>The handle to the directory:</p>\n\n<pre><code>    HANDLE hDir = CreateFile( \n\"d:\\\\Detect\", /* pointer to the file name */\nFILE_LIST_DIRECTORY,                /* access (read-write) mode */\nFILE_SHARE_READ|FILE_SHARE_DELETE,  /* share mode */\nNULL, /* security descriptor */\nOPEN_EXISTING, /* how to create */\nFILE_FLAG_BACKUP_SEMANTICS, /* file attributes */\nNULL /* file with attributes to copy */\n);\n</code></pre>\n\n<p>And ReadDirectoryChangesW:</p>\n\n<pre><code>        ReadDirectoryChangesW(hDir,&amp;Buffer,sizeof(Buffer),FALSE,FILE_NOTIFY_CHANGE_SECURITY|\n     FILE_NOTIFY_CHANGE_CREATION|\n     FILE_NOTIFY_CHANGE_LAST_ACCESS|\n     FILE_NOTIFY_CHANGE_LAST_WRITE|\n     FILE_NOTIFY_CHANGE_SIZE|\n     FILE_NOTIFY_CHANGE_ATTRIBUTES|\n     FILE_NOTIFY_CHANGE_DIR_NAME|\n    FILE_NOTIFY_CHANGE_FILE_NAME,&amp;bytesReturned,NULL,NULL);\n</code></pre>\n"},{"tags":["winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":13,"score":-1,"question_id":13085838,"title":"How to create domain name checker and WHOIS link on own website","body":"<p>I want to create domain name checker within my website. I created with asp.net. I don't want to give another link to check the domain. And i also need WHOIS link. How to build it? </p>\n"},{"tags":["c++","winapi","memory","memory-management","allocation"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":13085152,"title":"C++ memory - Do primitive-typed variables created with 'new' need to be deleted?","body":"<p>I'm kind of new when it comes to memory management in C++. I read that if you create a class with the <code>new</code> keyword you must <code>delete</code> the object to free its memory. I also read that primitive types, such as <code>int</code>, <code>char</code> and <code>bool</code>, are created on the stack, which means they get deleted when they go out of scopes.</p>\n\n<p>But what about primitive types created with the <code>new</code> keyword? Do I need to explicitly call <code>delete</code>? Are these created on the heap like classes? Or since they are primitive do they still get created on the stack?</p>\n\n<p>I am asking because I am allocating a <code>LPTSTR</code> using the new keyword, but I am worried that if I do not call <code>delete</code> that the memory will never be freed. Here is my code with the bare question in the comments:</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;tchar.h&gt;\n#include &lt;string&gt;\n\n#ifdef _UNICODE\n    typedef std::wstring Str;\n#else // ANSI\n    typedef std::string Str;\n#endif\n\nStr GetWndStr(HWND hwnd) {\n    const int length = GetWindowTextLength(hwnd);\n\n    if (length != 0) {\n        LPTSTR buffer = new TCHAR[length + 1]; // Allocation of string\n        GetWindowText(hwnd, buffer, length + 1);\n        Str text(buffer);\n\n        delete buffer; // &lt;--- Is this line necessary?\n        return text;\n    } else {\n        return _T(\"\");\n    }\n}\n</code></pre>\n\n<p>Do I need to call <code>delete</code>? Awhile back, I tried using <code>GlobalAlloc()</code> and <code>GlobalFree()</code>, but during runtime I got an error saying something about illegally modifying the stack, I do not have an exact error message as this was awhile ago. Also, in addition to your answer, if you would like to give me resources you found helpful to learn more about C++ memory management, that would be nice.</p>\n"},{"tags":["c#","winapi","registerhotkey"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13085259,"title":"Register multiple global hot-keys in C#","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4704134/register-more-than-one-hotkey-with-registerhotkey\">Register more than one hotkey with RegisterHotKey</a>  </p>\n</blockquote>\n\n\n\n<p>Sorry, but I really googled for it a long time and I didn't get any clear code!</p>\n\n<p>I want to know how to register global hot-keys in C# using this:</p>\n\n<pre><code>Win32.RegisterHotKey(hWndSource.Handle, add, \n                     Win32.MOD_CONTROL | Win32.MOD_SHIFT, Win32.VK_KEY_D);\n</code></pre>\n\n<p>And the most important thing is how to capture multiple hot-keys.</p>\n\n<p>Lets say i want <kbd>Ctrl</kbd>+<kbd>E</kbd> key strokes to do something different to what <kbd>Ctrl</kbd>+<kbd>R</kbd> should do.</p>\n"},{"tags":["c++","winapi","stack-trace","callstack","debug-symbols"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":448,"score":0,"question_id":6794463,"title":"print callstack of a thread (c++), StackWalker or not?","body":"<p>Needing to print callstacks of C++ application thread by thread handle, I turned to <a href=\"http://www.codeproject.com/KB/threads/StackWalker.asp\" rel=\"nofollow\">StackWalker</a> which is mentioned in previous stackoverflow answers.</p>\n\n<p>However, <a href=\"http://www.codeproject.com/KB/threads/StackWalker/StackWalker.zip\" rel=\"nofollow\">the StakWalker code</a> is dated 2005. I suspect something changed since then.</p>\n\n<p>When I compile and run it, I get error (below), and output seems to be incomplete, truncated at error. Test shall print more testcases.</p>\n\n<p>Does anybody have an updated or different working callstack-printing published code ?</p>\n\n<pre><code>e:\\boris\\stackwalker\\stackwalker\\main.cpp (31): Func5\ne:\\boris\\stackwalker\\stackwalker\\main.cpp (32): Func4\ne:\\boris\\stackwalker\\stackwalker\\main.cpp (33): Func3\ne:\\boris\\stackwalker\\stackwalker\\main.cpp (34): Func2\ne:\\boris\\stackwalker\\stackwalker\\main.cpp (35): TestCurrentThread\ne:\\boris\\stackwalker\\stackwalker\\main.cpp (139): main\nf:\\dd\\vctools\\crt_bld\\self_x86\\crt\\src\\crtexe.c (582): __tmainCRTStartup\nf:\\dd\\vctools\\crt_bld\\self_x86\\crt\\src\\crtexe.c (399): mainCRTStartup  \nVVVVV  \nERROR: SymGetLineFromAddr64, GetLastError: 487 (Address: 7C817077)  \n^^^^^  \n7C817077 (kernel32): (filename not available): RegisterWaitForInputIdle\n</code></pre>\n"},{"tags":["delphi","winapi"],"answer_count":2,"favorite_count":4,"up_vote_count":7,"down_vote_count":0,"view_count":173,"score":7,"question_id":11647762,"title":"Align a TPopupMenu to the right hand side of the form?","body":"<p>How can a TPopupMenu be aligned to the right hand side of a form? The problem is that there doesn't seem to be a way to get the width of the Popup menu before you call <code>Popup(X, Y: Integer)</code>.</p>\n\n<p>I'm trying to get a behavior similar to that of the system menu in Chrome.</p>\n\n<p><img src=\"http://i.stack.imgur.com/ogWML.png\" alt=\"enter image description here\"></p>\n"},{"tags":["c#","c++","c","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13080927,"title":"About the MSDN code example, \"Enabling and Disabling Privileges\"","body":"<p>MSDN article, <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa446619%28v=vs.85%29.aspx\" rel=\"nofollow\">Enabling and Disabling Privileges in C++</a>, provided a code example to show how to enable or disable a privilege in an access token.</p>\n\n<p>I quote the part in questioned:</p>\n\n<pre><code>tp.PrivilegeCount = 1;\ntp.Privileges[0].Luid = luid;\nif (bEnablePrivilege)\n    tp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;\nelse\n    tp.Privileges[0].Attributes = 0;\n</code></pre>\n\n<p><br />\n<b>What is the meaning of the zero value for <code>Attributes</code> member?</b></p>\n\n<p>According to the documentation of <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa379630%28v=vs.85%29.aspx\" rel=\"nofollow\">TOKEN_PRIVILEGES</a> structure, the attributes of a privilege can be a combination of the following values:</p>\n\n<ul>\n<li><code>SE_PRIVILEGE_ENABLED</code> &nbsp;(it is <b>0x00000002L</b> in <code>WinNT.h</code>)</li>\n<li><code>SE_PRIVILEGE_ENABLED_BY_DEFAULT</code> &nbsp;(it is <b>0x00000001L</b> in <code>WinNT.h</code>)</li>\n<li><code>SE_PRIVILEGE_REMOVED</code> &nbsp;(it is <b>0x00000004L</b> in <code>WinNT.h</code>)</li>\n<li><code>SE_PRIVILEGE_USED_FOR_ACCESS</code> &nbsp;(it is <b>0x80000000L</b> in <code>WinNT.h</code>)</li>\n</ul>\n\n<p>So, we don't see any valid constant with a value of zero. I guess, the zero is equal to <code>SE_PRIVILEGE_REMOVED</code>.</p>\n\n<p>Once more, if the zero means disabling all privileges, I doubt it because disabling all privileges can be done simply by setting <code>DisableAllPrivileges</code> parameter of <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa375202%28v=vs.85%29.aspx\" rel=\"nofollow\">AdjustTokenPrivileges()</a> to <code>TRUE</code>.</p>\n\n<p>Anybody here could explain what the zero value <i>really</i>  does?</p>\n"},{"tags":["c++","windows","winapi","modal"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":6406,"score":2,"question_id":734674,"title":"Creating a win32 modal window with CreateWindow","body":"<p>I create a window with CreateWindow() and show it with ShowWindow(). But the parent window on which this was created should be disabled until user returns from this window, i.e. it should simulate modal dialog box.</p>\n"},{"tags":["c++","winapi","interop","zeromq"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":150,"score":1,"question_id":11118493,"title":"Calling Win32 CreateEvent() fails from an IIS 7.5 web application","body":"<p>I am working with a native library (<a href=\"https://github.com/zeromq/libzmq\" rel=\"nofollow\">libzmq</a>), which is called by a C# wrapper (<a href=\"https://github.com/zeromq/clrzmq\" rel=\"nofollow\">clrzmq</a>). It is being used by an IIS web application (IIS 7.5, Windows Server 2008 R2, ASP.NET MVC 3).</p>\n\n<p>The native library makes a call to <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms682396%28v=vs.85%29.aspx\" rel=\"nofollow\">CreateEvent()</a> but this fails when running the web application using the ApplicationPoolIdentity. It works if I use the LocalSystem account instead but I'd rather not do this.</p>\n\n<p>I have tried both with and without the \"Global\\\" prefix for the event name.</p>\n\n<p><strong>Is there a way of giving the ApplicationPoolIdentity the required permissions?</strong></p>\n\n<p>The relevant snippet of code is below:</p>\n\n<pre><code>//  Make the following critical section accessible to everyone.\nSECURITY_ATTRIBUTES sa = {0};\nsa.nLength = sizeof (sa);\nsa.bInheritHandle = FALSE;\nSECURITY_DESCRIPTOR sd;\nBOOL ok = InitializeSecurityDescriptor (&amp;sd, SECURITY_DESCRIPTOR_REVISION);\nwin_assert (ok);\nok = SetSecurityDescriptorDacl(&amp;sd, TRUE, (PACL) NULL, FALSE);\nwin_assert (ok);\nsa.lpSecurityDescriptor = &amp;sd;\n\n//  This function has to be in a system-wide critical section so that\n//  two instances of the library don't accidentally create signaler\n//  crossing the process boundary.\nHANDLE sync = CreateEvent (&amp;sa, FALSE, TRUE,\n    \"Global\\\\zmq-signaler-port-sync\");\nwin_assert (sync != NULL);\n</code></pre>\n\n<p>It fails on the last line, because sync is null.</p>\n\n<p>For reference:</p>\n\n<pre><code>// Provides convenient way to check GetLastError-style errors on Windows.\n#define win_assert(x) \\\n    do {\\\n        if (unlikely (!(x))) {\\\n            char errstr [256];\\\n            zmq::win_error (errstr, 256);\\\n            fprintf (stderr, \"Assertion failed: %s (%s:%d)\\n\", errstr, \\\n                __FILE__, __LINE__);\\\n            zmq::zmq_abort (errstr);\\\n        }\\\n    } while (false)\n\n#endif\n</code></pre>\n"},{"tags":["c++","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":441,"score":0,"question_id":5687706,"title":"Understanding VerQueryValue","body":"<p>On MSDN I noticed the following for the VerQueryValue function:</p>\n\n<blockquote>\n  <p>lplpBuffer [out]<br>\n  LPVOID<br>\n  When this method returns, contains the address of a pointer to the requested version information in the buffer pointed to by pBlock. <strong>The memory pointed to by lplpBuffer is freed when the associated pBlock memory is freed._</strong></p>\n</blockquote>\n\n<p>How does the system know when pBlock is freed since pBlock is allocated by the caller?</p>\n\n<p>I'm using the following code:</p>\n\n<pre><code>UINT reqSize = ::GetSystemDirectoryW(nullptr, 1);\n\nstd::vector&lt;wchar_t&gt; winDirectory (reqSize, 0);\n\nUINT retVal = ::GetSystemDirectoryW(&amp;winDirectory[0], reqSize);\n\nstd::wstring filePath(winDirectory.begin(), winDirectory.end()-1);\n\nfilePath.append(L\"\\\\kernel32.dll\");\n\nDWORD bufSize = ::GetFileVersionInfoSizeW(\n    filePath.c_str(),\n    nullptr);\n\nstd::vector&lt;BYTE&gt; fileInfo (bufSize, 0);\n\n::GetFileVersionInfoW(\n    filePath.c_str(),\n    0,\n    bufSize,\n    &amp;fileInfo[0]);\n\nUINT size = 0;\n\nVS_FIXEDFILEINFO * ptr = nullptr;\n\nBOOL error = ::VerQueryValueW(\n    &amp;fileInfo[0],\n    L\"\\\\\",\n    reinterpret_cast&lt;LPVOID*&gt;(&amp;ptr),\n    &amp;size);\n</code></pre>\n"},{"tags":["c++","winforms","api","winapi","dll"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13080821,"title":"C++ API DLL Project","body":"<p>I have a C++ project which uses an API that comes with DLL and LIB files, as well as a header file.\nI want to create a win32 forms project.</p>\n\n<p>My question is how do I link the project with the dll and lib files.</p>\n\n<p>But the main question is, how do I subscribe to events?\nIn the API I can call functions, which come back as on event response, which in a MFC project I would generally subscribe in the message loop. But in the Win32 there is no message loop.</p>\n\n<p>Maybe I am complicating the situation myself and it is easier than I imagine.\nPlease clarify this situation for me.</p>\n\n<p>Thank you.</p>\n"},{"tags":["c++","winapi","visual-c++","annotations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13078953,"title":"Code analysis says Inconsistent annotation for 'wWinMain' : this instance has no annotations","body":"<p>I'm writing some simple win32 stuff and I'm using the following wWinMain</p>\n\n<pre><code>int WINAPI wWinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, PWSTR pCmdLine, int nCmdShow)\n</code></pre>\n\n<p>VS2012 express code analysis says </p>\n\n<p>C28251  Inconsistent annotation for function: this instance has an error    Inconsistent annotation for 'wWinMain': this instance has no annotations. See c:\\program files (x86)\\windows kits\\8.0\\include\\um\\winbase.h(2201).   LeesSpaceShip   main.cpp    6</p>\n\n<p>I'm not clear on what an annotation even is.  So what is an annotation and which part is wrong on my code?</p>\n\n<p>Thank you.</p>\n\n<p>EDIT: and yes the code compiles and runs just fine.</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":190,"score":3,"question_id":12034943,"title":"Win32 - Select Directory Dialog from C/C++","body":"<p>How to select an existing folder (or create new) from the native Win32 application?</p>\n\n<p><a href=\"http://stackoverflow.com/questions/1922204/open-directory-dialog\">Here is a similar question</a>. It has a good answer for C#/.NET. But I want this for native Win32.</p>\n\n<p>Anybody knows a solution, free code, etc?</p>\n\n<p><strong>Update:</strong></p>\n\n<p>I tried the function from the answer. Everything worked as expected, except it is necessary to call the <code>SHGetPathFromIDList</code> function to retrieve the name of selected directory. Here is a sample screen shot:</p>\n\n<p><img src=\"http://i.stack.imgur.com/HHPV2.jpg\" alt=\"Example of the directory pickup dialog.\"></p>\n"},{"tags":["winapi","logging","keyboard","raw-input"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":10,"score":-1,"question_id":13078742,"title":"keyboard RawInput Log non english keys","body":"<p>how  can log (write to file) Non-English character  when dealin with Raw keyboard input ?</p>\n\n<pre><code>        HWND hActive = GetActiveWindow();\n        DWORD dwThreadID = GetWindowThreadProcessId(hActive, NULL);\n        HKL hKL = GetKeyboardLayout(dwThreadID);\n\n        BYTE lpKeyState[256];\n        GetKeyboardState(lpKeyState);\n\n        wchar_t sBuffer[256];\n        ToUnicodeEx(Vkey, MapVirtualKeyEx(Vkey, MAPVK_VK_TO_VSC, hKL), lpKeyState, sBuffer, 256, 0, hKL);\n\n        WriteFile(hLog, sBuffer, wcslen(sBuffer), &amp;dwWritten, NULL);\n</code></pre>\n\n<p>this  output is english keys</p>\n\n<p>thanks</p>\n"}]}
{"total":13828,"page":4,"pagesize":100,"questions":[{"tags":["c++","windows","winapi","active-directory"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":102,"score":2,"question_id":13067529,"title":"Password Expiry Date using c++?","body":"<p>i want to display the password expiry dialogbox using c++ win32 API...</p>\n\n<p>i done it using System.directoryservice namespace...</p>\n\n<p>But now i need in Win32 API..</p>\n\n<p>Any functions there for get password expiry date?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["delphi","winapi","windows-networking"],"answer_count":1,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":345,"score":4,"question_id":11178480,"title":"Mapping a network drive (WebDAV) doesn't work with Windows XP","body":"<p>i've got a problem mapping a network drive (WebDAV) under Windows XP using API method WNetAddConnection2. Under Windows 7 or it works like a charme. My code:</p>\n\n<pre><code>function ConnectDrive(Drive: string; Folder: string;\nUsername: string; Password: string; RestoreAtLogon: Boolean): HRESULT;\n\nvar\n  NetResource: TNetResource;\n  dwFlags: DWORD;\nbegin\n  with NetResource do\n  begin\n    dwType := RESOURCETYPE_DISK;\n    lpLocalName := PChar(Drive);\n    lpRemoteName := PChar(Folder);\n    lpProvider := nil;\n  end;\n\n  if (RestoreAtLogon) then\n    dwFlags := CONNECT_UPDATE_PROFILE\n  else\n    dwFlags := 0;\n\n  Result := WNetAddConnection2(NetResource, PChar(Password),\n    PChar(Username), dwFlags);\nend;\n</code></pre>\n\n<p>Everytime i try to connect Windows tells me: \"The Network name cannot be found\" or \"The Network path cannot be found\"</p>\n\n<p>As i said before, under Windows 7 there is no problem.</p>\n\n<p>If i use commercial tools like Netdrive, this program has no problem mounting the drive under XP, Vista or Windows 7.</p>\n\n<p>Has anyone an idea?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["c#","winapi","process","pinvoke","win32-process"],"answer_count":5,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":305,"score":3,"question_id":5724759,"title":"Stop a process from showing a window from C#","body":"<p>I'm trying to automate an application that creates a GUI window on startup that has no user interaction, but I can't figure out how to hide the actual window.</p>\n\n<p>I've tried using ProcessStartInfo thus:</p>\n\n<pre><code>Process.Start(new ProcessStartInfo {\n    UseShellExecute = false,\n    CreateNoWindow = true,\n    WindowStyle = ProcessWindowStyle.Hidden,\n\n    // other properties here\n});\n</code></pre>\n\n<p>But the window still shows up.</p>\n\n<p>I've also tried spin-waiting for the window to exist, and then hiding it:</p>\n\n<pre><code>while (process.MainWindowHandle == IntPtr.Zero) {}\nShowWindowAsync(process.MainWindowHandle, SW_HIDE);\n</code></pre>\n\n<p>This, unfortunately, makes the window flash for about 1/16th of a second or so, and I'd like to avoid it if at all possible.</p>\n\n<p>My current thoughts are along the line of creating a <a href=\"http://msdn.microsoft.com/en-us/library/ms644959%28v=vs.85%29.aspx\" rel=\"nofollow\">hook</a>, but am unsure of what hooks to grab, nor if it will even work.</p>\n\n<p>Any tips?</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13070800,"title":"C++: How do I use SetLayeredWindowAttributes() only on a parent window?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1294805/transparent-window-containing-opaque-text-and-buttons\">Transparent window containing opaque text and buttons</a>  </p>\n</blockquote>\n\n\n\n<p>I'm trying to manipulate an existing window with <strong>C++</strong>.</p>\n\n<p>Basically, what I'm trying to do is set the parent window transparent via first setting its window style to <code>WS_EX_LAYERED</code> and then using <code>SetLayeredWindowAttributes()</code> with the right values.</p>\n\n<p>The problem is that that will set the child windows to transparent also, which will make the whole program transparent (obviously a problem).</p>\n\n<p>Any ideas?</p>\n\n<p><strong>EDIT</strong> Image demonstrating the problem: <img src=\"http://i.stack.imgur.com/tX2qA.png\" alt=\"enter image description here\"></p>\n\n<p>As you might see, I set the taskbars window style to <code>WS_EX_LAYERED</code>, but for example the window <code>MSTaskSwWClass</code> (the window that has the running application icons) is also affected.</p>\n\n<p><strong>EDIT2</strong> Tried <code>UpdateLayeredWindow()</code> with the exact same outcome.</p>\n"},{"tags":["winapi","mfc","wtl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13066267,"title":"Moving a listview item from one group to another","body":"<p>I have created a listview in Win32 with group view enabled, I can add Items to a group, but I Have multiple groups and I want an item to pass from group A to group B. I have found the macro ListView_MoveItemToGroup, I call it like so  </p>\n\n<pre><code>int i =0;\ni = m_taskList.GetSelectedIndex();\n\nbool ret = ListView_MoveItemToGroup(m_taskList.m_hWnd,i,LVI_GROUPID_EXEC);\n</code></pre>\n\n<p>but ret is false; What I am doing wrong, the LVI_GROUP_EXEC is added to the litview.</p>\n"},{"tags":[".net","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13072625,"title":"Creating a Folder that pulls in links to files in multiple other folders","body":"<p>I may be a little out of my depth, but I figure that this should be possible, I was wondering if there was a way to create a folder that looks through a number of other folders and creates links to certain files within those folders. Essentially, the idea is that One department has a lot of files scattered throughout a lot of folders, and another department needs access to those files, but does not want to have to navigate through the unfamiliar, relatively complicated, directory, so I want to create a single folder that creates shortcuts to everything they need, and that updates the shortcuts that it contains as new files are added.</p>\n\n<p>Should I be using the Win32 API or the .NET framework? Or are neither of these appropriate for what I'm attempting? Any advice is much appreciated.</p>\n\n<p>Thanks,\nEric</p>\n"},{"tags":["winapi","gdi+"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13072549,"title":"How to store mouse coordinates in GDI+?","body":"<p>I wanted to ask if a POINT structure is the only way to store mouse coordinates ? My problem with this way is that when you declare:</p>\n\n<pre><code>POINT ps[20];\n</code></pre>\n\n<p>you need to have a fixed size array. What if I need to store more points ? Is there a way to make it dynamic (to resize itself when it reaches the limit). I want to use this array to get mouse coordinates and then draw lines in WM_PAINT: message. thx</p>\n\n<pre><code>case WM_MOUSEMOVE:\n{\n   pt[i].x=LOWORD(lparam);\n   pt[i++].y=HIWORD(lparam);\n --------\n}\n</code></pre>\n"},{"tags":["http","winapi","winhttp"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":93,"score":5,"question_id":12939416,"title":"Retrieve HTTP response even if malformed from WinHTTP","body":"<p>With WinHTTP, WinHttpReceiveResponse will return ERROR_WINHTTP_INVALID_SERVER_RESPONSE if there is something wrong with an HTTP header for example.  </p>\n\n<p>Is there anyway to get to the data that was returned, despite the fact that it was malformed?</p>\n"},{"tags":["c++","winapi","gdi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13067687,"title":"Add a child window to a Layered window","body":"<p>Here is the problem. I have a layered window which represents the main GUI of my application. I created another window that hosts an IWebBrowser2 ActiveX control to show a part of a website. I am trying to add the hwnd of the browser window to the main window. If the parent window is a normal window everything is fine but when i try to create it as a WS_EX_LAYERED window, the added browser window does not appear anymore. How can i signal the main window to draw the other window too?</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":71,"score":1,"question_id":13070858,"title":"Creating a registry key - access denied","body":"<p>Hi I am trying to create a registry key in C++ but I keep getting the error 5 which googling told me it was access denied but I don't know to do get the correct privileges. I'm using windows 7 and here's my code. Thanks</p>\n\n<pre><code>HRESULT hr = S_OK;\nUINT er = ERROR_SUCCESS;\nLPWSTR szValueBuf = NULL;\nchar szProductName[MAX_PATH];\nLPSECURITY_ATTRIBUTES lpsa;\nHKEY hOrchKey;\nDWORD dwOpenStatus,\n      dwType;\nchar szProuductKey[MAX_PATH];\n\nhr = WcaInitialize(hInstall, \"CreateProductKey\");\nExitOnFailure(hr, \"Failed to initialize\");\n\nWcaLog(LOGMSG_STANDARD, \"Initialized.\");\n\n\nif (!(lpsa = default_sa()))\n    return FALSE;\n\nhr = WcaGetProperty(L\"PRODUCTNAME\",&amp;szValueBuf);\nExitOnFailure(hr, \"failed to get Product Name\");\n\nwcstombs(szProductName, szValueBuf, 260);\n\nsprintf(szProuductKey,\"SOFTWARE\\\\Company\\\\%s\",szProductName);\n\n// Open the registery Orchestrator key\nif (RegCreateKeyEx(HKEY_LOCAL_MACHINE,\n                szProuductKey,\n                0,\n                \"\",\n                REG_OPTION_NON_VOLATILE,\n                KEY_QUERY_VALUE,\n                lpsa,\n                &amp;hOrchKey,\n                &amp;dwOpenStatus) != ERROR_SUCCESS )\n    return FALSE;   \n\nOS_RegCloseKey(hOrchKey);\nreturn TRUE;\n</code></pre>\n"},{"tags":["c#",".net","winapi","windows-8"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":123,"score":3,"question_id":10892105,"title":"File History on windows 8","body":"<p>I have a question related to <a href=\"http://stackoverflow.com/questions/10160999/get-set-file-history-windows-8-settings-using-c-sharp\">Get/Set “File History” (Windows 8) settings using C#</a> </p>\n\n<p>Windows has provided an API <a href=\"http://msdn.microsoft.com/en-us/library/hh829789%28v=vs.85%29.aspx\" rel=\"nofollow\">File History API</a> that <em>\"allows applications to read and modify the File History configuration\"</em> </p>\n\n<ol>\n<li>Is there a C# version of this API?</li>\n<li>Does it require .NET 4.5?</li>\n<li>Are there any code samples of how to use this API?</li>\n</ol>\n"},{"tags":["winapi","modal-dialog","dialogbox"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":20,"score":2,"question_id":13070408,"title":"Why is WM_CLOSE not handled automatically by DefDlgProc?","body":"<p>When I create a dialog using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms645452%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>DialogBox</code></a>, it won't close unless I handle WM_CLOSE in my own <code>DLGPROC</code> function and call <code>EndDialog</code>. </p>\n\n<p>I know that this is by design, but I'm interested why was it chosen for WM_CLOSE not to be handled automatically by DefDlgProc? Are there any good reasons for that?</p>\n"},{"tags":["c#","winforms","winapi","hook","setwindowshookex"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13067417,"title":"Is it possible to implement a Windows hook on a specific Window only?","body":"<p>Seems like when I create the hook it automatically links to <strong>ALL</strong> the Windows in my application, I only need it to hook to Window1.</p>\n\n<p>The result must be that when you hover the mouse over the created forms it must only change the <code>ActiveForm.Text</code> when the user hovers over Window1.</p>\n\n<p><img src=\"http://i.stack.imgur.com/u17zH.jpg\" alt=\"enter image description here\"> </p>\n\n<pre><code>public delegate int HookProc(int nCode, IntPtr wParam, IntPtr lParam);\nstatic int hHook = 0;\npublic const int WH_MOUSE = 7;\nHookProc MouseHookProcedure;\n\n[DllImport(\"user32.dll\")]\npublic static extern IntPtr FindWindow(String sClassName, String sAppName);\n\n\n[DllImport(\"user32.dll\", SetLastError = true)]\nstatic extern uint GetWindowThreadProcessId(IntPtr hWnd, IntPtr ProcessId);\n\n\n[DllImport(\"user32.dll\", CharSet = CharSet.Auto, CallingConvention = CallingConvention.StdCall)]\npublic static extern int SetWindowsHookEx(int idHook, HookProc lpfn, IntPtr hInstance, int threadId);\n\n\n[DllImport(\"user32.dll\", CharSet = CharSet.Auto, CallingConvention = CallingConvention.StdCall)]\npublic static extern bool UnhookWindowsHookEx(int idHook);\n\n\n[DllImport(\"user32.dll\", CharSet = CharSet.Auto, CallingConvention = CallingConvention.StdCall)]\npublic static extern int CallNextHookEx(int idHook, int nCode, IntPtr wParam, IntPtr lParam);\n\n\n[StructLayout(LayoutKind.Sequential)]\npublic class POINT\n{\n    public int x;\n    public int y;\n}\n\n[StructLayout(LayoutKind.Sequential)]\npublic class MouseHookStruct\n{\n    public POINT pt;\n    public int hwnd;\n    public int wHitTestCode;\n    public int dwExtraInfo;\n}\n\npublic void Start(string windowTitle)\n{\n    if (hHook == 0 &amp; windowTitle == \"Window1\")\n    {\n        this.lblWindowType.Text = \"Parent\";\n        MouseHookProcedure = new HookProc(MouseHookProc);\n        IntPtr wordWindow = FindWindow(null, windowTitle);\n        var threadId = GetWindowThreadProcessId(wordWindow, IntPtr.Zero);\n\n        hHook = SetWindowsHookEx(WH_MOUSE, MouseHookProcedure, IntPtr.Zero, unchecked((int)threadId));\n    }\n}\n\npublic static int MouseHookProc(int nCode, IntPtr wParam, IntPtr lParam)\n{\n    MouseHookStruct hook = (MouseHookStruct)Marshal.PtrToStructure(lParam, typeof(MouseHookStruct));\n    ActiveForm.Text =\n        String.Format(\"{0},{1}\", hook.pt.x.ToString(), hook.pt.y.ToString());\n\n    if (nCode &lt; 0)\n    {\n        return CallNextHookEx(hHook, nCode, wParam, lParam);\n    }\n    else\n    {\n        return CallNextHookEx(hHook, nCode, wParam, lParam);\n    }\n}\n\nprivate void Window1_Load(object sender, EventArgs e)\n{\n    Start(this.Text);\n}\n\nprivate void btnAddWindow_Click(object sender, EventArgs e)\n{\n    Window1 win = new Window1();\n    win.Text = \"Window2\";\n    win.lblWindowType.Text = \"Child\";\n    win.Show();\n}\n</code></pre>\n"},{"tags":["c#",".net","winapi","webcam"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":13058161,"title":"How to get list of connected WebCams in avicap32.dll?","body":"<p>I'm coding an application to handle WebCams. I have to use (this is an external constraint) the avicap32.dll library. So here I am, using some extern functions (for which I have to marshal types) from this library, as well as user32 (sending WindowsMessages). And I digged up half the Internet, but failed to find how to get list of all the connected WebCam devices?</p>\n\n<p>Of course I'm fully aware of function:</p>\n\n<pre><code>[DllImport(avicap32dll)]\n[return: MarshalAs(UnmanagedType.Bool)]\npublic static extern bool capGetDriverDescription(\n    short driverIndex,\n    StringBuilder name, int nameSize,\n    StringBuilder version, int versionSize);\n</code></pre>\n\n<p>, but it gives me list of <strong>drivers</strong>, not <strong>cams</strong>! When I connect two cameras to my PC, I still can find only one capture driver by this function (checking driverIndex from 0 to 9). Both of them must be using the same capture driver. So, not having a list of WebCams I cannot really decide, to which one I want to connect. There is a WindowsMessage WM_CAP_DLG_VIDEOSOURCE, but it doesn't show video source dialog before I connect with a WebCam.</p>\n"},{"tags":["c++","windows","winapi","visual-c++","visual-studio-2012"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":456,"score":0,"question_id":11829249,"title":"Visual Studio 2012 app window creation/resizing differ from VS2008 window creation? Why?","body":"<p>@EDIT: I found out that it seems to be an issue of the Windows 8 RC, because I tried with Windows 7 and VS 2012, both classic and Aero view and it works fine. Thanks to @Werner Henze and @Ven Boigt for their feedback</p>\n\n<p>EDIT 2: Turns out this was a bug in Windows due to being beta and it was fixed in newer revisions so I don't have to worry about this anymore. Thanks for the feedback anyway.</p>\n\n<p>I used to do the following to create a window of an 800*600 client area:</p>\n\n<pre><code>dwStyle = WS_OVERLAPPED | WS_THICKFRAME | WS_BORDER | WS_DLGFRAME | WS_SYSMENU | WS_MINIMIZEBOX;\nhWindowHandle = CreateWindow(   L\"CGFramework\", wszWndCaption, \n                            pWindowData-&gt;dwStyle, pWindowData-&gt;nPositionX, pWindowData-&gt;nPositionY, \n                            800 + GetSystemMetrics( SM_CXSIZEFRAME )*2, \n                            600 + GetSystemMetrics( SM_CYSIZEFRAME ) *2\n                            + GetSystemMetrics( SM_CYCAPTION ),\n                            0, 0, hInstance, 0\n                        ); \n</code></pre>\n\n<p>Then when querying the client rect with GetClientRect, I used to get 800*600, but now I upgraded my Visual Studio 2008 project to VS2012, and now the GetClientRect() function is returning 792*592 instead. </p>\n\n<p>On top of that, the actual size of the window being created is 804*629, for which I see no reason as the resizeable frame (from WS_THICKFRAME) is obviously larger than 2 pixels on each side.</p>\n\n<p>I thought it was an issue of the Aero behaviour of Windows 8, but then I realized this is only happening with my VS2012 builds and not with my VS2008 builds. It makes no difference if I run it on Aero or the classic style, the behaviour will only apply to VS2012 builds. Why? Is there something I can change on my VS2012 project configuration to fix this horrible behaviour?</p>\n\n<p>I tried changing \"DPI Awareness\" setting of the project config, but this is not making any difference. I also removed the use of manifest in the same config page, still don't see any change in the resulting window.</p>\n\n<p>this is my test code:</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;cstdio&gt;\n\nLRESULT CALLBACK MainWndProc( HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam )\n{\n    switch( uMsg )\n    {\n    // WM_DESTROY is sent when the window is being destroyed.\n    case WM_DESTROY:\n        PostQuitMessage(0);\n        return 0;\n    default:\n        return DefWindowProc( hWnd, uMsg, wParam, lParam );\n    }\n}\n\nint WINAPI WinMain( HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, INT nShowCmd )\n{\n\n    WNDCLASS wc;\n    wc.style                = NULL; // CS_HREDRAW | CS_VREDRAW;\n    wc.lpfnWndProc          = MainWndProc; \n    wc.cbClsExtra           = 0;\n    wc.cbWndExtra           = 0;\n    wc.hInstance            = hInstance;\n    wc.hIcon                = LoadIcon(0, IDI_APPLICATION);\n    wc.hCursor              = LoadCursor(0, IDC_ARROW);\n    wc.hbrBackground        = CreateSolidBrush(GetSysColor(COLOR_3DFACE));\n    wc.lpszMenuName         = 0;\n    wc.lpszClassName        = L\"CGFramework\";\n    DWORD dwStyle   = WS_OVERLAPPED | WS_THICKFRAME | WS_BORDER | \n                                WS_DLGFRAME | WS_SYSMENU | WS_MINIMIZEBOX; // WS_DLGFRAME | \n    if( !RegisterClass(&amp;wc) )\n    {\n        MessageBox(0, L\"RegisterClass FAILED\", 0, 0);\n        return E_FAIL;\n    }\n\n    RECT r;\n    //r.left        = 100;\n    //r.top     = 100;\n    //r.right       = 800;\n    //r.bottom  = 600;\n    ////-----------------------------\n    r.left      = 100;\n    r.top       = 100;\n    r.right     = 900;\n    r.bottom    = 700;\n    ////-----------------------------\n    //r.left        = 100;\n    //r.top     = 100;\n    //r.right       = 800+GetSystemMetrics( SM_CXFRAME )*2;\n    //r.bottom  = 600+GetSystemMetrics( SM_CYFRAME )*2+GetSystemMetrics( SM_CYCAPTION );\n\n    BOOL result = AdjustWindowRect( &amp;r, dwStyle, FALSE );\n\n    HWND hWindowHandle = CreateWindow( L\"CGFramework\", L\"testWindow\", dwStyle,\n                          r.left, r.top, r.right-r.left, r.bottom-r.top, \n                          // r.left, r.top, r.right, r.bottom, \n                          0, 0, hInstance, 0 );\n\n\n\n    if( 0 == hWindowHandle )\n    {\n        MessageBox(0, L\"CreateWindow FAILED\", 0, 0);\n        UnregisterClass( wc.lpszClassName, hInstance );\n        return 0;\n    }\n\n    char buffer[512]; // for outing test message\n    GetClientRect( hWindowHandle, &amp;r );\n    sprintf( &amp;buffer[0], \"left=%i, top=%i, right=%i, bottom=%i\", r.left, r.top, r.right, r.bottom );\n    MessageBoxA(0, buffer, 0, 0); // print rect values before ShowWindow\n\n    ShowWindow( hWindowHandle, SW_SHOW );\n\n    GetClientRect( hWindowHandle, &amp;r );\n    sprintf( &amp;buffer[0], \"left=%i, top=%i, right=%i, bottom=%i\", r.left, r.top, r.right, r.bottom );\n    MessageBoxA(0, buffer, 0, 0);  // print rect values after ShowWindow\n\n    // main window loop\n    MSG msg;\n    ZeroMemory( &amp;msg, sizeof( MSG ) );\n    while( msg.message != WM_QUIT )\n    {\n        while( PeekMessage( &amp;msg, 0, 0, 0, PM_REMOVE ) )\n        {\n            TranslateMessage( &amp;msg );\n            DispatchMessage( &amp;msg );\n        }\n\n        if( GetAsyncKeyState( VK_ESCAPE ) )\n            DestroyWindow( hWindowHandle );\n    }\n    UnregisterClass( wc.lpszClassName, hInstance );\n    return 0;\n}\n</code></pre>\n\n<p>Please watch carefullly the code before answering as you may end up answering something I already tried (I'm posting this question because I already wasted all my choices).</p>\n\n<p>I'm using Windows 8 RC (MS windows 6.2.8400) and VS2012 RC (11.0.50706.0 QRELRC July 2012) to get this weird behaviour and none of the kind answers were able to address this issue. Be sure of reading them and testing my code before making any assumptions, as this code has been tested in many ways with subtle differences which in the end provided no improvement.</p>\n"},{"tags":["c++","windows","multithreading","winapi","token"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":202,"score":0,"question_id":5141997,"title":"Is there a way to set a token for another process?","body":"<p>There is SetThreadToken() function but no such function as \"SetProcessToken()\".</p>\n\n<p>Is there a way to set a token for another process? How to write \"SetProcessToken()\"?</p>\n"},{"tags":["delphi","winapi","tstringgrid"],"answer_count":1,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":80,"score":6,"question_id":13060257,"title":"What is the normal colo(u)r of a selected stringgrid row?","body":"<p>I am overriding <code>OnDrawCell</code> for a string grid. In certain circumstance, I want to use the normal <code>TColor</code> that is used for the selected row when the system does the drawing (no <code>OnDrawCell</code>).</p>\n\n<p>Which colo(u)r is that? clXXX ?</p>\n"},{"tags":["c#","c++","windows","winapi"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":136,"score":2,"question_id":12395327,"title":"Win32 OpenFileDialog Does Not Filter *.DOCX Shortcuts","body":"<p>I could do this on several different computers with Windows 7 SP1.</p>\n\n<p>This can be duplicated in Notepad (or any other app that uses <code>OpenFileDialog</code>)</p>\n\n<ol>\n<li>Create a shortcut to a DOCX</li>\n<li>Launch notepad</li>\n<li>File, Open</li>\n<li>Filter on *.txt</li>\n<li>Browse to location of *.docx shortcut</li>\n</ol>\n\n<p>*.docx is the only shortcut extension I can find that does not filter. So far my only workaround is for my application to check the file extension after the user selects a file.</p>\n\n<p>Is there some way to make <code>OpenFileDialog</code> filter out *.docx.lnk files as the user might expect it to?</p>\n\n<p>Why are only Office file extensions affected?</p>\n"},{"tags":["c++","winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13064745,"title":"How to get process relative time","body":"<p>Is there any way to get the process's execution time without using <code>GetTickCount</code> and <code>System Time</code> inside a C++ application?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":75,"score":4,"question_id":13064474,"title":"What could cause a deadlock of a single write/multiple read lock?","body":"<p>I have a class instance that is used by several other classes in other threads to communicate.</p>\n\n<p>This class uses a slim reader/writer lock (WinAPI's <code>SRWLOCK</code>) as a synchronization object and a couple of RAII helper classes to actually lock/unlock the thing:</p>\n\n<pre><code>static unsigned int readCounter = 0;\n\nclass CReadLock\n{\npublic:\n    CReadLock(SRWLOCK&amp; Lock) : m_Lock(Lock) { InterlockedIncrement(&amp;readCounter); AcquireSRWLockShared(&amp;m_Lock);  }\n    ~CReadLock() {ReleaseSRWLockShared(m_Lock); InterlockedDecrement(&amp;readCounter);}\n\nprivate:\n    SRWLOCK&amp; m_Lock;\n};\n\nclass CWriteLock\n{\npublic:\n    CWriteLock(SRWLOCK&amp; Lock) : m_Lock(Lock) { AcquireSRWLockExclusive(&amp;m_Lock); }\n    ~CWriteLock() { ReleaseSRWLockExclusive(&amp;m_Lock); }\n\nprivate:\n    SRWLOCK&amp; m_Lock;\n};\n</code></pre>\n\n<p>The problem is the whole thing deadlocks all the time. When I pause the deadlocked program, I see:</p>\n\n<ul>\n<li>one thread stuck in <code>AcquireSRWLockExclusive()</code>;</li>\n<li>two threads stuck in <code>AcquireSRWLockShared()</code>;</li>\n<li><code>readCounter</code> global is set to 3.</li>\n</ul>\n\n<p>The way I see it, the only way for this to happen is <code>CReadLock</code> instance's destructor hasn't been called somehow somewhere so the lock is perpetually stuck. However, the only way for this to happen (as far as I know) is because an exception has been thrown. It wasn't. I checked.</p>\n\n<p>What might be the problem? How should I go about fixing (or at least locating the reason of) this thing?</p>\n"},{"tags":["c++","multithreading","winapi","createfile","readdirectorychangesw"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13063710,"title":"CreateFile ,ReadDirectoryChanges issue","body":"<p>I’m using <code>ReadDirectoryChangesW</code> to spy a folder that I opened with <code>CreateFile</code>, once a file was added I call a function (<code>OnFileChanged</code>) that read the size and open it for reading, my application works fine for small sized file but the problem occurs when I try to copy a big file into my folder(7,24 M), and I get <code>Permission denied</code> error after calling fopen to read it. </p>\n\n<p>the watching process is based on <a href=\"http://sumatrapdf.googlecode.com/svn/trunk/src/FileWatch.h\" rel=\"nofollow\">this</a></p>\n\n<pre><code>    void Init(const QString FullPath)\n    {    ...\n         hDir = CreateFile(\n                dirPath, // pointer to the directory containing the tex files\n                FILE_LIST_DIRECTORY|GENERIC_READ,                // access (read-write) mode\n                FILE_SHARE_READ|FILE_SHARE_DELETE|FILE_SHARE_WRITE,  // share mode\n                NULL, // security descriptor\n                OPEN_EXISTING, // how to create\n                FILE_FLAG_BACKUP_SEMANTICS  | FILE_FLAG_OVERLAPPED , // file attributes\n                NULL); // file with attributes to copy\n\n\n            SecureZeroMemory (&amp;overl, sizeof(overl));\n            SecureZeroMemory(buffer, sizeof(buffer));\n            overl.hEvent = CreateEvent(NULL, FALSE, FALSE, NULL);\n\n            // watch the directory\n           BOOL res= ReadDirectoryChangesW(\n                 hDir, /* handle to directory */\n                 &amp;buffer[curBuffer], /* read results buffer */\n                 sizeof(buffer[curBuffer]), /* length of buffer */\n                 FALSE, /* monitoring option */\n                 FILE_NOTIFY_CHANGE_FILE_NAME ,\n                 //FILE_NOTIFY_CHANGE_LAST_WRITE, /* filter conditions */\n                 NULL, /* bytes returned */\n                 &amp;overl, /* overlapped buffer */\n                 NULL); /* completion routine */\n\n    }\n\nvoid StartWatchThread()\n{\n    // if the thread already exists then stop it\n    if (IsThreadRunning())\n        SynchronousAbort();\n\n    //CrashIf(!hDir);\n    if(!hDir)\n       { qDebug()&lt;&lt;\" handle \"&lt;&lt;hDir&lt;&lt;\" last error\"&lt;&lt;GetLastError();\n        exit(-1);}\n\n    else\n    {// reset the hEvtStopWatching event so that it can be set if\n    // some thread requires the watching thread to stop\n    ResetEvent(hEvtStopWatching);\n\n    DWORD watchingthreadID;\n    qDebug()&lt;&lt;\"befrore creating thread\";\n    hWatchingThread = CreateThread(NULL, 0, WatchingThread, this, 0, &amp;watchingthreadID);\n    qDebug()&lt;&lt;\"watchingthreadID\"&lt;&lt;watchingthreadID;\n    }\n}\n\n\nDWORD WINAPI WatchingThread(void *param)\n{\n    //qDebug()&lt;&lt;\"in WatchingThread\";\n    FileWatcher *fw = (FileWatcher *)param;\n\n    HANDLE hp[2] = { fw-&gt;hEvtStopWatching, fw-&gt;overl.hEvent };\n    for (;;)\n    {\n\n        DWORD dwObj = WaitForMultipleObjects((sizeof(hp)/(sizeof(hp[0])))\n                                             , hp, FALSE, INFINITE);\n        if (dwObj == WAIT_OBJECT_0) // the user asked to quit the program\n        {\n            qDebug()&lt;&lt;\"in WatchingThread the user asked to quit the program\";\n            //exit(-1);\n            break;\n        }\n        if (dwObj != WAIT_OBJECT_0 + 1)\n        {\n            // BUG!\n            //assert(0);\n            qDebug()&lt;&lt;\"dwObj \"&lt;&lt;dwObj&lt;&lt;\" last error \"&lt;&lt;GetLastError();\n            break;\n        }\n        //qDebug()&lt;&lt;\"WatchingThread fw-&gt;NotifyChange() \";\n\n        //if (fw-&gt;wakeup)\n            fw-&gt;NotifyChange();\n\n    }\n    return 0;\n} \n\n\nbool NotifyChange()\n{\n    //qDebug()&lt;&lt;\"in NotifyChange\";\n\n    GetOverlappedResult(hDir, &amp;overl, &amp;dwNumberbytes, FALSE);\n\n    FILE_NOTIFY_INFORMATION *pFileNotify = (FILE_NOTIFY_INFORMATION *)buffer[curBuffer];\n    // Switch the 2 buffers\n    curBuffer = (curBuffer + 1) % (sizeof(buffer)/(sizeof(buffer[0])));\n    SecureZeroMemory(buffer[curBuffer], sizeof(buffer[curBuffer]));\n    // start a new asynchronous call to ReadDirectory in the alternate buffer\n    ReadDirectoryChangesW(\n         hDir, /* handle to directory */\n         &amp;buffer[curBuffer], /* read results buffer */\n         sizeof(buffer[curBuffer]), /* length of buffer */\n         FALSE, /* monitoring option */\n         FILE_NOTIFY_CHANGE_FILE_NAME  ,\n         //FILE_NOTIFY_CHANGE_LAST_WRITE, /* filter conditions */\n         NULL, /* bytes returned */\n        &amp;overl, /* overlapped buffer */\n         NULL); /* completion routine */\n\n    // Note: the ReadDirectoryChangesW API fills the buffer with WCHAR strings.\n    for (;;) {\n\n        if (pFileNotify-&gt;Action == FILE_ACTION_ADDED)\n        {\n            qDebug()&lt;&lt;\"in NotifyChange if \";\n                char szAction[42];\n                char szFilename[MAX_PATH] ;\n                memset(szFilename,'\\0',sizeof( szFilename));\n                strcpy(szAction,\"added\");\n                wcstombs( szFilename, pFileNotify-&gt;FileName, MAX_PATH);\n\n                OnFileChanged(szFilename,szAction);\n                qDebug()&lt;&lt;\"in NotifyChange after OnFileChanged \";\n\n        }\n\n        // step to the next entry if there is one\n        if (!pFileNotify-&gt;NextEntryOffset)\n            return false;\n        pFileNotify = (FILE_NOTIFY_INFORMATION *)((PBYTE)pFileNotify + pFileNotify-&gt;NextEntryOffset);\n    }\n    pFileNotify=NULL;\n    return true;\n}\n</code></pre>\n\n<p>I couldn't figure out how is handling the file and don't let me read it?\nI tried to call Sleep() after calling <code>OnFileChanged</code> and wake up when it finish but in vain. \nAny idea please .</p>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12915734,"title":"A global keyboard hook with a delay","body":"<p>I'm making a \"driver\" for a barcode scanner.</p>\n\n<p>This particular scanner is basically a USB keyboard that generates keystrokes whenever something is scanned.</p>\n\n<p>I want to find a way to distinguish these keystrokes from those keystrokes a proper keyboard sends. Unfortunately the only difference is that scanner generates keystrokes <em>really</em> fast, a bunch of keyups and keydowns in a fraction of a second.</p>\n\n<p>The way I see it is I have to set up a global keyboard hook that intercepts all input, stores it somehow, waits for a tiny bit then either sends those keystrokes further down the hook chain or assumes they are something that scanner generated and handles them appropriately.</p>\n\n<p>However, having no prior experience with hooks, I am not sure about the right way to do it. Can I just invoke <code>CallNextHookEx()</code> in some method other than <code>KeyboardProc()</code> in some other thread to pass the delayed keystroke event? Or should I rather generate a new <code>WM_KEYPRESS</code> message manually? Maybe there is an altogether better way to go about this thing?</p>\n\n<p>Thanks.</p>\n"},{"tags":["c++","c","winapi","asynchronous","readdirectorychangesw"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":12897664,"title":"ReadDirectoryChangesW issues","body":"<p>I'am using  <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa365465%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>ReadDirectoryChangesW</code></a>  to watch a directory changes asynchronously, based on this <a href=\"http://stackoverflow.com/questions/6150984/asynchronous-readdirectorychangesw-getqueuedcompletionstatus-always-times-out?rq=1\">question</a> I implement a function that watch a given directory, but I still get the error message  <code>GetQueuedCompletionStatus(): Timeout</code></p>\n\n<pre><code>void Filewatcher::OpenWatchDir(QString PathToOpen)\n{\n\n    QString path=QDir::fromNativeSeparators(PathToOpen);\n\n    LPCTSTR  Dirname=(LPCTSTR)path.utf16();//.toStdWString().c_str();\n\n    dirinfo_t* d =(dirinfo_t*) malloc(1*sizeof(dirinfo_t));\n    d-&gt;CompletionKey = (ULONG_PTR)&amp;somekey;\n    dirinfo_init(d);\n\n    /* set up */\n    runthread = TRUE;\n    d-&gt;hDirFH = CreateFile(Dirname,\n                    FILE_LIST_DIRECTORY,\n                    FILE_SHARE_READ|FILE_SHARE_WRITE,\n                    NULL,\n                    OPEN_EXISTING,\n                    FILE_FLAG_BACKUP_SEMANTICS | FILE_FLAG_OVERLAPPED,\n                    NULL);\n\n    d-&gt;hDirOPPort = CreateIoCompletionPort(d-&gt;hDirFH, NULL,\n                          (ULONG_PTR)d-&gt;CompletionKey, 1);\n\n    DWORD errorcode = 0;    // an error code\n    BOOL bResultQ = FALSE;  // obvios=us\n    BOOL bResultR = FALSE;\n    DWORD NumBytes = 0;\n    FILE_NOTIFY_INFORMATION* pInfo = NULL; // the data incoming is a pointer\n                                           // to this struct.\n    int i = 0;\n\n    while ( runthread )\n        {\n            bResultR = ReadDirectoryChangesW(d-&gt;hDirFH, (void*)d-&gt;buffer,\n                                              16777216, TRUE,\n                   FILE_NOTIFY_CHANGE_FILE_NAME  | FILE_NOTIFY_CHANGE_CREATION  ,\n                                              NULL,\n                                              &amp;d-&gt;o-&gt;overlapped,\n                                              NULL );\n            bResultQ = GetQueuedCompletionStatus(d-&gt;hDirOPPort,\n                                                 &amp;NumBytes, &amp;(d-&gt;CompletionKey),\n                                                 (LPOVERLAPPED*)(d-&gt;o), 1000);\n            if ( bResultQ &amp;&amp; bResultR )\n                    {\n                wprintf(L\"\\n\");\n                pInfo = (FILE_NOTIFY_INFORMATION*) d-&gt;buffer;\n                wprintf(L\"File %s\", pInfo-&gt;FileName);\n                wprintf(L\" changes %d\\n\", pInfo-&gt;Action);\n\n                qDebug()&lt;&lt;\"file  \"&lt;&lt;pInfo-&gt;FileName&lt;&lt;\" was\"&lt;&lt;pInfo-&gt;Action;\n                memset(d-&gt;buffer, 0, 16777216);\n            }\n            else\n                   {\n                       errorcode = GetLastError();\n\n                       if ( errorcode == WAIT_TIMEOUT )\n                       {\n                           qDebug()&lt;&lt;\"GetQueuedCompletionStatus(): Timeout\\n\";\n                       }\n                       else\n                       {\n                           qDebug()&lt;&lt;\"GetQueuedCompletionStatus(): Failed\\n\";\n                           qDebug()&lt;&lt;\"Error Code \"&lt;&lt;errorcode;\n                       }\n                       Sleep(500);\n                   }\n               }\n\n\n}\n</code></pre>\n\n<p>I need to know how use <code>ReadDirectoryChangesW</code> asynchronously with <code>IoCompletionPort</code>.</p>\n\n<p>Any help please.</p>\n"},{"tags":["c++","c","winapi","ipc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13060626,"title":"MailSlot write sending same thing three times C/C++","body":"<p>I have a problem with MailSlots in windows (C/C++).</p>\n\n<p>I am trying to make two simple programs right now, but the communication is not good at the last step.</p>\n\n<p>This is my int main from the server.cpp</p>\n\n<pre><code>    int main()\n{\nHANDLE      ss, sc, sc2r;\n   LPCTSTR     errMsg;\n\n   ss = CreateMailslot(\"\\\\\\\\.\\\\mailslot\\\\ss\", 0, MAILSLOT_WAIT_FOREVER, NULL);\n   if (ss == INVALID_HANDLE_VALUE) \n   {\n       printf(\"Invalid ss value\");\n       return -1;\n   }\n\n   for (;;)\n   {\n       DWORD   msgSize;\n       DWORD nr;\n       BOOL    err;\n\n       /* Get the size of the next record */\n       err = GetMailslotInfo(ss, 0, &amp;msgSize, 0, 0);\n           char x[100];\n           char nrr[10];\n\n       if (msgSize != (DWORD)MAILSLOT_NO_MESSAGE)\n       {\n               DWORD   numRead;\n               /* Read the record */\n               err = ReadFile(ss, x, msgSize, &amp;numRead, 0);\n               int wrds=count(x)+1;\n               sc = CreateFile(\"\\\\\\\\*\\\\mailslot\\\\sc\", GENERIC_WRITE, FILE_SHARE_READ, 0, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, 0);\n               itoa(wrds,nrr,10);\n\n               err = WriteFile(sc, nrr, sizeof(nrr), &amp;nr, 0);\n               //cout&lt;&lt;err&lt;&lt;endl;\n\n               //cout&lt;&lt;x;\n\n               //cout&lt;&lt;err;\n               strrev(x);\n               err=WriteFile(sc, x, sizeof(x), &amp;nr, 0);\n           }   \n       }\n  return(0);\n}\n</code></pre>\n\n<p>Here is the client source:</p>\n\n<pre><code>int main()\n{\n   HANDLE      ss, sc, sc2;\n   LPCTSTR     errMsg;\n   BOOL        err;\n   DWORD       numWritten;\n\n   sc = CreateMailslot(\"\\\\\\\\.\\\\mailslot\\\\sc\", 0, MAILSLOT_WAIT_FOREVER, NULL);\n   ss = CreateFile(\"\\\\\\\\*\\\\mailslot\\\\ss\", GENERIC_WRITE, FILE_SHARE_READ, 0, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, 0);\n\n   if (ss == INVALID_HANDLE_VALUE) \n   {\n       printf(\"CreateFile failed. \");  \n       // Close any mailslot we opened\n       if (ss != INVALID_HANDLE_VALUE) CloseHandle(ss);\n       return -1;\n   }\n\n   char x[100];\n   char z[100];\n\n   printf(\"Write the damn sentence:\");\n   cin.getline(x,100);\n   err = WriteFile(ss, x, sizeof(x), &amp;numWritten, 0);\n   if (!err) printf(\"WriteFile failed. \");\n   DWORD rd;\n\n   ReadFile(sc,x,sizeof(x),&amp;rd,NULL);\n   cout&lt;&lt;x&lt;&lt;endl;\n   ReadFile(sc,z,sizeof(z),&amp;rd,NULL);\n   cout&lt;&lt;z;\n\n   return 0;\n}\n</code></pre>\n\n<p>It seems like the server is sending the same thing three times. I tested the client in debugger and he gets it right, but can't figure it out why the server is sending three times the same thing.</p>\n\n<p>Do you have any suggestions ?</p>\n"},{"tags":["c++","windows","winapi","dialog"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13062535,"title":"How to focus wlxDialogBoxParam() Dialogbox in system logon timeusing c++ win32API?","body":"<p>i am using c++ win32 API for developing my gina project...</p>\n\n<p>i have problem,when the system logontime,that is the dialogbox will appear...</p>\n\n<p>but that dialogbox cant focus anything till i click on the dialogbox...</p>\n\n<pre><code>SendMessage(_hwnd, WM_NEXTDLGCTL, (WPARAM)GetDlgItem(_hwnd, IDC_NAME), TRUE);\n\nand\n\nsetfocus(GetDlgItem(_hwnd, IDC_NAME));\n</code></pre>\n\n<p>but it didnt work...</p>\n\n<p>can anyone resolve,how to focus the dialogbox in default?</p>\n\n<p>thanks in advance...</p>\n"},{"tags":["c++","winapi","windows-7","fonts"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":285,"score":1,"question_id":10991441,"title":"Tahoma (MS Shell Dlg 2) font looks squashed in Win7 when created with CreateFont()","body":"<p>I'm trying to use Tahoma font (MS Shell Dlg 2) with a height of -15 and/or height -12 in a Listview control. However with both these sizes, my text appears squashed together horizontally, i.e. l's and i's are so close together you can barely distinguish them. It looks fine with the default height of -13 or with -16. </p>\n\n<p>I am wondering if I'm doing something wrong with my call to CreateFont, as shown below, or whether this is a limitation of the font?</p>\n\n<pre><code>CreateFont(-15, 0, 0, 0, FW_NORMAL, FALSE, FALSE, FALSE, DEFAULT_CHARSET,    \n    OUT_DEFAULT_PRECIS, CLIP_DEFAULT_PRECIS, DEFAULT_QUALITY, \n    DEFAULT_PITCH | FF_DONTCARE, L\"MS Shell Dlg 2\");\n</code></pre>\n\n<p>I tried playing with the quality and output precision args, with no luck.</p>\n"},{"tags":["c++","multithreading","winapi","critical-section"],"answer_count":9,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":5568,"score":5,"question_id":1008726,"title":"Win32 Read/Write Lock Using Only Critical Sections","body":"<p>I have to implement a read/write lock in C++ using the Win32 api as part of a project at work.  All of the existing solutions use kernel objects (semaphores and mutexes) that require a context switch during execution.  This is far too slow for my application.</p>\n\n<p>I would like implement one using only critical sections, if possible.  The lock does not have to be process safe, only threadsafe.  Any ideas on how to go about this?</p>\n"},{"tags":["c++","winapi","handle","hbitmap"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":2,"view_count":105,"score":1,"question_id":13028872,"title":"Proper way close WinAPI HANDLEs (avoiding of repeated closing)","body":"<p>I have some handle and I need to close it. There is some places in code, where handle may be closed. So, is this a right way to close handle?</p>\n\n<pre><code>HANDLE h;\n....\nif ( h != INVALID_HANDLE_VALUE ) {\n  ::CloseHandle(h);\n  h = INVALID_HANDLE_VALUE;\n}\n</code></pre>\n\n<p>There is a same question about bitmap handles:</p>\n\n<pre><code>HBITMAP hb;\n....\nif ( hb != INVALID_HANDLE_VALUE ) {\n  ::DeleteObject(hb);\n  hb = INVALID_HANDLE_VALUE;\n}\n</code></pre>\n\n<p><em><strong>EDIT:</em></strong> I think, there is some misunderstanding. I know <code>CloseHandle</code> is for closing handles. I'd like to know proper way for closing handles. A similar situations occurs with deleting of pointers. </p>\n\n<pre><code>Foo *foo = new Foo();\n\n// for example there is 2 functions that can delete foo\nvoid bar() {\n  ....\n  delete foo;\n}\nvoid duck() {\n  ....\n  delete foo;\n}\n</code></pre>\n\n<p>So, the following code means problems:</p>\n\n<pre><code>bar();\nduck();\n</code></pre>\n\n<p>There is some workaround for this case. We need to define <code>bar</code>&amp;<code>duck</code> functions like this:</p>\n\n<pre><code>void bar() {\n  ....\n  if (foo) {\n    delete foo;\n    foo = NULL;\n  }\n}\nvoid duck() {\n  ....\n  if (foo) {\n    delete foo;\n    foo = NULL;\n  }\n}\n</code></pre>\n\n<p>So we avoid repeated deleting of foo. The question is What is the proper way to close handles? I mean, How to avoid repeated closing handles problem?</p>\n"},{"tags":["c++","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":12939220,"title":"Define thread in C++","body":"<p>How do I start a thread using <code>_beginthreadex()</code>, making it execute <code>void myFunction(wchar_t *param);</code>?   I try to use this:</p>\n\n<pre><code>_beginthread(NULL, 0, myFunction, L\"someParam\", 0, &amp;ThreadID);\n</code></pre>\n\n<p>but there is compilation error:</p>\n\n<blockquote>\n  <p>error C2664: '<em>beginthreadex' : cannot convert parameter 3 from 'void (</em>_cdecl *)(wchar_t *)' to 'unsigned int (__stdcall *)(void *)'. </p>\n</blockquote>\n\n<p>How I can resolve this error?   I seem able to do <code>_beginthread((void(*)(void*))myFunction, 0 , (void *)L\"someParam\");</code>. But for <code>_beginthreadex()</code> these casts don't seem to work. What do \nI need to do?\nThis code doesn't output anything. What's wrong?</p>\n\n<pre><code>unsigned int __stdcall myFunction( void *someParam )\n{\n    printf(\"Hello world!\");\n    return 0;\n}\n\n\nint _tmain(int argc, _TCHAR* argv[])\n{\n    _beginthreadex(NULL, 0, myFunction, L\"param\", 0, NULL);\n    return 0;\n}\n</code></pre>\n"},{"tags":["c++","windows","winapi","mingw","constants"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":13058892,"title":"GetFileAttributesA is returning \"17\" for an existing directory. \"16\" means it's a directory and there's no mention of \"17\" in documentation","body":"<p>Windows 7 64-bit, compiling with mingw. I'm trying to test whether a given path is a directory using GetFileAttributesA in the Windows headers. The constant for something being a directory is 16. For some reason, though, it's returning 17. My code looks like this:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;windows.h&gt;\n\nvoid dir_exists(std::string dir_path)\n{\n    DWORD f_attrib = GetFileAttributesA(dir_path.c_str());\n    std::cout &lt;&lt; \"Current: \" &lt;&lt; f_attrib &lt;&lt; std::endl &lt;&lt;\n        \"Wanted: \" &lt;&lt;\n        FILE_ATTRIBUTE_DIRECTORY &lt;&lt; std::endl;\n}\n\nint main()\n{\n    dir_exists(\"C:\\\\Users\\\\\");\n    return 0;\n}\n</code></pre>\n\n<p>When I run this, the output is:</p>\n\n<pre><code>Current: 17  \nWanted: 16\n</code></pre>\n\n<p>Current should be returning 16, here. As I said in the topic, I can't even find any mention of what 17 means in the documentation.</p>\n"},{"tags":["qt","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12992541,"title":"What can you do in WinAPI that you cannot do in Qt?","body":"<p>I am into learning some GUI API in C++, so I searched a lot to see which one was best. I ended up with either Qt or WinAPI. I read some people saying that Qt was easier to work with but with WinAPI you could control everything. The argument proceeded and someone said that it was a fair exchange, a small piece of control so it could become easier. Now I want to know, what exactly are you losing when you chose Qt? Is it the interaction with the system? What exactly can you do in WinAPI that you cannot do in Qt?</p>\n"},{"tags":["winapi","com","rpc","out-of-process"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12986618,"title":"Out-of-process COM server without a proxy/stub DLL?","body":"<p>I am learning how to implement an out-of-process COM server and came across <a href=\"http://www.codeproject.com/Articles/8679/Building-a-LOCAL-COM-Server-and-Client-A-Step-by-S\" rel=\"nofollow\">this article</a>.</p>\n\n<p>I can build it, and it runs fine, but where is the proxy/stub DLL? All I can see is the IDL file from which the proxy/stub code is generated during the build. But how is the DLL built, and where is it?</p>\n"},{"tags":["windows","winapi","language-packs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13057813,"title":"language packs on windows : winapi","body":"<p>how to retrieve all available language packs to set it to current thread language to use in FormateMessage afterward? I need exactly languages which may be used to use in function SetThreadUILanguage. After that I need to use FormateMessage function, which will extract message as current thread's one.</p>\n"},{"tags":["c#",".net","winapi","pinvoke","unmanaged"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13051711,"title":"Dump images from unmanaged image list to disk","body":"<p>I'm porting a C++ SDK from a USB device to use in C# through pinvoke and and I'm having good progress so far, and the problem now is with a function that builds an image list that I can use to attach to other controls using functions like <a href=\"http://msdn.microsoft.com/en-us/library/y355zfta%28v=vs.80%29.aspx\" rel=\"nofollow\">SetImageList</a>.</p>\n\n<p>What I would like to do is save all the images from this list to the disk and use them later.</p>\n\n<p>There are other functions that returns the index of a paraticular image inside this list, so I could pass this index and then save the image to the disk.</p>\n"},{"tags":[".net","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13057343,"title":"Get URI for digital camera files","body":"<p>I've attached my digital camera to my computer, and it's now showing up in Windows Explorer.  However, there's no mapped drive letter assigned, and no \"map drive letter\" option in the context menu, so other than through the Windows Explorer UI, how can I access the files? My ultimate goal is to be able to reference the files in a batch file.</p>\n\n<p>I tried:</p>\n\n<pre><code>\\\\&lt;ComputerName&gt;\\Canon EOS-1Ds Mark III\\SD\\DCIM\\104EOS1D\\&lt;file&gt;\n</code></pre>\n\n<p>But that didn't work. (Either with or without surrounding quotes)</p>\n\n<p>Can this be done?</p>\n"},{"tags":["winapi","mfc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13051700,"title":"what's the difference with the usage of thest two bitblt?","body":"<p>read the code below:\n why <strong>m_dcMem.BitBlt(0,0,m_size.cx, m_size.cy, &amp;dcScreen, 0,0, SRCCOPY);</strong>  works ,\n and <strong>dcScreen.BitBlt(0,0,m_size.cx, m_size.cy, &amp;m_dcMem, 0,0, SRCCOPY);</strong> don't?\nTHX!\n`</p>\n\n<p>int CScreenDlg::OnCreate(LPCREATESTRUCT lpCreateStruct)</p>\n\n<pre><code>if (CDialog::OnCreate(lpCreateStruct) == -1)\n    return -1;\n// TODO:  Add your specialized creation code here   \nShowWindow(SW_HIDE);\n\nCDC dcScreen;\ndcScreen.CreateDC(\"DISPLAY\", NULL, NULL, NULL);\n//dcScreen.Attach(GetDC(GetParent()));\nm_size.cx = GetDeviceCaps(dcScreen.GetSafeHdc(), HORZRES);\nm_size.cy = GetDeviceCaps(dcScreen.GetSafeHdc(), VERTRES);\n\nm_dcMem.CreateCompatibleDC(&amp;dcScreen);\nm_bmpScreen.CreateCompatibleBitmap(&amp;dcScreen, m_size.cx,m_size.cy);\nCBitmap* pOldBmp = m_dcMem.SelectObject(&amp;m_bmpScreen);\n//m_dcMem.BitBlt(0,0,m_size.cx, m_size.cy, &amp;dcScreen, 0,0, SRCCOPY);\ndcScreen.BitBlt(0,0,m_size.cx, m_size.cy, &amp;m_dcMem, 0,0, SRCCOPY); //why it doesn't work???\nCRect rect(0,0,m_size.cx, m_size.cy);\n\nLEFT_RECT = CRect(INFO_OFFSET, INFO_OFFSET, INFO_OFFSET + INFO_WIDTH, INFO_OFFSET + INFO_HEIGHT);\nRIGHT_RECT = CRect(m_size.cx - INFO_WIDTH-INFO_OFFSET, INFO_OFFSET, m_size.cx-INFO_OFFSET, INFO_OFFSET + INFO_HEIGHT);\nm_rectInfo = LEFT_RECT;\n\nm_bmpInfoBK.LoadBitmap(IDB_BITMAP_INFOBK);\nMoveWindow(rect);\nShowWindow(SW_SHOW);\nm_hCursor = LoadCursor(AfxGetInstanceHandle(), MAKEINTRESOURCE(IDC_CURSOR_SELECT));\nreturn 0;\n</code></pre>\n\n<p>}</p>\n"},{"tags":["winapi","audio","windows-7"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13054371,"title":"Programmatically switch audio devices on Windows 7","body":"<p>On my Windows 7 PC, I've got a set of speakers, some wireless headphones and a USB web cam. This means that I have two possible audio output devices and 2 possible audio input devices.</p>\n\n<p>I find myself having to switch between them fairly frequently. At the moment this is a manual process: right-click on the speaker icon, choose one of \"Playback devices\" or \"Recording devices\", choose the correct device in the list (and there's some \"dead\" ones in there, too) and then hit \"Set Default\".</p>\n\n<p>I've looked around, and all I can find are people scripting <code>SendKeys</code> to automate this.</p>\n\n<p>That sucks.</p>\n\n<p>Is there anyway to programmatically switch audio input/output devices, so that I can write a simple tray app/hotkey app to make this easier?</p>\n"},{"tags":["windows","winapi","sockets","operating-system"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":94,"score":2,"question_id":12834501,"title":"UDP Packets, Seen by Wireshark, Dropped by (do not even reach) WSARecvFrom","body":"<p>I have quite a bewildering problem.<br>\nI'm using a big C++ library for handling some proprietary protocol over UDP on Windows XP/7. It listens on one port throughout the run of the program, and waits for connections from distant peers.</p>\n\n<p>Most of the time, this works well. However, due to some problems I'd experienced, I've decided to add a simple debug print directly after the call to <code>WSARecvFrom</code> (the win32 function used in the library to recv datagrams from my socket of interest, and tell what IP and port they came from).<br>\nStrangely enough, in some cases, I've discovered packets are dropped at the <strong>OS level</strong> (i.e. I see them in Wireshark, they have the right dst-port, all checksums are correct - but they never appear in the debug prints I've implanted into the code).</p>\n\n<p>Now, I'm fully of the fact (people tend to mention a bit too often) that \"UDP doesn't guarantee delivery\" - but this is not relevant, as the packets <strong>are</strong> received by the machine - I see them in Wireshark.<br>\nAlso, I'm familiar with OS buffers and the potential to fill up, but here comes the weird part...</p>\n\n<p>I've done some research trying to find out which packets are dropped exactly. What I've discovered, is that all dropped packets share two things in common (though <em>some</em>, but definitely not <em>most</em>, of the packets that <em>aren't</em> dropped share these as well):</p>\n\n<ol>\n<li>They are small. Many of the packets in the protocol are large, close to MTU - but all packets that are dropped are under 100 bytes (gross).</li>\n<li>They are always one of two: a SYN-equivalent (i.e. the first packet a peer sends to us in order to initiate communications) or a FIN-equivalent (i.e. a packet a peer sends when it is no longer interested in talking to us).</li>\n</ol>\n\n<p>Can either one of these two qualities affect the OS buffers, and cause packets to be randomly (or even more interesting - selectively) dropped?<br>\nAny light shed on this strange issue would be very appreciated.</p>\n\n<p>Many thanks.</p>\n\n<hr>\n\n<p><strong>EDIT (24/10/12):</strong></p>\n\n<p>I think I may have missed an important detail. It seems that the packets dropped before arrival share something else in common: They (and I'm starting to believe, <em>only</em> they) are sent to the server by \"new\" peers, i.e. peers that it <strong>hasn't tried to contact before</strong>.</p>\n\n<p>For example, if a syn-equivalent packet arrives from a peer* we've never seen before, it will not be seen by <code>WSARecvFrom</code>. However, if we have sent a syn-equivalent packet to that peer <strong>ourselves</strong> (even if it didn't reply at the time), and now it sends <strong>us</strong> a syn-equivalent, we will see it.</p>\n\n<p>(*) I'm not sure whether this is a <em>peer</em> we haven't seen (i.e. ip:port) or just a <em>port</em> we haven't seen before.</p>\n\n<p>Does this help?<br>\nIs this some kind of WinSock option I've never heard of? (as I stated above, the code is not mine, so it may be using socket options I'm not aware of)</p>\n\n<p>Thanks again!</p>\n"},{"tags":["c++","qt","winapi","hardware","hid"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13053198,"title":"C++ / Qt interface to a presentation remote in Windows","body":"<p>I am looking to use a presentation remote such as the Kensington Wireless Presenter (33373) as an input controller for a C++/Qt base Windows application. It would be preferred if the application could receive input from the remote regardless the applications focus status.</p>\n\n<p>Do these devices use the HID interface? Are there any good libraries that provide a level of abstraction? What is the best way to read input from such as device?</p>\n"},{"tags":["c++","c","winapi","unicode","bom"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":88,"score":0,"question_id":13046140,"title":"Simple reading file using ReadFile()","body":"<p>Why this code doesn't output anything(exept info word)? File is exist.</p>\n\n<pre><code>hReadFile = CreateFile(L\"indexing.xml\",GENERIC_READ | GENERIC_WRITE, FILE_SHARE_READ |FILE_SHARE_WRITE, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);\n    wchar_t *wchr = new wchar_t[20];\n    DWORD dw;\n    ReadFile(hReadFile, wchr, sizeof(wchar_t) * 5, &amp;dw, NULL);\n    CloseHandle(hReadFile);\n    wchr[dw/sizeof(wchar_t)] = L'\\0';\n    std::wcout &lt;&lt; L\"info \" &lt;&lt; wchr &lt;&lt; L\"     \" &lt;&lt; dw &lt;&lt; std::endl;\n</code></pre>\n"},{"tags":["winapi"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":2451,"score":1,"question_id":1958128,"title":"What is thread?How to create thread in win32 application?","body":"<p>What is thread? How to create thread in win32 application?</p>\n"},{"tags":["c++","winapi","serial-port"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13052292,"title":"Problems with reading data from virtual serial port built with com0com","body":"<p>I am trying to read data written to a serial port created with <a href=\"http://sourceforge.net/projects/com0com/\" rel=\"nofollow\">com0com</a>. Current configuration have two serial ports, namely COM8 and COM9 connected to each other.</p>\n\n<p>When I open those two serial port using putty and write something in one terminal, it immediately appear in other terminal. However when I try to do it programmatically it's different story.</p>\n\n<p>I can do write without problem, but read fails for some reasons. I use CSerial library <a href=\"http://www.codeguru.com/cpp/i-n/network/serialcommunications/article.php/c2503/CSerial--A-C-Class-for-Serial-Communications.htm\" rel=\"nofollow\">CSerial library</a>by Tom Archer and Rick Leinecker.</p>\n\n<p>Function for reading data is like below</p>\n\n<pre><code>int CSerial::ReadData( void *buffer, int limit )\n{\n\n    if( !m_bOpened || m_hIDComDev == NULL ) return( 0 );\n\n    BOOL bReadStatus;\n    DWORD dwBytesRead, dwErrorFlags;\n    COMSTAT ComStat;\n\n    SetCommMask (m_hIDComDev, 0);\n    SetCommMask (m_hIDComDev, EV_RXCHAR);\n    ClearCommError( m_hIDComDev, &amp;dwErrorFlags, &amp;ComStat );\n    if( !ComStat.cbInQue ) return( 0 );\n\n    dwBytesRead = (DWORD) ComStat.cbInQue;\n    if( limit &lt; (int) dwBytesRead ) dwBytesRead = (DWORD) limit;\n\n    bReadStatus = ReadFile( m_hIDComDev, buffer, dwBytesRead, &amp;dwBytesRead, &amp;m_OverlappedRead );\n    if( !bReadStatus ){\n        if( GetLastError() == ERROR_IO_PENDING ){\n            WaitForSingleObject( m_OverlappedRead.hEvent, 2000 );\n            cout&lt;&lt; \"Read data\" &lt;&lt; endl;\n            return( (int) dwBytesRead );\n            }\n        return( 0 );\n        }\n\n    return( (int) dwBytesRead );\n\n}  \n</code></pre>\n\n<p>I cannot read data from the serial port as program exist at this line.\n    if( !ComStat.cbInQue ) return( 0 );</p>\n\n<p>This is really strange as serial buffer have data, yet cbInQue which tells whether data available for read operation or not is set to zero. </p>\n\n<p>Does anyone knows a workaround for this scenario ? Or any setting that should be changed in com0com ? </p>\n\n<p>FYI, I'm using Code::blocks IDE with MinGW compiler on Win7 64 bit.</p>\n"},{"tags":["c++","c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13047361,"title":"Status bar control not resizing properly when using XP Visual Styles manifest","body":"<p>In my program I created a status bar control and then set a new font for it.\nThe problem I'm having is that when I include the XP Visual Styles\nmanifest (i.e. Common controls 6.0), then the status bar is not resizing to match the new font size. </p>\n\n<p>e.g.</p>\n\n<pre><code>hGiantFont = CreateFont(-48, 0, 0, 0, FW_NORMAL, FALSE, FALSE,      \n   FALSE, DEFAULT_CHARSET, OUT_DEFAULT_PRECIS,\n   CLIP_DEFAULT_PRECIS, DEFAULT_QUALITY, DEFAULT_PITCH |    \n   FF_DONTCARE, L\"MS Shell Dlg 2\");\n\nhStatusBar = CreateWindowEx ( \n   0, STATUSCLASSNAME, NULL, WS_CHILD | WS_VISIBLE, \n   0, 0, 0, 0, hWnd, (HMENU)666, hInst, NULL    \n);      \n\nSendMessage(hStatusBar, WM_SETFONT, (WPARAM)hGiantFont,  \n   (LPARAM)MAKELONG(TRUE, 0));\n\nSendMessage(hStatusBar, WM_SIZE, 0, 0);\n</code></pre>\n\n<p>After executing the last line, nothing happens! It doesn't resize.\nNote that if I don't include the visual styles Manifest, it works fine!\nI've tried both InitCommonControls() and InitCommonControlsEX() with ICC_BAR_CLASSES to no avail.</p>\n\n<p>I've also tried using MoveWindow and SetWindowPos to change the size or move the status bar. With the visual styles manifest included, the status bar does not move, it seems glued to that specific size and location.</p>\n\n<p>Is this a bug in ComCtl32.dll 6.0? Or an extremely annoying intended feature. What is the work around?</p>\n\n<p>Also has anoyone else tried doing the same thing with successful results?</p>\n\n<p>Edit:</p>\n\n<p>Ok I've decided to include the whole program below, so people can try it out and see what I mean. It's just a bare basics Win32 app with a few lines added. If you comment out the #pragma manifest line at the top you'll notice it works as expected, and with the manifest line, the status bar doesn't resize.</p>\n\n<pre><code>// StupidStatusBar.cpp : Defines the entry point for the application.\n\n#pragma comment(linker,\"\\\"/manifestdependency:type='win32' \\\nname='Microsoft.Windows.Common-Controls' version='6.0.0.0' \\\nprocessorArchitecture='*' publicKeyToken='6595b64144ccf1df'    language='*'\\\"\") \n\n#define WIN32_LEAN_AND_MEAN\n#include &lt;windows.h&gt;\n#include &lt;tchar.h&gt;\n#include &lt;commctrl.h&gt;\n#pragma comment(lib, \"comctl32.lib\")\n\n// Global Variables:\nHINSTANCE hInst;                                    \nwchar_t *szTitle = L\"Stupid Status Bar\";    \nwchar_t *szWindowClass = L\"StupidClass\";    \n\n// Forward declarations of functions included in this code module:\nATOM                MyRegisterClass(HINSTANCE hInstance);\nBOOL                InitInstance(HINSTANCE, int);\nLRESULT CALLBACK    WndProc(HWND, UINT, WPARAM, LPARAM);\n\nint APIENTRY _tWinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPTSTR lpCmdLine, int nCmdShow)\n{\n    MSG msg;\n    INITCOMMONCONTROLSEX icex;\n\n    icex.dwSize = sizeof(INITCOMMONCONTROLSEX);\n    icex.dwICC = ICC_WIN95_CLASSES;\n\n    if(!InitCommonControlsEx(&amp;icex))\n    {\n        MessageBox(NULL, L\"Error initializing common controls\", L\"Error\", MB_OK);\n        return 1;\n    }\n\n    MyRegisterClass(hInstance);\n\n    // Perform application initialization:\n    if (!InitInstance (hInstance, nCmdShow))\n        return FALSE;\n\n    // Main message loop:\n    while (GetMessage(&amp;msg, NULL, 0, 0))\n    {\n        TranslateMessage(&amp;msg);\n        DispatchMessage(&amp;msg);\n    }\n\n    return (int) msg.wParam;\n}   \n\nATOM MyRegisterClass(HINSTANCE hInstance)\n{\n    WNDCLASSEX wcex;\n\n    wcex.cbSize = sizeof(WNDCLASSEX);\n\n    wcex.style      = CS_HREDRAW | CS_VREDRAW;\n    wcex.lpfnWndProc    = WndProc;\n    wcex.cbClsExtra     = 0;\n    wcex.cbWndExtra     = 0;\n    wcex.hInstance      = hInstance;\n    wcex.hIcon      = LoadIcon(NULL, IDI_APPLICATION);\n    wcex.hCursor        = LoadCursor(NULL, IDC_ARROW);\n    wcex.hbrBackground  = (HBRUSH)(COLOR_WINDOW+1);\n    wcex.lpszMenuName   = NULL;\n    wcex.lpszClassName  = szWindowClass;\n    wcex.hIconSm        = LoadIcon(NULL, IDI_APPLICATION);\n\n    return RegisterClassEx(&amp;wcex);\n}\n\nBOOL InitInstance(HINSTANCE hInstance, int nCmdShow)\n{\n   HWND hWnd;\n\n   hInst = hInstance; // Store instance handle in our global variable\n\n   hWnd = CreateWindow(szWindowClass, szTitle, WS_OVERLAPPEDWINDOW,\n      CW_USEDEFAULT, 0, CW_USEDEFAULT, 0, NULL, NULL, hInstance, NULL);\n\n   if (!hWnd)\n      return FALSE;\n\n   ShowWindow(hWnd, nCmdShow);\n   UpdateWindow(hWnd);\n\n   return TRUE;\n}\n\nLRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    HWND hStatusBar;\n    HFONT hGiantFont;\n\n    switch (message)\n    {\n    case WM_CREATE:\n        hGiantFont = CreateFont(-48, 0, 0, 0, FW_NORMAL, FALSE, FALSE,     FALSE, DEFAULT_CHARSET, OUT_DEFAULT_PRECIS,\n        CLIP_DEFAULT_PRECIS, DEFAULT_QUALITY, DEFAULT_PITCH | FF_DONTCARE, L\"MS Shell Dlg 2\");\n\n        hStatusBar = CreateWindowEx ( \n            0, STATUSCLASSNAME, NULL, WS_CHILD | WS_VISIBLE, \n            0, 0, 0, 0, hWnd, (HMENU)666, hInst, NULL   \n        );      \n        SendMessage(hStatusBar, WM_SETFONT, (WPARAM)hGiantFont, (LPARAM)MAKELONG(TRUE, 0));\n        SendMessage(hStatusBar, WM_SIZE, 0, 0);\n        SetWindowText(hStatusBar, L\"Testing Testing\");\n        break;\n    case WM_DESTROY:\n        PostQuitMessage(0);\n        break;\n    default:\n        return DefWindowProc(hWnd, message, wParam, lParam);\n    }\n    return 0;\n}\n</code></pre>\n"},{"tags":["c++","c","winapi","encoding"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":13049151,"title":"Encoding of console output stream in windows","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3130979/how-to-output-unicode-strings-on-the-windows-console\">How to Output Unicode Strings on the Windows Console</a>  </p>\n</blockquote>\n\n\n\n<p>I try to output UTF-16 charachters to console in win32console application, but i cannot change the encoding of output stream, I try to use SetConsoleOutputCP() function but when i use next code for testing</p>\n\n<pre><code>    std::wcout &lt;&lt; GetConsoleOutputCP() &lt;&lt; std::endl;//output 866\n    SetConsoleOutputCP(CP_WINUNICODE);              //if i set CP_UTF8 it works\n    std::wcout &lt;&lt; GetConsoleOutputCP() &lt;&lt; std::endl;//output 866\n</code></pre>\n\n<p>I get the same result (866) for two cases. When I'm try to set <code>CP_UTF8</code> it works correct but I need UTF-16, why my attempt is failed and how can I set output stream's encoding to UTF-16?</p>\n"},{"tags":["c++","winapi","dll"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":489,"score":4,"question_id":5866322,"title":"How do I redirect calls to ole32.dll to my own proxy DLL?","body":"<p>I'm trying to detect all calls to <a href=\"http://msdn.microsoft.com/en-us/library/ms686615(v=vs.85).aspx\" rel=\"nofollow\">CoCreateInstance</a> in some process I'm starting (ideally, I'm able to detect calls in child processes as well).</p>\n\n<p>To achieve this, using Microsoft Visual Studio 2008 on Windows 7, I create a proxy DLL which forwards all but one call in the standard <code>ole32.dll</code> library as described in various articles, e.g. <a href=\"http://www.ethicalhacker.net/content/view/207/24/\" rel=\"nofollow\">\nIntercepted: Windows Hacking via DLL Redirection</a>. The resulting DLL looks fine, but I just can't make existing programs (I'm using the standard <a href=\"http://msdn.microsoft.com/en-us/library/ms241446(v=vs.80).aspx\" rel=\"nofollow\">ActiveX Control Test Container (tstcon32.exe)</a> as a test application) pick up my proxy DLL. No matter what I do, the programs always seem to pick up <code>C:\\Windows\\SysWow64\\ole32.dll</code> according to <a href=\"http://technet.microsoft.com/en-us/sysinternals/bb896653\" rel=\"nofollow\">Process Explorer</a>. I tried a few things so far:</p>\n\n<ol>\n<li>Prepend the directory which contains my proxy DLL to the <code>PATH</code> and then invoke the program; didn't seem to have any effect.</li>\n<li>Copy my proxy DLL into the same directory as the invoked program; no luck.</li>\n<li>Create a <code>.local</code> file in the same directory as the invoked program as described in the <a href=\"http://msdn.microsoft.com/en-us/library/ms682600\" rel=\"nofollow\">Dynamic-Link Library Redirection</a> article and put my proxy DLL into the same directory - didn't work either. But then, I read that this stopped working on more recent Windows versions. Additionally, <code>ole32.dll</code> is a \"known DLL\" according to the <code>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\KnownDLLs</code> registry setting, so <code>.local</code>-based redirection is probably not going to work anyway.</li>\n<li>Use manifest-based redirection as described e.g. in the <a href=\"http://stackoverflow.com/questions/2100973/dll-redirection-using-manifests\">DLL redirection using manifests</a> question, but that didn't seem to have any effect either. However, this approach seems to be non-trivial, so chances are I did something wrong.</li>\n</ol>\n\n<p>Does anybody have experience with redirecting calls to standard DLLs such as <code>ole32.dll</code> using a stub DLL? How did you force the applications to pick up your stub DLL?</p>\n"},{"tags":["c#",".net","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13047556,"title":"Get selected text using SendMessage","body":"<p>Lets say i have the handler of the window contains the selected text ..</p>\n\n<p>And all i need is to fetch the selected text from this window.</p>\n\n<p>I know we can do this using <em>SendMessage() API</em> and <strong>EM_GETSEL</strong> constant , but i am really confused how to do that ! </p>\n"},{"tags":["c","windows","winapi","etw"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":127,"score":0,"question_id":8945890,"title":"Detect when ETW drops events","body":"<p><strong>How can I determine if an ETW session is dropping events?</strong></p>\n\n<p><strong>If it is dropping events, how can I configure the tracing session so that events are not dropped?</strong></p>\n\n<p>I've written a custom ETW provider to help with some debugging efforts. I'm currently capturing the trace data using logman.exe.</p>\n\n<p>In viewing the results, it appears that some of the events are being dropped. Basically I'm seeking something like:</p>\n\n<p>Event A\nEvent C</p>\n\n<p>where their should be an intervening Event B, but one does not appear in the trace file. It <strong>should</strong> be impossible for that to happen, which leads me to believe that ETW is dropping events.</p>\n\n<p>Of course, I'd like to verify that the problem I'm seeing is due to dropped events, and not caused by a bug in my code. I've tried Google, but wasn't able to come up with anything. Does any one know how I can check to see if events are being dropped?</p>\n"},{"tags":["c","winapi","message-queue"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":13045442,"title":"How to pass data(structure) as a message to a thread.","body":"<p>How do I pass data to a thread from main application?</p>\n\n<p>Inside the main application I created a thread for processing error messages. While processing data in the main application if there is an error, it generates an error message and fills it into a structure. This error message(structure) needs to be passed to the thread which will then process it further and the main application should continue its work. I am trying to do this in C on windows platform. </p>\n\n<p>There will be only one thread running in my application. At the moment I have defined a global variable structure (myData) and I am passing that using  <strong>PostThreadMessage.</strong></p>\n\n<pre><code>struct myData errorData;\n</code></pre>\n\n<p>From the main application post a message using </p>\n\n<pre><code>PostThreadMessage(ErrorLogId, THRD_MESSAGE_EXIT , 0 , (LPARAM)&amp;errorData);\n</code></pre>\n\n<p>In the thread I have </p>\n\n<pre><code>MsgReturn = GetMessage(&amp;msg, NULL, THRD_MESSAGE_SOMEWORK, THRD_MESSAGE_EXIT);\n</code></pre>\n\n<p>At the moment it is working fine. But if processing of error message takes more time, by that time main application might get new errors and update data in global structure errorData.</p>\n\n<p>I could use locking mechanism but I cannot stop main application till the thread has finished processing. How do I pass data without having it as a global variable?</p>\n"},{"tags":["c++","windows","security","winapi","kernel"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":71,"score":2,"question_id":13044991,"title":"Get all Windows Kernel object and Security rights of it","body":"<p>I need to get list of access rights to all Win-Kernel objects;\nWhat I do:</p>\n\n<pre><code>for (int i=0; i&lt;9999; i++)\n    GetKernelObjectSecurity( i, ... ) //result in security_descriptor\n    GetSecurityDescriptorDacl( security_descriptor, ... ) // result in lpbDaclPresent\n    if (lpbDaclPresent)\n        //lpbDaclPresent - need to get\n</code></pre>\n\n<blockquote>\n  <p>If DACL = Null -> \"all can do all\"</p>\n  \n  <p>If DACL != Null -> parsing DACL-mask</p>\n</blockquote>\n\n<hr>\n\n<p>I'm on the right track ?\nBy the way, I have: </p>\n\n<p>~300 handles without DACL</p>\n\n<p>~100 handles with DACL\n(testing on Windows 7)</p>\n"},{"tags":["c++","winapi","com","fstream","safearray"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13034585,"title":"How can I read a fstream into an LPSAFEARRAY?","body":"<p>I'm trying to call a method on a managed dll in C++.  One of the parameters is a byte array, which the library import translated to LPSAFEARRAY.  The byte array/LPSAFEARRAY is intended to be the content of a file.  How can I read a file into a LPSAFEARRAY to pass into the method?</p>\n\n<p>Here's the function signature from the generated library header file:</p>\n\n<pre><code>virtual HRESULT STDMETHODCALLTYPE AlterDocument(\n   LPSAFEARRAY document/*[in]*/, \n   LPSAFEARRAY* pRetVal/*[out,retval]*/) = 0; \n</code></pre>\n\n<p>The second parameter is another byte array that I'll need to use when it comes back from the method.</p>\n"},{"tags":["winapi","findwindow"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":224,"score":1,"question_id":6631089,"title":"FindWindow error 183","body":"<p>Does anybody know what would cause the FindWindow function to return an ALREADY_EXISTS error (183)?  A FILE_NOT_FOUND (2) I can understand, but why would it return a 183.</p>\n"},{"tags":["java","swing","winapi","swt"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":223,"score":3,"question_id":11300041,"title":"windows explorer context menu in java","body":"<p>Consider simple application, that display list of file. I would like to display context menu , when user click of file or folder, the same as, when user right mouse click in windows explorer (open, rename, edit etc.). I don't want to create my own context menu, I want to show windows os context menu, using some kind of winapi probably. This should works only on windows machine. </p>\n\n<p>Is it possible to achieve it with Swing or SWT or any other UI controls ?</p>\n"},{"tags":["c","windows","winapi"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":13021267,"title":"windows error argument type c programming","body":"<p>i have this code i don´t have experience in windows:</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n\n\n   typedef BOOL (WINAPI *P_GDFSE)(LPCTSTR, PULARGE_INTEGER, \n                                  PULARGE_INTEGER, PULARGE_INTEGER);\n\n   void main (int argc, char **argv)\n   {\n      BOOL  fResult;\n\n      char  *pszDrive  = NULL,\n             szDrive[4];\n\n      DWORD dwSectPerClust,\n            dwBytesPerSect,\n            dwFreeClusters,\n            dwTotalClusters;\n\n      P_GDFSE pGetDiskFreeSpaceEx = NULL;\n\n      unsigned __int64 i64FreeBytesToCaller,\n                       i64TotalBytes,\n                       i64FreeBytes;\n\n\n      if (argc != 2)\n      {\n         printf (\"usage:  %s &lt;drive|UNC path&gt;\\n\", argv[0]);\n         printf (\"\\texample:  %s C:\\\\\\n\", argv[0]);\n         return;\n      }\n\n      pszDrive = argv[1];\n\n      if (pszDrive[1] == ':')\n      {\n         szDrive[0] = pszDrive[0];\n         szDrive[1] = ':';\n         szDrive[2] = '\\\\';\n         szDrive[3] = '\\0';\n\n         pszDrive = szDrive;\n      }\n\n     // FIRST ERROR  kernel32.dll\n      pGetDiskFreeSpaceEx = (P_GDFSE)GetProcAddress (\n                               GetModuleHandle (\"kernel32.dll\"),\n                                              \"GetDiskFreeSpaceExA\");\n       // SECOND ERROR pszDrive\n      if (pGetDiskFreeSpaceEx)\n      {\n         fResult = pGetDiskFreeSpaceEx (pszDrive,\n                                 (PULARGE_INTEGER)&amp;i64FreeBytesToCaller,\n                                 (PULARGE_INTEGER)&amp;i64TotalBytes,\n                                 (PULARGE_INTEGER)&amp;i64FreeBytes);\n         if (fResult)\n         {\n            printf (\"\\n\\nGetDiskFreeSpaceEx reports\\n\\n\");\n            printf (\"Available space to caller = %I64u MB\\n\",\n                    i64FreeBytesToCaller / (1024*1024));\n            printf (\"Total space               = %I64u MB\\n\",\n                    i64TotalBytes / (1024*1024));\n            printf (\"Free space on drive       = %I64u MB\\n\",\n                    i64FreeBytes / (1024*1024));\n         }\n      }\n      else\n      {\n         // ERROR 3 pszDrive\n         fResult = GetDiskFreeSpace (pszDrive, \n                                     &amp;dwSectPerClust,\n                                     &amp;dwBytesPerSect, \n                                     &amp;dwFreeClusters,\n                                     &amp;dwTotalClusters);\n         if (fResult)\n         {\n            /* force 64-bit math */ \n            i64TotalBytes = (__int64)dwTotalClusters * dwSectPerClust *\n                              dwBytesPerSect;\n            i64FreeBytes = (__int64)dwFreeClusters * dwSectPerClust *\n                              dwBytesPerSect;\n\n            printf (\"GetDiskFreeSpace reports\\n\\n\");\n            printf (\"Free space  = %I64u MB\\n\", \n                    i64FreeBytes / (1024*1024));\n            printf (\"Total space = %I64u MB\\n\", \n                    i64TotalBytes / (1024*1024));\n         }\n      }\n\n      if (!fResult)\n         printf (\"error: %lu:  could not get free space for \\\"%s\\\"\\n\",\n                 GetLastError(), argv[1]);\n   }\n</code></pre>\n\n<p>i'm getting these errors(visual studio 2010 ultimate):</p>\n\n<p>at kernel32.dll:</p>\n\n<p>pGetDiskFreeSpaceEx = (P_GDFSE)GetProcAddress (\n                               GetModuleHandle (\"kernel32.dll\"),\n                                                \"GetDiskFreeSpaceExA\");</p>\n\n<p>Error: argument of type const char* is incompatible with parameter of type \"LPCWSTR\"</p>\n\n<p>at pszDrive:</p>\n\n<pre><code>fResult = pGetDiskFreeSpaceEx (pszDrive,\n                                 (PULARGE_INTEGER)&amp;i64FreeBytesToCaller,\n                                 (PULARGE_INTEGER)&amp;i64TotalBytes,\n                                 (PULARGE_INTEGER)&amp;i64FreeBytes);\n</code></pre>\n\n<p>Error: argument of type char* is incompatible with parameter of type \"LPCTSTR\"</p>\n\n<p>at pszDrive:</p>\n\n<pre><code> fResult = GetDiskFreeSpace (pszDrive, \n                                     &amp;dwSectPerClust,\n                                     &amp;dwBytesPerSect, \n                                     &amp;dwFreeClusters,\n                                     &amp;dwTotalClusters);\n</code></pre>\n\n<p>Error: argument of type char* is incompatible with parameter of type \"LPCWSTR\"</p>\n\n<p>thanks a lot</p>\n"},{"tags":["c++","multithreading","winapi","object","inheritance"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13039559,"title":"Creating thread in the base class which run a method from the subclasses","body":"<p>I don't know if this this even possible but I have an idea of creating an abstract class to make threads using WinAPI. This class would be inheritaded by class which will define the function to execute in the thread.</p>\n\n<p>I have two classes:</p>\n\n<pre><code>class XYZ{\n//...\n\nclass ABC: public XYZ{\n//...\n</code></pre>\n\n<p>And i have a construct</p>\n\n<pre><code>ABC::ABC()\n{\n    addThread(this,1);\n}\n</code></pre>\n\n<p>addThread is defined inside XYZ class:</p>\n\n<pre><code>void addThread(void* self, int a)\n{\n    DWORD ThreadID;\n    THREAD_DATA *threadData;\n    threadData-&gt;self = self;\n    threadData-&gt;thread_id = a;\n    CreateThread(NULL, 0, createThread, threadData, 0, &amp;ThreadID);\n}\n</code></pre>\n\n<p>As you can see i am creating a structure which contains two fields: object of the superclasses and the number of thread (so the method can know which data use).</p>\n\n<p>This is how the structure looks like:</p>\n\n<pre><code>typedef struct _THREAD_DATA {\nvoid*       self;\nint     thread_id;\n} THREAD_DATA;\n</code></pre>\n\n<p>The createThread in an static method of XYZ class:</p>\n\n<pre><code>static DWORD WINAPI createThread(void* _threadData)\n{\n    THREAD_DATA* threadData = (THREAD_DATA*) _threadData;\n    return threadData-&gt;self-&gt;execute(threadData-&gt;thread_id);\n}\n</code></pre>\n\n<p>And here is the place where everything goes wrong.\nMy VSC++ 2010 is underlining the first word \"threadDataself\" in the second line of the static method body. <strong>After compilation I get an error:</strong></p>\n\n<blockquote>\n  <p>left of '->execute' must point to class/struct/union/generic type</p>\n</blockquote>\n\n<p>I have no idea how to fix it. I wrote this code using those links:\n<a href=\"http://goo.gl/7VYC3\" rel=\"nofollow\">http://goo.gl/7VYC3</a> &amp; <a href=\"http://goo.gl/ETfe7\" rel=\"nofollow\">http://goo.gl/ETfe7</a></p>\n\n<p>The execute method is decalared in the XYZ class as:</p>\n\n<pre><code>virtual DWORD execute(int i);\n</code></pre>\n\n<p>and then defined in the ABC class as</p>\n\n<pre><code>DWORD ABC::execute(int i){\n//...\n</code></pre>\n\n<p>Can anyone please help me? I would appreciate any tips how to make this works.</p>\n"},{"tags":["c++","c","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13039506,"title":"Reading data from file using winapi","body":"<p>I know that in winapi exist <code>ReadFile()</code> function for reading data from file, but I don't know how can I set the position of reading from file. Can I do this using WinAPI?</p>\n"},{"tags":["c++","visual-studio-2010","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13038872,"title":"Writing to XML file using WriteFile function","body":"<p>I'm trying to write data to UNICODE XML file using the WinAPI function <code>WriteFile</code>. I'm using next code for writing:</p>\n\n<pre><code>WriteFile(hFile, t, sizeof(wchar_t) * (wcslen(t)), &amp;wr, NULL);\n</code></pre>\n\n<p>where <code>t</code> is <code>wchar_t</code> pointer. After writing data I'm opening the XML file in VS and get something like a binary file, look at the snapshot. Is it normal? And how can I view this file in VS like a normal XML file (in nodepade it looked like XML but without formatting). Can I realise it?\n<img src=\"http://i.stack.imgur.com/5yda2.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["c#","winapi","c#-4.0","pcsc","winscard"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":13034814,"title":"Emulate card reader","body":"<p>I'm doing a project in C# using winscard.dll to communicate with a smart card. Right now I'm don't have a card reader to test with, so I'm working on basic PInvoke layer right now, but I cannot test it because I don't have a smart card service running. And now the question:</p>\n\n<p>Is there a way to emulate a smart card(reader) on Windows so that is visible from the winscard api?</p>\n"},{"tags":["winapi","dll"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13035596,"title":"Dynamic DLL and ESP corruption","body":"<p>I'm learning to use dynamic DLL. I have created 2 functions i DLL library:</p>\n\n<pre><code>DWORD fn1(VOID);\nDWORD fn2(WCHAR*);\n</code></pre>\n\n<p>and exported it using def file</p>\n\n<pre><code>EXPORTS\nfn1\nfn2\n</code></pre>\n\n<p>When I load&amp;use fn1, everything is ok, but the second is causing problem <code>Run-Time Check Failure #0 - The value of ESP was not properly saved across a function call.  This is usually a result of calling a function declared with one calling convention with a function pointer declared with a different calling convention.</code></p>\n\n<p>pointers are defined like:</p>\n\n<pre><code>typedef DWORD (WINAPI *fn1)(void);\ntypedef DWORD (WINAPI *fn2)( WCHAR* );\n</code></pre>\n\n<p>and loaded like this:</p>\n\n<pre><code>fn1 first = NULL;\nfn2 second = NULL;\nfirst = (fn1) GetProcAddress( dll,  \"fn1\" ); \nsecond = (fn2) GetProcAddress( dll,  \"fn2\" ); \n</code></pre>\n\n<p>Can you help me, what could cause the problem - when I \"continue\" application works fine... </p>\n"},{"tags":["c#","windows","winapi","profiling","hook"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13035481,"title":"Profiling injected library written in C#","body":"<p>Suppose I have a library that will be injected in some process (managed or unmanaged) to hook some WinAPI calls. And I want to profile it to see if there is much overhead in some hooks. I'm using EasyHook to hook WinAPI calls and library is written in C# for .NET 3.5. Is there a way to profile library in such situation?</p>\n"},{"tags":["c++","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":590,"score":2,"question_id":4954352,"title":"What does CCriticalSection do?","body":"<p>What the diffrence between this code:</p>\n\n<pre><code>::EnterCriticalSection( &amp;m_CriticalSection );\n//...\n::LeaveCriticalSection( &amp;m_CriticalSection );\n</code></pre>\n\n<p>and the code:</p>\n\n<pre><code>static CCriticalSection cs;\ncs.Lock();\n//...\ncs.UnLock();\n</code></pre>\n\n<p>Thanks in advance for the help.</p>\n"},{"tags":["windows","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":60,"score":3,"question_id":13026945,"title":"How do I differentiate between an empty window text and an error with the GetWindowText API?","body":"<p>The <code>GetWindowText</code> function's return value is <a href=\"http://msdn.microsoft.com/EN-US/library/windows/desktop/ms633520%28v=vs.85%29.aspx\" rel=\"nofollow\">documented as follows</a>:</p>\n\n<blockquote>\n  <p>If the function succeeds, the return value is the length, in\n  characters, of the copied string, not including the terminating null\n  character. If the window has no title bar or text, if the title bar is\n  empty, or if the window or control handle is invalid, the return value\n  is zero. To get extended error information, call GetLastError.</p>\n</blockquote>\n\n<p>Now, when calling this method and receiving a return value of zero, how do I know whether <code>GetLastError</code> would return a sensible value? After all, zero is not only used to indicate failure, but could also mean that the window text is empty, in which case <code>GetLastError</code> would not return an undefined value.</p>\n\n<p>My own ideas:</p>\n\n<ul>\n<li>At first, I thought that maybe <code>GetWindowText</code> might set the last error to 0 on success. But testing shows it doesn't (and if it did, I couldn't rely on it anyway, since this isn't documented).</li>\n<li>Then, I thought that maybe <code>GetWindowText</code> might leave the last error unchanged on success, so setting it to 0 myself before the call would allow me to check whether the last error has changed. Testing shows this might work, but since it's not doumented this way, I can't rely on it. (And I guess this would depend heavily on the concrete circumstances and implementation of <code>GetWindowText</code>.)</li>\n<li>And, of course, I could first check the window text length using <code>GetWindowTextLength</code> and then call <code>GetWindowText</code> only if the length was greater than 0. However, what if the window changes its text between my calls to <code>GetWindowTextLength</code> and <code>GetWindowText</code>? I, again, couldn't rely on a return value of zero denoting an error.</li>\n</ul>\n\n<p>So, what can I do to definitely decide whether <code>GetWindowText</code> failed?</p>\n"},{"tags":["c++","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13030571,"title":"How to delete Registry Key with all rights","body":"<p>I like to delete the key <code>'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Enum\\Root\\LEGACY_HTTP\\0000'</code> programatically in C++. I get Error 5 which is Access Denied. I tried calling ACL functions but i could not succeed. Can any one help me by giving code snipped through which i can delete the above mentioned Registry Key.</p>\n"},{"tags":["windows","winapi","directx","fullscreen","cmd.exe"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":40,"score":3,"question_id":13028277,"title":"Render internal windows program in full screen in DirectX/Win API program","body":"<p>I want to make such stuff, where I'll be able to run my internal programs in Windows like cmd.exe in a full screen mode.</p>\n\n<p>Earlier, in Windows XP I could use cmd.exe in a full screen mode using Alt + Enter, but from Windows Vista such thing was disabled because of WDDM ( Windows Display Driver Model ).</p>\n\n<p>I think, that the best way to make such thing is: \"to make a full screen DirectX/Win API program and then render another internal program in it\".</p>\n\n<p>I know how to create full screen programs using DirectX/Win API, but can't imagine how to render another program execution in my full screen program.</p>\n\n<p>Another way is: \"just to manipulate with input/output streams with cmd.exe or another internal program and then parse information in a full screen in DirectX full screen program\".</p>\n\n<p>What are your suggestions for the such question?</p>\n"},{"tags":["c++","windows","winapi","file-io","corruption"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":158,"score":0,"question_id":6525943,"title":"Cause of corrupted file contents","body":"<p>I'm having a recurring problem with an app in the wild.</p>\n\n<p>It has a fairly simple XML file it dumps out every now and then, something like every 30 minutes. </p>\n\n<p>The data files are often quite small - e.g. &lt; 5KB.</p>\n\n<p>It doesn't hold a lock on the file - it just recreates it from scratch each time.</p>\n\n<p>I was lucky enough to see the problem occur on a test machine, and what I observed was that the file was corrupted and set to \"nulls\" (i.e. 00 in Hex). What's really weird is that it is exactly the correct length compared to what it should have been.</p>\n\n<p>I've tried to be really careful in my saving process:</p>\n\n<ol>\n<li>I write the xml to a temp file in the same directory as I'm going to really save it</li>\n<li>I perform a Win32 MoveFile() with the MOVEFILE_WRITE_THROUGH set (so it <em>should</em> block until the move is really and truly complete), to move the file to replace the existing data file</li>\n</ol>\n\n<p>I even lock on a Mutex to make sure this isn't a threading issue.</p>\n\n<p>It doesn't happen that often, like maybe 1 in 1000 users.</p>\n\n<p>Now I have in the past observed data files being corrupted by a power failure or BSOD during writing, and I've seen things like the 32kb of a file being all NULL. </p>\n\n<p>But it just seems like it's happening more than I'd expect, given the chances of a power failure during the write, and espcecially since I'm using MOVEFILE_WRITE_THROUGH.</p>\n\n<p>Any ideas?</p>\n\n<p>John</p>\n\n<hr>\n\n<p>Answers to some questions:</p>\n\n<ul>\n<li><p>Q: Why not write to the file directly\nA: I avoided this to make the software less vulnerable to power failure issues. E.g. you're halfway through writing the file and crash/powerfail/BSOD then you definitely have a corrupted file. Doing a temp file write and then a move is a commonly used and simple way of ensuring that you do an atomic file operation as possible (well, as close as is reasonable without using NTFS specific APIs). I should say that the software is an archiving/backup system, so I have to take more care with data consistency than other apps might.</p></li>\n<li><p>Q: Does this happen during normal operation?</p></li>\n<li><p>A: As this issue occurs in the wild, I'm only working with a few clues, so I don't know for sure. I can say that the software works reliabely 99.9% of the time. I guess that's the nub of my question: is this just random unluckyness caused by BSOD/power failure or is it a bug?</p></li>\n<li><p>Q: What environment/OS:</p></li>\n<li><p>A: XP, Vista, 7, Server 200X. Most likely NTFS, but could be FAT32</p></li>\n<li><p>Q: Am I closing the file before moving</p></li>\n<li><p>A: Yes. I'm using C++ streams and calling close() before I do the MoveFile</p></li>\n<li><p>Q: What other processses are accessing the file?</p></li>\n<li>A: None managed by me. Obviously I'm not in control of Virus Checker, Folder Syncers, etc. The file is located in the AppData\\Local folder of the user's machine.</li>\n</ul>\n"},{"tags":["c++","c","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":73,"score":2,"question_id":13025994,"title":"Get available physical drives on local machine","body":"<p>I am trying to get all the physical drives available on local machine. \nI tried to use <code>GetLogicalDrives()</code> but when i'm using this function it gets me also drives that physically not available on the machine, for example floppy drive A. \nHere is my code:</p>\n\n<pre><code>void FindDrives()\n{\n    DWORD drives = GetLogicalDrives();\n     for (int i=0; i&lt;26; i++)\n     {\n        if( ( drives &amp; ( 1 &lt;&lt; i ) ) )\n        {\n           wchar_t driveName[] = { L'A' + i, L':', L'\\\\', L'\\0'};\n           std::wcout &lt;&lt; driveName &lt;&lt; std::endl;\n        }\n     }\n}\n</code></pre>\n\n<p>How can I get only physically available drives?</p>\n"},{"tags":["delphi","winapi","delphi-2009"],"answer_count":1,"favorite_count":0,"up_vote_count":7,"down_vote_count":1,"view_count":120,"score":6,"question_id":13017111,"title":"How to get a tree view item by the hit test when RTL layout is used?","body":"<p><em><strong>Description:</em></strong></p>\n\n<p>Having a tree view in right-to-left reading mode (RTL), how to get node that was clicked knowing just the click coordinates ? Here is an interposed class, that makes the tree view to use the RTL display and that contains a click handler in which you can see the problem:</p>\n\n<pre><code>unit Unit1;\n\ninterface\n\nuses\n  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,\n  Dialogs, ComCtrls, CommCtrl;\n\ntype\n  TTreeView = class(ComCtrls.TTreeView)\n  protected\n    procedure CNNotify(var Msg: TWMNotify); message CN_NOTIFY;\n    procedure CreateParams(var Params: TCreateParams); override;\n  end;\n\ntype\n  TForm1 = class(TForm)\n    TreeView1: TTreeView;\n    procedure FormCreate(Sender: TObject);\n  private\n    { Private declarations }\n  public\n    { Public declarations }\n  end;\n\nvar\n  Form1: TForm1;\n\nimplementation\n\n{$R *.dfm}\n\n{ TTreeView }\n\nprocedure TTreeView.CNNotify(var Msg: TWMNotify);\nvar\n  Node: TTreeNode;\n  Point: TPoint;\nbegin\n  inherited;\n  if Msg.NMHdr.code = NM_CLICK then\n  begin\n    Point := ScreenToClient(Mouse.CursorPos);\n    Node := GetNodeAt(Point.X, Point.Y);\n    if Assigned(Node) then\n      ShowMessage('This message never shows...');\n  end;\nend;\n\nprocedure TTreeView.CreateParams(var Params: TCreateParams);\nbegin\n  inherited CreateParams(Params);\n  Params.Style := Params.Style or TVS_RTLREADING;\n  Params.ExStyle := Params.ExStyle or WS_EX_LAYOUTRTL or WS_EX_RIGHT;\nend;\n\n{ TForm1 }    \n\nprocedure TForm1.FormCreate(Sender: TObject);\nvar\n  Node: TTreeNode;\nbegin\n  Node := TreeView1.Items.AddChild(nil, 'Item 1');\n  TreeView1.Items.AddChild(Node, 'SubItem 1');\nend;\n\nend.\n</code></pre>\n\n<p>The problem with this code (or better to say with such tree view in RTL mode) is, that when you click the node (or wherever), the <a href=\"http://docwiki.embarcadero.com/Libraries/XE3/en/Vcl.ComCtrls.TCustomTreeView.GetNodeAt\" rel=\"nofollow\"><code>GetNodeAt</code></a> method never returns a valid node (always <code>nil</code>). For those, who don't have Delphi, the <a href=\"http://docwiki.embarcadero.com/Libraries/XE3/en/Vcl.ComCtrls.TCustomTreeView.GetNodeAt\" rel=\"nofollow\"><code>GetNodeAt</code></a> method internally calls the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb773897%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>TreeView_HitTest</code></a> macro which when the tree view is in RTL mode, returns <code>NULL</code> like there won't be any item. I am passing to that macro the coordinates obtained through the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms648390%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>GetCursorPos</code></a> function calculated relatively to the control by the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd162952%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>ScreenToClient</code></a> function.</p>\n\n<p><em><strong>Question:</em></strong></p>\n\n<p>My question is, how to get the clicked node knowing just the mouse coordinates ? How to make a hit test with the tree view in RTL mode ? Should I for instance calculate the mouse horizontal position from right, and if so, how ?</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":2,"view_count":150,"score":1,"question_id":12523465,"title":"How should one retrieve the word under cursor, of current active window?","body":"<p>How could I retrieve the word under the cursor, on the currently active window? My thought was to use <code>GetCursorPos()</code> and <code>WindowFromPoint()</code> to get the handle, and do something, but how?</p>\n\n<p>Imagine a dictionary app, which reads the text under the cursor, and give an explanation of its meaning.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I end up use the dll from stardict, with its API hooks on text drawing. </p>\n"},{"tags":["c++","c","windows","winapi","richtextbox"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":11141549,"title":"Rich edit control: difference between rcPage and rc members of FORMATRANGE structure","body":"<p>The Win32 <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb787605%28v=vs.85%29.aspx\" rel=\"nofollow\">rich edit control</a> has a message called <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb788020%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>EM_FORMATRANGE</code></a> that can render the contents of the control to an arbitrary device context.  This is often used for printing or print preview, but could be used with any device context.  This message accepts a structure called <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb787911%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>FORMATRANGE</code></a>, which is defined as follows:</p>\n\n<pre><code>typedef struct _formatrange {\n  HDC       hdc;\n  HDC       hdcTarget;\n  RECT      rc;\n  RECT      rcPage;\n  CHARRANGE chrg;\n} FORMATRANGE;\n</code></pre>\n\n<p>The only documentation for <code>rc</code> and <code>rcPage</code> is the following:</p>\n\n<blockquote>\n  <p><strong><code>rc</code></strong>: The area to render to. Units are measured in twips.</p>\n  \n  <p><strong><code>rcPage</code></strong>: The entire area of a page on the rendering device. Units are measured in twips.</p>\n  \n  <p>The values for <code>rc</code> and <code>rcPage</code> can be obtained by using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd144877%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>GetDeviceCaps</code></a>.</p>\n</blockquote>\n\n<p>It is not completely clear to me what the difference between rcPage and rc is.  The code examples I have seen online seem to set both of these to the same rectangle.  Microsoft's own example <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb787875%28v=vs.85%29.aspx\" rel=\"nofollow\">How to Print the Contents of Rich Edit Controls</a> completely fails to initialize <code>rcPage</code> and actually passes undefined data to the rich edit control.</p>\n\n<p>Is <code>rcPage</code> even used by the rich edit control?  I can't see why a second rectangle might be useful for affecting the behavior of this command, so what is it there for?  Can someone provide an example illustrating the difference between <code>rc</code> and <code>rcPage</code>?</p>\n"},{"tags":["c++","winapi","hook","direct3d"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1099,"score":0,"question_id":6979558,"title":"Hooking (hot patching) class member functions. Modifying vtable entries","body":"<p>I have 2 questions, after a rather long preamble.</p>\n\n<p>By looking at any function pointer as at a <code>void*</code> I am able to modify its first instructions, transform them into a <code>jmp</code> (either 32 bit relative or 64 bit absolute, via <code>r11</code>, depending on x86/x86-64). I believe that looking at function code as at data is illegal in both C and C++, but it somehow seems to work, in an unsupported way, in both MSVC (Win32) and GCC (OS X). There are several places on the Internet saying that casting function pointers to <code>void*</code> <a href=\"http://yosefk.com/c++fqa/function.html#fqa-33.8\" rel=\"nofollow\">is illegal</a>.</p>\n\n<p>One doesn't simply get a pointer to a class member. I mean, the compiler directly throws errors at build time when trying to look at such a pointer in the same way as I'd look at a <code>void *</code>, practice which seems to work just fine for non-member functions.</p>\n\n<p>Fortunately, in order to hook Direct3D9, I'm working with stuff like <code>IDirect3DDevice9</code> which has a <code>vtable</code>. With <code>pDev</code> of type <code>IDirect3DDevice9*</code>, it's enough that I look at <code>pDev</code> as at a <code>PVOID*</code>. Then, the first value at <code>pDev</code> is the address of an array of pointers to functions (the <code>vtable</code>):</p>\n\n<pre><code>// IDirect3DDevice9::Present()\ntypedef HRESULT (CALLBACK *PRESENT_PROC)(\n    LPDIRECT3DDEVICE9, const RECT*,\n    const RECT*,\n    HWND,\n    const RGNDATA*\n);\n\nPVOID (*vPtr)[] = reinterpret_cast&lt;PVOID (*)[]&gt;(\n    *reinterpret_cast&lt;PVOID*&gt;(pDev)\n);\nPRESENT_PROC pDevicePresent = reinterpret_cast&lt;PRESENT_PROC&gt;(\n    (*vPtr)[17]\n);\n</code></pre>\n\n<p>since Present is the 18th entry.</p>\n\n<p><a href=\"http://stackoverflow.com/questions/2357879/c-d3d-hooking-com-vtable\">The first answer from here</a> gives a more elegant, higher-level method, starting with defining <code>CINTERFACE</code>. I haven't tested it yet, but according to it I can do things like</p>\n\n<pre><code>reinterpret_cast&lt;PVOID&gt;(pDev-&gt;lpVtbl-&gt;Present)\n</code></pre>\n\n<p>without error.</p>\n\n<p><strong>First problem.</strong> I'm not an awesome C++ programmer; how do I get a pointer, in general, <strong>to a member function</strong>, so that I can overwrite the executable bytes of that function. For a non-member I do:</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;cstdio&gt;\nusing namespace std;\n\nconst unsigned char OP_JMP = 0xE9;  // 32 bit relative jmp\nconst SIZE_T SIZE_PATCH = 5;        // jmp dword ptr distance; 1 byte + 4 bytes\ntypedef void (*MyProc)();\n\nvoid SimpleFunction1()\n{\n    printf(\"foo\\n\");\n}\n\nvoid SimpleFunction2()\n{\n    printf(\"bar\\n\");\n}\n\nint main()\n{\n    PBYTE foo = reinterpret_cast&lt;PBYTE&gt;(SimpleFunction1);\n    PBYTE bar = reinterpret_cast&lt;PBYTE&gt;(SimpleFunction2);\n\n    DWORD oldProtection;\n    // make sure the bytes of the function are writable\n    // by default they are only readable and executable\n    BOOL res = VirtualProtect(\n        foo,\n        SIZE_PATCH,\n        PAGE_EXECUTE_READWRITE,\n        &amp;oldProtection\n    );\n    if (!res) return 1;\n\n    // be mindful of pointer arithmetic\n    // works with PBYTE, won't with PDWORD\n    DWORD distanceToNewFoo = bar - foo - SIZE_PATCH;\n\n    *foo = OP_JMP;\n    *reinterpret_cast&lt;PDWORD&gt;(foo + 1) = distanceToNewFoo;\n\n    // called though the pointer instead of foo()\n    // to make sure the compiler won't inline or do some other stupid stuff\n    reinterpret_cast&lt;MyProc&gt;(foo)(); // will print \"bar\\n\"\n    return 0;\n}\n</code></pre>\n\n<p>and something in the same vein for x86-64. For a virtual member of an object, I get the <code>foo</code> pointer from the <code>vtable</code> itself as I've shown above:</p>\n\n<pre><code>reinterpret_cast&lt;FUNC_TYPE&gt;(\n    *(reinterpret_cast&lt;void**&gt;(\n        *reinterpret_cast&lt;void**&gt;(objptr)) + n\n    )\n)\n</code></pre>\n\n<p><strong>Second problem.</strong> Can't I get by with simply modifying the entries from the <code>vtable</code> for my object? Here's an example, needless to say, it doesn't work for the <code>pDev</code> object, as taken directly from Direct3D, but <a href=\"http://taksi.sourceforge.net/\" rel=\"nofollow\">Taksi</a> seems to use this method:</p>\n\n<pre><code>#include &lt;cstdio&gt;\nusing namespace std;\n\nclass BaseClass\n{\npublic:\n    BaseClass(int a = 0, int b = 0);\n    int GetA();\n    int GetB();\n    virtual void Test();\nprivate:\n    int _a;\n    int _b;\n};\n\nBaseClass::BaseClass(int a, int b) :\n    _a(a),\n    _b(b)\n{\n}\n\nint BaseClass::GetA()\n{\n    return _a;\n}\n\nint BaseClass::GetB()\n{\n    return _b;\n}\n\nvoid BaseClass::Test()\n{\n    printf(\"test %d; %d\\n\", _a, _b);\n}\n\nvoid TheNewFunction(BaseClass *bc)\n{\n    printf(\"I am an intruder\\n\");\n}\n\ntypedef void (*PROC_TYPE)(BaseClass *);\n\nint main()\n{\n    BaseClass foo(5, 56);\n    PROC_TYPE proc = 0;\n    proc = reinterpret_cast&lt;PROC_TYPE&gt;(\n        *reinterpret_cast&lt;void**&gt;(\n            *reinterpret_cast&lt;void**&gt;(&amp;foo)\n        )\n    );\n    proc(&amp;foo);\n    reinterpret_cast&lt;void**&gt;(\n        *reinterpret_cast&lt;void**&gt;(&amp;foo)\n    )[0] = reinterpret_cast&lt;void*&gt;(TheNewFunction);\n\n    foo.Test(); // runs same old Test(); maybe due to compiler optimization?\n    proc = reinterpret_cast&lt;PROC_TYPE&gt;(\n        *reinterpret_cast&lt;void**&gt;(\n            *reinterpret_cast&lt;void**&gt;(&amp;foo)\n        )\n    );\n\n    proc(&amp;foo); // runs TheNewFunction\n    BaseClass *goo = &amp;foo;\n    goo-&gt;Test(); // runs TheNewFunction\n    return 0;\n}\n</code></pre>\n"},{"tags":["c","multithreading","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":13021015,"title":"Passing a parameter to threads in a loop","body":"<p>I need to create 10 threads and print out the threadId with which thread printed.</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n\nDWORD WINAPI xprint(LPVOID Param)\n{\nDWORD tID = GetCurrentThreadId();\nint count = *(int*)Param + 1;\n\nfprintf(stderr, \"Thread Number:%d ThreadID:%d\\n\", count, tID);\n\nreturn 0;\n}\n\nint main ()\n{\n   DWORD ThreadID[10];\n   HANDLE ThreadHandle[10];\n   int i;\n\n   for(i=0; i&lt;10; i++){\n\n    ThreadHandle[i] = CreateThread(\n      NULL,\n          0,\n          xprint,\n          &amp;i,\n          0,\n          &amp;ThreadID[i]);\n\n    if (ThreadHandle[i] == NULL) {\n        fprintf(stderr,\"Can't create thread!\\n\");\n        return -1;\n        }\n    }\n\n    for (i=0; i&lt;10; i++){\n            WaitForSingleObject(ThreadHandle[i],INFINITE);\n        CloseHandle(ThreadHandle[i]);\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>Thread Number:1 ThreadID:4952\nThread Number:1 ThreadID:5284\nThread Number:1 ThreadID:5084\nThread Number:1 ThreadID:5656\nThread Number:1 ThreadID:5292\nThread Number:1 ThreadID:3072\nThread Number:1 ThreadID:5904\nThread Number:1 ThreadID:3620\nThread Number:1 ThreadID:6056\nThread Number:1 ThreadID:5676\n</code></pre>\n\n<p>I don't know where i did wrong.\nmy desired output should look something like this.</p>\n\n<p>output:</p>\n\n<pre><code>Thread Number:10 ThreadID:4952\nThread Number:8 ThreadID:5284\nThread Number:3 ThreadID:5084\nThread Number:9 ThreadID:5656\nThread Number:1 ThreadID:5292\nThread Number:2 ThreadID:3072\nThread Number:5 ThreadID:5904\nThread Number:6 ThreadID:3620\nThread Number:4 ThreadID:6056\nThread Number:7 ThreadID:5676\n</code></pre>\n\n<p>The Thread Number should be *out of order.</p>\n\n<p><em>*</em> After posting this question i ran the program a few more times\noutput:</p>\n\n<pre><code>Thread Number:2 ThreadID:4500\nThread Number:7 ThreadID:5740\nThread Number:7 ThreadID:3772\nThread Number:1 ThreadID:4732\nThread Number:2 ThreadID:4252\nThread Number:2 ThreadID:4264\nThread Number:2 ThreadID:5544\nThread Number:2 ThreadID:4116\nThread Number:2 ThreadID:5240\nThread Number:2 ThreadID:4804\n</code></pre>\n\n<p>it seems like the thread number is random. but in any case, no same number should appear twice.</p>\n"},{"tags":["windows","winapi","file"],"answer_count":4,"favorite_count":2,"up_vote_count":14,"down_vote_count":0,"view_count":6359,"score":14,"question_id":3828835,"title":"How can we check if a file Exists or not using Win32 program?","body":"<p>How can we check if a file Exists or not using a Win32 program? I am working for a Windows Mobile App.</p>\n"},{"tags":["c++","winapi","shell","com","access-violation"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":107,"score":2,"question_id":13018389,"title":"IShellDisptach: Why does FolderItemVerbs::Release() + CoUninitialize() crash?","body":"<p>I'm having a very bizarre problem with the <strong>IShellDispatch</strong> COM interface, more specifically with the <strong>FolderItemVerbs</strong> object, that drives me nuts!</p>\n\n<p>Calling <em>FolderItemVerbs::Release()</em> followed by <em>CoUninitialze()</em> will result in crash. It's clearly reproducible, but only happens 1 out of 10 times.</p>\n\n<p>The crash is an \"0xC0000005: Access Violation\" error. Running the problematic code in a loop 100% reproduces the crash sooner or later :-(</p>\n\n<p>Please see the example program:</p>\n\n<pre><code>static int TestProc(const TCHAR *pcDirectoryName, const TCHAR *pcFileName)\n{\n    int iSuccess = 0;\n\n    IShellDispatch *pShellDispatch = NULL;\n    Folder *pFolder = NULL; FolderItem *pItem = NULL;\n    FolderItemVerbs *pVerbs = NULL;\n\n    HRESULT hr = CoCreateInstance(CLSID_Shell, NULL, CLSCTX_INPROC_SERVER, IID_IShellDispatch, (void**)&amp;pShellDispatch);\n    if(FAILED(hr) || (pShellDispatch ==  NULL))\n    {\n        iSuccess = -3;\n        return iSuccess;\n    }\n\n    variant_t vaDirectory(pcDirectoryName);\n    hr = pShellDispatch-&gt;NameSpace(vaDirectory, &amp;pFolder);\n    if(FAILED(hr) || (pFolder == NULL))\n    {\n        iSuccess = -4;\n        pShellDispatch-&gt;Release();\n        return iSuccess;\n    }\n\n    variant_t vaFileName(pcFileName);\n    hr = pFolder-&gt;ParseName(vaFileName, &amp;pItem);\n    if(FAILED(hr) || (pItem == NULL))\n    {\n        iSuccess = -5;\n        pFolder-&gt;Release();\n        pShellDispatch-&gt;Release();\n        return iSuccess;\n    }\n\n    hr = pItem-&gt;Verbs(&amp;pVerbs);\n    if(FAILED(hr) || (pVerbs == NULL))\n    {\n        iSuccess = -6;\n        pItem-&gt;Release();\n        pFolder-&gt;Release();\n        pShellDispatch-&gt;Release();\n        return iSuccess;\n    }\n\n    /* Here we would do something with the FolderItemVerbs */\n\n    pVerbs-&gt;Release(); pVerbs = NULL; //If this line is commented out, we don't get a crash, but a massive memory leak!\n    pItem-&gt;Release(); pItem = NULL;\n    pFolder-&gt;Release(); pFolder = NULL;\n    pShellDispatch-&gt;Release(); pShellDispatch = NULL;\n\n    iSuccess = 1;\n    return iSuccess;\n}\n\n//-----------------------------------------------------------------------------\n\nstatic unsigned __stdcall ThreadProc(void* pArguments)\n{\n    HRESULT hr = CoInitialize(NULL);\n    if((hr == S_OK) || (hr == S_FALSE))\n    {\n        threadParam_t *params = (threadParam_t*) pArguments;\n        params-&gt;returnValue = TestProc(params-&gt;pcDirectoryName, params-&gt;pcFileName);\n        CoUninitialize();\n    }\n    else\n    {\n        if(threadParam_t *params = (threadParam_t*) pArguments)\n        {\n            params-&gt;returnValue = -10;\n        }\n    }\n\n    return EXIT_SUCCESS;\n}  \n</code></pre>\n\n<p>Please download the <em>complete</em> example code is here:\n<a href=\"http://pastie.org/private/0xsnajpia9lsmgnlf2afa\" rel=\"nofollow\">http://pastie.org/private/0xsnajpia9lsmgnlf2afa</a></p>\n\n<p>Please also note that I unambiguously tracked down to crash to <strong>FolderItemVerbs</strong>, because if I never create the <em>FolderItemVerbs</em> object, the crash is gone immediately.</p>\n\n<p>Also if I never call \"pVerbs->Release()\" before <em>CoUninitialize()</em> the crash is gone too, but this will result in a massive memleak, obviously.</p>\n\n<p>Another strange thing is that the crash will NOT happen, if I run the program under the Debugger! But I can run the program, wait for the crash and then let the Debugger handle the crash.</p>\n\n<p>Unfortunately the Stack Trace that I get then doesn't help much:\n<a href=\"http://pastie.org/private/cuwunlun2t5dc5lembpw\" rel=\"nofollow\">http://pastie.org/private/cuwunlun2t5dc5lembpw</a></p>\n\n<p>I don't think I'm doing anything wrong here. I have checked the code over and over again in the last two days. So this all seems to be a bug in FolderItemVerbs!</p>\n\n<p>Has anybody encountered this before and/or can confirm that this is a bug in FolderItemVerbs? Also, is there any workaround for the problem?</p>\n\n<p>Thanks in advance !!! </p>\n"},{"tags":["c++","winapi","notifications","controls","subclass"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13019264,"title":"WinAPI C++ - Do subclassed controls still send notifications to their parent?","body":"<p>I am making an edit-control wrapper class. The edit-control around which the class wraps is sub-classed so that the virtual methods (or 'events', such as <code>virtual void OnChange()</code>) can be overridden. My only question is, if I handle, let's say, the <code>EN_CHANGE</code> notification, in the controls subclass procedure, can the user still handle the <code>EN_UPDATE</code> notification in the parent windows procedure? Or does subclassing a control mean ALL of the notifications are handled by the controls new window procedure?</p>\n"},{"tags":["java","winapi","processbuilder"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12998804,"title":"How can the WriteConsoleInput function of a Windows console be accessed in Java?","body":"<p>I am trying to accomplish the exact same thing as this user:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/11480056/feeding-input-to-an-interactive-command-line-application\">Feeding input to an interactive command line application</a></p>\n\n<p>Except I need to do it in Java instead of Python. I create a process for vpncli.exe using ProcessBuilder and I am able to feed it the username through its OutputStream. This does not work for the password however. The solution of the above post indicates that vpncli.exe uses a different input method for the password, namely ReadConsoleInput instead of ReadInput. So my question is: How can I access the WriteConsoleInput function from java?</p>\n"},{"tags":["windows","winapi","drag-and-drop","cursor"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":58,"score":3,"question_id":13014613,"title":"How to get new-style Windows drag&drop cursors","body":"<p>How is it possible to use new-style dragging cursor on Windows when user is dragging something (e.g. image) from Explorer to my application?</p>\n\n<p><img src=\"http://i.stack.imgur.com/GeTFK.png\" alt=\"Windows drag&amp;drop cursors\"></p>\n\n<p>In some apps (MS Paint, Visual Studio, Qt Creator, ...) old cursors are used, in others (Explorer, Skype, Chrome, Opera, ...) – new.</p>\n\n<p>I’m talking only about the case when drag&amp;drop operation was created <strong>outside</strong> of our application. So it is handled by other program (Explorer in my case).</p>\n"},{"tags":["python","c","winapi","gui","win32gui"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":76,"score":2,"question_id":13015044,"title":"Setting the text colour of a RichEdit from a different process","body":"<p>I'm trying to set the background and foreground colour for specific words in a richedit control (class RichEdit20W) from a different process. I have the following C code that I call using python, but it fails (SendMessage returns 0). It works if I change SCF_SELECTION to SFC_ALL or 0, but sadly it doesn't fit my needs as I only need the change to apply to part of the text in the control.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;limits.h&gt;\n#include &lt;Richedit.h&gt;\n\n__declspec(dllexport) LRESULT SetColour(HWND hWnd, COLORREF textColor, COLORREF bgColor)\n{\n    CHARRANGE cr;\n    cr.cpMin = 3;\n    cr.cpMax = 8;\n\n    CHARFORMAT2 cf;\n    cf.cbSize = sizeof(cf);\n    cf.dwMask = CFM_COLOR | CFM_BACKCOLOR;\n    cf.crTextColor = textColor;\n    cf.crBackColor = bgColor;\n\n    DWORD   dwPID;\n    HANDLE  hProcess;\n    LPVOID  pRemoteCR;\n    LPVOID  pRemoteCF;\n    SIZE_T  zWritten;\n    LRESULT lResult;\n\n    GetWindowThreadProcessId(hWnd, &amp;dwPID);\n    hProcess = OpenProcess(PROCESS_VM_WRITE | PROCESS_VM_OPERATION, FALSE, dwPID);\n    //  Allocate memory on the target process &amp; write the CHARFORMAT2 structure there\n    pRemoteCR = VirtualAllocEx(hProcess, NULL, sizeof cr, MEM_COMMIT, PAGE_READWRITE);\n    WriteProcessMemory(hProcess, pRemoteCR, &amp;cr, sizeof cr, &amp;zWritten);\n    SendMessage(hWnd, EM_EXSETSEL, 0, (LPARAM)pRemoteCR);\n    VirtualFreeEx(hProcess, pRemoteCR, 0, MEM_RELEASE);\n\n    pRemoteCF = VirtualAllocEx(hProcess, NULL, sizeof cf, MEM_COMMIT, PAGE_READWRITE);\n    WriteProcessMemory(hProcess, pRemoteCF, &amp;cf, sizeof cf, &amp;zWritten);\n    lResult = SendMessage(hWnd, EM_SETCHARFORMAT, (WPARAM)SCF_SELECTION, (LPARAM)pRemoteCF); // SCF_SELECTION\n    VirtualFreeEx(hProcess, pRemoteCF, 0, MEM_RELEASE);\n\n    return lResult;\n}\n\nBOOL WINAPI DllMain(HINSTANCE hinstDLL,DWORD dwReason,LPVOID lpvReserved)\n{\n    return TRUE;\n}\n</code></pre>\n"},{"tags":["winapi","api","arm","windows-8"],"answer_count":2,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":1355,"score":8,"question_id":8254846,"title":"Does Windows 8 ARM, A.K.A. \"Windows RT\" have the Winapi (win32) available for third party developers?","body":"<p>Windows 8 for ARM, also known as Windows RT, does it have the equivalent of the Win32 API?</p>\n\n<p>(I <em>don't</em> mean if it can run Win32 x86 code, but if it has the Win32 API <em>available</em> to third party developers.)</p>\n"},{"tags":["windows","winapi"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":136,"score":0,"question_id":10721371,"title":"Is there an equivalent to SetupDiGetDeviceProperty which is available in Windows XP?","body":"<p>I am attempting to retrieve the \"Friendly name\" for a USB device. The code sample I found uses SetupDiGetDeviceProperty, and works wonderfully on Windows Vista and later. Unfortunately I also have to support Windows XP. Is there an alternate API call, available in XP, that would allow me to retrieve the same information?</p>\n"},{"tags":["c++","winapi","ini","fileparse"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12996786,"title":"What is the easiest way to change sections order of INI file in C++","body":"<p>I'm trying to read an INI file and write another INI file with the sections order changed. </p>\n\n<p>Does Windows API have tools for this kind of INI file processing? Are there open-source solutions that are preferred? Or should I try to attempt to parse it manually?</p>\n"},{"tags":["c++","winapi","wifi","adapter","turn-off"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13011639,"title":"winAPI c++ disable wireless adaptor","body":"<p>Ive been using the Native Wifi winAPI documentation but I still do see it really clear. </p>\n\n<p>I want to turn off the wireless adaptor and the bluetooth adaptor of my computer by using the winAPI in c++. Im almost sure I have to use the function WlanSetInterface from the mentioned library, but I cant make it work, I dont know how to call the function properly. Has anybody done this same task before so I can get some help? any suggestions welcome!</p>\n\n<p>Tkx </p>\n"},{"tags":["winapi","locking","pthreads","mingw","mutex"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":54,"score":0,"question_id":13012218,"title":"pthread mutex lock issue","body":"<p>I was messing with pthreads and I am facing a strange issue.\nI wrote a program that theoretically cannot end because it should enter a deadlock.\nHere it is:</p>\n\n<pre><code>#include &lt;pthread.h&gt;\n#include &lt;stdio.h&gt;\n\nunsigned int d = 0;\npthread_mutex_t d_lock;\n\nvoid* add(void *threadid)\n{\n    for(int i = 0; i &lt; 50; i++) \n    {\n        pthread_mutex_lock(&amp;d_lock);\n        d += 5;\n        printf(\"d's value is %d\\n\", d);\n    }\n    system(\"pause\");\n}\n\nint main (int argc, char **argv)\n{\n    pthread_t mythread;\n    pthread_mutex_lock(&amp;d_lock);\n    pthread_create(&amp;mythread, NULL, add, NULL);\n    pthread_exit(NULL);\n}\n</code></pre>\n\n<p>I have no idea why it doesn't halt and keeps printing ...\nThanks.</p>\n\n<p>EDIT:\nIt seems that the mutex needs to be initialized in order for it to work.\nOne of the ways to do this is to replace <code>pthread_mutex_t d_lock;</code> with <code>pthread_mutex_t d_lock = PTHREAD_MUTEX_INITIALIZER;</code> (statically initalize it) and the deadlock now happens. \nI did not see such a thing in the tutorial though.</p>\n"},{"tags":["c++","windows","winapi","dialog","modal-dialog"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":128,"score":0,"question_id":13007869,"title":"How to invoke a button using C++ Win32 API when press the enter button?","body":"<p>i have created a dialogbox using c++ win32 API...\nthere are 3 text box,1 combo box and 3 buttons...</p>\n\n<p>now i have 2 problems...</p>\n\n<p>1.when i press the ENTER button,it invoke second button(ID_OK) function,but i want  to invoke first button(ID_MYBUTTON)...</p>\n\n<p>2.i am using the code to focus a textbox is,</p>\n\n<pre><code>SetFocus(GetDlgItem(_hwnd, IDC_NAME));\n</code></pre>\n\n<p>But it cant focus that dialogbox,i mean cursor position is there,but cant get any value,when i typed...</p>\n\n<p>Can anyone resolve it?</p>\n"},{"tags":["c++","c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":13007925,"title":"Setting On windows' High Performance power plan using C++ winAPI","body":"<p>Ive written a code trying to activate the windows' high perfomance power plan through the winAPI in c++. It seems to work well for all the power plans (in my terminal they are called Balanced, Power saver and Dell) excepting for the one im interested in, the high performance plan! I would like the code to go over through  all the power plans and when finding the high performance one just set it on and then quit. Ill put my code underneath in case anybody can help me. thanks in advance!</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;powrprof.h&gt;\n#include &lt;iostream&gt;\n#include \"stdio.h\"\n#include &lt;ntstatus.h&gt;\n#include &lt;string&gt;\n#pragma comment(lib, \"powrprof.lib\")\n\nusing namespace std;\n\n\nint main(int argc, char **argv) {\n\n\n//////////////////  SET ACTIVE HIGH PERFORMANCE PLAN  ///////////////////\n\n\n//Variables\nUCHAR displayBuffer[64] = \" \";\nDWORD displayBufferSize = sizeof(displayBuffer);\nGUID buffer;\nDWORD bufferSize = sizeof(buffer);\n\n//Go throught the machine's power plans and activate the high performance one\nfor(int index = 0; ; index++)\n{\n\n    if (ERROR_SUCCESS == PowerEnumerate(NULL,NULL,&amp;GUID_VIDEO_SUBGROUP,ACCESS_SCHEME,index,(UCHAR*)&amp;buffer,&amp;bufferSize) )\n    {\n        if (ERROR_SUCCESS == PowerReadFriendlyName(NULL,&amp;buffer,&amp;NO_SUBGROUP_GUID,NULL,displayBuffer,&amp;displayBufferSize) )\n        {\n            wprintf(L\"%s\\n\", (wchar_t*)displayBuffer);\n\n\n            if( 0 == wcscmp ( (wchar_t*)displayBuffer, L\"High Performance\" ) )\n            {\n                cout &lt;&lt; \"High Performance Plan Found!\\n\";\n                if (ERROR_SUCCESS == PowerSetActiveScheme(NULL,&amp;buffer) )\n                {\n                cout &lt;&lt; \"* Setting Active High Performance Power Plan *\";\n                //std::cin.get(); //pause\n                break;\n                }\n\n            }\n        }\n\n    }\n    else break;\n}\n\n\nreturn 0;\n</code></pre>\n\n<p>}</p>\n"},{"tags":["c++","c","winapi","codeblocks"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":13001650,"title":"functions sound/delay/nosound in dos.h for c/c++","body":"<p>How can I get a version of language C/C++(downloaded??) where the functions sound, nosound, delay are present in the library DOS.H? \nFor example it doesn't exist in the version c/c++ on code::blocks. What have I to do in order to use/find the functions sound/nosound/delay?\nthank you for your help !</p>\n"},{"tags":["winapi","events","synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13002639,"title":"win32 waiting for events(synchroniztion)","body":"<p>I have 3 windows that have to interact with each other using events.\nwindows 1 and 2 are identical; each only have one button in them.</p>\n\n<p>Basically, I the main window(program 3) to not show up until <strong>one</strong> of the other two windows buttons\nis clicked; this is how it was describes in the lab:</p>\n\n<p>You need to use synchronization to control the processes (starting Program3 via Program1 or 2, ending Program1 or 2 via closing Program3). Note: Program1 and Program2 must have had their button clicked in order for them to receive the signal to die</p>\n\n<p>I've been looking around and got this so far for code:</p>\n\n<p><strong>Main window(program 3):</strong></p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include&lt;string.h&gt;\n\n#include &lt;stdio.h&gt;\n#include &lt;tchar.h&gt;\n#include &lt;conio.h&gt;\n#pragma comment(lib, \"winmm.lib\")\n\n\nLRESULT CALLBACK WndProc (HWND, UINT, WPARAM, LPARAM) ;\n\nint WINAPI WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance,\n                    PSTR szCmdLine, int iCmdShow)\n{\n     static TCHAR szAppName[] = TEXT (\"RACE\") ;\n     HWND         hwnd ;\n     MSG          msg ;\n     WNDCLASS     wndclass ;\n     HANDLE hEvents[2];\n     hEvents[0] = \"btn2\";\n     hEvents[1] = \"btn3\";\n     DWORD count = 2;\n\n     HBRUSH brush;\n     brush = CreateSolidBrush(RGB(255,0,0));\n\n     wndclass.style         = CS_HREDRAW | CS_VREDRAW ;\n     wndclass.lpfnWndProc   = WndProc ;\n     wndclass.cbClsExtra    = 0;\n     wndclass.cbWndExtra    = 0;\n     wndclass.hInstance     = hInstance ;\n     wndclass.hIcon         = LoadIcon (NULL, IDI_APPLICATION) ;\n     wndclass.hCursor       = LoadCursor (NULL, IDC_ARROW) ;\n     wndclass.hbrBackground = brush;\n     wndclass.lpszMenuName  = NULL ;\n     wndclass.lpszClassName = szAppName ;\n\n     if (!RegisterClass (&amp;wndclass))\n     {\n          MessageBox (NULL, TEXT (\"This program requires Windows NT!\"), \n                      szAppName, MB_ICONERROR) ;\n          return 0 ;\n     }\n     TCHAR* name;\n\n     //WAIT FOR SIGNAL\n     DWORD result = WaitForMultipleObjects(count,hEvents,FALSE,INFINITE);//work on this\n     if(result == WAIT_OBJECT_0)\n     {\n        name = TEXT(\"Program 1\");       \n     }\n     else if(result == WAIT_OBJECT_0 + 1)\n     {\n        name = TEXT(\"Program 2\");\n     }\n\n    hwnd = CreateWindow (szAppName,                  // window class name\n                          name, // window caption\n                          WS_OVERLAPPEDWINDOW,        // window style\n                          0,              // initial x position\n                          0,              // initial y position\n                          600,              // initial x size\n                          600,              // initial y size\n                          NULL,                       // parent window handle\n                          NULL,                       // window menu handle\n                          hInstance,                  // program instance handle\n                          NULL);                     // creation parameters\n\n\n\n     ShowWindow (hwnd, iCmdShow) ;//DON'T SHOW UNTIL ANOTHER WINDOW'S BUTTON IS PUSHED.\n     UpdateWindow (hwnd) ;\n\n     while (GetMessage (&amp;msg, NULL, 0, 0))\n     {\n          TranslateMessage (&amp;msg) ;\n          DispatchMessage (&amp;msg) ;\n     }\n     return msg.wParam ;\n}\n\nLRESULT CALLBACK WndProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n     HDC         hdc ;\n     PAINTSTRUCT ps ;\n\n\n     TCHAR* carNames[5] = {TEXT(\"Red Car\"), TEXT(\"Blue Car\"), TEXT(\"Black Car\"), TEXT(\"Green Car\"), TEXT(\"Orange Car\")};\n     switch (message)\n     {\n     case WM_CREATE:\n         HWND hwndButton;\n\n         for(int i = 0; i &lt; 5; i++)\n         {\n         hwndButton = CreateWindow ( TEXT(\"button\"),//type of child window \n                                   carNames[i],//text displayed on button\n                                   WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON,//type of button\n                                   20, (20*i*5+10),\n                                   85, 25,\n                                   hwnd, //parent handle i.e. main window handle\n                                    (HMENU) i,//child ID – any number\n                                   ((LPCREATESTRUCT) lParam)-&gt;hInstance, NULL);\n         }\n\n\n\n         break;\n\n\n          return 0 ;\n\n     case WM_PAINT:\n          hdc = BeginPaint (hwnd, &amp;ps) ;\n\n\n\n          EndPaint (hwnd, &amp;ps) ;\n          return 0 ;\n\n    /* case WM_CLOSE:\n\n          c--;\n          DestroyWindow(hwnd);\n          return 0 ;*/\n\n     case WM_DESTROY:\n\n          PostQuitMessage (0) ;\n          return 0 ;\n     }\n     return DefWindowProc (hwnd, message, wParam, lParam) ;\n}\n</code></pre>\n\n<p><strong>window 2(program2):</strong></p>\n\n<pre><code>    #include &lt;windows.h&gt;\n    #include&lt;string.h&gt;\n    #pragma comment(lib, \"winmm.lib\")\n\n    LRESULT CALLBACK WndProc (HWND, UINT, WPARAM, LPARAM) ;\n\n    int WINAPI WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance,\n                        PSTR szCmdLine, int iCmdShow)\n    {\n         static TCHAR szAppName[] = TEXT (\"Part 2\") ;\n         HWND         hwnd ;\n         MSG          msg ;\n         WNDCLASS     wndclass ;\n\n\n         wndclass.style         = CS_HREDRAW | CS_VREDRAW ;\n         wndclass.lpfnWndProc   = WndProc ;\n         wndclass.cbClsExtra    = 0;\n         wndclass.cbWndExtra    = 0;\n         wndclass.hInstance     = hInstance ;\n         wndclass.hIcon         = LoadIcon (NULL, IDI_APPLICATION) ;\n         wndclass.hCursor       = LoadCursor (NULL, IDC_ARROW) ;\n         wndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH) ;\n         wndclass.lpszMenuName  = NULL ;\n         wndclass.lpszClassName = szAppName ;\n\n         if (!RegisterClass (&amp;wndclass))\n         {\n              MessageBox (NULL, TEXT (\"This program requires Windows NT!\"), \n                          szAppName, MB_ICONERROR) ;\n              return 0 ;\n         }\n\n         hwnd = CreateWindow (szAppName,                  // window class name\n                              TEXT (\"Part 2\"), // window caption\n                              WS_OVERLAPPEDWINDOW,        // window style\n                              0,              // initial x position\n                              0,              // initial y position\n                              300,              // initial x size\n                              200,              // initial y size\n                              NULL,                       // parent window handle\n                              NULL,                       // window menu handle\n                              hInstance,                  // program instance handle\n                             NULL) ;                     // creation parameters\n\n\n\n         ShowWindow (hwnd, iCmdShow) ;\n         UpdateWindow (hwnd) ;\n\n\n         while (GetMessage (&amp;msg, NULL, 0, 0))\n         {\n              TranslateMessage (&amp;msg) ;\n              DispatchMessage (&amp;msg) ;\n         }\n         return msg.wParam ;\n    }\n\n    LRESULT CALLBACK WndProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)\n    {\n         HDC         hdc ;\n         PAINTSTRUCT ps ;\n         HANDLE hEvent;\n\n\n         switch (message)\n         {\n         case WM_CREATE:\n             HWND hwndButton2;\n               hwndButton2 = CreateWindow ( TEXT(\"button\"),//type of child window \n                                       TEXT(\"PRESS ME!\"),//text displayed on button\n                                       WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON,//type of button\n                                       20, 20,\n                                       200, 25,\n                                       hwnd, //parent handle i.e. main window handle\n                                        (HMENU) 45,//child ID – any number\n                                       ((LPCREATESTRUCT) lParam)-&gt;hInstance, NULL);\n\n               hEvent = CreateEvent(NULL, //no security attributes\n                FALSE, //auto-reset event object\n                FALSE, //initial state is nonsignaled\n                L\"btn2\"); //unnamed object\n\n\n\n              return 0 ;\n\n         case WM_PAINT:\n              hdc = BeginPaint (hwnd, &amp;ps) ;\n\n\n\n              EndPaint (hwnd, &amp;ps) ;\n              return 0 ;\n\n         case WM_COMMAND:\n\n\n             SetEvent(\"btn2\");\n\n             return 0;\n\n         case WM_DESTROY:\n\n              PostQuitMessage (0) ;\n              return 0 ;\n         }\n         return DefWindowProc (hwnd, message, wParam, lParam) ;\n    }\n</code></pre>\n\n<p>and <strong>window 3 (program 3):</strong> which is pretty much identical to window 2</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include&lt;string.h&gt;\n#pragma comment(lib, \"winmm.lib\")\n\nLRESULT CALLBACK WndProc (HWND, UINT, WPARAM, LPARAM) ;\n\nint WINAPI WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance,\n                    PSTR szCmdLine, int iCmdShow)\n{\n     static TCHAR szAppName[] = TEXT (\"Part 3\") ;\n     HWND         hwnd ;\n     MSG          msg ;\n     WNDCLASS     wndclass ;\n\n\n     wndclass.style         = CS_HREDRAW | CS_VREDRAW ;\n     wndclass.lpfnWndProc   = WndProc ;\n     wndclass.cbClsExtra    = 0;\n     wndclass.cbWndExtra    = 0;\n     wndclass.hInstance     = hInstance ;\n     wndclass.hIcon         = LoadIcon (NULL, IDI_APPLICATION) ;\n     wndclass.hCursor       = LoadCursor (NULL, IDC_ARROW) ;\n     wndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH) ;\n     wndclass.lpszMenuName  = NULL ;\n     wndclass.lpszClassName = szAppName ;\n\n     if (!RegisterClass (&amp;wndclass))\n     {\n          MessageBox (NULL, TEXT (\"This program requires Windows NT!\"), \n                      szAppName, MB_ICONERROR) ;\n          return 0 ;\n     }\n\n     hwnd = CreateWindow (szAppName,                  // window class name\n                          TEXT (\"Part 3\"), // window caption\n                          WS_OVERLAPPEDWINDOW,        // window style\n                          0,              // initial x position\n                          0,              // initial y position\n                          300,              // initial x size\n                          200,              // initial y size\n                          NULL,                       // parent window handle\n                          NULL,                       // window menu handle\n                          hInstance,                  // program instance handle\n                         NULL) ;                     // creation parameters\n\n\n\n     ShowWindow (hwnd, iCmdShow) ;\n     UpdateWindow (hwnd) ;\n\n\n     while (GetMessage (&amp;msg, NULL, 0, 0))\n     {\n          TranslateMessage (&amp;msg) ;\n          DispatchMessage (&amp;msg) ;\n     }\n     return msg.wParam ;\n}\n\nLRESULT CALLBACK WndProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n     HDC         hdc ;\n     PAINTSTRUCT ps ;\n     HANDLE hEvent1;\n\n     switch (message)\n     {\n     case WM_CREATE:\n           HWND hwndButton3;\n           hwndButton3 = CreateWindow ( TEXT(\"button\"),//type of child window \n                                   TEXT(\"PRESS ME!\"),//text displayed on button\n                                   WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON,//type of button\n                                   20, 20,\n                                   200, 25,\n                                   hwnd, //parent handle i.e. main window handle\n                                    (HMENU) 95,//child ID – any number\n                                   ((LPCREATESTRUCT) lParam)-&gt;hInstance, NULL);\n\n           hEvent1 = CreateEvent(NULL, //no security attributes\n            FALSE, //auto-reset event object\n            FALSE, //initial state is nonsignaled\n            L\"btn3\"); //unnamed object\n\n\n          return 0 ;\n\n     case WM_PAINT:\n          hdc = BeginPaint (hwnd, &amp;ps) ;\n\n\n\n          EndPaint (hwnd, &amp;ps) ;\n          return 0 ;\n\n          case WM_COMMAND:\n\n         SetEvent(\"btn3\");\n\n         return 0;\n\n\n     case WM_DESTROY:\n\n          PostQuitMessage (0) ;\n          return 0 ;\n     }\n     return DefWindowProc (hwnd, message, wParam, lParam) ;\n}\n</code></pre>\n\n<p>These are all in the same solution; but in different projects(multiple project in one solution).</p>\n\n<p>The problem right now is that I can't seem to get the main window to open when I click \neither one of the buttons. I've tried many different things, but none seem to be working.</p>\n\n<p>Any and all help is appreciated. Thanks in advance.</p>\n"},{"tags":["winapi","visual-c++","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13002524,"title":"Visual Studio 2012 - some 'inherited values' I want to get rid of","body":"<p>I'd like to know how to do something about 'inherited values' in Visual Studio 2012's property pages. In my project, I've decided I want to use precompiled headers, so naturally, I tried removing *.pch from the list of extensions to delete on Clean. However, it turns out it's listed, among many other extensions, under the read-only 'Inherited values' box when I try editing this property.</p>\n\n<p>'Inherit from parent or project defaults' is not ticked, but it makes no difference. My .pch file is deleted when I clean the solution nonetheless.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c++","c","winapi","unicode","visual-studio-2012"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12999168,"title":"MultiByteToWideChar terminating output buffer with junk, but reporting no error. Why?","body":"<p>While developing a program the other day, I had to convert an ASCII string into a Unicode string. I'm working on Windows with Visual Studio 2012, by the way. I noticed some strange behaviour with the Win32 function <code>MultiByteToWideChar</code> which I couldn't sort out. I wrote some test code, below:</p>\n\n<pre><code>int main()\n{\n    /* Create const test string */\n    char str[] = \"test string\";\n\n    /* Create empty wchar_t buffer to hold Unicode form of above string, and initialize (zero) it */\n    wchar_t *buffer = (wchar_t*) LocalAlloc(LMEM_ZEROINIT, sizeof(wchar_t) * strlen(str));\n\n    /* Convert str to Unicode and store in buffer */\n    int result = MultiByteToWideChar(CP_UTF8, NULL, str, strlen(str), buffer, strlen(str));\n    if (result == 0)\n        printf(\"GetLastError result: %d\\n\", GetLastError());\n\n    /* Print MultiByteToWideChar result, str's length, and buffer's length */\n    printf_s(\n        \"MultiByteToWideChar result: %d\\n\"\n        \"'str' length: %d\\n\"\n        \"'buffer' length: %d\\n\",\n        result, strlen(str), wcslen(buffer));\n\n    /* Create a message box to display the Unicode string */\n    MessageBoxW(NULL, buffer, L\"'buffer' contents\", MB_OK);\n\n    /* Also write buffer to file, raw */\n    FILE *stream = NULL;\n    fopen_s(&amp;stream, \"c:\\\\test.dat\", \"wb\");\n    fwrite(buffer, sizeof(wchar_t), wcslen(buffer), stream);\n    fclose(stream);\n\n    return 0;\n}\n</code></pre>\n\n<p>As you can see, it simply takes an ordinary character string, creates a buffer to store the Unicode string in, puts that converted Unicode string into the buffer, and shows me some results, also writing the buffer to a file.</p>\n\n<p>The output:</p>\n\n<pre><code>MultiByteToWideChar result: 11\n'str' length: 11\n'buffer' length: 16\n</code></pre>\n\n<p>Already weird. The function is processing the correct number of characters in the C string, but <code>wcslen</code> is reporting the output buffer to be longer than the C string! I'm pretty sure I allocated the buffer correctly, too.</p>\n\n<p>I've tried using different sized string lengths, but there's always junk at the end, and <code>wcslen</code> always reports the buffer's length to be a multiple of 4.</p>\n\n<p>Finally, for this particular string (<code>\"test string\"</code>), here's the raw buffer that was printed to file:</p>\n\n<pre><code>74 00 65 00 73 00 74 00 20 00 73 00 74 00 72 00   t.e.s.t. .s.t.r.\n69 00 6E 00 67 00 AB AB AB AB AB AB AB AB EE FE   i.n.g...........\n</code></pre>\n\n<p>(That's 32 bytes, or 16 Unicode characters.)</p>\n\n<p>The 10 bytes at the end are five characters; four <a href=\"http://www.fileformat.info/info/unicode/char/abab/index.htm\" rel=\"nofollow\">U+ABAB</a>, and one <a href=\"http://www.fileformat.info/info/unicode/char/feee/index.htm\" rel=\"nofollow\">U+FEEE</a>, which are meaningless to me.</p>\n\n<p>In different amounts, they occur <strong>every time</strong> I try converting a string.</p>\n\n<p>I'm kinda out of ideas. Anyone?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c","winapi","bluetooth","sdp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12997996,"title":"Bluetooth SDP structure","body":"<p>What's the structure of a SDP stream? I'm trying to add a new SDP bluetooth record in Windows 7, but I can't understand what's the \"raw stream\" contents. I know what I need to put there, I just don't know the format/protocol and google didn't helped me a lot this time.</p>\n\n<p>It's to use with <a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff536694%28v=vs.85%29.aspx\" rel=\"nofollow\">IOCTL_BTH_SDP_SUBMIT_RECORD_WITH_INFO</a> </p>\n"},{"tags":["winapi","dos","close"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13000812,"title":"Open CMD box in C and hide pop up","body":"<p>Hello all I was wondering if someone could help me with this issue I am calling a cmd prompt .exe file from within my WINAPI project. This works ok however the black dos box pops up for a split second. Its not the end of the world but i was messing around trying to block it. </p>\n\n<p>This code works fine but the box pops up which I use to call the .exe and save the data. </p>\n\n<pre><code>system(\"my.exe &gt; output.txt\"); \n</code></pre>\n\n<p>This is my other work around using winexec</p>\n\n<pre><code>WinExec(\"my.exe &gt; output.txt\",SW_SHOWMINIMIZED); // This wont work\n</code></pre>\n\n<p>This will work </p>\n\n<pre><code>WinExec(\"my.exe\",SW_SHOWMINIMIZED); // This will work but I cant add the  &gt; output.txt to save my output. \n</code></pre>\n\n<p>Any recommendations please ?</p>\n\n<p>BR</p>\n"},{"tags":["c++","c","winapi","combobox"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":139,"score":1,"question_id":3684475,"title":"Combobox hidden on resize","body":"<p>Whenever I resize my controls in my window, in response to a WM_SIZE message, they resize and redraw themselves fine. But my combobox control (a dropdown list) disappears whenever I give it a resize message, until I hover over it to bring it back.</p>\n\n<p>There are two possibilities, either it is not redrawing when I resize it, or it is being hidden by my tab control. So how would I solve this problem?</p>\n"},{"tags":["c++","winapi","gdi+"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12997419,"title":"GDI+ Open different files and draw them","body":"<p>I met some problen while using GDI+ for drawing diferent images in my program.<br>\nWhat my program is (graphically):<br>\n1. Window with a button and a background.<br>\n  When user hits the button, a open file dialog box opens and user must select an image file. When he is done, program must draw that file on the background.    </p>\n\n<p>The problem is that all Gdiplus objects don't have a default constructors.<br>\nSo even when I choose FromFile method, my bitmap object still have the same picture, assigned in contructor, so I didn't even realize how to change them dynamically.<br>\nCan you guys help or advice me some solution?  </p>\n"},{"tags":["windows","dll","memory-management","winapi"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":462,"score":4,"question_id":2927598,"title":"Linking to a Large address aware DLL","body":"<p>Suppose I have a DLL which is built with LARGEADDRESSAWARE linker flag set. Now I have an application dynamically linking to this DLL. Does this make my application LARGEADDRESSAWARE?</p>\n\n<p>If not then, does it make sense to have this flag set for any DLL?</p>\n"},{"tags":["winapi","file","vb6","registry","shellexecute"],"answer_count":9,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":4687,"score":4,"question_id":1193873,"title":"Which reasons could make ShellExecute fail?","body":"<p>I have a VB6 application which opens files with their associated application using:</p>\n\n<pre><code>ShellExecute(0, \"open\", filename, params, vbNullString, vbNormalFocus)\n</code></pre>\n\n<p>This works perfectly. </p>\n\n<p>Now I got a customer (running XP with Adobe Reader) who can't open any PDF file using the above command. But the same file is being opened without any problems when double clicking it from Windows Explorer. I also tested the filename/-path combination on my machine to exclude those kind of problems.</p>\n\n<p>I'm searching for any hints on what I could check to make sure <code>ShellExecute</code> is working. Or what can cause ShellExecute to fail this way?</p>\n"},{"tags":["c++","visual-studio","winapi","console","cmd"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12994296,"title":"C++: Disabling scrolling in a console application..?","body":"<p>I have created a borderless (and scrollbox-less) console application, but I have found that if the user has a touchpad and tries to scroll the console with it, he is able to do so. (Can't be done with a regular mouse, apparently.)</p>\n\n<p>I'd like to disable this feature.</p>\n\n<p>First I thought about creating some kind of message handling system for a my console, just like in Win32 GUI programming, but that seemed unnecessarily difficult.</p>\n\n<p>I also thought about changing the buffer size, but I have no idea how to do that (I looked into SetConsoleScreenBufferSize but couldn't do anything useful with it).</p>\n\n<p>Any suggestions?</p>\n"},{"tags":["c++","windows","winapi","video","ms-media-foundation"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":12995830,"title":"Video composition with Media Foundation","body":"<p>I'm trying to composite 2 videos into one (audio too) and save as a file. Say, show a source video on the left half of the final video and the ohter source on the right. Any encoding is fine. Not with DirectShow.</p>\n\n<p>I suspected IMFVideoMixerControl may be related to this but unfortunately I'm too new to MF to detemine the right step to take in order to achieve this. If you could give me some guidance or if any example available on the web, please let me know. Thank you for your help.</p>\n"},{"tags":["windows","winapi","uac"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":67,"score":4,"question_id":12994978,"title":"Windows UAC Dialog","body":"<p>I have an application that has no resources (at all, so no UAC manifest either).\nThis application installs itself to the appdata/roaming folder with CopyFile. It also sets an autostart so it starts automatically with every start. Now with every start of the pc, the UAC Dialog pops up and says that the application does changes to the pc. It also has the shield sign on the icon if it's located in appdata. How can I remove the dialog / the shield in the icon? Does Windows detect the copyfile API and sets it automatically? </p>\n\n<p>Thanks for your answer(s).</p>\n"},{"tags":["winapi","hook","save-as"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":12965354,"title":"Windows API hook, custom save as file dialog to save directly to webserver via POST","body":"<p>I want to write a custom save as dialog that is hooked into the File -> \"Save As\" of most Windows program. This custom dialog will allow the user to enter their username, password, destination folder and uploads the file to the web server via a POST. If the user clicks cancel, it will call the original file dialog.</p>\n\n<p>I've been reading up about Windows API hooking and this is vaguely how I think I would approach this:</p>\n\n<ol>\n<li>Intercept \"Save As\"</li>\n<li>Display my custom dialog, return some temporary path on the drive</li>\n<li>Let the program write file to the temporary path, assume it calls WINAPI CreateFile(...) for now</li>\n<li>Read the temporary file and upload to web server</li>\n<li>Clean up temporary file</li>\n</ol>\n\n<p>But I still can't get my head around the steps required to pull this off. Assuming I can intercept the \"Save As\" and CreateFile function, how do I detect the CreateFile was called from a \"Save As\" and not just any random file creation? I can think of a hack where I keep track of the time difference of when the File dialog got open and CreateFile got called.</p>\n\n<p>My alternative solution is to use the existing file dialog and create a special folder on the disk, that is constantly monitored. When a file gets written there it will call an external program that uploads the file. I haven't looked into how to do this yet. I suspect this is easier.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>As a first baby step, I wrote a .NET task tray application that allows the user to enter their login details and a folder to monitor. Whenever a file gets dropped in there there it will upload to the web server. So far it seems to work. Now I just need to figure out how to add a nice shortcut to the left pane of the file dialog. Once that's done I think I got a solution I'm happy with.</p>\n"},{"tags":["windows","winapi","unicode"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":49,"score":-1,"question_id":12988824,"title":"Unicode charset","body":"<p>I'm writing a WinAPI app that supports Cyrillic symbols. When I just output Cyrillic data into the console it works correctly. But when I give the file a Cyrillic name, and then try to use <code>WIN32_FIND_DATAW.cFileName</code> or other WinAPI stuff, it outputs nothing. But with a file name using only ASCII symbols, it works. What can be the reason? I'm using VS2010 where I set support for Unicode charset in settings. For example, this code, with a folder with only Cyrillic-name files doesn't output anything, but if I rename the file to ASCII it works correctly. </p>\n\n<pre><code>HANDLE hSearch;    \nWIN32_FIND_DATAW fileinfo; \nhSearch= FindFirstFileW( L\"D:\\\\ANDRUSko_sait\\\\*\", &amp;fileinfo);\nstd::wcout &lt;&lt; fileinfo.cFileName &lt;&lt; std::endl;\n</code></pre>\n"},{"tags":["windows","winapi","assembly"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":74,"score":-1,"question_id":12992875,"title":"Is it true that windows api(s) handles are saved in registers?","body":"<p>Is it true that windows api(s) handles are saved in registers?\nLets say CreateFile api successfully opened a file,thus a handle will be assigned for that api . Where this handle is saved? in memory and registers? ok,if yes, which registers? is there any convention? I think it might be EBX , I saw it under debugger, but I'm not sure about it, if this is always true.</p>\n"},{"tags":["windows","winapi","z-order"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1415,"score":1,"question_id":3282328,"title":"Updating the Z-Order of Many Windows Using Win32 API","body":"<p>The scenario is that I have a list of window handles to top level windows and I want to shift them around so they are arranged in the z-order of my choosing.  I started off by iterating the list (with the window I want to end up on top last), calling SetForegroundWindow on each one.  This seemed to work some of the time but not always, improving a little when I paused slightly in between each call.</p>\n\n<p>Is there a better way to do this?</p>\n\n<hr>\n\n<p>Edit:</p>\n\n<p>It looks like the BeginDeferWindowPos/DeferWindowPos/EndDeferWindowPos route is the way to go.  However, I can't seem to get it to work with more than one window at a time.  When I limit the window list to a single window, it works correctly.  When the list has multiple windows, it only seems to get one of them.  Here is pseudocode of what I'm doing:</p>\n\n<pre><code>HWND[] windows;\nHWND lastWindowHandle = 0;\nHDWP positionStructure = BeginDeferWindowPos(windows.length);\n\nfor (int i = 0; i &lt; windows.length; i++)\n{\n    positionStructure = DeferWindowPos(positionStructure, windows[i], lastWindowHandle, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE);\n}\n\nEndDeferWindowPos(positionStructure);\n</code></pre>\n\n<p>I'm sure it's something small/obvious I'm missing here but I'm just not seeing it.</p>\n"}]}
{"total":13828,"page":5,"pagesize":100,"questions":[{"tags":["windows","winapi","z-order"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12992201,"title":"What is an alternative to using GetWindow in a loop?","body":"<p>MSDN mentions the following remark for the <a href=\"http://msdn.microsoft.com/en-us/library/ms633515%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>GetWindow()</code></a> function.</p>\n\n<blockquote>\n  <p>The <a href=\"http://msdn.microsoft.com/en-us/library/ms633494%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>EnumChildWindows</code></a> function is more reliable than calling <code>GetWindow</code>\n  in a loop. An application that calls <code>GetWindow</code> to perform this task\n  risks being caught in an infinite loop or referencing a handle to a\n  window that has been destroyed.</p>\n</blockquote>\n\n<p>Using <code>EnumChildWindows</code> works just fine when only interested in listing all windows. However, what if you need the additional z-order functionality which <code>GetWindow</code> provides? I can't find all windows ordered by z-order using <code>EnumChildWindows</code>.</p>\n\n<p>Does this mean there is no 'safe' way to do so?</p>\n"},{"tags":["python","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":180,"score":0,"question_id":5910202,"title":"PyHook: return keydown fires twice","body":"<p>In the following code, when I hit return, on_key_down gets called twice.  It only gets called once for any other key.  Any idea what's going on here?</p>\n\n<pre><code>import pyHook, pythoncom, win32api\n\ndef on_key_down(e):\n  if e.MessageName == 'key down':\n    print 'e.Key: ', e.Key\n    print 'e.Ascii: ', e.Ascii\n  return True\nhm = pyHook.HookManager()\nhm.KeyDown = on_key_down\nhm.HookKeyboard()    \npythoncom.PumpMessages()\n</code></pre>\n"},{"tags":["c++","image","winapi","dialog","bmp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12960339,"title":"Using SS_BITMAP style on static control in a dialog frame","body":"<p>I am attempting to write a slot machine Win32 App that uses images to display the result of the spins. I know how to display an image on a normal LRESULT CALLBACK frame, but i'm lost when it comes to displaying images on a dialog. Could anyone help me by explaining(in-depth) how i would go about displaying images? I really appreciate it.</p>\n\n<p>My current Dialog callback:</p>\n\n<pre><code>BOOL CALLBACK DlgProc(HWND hwnd, UINT message,WPARAM wParam, LPARAM lParam)\n{\n    switch(message)\n    {\n        case WM_INITDIALOG:         //dialog created\n            g_hbmObject = LoadBitmap(GetModuleHandle(NULL), MAKEINTRESOURCE(IDB_OBJECT));\n                                    //initialize slotmachine class\n            Machine.Initialize(time(0));\n            if(g_hbmObject == NULL) //test if object is loaded correctly\n                std::cerr &lt;&lt; \"Could not load ball..\";\n        break;\n        case WM_COMMAND:            //switch command\n            switch(LOWORD(wParam))\n            {\n                case IDC_SPIN:      //slot machine spins\n                                    //put spin function, decide what to display\n                                    //do i put the display image command here? or where?\n                break;\n                case IDC_EXIT:      //exit button\n                    DeleteObject(g_hbmObject);\n                    EndDialog(hwnd, 0);\n                break;\n            }\n        break;\n        case WM_CLOSE:\n        case WM_DESTROY:            //case program is exited\n            DeleteObject(g_hbmObject);\n            PostQuitMessage(0);\n        break;\n        default:\n            return FALSE;\n    }\n    return TRUE;\n}\n</code></pre>\n"},{"tags":["winapi","led","parallel-port"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":61,"score":0,"question_id":12987999,"title":"turn on LED using C","body":"<p>I want to turn on a LED using C, meaning that I want to write on parallel port.</p>\n\n<p>but the code doesn't work.</p>\n\n<p>I use <code>char ledStatus</code> instead of <code>BYTE ledStatus</code>. is there any difference??</p>\n\n<p>what is the problem in this code?</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;conio.h&gt;\n#include &lt;staio.h&gt;\n#define LED_ON  1\n\nint main()\n{\n   HANDLE h;\n   unsigned long  dwSize=1;\n   int success;\n\n   h = CreateFile(\n      L\"LPT1\",\n      GENERIC_WRITE, // access (read-write) mode\n      0, // share mode\n      NULL, // pointer to security attributes\n      OPEN_EXISTING, // how to create\n      FILE_ATTRIBUTE_NORMAL, // file attributes\n      NULL // handle to file with attributes to copy\n   );\n\n   if (INVALID_HANDLE_VALUE == h)\n   {\n      //Handle Error\n      printf(\"CreateFile failed with error %d\\n\", GetLastError());\n      exit(1);\n   }\n   else\n   {\n      printf(\"CreateFile1 Successful\\n\");\n   }\n\n   char   ledStatus;\n   // turn on LED\n   ledStatus = LED_ON;\n   success = WriteFile(h, &amp;ledStatus, 1, &amp;dwSize, NULL);\n   if (success)\n   {\n      printf(\"File Write Successful - %i bytes\\n\", dwSize);\n   }\n   else\n   {\n      printf(\"File Write Failed\\n\");\n   }\n\n   // close port\n   CloseHandle(h);\n   return 0;\n}\n</code></pre>\n"},{"tags":["windows","winapi","application","textbox","control"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12989715,"title":"Determine if the focused control is an Editable one?","body":"<p>Using <strong>pure Win32 API</strong>, how can I get the handle to the control that currently has the focus? And then how can I determine if it's a Text Box / Rich Text Box?</p>\n\n<p>I'm trying to write a small macro keys program which will allow user to register new hot keys using the RegisterHotKey() function. Everything is working fine except that I don't want to violently call SetWindowText() or SendMessage(hWnd, WM_SETTEXT, 0, TEXT(\"Something\")) without knowing whether the control is a text box or not.</p>\n\n<p>Be noted that I want a handle to the <strong>control</strong> that currently has the focus, <strong>not the whole window</strong> the user is working on.</p>\n"},{"tags":["c++","winapi","visual-studio-2012","runtime-error","crt"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":119,"score":3,"question_id":12988258,"title":"What's with this \"CRT not initialized\" error?","body":"<p>I created an empty C++ project in Visual Studio 2012 Express (for Desktop of course), and added some random basic code:</p>\n\n<pre><code>#include &lt;cstdio&gt;\n#include &lt;cstdlib&gt;\n\ntypedef struct examplestruct\n{\n    unsigned char num1;\n    unsigned short num2;\n    unsigned long num3;\n    unsigned long long num4;\n} EXAMPLESTRUCT;\n\nvoid examplefunction(unsigned long *num, int num2)\n{\n    *num += num2;\n    return;\n}\n\nint main(int nArgs, char **pszArgs)\n{\n    EXAMPLESTRUCT ExStructInstance = {0xFF, 0xFFFF, 0xFFFFFFFF, 0xFFFFFFFFFFFFFFFF};\n    printf(\"%d, %d, %u, %ull\\n\", ExStructInstance.num1, ExStructInstance.num2, ExStructInstance.num3, ExStructInstance.num4);\n    unsigned long num5 = ExStructInstance.num1 + ExStructInstance.num2;\n    printf(\"%d\\n\", num5);\n    examplefunction(&amp;num5, 10);\n    printf(\"%d\\n\", num5);\n    system(\"pause\");\n    return 0;\n}\n</code></pre>\n\n<p>(If you're wondering what the hell this is about, I'm disassembling the created executable file to observe the behaviour of the optimizing compiler, and also to learn more about x86 assembly.)</p>\n\n<p>Under Linker in the project settings, I selected <code>Multi-threaded (/MT)</code> for the runtime library, so it would statically link it.</p>\n\n<p>I compiled and started debugging with F5 and immediately got this error in a message box:</p>\n\n<blockquote>\n  <p>Runtime Error!</p>\n  \n  <p>Program: C:\\Users\\xxxxx\\Documents\\P...</p>\n  \n  <p>R6030</p>\n  \n  <ul>\n  <li>CRT not initialized</li>\n  </ul>\n</blockquote>\n\n<p>So, this basic program won't run due to some problem with the runtime library, which I can't figure out!</p>\n\n<p>Any ideas? I'd just like to know what's going on here. Thanks in advance!</p>\n\n<p>EDIT: FYI, this is all done in Release mode.</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12988598,"title":"Get the hWnd of the non-client \"close\" button [x] (win32)","body":"<p>My app needs to display an info balloon pointing to the <code>upper-right</code> corner <code>[x]</code> button indicating the window has to be closed by clicking the <code>pointed [x]</code> button.</p>\n\n<p>for this reason I need to get the <code>[x]</code> button <code>hWnd</code> or if known its (undocumented) resource Id. Do you guys know how to do this with plain <code>win32?</code></p>\n\n<p>I have tried other alternatives dealing with non-client element metrics but they all gave unconsistent results (consider my app runs from <code>W2K</code> to <code>W8</code>)</p>\n\n<p>thanks</p>\n"},{"tags":["c++","winapi","mfc","wtl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12976302,"title":"Custom drawing Listview Items not changing text color","body":"<p>I am trying to implement a custom drawn listview in WTL, this is the code for the listview:</p>\n\n<pre><code>class CTaskListCtrl:  public CWindowImpl&lt;CTaskListCtrl, CListViewCtrl&gt;,\n                   public CCustomDraw&lt;CTaskListCtrl&gt;   \n{\npublic:\n    BOOL SubclassWindow(HWND hWnd)\n    {\n        ATLASSERT(m_hWnd==NULL);\n        ATLASSERT(::IsWindow(hWnd));\n        BOOL bRet = CWindowImpl&lt;CTaskListCtrl, CListViewCtrl&gt;::SubclassWindow(hWnd);\n          return bRet;\n   }\n   BEGIN_MSG_MAP(CTaskListCtrl)\n      CHAIN_MSG_MAP(CCustomDraw&lt;CTaskListCtrl&gt;)\n   END_MSG_MAP()\n\n   DWORD OnPrePaint(int /*idCtrl*/, LPNMCUSTOMDRAW /*lpNMCustomDraw*/)\n   {        \n      return  CDRF_NOTIFYITEMDRAW;\n   }\n\n   DWORD OnItemPrePaint(int /*idCtrl*/, LPNMCUSTOMDRAW lpNMCustomDraw)\n   {\n      NMLVCUSTOMDRAW* pLVCD = reinterpret_cast&lt;NMLVCUSTOMDRAW*&gt;( lpNMCustomDraw );\n\n      COLORREF crText;\n\n      if ( (pLVCD-&gt;nmcd.dwItemSpec % 2) == 0 )\n         crText = RGB(200,200,255);\n      else \n         crText = RGB(255,255,255);   \n\n      pLVCD-&gt;clrTextBk = crText;\n\n      return CDRF_DODEFAULT;\n    }\n};   \n</code></pre>\n\n<p>And this is how I use it: IDC_LIST_TASKS is the ListVieew resource that I have created in the resource wizard.</p>\n\n<pre><code>CTaskListCtrl m_taskList;\nm_taskList.SubclassWindow(GetDlgItem(IDC_LIST_TASKS));\n\nm_taskList.AddColumn( TEXT(\"Name\"),0);\nm_taskList.SetColumnWidth(0,100);\n\nm_taskList.AddColumn( TEXT(\"Algorithm\"), 1);\nm_taskList.SetColumnWidth(1,100);\n\nm_taskList.AddColumn( TEXT(\"Status\"), 2);\nm_taskList.SetColumnWidth(2,100);\n\nm_taskList.AddItem(0,0,L\"ASDASD\");\nm_taskList.AddItem(0,1,L\"ASDASD\");\nm_taskList.AddItem(0,2,L\"ASDASD\");\n</code></pre>\n\n<p>and the color of items text doesn't change. Why?</p>\n"},{"tags":["c++","c","multithreading","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":86,"score":1,"question_id":12970299,"title":"Recursive synchronization","body":"<p>In my app two threads invoke the same recursive function, that should output data to some file. I don't know how I can synchonized this threads to output correct data. I try a few variants with mutex (commented in code using /<strong>** n **</strong>/), but it doesn't work (output data are mixed from different threads). How can I organize synchronizathion(i should use only WinAPI and std). Pseudocode below:</p>\n\n<pre><code>HANDLE hMutex = CreateMutex(NULL,FALSE, 0);\nwchar_t** HelpFunction(wchar_t const* p, int *t)\n{\n    do\n    {\n        /**** 1 ****/ //WaitForSingleObject(hMutex, INFINITE);\n        wchar_t* otherP= someFunction();\n        if(...)\n        {\n            /**** 2 ****/ //WaitForSingleObject(hMutex, INFINITE);\n            //File's output should be here\n            //Outputing p\n            /**** 2 ****/ //ReleaseMutex(hMutex);\n        }\n        if(...)\n        {\n            HelpFunction(otherP, t);\n        }\n        /**** 1 ****/ //ReleaseMutex(hMutex);\n    }while(...);\n}\nunsigned int WINAPI ThreadFunction( void* p)\n{\n    int t = 0;\n    /**** 3 ****/ //WaitForSingleObject(hMutex, INFINITE);\n    wchar_t** res = HelpFunction((wchar_t *)p, &amp;t);\n    /**** 3 ****/ //ReleaseMutex(hMutex);\n    return 0;\n}\nvoid _tmain()\n{\n    HANDLE hThreads[2];\n    hThreads[0] = (HANDLE)_beginthreadex(NULL, 0, ThreadFunction, L\"param1\", 0, NULL);\n    hThreads[1] = (HANDLE)_beginthreadex(NULL, 0, ThreadFunction, L\"param2\", 0, NULL);\n    WaitForMultipleObjects(2, hThreads, TRUE, INFINITE);\n}\n</code></pre>\n"},{"tags":["winapi","audio","midi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":28,"score":-1,"question_id":12987325,"title":"extended Beep())","body":"<p>I need to find something like winapi <code>Beep(int, int)</code> but somewhat\nimproved</p>\n\n<ol>\n<li>should play thru audio speakers </li>\n<li>should accept the volume (if play quiet or more loud)</li>\n<li><p>should not put silence between two calls <code>Beep()</code> <code>Beep()</code> if one is after another</p></li>\n<li><p>should work under win xp - preferebly under pure system with no external libs</p></li>\n</ol>\n\n<p>(5. can do some more settings about shape of played wave, but I do not need a\ngeneral way to play wav sample, but just some synthetic wave)</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12986673,"title":"WinAPI Threadpool","body":"<p>I've searched in google, but cannot find how can I add my own function to Threadpool. I have a function with signature <code>void MyFunction(void *param);</code>. How I can create Threadpool and add this function for assynchronos execution. I know that exist <code>TrySubmitThreadpoolCallback()</code> function, but I cannot understand how to use it. I'll be very glad to see simple example.</p>\n"},{"tags":["windows","winapi","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12986583,"title":"how to Avoid warning message on click of custom URL","body":"<p>I have register a custom URL in my system as described in the bellow link.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/aa767914(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/aa767914(v=vs.85).aspx</a></p>\n\n<p>when i send a mail to my email. i opened the mail in outlook email client and clicked on the link then it displayed warning message </p>\n\n<blockquote>\n  <p>Microsoft office had identified a potential security\n  concern.Hyperlinks can be harmful to your computer and data. To\n  protect your computer, click only those hyperlinks from trusted\n  sources.</p>\n</blockquote>\n\n<p>Is there any way to disable the warning message?</p>\n\n<p>If i digitally sign the email will that warning message comes?</p>\n\n<p>If i sign the binary will that warning message comes?</p>\n"},{"tags":["windows","winapi","visual-c++","appdata"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":211,"score":2,"question_id":10267437,"title":"Application cannot write into %APPDATA% (but user can)","body":"<p>I have an application which needs to create its settings directory inside the user's %APPDATA% directory. To do this it uses code similar to the following:</p>\n\n<pre><code>std::string appDataBase = getenv(\"APPDATA\");\nstd::string appDir = appDataBase + \"\\\\MyDir\";\n\nstd::cerr &lt;&lt; \"About to invoke _mkdir(\" &lt;&lt; appDir &lt;&lt; \")\" &lt;&lt; std::endl;\nint rv = _mkdir(appDir.c_str());\nstd::cerr &lt;&lt; \"_mkdir returned \" &lt;&lt; rv &lt;&lt; \", errno = \" &lt;&lt; errno &lt;&lt; std::endl;\n</code></pre>\n\n<p>However, when this code runs, the <code>_mkdir</code> call fails and <code>errno</code> is set to <code>EACCES</code>:</p>\n\n<pre><code>About to invoke _mkdir(C:\\Users\\mdm\\AppData\\Roaming\\MyDir)\n_mkdir returned -1, errno = 13\n</code></pre>\n\n<p>I would have assumed this is a simple permissions issue, except for the fact that (1) I can create the directory manually in Explorer without any permission problems, and (2) the exact same code works fine if I copy it into a project by itself.</p>\n\n<p>I have done extensive searching for information about this issue but can only find discussions of general permissions problems such as the user not being able to access/write into this folder using Explorer. The code in my application works if I run it as Administrator, so clearly there is something odd going on with its permissions, but I don't know what else to check. I have inspected with Process Explorer and confirmed that the application is running with my user account, which has full write permissions into the %APPDATA% directory, and I have ensured that the %APPDATA% tree is not set to Hidden or Read-Only.</p>\n\n<p>Is there some kind of \"effective user ID\" or \"effective permissions\" that can be set on a Windows application, which might depend on something in the build configuration or process initialisation? Are there any other factors that would prevent one specific application from writing into %APPDATA% while other user processes can?</p>\n\n<p><strong>Update</strong></p>\n\n<p>Further investigation reveals that the difference in behaviour is not related to the content of the code, but the <em>location of the executable</em> in the filesystem. My application is being built from a source tree inside a <code>Development</code> folder in my user directory, and the <code>_mkdir</code> call fails for executables within this directory; however, copying the .exe file into a new directory <code>C:\\Development</code> allows it to work fine (although moving the existing <code>Development</code> directory does not). The simple test program was inside <code>Documents\\Visual Studio\\Projects</code>, which also seems to be a satisfactory location.</p>\n"},{"tags":["c#","winapi","registry","uac"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":4637,"score":3,"question_id":4950371,"title":"Cannot Write to the Registry under HKEY_LOCAL_MACHINE\\Software","body":"<p>I'm writing an application that needs to create a special user account hidden from login screens and the Control Panel users applet. By writing a <code>DWORD</code> value of 0 with the user name to the registry key below, I'm able to accomplish this goal:</p>\n\n<blockquote>\n  <p>HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\n  NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\UserList</p>\n</blockquote>\n\n<p>The problem is that under Windows 7 with UAC on, no matter what I try, I cannot programmatically write a value to the key above. </p>\n\n<p>It is my understanding that writing to certain keys this is not allowed on Windows 7 with UAC on, unless you are running with Administrative privileges. I've added an application manifest <code>requestedExecutionLevel level=\"requireAdministrator\" uiAccess=\"false\"</code>, I accept the UAC prompt when my program is run, my account is a member of Administrators, yet I am still unable to write to the above registry key.</p>\n\n<p>What more do I need to do? How is it possible, in any application configuration, to write keys and values under <code>HKEY_LOCAL_MACHINE\\SOFTWARE</code>?</p>\n\n<p>Further information ... When my program runs, no errors are thrown and it seems to write values. My guess is that Windows is virtualizing the location to which I am writing. I need to write to the actual location, not a virtual one, if I am to hide this special user account.</p>\n"},{"tags":["c#","winapi","keyboard"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":12982513,"title":"Trouble Simulating Keystrokes","body":"<p>I've used WIN32API calls in the past to simulate keystrokes without much trouble.  Even now, at a superficial level, it seems to work.  I'm using the Win32 SendMessage call to send a WM_KEYDOWN, WM_CHAR, WM_KEYUP message to an instance of Notepad.</p>\n\n<p>And sure enough, whatever I send appears in Notepad.</p>\n\n<p>But while using Spy++ to inspect the messages; I noticed that my sent Keystrokes were noticeably different than the keys I had actually typed or the ones created using Windows built-in on screen keyboard.</p>\n\n<p>In Spy++ my single WM_KEYDOWN generates two lines:</p>\n\n<pre><code>&lt;001&gt; 00234 S WM_KEYDOWN nVirtKey:'W'....\n&lt;002&gt; 00234 R WM_KEYDOWN\n</code></pre>\n\n<p>Pressing the W key for real (or using the OnScreenKeyboard) generates only a single line</p>\n\n<pre><code>&lt;003&gt; 00234 P WM_KEYDOWN nVirtKey:'W'...\n</code></pre>\n\n<p>If I expand these messages, I can see that 'S' represents Sent, R - 'Received', and P - 'Posted'.</p>\n\n<p>Can anyone tell how I can more accurately simulate keyboard input programatically?  I've matched the rest of the message (including the lParam value).</p>\n"},{"tags":["c#",".net","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12982340,"title":"Post windows command to open menu","body":"<p>I need to be able to automate a second application in Windows 7 from another application.  I'm able to post a message to the target application I'm trying to control to select menu options, i.e.</p>\n\n<pre><code>WindowFuncs.PostMessage(hWin, (uint)WindowMessageCommands.WM.COMMAND, (IntPtr)menuId, (uint)0);\n</code></pre>\n\n<p>but some of the menu options I need to select are dynamic - they do not exist until the menu drops down, and they go away when the menu closes.  I am enumerating the menus of the target applications, searching for the option I want and then posting that menuId... but I need to cause the menu to open before doing that enumeration to see the dynamic options and I don't know how to do that.  Is there a WM command that I'm not finding that allows me to do that?</p>\n"},{"tags":["delphi","winapi","keyboard","delphi-7"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":191,"score":2,"question_id":12973296,"title":"How can I detect how long a key has been held down?","body":"<p>I'm looking for a way to detect how long a key has been held down in a Delphi project and warn user.</p>\n\n<p>I'm working on a chat program and need to see if the person is holding down a letter, like the W key, to spam that chat box. I'll give sample what trying to do in Delphi 7:</p>\n\n<pre><code>//Looking up if key in use and held for lets say 20 seconds\nif (GetAsyncKeyState(Byte(VkKeyScan('W'))) shl 20) &lt;&gt; 0 then\nbegin\n  ShowMessage('W Key Held down too long!');\nend;\n</code></pre>\n\n<p>I'm not sure whether GetAsyncKeyState will give me that information, though. If it doesn't, what will?</p>\n"},{"tags":["winapi","mfc","atl","wtl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12971062,"title":"Custom draw CProgressBarCtrl win32","body":"<p>I want to have a custom progress bar control, for example showing some moving oblique lines or like <a href=\"http://learnjavafx.typepad.com/photos/uncategorized/2008/07/30/burning_2.png\" rel=\"nofollow\">this</a> or drawing an image inside the progress bar control. I 've searched the web and some examples of custom drawing for listviews and dynamic subclassing but the code doesn't call the painting methods:</p>\n\n<pre><code>public:\n     BOOL SubclassWindow(HWND hWnd)\n      {\n          ATLASSERT(m_hWnd==NULL);\n          ATLASSERT(::IsWindow(hWnd));\n          BOOL bRet = CWindowImpl&lt;CMyProgressControl, CProgressBarCtrl&gt;::SubclassWindow(hWnd);\n          return bRet;\n       }\n\n    BEGIN_MSG_MAP(CMyProgressControl)\n      CHAIN_MSG_MAP(CCustomDraw&lt;CMyProgressControl&gt;)\n   END_MSG_MAP()\n\n   DWORD OnPrePaint(int /*idCtrl*/, LPNMCUSTOMDRAW /*lpNMCustomDraw*/)\n    {        \n        return  CDRF_NOTIFYITEMDRAW;\n    }\n     DWORD OnItemPrePaint(int /*idCtrl*/, LPNMCUSTOMDRAW lpNMCustomDraw)\n    {\n        NMLVCUSTOMDRAW* pLVCD = reinterpret_cast&lt;NMLVCUSTOMDRAW*&gt;( lpNMCustomDraw );\n\n        // This is the prepaint stage for an item. Here's where we set the\n        // item's text color. Our return value will tell Windows to draw the\n        // item itself, but it will use the new color we set here for the background\n\n        COLORREF crText;\n\n\n            crText = RGB(200,200,255);\n\n        // Store the color back in the NMLVCUSTOMDRAW struct.\n        pLVCD-&gt;clrTextBk = crText;\n\n\n        // Tell Windows to paint the control itself.\n        return CDRF_DODEFAULT;\n    }\n</code></pre>\n"},{"tags":["c","visual-studio-2010","winapi","playsound"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12980801,"title":"PlaySound in C beeps but does not play wav file","body":"<p>In C, my <code>PlaySound</code> is not throwing any errors... but instead of playing the file I want, it just beeps.</p>\n\n<p>Any suggestions?</p>\n\n<p>I tried :</p>\n\n<pre><code>PlaySound(\"song1.wav\", NULL, SND_ALIAS | SND_APPLICATION); \n</code></pre>\n\n<p>And:</p>\n\n<pre><code>PlaySound(\"song1.wav\", NULL, SND_FILENAME); \n</code></pre>\n\n<p>But I got the same result.</p>\n"},{"tags":["c++","winapi","malloc"],"answer_count":5,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":1952,"score":8,"question_id":8224347,"title":"malloc() vs. HeapAlloc()","body":"<p>What is the difference between malloc() and HeapAlloc()? As far as I understand malloc allocates memory from the heap, just as HeapAlloc, right?</p>\n\n<p>So what is the difference?</p>\n\n<p>Thanks!</p>\n"},{"tags":["c#","windows","winapi","windows-xp"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12975463,"title":"Get bitmap of another application window","body":"<p>Attempting to get an image of another applications window in Windows XP.</p>\n\n<p>I can do this in Windows 7, because of the DWMRegisterThumbnail API, and this works flawlessly. However, in Windows XP there is no DWM api and therefore I am relying on PrintWindow.</p>\n\n<p>This application opens new windows for each \"menu\" (every time you press a button on its UI), and therefore you have to re-enumerate all its windows to find the newest one (In fact, FindWindow returns the newest anyway). It does crash at some points however, possibly due to my application still having a handle to one of its old windows?</p>\n\n<p>This is my current code:</p>\n\n<pre><code>if (garminHwnd == IntPtr.Zero)\n            return;\n        garminHwnd = FindWindow(\"CDP_FIELD_WND\", String.Empty);\n        IntPtr hdc = GetWindowDC(garminHwnd);\n        if (hdc != IntPtr.Zero)\n        {\n\n            Graphics memoryGraphics = Graphics.FromImage(bmp);\n            IntPtr dc = memoryGraphics.GetHdc();\n            bool success = PrintWindow(garminHwnd, dc, 0);\n            memoryGraphics.ReleaseHdc(dc);\n       }\n</code></pre>\n\n<p>\"bmp\" is a Bitmap and is just displayed in a PictureBox at the moment. This is run approx 1/sec.</p>\n\n<p>Is there a more attractive/easier way to do what i'm doing? </p>\n"},{"tags":["windows","winapi","visual-c++","mfc","taskbar"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12929701,"title":"windows application showing behind the taskbar on vista","body":"<p>I have an MFC application. In my application if I run on Windows XP it's working fine. But if I run in Windows Vista the MFC dialog hides behind the taskbar.</p>\n\n<pre><code>bool bHide=true;\nCRect rectWorkArea = CRect(0,0,0,0);\nCRect rectTaskBar = CRect(0,0,0,0); \n\nCWnd* pWnd = CWnd::FindWindow(\"Shell_TrayWnd\", \"\"); \npWnd-&gt;ShowWindow(SW_SHOW);\nif( bHide ) \n{  // Code to Hide the System Task Bar  \n    SystemParametersInfo(SPI_GETWORKAREA,0,(LPVOID)&amp;rectWorkArea,0);   \n    if( pWnd ) \n    {   \n        pWnd-&gt;GetWindowRect(rectTaskBar);   \n    //    rectWorkArea.bottom -= rectTaskBar.Height();  \n        rectWorkArea.bottom += rectTaskBar.Height();//-----to hide taskbar\n        SystemParametersInfo(SPI_SETWORKAREA,0,(LPVOID)&amp;rectWorkArea,0);    \n    //    pWnd-&gt;ShowWindow(SW_SHOW);  \n        pWnd-&gt;ShowWindow(SW_HIDE); //--to hide taskbar\n    }\n}\n</code></pre>\n\n<p>I used this code but it hides the taskbar. But I want to show the application above the task bar.</p>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12973527,"title":"How OneNote accesses url of copied text from firefox, how can I use this in my app","body":"<p>When you copy text from a webpage in firefox (a non microsoft product) into OneNote it adds the url of the webpage along with the copied text as \"Pasted from\" as in the following example:</p>\n\n<pre><code>Apache OpenOffice is an open-source office productivity software suite \n\nPasted from &lt;http://en.wikipedia.org/wiki/Openoffice&gt; \n</code></pre>\n\n<p>How OneNote access the url info of the copied text from a non microsoft app. How can I access similar information programmatically in my apps using c++/C# or other technologies? Is there some api to access additional information from system clipboard like url, source application, source file etc?</p>\n"},{"tags":["c++","winapi","keyboard","borland"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12746800,"title":"Keyboard focus: looking for a general strategy","body":"<p>My application has a big graphics area with some controls (sliders, buttons, text edit controls) in a side panel. The graphics area understands some keyboard commands.</p>\n\n<p>My problem is that when a control in the side panel is in focus, the main graphics area won't receive any keyboard commands, so this confuses the users. However, for some controls, this is intended, e.g. text edit controls.</p>\n\n<p>What I want is the focus to automatically return to the graphics area at the earliest possible occasion (which I call \"greedy\" focus) -- e.g. when text editing is finished (Enter key), or when the user has selected an item from a combo box.</p>\n\n<p>I am looking for a clean and robust strategy for dealing with the problem, either using Windows API or Borland Vcl.</p>\n\n<p>I'd appreciate if you want to share your ideas.</p>\n"},{"tags":["c++","winapi","boost","time"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":73,"score":3,"question_id":12972221,"title":"Measurement with boost::posix_time::microsec_clock has error more than ten microseconds?","body":"<p>I have the following code:</p>\n\n<pre><code>long long unsigned int GetCurrentTimestamp()\n{\n   LARGE_INTEGER res;\n   QueryPerformanceCounter(&amp;res);\n   return res.QuadPart;\n}\n\n\nlong long unsigned int initalizeFrequency()\n{\n   LARGE_INTEGER res;\n   QueryPerformanceFrequency(&amp;res);\n   return res.QuadPart;\n}\n\n\n//start time stamp\nboost::posix_time::ptime startTime = boost::posix_time::microsec_clock::local_time();\nlong long unsigned int start = GetCurrentTimestamp();\n\n\n// ....\n// execution that should be measured\n// ....\n\nlong long unsigned int end = GetCurrentTimestamp();\nboost::posix_time::ptime endTime = boost::posix_time::microsec_clock::local_time();\nboost::posix_time::time_duration duration = endTime - startTime;\nstd::cout &lt;&lt; \"Duration by Boost posix: \" &lt;&lt; duration.total_microseconds() &lt;&lt;std::endl;\nstd::cout &lt;&lt; \"Processing time is \" &lt;&lt; ((end - start) * 1000000 / initalizeFrequency()) \n            &lt;&lt; \" microsec \"&lt;&lt; std::endl;\n</code></pre>\n\n<p>Result of this code is </p>\n\n<pre><code>Duration by Boost posix: 0\nProcessing time is 24 microsec\n</code></pre>\n\n<p>Why there is such a big divergence? Boost sucks as much as it should measure microseconds but it measures microseconds with tenth of microseconds error???</p>\n"},{"tags":["c++","windows","winapi","dialog"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12969768,"title":"how to show combobox second value in default using C++ winapi 32?","body":"<p>i have problem in display a login dialogbox...\nthat have 2 textbox,1 combobox like username,password,domain...</p>\n\n<p>1.i have setfocus in username ,that cant set</p>\n\n<pre><code>SetFocus(GetDlgItem(_hwnd, IDC_NAME)); \n</code></pre>\n\n<p>but,it cant set when system logontime,the cursor symbol is focus that textbox,but values not get,ather i click that textbox,then only focus that textbox...\nbut after login other dialogbox textboxs are focused using this type of code,like</p>\n\n<pre><code>SetFocus(GetDlgItem(hchged, IDC_PWD));\n</code></pre>\n\n<p>2.In combobox the systemname and domain name there...every login time\nsystem name only showed...how to change that into domain name...</p>\n\n<p>note:i am using c++ win32 API dialogbox...</p>\n"},{"tags":["windows","winapi","audio"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12963247,"title":"Way to get notification about audio device enable/disable in Windows XP/7/8","body":"<p>Is there way in Windows API to be notified when audio device gets enabled or disabled?</p>\n\n<p>I have source code with RegisterDeviceNotification() and WM_DEVICECHANGE; it tracks USB device insertion/removing good. But it does not track laptop's internal audio device enabling or disabling.</p>\n\n<p>Of course I can make timer and use waveInGetNumDevs/waveOutGetNumDevs.\nBut it is more interest to find way to force OS to send notifications :)</p>\n\n<p>Thank you :)</p>\n"},{"tags":["windows","winapi","visual-c++","hook","internals"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12971860,"title":"windows function table","body":"<p>Given any function address 0x12345678, how are strings related to the address stored ?\nStrings related to address are:\n1) return type\n2) calling convention\n3) function name\n4) parameter list</p>\n\n<p>All above strings make up complete function signature.\nWhenever we use dbghelp functions, we can retrieve the above strings separately.</p>\n\n<p>Does windows maintain any Internal Function table?</p>\n"},{"tags":["c++","winapi","visual-c++","data-binding","c++-cx"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12967071,"title":"Property Notification Changed equivalent in C++/CX bindings","body":"<p>In C#, I often created property getters that returned the result of a function call. This meant that I was required to trigger property change notifications manually using OnPropertyChanged. This process is well documented for C# and VB, but I can't seem to find a C++/CX equivalent. Does such a thing exist, or do I have to find a new programming pattern?</p>\n\n<p>Here's a basic example to show my issue:</p>\n\n<pre><code>public:\n    property int FooSquared {\n        int get() { return _calculateFooSquared(); }\n    }\n\nprivate:\n    int _foo;\n\n    int _calculateFooSquared() {\n        return _foo * _foo;\n    }\n\n    void _setNewFoo(int newFoo) {\n        // When _foo gets updated here, anyone bound to FooSquared\n        // needs to be updated. How do I trigger an update?\n        _foo = newFoo;\n    }\n</code></pre>\n"},{"tags":["c#",".net","winapi","usb","hid"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":1,"view_count":415,"score":4,"question_id":10178375,"title":"USB HID hangs on Read() in c#","body":"<p>I am trying to connect to a USB digital scale, The code does connect to the scale as <code>scale.IsConnected</code> comes true, but hangs on <code>scale.Read(250)</code> where 250 should be the timeout in milliseconds but it never return from Read<br></p>\n\n<p>I am using the code from <a href=\"https://github.com/mikeobrien/HidLibrary/issues/17\" rel=\"nofollow\">this</a> thread except one change which was due to the new version of <a href=\"https://github.com/mikeobrien/HidLibrary\" rel=\"nofollow\">Mike O Brien's HID Library</a></p>\n\n<pre><code>public HidDevice[] GetDevices ()\n    {\n      HidDevice[] hidDeviceList;\n\n\n      // Metler Toledo\n      hidDeviceList = HidDevices.Enumerate(0x0eb8).ToArray();\n      if (hidDeviceList.Length &gt; 0)\n    return hidDeviceList;\n\n      return hidDeviceList;\n    }\n</code></pre>\n\n<hr>\n\n<p>I managed to get the scale working, take a look at Mike's answer <a href=\"https://github.com/mikeobrien/HidLibrary/issues/17\" rel=\"nofollow\">here</a> </p>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12965531,"title":"Autostart and CurrentDirectory","body":"<p>I am very confused about the WindowsAPI function </p>\n\n<blockquote>\n  <p>GetCurrentDirectory</p>\n</blockquote>\n\n<p>When my application get's started from the autostart (HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run) the current directory is ALWAYS : %windir%\\system32</p>\n\n<p>Why is that?</p>\n"},{"tags":["c++","c","multithreading","winapi"],"answer_count":13,"favorite_count":30,"up_vote_count":61,"down_vote_count":0,"view_count":37006,"score":61,"question_id":331536,"title":"Windows threading: _beginthread vs _beginthreadex vs CreateThread C++","body":"<p>What's a better way to start a thread?</p>\n\n<p>I'm trying to determine what are the advantages/disadvantages of _beginthread, _beginthreadex and CreateThread.  All of these functions return a thread handle to a newly created thread, I already know that CreateThread provides a little extra information when an error occurs (it can be checked by calling GetLastError)... but what are some things I should consider when I'm using these functions?</p>\n\n<p>I'm working with a windows application, so cross-platform computability is already out of the question.</p>\n\n<p>I have gone through the msdn documentation and I just can't understand, for example, why anybody would decide to use _beginthread instead of CreateThread or vice versa.</p>\n\n<p>Cheers!</p>\n\n<p>Update:\nOK, thanks for all the info, I've also read in a couple of places that I can't call WaitForSingleObject() if I used _beginthread(), but if I call _endthread() in the thread shouldn't that work? What's the deal there?</p>\n"},{"tags":["c++","multithreading","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12954379,"title":"Synchronization output streams from different threads","body":"<p>I'm writing an app that writes to xml file some data from different threads. I try to synchronized it using Event core object, but in file I get wrong data. I get next result </p>\n\n<pre><code>&lt;file path=\"somePath\" /&gt;\n&lt;file path=\"somePath\" &lt;file path=\"somePath\" /&gt; /&gt;....\n</code></pre>\n\n<p>but I expect to get </p>\n\n<pre><code>&lt;file path=\"somePath\" /&gt;\n&lt;file path=\"somePath\" /&gt;\n&lt;file path=\"somePath\" /&gt;\n</code></pre>\n\n<p>See below my pseudo code. What wrong in it?</p>\n\n<pre><code>unsigned int WINAPI MyThread(void *p)\n{\n    std::wofstream outstr;\n    outstr.open(\"indexingtest.xml\", std::ios::app);\n    do\n    {\n        if(somePredicat1)\n        {\n            WaitForSingleObject(hEvent, INFINITE);\n            outstr &lt;&lt;\"&lt;file path=\\\"\"&lt;&lt; sFileName &lt;&lt; \"\\\"\\n\";\n            outstr &lt;&lt;\"\\tsize=\\\"\"&lt;&lt; fileSize &lt;&lt; \"\\\" /&gt;\\n\";           \n            ReleaseMutex(hMutex);\n        }\n         if(somePredicat3)\n         {\n             MyThread(sFileName);\n         }\n    }while(somePredicat2);\n    outstr.close();\n    FindClose( hSearch );\n    return 0;\n}\n\nint _tmain(int argc, TCHAR *argv[])\n{\n    hEvent = CreateEvent(NULL, TRUE, FALSE, NULL);\n    //hMutex = CreateMutex(NULL, FALSE, 0);\n    unsigned int ThreadID;\n    HANDLE hThread1 = (HANDLE)_beginthreadex(NULL, 0, MyThread, L\"D:\\\\*\", 0, &amp;ThreadID);\n    HANDLE hThread2 = (HANDLE)_beginthreadex(NULL, 0, MyThread, L\"C:\\\\*\", 0, &amp;ThreadID);\n    SetEvent(hEvent);\n    std::wcout &lt;&lt; \"\\a\" &lt;&lt; std::endl;\n    WaitForSingleObject( hThread1, INFINITE );\n    return 0;\n}\n</code></pre>\n\n<p>More concrete code</p>\n\n<pre><code>HANDLE hMutex = CreateMutex(NULL,FALSE, 0);\nwchar_t** GetAllFilesImpl( wchar_t const* folder, wchar_t** res, size_t* pAllocated, size_t* pUsed )\n{\n    HANDLE hSearch;\n    WIN32_FIND_DATAW fileinfo;\n    size_t allocatedMemory = 0;\n\n\n    hSearch = FindFirstFileW( folder, &amp;fileinfo );\n    if( hSearch != INVALID_HANDLE_VALUE ) {\n        do {\n\n            wchar_t* sFileName, ** tmp, sTmp[ 1024 ];\n            long fileSize = 0;\n            long creationDate;\n            /* ignore ., .. */\n            if( !wcscmp(fileinfo.cFileName, L\".\") ||\n                !wcscmp(fileinfo.cFileName, L\"..\") )\n                continue;\n            sFileName = PathCreator( folder, fileinfo.cFileName );\n            fileSize = fileinfo.nFileSizeLow;\n            creationDate = fileinfo.ftCreationTime.dwHighDateTime;\n\n\n            if(fileSize)\n            {\n                WaitForSingleObject(hMutex, INFINITE);\n                std::wofstream outstr;\n                            outstr.open(\"indexingtest.xml\", std::ios::app);\n                outstr.seekp(std::ios_base::end);\n                outstr &lt;&lt;\"&lt;file path=\\\"\"&lt;&lt; sFileName &lt;&lt; \"\\\"\\n\";\n                outstr &lt;&lt;\"\\tsize=\\\"\"&lt;&lt; fileSize &lt;&lt; \"\\\" /&gt;\\n\";\n                outstr.seekp(std::ios_base::end);\n                outstr.close();\n                wprintf( L\"%s\\n\", sFileName);\n                ReleaseMutex(hMutex);\n            }\n\n            tmp = AddToArray( res, pAllocated, pUsed, sFileName );\n            if( !tmp ) return FreeAllFilesMemory(res), NULL;\n            res = tmp;\n\n            if( fileinfo.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY ) {\n                wcscpy_s( sTmp, sFileName );\n                wcscat_s( sTmp, L\"\\\\*\" );\n                tmp = GetAllFilesImpl( sTmp, res, pAllocated, pUsed );\n                if( !tmp ) return NULL;\n                res = tmp;\n            }\n        } while( FindNextFileW(hSearch, &amp;fileinfo) );\n\n        FindClose( hSearch );\n    }\n    return res;\n}\n\nunsigned int WINAPI GetAllFiles( void* folder )\n{\n    size_t nAllocated = 0, nUsed = 0;\n    wchar_t** res = GetAllFilesImpl( (wchar_t *)folder, NULL, &amp;nAllocated, &amp;nUsed );\n    if( res ) {\n        /* to indicate end of result add a NULL string */\n        wchar_t** tmp = AddToArray( res, &amp;nAllocated, &amp;nUsed, NULL );\n        if( !tmp ) return FreeAllFilesMemory(res), -1;\n        res = tmp;\n    }\n    std::wcout &lt;&lt; \"\\a\" &lt;&lt; std::endl;\n    return 0;\n}\nint _tmain(int argc, TCHAR *argv[])\n{\n\n    Sleep(1000);\n    unsigned int ThreadID;\n    HANDLE hThreads[3];\n    hThreads[0] = (HANDLE)_beginthreadex(NULL, 0, GetAllFiles, L\"D:\\\\*\", 0, &amp;ThreadID);\n    hThreads[1] = (HANDLE)_beginthreadex(NULL, 0, GetAllFiles, L\"C:\\\\Users\\\\Andrew\\\\Desktop\\\\*\", 0, &amp;ThreadID);\n    hThreads[2] = (HANDLE)_beginthreadex(NULL, 0, GetAllFiles, L\"E:\\\\*\", 0, &amp;ThreadID);\n    unsigned int dw = WaitForMultipleObjects(3, hThreads, TRUE, INFINITE);\n    CloseHandle(hFile);\n    printf(\"finished\\n\");\n    return 0;\n}\n</code></pre>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12954796,"title":"shell_notifyicon : an attempt was made to reference a token that does not exist, no icon shown","body":"<p>I see notification balloon, but no icon is shown. And after successfull ( TRUE is returned )call to Shell_NotifyIcon there is a windows error : an attempt was made to reference a token that does not exist. Main question is why I do not see an icon? Windows 7 is used with the latest updates.</p>\n\n<p>Here is a code snippet:</p>\n\n<pre><code>namespace tray_tip\n{\n#define FINAL_INIT( tip, title, ic, icon_id, inst )\\\n    if ( icon )\\\n    {\\\n        static const GUID myGUID = \\\n        {0x23977b55, 0x10e0, 0x4041, {0xb8, 0x62, 0xb1, 0x95, 0x41, 0x96, 0x36, 0x69}};\\\n        data.guidItem = myGUID;\\\n        data.dwInfoFlags |= NIF_ICON;\\\n        ExtractIconEx( _T(\"task_dialog_test.ico\"), 0, NULL, &amp;(data.hIcon), 1 );\\\n    }\\\n    data.dwInfoFlags |= ic;\\\n    _tcscpy_s( data.szInfo, tip );\\\n    _tcscpy_s( data.szInfoTitle, title );\n\n    static NOTIFYICONDATA data = {0};\n    inline void init( HWND const &amp; parent, UINT const &amp; msg_id, UINT const &amp; time_out = 30 )\n    {\n        ULONGLONG ullVersion = GetDllVersion( _T( \"Shell32.dll\" ) );\n        if ( ullVersion &gt; MAKEDLLVERULL ( 6,0,0,0 ) )\n            data.cbSize = sizeof ( NOTIFYICONDATA );\n        else if ( ullVersion == MAKEDLLVERULL( 6,0,0,0 ) )\n            data.cbSize = sizeof( NOTIFYICONDATA_V3_SIZE );\n        else if ( ullVersion &gt;= MAKEDLLVERULL( 5,0,0,0 ) )\n            data.cbSize = NOTIFYICONDATA_V2_SIZE;\n        else \n            data.cbSize = NOTIFYICONDATA_V1_SIZE;\n        data.hWnd = parent;\n        data.uFlags = NIF_INFO | NIF_MESSAGE;// | NIF_SHOWTIP;\n        data.uCallbackMessage = msg_id;\n        data.uTimeout = time_out;\n    }\n    inline BOOL show( BOOL show = FALSE, TCHAR tip[256] = _T(\"\"), TCHAR title[64] = _T(\"\"), DWORD const &amp; ic = NIIF_INFO, UINT const &amp; icon = 0, HINSTANCE const &amp; inst_h = NULL )\n    {\n        FINAL_INIT( tip, title, ic, icon, inst_h );\n        return Shell_NotifyIcon( show == TRUE ? NIM_ADD : NIM_DELETE, &amp;data ); // function checks if version can be changed if it was preset.\n    }\n}\n</code></pre>\n"},{"tags":["winapi","xaml","windows-8","unhandled-exception"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":305,"score":3,"question_id":11880611,"title":"Win8 - Unhandled exception in Windows.UI.Xaml.dll","body":"<p>I've got some strange behavior while debugging/running my metro app.\nDuring drag'n'drop the screen will be refreshed. I'd added some functionality to block binded properties from refreshing while drag'n'drop is in progress.</p>\n\n<p>But sometimes the app crash, but in stead of throwing some exception which I can debug, all I got is an window saying to open an external just-in-time-debugger\n\" *An unhandled win32 exception occurred in SOME_APP.exe [7785]* \".\n(The external debugger does not bring more information)</p>\n\n<p>And the output says:\n\" *Unhandled exception at 0x05017145 (Windows.UI.Xaml.dll) in SOME_APP.exe: 0xC0000005: Access violation reading location 0x00000088.* \"</p>\n\n<p>I'm working on a x64 device.\nHas somebody ever heard of such problem?</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":399,"score":2,"question_id":8664792,"title":"undefined reference to `TextOutA@20'","body":"<p>I am kind of stuck on this and would appreciate help in solving this please. I am using window GDI, and according to this link, including windows.h is what is needed to work with the TextOut function, among others, but I am still getting some undefined reference error messages and I am stuck.</p>\n\n<p>**undefined reference to `TextOutA@20'|</p>\n\n<p>undefined reference to `CreateDCA@16'|</p>\n\n<p>undefined reference to `Escape@20'|  </p>\n\n<p>undefined reference to `DeleteDC@4'|**</p>\n\n<pre><code>#include &lt;Windows.h&gt;// HDC is a typedef defined in the windows.h library\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;fstream&gt;\n#include &lt;strstream&gt;\n#include &lt;string.h&gt;\nusing namespace std;\n\n#define IDM_QUIT 102\n#define EXAMPLE 101\n#define IDM_PRINT  27\n#define IDM_SHOW 1\n\n//this excerpt demonstrates how to get the handle to a device context ysing the BegingPaint() GDI function\nlong FAR PASCAL _export WINDOWPROCEDURE(HWND hwnd, UINT message, UINT wParam, LONG Param)\n{\n    HDC hdc;\n    PAINTSTRUCT ps;\n    RECT area;\n    char PInfo[80]=\"\";\n    char DriverName[20];\n    char DeviceName[40];\n    char Other[20];\n    int X,Y;\n    X=100;\n    Y=100;\n\n    switch(message)\n    {\n        case WM_PAINT:\n        hdc = BeginPaint(hwnd, &amp;ps);\n        TextOut(hdc,X,Y, \"Speed of Light\", 14);\n        EndPaint(hwnd, &amp;ps);\n\n        case IDM_SHOW:\n        hdc = GetDC(hwnd);\n        TextOut(hdc, X,Y, \"Speed of Light\", 14);\n        ReleaseDC(hwnd, hdc);\n\n        case IDM_PRINT:\n        GetProfileString(\"windows\", \"device\", \"\", PInfo,80);\n        istrstream In(PInfo);\n        In.getline(DeviceName, 80, ',');\n        In.getline(DriverName, 80, ',');\n        In.getline(Other,80, ',');\n        hdc = CreateDC(DriverName, DeviceName, Other, NULL);\n        Escape(hdc,\n               STARTDOC,8,\n               (LPSTR)\"EXAMPLE\",0L);\n        TextOut(hdc, X, Y, \"Speed of Light\", 14);\n        Escape(hdc, NEWFRAME, 0,0L, 0L);\n        Escape(hdc, ENDDOC, 0,0L, 0L);\n        DeleteDC(hdc);\n    }\n\n    return 0;\n}\n</code></pre>\n"},{"tags":["c++","winapi","windows-update"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":49,"score":0,"question_id":12949018,"title":"Windows Update Agent pure win32 APIs","body":"<p>I'm developing a sample code to get information about the Windows Updates Monitoring.\nI bumped into Windows Update Agent APIs. link: <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa387099(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/aa387099(v=vs.85).aspx</a></p>\n\n<p>But I'm not able to find any APIs for win32. I find only C#/.NET Interfaces.\nAre there any corresponding win32 APIs?</p>\n\n<p>Specifically I want to find out the \"release date\" of a windows update/patch.\nLook forward to any suggestions and guidance.</p>\n\n<ul>\n<li>Srivathsa</li>\n</ul>\n"},{"tags":["winapi","mfc","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12957839,"title":"EnumWindows strange behaviour","body":"<p>I am trying to use MFC with visual Studio 2012 on Windows 8.\nI have the following code:</p>\n\n<pre><code>BOOL CALLBACK EWP(HWND hwnd, LPARAM lParam)\n{\n    int txtlen = GetWindowTextLengthW(hwnd);\n    std::wstring s;\n    s.reserve(txtlen + 1);\n    GetWindowText(hwnd, const_cast&lt;wchar_t*&gt;(s.c_str()), txtlen);\n\n    return TRUE;\n}\n\nEnumWindows(EWP, 0);\n</code></pre>\n\n<p>What happens is that the very first string comes out as \"Task Switchin\" and the rest come out as \"\". I get about 330 of these strings. I have tried without using that weird string method too with just char buff[300], same story.</p>\n\n<p>Can someone please tell me whats going on?</p>\n"},{"tags":["winapi","capture","keystroke"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12885897,"title":"Block keystrokes from a specific keyboard","body":"<p>I would like to block all keystrokes that are coming from a specific keyboard (identified by its HID/Name, so its low level stuff I guess) before they reach the focused application. But I'm still using this disabled keyboard (I'm getting the keystrokes). I think I need an application's hook but I don't know how to do that. Maybe you can give me some useful link?</p>\n\n<p>Regards,</p>\n\n<p>EDIT:</p>\n\n<p>I think I need a low-level hook, because general hook (I mean hook all the existing window &amp; threads) aren't available in the .net framework, concerning the user-space.\nMoreover, I use RAWINPUT to get typed keystrokes from the keyboard. So if I make a hook to block keystroke from a specific device, could the hook block the RAWINPUT as well?</p>\n"},{"tags":["c++","windows","winapi","serial-port","citrix"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":95,"score":3,"question_id":12953075,"title":"What does error 112 (disk full) mean while writing on a serial port?","body":"<p>I'm getting a write error when writing to a serial port (COM1) on a Windows machine. The returned error is a 112 (DISK_FULL). As this is a serial port I don't get what the error means. </p>\n\n<p>Could it be that the buffer is full? I don't think so as I'm getting the error on the first request I send after opening the port.</p>\n"},{"tags":["windows","winapi","win32-process"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":12956912,"title":"isZoomed() functionality is not working in my client code","body":"<p>i wanted to know whether mstsc(RDP) window maximized or not from my client application.\nso i'm using :</p>\n\n<p>IsZoomed(handle of mstsc); but i'm always getting zero as return value even if i maximized the window ?</p>\n\n<p>How do i solve this problem ... ?</p>\n"},{"tags":["javascript","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12952655,"title":"Run javascript in winapi","body":"<p>I have a very simple js file:</p>\n\n<pre><code>function geoip_country_code() { return 'US'; }\nfunction geoip_country_name() { return 'United States'; }\nfunction geoip_city()         { return 'New York'; }\nfunction geoip_region()       { return '06'; }\nfunction geoip_region_name()  { return 'xxx'; }\nfunction geoip_latitude()     { return '55'; }\nfunction geoip_longitude()    { return '99'; }\nfunction geoip_postal_code()  { return ''; }\nfunction geoip_area_code()    { return ''; }\nfunction geoip_metro_code()   { return ''; }\n</code></pre>\n\n<p>I would like to call <code>geoip_country_code</code> from a win32 code. Is it even possible?</p>\n"},{"tags":["c++","winapi","registry"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":62,"score":1,"question_id":12954927,"title":"C++ Read a Registry String Value in char*","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6222583/how-to-compare-strings\">How to compare strings</a>  </p>\n</blockquote>\n\n\n\n<p><br>I want to Compare to registry string values and if they were the same an messagebox appears\n<br>Currently I'm using this functions , It returns the value correctly but whenever I want to compare them, The compare result is always wrong\n<br></p>\n\n<pre><code>char* GetRegistry(char* StringName)\n{\nDWORD dwType = REG_SZ;\nHKEY hKey = 0;\nchar value[1024];\nDWORD value_length = 1024;\nconst char* subkey = \"SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\MCI\\\\Player\";\nRegOpenKey(HKEY_LOCAL_MACHINE,subkey,&amp;hKey);\nRegQueryValueEx(hKey, StringName, NULL, &amp;dwType, (LPBYTE)&amp;value, &amp;value_length);\nreturn  value;\n}\n</code></pre>\n\n<p><BR>I use this to compare them</p>\n\n<pre><code>if (GetRegistry(\"First\") == GetRegistry(\"Second\"))\n{\nMessageBox(NULL,\":|\",\":|\",1);\n}\n</code></pre>\n\n<p><br> But the MessageBox appears how ever The values are different</p>\n\n<p><br>Any help is appreciated.</p>\n"},{"tags":["delphi","winapi","delphi-2009"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":100,"score":1,"question_id":12954545,"title":"Strange WM_CHAR behaviour (wrong chCharCode)","body":"<p>I need to automate entering a certain character (Russian letter <code>Э</code>). In Spy++ the corresponding message looks like this:</p>\n\n<p><code>WM_CHAR chCharCode: '221' (221) cRepeat:1 ScanCode:28 fExtended:0 fAltDown:0 fRepeat:0 fUp:0</code></p>\n\n<p><img src=\"http://i.stack.imgur.com/3ZIMR.png\" alt=\"enter image description here\"></p>\n\n<p>In order to send this message programmatically, I use this Delphi code:</p>\n\n<p><code>SendMessage(Self.PassengerGrid, WM_CHAR, WPARAM(221), LPARAM($280001));</code></p>\n\n<p>When I examine the results of running my code in Spy++, I see following message:</p>\n\n<p><code>WM_CHAR chCharCode: '89' (89) cRepeat:1 ScanCode:28 fExtended:0 fAltDown:0 fRepeat:0 fUp:0</code></p>\n\n<p>Something must be wrong with <code>wParam</code> of my <code>SendMessage</code> call.</p>\n\n<p>How can I fix it (so that the <code>chCharcode</code> is equal to <code>221</code>)` ?</p>\n\n<p><strong>Update 1:</strong></p>\n\n<ul>\n<li>The machine, where this error occurs, has two keyboard languages - English and Russian.</li>\n<li><p>I noticed that when the following code </p>\n\n<p>SendMessage(MyGridHandle, WM_KEYDOWN, VK_OEM_7, LPARAM($390000));\nSendMessage(MyGridHandle, WM_CHAR, WPARAM(221), LPARAM($280001));\nSendMessage(MyGridHandle, WM_KEYUP, VK_OEM_7, LPARAM($c0390001));</p></li>\n</ul>\n\n<p>is executed, the selected language (according to tray icon) changes from Russian to English.</p>\n\n<ul>\n<li>Whatever character I transmit in WM_CHAR, <code>WPARAM</code> of the message is always <code>0x59</code> (<code>89</code>).</li>\n</ul>\n\n<p><strong>Update 2:</strong> Using <code>WM_UNICHAR</code> instead of <code>WM_CHAR</code> doesn't help.</p>\n"},{"tags":["c#","winapi","keyboard","keyboard-hook"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":93,"score":1,"question_id":12951067,"title":"How to determine the current input language?","body":"<p>I am designing an on screen keyboard,</p>\n\n<p>I need to determine which language been set by the user and which language he is using now in the other threads,</p>\n\n<p>i.e. I need to know the language selected in the taskbar language switcher:</p>\n\n<p><img src=\"http://i.stack.imgur.com/yhCDC.jpg\" alt=\"language switcher\"></p>\n\n<p>P.S. current culture returns the language used in the on screen keyboard application, which is not the case I am looking for..</p>\n"},{"tags":["winapi","powershell","powershell-v2.0"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12954077,"title":"SetForegroundWindow, AllowSetForegroundWindow & LockSetForegroundWindow","body":"<p>With a powershell code I try to change the position of a window (is works correctly) and put this windows \"Always on top\".</p>\n\n<p>Please find below my code:</p>\n\n<pre><code>Import-Module C:/install/WASP/wasp.dll\n\nAdd-Type @\"\n  using System;\n  using System.Runtime.InteropServices;\n  public class SFW {\n     [DllImport(\"user32.dll\")]\n     [return: MarshalAs(UnmanagedType.Bool)]\n     public static extern bool SetForegroundWindow(IntPtr hWnd);\n  }\n\"@\n\n\nAdd-Type @\"\n  using System;\n  using System.Runtime.InteropServices;\n  public class Tricks {\n    [DllImport(\"user32.dll\")]\n    public static extern IntPtr GetForegroundWindow();\n}\n\"@\n\nAdd-Type @\"\n  using System;\n  using System.Runtime.InteropServices;\n  public class allowFor {\n    [DllImport(\"user32.dll\")]\n     [return: MarshalAs(UnmanagedType.Bool)]\n     public static extern bool AllowSetForegroundWindow(IntPtr hWnd);\n}\n\"@\n\n\nAdd-Type @\"\n  using System;\n  using System.Runtime.InteropServices;\n  public class lockFor {\n    [DllImport(\"user32.dll\")]\n     [return: MarshalAs(UnmanagedType.Bool)]\n     public static extern bool LockSetForegroundWindow(IntPtr hWnd);\n}\n\"@\n\n\n\n\ndo\n{\n    Start-Sleep -m 3000\n    $allWindow = Select-Window Perso*\n    if($allWindow)\n    {\n        foreach ($currentWindow in $allWindow) \n        {\n            $positionWindow = WindowPosition $currentWindow\n            foreach ($currentPosition in $positionWindow) \n            {\n                #Loop on each windows\n                if ( $currentWindow.title -match \"\\([0-9]*\\)#\" )\n                {\n                    # Retrieve windows ID\n                    $id = $currentWindow.title.Substring($currentWindow.title.IndexOf(\"(\")+1, $currentWindow.title.IndexOf(\")\")-$currentWindow.title.IndexOf(\"(\")-1)\n                    $allHUDWindow = Select-Window * | where {$_.Title -match \"\\($id\\).*.txt\"}\n\n                    if($allHUDWindow)\n                    {\n                        foreach ($currentHUDWindow in $allHUDWindow) \n                        {\n                            $currentForgr = [Tricks]::GetForegroundWindow()\n                            if ( ($currentForgr -match $currentWindow.Handle -or  $currentForgr -match $currentHUDWindow.Handle) )\n                            {\n                                write-host \"Pus currentHUDWindow in Front\"\n\n\n                                $hud =  (get-process -Id $currentHUDWindow.ProcessId).MainWindowHandle\n\n                                [allowFor]::AllowSetForegroundWindow(-1)\n                                [SFW]::SetForegroundWindow($hud)\n\n                                #Modification de la position\n                                Set-WindowPosition -X ($currentPosition.x-10) -Y ($currentPosition.y-30) -WIDTH ($currentPosition.width+20) -HEIGHT ($currentPosition.height+30) -Window $currentHUDWindow          \n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n} while(1)\n</code></pre>\n\n<p>But :</p>\n\n<pre><code>                                [allowFor]::AllowSetForegroundWindow(-1)\n                                [SFW]::SetForegroundWindow($hud)\n</code></pre>\n\n<p>return me False.</p>\n\n<p>From the documentation:</p>\n\n<pre><code>An application cannot force a window to the foreground while the user is working with another window. Instead, Windows flashes the taskbar button of the window to notify the user.\n</code></pre>\n\n<p>Do you know how can I force $currentHUDWindow to move in front ? And not only flashes the taskbar button ?</p>\n\n<p>Thanks for your help</p>\n"},{"tags":["c++","winapi","visual-c++","mfc","window"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12953607,"title":"How to find handle to a mfc control at mouse point but lie under other control?","body":"<p>I want find control handle lie under other when mouse over, but it only found control above (use <code>WindowFromPoint</code>, <code>ChildWindowFromPoint</code> , etc does not work). </p>\n\n<p>Any suggestion?</p>\n"},{"tags":["c++","winapi","mfc","timer"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":12953425,"title":"Is it safe to use c++ KillTimer() in middle of timer's execution?","body":"<p>What will be the effect on a working timer, when during its execution, a <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms644903.aspx\" rel=\"nofollow\"><code>KillTimer()</code></a> command is sent?</p>\n\n<p>Just to make sure, a working timer means that the timer executes its code. </p>\n\n<p>Thanks for your help!</p>\n"},{"tags":["c++","string","winapi","visual-c++","c++-cx"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":113,"score":1,"question_id":12951815,"title":"platform::string Functions in Windows 8/RT C++","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12533883/platformstring-is-kind-of-useless\">Platform::String is kind of useless</a>  </p>\n</blockquote>\n\n\n\n<p>I'm new to Windows development and the new Visual C++ APIs are driving me nuts. I've most recently run into a seeming lack of string functions. Are there basic functions available such as:</p>\n\n<ul>\n<li>substring</li>\n<li>strpos or similar</li>\n<li>regular expressions</li>\n</ul>\n\n<p>My ultimate goal is to take a file path such as \"C:\\foo\\bar\\baz.jpg\" and extract the deepest directory. In this example, I'm looking for \"bar\".</p>\n\n<p>Perhaps of a greater concern, I've found that it's incredibly difficult to find current documentation for Win 8 APIs. What's the best place to look for questions like this?</p>\n"},{"tags":["c++","winapi","compiler-errors","return-value","delay-load"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12952267,"title":"Use delay load to load correct library - return value type error","body":"<p>I used msdn documentation here: <a href=\"http://msdn.microsoft.com/en-us/library/f0fkfy9y(v=vs.100).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/f0fkfy9y(v=vs.100).aspx</a></p>\n\n<p>It specifies there that:</p>\n\n<pre><code>case dliNotePreLoadLibrary :\n//If you want to return control to the helper, return 0.\n//Otherwise, return your own HMODULE to be used by the \n//instead of having it call LoadLibrary itself\n</code></pre>\n\n<p>So I tried the following:</p>\n\n<pre><code>FARPROC WINAPI delayHook(unsigned dliNotify, PDelayLoadInfo pdli)\n{\n    switch (dliNotify) {\n        case dliStartProcessing :\n        case dliNotePreGetProcAddress :\n        case dliFailLoadLib :\n        case dliFailGetProc :\n        case dliNoteEndProcessing : \n          return 0;\n          break;\n        case dliNotePreLoadLibrary :\n            {\n                char* dllPath = getDllPath();\n                HMODULE lib = LoadLibrary(dllPath);\n                return lib;\n            }\n            break;      \n        default :\n            return NULL;\n    }\n    return NULL;\n}\n</code></pre>\n\n<p>I get error for returning the HMODULE: </p>\n\n<blockquote>\n  <p>'return' : cannot convert from 'HMODULE' to 'FARPROC'.</p>\n</blockquote>\n\n<p>What is the problem? Am I doing something worng? they do say return your own HMODULE, and that is what I did...     </p>\n"},{"tags":["c++","visual-studio","winapi","error-handling"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":2,"view_count":87,"score":0,"question_id":12951508,"title":"GetLastError() != oddity","body":"<p>As part of my C++ project, I'm using a file-managing struct with the WinAPI file management functions.\nWhen searching for a temporary file name, I have a function <code>OpenNewTempFile()</code> which will generate a name, attempt to open it via calling another function in the struct, simply <code>OpenFile()</code>, and if the file already exists, retry with a different name silently (and infinitely as it loops).\nThis is <code>OpenFile()</code>, and it should only report file-already-exists errors if it's not opening as a temporary file.</p>\n\n<p><img src=\"http://i.stack.imgur.com/sz3D4.png\" alt=\"GetLastError() oddity\"></p>\n\n<p>Can someone explain why the <code>if</code> block is executing? The second part of <code>&amp;&amp;</code> shouldn't be true.\nYou can see the current variables in the VS dock below when the block is hit, and what <code>GetLastError()</code> returns in the console window above. This is confusing me to bits.</p>\n\n<p>EDIT:\nDue to suggestions, I've stored GetLastError in a variable.</p>\n\n<p><img src=\"http://i.stack.imgur.com/SLnhx.png\" alt=\"Snap with GetLastError() stored\"></p>\n\n<p>...well, that just raises more questions. Why is it now 80?</p>\n"},{"tags":["delphi","winapi","delphi-2009"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":105,"score":2,"question_id":12950920,"title":"Simulating keyboard input in Delphi using WinAPI","body":"<p>I need to programmatically enter one character into a cell of a Delphi grid (in other application).</p>\n\n<p>In order to do this manually, following steps are required:</p>\n\n<ol>\n<li>Press the F3 button.</li>\n<li>Press the right-arrow key 3 times.</li>\n<li>Press the space button.</li>\n<li>Type letter 'E' on the keyboard.</li>\n<li><p>Press the right-arrow key.</p>\n\n<pre><code> // Press F3 button         \n keybd_event(VK_F3, 0, 0, 0);         \n // Press right arrow key 3 times\n keybd_event(VK_RIGHT, 0, 0, 0);\n keybd_event(VK_RIGHT, 0, 0, 0);\n keybd_event(VK_RIGHT, 0, 0, 0);\n\n // Press the space button\n keybd_event(VK_SPACE, 0, 0, 0);\n\n // Type letter E\n keybd_event(Ord('E'), 0, 0, 0);\n\n // Move to the right\n keybd_event(VK_RIGHT, 0, 0, 0);\n</code></pre></li>\n</ol>\n\n<p>But it doesn't work. When I run this code, nothing seems to happen.</p>\n\n<p>How should I modify this code so that it actually simulates user input?</p>\n"},{"tags":["c#","c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":70,"score":3,"question_id":12949937,"title":"SetFilePointer does not fail, but also does not move pointer","body":"<p>First, please forgive me if I say something silly, I am no IT guy but electronics engineer, but I have been assigned to something that needs more skills that I do.</p>\n\n<p>I need to write and read physical sectors in a SD card. I have accomplished it in C++, but the main application is written in C#, so I thought that it was a good moment to write my first dll.</p>\n\n<p>Here is the code working in c++ for writing a sector.</p>\n\n<pre><code>private: System::Void button4_Click(System::Object^  sender, System::EventArgs^  e) {\nHANDLE hFile   = INVALID_HANDLE_VALUE;\n    BOOL fSuccess  = FALSE;\n\n\n    DWORD dwBytesWritten = 0; \n\n    unsigned char  chBuffer[SIZE]; \n\n    long SectorActual = 39;\n    long PosicionInicio = SectorActual * 512;\n\n        for (int i=0; i&lt;SIZE; i++) // Garbage values to be written\n        {\n            chBuffer[i]= i % 16;\n            if((i/16)%2==0)\n            {\n                chBuffer[i]= 15 - chBuffer[i];\n            }\n        }\n        hFile = CreateFileA(\"\\\\\\\\.\\\\PhysicalDrive5\",GENERIC_READ|GENERIC_WRITE,0,NULL,OPEN_EXISTING,FILE_ATTRIBUTE_NORMAL,NULL);\n\n        if (hFile == INVALID_HANDLE_VALUE) \n        { \n            textBox1-&gt;Text += \"Could not open file (error \" + GetLastError() + \") \\r\\n\";\n            return; \n        }\n\n        DWORD dwPtr = SetFilePointer( hFile, \n                                PosicionInicio, \n                                NULL, \n                                FILE_BEGIN ); \n\n        if (dwPtr == INVALID_SET_FILE_POINTER) // Test for failure\n        { \n            textBox1-&gt;Text += \"Error moving pointer (error \" + GetLastError() + \") \\r\\n\";\n            return;     // Deal with failure \n        } // End of error handler \n\n        fSuccess = WriteFile(hFile, chBuffer, TAMANYO_SECTOR, &amp;dwBytesWritten, NULL); \n        if (!fSuccess) \n        {\n            textBox1-&gt;Text += \"WriteFile failed\\r\\n\";\n        }\n        else\n        {\n            textBox1-&gt;Text += \"WriteFile wrote \" + dwBytesWritten.ToString() + \" bytes\\r\\n\";\n        }\n\n        CloseHandle(hFile);\n    }\n</code></pre>\n\n<p>Then I made the DLL. Function is this:</p>\n\n<pre><code> int AccesoBajoNivel::EscribeBloqueFisico(char numeroDisco, unsigned char * buffer, long      BytesQueEscribir, long posicion_inicio)\n{\n    HANDLE hFile   = INVALID_HANDLE_VALUE;\n            BOOL fSuccess  = FALSE;\n    DWORD dwBytesWritten = 0; \n\n    char ArrayDeChars[] = \"\\\\\\\\.\\\\PhysicalDrive5\";\n            ArrayDeChars[17] = numeroDisco;\n    LPCSTR pathAlDisco = ArrayDeChars;\n\n    hFile = CreateFileA(pathAlDisco,GENERIC_READ|GENERIC_WRITE,0,NULL,OPEN_EXISTING,FILE_ATTRIBUTE_NORMAL,NULL);\n\n    if (hFile == INVALID_HANDLE_VALUE) \n    { \n        //printf(\"Could not open file (error %d)\\n\", GetLastError());\n        CloseHandle(hFile);\n        return -1; \n    }\n\n    DWORD dwPtr = SetFilePointer( hFile, \n                            posicion_inicio, \n                            NULL, \n                            FILE_BEGIN ); \n\n    if (dwPtr == INVALID_SET_FILE_POINTER) // Test for failure\n    { \n        CloseHandle(hFile);\n        return -2;     // Deal with failure \n    } // End of error handler \n\n    fSuccess = WriteFile(hFile, buffer, BytesQueEscribir, &amp;dwBytesWritten, NULL); \n    if (!fSuccess) \n    {\n        CloseHandle(hFile);\n        return -3;\n    }\n    else\n    {\n        CloseHandle(hFile);\n        //return dwBytesWritten;\n        return dwPtr;\n    }\n\n    CloseHandle(hFile);\n}\n</code></pre>\n\n<p>Then I imported in the C# project:</p>\n\n<pre><code>[DllImport(\"AccesoBajoNivel.dll\", CallingConvention = CallingConvention.Cdecl)]\nstatic extern int EscribeBloqueFisico(char numeroDisco, byte[] buffer, long BytesQueEscribir, long posicion_inicio);\n</code></pre>\n\n<p>Then I call the function:</p>\n\n<pre><code>int ResultEscribir = EscribeBloqueFisico(numeroDiscoFisico, BufferEscritura, 512, SectorEscribir * 512);\n</code></pre>\n\n<p>Always writes to the first sector, no matter the value of \"posicion_inicio\" (Is the start offset, sorry about the spanish tags) So that's why I changed the writing function in the api to return dwPtr (Result of SetFilePointer) instead of bytes written. This always seems to be zero, which is obviously not what I want. But can't find why the first function works and the dll call don't.</p>\n\n<p>Maybe is something that should be seen at first glance, but as I said, I am electronics guy, not used to this kind of programming... </p>\n\n<p>Other functions (As reading DISK_GEOMETRY or VOLUME_DISK_EXTENTS) work, which I use to determine which Physical Drive is a given logical unit. As I say, also, writing and reading work well, it's just that I am always pointing to sector zero...</p>\n\n<p>Thanks in advance. Also, this is the first time I post here. Readed many times (That is why I chosed to ask here) but if I made some mistake when posting the question, please point it out.</p>\n"},{"tags":["windows","winapi","visual-c++","console-application","wmic"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12889989,"title":"System Settings for WUA API to Work","body":"<p>In order to leverage the WUA API in any windows machine, Could someone please let me know what are the settings that should be enabled or disabled on a windows box, so that any code written using WUA API works properly?</p>\n\n<p>I have tried the code written in Visual C++ (created a win32 console application) on Windows XP, Vista, Windows 2008 and below are the results</p>\n\n<ol>\n<li>Windows XP 64 bit - WMIC QFE GET is returning more results than WUA API</li>\n<li>Windows Vista - WUA API is not returning any results</li>\n<li>Windows 2008 Server - WUA API is returning more results that WMIC QFE GET</li>\n</ol>\n\n<p><strong>EDIT:</strong>\nAdded Sample source code:</p>\n\n<pre><code>#include &lt;wuapi.h&gt;\n#include &lt;iostream&gt;\n#include &lt;wuerror.h&gt;\n\nusing namespace std;\n\n\nint main()\n{\n\n    HRESULT hr;\n    hr = CoInitialize(NULL);\n\n    IUpdateSession* iUpdate;\n    IUpdateSearcher* searcher;\n    ISearchResult* results;\n    BSTR criteria = SysAllocString(L\"IsInstalled=1 or IsHidden=1 or IsPresent=1\");\n\n    hr = CoCreateInstance(CLSID_UpdateSession, NULL, CLSCTX_INPROC_SERVER,\n        IID_IUpdateSession, (LPVOID*)&amp;iUpdate);\n    hr = iUpdate-&gt;CreateUpdateSearcher(&amp;searcher);\n\n    wcout &lt;&lt; L\"Searching for updates ...\"&lt;&lt;endl;\n    hr = searcher-&gt;Search(criteria, &amp;results);\n    SysFreeString(criteria);\n\n    switch(hr)\n    {\n    case S_OK:\n        wcout&lt;&lt;L\"List of applicable items on the machine:\"&lt;&lt;endl;\n        break;\n    case WU_E_LEGACYSERVER:\n        wcout&lt;&lt;L\"No server selection enabled\"&lt;&lt;endl;\n        return 0;\n    case WU_E_INVALID_CRITERIA:\n        wcout&lt;&lt;L\"Invalid search criteria\"&lt;&lt;endl;\n        return 0;\n    }\n\n    IUpdateCollection * updateList;\n    IUpdate *updateItem;\n    LONG updateSize;\n    BSTR updateName;\n\n    results-&gt;get_Updates(&amp;updateList);\n    updateList-&gt;get_Count(&amp;updateSize);\n\n    if (updateSize == 0)\n    {\n        wcout &lt;&lt; L\"No updates found\"&lt;&lt;endl;\n    }\n\n    for (LONG i = 0; i &lt; updateSize; i++)\n    {\n        IStringCollection *KBCollection;\n        LONG KBCount;\n        updateList-&gt;get_Item(i, &amp;updateItem);\n        updateItem-&gt;get_KBArticleIDs(&amp;KBCollection);\n        KBCollection-&gt;get_Count(&amp;KBCount);\n        for(int i=0;i&lt;KBCount;i++)\n        {\n            BSTR KBValue;\n            KBCollection-&gt;get_Item(i,&amp;KBValue);\n            wcout &lt;&lt; L\"KB\" &lt;&lt; KBValue &lt;&lt; endl;\n        }\n\n        //Retrieve the bundled updates\n        IUpdateCollection *updtCollection;\n        updateItem-&gt;get_BundledUpdates(&amp;updtCollection);\n        LONG updtBundledCount;\n        updtCollection-&gt;get_Count(&amp;updtBundledCount);\n        for(LONG j=0;j&lt;updtBundledCount;j++)\n        {\n            cout&lt;&lt;\"Bundled KBs\" &lt;&lt;endl;\n            IUpdate *bundledUpdateItem;\n            updtCollection-&gt;get_Item(j,&amp;bundledUpdateItem);\n            bundledUpdateItem-&gt;get_KBArticleIDs(&amp;KBID);\n            if(KBID != NULL)\n            {\n                LONG KBCount;\n                BSTR KBIDValue;\n\n                KBID-&gt;get_Count(&amp;KBCount);\n                for(LONG j=0;j&lt;KBCount;j++)\n                {\n\n                    wcout &lt;&lt; \"KB\" &lt;&lt;(KBIDValue) &lt;&lt; endl;\n                    temp.setKBID(KBIDValue);\n                }\n            }\n        }\n    }\n\n    wcout &lt;&lt; L\"Total KB Count : \" &lt;&lt; updateSize &lt;&lt; endl;\n    CoUninitialize();\n\n    return 0;\n}\n</code></pre>\n\n<p>Any help would be really appreciated. Thanks in Advance</p>\n"},{"tags":["winapi","visual-c++"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12947951,"title":"Both WriteFile and ReadFile return 0 as No.of Bytes written or read","body":"<p>I am trying to communicate with a serial port, using the <code>WriteFile()</code> and <code>ReadFile()</code> functions, as defined in WinBase.h.</p>\n\n<p>The handle I pass is valid. Both functions return a success value, i.e. a boolean value of 1.</p>\n\n<p>But the number of bytes read or written is always frustratingly 0.</p>\n\n<pre><code>    BOOL  fWriteStat ;\n    DWORD dwBytesWritten;\n    #ifdef _UNICODE\n    char* outch = (char*) alloca (nChar+1);\n    __T2A (msg, outch);\n    fWriteStat = WriteFile( idComDev, outch, nChar, &amp;dwBytesWritten, NULL);\n    #else\n    fWriteStat = WriteFile( idComDev, msg, nChar, &amp;dwBytesWritten, NULL);\n    #endif     \n\n    return ((dwBytesWritten);\n}\n</code></pre>\n\n<p><code>nChar</code> and <code>dwBytesWritten</code> are both <code>DWORD</code>.</p>\n\n<p>The development environment is VC2010 and Windows 7.</p>\n\n<p>Could anyone help me with this, please?\nThanks.</p>\n"},{"tags":["c++","winapi","windows-7"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":411,"score":1,"question_id":3625983,"title":"How to make clone or extended mode","body":"<p>I am having multiple monitors(virtual+real) and by default I wanted to put it in clone/dual mode from my program. Can some one suggest how do I achieve this? I am very new to this world:) sorry for this basic question.... even any doc or any link will be highly appreciable.</p>\n\n<p>/sarbojit   </p>\n"},{"tags":["c++","windows","winapi","networking","wmi"],"answer_count":5,"favorite_count":4,"up_vote_count":12,"down_vote_count":0,"view_count":1549,"score":12,"question_id":5917304,"title":"How do I detect a disabled Network Interface Connection from a Windows application?","body":"<p>I would like to know when a interface has been disabled.</p>\n\n<p>If I go into the windows manager and disable one of the 2 enabled connections, GetIfTable() only returns status about 1 interface, it no longer sees the disconnected one. \n(Returns 1 table)</p>\n\n<p>How can I get something to return that the disabled <strong>interface still exists</strong> but is <em>currently</em> disabled?</p>\n\n<p>Thanks.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/aa365943%28VS.85%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/aa365943%28VS.85%29.aspx</a></p>\n"},{"tags":["winapi","mousewheel"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":725,"score":3,"question_id":7753123,"title":"Why is WheelDelta = 120?","body":"<p>I'm working with mouse events, specifically <code>OnMouseWheel</code>. Many code samples refer to distance the view changes (or zoom f.i. in 3D application) as <code>Distance = Sign(WheelDelta)*Constant</code> or <code>Distance = WheelDelta / WHEEL_DELTA</code> or something of that kind - assuming that WheelDelta is always a multiple of 120 (WHEEL_DELTA constant = 120).</p>\n\n<p>I already found that in touch interfaces / tablets input may depend on scrolling length.</p>\n\n<p>I was wondering why Microsoft has set default WheelDelta to 120, why not 100 or 10 or anything else? In what other cases wheel delta may be something different from 120?</p>\n"},{"tags":["c","winapi","taskmanager"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":620,"score":5,"question_id":5989469,"title":"What's the Win32 API to disable task manager completely?","body":"<p>That is,even if you press <kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>Del</kbd>,the task manager should not pop up.</p>\n"},{"tags":["winapi","qt","gdi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":259,"score":0,"question_id":5775646,"title":"`EnumDisplaySettings` repeating same Resolution Multiple Times","body":"<p>Here goes my code</p>\n\n<pre><code>DEVMODE dm;\nint index = 0;\nwhile(0 != EnumDisplaySettings(NULL, index++, &amp;dm)){\n    qDebug() &lt;&lt; index-1 &lt;&lt; dm.dmPelsWidth &lt;&lt; dm.dmPelsHeight;\n    Resolution* resolution = new Resolution(dm.dmPelsWidth, dm.dmPelsHeight);\n}\n</code></pre>\n\n<p>Outputs</p>\n\n<pre><code>0 320 200 \n1 320 200 \n2 320 200 \n3 320 240 \n4 320 240 \n5 320 240 \n6 400 300 \n7 400 300 \n8 400 300 \n9 512 384 \n10 512 384 \n11 512 384 \n12 640 400 \n13 640 400 \n14 640 400 \n15 640 480 \n.....\n25 640 480 \n26 640 480 \n27 800 600 \n.....\n41 800 600 \n42 1024 768 \n50 1024 768 \n51 1152 864 \n....\n62 1152 864 \n63 1280 600 \n</code></pre>\n\n<p>I get only one thing in return that is <code>320x200</code> not even the <code>1600x900</code> which is my current Resolution.</p>\n"},{"tags":["c","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":12945649,"title":"WinApi, Push button are not displayed","body":"<p>I'm trying to create simple windows app uisng WinAPi.\nHere is the code:<br/></p>\n\n<pre><code>       #include \"stdafx.h\"\n       #include \"APIup.h\"\n\n       #define MAX_LOADSTRING 100\n       HWND hWnd,cw13;\n       // Global Variables:\n       HINSTANCE hInst;                             // current                      instance\n       TCHAR szTitle[MAX_LOADSTRING];                   // The title bar text\n       TCHAR szWindowClass[MAX_LOADSTRING];         // the main window class name\n\n       // Forward declarations of functions included in this code module:\n       ATOM             MyRegisterClass(HINSTANCE hInstance);\n       ATOM Register(HINSTANCE hInstance);\n       BOOL             InitInstance(HINSTANCE, int);\n       LRESULT CALLBACK WndProc(HWND, UINT, WPARAM, LPARAM);\n       LRESULT CALLBACK    WndProc_dla13(HWND, UINT, WPARAM, LPARAM);\n       INT_PTR CALLBACK About(HWND, UINT, WPARAM, LPARAM);\n\n       int APIENTRY _tWinMain(HINSTANCE hInstance,\n                            HINSTANCE hPrevInstance,\n                            LPTSTR    lpCmdLine,\n                            int       nCmdShow)\n       {\n        UNREFERENCED_PARAMETER(hPrevInstance);\n        UNREFERENCED_PARAMETER(lpCmdLine);\n\n            // TODO: Place code here.\n        MSG msg;\n                HACCEL hAccelTable;\n\n        // Initialize global strings\n        LoadString(hInstance, IDS_APP_TITLE, szTitle, MAX_LOADSTRING);\n        LoadString(hInstance, IDC_APIUP, szWindowClass, MAX_LOADSTRING);\n        MyRegisterClass(hInstance);\n        Register(hInstance);\n\n        // Perform application initialization:\n        if (!InitInstance (hInstance, nCmdShow))\n        {\n            return FALSE;\n        }\n\n        hAccelTable = LoadAccelerators(hInstance, MAKEINTRESOURCE(IDC_APIUP));\n\n        // Main message loop:\n        while (GetMessage(&amp;msg, NULL, 0, 0))\n        {\n            if (!TranslateAccelerator(msg.hwnd, hAccelTable, &amp;msg))\n            {\n                TranslateMessage(&amp;msg);\n                DispatchMessage(&amp;msg);\n            }\n        }\n\n        return (int) msg.wParam;\n       }\n\n\n\n\n\n        ATOM MyRegisterClass(HINSTANCE hInstance)\n        {\n            WNDCLASSEX wcex;\n\n            wcex.cbSize = sizeof(WNDCLASSEX);\n\n            wcex.style          = CS_HREDRAW | CS_VREDRAW;\n            wcex.lpfnWndProc    = WndProc;\n            wcex.cbClsExtra     = 0;\n            wcex.cbWndExtra     = 0;\n            wcex.hInstance      = hInstance;\n            wcex.hIcon          = LoadIcon(hInstance, MAKEINTRESOURCE(IDI_APIUP));\n            wcex.hCursor        = LoadCursor(NULL, IDC_ARROW);\n            wcex.hbrBackground  = (HBRUSH)(COLOR_WINDOW+1);\n            wcex.lpszMenuName   = MAKEINTRESOURCE(IDC_APIUP);\n            wcex.lpszClassName  = szWindowClass;\n            wcex.hIconSm        = LoadIcon(wcex.hInstance, MAKEINTRESOURCE(IDI_SMALL));\n\n\n            return RegisterClassEx(&amp;wcex);\n               }\n\n               ATOM Register(HINSTANCE hInstance)\n               {\n            WNDCLASSEX cw13class;\n\n            cw13class.cbSize = sizeof(WNDCLASSEX);\n\n            cw13class.style         = CS_HREDRAW | CS_VREDRAW;\n            cw13class.lpfnWndProc   = WndProc_dla13;\n            cw13class.cbClsExtra        = 0;\n            cw13class.cbWndExtra        = 0;\n            cw13class.hInstance     = hInstance;\n            cw13class.hIcon         = LoadIcon(hInstance, MAKEINTRESOURCE(IDI_APIUP));\n            cw13class.hCursor       = LoadCursor(NULL, IDC_ARROW);\n            cw13class.hbrBackground = GetSysColorBrush(COLOR_3DFACE);\n            cw13class.lpszMenuName  = NULL;\n            cw13class.lpszClassName = L\"13class\";\n            cw13class.hIconSm       = LoadIcon(cw13class.hInstance,                               MAKEINTRESOURCE(IDI_SMALL));\n            return RegisterClassEx(&amp;cw13class);\n\n        }\n\n        BOOL InitInstance(HINSTANCE hInstance, int nCmdShow)\n        {\n\n\n\n\n           hWnd = CreateWindow(szWindowClass, szTitle, WS_OVERLAPPEDWINDOW,\n              CW_USEDEFAULT, 0, 100, 100, NULL, NULL, hInstance, NULL);\n           cw13=CreateWindow(L\"13class\",L\"Ćwiczenie                         13\",WS_OVERLAPPEDWINDOW,CW_USEDEFAULT,0,300,300,NULL,NULL,hInst,NULL);\n\n\n           if (!hWnd)\n           {\n              return FALSE;\n           }\n\n          ShowWindow(hWnd, nCmdShow);\n           UpdateWindow(hWnd);\n\n           return TRUE;\n        }\n\n\nLRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    int wmId, wmEvent;\n    PAINTSTRUCT ps;\n    HDC hdc;\n\n    switch (message)\n    {\n    case WM_COMMAND:\n        wmId    = LOWORD(wParam);\n        wmEvent = HIWORD(wParam);\n        // Parse the menu selections:\n\n        switch (wmId)\n        {\n        case IDM_ABOUT:\n            DialogBox(hInst, MAKEINTRESOURCE(IDD_ABOUTBOX), hWnd, About);\n            break;\n        case IDM_EXIT:\n            DestroyWindow(hWnd);\n            break;\n        case ID_32771:\n            ShowWindow(cw13, 1);\n            break;\n\n        default:\n            return DefWindowProc(hWnd, message, wParam, lParam);\n        }\n        break;\n    case WM_PAINT:\n        hdc = BeginPaint(hWnd, &amp;ps);\n        // TODO: Add any drawing code here...\n        EndPaint(hWnd, &amp;ps);\n        break;\n    case WM_DESTROY:\n        PostQuitMessage(0);\n        break;\n    default:\n        return DefWindowProc(hWnd, message, wParam, lParam);\n    }\n    return 0;\n}\n\nLRESULT CALLBACK WndProc_dla13 (HWND hWnd, UINT msg/*message*/, WPARAM  wParam,LPARAM lParam)\n        {\n switch(msg)  \n  {\n    case WM_CREATE:\n\n      CreateWindowW(L\"button\", L\"Beep\",\n          WS_VISIBLE | WS_CHILD ,\n          20, 50, 80, 25,\n          cw13, (HMENU) 1, hInst, NULL);\n\n      CreateWindowW(L\"button\", L\"Quit\",\n          WS_VISIBLE | WS_CHILD ,\n          120, 50, 80, 25,\n          cw13, (HMENU) 2, NULL, NULL);\n      break;\n\n    case WM_COMMAND:\n\n      if (LOWORD(wParam) == 1) {\n        Beep(40, 50);\n      }\n\n      if (LOWORD(wParam) == 2) {\n        PostQuitMessage(0);\n      }\n\n      break;\n\n    case WM_DESTROY:\n\n      PostQuitMessage(0);\n      break;\n      default:\n        return DefWindowProc(hWnd, msg, wParam, lParam);\n  }\n return 0;\n}\n\n\n\n\n// Message handler for about box.\nINT_PTR CALLBACK About(HWND hDlg, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    UNREFERENCED_PARAMETER(lParam);\n    switch (message)\n    {\n    case WM_INITDIALOG:\n        return (INT_PTR)TRUE;\n\n    case WM_COMMAND:\n        if (LOWORD(wParam) == IDOK || LOWORD(wParam) == IDCANCEL)\n        {\n            EndDialog(hDlg, LOWORD(wParam));\n            return (INT_PTR)TRUE;\n        }\n        break;\n    }\n    return (INT_PTR)FALSE;\n}\n</code></pre>\n\n<p>And the problem is that: when i create window 'cw13' it is created and displayed, but push buttons are not.I created two separate <code>WndProc</code> functions. Other messages are executed correctly( like <code>WM_QUIT</code>), only <code>CreateWindowW</code> under <code>WM_CREATE</code>,witch should create and show Push buttons aren't. Where is the problem?      </p>\n"},{"tags":["c++","string","winapi","equality"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12945202,"title":"Strange inequality - WC_BUTTONW not equal to L\"Button\"?","body":"<p>I have a Button control wrapper class, which allows you to pass an existing handle to it, provided it is of the <code>WC_BUTTON</code> class. I use <code>GetClassName()</code> to determine this. But I have a problem, the comments in the code should help describe it:</p>\n\n<pre><code>// Initialize from existing handle\nVivify::Button::Button(HWND handle) {\n    TCHAR cls[256];\n    GetClassName(handle, cls, sizeof(cls));\n\n    Alert(cls);       // MessageBox says \"Button\"\n    Alert(WC_BUTTON); // MessageBox says \"Button\" also\n\n    Str clsStr = cls;\n    Str wcStr  = WC_BUTTON;\n\n    Alert(ToStr&lt;int&gt;(clsStr.length())); // says \"6\"\n    Alert(ToStr&lt;int&gt;(wcStr.length()));  // says \"6\" also\n\n    // Problem HERE. Evaluates to false. How are they inequal??\n    if (cls == WC_BUTTON) {\n        SetHandle(handle); // Never gets executed\n        m_id = GetDlgCtrlID(handle);\n    }\n}\n</code></pre>\n\n<p><code>Str</code> is a <code>std::wstring</code> by the way, program is in Unicode.\nBut both the string I get from <code>GetClassName()</code> and <code>WC_BUTTON</code> are both unicode strings, are both <code>6</code> characters long, and both equal <code>\"Button\"</code>, how on earth is the line <code>if (cls == WC_BUTTON)</code> returning <code>false</code>??</p>\n\n<p>Could someone explain how two seemingly exactly identical strings could be in-equal to each-other?\nOr how can I determine if a <code>HWND</code> belongs to a button/edit/etc. control?</p>\n"},{"tags":["windows","winapi","networking","dhcp","rndis"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":66,"score":0,"question_id":12796726,"title":"How to disable dhcp for a specific network adapter?","body":"<p>Recently, I am programming of android USB reverse tether. On the windows platform, a Remote NDIS network adapter was created. By default, it turns on the DHCP, however I want to disable it in codes.\nIs there any Win32 API to do it?</p>\n\n<p>Use the WMI to fix it.</p>\n\n<p>I coded one helper class to query or modify the network adapter settings</p>\n\n<p>Here is the class defination</p>\n\n<pre><code>//Header file\n#include &lt;string&gt;\nstruct NetWorkAdapterSetting\n{\n     unsigned int nIfIndex;\n     bool bEnableDHCP;\n     std::wstring strIPAddress;\n     std::wstring strNetsubMask;\n\n     NetWorkAdapterSetting()\n     {\n        nIfIndex = 0;\n        bEnableDHCP = false;\n     }\n };\n\n struct IWbemServices;\n struct IWbemLocator;\n class UsbReverseTether\n {\n    public:\n        UsbReverseTether(void);\n        ~UsbReverseTether(void);\n\n        bool Init();\n        void Uninit();\n\n        bool getConnectedNetworkAdapterSettings( NetWorkAdapterSetting&amp; adapterSetting );\n\n        bool enableStaticIPAddress(\n              unsigned int nIfIndex, \n              const std::wstring&amp; strIPAddress,\n              const std::wstring&amp; strNetsubMask );\n\n    private:\n        IWbemServices* m_pWbemSvc;\n        IWbemLocator*  m_pWbemLoc;\n    };\n</code></pre>\n\n<p>The source file </p>\n\n<p>//COM init + Prepare the WMI Service  + COM unit</p>\n\n<pre><code>bool UsbReverseTether::Init()\n{\n        HRESULT hr = CoInitializeEx( 0, COINIT_MULTITHREADED );\n        if ( FAILED( hr ) ) \n        {\n            LOG_ERR( \"Failed to initialize COM library. Error code = 0x%x\", hr );\n            return false;\n        }\n\n        hr = CoInitializeSecurity(\n                     NULL,                      // Security descriptor\n                     -1,                        // COM negotiates authentication service\n                     NULL,                      // Authentication services\n                     NULL,                      // Reserved\n                     RPC_C_AUTHN_LEVEL_DEFAULT, // Default authentication level for proxies\n                     RPC_C_IMP_LEVEL_IMPERSONATE, // Default Impersonation level for proxies\n                     NULL,                        // Authentication info\n                     EOAC_NONE,          // Additional capabilities of the client or server\n                     NULL);                // Reserved\n\n        if ( FAILED( hr ) )\n        {\n           LOG_ERR( \"Failed to initialize security. Error code = 0x%x\", hr );\n           CoUninitialize();\n           return false;\n        }\n\n        hr = CoCreateInstance( \n              CLSID_WbemLocator,\n              0,\n              CLSCTX_INPROC_SERVER, IID_IWbemLocator, (LPVOID *) &amp;m_pWbemLoc );\n        if (FAILED(hr))\n        {\n            LOG_ERR( \"Failed to create IWbemLocator object. Err code = 0x%x\", hr );\n            CoUninitialize();\n            return false;\n        }\n\n         // Connect to the local root\\cimv2 namespace\n        // and obtain pointer m_pWbemSvc to make IWbemServices calls.\n        hr = m_pWbemLoc-&gt;ConnectServer(\n            L\"ROOT\\\\CIMV2\", \n            NULL,\n            NULL, \n            0, \n            NULL, \n            0, \n            0, \n            &amp;m_pWbemSvc\n        );\n\n        if (FAILED(hr))\n        {\n            LOG_ERR( \"Could not connect. Error code = 0x%x\", hr );\n            m_pWbemLoc-&gt;Release();\n            m_pWbemLoc = NULL;\n            CoUninitialize();\n            return false;\n        }\n\n        LOG_TRACE( \"Connected to ROOT\\\\CIMV2 WMI namespace\" );\n\n        // Set the proxy so that impersonation of the client occurs.\n        hr = CoSetProxyBlanket(m_pWbemSvc,\n           RPC_C_AUTHN_WINNT,\n           RPC_C_AUTHZ_NONE,\n           NULL,\n           RPC_C_AUTHN_LEVEL_CALL,\n           RPC_C_IMP_LEVEL_IMPERSONATE,\n           NULL,\n           EOAC_NONE\n        );\n\n        if (FAILED(hr))\n        {\n            LOG_ERR( \"Could not set proxy blanket. Error code = 0x%x\", hr );\n           m_pWbemSvc-&gt;Release();\n           m_pWbemLoc-&gt;Release();\n           CoUninitialize();\n           return false; \n        }\n\n        return true;\n    }\n\n    void UsbReverseTether::Uninit()\n    {\n        if ( NULL != m_pWbemSvc )\n        {\n            m_pWbemSvc-&gt;Release();\n            m_pWbemSvc = NULL;\n        }\n        if ( NULL != m_pWbemLoc )\n        {\n            m_pWbemLoc-&gt;Release();\n            m_pWbemLoc = NULL;\n        }\n        CoUninitialize();\n    }\n</code></pre>\n\n<p>Query the USB Remote RNDIS network adapter setting</p>\n\n<pre><code>   bool UsbReverseTether::getConnectedNetworkAdapterSettings( NetWorkAdapterSetting&amp; adapterSetting )\n    {\n        HRESULT hr = S_OK;\n        IEnumWbemClassObject* pEnumerator = NULL;\n\n        hr = m_pWbemSvc-&gt;ExecQuery( _bstr_t(\"WQL\"),\n            _bstr_t(\"SELECT * FROM Win32_NetworkAdapterConfiguration WHERE IPEnabled = TRUE AND ServiceName=\\'usb_rndisx\\'\"),\n            WBEM_FLAG_FORWARD_ONLY | WBEM_FLAG_RETURN_IMMEDIATELY,\n            NULL,\n            &amp;pEnumerator );\n        if ( FAILED( hr ) )\n        {\n            LOG_ERR( \"ExecQuery. Error code = 0x%x\", hr );\n            return false;\n        }\n\n        bool bOK = false;\n        IWbemClassObject* pclsObj = NULL;\n        ULONG uReturn = 0;\n        int nCount = 0;\n        while ( pEnumerator )\n        {\n            hr = pEnumerator-&gt;Next( WBEM_INFINITE, 1, &amp;pclsObj, &amp;uReturn );\n            if(0 == uReturn)\n            {\n                break;\n            }\n            ++nCount;\n            if ( nCount &gt; 1 )\n            {\n                LOG_WARN( \"There is more than 1 connected usb network adapter\" );\n                break;\n            }\n\n            VARIANT vtProp;\n\n            hr = pclsObj-&gt;Get(L\"Index\", 0, &amp;vtProp, 0, 0);\n            if ( FAILED( hr ) )\n            {\n                LOG_ERR( \"IWbemClassObject::Getproperty(Index). Error code = 0x%x\", hr );\n                break;\n            }\n            adapterSetting.nIfIndex = vtProp.uintVal;\n            VariantClear(&amp;vtProp);\n\n            hr = pclsObj-&gt;Get(L\"DHCPEnabled\", 0, &amp;vtProp, 0, 0);\n            if ( FAILED( hr ) )\n            {\n                LOG_ERR( \"IWbemClassObject::Getproperty(DHCPEnabled). Error code = 0x%x\", hr );\n                break;\n            }\n            adapterSetting.bEnableDHCP = vtProp.boolVal;\n            VariantClear(&amp;vtProp);\n\n            hr = pclsObj-&gt;Get(L\"IPAddress\", 0, &amp;vtProp, 0, 0);\n            if ( FAILED( hr ) )\n            {\n                LOG_ERR( \"IWbemClassObject::Getproperty(IPAddress). Error code = 0x%x\", hr );\n                break;\n            }\n            SAFEARRAY* psa = vtProp.parray;\n            if( psa )\n            {\n                void **p = (void **)psa-&gt;pvData;\n                wchar_t *wstr = (wchar_t *)*p;\n                adapterSetting.strIPAddress = wstr;\n            }\n            VariantClear(&amp;vtProp);\n\n            hr = pclsObj-&gt;Get(L\"IPSubnet\", 0, &amp;vtProp, 0, 0);\n            if ( FAILED( hr ) )\n            {\n                LOG_ERR( \"IWbemClassObject::Getproperty(SubnetMask). Error code = 0x%x\", hr );\n                break;\n            }\n            if( psa )\n            {\n                void **p = (void **)psa-&gt;pvData;\n                wchar_t *wstr = (wchar_t *)*p;\n                adapterSetting.strNetsubMask = wstr;\n            }\n            VariantClear(&amp;vtProp);\n\n            bOK = true;\n        }\n        return bOK;\n    }\n</code></pre>\n\n<p>Enable static IP Address</p>\n\n<pre><code>bool UsbReverseTether::enableStaticIPAddress( unsigned int nIfIndex, const std::wstring&amp; strIPAddress, const std::wstring&amp; strNetsubMask )\n{\n    HRESULT hr = S_OK;\n    BSTR MethodName = _bstr_t(L\"EnableStatic\");\n    BSTR ClassName = _bstr_t(L\"Win32_NetworkAdapterConfiguration\");\n\n    IWbemClassObject* pClass = NULL;\n    hr = m_pWbemSvc-&gt;GetObject( ClassName, 0, NULL, &amp;pClass, NULL);\n    if ( FAILED( hr ) )\n    {\n        LOG_ERR( \"GetObject. Error code = 0x%x\", hr );\n        return false;\n    }\n    IWbemClassObject* ppInSignature  = NULL;\n    hr = pClass-&gt;GetMethod( L\"EnableStatic\",0, &amp;ppInSignature, NULL );\n    if ( FAILED( hr ) )\n    {\n        LOG_ERR( \"GetMethod. Error code = 0x%x\", hr );\n        return false;\n    }\n\n    IWbemClassObject* pInputParaInstance = NULL;\n    hr = ppInSignature-&gt;SpawnInstance(0, &amp;pInputParaInstance);\n    if ( FAILED( hr ) )\n    {\n        LOG_ERR( \"SpawnInstance. Error code = 0x%x\", hr );\n        return false;\n    }\n\n    long aindex[]={0};\n\n    BSTR ipaddress = SysAllocString( strIPAddress.c_str() );\n    SAFEARRAY *ip_list = SafeArrayCreateVector(VT_BSTR,0,1);\n    SafeArrayPutElement(ip_list,aindex, ipaddress );\n\n    VARIANT varIPAddress;\n    varIPAddress.vt =  VT_ARRAY|VT_BSTR;\n    varIPAddress.parray = ip_list;\n    hr = pInputParaInstance-&gt;Put( L\"IPAddress\", 0, &amp;varIPAddress, 0 );\n    if ( FAILED( hr ) )\n    {\n        LOG_ERR( \"Put(IPAddress). Error code = 0x%x\", hr );\n        SysFreeString( ipaddress );\n        return false;\n    }\n    SAFEARRAY *mask_list = SafeArrayCreateVector(VT_BSTR,0,1);\n    BSTR netsubMask = SysAllocString( strNetsubMask.c_str() );\n    SafeArrayPutElement(mask_list,aindex, netsubMask );\n\n    VARIANT varSubnetMask;\n    varSubnetMask.vt = VT_ARRAY|VT_BSTR;\n    varSubnetMask.parray = mask_list;\n    hr = pInputParaInstance-&gt;Put(L\"SubnetMask\", 0,\n    &amp;varSubnetMask, 0);\n    if ( FAILED( hr ) )\n    {\n        SysFreeString( netsubMask );\n        LOG_ERR( \"Put(SubnetMask). Error code = 0x%x\", hr );\n        return false;\n    }\n\n    wchar_t className[100] = {0};\n    swprintf( className, 100, L\"Win32_NetworkAdapterConfiguration.Index=%d\", nIfIndex );\n    BSTR indexClassName = _bstr_t(className);\n    IWbemClassObject* ppOutSignature = NULL;\n    hr = m_pWbemSvc-&gt;ExecMethod(indexClassName, _bstr_t(L\"EnableStatic\"), 0,\n    NULL, pInputParaInstance, &amp;ppOutSignature, NULL);\n    if ( FAILED( hr ) )\n    {\n        SysFreeString( ipaddress );\n        SysFreeString( netsubMask );\n        LOG_ERR( \"ExecMethod(EnableStatic). Error code = 0x%x\", hr );\n        return false;\n    }\n    VARIANT ret_value;\n    hr = ppOutSignature-&gt;Get(L\"ReturnValue\", 0, &amp;ret_value, 0, 0);\n    int bResult = V_I4(&amp;ret_value);\n    SysFreeString( ipaddress );\n    SysFreeString( netsubMask );\n    return true;\n}\n</code></pre>\n"},{"tags":["delphi","winapi","encryption","cryptography","cryptoapi"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":808,"score":3,"question_id":10984064,"title":"WinAPI -> CryptoAPI -> RSA, encrypt with private, decrypt with public","body":"<p>Good day.</p>\n\n<p>I need to teach Windows CryptoAPI to encrypt the message with private (not public) part of the key, and decrypt with public. This is necessary to give users information, that they can read, but can't change.</p>\n\n<p><strong>How it works now:</strong></p>\n\n<p>I get the context</p>\n\n<pre><code>CryptAcquireContext(@Prov, PAnsiChar(containerName), nil, PROV_RSA_FULL, 0)\n</code></pre>\n\n<p>generate a key pair</p>\n\n<pre><code>CryptGenKey(Prov, CALG_RSA_KEYX, CRYPT_EXPORTABLE, @key)\n</code></pre>\n\n<p>Encrypt (and the problem is here. \"key\" - a keypair, and the function uses its public part);</p>\n\n<pre><code>CryptEncrypt(key, 0, true, 0, @res[1], @strLen, buffSize)\n</code></pre>\n\n<p>Decrypt (the same problem here, it uses the private part of the key)</p>\n\n<pre><code>CryptDecrypt(key, 0, true, 0, @res[1], @buffSize)\n</code></pre>\n\n<p>Thank you for your attention / help.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Yes, I could use a digital signature and other metods... </p>\n\n<p>The problem is that I need to encrypt one database field and make sure that no one but me can change it. It will be possible to read this field only with the help of my program (till someone decompiles it and get public key). This could be done with symmetrical key and digital signatures, but then i will need to create another field and store another key and so on... </p>\n\n<p>I do hope that we can somehow teach WIN API to do as I want. I know that i can do so with RSA, and I hope that somehow WinAPI supports this feature.</p>\n"},{"tags":["c++","winapi","bitwise","flags","dword"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12943420,"title":"C++/WinAPI - Removing a flag from a DWORD (bitwise operator?)","body":"<p>I now know how to check if there is a certain flag in a DWORD (Specifically a Windows style) by using the bitwise <code>&amp;</code> AND operator. How would I do this:</p>\n\n<pre><code>if (dwMyFlags &amp; dwSomeFlag) {\n    // dwMyFlags contains dwSomeFlag\n    // -&gt;&gt; How do I remove dwSomeFlag from dwMyFlags?\n}\n</code></pre>\n\n<p>I know subtracting it wouldn't work, is there some operator that can remove flags from a DWORD?</p>\n"},{"tags":["c++","c","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12942337,"title":"Could not display other unicode Eastern Asian Lanuage on Windows DialogBox","body":"<p>I use the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms645452%28v=vs.85%29.aspx\" rel=\"nofollow\">DialogBox</a> API to display a dialog at my application. In the WM_INITDIALOG message handling at the DLGPROC procedure call back, I could see the text string is correct Unicode at debugger and <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms645521%28v=vs.85%29.aspx\" rel=\"nofollow\">SetDlgItemText</a> is used to set the text on Rich Edit control in the dialog. However when I tried to get the text from dialog by using GetDlgItemText API , it was all question marks for those characters.  </p>\n\n<p>My project is compiled as Unicode. And I also used the spy++ and it shows the Windows Proc is Unicode.</p>\n\n<p>I am testing Chinese on Windows 7 with English Locale, so I also installed the Chinese Language Pack for my machine and it doesn't help either. </p>\n\n<p>I could not explain what I see here. It would be appreciated if any one could shed some lights on this or how to debug further.</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12943124,"title":"SetThreadAffinityMask Usage","body":"<p>i really have a hard time understanding the SetThreadAffinityMask function. Im trying to implement a timer with the QueryPerformanceCounter function but I dont understand how to get the thread affinity right. A guy on msdn posted the following code example:</p>\n\n<pre><code>void HRTimer::StartTimer(void)\n{\n    DWORD_PTR oldmask = ::SetThreadAffinityMask(::GetCurrentThread(), 0);\n    ::QueryPerformanceCounter(&amp;start);\n    ::SetThreadAffinityMask(::GetCurrentThread(), oldmask);\n}\n</code></pre>\n\n<p>But when I adopt this code snippet the value for oldmask returned by SetThreadAffinityMask is zero. On MSDN I saw that a return value of zero means that an error occurred. I called GetLastError() and got the error code for ERROR_INVALID_PARAMETER. Now im wondering if the code snippet above isnt correct. Can someone please explain me how to use SetThreadAffinityMask correctly so that QueryPerformanceCounter is for example only called on the first CPU on the system? Or is the above example correct allthough SetThreadAffinityMask returns zero?</p>\n\n<p>Thank you in advance.</p>\n"},{"tags":["c","winapi","com","windows-store-apps"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":43,"score":-1,"question_id":12942509,"title":"Can a Windows application using only Win32 be certified for the Windows Store?","body":"<p>Can a Windows application be certified for the Windows Store if it <strong>ONLY</strong> uses <a href=\"http://msdn.microsoft.com/en-us/windows/apps/br205757.aspx\" rel=\"nofollow\">the allowed Win32 subset</a> and is written in <a href=\"http://stackoverflow.com/a/946294/193892\">plain C</a>?</p>\n\n<p><sub><a href=\"http://stackoverflow.com/questions/12909139/can-windows-store-applications-be-built-with-mingw#comment17509787_12909139\">Related</a></sub></p>\n"},{"tags":["c++","c","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":12939534,"title":"What's a Win32 API equivalent of the stdlib system() function?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/7017680/run-a-simple-shell-command\">Run a simple shell command</a>  </p>\n</blockquote>\n\n\n\n<p>Is there a Win32 API function that does the same thing as <code>system()</code> in a similarly simple way? In the specific console program I'm creating, I'd like to limit as much as possible to the Windows libraries.</p>\n"},{"tags":["c++","multithreading","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12941056,"title":"Simple thread with wait function","body":"<p>I cannot understand why next code doesn't work. It compile correct, but doesn't output anything. Can you help me?</p>\n\n<pre><code>HANDLE hEvent;\nunsigned int WINAPI MyThread(void *p)\n{\n    WaitForSingleObject(hEvent, INFINITE);\n    _tprintf(TEXT(\"%s\\n\"),p);\n    return 0;\n}\n\nint _tmain(int argc, TCHAR *argv[])\n{\n    hEvent = CreateEvent(NULL, TRUE, FALSE, NULL);\n    unsigned int ThreadID;\n    HANDLE hThread1 = (HANDLE)_beginthreadex(NULL, 0, MyThread, L\"hello world\", 0, &amp;ThreadID);\n    SetEvent(hEvent);\n    return 0;\n}\n</code></pre>\n"},{"tags":["c++","windows","multithreading","winapi","beginthread"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12939077,"title":"The stack size argument in beginthread","body":"<p>I thought I knew what the stack size argument in beginthread means. So my question is: why does this work?</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;iostream&gt;\n#include &lt;process.h&gt;\n\nusing namespace std;\n\nvoid huge_stack(int a, int b, int c, int d)\n{\n    int i[100000] = {0};\n    cout &lt;&lt; a &lt;&lt; b &lt;&lt; c &lt;&lt; d &lt;&lt; i[12333] &lt;&lt; endl;\n}\n\nbool done = false;\n\nvoid thread(void* p)\n{\n    huge_stack(1,2,3,4);\n    done = true;\n}\n\nint main()\n{\n    _beginthread(thread, 10, nullptr);\n\n    while(!done) {}\n\n    return 0;\n}\n</code></pre>\n\n<p>I made sure I'm building in Debug mode, so the calls and arrays won't be optimized.</p>\n"},{"tags":["delphi","winapi","combobox","delphi-2009"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":113,"score":3,"question_id":12935912,"title":"How to find out the index of a combo box item by name using WinAPI in Delphi?","body":"<p>I have a Delphi application A, which needs to select a certain item in a combo box of another Delphi application B.</p>\n\n<p>A knows the text of the combo box item to select.</p>\n\n<p>In order to select the combo box item, application A needs to know the index of the item in the combo box.</p>\n\n<p>How can I figure out the index of a combo box item, when I only know its text?</p>\n"},{"tags":["c++","winapi","palette","bitblt"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12918303,"title":"BitBlt Copy Bitmap from ClipBoard gives wrong colors","body":"<p>I am pasting an image from the clipboard into my program.  The bitmap gets put on a background memDC bitmap, which is then composited with another memDC before being drawn to the screen.  The background bitmap is 8 bits per pixel.  The problem is that the bitblt turns Black(0x00000000) into Almost-Black (0x00010101).  If I paste the same thing into MSPaint, I get Black.  If I copy Black from MSPaint, I get Almost Black.  (Other colors are also mangled).  If I change the background bitmap to 32bpp, I get the correct colors, but that isn't currently an option.</p>\n\n<p>The following is some code that demonstrates the issue:</p>\n\n<pre><code>/*\n *HWND hWnd; // main window handle\n *HDC hDC; // main window DC (set elsewhere)\n *HDC memDC; // background DC (set elsewhere)\n */\nHBITMAP hClipBitmap=NULL;\nOpenClipboard(hWnd);\n\nhClipBitmap = (HBITMAP)GetClipboardData(CF_BITMAP);\nif (hClipBitmap!=NULL)\n{\n    // I now want to make a copy of the bitmap\n    BITMAP bm;\n    HDC hSrcDC,hDestDC;\n    HANDLE OldObject1, OldObject2;\n    DWORD sz = GetObject(hClipBitmap, sizeof(BITMAP), &amp;bm);\n    if(sz == sizeof(BITMAP))\n    {\n            // make a bitmap to allow positioning before actual pasting\n        hPasteBitmap = ::CreateCompatibleBitmap(memDC, bm.bmWidth, bm.bmHeight); \n        if (hPasteBitmap==NULL)\n            FATAL_ERROR;\n        hSrcDC = CreateCompatibleDC(hDC);\n        hDestDC = CreateCompatibleDC(hDC);\n        OldObject1 = SelectObject(hSrcDC, hClipBitmap); // bpp is 32\n        OldObject2 = SelectObject(hDestDC, hPasteBitmap); // bpp is 8\n        BitBlt(hDestDC, 0, 0, bm.bmWidth, bm.bmHeight, hSrcDC, 0, 0, SRCCOPY);\n        COLORREF color2 = ::GetPixel(hSrcDC, 1, 1); // color2 is 0x00000000\n        COLORREF color3 = ::GetPixel(hDestDC, 1, 1);// color2 is 0x00010101\n        COLORREF color4 = ::GetNearestColor(hSrcDC, color2); //  0x00000000\n        COLORREF color5 = ::GetNearestColor(hDestDC, color2);//  0x00000000\n        // hPasteBitmap now contains the clipboard data\n    }\n}\n// other cleanup snipped for clarity\n</code></pre>\n\n<p>Using GetPixel() and GetNearestColor(), it seems like I should get the results I'm looking for, but I don't.  I guess I'm missing some sort of palette operation?</p>\n\n<p><strong>Update</strong></p>\n\n<p>The part I really have trouble with, and maybe I misunderstand the point of these APIs, is that I can query the pixel color, and then ask the context what color it will use for that, and it returns the correct color (Black), instead of the Almost Black that the BitBlt generates.</p>\n\n<p>Other programs do not seem to put a palette on the clipboard - perhaps because they are putting 32bpp bitmaps that don't need the palette?  They aren't even doing DIBs as near as I can tell from looking at what is available based on <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms649013%28v=vs.85%29.aspx#_win32_Synthesized_Clipboard_Formats\" rel=\"nofollow\">MSDN's clipboard translation table</a></p>\n"},{"tags":["c++","windows","winapi","registry"],"answer_count":5,"favorite_count":6,"up_vote_count":18,"down_vote_count":0,"view_count":13100,"score":18,"question_id":34065,"title":"How to read a value from the Windows registry","body":"<p>Given the key for some registry value (e.g. HKEY_LOCAL_MACHINE\\blah\\blah\\blah\\foo) how can I:</p>\n\n<ol>\n<li>Safely determine that such a key exists.</li>\n<li>Programmatically (i.e. with code) get its value.</li>\n</ol>\n\n<p>I have absolutely no intention of writing anything back to the registry (for the duration of my career if I can help it). So we can skip the lecture about every molecule in my body exploding at the speed of light if I write to the registry incorrectly. </p>\n\n<p>Prefer answers in C++, but mostly just need to know what the special Windows API incantation to get at the value is.</p>\n"},{"tags":["c","winapi","bots","irc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":54,"score":-2,"question_id":12937216,"title":"c - trying to make irc bot","body":"<pre><code>#include &lt;winsock2.h&gt;\n#include &lt;stdio.h&gt;\n\nconst int PORT = 6667;\nconst char *SERVER = \"irc.freenode.org\";\nconst char *CHAN = \"#channela\";\nconst char *NICK = \"loveMilk\";\n\nconst int MAX_BUFF_SIZE = 512;\n\nint sock_conn(SOCKET *socketn, const char *HOST, int portn);\nint sock_send(SOCKET *socketn, char* msg, ...);\n\nint main(int argc, char *argv[])\n{\n    WSADATA wsadata;\n    char buff[MAX_BUFF_SIZE];\n    char oBuff[MAX_BUFF_SIZE];\n    int buffRec;\n\n    if (WSAStartup(MAKEWORD(2,2), &amp;wsadata) != 0)\n        return 0;\n\n    SOCKET sock;\n\n    if(sock_conn(&amp;sock, SERVER, PORT) != 0)\n    {\n        WSACleanup();\n        return 0;\n    }\n\n    printf(\"connected.\\n\");\n\n    sock_send(&amp;sock, \"USER %s \\\"\\\" \\\"127.0.0.1\\\" :%s\\r\\n\", NICK, NICK);\n    sock_send(&amp;sock, \"NICK %s\\r\\n\", NICK);\n    Sleep(100);\n\n    sock_send(&amp;sock, \"JOIN %s\\r\\n\", CHAN);\n    printf(\"Joined channel.\\n\");\n\n    while(1)\n    {\n        memset(buff, 0, MAX_BUFF_SIZE);\n        memset(oBuff, 0, MAX_BUFF_SIZE);\n\n        buffRec = recv(sock, buff, MAX_BUFF_SIZE, 0);\n        if((buffRec == 0) || (buffRec == SOCKET_ERROR)) break;\n\n        /* New line: Terminate buffer as a string */\n        buff[buffRec] = '\\0';\n\n        if(buff[0] != ':')\n        {\n            strcpy(oBuff, \"PONG :\");\n            printf(\"PONG\");\n            sock_send(&amp;sock, oBuff);\n        }\n        else\n        {\n            if(strstr(buff, \"PRIVMSG\"))\n            {\n                int i, num = 0;\n                for(i = 0; i &lt; strlen(buff); ++i) if(buff[i] = ' ') ++num;\n                char** parts = malloc(sizeof(char*) * num);\n                char *p;\n                p = strtok(buff, \" \");\n                int j = 0;\n                while(p != NULL)\n                {\n                    parts[j] = p;\n                    j++;\n                    p = strtok(NULL, \" \");\n                }\n                printf(\"%s\", parts[3]);\n\n                free(parts);\n            }\n        }\n    }\n    closesocket(sock);\n    return 1;\n}\n\nint sock_conn(SOCKET *socketn, const char *HOST, int portn)\n{\n    WSADATA wsadata;\n    SOCKADDR_IN sockA;\n    LPHOSTENT hostE;\n\n    if(WSAStartup(MAKEWORD(2,2), &amp;wsadata) == -1) return -1;\n    if(!(hostE = gethostbyname(HOST)))\n    {\n        WSACleanup();\n        return -1;\n    }\n    if ((*socketn = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)) == INVALID_SOCKET)\n    {\n        WSACleanup();\n        return -1;\n    }\n\n    sockA.sin_family = AF_INET;\n    sockA.sin_port = htons(portn);\n    sockA.sin_addr = *((LPIN_ADDR)*hostE-&gt;h_addr_list);\n\n    if(connect(*socketn, (LPSOCKADDR)&amp;sockA, sizeof(struct sockaddr)) == SOCKET_ERROR)\n    {\n        WSACleanup();\n        return -1;\n    }\n}\n\nint sock_send(SOCKET *socketn, char* msg, ...)\n{\n    char buff[MAX_BUFF_SIZE];\n    va_list va;\n    va_start(va, msg);\n    vsprintf(buff, msg, va);\n    va_end(va);\n    send(*socketn, buff, strlen(buff), 0);\n    return 1;\n}\n</code></pre>\n\n<p>parts always null, why? someone told me to terminate the buff with this line: <code>buff[buffRec] = '\\0';</code>, but still I got nothing, how can I change the buff to string cause I believe this is the problem... the bot is connecting and all and I can communicate with it, but when I try to reach to parts, it's NULL.</p>\n"},{"tags":["c","winapi","audio","capture"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":78,"score":-1,"question_id":12922930,"title":"C - how can I capture sound from the microphone?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2351659/how-to-get-pcm-data-from-microphone-in-c-os-windows\">How to get PCM data from microphone in C++ (os Windows)?</a>  </p>\n</blockquote>\n\n\n\n<p>How can i capture sound from the microphone, and hear it in another computer live?\nThanks.</p>\n"},{"tags":["c#","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12935798,"title":"Edit global context menu Cut/Copy/Paste","body":"<p>is there way how to edit global context menu (right-click menu) Cut/Copy/Paste in CSharp?</p>\n\n<p>I would like add some new items like \"Search with google\" or \"send it by email\".</p>\n\n<p>Thanks!</p>\n"},{"tags":["c++","windows","winapi","dll"],"answer_count":7,"favorite_count":5,"up_vote_count":8,"down_vote_count":0,"view_count":1125,"score":8,"question_id":315285,"title":"Can I use two incompatible versions of the same DLL in the same process?","body":"<p>I'm using two commercial libraries that are produced by the same vendor, called VendorLibA and VendorLibB. The libraries are distributed as many DLLs that depend on the compiler version (e.g. VC7, VC8). Both libraries depend on a another library, produced by this vendor, called VendorLibUtils and contained in one DLL.</p>\n\n<p>The problem: VendorLibA uses a different version of VendorLibUtils than VendorLibB. The two versions are not binary compatible, and even if they were it would be a bad idea to use the wrong version.</p>\n\n<p>Is there any way I could use the two libraries under the same process?</p>\n\n<p><strong>Note:</strong> LoadLibrary can't solve this since my process is not that one that's importing VendorLibUtils.</p>\n\n<p><strong>EDIT:</strong> Forgot to mention the obvious, I don't have to source code for any of the commercial libraries and probably I will never have (<em>sigh</em>).</p>\n\n<p><strong>EDIT:</strong> The alternative btw, is to do this: <a href=\"http://stackoverflow.com/questions/312569/how-to-combine-gui-applications-in-windows\">http://stackoverflow.com/questions/312569/how-to-combine-gui-applications-in-windows</a></p>\n"},{"tags":["c++","winapi","event-handling","event-hooking"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12931235,"title":"SetWinEventHook does not catch any event","body":"<p>It is a follow-up of this question : <a href=\"http://stackoverflow.com/questions/12862213/alt-tab-overlay-win32-identificator\">Alt Tab overlay Win32 identificator</a>.</p>\n\n<p>I try to catch the moment when the alt-tab switch menu open (and exit), using the SetWinEventHook function from the Winuser API. <strong>However, the hook do not catch any event (e.g. minimizing a window), and therefore, does not call HandleWinEvent</strong>.</p>\n\n<p>The following code is greatly inspired by the one provided on the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd373640%28v=vs.85%29.aspx\" rel=\"nofollow\">MSDN page</a></p>\n\n<pre><code>#ifndef _WIN32_WINNT\n    #define _WIN32_WINNT 0x0500\n#endif\n\n#ifndef WINVER\n    #define WINVER 0x0501\n#endif\n\n#include \"conio.h\"\n#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n\n\n// Global variable.\nHWINEVENTHOOK g_hook;\n\n// Prototype\nvoid HandleWinEvent(HWINEVENTHOOK , DWORD , HWND ,\n                         LONG , LONG ,\n                         DWORD , DWORD );\n\n// Initializes COM and sets up the event hook.\n//\nvoid InitializeMSAA()\n{\n    CoInitialize(NULL);\n    g_hook = SetWinEventHook(\n        EVENT_MIN ,EVENT_MAX,  // Range of events .\n        NULL,                                          // Handle to DLL.\n        HandleWinEvent,                                // The callback.\n        0, 0,              // Process and thread IDs of interest (0 = all)\n        WINEVENT_OUTOFCONTEXT ); // Flags.\n}\n\n// Unhooks the event and shuts down COM.\n//\nvoid ShutdownMSAA()\n{\n    UnhookWinEvent(g_hook);\n    CoUninitialize();\n}\n\n// Callback function that handles events.\n//\nvoid HandleWinEvent(HWINEVENTHOOK hook, DWORD event, HWND hwnd,\n                         LONG idObject, LONG idChild,\n                         DWORD dwEventThread, DWORD dwmsEventTime)\n{\n    std::cout &lt;&lt; std::hex &lt;&lt; event ; // desperate attempt to see if any event is caught \n\n    if (event == EVENT_SYSTEM_SWITCHSTART)\n    {\n        std::cout &lt;&lt; \"Begin\" ;\n    }\n    else if (event == EVENT_SYSTEM_SWITCHEND)\n    {\n        std::cout &lt;&lt; \"End \";\n    }\n}\n\n\n\nint main()\n{\n    InitializeMSAA();\n    while( getch()!= 'q' ){;}\n    ShutdownMSAA();\n    return 0;\n}\n</code></pre>\n\n<p>The building command : </p>\n\n<pre><code>g++ -o alttab main.cpp -luser32 -lole32\n</code></pre>\n\n<p>I'm using Windows XP with MinGW/GCC compiler, version 4.5.</p>\n"},{"tags":["delphi","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":108,"score":2,"question_id":12928799,"title":"How to find all text fields in a window?","body":"<p>I have a window with two text fields inside it.</p>\n\n<p>How can I get the handles of <strong>both</strong> text fields using WinAPI calls?</p>\n\n<p>Note: Both text boxes belong to a different application (I make the WinAPI calls in application A and the text boxes are located in application B).</p>\n\n<p><strong>Update 1:</strong></p>\n\n<p>I get <code>Invalid window handle</code> message when invoking <code>GetClassName</code>.</p>\n\n<p>I suppose that something is wrong with my declaration of the callback function.</p>\n\n<p><code>EnumChildWindows</code> is invoked from one of the methods of <code>TMyClass</code> like this:</p>\n\n<pre><code>EnumChildWindows(handle, @TMyClass.CBList, 0);\n</code></pre>\n\n<p>Here's the code of the callback function.</p>\n\n<pre><code>function TMyClass.CBList(Win: THandle; lp: LPARAM): Boolean; stdcall;\nvar\n  ClassName:array [1..1024] of Char;\nbegin\n  GetClassName(Win, PChar(@ClassName), 1024);\n  OutputDebugString(PChar('SysErrorMessage(GetLastError): '));\n\n  result := true;\nend;\n</code></pre>\n"},{"tags":["visual-studio","winapi","mfc","resource-file"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12929934,"title":"Same resource identifier in different language sections in an RC file, why is it possible?","body":"<p>I have noticed that an RC file can have duplicate resources (i.e. the same resource identifier), so long as they are in different language sections.</p>\n\n<p>For example, this compiles without errors in my rc file:</p>\n\n<pre><code>#define IDS_STRING_001 10001\n\nLANGUAGE LANG_ENGLISH, SUBLANG_DEFAULT\nSTRINGTABLE\nBEGIN\n    IDS_STRING_001 \"English\"\nEND\n\nLANGUAGE LANG_JAPANESE, SUBLANG_DEFAULT\nSTRINGTABLE\nBEGIN\n    IDS_STRING_001 \"Japanese\"\nEND\n</code></pre>\n\n<p>Why is this possible? Is it intended to be used as an alternative way of localization, instead of using a separate DLL to hold the localized resources?</p>\n"},{"tags":["c++","c","winapi","visual-c++"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":98,"score":2,"question_id":12929554,"title":"Static Text Color","body":"<p>I have written Following code which will apply color to all static text in one window, but \nI want to apply two different colors in one window like ID:1234 where ID is another color and 1234 will be different color in one window. How? </p>\n\n<pre><code>case WM_CTLCOLORSTATIC:\n\nSetBkColor(hdc,COLORREF(::GetSysColor(COLOR_3DFACE)));    \n//sets bckcolor of static text same as window color\n\nif ((HWND)lParam == GetDlgItem(hWnd,IDC_PID) ) \n{\n    SetTextColor((HDC)wParam, RGB(250,50,200));\n    return (BOOL)CreateSolidBrush (GetSysColor(COLOR_3DFACE));\n}\n\nbreak;\n</code></pre>\n"},{"tags":["c","winapi","bots","irc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12926012,"title":"C - irc bot skeleton","body":"<pre><code>#include &lt;winsock2.h&gt;\n#include &lt;stdio.h&gt;\n\nconst int PORT = 6667;\nconst char *SERVER = \"irc.freenode.org\";\nconst char *CHAN = \"#channela\";\nconst char *NICK = \"loveMilk\";\n\nconst int MAX_BUFF_SIZE = 512;\n\nint sock_conn(SOCKET *socketn, const char *HOST, int portn);\nint sock_send(SOCKET *socketn, char* msg, ...);\n\nint main(int argc, char *argv[])\n{\n    WSADATA wsadata;\n    char buff[MAX_BUFF_SIZE];\n    char oBuff[MAX_BUFF_SIZE];\n    int buffRec;\n\n    if (WSAStartup(MAKEWORD(2,2), &amp;wsadata) != 0)\n        return 0;\n\n    SOCKET sock;\n\n    if(sock_conn(&amp;sock, SERVER, PORT) != 0)\n    {\n        WSACleanup();\n        return 0;\n    }\n\n    printf(\"connected.\\n\");\n\n    sock_send(&amp;sock, \"USER %s \\\"\\\" \\\"127.0.0.1\\\" :%s\\r\\n\", NICK, NICK);\n    sock_send(&amp;sock, \"NICK %s\\r\\n\", NICK);\n    Sleep(100);\n\n    sock_send(&amp;sock, \"JOIN %s\\r\\n\", CHAN);\n    printf(\"Joined channel.\\n\");\n\n    while(1)\n    {\n        memset(buff, 0, MAX_BUFF_SIZE);\n        memset(oBuff, 0, MAX_BUFF_SIZE);\n\n        buffRec = recv(sock, buff, MAX_BUFF_SIZE, 0);\n        if((buffRec == 0) || (buffRec == SOCKET_ERROR)) break;\n\n        if(buff[0] != ':')\n        {\n            strcpy(oBuff, \"PONG :\");\n            printf(\"PONG\");\n            sock_send(&amp;sock, oBuff);\n        }\n        else\n        {\n            if(strstr(buff, \"PRIVMSG\"))\n            {\n                int i, num = 0;\n                for(i = 0; i &lt; strlen(buff); ++i) if(buff[i] = ' ') ++num;\n                char** parts = malloc(sizeof(char*) * num);\n                char *p;\n                p = strtok(buff, \" \");\n                int j = 0;\n                while(p != NULL)\n                {\n                    parts[j] = p;\n                    j++;\n                    p = strtok(NULL, \" \");\n                }\n\n                free(parts);\n            }\n        }\n    }\n    closesocket(sock);\n    return 1;\n}\n\nint sock_conn(SOCKET *socketn, const char *HOST, int portn)\n{\n    WSADATA wsadata;\n    SOCKADDR_IN sockA;\n    LPHOSTENT hostE;\n\n    if(WSAStartup(MAKEWORD(2,2), &amp;wsadata) == -1) return -1;\n    if(!(hostE = gethostbyname(HOST)))\n    {\n        WSACleanup();\n        return -1;\n    }\n    if ((*socketn = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)) == INVALID_SOCKET)\n    {\n        WSACleanup();\n        return -1;\n    }\n\n    sockA.sin_family = AF_INET;\n    sockA.sin_port = htons(portn);\n    sockA.sin_addr = *((LPIN_ADDR)*hostE-&gt;h_addr_list);\n\n    if(connect(*socketn, (LPSOCKADDR)&amp;sockA, sizeof(struct sockaddr)) == SOCKET_ERROR)\n    {\n        WSACleanup();\n        return -1;\n    }\n}\n\nint sock_send(SOCKET *socketn, char* msg, ...)\n{\n    char buff[MAX_BUFF_SIZE];\n    va_list va;\n    va_start(va, msg);\n    vsprintf(buff, msg, va);\n    va_end(va);\n    send(*socketn, buff, strlen(buff), 0);\n    return 1;\n}\n</code></pre>\n\n<p>If I try to print <code>buff</code> after the <code>if(strstr(buff, \"PRIVMSG\"))</code> it crashes.</p>\n\n<p>The while with the <code>strtok</code> won't work, if I try to reach <code>parts[0]</code> it crashes.</p>\n\n<p>I tried to print <code>parts[0]</code> but shows nothing, tried to print during the while loop, shows nothing.\nwhy?</p>\n"},{"tags":["windows","winapi","desktop-application","windows-update","wmic"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12818231,"title":"What exactly IUpdate::BundledUpdates retreives?","body":"<p>When we try to retrieve the Windows Update Information with WUA API, the following is the process I have followed. But I am bit confused with IUpdate::BundledUpdates propertly.</p>\n\n<ol>\n<li>Create an IUpdateSearcher </li>\n<li>Search based on a search criteria. I provided search criteria as \"IsHidden=1 or IsInstalled=1\"</li>\n<li>You will have a IUpdateCollection as result of search.</li>\n<li>Using get_Item in IUpdateCollection, I retreived each update (IUpdate) and printed the required values (KB numbers in my case).</li>\n<li>But again in IUpdate, you have a BundledUpdate property that gives IUpdateCollection with get_BundledUpdates() method. When I iterated over the results of BundledUpdates, I have got no results.</li>\n</ol>\n\n<p>Am I Missing something in retrieving bundled updates? (OR) does the criteria I specified includes Bundled Updates as part of first result set of IUpdateCollection?</p>\n\n<p>Also in MSDN, examples are lacking for each interface in WUA API, Could someone provide any resources that explains clearly what each interface in WUA API does?</p>\n\n<p>Added full source code of C++ console Application:</p>\n\n<pre><code>#include &lt;wuapi.h&gt;\n#include &lt;iostream&gt;\n#include &lt;wuerror.h&gt;\n\nusing namespace std;\n\n\nint main()\n{\n\n    HRESULT hr;\n    hr = CoInitialize(NULL);\n\n    IUpdateSession* iUpdate;\n    IUpdateSearcher* searcher;\n    ISearchResult* results;\n    BSTR criteria = SysAllocString(L\"IsInstalled=1 or IsHidden=1 or IsPresent=1\");\n\n    hr = CoCreateInstance(CLSID_UpdateSession, NULL, CLSCTX_INPROC_SERVER,\n        IID_IUpdateSession, (LPVOID*)&amp;iUpdate);\n    hr = iUpdate-&gt;CreateUpdateSearcher(&amp;searcher);\n\n    wcout &lt;&lt; L\"Searching for updates ...\"&lt;&lt;endl;\n    hr = searcher-&gt;Search(criteria, &amp;results);\n    SysFreeString(criteria);\n\n    switch(hr)\n    {\n    case S_OK:\n        wcout&lt;&lt;L\"List of applicable items on the machine:\"&lt;&lt;endl;\n        break;\n    case WU_E_LEGACYSERVER:\n        wcout&lt;&lt;L\"No server selection enabled\"&lt;&lt;endl;\n        return 0;\n    case WU_E_INVALID_CRITERIA:\n        wcout&lt;&lt;L\"Invalid search criteria\"&lt;&lt;endl;\n        return 0;\n    }\n\n    IUpdateCollection * updateList;\n    IUpdate *updateItem;\n    LONG updateSize;\n    BSTR updateName;\n\n    results-&gt;get_Updates(&amp;updateList);\n    updateList-&gt;get_Count(&amp;updateSize);\n\n    if (updateSize == 0)\n    {\n        wcout &lt;&lt; L\"No updates found\"&lt;&lt;endl;\n    }\n\n    for (LONG i = 0; i &lt; updateSize; i++)\n    {\n        IStringCollection *KBCollection;\n        LONG KBCount;\n        updateList-&gt;get_Item(i, &amp;updateItem);\n        updateItem-&gt;get_KBArticleIDs(&amp;KBCollection);\n        KBCollection-&gt;get_Count(&amp;KBCount);\n        for(int k=0;k&lt;KBCount;k++)\n        {\n            BSTR KBValue;\n            KBCollection-&gt;get_Item(k,&amp;KBValue);\n            wcout &lt;&lt; L\"KB\" &lt;&lt; KBValue &lt;&lt; endl;\n        }\n\n        //Retrieve the bundled updates\n        IUpdateCollection *updtCollection;\n        updateItem-&gt;get_BundledUpdates(&amp;updtCollection);\n        LONG updtBundledCount;\n        updtCollection-&gt;get_Count(&amp;updtBundledCount);\n        for(LONG j=0;j&lt;updtBundledCount;j++)\n        {\n            cout&lt;&lt;\"Bundled KBs\" &lt;&lt;endl;\n            IUpdate *bundledUpdateItem;\n            updtCollection-&gt;get_Item(j,&amp;bundledUpdateItem);\n            bundledUpdateItem-&gt;get_KBArticleIDs(&amp;KBID);\n            if(KBID != NULL)\n            {\n                LONG KBCount;\n                BSTR KBIDValue;\n\n                KBID-&gt;get_Count(&amp;KBCount);\n                for(LONG j=0;j&lt;KBCount;j++)\n                {\n\n                    wcout &lt;&lt; \"KB\" &lt;&lt;(KBIDValue) &lt;&lt; endl;\n                    temp.setKBID(KBIDValue);\n                }\n            }\n        }\n    }\n\n    wcout &lt;&lt; L\"Total KB Count : \" &lt;&lt; updateSize &lt;&lt; endl;\n    CoUninitialize();\n\n    return 0;\n}\n</code></pre>\n"},{"tags":["winapi","heap","shared-memory"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":12761938,"title":"(Win32) Heap shared between processes","body":"<p>Is it possible to create a memory pool shared between processes (for example from <code>CreateFileMapping</code> with <code>INVALID_HANDLE_VALUE</code> in Win32) and then use that chunk of memory as a heap ?</p>\n\n<p>I would like the <code>new</code>/<code>delete</code> operators (or <code>malloc</code>/<code>free</code>) to allocate/free memory from that chunk (and do their usual heap management on it).</p>\n\n<p>Thanks.</p>\n\n<p><strong>EDIT</strong>: My real problem is simple: for now I use the <code>new</code> operator to allocate various large series of structures normally, but I want these structures to persist after the process closes. So I would like to create another process whose almost only function is to hold the memory when the main process closes.</p>\n\n<p>For that, I would create a chunk of shared memory with <code>CreateFileMapping</code> in the auxiliary process, and, in the main process, tell those <code>new</code>/<code>delete</code> used to allocate the structures to use that chunk instead of the process's heap.</p>\n\n<p>To recover the structures after the main processes is relaunched, I would add a fixed amount to all the pointers, reflecting the different origins of the mapped view returned by <code>MapViewOfFile</code>.</p>\n"},{"tags":["c","winapi","buffer"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":69,"score":3,"question_id":12925513,"title":"warning: assignment from incompatible pointer type buffer","body":"<pre><code>for(i = 0; i &lt; sizeof(buff); i++) if(buff[i] = ' ') ++num;\nchar **parts[num];\nchar *p;\np = strtok(buff, \" \");\nint j = 0;\nwhile(p != NULL)\n{\n         parts[j] = p;\n         j++;\n         p = strtok(NULL, \" \");\n}\n</code></pre>\n\n<p>the error is warning: assignment from incompatible pointer type, where parts[j] = p is.\nWhat can I do?</p>\n"},{"tags":["c","winapi","sockets"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12924948,"title":"How to find out if a socket is closed","body":"<p>I have a simple client server program that I made but the main issue is that once a connection is established between the client and server, if the client closes the program, the server repeatedly executes the last message and that creates huge problems sometimes. So what I want to is if there is any function that I can call to get the state of a SOCKET structure so if the client closes the program, the server will know to stop. I just need the function what to look for from the function for a bad socket. By the way I am writing this program in Win32 c. I tried if(mySocket==SOCKET_ERROR) which didn't seem to work... unless I used it wrong. I'm just beginning networking.</p>\n\n<pre><code>if(!sockServer.RecvData( recMessage, STRLEN )){return 0;}\n// where\nbool Socket::RecvData( char *buffer, int size )\n{\n    int i = recv( mySocket, buffer, size, 0 );\n    if(!i){return false;}\n    buffer[i] = '\\0';\n    return true;\n}  //this isn't working\n</code></pre>\n"},{"tags":["winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":52,"score":-1,"question_id":12924561,"title":"How do I add buttons to a Win32 App? C++","body":"<p>I have created a new Win32 project in Visual Studio 2010 and I wish to add a button/buttons to the top of the window. I have created and saved the design of the icon(it seems to have been saved as an .iso file in my project folder) but I don't know how to get it to appear on screen and active.</p>\n\n<p>I currently just have the default code from when a win32 project is created.</p>\n"},{"tags":["delphi","winapi","winsock","rtsp","tcp-ip"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":143,"score":3,"question_id":12878373,"title":"How to test a network device for a valid RTSP stream?","body":"<p>I am working on a project which streams video/audio through RTSP using VLC Media Player plugin. I would like to provide an option to scan the network for RTSP cameras. I'm sure this will consist of querying a list of all network devices, and testing for port 554. All this I can take care of. However, once I have gotten this far, how do I test the device through port 554 to make sure it's a valid RTSP camera?</p>\n\n<p>I'm assuming there should be something in <code>Winsock</code> to be able to do this, but how should I test a socket connection and make sure it's a valid RTSP stream which I can connect to? Whatever method is used, I shouldn't have to attempt to connect via RTSP to each using any sort of authentication, I'm looking for a lower-level way of determining if the port 554 is actually providing an RTSP stream.</p>\n"},{"tags":["c++","winapi","command-line"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":103,"score":1,"question_id":12921680,"title":"How to execute a simple command line with CreateProcess?","body":"<p>I'd like to execute a simple command line but without to make a window appear. Therefore I can't use System and have to use CreateProcess as far as I know.\nSo I have the following code for example:</p>\n\n<pre><code>//.../\n\nCreateProcess(NULL,input,NULL,NULL,false,NORMAL_PRIORITY_CLASS | \n CREATE_NO_WINDOW,NULL,NULL,&amp;startInf,&amp;procInf);//)\n\n//.../\n</code></pre>\n\n<p>If input is a line like <em>\"ping www.google.com -n 2\"</em> it seems to work.\nWhat I need is the deletion-function though.\nTherefore I tried a lot of variations like: </p>\n\n<pre><code>input = \"rd /S /Q \\\"D:\\\\ALEX_DATEN\\\\PC\\\\C++\\\\bla\\\"\";\n</code></pre>\n\n<p>and </p>\n\n<pre><code>  input = \"rd /S /Q \\\"D:/DATEN/PC/C++/bla\\\"\";\n</code></pre>\n\n<p>But nothing happens and the function returns failure :/\nIf I write it as a .bat file (without using the \"\\\" escaping chars) the deleting works perfectly!</p>\n\n<p>Does anyone know what I'm doing wrong?</p>\n\n<p>P.s. no, I'm not writing a destructive virus.. if that would have been my target, I would have definitely have found simpler ways...</p>\n"},{"tags":["c++","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":157,"score":0,"question_id":12922303,"title":"Stack overflow in recursive function","body":"<p>I am writing a simple app that outputs all files in some directory to console. To achieve  this I dynamically allocate memory in function <code>PathCreator()</code> and return a pointer to this memory. I don't know how to correctly free this memory segment in <code>GetAllFiles()</code>. When I use the code below I get a stack overflow exception. How can I fix this? Please don't offer me to use something that doesn't need dynamically allocated memory, I just want to fix my code.</p>\n\n<pre><code>#include \"stdafx.h\"\n#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\nwchar_t *PathCreator(wchar_t *dir, wchar_t *fileName);\nint is_directory(wchar_t *p)\n{\n    wchar_t *t = PathCreator(p,L\"\\\\\");\n    WIN32_FIND_DATA file;\n    HANDLE search_hendle = FindFirstFile(t, &amp;file);\n    long error = GetLastError();\n    if(error == 267)\n    {\n        return 0;\n    }\n    else\n    {\n        return 1;\n    }\n}\n\nwchar_t *PathCreator(wchar_t *dir, wchar_t *fileName)\n{\n    wchar_t* path = 0;\n    int size = 0;\n    wchar_t *d = dir;\n    wchar_t *f = fileName;\n    while(*d != '\\0')\n    {\n        d++;\n        size++;\n    }\n    while(*f != '\\0')\n    {\n        f++;\n        size++;\n    }\n    path = new wchar_t[(size+=3) * sizeof(wchar_t)];\n    int j = 0;\n    while(j &lt; size)\n    {\n        path[j] = '\\0';\n        j++;\n    }\n    int i;\n    i = 0;\n    while(*dir != '\\0')\n    {\n        path[i] = *dir;\n        i++;\n        dir++;\n    }\n    path[i++] = '\\\\';\n    wchar_t *t = fileName;  \n    while(*t != '\\0')\n    {\n        path[i] = *t;\n        i++;\n        t++;\n    }\n    path[i] = '\\0';\n    return path;\n} \n\nvoid GetAllFiles(wchar_t* dir)\n{\n    wchar_t *p = 0;\n\n    int i = 0;\n    WIN32_FIND_DATA file;\n    wchar_t *t = PathCreator(dir, L\"*\");\n    HANDLE search_hendle = FindFirstFile(t, &amp;file);\n    if(search_hendle)\n    {\n\n        do\n        {\n            p = PathCreator(dir,file.cFileName);\n            if(!is_directory(p))\n            {\n                std::wcout &lt;&lt; p &lt;&lt; std::endl;\n            }\n            else\n            {\n                GetAllFiles(p);\n            }\n            delete [] p;\n        }\n        while(FindNextFile(search_hendle, &amp;file));\n\n    }\n    delete [] t;\n    FindClose(search_hendle);\n}\n\n\nint _tmain(int argc, _TCHAR* argv[])\n{\n    GetAllFiles(L\"C:\\\\Users\");\n}\n</code></pre>\n"},{"tags":["c","winapi","screenshot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":44,"score":-4,"question_id":12922662,"title":"SaveBMPFile undefined reference","body":"<p>I got the code snippet from here: <a href=\"http://stackoverflow.com/questions/3370702/c-take-screenshot\">link</a></p>\n\n<p>The error is: Undefined reference to <code>SaveBMPFile</code>\nThanks in advance.</p>\n"},{"tags":["winapi","audio","mp3"],"answer_count":3,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":89,"score":5,"question_id":12878812,"title":"simple .wav or .mp3 playbck in Windows - where has it gone?","body":"<p>Is there a \"modern\" replacement for the old Windows sndPlaySound() function, which was a very convenient way of playing a .wav file in the background while you focused on other matters?  I now find myself needing to play an .mp3 file in the background and am wondering how to accomplish the same thing in a relatively easy way that the system supports inherently.  Perhaps there's a COM component to acccomplish basic .mp3 playback?</p>\n"},{"tags":["winapi","ras","baud-rate"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":355,"score":1,"question_id":5098725,"title":"setting baud rate on dial-up connection win32","body":"<p>I am creating dial-up connection in code in Windows XP and Windows 7 (RasSetEntryProperties).  The entries come up with the default baud rate of 19200.</p>\n\n<p>Using Win32 how do I change the baud rate in both Windows XP and Windows 7?</p>\n"},{"tags":["winapi","process","creation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12920560,"title":"How to Create Several Processes with WINDOWS API?","body":"<p>I am trying to create five processes that use child process and prints the given arguments on the screen. However, I only see one new terminal opened. How can i see those five processes, each one opened in seperate terminal?</p>\n\n<p>Here is my parent.c :</p>\n\n<pre><code>  #include &lt;Windows.h&gt;\n  #include &lt;stdio.h&gt;\n  #include &lt;string.h&gt;\n\n  #define PROCESSES 5\n  #define MAX_LINE_LEN 100\n\n  void main()\n  {\nchar * appName, * cmdLine;\nchar buffer[MAX_LINE_LEN];\nSTARTUPINFO si[PROCESSES];\nPROCESS_INFORMATION pi[PROCESSES];\nHANDLE process[PROCESSES];\nint i;\nint first_space;\n\nsystem(\"cd\");\n\nfor(i = 0; i &lt; PROCESSES; i++)\n{\n    gets(buffer);\n    /*\n    appName = strtok(buffer,\" \");\n    cmdLine = strtok(NULL,\"\\0\");\n    */\n\n    appName = buffer;\n    for(cmdLine = buffer; *cmdLine!=' '; cmdLine++);\n    *cmdLine = '\\0';\n    cmdLine++;\n\n    ZeroMemory(&amp;si[i], sizeof(STARTUPINFO));\n    si[i].cb = sizeof(STARTUPINFO);\n\n    if( !CreateProcess( appName,\n                        cmdLine,\n                        NULL,\n                        NULL,\n                        FALSE,\n                        CREATE_NEW_CONSOLE,\n                        NULL,\n                        NULL,\n                        &amp;si[i],\n                        &amp;pi[i]))\n    {\n        printf(\"Unable to create process: %d\\n\",GetLastError());\n        system(\"pause\");\n        ExitProcess(1);\n    }\n    else\n    {\n        printf(\"Created child process %s with command line %s\", appName, cmdLine);\n    }\n}\n\nfor( ; i &gt; 0; i--)\n{\n    TerminateProcess(pi[i].hProcess, 1);\n    CloseHandle(pi[i].hProcess);\n}\n  }//main\n</code></pre>\n\n<p>My child process child.c :</p>\n\n<pre><code>  #include &lt;stdio.h&gt;\n  #include &lt;Windows.h&gt;\n\n\n  void main(int argc, char * argv[])\n   {\n int i;\n\nfor(i = 0; i &lt; argc ; i++)\n{\n    printf(\"Argument #%d is: %s\\n\", i, argv[i]);\n}\n\nsystem(\"pause\");\n\n    }\n</code></pre>\n"},{"tags":["c#","file","winapi","sharepoint","printing"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12918698,"title":"Which Windows Print API to call from .net program","body":"<p>I need to print my Files found in my SPFolder directly  to the Printer without recognizing the file type, so which Windows API to call and how to call it ?\nAlso what's the process to launch the printing job when there are many files to print at the same time ?</p>\n"},{"tags":["c++","visual-studio","debugging","winapi","assert"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12916489,"title":"How to disable assert error dialog in child process","body":"<p>I'm creating child processes with CreateProcess function in MSVC++ 2010, and before that setting error level with SetErrorMode(SEM_FAILCRITICALERRORS | SEM_NOGPFAULTERRORBOX);</p>\n\n<p>The task is to run console programs and hide any annoying messages like famous \"Don't send\" dialog preventing program from being normally finished after critical error.</p>\n\n<p>So, if i create child process containing some error(for example division by 0) it works fine, but when i create subprocess with vector index overflow it causes nonavoidable assert error message(in Debug mode of course). Here is the code of this program:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;vector&gt;\n\nint main(int argc, char *argv[])\n{\n    int index = atoi(argv[1]);\n    switch(index)\n    {\n    case 0:\n    {\n        int k = 3, j = 3;\n        j -= k;\n        k = k/j;//division by zero\n    }\n    case 1:\n    {\n        std::vector&lt;int&gt; k(2);\n        int i = k.at(2);//index is out of bounds and it causes assert failure\n    }\n    }\n}\n</code></pre>\n\n<p>In Release configuration it works fine, but in Debug - it causes an assert error dialog. Of course I can just add <a href=\"http://msdn.microsoft.com/en-us/library/e631wekh.aspx\" rel=\"nofollow\">_set_abort_behavior</a> to child program code, but it is not an option for me.</p>\n\n<p>Is there any way to surpass this assert error dialog for programs compiled in Debug configuration?</p>\n"},{"tags":["c++","winapi","mfc","ms-media-foundation"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12917256,"title":"Windows Media Foundation recording audio","body":"<p>I'm using the windows media foundation api to enumerate both my microphones and available cameras, which both work.</p>\n\n<p>Here is my enumeration code:</p>\n\n<pre><code>class deviceInput {\npublic:\n    deviceInput( REFGUID source );\n    ~deviceInput();\n\n    int listDevices(bool refresh = false);\n    IMFActivate *getDevice(unsigned int deviceId);\n    const WCHAR *getDeviceName(unsigned int deviceId);\n\nprivate:\n    void Clear();\n    HRESULT EnumerateDevices();\n\n    UINT32      m_count;\n    IMFActivate **m_devices;\n    REFGUID     m_source;\n};\n\ndeviceInput::deviceInput( REFGUID source )\n    : m_devices( NULL )\n    , m_count( 0 )\n    , m_source( source )\n{   }\n\ndeviceInput::~deviceInput()\n{\n    Clear();\n}\n\nint deviceInput::listDevices(bool refresh)\n{\n    if ( refresh || !m_devices ) {\n        if ( FAILED(this-&gt;EnumerateDevices()) ) return -1;\n    }\n    return m_count;\n}\n\nIMFActivate *deviceInput::getDevice(unsigned int deviceId)\n{\n    if ( deviceId &gt;= m_count ) return NULL;\n\n    IMFActivate *device = m_devices[deviceId];\n    device-&gt;AddRef();\n\n    return device;\n}\n\nconst WCHAR *deviceInput::getDeviceName(unsigned int deviceId)\n{\n    if ( deviceId &gt;= m_count ) return NULL;\n\n    HRESULT hr = S_OK;\n    WCHAR *devName = NULL;\n    UINT32 length;\n\n    hr = m_devices[deviceId]-&gt;GetAllocatedString( MF_DEVSOURCE_ATTRIBUTE_FRIENDLY_NAME, &amp;devName, &amp;length );\n    if ( FAILED(hr) ) return NULL;\n\n    return devName;\n}\n\nvoid deviceInput::Clear()\n{\n    if ( m_devices ) {\n        for (UINT32 i = 0; i &lt; m_count; i++) SafeRelease( &amp;m_devices[i] );\n        CoTaskMemFree( m_devices );\n    }\n    m_devices = NULL;\n    m_count = 0;\n}\n\nHRESULT deviceInput::EnumerateDevices()\n{\n    HRESULT hr = S_OK;\n    IMFAttributes *pAttributes = NULL;\n\n    Clear();\n\n    hr = MFCreateAttributes(&amp;pAttributes, 1);\n    if ( SUCCEEDED(hr) ) hr = pAttributes-&gt;SetGUID( MF_DEVSOURCE_ATTRIBUTE_SOURCE_TYPE, m_source );\n    if ( SUCCEEDED(hr) ) hr = MFEnumDeviceSources( pAttributes, &amp;m_devices, &amp;m_count );\n\n    SafeRelease( &amp;pAttributes );\n\n    return hr;\n}\n</code></pre>\n\n<p>To grab audio or camera capture devices, I specify either <code>MF_DEVSOURCE_ATTRIBUTE_SOURCE_TYPE_AUDCAP_GUID</code> or <code>MF_DEVSOURCE_ATTRIBUTE_SOURCE_TYPE_VIDCAP_GUID</code> and that works no problem, and I can grab the names of the devices, as well as the IMFActivate.  I have code to record the webcam to an output video file, however, I'm having a tough time figuring out how to record the audio to a file.  I'm under the impression that I need to use an IMFSinkWriter, but I can't find any examples that use an audio capture IMFActivate and IMFSinkWriter.</p>\n\n<p>I'm not much of a windows api programmer, so I'm sure there's a fairly straight forward answer, but COM stuff is just a bit over my head.  As far as audio format, I don't really care, as long as it gets into a file - can be wav, wma, or whatever.  Even though I'm recording video, I need the video and audio files separate, so I can't just figure out how to add the audio into my video encoding.</p>\n"},{"tags":["winapi","console"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":693,"score":3,"question_id":3193433,"title":"Make a win32 console app display a window","body":"<p>I've been developing a win32 console app and now I'd like it to be able to optionally show a non modal status / notification window. Is there any way I can do this from a console app or will I need to rewrite it as a windows app? </p>\n\n<p>This is for a kiosk system so I'll need to call SetWindowPos() with the topmost flag on the window handle.</p>\n"},{"tags":["c","image","winapi","turbo-c"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12912284,"title":"Opening an image file in the output screen","body":"<p>I want to create a photo viewer kind of software using C. But i am stuck at the point thinking that how would i load an image file in the output screen of C in Windows OS?</p>\n"}]}
{"total":13828,"page":6,"pagesize":100,"questions":[{"tags":["c++","winapi","wininet"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":12892830,"title":"InternetQueryOption crashes on Windows XP","body":"<p>The following code is more or less just copied from MSDN documentation. On Windows Vista and Windows 7 it works fine, but in crashes on XP with an access violation int the call to <code>InternetQueryOption</code>.\nAnyone got an idea what the problem could be?</p>\n\n<pre><code>int main(int argc, char* argv[])\n{\n\n  HINTERNET hInternet = InternetOpen(\"x\", INTERNET_OPEN_TYPE_DIRECT, NULL, NULL, 0);\n  //\n  // 1. Set\n  //\n  {\n    INTERNET_PER_CONN_OPTION_LIST    List;\n    INTERNET_PER_CONN_OPTION         Option[2];\n    unsigned long                    nSize = sizeof(INTERNET_PER_CONN_OPTION_LIST);\n\n    Option[0].dwOption = INTERNET_PER_CONN_AUTOCONFIG_URL;\n    Option[0].Value.pszValue = \"http://myserver/get_proxy_info.dll\";\n    Option[1].dwOption = INTERNET_PER_CONN_FLAGS;\n    Option[1].Value.dwValue = PROXY_TYPE_AUTO_PROXY_URL;\n\n    List.dwSize = sizeof(INTERNET_PER_CONN_OPTION_LIST);\n    List.pszConnection = NULL;\n    List.dwOptionCount = 2;\n    List.dwOptionError = 0;\n    List.pOptions = Option;\n\n    if(!InternetSetOption(hInternet, INTERNET_OPTION_PER_CONNECTION_OPTION, &amp;List, nSize))\n       printf(\"InternetQueryOption failed! (%d)\\n\", GetLastError());\n  }\n  //\n  // 2. Query\n  //\n  {\n    INTERNET_PER_CONN_OPTION_LIST    List;\n    INTERNET_PER_CONN_OPTION         Option[5];\n    unsigned long                    nSize = sizeof(INTERNET_PER_CONN_OPTION_LIST);\n\n    Option[0].dwOption = INTERNET_PER_CONN_AUTOCONFIG_URL;\n    Option[1].dwOption = INTERNET_PER_CONN_AUTODISCOVERY_FLAGS;\n    Option[2].dwOption = INTERNET_PER_CONN_FLAGS;\n    Option[3].dwOption = INTERNET_PER_CONN_PROXY_BYPASS;\n    Option[4].dwOption = INTERNET_PER_CONN_PROXY_SERVER;\n\n    List.dwSize = sizeof(INTERNET_PER_CONN_OPTION_LIST);\n    List.pszConnection = NULL;\n    List.dwOptionCount = 5;\n    List.dwOptionError = 0;\n    List.pOptions = Option;\n\n    printf(\"InternetQueryOption:\\n\");\n    if(!InternetQueryOption(hInternet, INTERNET_OPTION_PER_CONNECTION_OPTION, &amp;List, &amp;nSize))\n       printf(\"InternetQueryOption failed! (%d)\\n\", GetLastError());\n       if(Option[0].Value.pszValue != NULL)\n       printf(\"%s\\n\", Option[0].Value.pszValue);\n\n    if((Option[2].Value.dwValue &amp; PROXY_TYPE_AUTO_PROXY_URL) == PROXY_TYPE_AUTO_PROXY_URL)\n      printf(\"PROXY_TYPE_AUTO_PROXY_URL\\n\");\n\n    if((Option[2].Value.dwValue &amp; PROXY_TYPE_AUTO_DETECT) == PROXY_TYPE_AUTO_DETECT)\n       printf(\"PROXY_TYPE_AUTO_DETECT\\n\");\n\n    INTERNET_VERSION_INFO      Version;\n    nSize = sizeof(INTERNET_VERSION_INFO);\n\n    InternetQueryOption(hInternet, INTERNET_OPTION_VERSION, &amp;Version, &amp;nSize);\n\n    if(Option[0].Value.pszValue != NULL)\n       GlobalFree(Option[0].Value.pszValue);\n\n    if(Option[3].Value.pszValue != NULL)\n       GlobalFree(Option[3].Value.pszValue);\n\n    if(Option[4].Value.pszValue != NULL)\n       GlobalFree(Option[4].Value.pszValue);\n\n  }\n\n}\n</code></pre>\n\n<p>In Windows XP, it hits memory access violation trying to access something behind <code>NULL</code> pointer.</p>\n\n<pre><code>    wininet.dll!PROXY_SERVER_LIST::CopyString(void) Unknown\n    wininet.dll!PROXY_INFO::GetProxySettings(struct INTERNET_PROXY_INFO_EX *,int)   Unknown\n    wininet.dll!PROXY_INFO_GLOBAL::GetProxySettings(struct INTERNET_PROXY_INFO_EX *,int)    Unknown\n    wininet.dll!QueryPerConnOptions(void *,int,struct INTERNET_PER_CONN_OPTION_LISTA *) Unknown\n    wininet.dll!_InternetQueryOptionA@16()  Unknown\n&gt;   InternetQueryOption.exe!main(int argc=1, char * * argv=0x003e2e60) Line 55  C++\n    InternetQueryOption.exe!__tmainCRTStartup() Line 278    C\n</code></pre>\n"},{"tags":["c++","winapi","windows-7"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":93,"score":2,"question_id":12904681,"title":"CreateSymbolicLink equivalent to “mklink /J”?","body":"<p>Without admin privileges, I know I can create a symbolic link in command line:</p>\n\n<p>mklink /J LinkPath OriginalResourcePath</p>\n\n<p>In C++, I tried using CreateSymbolicLink; however, I got error \"A required privilege is not held by the client.\" Is there a way to create a symlink/junction to a directory without admin privileges, equipvalent to mklink /j?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c++","windows","image","winapi","bmp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12907286,"title":"When is WM_PAINT called?","body":"<p>When exactly is WM_PAINT called? Im trying to create a dialog based slot machine application, but i've run into a couple of logical issues. My application will consist of:</p>\n\n<ul>\n<li>\"Spin\" Button</li>\n<li>Exit Button</li>\n<li>Three BMP images to display the results of the spin(coin/heart/soldier)</li>\n</ul>\n\n<p>How will i show the final result of the spin using the BMP images? Am i correct in using WM_PAINT to attempt to display the images, how will i refresh the screen each time the user presses the spin button to show the new images? I really appreciate the help!</p>\n"},{"tags":["windows","delphi","winapi","delphi-7"],"answer_count":2,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":163,"score":6,"question_id":12880144,"title":"Get FileSystem Restrictions","body":"<p>I would like to code a function that tells me if it's possible to WRITE a file/folder to a specific path or not. I would like to do that WITHOUT actually writing any file(s) to the disk. Is there a WINAPI function for that? \nThank you for your help.</p>\n"},{"tags":["windows","winapi","user-interface","aero"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":68,"score":2,"question_id":12907441,"title":"Is there a way to change the Windows Aero colours in the non client area?","body":"<p>I noticed Windows has made the non-client area of windows automatically the color of the theme - Windows Aero. This is a great idea I think, because it makes the theme consistent across programs and a generally nicer interface. As a devious individual, I aspire to subvert Microsoft's intention here and get a GUI happening that uses a color set by my program, not the operating system's setting. </p>\n\n<p>Thoughts?</p>\n"},{"tags":["c#",".net","winforms","winapi","events"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12891998,"title":"Disappearing FormClosing/FormClosed events","body":"<p>Following code snippet may look weird, but it is a very simple method to reproduce the problem of a complicated interaction with a different application.</p>\n\n<p>The example application has two forms, both forms register FormClosing and FormClosed events, just doing a Debug.WriteLine there.</p>\n\n<p>The Main function does:</p>\n\n<pre><code>[STAThread]\nstatic void Main()\n{\n    Application.EnableVisualStyles();\n    Application.SetCompatibleTextRenderingDefault(false);\n    Form2 form2 = new Form2();\n    form2.Show();\n    Application.Run(new Form1());\n}\n</code></pre>\n\n<p>When I close Form2, I receive the events as expected. When I close Form1, the application exits and Form2 gets closed too. But: the events of Form2 do not occur.</p>\n\n<p>I overrode the WndProc of Form2. When I close Form2, I receive</p>\n\n<pre><code>15.10.2012 10:25:04 WndProc - WM_CLOSE\n15.10.2012 10:25:04 OnClosing\n15.10.2012 10:25:04 Form2_FormClosing\n15.10.2012 10:25:04 OnClosed\n15.10.2012 10:25:04 Form2_FormClosed\n...\n15.10.2012 10:25:04 WndProc - WM_DESTROY\n...\n15.10.2012 10:25:04 WndProc - WM_NCDESTROY\n</code></pre>\n\n<p>When I close Form1, Form2 does not receive a WM_CLOSE. But WM_DESTROY and WM_NCDESTROY are received.</p>\n\n<p>Edit:\nA different way of getting this strange behavior is as follows:\nThe project has three forms, Form1 and Form2 have each a button for opening the next form. In the button click event of form2, do:</p>\n\n<pre><code>Form3 frm3 = new Form3();\nfrm3.Parent = null;\nfrm3.Show(null);\n</code></pre>\n\n<p>Again, register event handlers as described above. When closing form2, the application stays running (form1 is still shown), but also form3 gets closed, and no WM_CLOSE event received. Note that I already set both Parent and Owner of the form to null.</p>\n\n<p>What is the reason for that strange behavior?</p>\n"},{"tags":["winapi","dpi","screen-resolution"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1243,"score":0,"question_id":2630392,"title":"GetSystemMetrics() returns wrong value for SM_CXSCREEN","body":"<p>I've run into an interesting problem. At least in Vista, getSystemMetrics(SM_CXSCREEN) returns an incorrect value when the desktop DPI settings aren't set at 100%. For example, I tried 150% in a 1366x768 screen and getSystemMetrics() returns 911 instead of 1366 (and 1366 / 1.5 ~ 911)</p>\n\n<p>According to the MSDN, getSystemMetrics(SM_CXSCREEN) returns pixels, so I thought this value wouldn't be affected by the DPI settings - but it is. So is there a safer way to find out the true, unscaled screen resolution?</p>\n"},{"tags":["c++","winapi","firebreath"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12400164,"title":"How do i load libraries in firebreath under windows?","body":"<p>I'm trying to use some functions from user32.dll in a firebreath plugin, and i can't for the life of me figure out how to link the library to my project.  I've tried adding\nfind_library(USER32_LIBRARY user32) and some variations like user32.dll user32.lib, adding the path to system32, etc.  It keeps saying USER32_LIBRARY is defined but set to NOT_FOUND.</p>\n\n<p>I haven't found any good examples of how to link libraries from the system32 folder, anyone have an example?</p>\n"},{"tags":["c++","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":74,"score":-1,"question_id":12905811,"title":"Single query to win32 api that always returns same value","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/926172/how-to-hide-strings-in-a-exe-or-a-dll\">How to hide strings in a exe or a dll?</a>  </p>\n</blockquote>\n\n\n\n<p>I am looking for a win32api call, that will always return the same value, preferably a value viewable as a string, but other types are ok also. It must return the same value whether executed from Windows XP SP2 in Spanish or Windows 7 in English. I couldn't find any, and was hoping to get some help.</p>\n\n<p>I'm trying to hide strings in a C++ application by finding a constant variable from the API that will be equal across XP/7 &amp; different languages, to serve as the base of the encryption.</p>\n"},{"tags":["winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":228,"score":1,"question_id":3395246,"title":"remote desktop software","body":"<p>i want to know how remote desktop softer is done on windows os. (low level technical stuff)</p>\n\n<ul>\n<li>where is the best way to \"hook\" the gui from server host, and send it via tcp to client. so that client can see remote desktop. </li>\n</ul>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":168,"score":-3,"question_id":12899120,"title":"Using recursion to get all files in some directory","body":"<p>I try to write application that find all files in current diretory and it's subdirectories. I have next problem I can't completely understand</p>\n\n<ol>\n<li>How I need use recursion <code>GetFiles()</code> function in my case, and</li>\n<li>Where I need free memory that was dynamically allocated in <code>PathCreator()</code> function. When I'm testing this program only for some directory (without subdirectories) it works (look commented code in <code>_tmain()</code>). But when I'm try to get all files there is crash.</li>\n</ol>\n\n<p>Here is my code: </p>\n\n<pre><code>// ConsoleApplication1.cpp : Defines the entry point for the console application.\n//\n\n#include \"stdafx.h\"\n#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n#define SIZE 300\n\nint is_directory(wchar_t *p)\n{\n    wchar_t temp[300];\n    int i;\n    i = 0;\n    while(*p != '\\0')\n    {\n        temp[i] = *p;\n        p++;\n        i++;\n    }\n    temp[i] = '\\\\';\n    i++;\n    temp[i] = '\\0';\n    WIN32_FIND_DATA file;\n    HANDLE search_hendle = FindFirstFile(temp, &amp;file);\n    long error = GetLastError();\n    if(error == 267)\n    {\n        return 0;\n    }\n    else\n    {\n        return 1;\n    }\n}\n\n\nwchar_t *PathCreator(wchar_t *dir, wchar_t *fileName)\n{\n    wchar_t* path = new wchar_t[SIZE];\n    int j = 0;\n    while(j &lt; SIZE)\n    {\n        path[j] = '\\0';\n        j++;\n    }\n    int i;\n    i = 0;\n    while(*dir != '*' &amp;&amp; *dir != '\\0')\n    {\n        path[i] = *dir;\n        i++;\n        dir++;\n    }\n    wchar_t *t = fileName;  \n    while(*t != '\\0')\n    {\n        path[i] = *t;\n        i++;\n        t++;\n    }\n    path[i] = '\\0';\n    return path;\n} \n\nwchar_t* allFlsArr[SIZE];\nint i = 0;\nwchar_t **GetAllFiles(wchar_t* dir)\n{\n    WIN32_FIND_DATA file;\n    HANDLE search_hendle = FindFirstFile(dir, &amp;file);\n    if(search_hendle)\n    {\n        do\n        {\n            wchar_t *p = PathCreator(dir,file.cFileName);\n            allFlsArr[i++] = p;\n        }\n        while(FindNextFile(search_hendle, &amp;file));\n        allFlsArr[i] = '\\0';\n    }\n    CloseHandle(search_hendle);\n    return allFlsArr;\n}\n\nvoid GetFiles(wchar_t *dir)\n{\n    wchar_t **filePaths = 0;\n    filePaths = GetAllFiles(dir);\n    int  i = 0;\n    while(filePaths[i] != '\\0'){\n        if(!is_directory(filePaths[i]))\n        {\n            std::wcout &lt;&lt; filePaths[i] &lt;&lt; std::endl;\n        }\n        else\n        {\n            GetAllFiles(filePaths[i]);\n        }\n    }\n    delete [] filePaths;\n}\nint _tmain(int argc, _TCHAR* argv[])\n{\n    /*wchar_t **wch = GetAllFiles(L\"C:\\\\*\");\n    int i = 0;\n    while( *wch != '\\0')\n    {\n        std::wcout &lt;&lt; *wch &lt;&lt; std::endl;\n        wch++;\n    }*/\n    GetFiles(L\"C:\\\\*\");\n}\n</code></pre>\n"},{"tags":["c++","winapi","console-application"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":119,"score":0,"question_id":12900713,"title":"Reducing console size","body":"<p>I got a problem with changing console size. This is my code:</p>\n\n<pre><code>BOOL setConsole(int x, int y)\n{\nhStdin = GetStdHandle(STD_INPUT_HANDLE); \nhStdout = GetStdHandle(STD_OUTPUT_HANDLE); \nif (hStdin == INVALID_HANDLE_VALUE || \n    hStdout == INVALID_HANDLE_VALUE) \n{\n    MessageBox(NULL, TEXT(\"GetStdHandle\"),\n        TEXT(\"Console Error\"), MB_OK);\n    return false;\n}\n\n\nSMALL_RECT windowSize = {0, 0, x-1, y-1};\n\n// Change the console window size:\nSetConsoleWindowInfo(hStdout, TRUE, &amp;windowSize);\n\nCOORD c = { x, y};\n\n//Change the internal buffer size:\nSetConsoleScreenBufferSize(hStdout, c);\n\n\nSetConsoleDisplayMode(hStdout,CONSOLE_FULLSCREEN_MODE, &amp;c);\n\nreturn true;\n}\n</code></pre>\n\n<p>It works perfectly fine, when I try to enlarge the console. When one parameter is smaller than previous one nothing happens. What is wrong?</p>\n\n<p>@edit: after some tests I noticed, that resizing(reducing) is possible if I change one parameter at once. Example(assume console is 100x100)</p>\n\n<pre><code> setConsole(90,90); //dosen't work.\n setConsole(90,100);\n setConsole(90,90); // works perfectly\n</code></pre>\n\n<p>WHY?!</p>\n"},{"tags":["c++","c","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":61,"score":-1,"question_id":12861350,"title":"How to detach exe from process [WinAPI][C/C++]","body":"<p>How can i detach executable from its process using WinAPI (C/C++)?</p>\n\n<p>I found an application that releases files from processes, (\"Unlocker\") but I don't know how it works.</p>\n"},{"tags":["c++","winapi","processid"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":12900036,"title":"Benefit of Using WaitForSingleObject When Checking Process ID","body":"<p>What is the benefit of using <code>WaitForSingleObject</code> here as opposed to not using it? The first block of code is from a <a href=\"http://stackoverflow.com/a/1591371/195488\">previous answer</a>. The second block is how I am doing it.</p>\n\n<pre><code>BOOL IsProcessRunning(DWORD pid)\n{\n    HANDLE process = OpenProcess(SYNCHRONIZE, FALSE, pid);\n    DWORD ret = WaitForSingleObject(process, 0);\n    CloseHandle(process);\n    return (ret == WAIT_TIMEOUT);\n}\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>BOOL IsProcessRunning(DWORD pid)\n{\n   HANDLE process = \n      OpenProcess(PROCESS_QUERY_LIMITED_INFORMATION, FALSE, pid);\n   const bool exists = (hProcess != NULL);\n   CloseHandle(hProcess);\n   return exists;\n}\n</code></pre>\n\n<p>It seems like using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms684880%28v=vs.85%29.aspx\" rel=\"nofollow\">SYNCHRONIZE</a> requires higher privileges and I only want to check the PID for the current user.</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":12896764,"title":"Getting all files in current directory","body":"<p>I try to write function that return array of string(all files and folders that located in some directory). Code is below. When I use this code for output info to console (using comented code below) it work great, but when I am try return pointer to pointer to <code>wchar_t</code> I obtain array where every element is equal to enother(all elements are the same). What I do wrong?</p>\n\n<pre><code>wchar_t path[SIZE];\n    wchar_t *PathCreator(wchar_t *dir, wchar_t *fileName)\n    {\n        int j = 0;\n        while(j &lt; SIZE)\n        {\n            path[j] = '\\0';\n            j++;\n        }\n        int i;\n        i = 0;\n        while(*dir != '*' &amp;&amp; *dir != '\\0')\n        {\n            path[i] = *dir;\n            i++;\n            dir++;\n        }\n        wchar_t *t = fileName;  \n        while(*t != '\\0')\n        {\n            path[i] = *t;\n            i++;\n            t++;\n        }\n        path[i] = '\\0';\n        return path;\n    }\nwchar_t* allFlsArr[SIZE];\nint i = 0;\nwchar_t **GetAllFiles(wchar_t* dir)\n{\n    WIN32_FIND_DATA file;\n    HANDLE search_hendle = FindFirstFile(dir, &amp;file);\n    if(search_hendle)\n    {\n        do\n        {\n            wchar_t *p = PathCreator(dir,file.cFileName);\n            //std::wcout &lt;&lt; p &lt;&lt; std::endl;\n            allFlsArr[i++] = p;\n            std::wcout &lt;&lt; i &lt;&lt; std::endl;\n        }\n        while(FindNextFile(search_hendle, &amp;file));\n        allFlsArr[i] = '\\0';\n    }\n    CloseHandle(search_hendle);\n    return allFlsArr;\n}\n</code></pre>\n"},{"tags":["winapi","batch","batch-file","cmd"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":12898879,"title":"How to call a bat file in new window","body":"<p>I have a little bat file which calls other bat files:</p>\n\n<pre><code>cd C:\\Users\\Ofis\\heroku\\1134 &amp;&amp; call up.bat\ncd C:\\Users\\Ofis\\heroku\\5095 &amp;&amp; call up.bat\ncd C:\\Users\\Ofis\\heroku\\9469 &amp;&amp; call up.bat\n</code></pre>\n\n<p>It works good, but I want it call .bat files in new windows so it will be synchronous and faster.  How can I do this?</p>\n"},{"tags":["c++","winapi","visual-c++","hook"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12896937,"title":"From where do i can start learning about Windows API Hooking?","body":"<p>I am programming an exploit framework for windows using visual c++ 2008, i want to know more about api hooking, i googled but there are many things  i dont understand, are there any guides or tutorials that has a step by step guide to understand?</p>\n"},{"tags":["c++","winapi","function","visual-studio-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":2,"view_count":93,"score":1,"question_id":12898618,"title":"Is there WinAPI function 'ExistFile'?","body":"<p>Are there any WinAPI functions like ExistFile(...) and DeleteFile(...). And if there is any how can I use them? \nRegards</p>\n"},{"tags":["c++","winapi","unicode"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":130,"score":1,"question_id":12897752,"title":"How does one manipulate Unicode strings at the character level?","body":"<p>Sometimes manipulating character strings at the character level is unavoidable.</p>\n\n<p>Here I have a function written for ANSI/ASCII based character strings that replaces CR/LF sequences with LF only, and also replaces CR with LF.  We use this because incoming text files often have goofy line endings due to various text or email programs that have made a mess of them, and I need them to be in a consistent format to make parsing / processing / output work properly down the road.</p>\n\n<p>Here's a fairly efficient implementation of this compression from various line-endings to LF only, for single byte per character implementations:</p>\n\n<pre><code>// returns the in-place conversion of a Mac or PC style string to a Unix style string (i.e. no CR/LF or CR only, but rather LF only)\nchar * AnsiToUnix(char * pszAnsi, size_t cchBuffer)\n{\n    size_t i, j;\n    for (i = 0, j = 0; pszAnsi[i]; ++i, ++j)\n    {\n        // bounds checking\n        ASSERT(i &lt; cchBuffer);\n        ASSERT(j &lt;= i);\n\n        switch (pszAnsi[i])\n        {\n            case '\\n':\n                if (pszAnsi[i + 1] == '\\r')\n                    ++i;\n                break;\n\n            case '\\r':\n                if (pszAnsi[i + 1] == '\\n')\n                    ++i;\n                pszAnsi[j] = '\\n';\n                break;\n\n            default:\n                if (j != i)\n                    pszAnsi[j] = pszAnsi[i];\n        }\n\n    }\n\n    // append null terminator if we changed the length of the string buffer\n    if (j != i)\n        pszAnsi[j] = '\\0';\n\n    // bounds checking\n    ASSERT(pszAnsi[j] == 0);\n\n    return pszAnsi;\n}\n</code></pre>\n\n<p>I'm trying to transform this into something that will work correctly with multibyte/unicode strings, where the size of the next character can be multible bytes wide.</p>\n\n<p>So:  </p>\n\n<ol>\n<li>I need to look at a character only at a valid character-point (not in the middle of a character)  </li>\n<li>I need to copy over the portion of the character that is part of the rejected piece properly (i.e. copy whole characters, not just bytes)</li>\n</ol>\n\n<p>I understand that _mbsinc() will give me the address of the next start of a real character.  But what is the equivalent for Unicode (UTF16), and are there already primitives to be able to copy a full character (e.g. length_character(wsz))?</p>\n"},{"tags":["windows","winapi","filesystems","backup","ntfs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12874210,"title":"how to open a file by fileID and then use BackupFile API?","body":"<p>I'd like to open up a file by ID and then use the resulting handle in the Win32 API <code>BackupFile()</code></p>\n\n<p>Is this possible? I'm not certain if its 'okay' to use handles that come from <code>NtCreateFile()</code> in other Win32 APIs?</p>\n\n<p>For example,  may I do this</p>\n\n<pre><code>NtCreateFile(&amp;handle, ..., FILE_OPEN_BY_FILE_ID, ....)\nBackupFile(handle, ....)\n</code></pre>\n\n<p>I'm somewhat bothered by using <code>NtCreateFile</code>,  it's well documented on <a href=\"http://msdn.microsoft.com/en-us/library/bb432380%28v=VS.85%29.aspx\" rel=\"nofollow\">MSDN</a>  but they also mention compatibility problems could occur</p>\n\n<p>Any ideas?</p>\n"},{"tags":["c++","windows","winapi","mfc","menu"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12860563,"title":"Subclassing the System Menu","body":"<p>I have defined an owner drawn menu class. The class takes into account the <code>MeasureItem</code> issues of the system menu defined in <a href=\"http://www.codeproject.com/Articles/7021/MFC-extension-library-A-plugin-to-handle-owner-dra#problem3\" rel=\"nofollow\">this article</a> (ie adjusting the custom measurements based on whether the menu is system menu or not). However the problem I'm having is subclassing the system menu at the correct time. </p>\n\n<p>At the moment I have used both of the following code snippets to attempt to subclass it (in an overriden <a href=\"http://msdn.microsoft.com/en-us/library/e3h089yt%28v=vs.80%29.aspx\" rel=\"nofollow\"><code>CFrameWnd::LoadFrame</code></a>):</p>\n\n<ol>\n<li><p>Attempt 1: <code>mSysMenu</code> is a subclass of <code>CMenu</code>, which has also overridden <code>Attach</code> to automatically set the menu to owner draw (the bool parameter is just passed to notify whether it is a system menu or not)</p>\n\n<pre><code>mSysMenu.Attach(GetSystemMenu(FALSE)-&gt;GetSafeHmenu(), true);\n</code></pre>\n\n<p>This one fails when I right-click the taskbar button, generating 3 assertions in <code>wincore.cpp</code> (in <code>CWnd::OnMeasureItem</code>) and an ugly, deformed owner drawn menu - something to do with the <code>_AFX_THREAD_STATE</code> class.\nHowever when I call <code>TrackPopupMenu</code> on it from <code>OnLButtonDown</code> BEFORE I right click the task bar, eveything goes fine.</p></li>\n<li><p>Attempt 2: This one just creates a similarly deformed menu measurement but without any signs of owner drawn attempts</p>\n\n<pre><code>CVSPMenu* sysMenu = (CVSPMenu*)CMenu::FromHandle(GetSystemMenu(FALSE)-&gt;GetSafeHmenu());\nsysMenu-&gt;SetOwnderDrawn(true);\n</code></pre></li>\n</ol>\n\n<p>I've also tried doing things in <code>OnInitMenuPopup</code> but the menu pointer passed in doesn't seem to be and use (just causing assertions and failing).</p>\n\n<p>So my question is, how and where do I subclass the system menu?</p>\n"},{"tags":["winapi"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12872832,"title":"How do I create a capturable no-borders fullscreen window containing OpenGL content?","body":"<p><br>\nI have a no-borders fullscreen window created with the WinApi function CreateWindowEx :<br></p>\n\n<pre><code>    m_window = CreateWindowEx(\n        WS_EX_TOOLWINDOW | WS_EX_TOPMOST,\n        winClassName,\n        winName,\n        WS_VISIBLE | WS_POPUP,\n        CW_USEDEFAULT, CW_USEDEFAULT,\n        GetSystemMetrics(SM_CXSCREEN), GetSystemMetrics(SM_CYSCREEN),\n        NULL,\n        NULL,\n        hInstance,\n        NULL\n    );\n</code></pre>\n\n<p>If I try to take a screenshot of the window with the Print-Scr key, the window won't appear on the result (everything that is behind appears though).<br>\nUsing WS_POPUP as window style seems to be the source of the problem, but I couldn't find any other way to create a no-border window with the WinApi.</p>\n"},{"tags":["c","winapi","mingw","wic"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12895810,"title":"Can't link against WICConvertBitmapSource","body":"<p>I'd like to use a function from <code>WindowsCodecs.dll</code>, but MinGW has incomplete and missing WinAPI headers, as well as import libraries. Consider the following demo:</p>\n\n<pre><code>#define WIN32_LEAN_AND_MEAN\n#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n\n// ---------- dummy declarations, because MinGW got no wincodec.h ----------\ntypedef REFGUID REFWICPixelFormatGUID;\ntypedef VOID IWICBitmapSource;\n\nHRESULT WINAPI WICConvertBitmapSource(\n    REFWICPixelFormatGUID dstFormat,\n    IWICBitmapSource *pISrc,\n    IWICBitmapSource **ppIDst);\n// -------------------------------------------------------------------------\n\nint WINAPI WinMain(HINSTANCE hInst, HINSTANCE hPrev, LPSTR lpLine, int nShow)\n{\n#ifdef LOAD_FROM_DLL\n    typedef HRESULT (WINAPI *PWICConvertBitmapSource)(\n        REFWICPixelFormatGUID, IWICBitmapSource *, IWICBitmapSource **);\n\n    HMODULE hDll = LoadLibrary(\"WindowsCodecs.dll\");\n    PWICConvertBitmapSource pFunc =\n        (PWICConvertBitmapSource)GetProcAddress(hDll, \"WICConvertBitmapSource\");\n    printf(\"WICConvertBitmapSource: 0x%p.\\n\", pFunc);\n    pFunc(NULL, NULL, NULL);\n    FreeLibrary(hDll);\n#else\n    WICConvertBitmapSource(NULL, NULL, NULL);\n#endif\n    return 0;\n}\n</code></pre>\n\n<p>When built by <code>gcc test.c -DLOAD_FROM_DEF</code>, the program prints address of the function and terminates correctly. Although, when linked against the import library from the following def:</p>\n\n<pre><code>LIBRARY WindowsCodecs.dll\nEXPORTS\n    WICConvertBitmapSource@12\n</code></pre>\n\n<p>, this error pops out:</p>\n\n<pre><code>The procedure entry point WICConvertBitmapSource@12 could\nnot be located in the dynamic link library WindowsCodecs.dll.\n</code></pre>\n\n<p>Surprisingly enough, if I remove the declaration of <code>WICConvertBitmapSource</code> from the source and <code>@12</code> from def file, the program links and runs fine.</p>\n\n<p>How can I create a correct import library?</p>\n\n<p><strong>Notes:</strong> I'm running MinGW on Windows 7 SP1. My gcc version is 4.7.0 with w32api 3.17 installed. The problem appears with many functions, like <code>GdiAlphaBlend</code>, or <code>SHCreateStreamOnFileEx</code>.</p>\n"},{"tags":["c++","winapi","module"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12896654,"title":"All functions to load modules C++ Windows","body":"<p>I want to hook all functions which apllications use to load modules, i tried CreateFile and OpenFile functions, but application use these functions to load some files, not modules.</p>\n\n<p>Thanks!</p>\n"},{"tags":["c++","windows","winapi","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12893678,"title":"Invoking Win32 application from email body","body":"<p>I am working in an application. In this user enter his email id to get the some application setting.</p>\n\n<p>After some time he will get mail with settings embedded and an apply button. Once user click on that we need to set the setting (in some file or registry).</p>\n\n<p>Desktop application will read the setting(File / Registry) once it is launched. </p>\n\n<p>This is the requirement. My question is,</p>\n\n<p>How to call Win32/MFC application on clicking apply button with setting parameter.</p>\n"},{"tags":["winapi","visual-c++","hook"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":48,"score":-2,"question_id":12889698,"title":"GetMessage function Crashing","body":"<p>I am Hooking the function <code>GetMessage</code>, my code is as below . </p>\n\n<p><strong>Please go through it and find what is wrong with my code.</strong></p>\n\n<pre><code>#include \"stdafx.h\"\n#include &lt;windows.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;cstdio&gt;\n#include \"MinHook.h\"\n\n#if defined _M_X64\n#pragma comment(lib, \"libMinHook.x64.lib\")\n#elif defined _M_IX86\n#pragma comment(lib, \"libMinHook.x86.lib\")\n#endif\n\n#define WM_GETTEXT    0x000D\n\ntypedef BOOL ( WINAPI *GetMessageNext )( LPMSG lpMsg, HWND hWnd, UINT wMsgFilterMin, UINT wMsgFilterMax );\nGetMessageNext Real_GetMessage = NULL;\n\nBOOL WINAPI GetMessageCallback ( LPMSG lpMsg, HWND hWnd, UINT wMsgFilterMin, UINT wMsgFilterMax )\n{\nDWORD ProcessID;\nchar arr[20] = {0};\n\nif(hWnd != INVALID_HANDLE_VALUE)\n{\n    GetWindowThreadProcessId ( hWnd, &amp;ProcessID );\n    sprintf ( arr,  \"Pid From GetWindowThread = %d CurrentProccesId = %d\", ProcessID, GetCurrentProcessId() );\n    MessageBoxA(NULL, arr, \"Info\", MB_OK);\n\n    if(lpMsg-&gt;message == WM_GETTEXT &amp;&amp; ProcessID == GetCurrentProcessId())\n    {\n        MessageBoxA(NULL, \"GetMessage Called\", \"Info\", MB_OK);\n        return Real_GetMessage ( lpMsg, hWnd, wMsgFilterMin, wMsgFilterMax );\n    }\n}\nreturn 0;\n}\n\nBOOL APIENTRY DllMain ( HMODULE hModule, DWORD  ul_reason_for_call, LPVOID lpReserved ) \n{\nDisableThreadLibraryCalls(hModule);\nswitch (ul_reason_for_call)\n{\ncase DLL_PROCESS_ATTACH:\n\n    if (MH_Initialize() != MH_OK)\n    {\n        MessageBoxW(NULL, L\"Failed Initialize\", L\"Info!\", MB_ICONWARNING|MB_OK);    \n    }\n    if (MH_CreateHook(&amp;GetMessage, &amp;GetMessageCallback, reinterpret_cast&lt;void**&gt;(&amp;Real_GetMessage)) != MH_OK)\n    {\n        MessageBoxW(NULL, L\"DeviceIoControl Disabled by hooking\", L\"Info!\", MB_ICONWARNING|MB_OK);\n    }\n    if (MH_EnableHook(&amp;GetMessage) != MH_OK)\n    {\n        MessageBoxW(NULL, L\"Failed EnableHook DeviceIoControl\", L\"Info!\", MB_ICONWARNING|MB_OK);\n    }\n    break;\ncase DLL_PROCESS_DETACH:\n    if (MH_DisableHook(&amp;GetMessage) != MH_OK){}\n    if (MH_Uninitialize() != MH_OK){}\n    break;\n}\nreturn TRUE;\n}\n</code></pre>\n\n<p>In the above I am not getting the Proper ProcessId From GetWindowThread function and also this code is crashing so please help me.</p>\n"},{"tags":["windows","winapi","driver","modem"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":85,"score":2,"question_id":11611387,"title":"API to install driver from driverstore","body":"<p>Is there any APIs available to install the driver for my device say for example (PNPC031)  from the driverstore or from the inf folder?</p>\n"},{"tags":["windows","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12885264,"title":"Win32 C++ - Do something when window is restored, which message?","body":"<p>So, I have a dialog based application using pure WinAPI. There is a main dialog, and then multiple other dialogs that are toolwindows. These toolwindows are meant to free-float around, the user can drag them, hide them, and show them, but they have no taskbar entry. This is what I intended, but the problem is, when I switch from the main window to a different application, then click on the taskbar entry for the main window, the main window will show up, but the toolwindows will not. They stay hidden behind the main window and sometimes windows of other applications, and you cannot use them until you move all of the top-most windows and hunt down the toolwindow.</p>\n\n<p>So, what I'm trying to do to work around this is, when the user restores the window from being minimized, I want to enumerate through all of the tool windows and bring them to the front, maybe by calling <code>SetActiveWindow()</code>.</p>\n\n<p>But what message gets sent when the window is restored? I was thinking WM_SHOW, or WM_RESTORE, but they don't exist.</p>\n\n<p>Another question, and if you answer this the first question is irrelevant because I will no longer need to use that workaround: Is there a better method of bringing all tool-windows to the front?</p>\n"},{"tags":["c++","winapi","chars","reversing","lpstr"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":2,"view_count":102,"score":2,"question_id":12883035,"title":"(C++/WinAPI) Reversing LPSTR","body":"<p>i have some problems to reverse LPSTR.\nHere is my function:</p>\n\n<pre><code>LPSTR Reverse(LPSTR a_lpText)\n{\n   int nTextLength = strlen((char*)a_lpText);\n   LPSTR lpReversed = (LPSTR) GlobalAlloc(GPTR, nTextLength + 1);\n   for (int i = 0; i &lt; nTextLength; ++i)\n      *(lpReversed + i) = (CHAR) *(a_lpText + nTextLength - i);\n   return lpReversed;\n}\n</code></pre>\n\n<p>Function, return not initialized LPSTR or some strange characters.\nProblem is probably in conversion? Thanks for answers!</p>\n\n<p>Edit 1: strcat() don't work. I just want copy char by char.</p>\n\n<p>Edit 2: </p>\n\n<pre><code>*(lpReversed + i) = (CHAR) *(a_lpText + nTextLength - i - 1);\n</code></pre>\n\n<p>Freeze the whole program.</p>\n"},{"tags":["c++","windows","winapi","sockets","winsock"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12883918,"title":"closesocket() causes a \"proj.exe has triggered a breakpoint\"","body":"<p>I'm writing a client app in c++ for windows platform.\nIn cases where the server (<code>c#</code>) had already closed the session from his side,\nthis error arises , as I'm calling <code>closesocket</code>.</p>\n\n<p>while debugging, I saw that at that exact point, the socket handle is still valid, \nas expected. </p>\n\n<p>the VS debug output print is:</p>\n\n<p><code>Critical error detected c0000420 proj.exe has triggered a breakpoint</code></p>\n\n<p>witch is a rather odd exception message.</p>\n"},{"tags":["windows","winapi","win32gui"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12883028,"title":"PropertySheet with a TreeView (using WinAPI)","body":"<p>In my WinAPI program I use PropertySheet for a settings dialog box. I use property sheet with pages (tabs), i.e. I use PSH_PROPSHEETPAGE flag. But the software now have too many parameters for such a type of property sheet. So I want to use PropertySheet with treeview:  the treeview on the left and the page with paramerets for the currently selected item in the treeview - on the right.\nHow can I do this? Can my current property sheet be modified for this and how?\n(using only WinAPI, no MFC)</p>\n"},{"tags":["c++","c","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":74,"score":-1,"question_id":12881462,"title":"detecting a key pressed and key released event","body":"<p>The following function is called whenever keypress event occurs:</p>\n\n<pre><code>static LRESULT CALLBACK LowLevelKeyboardProc(int nCode, WPARAM wParam, LPARAM lParam) {\n\n   printf(\"Key is pressed !\\n\");\n   // If key pressed down,call function A\n   // If key released , call function B\n}\n</code></pre>\n\n<p>How do I detect these events ?</p>\n\n<p>The key pressed could be any key from a <em>window keyboard</em>.I just want to know whether a key was pressed or was released after pressing. How do I do this ?</p>\n"},{"tags":["winapi","copy"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":12881350,"title":"WinAPI how to detect in which control took place the copying","body":"<p>I wonder how to identify in my win32 application, in  which control the copying occurs.\nFor example in EditBox, in RichEdit and etc.</p>\n\n<p>In order to figure out whether the copying took place in my app or outside it, I used  the following method:</p>\n\n<pre><code>//global variables\n\nHWND hWnd; \nDWORD ProcId; \nHWND nextHandle; \nDWORD currentID;\n\n//then I call two functions on form create\n\ncurrentID=GetCurrentProcessId();\nnextHandle = SetClipboardViewer(Handle); \n\n//then on  WM_DRAWCLIPBOARD message I call \n\nhWnd = GetClipboardOwner();\nGetWindowThreadProcessId(hWnd,&amp;ProcId);\n\n// functions and checking by IDs whether\n// the copying took place in or outside my application \n\nif(lpdwProcessId==currentID) {...}\n</code></pre>\n\n<p>It works fine, but this is not a solution how to detect in whitch control (in my app) the copying occurs.</p>\n"},{"tags":["c#","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12880919,"title":"set format in DrawText win32 function","body":"<p>When I draw text by DrawText function of Win32 API<br>\nIs there a way to determine which font will be used, or determine the font size, or bold, or italic?<br>\nPS I write in C#</p>\n"},{"tags":["c++","c","windows","winapi","keyboard-events"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12880349,"title":"calling a function only when a key is pressed not when it is released","body":"<p>As the snippet below runs , each time a key is tapped,the function <em>LowLevelKeyboardProc</em> is called. But the problem is it is called both at the time of pressing a key and at the time of releasing a key.It means , per one tap the function is called two times.But I want the function be called only one when the key is pressed and not when the key is released.</p>\n\n<p>Even if I can filter the pressing and releasing of keys inside the function <em>LowLevelKeyboardProc</em>,it will be fine. Is there any way I can do this.</p>\n\n<pre><code>static LRESULT CALLBACK LowLevelKeyboardProc(int nCode, WPARAM wParam, LPARAM lParam) {\n  // call the function only if the key is pressed,else ( i.e key released) do nothing\n}\n\nBOOL WINAPI installHook(HINSTANCE hinstDLL, DWORD fwdReason, LPVOID lpvReserved){\n  handleKeyboardHook = SetWindowsHookEx(WH_KEYBOARD_LL, LowLevelKeyboardProc, hinstDLL, 0);\n  MSG msg;\n\n  while(GetMessage(&amp;msg, NULL, 0, 0)){\n    TranslateMessage(&amp;msg);\n    DispatchMessage(&amp;msg);\n  }\n  return msg.wParam;\n}\n\nBOOL WINAPI DllMain( HINSTANCE hinstDLL, DWORD fwdReason, LPVOID lpvReserved) { // ENTRY POINT\n if(hookThreadHandle==NULL) { \n    LPTHREAD_START_ROUTINE lpStartAddress = &amp;installHook;\n    hookThreadHandle = CreateThread(NULL, 0, lpStartAddress, NULL, 0, &amp;hookThreadId);\n }\n return TRUE;\n}\n</code></pre>\n"},{"tags":["c#",".net","winapi","systemevent"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":83,"score":3,"question_id":12878729,"title":"Thread hook procedure is no longer called after pressing Tab several times. Why?","body":"<p>I installed a thread-specific windows hook to monitor messages sent to WndProc. It worked at first. However, after I pressed Tab about 19 times to move focus around a form, my hook callback is nolonger called. This happened regaless of whether I pressed Tab quickly or slowly. Can anybody explain what is really going on?</p>\n\n<p>Below is the code I wrote. I tested it on Windows 7 64 bit.</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Windows.Forms;\nusing System.Runtime.InteropServices;\n\nnamespace HookTest\n{\n    static class Program\n    {\n        private const int WH_CALLWNDPROC = 4;\n\n        private delegate IntPtr HookProc(int nCode, IntPtr wParam, IntPtr lParam);\n\n        private class MainForm : Form\n        {\n            private Button button1;\n            private TextBox textBox1;\n\n            public MainForm()\n            {\n                this.button1 = new System.Windows.Forms.Button();\n                this.textBox1 = new System.Windows.Forms.TextBox();\n                this.SuspendLayout();\n                // \n                // button1\n                // \n                this.button1.Location = new System.Drawing.Point(12, 38);\n                this.button1.Name = \"button1\";\n                this.button1.Size = new System.Drawing.Size(75, 23);\n                this.button1.TabIndex = 0;\n                this.button1.Text = \"Button 1\";\n                this.button1.UseVisualStyleBackColor = true;\n                // \n                // textBox1\n                // \n                this.textBox1.Location = new System.Drawing.Point(12, 12);\n                this.textBox1.Name = \"textBox1\";\n                this.textBox1.Size = new System.Drawing.Size(100, 20);\n                this.textBox1.TabIndex = 1;\n                // \n                // MainForm\n                // \n                this.Controls.Add(this.textBox1);\n                this.Controls.Add(this.button1);\n                this.Name = \"MainForm\";\n                this.Text = \"Main Form\";\n                this.ResumeLayout(false);\n                this.PerformLayout();\n            }\n        }\n\n        private static IntPtr hWndProcHook = IntPtr.Zero;\n        private static int messageCount = 0;\n\n        [DllImport(\"Kernel32.dll\", CharSet = CharSet.Auto)]\n        public static extern IntPtr GetModuleHandle(string lpModuleName);\n\n        [DllImport(\"Kernel32.dll\", CharSet = CharSet.Auto)]\n        public static extern uint GetCurrentThreadId();\n\n        [DllImport(\"User32.dll\", CharSet = CharSet.Auto)]\n        private static extern IntPtr SetWindowsHookEx(int idHook,\n            HookProc lpfn, IntPtr hMod, uint dwThreadId);\n\n        [DllImport(\"User32.dll\", CharSet = CharSet.Auto)]\n        [return: MarshalAs(UnmanagedType.Bool)]\n        private static extern bool UnhookWindowsHookEx(IntPtr hhk);\n\n        [DllImport(\"User32.dll\", CharSet = CharSet.Auto)]\n        private static extern IntPtr CallNextHookEx(IntPtr hhk, int nCode,\n            IntPtr wParam, IntPtr lParam);\n\n        /// &lt;summary&gt;\n        /// The main entry point for the application.\n        /// &lt;/summary&gt;\n        [STAThread]\n        static void Main()\n        {\n            Application.EnableVisualStyles();\n            Application.SetCompatibleTextRenderingDefault(false);\n            InstallHook();\n            Application.Run(new MainForm());\n            UninstallHook();\n        }\n\n        private static void InstallHook()\n        {\n            if (Program.hWndProcHook == IntPtr.Zero)\n            {\n                Console.WriteLine(\"Hooking...\");\n\n                Program.hWndProcHook = SetWindowsHookEx(\n                    WH_CALLWNDPROC,\n                    WndProcHookCallback,\n                    GetModuleHandle(null),\n                    GetCurrentThreadId());\n\n                if(Program.hWndProcHook != IntPtr.Zero)\n                    Console.WriteLine(\"Hooked successfully.\");\n                else\n                    Console.WriteLine(\"Failed to hook.\");\n            }\n        }\n\n        private static void UninstallHook()\n        {\n            if (Program.hWndProcHook != IntPtr.Zero)\n            {\n                Console.WriteLine(\"Unhooking...\");\n\n                if (UnhookWindowsHookEx(Program.hWndProcHook))\n                    Console.WriteLine(\"Unhooked successfully.\");\n                else\n                    Console.WriteLine(\"Failed to unhook.\");\n\n                Program.hWndProcHook = IntPtr.Zero;\n            }\n        }\n\n        private static IntPtr WndProcHookCallback(int nCode, IntPtr wParam, IntPtr lParam)\n        {\n            Console.WriteLine(\"WndProcHookCallback {0}\", Program.messageCount++);\n\n            return CallNextHookEx(Program.hWndProcHook, nCode, wParam, lParam);\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c++","winapi"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":197,"score":1,"question_id":3647580,"title":"Set a class instance's function after it has already been defined","body":"<p>I am trying to give a class event functions such as .onShow() and .onHide(), so when the object is shown, the .onShow() function will run. How can I allow the function to be change like so:</p>\n\n<pre><code>MyClass myInst = MyClass();\nmyInst.onShow = OnShowFunction;\n</code></pre>\n\n<p>Is it possible to allow this?</p>\n"},{"tags":["winapi","group-policy"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":9063522,"title":"Group Policy API","body":"<p>Is it possible to use Advanced Group Policy API to prevent an user from launching certain applications?\nIs it any other way to do it programatically in windows?</p>\n"},{"tags":["c++","winapi","mfc","menu","skin"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":547,"score":1,"question_id":5854664,"title":"How can I programatically display the window's system (titlebar) menu","body":"<p>My dialog doesn't have any non-client area, because I want to paint a custom titlebar. But that means the system menu isn't shown when the user clicks on the titlebar. </p>\n\n<p>I've changed WM_NCHITTEST to respond with HTCLIENT for my titlebar, and I can capture the WM_NCRBUTTONUP message, but I need help about showing the system menu, I can't find out how to do this properly. </p>\n\n<p>So far I have this:</p>\n\n<pre><code>void CSkinnedDialog::OnNcRButtonUp( UINT nHitTest, CPoint point )\n{\n    CMenu* pMenu = GetSystemMenu(FALSE);\n    if (int cmd = pMenu-&gt;TrackPopupMenu(TPM_RETURNCMD, point.x, point.y, this))\n        SendMessage(WM_SYSCOMMAND, cmd, MAKELPARAM(point.x, point.y));\n}\n\nvoid CSkinnedDialog::OnSysCommand(UINT nID, LPARAM lParam)\n{\n    if ((nID &amp; 0xFFF0) == IDM_ABOUTBOX)\n    {\n        CAboutDlg dlgAbout;\n        dlgAbout.DoModal();\n    }\n    else\n    {\n        CDialog::OnSysCommand(nID, lParam);\n    }\n}\n\nLRESULT CSkinnedDialog::OnNcHitTest( CPoint point )\n{\n    LRESULT res = CDialog::OnNcHitTest(point);\n    ScreenToClient(&amp;point);\n    if (res == HTCLIENT &amp;&amp; point.y &lt; m_nFrameHeight)\n    {\n        res = HTCAPTION;\n    }\n    return res;\n}\n\nvoid CSkinnedDialog::SysMenuAddAboutEntry()\n{\n    // Add \"About...\" menu item to system menu.\n    // IDM_ABOUTBOX must be in the system command range.\n    ASSERT((IDM_ABOUTBOX &amp; 0xFFF0) == IDM_ABOUTBOX);\n    ASSERT(IDM_ABOUTBOX &lt; 0xF000);\n\n    CMenu* pSysMenu = GetSystemMenu(FALSE);\n    if (pSysMenu != NULL)\n    {\n    pSysMenu-&gt;AppendMenu(MF_SEPARATOR);\n    pSysMenu-&gt;AppendMenu(MF_STRING, IDM_ABOUTBOX, \"About...\");\n    }\n}\n</code></pre>\n\n<p>It shows the system menu, but it doesn't work very well. It doesn't respond to all the commands the user can select (for example, clicking on the \"About...\" menu entry doesn't do anything, and some of the actions that should be disabled and grayed out, like maximize and restore, aren't until you've clicked at least once with the left button on the titlebar.</p>\n"},{"tags":["c++","c","windows","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12873807,"title":"Name of the window doesn't get printed","body":"<p>The following program is meant to print the name of the window that has focus or at least the name of the command prompt where the program is running.But it prints only one character which is <code>W</code>. Why is it so ? Where am I making a mistake ?</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;stdio.h&gt;\n\nint main() {\n TCHAR title[500];\n int i=0;\n while(i&lt;10) {\n   GetWindowText(GetForegroundWindow(), title, 500);\n   printf(\"%s\\n\",title);\n   i++;\n   system(\"pause\");\n }\n}\n</code></pre>\n"},{"tags":["winapi","visual-c++","mfc"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":109,"score":1,"question_id":12856926,"title":"Hide an MFC dialog window","body":"<p>I have written an MFC dialog based application which is launched by some another application. For now, I have not added any code. It is just the default files that I got. The other application can successfully launch my application.</p>\n\n<p>I am trying to hide the window of my application when the other application launches it.</p>\n\n<pre><code>BOOL CMyApp::InitInstance()\n{\n    CMyAppDlg dlg;\n    m_pMainWnd = &amp;dlg;        \n\n    INT_PTR nResponse = dlg.DoModal();\n\n    if (nResponse == IDOK)\n    {\n    }\n    else if (nResponse == IDCANCEL)\n    { \n    }\n\n    return FALSE;\n}\n</code></pre>\n\n<p>I am trying to use </p>\n\n<pre><code>dlg.ShowWindow(SW_HIDE) \n</code></pre>\n\n<p>but it stil does not hide the window.</p>\n\n<p>Can you please tell me how do I accomplish this task?</p>\n\n<p>Many thanks.</p>\n\n<p>Best Regards,</p>\n\n<p>Chintan</p>\n"},{"tags":["c++","c","windows","winapi","gdi+"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12872587,"title":"How can I get WNDCLASS to have a bitmap image as a background?","body":"<p>I filled out the WNDCLASS and the the hbrBackground property to my bitmap like </p>\n\n<p><code>wc.hbrBackground = CreatePatternBrush( LoadBitmap( hInstance, MAKEINTRESOURCE( \"grey-texture.bmp\" ) ) );</code></p>\n\n<p>This doesn't seem to change at all, the window is white like it is for defaults, so I need to find out what is going on here. Is CreatePatternBrush not the correct function to use for something like this? Couldn't it be done in such a way like this?</p>\n\n<blockquote>\n  <p>hbrBackground = fromimagefile(string bitmap, bool tile);</p>\n</blockquote>\n"},{"tags":["windows","winapi","mirroring","setwindowshookex"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12872806,"title":"How to hook the repaint event of screen (make a middle level of screen) on Windows?","body":"<p>I'm wondering how to render Screen as a middle level.</p>\n\n<p>that is, I can produce the screen HDC after every repaint of screen, and before the screen is actually display on monitor.</p>\n\n<p>for example, the magnifier utility of Window 7. you can see the content under the magnifier window, how does it made?</p>\n\n<p>Thank you :-)</p>\n\n<p>regards,\nXavier Wang.</p>\n"},{"tags":["java","c++","c","winapi","jni"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12871344,"title":"jvm crashes when trying to send TCHAR type to java function that accepts string as argument","body":"<p>While trying to send the name of the window on which currently a key is being pressed from a JNI C code to a java method jvm crashes. I think it is due to passing of an invalid argument. Please explain why the call fails and how can I send the argument ?</p>\n\n<p>Prototype of  java method looks like :</p>\n\n<pre><code>public void storeNameOfForegroundWindow(String windowName) {\n  // store in the list\n}\n</code></pre>\n\n<p><em>JNI C snippet :</em></p>\n\n<pre><code> jmethodID callBackToStoreWindowName = (*env)-&gt;GetMethodID(env,cls,\"storeNameOfForegroundWindow\",\"(Ljava/lang/String;)V\");\n TCHAR title[500];\n GetWindowText(GetForegroundWindow(), title, 500);\n jvalue windowName,*warr;\n windowName.l = title;\n warr = &amp;title;\n (*Env)-&gt;CallVoidMethodA(Env,object,callBackToStoreWindowName,warr);\n</code></pre>\n\n<p>JVM crashes as it encounters the above snippet.I know that jvm crashes due to passing of  invalid argument to the java function ( via C code) . If that is so please explain how do I send the argument .I need to send the title of the current window to the java function.</p>\n"},{"tags":["c","multithreading","winapi","permissions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":70,"score":-1,"question_id":12870916,"title":"how to change thread user in c?","body":"<p>I have a program with 2 threads. I want the first thread to be run under user permissions of USER_1, and the second under USER_2 of Windows. When I log in as USER_1, both threads have USER_1 permissions. How can I change the user of the thread!?</p>\n"},{"tags":["c#","winforms","winapi","aero-glass"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":1738,"score":0,"question_id":5978086,"title":"Windows aero glass form text problem","body":"<p>I use windows form with GlassForm(using Microsoft.WindowsAPICodePack.Shell;). my problem when I change form to GlassForm my textbox texts doesnt </p>\n"},{"tags":["c","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12869266,"title":"How can I set hbrBackground to a solid color of my choosing?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3301053/c-win32-how-to-set-back-color-of-a-window\">c++ win32: how to set back color of a window?</a>  </p>\n</blockquote>\n\n\n\n<p>I don't want to use on of the stock HBRUSH's in WNDCLASS</p>\n\n<p>Here is my WNDCLASS:</p>\n\n<pre><code> WNDCLASS     wndclass ;\n\n wndclass.style         = CS_HREDRAW | CS_VREDRAW ;\n wndclass.lpfnWndProc   = WndProc ;\n wndclass.cbClsExtra    = 0 ;\n wndclass.cbWndExtra    = 0 ;\n wndclass.hInstance     = hInstance ;\n wndclass.hIcon         = LoadIcon (NULL, IDI_APPLICATION) ;\n wndclass.hCursor       = LoadCursor (NULL, IDC_ARROW) ;\n wndclass.hbrBackground = (HBRUSH) GetStockObject (BLACK_BRUSH) ;\n wndclass.lpszMenuName  = NULL ;\n wndclass.lpszClassName = szAppName ;\n</code></pre>\n\n<p>I want the hbrBackground member to be hex value #cfdf9b</p>\n\n<pre><code>wndclass.hbrBackground = (HBRUSH) GetStockObject (#cfdf9b);\n</code></pre>\n\n<p>With this there errors come </p>\n\n<p><strong>error C2014: preprocessor command must start as first nonwhite space\nwarning C4047: 'function' : 'int' differs in levels of indirection from 'LPCSTR'\nhelloworldwinapi.c(21) : warning C4024: 'GetStockObject' : different types for formal and actual parameter 1\nerror C2143: syntax error : missing ')' before ';'</strong></p>\n"},{"tags":["c++","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":192,"score":1,"question_id":10425881,"title":"unexplained behavior of GetOpenFileName() on windows 7 64 bit OS","body":"<p>im really struggling here to understand why the following function blocks my entire IEXPLORER process whenever it's the next command to be processed. im almost sure it's something related to the hwndOwner varible. during one of my diggings in the callstack of the ntdll.dll. i noticed these 2 lines :</p>\n\n<pre><code>ntdll.dll!_ZwWaitForMultipleObjects@20()  + 0x15 bytes  \nntdll.dll!_ZwWaitForMultipleObjects@20()  + 0x15 bytes  \n</code></pre>\n\n<p>one of my \"educated\" guesses is that a deadlock might have been appeared, but i dont exatclly have the tools and knowledge to understand what/who actually caused it.<br>\nas the topic says it, on OS 32 bit win7 based, this doesn't happen.\ni couldn't find any line in my code that actually locks that particular hwnd and might have caused a deadlock or a pre-lock.</p>\n\n<pre><code>EXPORTFILENAME ofn;\n        ZeroMemory(&amp;ofn, sizeof(ofn));\n        ofn.hwndOwner       = m_hWnd;\n        ofn.lStructSize     = sizeof(OPENFILENAME);\n        ofn.Flags           = OFN_OVERWRITEPROMPT | OFN_ENABLESIZING | OFN_EXPLORER | OFN_NOREADONLYRETURN | ((DVDBURN == (eType &amp; DVDBURN)) ? (/*OFN_OVERWRITEPROMPT |*/ /*OFN_ENABLEINCLUDENOTIFY |*/ OFN_PATHMUSTEXIST | OFN_ENABLETEMPLATE | OFN_ENABLEHOOK) : 0);\n        ofn.nFilterIndex    = 1;\n        ofn.lpstrTitle      = Title;\n        ofn.lpstrFilter     = szFilter;\n        ofn.lpstrFile       = szResult; \n        ofn.nMaxFile        = MAX_PATH;\n        ofn.lpstrDefExt     = szFilter + wcslen(szFilter) + 1; // UGH..\n        if(DVDBURN == (eType &amp; DVDBURN)) {\n            ofn.lpfnHook        = DVDSelectorProc;\n            ofn.lpTemplateName  = MAKEINTRESOURCE(IDD_DLG_EXPORTER_BURNNER);\n            ofn.hInstance       = (HINSTANCE)&amp;__ImageBase;\n        }\n        ofn.pExporter       = this;\n\n        if(0 == (eType &amp; OPENFILE)) {\n            if( ::GetSaveFileName(&amp;ofn))\n                VerifyTargetFileName(szResult, szResultOut);\n            else {\n                SetLastError(CommDlgExtendedError());\n                goto GracefulExit;\n            }\n        } else {\n            ATLTRACE(\"GFX ThreadId = %u\\r\\n\", GetCurrentThreadId());\n            if( ::GetOpenFileName(&amp;ofn))\n                VerifyTargetFileName(szResult, szResultOut);\n            else {\n                SetLastError(CommDlgExtendedError());\n                goto GracefulExit;\n            }\n        }\n</code></pre>\n\n<p>when EXPORTFILENAME =</p>\n\n<pre><code>    struct EXPORTFILENAME : OPENFILENAME {\n        CVMNExporter*   pExporter;\n        WCHAR           szResultBurningDrive[128];\n    };\n</code></pre>\n\n<hr>\n\n<h3>EDIT:</h3>\n\n<p>I also tried to discard the owner HWND by inserting 0/NULL. that didn't work either..</p>\n"},{"tags":["c++","winapi","visual-c++","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12444131,"title":"How can I modify this MFC-based code snippet to use a window class name of my own choice?","body":"<p>I am looking at some MFC/C++ CView object subclass like this:</p>\n\n<pre><code>BOOL CCustomView::CreateView(DWORD dwStyle,\n                  CDocument * pDocument,\n                  CWnd * pParent,\n                  String title)\n{\n  ...\n   CString className = AfxRegisterWndClass(CS_DBLCLKS,\n                       ::LoadCursor(NULL, IDC_IBEAM));\n   return Create(className, title, dwStyle,\n         rect, pParent, -1, &amp;context);\n}\n</code></pre>\n\n<p>What I don't like about this, although maybe it's normal for MFC application programming, is that the runtime Window Class Name, is not a name of my own choosing. If later, I wanted to find this window, from another Win32 application, and find the window by window class name, I'd have to use the ugly \"Afx:123:39843:39843\" strings, and actually, I don't know if those window class names can be counted on to not change. I'd rather change the window class to \"CCustomView\", but still have it have the same behaviours as the window class created above. How do I do that?</p>\n"},{"tags":["c++","windows","winapi","alt-tab"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":129,"score":4,"question_id":12862213,"title":"Alt Tab overlay Win32 identificator","body":"<p>I'm mapping events coming from an external sensor (e.g. a keypad) to keyboard shorcuts and I would like to switch applications using the Fast switch overlay window ( i.e. \"Alt-Tab menu\") , but I want to keep showing the switch menu until an application is chosen.</p>\n\n<p>Basically, what am I doing is this :</p>\n\n<pre><code>if(notInSwitchMenu) \n{   // Alt-Tab keystroke, but Alt remains pressed : the menu is still visible\n    Press(VK_MENU); \n    Press(VK_TAB); \n    Release(VK_TAB);\n}\nelse\n{\n\n    if(event1) //Tab keystroke : next app\n    {\n        Press(VK_TAB);\n        Release(VK_TAB) ;\n    } \n    else if(event2) //Shift-Tab keystroke  : previous app\n    { \n        Press(VK_SHIFT); \n        Press(VK_TAB);\n        Release(VK_TAB);\n        Release(VK_SHIFT) \n    }\n    else if(event3) // we get out of the menu : the selected app has the focus.\n    {\n        Release(VK_MENU);\n    } \n}\n</code></pre>\n\n<p>The Press and Release simply calls SendInput with the right properties.</p>\n\n<p>My problem is that I don't know a robust method to determine if the user is currently in the Alt-Tab program list. <strong>Do anyone know how to idendify the Alt-Tab overlay menu with the Win32 API ?</strong> </p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12853686,"title":"Checkbox height coudn't change using MoveWindow","body":"<p>I'm developing a simple application.</p>\n\n<p>I have created a checkbox , and I set it's dimensions using MoveWindow.\ntop , right , left positions are working fine, but the problem is , it does not\nrespond for correct bottom value. In other words I couldn't adjust it's height.</p>\n\n<pre><code>static void SetCheckboxSinhalaDimensions(HWND hwndCheckboxSinhala)\n{\n  double right = 0;\n  double left  = TEXT_BOX_RIGHT_MARGIN * main_window_width ;\n  double top = TEXT_BOX_TOP_MARGIN * main_window_height ;\n\n  int cychar = HIWORD (GetDialogBaseUnits ()) ;\n  double bottom = top+ 2*cychar; // I've used 1.5 , 1 , 0.5 and even 0.2 here\n                             // but it never changed.\n  MoveWindow (hwndCheckboxSinhala, right,top, left,bottom,TRUE);\n}\n</code></pre>\n\n<p>This is how it look like on main window.\n<img src=\"http://i.stack.imgur.com/JvVK1.png\" alt=\"enter image description here\"></p>\n\n<p>Any workaround on this issue?\nOr something that I'm missing?</p>\n"},{"tags":["c","windows","winapi","mouse","driver"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":494,"score":-1,"question_id":8952958,"title":"How to make a Windows touch pad acts like a Mac touch pad?","body":"<p>I am trying to write something for windows using WINAPI, so I can make the touch pad do whatever the mac touch pad do. </p>\n\n<p>I have checked using Spy++ what WM messages the two finger taps and etc. send to the OS, but figured out it sends only those plus/minus:</p>\n\n<pre><code>WM_LBUTTONDOWN\nWM_LBUTTONUP\nWM_MOUSEHOVER\nWM_MOUSEHWHEEL\nWM_MOUSELEAVE\nWM_MOUSEMOVE\nWM_RBUTTONDOWN\nWM_RBUTTONUP\n</code></pre>\n\n<p>When I tried to see what happend when clicking with 3 or 2 fingers it didn't send any particular message, unless I moved them a bit.</p>\n\n<p>firstly i would like to start with this: </p>\n\n<p>when 5 fingers going down show desktop (as <code>win+D</code> does).</p>\n\n<ul>\n<li><p>How to write (driver?) something that can diagnose 5 fingers touching simultaneously    the touch pad? \nOf curse there is no OS messages for this, but I can make some unique combination of existed  messages and by that diganose it. </p></li>\n<li><p>If I need to write a driver can I do it generic for most of the touchpad, can I do it as add-on?</p></li>\n<li><p>If you can post a good tutorial you are familiar with for writing a driver for windows, pls, cause I have no clue about it.</p></li>\n<li><p>Do I need anything else to take into account :</p></li>\n</ul>\n\n<blockquote>\n<pre><code>1. Diagnose 5 fingers mouse events.\n2. Make a thread in Explorer on startup that handle those new mouse messages.\n</code></pre>\n</blockquote>\n\n<p>thanks in advance</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ff468877%28v=vs.85%29.aspx\" rel=\"nofollow\">Mouse Input Notifications</a></p>\n"},{"tags":["c++","c","windows","winapi","dialog"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":12858841,"title":"how to set image in dialogbox in c++ win32 API?","body":"<p>i have developing a  C++ Api project.</p>\n\n<p>i will use dialogboxparam  to create  a dialogbox...</p>\n\n<p>i done to create and set the textbox,labels and buttons...\nits work fine...</p>\n\n<p>now i want to add a image in the top of the dialogbox...</p>\n\n<p>i did use this code in WM_INITDIALOG:</p>\n\n<pre><code>HBITMAP hImage= (HBITMAP)LoadImage(NULL,L\"C:\\\\WINDOWS\\\\system32\\\\BMA-Images\\\\login-header\",IMAGE_BITMAP,LR_DEFAULTSIZE ,LR_DEFAULTSIZE ,LR_LOADFROMFILE|LR_CREATEDIBSECTION);\n            SendMessage(_hwnd,STM_SETIMAGE,IMAGE_BITMAP,(LPARAM)hImage);\n</code></pre>\n\n<p>But it didnt work...\nCan anyone help to resolve this...\nThanks in advance\nSonu</p>\n"},{"tags":["c","windows","winapi","networking"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":308,"score":1,"question_id":6324647,"title":"how to view socket info when SO_DEBUG is enabled on socket (windows)?","body":"<pre><code>int setsockopt(\n  SOCKET s,\n  int level,\n  int optname,\n  const char* optval,\n  int optlen\n);\n</code></pre>\n\n<p><strong>SO_DEBUG</strong> </p>\n\n<p>Windows Sockets service providers are encouraged (but not required) to supply \n    output debug   information if the SO_DEBUG option is set by an application. \n    The mechanism for generating the    debug information and the form it takes\n    are beyond the scope of this document. </p>\n\n<p>I did not find any scope.</p>\n\n<p>Thank you for applicable info.</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":88,"score":2,"question_id":12862270,"title":"Modern Splash Screen","body":"<p>When you start up Microsoft Word, you know how there's that little unwindowed box that pops up for a second while everything loads?  How do I do that?  The <code>CreateWindow()</code>function has a <code>windowed</code> argument, but all it does when I send a <code>false</code> is make the window fullscreen.  Any ideas?  </p>\n\n<p>Reference material:  </p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/ms632679(VS.85).aspx\" rel=\"nofollow\">CreateWindow function on MSDN</a></p>\n"},{"tags":["winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12861833,"title":"winApi 32 icons defination","body":"<p>I wanted to ask about winApi 32 custom icons creation. When I define icon in <code>recource.h</code>:</p>\n\n<p><code>#define IDI_MYICON 1</code></p>\n\n<p>What does that number, in this case <code>1</code> mean?\nAnd what about <code>IDI</code> is it just a standard or it actually means something ? Thx</p>\n"},{"tags":["winapi","com"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12860895,"title":"Using IApplicationAssociationRegistration from a service","body":"<p>I'm having a problem using IApplicationAssociationRegistration to check the default email client. In the user context everything is fine, but from a service running in the system context the wrong default client is being returned as it seems to be picking up values from the system user rather than the current logged in user.</p>\n\n<p>Here are the steps I take:</p>\n\n<p>1) Call CoInitialize and CoInitializeSecurity for impersonation.</p>\n\n<p>2) Call DuplicateTokenEx to get a security token for SecurityImpersonation of the logged in user.</p>\n\n<p>3) Call ImpersonateLoggedOnUser with the token.</p>\n\n<p>4) Call CoCreateInstance to create an instance of IApplicationAssociationRegistration. I get S_OK returned and an instance pointer.</p>\n\n<p>5) Call CoSetProxyBlanket for both the instance pointer I got from step (4) and the IUnknown pointer. Again I get S_OK returned.</p>\n\n<p>6) Call the method IApplicationAssociationRegistration::QueryAppIsDefault for Outlook using the instance pointer I got from step (4). Again I get S_OK returned, but in the system context I get TRUE returned, and in the user context I correctly get FALSE returned. If I manually modify the UrlAssociations/mailto/UserChoice/ProgId value for HKEY_USERS/.DEFAULT in regedit and call again, it picks up the new value.</p>\n\n<p>7) Similarly if I call SetAppAsDefault, it seems to set the associations in the system context, rather than the user context as I want.</p>\n\n<p>If I put steps 4 to 7 into a console application and run this from the service using CreateProcessAsUser, then it works fine. But I would rather avoid having to do this.</p>\n\n<p>Any help would be appreciated.</p>\n"},{"tags":["c","windows","winapi","sdk"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":206,"score":4,"question_id":12000876,"title":"invoke iexplore.exe in already launched instance using ShellExecuteEx","body":"<p>I used <code>ShellExecuteEx</code> to call <code>iexplore.exe</code>, Whenever I start the application a new instance of internet explorer is created irrespective of, internet explorer already opened or not.</p>\n\n<p>I want to change this, if already an instance of the Internet explorer is there, I need to open a new tab in that instance with the address I am passing to the <code>ShExecInfo.lpParameters</code>, thus without creating a new window. Is there a way to do this? Please advice..</p>\n\n<p>UPADATE:\nIn the below answer I have a problem, when I set the lpFile parameter as \"iexplore.exe\" and lpParameters as \"www.google.com\", two windows get opened. If I ignore lpfile parameter, then the below code opens default browsers in some machine. I want only internet explorer to get opened. please help..</p>\n\n<pre><code>int WINAPI WinMain ( HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow ) { \n\n\n ShellExecute(0,L\"open\",L\"iexplore.exe\", L\"http://www.google.com\",0,SW_SHOWDEFAULT );       \n\n\n ShellExecute(0,L\"open\", L\"iexplore.exe\", L\"http://www.yahoo.com\",0,SW_SHOWDEFAULT );        \n\n return 0;\n\n} \n</code></pre>\n"},{"tags":["c++","internet-explorer","winapi","windows-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12857740,"title":"EnumUrls return fetched = 0 when process called by a service","body":"<p>I am trying to fetch Internet Explorer history using <code>IUrlHistoryStg2</code> and Enumerating URL via EnumUrls.</p>\n\n<p>My process is working fine and fetching IE history when launched by the windows explorer but i want to start this process via window service.</p>\n\n<p>When i launch this process using API</p>\n\n<pre><code>CreateProcessAsUserW(hToken, A2T((char*)(ProcImgFQName.c_str())), A2T((char*)(CmdLineArgs.c_str()))/*sCommandLine*/, NULL, NULL, FALSE, NORMAL_PRIORITY_CLASS |  CREATE_NEW_CONSOLE, NULL, NULL, &amp;si, &amp;pi)\n</code></pre>\n\n<p>EnumUrls returns 0 record Fetched. </p>\n\n<p>On some blogs i have searched before posting the thread says:</p>\n\n<p>Call LoadUserProfile before creating process but it did not worked for me.</p>\n\n<p>please help</p>\n"},{"tags":["windows","winapi","registry","key"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":54,"score":3,"question_id":12844409,"title":"Convert Windows registry key path to string?","body":"<p>The straight WIN32API program I'm writing (no MFC, no .NET) uses the registry. Should a registry error occur, I'd like to print the full path of the key that failed.</p>\n\n<p>HKEY_CLASSES_ROOT, HKEY_CURRENT_CONFIG, HKEY_CURRENT_USER, HKEY_LOCAL_MACHINE, and HKEY_USERS are HKEY (DWORD) values (0x8000000 for HKEY_CLASSES_ROOT), etc. The subkey is a LPCTSTR, as is the value name.</p>\n\n<p>Is there a method to convert the HKEY, subkey and value name (including any redirection (http://msdn.microsoft.com/en-us/library/windows/desktop/ms724072(v=vs.85).aspx)) to a text string?</p>\n\n<p>I realize I can build a table of the HKEY's myself, and they're unlikely to change, but that's  a crass way to do it.</p>\n"},{"tags":["c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12856485,"title":"VirtualProtectEx fails with ERROR_NOACCESS (error code 998)","body":"<pre><code>CreateProcess(\"something.exe\", NULL, NULL, NULL, FALSE, CREATE_SUSPENDED, \n    NULL, NULL, &amp;sInfo, &amp;pInfo);\n\nReadProcessMemory(pInfo.hProcess, (LPCVOID) (contx.Ebx + 8),\n  (LPVOID) &amp;baseAddress, sizeof(baseAddress), NULL);\n\nhProcess=OpenProcess(PROCESS_VM_READ|PROCESS_VM_WRITE|PROCESS_VM_OPERATION,\n  FALSE, pInfo.dwProcessId);\n\nVirtualProtectEx(hProcess, (LPVOID) baseAddress, sizeof(IMAGE_DOS_HEADER),\n    PAGE_EXECUTE_READWRITE, NULL);\n\nWriteProcessMemory(hProcess, (LPVOID) baseAddress, (LPCVOID) pidh,\n    sizeof(IMAGE_DOS_HEADER), NULL);\n</code></pre>\n\n<p>Why VirtualProctecEx gives me ERROR_NOACCESS ?</p>\n"},{"tags":["visual-c++","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":903,"score":0,"question_id":4285201,"title":"How to change the border style of applications main window in visual c++ win32 API","body":"<p>I have an application in Visual c++ (Win32 API). In my application the main window boarder is displayed in old windows styled. I have tried changing the wndWc.style values to WS_OVERLAPPED,WS_POPUP and other which are given in WinUser.h but there is no change in the appearance of the main window were as all my pop-up window are displayed in windows 7 style how this can be rectified. Any help in this regards will be highly appreciated. I have attached both the images the main window and the pop up window.\n<img src=\"http://i.stack.imgur.com/j6Lu3.png\" alt=\"alt text\"></p>\n\n<p><img src=\"http://i.stack.imgur.com/fec5G.png\" alt=\"alt text\"></p>\n\n<p>Code : </p>\n\n<pre><code>// our window class\n  WNDCLASS wndWc;\n  // ---------------------------------------------------------\n  // fill window class members\n  // ---------------------------------------------------------\n  wndWc.style = CS_GLOBALCLASS;\n  wndWc.lpfnWndProc = (WNDPROC) WndProc;\n  wndWc.cbClsExtra = 0;\n  wndWc.cbWndExtra = 0;\n  wndWc.hInstance = GetModuleHandle(NULL);\n  wndWc.hIcon = NULL;\n  wndWc.hCursor = LoadCursor(0, IDC_ARROW);\n  wndWc.hbrBackground = (HBRUSH)GetStockObject(0);\n  wndWc.lpszMenuName = NULL;\n  wndWc.lpszClassName = \"XYZ\";\n\n\n  // register class\n  if (!RegisterClass(&amp;wndWc)) return false;\n  // ---------------------------------------------------------\n\n  // get actual screen resolution\n  int iSw = (WORD)GetSystemMetrics(SM_CXSCREEN);       // height\n  int iSh = (WORD)GetSystemMetrics(SM_CYSCREEN);       // height\n\n  // make a rectangle on the center of the screen\n  RECT rc = {(iSw - iWidth)/2, (iSh - iHeight)/2, width, height};\n\n  // create the window. the spaces on the window title\n  // are just to make sure this will be visible when the region\n  // is active. just run the app and you'll understand. =)\n  hWnd = CreateWindow(\"XYZ\", \"XYZ\",\n                      WS_OVERLAPPEDWINDOW,\n                      CW_USEDEFAULT,CW_USEDEFAULT, width,height,\n                      NULL, NULL, GetModuleHandle(NULL), NULL);\n</code></pre>\n"},{"tags":["c#","winapi","registry"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12854088,"title":"C# Offreg.dll 'System.AccessViolationException' ORGetValue","body":"<p>I am trying to obtain a value from a registry key contained in an offline hive. The code would compile but I am getting 'System.AccessViolationException' or the program just closes. </p>\n\n<p>I think the program is trying to read of write to memory that is not allocated. However I have tried to allocate memory for myValue using stringbuilder. </p>\n\n<p>When i set pcbData to any value lower than 66 i get a return value of 234, which means that the specified buffer size is not large enough to hold the data.</p>\n\n<p>OROpenHive seems be working as I am getting a return value of 0.</p>\n\n<p>Syntax for ORGetValue at <a href=\"http://msdn.microsoft.com/en-us/library/ee210767(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ee210767(v=vs.85).aspx</a></p>\n\n<pre><code>DWORD ORGetValue(\n    _In_         ORHKEY Handle,\n    _In_opt_     PCWSTR lpSubKey,\n    _In_opt_     PCWSTR lpValue,\n    _Out_opt_    PDWORD pdwType,\n    _Out_opt_    PVOID pvData,\n    _Inout_opt_  PDWORD pcbData\n);\n</code></pre>\n\n<p>Here is my code:</p>\n\n<pre><code>    [DllImport(\"offreg.dll\", CharSet = CharSet.Auto, EntryPoint = \"ORGetValue\",          SetLastError = true, CallingConvention = CallingConvention.StdCall)]\n    public static extern uint ORGetValue(\n        IntPtr Handle, \n        string lpSubKey, \n        string lpValue, \n        out uint pdwType, \n        out StringBuilder pvData, \n        ref uint pcbData);\n\n    [DllImport(\"offreg.dll\", CharSet = CharSet.Auto)]\n    public static extern uint OROpenHive(\n        String lpHivePath,\n        out IntPtr phkResult);\n\n    private void button2_Click(object sender, EventArgs e)\n    {\n        IntPtr myHive;\n        String filepath = @\"C:\\Users\\JON\\Desktop\\NTUSER.DAT\";\n\n        StringBuilder myValue = new StringBuilder(\"\", 256);\n        uint pdwtype;\n        uint pcbdata = 66;\n\n        uint ret2 = OROpenHive(filepath, out myHive);\n        this.textBox1.Text = ret2.ToString();\n\n        uint ret3 = ORGetValue(myHive, \"Environment\", \"TEMP\", out pdwtype, out myValue,  ref pcbdata);\n        this.textBox1.Text = ret3.ToString();\n    }\n</code></pre>\n"},{"tags":["c","windows","multithreading","winapi","memory"],"answer_count":1,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":142,"score":6,"question_id":12852940,"title":"Can memset be parallelized on 4 cores?","body":"<p>I am not sure to that. Can I write a large memset (for example 10 MB), on four cores to gain speedup with this? </p>\n\n<p>Is such ram-chip parallelization possible at all, and also how big are time costs of firing other threads - is it more than a millisecond or less?</p>\n"},{"tags":["c#","c","winapi","pinvoke"],"answer_count":2,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":173,"score":5,"question_id":12837418,"title":"Convert C Union to C# (Incorrectly Aligned)","body":"<p>I want to call the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa363286%28v=vs.85%29.aspx\" rel=\"nofollow\">DhcpGetClientInfo</a> API from C# but I have a question on conversion of this C struct to C#:</p>\n\n<pre><code>typedef struct _DHCP_CLIENT_SEARCH_INFO {\n  DHCP_SEARCH_INFO_TYPE SearchType;\n  union {\n    DHCP_IP_ADDRESS ClientIpAddress;\n    DHCP_CLIENT_UID ClientHardwareAddress;\n    LPWSTR          ClientName;\n  } SearchInfo;\n} DHCP_SEARCH_INFO, *LPDHCP_SEARCH_INFO;\n</code></pre>\n\n<p>I think the Correct conversion is this:</p>\n\n<pre><code>[StructLayout(LayoutKind.Explicit, Size=12)]\npublic struct DHCP_SEARCH_INFO\n{\n    [FieldOffset(0)]\n    public DHCP_SEARCH_INFO_TYPE SearchType;\n    [FieldOffset(4)]\n    public DHCP_IP_ADDRESS ClientIpAddress;\n    [FieldOffset(4)]\n    public DHCP_BINARY_DATA ClientHardwareAddress;\n    [FieldOffset(4), MarshalAs(UnmanagedType.LPWStr)]\n    public string ClientName;\n};\n</code></pre>\n\n<p>But that gives an System.TypeLoadException: Additional information: Could not load type 'Dhcpsapi.DHCP_SEARCH_INFO' from assembly 'ConsoleApplication3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null' because it contains an object field at offset 4 that is incorrectly aligned or overlapped by a non-object field.</p>\n\n<p>This is the conversion of the other types in case you want to compile:</p>\n\n<pre><code>public enum DHCP_SEARCH_INFO_TYPE : uint\n{\n    DhcpClientIpAddress = 0,\n    DhcpClientHardwareAddress = 1,\n    DhcpClientName = 2\n};\n\n[StructLayout(LayoutKind.Sequential)]\npublic struct DHCP_BINARY_DATA\n{\n    public uint DataLength;\n    public IntPtr Data;\n};\n\n[StructLayout(LayoutKind.Sequential)]\npublic struct DHCP_IP_ADDRESS\n{\n    public UInt32 IPAddress;\n} \n</code></pre>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I verified sizeof and offsets in C:</p>\n\n<pre><code>#pragma comment(lib,\"Dhcpsapi.lib\")\n\nint _tmain(int argc, _TCHAR* argv[])\n{\n    DHCP_SEARCH_INFO si;\n\n    printf(\"sizeof(DHCP_SEARCH_INFO)=%d\\n\", sizeof(DHCP_SEARCH_INFO));\n\n    printf(\"ClientIpAddress offset=%d\\n\", (PBYTE)&amp;si.SearchInfo.ClientIpAddress - (PBYTE)&amp;si);\n    printf(\"ClientHardwareAddress offset=%d\\n\", (PBYTE)&amp;si.SearchInfo.ClientHardwareAddress - (PBYTE)&amp;si);\n    printf(\"ClientName offset=%d\\n\", (PBYTE)&amp;si.SearchInfo.ClientName - (PBYTE)&amp;si);\n    return 0;\n}\n</code></pre>\n\n<p>Output is:</p>\n\n<pre><code>sizeof(DHCP_SEARCH_INFO)=12\nClientIpAddress offset=4\nClientHardwareAddress offset=4\nClientName offset=4\n</code></pre>\n\n<p><strong>EDIT:</strong>\nBased on Camford's answer I declared the struct as below. Using sizeof should make it correct for x64 as well.</p>\n\n<pre><code>[StructLayout(LayoutKind.Explicit, Size=12)]\npublic struct DHCP_SEARCH_INFO\n{\n    [FieldOffset(0)]\n    public DHCP_SEARCH_INFO_TYPE SearchType;\n    [FieldOffset(sizeof(DHCP_SEARCH_INFO_TYPE))]\n    public DHCP_IP_ADDRESS ClientIpAddress;\n    [FieldOffset(sizeof(DHCP_SEARCH_INFO_TYPE))]\n    public IntPtr ClientName;\n    [FieldOffset(sizeof(DHCP_SEARCH_INFO_TYPE))]\n    public DHCP_BINARY_DATA ClientHardwareAddress;\n};\n</code></pre>\n"},{"tags":["c#","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12849104,"title":"Creating .Net Wrappers for Windows API and COM DLLs","body":"<p>Let me start by saying that I don't know what I don't know at this point, so rather than specific answers, I'm also looking for better questions to ask, I think.  My .Net/C# is solid enough, and my C/C++ is meh.</p>\n\n<p>Lately, I'm finding that there are no libraries in the standard .Net framework to accomplish certain tasks, and while it's easy enough to download a third party library, I'd like to understand how to do it myself if one doesn't already exist.  </p>\n\n<p>In one recent case, I need to deal with MIDI in windows at a relatively low-level, and I accidentally found out that \"winmm.dll\" is the library I'll need to use by downloading a .net wrapper for MIDI and browsing through the source.  I understand that I'll have to make a wrapper class and do the whole P/Invoke thing to make that happen.</p>\n\n<p>The next thing I did was to search for documentation on the Windows API to figure out what was going on in the mystery box of \"winmm.dll,\" and to my delight, there was a whole Windows SDK that I was able to download and read through.  I went through the \"getting started\" section of \"Windows Development\" which covered some of the basics via C++.  It talked a bit about COM, windows header files, and I know enough C++ to get the gist.</p>\n\n<p>Now, I need help connecting the dots on a few issues:</p>\n\n<p>1) The Windows SDK, so far, seems to suggest that I want to program to specific header files rather than the dlls themselves, but the .net wrappers I've found typically point to a specific .dll rather that a header file...</p>\n\n<pre><code>/// &lt;summary&gt;\n/// Returns the number of MIDI input devices on this system.\n/// &lt;/summary&gt;\n/// Win32 docs: http://msdn.microsoft.com/en-us/library/ms711608(VS.85).aspx\n[DllImport(\"winmm.dll\", SetLastError = true)]\npublic static extern UInt32 midiInGetNumDevs();\n</code></pre>\n\n<p>I was under the impression that a header file and DLL needed to be in the same folder, but the windows SDK includes a folder with all the windows header files, and no DLLs (I'm guessing the registry comes into play here for mapping to specific libraries?)?  How do those header files eventually get mapped to actual libraries, and why does it seem like I don't even need to deal with header files to create a .Net wrapper?</p>\n\n<p>2) I can't seem to find documentation on winmm.dll, but I have found references to the functions I'll likely need in the \"Windows API\" list in the Windows SDK, and I'm pretty sure that the code for those functions are in winmm.dll.  How do I find the documentation for the specific libraries I'll need to begin creating my wrapper?  If I didn't know that I was going to need winmm.dll to access windows MIDI functionality, how could I have figured that out myself?</p>\n\n<p>3) Some DLLs are COM, some are plain windows DLLs, some are .net DLLs... how can I tell the different going forward?  It seems that creating wrappers for the former two would require a different approach.</p>\n\n<p>4) There is no page on MSDN for \"Winmm.dll\" listing all of its API, and I assume there's a good and practical reason for that, but I'm not sure what it is?  I'm used to .Net land where I can figure out what a library does and how to use it almost without effort.</p>\n\n<p>Thanks in advance for any insights.</p>\n"},{"tags":["iphone","winapi","ipad","ios"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1327,"score":0,"question_id":4845451,"title":"Wait for NSThread","body":"<p>I have a many NSThreads, and I want to sleep during the time when they are working. How can I do it? Is there analogue of WinApi functions WaitForSingleObject/WaitForMultipleObjects in iOS SDK?</p>\n"},{"tags":["objective-c","windows","winapi","gcc","cygwin"],"answer_count":9,"favorite_count":51,"up_vote_count":110,"down_vote_count":0,"view_count":80407,"score":110,"question_id":56708,"title":"Objective C for Windows","body":"<p>What would be the best way to write Objective-C on the Windows platform?</p>\n\n<p>Cygwin and gcc? Is there a way I can somehow integrate this into Visual Studio?</p>\n\n<p>Along those lines - are there any suggestions as to how to link in and use the Windows SDK for something like this. Its a different beast but I know I can write assembly and link in the Windows DLLs giving me accessibility to those calls but I don't know how to do this without googling and getting piecemeal directions.</p>\n\n<p>Is anyone aware of a good online or book resource to do or explain these kinds of things?</p>\n"},{"tags":["c#","c++","windows","visual-studio-2010","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":88,"score":-1,"question_id":12851010,"title":"Detect Double Click Globally in Windows","body":"<p>I want to write a Windows program that runs in the background and prints out the exact time (accurate to the millisecond) of when the next mouse double click event occurs. Specifically, I want the exact time at which I double click on a certain .exe file on my desktop. Is there a way of doing this, and if so, could you provide some simple sample code?</p>\n"},{"tags":["windows","delphi","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":12835135,"title":"[delphi]How can I detect whether a folder is in use or not?","body":"<p>I write two thread in one project.</p>\n\n<p>Thread1 is used in coping all files and child folders in folder1 to folder2.</p>\n\n<p>Both of folder1 and folder2, folder3 are from input.</p>\n\n<p>Thread2 is used in checking whether folder2 has any file or child folder, if true ,Move them to folder3(Copy them to folder3, then remove them from folder2). </p>\n\n<p>There has a problem.</p>\n\n<p>Example1</p>\n\n<p>folder1 'C:\\Test\\1'</p>\n\n<p>folder1's children</p>\n\n<p>C:\\Test\\1</p>\n\n<p>C:\\Test\\1\\L.tex</p>\n\n<p>C:\\Test\\1\\sdf.txt</p>\n\n<p>C:\\Test\\1\\2031   &lt;--- it's folder</p>\n\n<p>folder2 'D:\\Sdf\\555'</p>\n\n<p>folder3 'D:\\Sdf\\492pS1'</p>\n\n<p><strong>project running...</strong></p>\n\n<p>Thread1 create D:\\Sdf\\555\\1</p>\n\n<p>Thread2 move D:\\Sdf\\555\\1 to D:\\Sdf\\492pS1\\1</p>\n\n<p>Thread1 create D:\\Sdf\\555\\1\\2031(D:\\Sdf\\555\\1 is removed)</p>\n\n<p><strong>error...</strong> </p>\n\n<p>How can I detect whether a folder is in use or not?</p>\n"},{"tags":["c++","winapi","menu","resources","keyboard-shortcuts"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":12848500,"title":"WinAPI - Menu accelerators not working","body":"<p>I'm trying to add accelerators to my menu, when I press 'Ctrl+R' it should send the command <code>ID_VIEW_RESULTS</code>, But it doesn't. It works fine clicking the menu item, but it isn't translating the accelerator, this is what I have:</p>\n\n<p>MyApp.h</p>\n\n<pre><code>#define WIN32_LEAN_AND_MEAN\n#include &lt;Windows.h&gt;\n\n#define ID_MAINMENU 101\n#define ID_MENUACC  102\n\n#define ID_VIEW_RESULTS 2001\n</code></pre>\n\n<p>MyApp.rc</p>\n\n<pre><code>#include \"MyApp.h\"\n\n/////////////////////////////////////////////////////////////////////////////\n//\n// Menu\n//\n\nID_MAINMENU MENU \nBEGIN\n    POPUP \"&amp;View\"\n    BEGIN\n        MENUITEM \"Calculated &amp;Results...\\aCtrl+R\",  ID_VIEW_RESULTS\n    END\nEND\n\n/////////////////////////////////////////////////////////////////////////////\n//\n// Accelerator\n//\n\nID_MENUACC ACCELERATORS \nBEGIN\n    \"^R\",       ID_VIEW_RESULTS,        ASCII,  NOINVERT\nEND\n</code></pre>\n\n<p>MyApp.cpp</p>\n\n<pre><code>#include \"MyApp.h\"\n\nint WINAPI WinMain(HINSTANCE hInst, HINSTANCE hPrevInst, LPTSTR lpCmdLine, int nCmdShow)\n{\n    UNREFERENCED_PARAMETER(hPrevInst);\n    UNREFERENCED_PARAMETER(lpCmdLine);\n\n    // Create and show main window, CMainWnd definition is dialog\n    // resource template, works fine, irrelevant to problem.\n    MainWnd = new CMainWnd();\n    MainWnd-&gt;Show();\n\n    MSG    Msg;\n    HACCEL hAcc;\n    hAcc = LoadAccelerators(hInst, MAKEINTRESOURCE(ID_MENUACC));\n\n    while (GetMessage(&amp;Msg, 0, 0, 0)) {\n        if (!TranslateAccelerator(Msg.hwnd, hAcc, &amp;Msg)) {\n            TranslateMessage(&amp;Msg);\n            DispatchMessage(&amp;Msg);\n        }\n    }\n\n    return (int)Msg.wParam;\n}\n</code></pre>\n\n<p>I myself can't see a good reason why this wouldn't work, can anyone point out what I'm doing wrong or give me any suggestions?</p>\n"},{"tags":["delphi","winapi","image-processing","gdi+","delphi-6"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":285,"score":1,"question_id":11344504,"title":"Replacing StretchDIBits with GDI+ (while drawing an Image to Printer's canvas)","body":"<p>My application is developed in Delphi 6. This is a resource intesive application due to background processing and large volume of data (It consumes around 60MB - 120MB of physical memory). One of the functionality of this application is to create barcode images and print them.  If user keeps on generating the Barcodes, then at least One out of Ten Barcode has missing lines in it.</p>\n\n<p>I was able to resolve this issue using TExcellenImagePrinter component. But, it diminished the performance a lot. This resolution was rejected by my client and hence, now I am trying to replace the WinAPI StretchDIBits call with GDI+.</p>\n\n<p>The original source code is as following:</p>\n\n<pre><code>procedure PrintBitmap(ARect:TRect; Bitmap:TBitmap);\nvar\n   Info: PBitmapInfo;\n   InfoSize: dword{Integer};\n   Image: Pointer;\n   ImageSize: dword{ integer};\n   iWidth,iHeight :integer;\n   iReturn : integer ;\nbegin\n   GetDIBSizes(Bitmap.handle,InfoSize,ImageSize);\n   if (LoadDIBFromTBitmap(Bitmap,Pointer(Info),Image,iWidth,iHeight)) then\n   begin\n        SetStretchBltMode(Printer.Canvas.handle,STRETCH_HALFTONE);\n        SetBrushOrgEx(Printer.Canvas.handle, 0, 0, NIL);\n        iReturn := StretchDIBits(Printer.Canvas.Handle, ARect.Left, ARect.Top,\n            ARect.Right - ARect.Left, ARect.Bottom - ARect.Top,\n            0, 0, Info^.bmiHeader.biWidth,\n            Info^.bmiHeader.biHeight, Image, Info^,DIB_RGB_COLORS, SRCCOPY);\n   end;\n   FreeMemEx(Info);\n   FreeMemEx(Image);\nend;\n</code></pre>\n\n<p>I got the GDI+ header from the (<a href=\"http://www.progdigy.com/?page_id=7\" rel=\"nofollow\">http://www.progdigy.com/?page_id=7</a>) as suggested by Joe in embarcadero forums (<a href=\"https://forums.embarcadero.com/thread.jspa?messageID=471501#471501\" rel=\"nofollow\">https://forums.embarcadero.com/thread.jspa?messageID=471501#471501</a>).</p>\n\n<p>I have modified my source code as following :</p>\n\n<ul>\n<li><p>Created an object of TGPGraphics class and assigned the printer's handle to it. </p>\n\n<p>gp := TGPGraphics.Create(Printer.Canvas.Handle);</p></li>\n<li><p>Created an onject of TGPBitmap class and assigned the barcode image to it. </p>\n\n<p>bmp := TGPBitmap.Create(Info^,Image); </p>\n\n<p>Info is TBitmapInfo and Image is an pointer.</p></li>\n<li>Assigned the Printer's dimension to the an instance <strong>rect</strong> of TGPRect record</li>\n<li><p>Called the DrawImage function : </p>\n\n<p>gp.DrawImage(bmp,rect);</p></li>\n</ul>\n\n<p>But, after making these changes, empty image is shown in the printer's output.\nCan you point out if I have missed something or my implementation is wrong.\nCan you provide any pointers regarding this?</p>\n"},{"tags":["winapi","nsis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12402628,"title":"unexpected logiclib behavior when testing string returned by system plugin","body":"<p>I am getting system information via the System plugin by using code similar to the <a href=\"http://stackoverflow.com/a/12358195/317266\">answer to my previous question</a>. The API function is very similar except that it returns (or not) a wide char string.</p>\n\n<p>While using that script on a computer that is member of a domain, I cannot understand why the logiclib test always pass in the <code>${else}</code> branch of the test. The following capture shows that <code>$1</code> is not null:</p>\n\n<p><img src=\"http://i.stack.imgur.com/LlRUe.png\" alt=\"variable dump\"></p>\n\n<p>While reading more the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa370420%28v=vs.85%29.aspx\" rel=\"nofollow\">NetGetDCName reference</a> I think that it would be preferable to check the function returned value instead of the wide char string pointer. I am a bit confused, why does my <code>${If} 0 &lt;&gt; $1</code> always fails? I have checked on a virtual machine not member of a domain that <code>$1</code> equals <code>0</code> in this case. I suppose then that the <code>${IfThen}</code> test to free the memory is wrong too.</p>\n\n<p>Here is the sample code:</p>\n\n<pre class=\"lang-default prettyprint-override\"><code>!include \"logiclib.nsh\"\noutfile \"hello2.exe\"\n\n!define DEBUG `System::Call kernel32::OutputDebugString(ts)`\n\nsection\n\n    Call GetDCName\n    pop $0\n\n    Messagebox MB_OK \"DCName=$0\"\n\nsectionEnd\n\nFunction GetDCName\n    ;Push the domain controler name to the stack (or an empty string if no dc)\n    push $0\n    push $1\n    push $2\n    System::Call \"netapi32::NetGetDCName(i0, i0, *w 0 r1) i.r2\"\n    Dumpstate::debug\n    ${If} 0 &lt;&gt; $1\n        ${debug} \"copy $1\"\n        StrCpy $0 $1\n    ${else}\n        ${debug} \"copy empty string\"\n        StrCpy $0 \"\"\n    ${endif}\n    ${IfThen} $1 &lt;&gt; 0 ${|} System::Call \"netapi32::NetApiBufferFree(ir1)\" ${|}\n    Pop $2\n    Pop $1\n    Exch $0\nFunctionEnd\n</code></pre>\n\n<p><strong>Edit:</strong> thanks to Anders, here is the corrected function:</p>\n\n<pre class=\"lang-default prettyprint-override\"><code>Function GetDCName\n    ;Push the domain controler name to the stack (or an empty string if no dc)\n    push $0\n    push $1\n    push $2\n    System::Call \"netapi32::NetGetDCName(i0, i0, *i 0 r1) i.r2\" ;do not convert r1 to wchar, keep the pointer to free it\n    ${If} $2 = 0\n        System::Call \"*$1(&amp;w${NSIS_MAX_STRLEN} .r0)\"        ;get the wchar from the pointer\n        ${IfThen} $1 &lt;&gt; 0 ${|} System::Call \"netapi32::NetApiBufferFree(ir1)\" ${|}  ;free the pointer\n    ${else}\n        StrCpy $0 \"\"\n    ${endif}\n    Pop $2\n    Pop $1\n    Exch $0\nFunctionEnd\n</code></pre>\n"},{"tags":["c++","file","winapi","system-programming"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12827973,"title":"Can't read file in inherited process","body":"<p>I'm trying to read the file in inherited process, the file handle which I passed through command line is valid, but <code>GetFileSize(HANDLE,LPDWORD)</code> returns <code>0</code>.</p>\n\n<pre><code>#include\"mainClass.h\"\n\nMainClass* MainClass::ptr = NULL;\n\nMainClass::MainClass()\n{\n    ptr = this;\n}\nBOOL CALLBACK MainClass::DlgProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam)\n{\n    switch(uMsg)\n    {\n        HANDLE_MSG(hwnd,WM_CLOSE,ptr-&gt;OnClose);\n        HANDLE_MSG(hwnd,WM_COMMAND,ptr-&gt;OnCommand);\n        HANDLE_MSG(hwnd,WM_INITDIALOG,ptr-&gt;OnInitDialog);\n    }\n    return false;\n}\n\nBOOL MainClass::OnInitDialog(HWND hwnd, HWND hwndFocus, LPARAM lParam)\n{\n    SECURITY_ATTRIBUTES sa = {sizeof(SECURITY_ATTRIBUTES),0,true};\n\n    hFile = CreateFile(_T(\"D:/mutex.txt\"),GENERIC_READ,0,&amp;sa,OPEN_EXISTING,FILE_ATTRIBUTE_NORMAL,NULL);\n\n    return true;\n}\n\nvoid MainClass::OnClose(HWND hwnd)\n{\n    DestroyWindow(hwnd);\n    PostQuitMessage(0);\n}\n\nvoid MainClass::OnCommand(HWND hwnd, int id, HWND hwndCtl, UINT codeNotify)\n{\n\n    if(codeNotify == BN_CLICKED)\n    {\n        if(id == IDC_BUTTON_READ_ENCRYPT)\n        {\n            TCHAR* cmd = new TCHAR[100];\n            _stprintf(cmd,_T(\"readFromFile.exe %d\"),(int)hFile);\n\n            STARTUPINFO si = {sizeof(STARTUPINFO)};\n            PROCESS_INFORMATION pi = {0};\n\n            if(CreateProcess(NULL,cmd,NULL,NULL,true,NULL,NULL,NULL,&amp;si,&amp;pi))\n            {\n                //CloseHandle(hFile);\n                //CloseHandle(pi.hThread);\n                //CloseHandle(pi.hProcess);\n            }\n\n            delete[]cmd;\n        }\n    }\n}\n</code></pre>\n\n<p>Inherit process is console application:</p>\n\n<pre><code>#include&lt;windows.h&gt;\n#include&lt;stdio.h&gt;\n#include&lt;conio.h&gt;\n#include&lt;tchar.h&gt;\n\nPTSTR buf;\nHANDLE hFile;\n\nvoid main()\n{\n    int s = 100;\n    buf = new TCHAR[s];\n    TCHAR* temp = buf;\n\n    _tcscpy(buf,GetCommandLine());\n\n    while(*buf++ != _T(' '));\n\n    hFile = (HANDLE)_ttoi(buf); \n    _tprintf(_T(\"%d\\n\"),(int)hFile);\n    getch();\n\n    buf = temp;\n    delete[]buf;\n\n    if(hFile == INVALID_HANDLE_VALUE)\n    {\n        MessageBox(NULL,_T(\"file handle invalid\"),_T(\"Error\"),NULL);\n        return;\n    }\n\n    DWORD fileSize;\n    GetFileSize(hFile,&amp;fileSize);\n\n    _tprintf(_T(\"%d\\n\"),(int)fileSize);\n    getch();\n\n    if(!fileSize)\n    {\n        MessageBox(NULL,_T(\"file is empty\"),_T(\"\"),NULL);\n        return;\n    }\n\n    buf = new TCHAR[fileSize/sizeof(TCHAR)+1];\n    DWORD wasRead;\n\n    ReadFile(hFile,buf,fileSize,&amp;wasRead,NULL);\n\n    _tprintf(buf);\n\n    if(buf)\n        delete[]buf;\n    getch();\n}\n</code></pre>\n\n<p>What is wrong here, please help :).</p>\n"},{"tags":["c#","visual-studio-2010","api","winapi","wmi"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":49,"score":3,"question_id":12833501,"title":"Tracking the progress of WMI Defrag Class","body":"<p>I am looking at something like this:\n<a href=\"http://www.codeproject.com/Messages/2901324/Re-the-result-of-DefragAnalysis-method-in-csharp.aspx\" rel=\"nofollow\">http://www.codeproject.com/Messages/2901324/Re-the-result-of-DefragAnalysis-method-in-csharp.aspx</a></p>\n\n<p>Which is perfect for my needs. I ran it as a thread and everything is working good.\nThe Only thing i wanted was being able to track the progress.</p>\n\n<p>For example: 50% Analyzed or something like that.</p>\n\n<p>Any Ideas ? </p>\n"},{"tags":["windows","winapi","desktop-application","wmic"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":12844538,"title":"Whats the difference between \"IsPresent=1\" and \"IsInstalled=1\" in search criteria of IUpdateSearcher","body":"<p>I was trying to retrieve Windows Update with WUA API of IUpdateSearcher interface's search method.</p>\n\n<p>The search criteria I have passed as \"IsInstalled=1 or IsPresent=1\". Please find below is the sample code.</p>\n\n<pre><code>IUpdateSearcher* searcher;\nISearchResult* results;\n/*\n.\n.\nCode to initialize COM and get UpdateSearcher*/\n.\n.\n*/\n\nhRes = searcher-&gt;Search(\"IsInstalled=1 or IsPresent=1\", &amp;results);\n</code></pre>\n\n<p>I have gone through the definition of IsInstalled and IsPresent in MSDN (Copied for reference). Both talk about similar things.</p>\n\n<pre><code>IsPresent   \nWhen set to 1, finds updates that are present on a computer.\n\"IsPresent=1\" finds updates that are present on a destination computer. If the update\nis valid for one or more products, the update is considered present if it is installed\nfor one or more of the products.\"IsPresent=0\" finds updates that are not installed \nfor any product on a destination   computer.\n\nIsInstalled\nFinds updates that are installed on the destination computer.\n\"IsInstalled=1\" finds updates that are installed on the destination computer.\n\"IsInstalled=0\" finds updates that are not installed on the destination computer.\n</code></pre>\n\n<p>Could someone please clarify what exactly they differ?</p>\n"},{"tags":["winapi","mfc","combobox","ccombobox"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":12843066,"title":"C++ MFC add combo box string item from a widget ID","body":"<p>I've added a combo box in the gui editor in MSVC 2010 pro in my MFC project.  I have a list of strings I am grabbing from an external source and want to add them to my combo box.  I've searched for a while, and every post seems to suggest I need to use the CComboBox class, however, I have no idea how to get the class variable from the resource ID of the combobox element in the gui editor.</p>\n\n<p>In summary, how do I add a string to my combo box, either using a macro (like <code>CB_ADDSTRING(RESOURCE_ID, \"my string\");</code>) or using CComboBOx (something like <code>CComboBox::GetObject(RESOURCE_ID)-&gt;AddString(\"blah\");</code>).</p>\n\n<p>I do not do much win32 api/mfc programming, and just started fiddling around with it.</p>\n"},{"tags":["winapi","named-pipes"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12745527,"title":"Reading a message from a named pipe using Win32","body":"<p>I have a .NET application sending data to a C++ app. They are using named pipes in message mode to send data.On the C++ side to get the data I am guessing I have to do a ReadFile to get the message into a buffer. however if the buffer is too small I will get ERROR_MORE_DATA and I should issue a ReadFile again . Its been a really long time since I've done any cpp coding, so am wondering is there is a best practices way to do this kind of reallocation and then reassembly of all they byte buffers into one buffer.<br>\nI can only think of some sort of list of pointers to buffers and you keep growing the list till youre done compute the size allocate one massive buffer and copy everything over using memcpy. Is there a nicer way anyone can think of.</p>\n"},{"tags":["c++","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2862,"score":3,"question_id":3364589,"title":"Find what directory the running process EXE is stored in","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/124886/how-to-get-the-application-executable-name-in-windows-c-win32-or-c-cli\">How to get the application executable name in Windows (C++ Win32 or C++/CLI)?</a>  </p>\n</blockquote>\n\n\n\n<p>I can find what directory the process is running in using <code>GetCurrentDirectory()</code>, but what about finding the directory the executabke resides in?</p>\n"},{"tags":["c++","c","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12619695,"title":"Callback in user-mode from another process, w/o extra thread","body":"<p>I wonder if  anyone familiar with a synchronization mechanism in user-mode, by which an app can register a \"callback\" function that would be called when another app signals it ...   <strong>i don't mind the callback to be in an arbitraty thread.</strong></p>\n\n<p>Suppose i'm having lots of \"Worker\" processes in parallel, And one wants to notify them of a change (no payloaded data needed),   by which every process will have to do some internal updates.</p>\n\n<p>The immediate approach to this was to create another thread in each of them, and have an infinite loop that waits for a global event and call the callback function right afterwards.    To signal this, one process would only need to signal this global event.</p>\n\n<p>The problem is that i'll have lots of parallel processes in this project, i don't want to add thread*nProcesses to the system just to implement this, even if they're mostly paused.</p>\n\n<p>The current \"workaround\" i found for this would be to hold my own \"dummy\" registry key, and every process will \"register registery notification callback\",  when one app wants to notify the others it will just trigger a write to this key... and windows will callback every process which registered to this notification. </p>\n\n<p>Any other ideas? </p>\n"},{"tags":["java","arrays","winapi","jna","structures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12823540,"title":"How to pass an array of structures using JNA","body":"<p>I referenced another stackoverflow article \"How do I map a pointer to an array of structures in JNA\" to come up with the following code to enumerate Windows service dependencies.</p>\n\n<p>Structure and function declarations:</p>\n\n<pre><code>static class SERVICE_STATUS extends Structure {\n    public int dwServiceType;\n    public int dwCurrentState;\n    public int dwControlsAccepted;\n    public int dwWin32ExitCode;\n    public int dwServiceSpecificExitCode;\n    public int dwCheckPoint;\n    public int dwWaitHint;\n    public SERVICE_STATUS(){}\n}\n\nstatic class ENUM_SERVICE_STATUS extends Structure {\n    public ENUM_SERVICE_STATUS(){ }\n\n    public WString lpServiceName;\n    public WString lpDisplayName;\n    SERVICE_STATUS serviceStatus;\n}\n\nboolean EnumDependentServicesW(Pointer hService, int serviceState, ENUM_SERVICE_STATUS serviceStatuses, int size, IntByReference bytesNeeded, IntByReference servicesReturned);\n</code></pre>\n\n<p>If there is only one service dependency, the following code works:</p>\n\n<pre><code>IntByReference bytesNeeded = new IntByReference();\nIntByReference numberOfServices = new IntByReference();\nAdvapi32.ENUM_SERVICE_STATUS serviceStatus = new Advapi32.ENUM_SERVICE_STATUS();\nAdvapi32.ENUM_SERVICE_STATUS[] serviceStatuses = (Advapi32.ENUM_SERVICE_STATUS[]) serviceStatus.toArray(1);\n\nif (!advapi32.EnumDependentServicesW(serviceHandle, Advapi32.SERVICE_ACTIVE, null, 0, bytesNeeded, numberOfServices)) {\n    if (advapi32.EnumDependentServicesW (serviceHandle, Advapi32.SERVICE_ACTIVE, serviceStatuses[0], bytesNeeded.getValue(), bytesNeeded, numberOfServices)) {\n        for(int i = numberOfServices.getValue() - 1; i &gt;= 0; i--){\n            logger.debug(\"Service Name: \" + serviceStatuses[i].lpServiceName.toString());\n    }\n}\n</code></pre>\n\n<p>If there are 2 service dependencies, I get a NullPointerException for lpServiceName in the logger.debug call:</p>\n\n<pre><code>IntByReference bytesNeeded = new IntByReference();\nIntByReference numberOfServices = new IntByReference();\nAdvapi32.ENUM_SERVICE_STATUS serviceStatus = new Advapi32.ENUM_SERVICE_STATUS();\nAdvapi32.ENUM_SERVICE_STATUS[] serviceStatuses = (Advapi32.ENUM_SERVICE_STATUS[]) serviceStatus.toArray(2);\n\nif (!advapi32.EnumDependentServicesW(serviceHandle, Advapi32.SERVICE_ACTIVE, null, 0, bytesNeeded, numberOfServices)) { \n    if (advapi32.EnumDependentServicesW (serviceHandle, Advapi32.SERVICE_ACTIVE, serviceStatuses[0], bytesNeeded.getValue(), bytesNeeded, numberOfServices)) {\n        for(int i = numberOfServices.getValue() - 1; i &gt;= 0; i--){\n            logger.debug(\"Service Name: \" + serviceStatuses[i].lpServiceName.toString());\n    }\n}\n</code></pre>\n\n<p>The numberOfServices value for the code above is 2, as expected. I'm trying to pass the structure array instead of a pointer because I want JNA to do the memory synching. How should I be passing/using the array of structures?</p>\n"},{"tags":["c++","winapi","file-io","settings","ini"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":12839025,"title":"WinAPI - Create .ini file if it doesn't exist","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1373889/c-how-to-create-a-directory-from-a-path\">c++ how to create a directory from a path</a>  </p>\n</blockquote>\n\n\n\n<p>I'm trying to create an .ini file in the application data folder so I can use settings. I gave it a try, but I couldn't figure out how to check if it already exists, and if not, create the subdirectory and .ini file.</p>\n\n<p>When I get the last error message it says \"The system cannot find the path specified.\"</p>\n\n<pre><code>#include &lt;string&gt;\nusing namespace std;\n\n#include &lt;Windows.h&gt;\n#include &lt;Shlwapi.h&gt;\n#include &lt;ShlObj.h&gt;\n#pragma comment(lib, \"shlwapi.lib\")\n\nnamespace Settings\n{\n    CIni        Ini;\n    bool        Available = false;\n    char        Directory[MAX_PATH];\n    const char *IniFileName = \"Settings.ini\";\n\n    void CheckError() {\n        LPVOID lpMsgBuf;\n        LPVOID lpDisplayBuf;\n        DWORD dw = GetLastError(); \n\n        FormatMessage(\n            FORMAT_MESSAGE_ALLOCATE_BUFFER | \n            FORMAT_MESSAGE_FROM_SYSTEM |\n            FORMAT_MESSAGE_IGNORE_INSERTS,\n            NULL, dw,\n            MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),\n            (LPTSTR)&amp;lpMsgBuf, 0, NULL\n        );\n\n        string msg = (LPTSTR)lpMsgBuf;\n        Error(msg); // MessageBox\n    }\n\n    void Initialize() {\n        // Get AppData directory\n        if (SHGetFolderPath(0, CSIDL_COMMON_APPDATA, 0, 0, Directory) &gt;= 0) {\n            string fullpath;\n            string subDir = \"\\\\MyCompany\\\\MyProgram\\\\1.0\\\\\";\n\n            PathAppend(Directory, subDir.c_str());\n            fullpath = Directory;\n            fullpath += IniFileName;\n\n            // If directory doesn't exist, create it.\n            DWORD attrib = GetFileAttributes(Directory);\n            if (!(attrib != INVALID_FILE_ATTRIBUTES &amp;&amp; (attrib &amp; FILE_ATTRIBUTE_DIRECTORY))) {\n\n                if (CreateDirectory(Directory, NULL)) {\n                    HANDLE file = CreateFile(\n                        fullpath.c_str(), GENERIC_WRITE, 0, 0,\n                        CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, 0\n                    );\n\n                    if (file != INVALID_HANDLE_VALUE) {\n                        CloseHandle(file);\n                    } else {\n                        CheckError();\n                        return;\n                    }\n                } else {\n                    CheckError();\n                    return;\n                }\n            }\n\n            Ini.SetPathName(fullpath.c_str());\n            Available = true;\n        }\n    }\n}\n</code></pre>\n\n<p>I checked and my call to <code>CreateDirectory()</code> is returning false.\nHow can I check if the file and directory exists, and if not then create them?</p>\n"},{"tags":["c++","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1878,"score":2,"question_id":4568015,"title":"Using SHFileOperation: What errors are occuring","body":"<p>I am using the function <code>SHFileOperation()</code> to send a file to the recycling bin and I am getting 2 errors that I do not know what they mean because with this function the error codes are not <code>GetLastError()</code> values.</p>\n\n<p>When the function <code>SHFileOperation()</code> fails the return values are 0x57 (decimal 87) and 0x2 (decimal 2). Can anyone help me discover the definitions of these errors (expecially when you consider with this function, the errors are not part of the <code>GetLastError()</code> codes).</p>\n\n<p>Some important information:</p>\n\n<ul>\n<li><p>I am using Windows 7 (&amp; I know that MSDN says to use IFileOperation instead of SHFileOperation but I want to make my app backwards compatable which is why I am using SHFileOperation). If the error is occuring because I am using SHFileOperation on Windows 7 what solution could I use to make this work on all versions of windows from 2000 &amp; up? </p></li>\n<li><p>I have debugged extensively &amp; as far as I know my SHFILEOPSTRUCT is correct (correct flags used, .pFrom is a double-null ended string). One thing I know for sure is that my path to the file is correct (leads to a real file &amp; it correctly formatted). </p></li>\n<li><p>About 2/5 times the SHFileOperation() works, meaning it sends the file to the recycle bin &amp; does not returns an error</p></li>\n</ul>\n\n<p>.</p>\n\n<pre><code> BOOL result;\n SHFILEOPSTRUCT fileStruct;\n fileStruct.hwnd = hwnd; \n fileStruct.wFunc = FO_DELETE;\n fileStruct.pFrom = dest.c_str();\n fileStruct.fFlags = FOF_FILESONLY; // FOF_ALLOWUNDO\n fileStruct.fAnyOperationsAborted = result;\n\n // Call operation(delete file)\n int success = SHFileOperation( &amp;fileStruct );\n\n // if delete was successful\n if ( success != 0 ) \n {\n    printf( \"%s \\t %X %d \\n\", dest.c_str(), success, success );\n    cout &lt;&lt; result &lt;&lt; endl;\n\n    MessageBox( hwnd, \"Failed to delete file\", \"Error\", MB_OK|MB_ICONERROR );\n    return;\n }\n</code></pre>\n"},{"tags":["winapi","size","percentage","indicator"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":105,"score":0,"question_id":10706542,"title":"a bar to indicator the percentage, but not a progress bar","body":"<p>I need a bar which indicate a percentage of something, like battery engry or used space size of a hard disk. Like<img src=\"http://i.stack.imgur.com/V3GDr.png\" alt=\"enter image description here\"></p>\n\n<p>This is not a progress bar. When I use progress bar, each time I send the message <code>PBM_SETPOS</code>, it will increase from 0 to the pos.</p>\n\n<p>The bar must have the ability for me to set a value manually, and after it, it will change the color region to the specified length directly, rather than in a increasement way.</p>\n\n<p>Does WinAPI has a build in function for this purpose?</p>\n"},{"tags":["c++","c","winapi","waveout"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12833754,"title":"Name of audio device by ID(waveout c++)","body":"<p>I need to discover name of audio device by ID. I use WaveOut functions. please help me </p>\n"},{"tags":["c++","winapi","drives"],"answer_count":4,"favorite_count":2,"up_vote_count":9,"down_vote_count":0,"view_count":5258,"score":9,"question_id":286534,"title":"Enumerating all available drive letters in Windows","body":"<p>I want to enumerate all available drive letters (which aren't already taken) in Windows using VC++.</p>\n\n<p>How can I do this?</p>\n"},{"tags":["winapi","shfileoperation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12770847,"title":"System call level is not correct","body":"<p>I'm using SHFileOperation to delete files to Recycle bin. But sometimes I received a \"System call level is not correct\" error. It not happens every time or every file. Just some random files at random time. Anyone knows the reason? Thanks.</p>\n\n<p><strong>Update</strong>: Here it the code I am using:</p>\n\n<pre><code>function DeleteToRecycleBin(const ADir : WideString) : Integer;\nvar\n  op : SHFILEOPSTRUCTW;\nbegin\n  ZeroMemory(@op, sizeof(op));\n  op.pFrom := PWideChar(ADir + #0#0);\n  op.wFunc := FO_DELETE;\n  op.fFlags := FOF_SILENT or FOF_NOCONFIRMATION or FOF_NOERRORUI or FOF_ALLOWUNDO;\n  Result := SHFileOperationW(op); \nend;\n</code></pre>\n"},{"tags":[".net","wpf","winapi","hwnd","hwndsource"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12830171,"title":"Click Through a WPF Layered Window to acees a Win32 Windows","body":"<p>Pretty long Title,</p>\n\n<p>I have a legacy Win32 application lets say for this example a Winform application with a Form (a Gdi HWND) with multiple edit control and button (each one as it own Gdi HWND). On the other hand I'm having a WPF Windows (a DirectX HWND) that I would like to use as an overlay layer to add annotation and some connector metaphor (e.g.: MS Word review Mode). Both HWND are host by the same process.</p>\n\n<p>So far everything is working well except in a specific case where I want to have a click through ability over some visible WPF component (e.g.: the line connector). </p>\n\n<p>So far :\n* Setting IsHitTestVisible = false doesn't work (Du to some airspace issues);\n* Overriding the WndProc of the WPF window work partially but I need to put many effort (e.g.: making WM_MOUSELEAVE working correctly) to reroute all wnd messaging to the underline Gdi HWND.</p>\n\n<p>I would like any suggestion on a better to manage that issue.</p>\n"},{"tags":["delphi","winapi","audio","twebbrowser","urlmon"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12772289,"title":"Delphi XE2 winapi.urlmon.CoInternetSetFeatureEnabled not found?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4702285/cointernetisfeatureenabled-in-delphi2010\">CoInternetIsFeatureEnabled in Delphi2010</a>  </p>\n</blockquote>\n\n\n\n<p>I am trying to disable the annoying click on navigate sound in twebbrowser control but i can't seem to see the winapi.urlmon. CoInternetSetFeatureEnabled anywhere?</p>\n"},{"tags":["c++","c","windows","winapi","createwindowex"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12829189,"title":"Where is CreateWindowEx()?","body":"<p>I'm trying to understand how winapi works. I just started on writing my first few apps. Now I am curious about the function \"CreateWindowEx()\" I wish to know what is written inside this function, but all I can find are the arguments for calling it and the parameters for it. So I decided to look for this function within the h files, but I can't find it. Can someone please help?</p>\n"},{"tags":["c#",".net","windows","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12828678,"title":"Url connect timesout when made from .net code running as local sys ac service","body":"<p>I am trying to connect to an url from IE as well as trying to open a connection from  a .net program running as a service under local system account on Windows 2008 machine.</p>\n\n<p>The url open from the browser while the call made from the program timesout.</p>\n\n<p>Could it have something to do with the local system account settings ?\nI am not sure how to go about investigating this.</p>\n\n<p>Greatly appreciate any advice.</p>\n\n<p>Thanks,</p>\n\n<p>K</p>\n"},{"tags":["c#","winapi","wmi"],"answer_count":4,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":8490,"score":5,"question_id":1101772,"title":"WIN32_Processor::Is ProcessorId Unique for all computers","body":"<p>I want to use some thing unique for a licensing system. i decided to use ProcessorID from Win32_Processor Management class.</p>\n\n<p>I tried on two different systems with same processor type..</p>\n\n<p>It shows me same processorID for both system. i am using this code</p>\n\n<pre><code>public static String GetCPUId()\n{\n    String processorID = \"\";\n\n    ManagementObjectSearcher searcher = new ManagementObjectSearcher(\n        \"Select * FROM WIN32_Processor\");\n\n    ManagementObjectCollection mObject = searcher.Get();\n\n    foreach (ManagementObject obj in mObject)\n    {\n        processorID = obj[\"ProcessorId\"].ToString();\n    }\n\n    return processorID;\n}\n</code></pre>\n"},{"tags":["winapi","windows-7","bluetooth","createfile"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12827642,"title":"Windows device name","body":"<p>I'm trying to get a device name for a USB Bluetooth transceiver to use with CreateFile, but I don't know the file path. I've tried the USB file path but always return SHARING_VIOLATION.</p>\n\n<p>In order to understand if that's the correct device path, how can I get Windows registered device names? Is there a standard device path for a Bluetooth transceiver?</p>\n"},{"tags":["c++","c","windows","winapi","richtextbox"],"answer_count":4,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":166,"score":5,"question_id":11214796,"title":"Rounding errors when scaling the rendered output of the rich edit control via EM_FORMATRANGE","body":"<p>I am using the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb788020%28v=vs.85%29.aspx\"><code>EM_FORMATRANGE</code></a> message to render the output of a rich text control to an arbitrary device context.  However, when rendering to a bitmap, the dots-per-inch of the bitmap's device context is the same as the display device's DPI, which is 96 dots-per-inch.  This is much lower than what I would like to render to.  I'd rather render at a much higher DPI so that the user can zoom in, and perhaps print on a high-DPI printer later.</p>\n\n<p>I suspect what happens is that the RTF control calls <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd144877%28v=vs.85%29.aspx\"><code>GetDeviceCaps</code></a> with <code>LOGPIXELSX</code> and <code>LOGPIXELSY</code> to get the number of pixels per inch of the device.  It then renders the document using this DPI value at a 100% zoom level.  Windows display devices always return a value of 96 DPI, unless large fonts are being used on the system (as set in Control Panel) and the application is DPI-aware.</p>\n\n<p>Many examples on the Internet propose scaling the output of <code>EM_FORMATRANGE</code>.  This is so that any arbitrary DPI resolution can be achieved.  Most examples generally involve using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd162980%28v=vs.85%29.aspx\"><code>SetMapMode</code></a>, <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd145100%28v=vs.85%29.aspx\"><code>SetWindowExtEx</code></a>, and <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd145098%28v=vs.85%29.aspx\"><code>SetViewportExtEx</code></a> (e.g. see <a href=\"http://social.msdn.microsoft.com/Forums/en-us/netfxbcl/thread/37fd1bfb-f07b-421d-9b5e-5f4492ffbbc3\">http://social.msdn.microsoft.com/Forums/en-us/netfxbcl/thread/37fd1bfb-f07b-421d-9b5e-5f4492ffbbc3</a>).  These functions can be used to scale the rich text control's rendered output:  for example, if I specify 400% scaling, then if the rich text control rendered something that was 5 pixels wide, it would actually become 20 pixels wide.</p>\n\n<p>Unfortunately, the old GDI functions use integers instead of floating point numbers.  For example, suppose the RTF control decided that an element should be drawn at (12.7, 15.3) pixels.  This would be rounded to a position of (13, 15).  These rounded coordinates are passed to GDI, which then scales up the image using scaling specified by <code>SetMapMode</code>: for the example of 400%, it would be (13*4, 15*4), or (52, 60).  But this is not accurate: the element would have better been placed at (12.7*4, 15.3*4), or (51, 61).  The worst part is that for some cases, the error becomes cumulative.</p>\n\n<p>I believe this is the underlying cause of this very noticeable error when scaling some simple text:</p>\n\n<p><img src=\"http://i.stack.imgur.com/JIF4h.png\" alt=\"Rendered using EM_FORMATRANGE&lt;code&gt;and scaled with&lt;/code&gt;SetMapMode\"></p>\n\n<p>The above example is 8 point Segoe UI, scaled to 400% using <code>EM_FORMATRANGE</code> and <code>SetMapMode</code> on a 96 DPI display device context.  The text has now become 32 point size, but the space between each character is too high and looks unnatural.</p>\n\n<p><img src=\"http://i.stack.imgur.com/17SSe.png\" alt=\"Zoomed to 400% in WordPad\"></p>\n\n<p>The above example was created in WordPad by entering the text as 8 point Segoe UI and then using the zoom control to set to a 400% zoom level.  The space between each character looks normal.  The exact same result is achieved with a 32 point font and 100% zoom level.</p>\n\n<p>To work around this issue, I have tried the following.  For each thing tried, the result has been identically unsatisfactory when scaled to 400%.</p>\n\n<ul>\n<li>Using a scaling transform set using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd145104%28v=vs.85%29.aspx\"><code>SetWorldTransform</code></a> instead of the scaling done with <code>SetMapMode</code> and <code>SetWindowExtEx</code> etc.</li>\n<li>Passing the device context for a metafile to <code>EM_FORMATRANGE</code>, and then scaling the metafile later.</li>\n<li>Using <code>SetMapMode</code> to scale in conjunction with rendering to a metafile, and then showing the metafile later without scaling.</li>\n</ul>\n\n<p>I believe the results are always unsatisfactory because the problem boils down to the fact that the rich edit control is rounding to the nearest integer and rendering to what it thinks is a 96 DPI device - ignoring the transforms in place.  I looked into the metafile format and what I discovered is that the individual character positions are actually stored in the metafile at pixel-level resolution - that's why scaling the metafile obviously didn't work since the rounding has already happened by that point.</p>\n\n<p>I can think of two real solutions that would work around this issue:</p>\n\n<ul>\n<li>Use a device context with a higher user-specified dots per inch, such that <code>GetDeviceCaps</code> returns different values.  (Note: some examples propose using the printer device since they generally have higher DPI, but I want my code to work on systems that don't have a printer and be able to render to an off-screen buffer).</li>\n<li>Some way to tell the rich edit control to assume the device context has a different dots per inch than reported by <code>GetDeviceCaps</code>.</li>\n</ul>\n\n<p>Anything else seems like it would still be subject to these rounding errors.</p>\n\n<p>Does anyone (1) have an idea of how to implement either of the solutions I have proposed, or (2) have an alternate idea of how to achieve my goal of getting an accurate high-DPI output into a buffer?</p>\n"},{"tags":["c++","winapi","asynchronous","readfile","createfile"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":795,"score":1,"question_id":9373632,"title":"Readfile async - iso files c++","body":"<p>In my c++ application I'm rying to read iso file asynchronous by <code>createfile</code> - with overlapped flag and after it - <code>readfile</code>.\nhowever when I try this code on a simple file (txt file for example) it works. but when I run this code on iso file - it fails.\nI saw in MSDN that compressed file can only read by readfile sync calls. does iso files is in this category?\nif yes - do you have other suggestion how to read iso files async?</p>\n\n<p>this is my code:</p>\n\n<pre><code>int _tmain(int argc, _TCHAR* argv[])\n{\n\n\nHANDLE hFile;\n    DWORD NumberOfBytesRead = 0, dw;\n    BYTE *buf = (BYTE*)malloc(BUF_SIZE*sizeof(BYTE));\n    OVERLAPPED overlapped;\n    overlapped.Offset = overlapped.OffsetHigh = 0;  \n    memset(buf, 0, 1024);\n\noverlapped.hEvent = CreateEvent(NULL, true, false, NULL); \nif(NULL == overlapped.hEvent)\n    printf(\"error\");\n\nhFile = CreateFile(\"xxx.iso\",\n                  GENERIC_READ,\n                  FILE_SHARE_READ,\n                  NULL,\n                  OPEN_EXISTING,\n    FILE_FLAG_OVERLAPPED | FILE_ATTRIBUTE_NORMAL | FILE_FLAG_NO_BUFFERING , \n                  NULL);\n\n\n\nif (hFile == INVALID_HANDLE_VALUE)\n        printf(\"invalid hfile\\n\");\n\n   int i;   \n   i= ReadFile(hFile,\n                 buf,\n                 BUF_SIZE,\n                 &amp;NumberOfBytesRead,\n        &amp;overlapped);\n   if( GetLastError() == ERROR_IO_PENDING)\n   {\n\n\n       dw = WaitForSingleObject(overlapped.hEvent, INFINITE);\n    if(dw ==  WAIT_OBJECT_0)\n        if (GetOverlappedResult(hFile,&amp;overlapped,&amp;NumberOfBytesRead, TRUE) != 0)   \n        {\n            if (NumberOfBytesRead != 0) \n            {\n                printf(\"!!!\\n\");\n            }\n\n        }\n\n   }\n</code></pre>\n\n<p>thanks</p>\n"},{"tags":["c++","winapi","application","registry","settings"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":115,"score":1,"question_id":12819613,"title":"Win32 Application Settings","body":"<p>How can I store settings that can later be loaded into my application?</p>\n\n<p>For instance, I have an edit control that the user can change the font, font color, and background color of. When the user changes these, I would like to save them so that when the user opens the application again the fonts and colors will be the same as they left them.</p>\n\n<p>I had thought about writing to the windows registry, but not only am I confused as to how to save fonts there, (or even if you could do such a thing), but I also have a portable version that can be run off of a flash-drive. Is there any way to save these settings to a file that is in the same directory as the executable? If so, how would I go about saving and loading these?</p>\n\n<p>If there isn't a way to accomplish this using a settings file, how could I use the windows registry to do it?</p>\n"},{"tags":["file","winapi","permissions","uac","privileges"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":12820689,"title":"Win32 - Get permission to save file to C drive","body":"<p>I have a program that the user can save the output session to a text file. This works fine, but when I try to save the file to a location such as <code>C:\\</code>, it shows an error dialog saying:</p>\n\n<p><code>You don't have permission to save to this location. Contact the administrator to obtain permission. Would you like to save to the Documents folder instead?</code></p>\n\n<p>When I click no, thinking it would just cancel the operation, my application crashes.\nI do not want my application to <em>require</em> administrative privileges, but how, when attempting to save the file, do I ask the user to provide privileges (such as bring up the UAC dialog, and if required provide authentication). If the user cannot provide the permissions I would like to just stay on the Save File Dialog until the user either picks a location they have permission to save to, or presses cancel. I do not really want the permission to be asked for when the program starts, just when the user saves the file to a location they need permission for.</p>\n\n<p>By the way I am currently logged in as administrator when running my application, it's the only account on my computer running Windows Vista.</p>\n"},{"tags":["windows","winapi","registry"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":76,"score":2,"question_id":12813679,"title":"GetProcAddress returning NULL for RegDeleteKeyEx","body":"<p>I am trying to implement recursive deletion of Registry Keys for both 32-bit and 64-bit OS. As <strong>RegDeleteKeyEx</strong> is not defined for OSes lesser than XP x64 Professional, I am trying to use the function indirectly.</p>\n\n<p><strong>Problem</strong>:: Even on x64, the <strong>GetProcAddress()</strong> is returning NULL.</p>\n\n<pre><code>//Global Declarations \ntypedef LONG (WINAPI * PFN_RegDeleteKeyEx)(HKEY hKey , LPCTSTR lpSubKey , REGSAM samDesired , DWORD Reserved );\nPFN_RegDeleteKeyEx _RegDeleteKeyEx ;\n\n//The code inside function\nhAdvAPI32 = LoadLibrary(TEXT(\"Advapi32.dll\"));\n_RegDeleteKeyEx = (PFN_RegDeleteKeyEx)GetProcAddress( hAdvAPI32, \"RegDeleteKeyEx\" );\nif( _RegDeleteKeyEx == NULL )\n     printf(\"NULL\\n\") ;\n</code></pre>\n"},{"tags":["javascript","c","winapi","frameworks"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":52,"score":-5,"question_id":12819755,"title":"What type of IDE and project could be choose for framework in C++?","body":"<p>What Environment (software) you should use for that? I prefer VS C++ Professional.\nWhat type of project you should use for that? </p>\n\n<ul>\n<li>Win32 API, </li>\n<li>CLR, </li>\n<li>MFC,</li>\n<li>ATL, </li>\n<li>Class Library.</li>\n</ul>\n\n<p>Please give me some easy steps to do that. </p>\n"},{"tags":["winapi","assembly","x86","interrupt-handling"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12813875,"title":"_asm int 5H, can use visual studio to excute this instruction?","body":"<p>_asm int 5h usually work as prtscrn. how can check this one. not only prntscrn any interrupt like reboot int 19h.. etc. can interrupt through application.\nI tried to code for reboot</p>\n\n<pre><code>int _tmain(int argc, _TCHAR* argv[])\n{\n    //_asm mov al, 2\n    _asm int 19h //reboot\n    //_asm in 3\n}\n</code></pre>\n\n<p>its giving access violation</p>\n"}]}
{"total":13828,"page":7,"pagesize":100,"questions":[{"tags":["c#","winapi","cursor","caret"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":12816200,"title":"draw cursor on window","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/848868/drawing-a-blinking-caret-in-winforms\">Drawing a blinking caret in Winforms</a>  </p>\n</blockquote>\n\n\n\n<p>I write a text box, respectively for my needs, I use the winAPI function <strong>drawtext</strong> to draw the text that user types.\nBut when I reach the part of the drawing cursor (I do not mean the mouse cursor, but to the selection start cursor) I'm trying to understand how it should work, I see that in RichTextBox the text box do not redraw when you move the cursor. so how is the drawing of the cursor.</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12796827,"title":"Accept only character and space in text box(edit control) in Win32","body":"<p>I don't know how to text box accept only character and space when we type to textbox.I just think we can use WM_Keydown but i just guess it cannot know which edit control we type in.\nThis is my code to create form</p>\n\n<pre><code>void CREATE_EDITNAMECONTROL()\n\nCreate_Control( hNameEditControl,   /* Handle */\n    NULL,//NULL,        /* Handle of parent */\n    L\"Edit\",  /* class name */\n    ID_EDIT_CONTROl , /* ID     */\n    L\"\",        /* Caption/Title */\n    EDITCONTROL_STYLE, /* Style */\n    200,        /* Position X */\n    70,     /* Position Y */\n    160,        /* Width      */\n    30 );       /* Height     */\n</code></pre>\n\n<p><pre>\nvoid CREATE_EDITDATECONTROL()</p>\n\n<code>Create_Control( hDateEditControl,   /* Handle */\n    NULL,//NULL,        /* Handle of parent */\n    L\"Edit\",  /* class name */\n    ID_EDIT_CONTROl , /* ID     */\n    L\"\",        /* Caption/Title */\n    EDITCONTROL_STYLE, /* Style */\n    200,        /* Position X */\n    110,        /* Position Y */\n    160,        /* Width      */\n    30 );       /* Height     */\n</code></pre>\n\n<p></p>\n"},{"tags":["c","winapi","process"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12810971,"title":"How would I migrate to a new process in C?","body":"<p>this is a pretty complicated procedure so please bear with me!\nThe concept is straight forward anyway:</p>\n\n<p>I have a C program that generates a batch file according to user input and executes it. In all cases, the batch file opens up a new terminal. I want my program to execute set commands through the new terminal. </p>\n\n<p>I'm 99% positive I would need to use the Win32 API for this and am perfectly fine with taking on that challenge, but I would just like a little nudge in the right direction.</p>\n\n<p>Any suggestions on how one would go about designing such a program?</p>\n\n<p>Thank you very much for your time!</p>\n"},{"tags":["winapi","visual-c++","atl","wtl"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12796501,"title":"Detect clicking inside listview and show context menu","body":"<p>I have a listview created as a resource and loaded on a dialog window.  I want to detect and show a context menu only when items within the listview have been clicked.</p>\n\n<pre><code> MESSAGE_HANDLER(WM_CONTEXTMENU,OnContextMenu)\n\n        LRESULT OnContextMenu(UINT /*uMsg*/, WPARAM wParam, LPARAM lParam, BOOL&amp; bHandled)\n            {\n                int iSelected = -1;\n    int iFocusGroup = -1;\n    iSelected = SendMessage((HWND)wParam, LVM_GETNEXTITEM, -1,LVNI_SELECTED);\n    iFocusGroup = ListView_GetFocusedGroup((HWND)wParam);\n    if( iSelected != -1 &amp;&amp; iFocusGroup == -1) {\n                    hPopupMenu = CreatePopupMenu();\n                    Insert\n\nMenu(hPopupMenu,  0,     MF_BYCOMMAND | MF_STRING | MF_ENABLED, ID_SHREDTASK_CTXMENU_DELETE, TEXT(\"Delete\"));\n                TrackPopupMenu(hPopupMenu, TPM_TOPALIGN | TPM_LEFTALIGN, GET_X_LPARAM(lParam), GET_Y_LPARAM(lParam), 0, m_hWnd, NULL); \n            }\n            return 0;\n        }\n</code></pre>\n\n<p>OK, I've edited this and it works the way it is presented here but the question still stands and can someone explain to me what's the thing with focus group here and why if I send the LVM_GETNEXTITEM message while in the dialog it returns != -1 ? isn't it solely for Listviews ?</p>\n\n<p>EDIT :</p>\n\n<p>Here is another alternative that I've worked out based on your responses:</p>\n\n<pre><code>LRESULT OnNotifyRClick(UINT uMsg, WPARAM wParam, LPARAM lParam, BOOL&amp; bHandled)\n    {\n          switch (uMsg)\n        {\n            case WM_NOTIFY:\n                switch (((LPNMHDR)lParam)-&gt;code)\n                {\n                case NM_RCLICK:\n                    if (((LPNMHDR)lParam)-&gt;idFrom == IDC_LISTTASKFILES)\n                    {                       \n                         int iSelected = -1;\n                         iSelected = SendMessage(GetDlgItem(IDC_LISTTASKFILES), LVM_GETNEXTITEM, -1,LVNI_SELECTED);\n\n                        if( iSelected != -1 ) {\n                            hPopupMenu = CreatePopupMenu();\n                            InsertMenu(hPopupMenu,  0,     MF_BYCOMMAND | MF_STRING | MF_ENABLED, ID_SHREDTASK_CTXMENU_DELETE, TEXT(\"Delete\"));\n                            TrackPopupMenu(hPopupMenu, TPM_TOPALIGN | TPM_LEFTALIGN, ((CPoint)GetMessagePos()).x, ((CPoint)GetMessagePos()).y, 0, m_hWnd, NULL); \n                        }\n                         bHandled = true;\n\n                        return TRUE;\n                    }\n                    break; \n\n                break;\n                }\n\n        }\n          return false;\n    }\n</code></pre>\n"},{"tags":["c++","c","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12813677,"title":"CreateFile() return INVALID_HANDLE_VALUE(C++)","body":"<pre><code>void main()\n{\nLPSTR FileName;\nFileName = \"c:\\\\test2.wav\";\nhFile = CreateFile((LPCWSTR)FileName, GENERIC_READ, 0 , 0,\n    OPEN_EXISTING, FILE_ATTRIBUTE_ARCHIVE, 0);\nif (hFile == INVALID_HANDLE_VALUE)\n{\n    cout&lt;&lt;\"INVALID_HANDLE_VALUE\"&lt;&lt;endl;\n    return;\n}\n\n}\n</code></pre>\n\n<p>This program always prints \"INVALID_HANDLE_VALUE\", why?. File c:\\test2.wav exists. </p>\n"},{"tags":["c++","c","winapi","waveout"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":69,"score":-1,"question_id":12796917,"title":"Play .wav with WaveOutOpen(C++)","body":"<p>I need to play audio file(.wav) with waveOutOpen function. I found manual for this. <a href=\"http://www.planet-source-code.com/vb/scripts/ShowCode.asp?txtCodeId=4422&amp;lngWId=3\" rel=\"nofollow\">http://www.planet-source-code.com/vb/scripts/ShowCode.asp?txtCodeId=4422&amp;lngWId=3</a> but I dont know how change this for .wav files. Please help me...</p>\n"},{"tags":["c++","windows","winapi","events","window"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":12811384,"title":"Catching Window Resize","body":"<p>I'm trying to resize a graphics device buffer when the window is resized, but I have no luck in detecting the event.</p>\n\n<p>This is C++ Windows programming. I tried:</p>\n\n<pre><code>            while(WM_QUIT != msg.message){\n                if(PeekMessage(&amp;msg, NULL, 0, 0, PM_REMOVE)){\n                    switch(msg.message){\n                    case WM_SIZE:\n                        return; //&lt;-- If the program closes because of this return, then I know I found the right statements.\n                    }\n                    //TranslateMessage(&amp;msg);\n                    //DispatchMessage(&amp;msg);\n                }else{\n                    poly.setConstantBuffer(space.getCamera());\n                    poly.draw(iSize);\n\n                    graphics.render();\n                }\n            }\n</code></pre>\n\n<p>It is not returning, so that means that is not correct. What is the right way to catch the resize event?</p>\n"},{"tags":["windows","delphi","winapi","harddrive"],"answer_count":2,"favorite_count":4,"up_vote_count":8,"down_vote_count":2,"view_count":459,"score":6,"question_id":8733457,"title":"How to programatically prevent Windows from hard disk drive spin down?","body":"<p>My program performs a task on the hard disk free space.\nThe task is quite long, <strong>it takes 1-2 hours</strong>.</p>\n\n<p>The problem is that on laptop the hard disk may be turned off after few minutes when the user is inactive.</p>\n\n<p><strong>How do I programmatically prevent Windows from hard disk spin down (power off) ?</strong></p>\n"},{"tags":["c","winapi","pointers"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12808516,"title":"pointer to baseAddress through CONTEXT.Ebx+8","body":"<p>I am trying to implement the known method of \"Dynamic Forking of Win32 EXE\", which is knows as RunPE.\nMy problem is that i am can't get the right result of the \"base address\" as it mentioned in the 3rd point at <a href=\"http://www.security.org.sg/code/loadexe.html\" rel=\"nofollow\">http://www.security.org.sg/code/loadexe.html</a></p>\n\n<p>This is my code:</p>\n\n<pre><code>DWORD* peb;\nDWORD* baseAddress;\n...snip...\n\nGetThreadContext(hTarget, &amp;contx)\n\npeb = (DWORD *) contx.Ebx;\nbaseAddress = (DWORD *) contx.Ebx+8;\n\n_tprintf(_T(\"The EBX [PEB] is: 0x%08X\\nThe base address is: 0x%08X\\nThe Entry Point is: 0x%08X\\n\"), peb, baseAddress, contx.Eax);\n</code></pre>\n\n<p>and the output is as follwos:</p>\n\n<blockquote>\n  <p>The EBX [PEB] is: 0x7FFD4000 </p>\n  \n  <p>The base address is: 0x7FFD4020</p>\n  \n  <p>The Entry Point is: 0x00401000</p>\n</blockquote>\n\n<p>I think that my problem is with the implementation of my baseAddress pointer, but i can't figure out exactly what is the issue. Or could be that i havn't understand the above article correctly and baseAddress isn't ImageBase, if so what is baseAddress ?</p>\n\n<p>I have tried to run it under Win 7 64b and Win-XP and on both i am get the same incorrect results.</p>\n"},{"tags":["c++","windows","winapi","application","registry"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":73,"score":-3,"question_id":12808547,"title":"How to list/enemurate all sofwares and related .exe installed on a Windows Computer in C++?","body":"<p>As a component of an application, I have to develop in c++ a way to list all the software installed on a windows computer. In order to execute them, I need to have their related executables. (Example: Opera => opera.exe).\nAt this stage I have been able to look in the registry in:\nSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall and SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall and found several softwares (not all of them)\nSo here's my questions:\n- How can I have all the software installed on the computer? (Did I miss a registry folder?)\n- How can I define the good .exe related to each software?</p>\n"},{"tags":["delphi","winapi","windows-7","delphi-2009","delphi-xe3"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":159,"score":2,"question_id":12807758,"title":"Why does a combo box change its text to an item text at font change?","body":"<p>It's obviously a bug, but I cannot track down why happens. Here is a minimalistic code to reproduce. Just drop a combo box and button on a form and write the following event handlers:</p>\n\n<pre><code>procedure TForm1.FormCreate(Sender: TObject);\nbegin\n  ComboBox1.Items.Add('A Item');\n  ComboBox1.Items.Add('B Item');\n  ComboBox1.Items.Add('C Item');\n  ComboBox1.Style := csDropDown;\n  ComboBox1.AutoComplete := False;\nend;\n\nprocedure TForm1.Button1Click(Sender: TObject);\nbegin\n  ComboBox1.Text := 'B';\n  ComboBox1.Font.Color := clRed;\n  ShowMessage(IntToStr(ComboBox1.ItemIndex));\nend;\n</code></pre>\n\n<p>When you click the button for the first time, you will see in the combo edit fully selected text of the second item, but message box will show you the item index equals to -1. When you drop down it, the second item seems to be selected. The second click will set the proper text though, but the rest will be the same as at the first click. So, combo box in this case behaves like if some weird autocompletion would be enabled. </p>\n\n<p>I've tracked this down to the <code>EditWndProc</code> where after font change is received <code>WM_SETTEXT</code> message with the text of the second item, but I don't know where it comes from and why with the text of the second item.</p>\n\n<p>So, my question is quite specific - what (which method) sends the <code>WM_SETTEXT</code> at font change and how does it know about second item text match when the autocompletion is disabled ?</p>\n\n<p>So far I could reproduce this in Delphi 2009 and Delphi XE3 on Windows 7 Home Premium 64-bit with the most recent updates installed.</p>\n"},{"tags":["c++","winapi","screenshot","bmp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":12806747,"title":"Black image when creating a Bitmap from a selection of the screen in C++","body":"<p>I am trying to get a screen capture of a selected region of the desktop. </p>\n\n<p>The problem I am having is that the output (.bmp file) is just black. </p>\n\n<p>I took CreateBitmapInfoStruct(); and CreateBMPFile(); from <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd145119%28v=vs.85%29.aspx\" rel=\"nofollow\">MSDN</a>. The rest has been snips from the internet Frankenstein-ed together by me.</p>\n\n<p>Here is what my code looks like presently:</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n#include &lt;fstream&gt;\n#include &lt;string&gt;\nusing namespace std;\n\nPBITMAPINFO CreateBitmapInfoStruct(HBITMAP hBmp)\n{ \n    BITMAP bmp; \n    PBITMAPINFO pbmi; \n    WORD    cClrBits; \n\n    // Retrieve the bitmap color format, width, and height.  \n    if (!GetObject(hBmp, sizeof(BITMAP), (LPSTR)&amp;bmp)) \n        cout &lt;&lt; \"ERROR:1\";\n\n    // Convert the color format to a count of bits.  \n    cClrBits = (WORD)(bmp.bmPlanes * bmp.bmBitsPixel); \n    if (cClrBits == 1) \n        cClrBits = 1; \n    else if (cClrBits &lt;= 4) \n        cClrBits = 4; \n    else if (cClrBits &lt;= 8) \n        cClrBits = 8; \n    else if (cClrBits &lt;= 16) \n        cClrBits = 16; \n    else if (cClrBits &lt;= 24) \n        cClrBits = 24; \n    else cClrBits = 32; \n\n    // Allocate memory for the BITMAPINFO structure. (This structure  \n    // contains a BITMAPINFOHEADER structure and an array of RGBQUAD  \n    // data structures.)  \n\n     if (cClrBits &lt; 24) \n         pbmi = (PBITMAPINFO) LocalAlloc(LPTR, \n                    sizeof(BITMAPINFOHEADER) + \n                    sizeof(RGBQUAD) * (1&lt;&lt; cClrBits)); \n\n     // There is no RGBQUAD array for these formats: 24-bit-per-pixel or 32-bit-per-pixel \n\n     else \n         pbmi = (PBITMAPINFO) LocalAlloc(LPTR, \n                    sizeof(BITMAPINFOHEADER)); \n\n    // Initialize the fields in the BITMAPINFO structure.  \n\n    pbmi-&gt;bmiHeader.biSize = sizeof(BITMAPINFOHEADER); \n    pbmi-&gt;bmiHeader.biWidth = bmp.bmWidth; \n    pbmi-&gt;bmiHeader.biHeight = bmp.bmHeight; \n    pbmi-&gt;bmiHeader.biPlanes = bmp.bmPlanes; \n    pbmi-&gt;bmiHeader.biBitCount = bmp.bmBitsPixel; \n    if (cClrBits &lt; 24) \n        pbmi-&gt;bmiHeader.biClrUsed = (1&lt;&lt;cClrBits); \n\n    // If the bitmap is not compressed, set the BI_RGB flag.  \n    pbmi-&gt;bmiHeader.biCompression = BI_RGB; \n\n    // Compute the number of bytes in the array of color  \n    // indices and store the result in biSizeImage.  \n    // The width must be DWORD aligned unless the bitmap is RLE \n    // compressed. \n    pbmi-&gt;bmiHeader.biSizeImage = ((pbmi-&gt;bmiHeader.biWidth * cClrBits +31) &amp; ~31) /8\n                                  * pbmi-&gt;bmiHeader.biHeight; \n    // Set biClrImportant to 0, indicating that all of the  \n    // device colors are important.  \n     pbmi-&gt;bmiHeader.biClrImportant = 0; \n     return pbmi; \n } \n\nvoid CreateBMPFile(LPTSTR pszFile, PBITMAPINFO pbi, \n                  HBITMAP hBMP, HDC hDC) \n { \n     HANDLE hf;                 // file handle  \n    BITMAPFILEHEADER hdr;       // bitmap file-header  \n    PBITMAPINFOHEADER pbih;     // bitmap info-header  \n    LPBYTE lpBits;              // memory pointer  \n    DWORD dwTotal;              // total count of bytes  \n    DWORD cb;                   // incremental count of bytes  \n    BYTE *hp;                   // byte pointer  \n    DWORD dwTmp; \n\n    pbih = (PBITMAPINFOHEADER) pbi; \n    lpBits = (LPBYTE) GlobalAlloc(GMEM_FIXED, pbih-&gt;biSizeImage);\n\n    if (!lpBits) \n         cout &lt;&lt; \"ERROR:2\"; \n\n    // Retrieve the color table (RGBQUAD array) and the bits  \n    // (array of palette indices) from the DIB.  \n    GetDIBits(hDC, hBMP, 0, (WORD) pbih-&gt;biHeight, lpBits, pbi, \n        DIB_RGB_COLORS);\n\n    // Create the .BMP file.  \n    hf = CreateFile(pszFile, \n                   GENERIC_READ | GENERIC_WRITE, \n                   (DWORD) 0, \n                    NULL, \n                   CREATE_ALWAYS, \n                   FILE_ATTRIBUTE_NORMAL, \n                   (HANDLE) NULL); \n    if (hf == INVALID_HANDLE_VALUE) \n        cout &lt;&lt; \"ERROR:4\"; \n    hdr.bfType = 0x4d42;        // 0x42 = \"B\" 0x4d = \"M\"  \n    // Compute the size of the entire file.  \n    hdr.bfSize = (DWORD) (sizeof(BITMAPFILEHEADER) + \n                 pbih-&gt;biSize + pbih-&gt;biClrUsed \n                 * sizeof(RGBQUAD) + pbih-&gt;biSizeImage); \n    hdr.bfReserved1 = 0; \n    hdr.bfReserved2 = 0; \n\n    // Compute the offset to the array of color indices.  \n    hdr.bfOffBits = (DWORD) sizeof(BITMAPFILEHEADER) + \n                    pbih-&gt;biSize + pbih-&gt;biClrUsed \n                    * sizeof (RGBQUAD); \n\n    // Copy the BITMAPFILEHEADER into the .BMP file.  \n    if (!WriteFile(hf, (LPVOID) &amp;hdr, sizeof(BITMAPFILEHEADER), \n        (LPDWORD) &amp;dwTmp,  NULL)) \n    {\n       cout &lt;&lt; \"ERROR:5\";\n    }\n\n    // Copy the BITMAPINFOHEADER and RGBQUAD array into the file.  \n    if (!WriteFile(hf, (LPVOID) pbih, sizeof(BITMAPINFOHEADER) \n                  + pbih-&gt;biClrUsed * sizeof (RGBQUAD), \n                  (LPDWORD) &amp;dwTmp, ( NULL)))\n        cout &lt;&lt; \"ERROR:6\";\n\n    // Copy the array of color indices into the .BMP file.  \n    dwTotal = cb = pbih-&gt;biSizeImage; \n    hp = lpBits; \n    if (!WriteFile(hf, (LPSTR) hp, (int) cb, (LPDWORD) &amp;dwTmp,NULL)) \n           cout &lt;&lt; \"ERROR:7\";\n\n    // Close the .BMP file.  \n     if (!CloseHandle(hf)) \n           cout &lt;&lt; \"ERROR:8\"; \n\n    // Free memory.  \n    GlobalFree((HGLOBAL)lpBits);\n}\n\nvoid getBit(string name) {\n    int nX = 300;\n    int nX2 = 600;\n    int nY = 300;\n    int nY2 = 700;\n     HDC hScrDC  =  GetDC(NULL); \n     HDC hMemDC  =  CreateCompatibleDC(hScrDC);\n     int nWidth  =  nX2  -  nX; \n     int nHeight  =  nY2  -  nY; \n     HBITMAP hBitmap  =  CreateCompatibleBitmap(hScrDC,  nWidth,  nHeight); \n     HBITMAP hOldBitmap  =  (HBITMAP)SelectObject(hMemDC,  hBitmap); \n\n     BitBlt(hMemDC,  0,  0,  nWidth,  nHeight, \n     hScrDC,  nX,  nY,  SRCCOPY); \n     hBitmap  =  (HBITMAP)SelectObject(hMemDC,  hOldBitmap); \n     DeleteDC(hScrDC); \n     DeleteDC(hMemDC); \n    // now your image is held in hBitmap. You can save it or do whatever with it\n    PBITMAPINFO pbi = CreateBitmapInfoStruct(hBitmap);\n    //File name\n    LPTSTR path = L\"test.bmp\";\n    CreateBMPFile(path,pbi,hBitmap,hMemDC);\n}\n\nvoid main(void) {\n    getBit(\"SAVE\");\n    cout &lt;&lt; \"Done\";\n    int wait;\n    cin &gt;&gt; wait;\n}\n</code></pre>\n"},{"tags":["c++","winapi","http"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12806592,"title":"WinHttpQueryDataAvailable returns various results when downloading data","body":"<p>I am attempting to download a fairly large file from a site, and will be doing this download several times per day. I am using a loop with <code>WinHttpQueryDataAvailable(hRequest, &amp;dwSize)</code> and <code>WinHttpReadData( hRequest, (LPVOID)pszOutBuffer, dwSize, &amp;dwDownloaded)</code> to continuously read data for the file, until it has been completely downloaded, which is determined when dwSize == 0. However, sometimes I get error codes when downloading the file, specifically 12030 and 12002 (ERROR_WINHTTP_CONNECTION_ERROR and ERROR_WINHTTP_TIMEOUT). </p>\n\n<p>What is the best way to add some resilience to the code?  Should I be attempting to reconnect and pick up where I left off? If so, how can this be accomplished with the WinHTTP functions?  The timeout is already reasonably long; could the timeout error actually be a connection error as well?</p>\n\n<p>Any advice would be appreciated!</p>\n"},{"tags":["c#","winapi","enumeration","window-handles"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":3,"view_count":147,"score":-2,"question_id":12230561,"title":"manipulating window / process by its handle (even if there's no title or a window)","body":"<p>I want to check on this code and see if you can help me implement it </p>\n\n<p>if so ,\nis there a way to query faster getting only \nprocess that starts with \"a\" and process starts with \"b\"</p>\n\n<p>(is it by using the <code>filter</code> parameter )</p>\n\n<p>could it be done via other method with parameters required by </p>\n\n<pre><code>EnumDesktopWindows(IntPtr.Zero, filter, IntPtr.Zero)\n</code></pre>\n\n<p>how can i call <code>EnumDesktopWindows()</code> with another maybe not only using native method -  filtering as mentioned   ... kind'a \"helper\" method</p>\n\n<pre><code> private const string USER32 = \"user32.dll\";\n\n    internal delegate bool EnumDelegate(IntPtr hWnd, int lParam);\n\n    [DllImport(WindowsFunctions.USER32, EntryPoint = \"GetWindowText\", ExactSpelling = false, CharSet = CharSet.Auto, SetLastError = true)]\n    internal static extern int GetWindowText(IntPtr hWnd, StringBuilder lpWindowText, int nMaxCount);\n\n    [DllImport(WindowsFunctions.USER32)]\n    [return: MarshalAs(UnmanagedType.Bool)]\n    internal static extern bool IsWindowVisible(IntPtr hWnd);\n\n    [DllImport(WindowsFunctions.USER32)]\n    internal static extern int GetWindowThreadProcessId(IntPtr hWnd, out int processId);\n\n    [DllImport(WindowsFunctions.USER32)]\n    internal static extern bool EnumDesktopWindows(IntPtr hDesktop, EnumDelegate lpfn, IntPtr lParam);\n\n\n\n\n\n\n\npublic class WindowData\n{\n    public string Title { get; set; }\n    public long ProcessId { get; set; }\n    public long ThreadId { get; set; }\n    public IntPtr HWindow { get; set; }\n}\n\n\n        var collection = new List&lt;WindowData&gt;();\n\n        EnumDelegate filter = delegate(IntPtr hWnd, int lParam)\n        {\n            StringBuilder strbTitle = new StringBuilder(255);\n            int nLength = WindowsFunctions.GetWindowText(hWnd, strbTitle, strbTitle.Capacity + 1);\n            string strTitle = strbTitle.ToString();\n\n            if (IsWindowVisible(hWnd) &amp;&amp; !string.IsNullOrEmpty(strTitle))\n            {\n                int pid;\n                int threadId = WindowsFunctions.GetWindowThreadProcessId(hWnd, out pid);\n\n                collection.Add(new WindowData()\n                {\n                    Title = strbTitle.ToString(),\n                    ProcessId = pid,\n                    ThreadId = threadId,\n                    HWindow = hWnd\n                });\n            }\n\n            return true;\n        };\n\n\n\n        if (EnumDesktopWindows(IntPtr.Zero, filter, IntPtr.Zero))\n        {\n            return collection.ToArray();\n        }\n\n        return null;\n    }\n</code></pre>\n"},{"tags":["c++","gui","winapi","window"],"answer_count":5,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":7153,"score":6,"question_id":2122506,"title":"How to create a hidden window in C++","body":"<p>How to create a hidden window ?</p>\n\n<p>The purpose of this window is to receive some messages.</p>\n"},{"tags":["c++","winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":99,"score":1,"question_id":12803009,"title":"C++ Win32: Calling WM_PAINT from another thread using SendMessage, drawing has no effect","body":"<p>I am currently developing a program (C++ Win32, Visual Studio 2012) that captures audio signals from a microphone, computes a Fourier Transformation (you know, to get the frequencies in the audio) in another thread, and finally plots the results on a screen.</p>\n\n<p>Everything works fine, except for the plotting, so this is a GUI related topic.</p>\n\n<p>In WndProc, I get a message when a buffer is full and ready to be processed, and I call</p>\n\n<pre><code>boost::thread t(&amp;ComputationThread,data);\n</code></pre>\n\n<p>to start the computation thread.</p>\n\n<p>At the end of <code>ComputationThread</code> I send a message to the GUI thread to plot the data, using a predefined fixed value and the data pointer as arguments:</p>\n\n<pre><code>SendMessage(hWnd, WM_PAINT, PARAM_FFT_COMPUTED, (LPARAM)data);\n</code></pre>\n\n<p>This works fine as well, I get the message and I can also write the computed data to a file, however, drawing on the form (e.g. using <code>SetPixel</code>) has no effect, while it has an effect when <code>wParam</code> is <em>not</em> <code>PARAM_FFT_COMPUTED</code>, for example when the form is resized.</p>\n\n<p><code>InvalidateRect</code>has no effect either.</p>\n\n<p>What am I doing wrong?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["winapi","visual-c++","windows-update","wmic"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":70,"score":-1,"question_id":12799414,"title":"Windows Update Agents Vs WMIC QFE GET","body":"<p>I am exploring the reliability of the following two ways to get the Windows Patch Information.</p>\n\n<ol>\n<li>Using Windows Update Agent - IUpdateSearcher Interface with COM.</li>\n<li>Using WMIC QFE GET (Either through client or WMI Interfaces with\nCOM)</li>\n</ol>\n\n<p>Below are the queries I have for the above two methods</p>\n\n<p><strong>Using Windows Update Agent - IUpdateSearcher Interface with COM.</strong></p>\n\n<ol>\n<li>Does IUpdateSearcher navigates through the following registry and provides the information?<br>\nHKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Component Based Servicing</li>\n<li>Are there any other registry paths IUpdateSearcher looks for to give Update information? </li>\n<li>Does IUpdateSearcher give a super set of what WMIC QFE gives?</li>\n</ol>\n\n<p><strong>Using WMIC QFE GET (Either through client or WMI Interfaces with COM)</strong></p>\n\n<ol>\n<li>Does WMIC QFE search the following registry path and provides the\ninformation? \nHKEY_LOCAL_MACHINE\\Software\\Microsoft\\Updates (OR)\nHKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Updates</li>\n<li>Are there any other registry paths WMIC QFE GET looks for to give Update information?</li>\n</ol>\n\n<p>Also, Of the above two ways, </p>\n\n<ol>\n<li>Which method is the best way to get the Update Information without\ndata loss? </li>\n<li>Which method performs faster?</li>\n</ol>\n\n<p>Could someone provide answers for all my queries?</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":34,"score":-3,"question_id":12797501,"title":"what is wrong with QueryStatus function  in vista 64?","body":"<p>I need to use</p>\n\n<pre><code>QueryStatus(IDM_CARETBROWSINGMODE);\n</code></pre>\n\n<p>it works properly in windows 7 and windows xp but not in the vista 64 bit. it returns 0(means it is failed). My program is 32 bit native C++.\nwhat is the problem?</p>\n"},{"tags":["c++","winapi","serial-port"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":3927,"score":0,"question_id":757556,"title":"Determine if device is connected/disconnected to RS232 port without opening the port","body":"<p>I\"m working on a C++ Win32 application for which I'm trying to essentially \"auto detect\" if a device has been plugged into one of the RS232 ports and then if it has been disconnected.</p>\n\n<p>The checking for a connected device is easy enough because my use case allows me to assume that this particular thread will be the first to try to initiate communication with the port.  I'm able to scan the available ports every minute or so and once I've found a port with the device on it I flag that port has having a device, close the port, then set an event so that the process that actually will use the device knows it can now connect on that port.</p>\n\n<p>The disconnect detect is where I run into trouble.  When I'm scanning for connected devices I can actually send data to the port to be sure that, if there is a device, it's the specific device I'm looking for.  But once it's connected, that port will already be open by the other process and I can no longer open that port from the detect thread.  So I am looking for a way to either open the port in a \"listen mode\" or something like that so I can just see if the device is still there.</p>\n\n<p>I briefly came across something about watching the DSR or DTR line or something...but couldn't find any more or how to actually do it.</p>\n\n<p>Any suggestions?</p>\n\n<p><strong>Edit:</strong>  Looks like I need to clarify a little more...  For detecting the disconnect, I <em>cannot</em> send data to the RS232 port <em>in any way.</em>  Also, I cannot assume that another application actually has the port open.  The device may be physically connected, but without and open connection...but I still can't risk sending data to it.  I was hoping there was a way to just check that there was still power on that port or something like that.</p>\n"},{"tags":["c","winapi","assembly","x86"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12796380,"title":"SIGSEGV recovery?","body":"<p>I ve got some SSE procedure which zeroes memory in loop,\nWhen pointer is unaligned it raises SIGSEGV which goes \ninto my handler. Can I get more info here in such handler\nroutine, Now I got no info where it was done, can I also\nreact in some predictible way from it? When I chose to \nignore it It seemd to me that it should go back and becouse\nit was in loop raise SIGSEGV again, (got such behaviour with \ndivision by zero when where I ignore it it just goes on\nfurther) but it does not work here such way but sadly just \ncrashes after ignoring. Can I do some more eleborate recovery here?</p>\n\n<p>EDIT - ADD</p>\n\n<p>in my signal.h (some very old win32 compiler but I use it)\n I have such stuff</p>\n\n<pre><code>    /* _SIGCONTEXT contains exception info for WIN32 exceptions that were caught\n     and turned into signals.  There will always be three 32-bit parameters\n     passed to the user's signal handler.  Unused parameters will be 0.  The\n    _PSIGCONTEXT parameter will always be the last (third) parameter.\n      */\n\n    typedef struct\n     {\n      struct _EXCEPTION_RECORD * _pexecptionrecord; /* defined in WINNT.H */\n      struct _CONTEXT *          _pcontext;         /* defined in WINNT.H */\n      unsigned long              _result;           /* return value for the SEH */\n     } _SIGCONTEXT, *_PSIGCONTEXT;\n\n     typedef int sig_atomic_t;   /* Atomic entity type (ANSI) */\n\n     typedef void (*_CatcherPTR)(int);\n\n     #define SIG_DFL ((_CatcherPTR)0)   /* Default action   */\n     #define SIG_IGN ((_CatcherPTR)1)   /* Ignore action    */\n     #define SIG_ERR ((_CatcherPTR)-1)  /* Error return     */\n\n      //////////////////////////////////\n     //skipped  #define SIGABRT  22  \n     //         #define SIGFPE  8  .... constants block  here\n\n     int raise(int __sig);\n\n     void (*signal(int __sig, void (*__func)(int) )) (int);\n</code></pre>\n\n<p>Signal Raise are understood for me but how to get to data of SIGCONTEXT or use 'catcher' ?</p>\n"},{"tags":["c++","winapi","encryption"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":12798172,"title":"How does the EncryptFile function work and why can I still the contents?","body":"<p>I am using the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa364021%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>EncryptFile</code> function</a> to encrypt files and directories but I get as result, the same file or folder with a green text name.</p>\n\n<p>Am I missing something? Where is the encrypted data?</p>\n\n<pre><code>BOOL res= EncryptFile( L\"D:\\\\test\");\nqDebug()&lt;&lt;\"res \"&lt;&lt;res&lt;&lt;\"  last error  \"&lt;&lt;GetLastError();\n</code></pre>\n"},{"tags":["windows","winapi","registry"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12797905,"title":"RegDeleteKey and RegDeleteKeyEx","body":"<p>I am writing an app which will remove some Registry keys recursively using API <strong>RegDeleteKey</strong> or <strong>RegDeleteKeyEx</strong>. What is bothering me is that <strong>RegDeleteKeyEx</strong> is not defined for less than <strong>XP x64 Professional</strong>, so now this limitation is limiting my app. Is there any way in which I can use both APIs with compatibility from XP x86 to Win7 x64 ? </p>\n"},{"tags":["windows","winapi","exception"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":385,"score":1,"question_id":5303524,"title":"What exactly is the scope of Access Violation '0xc0000005'?","body":"<p>I was wondering about exception 0xc0000005 and what it acctually encompasses.</p>\n\n<p>I.e. I take it this occurs if an application tries to access freed memory/memory belonging to another process.<br>\nBut what about, for example, an address mapped for hardware? Or an address outside the valid range? Do attempted accesses to these fault with the same code or do they have their own?\nDoes this include failed reads to valid addresses owned by the process?</p>\n\n<p>Essentially I want to know when an application fails with this exception, what may have gone wrong; is this a narrow fault that could only have come from the apps. code or am I looking at anything up and including hardware problems?</p>\n\n<p>(I know there must be an MSDN page on this but searching Google or MSDN brings up the expected 100 pages of troubleshooting random applications ;))</p>\n\n<p>Thanks!</p>\n"},{"tags":["c#","winapi","memory-management","marshalling"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":12778435,"title":"Why is it called Marshal.AllocHGlobal if it allocates on the local heap?","body":"<p>From the MSDN documentation of <a href=\"http://msdn.microsoft.com/en-us/library/s69bkh17.aspx\" rel=\"nofollow\"><code>Marshal.AllocHGlobal</code></a>:</p>\n\n<blockquote>\n  <p>AllocHGlobal is one of two memory allocation methods in the Marshal class. This method exposes the Win32 LocalAlloc function from Kernel32.dll.</p>\n</blockquote>\n\n<p><strike>Considering there's a GlobalAlloc API which allocates memory on the <em>global</em> heap, rather than the <em>local</em> heap,</strike> isn't this method's name rather misleading? </p>\n\n<p>Was there a reason for naming it <code>AllocHGlobal</code>, rather than <code>AllocHLocal</code>?</p>\n\n<p><strong>Update:</strong> Simon points out in the comments that there's no such thing as a global heap in Windows any more, and the <code>GlobalAlloc</code> and <code>LocalAlloc</code> APIs remained for legacy purposes only. These days, the <code>GlobalAlloc</code> API is nothing morethan a wrapper for <code>LocalAlloc</code>.</p>\n\n<p>This explains why the API doesn't call <code>GlobalAlloc</code> at all, but it doesn't explain why the API was named <code>AllocHGlobal</code> when it doesn't (can't) use a global heap, nor does it even call <code>GlobalAlloc</code>. The naming cannot possibly be for legacy reasons, because it wasn't introduced until .NET 2.0, way after 16-bit support was dropped. So, the question remains: why is <code>Marshal.AllocHGlobal</code> so misleadingly named?</p>\n"},{"tags":["delphi","winapi","delphi-2009"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":220,"score":3,"question_id":12782567,"title":"What windows messages are used by Delphi to notice changes in a combo box?","body":"<p>I have a Delphi application A, which I need to control from a .NET application B.</p>\n\n<p>Among other things, I need to automate this process:</p>\n\n<ol>\n<li>User selects item X from a combo box.</li>\n<li>Application A notices the change and reacts by displaying a certain panel.</li>\n</ol>\n\n<p>This works fine, if I do it manually.</p>\n\n<p>But when the application B selects a combo box value, no panel is displayed.</p>\n\n<p>This is the problem.</p>\n\n<p>Potential cause of it:</p>\n\n<ol>\n<li>When I select a combo box item, a certain windows message is fired. Some Delphi routine reacts to this message.</li>\n<li>When I select a combo box item programmatically, the only message I send is <code>CB_SETCURSEL</code> and the Delphi app seems to ignore it.</li>\n</ol>\n\n<p>Hence I assume that I can fix the problem, if I </p>\n\n<ol>\n<li>get to know what windows messages are used as a basis for notification about combo box value changes (e. g. <code>OnChange</code>) and</li>\n<li>send that windows message from C# application.</li>\n</ol>\n\n<p>Therefore my question: What are the windows messages, on whose occurrence <code>OnChange</code> (and other events that notify the Delphi application on changed combo box selection) are fired?</p>\n\n<p><strong>Update 1:</strong> Started to implement the solution proposed by David Heffernan</p>\n\n<pre><code>private const int CB_SETCURSEL = 0x14E;\nprivate const int WM_COMMAND = 0x0111;\nprivate const int CBN_SELCHANGE = 0x001;\nprivate const int CN_COMMAND = 0xBD11;\n\nprivate int MakeWParam(int l, int h)\n{\n    return (l &amp; 0xFFFF) | (h &lt;&lt; 16);\n}\n\n...\nIntPtr comboBoxHandle = new IntPtr(comboBox.Current.NativeWindowHandle);\nSendMessage(comboBoxHandle, CB_SETCURSEL, (Int32)myIndexInComboBox, 0);\nSendMessage(comboBoxHandle, CN_COMMAND, MakeWParam(0, CBN_SELCHANGE), 0);\n</code></pre>\n\n<p>At the moment, it doesn't work. </p>\n\n<p><strong>Update 2:</strong></p>\n\n<p>I noticed a very strange thing.</p>\n\n<ol>\n<li>If I invoke <code>CB_SETCURSEL</code> only, the desired item is selected in the combo box.</li>\n<li>If I invoke <code>CB_SETCURSEL</code> and then (after 5 seconds) <code>CN_COMMAND</code>, then nothing is selected in the combo box.</li>\n</ol>\n\n<p>This means - <code>CB_SECURSEL</code> selects the item and <code>CN_COMMAND</code> undoes it.</p>\n\n<p><strong>Update 3</strong>: Styles of the combo box according to Spy++:</p>\n\n<ol>\n<li>WS_CHILDWINDOW</li>\n<li>WS_VISIBLE</li>\n<li>WS_CLIPSIBLINGS</li>\n<li>00000243</li>\n</ol>\n\n<p>Extended styles:</p>\n\n<ol>\n<li>WS_EX_LEFT</li>\n<li>WS_EX_LTRREADING</li>\n<li>WS_EX_RIGHTSCROLLBAR</li>\n</ol>\n\n<p>Class styles:</p>\n\n<ol>\n<li>CS_VREDRAW</li>\n<li>CS_HREDRAW</li>\n<li>CS_DBLCLKS</li>\n</ol>\n\n<p><strong>Update 4</strong>: When I select the combo box item manually, I see following messages in the Spy++ output:</p>\n\n<pre><code>&lt;00177&gt; 0195085E S message:0xBD33 [Custom:WM_APP+15667] wParam:6801164A lParam:0195085E\n&lt;00178&gt; 0195085E R message:0xBD33 [Custom:WM_APP+15667] lResult:4610165A\n</code></pre>\n\n<p>Unfortunately, I couldn't find documentation for this message.</p>\n\n<p><strong>Update 5</strong>: I noticed that the reaction to combo box selection change does occur, but only after a relatively long time (30 seconds to 1 minute). When I do the same thing manually, the reaction occurs instantaneously.</p>\n\n<p>Potential cause of this behaviour: The thread of the .NET application makes the thread of the Delphi application wait for it. Note that the UI interaction code in the .NET app is executed in a separate thread (not the UI thread).</p>\n"},{"tags":["windows","winapi","registry","registrykey","registry-virtualization"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12796624,"title":"KEY_WOW64_32KEY and KEY_WOW64_64KEY","body":"<p>Apart from the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms724878%28v=vs.85%29.aspx\" rel=\"nofollow\">MSDN reference</a>, I want to know what these keys do? Does <strong>KEY_WOW64_32KEY</strong> means that a 32-bit app on x64 OS will access the <strong>WOW64 Registry Tree</strong> ? And does <strong>KEY_WOW64_64KEY</strong> means that a 32-bit app on x64 OS will access the normal Registry Tree and not the <strong>WOW64 Registry Tree</strong> ? What if I have to access some keys which I do not know whether lies in the WOW64 or normal Registry Tree ?</p>\n"},{"tags":["windows","winapi","ms-office","powerpoint","exe"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12782557,"title":"PowerPoint icons","body":"<p>I am working on a PowerPoint course for my students.\nI would like to replicate PowerPoint ribbon behavior in Flex.\nI spent huge amount of time trying to find ribbon icons as on the following picture:</p>\n\n<p><img src=\"http://i.stack.imgur.com/95W3X.jpg\" alt=\"enter image description here\"></p>\n\n<p>Does anybody know where does Microsoft keep its icons. How can I extract those icons?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c++","qt","winapi","driver","folders"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":12781013,"title":"How create an encrypted mounted Folder","body":"<p>I want to create a mounted Folder to be encrypted later, my point is that create a normal directory(<code>C:\\path\\to\\myfolder</code>) and mount it to a drive (<code>I:\\</code>) so any change will occurs in both path, my goal is if any file  added to <code>I:\\</code> will be automatically encrypted in <code>C:\\path\\to\\myfolder</code></p>\n\n<p>Questions:</p>\n\n<ul>\n<li>How to monitor the mounted folder and encrypt its children (files or directories) without touching files or directories under the drive.</li>\n<li>is there any way to create this mounted folder from the beginning so any file added will be automatically encrypted under the folder and decrypted under the drive, and if it is already exist when I mount it, files will be decrypted under the associated drive.</li>\n</ul>\n\n<p>any help will be appreciated.</p>\n"},{"tags":["winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12758000,"title":"Windows Event Log : Event template - Output type: win:Xml","body":"<p>I am making Windows event log for my application that support Vista and above. I have a manifest created for each event, but I get a issue with the output type of win:Xml.\nBelow is what I specify for the data in event template. </p>\n\n<pre><code>&lt;data name=\"StackTrace\" inType=\"win:UnicodeString\" outType=\"win:Xml\"&gt;\n&lt;/data&gt;\n</code></pre>\n\n<p>I would like to set the StackTrace to be displayed as XML format in the Event logs. StackTrace must be input with well-formed XML. However, I still see it displayed as string(xs:string) in the Event Log viewer. </p>\n\n<p>Do you know what I did wrong? How can I make it properly?</p>\n\n<p>Below if update for my code:</p>\n\n<pre><code>const int NUM_OF_DATADESC = 6;\nEVENT_DATA_DESCRIPTOR eventDataDesc[NUM_OF_DATADESC];\nevDesc.Level = uLevel;\nevDesc.Channel = nChannel;\nevDesc.Keyword |= uKeyword;\nfor (int i = 0; i &lt; NUM_OF_DATADESC; i++)\n{\nif (strings[i] != NULL)\n    EventDataDescCreate(&amp;eventDataDesc[i], strings[i],    ((ULONG)wcslen(strings[i])+1)*sizeof(WCHAR));\nelse\n    EventDataDescCreate(&amp;eventDataDesc[i], L\"\", sizeof(WCHAR));\n}\nBOOL s = WriteEvent(evDesc,NUM_OF_DATADESC,&amp;eventDataDesc[0]);\n\n\nBOOL WriteEvent(EVENT_DESCRIPTOR eventID,DWORD userDataCount,PEVENT_DATA_DESCRIPTOR     userData)\n{\nREGHANDLE hPub = NULL;\nULONG res = EventRegister(&amp;MYCOMPANE_MYAPP_MYCOMPONENT, NULL, NULL, &amp;hPub);    \nif (ERROR_SUCCESS != res){\n    return FALSE;\n}\n\nres = EventWrite(hPub, &amp;eventID, userDataCount, userData);\nif (ERROR_SUCCESS != res){\n return FALSE;\n}\nEventUnregister(hPub);\n\nreturn TRUE;\n}\n</code></pre>\n\n<p>The code is working fine, but only issue with output type = win:Xml.</p>\n"},{"tags":["c++","windows","winapi","device"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12756712,"title":"Windows Device Uninstall using C++","body":"<p>I need to programatically uninstall all Com port devices. The issue is that these Com Port Devices are not present and therefore completely hidden. Meaning, even if you want to uninstall them using device manager, first you have to add <code>devmgr_show_nonpresent_devices = 1</code> to your environment variables and then show hidden devices in device manager. Then, you can right click each device and uninstall. I don't want to uninstall the associated driver though. I am adding that variable under advanced system settings, creating and saving a new user variable. </p>\n\n<p>I try to do this with <a href=\"http://support.microsoft.com/kb/311272\" rel=\"nofollow\">devcon</a>. They can  be found with <code>devcon findall</code> but I cannot remove them because the <a href=\"http://www.osronline.com/ddkx/ddtools/devcon_59f7.htm\" rel=\"nofollow\">command to remove</a> them fails stating no device has been uninstalled. Also, there is not flag to have it look for non-present devices. If I do a standard <code>devcon find</code>, no devices are found (of interest).</p>\n\n<p>So, I am back to being forced to figure out how exactly to do this using my own code and here is where I get stuck. Here is what I have so far:</p>\n\n<pre><code>// Get all of the devices\nPCTSTR enumType = \"PORTS\";\nHDEVINFO devs = NULL;\ndevs = SetupDiGetClassDevs(NULL,enumType,0,DIGCF_PRESENT | DIGCF_ALLCLASSES);\n\n// Loop through the devices\nDWORD devCount = 0;\nSP_DEVINFO_DATA devInfo;\nint enumeratingDevices = 1;\ndevInfo.cbSize = sizeof(SP_DEVINFO_DATA);\nwhile(enumeratingDevices){\n    enumeratingDevices = SetupDiEnumDeviceInfo (devs,devCount,&amp;devInfo);\n    // Uninstall each device\n    cout &lt;&lt; SetupDiRemoveDevice(devs,&amp;devInfo);\n    cout &lt;&lt; SetupDiCallClassInstaller(DIF_REMOVE,&amp;devInfo,NULL);\n    devCount++;\n}\ncout &lt;&lt; devCount;\nSetupDiDestroyDeviceInfoList(devs);\nreturn 0;\n</code></pre>\n\n<p>Right now I am getting an output of <code>001</code>. So, basically, <code>SetupDiEnumDeviceInfo()</code> or<code>SetupDiRemoveDevice</code> do not run correctly. I know that the enumeration is working because if I put in <code>enumType = \"USB\";</code> I get ten for the devCount.</p>\n\n<p>Any help or advice would be great.</p>\n"},{"tags":["windows","winapi","filesystems","ntfs"],"answer_count":1,"favorite_count":2,"up_vote_count":13,"down_vote_count":4,"view_count":337,"score":9,"question_id":12751684,"title":"How do I determine the degree in which a file is fragmented?","body":"<p>I would like to provide a way to recognize when a large file is fragmented to a certain extent, and alert the user when they should perform a defragmentation. In addition, I'd like to show them a visual display demonstrating how the file is actually broken into pieces across the disk.</p>\n\n<p>I don't need to know how to calculate how fragmented it is, or how to make the visual display. What I need to know is two things: 1) how to identify the specific clusters on any disk which contain pieces of any particular given file, and 2) how to identify the total number of clusters on that disk. I would essentially need a list of all the clusters which contain pieces of this file, and where on the disk each of those clusters is located.</p>\n\n<p>Most defragmentation utilities have a visual display showing how the files are spread across the disk. My display will show how one particular file is split up into different areas of a disk. I just need to know how I can retrieve the necessary data to tell me where the file's clusters/sectors are located on the disk, so I can further determine how fragmented it is.</p>\n"},{"tags":["python","c","windows","delphi","winapi"],"answer_count":1,"favorite_count":10,"up_vote_count":15,"down_vote_count":0,"view_count":338,"score":15,"question_id":12697292,"title":"Detecting reflective DLL injection","body":"<p>In the past few years, malware (and some pen-test tools like Metasploit's meterpreter payload) have begun to use <a href=\"http://www.harmonysecurity.com/files/HS-P005_ReflectiveDllInjection.pdf\">reflective DLL injection (PDF)</a> to load a DLL into the memory of a process. The benefit is that the file is never written to disk and is difficult to detect. Many examples I've seen are based on <a href=\"http://www.joachim-bauch.de/2012/04/09/memorymodule-0-0-3-released/\">Joachim Bauch's work</a>.</p>\n\n<p>However, at DEF CON 20 (this year, 2012) Andrew King demonstrated that he was able to detect DLL's injected using reflective DLL injection. His presentation was called \"<a href=\"https://www.defcon.org/html/defcon-20/dc-20-speakers.html#King\">Detecting Reflective Injection</a>\". Unfortunately, he has not released the source code (which he certainly is under no obligation to do).</p>\n\n<p>In addition, a tool called \"<a href=\"http://www.mertsarica.com/antimeter-tool/\">Antimeter</a>\" can detect the meterpreter engine when loaded using reflective dll injection. Again, closed source.</p>\n\n<p>I understand that Andrew King's tool and Antimeter are both written in Python and use pydbg/pydasm in order to enumerate the memory of running executables.</p>\n\n<p>Does anyone have some general source code (in Python, C, Delphi, or otherwise) that they are willing to share that demonstrates how to detect reflective DLL injection? There are memory forensic tools that can analyze a memory dump and find this, but I'm looking to execute an application on a running system (like antimeter does) and find processes with reflectively injected DLL's.</p>\n\n<p>If you are interested in understanding how reflective DLL injection works, there is some <a href=\"http://code.google.com/p/memorymodule/\">open-source code written in Delphi</a> that shows how to do this.</p>\n\n<p><strong>UPDATE</strong>:\nI tested and I can reflectively inject DLL's without admin rights (and as a regular user), but of course as a USER I can only inject into processes running at the same integrity level (and in my session)...but that still covers applications like the Office suite, Internet Explorer, etc.</p>\n"},{"tags":["c++","c","winapi"],"answer_count":3,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":2138,"score":1,"question_id":4529577,"title":"Disable CONTROL + ALT + DELETE and Windows(win) Key in Windows 7 using Win32 application","body":"<p>I am writing an application which runs like a kiosk and should allow user to go out of the application. In windows 7 , when he presses the Win key or CTRL + ALT+ DELETE , it comes out of program. I need to disable the Ctrl+ ALT + delete combination key and Win key in Windows 7 OS programmatically.  Kindly Help me.... Very URGENT .... :(</p>\n\n<p>thank you</p>\n"},{"tags":["windows","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12791176,"title":"How the windows implements the event system?","body":"<p>I am wondering how Windows implements event system. Where is event get stored? How is event get consumer? Does it use some mechanism like queue?</p>\n"},{"tags":["windows","delphi","winapi","special-folders","appdata"],"answer_count":3,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":234,"score":6,"question_id":12771473,"title":"Finding a Windows user's \"true\" application data folder?","body":"<p>I have a Delphi 6 application that, like most Windows applications, reads/writes data to the user's \"local application data\" folder.  I use the code below to determine that folder.  Up until now, that code worked for most of my users.  I have encountered a user whose local application data is not in the expected folder:</p>\n\n<pre><code>C:\\Users\\Bob\\AppData\\Roaming\\\n</code></pre>\n\n<p>Usually the local app data folder resolves to:</p>\n\n<pre><code>C:\\Documents and Settings\\Bob\\Application Data\\\n</code></pre>\n\n<p>What is odd about this user's particular situation is that several registry keys normally found in HKEY_LOCAL_MACHINE are actually located in HKEY_CURRENT_USER.  They are running on Windows 7.</p>\n\n<p>For lack of a better word, is there a way to get the \"true\" application data for a user so I can navigate this situation better?  If it's a matter of intelligently choosing between  the CSIDL_APPDATA, CSIDL_COMMON_APPDATA and CSIDL_LOCAL_APPDATA special folders, what is the logic for doing so?  As you can tell I'm looking for an all-purpose function that can root out the correct application data folder regardless of the version of Windows the user is running or their specific PC configuration.</p>\n\n<p>I found this Stack Overflow post that seems to have the answer but it is using function from the .NET library and I am using Delphi 6.  If this solution answers my question, can someone tell me a quick way to replicate it in Delphi:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/915210/how-can-i-get-the-path-of-the-current-users-application-data-folder\">How can i get the path of the current user&#39;s &quot;Application Data&quot; folder?</a></p>\n\n<pre><code>// Function to get the app data special folder.\nfunction GetAppdataFolder: string;\nbegin\n   Result := GetSpecialFolderLocation(CSIDL_APPDATA);\nend;\n</code></pre>\n"},{"tags":["c#","winapi","pinvoke"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12789612,"title":"P/Invoke in C#, how to find out CallingConvention?","body":"<p>I updated my project from VS2005 (targeting .net 2) to VS2010 (targeting .net4). It seems the <a href=\"http://stackoverflow.com/a/6768223/166286\">pInvokeStackImbalance MDA</a> is enabled by default, then I get a bunch of <code>\"unbalanced the stack\"</code> exceptions. Take this one for example:  </p>\n\n<pre><code>[DllImportAttribute(\"gdi32.dll\")]\nprivate static extern IntPtr CreateSolidBrush(BrushStyles enBrushStyle, int crColor);  \n</code></pre>\n\n<p>It was working in .net 2 but now it throws exception. I changed it to this and it works:  </p>\n\n<pre><code>[DllImportAttribute(\"gdi32.dll\", CallingConvention = CallingConvention.ThisCall)]\nprivate static extern IntPtr CreateSolidBrush(BrushStyles enBrushStyle, int crColor);\n</code></pre>\n\n<p>To my surprise, <a href=\"http://www.pinvoke.net/default.aspx/gdi32/CreateSolidBrush.html\" rel=\"nofollow\">pinvoke.net</a> lists it as  </p>\n\n<pre><code>[DllImport(\"gdi32.dll\")]\nstatic extern IntPtr CreateSolidBrush(uint crColor);\n</code></pre>\n\n<p>Why my old is not working? It seems the pinvoke.net is wrong but how do I find out which calling conversion is it given a win32 function?  </p>\n\n<p><strong>EDIT</strong><br>\nMy project is using the code from <a href=\"http://www.codeproject.com/Articles/27389/C-Rubber-Rectangle\" rel=\"nofollow\">C# Rubber Rectangle</a> to do the XOR drawing. Apparently the code needs a fix to work in .Net 4.</p>\n"},{"tags":["delphi","winapi","struct","delphi-xe2","code-conversion"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":195,"score":2,"question_id":12763551,"title":"How to translate RETRIEVAL_POINTERS_BUFFER structure to Delphi?","body":"<p>I'm working with Windows API and have to recreate <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa365521%28v=vs.85%29.aspx\" rel=\"nofollow\">a structure</a> inside a Delphi <code>record</code>. I think I have it down, but this one was a little confusing and I need to make sure I did this right.</p>\n\n<p>Here's the original C++ structure:</p>\n\n<pre><code>typedef struct RETRIEVAL_POINTERS_BUFFER {\n  DWORD         ExtentCount;\n  LARGE_INTEGER StartingVcn;\n  struct {\n    LARGE_INTEGER NextVcn;\n    LARGE_INTEGER Lcn;\n  } Extents[1];\n} RETRIEVAL_POINTERS_BUFFER, *PRETRIEVAL_POINTERS_BUFFER;\n</code></pre>\n\n<p>Notice that there's an array struct within this struct. This is where I got lost. If I'm not mistaken, the Delphi version should look like this:</p>\n\n<pre><code>  TExtent = record\n    NextVcn: Integer;\n    Lcn: Integer;\n  end;\n\n  TExtents = array of TExtent;\n\n  PRETRIEVAL_POINTERS_BUFFER = ^TRETRIEVAL_POINTERS_BUFFER;\n  TRETRIEVAL_POINTERS_BUFFER = record\n    ExtentCount: DWORD;\n    StartingVcn: Integer;\n    Extents: TExtents;\n  end;\n</code></pre>\n\n<p>When I use this structure in the Windows API, it does appear to work. But, because of this structure array inside of the structure, I'm a little hesitant that I did this correctly. Does this look right?</p>\n"},{"tags":["c#","winapi","window","handle"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12769538,"title":"How to know which win handle will get the focus when clicked?","body":"<p>So it's definetely a weird question. When a window is on the background, it has no focus. But when you click on it, it get it and the \"keyboard cursor\" is placed in a specific place. For example, if you are using Skype, the keyboard cursor will be inside the textbox of the active conversation. In Skype, the textbox has its specific handle.</p>\n\n<p>So the question is: How to know which window handle will be focused when you click on the main (parent) window title?</p>\n\n<p>Regards</p>\n\n<p>EDIT1:</p>\n\n<p>I found a workaround for my case: I want to register inside a variable, each handle code of the last window of each main window. For example, I have 3 opened windows, the one with arrow is focused:</p>\n\n<p>1.) </p>\n\n<p>->Window 1\n  ->Child window1\n  -Child window2\n-Window 2\n-Window 3</p>\n\n<p>2.) I select another window, so the handle number of the child window that lost focus is saved inside a variable</p>\n\n<p>-Window 1\n  -Child window1\n  -Child window2\n->Window 2\n-Window 3</p>\n\n<p>=> HANDLE OF Child window1 is saved inside a variable</p>\n\n<p>Using this, I could know the last used window's handle of each application! Is there any way to generate an event each time the user change the focused window handle? Or do I need to set a timer, that is not really clever to my mind?</p>\n\n<p>Regards</p>\n"},{"tags":["c#","winapi","wmi"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":265,"score":1,"question_id":9161617,"title":"check if a process runs on a remote machine for a certain user","body":"<p>I have to create an executable which checks if a certain process is running for a certain user (a service account) on a remote machine, the input parameters are 3 strings, machine name, user name and process name.</p>\n\n<p>I have the idea to do this using either <code>System.Diagnostics</code> or <code>WMI</code>, just wanted to double check if anybody has another idea like powershell or even a window functionality which could make the task even easier.</p>\n\n<p>since we want to make sure that process is always running on a dedicated server we will configure a scheduled task to execute a small console application which does this check. Not sure if coding it in C# is the best option or am I ignoring a builtin feature of windows server? Thanks!</p>\n"},{"tags":["windows","winapi","visual-c++","wmi-query"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":96,"score":2,"question_id":12780659,"title":"Windows API equivalent to \"WMIC QFE Get\"","body":"<p>I am a newbie in C++ and currently working to get Windows Hotfix/Patch information in C++ DLL.</p>\n\n<p>I have evaluated the following ways:</p>\n\n<ol>\n<li>By executing a sub process in C++ code and running <code>wmic qfe get</code> and read all the data.</li>\n<li>By using the C++ APIs to initialize COM, Connect to Wbem and execute <code>select * from win32_quickfixengineering</code> query.</li>\n</ol>\n\n<p>Apart from above two methods,</p>\n\n<p>Is there any direct Windows API that does all the job for me and gives the list of KB Info currently installed on the machine?</p>\n"},{"tags":["delphi","winapi","windows-7","delphi-xe2","windows-explorer"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":1,"view_count":224,"score":4,"question_id":10680899,"title":"Is there a way to change text background color of the items in Windows Explorer in Windows 7?","body":"<p><img src=\"http://i.stack.imgur.com/lvAl9.jpg\" alt=\"http://screenshots.en.sftcdn.net/en/scrn/39000/39972/xentient-labels-1.jpg\"></p>\n\n<p>Is is possible to change background color of the items in Windows Explorer like the <a href=\"http://xentient-labels.en.softonic.com/\" rel=\"nofollow\"><code>Xentient Labels</code></a> application does ? Is it possible to do so from Delphi XE2 in Windows 7 ?</p>\n"},{"tags":["delphi","winapi","delphi-7"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":93,"score":1,"question_id":12182596,"title":"Is there a way to modify value of FD_SETSIZE (WinSock) in Delphi?","body":"<p>Is there any way to increment value of <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms739169%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>FD_SETSIZE</code></a> (WinSock) in Delphi 7 application ?</p>\n\n<p>In C++ I can define it before using <code>include</code>, but for Delphi it is impossible.</p>\n"},{"tags":["javascript","c","winapi","frameworks"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":5,"view_count":44,"score":-3,"question_id":12786804,"title":"How complicated is it to port an existing framework to C/C++ (Win API)?","body":"<p>Good day,\nis the meaning to rewrite the <strong>existing</strong> framework (JS) on <strong>own</strong> framework using <strong>C/C++ (Win API)</strong>? Existing framework has about <strong>one hundred thousand lines</strong>. How long would it take?</p>\n\n<p>Is something like this already created (for example jquery)? I do not want to unnecessarily something already done.\nThank you so much for advice.</p>\n"},{"tags":["c++","winapi","skinning","theming","window-chrome"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12786077,"title":"C++ Win32 Design my Window","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6717620/c-win32-a-professional-looking-application-is-it-really-possible\">C++/WIN32 A professional looking application - is it really possible?</a>  </p>\n</blockquote>\n\n\n\n<p>I'm not talking about opening a resource file, (.rc) and make my buttons, and etc ..\nI'm talking about the look of the window itself &mdash; like the installer for the Visual Studio Ultimate 2012:</p>\n\n<p><img src=\"http://i.stack.imgur.com/Ydpry.png\" alt=\"enter image description here\"></p>\n\n<p>The buttons, and all looks different.  Same with the Photoshop, AE, Maya Autodesk.</p>\n\n<p>How they did it?  Its easy or hard ?  We can do it with c++?</p>\n"},{"tags":["windows","delphi","winapi","handle","window-handles"],"answer_count":1,"favorite_count":0,"up_vote_count":6,"down_vote_count":1,"view_count":389,"score":5,"question_id":9018903,"title":"How to get count of opened handles that belongs to a certain process?","body":"<p>You can use the program <a href=\"http://technet.microsoft.com/en-us/sysinternals/bb896653\" rel=\"nofollow\">Process Explorer</a> to see how many handles running applications have.  Is there a way with Delphi code to get this number?  I am interested in tracking the number for the application itself; not to find the number of handles used by other applications as Process Explorer is doing. </p>\n\n<p>My intention is for the application to track/detect possible resource leaks.</p>\n"},{"tags":[".net","winapi","windows-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":54,"score":-1,"question_id":12725003,"title":"What process is locking file","body":"<p>There are millions of questions how to know what process is locking some file programmatically. However my boss told me today that since Windows 2008 R2 there is some new possibility. As far as now I can:</p>\n\n<p>a. use Handle.exe in a subprocess and capture output</p>\n\n<p>b. use some nasty long code that examines all the processes and enumerates handles opened by them</p>\n\n<p>That is ok, but does anyone know about those new possibilities (I believe new API calls in Windows 2008R2)?</p>\n"},{"tags":["c#",".net","winapi","hook","keyboard-hook"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":83,"score":0,"question_id":12781059,"title":"How to know if the keyboard is active on a text input","body":"<p>I have an application that acts like an on screen keyboard, I need it to know if there is a keyboard cursor (caret) active any where, so the keyboard will set to active.</p>\n\n<p>I have searched for keyboard hooks and winapi, but I couldn't find the proper method to use.</p>\n\n<p>To simplify my problem, I need my application to be active if the user can press on the real keyboard and print text on the computer.</p>\n"},{"tags":["c++","winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12780755,"title":"Reverse of GetDateFormat() in Windows","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/234171/parse-a-date-from-a-string-in-win32\">Parse a Date from a String in Win32</a>  </p>\n</blockquote>\n\n\n\n<p>I'm looking for a Win32 API that would do the reverse of <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd318086%28v=vs.85%29.aspx\" rel=\"nofollow\">GetDateFormat()</a>. I need to convert a time string to UTC time. strptime is out of the question as the time format will be Windows specific. Thanks!!</p>\n"},{"tags":["winapi","visual-c++","mfc","gdi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12778542,"title":"Custom draw ListView but need to show the 3 dots at the end if longer then column width","body":"<p>In NM_CUSTOMDRAW, I draw something and return CDRF_SKIPDEFAULT. But the 3 dots at the end do not show if the text is longer then column width.</p>\n\n<p>How to show the 3 dots but allow custom draw?</p>\n"},{"tags":["c++","security","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12774738,"title":"How to determine the integrity level of a process？","body":"<p>all\nI recently need to get the integrity level of a process, and I found help from MSDN. The sample code looks like this:</p>\n\n<pre><code>if (GetTokenInformation(hToken, TokenIntegrityLevel, \n     pTIL, dwLengthNeeded, &amp;dwLengthNeeded))\n {\n  dwIntegrityLevel = *GetSidSubAuthority(pTIL-&gt;Label.Sid, \n    (DWORD)(UCHAR)(*GetSidSubAuthorityCount(pTIL-&gt;Label.Sid)-1));\n\n  if (dwIntegrityLevel == SECURITY_MANDATORY_LOW_RID)\n  {\n   // Low Integrity\n   wprintf(L\"Low Process\");\n  }\n  else if (dwIntegrityLevel &gt;= SECURITY_MANDATORY_MEDIUM_RID &amp;&amp; \n       dwIntegrityLevel &lt; SECURITY_MANDATORY_HIGH_RID)\n  {\n   // Medium Integrity\n   wprintf(L\"Medium Process\");\n  }\n  else if (dwIntegrityLevel &gt;= SECURITY_MANDATORY_HIGH_RID)\n  {\n   // High Integrity\n   wprintf(L\"High Integrity Process\");\n  }\n  else if (dwIntegrityLevel &gt;= SECURITY_MANDATORY_SYSTEM_RID)\n  {\n   // System Integrity\n   wprintf(L\"System Integrity Process\");\n  }\n }\n</code></pre>\n\n<p>As you all know, </p>\n\n<pre><code>SECURITY_MANDATORY_LOW_RID == 0x00001000L\nSECURITY_MANDATORY_MEDIUM_RID == 0x00002000L\nSECURITY_MANDATORY_HIGH_RID == 0x00003000L\nSECURITY_MANDATORY_SYSTEM_RID == 0x00004000L.\n</code></pre>\n\n<p><strong>Here is my question:</strong>\nIf this sample code is correct, then what integrity level does process A have if it has the dwIntegrityLevel of 0x00004100L? SECURITY_MANDATORY_HIGH_RID and SECURITY_MANDATORY_SYSTEM_RID? Does it mean that a process have SECURITY_MANDATORY_SYSTEM_RID level also have a SECURITY_MANDATORY_HIGH_RID?</p>\n\n<p>If the sample code is wrong, then what is the right way to determine the integrity level of a process?</p>\n"},{"tags":["c++","winapi","vb6"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":12747430,"title":"how to use mouse_event to move mouse cursor in windows login screen?","body":"<p>there is a same question in:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/1964149/setcursorpos-and-getcursorpos-not-working-at-login-screen\">SetCursorPos and GetCursorPos not working at login screen?</a></p>\n\n<p>the answer as resovled was</p>\n\n<blockquote>\n  <p>Alternative solution: It is possible (but very tricky) to use\n  mouse_event (which does work at login screen) instead of SetCursorPos.\n  I don't have time to post code now, but if asked I may update this\n  answer...</p>\n</blockquote>\n\n<p>so, does anybody know how to use <code>mouse_event</code> to move mouse cursor in windows login screen? thanks!</p>\n"},{"tags":["winapi","visual-c++","messagebox"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12780198,"title":"How do I get MessageBox icon using WinAPI","body":"<p>I have a   WH_CALLWNDPROC   hook code which handles   WM_INITDIALOG   message to get information about message boxes. I could get \"Message\", \"Title\", \"Buttons\" but I couldnt get \"icon\" information. I'm trying to use a function like below:</p>\n\n<pre><code>long getIcon(HWND hwnd) { // handle of messagebox dialog\n    HWND hlbl = GetDlgItem(hwnd,20);\n\n    wcout &lt;&lt; \"LABEL HWND: \" &lt;&lt; hlbl &lt;&lt; endl;\n\n    if (hlbl != NULL) { \n         LRESULT r =  SendMessage(hlbl,WM_GETICON,0,0);\n         return (long)r; \n    }\n\n    return 0; \n}\n</code></pre>\n\n<p>function always returns 0. I have checked by MS Spy++ and I saw that icon handle is 0. \nWhat is the correct way to get icon?</p>\n"},{"tags":["c","winapi","c99","winsock2","getaddrinfo"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":12765743,"title":"getaddrinfo() on Win32","body":"<p>I have a C program that uses <code>getaddrinfo()</code>. It works as expected on Linux and Mac OS X.</p>\n\n<p>I'm in the middle of porting it to Windows.</p>\n\n<p>When I compile it (with MinGW gcc) I get the following warnings:</p>\n\n<pre><code>ext/socket/socket.c: In function 'sl_tcp_socket_init':\next/socket/socket.c:98:5: warning implicit declaration of function 'getaddrinfo' [-Wimplicit-function-declaration]\next/socket/socket.c:104:9: warning implicit declaration of function 'freeaddrinfo' [-Wimplicit-function-declaration]\n</code></pre>\n\n<p>Then the entire thing fails to link with undefined references to <code>getaddrinfo()</code> and <code>freeaddrinfo()</code>.</p>\n\n<p>Now, according to <a href=\"http://msdn.microsoft.com/en-us/library/ms738520%28v=vs.85%29.aspx\" rel=\"nofollow\">this MSDN page</a>, <code>getaddrinfo()</code> is supported on Windows and is located in the header file <code>Ws2tcpip.h</code> and the library file <code>Ws2_32.lib</code>.</p>\n\n<p>I'm including <code>Ws2tcpip.h</code> and linking with <code>-lWs2_32</code>, so I'm not sure why this isn't working.</p>\n"},{"tags":["c#","winapi","pinvoke"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12740962,"title":"What DLL is ComboBox_SetCurSel located in?","body":"<p>I want to use WinApi function <code>ComboBox_SetCurSel</code> in my C# application.</p>\n\n<p>For this purpose I insert following statement:</p>\n\n<pre><code>[DllImport(\"user32.dll\", SetLastError = true)]\npublic static extern IntPtr ComboBox_SetCurSel(IntPtr hWnd, int index);\n</code></pre>\n\n<p>When I run the program, I get the error</p>\n\n<pre><code>EntryPointNotFoundException ComboBox_SetCurSel user32.dll\n  Message=Can't find entry point \"ComboBox_SetCurSel\" in DLL \"user32.dll\".\n</code></pre>\n\n<p>I suppose that this error is caused by <code>ComboBox_SetCurSel</code> being located not in <code>user32.dll</code>, but in some other DLL.</p>\n\n<p>If this is correct, to fix this error I need to change <code>DllImport</code> declaration.</p>\n\n<p>Question: In what DLL is <code>ComboBox_SetCurSel</code> located?</p>\n"},{"tags":["winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12775866,"title":"How to disable particular software in C in windows?","body":"<p>I am new in win32, I am developing application which is used in exam laboratory.</p>\n\n<p>Now my requirement is that all application other than turbo c are disabled when exam starts(ex- Internet explore,media player,pendrive access). \nAnd after exam all application are successfully enabled. </p>\n\n<p>How I achieve this?</p>\n\n<p>Please help me.</p>\n\n<p>Thank you in advance.</p>\n"},{"tags":["multithreading","winapi","deadlock","critical-section"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":82,"score":2,"question_id":12774425,"title":"What happen if 2 threads do EnterCriticalSection and thread 1 do DeleteCriticalSection","body":"<p>I am hunting a possible deadlock in my program and im suspecting the following.\nWhat happen if 2 threads at the same time calls EnterCriticalSection and thread #1 calls DeleteCriticalSection right after entering, what happen to thread #2 which is still in EnterCriticalSection call?</p>\n\n<p>Thanks.</p>\n"},{"tags":["winapi","include"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":12763233,"title":"How do i split my win32 program into multiple files?","body":"<p>My win32 program has become a little to large to keep in one main file. My plan is to split the code into three files, a main file for the procs, a file to handle files and a file to handle fonts. I'm having trouble splitting the file though, i dont know how i should include them in order for them to act as one main file. For example some of my main:</p>\n\n<pre><code>    #include &lt;iostream&gt;\n    #include &lt;windows.h&gt;\n    #include \"resource.h\"\n    #include &lt;commctrl.h&gt;\n    #include \"hideconsole.h\"\n\n    #define IDC_MAIN_MDI    101\n    #define IDC_MAIN_TOOL   102\n    #define IDC_MAIN_STATUS 103\n\n    #define IDC_CHILD_EDIT 101\n\n    #define ID_MDI_FIRSTCHILD 50000\n\n    const char szClassName[] = \"MainClass\";                         //window class\n    const char szChildClassName[] = \"ChildClass\";                   //child class\n\n    HWND g_hMDIClient = NULL;\n    HWND g_hMainWindow = NULL;\n\n//functions and procs for windows\n</code></pre>\n\n<p>how should i separate these files? i tried before but i couldnt wrap my head around getting all of the files to have access to mains variables. Could anyone give me some pointers? thanks!</p>\n"},{"tags":["c++","winapi","rounded-corners"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12738802,"title":"Layered window: Why's the edge rounded automatically?","body":"<p>I am trying to draw a <code>hbitmap</code> with a <code>layeredwindow</code> directly onto the screen. this also works now how it should, yet the left upper corner of the image is <em>always</em> rounded.</p>\n\n<p>I'm creating the window with:</p>\n\n<pre><code>    HWND hWnd = CreateWindowEx(WS_EX_LAYERED | WS_EX_TRANSPARENT\n        , szWindowClass, 0, \n        WS_VISIBLE\n        , 150,250, width, height, 0, NULL, hInstance, NULL);\n</code></pre>\n\n<p>Could anyone help me please to solve this problem?</p>\n"},{"tags":["winapi","video","windows-ce","directshow","windows-embedded-compact"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12771314,"title":"Using DirectShow for multiple simultaneous video playback on windows Embedded Compact 7","body":"<p>Hello i am struggling for past few days, with simple application which could create multiple previews for simultaneous video playback of different video streams ( but same formats in example mpeg4 ). On my platform there are no Xaml runtime so i am using simple WinApi32 functions with DirectShow.</p>\n\n<p>But no matter what i do i can not achieve more than one video stream playing at once. I am in doubt right now if it is even possible with DirectShow on windows Embedded Compact. But maybe i am wrong since i didn't descend in details of creating filters graphs. </p>\n\n<p>My approach was to simply create few <strong>IBuilderGraph</strong>, <strong>IMediaControl</strong>, and <strong>IMediaEventEx</strong> interfaces. Then i use <strong>RenderFile</strong> method for each graph builder to create filter graph, then create <strong>IVideoWindow</strong> for each sets notification window and use <strong>IMediaControl::Run</strong> to start playing file.</p>\n\n<p>This works on desktop windows 7 platform, but simply doesn't work on CE. Only one preview is actually playing video stream, and the other ones are black and doesn't show anything. </p>\n\n<p>So my question is \"<strong>Is this possible to have multiply video playbacks on windows embedded compact 7?</strong>\" and if it is, please explain what tool could i use.</p>\n"},{"tags":["windows","winapi","windows-messages","setwindowshookex"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12770963,"title":"WH_MOUSE_LL hook, avoid getting useless WM_MOUSEMOVE events","body":"<p>Is there a way, even a dirty hack, to avoid receiving <code>WM_MOUSEMOVE</code> events in a <code>WH_MOUSE_LL</code> hook? I'm interested only in wheel rotations and buttons. The performance cost of receiving <code>WM_MOUSEMOVE</code> is unnacceptable in my scenario.</p>\n\n<p>I cannot use <code>WH_MOUSE</code>.</p>\n"},{"tags":["windows","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":502,"score":0,"question_id":5303429,"title":"MOUSEEVENTF_MOVE and SetCursorPos not works in console app?","body":"<p>MOUSEEVENTF_RIGHTDOWN and MOUSEEVENTF_RIGHTUP works as expected, but MOUSEEVENTF_MOVE and SetCursorPos not works(nothing happened).</p>\n\n<p>And also, seems the X and Y have no effect on MOUSEEVENTF_RIGHTDOWN and MOUSEEVENTF_RIGHTUP.</p>\n\n<p>compile opt: gcc -o test.exe test.c</p>\n\n<p>os: windows7</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#define X (DWORD)50\n#define Y (DWORD)50\n\nint main() {    \n    mouse_event(MOUSEEVENTF_RIGHTDOWN, X, Y, 0, 0);\n    mouse_event(MOUSEEVENTF_RIGHTUP, X, Y, 0, 0);\n    mouse_event(MOUSEEVENTF_MOVE, X,Y,0,0);\n    SetCursorPos(X,Y);\n    return 0;\n}\n</code></pre>\n"},{"tags":["c++","c","winapi","api","resolution"],"answer_count":4,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":5060,"score":6,"question_id":4631292,"title":"How detect current screen resolution?","body":"<p>How do I from Winapi (in C or C++) detect the current screen resolution?</p>\n\n<p>Some background:</p>\n\n<p>I want to start a new OpenGL fullscreen window, but want it open with the same horizontal and vertical size which the desktop already is set to. (Now when everyone uses LCD screens, I figured this is the best way to get the native resolution of the screen.)</p>\n\n<p>I don't desperately need to also know the desktop color depth, although that would be a nice bonus.</p>\n"},{"tags":["winapi","resolution"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12766944,"title":"Resolution 1024x611, why is it not 1024x600? (Or why does SM_CYFULLSCREEN report a slightly too large height=)","body":"<p>I am posting here on the off-chance that someone knows why my screen size is reported as 611 instead of 600?</p>\n\n<pre><code>GetSystemMetrics(SM_CYFULLSCREEN)\n</code></pre>\n\n<p>returns 611. My netbook is 1024x600, so I expected 600, not 611.</p>\n\n<p>Googling for 1024x611 turns up a surprising number of results, also.</p>\n"},{"tags":["python","winapi","ctypes","readprocessmemory"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":124,"score":2,"question_id":12712585,"title":"ReadProcessMemory with ctypes","body":"<p>im working on a little solitär trainer. I don't know why the function ReadProcessMemory doesn't work. Normally it returns a False or True but in that case nothing. The GetlastError() gives me the Errorcode 6.</p>\n\n<pre><code>#-*- coding: cp1252 -*-\n\nimport ctypes, win32ui, win32process ,win32api\n\nPROCESS_ALL_ACCESS = 0x1F0FFF\nHWND = win32ui.FindWindow(None,\"Solitär\").GetSafeHwnd()\nprint(HWND)\nPID = win32process.GetWindowThreadProcessId(HWND)[1]\nprint(PID)\nPROCESS = win32api.OpenProcess(PROCESS_ALL_ACCESS,0,PID).handle\n\nrPM = ctypes.windll.kernel32.ReadProcessMemory\nwPM = ctypes.windll.kernel32.WriteProcessMemory\n\nADDRESS1 = 0x00E97074\nADDRESS2 = ctypes.create_string_buffer(64)\npi = ctypes.pointer(ADDRESS2)\nrPM(PROCESS,ADDRESS1,ADDRESS2,64,0)\nprint(ADDRESS2)\nx=ctypes.windll.kernel32.GetLastError()\nprint(x)\n</code></pre>\n"},{"tags":["winapi","visual-c++","gdi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12764312,"title":"GDI is not rendering, what am I doing wrong?","body":"<p>I am trying to make a basic framework for graphics with GDI to make some minigames with.\nBut GDI is not rendering anything at all, I just get a black client area, and I have no idea what I'm doing wrong.</p>\n\n<p>The following code is inside a game loop that is running constantly:</p>\n\n<pre><code>//render double buffered with GDI\n            HDC frontBuffer = GetDC(m_hMainWnd);\n\n            HDC backBuffer;\n            HBITMAP bitmap;\n            HBITMAP oldBitmap;\n\n            backBuffer = CreateCompatibleDC(frontBuffer);\n            bitmap = CreateCompatibleBitmap(frontBuffer, m_ClientWidth, m_ClientHeight);\n            oldBitmap = (HBITMAP)SelectObject(backBuffer, bitmap);\n\n            GDI-&gt;StartDrawing(backBuffer, m_ClientWidth, m_ClientHeight); //this basically selects pens and brushes etc\n            Render(dRenderTime); //here I render some stuff\n            GDI-&gt;StopDrawing(backBuffer); //selects old pens and brushes back\n\n         //blit backbuffer to frontbuffer\n            BitBlt(frontBuffer, 0, 0, m_ClientWidth, m_ClientHeight, backBuffer, 0, 0, SRCCOPY);\n\n            SelectObject(backBuffer, oldBitmap);\n            DeleteObject(bitmap);\n            DeleteDC(backBuffer);\n\n            ReleaseDC(m_hMainWnd, frontBuffer);\n        }\n</code></pre>\n\n<p>What am I doing wrong here? \nSorry if it's some stupid mistake, I am not good at all with windows programming.</p>\n\n<p>EDIT: additional code, as requested:</p>\n\n<pre><code>gdi.h\n\n    #pragma once\n\n#include &lt;Windows.h&gt;\n#include \"Macros.h\"\n#include \"Transform.h\"\n#include \"Text.h\"\n\n#define GDI gdi::getInstance()\n\nclass gdi\n{\nprivate:\n  HPEN m_OldPen;\n  HPEN m_Pen;\n  HBRUSH m_OldBrush;\n  HBRUSH m_Brush;\n  HDC m_hdc;\n\n  int m_DcWidth;\n  int m_DcHeight;\n\n  COLORREF m_Color;\n  int m_LineWidth;\n\n  DBlib::float3x3 m_Transform;\n\n  gdi();\n\n  void Transform(int&amp; x_out, int&amp; y_out, const DBlib::float2&amp; p) const;\n  void Transform_NDC_To_WC(int&amp; x_out, int&amp; y_out, const DBlib::float2&amp; p) const;\n  void Transfrom_WC_To_NDC(DBlib::float2&amp; p_out, int x, int y) const;\n\npublic:\n  ~gdi();\n\n  static gdi* getInstance();\n\n  void StartDrawing(HDC hdc, int dcwidth, int dcheight);\n  void StopDrawing(HDC hdc);\n\n  void SetColor(const DBlib::float3&amp; col);\n  void SetLineWidth(int width);\n\n  void SetTransform(const DBlib::float3x3&amp; transform);\n\n  void DrawText(const DBlib::float2&amp; p1, const std::tstring&amp; s);\n  void DrawLine(const DBlib::float2&amp; p1, const DBlib::float2&amp; p2);\n  void DrawPolygon(const DBlib::float2* p, int size);\n  void FillPolygon(const DBlib::float2* p, int size);\n};\n</code></pre>\n\n<p>GDI.cpp</p>\n\n<pre><code>#include \"gdi.h\"\n\ngdi* gdi::getInstance()\n{\n  static gdi instance;\n  return &amp;instance;\n}\n\ngdi::gdi()\n{\n  m_hdc = NULL;\n  m_OldPen = NULL;\n  m_OldBrush = NULL;\n  m_LineWidth = 1;\n  m_Color = RGB(0,0,0);\n  m_DcWidth = -1;\n  m_DcHeight = -1;\n  m_Transform.set_identity();\n\n  m_Pen = CreatePen(PS_SOLID,1,RGB(0,0,0));\n  m_Brush = CreateSolidBrush(RGB(255,255,255));\n}\n\ngdi::~gdi()\n{\n    if(m_Pen) DeleteObject(m_Pen);\n    if(m_Brush) DeleteObject(m_Brush);\n}\n\nvoid gdi::StartDrawing(HDC hdc, int dcwidth, int dcheight)\n{\n  m_hdc = hdc;\n  m_DcWidth = dcwidth;\n  m_DcHeight = dcheight;\n  m_OldPen = (HPEN)SelectObject(hdc, m_Pen);\n  m_OldBrush = (HBRUSH)SelectObject(hdc, m_Brush);\n}\n\nvoid gdi::StopDrawing(HDC hdc)\n{\n  SelectObject(hdc, m_OldPen);\n  SelectObject(hdc, m_OldBrush);\n\n  m_hdc = NULL;\n  m_DcWidth = -1;\n  m_DcHeight = -1;\n  m_OldPen = NULL;\n  m_OldBrush = NULL;\n}\n\nvoid gdi::SetColor(const DBlib::float3&amp; col)\n{\n    int r = static_cast&lt;int&gt;(DBlib::clamp(col.x*255.0f, 0.0f, 255.0f));\n    int g = static_cast&lt;int&gt;(DBlib::clamp(col.y*255.0f, 0.0f, 255.0f));\n    int b = static_cast&lt;int&gt;(DBlib::clamp(col.z*255.0f, 0.0f, 255.0f));\n    m_Color = RGB(r,g,b);\n\n    SetTextColor(m_hdc, m_Color);\n\n    if(m_Pen) DeleteObject(m_Pen);\n    if(m_Brush) DeleteObject(m_Brush);\n    m_Pen= CreatePen(PS_SOLID, m_LineWidth, m_Color);\n    m_Brush= CreateSolidBrush(m_Color);\n}\n\nvoid gdi::SetLineWidth(int width)\n{\n    m_LineWidth = width;\n\n    if(m_Pen) DeleteObject(m_Pen);\n    m_Pen= CreatePen(PS_SOLID, m_LineWidth, m_Color);\n}\n\nvoid gdi::SetTransform(const DBlib::float3x3&amp; transform)\n{\n    m_Transform = transform;\n}\n\nvoid gdi::Transform_NDC_To_WC(int&amp; x_out, int&amp; y_out, const DBlib::float2&amp; p) const\n{\n    x_out = static_cast&lt;int&gt;((p.x+1.0f)*(static_cast&lt;float&gt;(m_DcWidth)/2.0f));\n    y_out = m_DcHeight - static_cast&lt;int&gt;((p.y+1.0f)*(static_cast&lt;float&gt;(m_DcHeight)/2.0f));\n}\n\nvoid gdi::Transfrom_WC_To_NDC(DBlib::float2&amp; p_out, int x, int y) const\n{\n    p_out.x = static_cast&lt;float&gt;(x)*2.0f/static_cast&lt;float&gt;(m_DcWidth) - 1.0f;\n    p_out.y = -(static_cast&lt;float&gt;(y)*2.0f/static_cast&lt;float&gt;(m_DcHeight) - 1.0f);\n}\n\nvoid gdi::Transform(int&amp; x_out, int&amp; y_out, const DBlib::float2&amp; p) const\n{\n    Transform_NDC_To_WC(x_out, y_out, p*m_Transform);\n}\n\nvoid gdi::DrawText(const DBlib::float2&amp; pos, const std::tstring&amp; s)\n{\n    int x,y;\n    Transform(x,y,pos);\n    TextOut(m_hdc, x, y, s.c_str(), (int)s.size());\n}\n\nvoid gdi::DrawLine(const DBlib::float2&amp; p1, const DBlib::float2&amp; p2)\n{\n    int x1,y1,x2,y2;\n    Transform(x1,y1,p1);\n    Transform(x2,y2,p2);\n\n    MoveToEx(m_hdc, x1, y1, NULL);\n    LineTo(m_hdc, x2, y2);\n}\n\nvoid gdi::DrawPolygon(const DBlib::float2* p, int size)\n{\n    int* x = new int[size];\n    int* y = new int[size];\n\n    for(int i=0; i&lt;size; ++i) {\n        Transform(x[i],y[i],*(p+i));\n    }\n    for(int i=0; i&lt;size; ++i) {\n        MoveToEx(m_hdc, x[i], y[i], NULL);\n        LineTo(m_hdc, x[(i+1)%size], y[(i+1)%size]);\n    }\n\n    delete[] x;\n    delete[] y;\n}\n\nvoid gdi::FillPolygon(const DBlib::float2* p, int size)\n{\n    int* x = new int[size];\n    int* y = new int[size];\n    POINT* pts = new POINT[size];\n\n    for(int i=0; i&lt;size; ++i) {\n        Transform(x[i],y[i],*(p+i));\n        pts[i].x = static_cast&lt;LONG&gt;(x[i]);\n        pts[i].y = static_cast&lt;LONG&gt;(y[i]);\n    }\n\n    Polygon(m_hdc, pts, size);\n\n    delete[] x;\n    delete[] y;\n    delete[] pts;\n}\n</code></pre>\n\n<p>App.cpp - Render method definition</p>\n\n<pre><code>void App::Render(float dTime)\n{\n    GDI-&gt;SetColor(DBlib::float3(1.0f,1.0f,1.0f));\n    GDI-&gt;SetLineWidth(50);\n    GDI-&gt;DrawLine(DBlib::float2(-1.0f,-1.0f), DBlib::float2(1.0f,1.0f));\n}\n</code></pre>\n"},{"tags":["c++","c","windows","delphi","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12756751,"title":"KeyInformation parameter of NtEnumerateKey()","body":"<p>I'm curious to know how the <code>KeyInformation</code> parameter should be passed to <code>NtEnumerateKey()</code>. When I run the following code, <code>NtEnumerateKey()</code> returns <code>NTSTATUS = 0xC000000D</code> with the error message <i>\"An invalid parameter was passed to a service or function.\"</i></p>\n\n<p>I'm using Windows 7. Although the following code uses Delphi language, you can answer my question in C language too. My question is not specific to a programming language.</p>\n\n<pre><code>type\n  KEY_NAME_INFORMATION = record\n    NameLength: ULONG;\n    Name: array[0..254] of WCHAR;\n  end;\n  PKEY_NAME_INFORMATION = ^KEY_NAME_INFORMATION;\n\nvar\n  iNtStatus: LONG;\n  hKeyResult: THandle;\n  KeyNameInfo: KEY_NAME_INFORMATION;\n  iResultLen: ULONG;\n\niNtStatus := NtOpenKey(@hKeyResult, (KEY_ENUMERATE_SUB_KEYS) and not\n    SYNCHRONIZE, @rObjAttrs);\nif hKeyResult = 0 then Exit;\n\niNtStatus := NtEnumerateKey(hKeyResult,\n    0,\n    KeyNameInformation,\n    @KeyNameInfo,                 // I'm asking about this parameter,\n    SizeOf(KEY_NAME_INFORMATION), // and also this parameter\n    @iResultLen);\n</code></pre>\n\n<h2>UPDATED: Weird Thing</h2>\n\n<p>If I pass <code>KeyBasicInformation</code> instead of <code>KeyNameInformation</code>, <code>NtEnumerateKey()</code> returns <code>STATUS_SUCCESS</code>. Does not <code>NtEnumerateKey()</code> support the <code>KeyNameInformation</code>?</p>\n\n<pre><code>type\n  KEY_BASIC_INFORMATION = record\n    LastWriteTime: LARGE_INTEGER;\n    TitleIndex: ULONG;\n    NameLength: ULONG;\n    Name: array[0..254] of WCHAR;\n  end;\n  PKEY_BASIC_INFORMATION = ^KEY_BASIC_INFORMATION;\n\nvar\n  KeyBasicInfo: KEY_BASIC_INFORMATION;\n\niNtStatus := NtEnumerateKey(hKeyResult,\n    0,\n    KeyBasicInformation,           // Note this!\n    @KeyBasicInfo,                 // Note this!\n    SizeOf(KEY_BASIC_INFORMATION), // Note this!\n    @iResultLen);\n</code></pre>\n"},{"tags":["winapi","design-patterns","messages"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12763000,"title":"Better way for handling windows messages?","body":"<p>I work on some project using C and uses Win32API, using different language or any other libraries such as MVC, GTK, QT .. etc, is not an option.</p>\n\n<p>I'm looking for a good way for handling windows messages/signals/events like :</p>\n\n<pre><code>LRESULT CALLBACK WndProc(HWND hwnd, UINT msg, WPARAM wparam, LPARAM lparam)\n{\n    switch(msg) {\n        case WM_CLOSE:\n            DestroyWindow(hwnd);\n            break;\n        case WM_DESTROY:\n            PostQuitMessage(0);\n            break;\n        case WM_COMMAND:\n            switch(wparam) {\n                case ID_OK_BUTTON:\n                    DoSomething(hwnd);\n                    break;\n                case ID_FOO_BUTTON:\n                    DoFoo(hwnd);\n                    break;\n                /*\n                ....\n                It's only getting more complex\n                ....\n                */\n                case ID_BAR_BUTTON:\n                    DoBar(hwnd);\n                    break;\n                case ID_EXIT_BUTTON:\n                    SendMessage(hwnd, WM_CLOSE, wparam, lparam);\n                    break;\n                case ID_OPEN_BUTTON:\n                    OpenFile(hwnd);\n                    break;\n            }\n            break;\n        default:\n            return DefWindowProc(hwnd, msg, wparam, lparam);\n    }\n    return 0;\n}\n</code></pre>\n\n<p>This part is only getting more and more complex and ugly. Do you know any way to simplify it, perhaps something like the way I always see in many GUI libraries:</p>\n\n<pre><code>some_magic(some_object, message, callback);\n</code></pre>\n\n<p>Any simple advice will be a great help.</p>\n"},{"tags":["python","winapi","ms-access","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":105,"score":1,"question_id":12756731,"title":"Run a query within MS Access","body":"<p>I am not very familiar with python yet. I have added <code>win32</code>, imported <code>odbc</code> in my code, opened a connection to a database.</p>\n\n<p>I would like to run a query stored in the database. </p>\n\n<p>When I add the update query to the code and try to run it, I get the following message: </p>\n\n<blockquote>\n  <p>opError: [Microsoft][ODBC Microsoft Access Driver] The query cannot be\n  completed. Either the size of the query result is larger than the\n  maximum size of a database (2 GB), or there is not enough temporary\n  storage space on the disk to store the query result. in EXEC</p>\n</blockquote>\n\n<p>The amount of data I am manipulating is quite large and the specific query I am trying to run is not efficient.</p>\n\n<p>Is there something similar like in visual basic <code>doCmd</code>?</p>\n\n<p>Thanks.</p>\n"},{"tags":["winapi","createprocess"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12759894,"title":"How do I find all windows classes that were created by a program that was started via CreateProcess in win32 API programming?","body":"<p>I'm launching a program through <code>CreateProcess</code> and this program creates many different windows classes. For example, one of the classes is called <code>Message_Dispatch</code>. Another one is called <code>Main_App_Frame</code>. There are several more.</p>\n\n<p>How do I enumerate all windows classes belonging to the process started by <code>CreateProcess</code> API call?</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":12761666,"title":"Why doesn't Chrome hang when a plugin fails?","body":"<p>I understand that Chrome using re-parenting in order to have child plugins such as Flash render from different processes.</p>\n\n<p>I have experimented with this, and I have got it working using the SetParent Win32 call.</p>\n\n<p>However, when I force the child GUI thread to block, the parent process will also hang as soon as the mouse moves over a the window area owned by the child process.  Presumably this is because the message loop in the parent application is calling down to the child and it never responds.  How does Chrome get around this?</p>\n"},{"tags":["c++","file","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12758406,"title":"How to check if the file is still being copied in cpp using windows API?","body":"<p>In my current project, we had a requirement to check if the file is still copying. </p>\n\n<p>We have already developed a library which will give us OS notification like file_added , file_removed , file_modified, file_renamed on a particular folder along with the corresponding file path.</p>\n\n<p>The problem here is that, lets say if you add 1 GB file, it is giving multiple notification such as file_added , file_modified, file_modified as the file is being copied. </p>\n\n<p>Now i decided to surpass these notifications by checking if the file is copying or not. Based on that i will ignore events.</p>\n\n<p>I have written below function in c++ which tells if the file is being copied or not which takes file path as input.\nDetails:- Basically it uses windows API \"CreateFile\" to get file handle. If we are not able acquire handle then it is determined as file is being copied.</p>\n\n<p>Problem :- For some larger files like 2 GB with .rar &amp; .exe format, this not working. Can you please advice me is this is right approach or not? If not appreciate other approaches.</p>\n\n<pre><code>bool isFileBeingCopied(const boost::filesystem::path &amp;filePath)\n{\n     //Log(INFO, \"Checking if the given file is being copied or not for the file [%s]\",filePath.string().c_str());\n     HANDLE hFile = ::CreateFile(filePath.c_str(), GENERIC_READ, 0, NULL, OPEN_EXISTING, 0, NULL);\n     DWORD dwLastError = GetLastError();\n\n     if(hFile == NULL &amp;&amp; hFile == INVALID_HANDLE_VALUE)\n     {\n          Log(INFO, \"Gained invalid handle on the file - hence determining it, as being copied file [%s]\",filePath.string().c_str());\n          return true;\n     }\n     else\n     {\n          if(dwLastError == ERROR_SUCCESS )\n          {\n                CloseHandle(hFile);\n                Log(INFO, \"Able to gain the handle on the file - hence determining it, as copied file [%s]\",filePath.string().c_str());\n                return false;\n          }\n          else\n          {\n              Log(INFO, \"Not able to gain the handle for the file - hence determining it, as being copied file [%s]\",filePath.string().c_str());\n              return true;\n          }\n     }               \n}\n</code></pre>\n"},{"tags":["c++","windows","winapi","keyboard","ascii"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":434,"score":1,"question_id":11378936,"title":"Hardware scan code to ascii char conversion","body":"<p>Is there a Windows API to translate a hardware scan code to an ASCII character?</p>\n"},{"tags":["c#",".net","winapi","c#-4.0","wmi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":116,"score":2,"question_id":8211715,"title":"Win32_MountPoint alternative for xp","body":"<p>Is there any alternative for Win32_MountPoint WMI class that is available on xp?</p>\n"},{"tags":["windows","winapi","createprocess"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12759861,"title":"Why is there a \"dwThreadId\" and a \"dwProcessId\" for a newly created process via CreateProcess in win32 API programming?","body":"<p>I'm curious why there are two separate IDs - <code>dwProcessId</code> and <code>dwThreadId</code> returned in the <code>PROCESS_INFORMATION</code> data structure when I call <code>CreateProcess</code> in win32 API programming?</p>\n\n<p>In what cases would I use the <code>dwThreadId</code>? So far I haven't found a use case. I only use the process id to identify the program that I started via <code>CreateProcess</code>.</p>\n\n<p>Also I'm very curious why does Linux have just a <code>pid</code> (aka ProcessId) but Windows has both pid and threadid?</p>\n"},{"tags":["windows","winapi","custom-draw"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3000,"score":0,"question_id":1955538,"title":"Win32: How to custom draw an Edit control?","body":"<p>i need to implement the functionality of <a href=\"http://msdn.microsoft.com/en-us/library/bb761639.aspx\" rel=\"nofollow\">EM_SETCUEBANNER</a>, where a text hint appears inside an Edit control:</p>\n\n<p><img src=\"http://i45.tinypic.com/4rxfgl.jpg\" alt=\"alt text\"></p>\n\n<p>The catch is that i cannot use version 6 of the Common Controls, which is what is required to get the Microsoft supplied implementation of a cue banner.</p>\n\n<p>i've looked into simply changing the text of the edit control, and the font format to </p>\n\n<pre><code>Dark Gray Italic Text\n</code></pre>\n\n<p>but it will throw <strong>Change</strong> events (<a href=\"http://delphi.about.com/od/tedittmaskedit/TEdit%5FTMaskEdit%5FDelphi%5FEdit%5FControl%5FUsage%5FExamples%5FTips%5Fand%5FTricks.htm\" rel=\"nofollow\">component wrapper provided by higher component library</a>) that i can't find a way to avoid.</p>\n\n<p>So i was instead going to custom draw the text, drawing the Cue Banner text when the control is unfocused and empty, and rely on default painting otherwise.</p>\n\n<p>The Edit control doesn't nicely expose a custom drawing mechanism, <a href=\"http://msdn.microsoft.com/en-us/library/bb761817.aspx\" rel=\"nofollow\">like ListView, TreeView and others provide</a>.</p>\n\n<p><a href=\"http://www.codeguru.com/forum/archive/index.php/t-302153.html\" rel=\"nofollow\">Other people have looked into it</a>, but it seems to be an nearly impossible task:</p>\n\n<blockquote>\n  <p>From the way things are looking, I'll\n  have to handle the following\n  messages:</p>\n  \n  <ul>\n  <li><strong>WM_ERASEBKGND, WM_PAINT</strong> (for obvious reasons)</li>\n  <li><strong>WM_SETFOCUS, WM_KILLFOCUS</strong> (to prevent\n  the white bar from displaying --\n  described above)</li>\n  <li><strong>WM_CHAR</strong> (to process and update the\n  text in the control)</li>\n  </ul>\n  \n  <p>And I also need to find a way to\n  display the caret in the control,\n  since I haven't found a way to allow\n  Windows to do that for me without also\n  painting the white bar I mentioned.</p>\n  \n  <p>This is going to be fun. :rolleyes:</p>\n</blockquote>\n\n<p>Given that the Windows Edit control was never meant to be custom drawn: does anyone know how to custom draw a Windows Edit control?</p>\n\n<p><hr></p>\n\n<p><strong>Note</strong>: i will also accept answers that solve my problem, rather than answering my question. But anyone else wanting to custom draw an Edit control, coming across this question, would probably like an answer.</p>\n"},{"tags":["c++","winapi","icons","glut","freeglut"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":12748103,"title":"How to change freeglut main window icon in C++?","body":"<p>I have a DLL written in C++ that uses FreeGlut to visualize some data. I want to change the icon of the main (free)glut window. </p>\n\n<p>I've read that it is impossible, but in the docs I see:</p>\n\n<blockquote>\n  <p>GLUT_ICON - specifies the icon that goes in the upper left-hand corner of the freeglut windows.</p>\n</blockquote>\n\n<p>How can I change icon for (free)glut window, if possible?</p>\n"},{"tags":["winapi","gcc","assembly","mingw","ld"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12755237,"title":"using winapi in mingw assembler","body":"<p>I'm tring to compile the following assembly code into shared library (dll) </p>\n\n<pre><code>.extern _GetProcAddress\n\n.global _main\n_main:\n    CALL _GetProcAddress\n</code></pre>\n\n<p>using the following commend:</p>\n\n<pre><code>i686-w64-mingw32-gcc -shared -o file.dll file.S\n</code></pre>\n\n<p>but I'm getting the following link error:</p>\n\n<pre><code>`_GetProcAddress' referenced in section `.text' of /tmp/ccamwU4N.o: defined in discarded section `.text' of /usr/lib/gcc/i686-w64-mingw32/4.6/../../../../i686-w64-mingw32/lib/../lib/libkernel32.a(dxprbs00553.o)\n</code></pre>\n\n<p>how can I fix this error and call winapi functions?</p>\n"},{"tags":["python","winapi","pdf","printing","shellexecute"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":107,"score":3,"question_id":12626918,"title":"Python's win32api only printing to default printer","body":"<p>I'm trying to use <code>win32api</code> to output a PDF document to a particular printer.</p>\n\n<pre><code>win32api.ShellExecute(0, \"print\", filename, '/d:\"%s\"' % printername, \".\", 0)\n</code></pre>\n\n<p><code>filename</code> is a full pathname to the file, and <code>printname</code> is the name of the target printer I get by going through the output of <code>win32api.EnumPrinters(6)</code>.</p>\n\n<p>The file is sent to the Windows default printer even if <code>printername</code> is the name of a different target (my expectation is that passing a specific printer would send the named file to that printer, rather than the default). </p>\n\n<p>Any hints as to what I'm doing wrong? Is there a different way of generically printing a PDF file to a specific printer? Barring all else, is there a way of temporarily changing the default printer from my program?</p>\n"},{"tags":["c++","windows","winapi","visual-c++"],"answer_count":4,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":463,"score":1,"question_id":10777714,"title":"Creating a C++ Non-Blocking Timer in Windows","body":"<p>On Linux, I would create a child process using fork() that will be my count-down timer, and once the timer ends, the child process will send a signal to the parent process to tell it that the timer has ended. The parent process then should handle the signal accordingly.</p>\n\n<p>I have no idea how to do this on windows. Some people here recommended using threads but they never wrote any example code showing how to do that.</p>\n\n<p>The most important thing is that the timer is non-blocking, meaning that it remains counting down in the background, while the program is accepting input from the user and handling it normally.</p>\n\n<p>Could you please show me how?</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>The application is a console one. And please show me example code. Thanks!</p>\n\n<p><strong>Update:</strong></p>\n\n<p>So after I read some of the suggestions here, I searched for some answers here and found this <a href=\"http://stackoverflow.com/questions/10715555/settimer-in-vc\">one</a> which was helpful.</p>\n\n<p>I then wrote the below code, which works, but not as it's supposed to be:</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;iostream&gt;\n#include &lt;string&gt;\nusing namespace std;\n\n#define TIMER_VALUE (5 * 1000) //5 seconds = 5000 milli seconds\nHANDLE g_hExitEvent = NULL;\n\nbool doneInTime = false;\nstring name;\n\nbool inputWords();\n\n\n//The below function will be called when the timer ends\nvoid CALLBACK doWhenTimerEnds(PVOID lpParameter, BOOLEAN TimerOrWaitFired)\n{\n    if(!doneInTime)\n    {\n        cout &lt;&lt; \"\\nOut of time ... try again ...\" &lt;&lt; endl;\n        name = \"\";\n        doneInTime = inputWords();\n    }\n    SetEvent(g_hExitEvent);\n}\n\n\nbool inputWords()\n{\n\n    /* doWhenTimerEnds() will be called after time set by 5-th parameter and repeat every 6-th parameter. After time elapses,\n    callback is called, executes some processing and sets event to allow exit */\n    HANDLE hNewTimer = NULL; \n    BOOL IsCreated = CreateTimerQueueTimer(&amp;hNewTimer, NULL, doWhenTimerEnds, NULL, TIMER_VALUE, 0, WT_EXECUTELONGFUNCTION);\n\n    g_hExitEvent = CreateEvent(NULL, TRUE, FALSE, NULL);\n\n    cout &lt;&lt; \"Input your name in 5 seconds .. \" &lt;&lt; endl;\n    std::getline(cin, name);\n\n    DeleteTimerQueueTimer(NULL, hNewTimer, NULL);\n    return true;\n}\n\nint main()\n{\n    doneInTime = inputWords();\n    cout &lt;&lt; \"Hello, \" &lt;&lt; name &lt;&lt; \"! You're done in time\" &lt;&lt; endl;\n\n    //WaitForSingleObject(g_hExitEvent, 15000);\n\n    system(\"pause\");\n    return 0;\n}\n</code></pre>\n\n<p>The problem is, the interrupted getline() never stops, and the subsequent getline()'s read even the text previously entered! how can I fix that please? And if there's a better way of doing it, could you please point me out to it?</p>\n"},{"tags":["winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12747951,"title":"How to preserve scroll position when calling SetWindowText on Edit control","body":"<p>I create an edit control with:</p>\n\n<pre><code>HWND hwnd = CreateWindow( \"EDIT\", tabText.c_str(), WS_CHILD | WS_VSCROLL | ES_LEFT | ES_MULTILINE | ES_AUTOVSCROLL, ...)\n</code></pre>\n\n<p>Then I update its contents by calling <code>SetWindowText(...)</code>. But every time the update completes the scroll is set to the beginning. I need to make it preserve its position.\nI write to this control a log. That means that the text string is getting bigger.\nI tried to get scroll info before calling <code>SetWindowText()</code> and set scroll info after the call. This results in a blinking of the control.</p>\n\n<p>How can I preserve scroll position and view the text while it is updated?</p>\n"},{"tags":["winapi","touch","multi-touch"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":311,"score":4,"question_id":5008080,"title":"Multitouch pad for Win32 application on Windows 7","body":"<p>I am developing an Win32 application (Windows 7) that uses a multitouch input. I tried several multitouch pads working on Windows, such as MSI starpad and Macbook pro built-in touchpad (booted in Window 7 using Bootcamp), but none of them generate Windows multitouch or gesture event. Does anyone know how these touchpad drivers send multitouch signals to win32 applications?</p>\n"},{"tags":["windows","winapi","caching","flush","ini"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":141,"score":1,"question_id":10912352,"title":"Does Windows NT cache or flush INI-file writings?","body":"<p>I am updating a rather old application. It used INI file accesses all around the code, creating and freeing INI-accessing class instances here and there.</p>\n\n<p>I want to centralize this to several single instances, one per used file.\nSo we'd get rid of instances creating/freeing copy-pasted everywhere and would have freedom to completely replace those classes would be decision to switch from INI to other settings storage.</p>\n\n<p>Should one call WritePrivateProfileString(NULL, NULL, NULL...) to apply the changes?\nAssume that:\n1) the access goes directly to real INI-files, not to registry mapped ones.\n2) OS is of NT family (maybe rarely Win2000, most probably WinXP and later). Win9x/ReactOS/WinE/Odin/etc are not cared about.</p>\n\n<p>So, should we flush the ini savings now explicitly or not ?</p>\n\n<p>NT does not cache Registry key writes, do no need to regFlushKey now.\nBut what about INI files?</p>\n\n<p>MSDN page about WritePrivateProfileString only describes flushing technique wrt Win9x and NT File-to-Reg mappings. It is silent about real INI files.</p>\n"},{"tags":["c++","winapi","windows-7","asynchronous","serial-port"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":150,"score":1,"question_id":12583482,"title":"Serial asynchronous I/O in Windows 7/64","body":"<p>I have a multi-threaded Windows program which is doing serial port asynchronous I/O through \"raw\" Win API calls. It is working perfectly fine on any Windows version except Windows 7/64. </p>\n\n<p>The problem is that the program can find and setup the COM port just fine, but it cannot send nor receive any data. No matter if I compile the binary in Win XP or 7, I cannot send/receive on Win 7/64. Compatibility mode, run as admin etc does not help.</p>\n\n<p>I have managed to narrow down the problem to the FileIOCompletionRoutine callback. Every time it is called, dwErrorCode is always 0, dwNumberOfBytesTransfered is always 0. GetOverlappedResult() from inside the function always return TRUE (everything ok). It seems to set the lpNumberOfBytesTransferred correctly. But the lpOverlapped parameter is corrupt, it is a garbage pointer pointing at garbage values.</p>\n\n<p>I can see that it is corrupt by either checking in the debugger what address the correct OVERLAPPED struct is allocated at, or by setting a temp. global variable to point at it.</p>\n\n<p>My question is: why does this happen, and why does it only happen on Windows 7/64? Is there some issue with calling convention that I am not aware of? Or is the overlapped struct treated differently somehow?</p>\n\n<hr>\n\n<p>Posting relevant parts of the code below:</p>\n\n<pre><code>class ThreadedComport : public Comport\n{\n  private:\n\n    typedef struct\n    {\n      OVERLAPPED       overlapped;\n      ThreadedComport* caller;                   /* add user data to struct */\n    } OVERLAPPED_overlap;\n\n    OVERLAPPED_overlap _send_overlapped;\n    OVERLAPPED_overlap _rec_overlapped;\n\n  ...\n\nstatic void WINAPI  _send_callback     (DWORD dwErrorCode,\n                                        DWORD dwNumberOfBytesTransfered,\n                                        LPOVERLAPPED lpOverlapped);\nstatic void WINAPI  _receive_callback  (DWORD dwErrorCode,\n                                        DWORD dwNumberOfBytesTransfered,\n                                        LPOVERLAPPED lpOverlapped);\n\n  ...\n};\n</code></pre>\n\n<p>Open/close is done in a base class that has no multi-threading nor asynchronous I/O implemented:</p>\n\n<pre><code>void Comport::open (void)\n{\n  char          port[20];\n  DCB           dcbCommPort;\n  COMMTIMEOUTS  ctmo_new      = {0};\n\n  if(_is_open)\n  {\n    close();\n  }\n\n  sprintf(port, \"\\\\\\\\.\\\\COM%d\", TEXT(_port_number));\n\n  _hcom = CreateFile(port,\n                     GENERIC_READ | GENERIC_WRITE,\n                     0,\n                     0,\n                     OPEN_EXISTING,\n                     0,\n                     0);\n\n  if(_hcom == INVALID_HANDLE_VALUE)\n  {\n   // error handling\n  }\n\n  GetCommTimeouts(_hcom, &amp;_ctmo_old);\n  ctmo_new.ReadTotalTimeoutConstant    = 10;\n  ctmo_new.ReadTotalTimeoutMultiplier  = 0;\n  ctmo_new.WriteTotalTimeoutMultiplier = 0;\n  ctmo_new.WriteTotalTimeoutConstant   = 0;\n\n  if(SetCommTimeouts(_hcom, &amp;ctmo_new) == FALSE)\n  {\n    // error handling\n  }\n\n  dcbCommPort.DCBlength = sizeof(DCB);\n  if(GetCommState(_hcom, &amp;(DCB)dcbCommPort) == FALSE)\n  {\n    // error handling\n  }\n\n  // setup DCB, this seems to work fine\n\n  dcbCommPort.DCBlength = sizeof(DCB);\n  dcbCommPort.BaudRate = baudrate_int;\n\n  if(_parity == PAR_NONE)\n  {\n    dcbCommPort.fParity = 0;                     /* disable parity */\n  }\n  else\n  {\n    dcbCommPort.fParity = 1;                     /* enable parity */\n  }\n  dcbCommPort.Parity  = (uint8)_parity;\n  dcbCommPort.ByteSize = _databits;\n  dcbCommPort.StopBits = _stopbits;\n\n  SetCommState(_hcom, &amp;(DCB)dcbCommPort);\n}\n\n\nvoid Comport::close (void)\n{\n  if(_hcom != NULL)\n  {\n    SetCommTimeouts(_hcom, &amp;_ctmo_old);\n    CloseHandle(_hcom);\n    _hcom = NULL;\n  }\n  _is_open = false;\n}\n</code></pre>\n\n<p>The whole multi-threading and event handling mechanism is rather complex, relevant parts are:</p>\n\n<p>Send</p>\n\n<pre><code>result = WriteFileEx (_hcom,              // handle to output file\n                      (void*)_write_data, // pointer to input buffer\n                      send_buf_size,      // number of bytes to write\n                      (LPOVERLAPPED)&amp;_send_overlapped, // pointer to async. i/o data\n                      (LPOVERLAPPED_COMPLETION_ROUTINE )&amp;_send_callback);\n</code></pre>\n\n<p>Receive</p>\n\n<pre><code>  result = ReadFileEx (_hcom,                  // handle to output file\n                       (void*)_read_data,      // pointer to input buffer\n                       _MAX_MESSAGE_LENGTH,    // number of bytes to read\n                       (OVERLAPPED*)&amp;_rec_overlapped, // pointer to async. i/o data\n                       (LPOVERLAPPED_COMPLETION_ROUTINE )&amp;_receive_callback);\n</code></pre>\n\n<p>Callback functions</p>\n\n<pre><code>void WINAPI ThreadedComport::_send_callback (DWORD dwErrorCode,\n                                             DWORD dwNumberOfBytesTransfered,\n                                             LPOVERLAPPED lpOverlapped)\n{\n  ThreadedComport* _this = ((OVERLAPPED_overlap*)lpOverlapped)-&gt;caller;\n\n  if(dwErrorCode == 0)                           // no errors\n  {\n    if(dwNumberOfBytesTransfered &gt; 0)\n    {\n      _this-&gt;_data_sent = dwNumberOfBytesTransfered;\n    }\n  }\n\n  SetEvent(lpOverlapped-&gt;hEvent);\n}\n\n\nvoid WINAPI ThreadedComport::_receive_callback (DWORD dwErrorCode,\n                                                DWORD dwNumberOfBytesTransfered,\n                                                LPOVERLAPPED lpOverlapped)\n{\n  if(dwErrorCode == 0)                           // no errors\n  {\n    if(dwNumberOfBytesTransfered &gt; 0)\n    {\n      ThreadedComport* _this = ((OVERLAPPED_overlap*)lpOverlapped)-&gt;caller;\n      _this-&gt;_bytes_read = dwNumberOfBytesTransfered;\n    }\n  }\n\n  SetEvent(lpOverlapped-&gt;hEvent);\n}\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>Updated: I have spent most of the day on the theory that the OVERLAPPED variable went out of scope before the callback is executed. I have verified that this never happens and I have even tried to declare the OVERLAPPED struct as static, same problem remains. If the OVERLAPPED struct had gone out of scope, I would expect the callback to point at the memory location where the struct was previously allocated, but it doesn't, it points somewhere else, at an entirely unfamiliar memory location. Why it does that, I have no idea.</p>\n\n<p>Maybe Windows 7/64 makes an internal hardcopy of the OVERLAPPED struct? I can see how that would cause this behavior, since I am relying on additional parameters sneaked in at the end of the struct (which seems like a hack to me, but apparently I got that \"hack\" from official MSDN examples).</p>\n\n<p>I have also tried to change calling convention but this doesn't work at all, if I change it then the program crashes. (The standard calling convention causes it to crash, whatever standard is, cdecl? __fastcall also causes a crash.) The calling conventions that work are __stdcall, WINAPI and CALLBACK. I think these are all same names for __stdcall and I read somewhere that Win 64 ignores that calling convention anyhow.</p>\n\n<p>It would seem that the callback is executed because of some \"spurious disturbance\" in Win 7/64 generating false callback calls with corrupt or irrelevant parameters. </p>\n\n<p>Multi-thread race conditions is another theory, but in the scenario I am running to reproduce the bug, there is only one thread, and I can confirm that the thread calling ReadFileEx is the same one that is executing the callback.</p>\n"},{"tags":["java","windows","winapi","wmi","jacob"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":120,"score":1,"question_id":12698653,"title":"(SOLVED) Java JACOB retrieve all the properties for a given Win32_* class object","body":"<p>I am currently working on a java-base cross-platform software distributor and I chose to use native OS mechanisms to prevent the users from having to do any setup before hand.</p>\n\n<p>I chose JSCH for SSH2 and JACOB for Java. I realize that JACOB limits me to Windows as the starting host, but that is something I can live with.</p>\n\n<p>I am writing a wrapper around JACOB to use some of the native mechanisms for talking to the target via WMI and I am running into a little issue. I am trying to retrieve a list of ALL the properties available for a given Win32_ class object and I haven't been able to do it. </p>\n\n<p>This link shows you can do it in VB <a href=\"http://www.vbsedit.com/scripts/misc/wmi/scr_1333.asp\" rel=\"nofollow\">http://www.vbsedit.com/scripts/misc/wmi/scr_1333.asp</a> and I was wondering if anyone had been able to figure it out when using JACOB.</p>\n\n<p>EDIT : (code snippet)</p>\n\n<pre><code>item = enumVariant.nextElement().toDispatch();\n            //Dispatch.class returns a variant which can convert to java form\n            String serviceName = Dispatch.call(item, \"Name\").toString();\n            String servicePath = Dispatch.call(item,\"PathName\").toString();\n            int servicePID = Dispatch.call(item,\"ProcessId\").getInt();\n            //System.out.println(\"Service: \"+serviceName+\" ServicePath: \"+servicePath+\" PID: \"+servicePID);\n            //System.out.println(serviceName+\" \"+servicePath+\" \"+servicePID);\n            list.add(serviceName+\" \"+servicePID);\n</code></pre>\n\n<p>Code above shows that I can ask for individual properties but there isn't a good way to ask for ALL properties.</p>\n\n<p>Using the answer provided by jarekczek, I have drawn up a simpler bit of code </p>\n\n<pre><code>//do the query\n    EnumVariant enumVariant = execQuery(query);\n    //get the acx object\n    ActiveXComponent acx = null; \n    acx = new ActiveXComponent(enumVariant.nextElement().getDispatch());\n    //show all the properties for the object\n    EnumVariant propertiesVariant = new EnumVariant(acx.getProperty(\"Properties_\").getDispatch());\n    ActiveXComponent propertyComponent = null;\n    while(propertiesVariant.hasMoreElements())\n    {\n        propertyComponent = new ActiveXComponent(propertiesVariant.nextElement().getDispatch());\n        System.out.println(propertyComponent.getPropertyAsString(\"Name\"));\n    }\n</code></pre>\n"},{"tags":["windows","winapi","global-variables"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":12750486,"title":"How do I avoid using a global variable when doing `EnumWindows` to find a windows in Win32 C API?","body":"<p>How do I avoid using global variables when using <code>EnumWindows</code> (or <code>FindChildWindows</code>) Win32 API?</p>\n\n<p>I've approximately the following code:</p>\n\n<pre><code>HWND prog_hwnd;\n\nBOOL CALLBACK ProgEnumProc(HWND hwnd, LPARAM lParam) {\n    if (...) {\n        // found the right hwnd, assign it to prog_hwnd;\n        prog_hwnd = hwnd;\n        return FALSE;\n    }\n    return TRUE;\n}\n\nvoid FindProgHwnd()\n{\n    EnumWindows(ProgEnumProc, 0);\n}\n\nint main()\n{ \n     FindProgHwnd();\n     if (prog_hwnd) {\n         // found prog_hwnd, but it's global variable\n     }\n}\n</code></pre>\n\n<p>As you can see, to find the right hwnd, I've to use a global variable <code>prog_hwnd</code>. I want to avoid using the global variable. Is there a way to do it?</p>\n"},{"tags":["winapi","cryptography","x509certificate","cryptoapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12691742,"title":"CryptoAPI: CERT_STORE_PROV_MEMORY and thread safety","body":"<p>I'm writing a client/server solution using CryptoAPI to provide SSL encryption over a TCP socket. In the client I have a global CERT_STORE_PROV_MEMORY certificate store that I share between all connections (i.e. multiple threads).</p>\n\n<p>My question is whether this is thread safe? Can multiple threads call functions (e.g. CertGetIssuerCertificateFromStore()) on the certificate store at the same time?</p>\n"},{"tags":["api","winapi","findwindow","findwindowex"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12738408,"title":"How to find a child HWND of a child window of a child window (3 levels deep) with Win32 API?","body":"<p>Suppose I've this Window hierarchy for one of the processes:</p>\n\n<pre><code>Main Window               (class name: XYZ_Widget_1)\n`- Child Window           (class name: XYZ_Widget_0)\n  `- Child-Child Window    (class name: XYZ_Renderer)\n</code></pre>\n\n<p>How do I find the HWND of the <code>Child-Child Window</code>?</p>\n\n<p>I tried using <code>FindWindow</code> Win32 API function on <code>XYZ_Renderer</code> class but the <code>FindWindow</code> function doesn't find child windows.</p>\n\n<p>Then I tried using <code>FindWindow</code> to find <code>Main Window</code>, which succeeded, but after that using <code>FindWindowEx</code> can only find <code>Child Window</code> as <code>Child-Child Window</code> is not a child of <code>Main Window</code>.</p>\n\n<p>I guess I could go one layer deeper and call FindWindowEx on the <code>Child Window</code> once it's found.</p>\n\n<p>But before I do that I figured maybe there is an easy way to find <code>Child-Child Window</code>?</p>\n"},{"tags":["c++","winapi","namespaces","function-pointers","signature"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12747990,"title":"Can window/dialog procedures be in namespaces?","body":"<p>Before when I tried to make a window wrapper class, I learned that you cannot pass a dialog procedure to <code>CreateDialogParam()</code> that is in a class, because it being a class member changes the signature and therefor doesn't match that of <code>DLGPROC</code>. I used a workaround where all dialogs used one global procedure that used a map to find the class member procedure from the window handle passed to the global procedure. It would find the correct class pointer in the map, and pass the arguments to its procedure and return the result.</p>\n\n<p>Now I am using this same method, <em>but</em>, in this project everything is going to be in a namespace. Is this valid?</p>\n\n<pre><code>namespace MyNamespace\n{\n    INT_PTR MyProc(HWND hwnd, UINT msg, WPARAM wp, LPARAM lp) {\n        return 0;\n    }\n\n    class MyDlg\n    {\n    public:\n        HWND hwnd;\n\n        MyDlg(void) {\n            hwnd = CreateDialogParam(\n                GetModuleHandle(NULL),\n                MAKEINTRESOURCE(IDD_MYDLG),\n                HWND_DESKTOP,\n                (DLGPROC)MyProc, // Maybe 'MyNamespace::MyProc'?\n                NULL\n            );\n        }\n    };\n}\n</code></pre>\n\n<p>I'm not sure if namespaces change the function type signature like classes do.</p>\n"},{"tags":["winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12367155,"title":"Jrxml file build error in netbeans","body":"<p>I am using ireport to generate report in netbeans. I designed a jrxml successfully which fetch data from mysql database but I have this error in run time:</p>\n\n<pre><code>Sep 11, 2012 3:00:30 PM org.apache.commons.digester.Digester error\nSEVERE: Parse Error at line 2 column 394: Document root element \"jasperReport\", must match DOCTYPE root \"null\".\norg.xml.sax.SAXParseException: Document root element \"jasperReport\", must match DOCTYPE root \"null\".\n    at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:195)\n    at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.error(ErrorHandlerWrapper.java:131)\n    at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:384)\n    at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:318)\n    at com.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.rootElementSpecified(XMLDTDValidator.java:1621)\n    at com.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.handleStartElement(XMLDTDValidator.java:1900)\n    at com.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.startElement(XMLDTDValidator.java:764)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:1363)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$ContentDriver.scanRootElementHook(XMLDocumentScannerImpl.java:1315)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:3104)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$PrologDriver.next(XMLDocumentScannerImpl.java:921)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:647)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511)\n    at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808)\n    at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737)\n    at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119)\n    at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205)\n    at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522)\n    at org.apache.commons.digester.Digester.parse(Digester.java:1647)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.loadXML(JRXmlLoader.java:238)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.loadXML(JRXmlLoader.java:225)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.load(JRXmlLoader.java:213)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.load(JRXmlLoader.java:167)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.load(JRXmlLoader.java:151)\n    at net.sf.jasperreports.engine.JasperCompileManager.compileReport(JasperCompileManager.java:142)\n    at Java.NewClass.main(NewClass.java:45)\nException in thread \"main\" org.xml.sax.SAXParseException: Document root element \"jasperReport\", must match DOCTYPE root \"null\".\n    at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:195)\n    at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.error(ErrorHandlerWrapper.java:131)\n    at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:384)\n    at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:318)\n    at com.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.rootElementSpecified(XMLDTDValidator.java:1621)\n    at com.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.handleStartElement(XMLDTDValidator.java:1900)\n    at com.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.startElement(XMLDTDValidator.java:764)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:1363)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$ContentDriver.scanRootElementHook(XMLDocumentScannerImpl.java:1315)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:3104)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$PrologDriver.next(XMLDocumentScannerImpl.java:921)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:647)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511)\n    at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808)\n    at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737)\n    at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119)\n    at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205)\n    at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522)\n    at org.apache.commons.digester.Digester.parse(Digester.java:1647)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.loadXML(JRXmlLoader.java:238)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.loadXML(JRXmlLoader.java:225)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.load(JRXmlLoader.java:213)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.load(JRXmlLoader.java:167)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.load(JRXmlLoader.java:151)\n    at net.sf.jasperreports.engine.JasperCompileManager.compileReport(JasperCompileManager.java:142)\n    at Java.NewClass.main(NewClass.java:45)\n\nNESTED BY :\nnet.sf.jasperreports.engine.JRException: Document root element \"jasperReport\", must match DOCTYPE root \"null\".\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.loadXML(JRXmlLoader.java:242)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.loadXML(JRXmlLoader.java:225)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.load(JRXmlLoader.java:213)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.load(JRXmlLoader.java:167)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.load(JRXmlLoader.java:151)\n    at net.sf.jasperreports.engine.JasperCompileManager.compileReport(JasperCompileManager.java:142)\n    at Java.NewClass.main(NewClass.java:45)\nCaused by: org.xml.sax.SAXParseException: Document root element \"jasperReport\", must match DOCTYPE root \"null\".\n    at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:195)\n    at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.error(ErrorHandlerWrapper.java:131)\n    at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:384)\n    at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:318)\n    at com.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.rootElementSpecified(XMLDTDValidator.java:1621)\n    at com.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.handleStartElement(XMLDTDValidator.java:1900)\n    at com.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.startElement(XMLDTDValidator.java:764)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:1363)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$ContentDriver.scanRootElementHook(XMLDocumentScannerImpl.java:1315)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:3104)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$PrologDriver.next(XMLDocumentScannerImpl.java:921)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:647)\n    at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511)\n    at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808)\n    at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737)\n    at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119)\n    at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205)\n    at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522)\n    at org.apache.commons.digester.Digester.parse(Digester.java:1647)\n    at net.sf.jasperreports.engine.xml.JRXmlLoader.loadXML(JRXmlLoader.java:238)\n    ... 6 more\nJava Result: 1\n</code></pre>\n"},{"tags":["windows","winapi","iis7"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":12622328,"title":"query IIS application pool configuration fails in IIS7 when code running in worker","body":"<p>When querying iis7 config data it fails when running within the worker process and ok in console application.</p>\n\n<pre><code>        COSERVERINFO     csiMachineName;\n\n        csiMachineName.pAuthInfo     = NULL;\n        csiMachineName.dwReserved1 = 0;\n        csiMachineName.dwReserved2 = 0;\n        csiMachineName.pwszName      = L\"localhost\";\n\n        hr = CoGetClassObject(\n            __uuidof( AppHostAdminManager ),\n            CLSCTX_SERVER,\n            &amp;csiMachineName,\n            IID_IClassFactory,\n            (void**) &amp;(pClassFactory.GetInterfacePtr()));\n\n        hr = pClassFactory-&gt;CreateInstance(\n            NULL, __uuidof( IAppHostAdminManager ), (void **) &amp;(iisAdmin.GetInterfacePtr()));\n\n        bstr_t bstrSectionName(\"system.applicationHost/applicationPools\");\n        bstr_t bstrPath(\"MACHINE/WEBROOT/APPHOST\");\n\n        hr = iisAdmin-&gt;GetAdminSection(bstrSectionName, bstrPath, &amp;(sitesElement.GetInterfacePtr()) );\n\n        hr = sitesElement-&gt;get_Collection(&amp;(sitesElementCollection.GetInterfacePtr()));\n\n    DWORD sitesCount = 0;\n        hr = sitesElementCollection-&gt;get_Count(&amp;sitesCount);\n</code></pre>\n\n<p>and <code>sitesCount</code> is 0 when this code run in IIS module but ok when running in windows application.</p>\n\n<p>any idea?</p>\n"},{"tags":["c","winapi","command-line-arguments","createprocess"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":635,"score":0,"question_id":3982602,"title":"Way to pass argv[] to CreateProcess()","body":"<p>My C Win32 application should allow passing a full command line for another program to start, e.g.</p>\n\n<pre><code>myapp.exe /foo /bar \"C:\\Program Files\\Some\\App.exe\" arg1 \"arg 2\"\n</code></pre>\n\n<p><code>myapp.exe</code> may look something like</p>\n\n<pre><code>int main(int argc, char**argv)\n{\n  int i;\n\n  for (i=1; i&lt;argc; ++i) {\n     if (!strcmp(argv[i], \"/foo\") {\n        // handle /foo\n     } else if (!strcmp(argv[i], \"/bar\") {\n        // handle /bar\n     } else {\n        // not an option =&gt; start of a child command line\n        break;\n     }\n  }\n\n  // run the command\n  STARTUPINFO si;\n  PROCESS_INFORMATION pi;\n  // customize the above...\n\n  // I want this, but there is no such API! :(\n  CreateProcessFromArgv(argv+i, NULL, NULL, FALSE, 0, NULL, NULL, &amp;si, &amp;pi);\n\n  // use startup info si for some operations on a process\n  // ...\n}\n</code></pre>\n\n<p>I can think about some workarounds:</p>\n\n<ul>\n<li>use <a href=\"http://msdn.microsoft.com/en-us/library/ms683156.aspx\" rel=\"nofollow\"><code>GetCommandLine()</code></a>\nand find a substring corresponding to argv[i]</li>\n<li>write something similar to <a href=\"http://msdn.microsoft.com/en-us/library/system.diagnostics.processstartinfo.arguments%28VS.90%29.aspx#1\" rel=\"nofollow\"><code>ArgvToCommandLine()</code></a> also mentioned in <a href=\"http://stackoverflow.com/questions/2611044/process-start-pass-html-code-to-exe-as-argument/2611075#2611075\">another SO question</a></li>\n</ul>\n\n<p>Both of them lengthy and re-implement cumbersome windows command line parsing logic, which is already a part of <a href=\"http://msdn.microsoft.com/en-us/library/bb776391.aspx\" rel=\"nofollow\"><code>CommandLineToArgvW()</code></a>.</p>\n\n<p>Is there a \"standard\" solution for my problem? A standard (Win32, CRT, etc.) implementation of workarounds counts as a solution.</p>\n"},{"tags":["winapi","synchronization","compiler-errors"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":11980721,"title":"InterlockedPushListSList is missing. Where is it?","body":"<p>I am developing on a Windows Server 2008 box, with Visual Studio 2010 Ultimate, SP1. Unfortunately, the function <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/hh448545%28v=vs.10%29.aspx\" rel=\"nofollow\"><code>InterlockedPushListSList</code></a> is causing errors because it is undefined in my copy of <code>WinBase.h</code>. </p>\n\n<p>Declaring the function myself does not work; linker errors occur. It looks like this function is not defined in the windows libraries for my compiler. But the documentation linked to above states that it is available for my operating system. </p>\n\n<p>Some Googling has revealed that the API has been around since the development of Windows Longhorn, albeit from a non-official <a href=\"http://mikedimmick.blogspot.com.au/2004/07/changes-to-win32-api-in-longhorn_21.html\" rel=\"nofollow\">source</a>, so there shouldn't be any reason for it to be missing from my point of view.</p>\n\n<p>Does this function <em>actually</em> exist? If so, where can I get it?</p>\n"},{"tags":["winapi","serial-port","wait","comm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":121,"score":0,"question_id":12503798,"title":"Win32, Serial Port Read/Write and OVERLAPPED","body":"<p>I'm trying to put together a proof of concept for reading/writing to a serial port and I am having problems with design/concept. I don't want to poll, so I'm trying to use Overlapped I/O. In this case, it's not a multi-threaded application - it just uses efficient waits.</p>\n\n<p>(1) Open port (with OVERLAPPED)</p>\n\n<p>(2) SetCommState (set port baud, parity, CTS/RTS, etc)</p>\n\n<p>(3) SetCommMask (EV_BREAK, EV_CTS, EV_DSR,..., EV_RXCHAR, EV_RXFLAG, EV_TXEMPTY)</p>\n\n<p>(4) Create OVERLAPPED structures and Events</p>\n\n<p>(5) WriteFile (to port)</p>\n\n<p>(6) WaitCommEvent (due to write)</p>\n\n<p>(7) WaitCommEvent (due to read)</p>\n\n<p>(8) ReadFile (from port)</p>\n\n<p>(9) Check read buffer</p>\n\n<p>The MSDN example is kind of lame (<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa363424%28v=vs.85%29.aspx\" rel=\"nofollow\">Monitoring Communications Events</a>). I'm currently using two events, but the <code>ReadFile</code> step is failing with <code>ERROR_INVALID_PARAMETER</code>.</p>\n\n<p>In the steps above, do I need one or two overlapped structures? If one <code>OVERLAPPED</code> structure, are the steps <code>WriteFile</code>, <code>WaitCommEvent</code> (for write), reset event, <code>WaitCommEvent</code> (for read), <code>ReadFile</code>?</p>\n"},{"tags":["c++","delphi","winapi","dll","delphi-6"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12744947,"title":"Using C++ DLL in Delphi 6","body":"<p>I have to use an encoding function from an external C++ DLL in Delphi 6.\nFollowing is the declaration provided :</p>\n\n<p><code>long &lt;Function Name&gt; (char *Data, long &amp;Apply, char *ReturnVal, long &amp;Size)</code></p>\n\n<p>Data is the input value, Apply is a boolean value (default : FALSE), ReturnVal is the return value from the DLL and Size is the length of the ReturnVal.</p>\n\n<p>To use this in Delphi 6, I wrote following Code:</p>\n\n<pre><code>implementation\n   const\n     EncoderDLL = '&lt;DLL NAME&gt;';\n     FunctionName = 'FUNCTION NAME';\n   var\n      _TEST : function(const Data : PChar; Apply : PInteger;stOutput : Pchar;\n          iSize : PInteger) : integer; stdcall;\n   .....\n   .....\n   var\n     stInput,stOutput : string;\n     iLength,i1,iResult : integer;\n     hnd : THandle;\n   begin\n     iLength := 0;\n     i1 := 0;\n     stInput := Trim(edtInput.Text);\n     hnd := SafeLoadLibrary(EncoderDLL);\n     if hnd &gt; 0 then\n     begin\n       @_TEST := GetProcAddress(hnd,FunctionName);\n       if @_TEST &lt;&gt; nil then\n       begin\n         iResult := _TEST(PChar(stInput),@i1,PChar(StOutput),@iLength); // ERROR\n       end;\n     end;\n     FreeLibrary(hnd);\n  end;\n</code></pre>\n\n<p>I am getting <strong>Access Violation</strong> in the line having 'ERROR' as comments.</p>\n\n<p>If I replace <strong>PChar</strong> in the function declaration with <strong>string</strong>, then the access violation does not come at the same line. It comes while freeing the library. Also, the value of the iLength parameter is populated correctly.</p>\n\n<p>Can anyone please provide pointers to resolve this issue. </p>\n"},{"tags":["c#","c++","windows","winapi","getsystemmetrics"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":12744117,"title":"Get drop shadow dimensions of window","body":"<p>I need to know the drop shadow dimensions of a window. I tried receiving values via the GetSystemMetrics WinAPI function, but I could not find the parameter to pass over.\nAny idea on how I can get this value globally (or for a single window handle)? I know that the width of a drop shadow depends on the window type (dialog/normal/and so on).\nIbwould implement this functionality using C#, but C++ would also be fine.</p>\n"},{"tags":["c++","winapi","linker","pragma","common-controls"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12742725,"title":"Can/Should C++ #pragma Preprocessors Reside In Functions","body":"<p>In short, I am wanting to make a function that embeds the visual styles manifest and links to <code>ComCtl32.lib</code>, version 6 if available. Here is basically what I am hoping to do:</p>\n\n<pre><code>void InitVivify() {\n    // Embed visual style XML manifest\n    #pragma comment(linker,                           \\\n        \"\\\"/manifestdependency:type='Win32'\"          \\\n        \"   name='Microsoft.Windows.Common-Controls'\" \\\n        \"   version='6.0.0.0'\"                        \\\n        \"   processorArchitecture='*'\"                \\\n        \"   publicKeyToken='6595b64144ccf1df'\"        \\\n        \"   language='*'\\\"\"                           \\\n    )\n\n    // Link common controls library\n    #pragma comment(lib, \"ComCtl32.lib\")\n\n    // Initialize controls used\n    INITCOMMONCONTROLSEX InitCtrlEx;\n    InitCtrlEx.dwSize = sizeof(INITCOMMONCONTROLSEX);\n    InitCtrlEx.dwICC = ICC_LISTVIEW_CLASSES | ICC_TAB_CLASSES | ICC_USEREX_CLASSES;\n    InitCommonControlsEx(&amp;InitCtrlEx);\n}\n</code></pre>\n\n<p>I realize this probably isn't good practice, but is it valid? </p>\n"},{"tags":["c#","winapi","microsoft-ui-automation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12730474,"title":"How to convert AutomationElement.NativeWindowHandle to IntPtr","body":"<p>I have an <code>AutomationElement A</code> (MS UI Automation), which represents a combo box. I want to select n-th item in that combo box using Windows API call</p>\n\n<pre><code>IntPtr ComboBox_SetCurSel(IntPtr hWnd, int index)\n</code></pre>\n\n<p><code>A.NativeWindowHandle</code> contains the handle of the combo box, but in order to pass it to <code>ComboBox_SetCurSel</code>, I need to convert it from <code>int</code> to <code>IntPtr</code>.</p>\n\n<p>How?</p>\n"},{"tags":["c++","windows","winapi","mfc","registry"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":127,"score":3,"question_id":12580418,"title":"RegOpenKeyEx returning Error 87 aka \"INVALID_PARAMETER\"","body":"<p>I am implementing a recursive registry delete using RegOpenKeyEx, RegDeleteKey and RegEnumKey.</p>\n\n<p><strong>Problem::</strong> Though the code works perfectly fine for Vista x86/x64 and Win 7 x86/x64 but fails on XP for some keys in HKCR</p>\n\n<p><strong>Problem Area::</strong> HKCR\\Installer\\Products\\SomeKey</p>\n\n<p><strong>Error Code::</strong> 87 (INVALID_PARAMETER)</p>\n\n<p><strong>Weird Behaviour::</strong> Deletes the key the moment I open the key using REGEDIT.</p>\n\n<p><strong>Code::</strong></p>\n\n<pre><code>static BOOL RcrsvRegDel( HKEY hKey, LPTSTR lpszSub )\n{\nBOOL    bRet = TRUE ;\nLONG    lRet ;\nDWORD   dwSize = MAX_PATH ;\nTCHAR   szName[MAX_PATH] ;\nTCHAR   szFullKey[MAX_PATH * 2] ;\nHKEY    hKeySub = NULL ;\nHRESULT hr = NULL ;\n\ndo{\n    lRet = RegOpenKeyEx( hKey, lpszSub, 0, KEY_ENUMERATE_SUB_KEYS | DELETE, &amp;hKeySub ) ;\n    printf(\"RegOpenKey:: %S :: lRet = %ld\\n\", lpszSub, lRet) ;\n    if( lRet != ERROR_SUCCESS )\n    {\n        if( lRet == ERROR_FILE_NOT_FOUND )\n        {\n            bRet = TRUE ;\n            break ;\n        }\n        else\n        {\n            bRet = FALSE ;\n            break ;\n        }\n    }\n\n    while( ERROR_NO_MORE_ITEMS != (lRet = RegEnumKeyEx(hKeySub, 0, szName, &amp;dwSize, NULL, NULL, NULL, NULL)) )\n    {\n        bRet = RcrsvRegDel( hKeySub, szName) ;\n        if( bRet == FALSE )\n            break ;\n    }\n\n    if( hKeySub != NULL )\n    {\n        RegCloseKey(hKeySub) ;\n        hKeySub = NULL ;\n    }\n\n    lRet = RegDeleteKey( hKey, lpszSub ) ;\n    printf(\"RegDelKey:: %S :: lRet = %ld\\n\", lpszSub, lRet) ;\n    if( lRet == ERROR_SUCCESS )\n    {\n        bRet = TRUE ;\n        break ;\n    }\n}while(0) ;\nreturn bRet ;\n}\n</code></pre>\n\n<p>Any idea whats goin on?</p>\n\n<p><strong>UPDATE::</strong></p>\n\n<p>I have also tried the samDesired Parameter with following flags</p>\n\n<p>-KEY_READ</p>\n\n<p>-KEY_READ | KEY_WRITE</p>\n\n<p>-KEY_ENUMERATE_SUB_KEYS</p>\n\n<p>-KEY_ENUMERATE_SUB_KEYS | DELETE</p>\n\n<p>Neither of the above flag works :-(</p>\n"},{"tags":["winapi","memory-management","dll","pe","entry-point"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12722597,"title":"Merge DLL to PE (Patching)","body":"<p>I have an executable that needs a dll file for dependencies. I wonder if it's possible to actually patch a PE file that needs the dll that would read the entry point from a pointer which is located either in memory or in a resource. If this would be possible how can I do it?</p>\n\n<p>Thanks for your help :)</p>\n"},{"tags":["c#","winapi","click","mouse"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":135,"score":0,"question_id":12735569,"title":"How to simulate mouse click in c# , which will work in games?","body":"<p>When i play Age of empires or and other strategy game i often need to sell some resource 100 times and then by another.\nIt's annoying :(</p>\n\n<p>I wrote a program which helps me by clicking the mouse using : </p>\n\n<pre><code>//This is the decleration\n[DllImport(\"user32.dll\",CharSet=CharSet.Auto, CallingConvention=CallingConvention.StdCall)]\npublic static extern void mouse_event(long dwFlags, long dx, long dy, long cButtons, long dwExtraInfo);\n\nprivate void ClickTheMouse()\n{\n      int X = Cursor.Position.X;\n      int Y = Cursor.Position.Y;\n      mouse_event(MOUSEEVENTF_LEFTDOWN | MOUSEEVENTF_LEFTUP, X, Y, 0, 0);\n}\n</code></pre>\n\n<p>and then by using a timer and the code above i can click 30 times.</p>\n\n<p>It all works great in and window in windows (word, Firefox, etc..) and even in Age of empires, But unfortunately it doesn't work in \"Stronghold crusader\" and some other games i don't remember their names.</p>\n\n<p>I assume this happens because the click simulated in high level, and if it will be simulated closer to driver level it will work.</p>\n\n<p>I have 2 questions : </p>\n\n<ol>\n<li>is my assumption right? </li>\n<li>how can i simulate mouse click in a lower level which will work in this game?</li>\n</ol>\n\n<p>I use c# , but any c++ code will help also (i'll just use PInvoke).</p>\n\n<p>Thanks, </p>\n"}]}
{"total":13828,"page":8,"pagesize":100,"questions":[{"tags":["c++","windows","winapi","sessionid","processid"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":141,"score":0,"question_id":12718578,"title":"Get the logon session of a user in c++","body":"<p>I want to get a handle on the current logon session of processes whose parent is explorer.exe. If we run a process as administrator or a service it wont have a logon session. The reason I want to get the logon session is that I have a program(.exe) which I want to restrict opening when a user tries to open it via (right click on the .exe--> run as administrator)and When a user opens it via administrator we dont have a logon session associated with it whereas when a user opens it by double clicking on it, it has a logon session associated with it. I searched quite some places but i just get the process for getting the logon SID. If someone wants more info, you can download <a href=\"http://technet.microsoft.com/en-us/sysinternals/bb896653\" rel=\"nofollow\">http://technet.microsoft.com/en-us/sysinternals/bb896653</a> and under the explorer-->right click on any program executing-->security. here you will find the logon session.</p>\n"},{"tags":["c","windows","winapi","process","command-line-arguments"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12718085,"title":"how to access UNICODE_STRING CommandLine variable?","body":"<p>I found out that the command line arguments for a program run in windows are stored in Process Environment block.I found out more that inside PEB there is a structure called RTL_USER_PROCESS_PARAMETERS , which holds a member variable named UNICODE_STRING CommandLine;\ncan i access this variable by writing a c code ? please assist \nFor more information about PEB refer this link \n<a href=\"http://msdn.microsoft.com/en-us/library/aa813706%28VS.85%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/aa813706%28VS.85%29.aspx</a></p>\n"},{"tags":["c++","windows","winapi","explorer","windows-shell"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":145,"score":3,"question_id":10421990,"title":"Why do I not receive the WM_MENUCHAR message?","body":"<p>I implemented an <code>IContextMenu3</code> interface and I am trying to capture keystrokes for my own custom accelerator. The problem is that if i hover over my submenu in the root menu I dont get any <code>WM_MENUCHAR</code> messages whereas if I hover over a submenu that is inside one of my submenu's then I do. </p>\n\n<p>I know that the <code>WM_INITMENUPOPUP</code> message only gets sent if there is a child. The <code>WM_MENUCHAR</code>has the caveat that no accelerators are bound to the key. I know this caveat to be held since when I press a key, I get the distinctive 'no-accelerator' beep.</p>\n\n<p>Is there another caveat that I am not aware of?</p>\n\n<p>This is the smallest code I can get that reproduces the problem:</p>\n\n<pre><code>\nHRESULT CFolderViewImplContextMenu::QueryContextMenu(HMENU hmenu, UINT uMenuIndex, UINT idCmdFirst, UINT idCmdLast, UINT /* uFlags */)\n{\nUINT uID = idCmdFirst;\nHMENU hSubmenu = CreatePopupMenu();\n\nMENUITEMINFO mii = { 0 };\nmii.cbSize = sizeof(MENUITEMINFO);\nmii.fMask = MIIM_SUBMENU | MIIM_ID | MIIM_STRING;\nmii.dwTypeData = str_toWchar(\"test\");\nmii.wID = uID++;\nmii.hSubMenu = hSubmenu;    \n\nInsertMenuItem ( hmenu, 0, TRUE, &mii );\nInsertMenu ( hSubmenu, 0, MF_BYPOSITION, uID++, L\"&Notepad\" );\nInsertMenu ( hSubmenu, 1, MF_BYPOSITION , uID++, L\"&Internet Explorer\" );\n\nHMENU hSubmenu2 = CreatePopupMenu();\nMENUITEMINFO mii2 = {0};\nmii2.cbSize = sizeof(MENUITEMINFO);\n\nmii2.fMask  = MIIM_ID | MIIM_TYPE | MIIM_SUBMENU;\nmii2.fType  = MFT_OWNERDRAW;\nmii2.wID    = uID++;\nmii2.hSubMenu = hSubmenu2;\nInsertMenuItem ( hSubmenu, 0, TRUE, &mii2 );\n\nInsertMenuA ( hSubmenu2, 0, MF_BYPOSITION, uID++, \"\");\n\nreturn MAKE_HRESULT ( SEVERITY_SUCCESS, FACILITY_NULL, uID - idCmdFirst );\n}\n</code></pre>\n"},{"tags":["winapi","operating-system","version","platform","visualstyles"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12732267,"title":"Win32 Visual Styles backwards compatibility?","body":"<p>When I embed the Visual Styles manifest in my program like this:</p>\n\n<pre><code>// Embed visual style XML manifest\n#pragma comment(linker,                           \\\n    \"\\\"/manifestdependency:type='Win32'\"          \\\n    \"   name='Microsoft.Windows.Common-Controls'\" \\\n    \"   version='6.0.0.0'\"                        \\\n    \"   processorArchitecture='*'\"                \\\n    \"   publicKeyToken='6595b64144ccf1df'\"        \\\n    \"   language='*'\\\"\"                           \\\n)\n\n// Link common controls library\n#pragma comment(lib, \"ComCtl32.lib\")\n</code></pre>\n\n<p>Does that mean my program will only run on Windows XP? Or if visual styles are not on the computer will they just use the operating systems default style? I ask because I enabled visual styles in my program that I am developing with Visual Studio 2008 and I want to know what is the earliest version of Windows it can be run on. Should I check <code>WINVER</code> to see if they are running a version that supports visual styles? If so, what version number should I check for in the preprocessor. Another thing I would like to know is, without visual styles, what is the lowest version I can run my program on?</p>\n"},{"tags":["c++","winapi","mfc","odbc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12714310,"title":"CRecordset::snapshot doesn't work in VS2012 anymore - what's the alternative?","body":"<p>Apparently, in VS2012, SQL_CUR_USE_ODBC is deprecated.  [Update: it appears that the cursors library has been removed from VS2012 entirely].</p>\n\n<p>MFC's CDatabase doesn't use it anymore (whereas it was the default for VS2010 and earlier versions of MFC), but instead uses SQL_CUR_USE_DRIVER.</p>\n\n<p>Unfortunately, SQL_CUR_USE_DRIVER doesn't work properly with the Jet ODBC driver (we're interacting with an Access database).  The driver initially claims to support positional operations (but not positional updates), but when an attempt is made to actually query the database, all concurrency models fail until the MFC library drops down to read-only interaction with the database (which is not going to fly for us).</p>\n\n<p>Questions</p>\n\n<ul>\n<li>Is this MS's latest attempt to force devs to move away from Jet based datasources and migrate to SQL Express (or the like)?  </li>\n<li>Is there another modality that we should be using to interact with our Access databases through VS 2012 versions of MFC/ODBC?(1)</li>\n</ul>\n\n<p>See also:\n<a href=\"http://social.msdn.microsoft.com/Forums/kk/vcmfcatl/thread/acd84294-c2b5-4016-b4d9-8953f337f30c\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/kk/vcmfcatl/thread/acd84294-c2b5-4016-b4d9-8953f337f30c</a></p>\n\n<hr>\n\n<p>Update:  Looking at the various options, it seems that the cursor library has been removed from VS2012's ODBC library.  Combined with the fact that Jet doesn't correctly support positional updates(2), it makes \"snapshot\" mode unusable.  It does appear to support \"dynaset\" as long as the underlying tables have a primary key.  Unkeyed tables are incompatible with \"dynaset\" mode(3).  So - I can stick with VS 2010, or I can change my tables to include an autonumber or something similar in order to ensure a pkey is available so I can use dynaset mode for the recordsets.</p>\n\n<hr>\n\n<p>(1)  e.g. should we be using a different open type for CRecordset?  We currently use CRecordset::snapshot.  But I've never really understood the various modes snapshot, dynamic, dynaset.  A quick set of \"try each\" has failed to get a working updatable interface to our access database...<br>\n(2) it claims to when queried initially, but then returns errors for all concurrency modes that it previously claimed to support<br>\n(3)  \"dynamic\" is also out, since Jet doesn't support it at all (from what I can tell from my tests).</p>\n"},{"tags":["c++","windows","winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":69,"score":4,"question_id":12730425,"title":"Get current Location Value under Regional language setting in c++","body":"<p>Want to extract country name from the control panel->region and language->location current location value</p>\n\n<p>i have tried following function of win32 \nGetLocaleInfo(returns culture)\nGetSystemDefaultLCID (returns language).\nAlso looked at the GetGeoInfo</p>\n\n<p>but not able to extract the country name.\nI hope i am clear with my question </p>\n"},{"tags":["python","command-line","winapi","windows-7","redirect"],"answer_count":3,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":1899,"score":5,"question_id":3018848,"title":"Cannot redirect output when I run Python script on Windows using just script's name","body":"<p>This is running on Windows 7 (64 bit), Python 2.6 with Win32 Extensions for Python.</p>\n\n<p>I have a simple script that just print \"hello world\". I can launch it with <code>python hello.py</code>. In this case I can redirect the output to a file. But if I run it by just typing <code>hello.py</code> on the command line and redirect the output, I get an exception.</p>\n\n<pre><code>C:&gt; python hello.py\nhello world\n\nC:&gt; python hello.py &gt;output\n\nC:&gt; type output\nhello world\n\nC:&gt; hello.py\nhello world\n\nC:&gt; hello.py &gt;output\nclose failed in file object destructor:\nError in sys.excepthook:\n\nOriginal exception was:\n</code></pre>\n\n<p>I think I first get this error after upgrading to Windows 7. I remember it should work in XP. I have seen people talking about this bug <a href=\"http://mail.python.org/pipermail/python-bugs-list/2004-August/024920.html\" rel=\"nofollow\">python-Bugs-1012692 | Can't pipe input to a python program</a>. But that was long time ago. And it does not mention any solution.</p>\n\n<p>Have anyone experienced this? Anyone can help?</p>\n"},{"tags":["windows","winapi","x64","barcode","barcode-scanner"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":186,"score":3,"question_id":12497105,"title":"Reading USB HID barcode scanner input without knowing VID&PID","body":"<p>I'm trying to develop device independent library for barcode scanners, it has to be working in windows environment. </p>\n\n<p>I've done some research in this field, afaik most of the solutions of this problem are depending on specific device VID&amp;PID (RawInput @ filter by vid&amp;pid string), in my situation this is inacceptable, because i'm trying to develop a device independent solution, which will be working with any USB-barcode scanner. </p>\n\n<p>Actually this thing is quite challenging, for me atleast, here are exact requiriments. Also i can't ask user to hot-plug device (in that case i could've just detect plugged device and extract it vid/pid). Also i can't use VID&amp;PID database of devices. In general i can't use vid&amp;pid at all actually. </p>\n\n<p>Also i can't in any way reprogramm barcode scanner, unless it's done from my programm (maybe i can send some barcodescanner-specific IOCTLs which will make it answer to me?).</p>\n\n<p>Currently i'm going to use solution proposed in this question: \n<a href=\"http://stackoverflow.com/questions/615036/reading-a-barcode-using-a-usb-barcode-scanner-along-with-ignoring-keyboard-data\">Reading a barcode using a USB barcode scanner along with ignoring keyboard data input while scanner product id and vendor id are not known</a></p>\n\n<p>Also i have seen commercial library (which is offcourse comes without any sources and any info about how it's implemented, but considering they have'd some word \"Perfomance counter\" in their changelogs, i guess they used solution in the link above), which implements this functionality, but it doesn't work in x64 systems. Probably either because of messy code or beacause it probably uses some kind of filter (mini) driver. It's crypted and i can't redistribute it. </p>\n\n<p><strong>My exact question is:</strong> \nIs there any way to determine that this HID keyboard is in fact not a keyboard, but a barcode scanner? I've seen on Win 7 x64 that it connects as Barcode scanner, not keyboard (this was a system bug, or sort of). </p>\n\n<p>Exactly what i'm doing now: </p>\n\n<ol>\n<li>Reading input by RID_INPUTSINK.</li>\n<li>Distinguishing all input by vid&amp;pid of device</li>\n<li>Putting all input to separate buffers and collecting barcodes from buffer when VK_ENTER shows on buffer.</li>\n</ol>\n\n<p>What i'm currently going to do: </p>\n\n<ol>\n<li>Read input by RID_INPUTSINK</li>\n<li>Start timer for specific device and if next symbol is VK_ENTER - stop timer</li>\n<li>If timer exceeds 50 ms limit - off it and drop all further device input. </li>\n<li>If device will successfully read sequence of characters from first symbol to VK_ENTER - extract device VID&amp;PID/handle and work with it in more convenient way (without timering). </li>\n</ol>\n\n<p>I'm developng it on C++, pure WinAPI, it will be a DLL library, and got to work in Windows XP, Vista, 7, 8 on x32-86 and x32-64 architectures. </p>\n\n<p><strong>UPDATE 0:</strong>\nJust found that barcode scanner have their own usagePage and usage in USB specs:\n<a href=\"http://www.usb.org/developers/devclass_docs/pos1_02.pdf\" rel=\"nofollow\">http://www.usb.org/developers/devclass_docs/pos1_02.pdf</a></p>\n\n<p>According to this document USB Barcode scanner have UsagePage 0x8C and Usage 0x02. Unfortunately i've failed using it as RAWINPUTDEVICE.dwUsage and RAWINPUTDEVICE.dwUsagePage. Probably because system install it's usb keyboard driver on top of it and in user mode it is indistinguishable from real usb keyboard. Probably those values are usable in kernelmode environment (one of the options is to develop hid filter driver).</p>\n"},{"tags":["c++","windows","winapi","overlapped-io"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12717388,"title":"using overlapped I/O conflicts with c++ D'tor","body":"<p>I'm writing a single-client (for now) server that has a main loop that interpert client request , and dispatces a proper handler.</p>\n\n<p>for some taks, I'll like to use MS overlapped I/O (it's for windows only) .\nin one of them, I want to read from a file and write the content to a socket.\nas I have class wrape for that action, it's allocates a buffer, the size of the file, and then a call to  ReadFile (with an actual file-system file) is made, followed by a WriteFile (this time, to a socket handle) both beeing made overlapped.</p>\n\n<p>problem is: \nas it's async', the class d'tor is beeing called automatically, and the file's buffer get's freed, before the job is done,</p>\n\n<p>obviously, that is a broken design of mine,\nI really like to hear for a suggestion of your's,</p>\n\n<p>thanks!</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12723399,"title":"Windows Device properties documentation?","body":"<p>in windows if you go\nDeviceManager -> Select Device(Like a a keyboard) -> Go to details -> List of properties:</p>\n\n<pre><code>Device description\nHardware Ids\nCompatible Ids\nDevice class\nDevice class guid\nDriver key\nConfigFlags\n... etc\n</code></pre>\n\n<p>Where can I find what each of these properties mean?</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":25,"score":2,"question_id":12724031,"title":"Identify device across different computers","body":"<p>I read here:</p>\n\n<p><a href=\"https://kc.mcafee.com/corporate/index?page=content&amp;id=KB53715&amp;cat=CORP_DATA_LOSS_PREVENTION_HOST&amp;actp=LIST\" rel=\"nofollow\">https://kc.mcafee.com/corporate/index?page=content&amp;id=KB53715&amp;cat=CORP_DATA_LOSS_PREVENTION_HOST&amp;actp=LIST</a></p>\n\n<p>that the HID, PID, VID and the GUID are embedded in the hardware of the device.</p>\n\n<p>so does the following make sense:</p>\n\n<ol>\n<li>I take a USB keyboard, plug it into my computer.</li>\n<li>I read out the HID, PID, VID and the GUID of the device, and save it somewhere.</li>\n<li>I send this HID, PID, VID and the GUID to my friends computer.</li>\n<li>My friend plugs in a USB keyboard.</li>\n<li>If the HID, PID, VID and the GUID match, then we have the same type of keyboard, it could even be the same keyboard, if it does not match, then we do not have the keyboard type.</li>\n</ol>\n\n<p>I'm asking this because I want to differentiate between different keyboards across different computers, is this the right way to do it?</p>\n"},{"tags":["winapi","advapi32"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":1477,"score":2,"question_id":1290782,"title":"Where can I find a good example of ReportEvent function usage?","body":"<p>As with most \"legacy\" MSDN pages, the page for <a href=\"http://msdn.microsoft.com/en-us/library/aa363679%28VS.85%29.aspx\" rel=\"nofollow\">ReportEvent</a> has too little information for me to make much sense of it. I've tried searching, but can't find a good, clean, simple example of the function's usage. Could anyone suggest one?</p>\n"},{"tags":["c++","winapi","visual-c++","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12722581,"title":"mfc sdi application cdocument dosave error 0xFEEEFEEE","body":"<p>in my MFC SDI application, i'm trying to override CDocument::DoSave to save my document. I'm using a third part component (TxTextControl) to build a text control. When i save the document, the file is created, but after about one minute my app crashes rising read access error 0xFEEEFEEE, in ole32.dll.\nThis is my code, txtCtrl is my component:</p>\n\n<pre><code>BOOL CEditorTxDoc::DoSave(LPCTSTR lpszPathName, BOOL bReplace)\n{\nCString path, nome;\nVARIANT vt1, vt2, vt3;\nPOSITION pos = GetFirstViewPosition();\nCEditorTxView *pView = (CEditorTxView*)this-&gt;GetNextView(pos);\n\nVariantInit(&amp;vt1);\nvt1.vt = VT_INT;\nvt1.intVal = -1;\nVariantInit(&amp;vt2);\nvt2.vt = VT_INT;\nvt2.intVal = 3;\nVariantInit(&amp;vt3);\nvt3.vt = VT_BOOL;\nvt3.boolVal = FALSE;\n\nif (lpszPathName == NULL) {\n    CFileDialog fSaveDlg(FALSE);\n\n    fSaveDlg.m_pOFN-&gt;lpstrFilter = _T(\"File Tx (*.tx)\");\n    fSaveDlg.m_pOFN-&gt;lpstrDefExt = _T(\"tx\");\n    fSaveDlg.m_pOFN-&gt;lpstrTitle = _T(\"Salva documento\");\n    fSaveDlg.m_pOFN-&gt;lpstrInitialDir = _T(\"c:\");\n\n    if(fSaveDlg.DoModal()==IDOK)\n    {\n        path = fSaveDlg.GetPathName();\n        nome = fSaveDlg.GetFileName();\n\n        pView-&gt;txtCtrl.Save(path, vt1, vt2, vt3);\n        SetTitle(nome);\n        SetModifiedFlag(FALSE);\n        SetPathName(path);\n    }\n} else {\n        pView-&gt;txtCtrl.Save(GetPathName(), vt1, vt2, vt3);\n        SetModifiedFlag(FALSE);\n}\n\nreturn TRUE;\n}\n</code></pre>\n"},{"tags":["c++","winapi","sockets","udp","winsock"],"answer_count":4,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":16584,"score":5,"question_id":679145,"title":"How to set up a Winsock UDP socket?","body":"<p>I want to create a Winsock UDP socket that only sends data to a client. I want the kernel to choose an available port for me. On the other hand, I want to indicate which local IP to use, since I'm running a few nics. </p>\n\n<p>I've tried combing through the maze of socket options, as well as binding with the port in the socket address set to 0 to no avail. </p>\n\n<p>My code is in Win32 C++.</p>\n"},{"tags":["c++","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12718399,"title":"CreateFileMapping() returning \"already exists\" even after reboot; how to remove old Named Shared Memory?","body":"<p>I have a series of Slave exe's controlled by a Master exe via usage of Named Shared Memory created with CreateFileMapping() and MapViewOfFile(). </p>\n\n<p>I was debugging the Master via Visual Studio, and when I got what I needed I simply told Visual Studio to \"stop debugging\". Bad move, because that Named Shared Memory was left active, and it is still there after reboots!</p>\n\n<p>I've tried recognizing the Named Shared Memory via looking at the error code, seeing it was 183 (already exists) and asking for the existing Named Shared Memory, but that fails. </p>\n\n<p>I'd be happy either way: remove/delete it when found to already exist, or reuse it when found to already exist. Currently, I'm stuck. I guess I could create a different name, but that damn one that already exists will probably just linger there forever...</p>\n\n<p>Anyway, here's the C++ class defining my Named Shared Memory control logic:</p>\n\n<pre><code>enum ServerSharedMemReturnCodes {\n    Success,                    // everything worked!\n    SharedMemAlreadyGrabbed,    // EnableSharedMemoryAccess() error: _mapFile was not NULL!\n    OpenFileMappingFailed,      // EnableSharedMemoryAccess() error: OpenFileMapping() filed!\n    MapViewOfFileFailed         // EnableSharedMemoryAccess() error: MapViewOfFile() filed!\n};\n\nclass ServerSharedMem {\npublic:\n    ServerSharedMem() {\n        _mapFile         = NULL;\n        _serverCommLinks = NULL;\n    }\n    ~ServerSharedMem() {\n        // Deactivate(); called explicitly at shutdown rather than here\n    }\n\n    /* our Named Shared Memory needs to be \"activated\" by the Master (installed to shared virtual memory). This does that. */\n    inline int Activate( void ) {\n        char *caller = \"ServerSharedMem::Activate\";\n\n        if (_mapFile != NULL) {\n            DebugMessage( caller, \"Named Shared Memory already activated!\" );\n            return false;\n        }\n\n        TCHAR smName[]      = TEXT(CEX_SHAREDMEM_NAME);\n        int   sharedMemSize = sizeof(ServerCommLink) * CEX_MAX_SERVER_COUNT;\n\n        // debug logic: print out size and name:\n        size_t convertedChars = 0;\n        char   bsjnk[1024];\n        errno_t err = wcstombs_s( &amp;convertedChars, bsjnk, 1024, smName, sizeof(smName));\n        if (err != 0) {\n            DebugMessage( caller, \"wcstombs_s  failed!\" );\n        } \n        char bsjnk2[1024];\n        sprintf_s( bsjnk2, 1024, \"sharedMemSize is '%d' bytes and smName is '%s'\", sharedMemSize, bsjnk );\n        DebugMessage( caller, bsjnk2 ); // size is 16832, name is \"Global\\CEX_ActiveTasks\"\n\n\n        // let's create a Named Shared Memory block:\n        _mapFile = CreateFileMapping( INVALID_HANDLE_VALUE,   // request a paging file\n                                      NULL,                   // default security\n                                      PAGE_READWRITE | SEC_COMMIT, // read/write access and hold entirely in RAM\n                                      0,                      // high-order DWORD of max file size\n                                      sharedMemSize,          // low-order DWORD of max file size\n                                      smName );               // name of our named shared memory\n        if (_mapFile == NULL) {\n            DebugMessage( caller, \"failed to create Named Shared Memory!\" );\n\n            DWORD errCode = GetLastError();\n            if (errCode == 183) { // already exists! we did not shutdown cleanly\n               DebugMessage( caller, \"It appears to already exist! Attempting to grab it!\" );\n               ServerSharedMemReturnCodes retCode = EnableSharedMemoryAccess();\n               if (retCode == Success) {\n                  DebugMessage( caller, \"Yes! Got it!\" );\n                  for (int i = 0; i &lt; CEX_MAX_SERVER_COUNT; i++) {\n                      _serverCommLinks[i].Init();\n                      _serverCommLinks[i].SetServerId( i );\n                  }\n                  return true;\n               }\n               static CHAR errBuffer[CEX_CMDBUFFER_SIZE];\n                va_list     errArgs[256];\n                FormatMessageA(FORMAT_MESSAGE_FROM_SYSTEM,NULL,errCode,0,errBuffer,CEX_CMDBUFFER_SIZE,errArgs);\n                DebugMessage( caller, errBuffer );\n                sprintf_s( errBuffer, CEX_CMDBUFFER_SIZE, \"error code is '%d'\", errCode );\n                DebugMessage( caller, errBuffer ); // still 183, already exists\n            }\n            /*\n            static CHAR errBuffer[CEX_CMDBUFFER_SIZE];\n            va_list     errArgs[256];\n            FormatMessageA(FORMAT_MESSAGE_FROM_SYSTEM,NULL,errCode,0,errBuffer,CEX_CMDBUFFER_SIZE,errArgs);\n            DebugMessage( caller, errBuffer );\n            sprintf_s( errBuffer, CEX_CMDBUFFER_SIZE, \"error code is '%d'\", errCode );\n            DebugMessage( caller, errBuffer ); */\n            return false;\n        }\n        else {\n            _serverCommLinks = (ServerCommLink *)MapViewOfFile(_mapFile, FILE_MAP_READ | FILE_MAP_WRITE, 0, 0, 0);\n            if (_serverCommLinks == NULL) {\n                CloseHandle(_mapFile);\n                _mapFile = NULL;\n                DebugMessage( caller, \"MapViewOfFile() failed!\" );\n                return false;\n            }\n            else {\n                for (int i = 0; i &lt; CEX_MAX_SERVER_COUNT; i++) {\n                    _serverCommLinks[i].Init();\n                    _serverCommLinks[i].SetServerId( i );\n                }\n                return true;\n            }\n        }\n    }\n\n    /* upon program shutdown, Named Shared Memory needs to be removed from Shared Virtual Memory. This does that. */\n    inline void Deactivate( void ) {\n        char *caller = \"ServerSharedMem::Deactivate\";\n        if (_mapFile) {\n            if (_serverCommLinks) {\n                UnmapViewOfFile( _serverCommLinks );\n                _serverCommLinks = NULL;\n                DebugMessage( caller, \"Unmapped Named Shared Memory view.\" );\n            }\n            CloseHandle(_mapFile);\n            _mapFile = NULL;\n            DebugMessage( caller, \"Closed Named Shared Memory handle.\" );\n        }\n    }\n\n    /* Slaves use this to gain access to the Named Shared Memory setup by their Master */\n    inline ServerSharedMemReturnCodes EnableSharedMemoryAccess( void ) {\n        if (_mapFile != NULL) {\n            return SharedMemAlreadyGrabbed;\n        }\n        TCHAR smName[] = TEXT(CEX_SHAREDMEM_NAME);\n        _mapFile = OpenFileMapping( FILE_MAP_READ | FILE_MAP_WRITE, FALSE, smName );\n        if (_mapFile == NULL) {\n            return OpenFileMappingFailed;\n        }\n        else {\n            _serverCommLinks = (ServerCommLink *)MapViewOfFile( _mapFile, FILE_MAP_READ | FILE_MAP_WRITE, 0, 0, 0 );\n            return Success;\n        }\n    }\n\n    /* Slaves use this to release their hold on their view of the Named Shared Memory */\n    inline void ReleaseSharedMemoryAccess( void ) {\n        char *caller = \"ServerSharedMem::ReleaseSharedMemoryAccess\";\n        if (_mapFile != NULL) {\n            if (_serverCommLinks != NULL) {\n                UnmapViewOfFile( _serverCommLinks );\n                _serverCommLinks = NULL;\n                DebugMessage( caller, \"Unmapped Named Shared Memory view.\" );\n            }\n            else DebugMessage( caller, \"No active Named Shared Memory view!\" );\n            CloseHandle(_mapFile);\n            DebugMessage( caller, \"Closed Named Shared Memory handle.\" );\n        }\n        else DebugMessage( caller, \"No Named Shared Memory!\" );\n    }\n\n    /* pass in a return code, get back a string describing the code */\n    inline char *ReturnCodeInfo( ServerSharedMemReturnCodes code ) {\n        switch (code) {\n        case Success:                 return \"Success.\";\n        case SharedMemAlreadyGrabbed: return \"Shared memory access has already been enabled.\";\n        case OpenFileMappingFailed:   return \"Unable to open Named Shared Memory!\";\n        case MapViewOfFileFailed:     return \"Unable to map view of Named Shared Memory!\";\n        default:                      return \"Unknown return code!!!\";\n        }\n    }\n\n    inline int Active( void ) { return(_serverCommLinks ? true : false); }\n\n    /* returns the requested server;s communication link if Named Shared Memory is activated/enabled */\n    inline ServerCommLink *GetServerCommLink( int serverId ) {\n        if (!_serverCommLinks)\n            return NULL;\n        if ((serverId &gt;= 0) &amp;&amp; (serverId &lt; CEX_MAX_SERVER_COUNT)) {\n            return &amp;_serverCommLinks[serverId];\n        }\n        return NULL;\n    }\n\nprivate:\n    HANDLE         _mapFile;           // our Named Shared Memory handle\n    ServerCommLink *_serverCommLinks;  // will point to shared memory, an array of size CEX_MAX_SERVER_COUNT\n};\n</code></pre>\n"},{"tags":["c","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12717899,"title":"Code interpretation","body":"<p>I have difficulty understanding this <a href=\"http://ideone.com/pkhGL\" rel=\"nofollow\">piece of code</a>: </p>\n\n<p>Particularly this part:</p>\n\n<pre><code>     // check that the stuff we wrote has not changed\n     if(n[k][0]!=(unsigned char)(n[k]+s[k]+k))\n        printf(\"Error when checking first byte!\\n\");\n     if(s[k]&gt;1 &amp;&amp; n[k][s[k]-1]!=(unsigned char)(n[k]-s[k]-k))\n        printf(\"Error when checking last byte!\\n\");\n</code></pre>\n\n<p>The whole program tries to mimic the Windows' <code>malloc</code> and <code>free</code> function.\nIt must be run on Windows.</p>\n\n<p>Anyone can explain how those 2 ifs work?</p>\n\n<p>Thanks.</p>\n"},{"tags":["c++","winapi","locale"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":2,"question_id":12715646,"title":"How to use FormatMessage c++ for getting english only messages","body":"<p>I am trying to use format message to obtain English only values</p>\n\n<p>MSDN specifies the following </p>\n\n<pre><code>DWORD WINAPI FormatMessage(\n  _In_      DWORD dwFlags,\n  _In_opt_  LPCVOID lpSource,\n  _In_      DWORD dwMessageId,\n  _In_      DWORD dwLanguageId,\n  _Out_     LPTSTR lpBuffer,\n  _In_      DWORD nSize,\n  _In_opt_  va_list *Arguments\n);\n</code></pre>\n\n<p>For dwLanguageId parameter,</p>\n\n<blockquote>\n  <p>The language identifier for the requested message. This parameter is ignored if dwFlags includes FORMAT_MESSAGE_FROM_STRING.</p>\n  \n  <p>If you pass a specific LANGID in this parameter, FormatMessage will return a message for that LANGID only. If the function cannot find a message for that LANGID, it sets Last-Error to ERROR_RESOURCE_LANG_NOT_FOUND. If you pass in zero, FormatMessage looks for a message for LANGIDs in the following order:</p>\n  \n  <ol>\n  <li>Language neutral</li>\n  <li>Thread LANGID, based on the thread's locale value</li>\n  <li>User default LANGID, based on the user's default locale value</li>\n  <li>System default LANGID, based on the system default locale value</li>\n  <li>US English</li>\n  </ol>\n  \n  <p>If FormatMessage does not locate a message for any of the preceding LANGIDs, it returns any language message string that is present. If that fails, it returns ERROR_RESOURCE_LANG_NOT_FOUND.</p>\n</blockquote>\n\n<p>Would this mean that, if is pass value 5, it will return messages in English? </p>\n\n<p>Can you please clarify this?</p>\n"},{"tags":["c++","winapi","design-patterns","concurrency","c++11"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12669148,"title":"How to make proper sequential async message processing in Windows?","body":"<p>I have an windows application that need's to very fast process all incoming messages, or it will cripple system performance pretty hard i suppose. What i've thinked about is an some way to spawn and join threads for each message so that they will be processed sequentially. But that approach have serious problem: when i spawn thread and trying to join top thread how can i know if it's available for join? Offcourse i can check if it's joinable (i use std::thread) but while i will be doing that it could just become non-joinable and thread isn't a mutex - i can't just block it and check again. So what i need is some kind of deffered task pool or task query that would be non-blocking, atleast for message thread. Again i can just spawn thread that will wait for that query and add the task so it can be processed, but is it really good solution? </p>\n\n<p>That wouldn't be necessarily something working from the box, i can implement any concurent pattern.</p>\n\n<p>inb4: \nWindows, WinAPI, C++11, std::thread for threading. \nSorry for my english, can't find time to improve it, really. </p>\n\n<p>Thank you for your answer, it seem's i did a mistake in problem descreption. Exactly i need only to let WNDPROC return it's result ASAP, so next message can be poped from message queue. I need this because i log time when message was sent, so i need it done fast so it won't affect that time measurement. Also those messages are afaik urgent for system and my window need to process them fast or it will somehow affect performance. </p>\n\n<p>Again: i need to somehow move exact message processing to other thread, right now it look like this:</p>\n\n<pre>\n<code>\ncase WM_INPUT:\n    int timestamp = PushTimeStampToAsyncTimestampQueue();\n    launchLongChainOfMessageProcessing(message,timestamp);\n    return 0;\n</code>\n</pre>\n\n<p>I need to get rid of that launchLongChainOfMessageProcessing and replace it with something like </p>\n\n<pre>\n<code>\ncase WM_INPUT:\n    int timestamp = PushTimeStampToAsyncTimestampQueue();\n    std::thread processThread([]() { do_work(message, timestamp);});\n    return 0;\n</code>\n</pre>\n"},{"tags":["c","windows","winapi","internet-explorer","memory"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":202,"score":4,"question_id":3861702,"title":"Internet Explorer Address Space","body":"<p>Though i'm currently interested in internet explorer address space i wouldn't mind a general answer. The question is how can i calculate the address space ( and by address space a mean the minimum and maximum address in memory -correct me if i'm wrong- ) of a windows process.\n Actually is this space fixed or varied ? Also do i get to know the virtual or the physical address space , and if the one i get is the visual is it the mapping the same for every instance of the IE i open ?\n I do have a debugger ( ollydbg to be specific ) and i suppose i could get some information from it but i can't specify what and how. Please bear my lack of knowledge, thank you.</p>\n"},{"tags":["c++","winapi","cryptography","digital-signature"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12713715,"title":"Digital signature with CryptVerifySignature","body":"<p>I want to implement digital signature app using CryptVerifySignature. I've written this code(with help of MSDN example):</p>\n\n<pre><code>#define Check(condition, message) if (!(condition)) { fprintf(stderr, \"%s\\n\", message); goto Exit; };\nvoid DigSign(const char* inputFileName, const char* signFileName)\n{\n\n    HCRYPTPROV hProv;\n    BYTE *pbBuffer= NULL;\n    DWORD dwBufferLen = 0;\n    HCRYPTHASH hHash;\n    HCRYPTKEY hKey;\n    HCRYPTKEY hPubKey;\n    BYTE *pbKeyBlob;        \n    BYTE *pbSignature;\n    DWORD dwSigLen;\n    DWORD dwBlobLen;\n\n    FILE* inputFile = NULL;\n\n    Check((inputFile = fopen(inputFileName, \"r\")) != NULL, \"File does not exists\");\n    dwBufferLen = GetFileSize(inputFile);\n    Check(pbBuffer = (BYTE*)malloc(dwBufferLen + 1), \"cannot allocate memory\");\n\n    fread(pbBuffer, 1, dwBufferLen, inputFile);\n    pbBuffer[dwBufferLen] = '\\0';\n    fclose(inputFile);\n\n\n    //-------------------------------------------------------------------\n    // Acquire a cryptographic provider context handle.\n\n    Check(CryptAcquireContext(&amp;hProv, NULL, NULL, PROV_RSA_FULL, 0), \"Error during CryptAcquireContext.\");\n\n\n    if(!CryptGetUserKey(hProv, AT_SIGNATURE, &amp;hKey)) \n    {\n        if(NTE_NO_KEY == GetLastError())\n        {\n            Check(CryptGenKey(hProv, AT_SIGNATURE, CRYPT_EXPORTABLE, &amp;hKey), \"Could not create a user public key.\\n\");\n        }\n        else\n        {\n            goto Exit;\n        }\n    }\n\n    Check(CryptExportKey(hKey, NULL, PUBLICKEYBLOB, 0, NULL, &amp;dwBlobLen), \"Error computing BLOB length.\");\n    Check(pbKeyBlob = (BYTE*)malloc(dwBlobLen), \"Out of memory. \\n\");\n    Check(CryptExportKey(hKey, NULL, PUBLICKEYBLOB, 0, pbKeyBlob, &amp;dwBlobLen), \"Error during CryptExportKey.\");\n\n    //-------------------------------------------------------------------\n    // Create the hash object.\n    Check(CryptCreateHash(hProv, CALG_SHA, 0, 0, &amp;hHash), \"Error during CryptCreateHash.\");\n\n    //-------------------------------------------------------------------\n    // Compute the cryptographic hash of the buffer.\n    Check(CryptHashData(hHash, pbBuffer, dwBufferLen, 0), \"Error during CryptHashData.\");\n\n    //-------------------------------------------------------------------\n    // Determine the size of the signature and allocate memory.\n\n    dwSigLen= 0;\n    Check(CryptSignHash(hHash, AT_SIGNATURE, NULL, 0, NULL, &amp;dwSigLen), \"Error during CryptSignHash.\");\n\n    //-------------------------------------------------------------------\n    // Allocate memory for the signature buffer.\n    Check(pbSignature = (BYTE *)malloc(dwSigLen), \"Out of memory.\");\n\n    //-------------------------------------------------------------------\n    // Sign the hash object.\n    Check(CryptSignHash(hHash, AT_SIGNATURE, NULL, 0, pbSignature, &amp;dwSigLen), \"Error during CryptSignHash.\");\n\n    FILE* f = fopen(signFileName, \"w\");\n    fwrite(pbSignature, dwSigLen, 1, f);\n    printf(\"W: %.128s\\n\", pbSignature);\n    fwrite(pbKeyBlob, dwBlobLen, 1, f);\n    printf(\"W: %.148s\\n\", pbKeyBlob);\n    fclose(f);\n    //-------------------------------------------------------------------\n    // Destroy the hash object.\n\n    if(hHash) \n        CryptDestroyHash(hHash);\n\n    free(pbSignature);\n    free(pbKeyBlob);\n\n    if(hProv) \n        CryptReleaseContext(hProv, 0);\n\nExit:;\n}\n\n\nbool CheckDigSign(const char* inputFileName, const char* signFileName, const char* userName)\n{\n    bool result = false;\n    HCRYPTPROV hProv;\n    BYTE *pbBuffer= (BYTE *)\"The data that is to be hashed and signed.\";\n    DWORD dwBufferLen = strlen((char *)pbBuffer)+1;\n    HCRYPTHASH hHash;\n    HCRYPTKEY hKey;\n    HCRYPTKEY hPubKey;\n    BYTE *pbKeyBlob;        \n    BYTE *pbSignature;\n    DWORD dwSigLen;\n    DWORD dwBlobLen;\n\n    FILE* inputFile = NULL;\n\n    Check((inputFile = fopen(inputFileName, \"r\")) != NULL, \"File does not exists\");\n    dwBufferLen = GetFileSize(inputFile);\n    Check(pbBuffer = (BYTE*)malloc(dwBufferLen + 1), \"cannot allocate memory\");\n\n    fread(pbBuffer, 1, dwBufferLen, inputFile);\n    pbBuffer[dwBufferLen] = '\\0';\n    fclose(inputFile);\n\n\n    FILE* signFile = NULL;\n    Check((signFile = fopen(signFileName, \"r\")) != NULL, \"File does not exists\");\n    DWORD dwSignFileLen = GetFileSize(signFile);\n    dwSigLen = 128;\n    pbSignature = (BYTE*)malloc(dwSigLen);\n    dwBlobLen = dwSignFileLen - dwSigLen;\n    pbKeyBlob = (BYTE*)malloc(dwBlobLen);\n    fread(pbSignature, 1, dwSigLen, signFile);\n    fread(pbKeyBlob, 1, dwBlobLen, signFile);\n    fclose(signFile);\n\n\n\n    printf(\"R: %.128s\\n\", pbSignature);\n    printf(\"R: %.148s\\n\", pbKeyBlob);\n\n    Check(CryptAcquireContext(&amp;hProv, NULL, NULL, PROV_RSA_FULL, 0), \"Error during CryptAcquireContext.\");\n\n    Check(CryptImportKey(hProv, pbKeyBlob, dwBlobLen, 0, 0, &amp;hPubKey), \"Public key import failed.\");\n\n    //-------------------------------------------------------------------\n    // Create a new hash object.\n    Check(CryptCreateHash(hProv, CALG_SHA, 0, 0, &amp;hHash), \"Error during CryptCreateHash.\");\n\n    //-------------------------------------------------------------------\n    // Compute the cryptographic hash of the buffer.\n    Check(CryptHashData(hHash, pbBuffer, dwBufferLen, 0), \"Error during CryptHashData.\");\n\n    //-------------------------------------------------------------------\n    // Validate the digital signature.\n\n    result = CryptVerifySignature(hHash, pbSignature, dwSigLen, hPubKey, NULL, 0); \n    printf(\"%u %x\", GetLastError(), GetLastError());\n    //-------------------------------------------------------------------\n    // Free memory to be used to store signature.\n\n    if(pbSignature)\n        free(pbSignature);\n\n    //-------------------------------------------------------------------\n    // Destroy the hash object.\n\n    if(hHash) \n        CryptDestroyHash(hHash);\n\n    //-------------------------------------------------------------------\n    // Release the provider handle.\n\n    if(hProv) \n        CryptReleaseContext(hProv, 0);\n\nExit:\n    return result;\n}\n\n\nint _tmain(int argc, _TCHAR* argv[])\n{\n\n\n    DigSign(\"test3.txt\", \"test.sig\");\n    printf(\"TEST: %u\\n\", CheckDigSign(\"test3.txt\", \"test.sig\", \"\"));\n}\n</code></pre>\n\n<p>DigSign function must sign content of file and write signature and public key to another file. CheckSign must return true if sign is right. But I don't understand why my code doesn't work. CheckDigSign in _tmain must return true, but it returns false. Can anybody help me pls?</p>\n"},{"tags":["ruby","windows","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12713368,"title":"Ruby 1.9 win32 api monitor window component","body":"<p>I'd like to interact with some window's windows using ruby but, other than the examples on the gem docs, I can't go any further. </p>\n\n<p>Basically I need to find a window, get it's elements, monitor some of it's elements and send clicks on some of the window's buttons. The elements that I need to monitor are some progress bars and lists and I need to trigger some event in my ruby code as soon as some of those changes. Possibly with some callback function. </p>\n\n<p>All this is part of a bigger implementation where I need to monitor the window from a remote linux system and implement or use some sort of protocol that the process living on the windows box would use to send out the changes on the window and receive commands to perform on that window.</p>\n\n<p>So, as you can see, there's a lot to do and I'd like to start with the first bit, which is create the ruby process on the windows box.</p>\n\n<p>Any idea or sample code in order to get me started with monitoring the progress bar on the window?</p>\n\n<p>Thanks</p>\n"},{"tags":["c++","winapi","internal","ntdll"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12710968,"title":"How to determine an order of opening files for a process?","body":"<p>Is there a way to get all opened file handles for a process and arrange it by time files were opened? We have a project, which requires exactly this - we need to determine which files are opened by a Dj software, such as Traktor or Serato. The reason we need to know its order is to determine, which file is in the first deck, and which is in the second one.</p>\n\n<p>Currently we are using Windows internal APIs from the Ntdll.dll (Winternl.h) to determine a list of all opened files for a process. Maybe that's not the best way to do it. Any suggestions are highly appreciated.</p>\n\n<p>We relied on an observed behavior of that APIs on certain OS version and certain Dj software versions, which was that the list of all opened files for a process never get rearranges, i.e. adheres an order. I know that's a bad practice, but it was a \"should be\" feature from the customer right before the release, so we had to. The problem is now we have a bug when those handles are sometimes randomly rearranged without any particular cause. That brakes everything. I thought maybe there would be a field in those win structures to obtain file's been opened time, but seemingly there are no such things. Docs on that APIs are quite bad.</p>\n\n<p>I thought about some code paste, but it's a function 200 lines long and it uses indirect calls from the dll using function pointers and all structures for WinAPIs are redefined manually, so it's really hard to read it. Actually, the Winternl.h header isn't even included - all stuff is loaded manually too, like that:</p>\n\n<pre><code>GetProcAddress( GetModuleHandleA(\"ntdll.dll\"), \"NtQuerySystemInformation\" );\n</code></pre>\n\n<p>It's really a headache for a cross platform application...</p>\n\n<p><strong>P.S.</strong> I have posted a related question <a href=\"http://stackoverflow.com/questions/12475132/is-there-a-way-to-get-a-list-of-all-opened-files-for-a-process-using-qt\">here</a> about any cross-platform or Qt way to get opened file handles, maybe that stuff will be useful or related.</p>\n"},{"tags":["windows","winapi"],"answer_count":5,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":2091,"score":5,"question_id":812686,"title":"Can a window be always on top of just one other window?","body":"<p>In Windows, is it possible to set window A such that it is always on top of window B, yet allow other windows to work as normal and appear over the top of both, when active.</p>\n\n<p>In other words, I want a parent-child relationship between two windows. Can this be done without making window A a child of window B, MDI-style? Window B isn't mine (Internet Explorer), and screws my dialog A's graphics up when I try to achieve this with <code>SetParent</code>.</p>\n\n<p>I thought I'd cracked it with this idea from an <a href=\"http://social.msdn.microsoft.com/Forums/en-US/ieextensiondevelopment/thread/46a66fe3-194a-4e57-891e-4875ea8fcd00/\">MSDN forum post</a>, but alas windows A is still always on top of everything, not just window B.</p>\n\n<pre><code>// Place window A on top\nSetWindowPos(hWndWindow, HWND_TOPMOST, 0, 0, 0, 0, SWP_NOMOVE|SWP_NOSIZE);\n// Place window B underneath it\nSetWindowPos(hWndParent, HWND_NOTOPMOST, 0, 0, 0, 0, SWP_NOSIZE|SWP_NOMOVE);\n</code></pre>\n\n<p>Is it possible?</p>\n"},{"tags":["winapi","windows-vista","windows-xp","screensaver"],"answer_count":10,"favorite_count":4,"up_vote_count":14,"down_vote_count":0,"view_count":11772,"score":14,"question_id":463813,"title":"Programmatically prevent Windows screensaver from starting","body":"<p>Is there a recommended way to prevent the Windows screensaver from starting?  The closest thing I've found is <a href=\"http://www.codeproject.com/KB/cs/ScreenSaverControl.aspx\">this article</a>, but what I would really like to do is just tell Windows that the computer isn't idle rather than fooling with the currently set screensaver values.</p>\n"},{"tags":["winapi","hook","barcode-scanner"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12708367,"title":"How to process window message with bufferization","body":"<p>I have a WH_GETMESSAGE hook that catches WM_KEYDOWN and WM_INPUT (right now only WM_KEYDOWN), what i need is a way to measure time intervals between WM_KEYDOWNs to see how fast user typing. Exactly i need to drop entire keystroke if it was inputed too fast (i.e. input wasn't actually from user, but from some HID keyboard device, like barcode scanner). What i need to do is for each symbol i'm gonna wait for 30 ms and then if none further symbols applied i need to send it to window it was meant for. And that check need to be performed on each WM_KEYDOWN.  If new symbol applied i will push it to my queue along with any further symbols that will go within 30 ms limit between messages (actually i tested on my computer it takes something like 31-32 ms to input symbol and barcode scanner needs something like 15-16 ms which will be sufficent). </p>\n\n<p>I figured out following algorithm: \n1. If incoming message is WM_KEYDOWN - store it (with time offcourse). \n2. If next incoming message isn't WM_KEYDOWN or time-limit exceeded - send stored message to it's recipient and store current message if it's WM_KEYDOWN - go to step 1. \n3. If next message came in 30 ms limit - store it too.\n4. If next message is VK_RETURN or sequence is longer than 128 symbols - drop current sequence and store it as barcode. Goto step 1. </p>\n\n<p>Current flaw in this algorithm is that sendMessage thing. I used both sendMessage and postMessage but they both just resend it to my hook procedure (which is obvious i guess). Is there any way to just send this message directly to window it was mento to be send? </p>\n\n<p>Or maybe there are other solution for my problem? </p>\n\n<p>My explanation may seem ambiguous so i just write what i need to achieve: \nI need to intercept barcode scanner input before it actually reaches window procedure, so no WM_KEYDOWN messages from scanner will reach target window. A barcode message are typically comes with 15-16ms interval between single WM_KEYDOWNs and ends with VK_RETURN.</p>\n\n<p>Also i need to use exactly WH_GETMESSAGE (or similiar hook that will allow me to catch both WM_INPUT and WM_KEYDOWN). WM_INPUT is needed to distinguish input from various devices (basically i'm going to enum all HID keyboards, determine which of them send barcodes if such event occurs i will flag device as barcode scanner and store it's VID&amp;PID to local database and it will be use for other). </p>\n"},{"tags":["c++","winapi","boost","signals"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12694077,"title":"Convert boost::bind object to function pointer - implementing message map","body":"<p>I'm thinking of creating a Window class library that uses Win32 API and C++ standard libraries<br>\nAnd I'd like to add signal/slot functionality that handles window messages.</p>\n\n<pre><code>using namespace std;\nusing namespace boost::signals2;\ntypedef signal&lt;void (Window*, EventArgs*)&gt; WndEvent; \n\nclass EventArgs { public: HWND hWnd; WPARAM wParam; LPARAM lParam; };\n\nclass Window {\n    protected: unordered_map&lt;UINT, WndMsg*&gt; msgMap;\n    public: void addMsgHandler(UINT msg, void (*handler)(Window*, EventArgs*)) {\n        auto iter=msgMap.find(msg);\n        if(iter==msgMap.end()) {\n            WndEvent* newEvent = new WndEvent();\n            newEvent-&gt;connect(handler);\n            msgMap.insert(make_pair(msg, newEvent));\n        }\n        else iter-&gt;second-&gt;connect(handler);\n    }\n\n    private: LRESULT wndProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lparam) {\n        for(auto iter=msgMap.begin(); iter!=msgMap.end(); iter++)\n            iter-&gt;second-&gt;();\n    }\n};\n</code></pre>\n\n<p>In using that library:</p>\n\n<pre><code>class Form : public Window {\n    void initialize() {// add here pair of 'message' and 'corresponding handler'\n        addMsgHandler(WM_LBUTTONUP, boost::bind(&amp;Form::onLButtonUp, this, _1, _2));\n        ...\n    }\n    void onLButtonUp(Window* sender, EventArgs* e) { // event handler\n        wchar_t buf[1000]; \n        wsprintf(buf, L\"(%d, %d) clicked\", GET_X_LPARAM(e-&gt;lParam), GET_Y_LPARAM(e-&gt;lParam));\n        MessageBox(0, buf, L\"\", MB_OK);\n    }\n}\n</code></pre>\n\n<p>Here the problem is onLButtonUp's signature doesn't match since it's a class member function.<br>\nSo I tried to use boost::bind and I got compile error like this:    </p>\n\n<pre><code> Window::addMsgHandler': cannot convert parameter 2 'boost::_bi::bind_t&lt;R,F,L&gt;' to 'void (__cdecl *)(Window *,EventArgs *)'\n</code></pre>\n\n<p>which means I have to change (from simple function pointer to boost function object?) the signature of addMsgHandler() but </p>\n\n<p>I cannot determine the data type (with very long template parameters) to be passed.</p>\n\n<p>The compile error message says           </p>\n\n<pre><code>R=void,            \nF=boost::_mfi::mf2&lt;void,Form,Window *,EventArgs *&gt;,1&gt;                           \nL=boost::_bi::list3&lt;boost::_bi::value&lt;Form*&gt;,boost::arg&lt;1&gt;,boost::arg&lt;2&gt;&gt;                \n</code></pre>\n\n<p>Furthermore, since many other classes will be derived from class Window, I cannot know the template type when I define class <em>Window</em>.</p>\n\n<p>Is there a proper way to pass boost.bind object as function parameter?</p>\n"},{"tags":["windows","winapi","version","rc"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":356,"score":1,"question_id":990308,"title":"Automatically increment the version number in a project's .rc file","body":"<p>How I can automatically increment the file version in my C/C++ project when I build it?\nCurrently I have to modify the resources manually before I do the build.\nIs there any script or utility to automate this?</p>\n"},{"tags":["c++","c","windows","winapi","filesystems"],"answer_count":2,"favorite_count":1,"up_vote_count":9,"down_vote_count":0,"view_count":513,"score":9,"question_id":8070224,"title":"Is there an alternative to the Windows FindFirstFile/FindNextFile API that doesn't search short file names?","body":"<p>I'm using the Windows API calls <a href=\"http://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;ved=0CCQQFjAA&amp;url=http://msdn.microsoft.com/en-us/library/windows/desktop/aa364418%28v=vs.85%29.aspx&amp;ei=kci6TtGwKqHq2QWa1ajCBw&amp;usg=AFQjCNEZdeD7Rk_PkGmVQosMyhgQ1lO16w&amp;sig2=XjQK3PSs7WVDzh2O8E82sw\">FindFirstFile</a> and <a href=\"http://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;sqi=2&amp;ved=0CBoQFjAA&amp;url=http://msdn.microsoft.com/en-us/library/windows/desktop/aa364428%28v=vs.85%29.aspx&amp;ei=38i6Tp-6EYGU2AWuirnDBw&amp;usg=AFQjCNG-eZr5AIhnTwM8nxgFow9m1AUReg&amp;sig2=eDfRsNM5RXQn909ihJFNeg\">FindNextFile</a> to search for files matching a certain wildcard string in a directory.  For example, I might want to find all XML files in a directory, and so I search using the pattern \"*.xml\".</p>\n\n<p>I'm running into the problem that if I'm searching for a 3-letter extension, and a file's extension starts with that 3-letter extension, it will get picked up by my search, even if the extension contains more characters after those first 3.  For example, if my file is named somelongname.xmlaaaa, this will get picked up by the search for \"*.xml\".  The short name of that file is somelo~1.xml, which matches my wildcard string.</p>\n\n<p>I could do my own wildcard matching to get around this problem, but presumably a Windows API would be able to do this more efficiently than I could, and my code would be simpler.  As far as I can tell there isn't a way to force these functions to ignore short names.  Is there any API Windows exposes with this functionality?</p>\n"},{"tags":["c++","winapi","serial-port"],"answer_count":7,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":5241,"score":1,"question_id":1228567,"title":"How to call the RJ45 as a serial port for interfacing?","body":"<p>I'm currently working on a serial interfacing project based upon connecting to the rs232 port. However, seeing as a decent number of laptops and/or PC's seem like they might have their rs232 ports disappear within the next 5 years, I was considering using the RJ45 modular port for my project (EIA/TIA 568). However, I'm not quite sure how to denominate it when accessing the port through the Win32API (I'm programming in C++). It's currently programmed to \"COM1\". Does anyone know how I can find out what this port is called or how to configure it so it can be used in this manner?</p>\n"},{"tags":["python","winapi","pywin32"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":253,"score":0,"question_id":11106281,"title":"Error installing and running pywin32 2.7","body":"<p>I am coming up with a couple errors after installing: </p>\n\n<blockquote>\n  <p>pywin32-217.win32-py2.7</p>\n</blockquote>\n\n<p>I have recently upgraded ArcGIS to 10.1 and it uses Python 2.7 (as ooposed to 2.6 that came with ArcGIS 10.0)</p>\n\n<p>When I run the installer on a Windows 7 64 bit, it installs, but throws the following message:</p>\n\n<blockquote>\n  <p>close failed in file object destructor:</p>\n  \n  <p>sys.excepthook is missing</p>\n  \n  <p>lost sys.stderr</p>\n</blockquote>\n\n<p>I had a simple python script to print to a printer from a folder containing .pdf files which worked before my upgrade</p>\n\n<pre><code>import arcpy, glob, win32api, os\n\npdfLoc = arcpy.GetParameterAsText(0)\n\ntry:\n    copies = int(arcpy.GetParameter(1))\nexcept:\n    copies = 1\n\nfor pdfname in glob.glob(os.path.join(pdfLoc, \"*.pdf\")):\n    fullpath = os.path.join(pdfLoc, pdfname)\n    for copy in range(copies):\n        win32api.ShellExecute(0, \"print\", pdfname, None, \".\", 0)\n\ndel fullpath\ndel pdfname\ndel pdfLoc\n</code></pre>\n\n<p>Now when I run the script, I get the following error:</p>\n\n<blockquote>\n  <p>Traceback (most recent call last):   File\n  \"Z:\\ESRI\\Python\\Solstice_Tools_Scripts\\Printer_Tools\\Batch_Print_From_PDF_Only\\BatchprintFromPDFOnly_Test.py\",\n  line 34, in \n      win32api.ShellExecute(0, \"print\", pdfname, None, \".\", 0) error: (31, 'ShellExecute', 'A device attached to the system is not\n  functioning.')</p>\n  \n  <p>Failed to execute (BatchPrintFromPDFOnly2).</p>\n</blockquote>\n\n<p>I've been googling around and have tried a few solutions, like running the executable in troubleshooting mode, but the error persists. Can anyone suggest what may cause this?</p>\n\n<p>As a side note, I upgraded 4 computers in my company to the new version of python and ArcGIS, and only one of them is throwing this error. The rest work fine.</p>\n\n<p>Thanks,\nMike</p>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":12693995,"title":"How do I measure the width available for text in a tree view item?","body":"<p>I have a standard Win32 tree view control.  I'm putting a file name into the root node. To avoid asking the user to use a horizontal scroll bar I would like to shorten the text using <code>PathCompactPath</code> to fit in the space available on the control.</p>\n\n<p><img src=\"http://i.stack.imgur.com/HozVp.png\" alt=\"enter image description here\"></p>\n\n<p>So, in order to do this I need to measure the distance marked in the screenshot above.  I know about <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb773610.aspx\" rel=\"nofollow\"><code>TVM_GETITEMRECT</code></a> but it returns a rect that includes the space taken up by the icon.</p>\n\n<p>So, how can I obtain the metric I need? Is it even possible to do so?</p>\n"},{"tags":["winapi","credential-providers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12421463,"title":"CredentialProvider does not accept passwords with special (German) letters","body":"<p>I wrote a CredentialProvider that allows to log in to Windows. But today I found out this strange error that <code>GetSerialization()</code> seems not to accept passwords which contain the German 'umlaut' letters like 'ä' or 'ü'. Does anyone know the solution?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["excel","winapi","vba","excel-vba","taskbar"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12682749,"title":"Excel - Windows 7 Taskbar Progress","body":"<p>Running Excel 2010, I can assuredly always be running these sheets on this version, as it will only be accessed locally exclusively on my work's terminal computers.</p>\n\n<p>I run a number of import process and large folder filtering/printing batch functions via excel. I am wanting to utilize the Windows 7 taskbar progress bar visual while my functions process, giving an idea of how  far they are along. Considered going with other visual effects for showing the progress, but this(if possible) seems the most obvious and professional style to do so.</p>\n\n<p>I've been looking thoroughly into trying to make this work, to no avail. My understanding thus far is that I need to impliment the ITaskbarList3 interface, commonly found within the Windows API. From the code I have found showing how to make it work, once implimented the rest seems fairly easy and self-explanatory.</p>\n\n<p>I am completely restricted to using Excel as the basis for the code, no installation permission on the work computers. I can install at home to get any files necessary, and then transfer them. Happy to use any extensive or really backwards ways to get to the end, as the ends justify whatever means it takes.</p>\n"},{"tags":["c","winapi","sdl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":11366811,"title":"Using SDL with Win32 Window","body":"<p>I'm using gcc in Codeblocks for my c programming on Windows Xp. </p>\n\n<p>When learning c I created a basic program that takes a book text file and counts the letter frequency.</p>\n\n<p>A couple of months later when learning SDL basics i thought it would be a good idea to\ncreate a bar graph to display the results of the c program. </p>\n\n<p>I now have 2 working programs BUT with no idea of how to combine them.</p>\n\n<p>Searching the net has produced numerous mentions of a Windows hack that allows SDL\nto be displayed inside a Win32 window, but i've been unable to find an actual code routine.</p>\n\n<p>I know at some point I will have to learn Windows programming, but was hoping i could find a short, quick fix meanwhile.</p>\n"},{"tags":["c++","c","winapi","serial-port"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1369,"score":2,"question_id":630432,"title":"Where can I find a ZwCreateFile example for C++?","body":"<p>I am looking for an example to read an already opened COM port, the only thing that I have found is an application called PORTMON that refers to a method called <code>ZwCreateFile</code>.</p>\n"},{"tags":["c++","winapi","dll","resources","rc"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":81,"score":2,"question_id":12692803,"title":"Are resource files compiled as UNICODE or ANSI code-page?","body":"<p>First - my apologies if this has been answered a hundred times over! D'oh!</p>\n\n<p>But my search-fu apparently sucks, as I'm having no luck answering this basic question:</p>\n\n<blockquote>\n  <p>How are resources stored in the EXE/DLL?  As UNICODE (UCS-2, Windows native internal character format), or as multibyte characters using the code-page of the resources block?</p>\n</blockquote>\n\n<ul>\n<li>How does one embed UNICODE strings into one's resources (.rc)?  </li>\n<li>Can UNICODE (UCS-2) text be inserted into the language strings from within VS 2012?</li>\n<li>Is Windows still using UCS-2, or is it using UTF16 internally?</li>\n</ul>\n\n<p>I'm just looking for general answers, or links to details, rather than a detailed how-to for putting a UNICODE string into an .rc string table.  Thanks!</p>\n"},{"tags":["c++","winapi","sleep","power-management","wakeup"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":120,"score":4,"question_id":12273382,"title":"How soon will Windows OS be able to wake from a wake timer?","body":"<p>I'm writing a program using C++ and Win APIs. I employed <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa373201%28v=vs.85%29.aspx\" rel=\"nofollow\">SetSuspendState</a>() API to send the system into a sleep mode (with a possibility to wake on a wake timer, 'DisableWakeEvent' set to FALSE.) I then use CreateWaitableTimer and SetWaitableTimer API to set the actual timer. The issue is that sometimes the system does not wake up if I set the wake timer too soon after the system enters the sleep mode.</p>\n\n<p>So I was curious if there's a minimum time that has to pass since the system is sent into a sleep mode before it can be woken up with a wake timer programmatically?</p>\n"},{"tags":["c","windows","winapi"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":121,"score":4,"question_id":12689142,"title":"Win32 API command line arguments parsing","body":"<p>I'm writing  Win32 console application, which can be started with optional arguments like this:</p>\n\n<pre><code>app.exe /argName1:\"argValue\" /argName2:\"argValue\"\n</code></pre>\n\n<p>Do I have to parse it manually (to be able to determine, which arguments are present) from argc/argv variables, or does Win32 API contain some arguments parser?</p>\n"},{"tags":["java","winapi","uac"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":79,"score":2,"question_id":12585725,"title":"UAC and file virtualization of java created files","body":"<p>I have an front end application (in PowerBuilder but that is not important) that is calling a helper application developed in Java and packaged with launch4j.</p>\n\n<p>The end user of the application has the possibility to freely configure a path into the front end where some files will be generated by either the front-end or the backend. </p>\n\n<p>I notice that on a Windows Vista or a Windows7 with UAC activated, if the user (that has no administrator privileges) has configured the output to <code>C:\\</code>, the generated files are silently virtualized into the <code>c:\\Users\\user_name\\AppData\\Local\\VirtualStore\\</code> directory.</p>\n\n<p>But when the process makes the java application create some files (via a <code>FileOutputStream</code>) in the same <code>C:\\</code>, the java fails on an \"Access denied\" exception that could be coherent to the fact that the drive root is not accessible to users, but not to the fact that the other application is virtualized. Task manager confirms that one is virtualized and not the other.</p>\n\n<p>I have found <a href=\"http://stackoverflow.com/q/8852967/317266\">that other SO question</a> that provides some clues but not an answser to my case, as both applications are 32 bit on a 32 system and no manifest are involved for both.</p>\n\n<p>Is there a way to let the java behave like the PB application (that is to be virtualized - it a customer request)? Of course a better solution would be to check if the path is accessible and to notify the user if it is not.</p>\n\n<p><strong>EDIT:</strong>\nWhile looking at the java.exe binary, I noticed that it includes a manifest that states (but I am not familiar with that)</p>\n\n<pre><code>&lt;trustInfo xmlns=\"urn:schemas-microsoft-com:asm.v3\"&gt;\n  &lt;security&gt;\n     &lt;requestedPrivileges&gt;\n        &lt;requestedExecutionLevel\n                  level=\"asInvoker\"\n                  uiAccess=\"false\"/&gt;\n     &lt;/requestedPrivileges&gt;\n  &lt;/security&gt;\n&lt;/trustInfo&gt;\n</code></pre>\n\n<p>Maybe it is the answer of the question : java is not virtualized by design? <strong>EDIT:</strong> I did understand that the manifest mechanism disables the virtualization.</p>\n\n<p><strong>EPILOGUE:</strong> thanks for your explanations and your arguments helped to change the customer request. Now it is acknowledged that handling the lack of privileges to write on some folders is better than letting windows virtualize the files somewhere in the ether :o)</p>\n"},{"tags":[".net","windows","winapi","hardware"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12686820,"title":"Programmatic way to see if a mobile computer (laptop/tablet/etc.) is connected to a docking station","body":"<p>I am writing some software that needs to behave differently on a mobile device that is connected to a docking station. As a result, I need a programmatic way to check if the computer is connected to a docking station in C#/.NET.</p>\n\n<p>I have tried the following:</p>\n\n<ul>\n<li>P/invoking the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms724311%28v=vs.85%29.aspx\" rel=\"nofollow\">GetCurrentHwProfile</a> function.</li>\n<li>P/invoking the <a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff538716%28v=vs.85%29.aspx\" rel=\"nofollow\">CM_Is_Dock_Station_Present</a> function.</li>\n<li>Looking for a Docking Station chassis type in WMI's <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa394474%28v=vs.85%29.aspx\" rel=\"nofollow\">Win32_SystemEnclosure</a>.</li>\n</ul>\n\n<p>Unfortunately, none of these seemed to work in a 'one size fits all' situation. They would work for some of my test devices, but not others. </p>\n\n<p>I need to run across a variety of devices and docking stations. Are there any consistent, reliable ways to check if a device is docked in Windows?</p>\n"},{"tags":["c++",".net","winapi","active-directory"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":95,"score":2,"question_id":12673506,"title":"Verify Active Directory domain trust relationship of the local machine","body":"<p>I have to find out if the local machine is still joined to a domain, or if another computer has used the computer account or, if the computer account has been reset.</p>\n\n<p>In other words, i need to verify the trust relationship between the local machine and the domain</p>\n\n<p>NLTest /SC_VERIFY:{Domain} does the job pretty well.</p>\n\n<p>Are there any API functions that i can use to detect whether the local machine has lost the trust relationship to a domain? I don't like to call external executables from my program.</p>\n\n<p>What i tried so far:</p>\n\n<ul>\n<li>NetGetJoinInformation(): It doesn't realize it.</li>\n<li>DsBind*(): It doesn't realize it. Also tried to call it under the local system account.</li>\n</ul>\n\n<p>Any ideas?</p>\n"},{"tags":["c++","winapi","device-driver","volume"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12687937,"title":"remove a defined device","body":"<p>to get device information I have this example code, but some how I created a device that I want to remove it and get back to default list.\nthere is the code: </p>\n\n<pre><code>#include&lt;DeviceInfos.h&gt;\n\nQString DisplayVolumePaths( PWCHAR VolumeName   )\n{\n    DWORD  CharCount = MAX_PATH + 1;\n    PWCHAR Names     = NULL;\n    PWCHAR NameIdx   = NULL;\n    BOOL   Success   = FALSE;\n\n    for (;;)\n    {\n        //\n        //  Allocate a buffer to hold the paths.\n        Names = (PWCHAR) new BYTE [CharCount * sizeof(WCHAR)];\n\n        if ( !Names )\n        {\n            //\n            //  If memory can't be allocated, return.\n            return \"memory can't be allocated\";\n        }\n\n        //\n        //  Obtain all of the paths\n        //  for this volume.\n        Success = GetVolumePathNamesForVolumeNameW(\n            VolumeName, Names, CharCount, &amp;CharCount\n            );\n\n        if ( Success )\n        {\n            qDebug()&lt;&lt;\"GetVolumePathNamesForVolumeNameW succeed count\"&lt;&lt;CharCount;\n            break;\n        }\n\n        qDebug()&lt;&lt;\"GetVolumePathNamesForVolumeNameW failed count\"&lt;&lt;CharCount&lt;&lt;\" error \"&lt;&lt;GetLastError();\n        if ( GetLastError() != ERROR_MORE_DATA )\n        {\n            break;\n        }\n\n        //\n        //  Try again with the\n        //  new suggested size.\n        delete [] Names;\n        Names = NULL;\n    }\n\n    if ( Success )\n    {\n        //\n        //  Display the various paths.\n        for ( NameIdx = Names;\n              NameIdx[0] != L'\\0';\n              NameIdx += wcslen(NameIdx) + 1 )\n        {\n            qDebug()&lt;&lt;\"  \"&lt;&lt;QString::fromWCharArray(NameIdx);\n            return QString::fromWCharArray(NameIdx);\n        }\n        qDebug()&lt;&lt;\"\\n\";\n    }\n\n    if ( Names != NULL )\n    {\n        delete [] Names;\n        Names = NULL;\n    }\n\n    return \"s\";\n}\n\nQMap&lt;QString,DeviceVolumeName&gt; __cdecl GetDeviceVolumeInfos(void)\n{\n    DWORD  CharCount            = 0;\n    WCHAR  DeviceName[MAX_PATH] = L\"\";\n    DWORD  Error                = ERROR_SUCCESS;\n    HANDLE FindHandle           = INVALID_HANDLE_VALUE;\n    BOOL   Found                = FALSE;\n    size_t Index                = 0;\n    BOOL   Success              = FALSE;\n    WCHAR  VolumeName[MAX_PATH] = L\"\";\n    QMap&lt;QString,DeviceVolumeName&gt; mapDeviceInfos=QMap&lt;QString,DeviceVolumeName&gt;();\n\n\n    //\n    //  Enumerate all volumes in the system.\n    FindHandle = FindFirstVolumeW(VolumeName, ARRAYSIZE(VolumeName));\n\n    if (FindHandle == INVALID_HANDLE_VALUE)\n    {\n        Error = GetLastError();\n        qDebug()&lt;&lt;\"FindFirstVolumeW failed with error code %d\\n\"&lt;&lt; QString::number( Error);\n\n        return mapDeviceInfos;\n    }\n\n    for (;;)\n    {\n        DeviceVolumeName DVName;\n        //\n        //  Skip the \\\\?\\ prefix and remove the trailing backslash.\n        Index = wcslen(VolumeName) - 1;\n\n        if (VolumeName[0]     != L'\\\\' ||\n            VolumeName[1]     != L'\\\\' ||\n            VolumeName[2]     != L'?'  ||\n            VolumeName[3]     != L'\\\\' ||\n            VolumeName[Index] != L'\\\\')\n        {\n            Error = ERROR_BAD_PATHNAME;\n            qDebug()&lt;&lt;\"FindFirstVolumeW/FindNextVolumeW returned a bad path: %s\\n\"&lt;&lt;QString::fromWCharArray( VolumeName);\n            break;\n        }\n\n        //\n        //  QueryDosDeviceW does not allow a trailing backslash,\n        //  so temporarily remove it.\n        VolumeName[Index] = L'\\0';\n\n        CharCount = QueryDosDeviceW(&amp;VolumeName[4], DeviceName, ARRAYSIZE(DeviceName));\n\n        VolumeName[Index] = L'\\\\';\n\n        if ( CharCount == 0 )\n        {\n            Error = GetLastError();\n            qDebug()&lt;&lt;L\"QueryDosDeviceW failed with error code \\n\"&lt;&lt;QString::number(  Error);\n            break;\n        }\n\n\n        qDebug()&lt;&lt;\"Found a device: \"&lt;&lt;QString::fromWCharArray( DeviceName);\n        qDebug()&lt;&lt;\"Volume name: \"&lt;&lt; QString::fromWCharArray(VolumeName);\n        qDebug()&lt;&lt;\"Paths:  \";\n        QString VolPath=DisplayVolumePaths(VolumeName);\n        qDebug()&lt;&lt;\"VolPath.at(0)\"&lt;&lt;VolPath.at(0);\n\n\n        DVName.DeviceN=QString::fromWCharArray(DeviceName);\n        DVName.VolumeN=QString::fromWCharArray(VolumeName);\n        mapDeviceInfos.insert(VolPath.at(0),DVName);\n\n\n\n\n        //\n        //  Move on to the next volume.\n        Success = FindNextVolumeW(FindHandle, VolumeName, ARRAYSIZE(VolumeName));\n\n        if ( !Success )\n        {\n            Error = GetLastError();\n\n            if (Error != ERROR_NO_MORE_FILES)\n            {\n                qDebug()&lt;&lt;\"FindNextVolumeW failed with error code \\n\"&lt;&lt;QString::number( Error);\n                break;\n            }\n\n            //\n            //  Finished iterating\n            //  through all the volumes.\n            Error = ERROR_SUCCESS;\n            break;\n        }\n    }\n\n    FindVolumeClose(FindHandle);\n    FindHandle = INVALID_HANDLE_VALUE;\n\n    return mapDeviceInfos;\n}\n</code></pre>\n\n<p>the output:</p>\n\n<pre><code>Found a device:  \"\\Device\\HarddiskVolume1\" \nVolume name:  \"\\\\?\\Volume{af2c546d-c067-11e1-9f1c-806e6f6e6963}\\\" \nPaths:   \nGetVolumePathNamesForVolumeNameW succeed count 5 \n   \"C:\\\" \nVolPath.at(0) 'C' \nFound a device:  \"\\Device\\HarddiskVolume2\" \nVolume name:  \"\\\\?\\Volume{af2c546e-c067-11e1-9f1c-806e6f6e6963}\\\" \nPaths:   \nGetVolumePathNamesForVolumeNameW succeed count 5 \n   \"D:\\\" \nVolPath.at(0) 'D' \nFound a device:  \"\\Device\\{A5E1065D-0AD1-48ED-8457-A80B2D9B6FE2}#0#0\" \nVolume name:  \"\\\\?\\Volume{4dee513c-0b96-11e2-9b3b-d4bed9a624c5}\\\" \nPaths:   \nGetVolumePathNamesForVolumeNameW failed count 261  error  2 \nVolPath.at(0) 's' \nFound a device:  \"\\Device\\CdRom0\" \nVolume name:  \"\\\\?\\Volume{af2c5471-c067-11e1-9f1c-806e6f6e6963}\\\" \nPaths:   \nGetVolumePathNamesForVolumeNameW succeed count 5 \n   \"E:\\\" \nVolPath.at(0) 'E' \n</code></pre>\n\n<p>the Device that I want to remove is with those information(<code>GetVolumePathNamesForVolumeNameW</code> couldn't' t get the volume path):</p>\n\n<pre><code>Found a device:  \"\\Device\\{A5E1065D-0AD1-48ED-8457-A80B2D9B6FE2}#0#0\" \n    Volume name:  \"\\\\?\\Volume{4dee513c-0b96-11e2-9b3b-d4bed9a624c5}\\\" \n    Paths:   \n    GetVolumePathNamesForVolumeNameW failed count 261  error  2 \n</code></pre>\n\n<p>any help please!!!</p>\n\n<p>thanks in advance.</p>\n"},{"tags":["c++","winapi","visual-c++"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":226,"score":0,"question_id":9893493,"title":"How to simulate interaction with console programmatically?","body":"<p>I want to know how to programmatically execute commands (like \"dir C:\\\" or \"shutdown -r\", etc.) in Windows' Command Prompt (CMD) and retrieve the resulted output, without displaying the black CMD window of course.</p>\n\n<p>I suspect <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms682073%28v=vs.85%29.aspx\" rel=\"nofollow\" title=\"this\">->this link&lt;-</a> contains the list of required APIs, but I'm not sure which ones to pick, so need your assistance.</p>\n\n<p>Basically this is what I need it for: I want to write simple client-server application (WinSock) where user can sit on the client end and execute commands in (and read replies from) the command prompt of server. Yes - just like Telnet works, but without Telnet, just Win32 API.</p>\n\n<p>Suppose user wants to execute \"dir\" command on server. He types \"dir\" on client application, which sends request to the server application, where the command will be executed (as if it was physically typed in command prompt of server) and the output text will be sent back to the client application.</p>\n"},{"tags":["c#","windows","winapi"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":12260384,"title":"Making GetRawInputDeviceInfo and RIDI_DEVICEINFO work with C#","body":"<p>I have the problem that I can't seem to make GetRawInputDeviceInfo in combination with RIDI_DEVICEINFO (to try to retrieve a RID_DEVICE_INFO) is not working at all.</p>\n\n<p>I get the error -1 back from the function, what should mean that there is not enough space to store the RID_DEVICE_INFO, buy I tried already to increase it to the more then needed but the effect the same.</p>\n\n<p>I used the following DLLImports :</p>\n\n<pre><code>[DllImport(\"User32.dll\")]\nextern static uint GetRawInputDeviceInfo(IntPtr hDevice, uint uiCommand, IntPtr pData, ref uint pcbSize);\n\n[DllImport(\"User32.dll\")]\nunsafe extern static uint GetRawInputDeviceInfo(IntPtr hDevice, uint uiCommand, IntPtr pData, IntPtr pcbSize);\n</code></pre>\n\n<p>Both with no result, but when I try these with RIDI_DEVICENAME they both work just fine.\nIn this case I call the function like this :</p>\n\n<p>first to get the size: <code>GetRawInputDeviceInfo(rid.hDevice, RIDI_DEVICENAME, IntPtr.Zero, pSize);</code></p>\n\n<p>and then : <code>GetRawInputDeviceInfo(rid.hDevice, RIDI_DEVICENAME, pData, pSize);</code></p>\n\n<p>to get the name. Both work fine, but when I call the function like this :</p>\n\n<pre><code>int intReturn = (int)GetRawInputDeviceInfo(rid.hDevice, RIDI_DEVICEINFO, IntPtr.Zero, pInfoSize);\nintReturn = (int)GetRawInputDeviceInfo(rid.hDevice, RIDI_DEVICEINFO, pInfoData, pInfoSize);\n</code></pre>\n\n<p>Then at first I get 0 into intReturn and also can get the correct size,\nbut then I get -1 into return, and whan I do a PtrToStructure it just returns wrong and seemingly random values.</p>\n\n<p>Also when I after that do a GetLastWin32Error(), it return sometime 1008 or 87 , what also seems not to make any logic to me, because I don't see where I could have made the wrong parameters.</p>\n\n<p>I defined RIDI_DEVICENAME and RIDI_DEVICEINFO  as :</p>\n\n<pre><code>internal const uint RIDI_DEVICENAME = 0x20000007;\ninternal const uint RIDI_DEVICEINFO = 0x2000000b;\n</code></pre>\n\n<p>Can anyone help with this problem or show me a working C# example for GetRawInputDeviceInfo ?</p>\n\n<p>Thanks,\nPeter</p>\n"},{"tags":["c++","winapi","sleep"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12685735,"title":"Is PBT_APMSUSPEND notification supposed to be sent during forced sleep on Windows XP?","body":"<p>I'm not sure if I'm reading <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa373247%28v=vs.85%29.aspx\" rel=\"nofollow\">documentation</a> correctly, so I'd appreciate if someone could clarify.</p>\n\n<p>I run the following API to put Windows XP SP3 into sleep (or standby mode) from a worker thread:</p>\n\n<pre><code>BOOL bForced = TRUE;\nSetSuspendState(FALSE, bForced, FALSE);\n</code></pre>\n\n<p>Then in the main thread, while processing window messages:</p>\n\n<pre><code>LRESULT WindowProc(UINT message, WPARAM wParam, LPARAM lParam)\n{\n    if(message == WM_POWERBROADCAST)\n    {\n        if(wParam == PBT_APMSUSPEND)\n        {\n            AddLogMsg(_T(\"SUSPEND event received\"));\n        }\n        else if(wParam == PBT_APMRESUMEAUTOMATIC)\n        {\n            AddLogMsg(_T(\"RESUME event received\"));\n        }\n    }\n\n    //Do other processing\n}\n</code></pre>\n\n<p>So when SetSuspendState is called with request for a 'forced' sleep mode, the PBT_APMSUSPEND notification is never broadcast. Only if I set forced parameter to FALSE I receive it.</p>\n\n<p>Any idea why?</p>\n\n<p>PS. PBT_APMRESUMEAUTOMATIC is received in either case.</p>\n\n<p>PS2. PBT_APMSUSPEND is always received when run on Windows Vista/7.</p>\n"},{"tags":["winapi","cmd","stdin","cmd.exe"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":12685693,"title":"process launched by writing command to standard input of cmd.exe doesn't have a window","body":"<p>I would like to use code below to launch notepad.exe. Result is: cmd.exe has a child process, but notepad.exe doesn't have a window. Situation is strange, becuase notepad.exe behaves like \"waiting for procesing some events?\" - if we extend std::vector commands container to relatively bigger number of commands, then notepad.exe finally will be showed.</p>\n\n<pre><code>//------------Sample using CreateProcess and Anonymous Pipes-----------------\n//---------------------childspawn.cpp----------------------------------------\n//---------------------use freely--------------------------------------------\n#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;conio.h&gt;\n#include &lt;string.h&gt;\n\n#define bzero(a) memset(a,0,sizeof(a)) //easier -- shortcut\n\nbool IsWinNT()  //check if we're running NT\n{\n  OSVERSIONINFO osv;\n  osv.dwOSVersionInfoSize = sizeof(osv);\n  GetVersionEx(&amp;osv);\n  return (osv.dwPlatformId == VER_PLATFORM_WIN32_NT);\n}\n\nvoid ErrorMessage(char *str)  //display detailed error info\n{\n  LPVOID msg;\n  FormatMessage(\n    FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_FROM_SYSTEM,\n    NULL,\n    GetLastError(),\n    MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), // Default language\n    (LPTSTR) &amp;msg,\n    0,\n    NULL\n  );\n  printf(\"%s: %s\\n\",str,msg);\n  LocalFree(msg);\n}\n\n//---------------------------------------------------------------------------\nvoid rrmain()\n{\n  char buf[1024];           //i/o buffer\n\n  STARTUPINFO si;\n  SECURITY_ATTRIBUTES sa;\n  SECURITY_DESCRIPTOR sd;               //security information for pipes\n  PROCESS_INFORMATION pi;\n  HANDLE newstdin,newstdout,read_stdout,write_stdin;  //pipe handles\n\n  if (IsWinNT())        //initialize security descriptor (Windows NT)\n  {\n    InitializeSecurityDescriptor(&amp;sd,SECURITY_DESCRIPTOR_REVISION);\n    SetSecurityDescriptorDacl(&amp;sd, true, NULL, false);\n    sa.lpSecurityDescriptor = &amp;sd;\n  }\n  else sa.lpSecurityDescriptor = NULL;\n  sa.nLength = sizeof(SECURITY_ATTRIBUTES);\n  sa.bInheritHandle = true;         //allow inheritable handles\n\n  if (!CreatePipe(&amp;newstdin,&amp;write_stdin,&amp;sa,0))   //create stdin pipe\n  {\n    ErrorMessage(\"CreatePipe\");\n    getch();\n    return;\n  }\n  if (!CreatePipe(&amp;read_stdout,&amp;newstdout,&amp;sa,0))  //create stdout pipe\n  {\n    ErrorMessage(\"CreatePipe\");\n    getch();\n    CloseHandle(newstdin);\n    CloseHandle(write_stdin);\n    return;\n  }\n\n  GetStartupInfo(&amp;si);      //set startupinfo for the spawned process\n  /*\n  The dwFlags member tells CreateProcess how to make the process.\n  STARTF_USESTDHANDLES validates the hStd* members. STARTF_USESHOWWINDOW\n  validates the wShowWindow member.\n  */\n  si.dwFlags = STARTF_USESTDHANDLES|STARTF_USESHOWWINDOW;\n  si.wShowWindow = SW_HIDE;\n  si.hStdOutput = newstdout;\n  si.hStdError = newstdout;     //set the new handles for the child process\n  si.hStdInput = newstdin;\n  wchar_t app_spawn[] = L\"c:\\\\windows\\\\system32\\\\cmd.exe\"; //sample, modify for your\n                                                     //system\n\n  //spawn the child process\n  if (!CreateProcess(app_spawn,NULL,NULL,NULL,TRUE,CREATE_NEW_CONSOLE,\n                     NULL,NULL,&amp;si,&amp;pi))\n  {\n    ErrorMessage(\"CreateProcess\");\n    getch();\n    CloseHandle(newstdin);\n    CloseHandle(newstdout);\n    CloseHandle(read_stdout);\n    CloseHandle(write_stdin);\n    return;\n  }\n\n  unsigned long exit=0;  //process exit code\n  unsigned long bread;   //bytes read\n  unsigned long avail;   //bytes available\n\n  std::vector&lt;std::string&gt; commands;\n  commands.push_back(std::string(\"notepad\\n\"));\n\n  bzero(buf);\n  for(;;)      //main program loop\n  {\n    GetExitCodeProcess(pi.hProcess,&amp;exit);      //while the process is running\n    if (exit != STILL_ACTIVE)\n      break;\n    PeekNamedPipe(read_stdout,buf,1023,&amp;bread,&amp;avail,NULL);\n    //check to see if there is any data to read from stdout\n    if (bread != 0)\n    {\n      bzero(buf);\n      if (avail &gt; 1023)\n      {\n        while (bread &gt;= 1023)\n        {\n          ReadFile(read_stdout,buf,1023,&amp;bread,NULL);  //read the stdout pipe\n          qDebug() &lt;&lt; buf;\n          bzero(buf);\n        }\n      }\n      else {\n        ReadFile(read_stdout,buf,1023,&amp;bread,NULL);\n        qDebug() &lt;&lt; buf;\n      }\n    }\n    if( commands.empty() == false )\n    {\n        std::string command = commands.front();\n        commands.erase(commands.begin());\n        bzero(buf);\n        //*buf = (char)getche();\n        strcpy((char*)&amp;buf, command.c_str());\n        //printf(\"%c\",*buf);\n        WriteFile(write_stdin,buf,command.size(),&amp;bread,NULL); //send it to stdin\n        qDebug() &lt;&lt; bread &lt;&lt; \"written\";\n    }\n\n\n  }\n  CloseHandle(pi.hThread);\n  CloseHandle(pi.hProcess);\n  CloseHandle(newstdin);            //clean stuff up\n  CloseHandle(newstdout);\n  CloseHandle(read_stdout);\n  CloseHandle(write_stdin);\n}\n//----------------------------EOF--------------------------------------------\n//---------------------------------------------------------------------------\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["winapi","dialog","focus","require","z-order"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12685463,"title":"Win32 - Make dialog require focus/action","body":"<p>In Win32 programming the MessageBox function launches a dialog that requires action, you cannot give focus to another window in the application until you press 'OK'. Well I have a dialog box that I designed in the resource editor of Visual Studio 2008 and the problem is that I can click the menu-item that launches it, and while that dialog is still being showed I can click it again and show another one of them. Also I can use the rest of my application while the dialog is open.</p>\n\n<p>I would like to make it so that the user must press 'OK' or 'Cancel' on my custom dialog to do anything else at all in the application, as if it were a MessageBox. How would I accomplish this? Is there a specific windows style or ex-style that I can set on my Dialog resource? I have tried WS_TOPMOST but I got no effect, I'm not sure what else to try.</p>\n"},{"tags":["winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":12684339,"title":"Understanding the resource file of a program(Win32)","body":"<p>Say i have a simple Win32 program with a menu, and all syntax is correct. Here is the resource file:</p>\n\n<pre><code>#define IDR_MYMENU                      101\n#define IDI_MYICON                      102\n#define ID_FILE_EXIT                    40001\n#define ID_STUFF_GO                     40002\n#define ID_STUFF_GOSOMEWHEREELSE        40003\n</code></pre>\n\n<p>Im a little confused on the constants declared, could i use any ol number to represent each option? such as:</p>\n\n<pre><code>#define IDR_MYMENU                      23\n#define IDI_MYICON                      412\n#define ID_FILE_EXIT                    40071\n#define ID_STUFF_GO                     40892\n#define ID_STUFF_GOSOMEWHEREELSE        64982\n</code></pre>\n\n<p>or is there something behind those specific numbers? Thanks for any help!</p>\n"},{"tags":["winapi","win32-process"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":12679518,"title":"Win32- Getting ListView Control content from another application","body":"<p>I am trying to access the ListView control (located within an Dialog) in another application, and get the data from within the control. Here is the Win32 code (with appropiate comments) that I am writing :</p>\n\n<pre><code>        HWND hListView32 = hRoot;   //HANDLE to the ListView control within the Dialog, having class name - \"SysListView32\"\n        int cnt = (int) ::SendMessage(hListView32, LVM_GETITEMCOUNT, 0, 0L); //returns CORRECT item count of the ListView Control\n        int nItem=0,nRes;\n\n        for(int nItem=0;nItem&lt;cnt;nItem++)\n        {\n            LVITEM LvItem;  // ListView Item struct\n              char Text[255]={0};  \n              char Temp[255]={0};\n              char Temp1[255]={0};\n\n                memset(&amp;LvItem,0,sizeof(LvItem));\n          LvItem.mask=LVIF_TEXT;\n              LvItem.iSubItem=1;    //Trying to get the 2nd Colomn text\n\n              LvItem.pszText=Text;  //Does not returns any Text, after the below SendMessage is executed???\n\n              LvItem.cchTextMax=256;\n              LvItem.iItem=nItem;\n              nRes  = (int)::SendMessage(hListView32,LVM_GETITEMTEXT, nItem, (LPARAM)&amp;LvItem);\n              DWORD dd = ::GetLastError();  //returns 0\n        }\n</code></pre>\n\n<p>Though the code is executing, I am not getting any data from within the control. However, I am able to retrieve the correct Item count from within the control, but no data.</p>\n\n<p>Another approach maybe would be to use an MSAA hook to get the data. But that would be a very long and cumbersome process. Running out of ideas here. Pls help.</p>\n\n<p>Thanks,</p>\n"},{"tags":["windows","winapi","serial-port"],"answer_count":5,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":3263,"score":5,"question_id":237487,"title":"Basic example of serial communication with Windows XP/win32","body":"<p>I am working with a peripheral device that needs to be communicated through serial.  I can send it commands using HyperTerminal, but now I need to write programs that will let me do it without HyperTerminal.  Can somebody point me to a website and/or show me a sample hello world program to get me started?  I have searched through many sites which give me uncompilable/ancient VC6 code.</p>\n"},{"tags":["multithreading","delphi","winapi","delphi-7","multitasking"],"answer_count":3,"favorite_count":1,"up_vote_count":9,"down_vote_count":0,"view_count":389,"score":9,"question_id":11942827,"title":"Why threads starve even on preemptive multitasking OS (Windows 7)","body":"<p>I wrote a Win32 application (in Delphi-7 which is 32-bit using TThread class) to create 100 threads. Each thread when resumed will continuously (in a loop) increment a 64 bit counter associated with the thread object (so no locking or sharing of data). </p>\n\n<p>If you let the system run for 10 to 15 seconds and stop after that, you should see roughly the same counts in each of the threads. But what I observed was that 81 threads ran under 400 million loops and the remaining ones looped more than 950 million times. Slowest thread got only 230 million compared to the fastest 2111 million. </p>\n\n<p>According to MSDN, the preemptive multitasking is at the thread-level (not process level), so each of my thread should have gotten its time-slice in a round-robin fashion. What am I missing here and why is this discrepancy? </p>\n\n<p>Edit1: Machine configuration: Intel i7 Quad Core 3.4GHz with hyper-threading turned on (8 active threads at a time). Running Windows-7 64 bit professional (and the test application is 32 bit)</p>\n\n<p>Edit2 (thread code): The test application is built with optimization turned on and without any debug info. Run the test application outside of IDE.</p>\n\n<pre><code>type\n\n  TMyThread = class(TThread)\n  protected\n    FCount: Int64;\n  public\n    constructor Create;\n    procedure Execute; override;\n    property Count: Int64 read FCount;\n  end;\n\n\n{ TMyThread }\n\nconstructor TMyThread.Create;\nbegin\n  inherited Create(True);\n  FCount := 0;\nend;  \n\nprocedure TMyThread.Execute;\nbegin\n  inherited;\n  while not Terminated do\n  begin\n    Inc(FCount);\n  end;\nend;\n</code></pre>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":134,"score":2,"question_id":12655314,"title":"Open an executable file without an \".exe\" extension with ShellExecute","body":"<p>I want to open an executable file that have no \".exe\" extension with ShellExecute. I can use CreateProcess but I prefer to use ShellExecute. There is any way to do it?</p>\n\n<p>I use C++ with the win32api functions.</p>\n\n<p>Thank you.</p>\n"},{"tags":["c++","windows","winapi","hbitmap","layered-windows"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":158,"score":0,"question_id":12626729,"title":"Draw HBITMAP onto layered window. What's wrong?","body":"<p>Hello and good day to everyone,</p>\n\n<p>my final target is to draw a PNG file including alpha onto the screen - that means not into an own window but just somewhere on the desktop.\nThe part to load PNG's into a HBITMAP works now (tested that in a diffrent way) but I don't manage to <strong>draw it including alpha.</strong></p>\n\n<p>As far as I've heard the best way to do this would be using alyered windows. So I wroked a lot to redo a couple of examples and tiny tutorials.</p>\n\n<p>The following code compiles without problems and there do not prompt any messages (that means the showError(\"#\") function is never called).</p>\n\n<p><strong>Yet there is <em>nothing</em> visible on the screen :/</strong></p>\n\n<p>Sorry that it is so long... Hope someone would like to look at it at least quickly..</p>\n\n<pre><code>LRESULT CALLBACK WndProc(HWND hWindow, UINT msg, WPARAM wParam, LPARAM lParam);\n\n\nint main(HINSTANCE hInstance)\n{\n\n\n    WNDCLASSEX WndClass;\n    char sClassName[]  = \"mainClass\";\n    WndClass.cbSize     = sizeof(WNDCLASSEX);\n    WndClass.style      = NULL;\n    WndClass.lpfnWndProc   = WndProc;//WndProc;\n    WndClass.cbClsExtra = 0;\n    WndClass.cbWndExtra = 0;\n    WndClass.hInstance  = hInstance;\n    WndClass.hIcon      = NULL;\n    WndClass.hCursor    = LoadCursor(NULL, IDC_ARROW);\n    WndClass.hbrBackground = (HBRUSH)(COLOR_WINDOW+1);\n    WndClass.lpszMenuName  = NULL;\n    WndClass.lpszClassName = sClassName;\n    WndClass.hIconSm    = LoadIcon(NULL, IDI_APPLICATION);\n    if (RegisterClassEx(&amp;WndClass) == 0) showError(\"-1\");\n\n\n\n\n\n    HWND screen = CreateWindowEx(WS_EX_LAYERED,//WS_EX_LEFT\n        \"mainClass\",\n        \"UpdateLayeredWind\",\n        WS_DISABLED | WS_VISIBLE,\n        200,200,260,260,\n        NULL /*eventuelly, GM window*/,\n        NULL,\n        hInstance,\n        NULL);  \n\n\n    if (screen == NULL) showError(\"0\");\n\n\n\n\n        HBITMAP img = LoadImageResource(\"D://ThreadDraw/ThreadDraw-test/ThreadDraw/test.png\");\n            if (img == NULL) showError(\"1\");\n\n\n\n\n\n\n    BLENDFUNCTION blend = {0};\n\n    blend.AlphaFormat = AC_SRC_ALPHA;\n    blend.SourceConstantAlpha = 155;\n\n    POINT ptPos = {200,300};\n    SIZE sizeWnd = {260,260};\n    POINT ptPos2 = {200,300};\n\n\n    ShowWindow(screen, SW_SHOW);\n\n\n\n    while (1)\n    {\n\n\n        PAINTSTRUCT             ps;\n        HDC                     hdc;\n        BITMAP                  bitmap;\n        HDC                     hdcMem;\n        HGDIOBJ                 oldBitmap;\n\n        hdc = BeginPaint(screen, &amp;ps);\n\n        hdcMem = CreateCompatibleDC(hdc);\n        oldBitmap = SelectObject(hdcMem, img);\n\n        GetObject(img, sizeof(bitmap), &amp;bitmap);\n\n\n        if (SetLayout(hdc,LAYOUT_RTL) == GDI_ERROR)\n            showError(\"5\");\n\n\n\n            if (!BitBlt(hdc, 0, 0, 64, 64, hdcMem, 0, 0, SRCCOPY))\n                showError(\"4\");\n\n\n\n            if (!UpdateLayeredWindow(screen,hdcMem,&amp;ptPos,&amp;sizeWnd,hdc,&amp;ptPos2,RGB(255,255,255),&amp;blend,ULW_ALPHA))//ULW_OPAQUE))\n            showError(\"2\");\n\n\n\n        EndPaint(screen, &amp;ps);\n\n        SelectObject(hdcMem, oldBitmap);\n        DeleteDC(hdcMem);\n\n\n        Sleep(10);\n\n    }\n\n\n\n    return 0;\n}\n\n\n\nLRESULT CALLBACK WndProc(HWND hwnd, UINT Message, WPARAM wParam, LPARAM lParam) \n{\n    switch(Message) \n    {\n        case WM_CLOSE:\n            DestroyWindow(hwnd);\n            break;\n        case WM_DESTROY:\n            PostQuitMessage(0);\n            break;\n        default:\n            return DefWindowProc(hwnd, Message, wParam, lParam);\n    }\n    return 0;\n}\n</code></pre>\n\n<p>By the way, if I use ULW_OPAQUE instead of ULW_ALPHA in UpdateLayeredWindow, then a right sized, black window appears so think the issue has to be something minimal related to the PAINTSTRUKT or BitBlt function.. Yet I tried a lot of ways without any change.</p>\n\n<p>Hope someone can help. Thank you very much in advance!</p>\n"},{"tags":["c#",".net","windows","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":95,"score":2,"question_id":12678476,"title":"C# and partially working SendMessage?","body":"<p>I've tried to send text messages to various applications in Windows 7 (eg. Notepad++, Notepad etc.). SendMessage is working fine for Notepad but not for Notepad++.</p>\n\n<p>If i'm sending text to Notepad everything appears fine, whole text and i'm getting 1 as return from SendMessage method. But for Notepad++ only first letter appears and method SendMessage is returning 0, however Marshal.GetLastWin32Error() is not returning any error (result 0)?</p>\n\n<p>Here's the code:</p>\n\n<pre><code>GUITHREADINFO gti = new GUITHREADINFO();\nIntPtr hWnd = GetForegroundWindow();\nuint processId;\nuint activeThreadId = GetWindowThreadProcessId(hWnd, out processId);\nif (GetInfo(activeThreadId, out gti))\n{\n    int EM_REPLACESEL = 0x00C2;\n\n    int error = Marshal.GetLastWin32Error();\n    int result = SendMessageW(gti.hwndCaret, EM_REPLACESEL, -1, passed);//3rd param doesn't change anything\n    error = Marshal.GetLastWin32Error();\n}\n</code></pre>\n\n<p>WinAPI functions and GetInfo method as long with required structures are defined as:</p>\n\n<pre><code>[DllImport(\"User32.dll\", EntryPoint = \"SendMessageW\", SetLastError = true, CharSet = CharSet.Unicode)]\npublic static extern int SendMessageW(IntPtr hWnd, int uMsg, int wParam, string lParam);\n\n[DllImport(\"user32.dll\")]\nstatic extern IntPtr GetForegroundWindow();\n\n[DllImport(\"user32.dll\", SetLastError = true)]\nstatic extern uint GetWindowThreadProcessId(IntPtr hWnd, out uint lpdwProcessId);\n//\"Borrowed\" code\npublic static bool GetInfo(uint hwnd, out GUITHREADINFO lpgui)\n{\n     uint lpdwProcessId;\n     uint threadId = GetWindowThreadProcessId(hwnd, out lpdwProcessId);\n\n     lpgui = new GUITHREADINFO();\n     lpgui.cbSize = Marshal.SizeOf(lpgui);\n\n    return GetGUIThreadInfo(threadId, ref lpgui);\n}\n\n[StructLayout(LayoutKind.Sequential)]\npublic struct RECT\n{\n    public int iLeft;\n    public int iTop;\n    public int iRight;\n    public int iBottom;\n}\n\n[StructLayout(LayoutKind.Sequential)]\npublic struct GUITHREADINFO\n{\n    public int cbSize;\n    public int flags;\n    public IntPtr hwndActive;\n    public IntPtr hwndFocus;\n    public IntPtr hwndCapture;\n    public IntPtr hwndMenuOwner;\n    public IntPtr hwndMoveSize;\n    public IntPtr hwndCaret;\n    public RECT rectCaret;\n}\n</code></pre>\n\n<p>So well i wonder what should i do to fix it so it would work (fully) for all windows not only for edit control in Notepad?</p>\n"},{"tags":["c++","winapi","shared-memory"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12619430,"title":"How to share HGLOBAL with another application?","body":"<p>I'm trying to understand something about <code>HGLOBAL</code>s, because I just found out that what I thought is simply wrong.</p>\n\n<p>In app A I <code>GlobalAlloc()</code> data (with <code>GMEM_SHARE|GMEM_MOVABLE</code>) and place the string <code>\"Test\"</code> in it. Now, what can I give to another application to get to that data?</p>\n\n<p>I though (wrongfully!) that <code>HGLOBAL</code>s are valid in all the processes, which is obviously wrong, because <code>HGLOBAL</code> is a <code>HANDLE</code> to the global data, and not a pointer to the global data (that's where I said \"OHHHH!\").</p>\n\n<p>So how can I pass the <code>HGLOBAL</code> to another application?</p>\n\n<p>Notice: I want to pass just a \"pointer\" to the data, not the data itself, like in the clipboard.</p>\n\n<p>Thanks a lot! :-)</p>\n"},{"tags":["c++","windows","winapi","critical-section"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":12675301,"title":"Why is the OwningThread member of CRITICAL_SECTION of type HANDLE, when it is denoting the thread ID?","body":"<p>I'm trying to add some debug checking for a CRITICAL_SECTION unlocking code, and I tried the following:</p>\n\n<pre><code>...\n  if (m_pCritSect) {\n    ASSERT(m_pCritSect-&gt;OwningThread == GetCurrentThreadId());\n    LeaveCriticalSection(m_pCritSect);\n  }\n}\n</code></pre>\n\n<p>From debugging CRITICAL_SECTIONS (With VS 2005, mostly on WindowsXP) I \"know\" that the value of <code>OwningThread</code> (member of the <code>RTL_CRITICAL_SECTION</code> structure defined in <code>winnt.h</code>) is the value of th <strong>ID</strong> of the thread holding the lock.</p>\n\n<p>However thread IDs are represented by <code>DWORD</code> (typedef for <code>unsigned long</code>) values while this variable has type <code>HANDLE</code> (typedef for <code>void*</code>) requiring <strike>a <code>reinterpret_cast</code> for</strike> the use of the <code>HandleToULong</code> Macro from <code>basetsd.h</code> for the above code to work.</p>\n\n<p>Even the <a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff541979%28v=vs.85%29.aspx\" rel=\"nofollow\">MSDN docs</a> state: </p>\n\n<blockquote>\n  <p>When the first thread calls the EnterCriticalSection routine, (...)\n  OwningThread becomes the thread ID of the caller.</p>\n</blockquote>\n\n<p>So why on earth is this defined as a <code>HANDLE</code>?</p>\n\n<hr>\n\n<p>Edit Note: I found <a href=\"http://www.osronline.com/showthread.cfm?link=136696\" rel=\"nofollow\">a statement</a> where a poster suggests that the HANDLE / DWORD-Id mismatch is some known misfeature of some Windows internals. So maybe this is the case here too:</p>\n\n<blockquote>\n  <p>GetCurrentThreadId returns a DWORD, which I send up to the kernel in a\n  message. PsLookupThreadByThreadId takes the thread Id in a HANDLE, ...\n  ...</p>\n  \n  <p>This is a known Windows API bug (\"known\" in that I talked to the\n  relevant filter manager DEV about this, as it shows up in Filter\n  Manager as well because of the I/O Manager API issue.) As long as you\n  don't have more than a half billion or so threads and processes (they\n  use a single shared handle table) you'll be fine. Maybe by the time\n  that's a real issue, we'll be running something different. [<em>RE: ThreadId to HANDLE for 64 bit?</em>, 08 Aug 08 14:21, Tony Mason]</p>\n</blockquote>\n"},{"tags":["c++","winapi","titlebar","string-conversion","string-building"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12574104,"title":"How to convert a double value to a string in order to output it to a window title bar under Win32","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/332111/how-do-i-convert-a-double-into-a-string-in-c\">How do I convert a double into a string in C++?</a><br>\n  <a href=\"http://stackoverflow.com/questions/1123201/convert-double-to-string-c\">Convert double to string C++?</a>  </p>\n</blockquote>\n\n\n\n<p>Total C++ and Win32 noob here playing around in Visual Studio 2012 land, so bear with me as I sometimes bite off more than I can chew  :)</p>\n\n<p>I have a Win32 app that's simply set up a window using a peekmessage loop for real-time updating. The app runs okay and the Window shows fine. I'd like to print text to the Window title bar displaying the frames per second from a clock / timer class I was provided with.</p>\n\n<p>I've yet to learn GDI / GDI+ or Direct2D &amp; DirectWrite for outputting text and variable values to the client area, so for now I need a simple method of outputting some basic statistics to the Window and I figured the easiest way is to update the window title at this stage. My window class has a SetTitle method that takes a std::wstring so I was wondering how best to build a string from literal text and variable values such as double? As you can likely surmise I'm also unfamiliar with strings beyond the basic std:cout for Console-based apps.</p>\n\n<p>Amazon tells me my Holy <strong><em>'Book of Petzold, 5th Edition'</em></strong> is 3 days away so any tips will be greatly appreciated and you'll make it onto my Christmas card list this year.</p>\n\n<p>Thanks.</p>\n"},{"tags":["winapi","visual-c++","mfc","atl"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12673965,"title":"WinApi, ATL creating context menu function handler","body":"<p>The code below creates a window, implements a CListViewCtrl and tries to make a context menu with 3 options: new, edit &amp; delete.</p>\n\n<pre><code>class CGuiView : public CWindowImpl&lt;CGuiView, CListViewCtrl&gt;\n{\n    HMENU hPopupMenu;\n    MENUINFO m_ContextMenuInfo;\n\npublic:\n    DECLARE_WND_CLASS(NULL)\n\n    BOOL PreTranslateMessage(MSG* pMsg)\n    {\n        pMsg;\n        return FALSE;\n    }\n\n    BEGIN_MSG_MAP(CGuiView)\n        MESSAGE_HANDLER(WM_PAINT, OnPaint)\n    //  MESSAGE_HANDLER(WM_LBUTTONUP,)\n         MSG_WM_CONTEXTMENU(OnContextMenu) \n         COMMAND_ID_HANDLER(ID_CTXMENU_NEW, OnNewTask)\n    END_MSG_MAP()\n\n\n    LRESULT OnPaint(UINT /*uMsg*/, WPARAM /*wParam*/, LPARAM /*lParam*/, BOOL&amp; /*bHandled*/)\n    {\n        CPaintDC dc(m_hWnd);\n\n        //TODO: Add your drawing code here\n\n        return 0;\n    }\n     void OnContextMenu ( HWND hwndCtrl, CPoint ptClick )\n    {\n\n\n        hPopupMenu = CreatePopupMenu();\n\n        InsertMenu(hPopupMenu,  0, MF_BYCOMMAND | MF_STRING, ID_CTXMENU_DELETE, TEXT(\"Delete\"));\n        InsertMenu(hPopupMenu, ID_CTXMENU_DELETE, MF_BYCOMMAND | MF_STRING, ID_CTXMENU_EDIT, TEXT(\"Edit\"));\n        InsertMenu(hPopupMenu, ID_CTXMENU_EDIT, MF_BYCOMMAND | MF_STRING | MF_ENABLED, ID_CTXMENU_NEW , TEXT(\"New\"));\n\n        TrackPopupMenu(hPopupMenu, TPM_TOPALIGN | TPM_LEFTALIGN, ptClick.x, ptClick.y, 0,GetParent(), NULL); \n\n\n    }\n\n    LRESULT OnNewTask(WORD /*wNotifyCode*/, WORD /*wID*/, HWND /*hWndCtl*/, BOOL&amp; /*bHandled*/)\n    {\n\n        CAboutDlg dlg;\n        dlg.DoModal();\n        return 0;\n    }\n\n};\n</code></pre>\n\n<p>The problem is that the code above does not enter OnNewTask when I click on the New menu item that I create in the OnContextMenu function. What I am doing wrong?</p>\n"},{"tags":["c#","winapi","process","embed","handler"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":156,"score":0,"question_id":12653418,"title":"Why can't I embed these Applications in my Form?","body":"<h2>Intention</h2>\n\n<p>Using the following code, I managed to load some applications in my windows form.</p>\n\n<h2>Code</h2>\n\n<p>What this function does is...</p>\n\n<ul>\n<li>stating a process</li>\n<li>embedding the process into a panel of my form</li>\n<li>maximizing the embedded process</li>\n<li>adding a resize event handler to the panel to update the size of the embedded process on panel resize</li>\n<li>adding a closed event handler to the form to terminate the embedded process on form close</li>\n</ul>\n\n<p>Usings</p>\n\n<pre><code>using System;\nusing System.Diagnostics;\nusing System.Runtime.InteropServices;\nusing System.Windows.Forms;\n</code></pre>\n\n<p>Constants</p>\n\n<pre><code>const int   GWL_STYLE   = -16;\nconst long  WS_VISIBLE  = 0x10000000,\n            WS_MAXIMIZE = 0x01000000,\n            WS_BORDER   = 0x00800000,\n            WS_CHILD    = 0x40000000;\n</code></pre>\n\n<p>Function</p>\n\n<pre><code>IntPtr LoadExtern(Control Panel, string Path)\n{\n    try\n    {\n        Process Process = Process.Start(Path);\n        Process.WaitForInputIdle();\n        IntPtr Handle = Process.MainWindowHandle;\n        SetParent(Handle, Panel.Handle);\n        SetWindowLong(Handle, GWL_STYLE, (int)(WS_VISIBLE+(WS_MAXIMIZE|WS_BORDER)));\n\n        MoveWindow(Handle, 0, 0, Panel.Width, Panel.Height, true);\n\n        Panel.Resize += new EventHandler(\n             delegate(object sender, EventArgs e)\n             {\n                  MoveWindow(Handle, 0, 0, Panel.Width, Panel.Height, true);\n             }\n        );\n\n        this.FormClosed += new FormClosedEventHandler(\n             delegate(object sender, FormClosedEventArgs e) {\n                  SendMessage(Handle, 83, 0, 0);\n                  Thread.Sleep(1000);\n                  Handle = IntPtr.Zero;\n             }\n        );\n\n        return Handle;\n    }\n    catch (Exception e) { MessageBox.Show(this, e.Message, \"Error\"); }\n    return new IntPtr();\n}\n</code></pre>\n\n<p>DLL Imports</p>\n\n<pre><code>[DllImport(\"user32.dll\")]\nstatic extern IntPtr SetParent(IntPtr hWndChild, IntPtr hWndNewParent);\n\n[DllImport(\"user32.dll\")]\nstatic extern int SetWindowLong(IntPtr hWnd, int nIndex, int dwNewLong);\n\n[DllImport(\"user32.dll\")]\nstatic extern bool MoveWindow(IntPtr Handle, int x, int y, int w, int h, bool repaint);\n\n[DllImport(\"user32.dll\")]\nstatic extern IntPtr SendMessage(IntPtr Handle, int Msg, int wParam, int lParam);\n</code></pre>\n\n<h2>Result</h2>\n\n<p>This code works nice with some applications, like the windows notepad. Notepad is started and included in the panel of my form. There is no caption and the are no borders, as it should be.</p>\n\n<pre><code>LoadExtern(panel1, \"notepad.exe\");\n</code></pre>\n\n<p>After closing the form the embedded process gets terminated like expected.</p>\n\n<h2>Problem</h2>\n\n<p>Unfortunately my code doesn't work for some other (bigger) applications like firefox or sublimetext. </p>\n\n<pre><code>LoadExtern(panel2, @\"C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe\");\n</code></pre>\n\n<p>What happens is that my form starts and firefox starts, but in its own window. Could you help me to include sublimetext or firefox in my applications?</p>\n\n<h2>Part of the solution</h2>\n\n<p>Thanks to Sheng Jiang's answers, I got it working for some more applications. What I did is to wait for a main window handle.</p>\n\n<pre><code>Process.WaitForInputIdle();\nIntPtr Handle = new IntPtr();\nfor (int i = 0; Handle == IntPtr.Zero &amp;&amp; i &lt; 300; i++)\n{\n     Handle = Process.MainWindowHandle;\n     Thread.Sleep(10);\n}\n</code></pre>\n\n<p>But I still can't embed applications like the windows explorer.</p>\n"},{"tags":["winapi","cryptography","ocsp"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":12636659,"title":"OCSP responses inside CertGetCertificateChain function","body":"<p>Is there way to get all OCSP responses which obtained by CryptoAPI during certificate chain building (<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa376078%28v=vs.85%29.aspx\" rel=\"nofollow\">CertGetCertificateChain</a> function)? </p>\n\n<p>I can get CRLs by structure <code>CERT_REVOCATION_CRL_INFO</code> related to <code>CERT_CHAIN_ELEMENT</code>, but I need OCSP responses too.</p>\n"},{"tags":["winapi","sendinput"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12663940,"title":"How to write strings to other application?","body":"<p>How to use the windows API to communicate with other applications?</p>\n\n<p>For example, another application has a textbox, I have already set mouse on there using mouse_event, but I don't know how to send a string to it, and display the string on that textbox?  </p>\n"},{"tags":["winapi","visual-c++","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12671527,"title":"mfc message pump vs win32 message loop","body":"<p>Well,I am bit confused.Things looked nice when I studies message loop in windows programming from Programming Windows,Charles Petzold.I completed initial 3 chapters(windows messages,message loops and stuff) and thought to plunge into MFC,so now has taken up 'Programming Windows with MFC,Jeff Prosise'.</p>\n\n<p>Now the question is 'Is message pump in MFC is same as message loop in Win32 programming'?\nOr is it different concept?If different what does that mean?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c++","winapi","visual-studio-2008","combobox"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":877,"score":0,"question_id":6202299,"title":"How to get combo-box display values using the Data field?","body":"<p>I have set the combo-box data to \"first;second;third\" in the resource editor, but when I compile the program, the combo-box is totally empty, I can't see there any items at all.</p>\n\n<p>Also, how do I set which item is selected by default ? And how do I change the currently selected item programmatically ?</p>\n"},{"tags":["c++","multithreading","winapi","windows-7","windows-7-x64"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12670097,"title":"What is the purpose of this mysterious _TppWaiterpThread thread","body":"<p>Consider this code sample for LookupPrivilegeValue taken from <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa446619%28v=vs.85%29.aspx\" rel=\"nofollow\">MSDN</a> (with minor code formatting edits)</p>\n\n<pre><code>BOOL SetPrivilege(HANDLE hToken, LPCTSTR lpszPrivilege, BOOL bEnablePrivilege) {\nTOKEN_PRIVILEGES tp;\nLUID luid;\n\nif ( !LookupPrivilegeValue(NULL, lpszPrivilege, &amp;luid ) )  {\n    printf(\"LookupPrivilegeValue error: %u\\n\", GetLastError() ); \n    return FALSE; \n}\n// SET A BREAKPOINT BELOW, notice a new thread was created\ntp.PrivilegeCount = 1;\ntp.Privileges[0].Luid = luid;\nif (bEnablePrivilege) {\n    tp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;\n}\nelse {\n    tp.Privileges[0].Attributes = 0;\n}\n// Enable the privilege or disable all privileges.\nif ( !AdjustTokenPrivileges( hToken, FALSE, &amp;tp, sizeof(TOKEN_PRIVILEGES), \n(PTOKEN_PRIVILEGES) NULL, (PDWORD) NULL) ) { \n      printf(\"AdjustTokenPrivileges error: %u\\n\", GetLastError() ); \n      return FALSE; \n} \n\nif (GetLastError() == ERROR_NOT_ALL_ASSIGNED) {\n      printf(\"The token does not have the specified privilege. \\n\");\n      return FALSE;\n} \nreturn TRUE;\n}\n</code></pre>\n\n<p>Using VS 2010/2008 debugger after the first call to LookupPrivilegeValue I've noticed that a new worker thread called _TppWaiterpThread@4 was created. This thread lives until the process exits and its stack trace is the following:</p>\n\n<pre><code>ntdll.dll!_KiFastSystemCallRet@0()  \nntdll.dll!_ZwWaitForMultipleObjects@20()  + 0xc bytes   \nntdll.dll!_TppWaiterpThread@4()  + 0x12c bytes  \nkernel32.dll!@BaseThreadInitThunk@12()  + 0x12 bytes    \nntdll.dll!___RtlUserThreadStart@8()  + 0x27 bytes   \nntdll.dll!__RtlUserThreadStart@8()  + 0x1b bytes    \n</code></pre>\n\n<p>Tested on Windows 7 x86/x64 (remote/local debugging). I tried setting two privileges SE_DEBUG_NAME &amp; SE_SYSTEM_NAME. This is how I've called SetPrivilege:</p>\n\n<pre><code>HANDLE hProcess;\nhProcess = OpenProcess(PROCESS_ALL_ACCESS, NULL, GetCurrentProcessId());\nSetPrivilege(hProcess, SE_SYSTEMTIME_NAME, TRUE);\n//SetPrivilege(hProcess, SE_DEBUG_NAME, TRUE);\n</code></pre>\n\n<p>On XP this new thread does not appear.</p>\n\n<p>So my questions are:</p>\n\n<ul>\n<li>What is the purpose of this _TppWaiterpThread thread?  </li>\n<li>Is LookupPrivilegeValue creating this thread behind the scenes to complete its work?</li>\n</ul>\n"},{"tags":["c#","winforms","visual-studio","winapi","uisplitviewcontroller"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12670092,"title":"Fix a Split Container Control in Windows Forms","body":"<p>I am using Visual Studio to coding Windows Forms applications. There is a control named Split Container in the toolbox.</p>\n\n<p>This Control provides two connected panels which are separated where their edges touch. The user can resize these two panels by dragging the separator between them.</p>\n\n<p><img src=\"http://i.stack.imgur.com/kpJZd.png\" alt=\"enter image description here\"></p>\n\n<p>What I want is to fix the separator so that the user can't drag it anymore. I want to do that in runtime so that the separator can be fixed and variable again. I didn't saw a property for fixing the separator.</p>\n\n<p><strong>How can I fix the separator of a Split Container?</strong></p>\n"},{"tags":["delphi","winapi","windows-7","resizable","flyout"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":461,"score":5,"question_id":7408768,"title":"How to make a window like Windows 7 Notifications Flyouts, (WS_THICKFRAME but NOT-RESIZABLE)","body":"<p>I just made a <a href=\"http://vitimtk.blogspot.com/2011/09/ibrightness-tray.html\">small app here</a> in Delphi 7 that simulates the default system icons, like Volume, Battery, Clock, Network.  </p>\n\n<p>I'm trying to follow all Microsoft recomendations here <a href=\"http://msdn.microsoft.com/en-us/library/aa511448.aspx#flyouts\">http://msdn.microsoft.com/en-us/library/aa511448.aspx#flyouts</a></p>\n\n<p>To make a window look like a flyout, i'm using this code:</p>\n\n<pre><code>//declaration\n\nTForm1 = class(TForm)\n\nprotected\n  procedure CreateParams(var Params: TCreateParams); override;\nend;\n</code></pre>\n\n<p>implementation</p>\n\n<pre><code>procedure TForm1.CreateParams(var Params: TCreateParams);\nbegin\n  inherited;\n  Params.Style := WS_POPUP or WS_THICKFRAME;\n  Params.ExStyle := Params.ExStyle or WS_EX_TOPMOST;\nend;\n</code></pre>\n\n<p><strong>My problem is the WS_THICKFRAME allows user to resize the window. How can I fix this?</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/VSr3S.jpg\" alt=\"Resizable Window Issue\"></p>\n"},{"tags":["c++","winapi","window"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12667302,"title":"Which OO Framework provides the smoothest transition from the C WinAPI: VCL, MFC, or qt?","body":"<p>I am interested in the pros and cons of these three frameworks, for someone who is used to the WinAPI/C environment. The code to be turned OO is not very complex: about 3000 lines of code, mostly controls. I would like to make the program OO, to make it maintainable by others down the road. At the moment it is a big ball of C mud, and I want to recode it in C++ OO. </p>\n\n<p>Which of those frameworks should I use? </p>\n"},{"tags":["c","windows","winapi","gcc"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":61,"score":1,"question_id":12651202,"title":"How do I link to libraries when compiling a win32 project with gcc?","body":"<p>I am trying to compile a basic hello word winform application with gcc on Win 7. </p>\n\n<p>The code is this: </p>\n\n<pre><code>/*\n\n  WINHELLO.C\n\n  \"Hello, world!\", Win32 style.\n\n*/\n\n#include &lt;windows.h&gt;\n\nLRESULT CALLBACK WndProc(HWND, UINT, WPARAM, LPARAM);\n\n\n/*  WinMain(), our entry point  */\n\nint WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance,\n           LPSTR szCmdLine, int iCmdShow) {\n    static char szAppName[] = \"winhello\";\n    HWND        hwnd;\n    MSG         msg;\n    WNDCLASSEX  wndclass;\n\n\n    /*  Fill in WNDCLASSEX struct members  */\n\n    wndclass.cbSize         = sizeof(wndclass);\n    wndclass.style          = CS_HREDRAW | CS_VREDRAW;\n    wndclass.lpfnWndProc    = WndProc;\n    wndclass.cbClsExtra     = 0;\n    wndclass.cbWndExtra     = 0;\n    wndclass.hInstance      = hInstance;\n    wndclass.hIcon          = LoadIcon(NULL, IDI_APPLICATION);\n    wndclass.hIconSm        = LoadIcon(NULL, IDI_APPLICATION);\n    wndclass.hCursor        = LoadCursor(NULL, IDC_ARROW);\n    wndclass.hbrBackground  = (HBRUSH) GetStockObject(WHITE_BRUSH);\n    wndclass.lpszClassName  = szAppName;\n    wndclass.lpszMenuName   = NULL;\n\n\n    /*  Register a new window class with Windows  */\n\n    RegisterClassEx(&amp;wndclass);\n\n\n    /*  Create a window based on our new class  */\n\n    hwnd = CreateWindow(szAppName, \"Hello, world!\",\n            WS_OVERLAPPEDWINDOW,\n            CW_USEDEFAULT, CW_USEDEFAULT,\n            CW_USEDEFAULT, CW_USEDEFAULT,\n            NULL, NULL, hInstance, NULL);\n\n\n    /*  Show and update our window  */\n\n    ShowWindow(hwnd, iCmdShow);\n    UpdateWindow(hwnd);\n\n\n    /*  Retrieve and process messages until we get WM_QUIT  */\n\n    while ( GetMessage(&amp;msg, NULL, 0, 0) ) {\n    TranslateMessage(&amp;msg);    /*  for certain keyboard messages  */\n    DispatchMessage(&amp;msg);     /*  send message to WndProc        */\n    } \n\n\n    /*  Exit with status specified in WM_QUIT message  */\n\n    return msg.wParam;\n}\n\n\n/*  Window procedure  */\n\nLRESULT CALLBACK WndProc(HWND hwnd, UINT iMsg, WPARAM wParam, LPARAM lParam) {\n    PAINTSTRUCT ps;\n    HDC         hdc;\n\n\n    /*  Switch according to what type of message we have received  */\n\n    switch ( iMsg ) {\n    case WM_PAINT:\n\n    /*  We receive WM_PAINT every time window is updated  */\n\n    hdc = BeginPaint(hwnd, &amp;ps);\n    TextOut(hdc, 100, 100, \"Hello, world!\", 13);\n    EndPaint(hwnd, &amp;ps);\n    return 0;\n\n    case WM_DESTROY:\n\n    /*  Window has been destroyed, so exit cleanly  */\n\n    PostQuitMessage(0);\n    return 0;\n    }\n\n\n    /*  Send any messages we don't handle to default window procedure  */\n\n    return DefWindowProc(hwnd, iMsg, wParam, lParam);\n}\n</code></pre>\n\n<p>The command I give to the compiler is <code>gcc C:\\Users\\Bobby\\Desktop\\myfile.c</code></p>\n\n<p>Well, it looks for libraries: </p>\n\n<pre><code>C:\\Users\\Bobby\\desktop&gt;gcc C:\\Users\\Bobby\\Desktop\\myfile.c\nC:\\Users\\Bobby\\AppData\\Local\\Temp\\ccT0bq97.o:myfile.c:(.text+0x88): undefined reference to `GetStockObject@4'\nC:\\Users\\Bobby\\AppData\\Local\\Temp\\ccT0bq97.o:myfile.c:(.text+0x1db): undefined reference to `TextOutA@20'\ncollect2: ld returned 1 exit status\nPS C:\\Users\\Scruffy\\desktop&gt; .\\build.bat\n\nC:\\Users\\Bobby\\desktop&gt;gcc C:\\Users\\Bobby\\Desktop\\myfile.c -I Gdi32.lib\nC:\\Users\\Bobby\\AppData\\Local\\Temp\\ccylV5js.o:myfile.c:(.text+0x88): undefined reference to `GetStockObject@4'\nC:\\Users\\Bobby\\AppData\\Local\\Temp\\ccylV5js.o:myfile.c:(.text+0x1db): undefined reference to `TextOutA@20'\ncollect2: ld returned 1 exit status\nPS C:\\Users\\Bobby\\desktop&gt; C:\\MinGW\\\n</code></pre>\n\n<p>I did some googling and well I found out that this first <code>GetStockObject@4</code> is in a file called Gdi32.lib . So i searched my harddrive and through MinGW and could not locate it. Where is the Lib to locate this function and what is the way to link to it? Also I think I must link to <code>TextOutA@20</code></p>\n"},{"tags":["c++","c","winapi","struct","initialization"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1475,"score":4,"question_id":3853339,"title":"Any reason to prefer memset/ZeroMemory to value initialization for WinAPI structs?","body":"<p>In Win32 programming a handful of POD structs is used. Those structs often need to be zeroed out before usage.</p>\n\n<p>This can be done by calling <code>memset()</code>/<code>ZeroMemory()</code></p>\n\n<pre><code>STRUCT theStruct;\nZeroMemory( &amp;theStruct, sizeof( theStruct ) );\n</code></pre>\n\n<p>or by value initialization:</p>\n\n<pre><code>STRUCT theStruct = {};\n</code></pre>\n\n<p>Although <a href=\"http://stackoverflow.com/questions/1998752/which-one-to-use-memset-or-value-initialization-to-zero-out-a-struct\">the two variants above are not equivalent in general</a>:</p>\n\n<ul>\n<li>treat padding differently</li>\n<li>treat non-POD member variables differently</li>\n</ul>\n\n<p>in case of POD structs used in Win32 they look equivalent.</p>\n\n<p>Are there any cases when <code>memset()</code>/<code>ZeroMemory()</code> should be used instead of value initialization with Win32 POD structs?</p>\n"},{"tags":["windows","delphi","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":123,"score":3,"question_id":12645417,"title":"Can Delphi themed toolbars have dividers that are centred between their tool buttons?","body":"<p>I have noticed a rather annoying oddity with Delphi toolbars. I have a <code>TToolbar</code> that has logical groups of icons. To make the grouping stand out I would like to use separator buttons, with style <code>tbsDivider</code>.</p>\n\n<p>When I do this, it looks like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/BkJr3.png\" alt=\"enter image description here\"></p>\n\n<p>Note the double vertical lines between each icon. The right hand one is in the middle of the separator tool button. The left hand one is on the left edge of the separator tool button.</p>\n\n<p>So, I can switch to <code>tbsSeparator</code> which removes the middle line:</p>\n\n<p><img src=\"http://i.stack.imgur.com/oVpNg.png\" alt=\"enter image description here\"></p>\n\n<p>But I'm not keen on that since I'd like the divider to be in the middle.</p>\n\n<p>I looked at an ancient version of my real app and found that it had centred separators. It seems that is possible when Windows themes are disabled.  Here's what it looks like with <code>tbsDivider</code> and the application manifest removed:</p>\n\n<p><img src=\"http://i.stack.imgur.com/3qqie.png\" alt=\"enter image description here\"></p>\n\n<p>That's the layout I am looking for. Is this attainable when themes are active?</p>\n\n<p>I did find a discussion of the issue on the Embarcadero forums, but there was no useful insight: <a href=\"https://forums.embarcadero.com/message.jspa?messageID=467842\" rel=\"nofollow\">https://forums.embarcadero.com/message.jspa?messageID=467842</a></p>\n\n<p>For sake of completeness, here's the pertinent extract from the .dfm file</p>\n\n<pre><code>object ToolButton1: TToolButton\n  Left = 0\n  Top = 0\n  ImageIndex = 0\nend\nobject ToolButton2: TToolButton\n  Left = 23\n  Top = 0\n  Width = 16\n  ImageIndex = 1\n  Style = tbsDivider\nend\nobject ToolButton3: TToolButton\n  Left = 39\n  Top = 0\n  ImageIndex = 1\nend\nobject ToolButton4: TToolButton\n  Left = 62\n  Top = 0\n  Width = 16\n  ImageIndex = 2\n  Style = tbsDivider\nend\nobject ToolButton5: TToolButton\n  Left = 78\n  Top = 0\n  ImageIndex = 2\nend\n</code></pre>\n"},{"tags":["c++","windows","winapi","visual-c++","c++-standard-library"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":9644092,"title":"Visual C++ Standard Library keywords","body":"<p>I wanted to write a unicode version of std::exception and std::runtime_error.<br>\nSo I thought what better way then to just take implementations from the C++ Standard Library and alter them to support unicode.</p>\n\n<p>So I pulled up the <i>exception</i> and <i>stdexcept</i> headers in Visual C++, copied the code, made my changes.</p>\n\n<p>The thing is I couldn't get it to link unless I removed the <code>_CRTIMP_PURE</code>.\nI also removed the <code>_EXCEPTION_INLINE __CLR_OR_THIS_CALL</code> prefix from all the member functions.</p>\n\n<p>It's working but I'm very curious what all those things did.<br>\n<code>_EXCEPTION_INLINE</code> it literally defined right above it as <code>#define _EXCEPTION_INLINE</code>, and my googling skills can't find any documentation on what they do.</p>\n\n<p>So, does anyone know what these are meant to do? And why it wound't link until I removed the <code>_CRTIMP_PURE</code> prefix from the class?</p>\n"},{"tags":["c++","winapi","hook"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12662606,"title":"C++ simple hooks and hiding command prompt","body":"<p>I am new to C++ and have just learned about hooks so I have a C++ program which runs a function when a KeyEvent occurs:</p>\n\n<pre><code>LRESULT WINAPI KeyEvent(int nCode, WPARAM wParam, LPARAM lParam)\n{  \n  //Do C++ stuff\n}\n</code></pre>\n\n<p>This is my only hook so far.</p>\n\n<p>However I want to hide the command prompt which pops up when executing my code.</p>\n\n<p>I was told I can use this snippet to hide it:</p>\n\n<pre><code>HWND Stealth;\nAllocConsole();\nStealth = FindWindowA(\"ConsoleWindowClass\", NULL);\nShowWindow(Stealth,0);  \n</code></pre>\n\n<p>However if I place it in the hook it will not hide the prompt until a key is pressed (not ideal) and if I place it above the hook (near top of program) I get an error...</p>\n\n<p>So my question is, is there any other types of hooks which I can place the snippet in to hide the command prompt once program is ran? -Or is there any other way like my snippet to hide command prompts which I can use?</p>\n\n<p>Thanks alot. </p>\n"},{"tags":["c++","api","winapi","menu","icons"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":174,"score":0,"question_id":12663717,"title":"How to add icons to menu items in c++ win32 API","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10181063/insertmenu-appendmenu-how-to-add-icons-to-menu-and-submenus-using-c-and-win3\">InsertMenu/AppendMenu - How to add Icons to menu and submenus using C++ and win32</a>  </p>\n</blockquote>\n\n\n\n<p>Hello I have a menu in c++ here is the code of it</p>\n\n<pre><code>HMENU hMenu = CreateMenu();\nHMENU hFileMenu = CreatePopupMenu;\nHMENU HFileOpen = CreateMenu;\n\nAppendMenu(hFileMenu, MF_STRING, (UINT)hFileOpen, \"Open\");\nAppendMenu(hMenu, MF_STRING | MF_POPUP, (UINT)hFileMenu, \"File\");\n\nSetMenu(hwnd,hMenu);\n</code></pre>\n\n<p>I have been looking all over the internet and I can't seen to find a tutorial on how to make bitmaps for the menu item.\nI want to add a bitmap for hFileOpen.\nHow would I do it?</p>\n"},{"tags":["python","windows","winapi","python-2.7","pywin32"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":12659719,"title":"Windows:What actually happens when Ctrl+C is pressed in windows explorer","body":"<p>I am designing a Copy/Paste Application for Windows os using Python.Now I want to a Register my application with hotkey for \"Ctrl+V\" So that when any one press \"Ctrl+V\" Paste is done through my application and not through windows default Copy/Paste application.But I don't know how to get the list of files path which are to be copied and also the path of Target window where paste is to be done.So I want to know what actually happens when someone presses Ctrl+C key in windows explorer</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":12658018,"title":"How to determine which way the mouse is being dragged (Win32, C++)","body":"<p>I am currently working on a project which requires me to know when the mouse is being dragged to the left, or to the right.</p>\n\n<p>What I would like to do with this information, is drag an object in 3d space (with OpenGL/Win32), left, or right, depending on which way the mouse was dragged.</p>\n\n<p>The problem is, I have no idea how to determine which way the mouse is being dragged.</p>\n\n<p>I tried finding the previous x coordinate, and subtracting it from the current x coordinate, but I do not know how to determine the previous x coordinate!</p>\n\n<p>Can someone please help me?</p>\n\n<p>(<strong>P.S.</strong> I already know that the current x mouse location is found with LOWORD(lParam), but what I do not know is how to determine the previous x mouse location. Thanks for your time.)</p>\n"},{"tags":["c#",".net","wpf","winapi","windows-7"],"answer_count":3,"favorite_count":6,"up_vote_count":34,"down_vote_count":0,"view_count":3760,"score":34,"question_id":5493149,"title":"How do I make a WPF window movable by dragging the extended window frame?","body":"<p>In applications like Windows Explorer and Internet Explorer, one can grab the extended frame areas beneath the title bar and drag windows around.</p>\n\n<p>For WinForms applications, forms and controls are as close to native Win32 APIs as they can get; one would simply override the <code>WndProc()</code> handler in their form, process the <a href=\"http://msdn.microsoft.com/en-us/library/ms645618%28VS.85%29.aspx\" rel=\"nofollow\"><code>WM_NCHITTEST</code></a> window message and trick the system into thinking a click on the frame area was really a click on the title bar by returning <code>HTCAPTION</code>. I've done that in my own WinForms apps to delightful effect.</p>\n\n<p>In WPF, I can also implement a similar <code>WndProc()</code> method and hook it to my WPF window's handle while extending the window frame into the client area, like this:</p>\n\n<pre><code>// In MainWindow\n// For use with window frame extensions\nprivate IntPtr hwnd;\nprivate HwndSource hsource;\n\nprivate void Window_SourceInitialized(object sender, EventArgs e)\n{\n    try\n    {\n        if ((hwnd = new WindowInteropHelper(this).Handle) == IntPtr.Zero)\n        {\n            throw new InvalidOperationException(\"Could not get window handle for the main window.\");\n        }\n\n        hsource = HwndSource.FromHwnd(hwnd);\n        hsource.AddHook(WndProc);\n\n        AdjustWindowFrame();\n    }\n    catch (InvalidOperationException)\n    {\n        FallbackPaint();\n    }\n}\n\nprivate IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)\n{\n    switch (msg)\n    {\n        case DwmApiInterop.WM_NCHITTEST:\n            handled = true;\n            return new IntPtr(DwmApiInterop.HTCAPTION);\n\n        default:\n            return IntPtr.Zero;\n    }\n}\n</code></pre>\n\n<p>The problem is that, since I'm blindly setting <code>handled = true</code> and returning <code>HTCAPTION</code>, clicking <em>anywhere</em> but the window icon or the control buttons causes the window to be dragged. That is, everything highlighted in red below causes dragging. This even includes the resize handles at the sides of the window (the non-client area). My WPF controls, namely the text boxes and the tab control, also stop receiving clicks as a result:</p>\n\n<p><img src=\"http://i.stack.imgur.com/7J27H.png\" alt=\"\"></p>\n\n<p>What I want is for only</p>\n\n<ol>\n<li>the title bar, and</li>\n<li>the regions of the client area...</li>\n<li>... that aren't occupied by my controls</li>\n</ol>\n\n<p>to be draggable. That is, I only want these red regions to be draggable (client area + title bar):</p>\n\n<p><img src=\"http://i.stack.imgur.com/dhOoX.png\" alt=\"\"></p>\n\n<p>How do I modify my <code>WndProc()</code> method and the rest of my window's XAML/code-behind, to determine which areas should return <code>HTCAPTION</code> and which shouldn't? I'm thinking something along the lines of using <code>Point</code>s to check the location of the click against the locations of my controls, but I'm not sure how to go about it in WPF land.</p>\n\n<p><strong>EDIT [4/24]:</strong> one simple way about it is to have an invisible control, or even the window itself, respond to <code>MouseLeftButtonDown</code> by invoking <code>DragMove()</code> on the window (see <a href=\"http://stackoverflow.com/questions/5493149/how-do-i-make-a-wpf-window-movable-by-dragging-the-extended-window-frame/5773515#5773515\">Ross's answer</a>). The problem is that for some reason <code>DragMove()</code> doesn't work if the window is maximized, so it doesn't play nice with Windows 7 Aero Snap. Since I'm going for Windows 7 integration, it's not an acceptable solution in my case.</p>\n"},{"tags":["winapi","ip","latency","packets"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":134,"score":0,"question_id":3933573,"title":"IP packet / timeout / interval control","body":"<p>Without a novel, I'll try to explain and hope it makes sense.  </p>\n\n<p>We have an app that handles sending data to a server via simple HTTPS, no problem all works fine.  HOWEVER, if the packets are sent via a satellite phone, the latency of transmissions is a lot longer than the typical milliseconds handled on land-line high-speed network access.  So, the exact same packets being sent out are broken up automatically via Windows API when through the following functions:</p>\n\n<pre><code>DECLARE INTEGER InternetOpen IN WININET.DLL\nDECLARE INTEGER InternetCloseHandle IN WININET.DLL\nDECLARE INTEGER InternetConnect IN WININET.DLL\nDECLARE INTEGER HttpOpenRequest IN WININET.DLL\nDECLARE INTEGER InternetQueryOption IN WININET.DLL\nDECLARE INTEGER InternetSetOption IN WININET.DLL\nDECLARE INTEGER HttpSendRequest IN WININET.DLL\nDECLARE INTEGER HttpQueryInfo IN WININET.DLL\nDECLARE INTEGER InternetReadFile IN WININET.DLL\n</code></pre>\n\n<p>I am not specifically controlling the \"packets\", just building an entire request and sending it and get an answer.</p>\n\n<p>What APPEARS to be happening is this.  The packets are getting split into smaller chunks as typical with a large amount of data.  However, by the time the get to the satellite, they are NOT re-assembled in the correct sequence thus acceptance at the final destination fails.</p>\n\n<p>So, now the question...  Is there a way I can specifically let Windows know to slow down the frequency that packets are sent out to HELP prevent the latency issues?  Since we don't have access to the satellite system,  we can't prove this is the issue, but it appears they get the packets, just don't put them back together in the correct sequence.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","windows","winapi","pinvoke","dbghelp"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":601,"score":2,"question_id":4606628,"title":"Viewing export table on an unmanaged dll in C#","body":"<p>I am currently trying to create a C# application that will allow me to view the export table from an unmanaged DLL. My problem is, once I have all the pointers I need, I have no idea how to loop through the information that the API has provided me. Here is what I have right now:</p>\n\n<pre><code>using System;\nusing System.ComponentModel;\nusing System.Runtime.InteropServices;\n\nnamespace DLLMapper\n{\nclass DLLExportViewer\n{\n        #region APIs\n        [DllImport(\"imagehlp.dll\")]\n        public static extern Boolean MapAndLoad(String ImageName, String DllPath, ref LOADED_IMAGE LoadedImage, Boolean DotDll, Boolean ReadOnly);\n\n        [DllImport(\"imagehlp.dll\")]\n        public static extern Boolean UnMapAndLoad(ref LOADED_IMAGE LoadedImage);\n\n        [DllImport(\"dbghelp.dll\")]\n        public static extern IntPtr ImageDirectoryEntryToData(IntPtr Base, Boolean MappedAsImage, UInt16 DirectoryEntry, ref Int32 Size);\n\n        [DllImport(\"dbghelp.dll\")]\n        public static extern IntPtr ImageRvaToVa(ref IMAGE_NT_HEADERS NtHeaders, IntPtr Base, UInt32 Rva, ref IMAGE_SECTION_HEADER LastRvaSection);\n        #endregion\n\n        #region Structures\n        [StructLayout(LayoutKind.Sequential, Pack = 4)]\n        public struct LOADED_IMAGE\n        {\n            public String ModuleName;\n            public IntPtr hFile;\n            public IntPtr MappedAddress;\n            public IMAGE_NT_HEADERS FileHeader;\n            public IMAGE_SECTION_HEADER LastRvaSection;\n            public Int32 NumberOfSections;\n            public IMAGE_SECTION_HEADER Sections;\n            public Int32 Characteristics;\n            public Boolean fSystemImage;\n            public Boolean fDOSImage;\n            public LIST_ENTRY Links;\n            public Int32 SizeOfImage;\n        }\n\n        [StructLayout(LayoutKind.Sequential, Pack = 4)]\n        public struct IMAGE_EXPORT_DIRECTORY\n        {\n            public UInt32 Characteristics;\n            public UInt32 TimeDateStamp;\n            public UInt16 MajorVersion;\n            public UInt16 MinorVersion;\n            public UInt32 Name;\n            public UInt32 Base;\n            public UInt32 NumberOfFunctions;\n            public UInt32 NumberOfNames;\n            public UInt32 AddressOfFunctions;\n            public UInt32 AddressOfNames;\n            public UInt32 AddressOfOrdinals;\n        }\n\n        [StructLayout(LayoutKind.Sequential, Pack = 4)]\n        public struct IMAGE_NT_HEADERS\n        {\n            public Int32 Signature;\n            public IMAGE_FILE_HEADER FileHeader;\n            public IMAGE_OPTIONAL_HEADER OptionalHeader;\n        }\n\n        [StructLayout(LayoutKind.Sequential, Pack = 4)]\n        public struct LIST_ENTRY\n        {\n            public IntPtr Flink;\n            public IntPtr Blink;\n        }\n\n        [StructLayout(LayoutKind.Sequential, Pack = 4)]\n        public struct IMAGE_SECTION_HEADER\n        {\n            [MarshalAs(UnmanagedType.ByValArray, SizeConst = IMAGE_SIZEOF_SHORT_NAME)]\n            public Byte[] Name;\n            public Misc Misc;\n            public UInt32 PhysicalAddress;\n            public UInt32 VirtualAddress;\n            public UInt32 SizeOfRawData;\n            public UInt32 PointerToRawData;\n            public UInt32 PointerToRelocations;\n            public UInt32 PointerToLinenumbers;\n            public Int16 NumberOfRelocations;\n            public Int16 NumberOfLinenumbers;\n            public UInt32 Characteristics;\n        }\n\n        [StructLayout(LayoutKind.Sequential, Pack = 4)]\n        public struct IMAGE_FILE_HEADER\n        {\n            public UInt16 Machine;\n            public UInt16 NumberOfSections;\n            public UInt32 TimeDateStamp;\n            public UInt32 PointerToSymbolTable;\n            public UInt32 NumberOfSymbols;\n            public UInt16 SizeOfOptionalHeader;\n            public UInt16 Characteristics;\n        }\n\n        [StructLayout(LayoutKind.Sequential, Pack = 4)]\n        public struct IMAGE_OPTIONAL_HEADER\n        {\n            public UInt16 Magic;\n            public Byte MajorLinkerVersion;\n            public Byte MinorLinkerVersion;\n            public UInt32 SizeOfCode;\n            public UInt32 SizeOfInitializedData;\n            public UInt32 SizeOfUninitializedData;\n            public UInt32 AddressOfEntryPoint;\n            public UInt32 BaseOfCode;\n            public UInt32 BaseOfData;\n            public UInt32 ImageBase;\n            public UInt32 SectionAlignment;\n            public UInt32 FileAlignment;\n            public UInt16 MajorOperatingSystemVersion;\n            public UInt16 MinorOperatingSystemVersion;\n            public UInt16 MajorImageVersion;\n            public UInt16 MinorImageVersion;\n            public UInt16 MajorSubsystemVersion;\n            public UInt16 MinorSubsystemVersion;\n            public UInt32 Win32VersionValue;\n            public UInt32 SizeOfImage;\n            public UInt32 SizeOfHeaders;\n            public UInt32 CheckSum;\n            public UInt16 Subsystem;\n            public UInt16 DllCharacteristics;\n            public UInt32 SizeOfStackReserve;\n            public UInt32 SizeOfStackCommit;\n            public UInt32 SizeOfHeapReserve;\n            public UInt32 SizeOfHeapCommit;\n            public UInt32 LoaderFlags;\n            public UInt32 NumberOfRvaAndSizes;\n            [MarshalAs(UnmanagedType.ByValArray, SizeConst = IMAGE_NUMBEROF_DIRECTORY_ENTRIES)]\n            public IMAGE_DATA_DIRECTORY[] DataDirectory;\n        }\n\n        [StructLayout(LayoutKind.Sequential, Pack = 4)]\n        public struct IMAGE_DATA_DIRECTORY\n        {\n            public UInt32 VirtualAddress;\n            public UInt32 Size;\n        }\n\n        [StructLayout(LayoutKind.Explicit)]\n        public struct Misc\n        {\n            [FieldOffset(0)]\n            public UInt32 PhysicalAddress;\n            [FieldOffset(0)]\n            public UInt32 VirtualSize;\n        }\n        #endregion\n\n        #region Variables &amp; Constants\n        public const Int32 IMAGE_SIZEOF_SHORT_NAME = 8;\n        public const Int32 IMAGE_NUMBEROF_DIRECTORY_ENTRIES = 16;\n        public const UInt16 IMAGE_DIRECTORY_ENTRY_EXPORT = 0;\n\n        /// &lt;summary&gt;\n        /// String value holding the path to the DLL file. This value is also returned by the FileName property.\n        /// &lt;/summary&gt;\n        private String sDLLFilePath;\n\n        /// &lt;summary&gt;\n        /// Boolean value that is return by the LibraryLoaded property.\n        /// &lt;/summary&gt;\n        private Boolean bLibraryLoaded;\n\n        /// &lt;summary&gt;\n        /// Int32 value that is returned by the FunctionCount property.\n        /// &lt;/summary&gt;\n        private Int32 iFunctionCount;\n\n        /// &lt;summary&gt;\n        /// Int32 value that is returned by the SizeOfImage property.\n        /// &lt;/summary&gt;\n        private Int32 iSizeOfCode;\n\n        /// &lt;summary&gt;\n        /// String array value that is returned by the ImageFunctions property.\n        /// &lt;/summary&gt;\n        private String[] sFunctions;\n        #endregion\n\n        #region Properties\n        /// &lt;summary&gt;\n        /// Gets a boolean value indicating if the library has been loaded successfully.\n        /// &lt;/summary&gt;\n        public Boolean LibraryLoaded { get { return bLibraryLoaded; } }\n\n        /// &lt;summary&gt;\n        /// Gets a string value indicating what file the class was initialized with.\n        /// &lt;/summary&gt;\n        public String FileName { get { return sDLLFilePath; } }\n\n        /// &lt;summary&gt;\n        /// Gets a string array of the functions within the image.\n        /// &lt;/summary&gt;\n        public String[] ImageFunctions { get { return sFunctions; } }\n\n        /// &lt;summary&gt;\n        /// Gets an Int32 value indicating the number of functions within the image.\n        /// &lt;/summary&gt;\n        public Int32 FunctionCount { get { return iFunctionCount; } }\n        #endregion\n\n        /// &lt;summary&gt;\n        /// Initilizes the DLLExportViewer class.\n        /// &lt;/summary&gt;\n        /// &lt;param name=\"sFilePath\"&gt;Path to the DLL file to initilize the class with.&lt;/param&gt;\n        public DLLExportViewer(String sFilePath)\n        {\n            IMAGE_SECTION_HEADER ishSectionHeader = new IMAGE_SECTION_HEADER();\n            LOADED_IMAGE liLoadedImage = new LOADED_IMAGE();\n            IMAGE_EXPORT_DIRECTORY iedExportDirectory;\n            IntPtr pImageExportDirectory;\n            IntPtr pVirtualAddressOfNames;\n            Int32 iDirectoryExportSize = 0;\n\n            sDLLFilePath = sFilePath;\n\n            if (MapAndLoad(sDLLFilePath, null, ref liLoadedImage, true, true))\n            {\n                bLibraryLoaded = true;\n\n                pImageExportDirectory = ImageDirectoryEntryToData(liLoadedImage.MappedAddress, false, IMAGE_DIRECTORY_ENTRY_EXPORT, ref iDirectoryExportSize);\n                iedExportDirectory = (IMAGE_EXPORT_DIRECTORY)Marshal.PtrToStructure(pImageExportDirectory, typeof(IMAGE_EXPORT_DIRECTORY));\n\n                iFunctionCount = (Int32)iedExportDirectory.NumberOfFunctions;\n\n                pVirtualAddressOfNames = ImageRvaToVa(ref liLoadedImage.FileHeader, liLoadedImage.MappedAddress, iedExportDirectory.AddressOfNames, ref ishSectionHeader);\n            }\n            else\n            {\n                throw new Exception(String.Format(\"Failed to load library {0}\\n\\nError Number:{1]\\nError:{2}\", sDLLFilePath, Marshal.GetLastWin32Error(), new Win32Exception(Marshal.GetLastWin32Error()).Message));\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>My biggest concern is that I may have some of the marshalling on the structures wrong. But, all in all, I'm not sure where to go from here. Can anyone offer me some assistance?</p>\n"},{"tags":["c","winapi","opengl"],"answer_count":8,"favorite_count":29,"up_vote_count":23,"down_vote_count":0,"view_count":7931,"score":23,"question_id":4052940,"title":"How to make an OpenGL rendering context with transparent background?","body":"<p>Rendering contexts usually have a solid color on the background (black or whatever, see the image below):</p>\n\n<p><img src=\"http://i.stack.imgur.com/YxAXx.gif\" alt=\"alt text\"></p>\n\n<p>I'm wondering if it's possible to setup a window, with no decorations AND with the transparent background, while allowing me to render OpenGL stuff on it.</p>\n\n<p>This would give the illusion that the triangle is floating on the screen. The transparent background should allow you to see the desktop or other applications that might be behind it.</p>\n\n<p>Could you please exemplify with source code?</p>\n\n<p>Platform: Windows (win32 only)</p>\n"},{"tags":["c++","windows","winapi","com","webbrowser-control"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":87,"score":2,"question_id":12647927,"title":"Reusing the web browser control","body":"<p>I have a pure Win32 application (no MFC, etc.) to which I want to add a web browser control in a window. I know the basics of COM and can create a COM object for the browser using</p>\n\n<pre><code> hr = CoCreateInstance(\n    CLSID_WebBrowser,\n    NULL,\n    CLSCTX_INPROC,\n    IID_IWebBrowser2,\n    (void**) &amp;pWebBrowser);\n</code></pre>\n\n<p>However, apparently one needs to call SetClientSite, passing an IOleClientSite*. How do I obtain such an interface? <a href=\"http://msdn.microsoft.com/en-us/library/aa451946.aspx\" rel=\"nofollow\">This example</a> implements its own browser class, which provides the interface by deriving from it and implementing it <a href=\"http://msdn.microsoft.com/en-us/library/aa451938.aspx\" rel=\"nofollow\">(here)</a>. I tried to go along that path, but in order to instantiate the browser class, I would have to register it (no?). This seems awfully complicated - I just want to use an existing COM object, not implement and register my own. What am I missing?</p>\n\n<p>Assuming I do implement my own ClientSite class as part of my application, is it possible to not register it, and just instantiate it by calling <code>new ClientSite</code> (and then fetch the interface as using <code>QueryInterface</code>)? Will this work, or is it mandatory to call <code>CoCreateInstance</code>?</p>\n"},{"tags":["python","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12656094,"title":"Python: Is there any way to monitor Drag and Drop events in Windows?","body":"<p>I am designing a software in Python. I want a way to monitor drag and drop (files/folders) events in Windows OS from one Windows explorer to another Windows explorer and get the list of dropped file paths in return and then run some functions automatically.<br>\n<strong>Actually I want to Overwrite the Default Action of Windows os Drag and Drop Event method with my own python script Method</strong><br>\nIs this possible from within Python?</p>\n"},{"tags":["c++","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":95,"score":1,"question_id":12655700,"title":"Read pixels from 1bpp bitmap (CreateDIBSection)","body":"<p>This code works fine for 32, 24, 16, 8, 4 bpp images. But not for 1 bpp. </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;windows.h&gt;\n\n#pragma comment(lib, \"user32.lib\")\n#pragma comment(lib, \"gdi32.lib\")\n\nvoid GetWindowBitmapBitsAndSave(const HWND&amp; hWnd, int nBitCount, char *szFilePath);\nvoid EnumerateBits(LPBYTE pBits, int nBitCount, int nWidth, int nHeight);\n\nint main(int argc, char **argv)\n{   \n    //GetWindowBitmapBits(HWND_DESKTOP, 32);\n    //32, 24, 16, 8, 4 works fine...\n    GetWindowBitmapBitsAndSave(HWND_DESKTOP, 1, \"test.bmp\");\n\n    return 0;\n}\n\nvoid EnumerateBits(LPBYTE pBits, int nBitCount, int nWidth, int nHeight)\n{\n    int nPixels = nWidth * nHeight; \n    WORD wByteCount = nBitCount / 8; \n    if(wByteCount == 0)\n        wByteCount = 1;\n    int nBytes = nPixels * wByteCount; \n\n    for(int i = 0; i &lt; nBytes; i += wByteCount) \n    { \n        int r = (int)(*(pBits+i));\n        //int g = (int)(*(pBits+i+1));\n        //int b = (int)(*(pBits+i+2));\n\n        //just for test\n        if(r != 0 /*&amp;&amp; g != 0 &amp;&amp; b != 0*/)\n            if(r != 255 /*&amp;&amp; g != 255 &amp;&amp; b != 255*/)\n            //printf(\"(%d, %d, %d)\\n\", r, g, b);\n                    printf(\"%d\\n\", r);\n    } \n}\n\nvoid GetWindowBitmapBitsAndSave(const HWND&amp; hWnd, int nBitCount, char* szFilePath)\n{\n    HWND hScreenWnd = hWnd;\n    if(!hScreenWnd)\n        hScreenWnd = HWND_DESKTOP;\n\n    //calculate the number of color indexes in the color table\n    int nColorTableEntries = -1;\n    switch(nBitCount) \n    {\n        case 1:\n            nColorTableEntries = 2;\n            break;\n        case 4:\n            nColorTableEntries = 16;\n            break;\n        case 8:\n            nColorTableEntries = 256;\n            break;\n        case 16:\n        case 24:\n        case 32:\n            nColorTableEntries = 0;\n            break;\n        default:\n            nColorTableEntries = -1;\n            break;\n    }\n\n    if(nColorTableEntries == -1)\n    {\n        printf(\"bad bits-per-pixel argument\\n\");\n        return;\n    }\n\n    HDC hDC = GetDC(hScreenWnd);\n    HDC hMemDC = CreateCompatibleDC(hDC);\n\n    int nWidth = 0;\n    int nHeight = 0;\n\n    if(hScreenWnd != HWND_DESKTOP)\n    {\n        RECT rect;\n        GetClientRect(hScreenWnd, &amp;rect);\n        nWidth = rect.right - rect.left;\n        nHeight = rect.bottom - rect.top;\n    }\n    else\n    {\n        nWidth = ::GetSystemMetrics(SM_CXSCREEN);\n        nHeight = ::GetSystemMetrics(SM_CYSCREEN);\n    }\n\n\n    HBITMAP hBMP = CreateCompatibleBitmap(hDC, nWidth, nHeight);\n    SelectObject(hMemDC, hBMP);\n    BitBlt(hMemDC, 0, 0, nWidth, nHeight, hDC, 0, 0, SRCCOPY);\n\n    int nStructLength = sizeof(BITMAPINFOHEADER) + sizeof(RGBQUAD) * nColorTableEntries;\n    BITMAPINFOHEADER BitmapInfoHeader;\n\n    BitmapInfoHeader.biSize = sizeof(BITMAPINFOHEADER);\n    BitmapInfoHeader.biWidth = nWidth;\n    BitmapInfoHeader.biHeight = nHeight;\n    BitmapInfoHeader.biPlanes = 1;\n    BitmapInfoHeader.biBitCount = nBitCount;\n    BitmapInfoHeader.biCompression = BI_RGB;\n    BitmapInfoHeader.biXPelsPerMeter = 0;\n    BitmapInfoHeader.biYPelsPerMeter = 0;\n    BitmapInfoHeader.biClrUsed = nColorTableEntries;\n    BitmapInfoHeader.biClrImportant = nColorTableEntries;\n\n    DWORD dwBytes = ((DWORD) nWidth * nBitCount) / 32;\n    if(((DWORD) nWidth * nBitCount) % 32) {\n        dwBytes++;\n    }\n    dwBytes *= 4;\n\n    DWORD dwSizeImage = dwBytes * nHeight;\n    BitmapInfoHeader.biSizeImage = dwSizeImage;\n\n    BITMAPINFO* bitmapInfo = new BITMAPINFO[sizeof(BITMAPINFO) + sizeof(RGBQUAD) * nColorTableEntries];\n    bitmapInfo-&gt;bmiHeader = BitmapInfoHeader;\n\n    if(nBitCount &lt; 16)\n    {\n        for(int i = 0; i != nColorTableEntries; ++i)\n        {\n            bitmapInfo-&gt;bmiColors[i].rgbRed = \n                bitmapInfo-&gt;bmiColors[i].rgbGreen =\n                bitmapInfo-&gt;bmiColors[i].rgbBlue = (BYTE)(i*(255/(nColorTableEntries-1)));\n            bitmapInfo-&gt;bmiColors[i].rgbReserved = 0;\n        }\n    }\n\n    LPBYTE lpDibBits = 0;\n    HBITMAP hBitmap = ::CreateDIBSection(hMemDC, bitmapInfo, DIB_RGB_COLORS, (void**)&amp;lpDibBits, NULL, 0);\n    SelectObject(hMemDC, hBitmap);\n    BitBlt(hMemDC, 0, 0, nWidth, nHeight, hDC, 0, 0, SRCCOPY);\n    ReleaseDC(hScreenWnd, hDC);\n\n    //save bitmap\n    BITMAPFILEHEADER bmfh;\n    bmfh.bfType = 0x4d42;  // 'BM'\n    int nHeaderSize = sizeof(BITMAPINFOHEADER) + sizeof(RGBQUAD) * nColorTableEntries;\n    bmfh.bfSize = 0;\n    bmfh.bfReserved1 = bmfh.bfReserved2 = 0;\n    bmfh.bfOffBits = sizeof(BITMAPFILEHEADER) + sizeof(BITMAPINFOHEADER) + sizeof(RGBQUAD) * nColorTableEntries;    \n\n    FILE *pFile = 0;\n    fopen_s(&amp;pFile, szFilePath, \"wb\");\n    if(pFile)\n    {\n        fwrite(&amp;bmfh, sizeof(BITMAPFILEHEADER), 1, pFile);\n        fwrite(bitmapInfo, nHeaderSize,1,pFile);\n        fwrite(lpDibBits, dwSizeImage, 1, pFile);\n        fclose(pFile);\n    }\n\n    EnumerateBits(lpDibBits, nBitCount, nWidth, nHeight);\n\n    delete[]bitmapInfo;\n    ::DeleteObject(hBMP);\n    ::DeleteObject(hBitmap);\n}\n</code></pre>\n\n<p>First question: Why when bit count is 1 there are colors other than black and white? (but image is monochrome. Just comment EnumerateBits call in GetWindowBitmapBitsAndSave function).</p>\n\n<p>Second question: How correctly calculate offset for color bits array?</p>\n"},{"tags":["c++","wpf","winapi","mfc","custom-controls"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12655091,"title":"WPF Control inside LISTCONTROL of MFC","body":"<p>I am working on the windows form based application using <code>MFC</code> in visual studio 2010. Running on <code>clr</code> I have attached <code>WPFuserlibrary</code> with it to use WPF contrl in the project. I want to make the <code>Custom List Control</code> so I can display the <code>WPF</code> control for e.g. a button in every row of list.</p>\n\n<pre><code>hwndWPF1 = GetHwnd(m_democontrol.GetSafeHwnd(),20,20, 20,20);\n</code></pre>\n\n<p>this is how i am displaying the <code>HWND</code> object But this draws on the form or list view. I want to draw this inside <code>listcontrol</code> in every row. Any Ideas?</p>\n"},{"tags":["c++","windows","winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":12655120,"title":"ReadFile function from Win32 API","body":"<p>I got two questions about ReadFile function from Win32 API. First of all, given that </p>\n\n<pre><code>BOOL WINAPI ReadFile(\n                       _In_         HANDLE hFile,\n                       _Out_        LPVOID lpBuffer,\n                       _In_         DWORD nNumberOfBytesToRead,\n                       _Out_opt_    LPDWORD lpNumberOfBytesRead,\n                       _Inout_opt_  LPOVERLAPPED lpOverlapped\n                    );\n</code></pre>\n\n<p>the third and fourth parameters are of type DWORD, which can hold maximum 1^32 without overflow. Does it mean that the ReadFile can only read a file that has less than 1^32 bytes data at a time? If that is true, I want to read a file bigger than 1^32, I'll put the ReadFile in a loop like this </p>\n\n<pre><code>char buffer[1&lt;&lt;32];\nwhile(!EOF){\n  ReadFIle(filename,buffer,1^32,bytesout,NULL);\n  SomeFunctionToExtractDataFromBuffer(buffer)\n}\n</code></pre>\n\n<p>Supposed the loop tends to overwrite the buffer every iteration, in order for this design to work, the ReadFile needs to remember where the previous read happened in the file is this true? or there are other ways to achieve this. Thanks a lot</p>\n"},{"tags":["c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12654517,"title":"ANSI C & WinAPI: how to get a handle to the window from hook procedure?","body":"<p>I'm writing a very simple program, which prints color of selected pixel. \nHere is my code:</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#define UNICODE\n\nLRESULT CALLBACK mouse_hook_low_level(int nCode, WPARAM wParam, LPARAM lParam)\n{\n    if(wParam == WM_MOUSEMOVE) {\n        //Need to get a handle to the window!\n        InvalidateRect(window, NULL, FALSE); \n        UpdateWindow(window);\n    }\n    return CallNextHookEx(NULL, nCode, wParam, lParam);\n}\n\nLRESULT CALLBACK window_process(HWND window, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    HDC dc = GetDC(NULL);\n    HDC hdc;\n    HFONT font;\n    PAINTSTRUCT ps;\n    int r, g, b;\n    POINT p;\n    RECT background_rect, color_rect;\n    wchar_t buffer[256];\n\n    switch(message) {\n        case WM_PAINT:\n            GetCursorPos(&amp;p);\n            r = GetRValue(GetPixel(dc, p.x, p.y));\n            g = GetGValue(GetPixel(dc, p.x, p.y));\n            b = GetBValue(GetPixel(dc, p.x, p.y));\n            hdc = BeginPaint(window, &amp;ps);\n            background_rect.left = 0;\n            background_rect.right = 199;\n            background_rect.top = 0;\n            background_rect.bottom = 99;\n            FillRect(hdc, &amp;background_rect, (HBRUSH)(COLOR_WINDOW+1));\n            font = CreateFont(\n                14,\n                0,\n                0,\n                0,\n                FW_DONTCARE,\n                FALSE,\n                FALSE,\n                FALSE,\n                DEFAULT_CHARSET,\n                OUT_OUTLINE_PRECIS,\n                CLIP_DEFAULT_PRECIS,\n                CLEARTYPE_QUALITY,\n                VARIABLE_PITCH,\n                TEXT(\"Times New Roman\")\n            );\n            SelectObject(hdc, font);\n            swprintf_s(buffer, 256, L\"Coordinates: (%d, %d)\", p.x, p.y);\n            TextOut(hdc, 70, 10, buffer, wcslen(buffer));\n            swprintf_s(buffer, 256, L\"RGB: (%d, %d, %d)\", r, g, b);\n            TextOut(hdc, 70, 40, buffer,  wcslen(buffer));\n            color_rect.left = 10;\n            color_rect.right = 60;\n            color_rect.top = 10;\n            color_rect.bottom = 60;\n            FillRect(hdc, &amp;color_rect, (HBRUSH)CreateSolidBrush(RGB(r, g, b)));\n            EndPaint(window, &amp;ps);\n            break;\n        case WM_CLOSE:\n            DestroyWindow(window);\n            break;\n        case WM_DESTROY:\n            PostQuitMessage(0);\n            break;\n        default:\n            ReleaseDC(window, hdc);\n            return DefWindowProc(window, message, wParam, lParam);\n    }\n    ReleaseDC(window, hdc);\n    return 0;\n}\n\nint WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)\n{\n    LPCWSTR class_name = L\"name\";\n    MSG message;\n    WNDCLASSEX window_class;\n    HWND window;\n    HHOOK MouseHook;\n\n    window_class.cbSize = sizeof(WNDCLASSEX);\n    window_class.style = CS_HREDRAW | CS_VREDRAW;\n    window_class.lpfnWndProc = window_process;\n    window_class.cbClsExtra = 0;\n    window_class.cbWndExtra = 0;\n    window_class.hIcon = LoadIcon(NULL, IDI_APPLICATION);\n    window_class.hCursor = LoadCursor(NULL, IDC_ARROW);\n    window_class.hbrBackground = (HBRUSH)GetStockObject(WHITE_BRUSH);\n    window_class.lpszMenuName = NULL;\n    window_class.lpszClassName = class_name;\n    window_class.hInstance = hInstance;\n    window_class.hIconSm = LoadIcon(NULL, IDI_APPLICATION);\n    RegisterClassEx(&amp;window_class);\n    window = CreateWindow(\n        class_name,\n        L\"Pixel color\",\n        WS_OVERLAPPED | WS_CAPTION | WS_SYSMENU,\n        CW_USEDEFAULT,\n        CW_USEDEFAULT,\n        200,\n        100,\n        NULL,\n        NULL,\n        hInstance,\n        NULL\n    );\n    ShowWindow(window, SW_SHOWNORMAL);\n    MouseHook = SetWindowsHookEx(WH_MOUSE_LL, mouse_hook_low_level, hInstance, 0);\n    while(GetMessage(&amp;message, NULL, 0, 0)) {\n        TranslateMessage(&amp;message);\n        DispatchMessage(&amp;message);\n    }\n    UnhookWindowsHookEx(MouseHook);\n    return message.wParam;\n}\n</code></pre>\n\n<p>The question is: how can I get a handle to the window for further window update in hook procedure at line 9? And what can you say generally about my code? I'm a student and have a little C-programming experience, could you point out my errors?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["windows","delphi","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":12652717,"title":"Create shortcut with Delphi and specify its privilege level","body":"<p>I am using the following code to make shortcuts in Delphi. I want to make a shortcut with \"Run this program as an administrator\" box checked in Privilege Level properties of shortcut. Is there any way to do this?</p>\n\n<pre><code>function MakeShortcut(Dst, Src: String; Desc: String = ''; Arg: String = ''; WorkDir: String = ''; Icon: String = ''; IconI: Integer = 0; Show: Integer = SW_SHOWNORMAL; HotKey: Word = 0): Boolean;\nvar\n  u: IUnknown;\n  s: IShellLink;\n  f: IPersistFile;\n  p: WideString;\nbegin\ntry\n  u := CreateComObject(CLSID_SHELLLINK);\n  s := u as IShellLink;\n  f := u as IPersistFile;\n  s.SetPath(PChar(Src));\n  if (WorkDir = '') then WorkDir := ExtractFileDir(Src);\n  s.SetWorkingDirectory(PChar(WorkDir));\n  if (Icon = '') then Icon := Src;\n  s.SetIconLocation(PChar(Icon), IconI);\n  s.SetDescription(PChar(Desc));\n  s.SetArguments(PChar(Arg));\n  s.SetShowCmd(Show);\n  s.SetHotkey(HotKey);\n  p := Dst;\n  Result := Succeeded(f.Save(PWChar(p), False));\nexcept\n  Result := False;\nend;\nend;\n</code></pre>\n"},{"tags":["winapi","visual-c++","seh","structured-exception"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":48,"score":-1,"question_id":11943570,"title":"How to get the benefits of /EHa with /EHsc, on a particular function?","body":"<p>If I know that a particular <code>extern \"C\"</code> function in my program (say, <code>RaiseException</code>) is the only function that raises SEH exceptions, and I want them converted to C++ exceptions, is there any way for me to \"selectively enable\" <code>/EHa</code> for that function, so that the exceptions get converted to <code>CStructured_Exception</code> without bloating or slowing down the rest of the program as <a href=\"http://msdn.microsoft.com/en-us/library/1deeycx5.aspx\" rel=\"nofollow\">normally caused by <code>/EHa</code></a>?</p>\n"},{"tags":["c#","winapi","c#-4.0","injection","sendmessage"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":528,"score":1,"question_id":10407769,"title":"Directly sending keystrokes to another process via hooking","body":"<p>I'm wondering, after fiddling with all sorts of issues with SendInput, SendKeys, PostMessage, SendMessage, SendNotifyMessage, keybd_event, etc and so forth. To find that well... trying to send a keyboard input to another non-foreground process is quite finicky and unreliable.</p>\n\n<p>I tried a method of SendInput where I trick the Z-order (to keep the current window on top) and quickly foreground the 3rd party window, send the input, and re-foreground my window. Of which ultimately failed, and also, somehow, not sure why, managed to also proc the keystrokes on my window as well while not foreground (causing an infinite loop of sending and receiving between two windows until I managed to close the process).</p>\n\n<p>I've tried different combinations of SendMessage and PostMessage. One for down, one for up, as using both for down and up leads to issues, like with PostMessage for both, causing the key to duplicate on the receiving window. or SendMessage for both, which caused issues with text entry, but other functions worked ok. SendMessage for keydown and PostMessage for keyUp worked for all functions, but the reliability rate dropped dramatically, as well as adding latency into key events. Only a combination of PostMessage for keydown, and SendMessage for keyup managed to do anything useful, with a maybe 5-10% fail rate of keyup registering. Same goes for SentNotifyMessage (behaves basically in the same fashion as SendMessage as far as reliability goes).</p>\n\n<p>So essentially, I'm at whit's end, and I wanted to know about directly injecting a hook into the target window, and doing some voodoo to send keystrokes to it that way, bypassing the message queue etc. Doing so in a way that will not proc global key events, and only affect the target window. Only thing is I'm pretty unknowledgeable when it comes to injecting/hooking, etc. So I turn to you, community.</p>\n\n<p>Wut do?</p>\n"},{"tags":["windows","winapi","sdk","microsoft","manifest"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":58,"score":0,"question_id":12651124,"title":"Difference between \"highestAvailable\" and \"requireAdministrator\" in manifest in terms of Elevation?","body":"<p>I used \"highestAvailable\" in my exe's manifest. But in <code>standard user and UAC ON</code> its not elevating the exe. </p>\n\n<p>Is this the behavior of \"highestAvailable\"?</p>\n\n<p>I referred this <a href=\"http://msdn.microsoft.com/en-us/library/bb756929.aspx\" rel=\"nofollow\">MSDN link</a> but its not clear whether \"highestavailable\" will elevate the exe or not. My requirement is to elevate the exe if UAC is on. </p>\n\n<p>I changed to \"requireAdministrator\" and my exe is getting elevated in standard user with UAC ON.</p>\n\n<p>Can someone explain me in detail about the elevation behavior of these two options \"highestAvailabe\" and \"requireAdministrator\"?  </p>\n"},{"tags":["c#","wpf","winapi","interop"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12652055,"title":"How to catch WM_WINDOWPOSCHANGING message?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/624367/how-to-handle-wndproc-messages-in-wpf\">How to handle WndProc messages in WPF?</a>  </p>\n</blockquote>\n\n\n\n<p>How do I catch the WM_WINDOWPOSCHANGING-Message in an WPF Application?</p>\n\n<p>Something like this:</p>\n\n<pre><code>protected void OnWM_WINDOWPOSCHANING()\n{\n    //some code\n}\n</code></pre>\n\n<p>But I don´t know how to register to the message (using Interop).</p>\n"},{"tags":["c#","windows","winapi","npapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":152,"score":0,"question_id":12323882,"title":"AllowSetForegroundWindow & SetForegroundWindow: NPAPI plug-in wants to allow a desktop application with no success","body":"<p>Here it's what I have: a web browser plug-in written in C++ and a Windows application written in C#. They communicate through a named pipe. The plug-in instructs the C# application to open a file (suppose that the file is a .txt and it opens in Notepad).</p>\n\n<p>Once the C# application is given the command, it opens the file but Notepad doesn't show in the foreground, which isn't acceptable, I must open Notepad in the foreground.</p>\n\n<p>I modified the C# application so that it calls the <code>SetForegroundWindow</code> function. This time Notepad didn't open in the foreground, but the taskbar flashes.</p>\n\n<p>After reading the documentation for <code>SetForegroundWindow</code> and many articles I think that now I understand what the problem is: the C# application can't bring Notepad to the foreground because it wasn't the the foreground process, the browser was (?).</p>\n\n<p>After reading this: </p>\n\n<blockquote>\n  <p>\"A process that can set the foreground window can enable another\n  process to set the foreground window by calling the\n  AllowSetForegroundWindow function.\"</p>\n</blockquote>\n\n<p>I decided to modify the plug-in.</p>\n\n<p>This time the plug-in calls the <code>AllowSetForegroundWindow</code> function passing <code>ASFW_ANY</code> as a parameter (I know, <code>ASFW_ANY</code> could be risky, but I wanted to make sure that <code>AllowSetForegroundWindow</code> would do it).</p>\n\n<p>After I did the modification to the plug-in I tested it and it worked! (Opera 12.02). Then I tested it on Internet Explorer and it worked too. But the problem came when I tested it in Firefox and Chrome. The C# application didn't have the ability to bring Notepad to the foreground. I noticed that for those browsers the <code>AllowSetForegroundWindow</code> function was returning false.</p>\n\n<p>So I started investigating and I come to the conclusion that maybe it's because the plugin container that Firefox uses. An idea came to my mind: it worked in Opera 12.02, but they don't have a plugin container, although they did in Opera 12.00. So I downloaded Opera 12.00, I did the test and it failed, which makes me conclude that the plugin container is the culprit.</p>\n\n<p>The question is: how can I give to the C# application the ability to set foreground?</p>\n\n<p>I don't know how to continue, and I think that I tried all the legitimate ways. The <code>AllowSetForegroundWindow</code> &amp; <code>SetForegroundWindow</code> seems to not apply here.</p>\n"},{"tags":["c","winapi","unicode"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":12642984,"title":"should the device name be narrow or wide for WM_DEVMODECHANGE?","body":"<p>I notice there is no <code>A</code>/<code>W</code> variations for <code>WM_DEVMODECHANGE</code>, yet it takes a string in the <code>LPARAM</code>.  I see no documentation (that I can find) that tells whether this string is narrow or wide.</p>\n\n<p>Does anyone know what is appropriate for the <code>LPARAM</code>?</p>\n"},{"tags":["c++","visual-studio-2010","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12649056,"title":"winapi destroyWindow() immediately exits my program","body":"<p>Okay, i can understand if the function would return an error or throw an exception, but for some reason my call to DestroyWindow literally exits the program at that point. Like with the actual exit() function changing my program flow. The documentation mentions nothing like this and i have no means of figuring out what is going on since i get no error code. Has anyone ever encountered something like this? </p>\n\n<p>I'm doing quite a bit more with this object than using winapi, so ignore the rest of it. What else could be wrong here?</p>\n\n<p>SYNC_WinSystem.h</p>\n\n<pre><code>#ifndef SYNC_WINSYSTEM_H\n#define SYNC_WINSYSTEM_H\n\n#include \"SYNC_ISystem.h\"\n\n#include &lt;Windows.h&gt;\n#include &lt;array&gt;\n#include \"SYNC_Winput.h\"\n#include \"SYNC_IRenderer.h\"\n#include \"SYNC_D3D11Renderer.h\"\n\n#define FULL_SCREEN true\n\n// SYNC_WinSystem\nclass SYNC_WinSystem : public SYNC_ISystem\n{   \npublic:\n    class WindowsContext;\n\n    SYNC_WinSystem();\n\n    virtual long Initialize(InitializeContext *);\n    virtual void Init_Loop();\n    virtual void Shutdown();\n\n    virtual long MakeDirectory(std::string);\n    virtual bool CreateSkin(std::string, std::string, SYNC::ISkin *&amp;);\n    virtual ISound * CreateSound();\n\n    LRESULT CALLBACK MessageHandler(HWND hwnd, UINT msg, WPARAM wparam, LPARAM lparam);\n\nprivate:\n    virtual long InitializeWindows();\n    virtual bool Frame();\n    virtual void ShutdownWindows();\n\nprivate:\n    SYNC_Winput m_Input;\n\nprivate:\n    std::shared_ptr&lt;SYNC_IRenderer&gt; m_Graphics;\n    HINSTANCE m_hinstance;\n    HWND m_hwnd;\n    int m_screenWidth;\n    int m_screenHeight;\n    std::string m_WindowName;\n};\n\n// SYNC_WinSystem::WindowsContext\nclass SYNC_WinSystem::WindowsContext : public SYNC_ISystem::InitializeContext\n{\npublic:\n    WindowsContext();\n    std::string Type();\n\n    HINSTANCE m_hinstance;\n    std::string m_WindowName;\n\nprivate:\n    const static std::string m_Identifier;\n};\n\n\n#endif\n</code></pre>\n\n<p>SYNC_WinSystem.cpp</p>\n\n<pre><code>#include \"SYNC_WinSystem.h\"\n\n// SYNC_WinSystem definitions\nSYNC_WinSystem * g_windows;\n\nLRESULT CALLBACK WndProc(HWND hwnd, UINT msg, WPARAM wparam, LPARAM lparam);\n\nSYNC_WinSystem::SYNC_WinSystem()\n    : m_Graphics(new SYNC_D3D11Renderer)\n{\n    m_hinstance = nullptr;\n    m_hwnd = nullptr;\n    m_screenWidth = 0;\n    m_screenHeight = 0;\n}\n\nlong SYNC_WinSystem::Initialize(InitializeContext  * context)\n{\n    long result = 0;\n    char errors[256];\n    WindowsContext * cContext;\n    if(context-&gt;Type() == \"WindowsContext\")\n        cContext = static_cast&lt;WindowsContext *&gt;(context);\n    else\n        return false;\n\n    m_hinstance = cContext-&gt;m_hinstance;\n    m_WindowName = cContext-&gt;m_WindowName;\n    g_windows = this;\n\n\n    result = InitializeWindows();\n    if(result)\n    {\n        sprintf_s(errors, \"The Window could not initialize. Windows error code: %i\", result);\n        MessageBox(NULL, errors, \"Error!\", MB_OK); \n        return result;\n    }\n\n    std::array&lt;std::string, 3&gt; folderNames=\n    {{\n        \"Compiled_Models\",\n        \"Temp_Models\",\n        \"Materials\"\n    }};\n\n    for(int i = 0; i &lt; (int) folderNames.size(); i++)\n    {\n        result = MakeDirectory(folderNames[i]);\n        if( result &amp;&amp; (result != ERROR_ALREADY_EXISTS))\n        {\n            sprintf_s(errors, \"Error creating directory \\\" %s \\\" for system. Windows error code: %i\", folderNames[i].c_str(), result);\n            MessageBox(NULL, errors, \"Error!\", MB_OK);\n            return result;\n        }\n        result = 0;\n    }\n\n    SYNC_D3D11Renderer::D3D11Context graphicsContext;\n    graphicsContext.fullscreen = true;\n    graphicsContext.hwnd = m_hwnd;\n    graphicsContext.screenDepth = 1000.0f;\n    graphicsContext.screenNear = 0.1f;\n    graphicsContext.screenWidth = m_screenWidth;\n    graphicsContext.screenHeight = m_screenHeight;\n\n    if(!m_Graphics-&gt;Initialize(&amp;graphicsContext))\n        return false;\n\n    return result;\n}\n\nvoid SYNC_WinSystem::Init_Loop()\n{\n\n    MSG msg;\n    bool done, result;\n\n    ZeroMemory(&amp;msg, sizeof(MSG));\n    done = false;\n\n    while(!done)\n    {\n        if(PeekMessage(&amp;msg, NULL, 0, 0, PM_REMOVE))\n        {\n            TranslateMessage(&amp;msg);\n            DispatchMessage(&amp;msg);\n        }\n\n        if(m_Input.IsKeyPressed(VK_ESCAPE))\n        {\n\n            done = true;\n        }\n        else\n        {\n            result = Frame();\n            if(!result)\n            {\n                done = true;\n            }\n        }\n\n    }\n}\n\nvoid SYNC_WinSystem::Shutdown()\n{\n    ShutdownWindows();\n}\n\nlong SYNC_WinSystem::MakeDirectory(std::string dirName)\n{\n    DWORD result = 0;\n    long returnValue = 0;\n\n    dirName.insert(0, \".\\\\\");\n    result = CreateDirectory(dirName.c_str(), NULL);\n\n    if(result == 0)\n    {\n        returnValue = GetLastError();\n    }\n    return returnValue;\n}\n\nbool SYNC_WinSystem::Frame()\n{\n\n    if(!m_Graphics-&gt;Frame())\n        return false;\n\n    return true;\n}\n\nlong SYNC_WinSystem::InitializeWindows()\n{\n    DWORD result = 0;\n    WNDCLASSEX wc;\n    DEVMODE dmScreenSettings;\n    int posX, posY;\n\n    wc.style = CS_HREDRAW | CS_VREDRAW | CS_OWNDC;\n    wc.lpfnWndProc = &amp;WndProc;\n    wc.cbClsExtra = 0;\n    wc.cbWndExtra = 0;\n    wc.hInstance = m_hinstance;\n    wc.hIcon = LoadIcon(NULL, IDI_WINLOGO);\n    wc.hIconSm = wc.hIcon;\n    wc.hCursor = LoadCursor(NULL, IDC_ARROW);\n    wc.hbrBackground = (HBRUSH) GetStockObject(BLACK_BRUSH);\n    wc.lpszMenuName = NULL;\n    wc.lpszClassName = m_WindowName.c_str();\n    wc.cbSize = sizeof(WNDCLASSEX);\n\n\n\n    if(RegisterClassEx(&amp;wc) == 0)\n    {\n        result = GetLastError();\n        return result;\n    } \n\n    m_screenWidth = GetSystemMetrics(SM_CXSCREEN);\n    m_screenHeight = GetSystemMetrics(SM_CYSCREEN);\n\n    if(FULL_SCREEN)\n    {\n        memset(&amp;dmScreenSettings, 0, sizeof(dmScreenSettings));\n        dmScreenSettings.dmSize = sizeof(dmScreenSettings);\n        dmScreenSettings.dmPelsWidth = (unsigned long) m_screenWidth;\n        dmScreenSettings.dmPelsHeight = (unsigned long) m_screenHeight;\n        dmScreenSettings.dmBitsPerPel = 32;\n        dmScreenSettings.dmFields = DM_BITSPERPEL | DM_PELSWIDTH | DM_PELSHEIGHT;\n\n        ChangeDisplaySettings(&amp;dmScreenSettings, CDS_FULLSCREEN);\n        posX = posY = 0;\n\n        m_hwnd = CreateWindowEx(WS_EX_APPWINDOW, \n                             m_WindowName.c_str(), \n                             m_WindowName.c_str(),\n                             WS_CLIPSIBLINGS | WS_CLIPCHILDREN | WS_POPUP,\n                             posX, posY, m_screenWidth, m_screenHeight,\n                             NULL, NULL, m_hinstance, NULL);\n\n    }\n    else\n    {\n        m_screenWidth = 800;\n        m_screenHeight = 600;\n\n        posX = ((GetSystemMetrics(SM_CXSCREEN)/2) - (m_screenWidth/2));\n        posY = ((GetSystemMetrics(SM_CYSCREEN)/2) - (m_screenHeight/2));\n\n        m_hwnd = CreateWindowEx(WS_EX_APPWINDOW, \n                             m_WindowName.c_str(), \n                             m_WindowName.c_str(),\n                             WS_OVERLAPPEDWINDOW | WS_CLIPSIBLINGS | WS_CLIPCHILDREN | WS_POPUP,\n                             posX, posY, m_screenWidth, m_screenHeight,\n                             NULL, NULL, m_hinstance, NULL);\n    }\n\n\n\n    if(!m_hwnd)\n    {\n        result = GetLastError();\n        return result;\n    }\n\n    ShowWindow(m_hwnd, SW_SHOW);\n    SetForegroundWindow(m_hwnd);\n    SetFocus(m_hwnd);\n\n    return result;\n}\n\nvoid SYNC_WinSystem::ShutdownWindows()\n{\n    ShowCursor(true);\n\n    if(FULL_SCREEN)\n    {\n        ChangeDisplaySettings(NULL, 0);\n    }\n\n\n    if(DestroyWindow(m_hwnd) == 0)\n    {\n        char meh[256];\n        sprintf(meh, \"error: %i\" , GetLastError());\n        MessageBox(NULL, meh, \"error!\", MB_OK);\n    }\n\n    m_hwnd = NULL;\n\n    UnregisterClass(m_WindowName.c_str(), m_hinstance);\n    m_hinstance = NULL;\n\n    g_windows = NULL;\n\n    return;\n}\n\nLRESULT CALLBACK WndProc(HWND hwnd, UINT msg, WPARAM wparam, LPARAM lparam)\n{\n    switch(msg)\n    {\n        case WM_DESTROY:\n        {\n\n            PostQuitMessage(0);\n            return 0;\n        }\n        case WM_CLOSE:\n        {\n            PostQuitMessage(0);\n            return 0;\n        }\n        default:\n        {\n            return g_windows-&gt;MessageHandler(hwnd, msg, wparam, lparam);\n        }\n    }\n}\n\nLRESULT CALLBACK SYNC_WinSystem::MessageHandler(HWND hwnd, UINT msg, WPARAM wparam, LPARAM lparam)\n{\n\n    switch(msg)\n    {\n        case WM_KEYDOWN:\n        {\n            m_Input.KeyDown((unsigned int) wparam);\n            return 0;\n        }\n        case WM_KEYUP:\n        {\n            m_Input.KeyDown((unsigned int) wparam);\n            return 0;\n        }\n        default:\n        {\n            return DefWindowProc(hwnd, msg, wparam, lparam);\n        }\n    }\n\n\n}\n\nISound * SYNC_WinSystem::CreateSound()\n{\n    return nullptr;\n}\n\nbool SYNC_WinSystem::CreateSkin(std::string filename, std::string shaderName, SYNC::ISkin *&amp; skin)\n{\n    if(!m_Graphics-&gt;CreateSkin(filename, shaderName, skin))\n        return false;\n\n    return true;\n}\n\n\n// SYNC_WinSystem::WindowsContext definitions\nconst std::string SYNC_WinSystem::WindowsContext::m_Identifier = \"WindowsContext\";\n\nSYNC_WinSystem::WindowsContext::WindowsContext()\n{\n\n\n}\n\nstd::string SYNC_WinSystem::WindowsContext::Type()\n{\n    return m_Identifier;\n}\n</code></pre>\n\n<p>quick explanation of how i do this. window handle and hinstance have private members in the object, and during the Initialize() and InitializeWindows() functions, the window class and window itself is created. The windows procedure is defined below as a global function, because you can't use a member function as a windows procedure. I dodge around this by making a global pointer (gasp) at the top, and assigning it to the this pointer of the system, which allows the procedure to call a member function procedure. Still only allows one instance of the system, but that's all i need :. Anywho, during shutdown, ShutdownWindows() is called, which then calls DestroyWindow. It is during this call, that my program simply ends, no error, no exception. MSVC++ express tells me it returns error code 3, but as far as windows error codes, that's just an ERROR_PATH_NOT_FIND which makes no sense in this context. Anyone have a clue?</p>\n\n<p>main.cpp</p>\n\n<pre><code>#include &lt;memory&gt;\n#include &lt;Windows.h&gt;\n\n#include \"Syncopate.h\"\n#include \"SYNC_WinSystem.h\"\nusing namespace std;\n\n#include \"SYNC_Winput.h\"\n\nint WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance,PSTR lpCmdLine, INT nCmdShow)\n{\n    //create a new instance of the engine\n    std::shared_ptr&lt;SYNC_WinSystem&gt; system( new SYNC_WinSystem);\n\n    // create an init context for this specific derivative of SYNC_ISystem\n    SYNC_WinSystem::WindowsContext context;\n    context.m_hinstance = hInstance;\n    context.m_WindowName = \"Syncopate\";\n\n    // Initialize the system object. if something goes wrong, return ERROR\n    if(system-&gt;Initialize(&amp;context))\n        return 1;\n\n    SYNC::ISkin * model;\n\n    if(!system-&gt;CreateSkin(\"data.txt\", \"ColorShader\", model))\n        return 1;\n\n    system-&gt;Init_Loop();\n\n    system-&gt;Shutdown();\n\n    return 0;\n}\n</code></pre>\n"},{"tags":["windows","winapi","opengl","gdi","wgl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12649084,"title":"What do Windows DCs and GLRCs correspond to?","body":"<p>What does a DC correspond to in Windows? I know I can get an HDC from an HWND or an HMONITOR. Does that mean that a window's DC is an alias or proxy for its monitor's DC? Windows allows you to say that a window class should have its own DC, so it seems like they're not the same DC, although the Windows API also seems to support having a parent-child relationship between DCs. Would I find the monitor's DC to be one of the parent DCs?</p>\n\n<p>What happens if a window spans multiple monitors? The Windows API seems to only support getting a single HDC back from a window and getting a single HGLRC from an HDC. I've read that OpenGL doesn't support having a full-screen window span multiple monitors and thus you must have multiple windows to accomplish this.</p>\n\n<p>Would an SLI/Crossfire system be a single GLRC?</p>\n\n<p>It seems to me that a GLRC is what most closely resembles a graphics system. The GLRC represents a single graphics system. The DCs represent the outputs. A GLRC can draw to any DCs that are associated with the outputs connected to the graphics system and any child DCs of those DCs. You can also have multiple monitors and multiple graphics cards, each of which are paired together, and thus each GLRC paired with each DC.</p>\n\n<p>Correct or confirm?</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12643441,"title":"Win 32 Writefile: Access Viloation and Error 1784","body":"<p>Two problems with the below code.  To begin, I have been scouring this and various other forums for answers to my 1784 error code and everything I've tried has failed.  Two of the threads I've checked on stackoverflow are <a href=\"http://stackoverflow.com/questions/6537416/writefile-returning-error-1784\">WriteFile returning error 1784</a> and <a href=\"http://stackoverflow.com/questions/11287901/blockwrite-i-o-error-1784\">BlockWrite I/O Error 1784</a>.  I've checked some others on this forum but I'm not remembering exactly what the are right now.</p>\n\n<p>I'm trying to save an array of structs to an empty binary file.  The first problem is that I get an access violation if my size variable (nNumberOfBytesToWrite parameter) is anything less about 99000 bytes.  That number jumps around.  For awhile when I was testing it would have the access violation if it was 99,999 bytes but not 100,000 bytes.  Of course, what I eventually want to do is set the size to the size of the entire array.  The original code to handle that is now commented out so I can test with various sizes.</p>\n\n<p>The second thing that happens (if I don't get an access violation) is I get error code 1784 and WriteFile fails every time.  As other threads on this topic have stated, this is defined on MSDN as ERROR_INVALID_USER_BUFFER and the description is \"The supplied user buffer is not valid for the requested operation.\"  I've looked at MSDN's own example for opening files like this (<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb540534%28v=vs.85%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/bb540534%28v=vs.85%29.aspx</a>) and have tried some variations based on their code, but nothing seems to work.</p>\n\n<p>This problem is probably massively noob and I'm sure I'm overlooking something ridiculously simple, but if anyone has suggestions they'd be greatly appreciated.</p>\n\n<pre><code>case IDM_SAVE1:\n{\n    HANDLE hFile = CreateFile(\"MineSave.mss\", GENERIC_WRITE, 0, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);\n    int test_buffer[] = {1,2,3,4,5,6,7,8,9,10};\n\n    if(hFile != INVALID_HANDLE_VALUE)\n    {\n        BOOL bSuccess;\n        DWORD size = 100000; //DWORD size = (((sizeof(tile)) * tiles_total));\n        LPDWORD bytes_written = 0;\n        bSuccess = WriteFile(hFile, test_buffer, size, bytes_written, NULL);\n        if(bSuccess)\n        {\n            MessageBox(hwnd, \"File saved successfully.\", \"Great Job!\", MB_OK);\n        }\n        else\n        {\n            DWORD error = GetLastError();\n            MessageBox(hwnd, \"Could not write to file.\", \"Error\", MB_OK);\n        }\n\n        CloseHandle(hFile);\n    }\n    else\n    {\n        MessageBox(hwnd, \"Could not create file.\", \"Error\", MB_OK);\n    }\n}\nbreak;\n</code></pre>\n"},{"tags":["string","winapi","unicode","filenames","createfile"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12644150,"title":"How do I open a file named 𤭢.txt with CreateFile() API function?","body":"<p>Code points of some Unicode characters (like 𤭢) consume more than 2-bytes. How do I use Win32 API functions like <code>CreateFile()</code> with these characters?</p>\n\n<p><strong>WinBase.h</strong></p>\n\n<pre><code>WINBASEAPI\n__out\nHANDLE\nWINAPI\nCreateFileA(\n    __in     LPCSTR lpFileName,\n    __in     DWORD dwDesiredAccess,\n    __in     DWORD dwShareMode,\n    __in_opt LPSECURITY_ATTRIBUTES lpSecurityAttributes,\n    __in     DWORD dwCreationDisposition,\n    __in     DWORD dwFlagsAndAttributes,\n    __in_opt HANDLE hTemplateFile\n    );\nWINBASEAPI\n__out\nHANDLE\nWINAPI\nCreateFileW(\n    __in     LPCWSTR lpFileName,\n    __in     DWORD dwDesiredAccess,\n    __in     DWORD dwShareMode,\n    __in_opt LPSECURITY_ATTRIBUTES lpSecurityAttributes,\n    __in     DWORD dwCreationDisposition,\n    __in     DWORD dwFlagsAndAttributes,\n    __in_opt HANDLE hTemplateFile\n    );\n#ifdef UNICODE\n#define CreateFile  CreateFileW\n#else\n#define CreateFile  CreateFileA\n#endif // !UNICODE\n</code></pre>\n\n<p>LPCSTR and LPCWSTR are define in <strong>WinNT.h</strong> as:</p>\n\n<pre><code>typedef __nullterminated CONST CHAR *LPCSTR, *PCSTR;\ntypedef __nullterminated CONST WCHAR *LPCWSTR, *PCWSTR;\n</code></pre>\n\n<p><code>CHAR</code> and <code>WCHAR</code> is defined in <strong>WinNT.h</strong> as:</p>\n\n<pre><code>typedef char CHAR;\n#ifndef _MAC\ntypedef wchar_t WCHAR;    // wc,   16-bit UNICODE character\n#else\n// some Macintosh compilers don't define wchar_t in a convenient location, or define it as a char\ntypedef unsigned short WCHAR;    // wc,   16-bit UNICODE character\n#endif\n</code></pre>\n\n<p><code>CreateFileA()</code> accepts <code>LPCSTR</code> file names, which are stored in 8-bit <code>char</code> array internally.<br>\n<code>CreateFileW()</code> accepts <code>LPCWSTR</code> file names, which are stored in 16-bit <code>wchar_t</code> array internally.</p>\n\n<p>I have created a file in the position <em>C:\\𤭢.txt</em>. It looks like it is not possible to open this file using <code>CreateFile()</code>, because it contains the character 𤭢 whose Unicode code point is 0x24B62 which doesn't fit even in a WCHAR array cell.</p>\n\n<p>But that file exists in my harddisk and Windows manages it normally. How do I open this file by a Win32 API function, like Windows does internally?</p>\n"},{"tags":["windows","security","internet-explorer","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":70,"score":2,"question_id":12642575,"title":"Changing Internet Explorer settings programmatically","body":"<p>In Internet Explorer, <strong>Internet Options -> Advanced</strong> we have Multiple <strong>check-box</strong> for settings.</p>\n\n<p>I want to programmatically manage all of them.</p>\n\n<p>I looked at Internet Explorer API but doesn't find much.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>I want specifically Uncheck these two check boxes</p>\n\n<p><img src=\"http://i.stack.imgur.com/wYr49.jpg\" alt=\"enter image description here\"></p>\n\n<p>Please suggest.</p>\n"},{"tags":["python","winapi","gtk","gevent","gtk3"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":152,"score":4,"question_id":12414874,"title":"How to intergrate Python's GTK with gevent?","body":"<p>Gtk is a GUI toolkit with bindings to Python. Gevent is a Python networking library built on top of libevent (libev on newer versions) and greenlets, allowing the usage of network functions inside greenlets without blocking the whole process.</p>\n\n<p>Both Gtk an gevent have blocking main loops that dispatch events. How to integrate their main loops so that I can receive both network events and UI events on my application, without one blocking another?</p>\n\n<p>The naive approach is to register an idle callback on Gtk's main loop, that is called instead whenever there is no Gtk event. In this callback, we yield the greenlet so network events can happen, also giving a small timeout, so the process does not busy waits:</p>\n\n<pre><code>from gi.repository import GLib\nimport gevent\n\ndef _idle():\n    gevent.sleep(0.1)\n    return True\n\nGLib.idle_add(_idle)\n</code></pre>\n\n<p>This approach is far from ideal, because I have a delay of 100 miliseconds between UI events processing, and if I lower the value too much, I waste too much processor busy-waiting.</p>\n\n<p>I want a better approach, where my process is truly asleep while there is no event to process.</p>\n\n<p>PS: I've already found a Linux specific solution (that will probably work under MacOS, too). What I really need now is a working Windows solution.</p>\n"},{"tags":["c#","visual-studio","winapi"],"answer_count":3,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":188,"score":5,"question_id":8547572,"title":"How to disable an hooking to my proccess?","body":"<p>Is there any debug/prepossessing param or any option under Windows 7 and visual studio to prevent from other processes hooking to my process?</p>\n\n<p>I am writing a game for Windows, under Visual Studio, and was wondering if there is a way to disable user to hook to the game's process?</p>\n"},{"tags":["windows","winapi","operating-system","cpu","internals"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":12637874,"title":"slicing processes in windows","body":"<p>I wonder how Windows is doing process slicing.</p>\n\n<p>Lets say that \"A\" is quantum of time/slice for my application\nit last some time (few miliseconds) then it is switched to\nsome system operations \"S\" and other applications \"U\" - and again</p>\n\n<p>--time---></p>\n\n<p>ASUASUASUASUASUASUASUASU</p>\n\n<p>q  q  q  q   q  q  q  q</p>\n\n<p>Besides that is there maybe some background processing (\"q\" here)\n(related to interrupts I think, mouse arrow or maybe fuulling the \napps events queue) - or maybe not and system is black dead when doing A\nquantum ?</p>\n\n<p>How many more can be said about such model, for example how much time\nbeleongs to A S U slices and what it depends on?</p>\n\n<p>(Sorry for my weak english.)</p>\n"}]}
{"total":13828,"page":9,"pagesize":100,"questions":[{"tags":["winapi","icons"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12636750,"title":"Extract icon name from *.icl, *.dll","body":"<p>An icon library is file containing one or more icons and their names.\nTo extract icon we use ExtractIcon function.\nWhat function to use to extract icon name?</p>\n"},{"tags":["windows","delphi","winapi","delphi-xe2","delphi-2007"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":326,"score":2,"question_id":12637203,"title":"Why does CreateProcess give error 193 (%1 is not a valid Win32 app)","body":"<p>The code below fails to start documents. I get error 193 (%1 is not a valid Win32 app). Starting executables work fine.\nThe files are properly associated, they start the corresponding app when double clicked.\nI have searched SO and elsewhere for the error message, createprocess stuff etc. (E.g. <a href=\"http://stackoverflow.com/questions/331829/why-is-createprocess-failing-in-windows-server-2003-64-bit\">Why is CreateProcess failing in Windows Server 2003 64-bit?</a>\nI know about quoting the command line.</p>\n\n<ul>\n<li><p>This is a Delphi XE2 (Update 4) Win32 app in a Win7 64bit VMWare VM. </p></li>\n<li><p>The code also fails on the host machine (Win7 64 bit) and in a Virtual PC VM with 32bit XP.</p></li>\n<li><p>The apps that should start in the Win7 VM (Excel 2003 and Crimson Editor) are 32 bit.</p></li>\n<li><p>The failure occurs both when starting from the IDE or when running the test app standalone</p></li>\n<li><p>It used to be Delphi2007 code, the compiled D2007 app where this code comes from works fine everywhere.</p></li>\n</ul>\n\n<p>What's wrong with the code? It's almost as if I'm overlooking something very obvious....</p>\n\n<p>Thanks in advance,</p>\n\n<p>Jan</p>\n\n<pre><code>procedure StartProcess(WorkDir, Filename: string; Arguments : string = '');\nvar\n  StartupInfo  : TStartupInfo;\n  ProcessInfo  : TProcessInformation;\n  lCmd         : string;\n  lOK          : Boolean;\n  LastErrorCode: Integer;\nbegin\n  FillChar( StartupInfo, SizeOf( TStartupInfo ), 0 );\n  StartupInfo.cb := SizeOf( TStartupInfo );\n  StartupInfo.dwFlags := STARTF_USESHOWWINDOW;\n  StartupInfo.wShowWindow := sw_Normal;\n\n  FillChar( ProcessInfo, SizeOf( TProcessInformation ), 0 );\n\n  lCmd := '\"' +  WorkDir + FileName + '\"';     // Quotes are needed http://stackoverflow.com/questions/265650/paths-and-createprocess\n  if Arguments &lt;&gt; '' then lCmd := lCmd + ' ' + Arguments;\n\n  lOk := CreateProcess(nil,\n                       PChar(lCmd),\n                       nil,\n                       nil,\n                       FALSE,  // TRUE makes no difference\n                       0,      // e.g. CREATE_NEW_CONSOLE or NORMAL_PRIORITY_CLASS makes no difference\n                       nil,\n                       nil,    // PChar(WorkDir) makes no difference\n                       StartupInfo,\n                       ProcessInfo);\n\n  if lOk then\n  begin\n    try\n      WaitForSingleObject(ProcessInfo.hProcess, INFINITE);\n    finally\n      CloseHandle( ProcessInfo.hThread );\n      CloseHandle( ProcessInfo.hProcess );\n    end;\n  end\n  else\n  begin\n    LastErrorCode := GetLastError;\n    ShowMessage(IntToStr(LastErrorCode) + ': ' + SysErrorMessage(LastErrorCode));\n  end;\nend;\n\nprocedure TFrmStartProcess.Button1Click(Sender: TObject);\nbegin\n   StartProcess('c:\\program files (x86)\\axe3\\','axe.exe');    // Works\nend;\n\nprocedure TFrmStartProcess.Button2Click(Sender: TObject);\nbegin\n   StartProcess('d:\\','klad.xls');                            // Fails\nend;\n\nprocedure TFrmStartProcess.Button3Click(Sender: TObject);\nbegin\n   StartProcess('d:\\','smimime.txt');                         // Fails\nend;\n</code></pre>\n"},{"tags":["windows","delphi","winapi","desktop","windows-shell"],"answer_count":1,"favorite_count":3,"up_vote_count":12,"down_vote_count":1,"view_count":305,"score":11,"question_id":8256022,"title":"How to enter Windows Flip 3D mode on Windows Vista and above?","body":"<p>Is it possible to trigger the <a href=\"http://windows.microsoft.com/en-US/windows-vista/Using-Windows-Flip-3D\" rel=\"nofollow\"><code>Flip 3D mode</code></a> on Windows Vista above systems programmatically?<br><br>\n<img src=\"http://i.stack.imgur.com/FV9TO.png\" alt=\"enter image description here\"><br><br>\nIt is the same as if you manually press <kbd>CTRL</kbd> + <kbd>WIN</kbd> + <kbd>TAB</kbd></p>\n"},{"tags":["winapi","windows-7","aero-snap"],"answer_count":1,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":408,"score":4,"question_id":8368540,"title":"Save and restore Aero Snap position on Windows 7","body":"<p>Let's say I have a window and I want to save its position when the window closes and restore it when the window is opened again. The typical way to do this is to call GetWindowPlacement / SetWindowPlacement. This takes care of remember the position and the maximized / minimized state.</p>\n\n<p>On Windows 7, you can dock a window to the side of the screen using the <a href=\"http://en.wikipedia.org/wiki/Windows_Aero\" rel=\"nofollow\">\"Aero Snap\"</a> feature. My question is how do you save and restore windows that have been \"Snapped\" so that you can restore the \"Snap\" state. GetWindowPlacement / SetWindowPlacement does not solve this problem (to my knowledge) and I haven't seen any \"Snap\" API's in Windows 7.</p>\n\n<p>There is a similar question on here \n<a href=\"http://stackoverflow.com/questions/1999035/how-to-detect-window-was-resized-by-windows7\">How to detect window was resized by Windows7</a> but in this case it seems that the OP just wanted the restore position, not the \"Snap\" state.</p>\n"},{"tags":["c++","winapi","qt-creator","include-path","kmdf"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":162,"score":0,"question_id":12637340,"title":"erreur : C1083: Cannot open include file: 'wdm.h': No such file or directory","body":"<p>I am trying to build this code with qtcreator, my point is to create a new device using <code>RtlInitUnicodeString</code> and <code>IoCreateDevice</code> </p>\n\n<pre><code>#define _WIN32_WINNT 0x0501\n\n#include &lt;string&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;iostream&gt;\n#include &lt;tchar.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;qdebug.h&gt;\n\n#include &lt;wdm.h&gt;\n#include &lt;Ntifs.h&gt;\n#include &lt;windows.h&gt;\n\n#define BUFSIZE MAX_PATH\n\nint main(  )\n{\n   BOOL bFlag;\n   TCHAR Buf[BUFSIZE];     // temporary buffer for volume name\n\n\n   //create a new device\n\n   NTSTATUS     ntStatus = STATUS_SUCCESS;\n   UNICODE_STRING       deviceNameUnicodeString;\n   UNICODE_STRING       deviceLINKNameUnicodeString;\n   int i;\n\n       RtlInitUnicodeString(&amp;deviceNameUnicodeString, L\"\\\\Device\\\\Harddisk0\\\\Partition3\");\n       RtlInitUnicodeString(&amp;deviceLINKNameUnicodeString, L\"\\\\DosDevices\\\\I:\");\n\n\n       ntStatus = IoCreateDevice (  theDriverObject,\n                       0, // For driver extension\n                       &amp;deviceNameUnicodeString,\n                       FILE_DEVICE_UNKNOWN,\n                       FILE_DEVICE_SECURE_OPEN,\n                       FALSE,\n                       &amp;g_MyDeviceI\n                       );\n\n\n        IoCreateSymbolicLink (&amp;deviceLINKNameUnicodeString, &amp;deviceNameUnicodeString);\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>erreur : C1083: Cannot open include file: 'wdm.h': No such file or directory\n</code></pre>\n\n<p>and here is my .pro file</p>\n\n<pre><code>SOURCES += \\\n    main.cpp \\\n    VolumeCreationWind.cpp \\\n    ChangePassWd.cpp \\\n    PasswordMountWind.cpp \\\n    MainWindow.cpp \\\n    DeviceInfos.cpp\n\nHEADERS += \\\n    VolumeCreationWind.h \\\n    PasswordMountWind.h \\\n    ChangePassWd.h \\\n    MainWindow.h \\\n    DeviceInfos.h \\\n\n\nFORMS +=\nCONFIG += release\nINCLUDEPATH += C:\\WinDDK\\7600.16385.1\\inc\\ddk\nINCLUDEPATH += C:\\WinDDK\\7600.16385.1\\inc\\wdf\\kmdf\\1.9\n</code></pre>\n\n<p>1) How can I fix the error of include path</p>\n\n<p>2) can any one explain for me the use of <code>IoCreateDevice</code> and how create <code>theDriverObject</code></p>\n\n<p>Any help please!!!!\nThanks in advance.</p>\n"},{"tags":["c++","linux","json","osx","winapi"],"answer_count":5,"favorite_count":4,"up_vote_count":12,"down_vote_count":3,"view_count":2192,"score":9,"question_id":2350814,"title":"Recommendations for cross-platform C/C++ JSON library?","body":"<p>I'm looking for recommendations for a reliable and functional cross-platform JSON library that can be called from either C or C++ and which can be used with Linux, Mac OS X and WIN32. Ideally it should support both generating JSON output as well as parsing JSON input.</p>\n\n<p>I've looked at a lot of the open source options but it's hard to tell how mature, reliable and well-documented each of the various libraries are, so I'm really looking for individual recommendations from developers who have successfully used or at least evaluated one or more of the various options.</p>\n"},{"tags":["winforms","winapi","audio","signal-processing"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12635346,"title":"Create an Audio Graphic Equalizer for Windows","body":"<p>I need to create an <strong>audio graphic equalizer</strong> with the commonly used <strong>presets</strong>, for an application in Windows. I need to <strong>apply the equalization effects globally</strong> across all applications in Windows (ex DFX audio enhancer v11.1 applies effects at system level). </p>\n\n<p>Currently I can get to the frames of the system audio using sAPO samples provided by Microsoft. But I need to apply graphic equalization to this.</p>\n\n<p>Does Microsoft provides <strong>any API or Sample code</strong> for creating graphic equalizer in Windows?</p>\n\n<p>Kindly inform me if there are any <strong>other Libraries or Open Source</strong> project that I can use for this purpose.</p>\n"},{"tags":["visual-studio-2010","winapi","plugins"],"answer_count":6,"favorite_count":7,"up_vote_count":27,"down_vote_count":0,"view_count":6738,"score":27,"question_id":2672277,"title":"Rockscroll or Metalscroll for Visual Studio 2010 (Minimap)","body":"<p>Has any one found a replacement for <a href=\"http://www.hanselman.com/blog/IntroducingRockScroll.aspx\">Rockscroll</a> or <a href=\"http://visualstudiogallery.msdn.microsoft.com/3a50c69b-9b35-4eb2-b06a-328758afcaa2\">Metalscroll</a> for Visual Studio 2010? </p>\n\n<p>I miss it so much that I looked into making one my self but only have word highlighting working and a place holder scroll bar and seems to be much harder than I thought it would be. I'm happy to share what I got if someone is interested in helping.</p>\n"},{"tags":["windows","winapi"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12633161,"title":"Is there a way to turn the Windows ghosting feature back on after DisableProcessWindowsGhosting?","body":"<p>We have an application that do heavy work in the main thread. To prevent Windows from deeming it 'Not Responding' and starting the ghosting feature (as described in section 'Hangs - Operating System Perspective' in this <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd744765%28v=vs.85%29.aspx\" rel=\"nofollow\">link</a>) during the heavy work, we could use <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms648415%28v=vs.85%29.aspx\" rel=\"nofollow\">DisableProcessWindowsGhosting</a> to turn the ghosting feature off.</p>\n\n<p>But we don't want to turn it off for the rest of the session, we want to turn it back on once the heavy work is done. Unfortunately Windows doesn't provide any (documented) API for that.</p>\n\n<p>Is there any (possibly hacky) way to turn it back on?</p>\n\n<p>As an interesting note, when the application runs in VC debugger, the ghosting feature is turned off, but once the it's detached, it's back on. There must be something the debugger does, any idea?</p>\n"},{"tags":["winapi","uac","shellexecute","createprocessasuser"],"answer_count":1,"favorite_count":7,"up_vote_count":6,"down_vote_count":0,"view_count":5788,"score":6,"question_id":2426594,"title":"starting a UAC elevated process from a non-interactive service (win32/.net/powershell)","body":"<p>I'm using a thrid party Windows service that handles some automation tasks by running scripts and executables using CreateProcessAsUser(). I'm running into problems on Windows Server 2008 due to UAC and way the LUA elevation is handled through the APIs.</p>\n\n<p>The service runs as LocalSystem and does not have \"Interact With Desktop\" enabled. The processes are being run as users in the Administrators group, but not the Administrator account (which is exempted from many UAC restrictions). All the UAC default settings in place.</p>\n\n<p>I can pass arbitrary commands or powershell code to the service, but I can't seem to 'break out' of the non-elevated, non-interactive process that gets kicked off by the service.</p>\n\n<p>The crux of the issue seems to be that the only (public) API option for starting an elevated process is ShellExecute() with the 'runas' verb, but as far as i can tell that can't be called from a non-interactive service or you get errors like \"This operation requires an interactive window station\".</p>\n\n<p>The only workaround I've found is mentioned here:\n<a href=\"http://www.eggheadcafe.com/software/aspnet/29620442/how-to-proper-use-sendinp.aspx\" rel=\"nofollow\">http://www.eggheadcafe.com/software/aspnet/29620442/how-to-proper-use-sendinp.aspx</a> </p>\n\n<blockquote>\n  <p>In Vista, the official documented way\n  to elevate a process is only using the\n  shell API ShellExecute(Ex)(not\n  CreateProcess or CreateProcessAsUser).\n  So your application must call\n  ShellExecute(Ex) to launch a helper\n  elevated to call SendInput.\n  Furthermore, due to Session 0\n  isolation, a service can only use\n  CreateProcessAsUser or\n  CreateProcessWithLogonW(can not use\n  ShellExecute(Ex)) to specify the\n  interactive desktop.</p>\n  \n  <p>..I think there is no direct way to\n  spawn an elevated process from a\n  windows service. We can only first use\n  CreateProcessAsUser or\n  CreateProcessWithLogonW to spawn a\n  non-elevated process into  the user\n  session(interactive desktop). Then in\n  the non-elevated process, it may use\n  ShellExecute(Ex) to spawn an elevated\n  process for the real task.</p>\n</blockquote>\n\n<p>To do this from .net/powershell code, it looks like I'd have to do some elaborate P/Invoke stuff to call CreateProcessAsUser or CreateProcessWithLogonW since the .Net System.Diagnostics.ProcessStartInfo doesn't have an equivalent of lpDesktop that I could set to \"winsta0\\default\". And I'm not clear on if LocalSystem even has the rights to call CreateProcessAsUser or CreateProcessWithLogonW.</p>\n\n<p>I also looked at\n<a href=\"http://blogs.msdn.com/alejacma/archive/2007/12/20/how-to-call-createprocesswithlogonw-createprocessasuser-in-net.aspx\" rel=\"nofollow\">http://blogs.msdn.com/alejacma/archive/2007/12/20/how-to-call-createprocesswithlogonw-createprocessasuser-in-net.aspx</a>\nand\n<a href=\"http://stackoverflow.com/questions/2313553/process-start-with-different-credentials-with-uac-on\">http://stackoverflow.com/questions/2313553/process-start-with-different-credentials-with-uac-on</a></p>\n\n<p>Based on all that, I'm reaching the conclusion that there's no straightforward way to do this. Am I missing something? This really doesn't seem like it should be so hard. It feels like UAC was just never designed to handle non-interactive use cases.</p>\n\n<p>And if any Microsoft people end up reading this, I noticed that the way ShellExecute internally handles elevation is by calling out to Application Information Service (AIS). Why isn't that same call to AIS available through some Win32 or .NET API?\n<a href=\"http://msdn.microsoft.com/en-us/library/bb756945.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/bb756945.aspx</a></p>\n\n<p>Sorry that ran a bit long. Thanks for any ideas.</p>\n"},{"tags":["python","winapi","pywin32"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":415,"score":1,"question_id":5078570,"title":"How to set process priority using pywin32 and WMI?","body":"<pre><code>from win32com.client import GetObject\n\nfor proc in GetObject(\"WinMgmts:{impersonationLevel=impersonate,(IncreaseBasePriority,Debug)}\").InstancesOf(\"Win32_Process\"):\n  if proc.CommandLine == \"&lt;my-command-line&gt;\":\n    proc.SetPriority(4) # fails\n</code></pre>\n\n<p>I have tried passing a <em>priority class</em> (0x40) as well as an actual priority (4), but both fail with the following message:</p>\n\n<pre><code>  File \"test.py\", line 5, in &lt;module&gt;\n    proc.SetPriority(0x40)\n  File \"C:\\Progs\\Python26\\lib\\site-packages\\win32com\\client\\dynamic.py\", line 505, in __getattr__\n    ret = self._oleobj_.Invoke(retEntry.dispid,0,invoke_type,1)\npywintypes.com_error: (-2147352567, 'Exception occurred.', (0, u'SWbemObjectEx', u'Invalid parameter ', None, 0, -2147217400), None)\n</code></pre>\n\n<p>I can see that it's not liking some parameter, but why not?</p>\n\n<p>I'm not interested in a non-WMI solution using <code>SetPriorityClass</code>. I have given myself the <code>SeDebugPrivilege</code> as follows:</p>\n\n<pre><code>import win32security, ntsecuritycon, win32con, win32api\nprivs = ((win32security.LookupPrivilegeValue('',ntsecuritycon.SE_DEBUG_NAME), win32con.SE_PRIVILEGE_ENABLED),)\nhToken = win32security.OpenProcessToken(win32api.GetCurrentProcess(), win32security.TOKEN_ALL_ACCESS)\nwin32security.AdjustTokenPrivileges(hToken, False, privs)\nwin32api.CloseHandle(hToken)\n</code></pre>\n"},{"tags":["windows","winapi","visual-c++","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12623381,"title":"2 way communication between WebControl and Win32/MFC","body":"<p>I am working on a win32/MFC application; in this application I have embedded WebControl on dialog.</p>\n\n<p>when application is launched then it will load web page, in that user will enter some fields and then press submit button. </p>\n\n<p>Once user presses the submit, then server will process that data and displays some unique ID to user.</p>\n\n<p>Now our requirement is, we don’t want to display that unique ID on the web page instead, that web page needs to send that data to our client application(Win32/MFC).</p>\n\n<p>To do this I found a solution:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/3747414/calling-c-function-from-javascript-script-running-in-a-web-browser-control\">Calling C++ function from JavaScript script running in a web browser control</a></p>\n\n<p>is this is the right way to do it or is there any other solution is there.</p>\n\n<p>Please help me to solve this problem</p>\n"},{"tags":["c++","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":736,"score":1,"question_id":6520428,"title":"How to query a running process for it's parameters list? (windows, C++)","body":"<p>for a given windows process I want to know with what command line parameters it was started. The windows task manager is able to show that for example.</p>\n\n<p>Thank you in advance!</p>\n"},{"tags":["c++","c","winapi","character-encoding"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":84,"score":0,"question_id":12629885,"title":"Encoding from Mac OS Roman to UTF8?","body":"<p>I am trying to convert a <a href=\"http://en.wikipedia.org/wiki/Mac_OS_Romana\" rel=\"nofollow\">Mac OS Roman</a> string to a UTF8 string:</p>\n\n<p><code>MacRoman: OneBW/1 Schwarzwei§:</code></p>\n\n<p>I am using these calls:</p>\n\n<pre><code>nBufLen = MultiByteToWideChar(CP_MACCP, 0, macRomanString.c_str(), -1, NULL, 0);\n\nMultiByteToWideChar(CP_MACCP, 0, macRomanString.c_str(), -1, tempWchar, nBufLen);\n</code></pre>\n\n<p>At this point:</p>\n\n<p><code>tempWhar = OneBW/1 Schwarzweiß:</code></p>\n\n<p>Now I am making this call:</p>\n\n<p><code>WideCharToMultiByte(CP_UTF8, 0, tempWchar, -1, temp, nBufLen, NULL, NULL);</code></p>\n\n<p>I am expecting <code>temp</code> to be in UTF 8, but I'm getting return value <code>0</code>, which is unsuccessful translation, something string in <code>temp</code>. How do I know string in <code>temp</code> is in UTF ?</p>\n\n<p>Am I doing it the right way or is something missing? Thanks.</p>\n"},{"tags":["windows","vb.net","winapi","code-signing","sha1"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":12628161,"title":"Calling CryptCATCatalogInfoFromContext Throw errors","body":"<p>I want to call the function <strong>CryptCATCatalogInfoFromContext</strong> available in <strong>wintrust.dll</strong>. But when I do that I receive an error saying <strong>Specified array was not of the expected type.</strong>\nI am using the following code to invoke method. It seems some data type I'm using is mismatching with the required data type. </p>\n\n<pre><code>    'import wintrust.dll\n    &lt;DllImport(\"Wintrust.dll\", PreserveSig:=True, SetLastError:=False)&gt; _\n    Private Shared Function CryptCATCatalogInfoFromContext(ByVal catalogContext As IntPtr, ByVal hash As CATALOG_INFO_, ByVal dwFlags As Integer) As Boolean\n    End Function\n\n    'create structure CATALOG_INFO\n    &lt;StructLayout(LayoutKind.Sequential)&gt; _\n        Public Structure CATALOG_INFO_\n        Public cbStruct As UInteger\n        &lt;MarshalAs(UnmanagedType.SafeArray)&gt; _\n        Public wszCatalogFile() As Char \n    End Structure\n</code></pre>\n\n<p>I have already obtained CatalogContext.</p>\n\n<pre><code>        Dim infoStruct As New CATALOG_INFO_()\n        infoStruct.cbStruct = 256\n        Dim c(255) As Char\n        infoStruct.wszCatalogFile = c\n        CryptCATCatalogInfoFromContext(CatalogContext, infoStruct, 0)\n</code></pre>\n\n<p>the last line throws the error <strong>Specified array was not of the expected type.</strong>\nHave I used a wrong data type for the array?</p>\n"},{"tags":["c","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":284,"score":1,"question_id":6413502,"title":"How to use WAVEHDR","body":"<p>Where can I find information about what data should be in the <code>lpData</code> buffer for the <a href=\"http://msdn.microsoft.com/library/dd743837%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>WAVEHDR</code></a> structure?</p>\n\n<p>MSDN simply says:</p>\n\n<blockquote>\n  <p><strong>lpData</strong></p>\n  \n  <p>Pointer to the waveform buffer.</p>\n</blockquote>\n\n<pre><code>typedef struct wavehdr_tag {\n    LPSTR               lpData;\n    DWORD               dwBufferLength;\n    DWORD               dwBytesRecorded;\n    DWORD_PTR           dwUser;\n    DWORD               dwFlags;\n    DWORD               dwLoops;\n    struct wavehdr_tag  *lpNext;\n    DWORD_PTR           reserved;\n} WAVEHDR, *LPWAVEHDR;\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12627048,"title":"c++ allocated memory in dllmain/ __attribute__ constructor","body":"<p>I've been reading about what happens when you do some initialization for a shared library. The concept is all well and good, but I'm unclear as to how memory is allocated and the scope it has in the program. </p>\n\n<p>Take for instance creating an integer in DLLMain (whether it's process_attach or thread_attach) on the stack or heap. Is that integer in the global scope of the program or would it be somewhere else? As in, if I new'd in an integer in DLLMain would it be accessible globally in the program, or just specially to main or perhaps some other weird case? If it is accessible in the global scope, does that mean that all threads can access that memory as well?</p>\n\n<p>Thanks for any help.</p>\n"},{"tags":["c#","vb.net","silverlight","winapi","sendkeys"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":539,"score":1,"question_id":5839301,"title":"Sending keystrokes to a Flash/Silverlight app embedded in a webbrowser control (mostly done)","body":"<p><strong>NOTE: This doesn't seem to necessarily apply to Silverlight only, I've read people have the same problems with Flash, so keep that in mind.</strong></p>\n\n<p>I'm trying to write a program that will control Netflix through my own buttons (for now, eventually it will be extended to a mobile remote control app), by sending hotkeys directly to it using the windows api.</p>\n\n<ul>\n<li>I am able to retrieve the actual window handle used by the Netflix Silverlight player.</li>\n<li>I am able to send keystrokes to specified window handles (using the <code>TranslateMessage</code> function in win api)</li>\n<li>But I cannot, for some reason, get the netflix player to recognize any keystroke I send.</li>\n<li>I have tried using the <code>SetFocus</code> function in the win api before attempting to send keypresses and that doesn't help.</li>\n</ul>\n\n<p>What I need to figure out, is why it's differentiating keys sent via api calls, from physical keyboard key presses.</p>\n\n<p>Here's how I have things set up (window class names for reference):</p>\n\n<blockquote>\n  <p>Form1 (<code>WindowsForms10.Window.8.app.0.33c0d9d</code>)</p>\n  \n  <blockquote>\n    <p>WebBrowser Control (<code>Shell DocObject View</code>)</p>\n    \n    <blockquote>\n      <p>HTML Page (<code>Internet Explorer_Server</code>)</p>\n      \n      <blockquote>\n        <p>Embedded Silverlight player (<code>MicrosoftSilverlight</code>) </p>\n      </blockquote>\n    </blockquote>\n  </blockquote>\n</blockquote>\n\n<p>I was wondering if someone might be able to offer some suggestions.  Thanks very much in advance.. hopefully someone can help get me through this.</p>\n"},{"tags":["winapi","installer","nsis"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12613534,"title":"Change loading bar colour in NSIS Installer","body":"<p><strong>How I change the colour of the Loading Bar in the Install Files page of an NSIS installer?</strong></p>\n\n<p>The following attempts to send the message PBM_SETBARCOLOR to the loading bar window but the colour of the load bar never changes?</p>\n\n<pre><code>!include MUI2.nsh\n!include WinMessages.nsh\n\nInstallDir  \"abc\"\nName        \"def\"        \nOutFile     \"def.exe\"\n\n!define MUI_PAGE_CUSTOMFUNCTION_SHOW InstFilesPageShow\n!insertmacro MUI_PAGE_INSTFILES\n\n!macro RefreshWindow HWND IDC\n    GetDlgItem $R0 ${HWND} ${IDC}\n    ShowWindow $R0 ${SW_HIDE}\n    ShowWindow $R0 ${SW_SHOW}\n!macroend\n\nFunction InstFilesPageShow\n\n    SendMessage 1004 ${PBM_SETBARCOLOR} 0 \"COLORREF(0,200,200)\" #0xFF0000\n    System::Call `user32::SendMessage(i R1, i ${PBM_SETBARCOLOR}, i 0, i COLORREF(0,0,0))`  #System::Call `user32::SetWindowPos(i R8, i ${HWND_TOP}, i 0, i 0, i ${w}, i ${h}, i ${SWP_NOMOVE})`\n    #!insertmacro RefreshWindow $HWND 1004\n    #!insertmacro RefreshWindow $mui.InstallPage 1004\n    !insertmacro RefreshWindow $HWNDPARENT 1004\n\nFunctionEnd\n\nSection \"Dummy\" \n    DetailPrint \"Test\"\nSectionEnd\n</code></pre>\n"},{"tags":["c++","winapi","atl","wtl"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12625096,"title":"CListViewCtrl usage","body":"<p>So I have  CListViewCtrl, I have found how to select an entire row from <a href=\"http://cboard.cprogramming.com/windows-programming/66184-select-entire-row-listview-using-win32.html\" rel=\"nofollow\">here</a>, what I want to do next:\n1.Add a right click context menu with options to delete or add new row records.\n2. How to retrieve the entire data found in every column on that row. How do I do that?</p>\n"},{"tags":["windows","winapi","sdk","microsoft","manifest"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12623296,"title":"Manifest doubts","body":"<p>I followed the below steps.<br>\n1.I am calling 2 exes(b&amp;c) from one exe(a) which are all mingw based.<br>\n2.I created 3 seperate manifiest files for a,b,c using <code>mageui.exe</code>.<br>\n3.Executed the below command for all 3 manifest files and for the corresponding exe's.</p>\n\n<pre><code>mt.exe –manifest temp.manifest –outputresource:YourApp.exe;#1\n</code></pre>\n\n<p>My questions:<br>\n1. Are the above steps correct?<br>\n2. If they are correct, is it required to distribute the manifest files with the exe's?<br>\n3. Is it possible to manage with only one manifest file instead of 3 for each exe?</p>\n"},{"tags":["c++","winapi","events"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12620380,"title":"Close Events after using it in WaitForMultipleObjects function","body":"<p>I have a vector of event objects, which is used in <code>WaitForMultipleObjects</code> function. After an event is signalled I tried to close the event using the close handle function, but I am getting an error like <code>Invalid handle was specified</code>. Can anybody tell that what the issue is? </p>\n\n<pre><code>std::vector&lt;HANDLE&gt; eventVector;\n//..\n// Entering data to vector\n\nsize_t count = eventVector.size();\nDWORD signaledEvent;\nWhile(count &gt; 0)\n{\n  if (WAIT_OBJECT_0 == (signaledEvent =     WaitForMultipleObjects(handleVector.size(),handleVector.data(), false, INFINITE)))\n  CloseHandle(handleVector[signaledEvent - WAIT_OBJECT_0]); // Here I am getting error.\n  count--;\n}\n</code></pre>\n"},{"tags":["c++","winapi","disk-partitioning"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12621592,"title":"Creating new partition disk winapi","body":"<p>I'am trying to create new partition and mount a volume to this new, I thought that <code>CreateFile</code> let me do this, with this code :</p>\n\n<pre><code>LPCTSTR lpFileName=L\"\\\\\\\\.\\\\Device\\\\Harddisk0\\\\Partition3\";\nHANDLE handl=CreateFile( lpFileName,\n                            GENERIC_READ | GENERIC_WRITE,\n                            FILE_SHARE_READ | FILE_SHARE_WRITE,\n                            NULL,\n                            CREATE_ALWAYS,\n                            FILE_ATTRIBUTE_NORMAL,\n                            NULL  );\n   if (handl==INVALID_HANDLE_VALUE)\n   {\n   qDebug()&lt;&lt;\"handl invalid\"&lt;&lt;\" error\"&lt;&lt;GetLastError();}\n\n\n   bool success = DefineDosDevice(DDD_RAW_TARGET_PATH,L\"I:\",L\"\\\\Device\\\\Harddisk0\\\\Partition3\");\n   if(!success)\n       qDebug()&lt;&lt;\" DefineDosDevice failed \"&lt;&lt;GetLastError();\n\n\n   bFlag = GetVolumeNameForVolumeMountPoint(\n               L\"I:\\\\\", // input volume mount point or directory\n               /** what u do in this directory u find it in th mount piont and vice versa**/\n                  Buf, // output volume name buffer\n              BUFSIZE  // size of volume name buffer\n           );\n   if (bFlag != TRUE)\n   {\n      //_tprintf( TEXT(\"Retrieving volume name for %s failed.\\n\"), argv[2] );\n      qDebug()&lt;&lt;\"Retrieving volume name failed.      \"&lt;&lt;GetLastError();\n      return (-2);\n   }\n    qDebug()&lt;&lt;\"Volume name\"&lt;&lt;QString::fromWCharArray(Buf);\n\n\n\n    bool fResult = DefineDosDevice (\n                         DDD_RAW_TARGET_PATH|DDD_REMOVE_DEFINITION|\n                         DDD_EXACT_MATCH_ON_REMOVE, L\"I:\",\n                         L\"\\\\Device\\\\Harddisk0\\\\Partition3\");\n    if (!fResult)\n                qDebug()&lt;&lt;\"DefineDosDevice failed  \"&lt;&lt; GetLastError();\n\n\n\n   bFlag = SetVolumeMountPoint(L\"D:\\\\myDirExample\\\\example\\\\\", // mount point\n                               /** should b empty**/\n                                Buf // volume to be mounted\n                               );\n\n   if (!bFlag)\n      {\n        qDebug()&lt;&lt;\"Attempt to mount failed\";\n        qDebug()&lt;&lt;\"error \"&lt;&lt;GetLastError();\n      }\n\n   return (bFlag);\n\n\n   CloseHandle(handl);\n</code></pre>\n\n<p>I have:</p>\n\n<pre><code>handl invalid  error 3 \nRetrieving volume name failed  erorr  2\n</code></pre>\n\n<p>The first error is ERROR_PATH_NOT_FOUND: The system cannot find the path specified.\nSo how can I fix <code>lpFileName</code> to make it works</p>\n\n<p>thanks in advance, any help will be appreciated.</p>\n"},{"tags":["winapi","win32gui"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12620944,"title":"win32 - detecting all the parent windows of an child window","body":"<p>Just like the <code>EnumChildWindows</code> API, was wondering if the opposite is possible.. i.e., if there is an technique or API to enumerate all the Parent windows of an child window, and ultimately arrive at the main application window.</p>\n\n<p>My issue is that I have more than 1 different applications having the same child window (identifiable by its window class and caption). I want to detect which application specific child window is active at a time, or if both are active would like to work with any one? </p>\n\n<p>For example I have 2 apps running called \"XYZ\" and \"ABC\", and both having a child window/dialog having same reg. class and caption say - \"Configuration\". Now I would like to get the window details of the \"Configuration\" dialog from say the \"XYZ\" application?</p>\n\n<p>Hope I was able to present the problem details properly.</p>\n\n<p>Thanks,</p>\n"},{"tags":["c++","winapi","gcc"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":738,"score":2,"question_id":4505806,"title":"Compiling WIN32 code with GCC","body":"<p>I have tried to compile some C++ WIN32 code with GCC through DevC++ (MinGW GCC). It seams that it failed to link the objects and it didn't give me a clear error message: \"[PathToSource] > Error 1\".</p>\n\n<p>Tried the same thing with Eclipse (MinGW GCC) and it compiled. However, not all of the resources show as I have an icon set to compile as the icon of the application, it's loaded from the resource files. I also get a console window in the background as I run the application.</p>\n\n<p>What is the cause of this? How can I make the resource files compile with the code and also avoid the loading of a console window in the background.</p>\n\n<p>I was also wondering if there's a way to compile WIN32 code in Linux through GCC, or a way to port it for the same compiler.</p>\n"},{"tags":["winapi","exception-handling","crash-reports","breakpad"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":344,"score":1,"question_id":8260742,"title":"SetUnhandledExceptionFilter and default exception handler when crash report dialog is disabled","body":"<p>I have a situation where an application which uses SetUnhandledExceptionFilter (via <a href=\"http://code.google.com/p/google-breakpad/\" rel=\"nofollow\">google breakpad</a> ) to set up a custom exception handler is hanging after the breakpad exception handler has caught a crash, saved a minidump file and returned EXCEPTION_EXECUTE_HANDLER from the SetUnhandledExceptionFilter function, to execute the standard exception handler.  The hang also happens if the filter function returns EXCEPTION_CONTINUE_SEARCH and the Windows Error Report dialog has been disabled via SetErrorMode().  If SetErrorMode() is not used to disable WER, the process closes once the user clicks the 'Close' button in the WER dialog.</p>\n\n<p>The hang happens under Windows XP but not Windows 7.</p>\n\n<p>The documentation for <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms680634%28v=vs.85%29.aspx\" rel=\"nofollow\">SetUnhandledExceptionFilter</a> states that when 'EXECEPTION_EXECUTE_HANDLER' is returned, the associated exception handler will execute which \"usually results in process termination,\" but I couldn't find documentation of the termination method used.</p>\n\n<p>A stack trace shows that the hang is occurring in a global destructor for an object in a 3rd party DLL, called from the DllMain() prelude.</p>\n\n<pre><code>ntdll.dll!_KiFastSystemCallRet@0()  \nntdll.dll!_NtWaitForSingleObject@12()  + 0xc bytes  \nkernel32.dll!_WaitForSingleObjectEx@12()  + 0x8b bytes  \nkernel32.dll!_WaitForSingleObject@8()  + 0x12 bytes \nQtCore4.dll!QWaitCondition::wait(QMutex * mutex=0x03ad1b00, unsigned long time=4294967295)  Line 175 + 0x15 bytes   C++\nQtCore4.dll!QThreadPoolPrivate::waitForDone()  Line 295 + 0x10 bytes    C++\nQtCore4.dll!QThreadPool::~QThreadPool()  Line 429   C++\nQtCore4.dll!QThreadPool::`vector deleting destructor'()  + 0x3d bytes   C++\nQtCore4.dll!`theInstance'::`8'::`dynamic atexit destructor for 'cleanup''()  + 0x14 bytes   C++\nQtCore4.dll!_CRT_INIT(void * hDllHandle=0x02b2b2d0, unsigned long dwReason=45265416, void * lpreserved=0x02b2b208)  Line 446    C\nQtCore4.dll!__DllMainCRTStartup(void * hDllHandle=0x67000000, unsigned long dwReason=0, void * lpreserved=0x00000000)  Line 557 + 0x8 bytes C\nQtCore4.dll!_DllMainCRTStartup(void * hDllHandle=0x67000000, unsigned long dwReason=0, void * lpreserved=0x00000001)  Line 507 + 0xe bytes  C\nntdll.dll!_LdrpCallInitRoutine@16()  + 0x14 bytes   \nntdll.dll!_LdrShutdownProcess@0()  - 0xfe bytes \nkernel32.dll!__ExitProcess@4()  + 0x42 bytes    \nkernel32.dll!7c81cb0e()     \nkernel32.dll!_BaseThreadStart@8()  + 0x2f479 bytes  \n</code></pre>\n\n<p>I guess that the mutex was locked by a thread that has since been killed, but I can imagine other kinds of global ctors/dtors that might be executed in this way that would cause a similar problem.  My questions are:</p>\n\n<ul>\n<li>Is it expected behavior that <code>ExitProcess()</code> is called in the event of a crash if WER is disabled via <code>SetErrorMode()</code>?</li>\n<li>Does anyone know of a change in behavior of the default exception handlers between Windows XP and Windows 7 which might be relevant?</li>\n<li>If <code>ExitProcess()</code> is expected behavior, what is the safest way to deal with this problem in third-party DLLs?  Calling <code>TerminateProcess()</code> from the breakpad exception handler fixes the problem but are there any caveats I should be aware of?</li>\n</ul>\n"},{"tags":["c++","winapi","service","power-management"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12232829,"title":"How to know if wake timers are enabled from a Windows local service?","body":"<p>I'm writing a Windows local service using C++. I need to know if wake timers are enabled on the system that it is running on. How can I do that from a local service?</p>\n\n<p>The setting that is circled in this screenshot:</p>\n\n<p><img src=\"http://i.stack.imgur.com/zaamR.png\" alt=\"enter image description here\"></p>\n"},{"tags":["windows","winapi","popup"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":54,"score":-1,"question_id":12606318,"title":"How to hide or destroy a popup window when click outside the popup window","body":"<p>When click a button , I  create a window with popup style and show it .\nAnd , I want to hide or destroy this window when i click outside the window.\ni can do this by using  wm_killfocus message. When the window receive the message ,hide the window .\nbut the problem is :\n when the window is exist , if i click the button , the window should hide .\nbut the fact is:\nwhen click the button , the window receive the wm_killfocus message and then the button receive WM_lbuttondown message ,  the window hide when receive wm_killfocus, and the click message event let the window show again. \nSo ,the final effect is window don't hide.</p>\n"},{"tags":["c++","file","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12610230,"title":"How to get SaveDialogBox combobox values","body":"<p>I want to set extension of file if user did not do this and concatenate the file name and extension-combobox-string.Is there some easy way to do so, or i need some \"hooks\"?</p>\n\n<pre><code>    OPENFILENAME ofn;       // common dialog box structure\n    TCHAR szFile[260];       // buffer for file name                      \n    HANDLE hFile;              // file handle\n\n    // Initialize OPENFILENAME\n    ZeroMemory(&amp;ofn, sizeof(ofn));\n    ofn.lStructSize = sizeof(ofn);\n    ofn.hwndOwner = hwnd;\n    ofn.lpstrFile = szFile;\n    // Set lpstrFile[0] to '\\0' so that GetOpenFileName does not \n    // use the contents of szFile to initialize itself.\n    ofn.lpstrFile[0] = 0;\n    ofn.nMaxFile = sizeof(szFile);\n    ofn.lpstrFilter = _T(\"Текстові файли(*.txt)\\0*.txt\\0Word(*.doc)\\0*.doc\\0\");\n    ofn.nFilterIndex = 1;\n    ofn.lpstrFileTitle = NULL;\n    ofn.nMaxFileTitle = 0;\n    ofn.lpstrInitialDir = NULL;\n    ofn.Flags = OFN_EXPLORER;   \n\n    if(GetSaveFileName(&amp;ofn) == TRUE)\n    {\n        hFile = CreateFile( szFile,\n            GENERIC_WRITE,\n            0,\n            (LPSECURITY_ATTRIBUTES)NULL,\n            CREATE_NEW,\n            FILE_ATTRIBUTE_NORMAL,\n            (HANDLE)NULL);\n\n        int editLen = Edit_GetTextLength(edit);\n        TCHAR* buffer = new TCHAR[editLen+1];\n        DWORD wroteLen = 0;\n\n        Edit_GetText(edit,buffer,editLen+1);\n        //Set extension if need\n\n        ///////////////////////\n        if(!WriteFile(hFile,buffer,editLen*sizeof(TCHAR),&amp;wroteLen,NULL))\n            MessageBox(hwnd,_T(\"File wasn`t saved..\"),_T(\"Error\"),MB_ICONERROR);\n\n        CloseHandle(hFile);\n        delete[]buffer;\n</code></pre>\n\n<p>Thank you for response! ))</p>\n"},{"tags":["c#","delphi","winapi","messagebox"],"answer_count":1,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":241,"score":6,"question_id":12570167,"title":"Getting the text from a dialog box that does not use a label control?","body":"<p>This is a continuation of my previous question <a href=\"http://stackoverflow.com/questions/12532812/how-to-supress-a-dialog-box-an-inproc-com-server-displays\">How to supress a dialog box an Inproc COM Server displays</a>.</p>\n\n<hr>\n\n<h2>Background:</h2>\n\n<p>A recap of my situation: I have a Inproc COM Server written in Delphi from a 3rd party. One of the functions I call will display a error message dialog box if it traps a specific type of error. The issue is I am trying to process data in bulk, and the data source I am using is causing that error dialog to pop up a lot (thanks to the answer of my previous question it now auto closes and I was able to run it to completion, it would have shown the dialog box and required someone to press OK 9923 times). The process blocks till the message box is closed.</p>\n\n<hr>\n\n<h2>Question:</h2>\n\n<p>I would like to have better logging of what the error dialog said. However any attempt to get get the body text of the dialog box has failed.</p>\n\n<p><img src=\"http://i.stack.imgur.com/01WJr.png\" alt=\"Image of Dialog Box\"></p>\n\n<pre><code>//Snip\n\nprivate void StartWindowListener()\n{\n    //Queue the watcher on the message pump if we are not watching.\n    if (_watcherRunning == false)\n    {\n        _watcherRunning = true;\n        _dummyForm.BeginInvoke(new Action(() =&gt;\n        {\n            _watcherRunning = false;\n\n            //If we are not inside the com object don't enumerate.\n            if (_insideCom == false) return;\n\n            // Enumerate windows to find dialogs\n            EnumThreadWndProc callback = new EnumThreadWndProc(CheckWindow);\n            EnumThreadWindows(GetCurrentThreadId(), callback, IntPtr.Zero);\n            GC.KeepAlive(callback);\n        }));\n    }\n}\n\nprivate bool CheckWindow(IntPtr hWnd, IntPtr lp)\n{\n    // Checks if hWnd is the expected dialog\n    StringBuilder sb = new StringBuilder(260);\n    GetClassName(hWnd, sb, sb.Capacity);\n    if (sb.ToString() == \"TMessageForm\")\n    {\n        //This returns the dialog box's title\n        GetWindowText(hWnd, sb, sb.Capacity);\n\n        //This returns IntPtr.Zero\n        var hDialogText = GetDlgItem(hWnd, 0xFFFF);\n        if (hDialogText != IntPtr.Zero)\n            GetWindowText(hDialogText, sb, sb.Capacity);\n\n        //This returns a empty string\n        GetDlgItemText(hWnd, 0xFFFF, sb, sb.Capacity);\n\n\n        //Only sees the OK button.\n        IntPtr hCtl = IntPtr.Zero;\n        HashSet&lt;IntPtr&gt; seen = new HashSet&lt;IntPtr&gt;();\n        while ((hCtl = GetNextDlgGroupItem(hWnd, hCtl, false)) != IntPtr.Zero)\n        {\n            //When we see the same control twice, break out of the loop.\n            if (seen.Add(hCtl) == false)\n                break;\n\n            GetClassName(hCtl, sb, sb.Capacity);\n            SendMessage(hCtl, WM_GETTEXT, sb.Capacity, sb)\n\n            //Close the dialog by sending WM_CLOSE to the window\n            SendMessage(hWnd, WM_CLOSE, IntPtr.Zero, IntPtr.Zero);\n        }\n\n         //Snip...\n    }\n    return true;\n}\n\n//Snip...\n\n// P/Invoke declarations\nconst int WM_CLOSE = 0x0010;\nprivate delegate bool EnumThreadWndProc(IntPtr hWnd, IntPtr lp);\n[DllImport(\"user32.dll\")]\nprivate static extern bool EnumThreadWindows(int tid, EnumThreadWndProc callback, IntPtr lp);\n[DllImport(\"user32.dll\")]\nprivate static extern int GetClassName(IntPtr hWnd, StringBuilder buffer, int buflen);\n[DllImport(\"user32.dll\")]\nprivate static extern IntPtr SendMessage(IntPtr hWnd, int msg, IntPtr wp, IntPtr lp);\n[DllImport(\"kernel32.dll\")]\nprivate static extern int GetCurrentThreadId();\n</code></pre>\n\n<p>I thought I may have been interrupting the dialog before it gets to add the text to it (it is not fully painted yet when I break in the above code). However putting a <code>Application.DoEvents</code> inside StartWindowListener before it starts the enumeration allows the dialog box to fully paint but I still get the same results as I posted with the above code.</p>\n\n<p>Doing a Ctrl-C works correctly on the dialog box so I could use that in a pinch, but being that I have to repeat this 9923 times I would like to avoid using that programmatically.</p>\n\n<p>Is there any other methods I can try to get the text from the Message box?</p>\n"},{"tags":["c#",".net","winapi","createfile"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":105,"score":2,"question_id":12608190,"title":"Handle does not support synchronous operations with CreateFile","body":"<p>I need to open read disk in raw mode, so I'm using CreateFile API function for that purposes.</p>\n\n<pre><code>private static FileStream OpenDisk(string drive)\n{\n    // Try to open hard disk drive in raw mode for reading\n    SafeFileHandle safeHandle = Native.CreateFile(\n        string.Format(@\"\\\\.\\{0}\", drive),\n        FileAccess.Read,\n        FileShare.Read,\n        IntPtr.Zero,\n        FileMode.Open,\n        FileAttributes.ReadOnly | FileAttributes.Device,\n        IntPtr.Zero);\n\n    // Check if the drive was successfully opened\n    if (safeHandle.IsInvalid)\n    {\n        Marshal.ThrowExceptionForHR(Marshal.GetHRForLastWin32Error());\n    }\n\n    // Create file stream on the file for reading\n    return new FileStream(safeHandle, FileAccess.Read);\n}\n</code></pre>\n\n<p>But when I try to read from the stream I get the following error</p>\n\n<p><code>Handle does not support synchronous operations. The parameters to the FileStream constructor may need to be changed to indicate that the handle was opened asynchronously (that is, it was opened explicitly for overlapped I/O).</code></p>\n\n<p>Here is the sample code that reproduces this issue</p>\n\n<pre><code>using (FileStream stream = OpenDisk(\"X:\"))\n{\n    byte[] buffer = new byte[1000];\n    while (stream.Read(buffer, 0, 1000) &gt; 0) { }\n}\n</code></pre>\n\n<p>I don't really get what does it want from me? It works when I use larger buffer (for example 4096). When I say it works I mean it really works (always), it was working for a while, until I changed buffer size. I guess it does some kind of asynchronous buffering inside and when I specify larger buffer then default buffering size it's just not used, but how to get rid of this?</p>\n\n<p>Thanks</p>\n\n<p><strong>update</strong></p>\n\n<p>When I try to read it using BufferedStream I get the same issue</p>\n\n<pre><code>using (BufferedStream stream = new BufferedStream(OpenDisk(\"X:\"), 4096))\n{\n    byte[] buffer = new byte[1000];\n    while (stream.Read(buffer, 0, 1000) &gt; 0) { }\n}\n</code></pre>\n\n<p>Do I understand wrong purpose of BufferedStream? Shouldn't it read and cache chunks of specified size?</p>\n"},{"tags":["windows","vb.net","winapi","code-signing","sha1"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12608003,"title":"Calculating the Hash of a file using CryptCATAdminCalcHashFromFileHandle in vb","body":"<p>I am following the code for Checking the Digital Signature of a file at <a href=\"http://forum.sysinternals.com/discuss-howto-verify-digital-signature-of-a-file_topic19404_page2.html\" rel=\"nofollow\">Sysinternals</a></p>\n\n<p>There I need to get the hash value of a file. for that part I'm using the following code.</p>\n\n<pre><code>        'Open file\n        Dim fs As FileStream = New FileStream(filename, FileMode.Open, FileAccess.Read, FileShare.Read, 8)\n\n\n        'Get the size we need for our hash.\n        Dim fileHandle As IntPtr = fs.SafeFileHandle.DangerousGetHandle()\n        Dim hashSize As Integer\n        Dim hash As Byte() = New Byte(256) {}\n\n        Dim b As Boolean = CryptCATAdminCalcHashFromFileHandle(fileHandle, hashSize, Nothing, 0)\n\n        'check results\n        System.Console.WriteLine(fileHandle)\n        System.Console.WriteLine(hashSize)\n        System.Console.WriteLine(hash)\n        System.Console.WriteLine(b)\n</code></pre>\n\n<p>Using wintrust.dll as follows</p>\n\n<pre><code>    &lt;DllImport(\"Wintrust.dll\", PreserveSig:=True, SetLastError:=False)&gt; _\n    Private Shared Function CryptCATAdminCalcHashFromFileHandle(ByRef fileHandle As IntPtr, ByVal hash As IntPtr, ByVal hashSize As Byte(), ByVal dwFlags As Integer) As Boolean\n    End Function\n</code></pre>\n\n<p>Output for file handle gets different values in different executions (Which is ok)\nBut the hashsize, and hash are always zero. and b is always false.</p>\n\n<p>Am I missing something here.\nPlease advice</p>\n"},{"tags":["c++","file","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12607283,"title":"MultiByteToWideChar or WideCharToMultiByte and txt files","body":"<p>I'm trying to write a universal text editor which can open and display ANSI and Unicode in EditControl. Do I need to repeatedly call <code>ReadFile()</code> if I determine that the text is ANSI? Can't figure out how to perform this task. My attempt below does not work, it displays '?' characters in EditControl.</p>\n\n<pre><code>LARGE_INTEGER fSize;\n        GetFileSizeEx(hFile,&amp;fSize);\n\n        int bufferLen = fSize.QuadPart/sizeof(TCHAR)+1;\n        TCHAR* buffer = new TCHAR[bufferLen];       \n        buffer[0] = _T('\\0');\n\n        DWORD wasRead = 0;\n        ReadFile(hFile,buffer,fSize.QuadPart,&amp;wasRead,NULL);        \n        buffer[wasRead/sizeof(TCHAR)] = _T('\\0');\n\n        if(!IsTextUnicode(buffer,bufferLen,NULL))\n        {                       \n            CHAR* ansiBuffer = new CHAR[bufferLen];\n            ansiBuffer[0] = '\\0';\n            WideCharToMultiByte(CP_ACP,0,buffer,bufferLen,ansiBuffer,bufferLen,NULL,NULL);\n            SetWindowTextA(edit,ansiBuffer);\n            delete[]ansiBuffer;\n        }\n        else\n            SetWindowText(edit,buffer);\n\n        CloseHandle(hFile);\n        delete[]buffer;\n</code></pre>\n"},{"tags":["winapi","directshow","gdi","screen-capture"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12604384,"title":"DirectShow Filter to grab a specific window","body":"<p>I saw another question that sounds almost the same but the answers seem to be about whole desktop screen capture: <a href=\"http://stackoverflow.com/questions/4214786/directshow-source-filter-using-dekstop-window-as-source\">DirectShow Source filter using Dekstop window as source</a>.</p>\n\n<p>I have looked at the PushSource and yes it does what it is meant to do, however I want the virtual webcam to grab a specific window (similar to how you can select to share a window in Skype's share screen).</p>\n\n<p>How would I go about selecting a specific window as a capture for the virtual webcam? is there a specific method already in the DirectShow API that I don't know about that does this?</p>\n"},{"tags":["windows","winapi"],"answer_count":2,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1379,"score":4,"question_id":1544179,"title":"What are the differences between BringWindowToTop, SetForegroundwindow, SetWindowPos etc.?","body":"<p>BringWindowToTop, SetForegroundWindow, SwitchToThisWindow, SetWindowPos, ShowWindow all are described as showing and activating a window.</p>\n\n<p>What are the real differences between them?  When and why would BringWindowToTop be preferred to SetForegroundWindow, (Or SwitchToThisWindow or even SetWindowPos with the flags to activate and show)?</p>\n"},{"tags":["delphi","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":119,"score":0,"question_id":12604263,"title":"CreateProcessAsUser How to add privileges?","body":"<p>I'm trying to call execute an application from another windows application under another users account using this code:</p>\n\n<pre><code>procedure TForm1.Button3Click(Sender: TObject);\nvar\n  userName: string;\n  password: string;\n  domain: string;\n  path: string;\n  logonok: boolean;\n  impok: boolean;\n  hUserToken: THandle;\n  ProcessCreatedOK: Boolean;\n  startupInfo: TStartupInfo;\n  processInfo: TProcessInformation;\n  err: DWORD;\nbegin\n    username := 'theusername';\n    password := 'thepassword';\n    domain := '';\n    Path := 'myapp.exe';\n\n    LogonOK := LogonUser(PWideChar(username), PWideChar(domain), PWideChar(password),\n      LOGON32_LOGON_INTERACTIVE, LOGON32_PROVIDER_DEFAULT, hUserToken);\n\n    if LogonOK then\n    begin\n      impOK := ImpersonateLoggedOnUser(hUserToken);\n\n      if impok then\n      begin\n        FillChar(startupInfo, SizeOf(startupInfo), 0);\n        startupInfo.CB := SizeOf(startupinfo);\n        startupInfo.dwFlags := STARTF_USESHOWWINDOW;\n        startupinfo.wShowWindow := SW_SHOWNORMAL;\n\n        NewState.PrivilegeCount := 1;\n        res := LookupPrivilegeValue(\n          nil,\n          SE_ASSIGNPRIMARYTOKEN_NAME,\n          NewState.Privileges[0].Luid);\n          Win32Check(res);\n\n        NewState.Privileges[0].Attributes := SE_PRIVILEGE_ENABLED;\n        res := AdjustTokenPrivileges(\n          hUserToken,\n          False,\n          NewState,\n          SizeOf(NewState),\n          nil,\n          returnLength);\n        Win32Check(res);\n\n        NewState.PrivilegeCount := 1;\n        res := LookupPrivilegeValue(\n          nil,\n          SE_INCREASE_QUOTA_NAME,\n          NewState.Privileges[0].Luid);\n          Win32Check(res);\n\n        NewState.Privileges[0].Attributes := SE_PRIVILEGE_ENABLED;\n        res := AdjustTokenPrivileges(\n          hUserToken,\n          False,\n          NewState,\n          SizeOf(NewState),\n          nil,\n          returnLength);\n        Win32Check(res);\n\n        ProcessCreatedOK := CreateProcessAsUser(\n           hUserToken,\n           nil,\n           PChar(path),\n           nil, nil,\n           false,\n           CREATE_NEW_CONSOLE or NORMAL_PRIORITY_CLASS, nil, nil,\n           startupInfo, processInfo);\n\n        if GetLastError &lt;&gt; 0 then\n        begin\n          err := GetlastError;\n          ShowMessage(inttostr(err) + ' ' +  SysErrorMessage(err));\n        end;\n      end;\n    end;\n</code></pre>\n\n<p>I'm getting a 1314 \"A required privilege is not held by the client\" error.</p>\n\n<p>Now from some digging around I can see that I need to apply some privileges to the impersonated account: SE_ASSIGNPRIMARYTOKEN_NAME and SE_INCREASE_QUOTA_NAME?</p>\n\n<p>Does anyone have some suggestions on how to do this?</p>\n\n<p>I've seen the JCL example given in this Stackoverflow <a href=\"http://stackoverflow.com/questions/2746053/delphi-and-createprocessasuser-example\">answer</a> but I get similar issues with regards to account privileges.</p>\n\n<p>I'd prefer not to use CreateProcessWithLogonW - I can explain why on request.</p>\n"},{"tags":["c#","winapi","postmessage"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":193,"score":2,"question_id":8666502,"title":"How to get hWnd of Edit Box when there are more than one?","body":"<p>I have a program that is not mine that has 3 TEdit boxes and 3 TButton objects. I can easily get the button handles by using:</p>\n\n<pre><code>IntPtr buttonhwnd = FindWindowEx(mainhwnd, IntPtr.Zero, \"TButton\", \"Button Text\");\n</code></pre>\n\n<p>But I can't do the same with the Edit boxes since they don't have any text in them. Therefore <code>FindWindowEx(hWnd, IntPtr.Zero, \"TEdit\", \"\")</code> can get all of them. However, it only gets the first one it comes across and I need the last one. Is there a way to skip a number of boxes or differentiate between them?</p>\n"},{"tags":["c","windows","winapi","windows-7"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":12603735,"title":"How to detect process set with CREATE_NEW_PROCESS_GROUP and why GetConsoleProcessList(..) return process with CREATE_NEW_CONSOLE flag?","body":"<p>I am trying to emulate SIGTERM in windows using GenerateConsoleCtrlEvent(..). I read the condition should be that the new process be in a new process group and share the console of the calling process.  In connection to this work, I have two questions -</p>\n\n<ol>\n<li><p>Given a process id,  is it possible to determine using any current windows API if the process is created with CREATE_NEW_PROCESS_GROUP flag?  </p></li>\n<li><p>GetConsoleProcessList(..) gives me all process belonging to the console of the calling process including the one created with CREATE_NEW_CONSOLE flag. This looked like a surprise, so can someone clarify the meaning of it?</p></li>\n</ol>\n"},{"tags":["windows","winapi","escaping","html-escape-characters"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12600849,"title":"Is there a WinAPI native function to escape HTML?","body":"<p>Is there a native WinAPI to call to escape a string for HTML/XML into <code>&amp;lt;</code> <code>&amp;gt;</code> etc?</p>\n"},{"tags":["winapi","localization"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12591993,"title":"GetDateFormat with LOCALE_SSHORTDATE returns non-localized numbers","body":"<p>I am running Windows 7 + Foreign language pack. (I've set the default locale to be the foreign language) I have a valid SYSTEMTIME struct and I am trying to build a localized date/time from it.</p>\n\n<p>This is how I get the format string and then try to get the localized date</p>\n\n<pre><code>WCHAR pFmt[MAX_SIZE] = {0};\nint localeinfo=GetLocaleInfo(localeID, LOCALE_SSHORTDATE, pFmt, sizeof(pFmt)/sizeof(TCHAR));\n</code></pre>\n\n<p>I've tried all the following</p>\n\n<pre><code>GetDateFormat(LOCALE_USER_DEFAULT, 0, &amp;st, pFmt, formattedString, MAX_PATH);\nGetDateFormat(LOCALE_SYSTEM_DEFAULT, 0, &amp;st, pFmt, formattedString, MAX_PATH);\nGetDateFormat(localeinfo, 0, &amp;st, pFmt, formattedString, MAX_PATH);\n</code></pre>\n\n<p>The string with the numbers does not get localized - In all the cases I always get formattedstring to be </p>\n\n<pre><code>pFmt            \"dd/MM/yyyy\"\nformattedString \"25/09/2012\"      (I want this to be in the foreign language)\n</code></pre>\n\n<p>How can I get the formattedstring to have localized values for the numbers?</p>\n"},{"tags":["winapi","vba","excel-vba"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":12582737,"title":"How to get the Shape Clicked without Application.Caller","body":"<p>How can I retrieve the shape that was clicked to run a macro, without using <code>Application.Caller</code>?.  Its name or the shape itself as an object.</p>\n\n<p>I cant use <code>Application.Caller</code> because if the shape name is bigger than 30 characters, it retrieves only the first 30 characters.</p>\n\n<p>Maybe there is an API that could retrieve the Sape object?</p>\n\n<p><strong>Edit:</strong></p>\n\n<ol>\n<li>I don't want to loop shapes in sheet.  Looping throug all shapes in the workbook takes too much time.</li>\n<li>I can not rename the Shapes.</li>\n</ol>\n\n<p>Thanks</p>\n"},{"tags":["winapi","visual-c++","console","kinect"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12561808,"title":"Getting errors in NuiApi.h when compiling project with kinect sdk","body":"<p>For the purposes of testing ,I have tried building a win32 console project (empty project) so as to compile make sure that the kinect sdk would work.</p>\n\n<p>On building i got hundreds of errors in NuiApi.h </p>\n\n<p>All I have done was to include NuiApi.h in my source code i did nothing else.</p>\n\n<p>here is the project </p>\n\n<p><a href=\"https://dl.dropbox.com/u/4740547/ConsoleApplication1.zip\" rel=\"nofollow\">https://dl.dropbox.com/u/4740547/ConsoleApplication1.zip</a></p>\n\n<p>Try to building it and you will see all the errors pop up. I would be really grateful if anyone can tell me where im going wrong.</p>\n"},{"tags":["windows","winapi","visual-c++","taskmanager","task-manager"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":44,"score":2,"question_id":12580253,"title":"ambiguous behaviour on ending program from task manager","body":"<p>I made a simple Windows application using WINAPI and then handled WM_CLOSE in its WinProc to display a message box asking confirmation from the user to confirm or cancel closing the window.</p>\n\n<p>When simply clicking on cross button the application works fine but on ending the application from task manager it shows different behavior for model and non model message boxes.</p>\n\n<p>On using a model message-box there is only one message box that pops up for user confirmation but on using non-model message-box two message boxes that pop up.</p>\n\n<p>Why is it showing two dialog boxes????</p>\n\n<p>Here is my code</p>\n\n<pre><code>case WM_CLOSE:\n  if (MessageBox(NULL, \"Do you want to quit\",\"Exit\",MB_OKCANCEL|MB_ICONQUESTION) == IDOK)\n    PostQuitMessage (WM_QUIT);\n  else\n    ShowWindow (hWnd, SW_RESTORE);\n  break;\n</code></pre>\n\n<p>The full code can be seen at</p>\n\n<p><a href=\"http://codepad.org/elkXnBM1\" rel=\"nofollow\">http://codepad.org/elkXnBM1</a></p>\n"},{"tags":["python","winapi","openoffice.org","libreoffice"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12596298,"title":"python win32 extensions and (open-)libreoffice","body":"<p>I am facing an issue with python win32 extensions and open-libreoffice.\nI installed the extensions (tried it two ways:)</p>\n\n<ol>\n<li>Drag and drop all the contents of the site-packages inside the openoffice python.</li>\n<li>Totally uninstalled system-python and run the win32 exe after fixing registry entry using <a href=\"http://effbot.org/zone/python-register.htm\" rel=\"nofollow\">this script</a> so that oo-python is known to the system.</li>\n</ol>\n\n<p>Problem is that when a macro has the statement <code>import win32ui</code> <strong>the entire office hangs</strong> (Not responding and I have to kill it. Using the console everything works fine).</p>\n\n<p>Any ideas?? <strong>Has anyone successfully used win32 extensions inside a macro script in open or libreoffice?</strong></p>\n\n<p>(tried it in win xp,2003 and libre 3,5-3,6 and openoffice 3.4.1)</p>\n"},{"tags":["c++","winapi","process"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":12599688,"title":"Access Violation when duplicating token","body":"<p>Below code generates:</p>\n\n<blockquote>\n  <p>Unhandled exception at 0x749ab763 in MyProgram1.exe: 0xC0000005: Access violation writing location 0x00d4eb38.</p>\n</blockquote>\n\n<pre><code>    SECURITY_ATTRIBUTES sa = {0};\n    sa.nLength = sizeof(sa);\n    STARTUPINFO si = {0};\n    si.cb = sizeof(si);\n    //si.cbReserved2 = sizeof(si);\n    si.lpDesktop = L\"winsta0\\\\default\";\n\n    CreateProcessAsUser(hUserTokenDup, NULL, L\"Setup.exe\", &amp;sa, &amp;sa, false, NORMAL_PRIORITY_CLASS | CREATE_NEW_CONSOLE, NULL, NULL, &amp;si, &amp;procinfo);\n</code></pre>\n\n<p>Is there anything wrong with the code? Please help</p>\n"},{"tags":["asp.net-mvc","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12599415,"title":"Win8 ASP.net HttpRouteUrl","body":"<p>I am pretty new to Win8 and ASP.net development, I apologize for any lack of clarity or specification as I am a 3D graphics programmer by trade and taking on developing an ASP.net back end system. The goal is communicate with a target Win8 app to consume data that is input via the ASP.net website by a user(admin).</p>\n\n<p>I am hitting multiple hurdles and dead ends with it being new Win8 technologies and few sound reference materials.</p>\n\n<p>Within HomeController.cs I am attempting to call:</p>\n\n<pre><code> public ActionResult Admin()\n    {\n\n        string apiUri = Url.HttpRouteUrl(\"DefaultApi\", new { controller = \"testModel\", });\n        ViewBag.ApiUrl = new Uri(Request.Url, apiUri).AbsoluteUri.ToString();\n\n        return View();\n    }\n</code></pre>\n\n<p>So that I can enable routing to my Admin controller. However I get the following output in the browser:</p>\n\n<p><a href=\"http://i.imgur.com/WX34S.png\" rel=\"nofollow\">http://i.imgur.com/WX34S.png</a></p>\n\n<p>I am using an example project I downloaded from the internet as a skeleton framework as it contains the WebApiConfig.cs file, whereas generating a new VS2012 ASP.NET MVC Web Application project does not contain this file and I believe I need it as it is the point I am able to specify that I want to serialize as JSON and remove XML formatting.</p>\n\n<p>I have cleaned out .DLL files in bin and cleaned the obj folder in case it was referencing an object that no longer exists.</p>\n\n<p>There are several other projects that I have created, one that uses the VS2012 MVC Web app project generated from the wizard, it implements:</p>\n\n<pre><code> Url.RouteUrl\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code> Url.HttpRouteUrl\n</code></pre>\n\n<p>But I am sure this does not achieve the same effect, as I want to communicate http over the internet from a server to the target app. If I try to use latter, it errors:</p>\n\n<pre><code>   'System.Web.Mvc.UrlHelper' does not contain a definition for 'HttpRouteUrl' and no extension method 'HttpRouteUrl' accepting a first argument of type 'System.Web.Mvc.UrlHelper' could be found (are you missing a using directive or an assembly reference?)\n</code></pre>\n\n<p>As reference, this is the article I am using to assist this portion of the project:</p>\n\n<p><a href=\"http://www.asp.net/web-api/overview/creating-web-apis/using-web-api-with-entity-framework/using-web-api-with-entity-framework,-part-4\" rel=\"nofollow\">http://www.asp.net/web-api/overview/creating-web-apis/using-web-api-with-entity-framework/using-web-api-with-entity-framework,-part-4</a></p>\n\n<p>I appreciate the help(this is very different from OpenGl and DirectX)</p>\n"},{"tags":["c++","winapi","opengl","createwindowex"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12599408,"title":"CreateWindowsEx() failing with Breakpoint triggered","body":"<p>I've got an issue with opening an OpenGL window from my application.</p>\n\n<p>I am using a 64bit console application, and from within that console I want to open another window for OpenGL to draw into.</p>\n\n<p>The call fails at CreateWindowEx(), and fails with \"MyApp.exe has triggered a breakpoint\"\nFollowing code initializes the window itself.</p>\n\n<pre><code>bool OpenGL_Display::CreateGLWindow(char* title, int width, int height, int bits, bool fullscreenflag, int posX, int posY)\n{\n    GLuint      PixelFormat;            // Holds The Results After Searching For A Match\n    WNDCLASS    wc;                     // Windows Class Structure\n    DWORD       dwExStyle;              // Window Extended Style\n    DWORD       dwStyle;                // Window Style\n    RECT        WindowRect;             // Grabs Rectangle Upper Left / Lower Right Values\n    WindowRect.left=(long)0;            // Set Left Value To 0\n    WindowRect.right=(long)width;       // Set Right Value To Requested Width\n    WindowRect.top=(long)0;             // Set Top Value To 0\n    WindowRect.bottom=(long)height;     // Set Bottom Value To Requested Height\n\n    hInstance           = GetModuleHandle(NULL);                // Grab An Instance For Our Window\n    wc.style            = CS_HREDRAW | CS_VREDRAW | CS_OWNDC;   // Redraw On Size, And Own DC For Window.\n    wc.lpfnWndProc      = NULL;                 // WndProc Handles Messages\n    wc.cbClsExtra       = 0;                                    // No Extra Window Data\n    wc.cbWndExtra       = 0;                                    // No Extra Window Data\n    wc.hInstance        = hInstance;                            // Set The Instance\n    wc.hIcon            = LoadIcon(NULL, IDI_WINLOGO);          // Load The Default Icon\n    wc.hCursor          = LoadCursor(NULL, IDC_ARROW);          // Load The Arrow Pointer\n    wc.hbrBackground    = NULL;                                 // No Background Required For GL\n    wc.lpszMenuName     = NULL;                                 // We Don't Want A Menu\n    wc.lpszClassName    = \"OpenGL\";                             // Set The Class Name\n\n    if (!RegisterClass(&amp;wc))                                    // Attempt To Register The Window Class\n    {\n        MessageBox(NULL,\"Failed To Register The Window Class.\",\"ERROR\",MB_OK|MB_ICONEXCLAMATION);\n        return FALSE;                                           // Return FALSE\n    }\n\n    dwExStyle=WS_EX_APPWINDOW | WS_EX_WINDOWEDGE;           // Window Extended Style\n    dwStyle=WS_OVERLAPPEDWINDOW;                            // Windows Style\n\n    AdjustWindowRectEx(&amp;WindowRect, dwStyle, FALSE, dwExStyle);     // Adjust Window To True Requested Size\n    HWND hwndC = GetConsoleWindow();\n    // Create The Window\n    if (!(hWnd=CreateWindowEx(  dwExStyle,                          // Extended Style For The Window\n                                \"OpenGL\",                           // Class Name\n                                title,                              // Window Title\n                                dwStyle |                           // Defined Window Style\n                                WS_CLIPSIBLINGS |                   // Required Window Style\n                                WS_CLIPCHILDREN,                    // Required Window Style\n                                0, 0,                               // Window Position\n                                WindowRect.right-WindowRect.left,   // Calculate Window Width\n                                WindowRect.bottom-WindowRect.top,   // Calculate Window Height\n                                hwndC,                              // No Parent Window\n                                NULL,                               // No Menu\n                                hInstance,                          // Instance\n                                NULL)))                             // Dont Pass Anything To WM_CREATE\n    {\n        KillGLWindow();                             // Reset The Display\n        MessageBox(NULL,\"Window Creation Error.\",\"ERROR\",MB_OK|MB_ICONEXCLAMATION);\n        return FALSE;                               // Return FALSE\n    }\n}\n</code></pre>\n\n<p>The previous code leading to it:</p>\n\n<pre><code>extern \"C\" __declspec(dllexport) void OpenGLDisplay_Init(int width, int height, int posX, int posY)\n{\n    oglDisp.Init_Display(width, height, posX, posY);\n}\n\nvoid OpenGL_Display::Init_Display(int width, int height, int posX, int posY)\n{\n    if (!CreateGLWindow(\"Ophthametrics Live Display\", width, height, 24, false, posX, posY))\n    {\n        throw;\n    }   \n}\n</code></pre>\n\n<p>What is going wrong in there? I have no idea, and I was using code I used for another application, which worked just fine. Here though it just fails horribly (in the original code it was no console application, but rather a Win32 application without the console). </p>\n\n<p>The final solution would be in a DLL which is called and once it gets called, it should create a window for OpenGL to draw into.</p>\n"},{"tags":["windows","visual-c++","winapi","openssl","nmake"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":837,"score":1,"question_id":3242386,"title":"Error compiling OpenSSL for Win32","body":"<p>I get the following  error when trying to build OpenSSL on Win32:</p>\n\n<blockquote>\n  <p><code>C:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\VC\\INCLUDE\\errno.h(92) : error C2220: warning treated as error - no 'object' file generated</code><br>\n  <code>C:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\VC\\INCLUDE\\errno.h(92) : warning C4005: 'EADDRINUSE' : macro redefinition</code><br>\n  <code>tmp32\\e_os.h(153) : see previous definition of 'EADDRINUSE'</code><br>\n  <code>NMAKE : fatal error U1077: '\"C:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\VC\\BIN\\cl.EXE\"' : return code '0x2'\n  Stop.</code></p>\n</blockquote>\n\n<p>I've followed the instructions in INSTALL.W32 to the letter. I configured with the no-asm flag. I am using Visual Studio Express 2010 C++.</p>\n\n<p>Thank you for your time.</p>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":34,"score":-2,"question_id":12597938,"title":"How to hide my WIN32 Service from Task Manager","body":"<p>I am new in Win32 development,\nI am creating project which tracks user activity.For this purpose I used Windows Service,\nI want to hide my service from task manager.</p>\n\n<p>Please help me.\nThanks in advance.</p>\n"},{"tags":["c#","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12578599,"title":"unfocusable form C#","body":"<p>I need to create unfocusable form in C#.\nOn that form there will be button. After pressing that button I want to paste content of System.Clipboard to the place where the cursot is.\nThis is what I have till now:</p>\n\n<pre><code> public partial class Form1 : Form\n{\n    public Form1()\n    {\n        InitializeComponent();\n    }\n\n    const int WS_EX_NOACTIVATE = 0x08000000;\n    const int WS_EX_TOPMOST = 0x00000008;\n    const int WS_EX_TOOLWINDOW = 0x00000080;\n    const int WM_MOUSEACTIVATE = 0x0021;\n    const int WS_EX_WINDOWEDGE = 0x00000100;\n    const int MA_NOACTIVATEANDEAT = 4;\n    const int WM_NCHITTEST = 0x0084;\n    //const int WM_ACTIVATEAPP = 0x001C;\n    const int WS_THICKFRAME = 0x00040000;\n    const int WS_CHILD = 0x40000000;\n    const int WS_BORDER = 0x00800000;\n    const int WS_DLGFRAME = 0x00400000;\n    const int WS_CAPTION = WS_BORDER | WS_DLGFRAME;\n    const int WS_SYSMENU = 0x00080000;\n\n    protected override bool ShowWithoutActivation { get { return true; } }\n\n    protected override CreateParams CreateParams\n    {\n        get\n        {\n            CreateParams ret = base.CreateParams;\n            ret.Style = WS_THICKFRAME |\n               WS_CHILD | \n                WS_CAPTION | \n                WS_SYSMENU;\n            ret.ExStyle |= WS_EX_NOACTIVATE | \n                WS_EX_TOOLWINDOW |\n                WS_EX_TOPMOST | \n                WS_EX_WINDOWEDGE;\n            ret.X = this.Location.X;\n            ret.Y = this.Location.Y;\n            return ret;\n        }\n    }\n\n    private void simpleButton1_Click(object sender, EventArgs e)\n    {\n        Clipboard.SetText(\"text1 text2\");\n        SendKeys.SendWait(\"^v\");\n    }\n}\n</code></pre>\n\n<p>The form is not the main form of my application.\nThe code works only if the focus is in my application. If I focus notepad or any other program clipboard content is not pasted to it.\nAny one can help with this?</p>\n"},{"tags":["windows","winapi","sdk","mingw","manifest"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12596555,"title":"Manifest for my application Using MageUi.exe","body":"<p>I have a Mingw executable for which I need to create a Manifest file. I used MageUi.exe to create a manifest. But I have the following doubts in it..</p>\n\n<p>1) I have a <code>main.exe</code> which calls <code>sub1.exe</code> and <code>sub2.exe</code>. So in this case while creating Manifest using <code>MageUI.exe</code>, \nDo I need to create a seperate manifest for all the exe's?\nor can I manage with only one manifest file? If yes kindly tell me how to do in MageUi.exe and  mt.exe?</p>\n\n<p>2) What is the use of mt.exe?</p>\n"},{"tags":["winapi","assembly","file-exists","fasm"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":12594403,"title":"FASM - If file exists - Using GetFileAttributes - INVALID_FILE_ATTRIBUTES value?","body":"<p>I am using GetFileAttributesA to determine if a file exists or not, in FASM. I know that if the file does not exists the return value will be INVALID_FILE_ATTRIBUTES, but I am not sure how to check for this value.</p>\n\n<p>My Code:</p>\n\n<pre><code>invoke GetFileAttributes,lpFileName\ncmp    eax,IDK WHAT TO CHECK FOR\nje     notfound\njne    found\ninvoke ExitProcess,0\n</code></pre>\n\n<p>Seeing as the compiler does not recognize INVALID_FILE_ATTRIBUTES as a value:</p>\n\n<pre><code>cmp    eax,INVALID_FILE_ATTRIBUTES\n</code></pre>\n\n<p>Will not work.</p>\n\n<p>Does anyone know the value for this constant, so that I can simply enter it manually?</p>\n\n<p>Any help is appreciated. Thanks</p>\n\n<hr>\n\n<p>After the response from Jens Björnhager, the following is the working code for anyone else interested:</p>\n\n<pre><code>invoke GetFileAttributes,lpFileName\ncmp    eax,-1\nje     notfound\njne    found\ninvoke ExitProcess,0 \n</code></pre>\n\n<p>Or Even:</p>\n\n<pre><code>invoke GetFileAttributes,lpFileName\ncmp    eax,$ffffffff\nje     notfound\njne    found\ninvoke ExitProcess,0 \n</code></pre>\n\n<p>Thanks again Jens Björnhager!</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12583449,"title":"WinAPI device notification - not entering message loop","body":"<p>I am trying to detect when a USB drive is inserted. Right now, I'm creating a dummy window and <code>RegisterDeviceNotification</code>ing it. However, I don't think my approach is correct, as the window doesn't seem to be receiving messages.</p>\n\n<pre><code>#include &lt;iostream&gt;\n#define WINVER 0x501\n#include &lt;windows.h&gt;\n#include &lt;dbt.h&gt;\n#include \"devicehandler.h\"\n#include \"remover.h\"\n\nDeviceHandler::DeviceHandler(Remover* remover)\n{\n    this-&gt;remover = remover;\n    this-&gt;hWnd = this-&gt;createHandleWindow();\n    this-&gt;registerDeviceHandler();\n    this-&gt;messageLoop(this-&gt;hWnd);\n}\n\nDeviceHandler::~DeviceHandler()\n{\n    this-&gt;unregisterDeviceHandler();\n}\n\nvoid DeviceHandler::messageLoop(HWND hWnd)\n{\n    std::cerr &lt;&lt; \"Entering message loop.\" &lt;&lt; std::endl; // Gets here!\n\n    MSG msg;\n    while (GetMessage(&amp;msg, this-&gt;hWnd, 0, 0)) {\n        std::cerr &lt;&lt; \"Loop!\" &lt;&lt; std::endl; // Does not get here!\n        switch (msg.message) {\n            case WM_DEVICECHANGE:\n                {\n                    PDEV_BROADCAST_HDR pHdr = (PDEV_BROADCAST_HDR) msg.lParam;\n                    switch(msg.wParam) {\n                        case DBT_DEVICEARRIVAL:\n                            std::cerr &lt;&lt; \"Device added!\" &lt;&lt; std::endl;\n                            break;\n                        default:\n                            std::cerr &lt;&lt; \"Other device event.\" &lt;&lt; std::endl;\n                            break;\n                    }\n                    break;\n                }\n            default:\n                break;\n        }\n        TranslateMessage(&amp;msg);\n        DispatchMessage(&amp;msg);\n    }\n}\n\nHWND DeviceHandler::createHandleWindow()\n{\n    std::cerr &lt;&lt; \"Creating handle window... \";\n\n    HWND hWnd = CreateWindow(NULL, NULL, WS_ICONIC, 0, 0, CW_USEDEFAULT, 0,\n                             NULL, NULL, GetModuleHandle(NULL), NULL);\n    ShowWindow(hWnd, SW_HIDE);\n\n    std::cerr &lt;&lt; \"done!\" &lt;&lt; std::endl;\n    return hWnd;\n}\n\nvoid DeviceHandler::registerDeviceHandler()\n{\n    std::cerr &lt;&lt; \"Device notification handling... \";\n    // GUID guid = { 0xa5dcbf10, 0x6530, 0x11d2, { 0x90, 0x1f, 0x00, 0xc0, 0x4f, 0xb9, 0x51, 0xed } };\n    GUID guid = { 0x25dbce51, 0x6c8f, 0x4a72, { 0x8a, 0x6d, 0xb5, 0x4c, 0x2b, 0x4f, 0xc8, 0x35 } };\n    DEV_BROADCAST_DEVICEINTERFACE notificationFilter;\n    ZeroMemory(&amp;notificationFilter, sizeof(notificationFilter));\n    notificationFilter.dbcc_size       = sizeof(DEV_BROADCAST_DEVICEINTERFACE);\n    notificationFilter.dbcc_devicetype = DBT_DEVTYP_DEVICEINTERFACE;\n    notificationFilter.dbcc_classguid  = guid;\n\n    this-&gt;deviceNotifier = RegisterDeviceNotification(this-&gt;hWnd,\n                                                      &amp;notificationFilter,\n                                                      DEVICE_NOTIFY_WINDOW_HANDLE);\n    std::cerr &lt;&lt; \"done!\" &lt;&lt; std::endl;\n}\n\nvoid DeviceHandler::unregisterDeviceHandler()\n{\n    UnregisterDeviceNotification(this-&gt;deviceNotifier);\n}\n</code></pre>\n\n<p>I'm guessing that this is not the right place to put the message loop, but I'm not very good with WinAPI. How do I get my program to enter the message loop? (And also preferably register device notifications.)</p>\n"},{"tags":["c++","c","winapi","visual-c++","pe"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":12592821,"title":"C/C++ assign pointer address of DWORD array","body":"<p>I am programming a C/C++ PE Parsing library where I use DLL or exe to extract info about directories and headers. My prblem is when I extract the export address and get the address of functions, I don't know how to use that address to point it to the array with the number of export functions exported</p>\n\n<pre><code>DWORD ExportRVA = PEHeader-&gt;optional.data_directory[0].virtual_address;\nimage_export_directory* Exports = (image_export_directory*)(RVAToOffset(ExportRVA)+BaseAddress);\n\nExportTable.nNames = Exports-&gt;number_of_names;\nExportTable.nFunctions = Exports-&gt;number_of_functions;\nExportTable.pFunctions = Exports-&gt;address_of_functions;\nExportTable.nNames = Exports-&gt;address_of_names;\nExportTable.pNamesOrdinals = Exports-&gt;address_of_name_ordinals;\n</code></pre>\n\n<p>Do I have to assign a pointer to array like </p>\n\n<pre><code>DWORD * AddrFunctions;\n</code></pre>\n\n<p>changing the pointer address?</p>\n"},{"tags":["delphi","winapi","bitmap","gdi","grayscale"],"answer_count":2,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":912,"score":4,"question_id":8559341,"title":"How to convert bitmap to grayscale by pixel intensity using GDI?","body":"<p>I'm looking for the simple solution of how to convert the 32-bit bitmap to grayscale using GDI (not GDI+). Is there a possibility e.g. by changing the bitmap's pallete or something ?</p>\n\n<p>Of course there is plenty of examples in Delphi like <a href=\"http://www.swissdelphicenter.ch/torry/showcode.php?id=437\" rel=\"nofollow\">this one</a>, but I'm looking for a WinAPI function which would do this without iteration through the lines.</p>\n"},{"tags":["c++","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12590247,"title":"Enumerate printers on a remote machine using EnumPrinters function","body":"<p>So what I'm trying to do is to simply enumerate printers on a remote machine in my private network.\nTo do that I'm using EnumPrinters this way:</p>\n\n<pre><code>int main()\n{\n    DWORD const BUFFER_SIZE = 50;\n    PRINTER_INFO_2* prninfo = NULL;\n    DWORD RequestedBufferSize = 0;\n    DWORD InfoLevel = 0;\n    bool suc = EnumPrinters(PRINTER_ENUM_LOCAL|PRINTER_ENUM_NAME,\"\\\\10.0.0.3\",2,NULL,0,&amp;RequestedBufferSize,&amp;InfoLevel);\n    int err = GetLastError();\n    return 0;\n}\n</code></pre>\n\n<p>In the end err = 16385 which is an error code I found no document about.</p>\n\n<p>I will only mention that when I told the function to return info about the local printers it worked.</p>\n\n<p>Does someone has a clue what's wrong here?</p>\n"},{"tags":["winapi","mfc","tchar"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":12589778,"title":"why TTN_NEEDTEXTW but not TTN_NEEDTEXTA?","body":"<p>This is an old problem that I've never figured out - wondered if someone here might happen to know the answer off of the top of your head...</p>\n\n<p>In some parts of our software (MFC/Win32/MBCS) my code will only receive</p>\n\n<p>TTN_NEEDTEXTW</p>\n\n<p>In other parts of our software, I'll receive the MBCS correct message</p>\n\n<p>TTN_NEEDTEXTA</p>\n\n<p>It makes no sense to me.</p>\n\n<p>I understand that our software can be compiled Unicode or not (we are set to use Multibyte character set).  And I have the vague recollection that each window can be constructed Unicode or not, though this is a vague memory, nothing concrete.</p>\n\n<p>Does anyone know why we'd be getting the wide version message some places in our code, despite being compiled as multibyte?</p>\n\n<p>NOTES:  </p>\n\n<ul>\n<li>We're definitely not sending this message - presumably the ToolTip control is.  </li>\n<li>We're definitely only receiving the (W) message in some places, and definitely only receiving the (A) message in others.  </li>\n<li>I'm certain that all compilation modules use MBCS, not Unicode, and that the build targets all specify MBCS not Unicode.  </li>\n<li>This seems to happen only for CMainFrame hosted windows and controls.  i.e. Windows outside of the main frame can use narrow versions (say in a dialog box).  </li>\n</ul>\n"},{"tags":["c++","windows","winapi","memory-management","gcc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12589787,"title":"How prevent memory leak, when killed with tast manager","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/7277477/how-is-dynamically-allocated-space-freed-when-a-program-is-interrupted-using-ctr\">How is dynamically allocated space freed when a program is interrupted using Ctrl-C?</a>  </p>\n</blockquote>\n\n\n\n<p>my application uses pointers, so memory needs to be allocated. </p>\n\n<p>What happen if you kill my application with Task Manager? \nWill windows free the allocated memory? </p>\n\n<p><em>My destructors are not called, so my application can't clean up :(</em> </p>\n\n<p><strong>Is there a solution?</strong></p>\n"},{"tags":["c++","windows","winapi","activex","fullscreen"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12583319,"title":"Fullscreen mode for ActiveX control","body":"<p>I tried to implement a switch-to-fullscreen mode for an ActiveX control. This currently works by removing and hiding the parent window and changing my control's placement and position.</p>\n\n<p>However, I have a problem with switching between applications while the control is in fullscreen mode. If I switch to another application and then click on my window area (not in the taskbar), it seems to not be activated. You can see in the taskbar, that another application still has the highlight and on the main screen, my window is partly hidden behind the taskbar unless it has the focus.</p>\n\n<p>I process the <code>WM_LBUTTONDOWN</code> window message to detect if my window is clicked. And I already tried to call the following WINAPI functions:</p>\n\n<pre><code>::ShowWindow(m_hWnd, SW_RESTORE);\n::SwitchToThisWindow(m_hWnd, FALSE);\n::SetForegroundWindow(m_hWnd);\n::SetActiveWindow(m_hWnd);\n::SetFocus(m_hWnd);\n::BringWindowToTop(m_hWnd);\n::SetWindowPos(m_hWnd, HWND_TOP, m_monitorInfo.rcMonitor.left, m_monitorInfo.rcMonitor.top, m_monitorInfo.rcMonitor.right, m_monitorInfo.rcMonitor.bottom, SWP_NOSIZE | SWP_NOMOVE | SWP_SHOWWINDOW); // SWP_NOACTIVATE, SWP_NOOWNERZORDER\n</code></pre>\n\n<p>I also tried to use <code>::SetWindowLongW(m_hWnd, GWL_STYLE, WS_VISIBLE);</code> which surprisingly gave my window the focus back. But it then suddenly disappeared when trying to switch back from fullscreen mode again.</p>\n\n<p>I have no idea why there are so many different functions that for me seem all to do roughly the same. But it doesn't matter as none of them worked anyway.</p>\n\n<p>What is the/one correct way to behave my control correctly?</p>\n"},{"tags":["c++","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12588875,"title":"What's A Great C++ WINAPI Tutorial That Is Very Explicit?","body":"<p>Are there any really explicit tutorials on the win api?\nI sometimes get confused about streams and some other things aswell, so I would like a tutorial that explains every detail about the examples that they give.</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":136,"score":-1,"question_id":12574113,"title":"Permanently Delete File C++","body":"<p>I am having a simple problem that I cannot find a simple solution to. I am trying to delete a file permanently. I'm not looking for the fanciest way to make the data unrecoverable, I just don't want it sitting in the Recycle Bin. I have two questions.</p>\n\n<ol>\n<li><p>Is the a way to get the path to the Recycle Bin? The idea is that once I have the path I can use <code>remove()</code> to delete it permanently from there. The following fails for me, returning a completely different path that isn't that of the Recycle Bin. Maybe I am missing an argument. </p>\n\n<pre><code>char RecycleBin[_MAX_PATH];   \nSHGetSpecialFolderPath(NULL, RecycleBin, CSIDL_BITBUCKET, FALSE);\n</code></pre></li>\n<li><p>Is there a win32api call to permanently delete a file?</p></li>\n</ol>\n\n<p>Thanks for reading. </p>\n\n<p>EDIT 1:</p>\n\n<p>Per the answer below, I have been using the <code>_unlink ()</code> function but it's behavior doesn't do exactly what I want it to do. I need something to get the Desktop, then add a file to that string and pass the string into a function that will delete the file as an argument. Here is how I am trying with unlink.If I do unlink like this - it works:</p>\n\n<pre><code>     char path [] = \"C:\\\\Users\\\\testuser\\\\Desktop\\\\test.dat\";\n\n     _unlink( path );\n</code></pre>\n\n<p>However, if I try it in the two following ways it fails.</p>\n\n<pre><code>    char DesktopPath[_MAX_PATH];\n\n    SHGetSpecialFolderPath(NULL, DesktopPath, CSIDL_DESKTOPDIRECTORY, FALSE);\n\n    strcat ( DesktopPath, \"\\\\test.dat\" );\n\n    _unlink ( DesktopPath );\n</code></pre>\n\n<p>This way (adding quotes) also fails.</p>\n\n<pre><code>    char DesktopPath[_MAX_PATH];\n\n    char final_path [] = \"\\\"\";\n\n    char quotes [] = \"\\\"\";\n\n    SHGetSpecialFolderPath(NULL, DesktopPath, CSIDL_DESKTOPDIRECTORY, FALSE);\n\n    strcat ( DesktopPath, \"\\\\test.dat\" );\n\n    strcat ( DesktopPath, quotes );\n\n    strcat ( final_path, DesktopPath );\n\n    _unlink ( final_path );\n</code></pre>\n\n<p>Both of the above ways compile and run fine, but it doesn't actually get rid of the file. Any ideas?</p>\n"},{"tags":["delphi","winapi","antivirus"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":173,"score":1,"question_id":12579273,"title":"Win32 WriteFile does not return because of Antivirus","body":"<p>My code is written in Delphi 7, but I don't think it plays a particular role.</p>\n\n<p>I try to overwrite the content of a file with WriteFile.\nIt works perfectly except when writing a \".dll\" file and antivirus is active.</p>\n\n<ul>\n<li>Opening the handle to the file is still OK.</li>\n<li>writing is blocked : <strong>WriteFile function does not RETURN !!!</strong></li>\n</ul>\n\n<p>The antivirus seems to prevent from overwriting in that dll.\nBut, the worst is that I have to reboot the PC because my app is blocked, task manager is blocked, Windows Explorer is blocked, etc.</p>\n\n<p>How can I prevent this ?</p>\n\n<p>Any ideas ?</p>\n"},{"tags":["winapi","windows-ce","winsock2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12583857,"title":"win32 winsocket","body":"<p>I've got a problem and I've been trying to solve it for already a week! But I don't get any information in the internet, which lead to the solution.</p>\n\n<p>The problem's following:\nI try to write a simple Win32-GUI-Application for WIndows Embedded. I'm using Visual Studio 2008 Professional. At the beginning of the application, a connection to a server should be build. This is my code so far:</p>\n\n<pre><code>// Test.cpp : Definiert den Einstiegspunkt für die Anwendung.\n//\n\n#include \"stdafx.h\"\n#include \"Test.h\"\n#include &lt;windows.h&gt;\n#include &lt;winsock2.h&gt;\n#include &lt;ws2tcpip.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\n\n// Need to link with Ws2_32.lib, Mswsock.lib, and Advapi32.lib\n#pragma comment (lib, \"Ws2_32.lib\")\n#pragma comment (lib, \"Mswsock.lib\")\n#pragma comment (lib, \"AdvApi32.lib\")\n\n\n#define DEFAULT_BUFLEN 512\n#define DEFAULT_PORT \"27015\"\n#define MAX_LOADSTRING 100\n\n// Globale Variablen:\nHINSTANCE           g_hInst;            // Aktuelle Instanz\nHWND                g_hWndMenuBar;      // Menüleistenhandle\n\n// Vorwärtsdeklarationen der in diesem Codemodul enthaltenen Funktionen:\nATOM            MyRegisterClass(HINSTANCE, LPTSTR);\nBOOL            InitInstance(HINSTANCE, int);\nLRESULT CALLBACK    WndProc(HWND, UINT, WPARAM, LPARAM);\nINT_PTR CALLBACK    About(HWND, UINT, WPARAM, LPARAM);\n\nint WINAPI WinMain(HINSTANCE hInstance,\n                   HINSTANCE hPrevInstance,\n                   LPTSTR    lpCmdLine,\n                   int       nCmdShow)\n{\n    MSG msg;\n\n    WSADATA wsaData;\n    SOCKET ConnectSocket = INVALID_SOCKET;\n    struct addrinfo *result = NULL,\n                    *ptr = NULL,\n                    hints;\n    char *sendbuf = \"this is a test\";\n    char recvbuf[DEFAULT_BUFLEN];\n    int iResult;\n    int recvbuflen = DEFAULT_BUFLEN;\n\n    // Initialize Winsock\n    iResult = WSAStartup(MAKEWORD(2,2), &amp;wsaData);\n    if (iResult != 0) {\n        ;\n        return 1;\n    }\n\n    ZeroMemory( &amp;hints, sizeof(hints) );\n    hints.ai_family = AF_UNSPEC;\n    hints.ai_socktype = SOCK_STREAM;\n    hints.ai_protocol = IPPROTO_TCP;\n\n    // Resolve the server address and port\n    iResult = getaddrinfo(\"localhost\", DEFAULT_PORT, &amp;hints, &amp;result);\n    if ( iResult != 0 ) {\n        ;\n        WSACleanup();\n        return 1;\n    }\n\n    // Attempt to connect to an address until one succeeds\n    for(ptr=result; ptr != NULL ;ptr=ptr-&gt;ai_next) {\n\n        // Create a SOCKET for connecting to server\n        ConnectSocket = socket(ptr-&gt;ai_family, ptr-&gt;ai_socktype, \n            ptr-&gt;ai_protocol);\n        if (ConnectSocket == INVALID_SOCKET) {\n            ;\n            WSACleanup();\n            return 1;\n        }\n\n        // Connect to server.\n        iResult = connect( ConnectSocket, ptr-&gt;ai_addr, (int)ptr-&gt;ai_addrlen);\n        if (iResult == SOCKET_ERROR) {\n            closesocket(ConnectSocket);\n            ConnectSocket = INVALID_SOCKET;\n            continue;\n        }\n        break;\n    }\n\n    freeaddrinfo(result);\n\n    if (ConnectSocket == INVALID_SOCKET) {\n        ;\n        WSACleanup();\n        return 1;\n    }\n\n    // Send an initial buffer\n    iResult = send( ConnectSocket, sendbuf, (int)strlen(sendbuf), 0 );\n    if (iResult == SOCKET_ERROR) {\n        ;\n        closesocket(ConnectSocket);\n        WSACleanup();\n        return 1;\n    }\n\n\n    // shutdown the connection since no more data will be sent\n    iResult = shutdown(ConnectSocket, SD_SEND);\n    if (iResult == SOCKET_ERROR) {\n        ;\n        closesocket(ConnectSocket);\n        WSACleanup();\n        return 1;\n    }\n\n    // Receive until the peer closes the connection\n    do {\n\n        iResult = recv(ConnectSocket, recvbuf, recvbuflen, 0);\n        if ( iResult &gt; 0 )\n            ;\n        else if ( iResult == 0 )\n            ;\n        else\n            ;\n\n    } while( iResult &gt; 0 );\n\n    // cleanup\n    closesocket(ConnectSocket);\n    WSACleanup();\n\n    // Anwendungsinitialisierung ausführen:\n    if (!InitInstance(hInstance, nCmdShow)) \n    {\n        return FALSE;\n    }\n\n    HACCEL hAccelTable;\n    hAccelTable = LoadAccelerators(hInstance, MAKEINTRESOURCE(IDC_TEST));\n\n    // Hauptmeldungsschleife:\n    while (GetMessage(&amp;msg, NULL, 0, 0)) \n    {\n        if (!TranslateAccelerator(msg.hwnd, hAccelTable, &amp;msg)) \n        {\n            TranslateMessage(&amp;msg);\n            DispatchMessage(&amp;msg);\n        }\n    }\n\n    return (int) msg.wParam;\n}\n\n//\n//  FUNKTION: MyRegisterClass()\n//\n//  ZWECK: Registriert die Fensterklasse.\n//\n//  KOMMENTARE:\n//\nATOM MyRegisterClass(HINSTANCE hInstance, LPTSTR szWindowClass)\n{\n    WNDCLASS wc;\n\n    wc.style         = CS_HREDRAW | CS_VREDRAW;\n    wc.lpfnWndProc   = WndProc;\n    wc.cbClsExtra    = 0;\n    wc.cbWndExtra    = 0;\n    wc.hInstance     = hInstance;\n    wc.hIcon         = LoadIcon(hInstance, MAKEINTRESOURCE(IDI_TEST));\n    wc.hCursor       = 0;\n    wc.hbrBackground = (HBRUSH) GetStockObject(WHITE_BRUSH);\n    wc.lpszMenuName  = 0;\n    wc.lpszClassName = szWindowClass;\n\n    return RegisterClass(&amp;wc);\n}\n\n//\n//   FUNKTION: InitInstance(HINSTANCE, int)\n//\n//   ZWECK: Speichert das Instanzenhandle und erstellt das Hauptfenster.\n//\n//   KOMMENTARE:\n//\n//        In dieser Funktion wird das Instanzenhandle in einer globalen Variablen gespeichert, und das\n//        Hauptprogrammfenster wird erstellt und angezeigt.\n//\nBOOL InitInstance(HINSTANCE hInstance, int nCmdShow)\n{\n    HWND hWnd;\n    TCHAR szTitle[MAX_LOADSTRING];      // Titelleistentext\n    TCHAR szWindowClass[MAX_LOADSTRING];    // Klassenname des Hauptfensters\n\n    g_hInst = hInstance; // Instanzenhandle in der globalen Variablen speichern\n\n    // SHInitExtraControls sollte einmal während der Initialisierung der Anwendung aufgerufen werden, um alle\n    // gerätespezifischen Steuerelemente wie CAPEDIT und SIPPREF zu initialisieren.\n    SHInitExtraControls();\n\n    LoadString(hInstance, IDS_APP_TITLE, szTitle, MAX_LOADSTRING); \n    LoadString(hInstance, IDC_TEST, szWindowClass, MAX_LOADSTRING);\n\n    //Bei bereits gestarteter Ausführung Fokus auf das Fenster verschieben und beenden\n    hWnd = FindWindow(szWindowClass, szTitle);  \n    if (hWnd) \n    {\n        // Fokus auf das erste untergeordnete Fenster festlegen\n        // \"| 0x00000001\" wird verwendet, um alle eigenen Fenster in den Vordergrund zu stellen und\n        // zu aktivieren.\n        SetForegroundWindow((HWND)((ULONG) hWnd | 0x00000001));\n        return 0;\n    } \n\n    if (!MyRegisterClass(hInstance, szWindowClass))\n    {\n        return FALSE;\n    }\n\n    hWnd = CreateWindow(szWindowClass, szTitle, WS_VISIBLE,\n        CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, NULL, NULL, hInstance, NULL);\n\n    if (!hWnd)\n    {\n        return FALSE;\n    }\n\n    // Wenn das Hauptfenster mithilfe von CW_USEDEFAULT erstellt wird, wird die Höhe der Menüleiste (falls\n    // erstellt) nicht berücksichtigt. Daher wird die Größe des Fensters nach dem Erstellen angepasst,\n    // sofern eine Menüleiste vorhanden ist.\n    if (g_hWndMenuBar)\n    {\n        RECT rc;\n        RECT rcMenuBar;\n\n        GetWindowRect(hWnd, &amp;rc);\n        GetWindowRect(g_hWndMenuBar, &amp;rcMenuBar);\n        rc.bottom -= (rcMenuBar.bottom - rcMenuBar.top);\n\n        MoveWindow(hWnd, rc.left, rc.top, rc.right-rc.left, rc.bottom-rc.top, FALSE);\n    }\n\n    ShowWindow(hWnd, nCmdShow);\n    UpdateWindow(hWnd);\n\n\n    return TRUE;\n}\n\n//\n//  FUNKTION: WndProc(HWND, UINT, WPARAM, LPARAM)\n//\n//  ZWECK:  Verarbeitet Meldungen vom Hauptfenster.\n//\n//  WM_COMMAND  - Verarbeiten des Anwendungsmenüs\n//  WM_PAINT    - Zeichnen des Hauptfensters\n//  WM_DESTROY  - Beenden-Meldung anzeigen und zurückgeben\n//\n//\nLRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    int wmId, wmEvent;\n    PAINTSTRUCT ps;\n    HDC hdc;\n\n    static SHACTIVATEINFO s_sai;\n\n    switch (message) \n    {\n        case WM_COMMAND:\n            wmId    = LOWORD(wParam); \n            wmEvent = HIWORD(wParam); \n            // Menüauswahl bearbeiten:\n            switch (wmId)\n            {\n                case IDM_HELP_ABOUT:\n                    DialogBox(g_hInst, (LPCTSTR)IDD_ABOUTBOX, hWnd, About);\n                    break;\n                case IDM_OK:\n                    SendMessage (hWnd, WM_CLOSE, 0, 0);             \n                    break;\n                default:\n                    return DefWindowProc(hWnd, message, wParam, lParam);\n            }\n            break;\n        case WM_CREATE:\n            SHMENUBARINFO mbi;\n\n            memset(&amp;mbi, 0, sizeof(SHMENUBARINFO));\n            mbi.cbSize     = sizeof(SHMENUBARINFO);\n            mbi.hwndParent = hWnd;\n            mbi.nToolBarId = IDR_MENU;\n            mbi.hInstRes   = g_hInst;\n\n            if (!SHCreateMenuBar(&amp;mbi)) \n            {\n                g_hWndMenuBar = NULL;\n            }\n            else\n            {\n                g_hWndMenuBar = mbi.hwndMB;\n            }\n\n            // Informationsstruktur für die Aktivierung der Shell initialisieren\n            memset(&amp;s_sai, 0, sizeof (s_sai));\n            s_sai.cbSize = sizeof (s_sai);\n            break;\n        case WM_PAINT:\n            hdc = BeginPaint(hWnd, &amp;ps);\n\n            // TODO: Hier den Zeichnungscode hinzufügen.\n\n            EndPaint(hWnd, &amp;ps);\n            break;\n        case WM_DESTROY:\n            CommandBar_Destroy(g_hWndMenuBar);\n            PostQuitMessage(0);\n            break;\n\n        case WM_ACTIVATE:\n            // Shell über die Aktivierungsmeldung benachrichtigen\n            SHHandleWMActivate(hWnd, wParam, lParam, &amp;s_sai, FALSE);\n            break;\n        case WM_SETTINGCHANGE:\n            SHHandleWMSettingChange(hWnd, wParam, lParam, &amp;s_sai);\n            break;\n\n        default:\n            return DefWindowProc(hWnd, message, wParam, lParam);\n    }\n    return 0;\n}\n\n// Meldungshandler für Infofeld.\nINT_PTR CALLBACK About(HWND hDlg, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    switch (message)\n    {\n        case WM_INITDIALOG:\n            {\n                // Erstellen Sie eine Schaltfläche \"Fertig\", und passen Sie die Größe an.  \n                SHINITDLGINFO shidi;\n                shidi.dwMask = SHIDIM_FLAGS;\n                shidi.dwFlags = SHIDIF_DONEBUTTON | SHIDIF_SIPDOWN | SHIDIF_SIZEDLGFULLSCREEN | SHIDIF_EMPTYMENU;\n                shidi.hDlg = hDlg;\n                SHInitDialog(&amp;shidi);\n            }\n            return (INT_PTR)TRUE;\n\n        case WM_COMMAND:\n            if (LOWORD(wParam) == IDOK)\n            {\n                EndDialog(hDlg, LOWORD(wParam));\n                return TRUE;\n            }\n            break;\n\n        case WM_CLOSE:\n            EndDialog(hDlg, message);\n            return TRUE;\n\n    }\n    return (INT_PTR)FALSE;\n}\n</code></pre>\n\n<p>The relevant code is just copied from msdn. However, I get the following error message:</p>\n\n<pre><code>unresolved external symbol \"recv\" referenced in function WinMain\n</code></pre>\n\n<p>There ar more errors, but they are all the same. The differences are the names of the functions (e.g. shutdown, send, ...)</p>\n\n<p>I tried the code in a Win32-Console-Application, and it worked well! </p>\n\n<p>Does anybody know, why this application doesn't work?</p>\n"},{"tags":["python","memory","winapi","memory-management","pywin32"],"answer_count":3,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":1623,"score":3,"question_id":2017545,"title":"Get memory usage of computer in Windows with Python","body":"<p>How can I tell what the computer's overall memory usage is from Python, running on Windows XP?</p>\n"},{"tags":["c++","winapi","callback","wrapper","wndproc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":12582511,"title":"Use class member as WNDPROC/DLGPROC with or without global","body":"<p>I'll go ahead and give a summary to this, how can I use a dialog procedure that is a member of a class? I am creating a window wrapper class, but <code>CreateDialogParam</code> needs a global dialog procedure, so I tried this workaround:</p>\n\n<p>I have done a bit of searching on this topic. I am making a <code>Dialog</code> class which I am subclassing to make a <code>CMainWnd</code> and then instantiating that. In the <code>Dialog</code> class I have a member function defined as <code>INT_PTR CALLBACK Dialog::cb_proc(HWND,UINT,WPARAM,LPARAM)</code>. Now, I know that windows must have a global function as a callback procedure.</p>\n\n<p>So I made a <code>std::map&lt;HWND,Dialog*&gt; DlgProcs</code> map to associate the dialogs window handle with its Dialog class pointer.</p>\n\n<p>And a <code>INT_PTR CALLBACK DlgMainProc(HWND,UINT,WPARAM,LPARAM)</code> so I could pass that to <code>CreateDialogParam()</code>. In the body of <code>DlgMainProc(...)</code> I search the map for using the <code>hWnd</code> parameter to find the <code>Dialog*</code> and return its <code>cb_proc(..)</code> member.</p>\n\n<p>My problem is that none of the messages get processed, this is because the member procedure in my <code>Dialog</code> class never gets called. Even though when I put a <code>MessageBox()</code> in <code>DlgMainProc</code> inside a <code>if (DlgProcs.find(hWnd) != DlgProcs.end()) {</code> statement, the messagebox is displayed, over and over again until I have to abort the program from Visual Studio 2008. Which tells me that it is finding the <code>hWnd</code> in my map. The weird thing is it also does this if I put it in the <code>else</code> statement after that, which contradictingly tells me it is NOT finding the <code>hWnd</code> in the map.</p>\n\n<p>If I put a messagebox in the <code>cb_proc</code> member function it does not get displayed at all. But during this I never get any compiler, linker, or runtime errors. When I remove the messagebox from it (as to not have to abort the program, it was just for debugging purposes) the program runs but no messages get processed, the X button does not close the program, button clicks do nothing.</p>\n\n<hr>\n\n<p>Here is the PasteBin code: <a href=\"http://pastebin.com/GsGUBpZU\" rel=\"nofollow\">http://pastebin.com/GsGUBpZU</a>\nBtw, I have no problem subclassing this, my window is created fine, just no messages are processed, <code>cb_proc</code> just never gets called.</p>\n\n<p><strong>EDIT:</strong> Here is the relevant parts of the code</p>\n\n<pre><code>map&lt;HWND,Dialog*&gt; g_DlgProcs;\n\nINT_PTR CALLBACK g_MainDlgProc(HWND hWnd, UINT msg, WPARAM wParam, LPARAM lParam) {\n        if (g_DlgProcs.find(hWnd) != g_DlgProcs.end()) {\n                Alert(\"blah\"); // Gets executed repeatedly\n                return g_DlgProcs[hWnd]-&gt;cb_proc(hWnd, msg, wParam, lParam);\n        } else {\n                Alert(\"blah\"); // Removing the above alert, this gets\n                               // executed repeatedly, erm, as well.. O.o strange\n                return FALSE;\n        }\n}\n\nDialog::Dialog(int id, HWND parent /* = HWND_DESKTOP */) {\n        _id = id;\n        _parent = parent;\n\n        // Tried this before CreateDialogParam\n        g_DlgProcs.insert(make_pair(_handle, this));\n\n        _handle = CreateDialogParam(\n                (HINSTANCE)GetModuleHandle(NULL),\n                MAKEINTRESOURCE(id), _parent,\n                (DLGPROC)g_MainDlgProc, NULL\n        );\n\n        // Then tried it after CreateDialogParam\n        g_DlgProcs.insert(make_pair(_handle, this));\n}\n\nINT_PTR CALLBACK Dialog::cb_proc(HWND hWnd, UINT msg, WPARAM wParam, LPARAM lParam) {\n        Alert(\"blah\"); // Never gets executed\n\n        bool handled = true;\n\n        switch (msg)\n        {\n        case WM_INITDIALOG:\n                OnInitialize();\n                break;\n        case WM_COMMAND:\n                if (HIWORD(wParam) == 0 || HIWORD(wParam) == 1) {\n                        OnMenuCommand((HIWORD(wParam) == 1), (int)LOWORD(wParam));\n                } else {\n                        OnCtrlCommand((int)HIWORD(wParam), (int)LOWORD(wParam), (HWND)lParam);\n                }\n                break;\n        case WM_NOTIFY:\n                {\n                        LPNMHDR head = (LPNMHDR)lParam;\n                        OnNotification(head-&gt;code, head-&gt;idFrom, head-&gt;hwndFrom);\n                }\n                break;\n        case WM_CLOSE:\n                OnClose(); // DestroyWindow(_handle)\n                break;\n        case WM_DESTROY:\n                OnDestroy(); // PostQuitMessage(0)\n        default:\n                handled = ProcessMsg(msg, wParam, lParam);\n        }\n\n        // Convert bool to Windows BOOL enum\n        return ((handled == true) ? TRUE : FALSE);\n}\n</code></pre>\n\n<hr>\n\n<p>Does anybody know why it never gets called? Or maybe just guide me to another way to use a member function as a DLGPROC?</p>\n"},{"tags":["winapi"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":2204,"score":4,"question_id":2285860,"title":"Change Win32 Window Style","body":"<p>Is there a win32 function to change the style of a window after it has been created? I would like to change the style flags that are specified in <code>CreateWindowEx</code>. Specifically, I would like to convert a standard window to a window with no border and no resize.</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":0,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":12583708,"title":"SwitchDesktop works momentarily but switches back after a moment","body":"<p>I've got some code to create a new desktop and launch a process into that desktop.</p>\n\n<p>One a few select Windows XP machines, when this code runs, I can see it switch to the new desktop and start the process, but almost immediately, the desktop switches back to the normal desktop.</p>\n\n<p>This code works fine on about 98% of machines, and I can't seem to isolate any reason for this not working on the others.</p>\n\n<p>Should <code>SwitchDesktop</code> be reliable?  Can I hook calls to <code>SwitchDesktop</code> that might be called from another application?</p>\n\n<p>My code:</p>\n\n<pre><code>int DLL_EXP_IMP WINAPI Process_Desktop(char *szDesktopName, char *szPath)\n{\n    HDESK   hOriginalThread;\n    HDESK   hOriginalInput;\n    HDESK   hNewDesktop;\n    int procSuccess;\n    // Save original ...\n    hOriginalThread = GetThreadDesktop(GetCurrentThreadId());\n    hOriginalInput = OpenInputDesktop(0, FALSE, DESKTOP_SWITCHDESKTOP);\n\n    // Create a new Desktop and switch to it\n    hNewDesktop = CreateDesktop(szDesktopName, NULL, NULL, DF_ALLOWOTHERACCOUNTHOOK, GENERIC_ALL, NULL);\n    SetThreadDesktop(hNewDesktop);\n    SwitchDesktop(hNewDesktop);\n\n    // This call blocks until the process exits, and is confirmed to work on the affected machines\n    procSuccess = StartProcess(szDesktopName, szPath);\n\n    // Restore original ...\n    SwitchDesktop(hOriginalInput);\n    SetThreadDesktop(hOriginalThread);\n\n    // Close the Desktop\n    CloseDesktop(hNewDesktop);\n\n    if (procSuccess != 0)\n    {\n        return procSuccess;\n    }\n    else\n    {\n        return 0;\n    }\n}\n</code></pre>\n"},{"tags":["winapi","windows-vista","manifest","compatibility","uac"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":127,"score":1,"question_id":12532308,"title":"Program Compatibility Assistant Manifest Not working in Vista32","body":"<p>When I run my application \"A driver Installer and Uninstaller Application\", I am getting a \"Program Compatibility Assistant\" window once my exe get ended successfully. After going through the SO links and googling I couldnt find a solution to avoid \"Program Compatibility Assistant\" window in vista 32. I used the below manifest to avoid PCA and it works as expected (am not getting any PCA window in windows 7) but except windows vista 32? What should I do to make this work?</p>\n\n<blockquote>\n  <p>After Using the below manifest for my installer application I am not\n  getting PCA window in windows 7 but it appears on windows vista\n  32-bit. How to avoid PCA window in vista32?</p>\n</blockquote>\n\n<p>Some related questions are:</p>\n\n<ul>\n<li><a href=\"http://stackoverflow.com/questions/1587962/how-do-i-prevent-programmatically-the-program-compatibility-assistant-in-vista\">how-do-i-prevent-programmatically-the-program-compatibility-assistant-in-vista</a></li>\n<li><a href=\"http://stackoverflow.com/questions/5098747/reasons-for-getting-the-program-compatibility-assistant-dialog\">reasons-for-getting-the-program-compatibility-assistant-dialog</a></li>\n</ul>\n\n<p>Here's the manifest I used:</p>\n\n<pre><code> &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;asmv1:assembly manifestVersion=\"1.0\" xmlns=\"urn:schemas-microsoft-com:asm.v1\" xmlns:asmv1=\"urn:schemas-microsoft-com:asm.v1\" xmlns:asmv2=\"urn:schemas-microsoft-com:asm.v2\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n  &lt;assemblyIdentity version=\"1.0.0.0\" name=\"Unins.exe\"/&gt;\n  &lt;trustInfo xmlns=\"urn:schemas-microsoft-com:asm.v2\"&gt;\n    &lt;security&gt;\n      &lt;requestedPrivileges xmlns=\"urn:schemas-microsoft-com:asm.v3\"&gt;\n        &lt;requestedExecutionLevel level=\"highestAvailable\" uiAccess=\"false\" /&gt;\n      &lt;/requestedPrivileges&gt;\n    &lt;/security&gt;\n  &lt;/trustInfo&gt;\n  &lt;compatibility xmlns=\"urn:schemas-microsoft-com:compatibility.v1\"&gt;\n    &lt;application&gt;\n      &lt;!--The ID below indicates application support for Windows Vista --&gt;\n      &lt;supportedOS Id=\"{e2011457-1546-43c5-a5fe-008deee3d3f0}\"/&gt;\n      &lt;!--The ID below indicates application support for Windows 7 --&gt;\n      &lt;supportedOS Id=\"{35138b9a-5d96-4fbd-8e2d-a2440225f93a}\"/&gt;\n    &lt;/application&gt;\n  &lt;/compatibility&gt;\n&lt;/asmv1:assembly&gt;\n</code></pre>\n\n<p>The below is the snapshot of PCA window I get...</p>\n\n<p><img src=\"http://i.stack.imgur.com/hcHvD.png\" alt=\"Snap Shot of PCA window\"></p>\n\n<p>Update : the root cause I for the PCA window is \"My Installer is not creating an entry in Add or Remove Programs\". I made my app to make an entry in \"Add or remove programs\" and am not getting any PCA window. But I dont want to make an entry in Add or Remove Program. </p>\n\n<blockquote>\n  <p><strong>Update 25-09-12:</strong> I have an executable say <code>A.exe</code>, which finds\n  architecture of the OS and depends on the architecture it calls either\n  <code>A64.exe or A86.exe</code>. In this case do I want to have manifests for all\n  the exe's ( A.exe, A64.exe, A86.exe )? Right now I have manifest only for A.exe. </p>\n</blockquote>\n"},{"tags":["windows","winapi","microsoft","manifest","uac"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12583006,"title":"Manifest for an exe?","body":"<p>I have an executable say A.exe, which finds architecture of the OS and depends on the architecture it calls either A64.exe or A86.exe. In this case do I want to have manifests for all the exe's ( A.exe, A64.exe, A86.exe )? Right now I have manifest only for A.exe?</p>\n"},{"tags":["windows","winapi","visual-c++"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":12581889,"title":"why exactly TranslateMessage","body":"<p>I am trying to make sense of 'The Message Loop'.\nThis is how it looks:</p>\n\n<pre><code>MSG msg = { };\nwhile (GetMessage(&amp;msg, NULL, 0, 0))\n{\n    TranslateMessage(&amp;msg);\n    DispatchMessage(&amp;msg);\n}\n</code></pre>\n\n<p>So far I am clear(at least I hope so) with the concept.When the user interacts with windows application using keyboard and mouse,those events are converted to appropriate messages by the respective device drivers and posted to system message queue.</p>\n\n<p>The OS removes messages from the queue one by one and examines each of them to send them to respective application's thread's queue that is responsible for having created the destination window.</p>\n\n<p>Now in my application </p>\n\n<pre><code>MSG msg;\nGetMessage(&amp;msg, NULL, 0, 0);\n</code></pre>\n\n<p>removes the message from thread specific message queue and fills the MSG structure.</p>\n\n<p>But <code>TranslateMessage</code> is said to translate the virtual keystrokes to characters and post them back to the caller thread's message queue.</p>\n\n<p><code>DispatchMessage</code> directs the OS to call the Windows Procedure of appropriate target window.</p>\n\n<p>Two doubts:</p>\n\n<p>1)What is the exact functionality of TranslateMessage;is it just to translate virtual keystrokes to character messages(I assume virtual keystrokes to be keystrokes other than alphabets and numbers),if character message is posted back to queue,isn't the loop broken?</p>\n\n<p>2)What about the mouse events?are they directly dispatched?</p>\n"},{"tags":["windows","winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":30,"score":3,"question_id":12580171,"title":"Why initialize an object to empty","body":"<p>I am learning windows programming with the help of MSDN.Why would somebody initialize an object like the following?</p>\n\n<pre><code>WNDCLASS wc = { };\n</code></pre>\n\n<p>Will this zero all the memory of the object?\nWhole source code is following:</p>\n\n<pre><code>#ifndef UNICODE\n#define UNICODE\n#endif \n\n#include &lt;windows.h&gt;\n\nLRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam);\n\nint WINAPI wWinMain(HINSTANCE hInstance, HINSTANCE, PWSTR pCmdLine, int nCmdShow)\n{\n    // Register the window class.\n    const wchar_t CLASS_NAME[]  = L\"Sample Window Class\";\n    WNDCLASS wc = { };\n\n    wc.lpfnWndProc   = WindowProc;\n    wc.hInstance     = hInstance;\n    wc.lpszClassName = CLASS_NAME;\n\n    RegisterClass(&amp;wc);\n\n    // Create the window.\n\n    HWND hwnd = CreateWindowEx(\n        0,                              // Optional window styles.\n        CLASS_NAME,                     // Window class\n        L\"Learn to Program Windows\",    // Window text\n        WS_OVERLAPPEDWINDOW,            // Window style\n\n        // Size and position\n        CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT,\n\n        NULL,       // Parent window    \n        NULL,       // Menu\n        hInstance,  // Instance handle\n        NULL        // Additional application data\n        );\n\n    if (hwnd == NULL)\n    {\n        return 0;\n    }\n\n    ShowWindow(hwnd, nCmdShow);\n\n    // Run the message loop.\n\n    MSG msg = { };\n    while (GetMessage(&amp;msg, NULL, 0, 0))\n    {\n        TranslateMessage(&amp;msg);\n        DispatchMessage(&amp;msg);\n    }\n\n    return 0;\n}\n\nLRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam)\n{\n    switch (uMsg)\n    {\n    case WM_DESTROY:\n        PostQuitMessage(0);\n        return 0;\n\n    case WM_PAINT:\n        {\n            PAINTSTRUCT ps;\n            HDC hdc = BeginPaint(hwnd, &amp;ps);\n\n            FillRect(hdc, &amp;ps.rcPaint, (HBRUSH) (COLOR_WINDOW+1));\n\n            EndPaint(hwnd, &amp;ps);\n        }\n        return 0;\n\n    }\n    return DefWindowProc(hwnd, uMsg, wParam, lParam);\n}\n</code></pre>\n"},{"tags":["winapi","windows-8","multi-touch","gesture","user32"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12577167,"title":"Unable to recieve all the pointer/touch messages injected at application level using Windows 8 Touch Inject API","body":"<p>I am able to inject pointer/touch messages succesfully but unable to recieve all the messages injected on an application(messages are captured in the application) though all the messages are injected successfully without any errors. Please do provide any suggestions/solution for the issue.</p>\n\n<pre><code>InitializeTouchInjection(10, TOUCH_FEEDBACK_INDIRECT);\n\n//\n// initialize the touch info structure\n//\nmemset(&amp;contact, 0, sizeof(POINTER_TOUCH_INFO));\n\ncontact.pointerInfo.pointerType = PT_TOUCH; //we're sending touch input\ncontact.pointerInfo.pointerId = 0;          //contact 0\ncontact.pointerInfo.ptPixelLocation.x = 300;\ncontact.pointerInfo.ptPixelLocation.y = 300;\ncontact.pointerInfo.pointerFlags = POINTER_FLAG_DOWN | POINTER_FLAG_INRANGE | POINTER_FLAG_INCONTACT;\ncontact.touchFlags = TOUCH_FLAG_NONE;\ncontact.touchMask = TOUCH_MASK_CONTACTAREA | TOUCH_MASK_ORIENTATION | TOUCH_MASK_PRESSURE;\ncontact.orientation = 90;\ncontact.pressure = 32000;\n\n//\n// set the contact area depending on thickness\n//\n// defining contact area (I have taken area of 4 x 4 pixel)\n\ncontact.rcContact.top = contact.pointerInfo.ptPixelLocation.y - 2; \n\ncontact.rcContact.bottom = contact.pointerInfo.ptPixelLocation.y + 2; \n\ncontact.rcContact.left = contact.pointerInfo.ptPixelLocation.x  - 2; \n\ncontact.rcContact.right = contact.pointerInfo.ptPixelLocation.x  + 2;\n//\n// inject a touch down\n//\nbRet = InjectTouchInput(1, &amp;contact);\n\n//Setting the Pointer Flag to Drag\n\ncontact.pointerInfo.pointerFlags = POINTER_FLAG_UPDATE | POINTER_FLAG_INRANGE | POINTER_FLAG_INCONTACT;\nbRet = InjectTouchInput(1, &amp;contact);\nfor(int i=0;i&lt;100;i++)\n{\n\n    contact.pointerInfo.ptPixelLocation.y--; \n    bRet =InjectTouchInput(1, &amp;contact);\n}\n//\n// if touch down was succesfull, send a touch up\n//\nif (bRet) {\n    contact.pointerInfo.pointerFlags = POINTER_FLAG_UP;\n\n    //\n    // inject a touch up\n    //\n    InjectTouchInput(1, &amp;contact);\n}\n</code></pre>\n"},{"tags":["c++","windows","winapi","mouse"],"answer_count":0,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":71,"score":3,"question_id":12579617,"title":"Draw on mouse cursor plane or create custom animated system cursor?","body":"<p>Platform: Windows 7\nLanguage: C++</p>\n\n<p>Hi,</p>\n\n<p>i am trying to create a visual aid for an accessibility application. My goal is to draw additional information around the mouse cursor. It should be available in every application window and if possible also in full screen apps.</p>\n\n<p>The possibilities i found so far are not satisfying:\n- drawing on device context of entire Desktop\n- layered window that is always on top</p>\n\n<p>Is there a possibility to draw on the same layer as the mouse cursor? Is there a special memory or device context, where it is possible to write same memory as the default mouse cursor.</p>\n\n<p>Can i override the default mouse cursors with a custom animated layout in other applications?\nCan i have a system wide mouse cursor layout with animated content?</p>\n"},{"tags":["c++","winapi","combobox"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12572778,"title":"ComboBox_GetCurSel macro is not defined when using the WinAPI with C++","body":"<p>Hello all I am having some issue adding a combo box to a tab I have created in WINAPI. Below is the simple code I use for making dialog and displaying tabs.  </p>\n\n<pre><code>#include \"TabControl_Win32.h\" \n#include \"resource.h\" \n\n#include \"stdafx.h\"\nHINSTANCE hInstance =NULL; \nHWND hMainDialog = NULL; \nHWND hTabMainControl=NULL; \nHWND hTabControlList[10]; \n//\nBOOL Dlg_OnInitDialog(HWND hwnd, HWND hwndFocus, LPARAM lParam);\n\n//entry point \nint WINAPI WinMain (HINSTANCE hInstan, HINSTANCE hPrevInstance, PSTR szCmdLine, int iCmdShow) \n{ \n MSG          msg ;        \n InitCommonControls(); \n  hInstance = hInstan; \n     //create dialog box \n      hMainDialog = CreateDialog(hInstance,MAKEINTRESOURCE(IDD_DIALOG1), NULL, (DLGPROC)MainDlgProc);  \n      if (hMainDialog == NULL) \n               { \n      // Notified your about the failure \n      MessageBox(NULL, TEXT(\"Application failed to load!\"), TEXT(\"Error\"), MB_OK | MB_ICONEXCLAMATION); \n      // Set the return value \n      return FALSE; \n     } \n    else \n    { \n      ShowWindow (hMainDialog, SW_SHOW) ; \n      UpdateWindow(hMainDialog); \n    } \nwhile (GetMessage (&amp;msg, NULL, 0, 0)) \n     { \n         if (!IsDialogMessage(hMainDialog, &amp;msg))  \n         { \n             TranslateMessage (&amp;msg) ; \n             DispatchMessage (&amp;msg) ; \n\n         } \n\n     } \n     return (int)msg.wParam ; \n} \n//\nINT_PTR CALLBACK MainDlgProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam) \n{ \n    switch (message) \n    { \n    case WM_INITDIALOG: \n        {\n  HWND hwndComboTab = GetDlgItem(hwnd, IDC_COMBO1);  \n        ComboBox_AddString(hwndComboTab, \"Hello 1\"); \n\n        }\n        break; \n    case WM_NOTIFY: \n        { \n            NMHDR *nmhdr = NULL; \n            nmhdr = (NMHDR*)lParam; \n            if(hTabMainControl == nmhdr-&gt;hwndFrom) \n            { \n            switch(nmhdr-&gt;code) \n            { \n                case TCN_SELCHANGE: \n                    { \n                        switch(SendMessage(nmhdr-&gt;hwndFrom,(UINT) TCM_GETCURFOCUS,0,0)) \n                       { \n                        case 0: \n                            { \n                                ShowWindow (hTabControlList[2] , SW_HIDE) ;\n                                ShowWindow (hTabControlList[1] , SW_HIDE) ; \n                                ShowWindow (hTabControlList[0] , SW_SHOW) ; \n                                UpdateWindow(hTabControlList[0] ); \n\n                            } \n                            break; \n                        case 1: \n                            { \n\n                                ShowWindow (hTabControlList[0] , SW_HIDE) ; \n                                ShowWindow (hTabControlList[1] , SW_SHOW) ; \n                              ShowWindow (hTabControlList[2] , SW_HIDE) ;\n                                UpdateWindow(hTabControlList[1] ); \n                            } \n                            break; \n                         case 2: \n                            { \n                                ShowWindow (hTabControlList[0] , SW_HIDE) ;\n                                ShowWindow (hTabControlList[1] , SW_HIDE) ;\n                                ShowWindow (hTabControlList[2] , SW_SHOW) ; \n                              UpdateWindow(hTabControlList[2] ); \n                            } \n                            break; \n                        } \n                    } \n\n                    break; \n\n                } \n\n           } \n\n\n\n        } \n\n        break; \n    case WM_COMMAND:      \n        { \n            switch (LOWORD(wParam)) \n            { \n            case IDOK: \n                break; \n            case IDCANCEL: \n                SendMessage(hwnd,WM_CLOSE,0,0); \n                break; \n            } \n            break; \n        } \n//\n    case WM_CLOSE: \n        DestroyWindow(hTabControlList[0]); \n        DestroyWindow(hTabControlList[1]);\n        DestroyWindow(hTabControlList[2]);\n        DestroyWindow(hwnd); \n        break;\n\n//\n    case WM_DESTROY: \n        PostQuitMessage (0) ; \n        break; \n    } \n    return FALSE ; \n} \n\n//\n\n\nvoid OnSelChangeCombo1(HWND hwndDlg, HWND hwndCombo)\n{\n   const int nCurSel = ComboBox_GetCurSel(hwndCombo);\n   if(CB_ERR != nCurSel)\n   {\n      const int nTextLen = ComboBox_GetLBTextLen(hwndCombo, nCurSel); \n      LPSTR pszText = new char[1 + nTextLen];\n      ComboBox_GetLBText(hwndCombo, nCurSel, pszText);\n      HWND hwndEdit = GetDlgItem(hwndDlg, IDC_EDIT1);\n      Edit_SetText(hwndEdit, pszText);\n      delete []pszText;\n   }\n}\n</code></pre>\n\n<p>I am trying to add a combo box on tab 2 so I added this line to the <code>WM_INITDIALOG</code> of tab 2. I added the combo item on the tab page and in the resource file:</p>\n\n<pre><code>        HWND hwndComboTab = GetDlgItem(hwndDlg, IDC_COMBO1); \n        ComboBox_AddString(hwndComboTab, \"Hello 1\");\n</code></pre>\n\n<p>I now get Error each time I try to use it </p>\n\n<blockquote>\n  <p>error C3861: 'ComboBox_GetCurSel': identifier not found</p>\n</blockquote>\n\n<p>and </p>\n\n<blockquote>\n  <p>ComboBox_AddString is undefined</p>\n</blockquote>\n\n<p>Am I doing this right ?</p>\n"},{"tags":["delphi","winapi","vcl","notification-area"],"answer_count":3,"favorite_count":4,"up_vote_count":3,"down_vote_count":0,"view_count":1116,"score":3,"question_id":3712551,"title":"How can I check if my application has focus?","body":"<p>What I want to do is check if my application has focus because if it is not then I will popup an Alert Window just over the Notification Area to display some message to the end user.</p>\n"},{"tags":["c#","winapi","compact-framework","windows-ce"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12578352,"title":"Send message from one process to other use winapi in wince","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/946279/what-is-the-best-mechanism-for-communicating-cross-process-in-windows-ce\">What is the best mechanism for communicating cross-process in Windows CE?</a>  </p>\n</blockquote>\n\n\n\n<p>I created two apps using .net cf 2.0.</p>\n\n<p>And I need send some message\\command from one app to other (when second app receive this message I want run some code). How can I do this use only winapi. I don't want use tcp or wcf, only use winapi.</p>\n"},{"tags":["winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":12577144,"title":"How many message queues a windows app can have?","body":"<p>Is number of message queue(s) a Windows App can have is equal to threads in that app that create windows?</p>\n"},{"tags":["winapi","max-path"],"answer_count":6,"favorite_count":2,"up_vote_count":10,"down_vote_count":0,"view_count":2085,"score":10,"question_id":2825798,"title":"Should I deal with files longer than MAX_PATH?","body":"<p>Just had an interesting case.</p>\n\n<p>My software reported back a failure caused by a path being longer than MAX_PATH.</p>\n\n<p>The path was just a plain old document in My Documents, e.g.:</p>\n\n<pre><code>C:\\Documents and Settings\\Bill\\Some Stupid FOlder Name\\A really ridiculously long file thats really very very very..........very long.pdf\n</code></pre>\n\n<p>Total length 269 characters (MAX_PATH==260).</p>\n\n<p>The user wasn't using a external hard drive or anything like that. This was a file on an Windows managed drive.</p>\n\n<p>So my question is this. Should I care?</p>\n\n<p>I'm not saying <em>can</em> I deal with the long paths, I'm asking <em>should</em> I. Yes I'm aware of the \"\\?\\\" unicode hack on some Win32 APIs, but it seems this hack is not without risk (as it's changing the behaviour of the way the APIs parse paths) and also isn't supported by all APIs .</p>\n\n<p>So anyway, let me just state my position/assertions:</p>\n\n<ol>\n<li>First presumably the only way the user was able to break this limit is if the app she used uses the special Unicode hack. It's a PDF file, so maybe the PDF tool she used uses this hack.</li>\n<li>I tried to reproduce this (by using the unicode hack) and experimented. What I found was that although the file appears in Explorer, I can do nothing with it. I can't open it, I can't choose \"Properties\" (Windows 7). Other common apps can't open the file (e.g. IE, Firefox, Notepad). Explorer will also not let me create files/dirs which are too long - it just refuses. Ditto for command line tool cmd.exe.</li>\n</ol>\n\n<p>So basically, one could look at it this way: a rouge tool has allowed the user to create a file which is not accessible by a lot of Windows (e.g. Explorer). I could take the view that I shouldn't have to deal with this.</p>\n\n<p>(As an aside, this isn't an vote of approval for a short max path length: I think 260 chars is a joke, I'm just saying that if Windows shell and some APIs can't handle > 260 then why should I?).</p>\n\n<p>So, is this a fair view? Should I say \"Not my problem\"?</p>\n\n<p><em>UPDATE:</em> Just had another user with the same problem. This time an mp3 file. Am I missing something? How can these users be creating files that violate the MAX_PATH rule?</p>\n\n<p>Thanks!</p>\n\n<p>John</p>\n"},{"tags":["c++","qt","winapi","mount","disk-partitioning"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":76,"score":2,"question_id":12568392,"title":"How to use winapi classes?","body":"<p>am trying to create a project that create a file, formatting it, create a new partition and mount it, dismount it ... in C++ with Qtcretor\nI found that winapi offer several function help me to do that <code>Format method of the Win32_Volume class</code> and <code>AddMountPoint method of the Win32_Volume class</code> but there is no code example show how to use it I try with <a href=\"http://msdn.microsoft.com/en-us/library/aa394558%28v=vs.85%29.aspx\" rel=\"nofollow\">WMI C++ Application Examples</a> but in vain </p>\n\n<p>can any one put me on the way please?</p>\n\n<p>Any help will be appreciated and thanks in advance.</p>\n"},{"tags":["winapi","volume-shadow-service"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":236,"score":5,"question_id":10544433,"title":"How to get the 'NextUSN' journal entry for a VSS snapshot?","body":"<p>after creating a VSS snapshot I'd like to be able to query the USN journal. Is this possible or is the USN journal not accessible from a VSS snapshot?</p>\n\n<p>my goal <strong>is to be able to use the USN journal in an incremental backup between two VSS snapshots</strong>.  The process for the backup would be to</p>\n\n<ol>\n<li>take a VSS Snapshot and backup the volume, taking note of the USN entries for each file</li>\n<li>...use the filesystem, add/delete/modify files</li>\n<li>take a second VSS snapshot,  then use the USN journal to detect anything that changed during step #2</li>\n</ol>\n\n<p>what I'm failing with right now is the part where I'm trying to get a hold of the highest USN entry on the VSS snapshot</p>\n\n<ol>\n<li>create VSS Snapshot</li>\n<li>open the snapshot with CreateFile(\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy25)</li>\n<li>DeviceIoControl(FSCTL_QUERY_USN_JOURNAL) - this fails with GLE:1179 \"the volume change journal is not active\"</li>\n</ol>\n\n<p>I can simulate this from the commandline as follows</p>\n\n<pre><code>C:\\&gt;vssadmin list shadows\nvssadmin 1.1 - Volume Shadow Copy Service administrative command-line tool\n(C) Copyright 2001-2005 Microsoft Corp.\n\nContents of shadow copy set ID: {54fc99fb-65f2-4558-8e12-9308979327f0}\n   Contained 1 shadow copies at creation time: 5/10/2012 6:44:19 PM\n      Shadow Copy ID: {a2d2c155-9916-47d3-96fd-94fae1c2f802}\n         Original Volume: (T:)\\\\?\\Volume{a420b1fa-9744-11e1-9082-889ffaf52b70}\\\n         Shadow Copy Volume: \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy25\n         Originating Machine: computer\n         Service Machine: computer\n         Provider: 'Microsoft Software Shadow Copy provider 1.0'\n         Type: Backup\n         Attributes: Differential\n\n\nC:\\&gt;fsutil usn queryjournal \\\\?\\Volume{a420b1fa-9744-11e1-9082-889ffaf52b70}\nUsn Journal ID   : 0x01cd2ebe9c795b57\nFirst Usn        : 0x0000000000000000\nNext Usn         : 0x000000000001b5f8\nLowest Valid Usn : 0x0000000000000000\nMax Usn          : 0x7fffffffffff0000\nMaximum Size     : 0x0000000000100000\nAllocation Delta : 0x0000000000040000\n\nC:\\&gt;fsutil usn queryjournal \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy25\nError:  The volume change journal is not active.\n</code></pre>\n\n<p>Any ideas what I'm doing incorrectly,  if this is possible?</p>\n"},{"tags":["winapi","win32gui"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12571449,"title":"What happens when a message is triggered before the previously dispatched message callback is complete?","body":"<p>I spent some time trying to research a definitive answer for this and couldn't find a reliable source.</p>\n\n<p>My scenario is fairly straightforward.  I have a thread with a message pump setup that is processing a recurring event from a timer.  Here is the message pump source:</p>\n\n<pre><code>// create timer that goes off every 500 ms\nUINT_PTR myTimerID = SetTimer(NULL, 0, 500, TimerCallback);\n\n// message structure\nMSG msg;\n\n// process and handle messages for this thread\nBOOL getMessageStatus;\nwhile((getMessageStatus = GetMessage(&amp;msg, NULL, 0, 0)) != 0)\n{\n    // failed get message\n    if(getMessageStatus == -1)\n    {\n        printf(\"GetMessage FAILED!\\n\");\n    }\n    // process timer message\n    else if(msg.message == WM_TIMER)\n    {\n        // invoke callback\n        TranslateMessage(&amp;msg);\n        DispatchMessage(&amp;msg);\n    }\n}\n</code></pre>\n\n<p>If TimerCallback takes longer than 500 ms, the timer will have fired its event again.  Since, the callback is being executed on the same thread as the message pump, I assume that the callback must complete before the next timer message is processed by the message pump.</p>\n\n<p>Is that correct?</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":45,"score":3,"question_id":12570185,"title":"How to get Localized Date and Time from SYSTEMTIME","body":"<p>I have a SYSTEMTIME and I am trying to get a localized string with both the date and time values from it. API's like GetDateFormat/GetTimeFormat get either the date or time - but not both.</p>\n\n<p>Is there an API that is available that'll get me the localized string with both the date and time from a SYSTEMTIME?</p>\n"},{"tags":["winapi","windows-7","scroll","editcontrol"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":371,"score":1,"question_id":7171412,"title":"Windows 7 edit control, vertical scroll does not work","body":"<p>I have an application that compiles ok (mingw) and runs ok, however the edit control that is created has scroll bars but the vertical scroll bar doesn't do anything. The same executable works fine on WinXP. Also, the edit control has both vertical and horizontal scroll bars, the horizontal works just fine, but vertical does not. The vertical scroll bar is visible and clickable, but nothing happens...</p>\n\n<p>Following code is used when creating the edit control:</p>\n\n<pre><code>HWND hwndEdit = CreateWindow(TEXT(\"EDIT\"), TEXT(\"Edit control\"),\n    WS_OVERLAPPED | WS_VISIBLE | WS_HSCROLL | WS_VSCROLL | ES_LEFT | ES_MULTILINE |\n    ES_AUTOHSCROLL | ES_AUTOVSCROLL | ES_READONLY | WS_SIZEBOX,\n    1000, 480, 400, 500, NULL, 0, GetModuleHandle(NULL), NULL);\nSendMessage(hwndEdit, WM_SETTEXT, 0, (LPARAM) TEXT(\"\")); \nSendMessage(hwndEdit, EM_LIMITTEXT, 0, 0);\n</code></pre>\n\n<p>Following code is used repeatedly to add text to edit control:</p>\n\n<pre><code>char test[] = \"test\";\nSendMessage(hWndDbg, EM_SETSEL, 0x7FFFFFFF, 0x7FFFFFFF); // Undo any selection and move to end.\nSendMessage(hWndDbg, EM_REPLACESEL, 0, (LPARAM) temp);\n</code></pre>\n"},{"tags":["winapi","opengl","screenshot"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":881,"score":2,"question_id":2143854,"title":"Getting screenshot of a child window running OpenGL in it (Windows)","body":"<p>I have a main window with children. I need to take screenshots programmatically to crop and draw them back on my main window. The way I do this is:</p>\n\n<pre><code>HDC hDC = GetWindowDC(hWnd);\nHDC memDC = CreateCompatibleDC(hDC);\nHBITMAP memBM = CreateCompatibleBitmap(hDC, Width, Height);\nHBITMAP OldBM = (HBITMAP)::SelectObject(memDC, memBM );\nBitBlt(memDC, 0, 0, Width, Height , hDC, BEGINX, BEGINY, SRCCOPY);\nint Bpp = GetDeviceCaps(hDC,BITSPIXEL);\nint size = Bpp/8 * ( Width * Height );\nBYTE *lpBits = new BYTE[size];\nGetBitmapBits(memBM, size, lpBits);\n</code></pre>\n\n<p>But this doesn't capture the OpenGL section of the child windows, instead it just draws blank white in the area where OGL render is supposed to be.</p>\n"},{"tags":["windows","winapi","user-interface"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12569448,"title":"Keep part of a window always visible","body":"<p>It is possible to use the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms633545%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>SetWindowPos</code></a> API on Windows to keep a windows always on top of other windows, and there are many questions on StackOverflow dealing with this.</p>\n\n<p>It is possible to keep only part of a Window always visible? I.e. specify a clipping region inside an existing window, and keep only that part visible?</p>\n\n<p>A use case would be the following (on Windows):</p>\n\n<ul>\n<li>User clicks on icon to run app.</li>\n<li>User highlights a portion of the screen to focus on (similar to the Snipping Tool on Windows 7)</li>\n<li>The highlighted part of the screen remains always visible, even when other windows/programs are moved over the selected region.</li>\n</ul>\n\n<p>I know the issues that would spring up with having other applications that are also set to being topmost. Just curious if this is even possible?</p>\n"},{"tags":["python","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12565088,"title":"python: win32print.AddPrinter: adding a printer to remote computer","body":"<p>I am getting the error</p>\n\n<pre><code>pywintypes.error: (1801, 'AddPrinter', 'The printer name is invalid.')\n</code></pre>\n\n<p>My intention is to add a network printer to end user computers... heres my def</p>\n\n<pre><code>import win32print\n\ndef AddPrinter(computer, printer):\n    pHandle = win32print.OpenPrinter(printer) #int\n    print \"%s = %s\"%(printer, pHandle)\n\n    pInfo = win32print.GetPrinter(pHandle,2) #dict\n    print pInfo\n\n    win32print.ClosePrinter(pHandle)    \n\n    win32print.AddPrinter(computer, 2, pInfo)\n\nif __name__=='__main__':\n    computer = 'remote-pc'\n    printer = r'\\\\printserver\\printer1'\n    AddPrinter(computer, printer)\n</code></pre>\n\n<p>What's the deal here... its got to be a valid printer name, because it successfully pulls the handle and gives me the pInfo dict that it wants...  frustrating... I don't want to make any batch files!!</p>\n\n<p>Thanks for any help you might have.</p>\n\n<p>traceback:</p>\n\n<pre><code>    \\\\cheops1\\4EPrint1 = &lt;PyPrinterHANDLE:4704604&gt;\n    {'Status': 0, 'UntilTime': 0, 'pDriverName': 'HP Universal Printing PCL 5 (v5.0)', 'cJobs': 0, 'pSepFile': '', 'AveragePPM': 0, 'pPortName': 'IP_10.10.185.5', 'pParameters': '', 'pPrintProcessor': 'hpcpp091', 'Attributes': 8728, 'Priority': 1, 'pPrinterName': '\\\\\\\\cheops1\\\\4EPRINT1', 'DefaultPriority': 0, 'StartTime': 0, 'pDatatype': 'RAW', 'pDevMode': &lt;PyDEVMODEA object at 0x01B92958&gt;, 'pLocation': '10.10.185.5', 'pShareName': '4EPRINT1', 'pServerName': '\\\\\\\\cheops1', 'pSecurityDescriptor': &lt;PySECURITY_DESCRIPTOR object at 0x01C74560&gt;, 'pComment': 'Rm 4053, 4E Main Desk Laser, Laserjet 4100 MFP, LNWID - 711096'}\n    Traceback (most recent call last):\n        File \"D:\\workspace\\Clinical Applications\\EPIC\\EPIC_Values.py\", line 183, in &lt;module&gt;\n            AddPrinter(computer, printer)\n        File \"D:\\workspace\\Clinical Applications\\EPIC\\EPIC_Values.py\", line 161, in AddPrinter\n            win32print.AddPrinter(computer, 2, pInfo)\n    pywintypes.error: (1801, 'AddPrinter', 'The printer name is invalid.')\n</code></pre>\n"},{"tags":["c++","winapi","map","file-system"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":74,"score":4,"question_id":12567600,"title":"windows map file system","body":"<p>Windows Explorer can associate a drive letter with a file system or directory within a file system. How do I do this from a C++ program under Windows 7 and Vista? My search of visual studio documentation and the web has not turned up API calls for doing this. Does anybody know?</p>\n"},{"tags":["c++","winapi"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12567467,"title":"Confusion With Win32 Conections - Why Does This Code Work?","body":"<p>I followed a tutorial on some win32, creation and interaction, but I'm not sure how the code connects a \"Write here\" edit box to a message box.</p>\n\n<pre><code>#define IDC_MAIN_BUTTON 101         // Button identifier\n#define IDC_MAIN_EDIT   102         // Edit box identifier\nHWND hEdit;\n\nLRESULT CALLBACK WinProc(HWND hWnd,UINT message,WPARAM wParam,LPARAM lParam);\n\nint WINAPI WinMain(HINSTANCE hInst,HINSTANCE hPrevInst,LPSTR lpCmdLine,int nShowCmd)\n{\n    WNDCLASSEX wClass;\n    ZeroMemory(&amp;wClass,sizeof(WNDCLASSEX));\n    wClass.cbClsExtra=NULL;\n    wClass.cbSize=sizeof(WNDCLASSEX);\n    wClass.cbWndExtra=NULL;\n    wClass.hbrBackground=(HBRUSH)COLOR_WINDOW;\n    wClass.hCursor=LoadCursor(NULL,IDC_ARROW);\n    wClass.hIcon=NULL;\n    wClass.hIconSm=NULL;\n    wClass.hInstance=hInst;\n    wClass.lpfnWndProc=(WNDPROC)WinProc;\n    wClass.lpszClassName=\"Window Class\";\n    wClass.lpszMenuName=NULL;\n    wClass.style=CS_HREDRAW|CS_VREDRAW;\n\n    if(!RegisterClassEx(&amp;wClass))\n    {\n        int nResult=GetLastError();\n        MessageBox(NULL,\n            \"Window class creation failed\\r\\n\",\n            \"Window Class Failed\",\n            MB_ICONERROR);\n    }\n\n    HWND hWnd=CreateWindowEx(NULL,\n            \"Window Class\",\n            \"Windows application\",\n            WS_OVERLAPPEDWINDOW,\n            200,\n            200,\n            640,\n            480,\n            NULL,\n            NULL,\n            hInst,\n            NULL);\n\n    if(!hWnd)\n    {\n        int nResult=GetLastError();\n\n        MessageBox(NULL,\n            \"Window creation failed\\r\\n\",\n            \"Window Creation Failed\",\n            MB_ICONERROR);\n    }\n\n    ShowWindow(hWnd,nShowCmd);\n\n    MSG msg;\n    ZeroMemory(&amp;msg,sizeof(MSG));\n\n    while(GetMessage(&amp;msg,NULL,0,0))\n    {\n        TranslateMessage(&amp;msg);\n        DispatchMessage(&amp;msg);\n    }\n\n    return 0;\n}\n\nLRESULT CALLBACK WinProc(HWND hWnd,UINT msg,WPARAM wParam,LPARAM lParam)\n{\n    switch(msg)\n    {\n        case WM_CREATE:\n        {\n\n// How does this edit box, connect to the button?\n\n            // Create an edit box\n            hEdit=CreateWindowEx(WS_EX_CLIENTEDGE,\n                \"EDIT\",\n                \"\",\n                WS_CHILD|WS_VISIBLE|\n                ES_MULTILINE|ES_AUTOVSCROLL|ES_AUTOHSCROLL,\n                50,\n                100,\n                200,\n                100,8\n                hWnd,\n                (HMENU)IDC_MAIN_EDIT, GetModuleHandle(NULL), NULL);\n            HGDIOBJ hfDefault=GetStockObject(DEFAULT_GUI_FONT);\n            SendMessage(hEdit, WM_SETFONT, (WPARAM)hfDefault, MAKELPARAM(FALSE,0));\n            SendMessage(hEdit, WM_SETTEXT, NULL, (LPARAM)\"Insert text here...\");\n\n            // Create a push button\n            HWND hWndButton=CreateWindowEx(NULL,\n                \"BUTTON\",\n                \"OK\",\n                WS_TABSTOP|WS_VISIBLE|\n                WS_CHILD|BS_DEFPUSHBUTTON,\n                50,\n                220,\n                100,\n                24,\n                hWnd,\n                (HMENU)IDC_MAIN_BUTTON, GetModuleHandle(NULL), NULL);\n            SendMessage(hWndButton, WM_SETFONT, (WPARAM)hfDefault, MAKELPARAM(FALSE,0));\n        }\n        break;\n\n\n\n        case WM_COMMAND:\n            switch(LOWORD(wParam))\n            {\n                case IDC_MAIN_BUTTON:\n                {\n                    char buffer[256];\n                    SendMessage(hEdit, WM_GETTEXT, sizeof(buffer)/sizeof(buffer[0]), reinterpret_cast&lt;LPARAM&gt;(buffer));\n                    MessageBox(NULL, buffer, \"Information\", MB_ICONINFORMATION);\n                }\n                break;\n            }\n            break;\n\n        case WM_DESTROY:\n        {\n            PostQuitMessage(0);\n            return 0;\n        }\n        break;\n    }\n\n    return DefWindowProc(hWnd,msg,wParam,lParam);\n}\n</code></pre>\n\n<p>I am really not sure how the text box sends its info to the message box.</p>\n"},{"tags":["c#","security","winapi","windows-8","internet-explorer-10"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12538367,"title":"Using CredEnumerate to pull WebCredentials","body":"<p>As part of a password management tool, I am attempting to enumerate IE 10 web site usernames (i.e., auto-complete usernames) by using <code>CredEnumerate</code>.  When I call <code>CredEnumerate</code>, it yields several usernames (generic usernames and domain usernames) from within the \"Windows Credentials\" section of the \"Credential Manager\", but does not include anything from the \"Web Credentials\" section of the Credential Manager (Control Panel\\User Accounts and Family Safety\\Credential Manager).</p>\n\n<pre><code>private static void Main()\n{\n    int count;\n    IntPtr pCredentials;\n    bool ret = CredEnumerate(null, 1, out count, out pCredentials);\n    // ...\n}\n</code></pre>\n\n<p>How can I get access to the Web Credentials?</p>\n"},{"tags":["c","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12565967,"title":"Semaphore functions","body":"<p>moin-moin,</p>\n\n<p>I need the MS Visual C (6.0) equivalent for the functions \"DosEnterCritSec()\" and \"DosExitCritSec()\", which garantees, that no two threads are executing the enclosed code at the same time.</p>\n\n<p>Can anybody please point me into the right direction?</p>\n\n<p>Thanks a lot,\nPeter</p>\n"},{"tags":["winapi","visual-c++"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12535401,"title":"How to auto resize main window according to size of text in Visual C++ application?","body":"<p>This is pretty simple. I have a main window which is having some lines of text.\nNow the text is sort of dynamic. It may change depending upon situation. If I keep window size fixed then it will not fit in that pre-defined window size. So how to have create a window which re sizes itself according to text in it. </p>\n\n<p>Second, I needed to remove my running exe from taskbar which I did using \"WS_EX_TOOLWINDOW\", but it also removed round corner border. Is there any other way to remove title controls so I don't lose round corners.</p>\n\n<p>Could anyone help me on these issues.</p>\n\n<p>I have searched all over the web for whole day but could not find any solution. Maybe I missed something.</p>\n\n<p>Thanks </p>\n\n<p>Final Code:</p>\n\n<pre><code>BOOL InitInstance(HINSTANCE hInstance, int nCmdShow)\n{\nHWND hWnd,hWnd2;\nHWND hEdit;\n\nhInst = hInstance; // Store instance handle in our global variable\nGetSystemMetrics(SM_CXSCREEN); GetSystemMetrics(SM_CYSCREEN);\nhWnd = CreateWindowEx(   WS_OVERLAPPED ,szWindowClass\n   , szTitle, WS_CAPTION,\n  100, 100, 200, 100,  NULL, NULL, hInstance, NULL);\n\n//ShowWindow(hWnd, nCmdShow);\n//UpdateWindow(hWnd);\n\nhWnd2= CreateWindowEx(   0  ,szWindowClass\n   , szTitle, WS_POPUP | WS_BORDER | WS_CAPTION | CS_NOCLOSE,\n  120, 120, 200, 100, hWnd , NULL, hInstance, NULL);\n\nif (!hWnd)\n{\n   return FALSE;\n}\n\nShowWindow(hWnd2, nCmdShow);\nUpdateWindow(hWnd2);\nreturn TRUE;\n}\n</code></pre>\n"},{"tags":["winapi","casting","inno-setup"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":81,"score":2,"question_id":12550791,"title":"Innosetup SendMessage after changing the environment values","body":"<p>I set environment variable in the registry using InnoSetup:</p>\n\n<pre><code>[Registry]\nRoot: HKLM; Subkey: \"SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\"; ValueType: string; ValueName: \"MY_PROGRAM_HOME_DIR\"; ValueData: \"{app}\"\n</code></pre>\n\n<p>But system cannot see this variable until I call <code>SendMessage</code>.</p>\n\n<pre><code>[Code]\nprocedure DeinitializeSetup();\nbegin\n  // HWND_BROADCAST = $FFFF \n  // WM_SETTINGCHANGE = $001A\n  SendMessage($FFFF, $001A, 0, Longint(PChar('Environment')));\nend;\n</code></pre>\n\n<p>InnoSetup says: </p>\n\n<blockquote>\n  <p>... Column 60: Type mismatch </p>\n</blockquote>\n\n<p>How do I correctly typecast <code>PChar</code> into <code>Longint</code> in InnoSetup script?</p>\n"},{"tags":["c++","windows","visual-studio","winapi"],"answer_count":11,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":1632,"score":7,"question_id":552019,"title":"Is is possible to develop for windows, in C++, without Visual Studio?","body":"<p>I'm aspiring to work in real-time 3D graphics. I work almost exclusively in C++, with a healthy smattering of win32. Realistically, do I have any sane alternatives?</p>\n"},{"tags":["windows","perl","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12541794,"title":"BrowseForFolder() window does not open at the foreground, hides (Perl Win32::GUI)","body":"<p>When calling Perl <code>Win32::GUI::BrowseForFolder()</code>, the desktop (naturally) has several earlier windows on it. It turns out that the <code>BrowseForFolder()</code> window hides behind those windows. This is sometimes confusing and annoying, because you may not realize the program is asking you for a folder name, and you may think there is a bug. (This is in difference from (for example)  <code>Win32::GUI::GetOpenFileName()</code> or <code>GetSaveFileName()</code>, which do pop up at the foreground!).</p>\n\n<p>My question is: how to make <code>BrowseForFolder()</code> come to the foreground?</p>\n\n<p>One possibility is to find its handle, and then raise it to the foreground.</p>\n\n<p>Note that <code>-addexstyle =&gt; WS_EX_TOPMOST</code> doesn't have an effect (see below).</p>\n\n<p>Here is a complete (compileable and running) code example. (5.014 is not essential) </p>\n\n<pre><code>use strict;\n\nuse warnings;\nuse 5.014;      \nuse Win32::GUI();\nuse Win32::GUI qw{ WS_EX_TOPMOST};\nmy ($InputDir, $TopDir, $InputFileName, $dw, $dh, $desktop, $Window);\n\n$TopDir = 'D:\\My documents';    # Change this to an existing direcotry of yours\n$desktop = Win32::GUI::GetDesktopWindow();\n$dw = Win32::GUI::Width($desktop);\n$dh = Win32::GUI::Height($desktop);\n$Window = Win32::GUI::Window-&gt;new( -name =&gt; 'main', -text =&gt; 'Main window',\n    -pos =&gt; [20/100*$dw, 20/100*$dh], -size =&gt; [50/100*$dw, 60/100*$dh],\n    -onTerminate =&gt; \\&amp;TerminateWindow,\n    -addexstyle =&gt; WS_EX_TOPMOST,   -dialogui =&gt; 1, -tabstop =&gt; 1, -cancel =&gt; 1, );\n$Window -&gt; AddButton ( -name =&gt; 'ButtonCommit', -pos =&gt; [10,10], \n    -size =&gt;[16/100*$dw,3.5/100*$dh], -text =&gt; 'Commit changes', -onClick =&gt; \\&amp;Commit);\nsub Commit {\n$InputDir = Win32::GUI::BrowseForFolder( -root =&gt; $TopDir, -includefiles =&gt; 1,\n                -title =&gt; 'Select directory for parameter file', \n                -text =&gt;'Selext directory for parameter file',\n                -size =&gt; [50/100*$dw, 50/100*$dh], -addexstyle =&gt; WS_EX_TOPMOST,);\n$InputFileName = Win32::GUI::GetOpenFileName( -title  =&gt; 'Select the input file',\n    -directory =&gt; $InputDir, -file   =&gt; \"\\0\" . \" \" x 256,\n    -filter =&gt; [\"Text files (*.txt)\" =&gt; \"*.txt\", \"All files\", \"*.*\", ],\n    -text =&gt; 'text Select input file');\n} # end sub Commit\n$Window -&gt;Show();\nWin32::GUI::Dialog();\nsub TerminateWindow {\nreturn -1;\n}\n</code></pre>\n\n<p>Click the \"Commit changes\" button, then minimize the main window, and only then you see the \"hiding\" <code>BrowseForFolder()</code> window. </p>\n\n<p>Note that the <code>BrowseForFolder()</code> window hides behind other windows, and you need to minimize other windows to get to it. All other Perl <code>Win32::GUI</code> windows do open up at the foreground.</p>\n\n<p>Furthermore, note that <code>-addexstyle =&gt; WS_EX_TOPMOST</code> doesn't have an effect, while it usually does in Perl <code>Win32::GUI</code> windows.</p>\n\n<p>Note: change the <code>D:\\My documents</code> to an existing directory.</p>\n\n<p>Related question: How does one find the desktop windows handles? If we could find <code>BrowseForFolder()</code>'s handle, we could raise it to the foreground.</p>\n\n<p>(Note: similar question cross-posted at PerlMonks: <a href=\"http://perlmonks.org/?node_id=994815\" rel=\"nofollow\">http://perlmonks.org/?node_id=994815</a>)</p>\n"},{"tags":["c++","c","winapi","thread-state"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":1,"view_count":118,"score":6,"question_id":12562323,"title":"How can I get the state of a program?","body":"<p>I'm observing an program and want to kill it, if it is for some time in the state \"wait:executive\".</p>\n\n<p>Here is a screenshot of the Process Explorer:</p>\n\n<p><img src=\"http://i.stack.imgur.com/15sio.png\" alt=\"State: wait:executive\"></p>\n\n<p><strong>How can I get that state by code?</strong> Or could maybe tell me somebody what that state exactly mean? This will may help me to find the right query to solve my problem.</p>\n"},{"tags":["windows","winapi","explorer"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12454918,"title":"How can I flush any cache of windows explorer?","body":"<p>I want to make a change on windows explorer by modifying specific registry value directly. but, the explorer is changed since I restart it ONLY. </p>\n\n<p>I guess that reloading the cache of the explorer's setting is a proper solution. But, I don't know how to reload the cache programmatically. </p>\n\n<p>Is there anybody who know the solution?</p>\n\n<p><strong>UPDATE:</strong><br>\nI think that my question do not give you enough information. When I changed any policy of internet settings on registry, I expect that the change would affect the windows explorer immediately. But it didn't do that. Thus, I tried to monitor the behavior of the explorer using ProcessMonitor made by sysinternals. By monitoring, I discovered the explorer didn't get the value from registry each time. </p>\n\n<p>Therefore, I really wanted to know how to make the explorer get the value.</p>\n"},{"tags":["c","windows","winapi","ati"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12562380,"title":"ATI Driver and settings change","body":"<p>I have the need to programmatically change the various settings that are present in the ATI Catalyst control center. From AMD website I downloaded ADL SDK, which seemed to allow me to change the settings for under and over scaling, resolution, frequency and brightness. However, it seems I'm not able to change the settings in the video section with my program: for example if I try to change screen brightness, changes are not propagated or applied, resulting in screen not changing the brightness.\nThe operating system used is Windows 7. Is ADL the correct technology to do that and how can I change this setting?</p>\n"},{"tags":["c#",".net","winforms","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":96,"score":1,"question_id":12561889,"title":"Using C# Winforms with Win32","body":"<p>I'm new to Win32 and not super familiar with C#, so bear with me please. I have a project in school that involves making an audio editing program, and we were given a choice of which language to use. I decided to thrust myself into unfamiliarity by going with a combination of C# and Win32.</p>\n\n<p>My progress so far in this is creating a Winforms project, scrapping all the Winforms code, and creating a window using the Win32 API. I do not know how to manipulate the window using Winforms or use anything else from the .NET framework in a meaningful way.</p>\n\n<p>My question is, is there some way to take a window created using the Win32 API and edit it using Winforms? Like, pass the window handle to my Form, edit it, and see the changes reflected in the window that has been created? Let me know if this doesn't make sense. It's been difficult for me to find much documentation on this, but maybe I'm just searching in the wrong places. If you could let me know of any resources that might help, or provide a nudge in the right direction, it would be appreciated.</p>\n"},{"tags":["winapi","qt4","device","disk-partitioning"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":98,"score":0,"question_id":12478006,"title":"How get device harddisk partion information QT","body":"<p>I'am trying to get system information in a QT project, I want to know the hard disk partition in windows and the different properties of each partition so there is my code</p>\n\n<pre><code>QString drivename=QString(FileInfo.absolutePath().at(0))+\":\\\\\\\\\";\n    ULARGE_INTEGER freeBytesToCaller;\n    ULARGE_INTEGER TotalBytes;\n    ULARGE_INTEGER FreeBytes;\n    freeBytesToCaller.QuadPart = 0L;\n    TotalBytes.QuadPart = 0L;\n    FreeBytes.QuadPart = 0L;\n\n    if( !GetDiskFreeSpaceEx( drivename.toStdWString().c_str(), &amp;freeBytesToCaller,&amp;TotalBytes,&amp;FreeBytes ) )\n    {\n        qDebug() &lt;&lt;drivename&lt;&lt; \"ERROR: Call to GetDiskFreeSpaceEx() failed.\";\n\n    }\n   // qDebug()&lt;&lt;\"drive type of \"&lt;&lt;drivename&lt;&lt;\"  \"&lt;&lt;GetDriveTypeW(drivename.toStdWString().c_str());\n     int TotalBytes_gb = TotalBytes.QuadPart/(1024*1024*1024) ;\n</code></pre>\n\n<p>So it let me know the partion name (eg. C:\\) the size and type but what i want also to get information about the partition (\\Device\\Harddisk0\\Partition1 C:\\ 232GB)</p>\n\n<p>How can I do it,\nThanks in advance</p>\n"},{"tags":["flash","winapi","com","windows-vista","compatibility"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":2116,"score":5,"question_id":1587962,"title":"How do I prevent programmatically the \"Program Compatibility Assistant\" in Vista (and Windows 7) from appearing?","body":"<p>I develop a C++ program which might use adobe flash, although it is not essential.<br>\nI use CoCreateInstance to create the flash object, and if it fails, I know flash is not installed so I don't use it.<br>\nHowever, in Vista (and I think Windows 7 as well), when flash is not installed, after leaving the application, the \"Program Compatibility Assistant\" pops up a message saying that \"This program requires a missing Windows component\" specifying the flash.ocx.<br><br>\nIs there a way to prevent this message from appearing? I don't want to force any user to install flash (especially since it's the IE ActiveX, and FireFox users might not have it installed), and my application can operate well without the flash.<br>\nPlus this message is really annoying when it appears after every run.<br>\nI don't mean of course disabling the PCA on the user's machine, but programmatically disable this specific appearance on all machines. </p>\n\n<p>Any thoughts?<br>\nThanks</p>\n\n<p>[EDIT:]</p>\n\n<p>I followed Shay's lead (thanks), and did some more digging of my own. I added the following XML to the application's manifest:</p>\n\n<pre><code>&lt;trustInfo xmlns=\"urn:schemas-microsoft-com:asm.v2\"&gt;\n  &lt;security&gt;\n    &lt;requestedPrivileges&gt;\n      &lt;requestedExecutionLevel level=\"asInvoker\" uiAccess=\"false\"&gt;\n      &lt;/requestedExecutionLevel&gt;\n   &lt;/requestedPrivileges&gt;\n  &lt;/security&gt;\n&lt;/trustInfo&gt;\n</code></pre>\n\n<p>(see also: <a href=\"http://msdn.microsoft.com/en-us/library/bb756929.aspx\">msdn.microsoft.com/en-us/library/bb756929.aspx</a>)<br />\nThis solved the problem on Vista 64.</p>\n\n<p>To solve the same problem on Windows 7, I added the following:</p>\n\n<pre><code>&lt;compatibility xmlns=\"urn:schemas-microsoft-com:compatibility.v1\"&gt;\n  &lt;application&gt;\n    &lt;!--The ID below indicates application support for Windows Vista --&gt;\n    &lt;supportedOS Id=\"{e2011457-1546-43c5-a5fe-008deee3d3f0}\"/&gt;\n    &lt;!--The ID below indicates application support for Windows 7 --&gt;\n    &lt;supportedOS Id=\"{35138b9a-5d96-4fbd-8e2d-a2440225f93a}\"/&gt;\n  &lt;/application&gt;\n&lt;/compatibility&gt;\n</code></pre>\n\n<p>(See also: <a href=\"http://blogs.msdn.com/yvesdolc/archive/2009/09/22/the-new-compatibility-section-in-the-application-manifest.aspx\">blogs.msdn.com/yvesdolc/archive/2009/09/22/the-new-compatibility-section-in-the-application-manifest.aspx</a>)  </p>\n\n<p>Solved Windows 7.</p>\n\n<p>But for some reason, <strong>it still happens in Vista 32</strong>...</p>\n\n<p>I also tried editing the manifest of the specific DLL which causes the problem, but it had no effect. Only the executable's manifest itself affected the problem.</p>\n\n<p>So... Vista 32?</p>\n"}]}
{"total":13828,"page":10,"pagesize":100,"questions":[{"tags":["c++","c","winapi","delete","hwnd"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":129,"score":2,"question_id":12543668,"title":"Delete an HWND object","body":"<p>I have a situation where when I receive a message I must delete a window just from the hWnd. I though this must be possible since <code>CreateWindowEx</code> creates an object by returning a HWND, I must be able to delete one.</p>\n\n<p>Note : The hWnd lies on some other process.</p>\n"},{"tags":["c++","winapi","download","max-size"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12558651,"title":"URLDownloadToFile C++ won't download more than 15Kb","body":"<pre><code>void UpdateApp(HWND hwnd) {\nHRESULT hRez = URLDownloadToFile( NULL, string(\"Web Address here.\").c_str(), string(\"Download file here\").c_str(), 0, NULL);\nif(hRez == E_OUTOFMEMORY ){\n    MessageBox(hwnd, \"\",\"\",MB_OK);\n}\nelse if(hRez!=S_OK) {\n    MessageBox(hwnd, \"Error downloading the updater.\", \"Error!\", MB_ICONERROR | MB_SYSTEMMODAL);\n}\nif(hRez==S_OK) {\n    MessageBox(hwnd, \"Done\", \"\", MB_OK);\n}\n}\n</code></pre>\n\n<p>I am making an auto-update program for a main program. So far all is going good, but the function URLDownloadToFile does not download more than 14.1 Kb. I am using it to download a zip with all the update files in it. Every time I run it it goes 14.1 Kb and then stops, and doesn't return any errors. I haven't read anywhere about a size restriction on the downloads, so what could be causing this? The actual size of the zip is 1,644Kb. Thanks for any and all help in advance.</p>\n"},{"tags":["c#","c++","winapi","registry","system-tray"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":115,"score":-1,"question_id":12550445,"title":"Registry setting to make icon always show in the Windows 7 tray","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/904790/how-to-always-show-program-tray-icons-in-windows-by-default\">How to always show program tray icons in Windows by <em>default</em>?</a>  </p>\n</blockquote>\n\n\n\n<p>I thought setting a tray icon to always show it in the \"new\" system tray on Windows 7 (or Windows 8) was impossible from a non-Microsoft program or a script... until I stumbled upon Dropbox's desktop agent (downloadable right off their home page) that somehow manages to keep its tray icon on the system tray fully visible for as long as it needs. (At least during the set-up stage when it asks for your user name and password. I left it running for at least 5 or 10 min and the icon stayed.) </p>\n\n<p>I then clicked the little chevron that shows a pop-up that enables users to change which icons to show and, what would you know, the dropbox's icon was set to \"Show icon and notifications\". Mind you, I did not change it manually... So there must be a way to do it from a program.</p>\n\n<p>Any idea how it was done?</p>\n\n<p>PS. Please do not point me to the MSDN document saying that it could not be done...</p>\n"},{"tags":["delphi","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":4,"down_vote_count":1,"view_count":150,"score":3,"question_id":12532370,"title":"Folder icon change doesn't take effect","body":"<p>I change the default system folder icon via registry key</p>\n\n<pre><code>Reg := TRegistry.Create; \ntry \n  Reg.RootKey := HKEY_LOCAL_MACHINE;\n  Reg.OpenKey('Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Icons', True);\n  Reg.WriteString('3', 'C:\\MyIcon.icl,0');\nfinally\n  RegFile.Free;\nend;\n</code></pre>\n\n<p>I can change registry values, but the problem is I need to restart the OS for it to take effect.</p>\n\n<p>To fix it I tried:</p>\n\n<pre><code>SendMessage(HWND_BROADCAST, WM_SETTINGCHANGE, 0, 0);\n</code></pre>\n\n<p>and: </p>\n\n<pre><code>SHChangeNotify(SHCNE_ASSOCCHANGED, SHCNF_IDLIST, nil, nil);\n</code></pre>\n\n<p>It works on WinXP but does not on Win7.</p>\n\n<p>How can i fix it on Win7?</p>\n"},{"tags":["windows","winapi","porting"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":63,"score":1,"question_id":12555937,"title":"Porting - Shared Memory x32 & x64 processes","body":"<p>A 32 bit host Windows application setups shared memory (using memory mapped file / CreateFileMapping() API), and then other 32 bit client processes use this shared memory to communicate with each other.</p>\n\n<p>I am planning to port the host application to 64 bit platform and once it is ready, I intend that both 32 bit and 64 bit client processes should be able to use the shared memory setup by the main 64 bit host application.</p>\n\n<p>The original code written for host x32 application uses \"size_t\" almost everywhere, since this differs from 4 bytes to 8 bytes as we move from x32 to x64, I am looking for replacing it.</p>\n\n<p>I intend to replace \"size_t\" by \"unsigned long long\", so that its size will be same on 32 bit &amp; 64 bit. </p>\n\n<p>Can you please suggest me better alternative?\nAlso, will the use of \"unsigned long long\" have performance impact on x32 app .. i guess yes?</p>\n\n<hr>\n\n<p>Research Done - \nFound very useful articles - \na) 20 issue in porting from 32 bit to 64 bit (www.viva64.com)\nb) No way to restrict/change \"size_t\" on x64 platform to 4 bytes using compiler flags or any hooks/crooks since it is typedef</p>\n"},{"tags":["python","winapi","pyqt4","aero"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12553675,"title":"Python/PyQT check if Aero enabled","body":"<p>As told here <a href=\"http://stackoverflow.com/questions/453069/qt-erase-background-windows-aero-glass\">Qt: Erase background (Windows Aero Glass)</a>, I'm using <code>WA_TranslucentBackground</code> to have a glass background on my QMainWindow: on Windows 7 (Aero enabled) it works well, but on Linux (KDE4) I get a black background, I haven't tried on a PC with Aero disabled, or maybe older than Vista.</p>\n\n<p>Is there a way to check if Aero is available and enabled, so I can set WA_TranslucentBackground only if it's enabled, and keep the standard background on Linux and Windows without Aero?</p>\n\n<p>It seems that Windows API's <code>DwmIsCompositionEnabled</code> does the job, but I cannot find how to call it from Python, also taking in account that it may not exist on pre-Vista versions.</p>\n"},{"tags":["c++","winapi","stl"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":12554215,"title":"How to delimit capacity of edit box?","body":"<pre><code>    textBoxOutput = CreateWindowEx(WS_EX_CLIENTEDGE,L\"Edit\",NULL,WS_CHILD | WS_VISIBLE | WS_VSCROLL | ES_AUTOVSCROLL |  ES_MULTILINE | ES_READONLY ,10,81,500,90,hMainWindow,NULL,NULL,NULL);\n.\n.\n.\n\n    while(!buffer.empty()) //Buffer contains arrays of  wchar_t* type\n            {   \n                SendMessage(textBoxOutput,EM_SETSEL,GetWindowTextLength(textBoxOutput),GetWindowTextLength(textBoxOutput));\n                SendMessage(textBoxOutput,EM_REPLACESEL,FALSE, (LPARAM) buffer.front()); \n\n                delete [] buffer.front();\n                buffer.pop();\n            }\n</code></pre>\n\n<p>There are maximally 30000 wide characters visible. Is it possible to at least increase this number?</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":72,"score":2,"question_id":12552822,"title":"winapi - Clear a region of a CBitmap","body":"<p>I have a 32 bit <code>CBitmap</code> buffer on which I <code>AlphaBlend</code> things. However I was wondering if there was a way to 'clear' a rectangular region of the CBitmap completely (as in either set all the Alpha values of the pixels in a specific region to 0 or just clear the region completely). </p>\n\n<p>I can't used GDI+!</p>\n"},{"tags":["c++","api","winapi","hook"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":108,"score":0,"question_id":12554235,"title":"NtQuerySystemInformation Hook Failure","body":"<p>After successfully building a trampoline and learning more about process memory space, I tested the trampoline on MessageBoxA. It worked perfectly so I decided to finally put the code to the use it was supposed to be for in the first place, hiding a process by hooking NtQuerySystemInformation. The redirect function should work fine, but the code I used to write the jmp instruction now causes the task manager to crash every time.</p>\n\n<pre><code>        BYTE tmpJMP[5] = {0xE9,0x00,0x00,0x00,0x00}; //jmp,A,D,D,R\n        memcpy(JMP,tmpJMP,5);\n        DWORD Addr = ((DWORD)func - ((DWORD)oNtQuerySystemInformation + 0x5));\n\n        for (int i=0;i&lt;4;++i)\n            JMP[i+1] = ((BYTE*)&amp;Addr)[i];\n\n        if (VirtualProtect((LPVOID)oNtQuerySystemInformation,5,PAGE_EXECUTE_READWRITE,&amp;oldProtect) == FALSE)\n            MessageBox(NULL,L\"Error unprotecting memory\",L\"\",MB_OK);\n\n        memcpy(oldBytes,(LPVOID)oNtQuerySystemInformation,5);\n\n        if (!WriteProcessMemory(GetCurrentProcess(),(LPVOID)oNtQuerySystemInformation,(LPCVOID)JMP,5,NULL))\n            MessageBox(NULL,L\"Unable to write to process memory space\",L\"\",MB_OK);\n\n        VirtualProtect((LPVOID)oNtQuerySystemInformation,5,oldProtect,NULL);\n\n        FlushInstructionCache(GetCurrentProcess(),NULL,NULL);\n</code></pre>\n\n<p>I'm writing to the memory as such. I can't seem to find a problem with the code. I was thinking that maybe the memory changes from API to API but I was told that's incorrect, making me all out confused. Is there anything wrong that you all see? Please be descriptive. I love to learn o3o </p>\n"},{"tags":["c","winapi","readfile"],"answer_count":5,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1057,"score":3,"question_id":3587117,"title":"Win32 ReadFile() refuses to read more than 16Mb at once?","body":"<p>I've got very strange problem on my Windows XP in VirtualBox.</p>\n\n<p><code>ReadFile()</code> function refuses to read more than 16Mb of data in single call.\nIt returns error code 87 (<code>ERROR_INVALID_ARGUMENT</code>).\nLooks like data length is limited to 24 bits.</p>\n\n<p>Here is the example code allowed me to find out exact limit.</p>\n\n<pre><code>#include &lt;conio.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;io.h&gt;\n#include &lt;sys/stat.h&gt;\n\nint _tmain(int argc, _TCHAR* argv[])\n{\n    int fd,len,readed;\n    char *buffer;\n    char *fname=\"Z:\\\\test.dat\";\n    fd=_open(fname,_O_RDWR|_O_BINARY,_S_IREAD|_S_IWRITE);\n    if (fd==-1) {\n        printf(\"Error opening file : %s\\n\",strerror(errno));\n        getch();\n        return -1;\n    }\n    len=_lseek(fd,0,SEEK_END);\n    _lseek(fd,0,SEEK_SET);\n    if (!len) {\n        printf(\"File length is 0.\\n\");\n        getch();\n        return -2;\n    }\n    buffer=(char *)malloc(len);\n    if (!buffer) {\n        printf(\"Failed to allocate memory.\\n\");\n        getch();\n        return -3;\n    }\n    readed=0;\n    while (readed&lt;len) {\n        len-=100;\n        readed=_read(fd,buffer,len);\n        if (len&lt;=100) break;\n    }\n    if (readed!=len) {\n        printf(\"Failed to read file: result %d error %s\\n\",readed,strerror(errno));\n        getch();\n        return -4;\n    }\n    _close(fd);\n    printf(\"Success (%u).\",len);\n    getch();\n    return 0;\n}\n</code></pre>\n\n<p>File <code>Z:\\test.dat</code> length is 21Mb.</p>\n\n<p>Result is \"<code>Success (16777200).</code>\"</p>\n\n<p>I was trying to find same issues in Google without any success :(</p>\n\n<p>May be someone knows what is the cause of the problem?</p>\n"},{"tags":["windows","multithreading","winapi"],"answer_count":8,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":607,"score":3,"question_id":2022774,"title":"WIN32: Yielding execution to another (given) thread","body":"<p>I am looking for a way to yield the remainder of the thread execution's scheduled time slice to a different thread. There is a <a href=\"http://msdn.microsoft.com/en-us/library/ms686352%28VS.85%29.aspx\" rel=\"nofollow\">SwitchToThread</a> function in WINAPI, but it doesn't let the caller specify the thread it wants to switch to. I browsed MSDN for quite some time and haven't found anything that would offer just that.</p>\n\n<p>For an operating-system-internals layman like me, it seems that yielding thread should be able to specify which thread does it want to pass the execution to. Is it possible or is it just my imagination?</p>\n"},{"tags":["python","winapi","python-2.7","ctypes","windows-console"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12549921,"title":"make windows console cursor invisible with python ctypes modules","body":"<p>I've recently tried using the Console module for python 2.7 on Windows XP, but found that it was poorly documented and would crash on my machine.</p>\n\n<p>So, what I'm doing now is essentially writing my own module, but have come across this bump where I can't figure out how to set the console cursor to be invisible using ctypes.windll.kernel32</p>\n\n<p>How would I go about doing this? (using standard modules with python 2.7 (hopefully just ctypes))</p>\n"},{"tags":["windows","winapi","language-agnostic"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12375660,"title":"How do I launch an updater properly?","body":"<p>I've got a program that needs to be able to update itself.  I have a second program that will perform the updates, downloading and installing.  The updater will obviously need to be able to update the main program, and for that, the main program can't be running.  So I want to have the main program launch the updater with a call to <code>ShellExecuteEx</code>, but <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb759784%28v=vs.85%29.aspx\" rel=\"nofollow\">the MSDN documentation</a> has me a little confused.</p>\n\n<p>It says that:</p>\n\n<blockquote>\n  <p>The SEE_MASK_NOASYNC flag must be specified if the ... process will\n  terminate soon after ShellExecuteEx returns. Under such conditions,\n  the calling thread will not be available to complete the DDE\n  conversation, so it is important that ShellExecuteEx complete the\n  conversation before returning control to the calling application.\n  Failure to complete the conversation can result in an unsuccessful\n  launch of the document.</p>\n</blockquote>\n\n<p>And under <code>SEE_MASK_NOASYNC</code>, it says that the <code>ShellExecuteEx</code> call won't return until the operation is complete.  What I want is to launch the updater and then immediately terminate the main program, so the updater can run without trouble.  Is that the correct way to do it?  And is there anything special I need to do to keep the launched updater from being marked as a \"child process\" that will be killed when the main process shuts down?</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":91,"score":-1,"question_id":12546384,"title":"WinAPI CreateFile function","body":"<p>i have to write CreateFile function in c++\nI wrote this, but it didn't work</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;windows.h&gt;\n#include &lt;string&gt;\nusing namespace std;\n\nint main()\n{\n    HANDLE hfile = CreateFile(\n           \".\\temp.txt\",                // \"\\\\.\\C:\" \n           GENERIC_READ, \n           0,\n           NULL,\n           CREATE_NEW,\n           FILE_ATTRIBUTE_NORMAL,\n           NULL);\n\n    //if (hFile == INVALID_HANDLE_VALUE) cout &lt;&lt; \"Unable to create file \\n\";\n    return 0;\n}\n</code></pre>\n\n<blockquote>\n  <p>error C2664: 'CreateFileW' : cannot convert parameter 1 from 'const char [10]' to 'LPCWSTR' </p>\n</blockquote>\n\n<p>How can I fix this error?</p>\n"},{"tags":["c#","wpf","winapi","keyboard","webbrowser-control"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":243,"score":0,"question_id":9028067,"title":"How to send keystrokes to WebBrowser?","body":"<p>I would like to simulate keystrokes within an embedded <code>System.Windows.Controls.WebBrowser</code>. Various techniques for simulating keystrokes are documented already here on StackOverflow, however they do not seem to work for the WebBrowser control. </p>\n\n<p>Knowing that the control wraps another window/hwnd, I would have expected the following to work however it's not:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>[DllImport(\"user32.dll\")]\nprivate static extern int SendMessage(IntPtr hWnd, uint msg, int wParam, int lParam);\n\n...\n\nSendMessage(myWebBrowser.Handle, WM_CHAR, key, 0);\n</code></pre>\n\n<p>I am already using <code>SendMessage</code> to forward simulated keystrokes to other parts of the WPF application, and would prefer a consistent solution; however this is failing for the <code>WebBrowser</code>.</p>\n\n<p>How can I forward simulated keystrokes to <code>WebBrowser</code>?</p>\n"},{"tags":["c++","winapi","createfile"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":64,"score":-1,"question_id":12546871,"title":"WinAPI createFile function 2","body":"<p>i wrote some code to createfile in c++\nit compiles without errors, but it doesn't create any file.. \nCan anyone tell me what is wrong ?\nthanks</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;windows.h&gt;\n#include &lt;string&gt;\nusing namespace std;\n\n    int main()\n    {\n        HANDLE hfile;\n        char data[] = \"some text to write into file\";       \n\n        hfile = CreateFile(\n               L\"c:\\name.txt\",              \n               GENERIC_WRITE, \n               0,\n               NULL,\n               CREATE_NEW,\n               FILE_ATTRIBUTE_NORMAL,\n               NULL);\n\n        /*\n        if (hFile == INVALID_HANDLE_VALUE) \n        { \n            cout &lt;&lt; \"Unable to create file \\n\";\n\n        }\n        */\n    return 0;\n    }\n</code></pre>\n"},{"tags":["c++","winapi","listview","grouping","common-controls"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12541475,"title":"Enable grouping in ListView - Invalid Handle?","body":"<p>I do not understand the following situation:</p>\n\n<pre><code>    HWND hListView = CreateWindowEx( 0, WC_LISTVIEW, NULL, WS_CHILD | WS_VISIBLE |\n                                   LVS_REPORT | LVS_EDITLABELS | LVS_SHOWSELALWAYS, 0,\n                                   0, rcl.right - rcl.left, rcl.bottom - rcl.top,\n                               hMain,( HMENU ) 1000, inst, NULL);\n    int error = GetLastError();//error=0;\n    //ListView is displayed correctly\n    //Some Code for columns\n    //Now trying to enable grouping via SendMessage or following macro returns error:6?\n    //What the...\n    ListView_EnableGroupView(hListView, TRUE);\n    error = GetLastError();//error=6;ERROR_INVALID_HANDLE\n    //Some Code for Items\n</code></pre>\n\n<p>So what am i missing ;D ? It's hilarious to get this error while the handle is right there above, working for other things (columns, rows/items)</p>\n\n<p>Edit_1 - 7:27(GMT):\nYep, its always error 6 whenever  its placed after creating columns/items/groups and all kinds of combinations, here is the code:</p>\n\n<pre><code>    //Groups - Send-Recv\nLVGROUP lvg;\nlvg.cbSize = sizeof(LVGROUP);\nlvg.mask = LVGF_HEADER | LVGF_GROUPID;\n\nlvg.pszHeader = L\"Gr1\";\nlvg.iGroupId = 1;\nListView_InsertGroup( hListView, - 1, &amp; lvg );\n//MessageBoxA(NULL, i2s(GetLastError()).c_str(), \"ERROR2\", MB_OK | MB_ICONERROR);\nlvg.pszHeader = L\"Gr2\";\nlvg.iGroupId = 2;\nListView_InsertGroup( hListView, - 1, &amp; lvg );\n    //Enable\nListView_EnableGroupView(hListView, TRUE);\n//error 6\n</code></pre>\n"},{"tags":["c","winapi","mouseevent"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":73,"score":-4,"question_id":12541902,"title":"C code to click mouse at given coordinates","body":"<p>I want to click my mouse whenever a certain condition holds true in a program, at specific  coordinates.\nPlease help me out, and please <em>answer</em> only in the <em>C language</em>..</p>\n\n<p>I prefer a direct function if possible..</p>\n"},{"tags":["c++","mfc","winapi","atl","wtl"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":493,"score":1,"question_id":2063553,"title":"ComboBoxEx32 (CComboBoxEx) keyboard behaviour","body":"<p>I have a WTL application that uses an extended combobox control (the Win32 class <code>ComboBoxEx32</code>) with the <code>CBS_DROPDOWNLIST</code> style.  It works well (I can have images against each item in the box) but the keyboard behaviour is different to a normal combobox - pressing a key will not jump to the first item in the combo that starts with that letter.</p>\n\n<p>For example, if I add the strings 'Arnold', 'Bob' and 'Charlie' to the combo, if I then select the combo and press 'B', then 'Bob' won't be selected.</p>\n\n<p>Does anyone know how to make this work?  Currently the only idea I can think of is to somehow subclass the 'actual' combobox (I can get the handle to this using the <code>CBEM_GETCOMBOCONTROL</code> message) and process <code>WM_CHARTOITEM</code>.  This is a PITA so I thought I'd ask if anyone else has come across this issue before.</p>\n"},{"tags":["c","winapi","c89","dwmapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12537082,"title":"Using WinAPI & DWMApi in ANSI C","body":"<p>I've got a question regarding writing applications for Windows. Can I use WinAPI and DWMApi (aero glass, ribbon, etc.) when programming in ANSI C? I'm looking at MSDN right now and they use c++.</p>\n"},{"tags":["c++","c","winapi","textbox"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":135,"score":0,"question_id":12537456,"title":"How to append text to a TextBox?","body":"<p>I think the following code should be self-explanatory.  </p>\n\n<pre><code>#include &lt;Windows.h&gt;\n\nstatic HWND textBoxInput;\nstatic HWND button;\nstatic HWND textBoxOutput;\n\nLRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam);\n\nint CALLBACK WinMain(HINSTANCE hInstance,HINSTANCE hPrevInstance,LPSTR cmdLine,int nCmdShow)\n{\n    HWND hMainWindow;\n    WNDCLASS wc = {};\n    wc.lpfnWndProc = WindowProc;\n    wc.lpszClassName = \"Main's window class\";\n    wc.hInstance = hInstance;\n    RegisterClass(&amp;wc);\n\n\n    hMainWindow = CreateWindow(wc.lpszClassName,\"Append text main window\",WS_OVERLAPPEDWINDOW,CW_USEDEFAULT,CW_USEDEFAULT,500,400,NULL,NULL,hInstance,NULL);\n\n    error=GetLastError();\n\n    if(hMainWindow == NULL) return 1;\n\n    textBoxInput = CreateWindowEx(WS_EX_CLIENTEDGE, \"Edit\", NULL,WS_CHILD | WS_VISIBLE | ES_AUTOHSCROLL, 10, 10, 300, 21, hMainWindow, NULL, NULL, NULL);\n\n    button = CreateWindowEx(WS_EX_CLIENTEDGE,\"Button\",\"Append\",WS_CHILD | WS_VISIBLE | ES_CENTER, 10, 41,75,30,hMainWindow,NULL,NULL,NULL); \n\n    textBoxOutput = CreateWindowEx(WS_EX_CLIENTEDGE,\"Edit\",TEXT(\"-&gt;This content is untouchable and unreadable!&lt;-\"),WS_CHILD | WS_VISIBLE | WS_VSCROLL | ES_AUTOVSCROLL |  ES_MULTILINE | ES_READONLY ,10,81,500,90,hMainWindow,NULL,NULL,NULL);\n\n\n    ShowWindow(hMainWindow,SW_SHOW);\n\n    MSG msg = { };\n\n    while (GetMessage(&amp;msg, NULL, 0, 0))\n    {\n        TranslateMessage(&amp;msg);\n        DispatchMessage(&amp;msg);\n    }\n\n    return 0;\n}\n\nLRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam)\n{\n    switch(uMsg)\n    {\n        case WM_COMMAND:\n        if((HWND)lParam == button)\n        {               \n            TCHAR* buffer = new TCHAR[150];\n\n            GetWindowText(textBoxInput,buffer,150);\n\n            SetWindowText(textBoxOutput,buffer);\n            //AppendWindowText(textBoxOutput,buffer,150) - I haven't found such function;           \n                    delete [] buffer;       \n        }\n        break;\n\n        case WM_PAINT:          \n            {\n            PAINTSTRUCT ps;\n            HDC hdc = BeginPaint(hwnd, &amp;ps);\n            HBRUSH pedzel;\n\n            pedzel = CreateSolidBrush(RGB(10,250,10));\n\n            FillRect(hdc, &amp;ps.rcPaint, pedzel);\n\n            EndPaint(hwnd, &amp;ps);\n            return 0;\n            }\n        case WM_DESTROY:\n            PostQuitMessage(0);\n            return 0;\n    }\n    return DefWindowProc(hwnd, uMsg, wParam, lParam);\n}\n</code></pre>\n\n<p>In brief: this program creates two textBoxes and a button that launches a process of  copying a content from the first to the second. The <code>SetWindowText</code> function causes cleaning the output box , what obviously isn't desired. </p>\n\n<p><strong>Update after the Jerry Cofinn's answer</strong></p>\n\n<pre><code>SendMessage(textBoxOutput,EM_SETSEL,-1,-1); //no difference between passing 0 or -1\nSendMessage(textBoxOutput,EM_REPLACESEL,TRUE,(LPARAM)buffer);\n</code></pre>\n\n<p>Surprisingly, it <strong>prepends</strong> the text. I've read <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb761661%28v=vs.85%29.aspx\" rel=\"nofollow\">the documentation</a> about EM_SETSEL and I'm still wondering why doesn't it place the raw input at the end.</p>\n"},{"tags":["c#","windows","security","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":855,"score":2,"question_id":254980,"title":"Help with CredEnumerate","body":"<p>As a follow-up to <a href=\"http://stackoverflow.com/questions/199518/how-to-programatically-add-mapped-network-passwords-winxp\">this</a> question I am hoping someone can help with the <a href=\"http://msdn.microsoft.com/en-us/library/aa374794(VS.85).aspx\" rel=\"nofollow\">CredEnumerate</a> API.  </p>\n\n<p>As I understand from the documentation the PCREDENTIALS out parameter is a \"pointer to an array of pointers to credentials\". I am able to successfully call the CredEnumerate API using C# but I am not sure of how to convert the PCREDENTIALS into something useful (like a list of credentials).</p>\n\n<p>Edit: Here's the code I am using:</p>\n\n<pre><code>        int count = 0;\n        IntPtr pCredentials = IntPtr.Zero;\n        bool ret = false;\n        ret = CredEnumerate(null, 0, out count, out pCredentials);\n        if (ret != false)\n        {\n            IntPtr[] credentials = new IntPtr[count];\n            IntPtr p = pCredentials;\n            for (int i = 0; i &lt; count; i++)\n            {\n                p = new IntPtr(p.ToInt32() + i);\n                credentials[i] = Marshal.ReadIntPtr(p);\n            }\n            List&lt;Credential&gt; creds = new List&lt;Credential&gt;(credentials.Length);\n            foreach (IntPtr ptr in credentials)\n            {\n                creds.Add((Credential)Marshal.PtrToStructure(ptr, typeof(Credential)));\n            }\n        }\n</code></pre>\n\n<p>Unfortunately, while this works for the first credential in the array—it gets generated and added to the list correctly—subsequent array items bomb at Marshal.PtrToStructure with the following error:</p>\n\n<p><em>Attempted to read or write protected memory. This is often an indication that other memory is corrupt.</em></p>\n\n<p>Any ideas? Anyone? Bueller?</p>\n"},{"tags":["c++","winapi"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12538131,"title":"C win32 applications","body":"<p>So, I have started C++ (I already know java) but now I'm ready for windowed applications. I'm guessing win32 is what I what to start with, but my problem is, where to start learning this or is win32 not what I want to use.</p>\n"},{"tags":["java","winapi","jni"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12531700,"title":"Win32 File Properties dialog not displaying in Java Swing app via JNI","body":"<p>I have a Java Swing application with a couple of pieces of native functionality added via JNI.  One thing this application does is show a tree view of the file system.  I was trying to write a little JNI so that, on Windows systems, I could provide a \"Properties...\" context menu item that displayed the standard file \"Properties\" dialog from Windows.</p>\n\n<p>I scraped the internet for the Win32 code needed to do this, and came up with this:</p>\n\n<pre><code>JNIEXPORT jboolean JNICALL Java_com_foobar_showFilePropertiesDialogImpl\n  (JNIEnv *env, jobject obj, jlong hwnd, jstring fileName)\n{\n    LPITEMIDLIST pidl;\n    LPCITEMIDLIST pidlItem;\n    HRESULT hr;\n    IShellFolder *pFolder;\n    IContextMenu *pContextMenu;\n    CMINVOKECOMMANDINFO cmi;\n    const wchar_t *pszFile;\n\n    if (!coInitialized)\n    {\n#ifdef DEBUG\n        MessageBoxW(NULL, L\"Initializing COM (should happen just once)...\", L\"Initializing COM...\", MB_OK);\n#endif\n        CoInitialize(NULL);\n        coInitialized = true;\n    }\n\n    /* Get the name of the file. */\n    pszFile = (wchar_t *)env-&gt;GetStringChars(fileName, NULL);\n    if (pszFile==NULL) { /* Exception occurred */\n        return JNI_FALSE;\n    }\n\n    hr = SHGetDesktopFolder(&amp;pFolder);\n    if (FAILED(hr))\n    {\n        env-&gt;ReleaseStringChars(fileName, (const jchar *)pszFile);\n        return JNI_FALSE;\n    }\n\n    hr = pFolder-&gt;ParseDisplayName(HWND_DESKTOP, NULL, (LPTSTR)pszFile, NULL, &amp;pidl, NULL);\n    pFolder-&gt;Release();\n    if (FAILED(hr))\n    {\n        env-&gt;ReleaseStringChars(fileName, (const jchar *)pszFile);\n        return JNI_FALSE;\n    }\n\n    hr = SHBindToParent(pidl, IID_IShellFolder, (void **)&amp;pFolder, &amp;pidlItem);\n    if (FAILED(hr))\n    {\n        SHFree(pidl);\n        env-&gt;ReleaseStringChars(fileName, (const jchar *)pszFile);\n        return JNI_FALSE;\n    }\n\n    hr = pFolder-&gt;GetUIObjectOf(HWND_DESKTOP, 1, (LPCITEMIDLIST *)&amp;pidlItem, IID_IContextMenu, NULL, (void **)&amp;pContextMenu);\n    pFolder-&gt;Release();\n    if(SUCCEEDED(hr))\n    {\n        ZeroMemory(&amp;cmi, sizeof(cmi));\n        cmi.cbSize = sizeof(cmi);\n        if (hwnd&gt;0)\n        {\n            cmi.hwnd = (HWND)hwnd;\n        }\n        cmi.lpVerb = \"properties\";\n        cmi.nShow = SW_SHOWNORMAL;\n        hr = pContextMenu-&gt;InvokeCommand(&amp;cmi);\n#ifdef DEBUG\n        if (FAILED(hr))\n        {\n            wchar_t msg[2048];\n            wsprintf(msg, L\"InvokeCommand failed: %d - %x\", SUCCEEDED(hr), hr);\n            MessageBoxW(NULL, pszFile, msg, MB_OK);\n        }\n        else\n        {\n            MessageBoxW(NULL, L\"InvokeCommand successful!\", L\"InvokeCommand Status\", MB_OK);\n        }\n#endif\n    }\n\n    pContextMenu-&gt;Release();\n    SHFree(pidl);\n    env-&gt;ReleaseStringChars(fileName, (const jchar *)pszFile);\n\n    return JNI_TRUE;\n}\n</code></pre>\n\n<p>From Java, I run this method from the EDT.  Unfortunately, the properties dialog doesn't display <em>if</em> DEBUG is not defined.  It seems that if I define DEBUG, the properties dialog will pop up after the \"InvokeCommand successful!\" MessageBox.</p>\n\n<p>Another thing I noticed is, when DEBUG is not defined, I call this method (and the properties dialog is not displayed), it <em>will</em> display later on in the application if I open a different \"native\" window.  For example, I have code that opens the native Delete dialog via SHFileOperation (which works); as soon as I display that dialog, any File properties dialogs that didn't originally display will suddenly appear.</p>\n\n<p>It seems as though I'm doing stuff on the wrong thread perhaps.  Is the EDT not the thread I want to display native windows from?  But I'm confused because again, the delete dialog is working fine.</p>\n"},{"tags":["c","winapi","shell","tray"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12533676,"title":"Shell_NotifyIcon() and an invisible window","body":"<p>I'd like to use Shell_NotifyIcon() to add an icon to the system tray but I do not want to have a visible window in my application. That's why I'm passing a handle to a message-only window to Shell_NotifyIcon(). The window has been created like that:</p>\n\n<pre><code>hTrayWnd = CreateWindowEx(0, CLASSNAME, \"tray_dummy\", 0, 0, 0, 0, 0, HWND_MESSAGE, NULL, HINSTANCE, NULL);\n</code></pre>\n\n<p>CLASSNAME points to the name of my class that I've registered using RegisterClassEx() and HINSTANCE is the handle of my instance. </p>\n\n<p>Now the problem is: The tray icon is added but the WindowProc() of my class is never called. If I use a normal top-level window instead, everything is working fine.</p>\n\n<p>Is there no way to create a tray icon without a top-level window? I've seen apps having a tray icon without a top level window so it must be possible somehow. But why does it not work with a HWND_MESSAGE window?</p>\n\n<p>Thanks!</p>\n"},{"tags":["windows","delphi","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":110,"score":0,"question_id":12513270,"title":"how to get handle of created mdi child?","body":"<p>Thansk!!\nI wish get the handle of mdi child in the clientWndProc, using WM_MDICREATE message</p>\n\n<pre><code>procedure TFrmMain.ClientWndProc(var Message: TMessage);\nvar\nHwnd : HWND;\nprocedure Default;\nbegin\n with Message do\n  Result := CallWindowProc(FClientWndProc, ClientHandle, Msg, wParam, lParam);\nend;\n\nbegin\ncase Message.Msg of\n  WM_MDICREATE:\n   begin\n    hwnd := Message.LParam; //dont' work\n    hwnd := TWMMDICreate(Message).MDICreateStruct^.lparam; //don't work\n   Default;\n   end;\n\n  end;\n\n  inherited ClientWndProc(Message);\n  end;\n</code></pre>\n\n<p>I want Bind the next proceddure (ChildProc) when started a MDICHILD, into the ClientWndProc Procedure of MainForm </p>\n\n<pre><code>    function childProc(hwnd: HWND;  msg, wParam,lParam: LongInt): LongInt; stdcall;\n    begin\n     if msg = WM_SYSCOMMAND then\n      begin\n       CallWindowProc(p,hwnd,msg,wparam,lparam);\n        if WParam = SC_MINIMIZE then\n          //do something\n       end;\n\n    result := CallWindowProc(p,hwnd,msg,wparam,lparam);\n\n    end;\n</code></pre>\n\n<p>I need the handle of new chid form ,Something like that</p>\n\n<pre><code>        P := Pointer(SetWindowLong(ActiveMDIChild.Handle, GWL_WNDPROC, integer(@Child)));\n</code></pre>\n"},{"tags":["c++","winapi","dll","process","loadlibrary"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":108,"score":1,"question_id":12530022,"title":"Load the same dll multiple times","body":"<p>I want to load the same dll e.g. Lib.dll multiple times! </p>\n\n<p>-> need creating a new process (CreateProcess function) for every LoadLibrary!</p>\n\n<p>Anyone have an example or some hints?!</p>\n\n<p>Thx and greets</p>\n"},{"tags":["winapi","kerberos","sspi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":11028798,"title":"How do I interpret the expiry returned by AcquireCredentialsHandle (Kerberos)?","body":"<p>The Windows SSPI call <code>AcquireCredentialsHandle</code> returns a time stamp indicating when the credentials handle will expire. The docs seem to be saying that the <code>TimeStamp</code> structure should have the same format as a <code>FILETIME</code> structure. However, when I use this function with the \"Kerberos\" package, the result makes no sense when treated as a <code>FILETIME</code>:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#define SECURITY_WIN32\n#include &lt;windows.h&gt;\n#include &lt;security.h&gt;\n\nint main() {\n\n  TimeStamp expiry;\n  int aquireCode;\n  CredHandle credHandle;\n  BOOL timeOk;\n  SYSTEMTIME sysTime;\n\n  aquireCode = AcquireCredentialsHandle(\n          NULL,\n          \"Kerberos\",\n          SECPKG_CRED_OUTBOUND,\n          NULL,\n          NULL,\n          NULL,\n          NULL,\n          &amp;credHandle,\n          &amp;expiry);\n\n  printf(\"result = %d\\n\", aquireCode);\n  printf(\"upper = %d (%X)\\n\", expiry.HighPart, expiry.HighPart);\n  printf(\"lower = %d (%X)\\n\", expiry.LowPart, expiry.LowPart);\n\n  timeOk = FileTimeToSystemTime((FILETIME*)&amp;expiry, &amp;sysTime);\n  printf(\"time covert ok = %d\\n\", timeOk);\n  printf(\"%4d/%02d/%02d %02d:%02d:%02d\\n\", sysTime.wYear, sysTime.wMonth, sysTime.wDay, sysTime.wHour, sysTime.wMinute, sysTime.wSecond);\n}\n</code></pre>\n\n<p>On my system, this prints:</p>\n\n<pre><code>result = 0\nupper = 2147483530 (7FFFFF8A)\nlower = -1488801793 (A742AFFF)\ntime covert ok = 1\n30828/09/13 12:48:05\n</code></pre>\n\n<p>If it's not a <code>FILETIME</code>, what is it?</p>\n"},{"tags":["c++","windows","winapi","resources"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12533207,"title":"FindResource can not file resource, however, LoadString can load it","body":"<p>I am trying to get string resource length with <code>FindResource</code>/<code>SizeofResource</code> functions. </p>\n\n<p>I make call like this:</p>\n\n<pre><code>HRSRC hResInfo = FindResource(hModule, MAKEINTRESOURCE(resourceId), RT_STRING);\n</code></pre>\n\n<p>I receive <code>NULL</code> and <code>GetLastError</code> returns <code>ERROR_RESOURCE_NAME_NOT_FOUND</code>.</p>\n\n<p>Now I use the same variables to make following call:</p>\n\n<pre><code>LoadString(hModule, resourceId, buffer, 4096)\n</code></pre>\n\n<p>And string is loaded successfully with the same <code>hModule</code> and <code>resourceId</code>. </p>\n\n<p>So, I can load string resource, but can not find it with <code>FindResource</code>. \nWhat may be the reason? How to find string resource with <code>FindResource</code> (and hence get its size)?</p>\n"},{"tags":["windows","winapi","boot"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12530345,"title":"Write program that runs during Windows boot - such as chkdsk?","body":"<p>Programs like ScanDisk/chkdsk can run while Windows is booting, i.e. before the logon screen appears. I thought this was only for Windows internal programs, but I have seen that Avast! antivirus offers the same feature, to perform virus checks while Windows is not yet loaded. How is this accomplished? I.e. what kind of APIs do I have to use to write such a program? Can it be any kind of commandline program, am I restricted to a subset of the Windows API, do I have to implement a specific interface?</p>\n"},{"tags":["winapi","boost-asio","handle"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":162,"score":3,"question_id":7602507,"title":"Using Boost's ASIO, how can I wait on a Windows Event?","body":"<p>My program needs to gracefully terminate when a Windows event becomes signaled. I am using Boost's ASIO library for it's sockets. I only have one <code>io_service</code> object. How can I 'register' this event handle with the <code>io_service</code>, so it calls a callback when the event signals?</p>\n"},{"tags":["c++","winapi","powershell"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":71,"score":0,"question_id":12529566,"title":"Retrieve all window opened on Windows","body":"<p>I try to retrieve some information(x,y,width,height and title) for all opened window on Windows with a simple C++ code(see below):</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;windows.h&gt;\nusing namespace std;\n\nBOOL CALLBACK EnumWindowsProc(HWND hwnd, LPARAM lParam);\n\nint WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, PSTR pCmdLine, int     iCmdShow)\n{\n    EnumWindows(EnumWindowsProc, NULL);\n    //system(\"PAUSE\");\n    return 0;\n}\n\nBOOL CALLBACK EnumWindowsProc(HWND hwnd, LPARAM lParam)\n{\nchar class_name[255];\nchar title[255];\nint tmpWidth;\nint tmpHeight;\nHWND currenthwnd;\nRECT WindowRect;\n\nGetClassName(hwnd,class_name, sizeof(class_name));\nGetWindowText(hwnd,title,sizeof(title));\nGetWindowRect(hwnd,&amp;WindowRect);\n\n//if(WindowRect.left&gt;-50 &amp;&amp; title != \"\" &amp;&amp; title != NULL &amp;&amp; strlen(title)&gt;0){\n    tmpHeight = WindowRect.bottom - WindowRect.top;\n    tmpWidth = WindowRect.right - WindowRect.left;\n    cout &lt;&lt;\"@@##@@\"&lt;&lt;title&lt;&lt;\",(@@#@@)\";\n    cout &lt;&lt;WindowRect.left&lt;&lt;\",(@@#@@)\";\n    cout &lt;&lt;WindowRect.top&lt;&lt;\",(@@#@@)\";\n    cout &lt;&lt;tmpWidth&lt;&lt;\",(@@#@@)\";\n    cout &lt;&lt;tmpHeight&lt;&lt;\",(@@#@@)\";\n    currenthwnd=GetForegroundWindow();\n    if (currenthwnd!=hwnd){\n       cout &lt;&lt;title&lt;&lt;\",(@@#@@)false\";\n    }else{\n       cout &lt;&lt;title&lt;&lt;\",(@@#@@)true\";\n    }\n //}\n\n return TRUE;\n}\n</code></pre>\n\n<p>But I encountered some issue with this code, I also try with PowerShell with Get-Process function, but this function doesn't return all opened windows but all existing process.</p>\n\n<p>How can I retrieve title, x,y, with, heigth of all opened window ?</p>\n\n<p>Thanks for your help</p>\n"},{"tags":["c#","c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":118,"score":0,"question_id":11886077,"title":"Mute specific audio inputs with Win MMDevice API","body":"<p>I have a very specific requirement where I need to mute the \"Auxiliary\" input.  I am already using the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd370784%28v=vs.85%29.aspx\" rel=\"nofollow\">Windows Core Audio APIs</a> like EndpointVolume &amp; MMDevice. </p>\n\n<h2>Scenario</h2>\n\n<p>I need to mute the auxiliary output volume here in order to achieve the desired effect. \nPictured below is the audio device and it's properties. </p>\n\n<p><img src=\"http://i.stack.imgur.com/dEkUW.png\" alt=\"Figure 1\" title=\"Figure 1\"></p>\n\n<h2>Issues</h2>\n\n<ul>\n<li><p>Using <code>MMDeviceEnumerator</code> it doesn't appear that the endpoint depicted above includes any of the \"output volume levels\" displayed in the second half of that screenshot.</p></li>\n<li><p>Muting the actual recording device (<em>Auxiliary</em>) does not actually mute what is heard. </p></li>\n<li>This must be as simple as possible with as little human interaction as possible. The environment will be controlled entirely via the application as it is a kiosk. The screenshots below indicates what I am referring to when I say <em>\"auxiliary recording device which when muted, does nothing\"</em>: </li>\n</ul>\n\n<p><img src=\"http://i.imgur.com/DEWjy.png\" alt=\"Figure 2\" title=\"Figure 2\"></p>\n\n<p>Is there a hidden place that the <a href=\"http://i.stack.imgur.com/dEkUW.png\" rel=\"nofollow\" title=\"see example\"><em>Levels</em> tab's</a> individual \"input output levels\" exist?  I cannot find it anywhere within MMDevice which means I am currently unable to mute this device through code. Thanks for reading.</p>\n"},{"tags":["c++","windows","delphi","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":140,"score":2,"question_id":12528228,"title":"window active caption color","body":"<p>How can I get caption color of active window in Windows 8 ???</p>\n\n<p>I tried to call GetSysColor(COLOR_ACTIVECAPTION) but it returns different color. It's strange because in Windows 7 it works right. Is there any other way how to get caption color of active window or color of taskbar ?</p>\n"},{"tags":["c++","windows","visual-studio-2010","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":155,"score":4,"question_id":12228321,"title":"Is there any way to force the WorkingSet of a process to be 1GB in C++?","body":"<p>If I use the following call in C++, I would expect the WorkingSet of the process to never drop below 100MB. </p>\n\n<p>However, the OS still trims the working set back to 16MB, even if I make this call.</p>\n\n<p>Setting WorkingSet to 100MB would lead to a dramatic increase in my application speed, by eliminating soft page page faults (see the diagram below).</p>\n\n<p>What am I doing wrong?</p>\n\n<pre><code>SIZE_T workingSetSizeMB = 100;\nint errorCode = SetProcessWorkingSetSizeEx(\n    GetCurrentProcess(),\n    (workingSetSizeMB - 1) * 1024 * 1024), // dwMinimumWorkingSetSize\n    workingSetSizeMB * 1024 * 1024,  // dwMaximumWorkingSetSize,\n    QUOTA_LIMITS_HARDWS_MIN_ENABLE | QUOTA_LIMITS_HARDWS_MAX_DISABLE\n  );\n// errorCode returns 1, so the call worked.\n</code></pre>\n\n<p><em>(extra for experts)</em> <strong>Experimental Methodology</strong></p>\n\n<p>I wrote a test C++ project to allocate 100MB of data to bring the WorkingSet over 100MB (as viewed within Process Explorer), then deallocated that memory. However, the OS trimed the WorkingSet back to 16MB as soon as I deallocated that memory. I can provide the test C++ project I used if you wish.</p>\n\n<p>Why is Windows providing a call to SetProcessWorkingSetSizeEx() if it doesn't appear to work? I must be doing something wrong.</p>\n\n<p>The diagram below shows the dramatic increase in the number of soft page faults (the red spikes) when the green line (the working set) dropped from 50MB to 30MB.</p>\n\n<p><img src=\"http://i.stack.imgur.com/AEyEh.png\" alt=\"Example showing the increase in soft page faults when the WorkingSet is reduced too low\"></p>\n\n<p><strong>Update</strong></p>\n\n<p>In the end, we ended up ignoring the problem, as it didn't impact performance that much.</p>\n\n<p>More importantly, SetProcessWorkingSetSizeEx does <em>not</em> control the current WorkingSet, and is <em>not</em> related in any way to soft page faults. All it does is prevent hard page faults, by preventing the current WorkingSet being paged out to the hard drive.</p>\n\n<p>In other words, if one wants to reduce soft page faults, SetProcessWorkingSetSizeEx has absolutely no effect, as it refers to hard page faults.</p>\n\n<p>There is a great writeup in \"Windows via C/C++\" (Richter) which how Windows deals with memory.</p>\n"},{"tags":["c#",".net","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12517740,"title":"How does one lookup the error number in Windows EventLogEntry Message","body":"<p>I am trying to read through the Windows Event log \"Error\" entry messages in  in c#.</p>\n\n<pre><code>  foreach (EventLogEntry log in eventLog.Entries)\n  {\n    if (log.EntryType.ToString() == \"Error\") \n    {\n        Console.WriteLine( log.Message);\n    }\n  }\n</code></pre>\n\n<p>The output is \"The XYZ service failed to start due to the following error: \\r\\n%%2\"</p>\n\n<p>while the entry I am looking for is</p>\n\n<p>\"The XYZ service failed to start due to the following error:\\r\\nThe system cannot find the file specified.\"</p>\n\n<p>How does one translate from the id to the appropriate error message ?</p>\n\n<p>Many thanks,\nKG</p>\n"},{"tags":["c++","qt","winapi","registry","windows-7-x64"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":66,"score":2,"question_id":12528099,"title":"Error with RegOpenKeyEx()","body":"<p>I'm using Qt with mingw to write a program that changes the registry, but when I call :</p>\n\n<pre><code>RegOpenKeyEx(HKEY_LOCAL_MACHINE,\n             \"SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\DefaultProductKey\",\n             0,\n             KEY_ALL_ACCESS|KEY_WOW64_64KEY,\n             &amp;key);\n</code></pre>\n\n<p>Qt return :</p>\n\n<pre><code>`KEY_WOW64_64KEY' undeclared (first use in this function)\n</code></pre>\n\n<p>I had add <code>\"#include &lt;windows.h&gt;\"</code> but it still doesn't work.</p>\n\n<p>I've find this post <a href=\"http://stackoverflow.com/questions/5247862/error-with-regopenkeyex?answertab=votes#tab-top\">Error with RegOpenKeyEx</a>, it's the same probleme than me, and the answer looks good.\nBut i'm not using windows xp i'm using 7(64bits).\nSo I trided to put in targetver.h :</p>\n\n<pre><code>#ifndef _WIN32_WINNT_WIN7\n#define _WIN32_WINNT_WIN7 (0x0601)\n#endif  /* _WIN32_WINNT_WIN7 */\n</code></pre>\n\n<p>And it's still doesn't work ... :(</p>\n\n<p>What can i do ? :(</p>\n\n<p>Thanks :)</p>\n\n<p>(sorry for my bad english)</p>\n"},{"tags":["c++","winapi","rtf"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12527086,"title":"How to set the background color of an RTF edit control","body":"<p>I thought it was simple but after 2 hours of googling and trying I am still at the same point.\nI am trying to set a custom background color using plain Win32 C++ for a RTF Edit control.</p>\n\n<p>Do you know how can I do this?</p>\n\n<p>Thanks and regards,</p>\n"},{"tags":["winapi","dll","loadlibrary","side-by-side"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":117,"score":0,"question_id":12514760,"title":"LoadLibrary fails with ERROR_SXS_CANT_GEN_ACTCTX (the dll depends on VS2005 CRT 8.0.50727.4053)","body":"<p>I have a third-party DLL that is built with Visual Studio 2005, which I use in a project that is built with Visual Studio 2008. This DLL depends on VS2005 CRT, version 8.0.50727.4053.</p>\n\n<p>On Windows 7 it works, but on Vista and XP LoadLibrary fails with a side by side error. The is from the Event Viewer:</p>\n\n<blockquote>\n  <p>Activation context generation failed for \"C:\\MyLibrary.dll\". Dependent\n  Assembly\n  Microsoft.VC80.CRT,processorArchitecture=\"x86\",publicKeyToken=\"1fc8b3b9a1e18e3b\",type=\"win32\",version=\"8.0.50727.4053\"\n  could not be found. Please use sxstrace.exe for detailed diagnosis.</p>\n</blockquote>\n\n<p>I've tried copying <code>msvcm80.dll</code>,<code>msvcp80.dll</code>,<code>msvcr80.dll</code> from <code>x86_microsoft.vc80.crt_1fc8b3b9a1e18e3b_8.0.50727.4053_none_d08d7da0442a985d</code> on my computer to the same directory as the DLL, but LoadLibrary still fails and the same error is in the Event Viewer.</p>\n\n<p>This is the output from sxstrace.exe:</p>\n\n<pre><code>=================\nBegin Activation Context Generation.\nInput Parameter:\n    Flags = 0\n    ProcessorArchitecture = x86\n    CultureFallBacks = en-US;en\n    ManifestPath = C:\\MyDir\\MyLibrary.dll\n    AssemblyDirectory = C:\\MyDir\\\n    Application Config File = \n-----------------\nINFO: Parsing Manifest File C:\\MyDir\\MyLibrary.dll.\n    INFO: Manifest Definition Identity is (null).\n    INFO: Reference: Microsoft.VC80.CRT,processorArchitecture=\"x86\",publicKeyToken=\"1fc8b3b9a1e18e3b\",type=\"win32\",version=\"8.0.50727.4053\"\nINFO: Resolving reference Microsoft.VC80.CRT,processorArchitecture=\"x86\",publicKeyToken=\"1fc8b3b9a1e18e3b\",type=\"win32\",version=\"8.0.50727.4053\".\n    INFO: Resolving reference for ProcessorArchitecture x86.\n        INFO: Resolving reference for culture Neutral.\n            INFO: Applying Binding Policy.\n                INFO: Find publisher policy at C:\\Windows\\WinSxS\\manifests\\x86_policy.8.0.microsoft.vc80.crt_1fc8b3b9a1e18e3b_8.0.50727.4016_none_5169e8e10f4ca52d.manifest\n                INFO: No binding policy redirect found.\n            INFO: Begin assembly probing.\n                INFO: Did not find the assembly in WinSxS.\n                INFO: Attempt to probe manifest at C:\\Windows\\assembly\\GAC_32\\Microsoft.VC80.CRT\\8.0.50727.4053__1fc8b3b9a1e18e3b\\Microsoft.VC80.CRT.DLL.\n                INFO: Attempt to probe manifest at C:\\MyDir\\Microsoft.VC80.CRT.DLL.\n                INFO: Attempt to probe manifest at C:\\MyDir\\Microsoft.VC80.CRT.MANIFEST.\n                INFO: Attempt to probe manifest at C:\\MyDir\\Microsoft.VC80.CRT\\Microsoft.VC80.CRT.DLL.\n                INFO: Attempt to probe manifest at C:\\MyDir\\Microsoft.VC80.CRT\\Microsoft.VC80.CRT.MANIFEST.\n                INFO: Did not find manifest for culture Neutral.\n            INFO: End assembly probing.\n    ERROR: Cannot resolve reference Microsoft.VC80.CRT,processorArchitecture=\"x86\",publicKeyToken=\"1fc8b3b9a1e18e3b\",type=\"win32\",version=\"8.0.50727.4053\".\nERROR: Activation Context generation failed.\nEnd Activation Context Generation.\n</code></pre>\n"},{"tags":["winapi","icons","gdi+","embedded-resource"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":97,"score":1,"question_id":12511853,"title":"Displaying Icons stored as resources with alpha using GDIPlus (WIn32 C++)","body":"<p>I have an icon with partial alpha (alpha values between 0 and 255) that I want to display using GDIPlus. When using the Bitmap constructor of GDI+ that takes the direct filename, the file displays properly. However, when loading from resource, it has a problem recognizing alpha. I looked on MSDN, and there are problems with alpha: <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms536318.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/ms536318.aspx</a>. By retrieving the ICONINFO structure from the Icon, I can get rid of the fully transparent pixels, however, the partially transparent pixels still appear either as fully opaque or fully transparent. </p>\n\n<p>I wanted to  know how to create a Win32 Bitmap from an Icon in resource with the partial alpha values.</p>\n"},{"tags":["c#","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":117,"score":3,"question_id":12472770,"title":"DeviceIoControl can't eject a non-empty CDROM drive?","body":"<p>I tried using <code>DeviceIoControl</code> function (Win32 API function) to eject my CDROM drive, it works perfectly when my CDROM drive has no disk, but after inserting a disk in it, the <code>Marshal.GetLastWin32Error()</code> returned 32 (<code>ERROR_SHARING_VIOLATION</code>: The process cannot access the file because it is being used by another process), the driveHandle passed in the <code>DeviceIoControl</code> is created by <code>CreateFile()</code> function.</p>\n\n<p>Could you please help me out? I like this way of manipulating the CD ROM related stuff, I can use winmm.dll to eject my CDROM but I think this way is worth to try.</p>\n\n<p>OK, here is the code:</p>\n\n<pre><code>using System;\nusing System.ComponentModel;\nusing System.Text;\nusing System.Windows.Forms;\nusing System.IO;\n\nusing System.Runtime.InteropServices;\n\nnamespace DVD_ejector\n{\n\n    public partial class Form1 : Form\n    {\n        const int OPENEXISTING = 3;\n        const int IOCTL_STORAGE_EJECT_MEDIA = 2967560;\n        const uint GENERICREAD = 0x80000000;\n        const int INVALID_HANDLE = -1;\n        public Form1()\n        {\n            InitializeComponent();\n            DriveInfo[] drs = DriveInfo.GetDrives();\n            List&lt;DriveInfo&gt; cdRoms = new List&lt;DriveInfo&gt;();\n            foreach (DriveInfo dInfo in drs)\n            {                \n                if (dInfo.DriveType == DriveType.CDRom)\n                {\n                    cdRoms.Add(dInfo);                    \n                }                                \n            }\n            comboBox1.DataSource = cdRoms;               \n            comboBox1.DisplayMember = \"Name\";\n\n            if (comboBox1.Items.Count &gt; 0) comboBox1.SelectedIndex = 0;\n            button1.Click += (sender, e) =&gt;\n            {\n                Eject(@\"\\\\.\\\" + ((DriveInfo)comboBox1.SelectedItem).Name[0]+\":\");\n            };\n        }\n        [DllImport(\"kernel32\", SetLastError=true)]\n        static extern IntPtr CreateFile(string fileName, uint desiredAccess, uint shareMode, IntPtr attributes,uint creationDisposition, uint flagsAndAttribute, IntPtr fileTemplate);\n        [DllImport(\"kernel32\")]\n        static extern int CloseHandle(IntPtr fileHandle);\n        [DllImport(\"kernel32\")]\n        static extern bool DeviceIoControl(IntPtr driveHandle, int ctrlCode, IntPtr inBuffer, int inBufferSize, IntPtr outBuffer, int outBufferSize, ref int bytesReturned, IntPtr overlapped);\n        int bytesReturned;\n        private void Eject(string cdDrive)\n        {\n            IntPtr driveHandle = CreateFile(cdDrive, GENERICREAD, 0, IntPtr.Zero, OPENEXISTING, 0, IntPtr.Zero);\n            try\n            {\n                if((int)driveHandle != INVALID_HANDLE) \n                   DeviceIoControl(driveHandle, IOCTL_STORAGE_EJECT_MEDIA, IntPtr.Zero, 0, IntPtr.Zero, 0, ref bytesReturned, IntPtr.Zero);\n            }\n            catch (Exception ex)\n            {\n                MessageBox.Show(ex.Message);\n            }\n            finally\n            {\n                CloseHandle(driveHandle); \n            }\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c++","windows","winapi","clipboard","ole"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12506217,"title":"Unexpected/weird results using OLE clipboard and classic clipboard, or do I miss something?","body":"<p>I'm trying to do the following trick:</p>\n\n<ol>\n<li>I have <code>IDataObject*</code> to be set into the clipboard, so I'm using <code>OleSetClipboard()</code> to set it into the clipboard.</li>\n<li>I have another <code>CLIPFORMAT</code> I want to add to the clipboard, but I can't do it with <code>OleSetClipboard()</code> because the <code>IDataObject*</code> I receive does not implement <code>SetData()</code> method. So, to overcome this limitation I <code>OpenClipboard()</code> with <code>GetClipboardOwner()</code>, this way, I can <code>SetClipboardData()</code> to the clipboard without <code>EmptyClipboard()</code> first.</li>\n</ol>\n\n<p>Now, it all works well, but what happens is that <code>OleGetClipboard()</code> does not return the data I placed in the clipboard using <code>SetClipboardData()</code>, but I can using <code>GetClipboardData()</code>.</p>\n\n<p>I can imagine why this happens (It just returns the <code>IDataObject*</code>), so I tried to <code>OleFlushClipboard()</code> to delete the <code>IDataObject*</code>, and <code>OleGetClipboard()</code> again to let the OS rebuild a new <code>IDataObject*</code>, and <strong>it still didn't contain</strong> the <code>CLIPFORMAT</code> added by <code>SetClipboardData()</code>.</p>\n\n<p>Does anyone have any idea how to overcome this issue? or a different trick? or even explain why it works this way? Thanks</p>\n"},{"tags":["c++","winapi","gdi","screensaver","doublebuffered"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":66,"score":3,"question_id":12504472,"title":"Can't seem to make double-buffered painting with multiple monitors","body":"<p>I'm trying to remake my Windows screensaver written with C++ and WinAPIs to work on multiple monitors. I found <a href=\"http://www.codeproject.com/Articles/7831/Dual-Multiple-Monitor-Support-in-Win32\" rel=\"nofollow\">this article</a> that gives the basics. But when I implement it in my own code, I get a weird result. Take a look at this code:</p>\n\n<pre><code>case WM_PAINT:\n{\n    PAINTSTRUCT ps = {0};\n    HDC hdcE = BeginPaint(hWnd, &amp;ps );\n\n    EnumDisplayMonitors(hdcE, NULL, MyPaintEnumProc, 0);\n\n    EndPaint(hWnd, &amp;ps);\n}\nbreak;\n\nBOOL CALLBACK MyPaintEnumProc(\n      HMONITOR hMonitor,  // handle to display monitor\n      HDC hdc1,     // handle to monitor DC\n      LPRECT lprcMonitor, // monitor intersection rectangle\n      LPARAM data       // data\n      )\n{\n    MONITORINFO mi = {0};\n    mi.cbSize = sizeof(mi);\n    if(GetMonitorInfo(hMonitor, &amp;mi))\n    {\n        //Is it a primary monitor?\n        BOOL bPrimary = mi.dwFlags &amp; MONITORINFOF_PRIMARY;\n\n        DoDrawing(bPrimary, hdc1, &amp;mi.rcMonitor);\n    }\n\n    return 1;\n}\n\nvoid DoDrawing(BOOL bPrimaryMonitor, HDC hDC, RECT* pRcMonitor)\n{\n//#define DIRECT_PAINT          //Comment out for double-buffering\n\n    int nMonitorW = abs(pRcMonitor-&gt;right - pRcMonitor-&gt;left);\n    int nMonitorH = abs(pRcMonitor-&gt;bottom - pRcMonitor-&gt;top);\n\n    HDC hMemDC = ::CreateCompatibleDC(hDC);\n    if(hMemDC)\n    {\n        HBITMAP hMemBmp = ::CreateCompatibleBitmap(hDC, nMonitorW, nMonitorH);\n        if(hMemBmp)\n        {\n            HBITMAP hOldBmp = (HBITMAP)SelectObject(hMemDC, hMemBmp);\n\n            COLORREF clr, clrBorder;\n            if(bPrimaryMonitor)\n            {\n                clr = RGB(0, 128, 0);           //Green\n                clrBorder = RGB(255, 0, 0);\n            }\n            else\n            {\n                clr = RGB(128, 0, 0);           //Red\n                clrBorder = RGB(0, 255, 0);\n\n            }\n\n            RECT rcRect;\n#ifndef DIRECT_PAINT\n            //With double-buffering\n            rcRect.left = 0;\n            rcRect.top = 0;\n            rcRect.right = nMonitorW;\n            rcRect.bottom = nMonitorH;\n#else\n            rcRect = *pRcMonitor;\n#endif\n\n            HBRUSH hBrush = ::CreateSolidBrush(clr);\n\n#ifndef DIRECT_PAINT\n            //With double-buffering\n            ::FillRect(hMemDC, &amp;rcRect, hBrush);\n#else\n            ::FillRect(hDC, &amp;rcRect, hBrush);\n#endif\n\n\n#ifndef DIRECT_PAINT\n            //With double-buffering\n            ::BitBlt(hDC, pRcMonitor-&gt;left, pRcMonitor-&gt;top, nMonitorW, nMonitorH, hMemDC, 0, 0, SRCCOPY);\n#endif\n\n//Debugging output\nCString _s;\n_s.Format(_T(\"%s\\n\")\n          _T(\"%s\\n\")\n          _T(\"hDC=0x%X\\n\")\n          _T(\"hMemDC=0x%X\\n\")\n        _T(\"RcMonitor: L=%d, T=%d, R=%d, B=%d\")\n          , \n          bPrimaryMonitor ? _T(\"Primary\") : _T(\"Secondary\"),\n#ifndef DIRECT_PAINT\n          _T(\"Double-buffering\"),\n#else\n          _T(\"Direct paint\"),\n#endif\n          hDC,\n          hMemDC,\n          pRcMonitor-&gt;left,\n          pRcMonitor-&gt;top,\n          pRcMonitor-&gt;right,\n          pRcMonitor-&gt;bottom);\n::DrawText(hDC, _s, _s.GetLength(), pRcMonitor, DT_NOCLIP | DT_NOPREFIX);\n\n\n            SelectObject(hMemDC, hOldBmp);\n            ::DeleteObject(hMemBmp);\n        }\n\n        ::DeleteDC(hMemDC);\n    }\n\n}\n</code></pre>\n\n<p>Painting always works on a primary monitor. But when I paint to the secondary monitor, I can only paint directly to its DC. When I use double-buffering technique (with DIRECT_PAINT pre-processor directive commented out) I only get a black screen on a secondary monitor when it should've been red.</p>\n\n<p>I'm attaching two screenshots here.</p>\n\n<p>First one with direct painting that works:\n<img src=\"http://i.stack.imgur.com/XOMHl.png\" alt=\"enter image description here\"></p>\n\n<p>And then the one with double-buffering that fails:\n<img src=\"http://i.stack.imgur.com/fQ46r.png\" alt=\"enter image description here\"></p>\n\n<p>Any ideas what am I doing wrong here?</p>\n"},{"tags":["c#",".net","wpf","winapi"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":124,"score":1,"question_id":10591171,"title":"Missing WM_Messages on WPF","body":"<p>I'm having problems to minimize/restore my wpf app by clicking on windows taskbar. Sometimes it works, sometimes it does not. So, <a href=\"http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/6b97a6de-0480-4339-8ed0-cb7cdb27bd83/\" rel=\"nofollow\">I added a hook</a> to app main window to try to see if events were coming or not. Sometimes they do, sometimes they do not. Then I use <a href=\"http://msdn.microsoft.com/en-us/library/aa264396%28v=vs.60%29.aspx\" rel=\"nofollow\">Spy++</a> to see if events were at least launched... Yes! They are. So why am I receiving just some of them?</p>\n\n<pre><code>public MyMainWindow()\n{\n    InitializeComponent();\n    this.SourceInitialized += new EventHandler(OnSourceInitialized);\n}\n\nvoid OnSourceInitialized(object sender, EventArgs e)\n{\n    HwndSource source = (HwndSource)PresentationSource.FromVisual(this);\n    source.AddHook(new HwndSourceHook(HandleMessages));\n}\n\nprivate IntPtr HandleMessages(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)\n{\n    switch (msg) {\n        case  0x0112://WM_SYSCOMMAND:\n            switch ((int)wParam &amp; 0xFFF0) {\n                case  0xF020://SC_MINIMIZE:\n                    break;\n                case  0xF120://SC_RESTORE:\n                    break;\n            }\n            break;\n    }\n}\n</code></pre>\n\n<p>I have <a href=\"http://sudhirdotnet.wordpress.com/2011/09/27/wpf-adding-a-custom-main-method-in-wpf-application-2/\" rel=\"nofollow\">a custom main</a> and I'm using <a href=\"http://caliburnmicro.codeplex.com/wikipage?title=Customizing%20The%20Bootstrapper&amp;referringTitle=Documentation\" rel=\"nofollow\">Caliburn Micro with customized Bootstrapper</a>.</p>\n\n<hr>\n\n<p>I think I made a simplified case where this problem can be seen (not sure about this been same source of my problem). I used a Timer to emulate been waiting for async socket/activeX response. As is possible to see, clicking over taskbar, sometimes window will not be maximized/minimized.</p>\n\n<p>Still don't know how to solve it.</p>\n\n<pre><code>using System;\nusing System.Threading;\nusing System.Windows;\nusing System.Windows.Threading;\nusing Timer = System.Timers.Timer;\n\n\nnamespace Garbage\n{\n/// &lt;summary&gt;\n/// Interaction logic for MainWindow.xaml\n/// &lt;/summary&gt;\npublic partial class MainWindow : Window\n{\n    public MainWindow()\n    {\n        InitializeComponent();\n\n        var dispatcherTimer = new DispatcherTimer { Interval = new TimeSpan(0,0,0,0,10) };\n        dispatcherTimer.Tick += (o, e) =&gt;\n                                    {\n                                        var waintingForSocketAsyncRenponseEmulation = new Timer(10);\n\n                                        waintingForSocketAsyncRenponseEmulation.Elapsed += delegate\n                                                            {\n                                                                lock (this)\n                                                                {\n                                                                    Monitor.Pulse(this);\n                                                                }\n                                                            };\n\n                                        waintingForSocketAsyncRenponseEmulation.Start();\n\n                                        lock (this)\n                                        {\n                                            Monitor.Wait(this);\n                                        }\n                                    };\n        dispatcherTimer.Start();\n    }\n}\n</code></pre>\n\n<p>}</p>\n"},{"tags":["c#","winapi","keyboard"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12518443,"title":"How to make virtual key up after sending key combination in c# using WinAPI","body":"<p>I've got the strange issue with sending key combination using winapi in c#.\nMy goal is to create a method for sending two keys, f.e. SHIFT + HOME:</p>\n\n<pre><code> private const int WM_KEYDOWN = 0x0100;\n private const int WM_KEYUP = 0x0101;\n\n [DllImport(\"user32.dll\")]\n static extern void keybd_event(byte bVk, byte bScan, uint dwFlags, UIntPtr dwExtraInfo);\n\n public static void SendKey(byte key1, byte key2)\n {\n      //SHIFT down\n      keybd_event(key1, 0, WM_KEYDOWN, UIntPtr.Zero);\n      //press HOME\n      keybd_event(key2, 0, WM_KEYDOWN, UIntPtr.Zero);\n      keybd_event(key2, 0, WM_KEYUP, UIntPtr.Zero);\n      //SHIFT up\n      keybd_event(key1, 0, WM_KEYUP, UIntPtr.Zero);\n }\n</code></pre>\n\n<p>The issue is that key1 (SHIFT) is still pressed after the method finishes execution. In other words the additional method call will start with pressed SHIFT from the previous run.\nIt looks extremely simple but I can't find the solution to make it working. I've looked at lots of related SO questions and tried them but the issue is still actual. Any help is appreciated.</p>\n"},{"tags":["winapi","networking"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12517610,"title":"Get Process Network Usage","body":"<p>I know from previous questions asked that it is possible using Microsoft NM API, or the different Pocket Capturing frameworks (PCap, etc.), but Sysinternals's ProcessExplorer tool shows this information without using the NM API or any other external utility.  </p>\n\n<p>Are there any WIN API that allows me to get process network usage information?</p>\n"},{"tags":["c","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12517176,"title":"GUI application with C (no c++)","body":"<p>I need to write a application with C (and C only,nothing else).It is most probably going to be a simple breakout game.How do I go on with it?Should I learn win32 api before? or is there an easier way? will it be easier as a console application?Please guide me. </p>\n"},{"tags":["security","winapi","windows-8","shellexecute"],"answer_count":0,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":332,"score":3,"question_id":12054548,"title":"ShellExecute fails if run from elevated process and non-default browser set in Windows 8 RTM","body":"<p>Set non-default browser in Windows 8 RTM (Chrome, Firefox) and try to run code like this:</p>\n\n<p><code>ShellExecute(NULL, \"open\", \"http://stackoverflow.com\", NULL, NULL, SW_SHOWNORMAL);</code></p>\n\n<p>It's ok.\nBut then change manifest to require Administrative priveleges or just \"run as administrator\".</p>\n\n<p>Code won't work.</p>\n\n<p>Ok, then try to run <strong>any</strong> application using \"run as administrator\".</p>\n\n<p>You will see the same result, links are not working.</p>\n\n<p>Change default browser back to IE -> all works fine.</p>\n\n<p>In Windows 8 previous builds there is no such behavour.</p>\n\n<p><em><strong>What is going on?</em></strong></p>\n\n<p>PS. It seems Microsoft experienced the same problems in their own software :) \n<a href=\"http://stackoverflow.com/questions/12029733/visual-studio-2012-web-publish-on-windows-8-rtm-fails-browser-launch\">Visual Studio 2012 Web Publish on Windows 8 RTM Fails Browser Launch</a></p>\n"},{"tags":["windows","winapi","serial-port","iocp","io-completion-ports"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":614,"score":1,"question_id":8885748,"title":"CloseHandle() returns before the serial port is actually closed","body":"<p>I'm pulling my hair trying to figure out when a serial port finishes closing so I can reopen it. It turns out that <code>CloseHandle()</code> returns before the port is actually unlocked.</p>\n\n<p>I am opening a serial port using <code>CreateFile(FILE_FLAG_OVERLAPPED)</code>, associating it with a CompletionPort using <code>CreateIoCompletionPort()</code>, reading/writing to it using <code>ReadFile()</code>, <code>WriteFile()</code> and closing it using <code>CloseHandle()</code>.</p>\n\n<p>I've noticed that if I close and reopen a serial port quickly enough, I get an <code>ERROR_ACCESS_DENIED</code> back from <code>CreateFile()</code>. This is happening in spite of the fact that I'm waiting for <code>CloseHandle()</code> to return, then waiting for all outstanding read/write operations associated with that handle to come back from the completion port. Surely there is a better way :)</p>\n\n<p><strong>How do I close a serial port synchronously?</strong> Please no retry loops, sleep() or some other cheap hacks.</p>\n\n<p><strong>EDIT</strong>: Maybe this has something to do with my use of completion ports and FILE_FLAG_OVERLAPPED. I get a callback when the read/write operations complete. Is there some sort of callback for the port closing?</p>\n"},{"tags":["c#","winapi","windows-mobile"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12488965,"title":"WaveIn API fails on mobile platform during work","body":"<p>I am capturing real time audio on a Pocket PC device in C#/.NET, using a\nWaveIn P/Invoke example. I am recycling the <code>WAVEHDR</code>\nbuffers by doing a <code>waveInUnprepareHeader</code>, <code>waveInPrepareHeader</code>,\n<code>waveInAddBuffer</code> sequence. This all works fine for about 2 - 60 seconds, but after, <code>waveInUnprepareHeader</code>, <code>waveInPrepareHeader</code>, and <code>waveInAddBuffer</code> (all of them) returns an <code>INVALPARAM</code> error and audio input ceases.</p>\n\n<p>How can i avoid this bug and solve the problem?</p>\n"},{"tags":["windows","winapi","page-fault"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":38,"score":3,"question_id":12513488,"title":"Get Process Total Page Faults","body":"<p>Both Task Manager and SysInternals Process Explorer show the total amount of a process's page-fault, but all Performance Counters and WMI objects I found show only Page-Faults per second,</p>\n\n<p>Is there a different API or some obscure performance counter that does show the total amount of Page-Faults for a certain process? (on Windows)</p>\n"},{"tags":["c#","winapi","file-system","ntfs-mft"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":138,"score":0,"question_id":8832192,"title":"Incorrect Function error while enumerating MFT","body":"<p>I have a C# application which enumerates USN data to get MFT records for getting a list of files on a volume. It uses the <code>DeviceIoControl()</code> function with various control codes to achieve the same.</p>\n\n<p>It works on almost all of the machines so far except one where it fails by raising a Win32 exception <strong>\"Incorrect Function while calling DeviceIoControl with control code FSCTL_ENUM_USN_DATA\"</strong>. This error translates to win32 error code 1, <code>ERROR_INVALID_FUNCTION</code>. As per MSDN documentation for this control code, the file system on the specified volume does not support this control code.</p>\n\n<p>However the change journal exists on this volume and controls codes like <code>FSCTL_CREATE_USN_JOURNAL</code> or <code>FSCTL_QUERY_USN_JOURNAL</code> do not raise any such errors. Is it somehow possible to make file system accept this control code by updating the device driver or anything?</p>\n\n<p>Any help would be greatly appreciated.</p>\n"},{"tags":["winapi","vb6","vb6-migration"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":58,"score":3,"question_id":12513138,"title":"What is the Use of user32.dll in VB Application?","body":"<p>In our we have used the user32.dll and passing the value of hWnd.So I would like to know what is the use of this User32.dll and passing the value hWnd?</p>\n\n<p>They are setting this Values </p>\n\n<pre><code>SetProp hwnd, \"PrevWndProc\", SetWindowLong(hwnd, GWL_WNDPROC, AddressOf WindowProc)\n</code></pre>\n"},{"tags":["c++","winapi","api","3d","nvidia"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2530,"score":0,"question_id":1120721,"title":"Where to find API documentation for NVIDIA 3D Vision?","body":"<p>I'd like to start coding for NVIDIA 3D Vision and wonder where can I find the documentation for it?</p>\n"},{"tags":["c++","windows","winapi","windows-shell"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":12470766,"title":"Win32 - determine if path has jumbo icon available","body":"<p>I have some code to get jumbo icons from a file:</p>\n\n<pre><code>// Get the image list index of the icon\nSHFILEINFO sfi;\nif (!SHGetFileInfo(pszPath, 0, &amp;sfi, sizeof(sfi), SHGFI_SYSICONINDEX)) return NULL;\n\n// Get the jumbo image list\nIImageList *piml;\nif (FAILED(SHGetImageList(SHIL_JUMBO, IID_PPV_ARGS(&amp;piml)))) return NULL;\n\n// Extract an icon\nHICON hico;\npiml-&gt;GetIcon(sfi.iIcon, ILD_SCALE|ILD_TRANSPARENT, &amp;hico);\n</code></pre>\n\n<p>Now, the problem is, if the path doesn't have a <em>256x256</em> icon associated with it, I don't want the icon returned by the <em>ImageList</em>.  (It will helpfully take the 32x32 and put it in a 256x256 icon, which I cannot use).</p>\n\n<p>So, is there a way to find out, if the icon that is (would be) associated with a path has a jumbo icon for it, or is indeed just going to be a scaled 32x32?  If not, I'll just get the regular system icon.</p>\n\n<h2>NOTE:</h2>\n\n<p>Final solution inspired by Jonathan below:</p>\n\n<pre><code>HBITMAP hbitmapForFile(LPCWSTR path, int w, int h)\n{\n    IShellItemImageFactory *pif;    \n    HBITMAP hbm;\n\n    SIZE sz = { w, h };\n    SHCreateItemFromParsingName(path, NULL, IID_PPV_ARGS(&amp;pif));\n    pif-&gt;GetImage(sz, SIIGBF_RESIZETOFIT, &amp;hbm);\n    pif-&gt;Release();\n    return hbm;\n}\n</code></pre>\n\n<p>I took the resulting <code>HBITMAP</code> and put it into a <em>STATIC</em> control with <code>SS_BITMAP</code>.</p>\n\n<p>One important thing I learned:  You <em>cannot</em> use the <code>IShellItemImageFactory</code> from within a <em>HookProc</em>.  Known Windows limitation; I had to <code>PostMessage</code> to the window and then use it.</p>\n"},{"tags":["c","windows","winapi","unicode"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":73,"score":-1,"question_id":12508100,"title":"SHELLEXECUTEINFO UNICODE support?","body":"<p>I used <code>ShellExecuteEx()</code> to call an executable file. And the following are the parameters I set for <code>SHELLEXECUTEINFO</code> structure.</p>\n\n<pre><code>SHELLEXECUTEINFO ShExecInfo = {0};\nShExecInfo.cbSize = sizeof(SHELLEXECUTEINFO);\nShExecInfo.fMask = SEE_MASK_NOCLOSEPROCESS|SEE_MASK_UNICODE;// Set Unicode Flag\nShExecInfo.hwnd = NULL;\nShExecInfo.lpVerb = NULL;\nShExecInfo.lpParameters = TEXT (\"/s\");\nShExecInfo.lpDirectory = NULL;\nShExecInfo.nShow = SW_SHOWNORMAL;\nShExecInfo.hInstApp = NULL;\nShExecInfo.lpFile = TEXT ( \".\\\\bin\\\\x86\\\\installerx86.exe\" ); \n</code></pre>\n\n<p>The <code>ShExecInfo.fMask</code> is set for Unicode, but the <code>ShExecInfo.lpFile</code> is not prepended with <code>\"\\\\?\\\"</code>. \nIn this case, is my code compatible with Unicode?</p>\n"},{"tags":["winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":28,"score":2,"question_id":12508485,"title":"WIN API To Check For Window Responsiveness","body":"<p>Is there a WINAPI to check if a certain window is \"Not Responsive\"? or get its responsiveness level?</p>\n"},{"tags":["c++","multithreading","winapi","thread-state"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":376,"score":2,"question_id":8185437,"title":"How to determine that a win32 thread is either in Wait or Join or Sleep state in c++","body":"<p>What I actually search for is c++/win32 equivalent for .net <a href=\"http://msdn.microsoft.com/en-us/library/system.threading.threadstate.aspx\" rel=\"nofollow\">ThreadState Enumeration</a>.</p>\n\n<p>Any suggestions?</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":3,"view_count":126,"score":-1,"question_id":12491182,"title":"How to send user data using SendMessage function?","body":"<p>How to send struct or pointer using SendMessage or PostMessage function?</p>\n"},{"tags":["c++","winapi","memory","profiler"],"answer_count":13,"favorite_count":9,"up_vote_count":15,"down_vote_count":0,"view_count":10232,"score":15,"question_id":818673,"title":"memory profiler for c++","body":"<p>Im trying to find a tool that can help me find out where my memory is allocated in a certain stage of my program. Most memory profilers cant do this and just tell you if memory is leaked or not.</p>\n\n<p>Does any one know of a tool that can do this?</p>\n\n<p>Edit:</p>\n\n<p>OS: Win32</p>\n\n<p>Visual studio 2005</p>\n"},{"tags":["multithreading","winapi","timer"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":12489234,"title":"Wait for a specific time in thread, use WaitForSingleObject?","body":"<p>I need to wait some time in one of my threads, I started to think about <code>WaitForSingleObject</code> but it needs handles to wait on, although it can take a timeout input; </p>\n\n<p>Another resolution may use <code>SetTimer</code> but it seems that it will create <code>WM_TIMER</code> message but I don't have change to catch that message since I am in a thread, so is there something I can use here ? can I use <code>Sleep</code>?</p>\n"},{"tags":["windows","winapi","sockets","tcp","port"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12500576,"title":"Enumerate open ports in same process","body":"<p>Is there any way in Windows for a process to enumerate all the open ports/sockets it is using?  I'm trying to track down some high port usage in my app, but my app uses very few, so it must be some other DLL getting loaded into the process.</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":12500093,"title":"Can't create popup Menu","body":"<p>I`m trying to create a menu programmatically but the code below fails to create the popup menu in the second menu item (neighbor of file)(in first File->new etc. everything is fine).\nWhen I click on View it does nothing instead of show SelectAll command.</p>\n\n<pre><code>HMENU menu = CreateMenu();\nHMENU subMenu1 = CreatePopupMenu();\n\nAppendMenu(subMenu1,MF_STRING,IDC_MENU_NEW,_T(\"New\"));\nAppendMenu(subMenu1,MF_STRING,IDC_MENU_EXIT,_T(\"Exit\"));\n\nAppendMenu(menu,MF_POPUP,(UINT_PTR)subMenu1,_T(\"File\"));\n\nSetMenu(dlg,menu);\nHMENU menu2 = CreateMenu(); \nHMENU subMenu2 = CreatePopupMenu();\n\nAppendMenu(menu,MF_INSERT,(UINT_PTR)menu2,_T(\"View\"));\nAppendMenu(subMenu2,MF_STRING,IDC_MENU_EXIT2,_T(\"Select All\"));\n\nAppendMenu(menu2,MF_POPUP,(UINT_PTR)subMenu2,_T(\"View\"));\n</code></pre>\n\n<p>What am I doing wrong?  Can you point me to somewhere to find the information?</p>\n"},{"tags":["python","windows","winapi","network-programming"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":192,"score":3,"question_id":12499523,"title":"Using sys.stdin in select.select on Windows","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10842428/can-select-be-used-with-files-in-python-under-windows\">Can select() be used with files in Python under Windows?</a>  </p>\n</blockquote>\n\n\n\n<p>On UNIX I am able to pass <code>sys.stdin</code> to <code>select.select</code> in Python. I am attempting to do this on Windows, but <code>select.select</code> in Python on Windows will not allow it.</p>\n\n<p>To more accurately describe what I am doing see <a href=\"https://github.com/eldarion/gondor-client/blob/ccbbf9d4b61ecbc2f66f510b993eb5fba0d81c09/gondor/run.py\" rel=\"nofollow\">https://github.com/eldarion/gondor-client/blob/ccbbf9d4b61ecbc2f66f510b993eb5fba0d81c09/gondor/run.py</a>.</p>\n\n<p>The <code>unix_run_poll</code> function is what I am trying to accomplish on Windows. The basic idea is that I have a socket connection to a server which has hooked up streaming stdin, stdout, stderr to a process running remotely and I am interacting with it from the local client and making it appear as if the local client is running the process.</p>\n\n<p>The <code>win32_run_poll</code> is my attempt at porting it to Windows and it does work, sort of. It is a little wonky and the approach, IMO, is very bad.</p>\n\n<p>Does anyone have suggestions on how this can be improved? The dependency on win32api is less than ideal, but I am okay with keeping it.</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":4364,"score":3,"question_id":1126730,"title":"How to find the width of a String (in pixels) in WIN32","body":"<p>Can you measure the width of a string more exactly in WIN32 than using the GetTextMetrics function and using tmAveCharWidth*strSize?</p>\n"},{"tags":["c++","winapi","embarcadero","c++builder-xe"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12498507,"title":"Is there a way to create a shared directory/folder using WINAPI or Embarcadero C++ Builder XE?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1011520/windows-folder-share-api\">Windows Folder Share API</a>  </p>\n</blockquote>\n\n\n\n<p>I need my C++ application to occasionally create shared directories. I am using Embarcadero C++ Builder XE which has only the <code>CreateDir()</code> function which has no way to specify shared access. Is there anything within the Embarcadero C++ Builder environment that will allow me to do this simply, or failing that is there a simple way to do this directly using the Windows API ? I have taken a look at the msdn pages for something that will allow me to do this but I have yet to find anything documented in a clear way.</p>\n\n<p><strong>EDIT</strong> Specifically the folder and its contents need to be accessible to all other machines on the network.</p>\n"},{"tags":["c++","winapi","shared-memory"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":169,"score":0,"question_id":12498553,"title":"CreateFileMapping and OpenFileMapping not cooperating in different processes","body":"<p>I'm trying to use CreateFileMapping and OpenFileMapping to share memory between processes. This isn't working as I want it to - OpenFileMapping returns null and GetLastError is 5 - access denied. Any ideas what I am doing wrong? Name is something like MemoryTest.</p>\n\n<p>Edit:</p>\n\n<p>using CreateFileMapping both times I can read the data written in the other process. The reason this is a problem is that I get Error 183 - memory area already exists. However, it still returns a handle to the existing memory.</p>\n\n<pre><code>var map_handle = CreateFileMapping(INVALID_HANDLE_VALUE, NULL, PAGE_READWRITE, 0, sizeof(int), name.c_str());\n\n....\n\nvar handle = MapViewOfFile(map_handle, FILE_MAP_ALL_ACCESS , 0, 0, 0)\n\n*handle = 10;\n\nUnMapViewOfFile(map_handle);\n\ngetchar();\n</code></pre>\n\n<p>Other process:</p>\n\n<pre><code>var map_handle = OpenFileMapping(PAGE_READWRITE, false, name.c_str())\n\n....\n\nvar handle = MapViewOfFile(map_handle, FILE_MAP_ALL_ACCESS , 0, 0, 0) //returns null\n\nvar out = *handle;\n\ngetchar();\n</code></pre>\n\n<p>This works for the second process though:</p>\n\n<pre><code>var map_handle = CreateFileMapping(INVALID_HANDLE_VALUE, NULL, PAGE_READWRITE, 0, sizeof(int), name.c_str());\n\n....\n\nvar handle = MapViewOfFile(map_handle, FILE_MAP_ALL_ACCESS , 0, 0, 0) //returns null\n\nvar out = *handle;\n\ngetchar();\n</code></pre>\n"},{"tags":["c++","multithreading","winapi","class"],"answer_count":2,"favorite_count":0,"up_vote_count":10,"down_vote_count":0,"view_count":6105,"score":10,"question_id":1372967,"title":"How do you use CreateThread for functions which are class members?","body":"<p>How do you use <code>CreateThread()</code> to create threads of functions which are class members?</p>\n"},{"tags":["vb.net","winapi","robocopy"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12468153,"title":"Using Robocopy in vb.net app Win32 error","body":"<p>I am developing an application in vb.net that needs to use Robocopy to copy directories and all contents within the directories to a specified directory. Robocopy must be used because unlike drag and drop, it preserves the date modified and other properties of the files and folders it moves. I am using the following code to initiate this but I am getting an error </p>\n\n<blockquote>\n  <p>Win32 ExceptionUnhandled, Could not find the specified file.</p>\n</blockquote>\n\n<p>I have done my research and this seems to be the most efficient way to call Robocopy... any help would be GREATLY appreciated.</p>\n\n<pre><code>Imports System\nImports System.IO\nImports System.Diagnostics\nImports System.Threading\nImports System.Windows.Forms\n\n\nPublic Class Form1\n\n    Private Sub Form1_Load(sender As System.Object, e As System.EventArgs) Handles         MyBase.Load\n\n    End Sub\n\n    Private Sub Button2_Click(sender As System.Object, e As System.EventArgs) Handles Button2.Click\n        Dim srcFold As String = TextBox1.Text\n        Dim destFold As String = TextBox2.Text\n\n        'Dim oProcess As New ProcessStartInfo\n        'oProcess.FileName = \"C:\\windows\\SysWow64\\robocopy.exe\"\n        'oProcess.Arguments = \"C:\\upsdnc\\11111\\\" &amp; \"C:\\ups\\11111_dnc\" &amp; \"/E /Z /dcopy:T /fft /R:10 /ETA /log:C:\\copy.log /tee\"\n\n       System.Diagnostics.Process.Start(\"C:\\Windows\\SysWow64\\Robocopy.exe C:\\upsdnc\\11111 C:\\ups\\11111_dnc /E /Z /dcopy:T /fft /R:10 /ETA /log:C:\\copy.log /tee\")\n\n\n    End Sub\n</code></pre>\n\n<p>As you can see I also attempted using ProcessStartInfo but I am told Process.Start is much simpler.</p>\n\n<p>Also, to use Robocopy, the format is \"Source folder\" \"Destination Folder\" followed by options as you can see in the above code</p>\n"},{"tags":["windows","winapi","ssl","ssl-certificate","wininet"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12492040,"title":"Wininet - How to download and verify SSL certificate","body":"<p>I want to download and verify certificate just like Internet Explorer, i tried to monitor IE API calls to see how its doing it all.\nFirst of all i don't see which wininet function is downloading the SSL certificate and secondly there are many calls to crypt32.dll functions.</p>\n\n<p>Someone can tell me which functions request the certificate or the certificate data needed to verify the certificate.\nI want to understand the methodology and to implement exactly the same behavior in my application.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c","windows","api","winapi","createwindow"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12491277,"title":"Windows create window API","body":"<p>I am new to Windows programming. On Windows OS, almost every application opens a window, and I want to know that if all these applications invoke the same API <code>CreateWindow()</code> to create their windows?</p>\n\n<p>Or, another way to ask my question: Do Games, Music Players, Browsers, Instant Messaging, IDEs, etc create their window all by invoking API <code>CreateWindow()</code>? If not, what other APIs can be used to create a windows on Windows?</p>\n"},{"tags":["java","linux","winapi","jni","hook"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":98,"score":3,"question_id":12481769,"title":"Disable running a program in Linux and Windows","body":"<p>I am building a Computer Adaptive Test in Java[Swing] and want to disable running other programs in the background until the test finishes(or the user quits). This is to prevent candidates taking the test from cheating in the test. </p>\n\n<p>My question is, how to go about it? How can I stop creation of new task or prevention of user from interacting with other programs?</p>\n\n<p>My homework before asking this question was: \n1. I could use JNI and call SetForegroundWindow(HWND) function on windows. What are its equivalents in Linux?</p>\n\n<ol>\n<li>Disable Keyboard completely using SetWindowsHookEx() function with a global LOWLEVEL KEYBOARD HOOK PROC. Equivalents in Linux?</li>\n</ol>\n\n<p>Apologies if this question has been answered before -- </p>\n"},{"tags":["c++","c","windows","winapi","operating-system"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":200,"score":0,"question_id":12471024,"title":"Win32: Passing lParam to CreateWindow and keeping track of open windows","body":"<p>To start, here is the description from the document I was given.\nNOTE:  all I had to do was change existing code to meet these requirements</p>\n\n<p>Change the code to create 4 windows organized as shown in the demo.\nWhen the user closes a window, if there are other windows still open\nit does NOT kill the program. The user must close ALL of them to stop program,</p>\n\n<p>You will need to keep track of the number of windows opened (and subtract\nwhen they are closed). NO GLOBALS ALLOWED. NO STATICS ALLOWED.</p>\n\n<p>In addition your program must initialize the count using the lParam and CREATESTRUCT.</p>\n\n<pre><code>Possible functions and structs:\n\nSetWindowLong()\nGetWindowLong()\nSetClassLong()\nGetClassLong()\nCREATESTRUCT\n</code></pre>\n\n<p>Ok now, here is what I ended with.  I could open the 4 required windows, and had it so closing one window (sending the WM_DESTROY Message) did not end the entire program.  What I am confused about is the passing of an lParam and using the CREATESTRUCT.</p>\n\n<p>Here is my wndproc.c:</p>\n\n<pre><code> LRESULT CALLBACK HelloWndProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam){\n    HDC     hdc;\n    PAINTSTRUCT ps;\n    RECT    rect;\n    int number = GetClassLongPtr(hwnd, 0);\n\n    switch (message){\n        case WM_CREATE:\n            if(number == 0){\n                SetClassLongPtr(hwnd, 0, (LONG)((CREATESTRUCT*)lParam)-&gt;lpCreateParams);\n            }\n            number++;\n            return 0;\n\n        case WM_PAINT:\n            hdc = BeginPaint(hwnd, &amp;ps);\n\n            GetClientRect(hwnd, &amp;rect);\n            DrawText(hdc, TEXT(\"Unique yet the same!\"), -1, &amp;rect,\n                    DT_SINGLELINE | DT_CENTER | DT_VCENTER);\n\n            EndPaint(hwnd, &amp;ps);\n            return 0;\n\n        case WM_DESTROY:\n            number--;\n            if(number == 0){\n                PostQuitMessage(0);\n            }\n            return 0;\n    }\n    return DefWindowProc(hwnd, message, wParam, lParam);\n</code></pre>\n\n<p>I'm trying to get the variable, which I pass as the lParam of the first window that is created, to be set as the Class Extra.  Does that make sense?  Here is my main.c:</p>\n\n<p>int WINAPI WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance, \n                    PSTR szCMLine, int iCmdShow){\n    static TCHAR szAppName[] = TEXT (\"HelloApplication\");\n    HWND    hwnd;\n    MSG     msg;\n    WNDCLASS wndclass;\n    LONG* count;</p>\n\n<pre><code>wndclass.style      = CS_HREDRAW | CS_VREDRAW;\nwndclass.lpfnWndProc = HelloWndProc;\nwndclass.cbClsExtra = 5;\nwndclass.cbWndExtra = 0;\nwndclass.hInstance  = hInstance;\nwndclass.hIcon      = LoadIcon (NULL, IDI_APPLICATION);\nwndclass.hCursor    = LoadCursor (NULL, IDC_ARROW);\nwndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH);\nwndclass.lpszMenuName = NULL;\nwndclass.lpszClassName = szAppName;\n\n\nif (!RegisterClass (&amp;wndclass)){\n    MessageBox (NULL, TEXT (\"This program requires Windows 95/98/NT\"),\n                szAppName, MB_ICONERROR);\n    return 0;\n}\n\nhwnd = CreateWindow(szAppName,      \n                    TEXT(\"Hello World for Windows\"), \n                    WS_OVERLAPPEDWINDOW,    \n                    100,        \n                    50,     \n                    400,        \n                    300,        \n                    NULL,               \n                    NULL,           \n                    hInstance,          \n                    count = 0);\nShowWindow(hwnd, iCmdShow);\nUpdateWindow(hwnd);\n</code></pre>\n\n<p>Any help would be appreciated; I've already been quizzed on this info in my class and did not understand it.  I'm posting this question for my own understanding only.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c","winapi"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":77,"score":2,"question_id":12302297,"title":"Create a file in %temp% using C program","body":"<p>How to create a file in %temp% folder using C program. Please provide me some Ideas on it.</p>\n\n<p>I am programming in windows using Mingw.</p>\n\n<p>Update:</p>\n\n<p>I want the file to be in .log or .txt format. How to do that? </p>\n"},{"tags":["c++","windows","winapi","icons"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12471020,"title":"DrawIconEx leaving mask artifacts","body":"<p>I'm extracting jumbo icons for any given path using <code>IImageList</code> and <code>SHGetFileInfo</code>.  Once I have that, I then render the <code>HICON</code> into a <code>HBITMAP</code> using <code>DrawIconEx</code> for eventual rendering with GDI+ <code>Bitmap</code> and <code>Graphics</code> objects.</p>\n\n<p>Now, this all works great, except that when I do the final rendering of the bitmap, the very left edge always has a black artifact on it. This is true for pretty much any icon I get, and is always the left edge.</p>\n\n<p><img src=\"http://i.stack.imgur.com/DKUzc.jpg\" alt=\"What I see in explorer.exe on left, what my drawn icon looks like right\"></p>\n\n<p>Any ideas where the dark line could be coming from?</p>\n\n<p>The code I'm using is roughly:</p>\n\n<h3>1. Extract Icon:</h3>\n\n<pre><code>// Get the image list index of the icon\nSHFILEINFO sfi;\nif (!SHGetFileInfo(pszPath, 0, &amp;sfi, sizeof(sfi), SHGFI_SYSICONINDEX)) return NULL;\n\n// Get the jumbo image list\nIImageList *piml;\nif (FAILED(SHGetImageList(SHIL_JUMBO, IID_PPV_ARGS(&amp;piml)))) return NULL;\n\n// Extract an icon\nHICON hicon;\npiml-&gt;GetIcon(sfi.iIcon, ILD_SCALE|ILD_TRANSPARENT, &amp;hicon);\nreturn hicon;\n</code></pre>\n\n<h3>2. Generate Bitmap</h3>\n\n<pre><code>HDC hDC = GetDC(NULL);\nHDC hMemDC = CreateCompatibleDC(hDC);\nHBITMAP hMemBmp = CreateCompatibleBitmap(hDC, x, y);\nHBITMAP hResultBmp = NULL;\nHGDIOBJ hOrgBMP = SelectObject(hMemDC, hMemBmp);\n\nHBRUSH hbr = CreateSolidBrush(bg);\n\nRECT rr = { 0, 0, 256, 256 }; // jumbo icons\nFillRect(hMemDC, &amp;rr, hbr);\nDeleteBrush(hbr);\nDrawIconEx(hMemDC, 0, 0, hicon, size, size, 0, NULL, DI_NORMAL);\n\nhResultBmp = hMemBmp;\nhMemBmp = NULL;\n\nSelectObject(hMemDC, hOrgBMP);\nreturn hResultBitmap;\n</code></pre>\n\n<h3>3. Render GDI+ Bitmap to \"window bitmap\":</h3>\n\n<pre><code>Bitmap *b = ::New Bitmap(hResultBitmap, NULL);\n\nGraphics    graphics(hdc);\ngraphics.SetTextRenderingHint(TextRenderingHintClearTypeGridFit);\n\nSolidBrush  bgbrush(Color(255, 255, 255, 255));\nRect r(0, 0, hwnd_w, hwnd_h);\ngraphics.FillRectangle(&amp;bgbrush, r);\n\ngraphics.SetInterpolationMode(InterpolationModeHighQualityBicubic);\nRect r(5, 5, 128, 128);\ngraphics.DrawImage(dpd-&gt;image_to_draw, r);\n</code></pre>\n"},{"tags":["c","winapi","inter-process-communicat"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":12485961,"title":"How can I get a message from another process when I don't have a window handle?","body":"<p>I have 2 programs, and I need a way for one of them to somehow send a message to the other.  I've looked into the SendMessage function in the Win32 API, and while it works great as long as you have a window handle, my program needs to be able to run while logged off under a service, which means it cannot create a window handle.</p>\n\n<p>Is there any way I can receive messages from another process without having a window handle created?  I've been looking to see if Win32 has some other way that I can hook into the messaging so that I don't depend on having a window handle, but there has to be some way to communicate between processes at a basic level, doesn't there?</p>\n\n<p>I have looked into using Pipe's to do this, but have run into huge permissions issues with that on top of that being much higher level than I'm really looking for.  All I need to be able to do is send a simple custom int message so my process knows it's time to shut down.</p>\n"},{"tags":["winapi","graphics","gdi","hdc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12485601,"title":"How to access another process' graphic pixels values","body":"<p>I want to write a program that make some simulatins based on pixele aquired from another application window graphics. </p>\n\n<p>An application have a window which HWND is easy to grab. Now I want to access its entire \"canvas\" to access pixel buffer.</p>\n\n<p>It is important to make it as fast as possible. I have tried old GDI GetPixel funcion, but it seems to be too slow.</p>\n\n<p>Is there any other way to create a bitmap of control \"canvas\" that one can access like a regular array of pixel values? I am not limited to GDI.</p>\n\n<p>Program is written in C++. Any ideas will be appreciated. </p>\n"},{"tags":["c++","winapi","visual-c++","mfc","createprocess"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":988,"score":2,"question_id":9428456,"title":"how to terminate a process created by CreateProcess()?","body":"<p>I have created a process using <code>CreateProcess()</code>. This is the code:</p>\n\n<pre><code>    STARTUPINFO si = {0};\n    PROCESS_INFORMATION pi = {0};\n    result = CreateProcess(\"C:\\\\AP\\\\DatabaseBase\\\\dbntsrv.exe\", NULL, NULL, NULL, FALSE, 0, NULL, \"C:\\\\ADP\\\\SQLBase\", &amp;si, &amp;pi)\n</code></pre>\n\n<p>How can I get the Handle and processId of this specific process? And eventually use it to close this process? Thank You</p>\n"},{"tags":["c","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":12484749,"title":"How do I program (in c) AnimateWindow to handle a modeless dialog box with two listboxes","body":"<p>I can slide a modeless dialog box with <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms632669.aspx\" rel=\"nofollow\"><code>AnimateWindow</code></a> when the dialog box has only one listbox but when I add the second listbox it will not slide out.  I can see the dialog box with the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms633548.aspx\" rel=\"nofollow\"><code>ShowWindow</code></a> function.</p>\n"},{"tags":["c++","c","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":7,"view_count":145,"score":-6,"question_id":12285375,"title":"C++ Win32 Error","body":"<p>I made a class for Win32 and I have no idea why this error happens.</p>\n\n<p>This is the code:</p>\n\n<p>main.cpp</p>\n\n<pre><code>using namespace std;\n#include \"WindowManager.h\"\n\n#define   WIDTH     700\n#define   HEIGHT    500\n#define   VERSION   0.1\n\nint WINAPI WinMain(HINSTANCE hInstance,HINSTANCE hPreviousInstance,LPSTR lpcmdline,int nCmdShow)\n{\n    WindowManager window(\"TalkToMe\", 100, 100, WIDTH, HEIGHT);\n\n    while(window.isWindowOpen())\n    {\n        window.PekMessage();\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>WindowManager.h</p>\n\n<pre><code>#pragma once\n\n#include &lt;Windows.h&gt;\n\nclass WindowManager\n{\nprivate:\n    MSG msg;\n    HWND window;\n\n    int stat;\npublic:\n    WindowManager(LPCTSTR title,int x, int y, int width, int height);\n    ~WindowManager();\n    LRESULT CALLBACK WindowProcedure(HWND winhan,UINT uint_Message,WPARAM parameter1,LPARAM parameter2);\n\n    inline bool isWindowOpen()   { return stat != -1; }\n    int  getStat()               { return stat; }\n    void PekMessage();\n};\n</code></pre>\n\n<p>WindowManager.cpp</p>\n\n<pre><code>#include \"WindowManager.h\"\n\nvoid WindowManager::PekMessage()\n{\n    if(PeekMessage(&amp;msg, window, 0, 0, PM_REMOVE))\n    {\n        TranslateMessage(&amp;msg);\n        DispatchMessage(&amp;msg);\n    }\n}\n\nLRESULT CALLBACK WindowManager::WindowProcedure(HWND winhan,UINT uint_Message,WPARAM parameter1,LPARAM parameter2)\n{\n    switch(uint_Message)\n    {\n        case 16: // exit button\n            stat = -1;\n        break;\n    }\n\n    return DefWindowProc(winhan,uint_Message,parameter1,parameter2);\n}\n\nWindowManager::WindowManager(LPCTSTR title,int x, int y, int width, int height)\n{\n    stat = 0;\n\n    WNDCLASSEX wnd;\n    wnd.cbSize = sizeof(wnd);\n    wnd.style  = CS_HREDRAW | CS_VREDRAW;\n    wnd.lpfnWndProc = WindowProcedure;\n    wnd.cbClsExtra  = 0;\n    wnd.cbWndExtra  = 0;\n    wnd.hInstance   = GetModuleHandle(NULL);\n    wnd.hIcon       = NULL;\n    wnd.hCursor     = LoadCursor(NULL,IDC_ARROW);\n    wnd.hbrBackground = GetSysColorBrush(NULL);\n    wnd.lpszClassName = \"TalkToMe\";\n    wnd.lpszMenuName  = NULL;\n    wnd.hIconSm = LoadIcon(NULL, IDI_APPLICATION);\n\n    RegisterClassEx(&amp;wnd);\n\n    window = CreateWindowEx(WS_EX_CONTROLPARENT, wnd.lpszClassName, title, \n        WS_OVERLAPPED | WS_CAPTION | WS_SYSMENU | WS_MINIMIZEBOX | WS_VISIBLE, x, y, width, height,NULL, NULL, \n        GetModuleHandle(NULL), NULL);\n}\n\nWindowManager::~WindowManager()\n{\n    DestroyWindow(window);\n}\n</code></pre>\n\n<p>This is the weird build failure:</p>\n\n<pre><code>1&gt;------ Build started: Project: Client, Configuration: Debug Win32 ------\n1&gt;  WindowManager.cpp\n1&gt;c:\\users\\user\\documents\\visual studio 2012\\projects\\talktome\\talktome\\windowmanager.cpp(31): error C3867: 'WindowManager::WindowProcedure': function call missing argument list; use '&amp;WindowManager::WindowProcedure' to create a pointer to member\n1&gt;c:\\users\\user\\documents\\visual studio 2012\\projects\\talktome\\talktome\\windowmanager.cpp(31): error C2440: '=' : cannot convert from 'LRESULT (__stdcall WindowManager::* )(HWND,UINT,WPARAM,LPARAM)' to 'WNDPROC'\n1&gt;          There is no context in which this conversion is possible\n1&gt;  Generating Code...\n1&gt; Compiling...\n1&gt;  Main.cpp\n1&gt;  Generating Code...\n========== Build: 0 succeeded, 1 failed, 0 up-to-date, 0 skipped ==========\n</code></pre>\n"},{"tags":["c++","winapi","gdi"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":164,"score":1,"question_id":12479386,"title":"How to draw text with transparent background using c++/WinAPI?","body":"<p>How to draw text with transparent color using WinAPI?\nIn usual way I used SetBkMode(hDC, TRANSPARENT), but now I need to use double buffer.\nIn this way images draws correct, but text draws not correct (with black background).</p>\n\n<pre><code>case WM_PAINT:\n{\n    hDC = BeginPaint(hWnd, &amp;paintStruct);\n    SetBkMode(hDC, TRANSPARENT);\n\n    HDC cDC = CreateCompatibleDC(hDC);\n    HBITMAP hBmp = CreateCompatibleBitmap(hDC, width, height);\n    HANDLE hOld = SelectObject(cDC, hBmp);\n\n    HFONT hFont = (HFONT)SelectObject(hDC, font);\n    SetTextColor(cDC, color);\n    SetBkMode(cDC, TRANSPARENT);\n\n    TextOut(cDC, 0, 0, text, wcslen(text));\n\n    SelectObject(cDC, hFont);\n\n    BitBlt(hDC, 0, 0, width, height, cDC, 0, 0, SRCCOPY);\n\n    SelectObject(cDC, hOld);\n    DeleteObject(hBmp);\n    DeleteDC(cDC);\n\n    EndPaint(hWnd, &amp;paintStruct);\n    return 0;\n}\n</code></pre>\n"},{"tags":["windows","winapi","gui"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12423584,"title":"How to set exact client size for overlapped window? (winapi)","body":"<p>I want to set anexact client size (say 300 x 300) when I create a normal 'overlapped' window.</p>\n\n<p>There is the <code>AdjustWindowRectEx()</code> function where I can pass the desired client\narea and get sizes that I can pass to CreateWindowEx but it says \nin the documentation that I should not use it for overlapped windows\nand I do not understand why.</p>\n\n<p>When I pass 300 x 300, I got 306 x 326 from it, and when I receive\n<code>WM_SIZE</code>, the client size is 298 x 298 so it is 2 pixels too small.</p>\n\n<p>How to create overlapped window with exact given client size?</p>\n"},{"tags":["c++","winapi","stl","boost-interprocess"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":119,"score":3,"question_id":12477713,"title":"STL containers in shared memory (Windows)","body":"<p>I'm working on an application that is composed of 2 processes that have to share some data structures. These classes are organized in different libraries and the libraries are used in different applications.</p>\n\n<ul>\n<li>My first attempt was to use <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa366551%28v=vs.85%29.aspx\" rel=\"nofollow\">Named Shared Memory</a> in Win32 but the problem here is that I can't use STL containers. </li>\n<li>Looking for a solution, I've found <a href=\"http://stackoverflow.com/questions/4278627/c-boostinterprocess-simple-application/\">Boost Interprocess</a> and, if I understand, I have to change all the STL containers, in my classes, to \"STL\" Boost Interprocess containers.</li>\n</ul>\n\n<p>So, is there any other method to share classes or structures using STL (in Windows)? The goal is to not create too much dependence from Boost in our libraries.</p>\n\n<p>Thanks</p>\n"},{"tags":["qt","winapi","icons","exe"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12459145,"title":"Extracting icon using WinAPI in Qt app","body":"<p>I'm trying to extract icon from exe file using WinAPI, but it doesn't work.</p>\n\n<p><strong>Here's the code:</strong></p>\n\n<pre><code>QIcon OSTools::AppsInterface::extractAppIcon(const QString &amp;fileName) const {\n    wchar_t *convertedName = new wchar_t[fileName.length() + 1];\n    fileName.toWCharArray(convertedName);\n    convertedName[fileName.length()] = '\\0';\n    HICON Icon = ExtractIcon(NULL, convertedName, 0);\n\n    QPixmap pixmap = QPixmap::fromWinHICON(Icon);\n    return QIcon(pixmap);\n}\n</code></pre>\n\n<p>Code outputs:</p>\n\n<pre><code>QPixmap::fromWinHICON(), failed to GetIconInfo()\n</code></pre>\n\n<p>(<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms648068%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>ExtractIcon</code> function on MSDN</a>).</p>\n\n<p>I think problem is that I send NULL instead of \"<em>A handle to the instance of the application calling the function</em>\". But, generally, I use Qt, and it's only one WinAPI function in my app.</p>\n\n<p>What's wrong? What's correct way to extract icon using WinAPI? If you have another function proposal, please, give me an example. This is the first time I'm using WinAPI.</p>\n"},{"tags":["c#","winapi","io"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":88,"score":-1,"question_id":12478703,"title":"C# - Delete Folder","body":"<p>I want delete java folder with C#,\nbut I have little problem.</p>\n\n<p>this is the code</p>\n\n<pre><code>private void setDebug(string value)\n{\n    debug.Text = value;\n}\n\nprivate void buildButton_Click(object sender, EventArgs e)\n{\n    // delete java folder\n    string java_folder = @\"C:\\Program Files\\Java\";\n    if (Directory.Exists(java_folder))\n    {\n        setDebug(\"Deleting Java folder...\");\n        Directory.Delete(java_folder, true);\n        progressBar.Value += 10;\n    }\n}\n</code></pre>\n\n<p>when I click on the button the program stuck, but when i delete the line Directory.Delete\nit change the debug label to \"Deleting java folder...\"</p>\n\n<p>I know that the program stuck because it delete the folder but i want it change the debug first before it delete the folder.</p>\n\n<p>what to do? thanks for help :)</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12475131,"title":"Cannot create window","body":"<pre><code>#include &lt;Windows.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;tchar.h&gt;\n\n#pragma comment(linker,\"\\\"/manifestdependency:type='win32'name='Microsoft.Windows.Common-Controls'\\\n                version='6.0.0.0' processorArchitecture='*'\\\n                publicKeyToken='6595b64144ccf1df' language='*'\\\"\")\n\nLRESULT WINAPI WndProc(HWND hWnd,UINT msg,WPARAM lParam,LPARAM wParam)\n{\n    return DefWindowProc(hWnd,msg,wParam,lParam);\n}\n\nint WinMain(HINSTANCE hInst,HINSTANCE hpInst,LPSTR cmdLine,int cmdshow)\n{\n    static TCHAR classname[]=_T(\"SCONF\");\n    static TCHAR wTitle[]=_T(\"Server Configurator\");\n\n    WNDCLASSEX wClass;\n    wClass.cbClsExtra=NULL;\n    wClass.cbSize=sizeof(WNDCLASSEX);\n    wClass.cbWndExtra=NULL;\n    wClass.hbrBackground=(HBRUSH)(CTLCOLOR_SCROLLBAR);\n    wClass.hCursor=LoadCursor(NULL,IDC_ARROW);\n    wClass.hIcon=LoadIcon(hInst,IDI_APPLICATION);\n    wClass.hIconSm=LoadIcon(hInst,IDI_APPLICATION);\n    wClass.hInstance=hInst;\n    wClass.lpfnWndProc=WndProc;\n    wClass.lpszClassName=classname;\n    wClass.lpszMenuName=NULL;\n    wClass.style=CS_HREDRAW|CS_VREDRAW;\n    if(!RegisterClassEx(&amp;wClass))\n    {\n        MessageBox(NULL,L\"Could not register class!\", L\"ERROR\",MB_ICONERROR|MB_OK);\n    }\n    RECT wr={0,0,200,250};\n    AdjustWindowRect(&amp;wr,WS_CAPTION,false);\n\n    HWND hWnd=CreateWindow(\n        classname,\n        wTitle,\n        WS_CAPTION,\n        GetSystemMetrics(SM_CXSCREEN)/2-100,\n        GetSystemMetrics(SM_CYSCREEN)/2-125,\n        wr.right-wr.left,//width\n        wr.bottom-wr.top,//height\n        NULL,\n        NULL,\n        hInst,\n        NULL);\n\n    if(!hWnd)\n    {\n        MessageBox(NULL,_T(\"Could not create window!\"),_T(\"ERROR!\"),MB_ICONERROR);\n        return 1;\n    }\n    ShowWindow(hWnd,cmdshow);\n    MSG msg;\n    while(GetMessage(&amp;msg,0,0,0))\n    {\n        TranslateMessage(&amp;msg);\n        DispatchMessage(&amp;msg);\n    }\n    return (int)msg.wParam;\n}\n</code></pre>\n\n<p>this is the full code, when I try to compile, the hWnd always returns false...I even tried copying the code from a working program and it did not work...What's going on here? It always worked before...</p>\n"},{"tags":["c#","windows","winapi","networking","wmi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":12474560,"title":"Getting the wired network name and security level on Windows","body":"<p>And by this question I mean the user assigned names windows lets you type in like: \"My home network\"  \"Basement\" \"Garage\" not the ssid (though I would also like to read that one for the wifi connections) </p>\n\n<p>and I especially want to read the windows security levels that can be chosen for networks: Home/Office/Public</p>\n\n<p>I want to use this information to switch programs on and off automatically when connecting to various networks.</p>\n\n<p><strong>Update:</strong>\nThanks to the answer of @Damien_The_Unbeliever I was able to solve my question and find the following information, I hope it will help others too:</p>\n\n<ul>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/ee264321%28v=vs.85%29.aspx\" rel=\"nofollow\">Network awareness in windows 7 and vista (MSDN, Unmanaged)</a></li>\n<li><a href=\"http://archive.msdn.microsoft.com/WindowsAPICodePack\" rel=\"nofollow\">Windows API Code Pack (Microsoft, managed wrapper for\nNetworkListManager and others)</a></li>\n<li><a href=\"http://www.codeproject.com/Articles/34650/How-to-use-the-Windows-NLM-API-to-get-notified-of\" rel=\"nofollow\">How to use the windows NLM API to get notified of new network\nconnectivity (Codeproject, Managed)</a></li>\n</ul>\n"},{"tags":["c++","windows","winapi","unicode"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":12472017,"title":"MultiByteToWideChar converts (°) degree symbol to �","body":"<p>I am trying to convert a string from ANSII to Wide char. I am using <code>CA2W(string,CP_UTF8)</code> which internally uses <code>MultiByteToWideChar</code>.</p>\n\n<p>While debugging it shows that <code>MultiByteToWideChar</code> converts  ° degree symbol to �.</p>\n\n<p>Any suggestions on how to resolve this?</p>\n"},{"tags":["winapi","framebuffer"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12463307,"title":"Screen Tearing when rendering using Windows API","body":"<p>I am trying to render an animation using Windows API. My problem is that half of the screen shows the previous frame, and the bottom half shows the current frame. I thought that this would be fixed when using a double buffer, but I have inserted</p>\n\n<pre><code>BitBlt(hdc, 0, 0, iWidth, iHeight, hdcMem, 0, 0, SRCCOPY);\n</code></pre>\n\n<p>which I understand is a double buffer, but the horizontal division still exists. How can I fix this?</p>\n"},{"tags":["python","winapi","symlink","pywin32"],"answer_count":5,"favorite_count":5,"up_vote_count":9,"down_vote_count":0,"view_count":3569,"score":9,"question_id":1447575,"title":"Symlinks on windows?","body":"<p>Does anyone know of a way to make/read symbolic links across versions of win32 from Python? Ideally there should be a minimum amount of platform specific code, as I need my app to be cross platform.</p>\n"},{"tags":["c","windows","winapi","backtrace"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12467619,"title":"How can I get the filename and line number when Backtracing?","body":"<p>I saw a very good way to get the symbol name from the following post.</p>\n\n<p><a href=\"http://stackoverflow.com/questions/5693192/win32-backtrace-from-c-code\">Win32 - Backtrace from C code</a></p>\n\n<p>But what about getting the file name and line number. I tried to use the SymGetLineFromAddr64 but could not get this debug information. </p>\n"},{"tags":["c#",".net","windows","winapi","graphics"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":95,"score":2,"question_id":12467380,"title":"How to process image pixel-by-pixel with WinAPI in a FAST WAY?","body":"<p>So, I make some simple image-processing program with GUI, C#. For example, I want to change image colors in HSV color model, converting each pixel from RGB and back again.</p>\n\n<p>My program loads some picture by user choice and shows it in one of form's panel using its Graphics context. Then user can do something with this picture by moving scrollbars, clicking buttons, selecting some image area etc. When he do that I need in realtime change all the picture pixel-by-pixel. So, I write something like:</p>\n\n<pre><code>for (int x = 0; x &lt; imageWidth; x++)\n    for (int y = 0; y &lt; imageHeight; y++)\n        Color c = g.GetPixel(x, y);\n        c = some_process_color_function_depending_on_user_controls(c);\n        g.SetPixel(x, y)\n</code></pre>\n\n<p>And even if I work with Graphics in memory (not on the screen), functions GetPixel and SetPixel works VERY SLOW (so, as my program works so slow, I profiled it, and explained that these two functions are slowing down my program at most). So, I can't process big pictures in a few time as user moving slider or checking checkbox.</p>\n\n<p>Please help! What can I do to make my program be fast? I nay agree to use other third-party libraries for graphics or change programming language!</p>\n"},{"tags":["c++","winapi","delete","folders"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":80,"score":3,"question_id":12462178,"title":"Why doesn't this method of deleting files inside a folder work?","body":"<pre><code>std::wstring inxmpath ( L\"folder\" );\nHANDLE hFind;\nBOOL bContinue = TRUE;\nWIN32_FIND_DATA data;\nhFind = FindFirstFile(inxmpath.c_str(), &amp;data); \n// If we have no error, loop through the files in this dir\nint counter = 0;\nwhile (hFind &amp;&amp; bContinue) {\n        std::wstring filename(data.cFileName);\n        std::string fullpath = \"folder/\";\n        fullpath += (const char* )filename.c_str();\n        if(remove(fullpath.c_str())!=0) return error;\n    bContinue = FindNextFile(hFind, &amp;data);\n    counter++;\n}\nFindClose(hFind); // Free the dir\n</code></pre>\n\n<p>I don't understand why it doesn't work, I think it has something to do with the conversions between wstring and string however I'm not sure about that. I have a folder which has some .txt files, I need to delete all of them using C++. There are no folders in it nothing. How hard can this be?\nthanks in advance</p>\n"},{"tags":["delphi","winapi"],"answer_count":6,"favorite_count":7,"up_vote_count":7,"down_vote_count":0,"view_count":22477,"score":7,"question_id":507853,"title":"System Error. Code: 8. Not enough storage is available to process this command","body":"<p>We have a few Win32 applications (coded in Delphi 2006) where sometimes the user gets an error message saying <strong>\"System Error. Code: 8. Not enough storage is available to process this command.\"</strong>.</p>\n\n<p>From the stacktrace it looks like it is always during CreateWnd call</p>\n\n<pre><code>Main ($1edc):\n004146cc +070 app.exe SysUtils               RaiseLastOSError\n00414655 +005 app.exe SysUtils               RaiseLastOSError\n004ce44c +130 app.exe Controls               TWinControl.CreateWnd\n00535a72 +022 app.exe cxControls             TcxControl.CreateWnd\n004ce82a +016 app.exe Controls               TWinControl.CreateHandle\n00553d21 +005 app.exe cxContainer            TcxContainer.CreateHandle\n00586ef1 +005 app.exe cxEdit                 TcxCustomEdit.CreateHandle\n005c331d +005 app.exe cxDropDownEdit         TcxCustomDropDownEdit.CreateHandle\n004ceaf0 +074 app.exe Controls               TWinControl.UpdateShowing\n004ceb1e +0a2 app.exe Controls               TWinControl.UpdateShowing\n004cebdc +03c app.exe Controls               TWinControl.UpdateControlState\n004d118a +026 app.exe Controls               TWinControl.CMVisibleChanged\n004cb713 +2bb app.exe Controls               TControl.WndProc\n004cf569 +499 app.exe Controls               TWinControl.WndProc\n004b727d +4c1 app.exe Forms                  TCustomForm.WndProc\n004cb3a0 +024 app.exe Controls               TControl.Perform\n004c9f6a +026 app.exe Controls               TControl.SetVisible\n004b6c46 +03a app.exe Forms                  TCustomForm.SetVisible\n004baf1b +007 app.exe Forms                  TCustomForm.Show\n004bb151 +14d app.exe Forms                  TCustomForm.ShowModal\n007869c7 +0d3 app.exe UfrmPrice      770 +19 TfrmPrice.EditPrice\n0078655d +009 app.exe UfrmPrice      628  +0 TfrmPrice.actNewBidExecute\n00431ce7 +00f app.exe Classes                TBasicAction.Execute\n004c2cb5 +031 app.exe ActnList               TContainedAction.Execute\n004c397c +050 app.exe ActnList               TCustomAction.Execute\n00431bb3 +013 app.exe Classes                TBasicActionLink.Execute\n004af384 +090 app.exe Menus                  TMenuItem.Click\n004b059f +013 app.exe Menus                  TMenu.DispatchCommand\n004b16fe +082 app.exe Menus                  TPopupList.WndProc\n004b164d +01d app.exe Menus                  TPopupList.MainWndProc\n004329a8 +014 app.exe Classes                StdWndProc\n7e4196b2 +00a USER32.dll                     DispatchMessageA\n004bea60 +0fc app.exe Forms                  TApplication.ProcessMessage\n004bea9a +00a app.exe Forms                  TApplication.HandleMessage\n004becba +096 app.exe Forms                  TApplication.Run\n008482c5 +215 app.exe AppName        129 +42 initialization\n</code></pre>\n\n<p>I've never been able to get to the bottom of what causes this and as it happens fairly seldom I haven't been to concerned, but I would like to find out what causes it and hopefully rectify it...</p>\n\n<p><strong>EDIT:</strong> Full Stacktrace</p>\n\n<p><strong>EDIT 2:</strong> More info... The client who experienced this today has had my app installed for about 4 months and it is running on his PC 8 hours a day. The problem only appeared today and kept reappearing even though he killed my app and restarted it. None of the other apps on his system behaved strangely. After a reboot the problem goes away completely. Does this point towards the heap shortage that Steve mentions?</p>\n\n<p><strong>EDIT 3:</strong> Interesting msdn blog post <a href=\"http://blogs.msdn.com/ntdebugging/archive/2007/01/04/desktop-heap-overview.aspx\">here</a> and <a href=\"http://blogs.msdn.com/ntdebugging/archive/2007/07/05/desktop-heap-part-2.aspx\">here</a> on the topic of the desktop heap. Though I'm not sure whether this is the cause of the problem it certainly looks likely.</p>\n"},{"tags":["c++","winapi","gdi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12456365,"title":"How to get color of window","body":"<p>I am trying to use API GetBkColor and GetSysColor(COLOR_WINDOW) to get color of window but its giving me wrong value.\nWhen I get color of wndow by using some tool its diffeent from what I get from API.</p>\n\n<p>Any suggestion of how to get right value of color?</p>\n\n<p>In case if window is using gradient color then how can I find the color at particular pixel?</p>\n"},{"tags":["c++","winapi","mfc","atl"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":2,"view_count":93,"score":-1,"question_id":12463386,"title":"Alternative for MFC functions in c++?","body":"<p>Alternative for MFC AfxIsValidAddress in c++ ?</p>\n"},{"tags":["winapi","visual-studio-2008","windows-xp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":43,"score":0,"question_id":12461215,"title":"The procedure entry point QueryFullProcessImageNameA could not be locatedin the dynamic link library KERNEL32.dll","body":"<p>I am trying to run a program on Visual Studio on a XP computer and i am getting the error in the heading. I have all the service packs for XP and VS. Never seen anything like this before so i really dont have a clue. Anyone seen this problem before or know what might be going wrong?</p>\n"},{"tags":["c++","winapi","mingw"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":147,"score":2,"question_id":12460712,"title":"Convert LPWSTR to string","body":"<p>Function <code>CommandLineToArgvW</code> is giving me commandline arguments in <code>LPWSTR</code> type. I need these arguments in <code>string</code>.\nWould someone please tell me how to convert <code>LPWSTR</code> to <code>string</code>?<br>\nI'm using mingw.</p>\n"},{"tags":["c++","winapi","visual-c++","dll"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":83,"score":-3,"question_id":12455852,"title":"Export entire class through c++ interface","body":"<p>Ok, I'll rewrite the question(s).\n1. Is it enough to do </p>\n\n<pre><code>class __declspec(dllexport) CXyz {\npublic:\nint Food() {printf(\"Food\\n\");}\n};\n</code></pre>\n\n<p>So that the class could be used like this in the exe:</p>\n\n<pre><code>#include \"CXyz.h\"\nCXyz obj;\nobj.Food();\n</code></pre>\n\n<p>2. What happens when I do CXyz x ( member &amp; methods code allocation), I mean does it allocate a linear structure with the size of (aprox. members size + function pointers for the methods) and method code is in the section .code of the program? What happens when I do CXyz *pX ? </p>\n"},{"tags":["asp.net","winapi","dll","marshalling"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12459462,"title":"Session expires when using marshaling","body":"<p>My client is building a web application that uses my win32.dll, when he call my API and pass parameter in it using marshalling, the dll API work as expected but when it come out from the function call his web session expires. \nWhat could be the reason? </p>\n\n<p>Please find the code snippet below:</p>\n\n<blockquote>\n  <p>// import part</p>\n  \n  <p>[DllImport(@\"SupportedFiles//xyz.dll\")]</p>\n  \n  <p>public static extern long IInitializeW([MarshalAs(UnmanagedType.LPWStr)]string pstr,\n      [MarshalAs(UnmanagedType.LPWStr)]string pstr1, int pl,\n      [MarshalAs(UnmanagedType.LPWStr)]StringBuilder pstrError);</p>\n  \n  <p>// calling part</p>\n  \n  <p>public static void ABC( RandomClass obj) \n  {\n   int llTemp = 0;\n   string lstr = obj.GetFirstParam();\n   string lstr1 = obj.GetSecondParam();</p>\n  \n  <p>StringBuilder lstrError = new StringBuilder(1000);</p>\n  \n  <p>lRet = (int )IInitializeW(lstr, lstr1,(int) llTemp, lstrError);\n  }  </p>\n</blockquote>\n"}]}
{"total":13828,"page":11,"pagesize":100,"questions":[{"tags":["winapi","user-interface","windows-7","interface","painting"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12459213,"title":"Win32 application windows eventually stop painting on Windows 7","body":"<p>I have a large, complex application written in C++ (no MFC or .NET).  The client that uses the software most aggressively will, within an hour or so of starting it, get to a state where all the windows stop painting.  We get reports that the application has \"hung\" because as far as they can tell nothing is happening.  In reality, the application is functioning, just not displaying anything.</p>\n\n<p>I've tried a lot of different things to no avail.  I'm out of ideas...</p>\n"},{"tags":["c++","winapi","visual-c++","dll"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12459242,"title":"Exporting and importing dll interface in c++ not working","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12455852/export-entire-class-through-c-interface\">Export entire class through c++ interface</a>  </p>\n</blockquote>\n\n\n\n<p>Starting from <a href=\"http://www.codeproject.com/Articles/28969/HowTo-Export-C-classes-from-a-DLL#CppMatureApproach\" rel=\"nofollow\">this</a> tutorial I have atried to do my own VS solution with 2 projects  a .dll builder and an .exe builder, here is the .dll project header:\nlibheader.h</p>\n\n<pre><code>#pragma once\n\n#ifdef SHREDLIB_EXPORTS\n#define SHREDAPI __declspec(dllexport)\n\n#else\n#define SHREDAPI __declspec(dllimport)\n\n#endif\n\nstruct IShred\n{\n    virtual int GetStringSize(char*) = 0;\n    virtual void Release() = 0;\n};\n\n// Handle type. In C++ language the iterface type is used.\ntypedef IShred* SHREDHANDLE;\n\n#ifdef __cplusplus\n#   define EXTERN_C     extern \"C\"\n#else\n#   define EXTERN_C\n#endif // __cplusplus\n\n\nEXTERN_C\nSHREDAPI \nSHREDHANDLE \nWINAPI \nGetShred(void);\n</code></pre>\n\n<p>the libheader.cpp</p>\n\n<pre><code>#include libheader.h\nclass IShredLib: public IShred {\n    int GetStringSize(char*);\n    void Release();\n};\n\nint IShredLib::GetStringSize(char* s)\n{\n    return strlen(s);\n}\nvoid IShredLib::Release()\n{\n    delete this;\n}\n#pragma comment(linker, \"/export:GetShred=_GetShred@0\")\nSHREDAPI SHREDHANDLE APIENTRY\nGetShred()\n{\n    return new IShredLib;\n}\n</code></pre>\n\n<p>and this in the main.cpp exe project:</p>\n\n<pre><code>#include \"libheader.h\"\n\n#include &lt;conio.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;iostream&gt;\nusing namespace std;\n\nint main(int argc, char* argv[])\n{\n    IShred* itf = ::GetShred();\n\n\n    _getch();\n    return 0;\n}\n</code></pre>\n\n<p>Now why do I get this?\n<strong>Error 1   error LNK2001: unresolved external symbol _<em>imp</em>_GetShred@0</strong> \nI have also defined the SHREDLIB_EXPORTS as a c++ preprocessor define in VS .dll project properties. </p>\n"},{"tags":["perl","winapi","console"],"answer_count":4,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":5276,"score":6,"question_id":1087248,"title":"How do I color output text from Perl script on Windows?","body":"<p>I would like to color format the text printed to the console using the Perl print command.</p>\n\n<p>In my case the script will only be run under WinXP-DOS Command Line but it would be great if it was OS independent although I would rather tie it to WinXP than have to download a seperate package.</p>\n"},{"tags":["qt","winapi","porting"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":117,"score":0,"question_id":12450362,"title":"Replacing WaitForMultipleObjects in Qt","body":"<p>I am not familar with WINAPI, and I am looking for a way to replace WaitForMultipleObjects used in one example I'm porting to Qt by anything using Qt only. Is it possible?</p>\n\n<p><strong>EDIT: (Providing more information as requested in comments)</strong></p>\n\n<p>A 3rd party API provides an array of events:</p>\n\n<pre><code>HANDLE  m_hEv[MAX_EV];\n</code></pre>\n\n<p>In an endles-loop of a thread, the program waits for the events like this:</p>\n\n<pre><code>WaitForMultipleObjects(m_EvMax, m_hEv, FALSE ,INFINITE )\n</code></pre>\n\n<p>The <code>HANDLE</code> type seems to be void*. \nSo I wonder, if any Qt class could observe m_hEv for changes and unlock thread execution.</p>\n"},{"tags":["c++","winapi","mkstemp"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1042,"score":2,"question_id":6036227,"title":"mkstemp() implementation for win32","body":"<p>Can anybody point me to the code that implements mkstemp() (C/C++) on Win32, or very close analog. </p>\n\n<p>Must be race-free. </p>\n\n<p>It's supposed to look like</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;io.h&gt;\n\n// port of mkstemp() to win32. race-free.\n// behaviour as described in http://linux.die.net/man/3/mkstemp\n// \nint mkstemp(char *template) {\n     ...\n}\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["c++","winapi","gdi","dual-monitor","device-context"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12456124,"title":"WM_PAINT message and EnumDisplayMonitors","body":"<p>I'm trying to adapt a screensaver written in C++ with WinAPIs to work for multiple monitors. I found <a href=\"http://www.codeproject.com/Articles/7831/Dual-Multiple-Monitor-Support-in-Win32\" rel=\"nofollow\">this article</a> that suggests to rewrite this basic WM_PAINT handler:</p>\n\n<pre><code>case WM_PAINT:\n{\n    PAINTSTRUCT ps = {0};\n    HDC hdc = BeginPaint(hWnd, &amp;ps );\n\n    DoDrawing(hdc, ps.rcPaint);\n\n    EndPaint(hWnd, &amp;ps);\n}\nbreak;\n\nvoid DoDrawing(HDC hDC, RECT rcDraw)\n{\n    //Do actual drawing in 'hDC'\n}\n</code></pre>\n\n<p>Into something like this to incorporate drawing for multiple screens:</p>\n\n<pre><code>case WM_PAINT:\n{\n    PAINTSTRUCT ps = {0};\n    HDC hdcE = BeginPaint(hWnd, &amp;ps );\n\n    EnumDisplayMonitors(hdcE,NULL, MyPaintEnumProc, 0);\n\n    EndPaint(hWnd, &amp;ps);\n}\nbreak;\n\nBOOL CALLBACK MyPaintEnumProc(\n      HMONITOR hMonitor,  // handle to display monitor\n      HDC hdc1,     // handle to monitor DC\n      LPRECT lprcMonitor, // monitor intersection rectangle\n      LPARAM data       // data\n      )\n{\n    RECT rc = *lprcMonitor;\n    // you have the rect which has coordinates of the monitor\n\n    DoDrawing(hdc1, rc);\n\n    // Draw here now\n    return 1;\n}\n</code></pre>\n\n<p>But the question I have is what about special optimization/clipping that BeginPaint() sets up in the DC after processing WM_PAINT message? With this approach it will be lost. Any idea how to preserve it across the EnumDisplayMonitors() call?</p>\n"},{"tags":["c","winapi","background-color"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":12434328,"title":"How to color entire screen solid color in Win32","body":"<pre><code>    RECT rect;\n    HWND hwnd = GetDesktopWindow();\n    LockWindowUpdate(hwnd);\n    HDC hdc = GetDC(hwnd);\n    HBRUSH hbrush = CreateSolidBrush(RGB(255,0,0));\n    GetWindowRect(hwnd, &amp;rect);\n    FillRect(hdc, &amp;rect, hbrush);         \n</code></pre>\n\n<p>This is my previous attempt which did nothing. Just to be clear, I am trying to color the whole screen a solid color.</p>\n"},{"tags":["delphi","winapi","ftp","wininet"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":164,"score":1,"question_id":12427247,"title":"Wininet InternetSetStatusCallback not working","body":"<p>I'm trying to detect when an ftp server closes the connection I opened in my application. I'm using the WinInet functionality.</p>\n\n<p>I found some examples that make use of the <code>InternetSetStatusCallback</code> function. I implemented a callback function <code>StatusCallback</code> and passed it's address in the call to <code>InternetSetStatusCallback</code>. <code>InternetSetStatusCallback</code> gives me back a status of type <code>PFNInternetStatusCallback</code>. The status is not <code>INTERNET_INVALID_STATUS_CALLBACK</code>, meaning that my function <code>StatusCallback</code> was accepted as a callback function, but the callback function is never called. I tried to trigger it by having the server timeout the connection and by manually taking the server down.</p>\n\n<p>My Delphi code is below. Could anybody please help me out here? Or would this be in improper way of detecting the connection status?</p>\n\n<p>Thank you</p>\n\n<pre><code>unit Unit1;\n\ninterface\n\nuses\n  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,\n  Dialogs, ExtCtrls, StdCtrls,\n  WinInet,\n  Winsock;\n\ntype\n  TForm1 = class(TForm)\n    lblConnected:   TLabel;\n    Label2:         TLabel;\n    tmrNOOP:        TTimer;\n    btnConnect:     TButton;\n    btnDisconnect:  TButton;\n    Memo1:          TMemo;\n    procedure btnConnectClick( Sender: TObject );\n    procedure btnDisconnectClick( Sender: TObject );\n    procedure SendNOOP( Sender: TObject );\n  private\n    FFtpRootHandle:     HINTERNET;\n    FFtpSessionHandle:  HINTERNET;\n  public\n    { Public declarations }\n  end;\n\nvar\n  Form1: TForm1;\n\nimplementation\n\n{$R *.dfm}\n\n{\n  N.b. we DO need to define FtpCommand here as it has been defined incorrectly\n  in WinInet.pas (missing last parameter)\n}\nfunction FtpCommand(\n  hConnect:         HINTERNET;\n  fExpectResponse:  BOOL;\n  dwFlags:          DWORD;\n  lpszCommand:      PChar;\n  dwContext:        DWORD;\n  out FtpCmd:       HINTERNET ): BOOL; stdcall; external 'wininet.dll' name 'FtpCommandA';\n\nprocedure StatusCallback(\n  hInet:        HINTERNET;\n  Context:      DWORD_PTR;\n  Status:       DWORD;\n  pInformation: Pointer;\n  InfoLength:   DWORD ); stdcall;\nvar\n  s: string;\nbegin\n  case Status of\n    INTERNET_STATUS_CLOSING_CONNECTION: s := 'Closing the connection to the server';\n    INTERNET_STATUS_CONNECTED_TO_SERVER: s := 'Successfully connected to the socket address: ';\n    INTERNET_STATUS_CONNECTING_TO_SERVER: s := 'Connecting to the socket address';\n    INTERNET_STATUS_CONNECTION_CLOSED: s := 'Successfully closed the connection to the server';\n    INTERNET_STATUS_CTL_RESPONSE_RECEIVED: s := 'Not implemented';\n    INTERNET_STATUS_HANDLE_CLOSING: s := 'This handle value has been terminated';\n    INTERNET_STATUS_HANDLE_CREATED: s := 'InternetConnect has created the new handle';\n    INTERNET_STATUS_INTERMEDIATE_RESPONSE: s :=\n      'Received an intermediate (100 level) status code message from the server';\n    INTERNET_STATUS_NAME_RESOLVED: s := 'Successfully found the IP address: ' + PChar(pInformation);\n    INTERNET_STATUS_PREFETCH: s := 'Not implemented';\n    INTERNET_STATUS_RECEIVING_RESPONSE: s := 'Waiting for the server to respond to a request ';\n    INTERNET_STATUS_REDIRECT: s := 'HTTP request is about to automatically redirect the request ' +\n      PChar(pInformation);\n    INTERNET_STATUS_REQUEST_COMPLETE: s := 'An asynchronous operation has been completed';\n    INTERNET_STATUS_REQUEST_SENT: s := 'Successfully sent the information request to the server: ' +\n      IntToStr(Integer(pInformation)) + ' Byte';\n    INTERNET_STATUS_RESOLVING_NAME: s := 'Looking up the IP address: ' + PChar(pInformation);\n    INTERNET_STATUS_RESPONSE_RECEIVED: s := 'Successfully received a response from the server: ' +\n      IntToStr(Integer(pInformation)) + ' Byte';\n    INTERNET_STATUS_SENDING_REQUEST: s := 'Sending the information request to the server.';\n    INTERNET_STATUS_STATE_CHANGE:\n      begin\n        s := 'Moved between a secure (HTTPS) and a nonsecure (HTTP) site.';\n        case DWORD(pInformation) of\n          INTERNET_STATE_CONNECTED: s := s + #13#10 + 'Connected state. Mutually exclusive with disconnected state.';\n          INTERNET_STATE_DISCONNECTED: s := s + #13#10 +\n            'Disconnected state. No network connection could be established.';\n          INTERNET_STATE_DISCONNECTED_BY_USER: s := s + #13#10 + 'Disconnected by user request.';\n          INTERNET_STATE_IDLE: s := s + #13#10 + 'No network requests are being made by Windows Internet.';\n          INTERNET_STATE_BUSY: s := s + #13#10 + 'Network requests are being made by Windows Internet.';\n        end;\n      end;\n  end;\n  Writeln(s);\nend;\n\nprocedure TForm1.btnConnectClick( Sender: TObject );\nvar\n  flags:  Cardinal;\n  Status: PFNInternetStatusCallback;\n  I:      Integer;\nbegin\n  FFtpRootHandle :=\n    InternetOpen(\n      Pchar( 'NOOP TESTER'),\n      INTERNET_OPEN_TYPE_DIRECT,\n      nil,\n      nil,\n      0 );\n\n  if not Assigned( FFtpRootHandle ) then\n  begin\n    RaiseLastOSError();\n    Exit;\n  end;\n\n  flags := INTERNET_FLAG_PASSIVE or INTERNET_FLAG_NO_UI;\n  FFtpSessionHandle :=\n    InternetConnect(\n      FFtpRootHandle,\n      PAnsiChar( '127.0.0.1' ),\n      Word( 21 ),\n      PAnsiChar( 'x11' ),\n      PAnsiChar( 'x11' ),\n      INTERNET_SERVICE_FTP,\n      Flags,\n      INTERNET_FLAG_ASYNC );\n\n  Status := InternetSetStatusCallback( FFtpSessionHandle,       INTERNET_STATUS_CALLBACK(@StatusCallback) );\nif NativeInt( Status ) = INTERNET_INVALID_STATUS_CALLBACK then\n  raise Exception.Create( 'Callback function is not valid' );\n\nif not Assigned( FFtpSessionHandle ) then\nbegin\n    InternetCloseHandle( FFtpRootHandle );\n    RaiseLastOSError();\n    Exit;\n  end;\n  lblConnected.Color := clGreen;\n  btnConnect.Enabled := false;\n  tmrNOOP.Interval := 10000;\n  tmrNOOP.Enabled := true;\nend;\n\nprocedure TForm1.btnDisconnectClick( Sender: TObject );\nbegin\n  tmrNOOP.Enabled := false;\n  if Assigned( FFtpSessionHandle ) then\n  begin\n    InternetCloseHandle( FFtpSessionHandle );\n    if Assigned( FFtpRootHandle ) then\n    begin\n      InternetCloseHandle( FFtpRootHandle );\n    end;\n  end;\n  lblConnected.Color := clRed;\n  btnConnect.Enabled := true;\nend;\n\nprocedure TForm1.SendNOOP( Sender: TObject );\nvar\n  NOOPSuccess:  Boolean;\n  FtpCmd:       HINTERNET;\nbegin\n  NOOPSuccess :=\n    FtpCommand(\n      FFtpSessionHandle,\n      false,\n      FTP_TRANSFER_TYPE_BINARY,\n      PAnsiChar( 'noop' ),\n      0,\n      FtpCmd );\n  if NOOPSuccess then\n  begin\n\n  end;\nend;\n\nend.\n</code></pre>\n"},{"tags":["c++","winapi","keycode","keyboard-hook","keypad"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":340,"score":1,"question_id":9942596,"title":"Hook Keyboard to change the key code","body":"<p>I have buy this keyboard <a href=\"http://www.mobilitylab.eu/mini-design-touch-silver.html\" rel=\"nofollow\">http://www.mobilitylab.eu/mini-design-touch-silver.html</a> of 107 touch, \nand I want a keypad to put it on my left hand.\nbut when we activate the numlock of the keypad, it activates the numlock on the keyboard.\nSo we have 456- instead of uiop.\nI have found this program but it don't work on a 64 bits OS. <a href=\"http://www.bellamyjc.org/fr/systeme.html#knumlock\" rel=\"nofollow\">http://www.bellamyjc.org/fr/systeme.html#knumlock</a>.</p>\n\n<p>So i want to do my own program with C++, but it don't work fine, the hook is allright (WH_GETMESSAGE) but i don't understand how we can change the keycode and how we can find if it's a key of the keypad or the keybord ?</p>\n\n<p>Here this is my code where i try to change the message :</p>\n\n<pre><code>//-----------------Keyboard Hook Callback---------------//\nHookmsg_API LRESULT CALLBACK Hookmsg(int ncode,WPARAM wparam,LPARAM lparam){\n    //if(ncode&gt;=0) //\n    if(ncode&lt;0)\n        return CallNextHookEx(hook,ncode,wparam,lparam);\n    MSG *msg;\n    msg=(MSG *)lparam;\n    WORD newVK,oldVK;\n    WORD newSC,oldSC;\n\n    if(ncode==HC_ACTION)\n    {\n        if((msg-&gt;message == WM_KEYUP))//Check whether key was pressed(not released).)\n        { \n            oldVK=msg-&gt;wParam;\n            oldSC=SCANCODE(msg-&gt;lParam);\n            bool extendkey=false;\n            if(((HIWORD(msg-&gt;wParam) &amp; 0x0100) == 0x0100))\n            {\n                extendkey=true;\n            }\n            if(!extendkey)\n            {\n                bool modif=true;\n                switch(oldVK)//wparam\n                {\n                    case VK_INSERT: newVK=VK_NUMPAD0; break;\n                    case VK_END: newVK=VK_NUMPAD1; break;\n                    case VK_DOWN: newVK=VK_NUMPAD2; break;\n                    case VK_NEXT: newVK=VK_NUMPAD3; break;\n                    case VK_LEFT: newVK=VK_NUMPAD4; break;\n                    case VK_CLEAR: newVK=VK_NUMPAD5; break;\n                    case VK_RIGHT: newVK=VK_NUMPAD6; break;\n                    case VK_HOME: newVK=VK_NUMPAD7; break;\n                    case VK_UP: newVK=VK_NUMPAD8; break;\n                    case VK_PRIOR: newVK=VK_NUMPAD9; break;\n                    case VK_DELETE: newVK=VK_DECIMAL; break;\n                    default: modif=false;\n                }\n                if(modif==true)\n                {\n\n                    msg-&gt;wParam = VK_NUMPAD0;\n                    UINT newSC=MapVirtualKey(VK_NUMPAD0,MAPVK_VK_TO_VSC);\n                    msg-&gt;lParam &amp;= 0xFF00;\n                    msg-&gt;lParam += (newSC &lt;&lt; 16 );\n                    //MessageBox( NULL, TEXT(\"OK\"), TEXT(\"Error!\"), MB_OK);\n                }\n            }\n\n        }\n    }\n    return ( CallNextHookEx(hook,ncode,wparam,lparam) );//pass control to next hook in the hook chain.\n}\n</code></pre>\n"},{"tags":["c","winapi","tabs","wm-paint","updown"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12455031,"title":"tab control and its up-down control receive non-stop WM_PAINT message","body":"<p>I created a window as:</p>\n\n<pre><code>HWND hwnd = CreateWindowEx(\n    WS_EX_COMPOSITED,\n    ClassName, NULL,\n    WS_CHILD | WS_CLIPCHILDREN | WS_CLIPSIBLINGS,\n    100, 100, 100, 100,\n    hwndPanel, NULL,\n    ghinst, NULL);\n</code></pre>\n\n<p>And I created a tab control for it:</p>\n\n<pre><code>HWND hwndTab = CreateWindowEx(\n    NULL,\n    WC_TABCONTROL,\n    NULL,\n    WS_CLIPCHILDREN | WS_CLIPSIBLINGS | WS_CHILD | TCS_FOCUSNEVER | TCS_HOTTRACK | TCS_FIXEDWIDTH,\n    0, 0, 100, 25,\n    hwnd,\n    NULL,\n    ghinst,\n    NULL);\n</code></pre>\n\n<p>But when I add more items so that the up-down child control of tab control appears, both tab control and up-down control don't stop receiving WM_PAINT message.</p>\n\n<p>If I remove WS_EX_COMPOSITED style for hwnd, then no such problem.</p>\n\n<p>For tab control, most of the message is:</p>\n\n<pre><code>&lt;12054&gt; 00720540 S WM_ERASEBKGND hdc:F2011CF3\n&lt;12055&gt; 00720540 R WM_ERASEBKGND fErased:True\n&lt;12056&gt; 00720540 R WM_PAINT\n&lt;12057&gt; 00720540 S WM_PAINT hdc:00000000\n&lt;12058&gt; 00720540 S WM_ERASEBKGND hdc:5101101A\n&lt;12059&gt; 00720540 R WM_ERASEBKGND fErased:True\n&lt;12060&gt; 00720540 R WM_PAINT\n&lt;12061&gt; 00720540 S WM_PAINT hdc:00000000\n&lt;12062&gt; 00720540 S WM_ERASEBKGND hdc:0C011019\n&lt;12063&gt; 00720540 R WM_ERASEBKGND fErased:True\n&lt;12064&gt; 00720540 R WM_PAINT\n&lt;12065&gt; 00720540 S WM_PAINT hdc:00000000\n</code></pre>\n\n<p>For up-down control, it is :</p>\n\n<pre><code>&lt;11720&gt; 00BA01E0 S WM_NCPAINT hrgn:00000001\n&lt;11721&gt; 00BA01E0 R WM_NCPAINT\n&lt;11722&gt; 00BA01E0 S WM_ERASEBKGND hdc:5101101A\n&lt;11723&gt; 00BA01E0 R WM_ERASEBKGND fErased:True\n&lt;11724&gt; 00BA01E0 R WM_PAINT\n&lt;11725&gt; 00BA01E0 S WM_PAINT hdc:00000000\n&lt;11726&gt; 00BA01E0 S WM_NCPAINT hrgn:00000001\n&lt;11727&gt; 00BA01E0 R WM_NCPAINT\n&lt;11728&gt; 00BA01E0 S WM_ERASEBKGND hdc:0C011019\n&lt;11729&gt; 00BA01E0 R WM_ERASEBKGND fErased:True\n&lt;11730&gt; 00BA01E0 R WM_PAINT\n&lt;11731&gt; 00BA01E0 S WM_PAINT hdc:00000000\n</code></pre>\n\n<p>How can I prevent WM_PAINT is generated in this case?</p>\n"},{"tags":["c","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12452992,"title":"Сan not create anonymous pipe / CreatePipe","body":"<p>Good day!!!</p>\n\n<p>I'm not good at programming. So please help.</p>\n\n<p>There are two applications written in winapi.\nI need by anonymous pipe to transfer from parent to the child content editbox.\nTask: when you enter editbox parent to editbox a child.</p>\n\n<p>I have a problem with it for transfer.\nLook, please, and give advice how to implement this.\nThanks in advance.</p>\n\n<p>The parent - <a href=\"http://pastie.org/4735732\" rel=\"nofollow\">http://pastie.org/4735732</a></p>\n\n<p>Child process - <a href=\"http://pastie.org/4735731\" rel=\"nofollow\">http://pastie.org/4735731</a></p>\n"},{"tags":["c#",".net","windows","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":3,"view_count":82,"score":-2,"question_id":12186790,"title":"Reboot and open all previously open files","body":"<p>My application needs to save the state of a number of applications on system, including: </p>\n\n<ul>\n<li>All URL's opened in browsers</li>\n<li>All documents open in document editors</li>\n<li>As many types of documents of other known (and unknown?) types as possible</li>\n</ul>\n\n<p>The goal being that a pc could be restarted and then re-open the list of files that were open prior to the reboot. </p>\n\n<p>I realize there is state involved in applications that will not be restored, but that is beyond the scope of what I need to be concerned with. </p>\n\n<p>I've seen that IE can be accessed using automation to enumerate the url's of all the open windows, so IE is not difficult to do this with. I assume MS office documents can be handled the same way.</p>\n\n<p>But beyond these, I would like to find out if there are: </p>\n\n<ul>\n<li><p>Standard Windows api's for finding the documents currently open in various applications. For instance, when windows forces a reboot after installing update, it attempts to do this exact thing- store open doc state and restore it after reboot. Is there a windows api to accomplish this?</p></li>\n<li><p>Any recommended \"nonstandard\" way of detecting these files- possibly by enumerating the files held open by visible window applications, and then detect which of these files are actual document types. </p></li>\n</ul>\n"},{"tags":["windows","winapi","visual-c++","gdi+","gdi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12451847,"title":"How to change combobox to ownerdraw at runtime?","body":"<p>I'd like to change a combobox control to owner-draw at runtime. In the resource script the control is layed out as a standard control.</p>\n\n<p>I've experimented with setting the style bits to CBS_OWNERDRAW | CBS_HASSTRINGS but somehow this does not help.</p>\n\n<p>Before doing subclass, set window style..</p>\n\n<pre><code>    // turn to ownerdraw\nDWORD dwStyle = ::GetWindowLong(hwnd, GWL_STYLE);\ndwStyle |= CBS_OWNERDRAWVARIABLE | CBS_HASSTRINGS;\nSetWindowLong(hwnd, GWL_STYLE, dwStyle);\n</code></pre>\n\n<p>Does anybody know the trick?</p>\n"},{"tags":["winapi","visual-c++","spotify","handle"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":98,"score":0,"question_id":12449760,"title":"SendMessage() to Spotify not working (C++)","body":"<p>I want to send <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms646275%28v=vs.85%29.aspx\" rel=\"nofollow\">WM_APPCOMMAND</a> to Spotify using C++</p>\n\n<p>My current code looks like that:</p>\n\n<pre><code>DWORD dwThreadId = GetCurrentThreadId();\nHDESK hDesktop = GetThreadDesktop(dwThreadId);\nEnumWindows((WNDENUMPROC)&amp;WndEnumProc, 0);\n</code></pre>\n\n<p>There is also:</p>\n\n<pre><code>BOOL CALLBACK Remote::WndEnumProc(HWND hwnd, LPARAM lParam) \n{\n    TCHAR className[MAX_PATH];\n    GetClassName(hwnd, className, sizeof(className));\n    string name = className;\n    if (name.compare(\"SpotifyMainWindow\") == 0) {\n        cout &lt;&lt; SendMessage(hwnd, WM_APPCOMMAND, 0, APPCOMMAND_MEDIA_PLAY_PAUSE) &lt;&lt; name &lt;&lt; endl;\n    }\n    return TRUE; \n}\n</code></pre>\n\n<p>Header-File:</p>\n\n<pre><code>class Remote\n{\npublic:\n    static BOOL CALLBACK WndEnumProc(HWND, LPARAM);\n};\n</code></pre>\n\n<p>The problem is that it returns <strong>0SpotifyMainWindow</strong>.\nIt prints 1 or 0 (return value of of SendMessage()) and the class of the handle. All in all it means that it tries to send the message to SpotifyMainWindow but is not able.</p>\n\n<p>How to solve this?</p>\n"},{"tags":["windows","winapi","windows-installer"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12412515,"title":"What does the MsiVerifyPackage WinAPI function do to verify an MSI?","body":"<p>The Windows documentation states that the MsiVerifyPackage function verifies that a file is an installation package. How much is verified here? If a byte in a content file is corrupted/incorrect, will this be caught? Or is it just a check that the MSI data is readable?</p>\n\n<p>The MSDN page for the function is here: <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa370508(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/aa370508(v=vs.85).aspx</a></p>\n"},{"tags":["c++","winapi","lnk2019","tchar"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":110,"score":0,"question_id":12446404,"title":"TCHAR and unresolved external symbol (LNK2019) error in C++ program?","body":"<p>My project has two cpp files and one header file. One cpp file contains the implementation of a single class and its declaration is in the header file. The other cpp file is which contains the <code>int main</code> function.</p>\n\n<p>One of the constructors of the class includes a <code>TCHAR</code> parameter and it is cited as the unresolved function in <code>LNK2019</code> linker error.</p>\n\n<p>I'm using visual studio 2010 and I have set the <code>Character set</code> option in the project properties to <code>Not Set</code> so that I can choose between <code>char</code> and <code>wchar_t</code> using <code>UNICODE</code> and <code>_UNICODE</code> macros.</p>\n\n<p>Currently I have defined these in the beginning of my main cpp file and the header files are included after those two. However, if I define these macros in the beginning of header file, the project compiles perfectly.</p>\n\n<p>Is there anyway to solve this issue ? Or do I have to hard code the class to use either <code>char</code> or <code>wchar_t</code> ?</p>\n\n<p>Thanks.</p>\n"},{"tags":["wpf","winapi","clr"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12447236,"title":"How to receive Win32 Messages from WPF windows hosted in Win32?","body":"<p>I have loaded a WPF window in my Win32 application:</p>\n\n<pre><code>case WM_INITDIALOG:\n    {\n        System::Windows::Interop::HwndSourceParameters p;\n        p.WindowStyle = WS_VISIBLE | WS_CHILD;\n        p.PositionX = 100;\n        p.PositionY = 100;\n        p.Width = 600;\n        p.Height = 600;\n        p.ParentWindow = System::IntPtr(hDlg);\n        Globals::source = gcnew System::Windows::Interop::HwndSource(p);        \n        Globals::source-&gt;RootVisual = gcnew MyControl();\n        return TRUE;\n    }\n</code></pre>\n\n<p>Now i want to handle WPF window events by receiving win32 messages in my application.\nHow can i do this?</p>\n"},{"tags":["c++","winapi","bitmap","structure"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":12446715,"title":"HBITMAP/BITMAP to BITMAPINFOHEADER -> over network - > BITMAPINFOHEADER to HBITMAP/BITMAP","body":"<p>I think the title is very much explanatory but here's a bit more detail what I'm trying to do.\nBasically say I have a <strong>BITMAP loaded in Memory.</strong></p>\n\n<p><strong>I would like to extract the BITMAPINFOHEADER from it</strong> and add it to my packet structure which will be transferred over a socket.*</p>\n\n<p><em>Transferring it is not a problem, but once it arrives I'd like to <strong>turn it back into a BITMAP so that I can work with it.</em></strong></p>\n\n<p>I've been struggling with this and I've searched high and low without any luck. An example and a list of functions I will need to accomplish this would be helpful.</p>\n\n<p>Many thanks. I need this in win32 c++. [no .NET or MFC]\nAppreciated.</p>\n"},{"tags":["c++","windows","delphi","winapi","delphi-2009"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":242,"score":3,"question_id":12437359,"title":"How to inject a DLL into a Delphi program","body":"<p>I have a legacy application, which contains a grid with data I need to extract.</p>\n\n<p>I don't have the code for that application and it is impossible to get the data out of it with normal means (like programmatically selecting all cells and copying them into clipboard).</p>\n\n<p>So I decided to use DLL injection as described in section \"II. The CreateRemoteThread &amp; LoadLibrary Technique\" at</p>\n\n<p><a href=\"http://www.codeproject.com/Articles/4610/Three-Ways-to-Inject-Your-Code-into-Another-Proces\" rel=\"nofollow\">http://www.codeproject.com/Articles/4610/Three-Ways-to-Inject-Your-Code-into-Another-Proces</a></p>\n\n<p>My plan is</p>\n\n<ol>\n<li>To load a DLL into the address space of the legacy application.</li>\n<li>Make the DLL read the data from the grid and write them out (e. g. via a named pipe).</li>\n</ol>\n\n<hr>\n\n<p>The first step is to inject the DLL into the address space of the legacy application (step a) above).</p>\n\n<p>I've written following code for that:</p>\n\n<pre><code>int  InjectDll            (HANDLE hProcess);\n\nint _tmain(int argc, _TCHAR* argv[])\n{\n    printf(\"DllInjector\\n\");\n\n    /**\n     * Find out PID of the legacy application (START)\n     */\n    HWND windowHandle = FindWindowW(NULL, L\"FORMSSSSS\");\n    DWORD* processID = new DWORD;\n    GetWindowThreadProcessId(windowHandle, processID);\n\n    DWORD delphiAppProcessId = *processID;\n    /**\n     * Find out PID of the legacy application (END)\n     */\n\n    printf(\"Process ID of legacy app: %lu\\n\", delphiAppProcessId);\n\n    // Now we need the handle of the legacy app\n    HANDLE hProcess = OpenProcess(\n    PROCESS_CREATE_THREAD | PROCESS_QUERY_INFORMATION | PROCESS_VM_OPERATION | PROCESS_VM_WRITE | PROCESS_VM_READ,\n    FALSE, delphiAppProcessId);\n\n    if (hProcess != NULL)\n    {\n        printf(\"Found handle, ready for injection\\n\");\n        int result = InjectDll(hProcess);\n        CloseHandle( hProcess );\n        printf(\"Injection complete, result=%d\\n\", result);\n\n    }\n    else\n    {\n        printf(\"Handle not found\\n\");\n    }\n\n    system(\"pause\");\n\n    return 0;\n}\n\nint InjectDll( HANDLE hProcess )\n{\n    HANDLE hThread;\n    const char* const szLibPath = \"D:\\\\mycompany\\\\SampleDll\\\\Debug\\\\SampleDll.dll\";\n    void*  pLibRemote = 0;  // the address (in the remote process) where\n                            // szLibPath will be copied to;\n    DWORD  hLibModule = 0;  // base adress of loaded module (==HMODULE);\n\n    HMODULE hKernel32 = ::GetModuleHandle(L\"Kernel32\");\n\n    // 1. Allocate memory in the remote process for szLibPath\n    // 2. Write szLibPath to the allocated memory\n    pLibRemote = ::VirtualAllocEx( hProcess, NULL, sizeof(szLibPath), MEM_COMMIT, PAGE_READWRITE );\n    if( pLibRemote == NULL )\n        return false;\n    ::WriteProcessMemory(hProcess, pLibRemote, (void*)szLibPath,sizeof(szLibPath),NULL);\n\n    // Load \"LibSpy.dll\" into the remote process \n    // (via CreateRemoteThread &amp; LoadLibrary)\n    hThread = ::CreateRemoteThread( hProcess, NULL, 0,  \n                    (LPTHREAD_START_ROUTINE) ::GetProcAddress(hKernel32,\"LoadLibraryA\"), \n                    pLibRemote, 0, NULL );\n    if( hThread == NULL )\n        goto JUMP;\n\n    ::WaitForSingleObject( hThread, INFINITE );\n\n    // Get handle of loaded module\n    ::GetExitCodeThread( hThread, &amp;hLibModule );\n    ::CloseHandle( hThread );\n\nJUMP:   \n    ::VirtualFreeEx( hProcess, pLibRemote, sizeof(szLibPath), MEM_RELEASE );\n    if( hLibModule == NULL ) // (1)\n        return false;\n\n\n    // Unload \"LibSpy.dll\" from the remote process \n    // (via CreateRemoteThread &amp; FreeLibrary)\n    hThread = ::CreateRemoteThread( hProcess,\n                NULL, 0,\n                (LPTHREAD_START_ROUTINE) ::GetProcAddress(hKernel32,\"FreeLibrary\"),\n                (void*)hLibModule,\n                 0, NULL );\n    if( hThread == NULL )   // failed to unload\n        return false;\n\n    ::WaitForSingleObject( hThread, INFINITE );\n    ::GetExitCodeThread( hThread, &amp;hLibModule );\n    ::CloseHandle( hThread );\n\n    // return value of remote FreeLibrary (=nonzero on success)\n    return hLibModule;\n}\n</code></pre>\n\n<p>Some comments:</p>\n\n<ol>\n<li>The legacy program has the title \"FORMSSSSS\".</li>\n<li>The sample DLL has following DllMain method:</li>\n</ol>\n\n<p>-</p>\n\n<pre><code>BOOL APIENTRY DllMain( HMODULE hModule,\nDWORD  ul_reason_for_call,\nLPVOID lpReserved\n\n{\n    OutputDebugStringA(\"DllMain called: \");\n    switch (ul_reason_for_call)\n    {\n    case DLL_PROCESS_ATTACH:\n        OutputDebugStringA(\"DLL_PROCESS_ATTACH\\n\");\n    case DLL_THREAD_ATTACH:\n        OutputDebugStringA(\"DLL_THREAD_ATTACH\\n\");\n    case DLL_THREAD_DETACH:\n        OutputDebugStringA(\"DLL_THREAD_DETACH\\n\");\n    case DLL_PROCESS_DETACH:\n        OutputDebugStringA(\"DLL_PROCESS_DETACH\\n\");\n        break;\n    }\n    return TRUE;\n}\n</code></pre>\n\n<p>When it is called, a text is written into the standard output of the application.</p>\n\n<hr>\n\n<p>When I run the program above (the one with _tmain method), I expect to see the text</p>\n\n<pre><code>DllMain called: DLL_PROCESS_ATTACH\n</code></pre>\n\n<p>in the console output (it means that the DLL injection was successful).</p>\n\n<p>But it doesn't happen.</p>\n\n<hr>\n\n<p>One potential cause is that the PID of the legacy application is determined incorrectly:</p>\n\n<pre><code>HWND windowHandle = FindWindowW(NULL, L\"FORMSSSSS\");\nDWORD* processID = new DWORD;\nGetWindowThreadProcessId(windowHandle, processID);\n\nDWORD delphiAppProcessId = *processID;\n</code></pre>\n\n<p>But the value delphiAppProcessId is the same as the PID displayed in the task manager, so I can exclude this potential bug.</p>\n\n<hr>\n\n<p>Using the debugger I found out that the execution stops at the line with comment (1):</p>\n\n<pre><code>JUMP:   \n    ::VirtualFreeEx( hProcess, pLibRemote, sizeof(szLibPath), MEM_RELEASE );\n    if( hLibModule == NULL ) // (1)\n        return false;\n</code></pre>\n\n<p>What do I need to change in order for the sample DLL to be injected into the address space of the application with title \"FORMSSSSS\" ?</p>\n\n<p><strong>Update, 16.09.2012:</strong></p>\n\n<p>I replaced all occurrences of</p>\n\n<p>sizeof(szLibPath)</p>\n\n<p>by pathLength, where </p>\n\n<p>const int pathLength = strlen(szLibPath)+1;</p>\n\n<p>Now, in</p>\n\n<pre><code>    ::WaitForSingleObject( hThread, INFINITE );\n    ::GetExitCodeThread( hThread, &amp;hLibModule );\n    ::CloseHandle( hThread );\n\n    // return value of remote FreeLibrary (=nonzero on success)\n    return hLibModule;\n}\n</code></pre>\n\n<p>hLibModule is nonzero, which means that the injection was successful.</p>\n\n<p>But I still can't see the log output of the sample DLL in the output of the program.</p>\n\n<p><strong>Update, 16.09.2012 (2):</strong></p>\n\n<p>When I</p>\n\n<p>a) add a call to AllocConsole() in DllMain of the sample DLL,\nb) rebuild it and \nc) execute the injecting program, </p>\n\n<p>then a console window appears, which has the same icon as the Delphi application.</p>\n\n<p>When I remove AllocConsole from the DllMain function, and execute the injecting application, the console window does not appear.</p>\n\n<p>So the injection might actually work.</p>\n"},{"tags":["windows","winapi","shell-extensions","alternate-data-stream"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":289,"score":2,"question_id":9032774,"title":"Windows Explorer Alternate Data Stream Shell Extension","body":"<p>I have some files that use alternate data stream and are not shown on windows explorer. I would like to make a shell extension or a program that runs on background that when I use windows explorer and navigates to a folders that has alternate data streams files, to show this file to windows explorer but with an overlay icon on it.</p>\n\n<p>Is this possible? Is there a sample code to check?</p>\n\n<p>Thanks a lot.</p>\n"},{"tags":["winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12440339,"title":"Win32 API : How to find inactive windows","body":"<p>I'm going to find <em>inactive</em> windows using win32 api and to close them. By an <em>inactive</em> window I mean <strong>a window that is left around for a while without any usage and without any opportunity to get focused</strong> . Sometimes when you are working with, for example photoshop, visual studio, MSDN and many explorer windows which have been left opened without any usage when you look at your taskbar you find your task-bar full of titles ! I want to write a program using win32 api to close unusable windows. How can I find such a window? Thanks !\n<strong>Edit: so let's define an unusable window, a window which has been minimized for 10 minutes.</strong></p>\n"},{"tags":["c++","visual-studio","debugging","winapi","screensaver"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12442914,"title":"Woes trying to debug a screensaver in MS Visual Studio 2008","body":"<p>I'm debugging a screensaver (written in C++ and liked to ScrnSavw.lib) and I need to run it through a local VS 2008 debugger. I managed to comment out screen rendering part so that I can see the screen but I can't seem to get the mouse out. It stays hidden. Any idea how to get the mouse back to working state so that I can use in VS2008 debugger window?</p>\n\n<p>PS. I can't use remote debugger because the screensaver needs to run on this local system with VS2008 installed on it.</p>\n"},{"tags":["c","windows","winapi","gcc","mingw"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12440240,"title":"ld.exe: cannot find -ISDL_image, -ISDL_mixer, -ISDL_ttf","body":"<p>I'm trying to compile GnuRobbo 0.66 using MinGW. It's written in C and uses SDL. After typing <code>make</code> it does something and then quits with these:</p>\n\n<p><code>c:/mingw/bin/../lib/gcc/mingw32/4.7.0/../../../../mingw32/bin/ld.exe: cannot find -lSDL_image</code></p>\n\n<p><code>c:/mingw/bin/../lib/gcc/mingw32/4.7.0/../../../../mingw32/bin/ld.exe: cannot find -lSDL_mixer</code></p>\n\n<p><code>c:/mingw/bin/../lib/gcc/mingw32/4.7.0/../../../../mingw32/bin/ld.exe: cannot find -lSDL_ttf</code></p>\n\n<p><code>collect2.exe: error: ld returned 1 exit status</code></p>\n\n<p><code>make: *** [gnurobbo] Error 1</code></p>\n\n<p>Could anyone tell me what I am doing wrong? I would greatly appreciate :)</p>\n"},{"tags":["c#","winapi","dll","verify","self-signed"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":128,"score":1,"question_id":12438206,"title":"Self-signed Win32 DLL verify signature from C#","body":"<p>I have a partner, who has a private+public key generated with a linux openssl tool. He digitally (self) signs his win32 dll with the windows signtool.exe utility. In my C# program I must check if a given win32 dll is signed by him or not. What I have is the DLL, and his public key as a string (maybe I can get his cert file). I am not soo good at how it's work in real. Should I add this .cert file to the trusted certificate store, and check normally like in <a href=\"http://stackoverflow.com/questions/6596327/how-to-check-if-a-file-is-signed-in-c\">How to check if a file is signed in C#?</a> or should I change something? I can't really understand what \"wintrust_action_generic_verify_v2\" guid is for, and what different checks exist anyway. Should I write a new verification chain, or use another policy? Please help me with some advice...</p>\n"},{"tags":["c","winapi","save","wav"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12438115,"title":"how to save audio data in memory as a wav file?","body":"<p>When an application calls <code>waveOutWrite(HWAVEOUT hwo, LPWAVEHDR pwh, UINT cbwh)</code> on windows, I save a copy of the audio data (pointed to by pwh->lpData) sent to the Audio Card in memory.</p>\n\n<p>Now I want to save the audio data as a WAV format file on the disk, how should I do this?  </p>\n\n<p>I have the pointer to the audio data block and the size of the audo data.</p>\n"},{"tags":["c","windows","winapi","unicode"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":132,"score":2,"question_id":12434722,"title":"How to test my application is UNICODE Compatible or not?","body":"<p>I apologise if it is a silly question..I recently developed an application in windows with C and WinApi. I am in need to check whether application is UNICODE compatible or not. How can I test my machine? Is there any procedure followed to check UNICODE Compatibility. More over I dont have a chinese language machine or any other languages. I want this test to be done in my machine in which language is by default English.</p>\n\n<p>Please provide some links if possible or a detailed procedure.</p>\n"},{"tags":["c++","windows","winapi","registry"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12384149,"title":"How to separate a executing path to file path and parameter?","body":"<p>There are such lines as</p>\n\n<pre><code>C:\\Program Files\\Realtek\\Audio\\HDA\\RAVCpl64.exe -s\n</code></pre>\n\n<p>in the registry key</p>\n\n<pre><code>HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\n</code></pre>\n\n<p>Now I want to separate the absolute path and parameters from the line.</p>\n\n<p>If the line is </p>\n\n<pre><code>C:\\Space Dir\\Dot.Dir\\Sample Name.Dot.exe param path.\"C:\\Space Dir\\Dot.Dir\\Sample Name.Dot.exe\"\n</code></pre>\n\n<p>Which separator should I use to deal with this line? Is there any Windows API function to solve this problem?</p>\n"},{"tags":["windows","winapi","dpapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12427138,"title":"Windows credential roaming - how are password protected keys sent to the AD server?","body":"<p>I'm trying to figure out how to Windows credential roaming is implemented. I have found that it will roam certs that have been strongly protected with a password (optional entropy to CryptProtectData()). </p>\n\n<p>I can't see how this could be done unless Windows keeps a copy of the password somewhere when the cert is imported. Copying the files in %APPDATA%/Crypto/RSA{UserSID} to another machine would not work as the keys are encrypted with the users DPAPI master key and optionally a password.</p>\n\n<p>Other than using ProcMon and I have no idea what else to try or look at in order to figure this out. Any pointers to help figure this out would be much appreciated!  </p>\n"},{"tags":["winapi","visual-studio-2008","visual-c++-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":33,"score":-1,"question_id":12419370,"title":"Function does not perform as expected","body":"<p>Code bellow is written in Visual Studio 2008 (C++), Win32Application. </p>\n\n<p>What I try to do is that after clicking on <em>button1</em> first write <strong>Some text</strong> to <em>textBox1</em>, and then after the someFunctionThatReturnString() return String add more <strong>text</strong> to <em>textBox1</em>.</p>\n\n<p>The problem is that execution of the function is not like I have planed. \nAfter clicking on <em>button1</em> program block until someFunctionThatReturnsString() return String and then write <strong>Some text</strong> +  someFunctionThatReturString() return <strong>value</strong>.</p>\n\n<pre><code>private: System::Void button1_Click(System::Object^  sender, System::EventArgs^  e) \n{\n        textBox1-&gt;Text = \"Some text\"; \n        textBox1-&gt;Text += someFunctionThatReturnString();\n}\n</code></pre>\n"},{"tags":["c++","winapi","com","ole"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":12431314,"title":"Getting specific COM server instance","body":"<p>Say I have multiple .exe files that register COM IClassFactories for a certain IID through <code>CoRegisterClassObject</code> function and specify <code>REGCLS_MULTI_SEPARATE</code> flag in the <code>flags</code> parameter.</p>\n\n<p>Is there a way for a client trying to get an instance of the exposed interface to specify what process I want it to get that instance from? So far in my experiments when I was calling <code>CoCreateInstance</code> it was giving me a pointer to an instance from the longest running LocalServer exposing the requested interface.</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":2,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":214,"score":6,"question_id":11839588,"title":"Extract high resolution icon or thumbnail for file","body":"<p>I'm trying to get a high resolution icon or thumbnail in Windows given a full path to that file. Doesn't <em>need</em> to be a thumbnail — a good looking Icon will be great. I Don't care if it's an <code>HICON</code> or an <code>HBITMAP</code>: I'm going to put it in a GDI+ object and render it into a device context.</p>\n\n<p>I've tried using <code>SHGetFileInfo</code> (with various variations on flags), but never get more than a ~32x32 icon back, which scales horribly to the 128 pixels or so that I need.</p>\n\n<pre><code>if (!SHGetFileInfoW(path, 0, &amp;fi, sizeof(fi),\n                    SHGFI_ICON | SHGFI_ICONLARGE | SHGFI_TYPENAME))\n    return GetLastError();\n\n// fi.hIcon is a valid icon here, but it's horrible quality with\n// a black mask on it. I want higher quality, and dare I dream of\n// alpha channel? Mask is acceptable, i suppose.\n</code></pre>\n\n<p><code>SHGetFileInfo</code> returns <code>\"\"</code> when I call with <code>SHGFI_ICONLOCATION</code> (which appears to be a known problem with that API).</p>\n\n<p>I've also tried using <code>SHCreateItemFromParsingName</code> name with the intention of getting <code>IThumbnailProvider</code>, but <code>BindToHandler</code> always returns <code>E_NOTIMPL</code> for <code>BHID_ThumbnailHandler</code> ...</p>\n\n<pre><code>IShellItem *psi;\nhr = SHCreateItemFromParsingName(path, NULL, IID_PPV_ARGS(&amp;psi));\nif (SUCCEEDED(hr))\n{\n    IThumbnailProvider *pThumbProvider;\n    hr = psi-&gt;BindToHandler(NULL, BHID_ThumbnailHandler,\n                            IID_PPV_ARGS(&amp;pThumbProvider));\n    if (SUCCEEDED(hr))\n    { \n    // never get here because hr == E_NOTIMPL !!!\n</code></pre>\n\n<p>I've actually run the Microsoft <a href=\"http://archive.msdn.microsoft.com/shellapplication\">Thumbnail Providers Sample</a> and found that it suffers from the same problem with <code>BindToInterface</code>.</p>\n\n<p>So, any suggestions on what else I could try? I just want something picture-y that more or less represents this file at, say, at least 100px size — just anything better than 32x32 ...</p>\n"},{"tags":["c#","winapi","keylistener","keylogger"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":114,"score":0,"question_id":12428766,"title":"GetAsyncKeyState and ToUnicodeEx and VirtualKeys","body":"<p>I have the folloing code on a C# application, and I'm trying to get all keys pressed and write them on a string.\nThe problema that I'm having is that if a press Shift+L or Shift+1 the ToUnicodeEx retrieves a lowercase l or a number 1, when I'm expecting an uppercase L and an ! point.\nDoes anyone have a clue why? I've tried a lot of options with the parameters on the function ToUnicodeEx, but without luck.\nI've based this code from this post:\n<a href=\"http://stackoverflow.com/questions/6237250/getasynckeystate-and-virtualkeys-special-characters-using-jna-java\">GetAsyncKeyState and VirtualKeys/special characters using JNA (JAVA)</a></p>\n\n<p>Thanks in advance!</p>\n\n<pre><code>        ...\n    while (true)\n    {\n        foreach (System.Int32 i in Enum.GetValues(typeof(Keys)))\n        {\n            Keys key = (Keys)i;\n\n            bool pressed = (GetAsyncKeyState(key) == Int16.MinValue);\n\n            if (_keyState[key] &amp;&amp; !pressed)\n            {\n                s += VKCodeToUnicode((uint)key);\n            }\n\n            _keyState[key] = pressed;\n        }\n\n        Thread.Sleep(10);\n    }\n    ...\n\n    private static string VKCodeToUnicode(uint VKCode)\n    {\n        System.Text.StringBuilder sbString = new System.Text.StringBuilder(5);\n\n        byte[] bKeyState = new byte[255];\n        bool bKeyStateStatus = GetKeyboardState(bKeyState);\n        if (!bKeyStateStatus)\n            return \"\";\n\n        IntPtr handle = GetForegroundWindow();\n        uint procId;\n        uint thread = GetWindowThreadProcessId(handle, out procId);\n\n        IntPtr keyboardLayout = GetKeyboardLayout(thread);\n        uint lScanCode = MapVirtualKeyEx(VKCode, MapVirtualKeyMapTypes.MAPVK_VSC_TO_VK, keyboardLayout);\n\n        ToUnicodeEx(lScanCode, lScanCode, bKeyState, sbString, 5, (uint)0, keyboardLayout);\n\n        return sbString.ToString();\n    }\n</code></pre>\n"},{"tags":["c++","c","multithreading","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":12425821,"title":"When is a thread actually terminated when calling TerminateThread?","body":"<p>If I terminate a thread on Windows using the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms686717%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>TerminateThread</code></a> function, is that thread actually terminated once the function returns or is termination asychnronous?</p>\n"},{"tags":["c++","c","winapi","sockets","tcp"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":471,"score":2,"question_id":10905714,"title":"How do I check if a TCP port is already being listened on?","body":"<p>I have a third party library that acts as a HTTP server. I pass it an address and port, which it then uses to listen for incoming connections. This library listens in such a way that it doesn't receive exclusive usage of the port and address it's bound to. As a result, I can listen on the same port multiple times.</p>\n\n<p>I need to run multiple instances of this HTTP server in the same process. Each instance has a default port, but if that port isn't available, it should use the next available port. This is where my problem is; I can end up with two HTTP servers listening on the same port.</p>\n\n<p>I cannot change the HTTP server's code and the HTTP server will not alert me if it cannot listen on the port I give it, so I have to be able to check if a port is already in use before starting each HTTP server. I have tried checking if a port is already being listened on by binding my own socket with SO_REUSEADDR set to FALSE and SO_EXCLUSIVEADDRUSE set to TRUE, but the bind and listen calls both succeed when an existing HTTP server is already listening on that port.</p>\n\n<p>How is this HTTP server achieving this effect, and how can I accurately check if a port is being listened on in this manner?</p>\n"},{"tags":["winapi","richedit","text-alignment","paragraphs"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":340,"score":1,"question_id":2809306,"title":"RichEdit, winapi - paragraph aligment","body":"<p>I would like to have a line aligned in such way, that some first words are aligned left and some last words are aligned right, but all are in the same line:</p>\n\n<pre><code>| text 1                           text2 |\n| Lorem ipsum             dolor sit amet |\n</code></pre>\n\n<p>Is that possibile? How can I do that? </p>\n"},{"tags":["c","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":49,"score":1,"question_id":12425710,"title":"Compiler error with win32 COORD structure?","body":"<p>I am trying to implement a progress bar for a console application in windows using Win32 Console API. My problem is that the compiler gives the error, <code>error C2059: syntax error : 'constant'</code>. The relevant code is as follows.</p>\n\n<pre><code>void updateBar(PBAR * pbr, float ratio){\n    COORD pos;\n    pos.X = 0;\n    pos.Y = 25;\n\n    SetConsoleCursorPosition(hConOut, pos);\n}\n</code></pre>\n\n<p><code>COORD</code> is the Win32 structure for denoting a co-ordinate pair. <code>hConOut</code> is a global variable and <code>PBAR</code> is a structure. Above error is given twice for two assignments (pos.X = 0 an pox.Y = 25). If I use the following, it compiles perfectly.</p>\n\n<pre><code>void updateBar(PBAR * pbr, float ratio){\n    COORD pos = {0, 25};\n    SetConsoleCursorPosition(hConOut, pos);\n}\n</code></pre>\n\n<p>I really can't understand the reason for this. I mean it's just an assignment to structure members, right ?? If I do something like <code>POINT pt; pt.x = 0; pt.y = 25</code>, it compiles perfectly. <code>POINT</code> is just another structure.</p>\n\n<p>I use visual studio 2010 on windows 7 and compiler is:</p>\n\n<p>Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 16.00.30319.01 for 80x86</p>\n\n<p>Any thoughts ?? Thanks in advance.</p>\n"},{"tags":["winapi","graphics","3d","2d"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12410502,"title":"how to vsync winapi drawings","body":"<p>I want to draw a frame number on my monitor screen sequentially</p>\n\n<blockquote>\n  <p>0 1 2 3 4 5 6 7 ...</p>\n</blockquote>\n\n<p>One number per one physical frame (100 times per second\non 100 Hz refresh rate monitor) Is it possible under\nwinapi/gdi? How to do it?</p>\n"},{"tags":["c++","winapi","console","processes","terminate"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12424380,"title":"How to end a process using C++?","body":"<p>I'm trying to create a C++ program  which ends a process. So starting from scratch, I'm not too sure which direction I should be heading? I mean based on the research I've done the solution involves these steps (let me know if it's incorrect logic):</p>\n\n<ol>\n<li><p>Get process name (in my case its always the same one)</p></li>\n<li><p>Iterate through all processes and find matching name (assuming this process has a unique name)</p></li>\n<li><p>Get the id and terminate it</p></li>\n</ol>\n\n<p>As I mentioned I don't have to worry about checking for duplicate process names since its assumed to be unique, but now I need guidance on what sort of library, classes etc I should be looking at?</p>\n"},{"tags":["c++","winapi","usb","hardware"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12422083,"title":"detecting presence of usb-printer programatically (prefered in C++) in Windows 7","body":"<p>I am looking for a way to detect if a special Lexmark printer is connected to PC (and is switched on), for asking the user to switch it off (or prefered switch off programmatically). \nIs there an API in Windows listing connected (not just installed) printers?</p>\n\n<p>Thank you very much!</p>\n\n<p>P.S: The background is, that Lexmark printer conflicts with a USB Camera (from \"The Imaging Source\")\ncorrupting the images and slowing down FPS considerably.</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":303,"score":1,"question_id":7072893,"title":"The problem of attachconsole","body":"<p>I need to make a windows GUI application can run in console, so I attach the console to the process when the application is invoked with a command line. However, after the application exit, the console prompt with the path doesn't show unless the ENTER key is pressed. Is there any way that the prompt with the path can directly show up without pressing the enter key? Thanks.</p>\n"},{"tags":["c++","windows","winapi","visual-c++","directshow"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12406095,"title":"graph builder is not released and render is in the background","body":"<p>I had some problems in my app \nI made an app that can detect the available webcams and render them \nwe can shift from one webcam to another at any time \nbut the problems is when i switch the new render is shown as main stream and the old chosen webcam is shown in the background </p>\n\n<p>Here is an image that shows the prob:</p>\n\n<p><img src=\"http://i.stack.imgur.com/1lOlF.png\" alt=\"enter image description here\"></p>\n\n<p>what i have done is releasing  the graphbuilder and reinit again with the new filter  it works but i'm not satisfied with this logic </p>\n\n<pre><code>MessageBox(NULL,\"this is the reload\",\"\",NULL);\nif(this-&gt;videoFilter){  this-&gt;videoFilter-&gt;Release();   this-&gt;videoFilter=NULL; }\nif(this-&gt;mediaEvent){   this-&gt;mediaEvent-&gt;Release(); this-&gt;mediaEvent=NULL;     }\nif(this-&gt;videoWindow){  this-&gt;videoWindow-&gt;Release(); this-&gt;videoFilter=NULL;   }\nif(this-&gt;mediaControl){ this-&gt;mediaControl-&gt;Release(); this-&gt;mediaControl=NULL; }\n    // and reallocate them \n</code></pre>\n"},{"tags":["winapi","pinvoke","createprocessasuser"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":962,"score":3,"question_id":5447418,"title":"why is CreateProcessWithTokenW failing with ERROR_ACCESS_DENIED","body":"<p>I have a call to CreateProcessWithTokenW that is failing with access denied.  Any ideas how to debug this?</p>\n\n<p>The call to CreateProcessWithTokenW is here: <a href=\"https://github.com/fschwiet/PShochu/blob/master/PShochu/PInvoke/NetWrappers/ProcessUtil.cs\" rel=\"nofollow\">https://github.com/fschwiet/PShochu/blob/master/PShochu/PInvoke/NetWrappers/ProcessUtil.cs</a></p>\n\n<p>For now I'm using a access token for the current process, eventually I'll use a token from another user.  For now then I'm using <a href=\"https://github.com/fschwiet/PShochu/blob/master/PShochu/PInvoke/NetWrappers/AccessToken.cs\" rel=\"nofollow\">https://github.com/fschwiet/PShochu/blob/master/PShochu/PInvoke/NetWrappers/AccessToken.cs</a> to get the access token.</p>\n\n<p>If you want to debug, pull down the sourcecode and run build_and_test.ps1.  The error stack is:</p>\n\n<pre><code>1) Test Error : PShochu.Tests.can_run_remote_interactive_tasks, given a psake script which writes the current process id to output, when that script is invoked interactively, then the script succeeds\n   System.ComponentModel.Win32Exception : Access is denied\n   at PShochu.PInvoke.NetWrappers.ProcessUtil.CreateProcessWithToken(IntPtr userPrincipalToken, String applicationName,\nString applicationCommand, Boolean dontCreateWindow, Boolean createWithProfile, StreamReader&amp; consoleOutput, StreamReader&amp; errorOutput) in c:\\src\\PShochu\\PShochu\\PInvoke\\NetWrappers\\ProcessUtil.cs:line 52\n   at PShochu.ProcessHandling.RunNoninteractiveConsoleProcessForStreams2(String command, String commandArguments, String&amp; newLine) in c:\\src\\PShochu\\PShochu\\ProcessHandling.cs:line 36\n   at PShochu.ProcessHandling.RunNoninteractiveConsoleProcess(String command, String commandArguments) in c:\\src\\PShochu\\PShochu\\ProcessHandling.cs:line 20\n   at PShochu.Tests.can_run_remote_interactive_tasks.&lt;&gt;c__DisplayClass16.&lt;&gt;c__DisplayClass18.&lt;Specify&gt;b__2() in c:\\src\\PShochu\\PShochu.Tests\\can_run_remote_interactive_tasks.cs:line 27\n   at NJasmine.Core.Execution.DescribeState.&lt;&gt;c__DisplayClass7`1.&lt;visitBeforeEach&gt;b__3() in c:\\src\\NJasmine\\NJasmine\\Core\\Execution\\DescribeState.cs:line 62\n</code></pre>\n\n<p>Later update:  I saw in some docs that additional privileges are needed (http://msdn.microsoft.com/en-us/library/aa374905%28v=vs.85%29.aspx).  I am having trouble getting tests to verify I have these individual securities (they are set in secpol.msc pre-reboot)</p>\n\n<pre><code>SE_ASSIGNPRIMARYTOKEN_NAME  \"Replace a process level token\"\nSE_TCB_NAME \"Act as part of the operatin system\"\nSE_INCREASE_QUOTA_NAME  \"Adjust memory quotas for a process\"\n</code></pre>\n\n<p>These tests keep telling me I don't have the permissions I've set in the UI, <a href=\"https://github.com/fschwiet/PShochu/blob/master/PShochu.Tests/verify_privileges.cs\" rel=\"nofollow\">https://github.com/fschwiet/PShochu/blob/master/PShochu.Tests/verify_privileges.cs</a> </p>\n"},{"tags":["c++","winapi","visual-c++"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1004,"score":1,"question_id":5800167,"title":"Displaying image in WIN32, Why its not displayed?","body":"<p>I want to load a BitMap image in a pic box I created inside a window...picBoxDisp is created using following mechanism..</p>\n\n<pre><code>picBoxDisp = CreateWindow(\"STATIC\", \"image box\",\n                      WS_VISIBLE |WS_CHILD | SS_BITMAP |WS_TABSTOP | WS_BORDER,\n                      50, 50, 250, 300, hwnd , (HMENU)10000, NULL, NULL);\n</code></pre>\n\n<p>Now Next I created a hBitmap object and loaded an image in to it...</p>\n\n<pre><code>hBitmap = (HBITMAP) LoadImage(NULL,szFileName,IMAGE_BITMAP,0,0,\n                              LR_LOADFROMFILE| LR_DEFAULTSIZE);\n\nSendMessage(picBoxDisp,STM_SETIMAGE,(WPARAM) IMAGE_BITMAP,(LPARAM) NULL);   \n//now assign the new image\n\n//Create a compatible DC for the original size bitmap, for example originalMemDc.\nHDC originalDC = GetDC((HWND)hBitmap);\nHDC originalMemDC = CreateCompatibleDC(originalDC);\nif(originalMemDC==NULL){\n    MessageBox(NULL,\"Problem while creating DC.\",\"Error\",MB_OK);\n}\n//Select hBitmap into originalMemDc.\nSelectObject(originalMemDC,hBitmap);\n\n//Create a compatible DC for the resized bitmap, for example resizedMemDc.\nHDC picBoxDC = GetDC(picBoxDisp);\nHDC resizedMemDC = CreateCompatibleDC(picBoxDC);\n\n//Create a compatible bitmap of the wanted size for the resized bitmap,\nHBITMAP hResizedBitmap = CreateCompatibleBitmap(picBoxDC,250,300);\n\n//Select hResizedBitmap into resizedMemDc.\nSelectObject(resizedMemDC,hResizedBitmap);\n\n//Stretch-blit from originalMemDc to resizedMemDc.\n//BitBlt(resizedMemDC,0,0,250,300,originalMemDC,0,0,SRCCOPY);\n\nBITMAP bmp_old,bmp_new;\nGetObject(hBitmap,sizeof(bmp_old),&amp;bmp_old);\nGetObject(hResizedBitmap,sizeof(bmp_new),&amp;bmp_new);\n\nStretchBlt ( resizedMemDC,0,0,bmp_new.bmWidth,bmp_new.bmHeight,\n            originalMemDC,0,0,bmp_old.bmWidth,bmp_new.bmHeight,\n            SRCCOPY);\n////De-select the bitmaps.\n\nif((resizedMemDC==NULL)||(hResizedBitmap == NULL)) {\n    MessageBox(NULL,\"Something is NULL\",\"Error\",MB_OK);\n}\nelse\n    //Set hResizedBitmap as the label image with STM_SETIMAGE\n    SendMessage(picBoxDisp,STM_SETIMAGE, (WPARAM) IMAGE_BITMAP,(LPARAM) hResizedBitmap);\n</code></pre>\n\n<p><strong>I just cant understand, why the above code is not working ?</strong></p>\n\n<p>Thanks in advance,                                  </p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":705,"score":4,"question_id":4910231,"title":"How to hook C++ in Explorer's rename event","body":"<p>I can't be clearer than my title. :P</p>\n\n<p>I want to run my program whenever a user renames a file in Windows Explorer (and only within the Explorer). Here's a simple mock up:</p>\n\n<p><img src=\"http://i.stack.imgur.com/0NYwe.png\" alt=\"Rename Hook Mockup\"></p>\n\n<p>A simple link to a tutorial will be very helpful. I couldn't find anything. :/</p>\n\n<p>Thank you in advance.</p>\n\n<p>P.S. I'm new in C++</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":150,"score":1,"question_id":12396016,"title":"CRITICAL_SECTION and avoiding including windows.h?","body":"<p>I have an interface declared like this:</p>\n\n<pre><code>    #if defined _WIN32 || _WIN64\n        typedef CRITICAL_SECTION MutexHandle;\n    #else\n        typedef pthread_mutex_t MutexHandle;\n    #endif\n\n    class IMutex\n    {\n    public:\n        enum MutexState\n        {\n            UNLOCKED = 0,\n            LOCKED\n        };\n\n        virtual ~IMutex() { }\n\n        virtual int32_t Lock() = 0;\n        virtual int32_t Unlock() = 0;\n\n        virtual const MutexState&amp; GetMutexState() const = 0;\n        virtual MutexHandle&amp; GetMutexHandle() = 0;\n    };\n</code></pre>\n\n<p>The problem is, I need to include windows.h for CRITICAL_SECTION definition;</p>\n\n<pre><code>#define WIN32_LEAN_AND_MEAN\n#include &lt;Windows.h&gt;\n#undef WIN32_LEAN_AND_MEAN\n</code></pre>\n\n<p>but dosn't this cause possible header include problems with others using the interface?</p>\n\n<p>How can I declare my typedef without having to include the whole windows.h?</p>\n\n<p>Thanks</p>\n"},{"tags":["c++","winapi","desktop","vlc"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":173,"score":4,"question_id":12416960,"title":"How does VLC play videos on the desktop?","body":"<p>A while back, I noticed that VLC has the ability to play videos directly on the desktop. When I did so at my school, on Windows XP, it played underneath the icons. When I tried at home, on Windows 7, it hid the icons. I'm not sure if it's the operating system or if it's an update of VLC, but I'm interested in playing it underneath the icons.</p>\n\n<p>After noticing this, I had an idea to make an animated desktop of sorts. Nothing special, just a few select videos for my own use. The idea I started with was to play a video in my own window (using <code>mciSendString</code>) and do a <code>PrintWindow</code> of each frame, save it to a file, and set the desktop wallpaper as the file. I've since lost the specific code, but it wasn't quite working, and, needless to say, would perform horribly. </p>\n\n<p>Coming back to it, I realized there must be a much more efficient way than that anyway, but I can't quite grasp what that is. </p>\n\n<p>I tried (all in Windows 7 now) setting the video's parent window to <code>GetDesktopWindow</code>, to the effect of minimizing all windows leaving behind a new window on the taskbar playing the video, but being able to see the desktop through clicking the aero peek button or hitting Win+D.</p>\n\n<p>I then tried the same with a parent window of the desktop's folder view window. The result was the same dimensioned window playing the video, but this time, the desktop could not be accessed, and no new window was created. It's like it was playing over top of most of the desktop, but the gadgets go over top and the areas toward the right and bottom still show due to the smaller playing window size. </p>\n\n<p>What does VLC do to play it on the desktop itself, looking as if it's a dynamic wallpaper? Is it significantly harder to make it play underneath the icons (and gadgets if you add in Windows 7, I suppose)? The program itself will be used on Windows XP. I'm not sure if DirectShow has anything that might help, but I'm willing to use it, among other Windows API areas besides just MCI. I'd prefer the solution to be in C++, if it makes a difference. .NET would also work well, but might take a bit of extra time working in.</p>\n"},{"tags":["winapi","windows-7"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":122,"score":0,"question_id":12398174,"title":"Stretching a desktop to 2 monitors in Windows 7","body":"<p>I am trying to stretch a desktop to two monitors using the ChangeDisplaySettingsEx function. I want the desktop resolution to be 3840x1080 instead of 1920x1080 resolution. I tried the following: </p>\n\n<pre><code> POINTL posPrimary={0};\n posPrimary.x=0\n posPrimary.y=0;\n\n DEVMODE mode_primary = {0};\n mode_primary.dmSize = sizeof(mode_primary);\n mode_primary.dmFields = DM_POSITION;\n mode_primary.dmPosition = posPrimary;\n mode_primary.dmPelsWidth = 3840;\n mode_primary.dmPelsHeight = 1080;\n\nLONG status = ChangeDisplaySettingsEx(\n    nameofMonitor,\n    &amp;mode_primary,\n    nullptr, // reserved\n   CDS_SET_PRIMARY | CDS_UPDATEREGISTRY,\n    nullptr // no video parameter\n);\n  if (DISP_CHANGE_SUCCESSFUL != status) {\n    printf(\"ChangeDisplaySettingsEx returned %d\", status);\n    return -__LINE__;\n}\n</code></pre>\n\n<p>I also tried the SetDisplayConfig function:</p>\n\n<pre><code>SetDisplayConfig(0,NULL,0,NULL,SDC_TOPOLOGY_CLONE|SDC_APPLY);\n</code></pre>\n\n<p>SDC_TOPOLOGY_CLONE just clones the monitors while SDC_TOPOLOGY_EXTEND extends the desktop to the second display. </p>\n\n<p>Any suggestions would be appreciated.</p>\n"},{"tags":["c++","windows","winapi","versioning"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":93,"score":5,"question_id":12405248,"title":"Getting application version from within application","body":"<p>Is there a simple way of obtaining the application version information from the resource file at runtime? </p>\n\n<p>Effectively what I'd like to do is be able to have a \"Version X.Y.Z\" displayed at runtime without having a separate variable somewhere that I'd have to keep in sync with my ProductVersion and FileVersion.</p>\n\n<p>To clarify: yes this is a standard C++ Windows project. I am aware of the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms647003%28v=vs.85%29.aspx\" rel=\"nofollow\">GetFileVersionInfo</a> method but it seems silly to have to open the binary from within the version in memory just to query the version information - I'm sure I'm missing something obvious here :-)</p>\n"},{"tags":["c++","winapi","resources"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12409474,"title":"C++ cannot create object file because requires resources","body":"<p>Okay so I have a C++ Win32 program that should have a custom icon. I have created a resource.h file and a resource.rc file (which I have compiled into a resource.o file). Now I need to compile my .cpp file and link my source object file and my resource object file into a final executable. However my cpp does not see the resources that are in the resource file. What I mean is during the compilation stage (g++ -c mine.cpp) it doesn't know what my custom icon is.</p>\n\n<p>Here is my resource.h file:</p>\n\n<pre><code>    #define IDR_MYMENU 101\n    #define IDI_MYICON 201\n\n    #define ID_FILE_EXIT 9001\n    #define ID_STUFF_GO 9002\n</code></pre>\n\n<p>Here is my resource.rc file:</p>\n\n<pre><code>    #include \"a.h\"\n\n    IDR_MYMENU MENU\n    BEGIN\n        POPUP \"&amp;File\"\n        BEGIN\n            MENUITEM \"E&amp;xit\", ID_FILE_EXIT\n        END\n\n        POPUP \"&amp;Stuff\"\n        BEGIN\n            MENUITEM \"&amp;Go\", ID_STUFF_GO\n            MENUITEM \"G&amp;o somewhere else\", 0, GRAYED\n        END\n    END\n\n    IDI_STAR ICON \"star.ico\"\n</code></pre>\n\n<p>Finally here is the .cpp file:</p>\n\n<pre><code>#include &lt;windows.h&gt;\n\nconst char g_szClassName[] = \"myWindowClass\";\n\nLRESULT CALLBACK WndProc (HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam) {\n    switch (msg) {\n        case WM_LBUTTONDOWN:\n            MessageBox(NULL, \"You pressed the left mouse button! :O\", \"MousePress\", MB_OK | MB_ICONINFORMATION);\n            break;      \n        case WM_RBUTTONDOWN:\n            MessageBox(NULL, \"You pressed the right mouse button! :O\", \"MousePress\", MB_OK | MB_ICONINFORMATION);\n            break;\n        case WM_MBUTTONDOWN:\n            {\n                char fileName[MAX_PATH];\n                HINSTANCE hInstance = GetModuleHandle(NULL);\n\n                GetModuleFileName(hInstance, fileName, MAX_PATH);\n                MessageBox(hwnd, fileName, \"The name of the program is:\", MB_OK | MB_ICONINFORMATION);\n            }\n            break;\n        case WM_CLOSE:\n            DestroyWindow(hwnd);\n            break;\n        case WM_DESTROY:\n            PostQuitMessage(0);\n            break;\n        default:\n            return DefWindowProc(hwnd, msg, wParam, lParam);\n    }\n    return 0;\n}\n\nint WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow) {\n    WNDCLASSEX wc;\n    HWND hwnd;\n    MSG Msg;\n\n    wc.cbSize           = sizeof(WNDCLASSEX);\n    wc.style            = 0;\n    wc.lpfnWndProc      = WndProc;\n    wc.cbClsExtra       = 0;\n    wc.cbWndExtra       = 0;\n    wc.hInstance        = hInstance;\n    wc.hIcon            = LoadIcon(GetModuleHandle(NULL), MAKEINTRESOURCE(IDI_STAR));\n    wc.hCursor          = LoadCursor(NULL, IDC_CROSS);\n    wc.hbrBackground    = (HBRUSH)(COLOR_WINDOW+1);\n    wc.lpszMenuName     = MAKEINTRESOURCE(IDR_MYMENU);\n    wc.lpszClassName    = g_szClassName;\n    wc.hIconSm          = (HICON)LoadImage(GetModuleHandle(NULL), MAKEINTRESOURCE(IDI_STAR), IMAGE_ICON, 16, 16, 0);\n\n    if (!RegisterClassEx(&amp;wc)) {\n        MessageBox(NULL, \"Registration Failed!\", NULL, MB_ICONEXCLAMATION | MB_OK);\n        return 0;\n    }\n\n    hwnd = CreateWindowEx(\n        WS_EX_DLGMODALFRAME,\n        g_szClassName,\n        \"This is a window!\",\n        WS_OVERLAPPEDWINDOW,\n        CW_USEDEFAULT, CW_USEDEFAULT, 800, 450,\n        NULL, NULL, hInstance, NULL     \n    );\n\n    if (hwnd == NULL) {\n        MessageBox(NULL, \"HWND failed!\", NULL, MB_ICONEXCLAMATION | MB_OK);\n        return 0;\n    }\n\n    ShowWindow(hwnd, nCmdShow);\n    UpdateWindow(hwnd);\n\n    while (GetMessage(&amp;Msg, NULL, 0, 0) &gt; 0) {\n        TranslateMessage(&amp;Msg);\n        DispatchMessage(&amp;Msg);\n    }\n    return Msg.wParam;\n}\n</code></pre>\n"},{"tags":["c++","winapi","crypt","winverifytrust"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":277,"score":0,"question_id":9339842,"title":"Verify digital signature within system32/drivers folder","body":"<p>I've spent all night researching this without a solution.</p>\n\n<p>I'm trying to verify the digital signature of a file in the drives folder (C:\\Windows\\System32\\drivers*.sys) pick whatever one you want.  I know that the code is correct because if you move the file from that folder to C:\\ the test works.</p>\n\n<p>WinVerifyTrust gives me error 80092003\n<a href=\"http://pastebin.com/nLR7rvZe\" rel=\"nofollow\">http://pastebin.com/nLR7rvZe</a></p>\n\n<p>CryptQueryObject give me error 80092009\n<a href=\"http://pastebin.com/45Ra6eL4\" rel=\"nofollow\">http://pastebin.com/45Ra6eL4</a></p>\n\n<p>What's the deal?</p>\n"},{"tags":["winapi","console"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":192,"score":1,"question_id":3516533,"title":"Catch output from win32 Console program","body":"<p>please, is it possible to catch the output from a console program? I would like to write a GUI to console app, but I need to get its output. </p>\n"},{"tags":["winapi","console"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":98,"score":1,"question_id":2435816,"title":"How do I poke the flag in a win32 PE that controls console window display","body":"<p>I have an executable which is part of a batch process.  This one executable opens a console window, which is annoying since it's useless to the end user and steals focus away from their active task.</p>\n\n<p>We can't compile a new version from of this EXE from source (easily).  Is there an easy way to twiddle this setting in the PE?</p>\n"},{"tags":["c#","winapi","windows-8","wininet"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":82,"score":2,"question_id":12401787,"title":"WININET.InternetConnect fails in Windows 8","body":"<p>This code worked well on Win7 but fails with unknown error <code>0x2f8c</code> in Windows 8 (Release Preview). Any idea why? Note that I checked out the code, compiled and ran it, but I'm pretty sure I got all dependencies right. The win32 declaration:</p>\n\n<pre><code>   [DllImport(\"wininet.dll\", CharSet = CharSet.Auto, SetLastError = true)]\n        extern public static IntPtr InternetConnect(\n            [In] IntPtr hInternet,\n            [In] string serverName,\n            [In] int serverPort,\n            [In] string userName,\n            [In] string password,\n            [In] int dwService,\n            [In] int dwFlags,\n            [In] IntPtr dwContext);\n</code></pre>\n"},{"tags":["winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":109,"score":2,"question_id":12392677,"title":"Creating modern style dynamic menu in Windows","body":"<p>In my MFC dialog based application I have main menu created with Visual Studio resource editor, and in one place there is dynamic menu, created at run time. All parts of menu that are created with Visual studio have modern look, and my dynamically created sub-menu has old look, as shown in image below.</p>\n\n<p><img src=\"http://i.stack.imgur.com/B1ZuY.png\" alt=\"enter image description here\"></p>\n\n<p>My code for creating dynamic sub-menu is something like this (not the real code, but real code is not all that important):</p>\n\n<pre><code>CMenu subMenu;\nsubMenu.CreateMenu();\n\nfor (...)\n{\n    subMenu.AppendMenu(\n        MF_STRING | (isChecked ? MF_CHECKED : MF_UNCHECKED),\n        &lt;some menu ID&gt;,\n        &lt;some menu text&gt;);\n}\n</code></pre>\n\n<p>Inserting this sub-menu to where it belongs is done like this (pretty much the actual code):</p>\n\n<pre><code>TCHAR szMenuString[256];\nMENUITEMINFO mii;\nmii.cbSize = sizeof(mii);\nmii.fMask = MIIM_STATE | MIIM_ID | MIIM_SUBMENU | MIIM_CHECKMARKS |\n    MIIM_DATA | MIIM_STRING | MIIM_BITMAP | MIIM_FTYPE;\nmii.dwTypeData = szMenuString;\nmii.cch = sizeof(szMenuString) / sizeof(szMenuString[0]);\n\nGetMenu()-&gt;GetMenuItemInfo(ID_SUBMENU, &amp;mii);\nmii.fMask |= MIIM_SUBMENU;\nmii.hSubMenu = subMenu.GetSafeHmenu();\nGetMenu()-&gt;SetMenuItemInfo(ID_SUBMENU, &amp;mii);\n</code></pre>\n\n<p>How can I create my sub-menu so that it appears the same in style as the rest of the main menu?</p>\n\n<p>My code is written in MFC, but your answer does not have to be in MFC (and probably cannot be).</p>\n"},{"tags":["c++","winapi","gdi"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12399357,"title":"Creating an HICON from an existing HICON by painting it to an HBITMAP","body":"<p>As part of a bigger project, I'm trying to create an HICON from an existing HICON by first painting that icon to an HBITMAP, then converting it back to an HICON. (This will allow me to modify the icon, for example, by drawing text on it.)</p>\n\n<p>Unfortunately, the icon is showing up as a black square. Here is my code:</p>\n\n<pre><code>bool createIcon()\n{\n  bool ret = false;\n\n  // get context of window\n  HDC context = GetDC(window_);\n  if (context != NULL)\n  {\n    // create a buffer context\n    HDC buffer = CreateCompatibleDC(context);\n    if (buffer != NULL)\n    {\n      PatBlt(buffer, 0, 0, iconSize_, iconSize_, WHITENESS);\n\n      // create a bitmap for our use\n      HBITMAP bitmap = CreateCompatibleBitmap(context, iconSize_, iconSize_);\n      if (bitmap != NULL)\n      {\n        HBITMAP oldBitmap;\n\n        // select the bitmap with the buffer\n        oldBitmap = reinterpret_cast&lt;HBITMAP&gt;(SelectObject(buffer, bitmap));\n        if (oldBitmap != NULL)\n        {          \n          // draw the icon\n          if (DrawIcon(buffer, 0, 0, icon_))\n          {\n            if (icon_ != NULL)\n              DestroyIcon(icon_);\n\n            ImageList_RemoveAll(imageList_);\n            if (ImageList_Add(imageList_, bitmap, NULL) != -1)\n            {\n              icon_ = ImageList_GetIcon(imageList_, 0, ILD_NORMAL);\n              if (icon_ != NULL)\n                ret = true;\n            }\n          }          \n          SelectObject(buffer, oldBitmap);\n        }\n        DeleteObject(bitmap);\n      }\n      DeleteDC(buffer);\n    }\n    DeleteDC(context);\n  }\n  return ret;\n}\n</code></pre>\n\n<p>Any ideas?</p>\n"},{"tags":["c++","c","winapi","activex","mingw"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12401306,"title":"Call a c++ activex dll from plain c code","body":"<p>I have a c++ active x dll which is built from visual studio 2005 and i need to call it from a \"c\" code which i has to be compiled in mingw32 compiler. </p>\n\n<p>Is it possible to call a c++ active x dll from c or i have to convert the dll from activex to win32.</p>\n\n<p>Please give me your suggestions.</p>\n"},{"tags":["c++","winapi","opengl"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12397435,"title":"OpenGL gltexcoord2f function in Win32","body":"<p>I have a texture that I want to render. But, if for example you imagine a 3x3 grid\non a texture, I want to render only the cell (1,1). \nIn simple words, I want to render a square part of a texture, and I am \nhaving trouble getting the glTexcoord2f function to work properly. The SDK documentation\ndoes not cover this subject.</p>\n"},{"tags":["winapi","dll","constructor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12398502,"title":"DllMain() and __attribute__((constructor)) order of execution","body":"<p><strong>Q</strong>: If i write a <code>DllMain()</code> function in a shared library, and also a function with <code>__attribute__((constructor))</code>, which one will be executed first when library is loaded?</p>\n\n<p><strong>Q</strong>: If i have functions with <code>__attribute__((constructor))</code> in the executable linked to that shared library, what will be called first - library's <code>DllMain()</code> or executable's <code>__attribute__((constructor))</code> function?</p>\n"},{"tags":["winapi","dll","exe"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1247,"score":1,"question_id":450700,"title":"Can the DllMain of an .exe be called?","body":"<p>My question is not exactly the same as <a href=\"http://stackoverflow.com/questions/186502/dllmain-in-an-exe\">this one</a> (it's not theoretical, there is only a main thread without message loop, InitInstance and ExitInstance are no fitting calls).</p>\n\n<p>I'm using a console app without message loop; this app loads an exe with the LoadLibrary function, so that it can use its exported functions. Bad news: the DllMain function of the exe is not called (and I verified the symbols tables, using a def file, DllMain appears correctly); <a href=\"http://msdn.microsoft.com/en-us/library/ms682583.aspx\" rel=\"nofollow\">the doc says</a> it's called if the loaded module is a DLL (too bad).</p>\n\n<p>What are the conditions (if they exist) which could lead to the execution of the exe's DllMain function when LoadLibrary is called (and maybe again when FreeLibrary is called)?</p>\n\n<p>Best regards</p>\n"},{"tags":["c","winapi","unicode","utf-8","tchar"],"answer_count":5,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":553,"score":5,"question_id":6315566,"title":"should I eliminate TCHAR from Windows code?","body":"<p>I am revising some very old (10 years) C code. The code compiles on Unix/Mac with GCC and cross-compiles for Windows with MinGW. Currently there are TCHAR strings throughout. I'd like to get rid of the TCHAR and use a C++ string instead. Is it still necessary to use the Windows wide functions, or can I do everything now with Unicode and UTF-8?</p>\n"},{"tags":["winapi","powershell","volume","mute"],"answer_count":6,"favorite_count":2,"up_vote_count":9,"down_vote_count":0,"view_count":3557,"score":9,"question_id":255419,"title":"How can I mute/unmute my sound from PowerShell","body":"<p>Trying to write a PowerShell cmdlet that will mute the sound at start, unless already muted, and un-mute it at the end (only if it wasn't muted to begin with).\nCouldn't find any PoweShell or WMI object I could use. I was toying with using Win32 functions like <a href=\"http://msdn.microsoft.com/en-us/library/ms706237(VS.85).aspx\" rel=\"nofollow\">auxGetVolume</a> or <a href=\"http://msdn.microsoft.com/en-us/library/ms706237(VS.85).aspx\" rel=\"nofollow\">auxSetVolume</a>, but couldn't quite get it to work (how to read the values from an IntPtr???).</p>\n\n<p>I'm using V2 CTP2. Any ideas folks?</p>\n\n<p>Thanks!</p>\n"},{"tags":["delphi","winapi","memory-management","delphi-7"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":182,"score":2,"question_id":11796088,"title":"Allocate a byte array and free it afterwards in delphi","body":"<p>I would like to allocate space (dynamic size) with a byte array and get a pointer to the \"spacearea\" and free it later if I don't need it anymore.</p>\n\n<p>I know about VirtualAlloc, VirutalAllocEx and LocalAlloc.\nWhich one is the best and how can I free the memory afterwards?</p>\n\n<p>Thank you for your help.</p>\n"},{"tags":["winapi","mbr"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12393403,"title":"Createfile fails while reading mbr","body":"<p>Createfile fails while reading mbr on WinXP. Returns -1 i.e <code>INVALID_DEVICE_HANDLE</code></p>\n\n<pre><code>HANDLE hDisk = CreateFile((LPCWSTR)\"\\\\\\\\.\\\\PhysicalDrive0\", GENERIC_READ| GENERIC_WRITE, FILE_SHARE_READ| FILE_SHARE_WRITE, NULL, OPEN_EXISTING, 0,NULL );\n</code></pre>\n\n<p>Any idea why???</p>\n"},{"tags":["c++","winapi","msdn","atlcom"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12387214,"title":"Closing timers handle from the working thread","body":"<p>best way to ask a question is to first show an example:</p>\n\n<p>this is how i create a timer in c++:</p>\n\n<pre><code>        if (FALSE == CreateTimerQueueTimer(&amp;m_hSampleStarvationTimer,\n                                            m_hSampleStarvationTimerQueue,\n                                            (WAITORTIMERCALLBACK)TsSampleStarvationTimeBomb_Static,\n                                            (LPVOID)this,\n                                            dwDueTime,\n                                            0,\n                                            WT_EXECUTEONLYONCE))\n</code></pre>\n\n<p>once the following callback is triggered(TsSampleStarvationTimeBomb_Static), i try to kill both the queue handle and timer's handle inside that particular thread.</p>\n\n<pre><code>void CALLBACK CCaptureChannel::TsSampleStarvationTimeBomb_Static(LPVOID lpArg, BOOLEAN TimerOrWaitFired)\n    {\n        HRESULT hr;\n        BOOL    bHandleDeletion          = FALSE;\n        CCaptureChannel* pCaptureChannel = (CCaptureChannel*)lpArg;\n\n        ATLASSERT(pCaptureChannel);\n\n        bHandleDeletion = DeleteTimerQueueTimer(pCaptureChannel-&gt;m_hSampleStarvationTimerQueue, pCaptureChannel-&gt;m_hSampleStarvationTimer, NULL);\n        bHandleDeletion = DeleteTimerQueue(pCaptureChannel-&gt;m_hSampleStarvationTimerQueue);\n</code></pre>\n\n<p>my question is: is it valid? i read over MSDN that the following deletion functions may return i/o errors which shouldn't concern me too much. their termination will be executed once the callback thread turns signled, automatically.</p>\n\n<p>am i right?\nThanks!</p>\n"},{"tags":["c++","winapi","resources","compiler-errors"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12390908,"title":"Error During C++ Compilation With Resource Files","body":"<p>All right so I created a C++ Win32 program that worked fine. Then I wanted to use a custom icon so I created a \"resource.h\" file and a \"resource.rc\" file and I <code>#include</code>'d them both in my C++ source file. However on compilation I get the following error for line 3: </p>\n\n<blockquote>\n  <p>expected unqualified-id before numeric constant</p>\n</blockquote>\n\n<p>What am I doing wrong? Am I forgetting something?</p>\n\n<p>My resource.h file:</p>\n\n<pre><code>#define IDI_MYICON 201\n</code></pre>\n\n<p>My resource.rc file:</p>\n\n<pre><code>#include \"resource.h\"\n\nIDI_MYICON ICON \"star.ico\"\n</code></pre>\n\n<p>Finally the first three line (the ones with the problem) of my C++ Win32 file:</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include \"resource.h\"\n#include \"resource.rc\"\n</code></pre>\n"},{"tags":["c++","windows","winapi"],"answer_count":5,"favorite_count":2,"up_vote_count":17,"down_vote_count":1,"view_count":2073,"score":16,"question_id":2067497,"title":"How to programmatically move Windows taskbar?","body":"<p>I'd like to know any sort of API or workaround (e.g., script or registry) to move (or resize) Windows taskbar to another position including another monitor (if dual monitors). Definitely, we can move task bar by using mouse, but I want to move it by a program, or a sort of automated way.</p>\n\n<p>I tried to find Win32 API, but it seems no one does this job.</p>\n\n<p><strong>EDIT</strong>: I was surprised by many people's opinion. Let me explain why I wanted it. In my workplace, I'm using dual monitors (resolutions are different), and the taskbar is placed on the left monitor while the primary monitor is the right monitor. However, I often connect to my workplace computer via remote desktop. After the remote connection, the taskbar position is switched. That's why I wanted to make a simple program that can save/restore taskbar's position. Everyday I have to rearrange my taskbar. That's it. I just want it for <strong>me</strong>.</p>\n"},{"tags":["c++","winapi","fltk"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12374475,"title":"Cannot open include file X11/X.h when compiling","body":"<p>I've copied the FL folder into the project.</p>\n\n<p>and it show me this:</p>\n\n<blockquote>\n  <p>1>------ Build started: Project: Client, Configuration: Debug Win32\n  ------ 1>  Main.cpp 1>c:\\users\\user\\documents\\visual studio 2012\\projects\\talktome\\talktome\\fl\\xutf8.h(33): fatal error C1083:\n  Cannot open include file: 'X11/X.h': No such file or directory\n  ========== Build: 0 succeeded, 1 failed, 0 up-to-date, 0 skipped ==========</p>\n</blockquote>\n\n<p>my source code is</p>\n\n<pre><code>using namespace std;\n\n#include \"FL\\Fl.H\"\n#include \"FL\\Fl_Window.H\"\n\n#define   WIDTH    700\n#define   HEIGHT   500\n\nint main()\n{\n    Fl_Window win(WIDTH, HEIGHT, \"TalkToMe\");\n\n    win.begin();\n    win.end();\n\n    win.show();\n\n    return Fl::run();\n}\n</code></pre>\n"},{"tags":["winapi","usb","webcam","directshow","directshow.net"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":238,"score":1,"question_id":11986119,"title":"Run multiple webcams at a time using DirectShow","body":"<p>I'm using Windows 7 OS. working with Visual Studio 2010. Here I'm usng DirectShow2005-Lib.dll.\nHere I'm able to run two webcams at a time. But when I'm going to connect and run the 3rd webcam .. I'm not able to run all the three at a time. I can run only two at a time.\nand getting an error : No combination of intermediate filters could be found to make the connection.</p>\n\n<p>How can I run multiple webcams at a time using DirectShow ?</p>\n\n<p>Please help me ! </p>\n\n<p>Thanks in Advanced !</p>\n"},{"tags":["c++","qt","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":168,"score":1,"question_id":12372099,"title":"win32 C++ print string to printer","body":"<p>After a few days of searching the net on how exactly I can go about printing an arbitrary string to an arbitrary printer on windows, I finally came up with this code.</p>\n\n<pre><code>LPBYTE pPrinterEnum;\nDWORD pcbNeeded, pcbReturned;\nPRINTER_INFO_2 *piTwo = NULL;\nHDC printer;\nEnumPrinters(PRINTER_ENUM_LOCAL,NULL,2,NULL,0,&amp;pcbNeeded,&amp;pcbReturned);\npPrinterEnum = new BYTE[pcbNeeded];\nif (!EnumPrinters(PRINTER_ENUM_LOCAL,NULL,2,pPrinterEnum,pcbNeeded,&amp;pcbNeeded,&amp;pcbReturned)) {\n    qDebug() &lt;&lt; \"In Print, could not enumerate printers\";\n} else {\n    piTwo = ((PRINTER_INFO_2*)pPrinterEnum);\n    for (int i = 0; i &lt; pcbReturned; i++) {\n        QString name = QString::fromWCharArray(piTwo[i].pPrinterName);\n        if (this-&gt;m_printer_path == name) {\n            const WCHAR * driver = L\"WINSPOOL\\0\";\n            printer = CreateDC(NULL,piTwo[i].pPrinterName,NULL,NULL);\n        }\n    }\n}\nif (printer == 0) {\n    qDebug() &lt;&lt; \"No Printer HDC\";\n    return;\n} else {\n    qDebug() &lt;&lt; \"Printer seems okay!\";\n}\n\nqDebug() &lt;&lt; \"Starting Document\";\nDOCINFO di;\nmemset( &amp;di, 0, sizeof( di ) );\ndi.cbSize = sizeof( di );\nWCHAR * text = new WCHAR[ba.length()];\nQString(ba).toWCharArray(text);\nStartDoc(printer,&amp;di);\n    qDebug() &lt;&lt; \"Writing text\";\n    TextOut(printer,0, 0, text, ba.length());\n    qDebug() &lt;&lt; \"Text Written\";\nEndPage(printer);\nqDebug() &lt;&lt; \"Page ended\";\nDeleteDC(printer);\nqDebug() &lt;&lt; \"DC Deleted\";\n</code></pre>\n\n<p>Some basic caveats:</p>\n\n<p>1) I cannot use QPrinter. I need to write raw text, no postscript.\n2) I do not know the name of the printer until the user sets it, and I do not know the size of the string to print until the user creates it.</p>\n\n<p>Additional information:</p>\n\n<p>a) The printer works, I can print from Notepad, Chrome, just about everything to the printer that I want.\nb) I am willing to implement just about any hack. Ones like write it to a text file and issue the copy command don't seem to work, that is, I get a failed to initialize device error.</p>\n\n<p>This works:\nnotepad /P Documents/test_print.txt\nThis does not work:\ncopy Documents\\test_print.txt /D:EPSON_TM_T20\ncopy Documents\\test_print.txt /D \\MYCOMPUTER\\epson_tm_t20 (leads to access denied, printer is shared)\nprint Documents\\test_print.txt (Unable to initialize device)</p>\n\n<p>I have tried just about every recommended way to print a text file from the command line, just doesn't work. I have installed, reinstalled driver, added printer, mucked with ports and done it all again.</p>\n\n<p>Obviously there is something simple about windows printing that I am missing due to inexperience.</p>\n\n<p>What I want to accomplish is:</p>\n\n<p>1) Best Scenario( Directly write text to the printer)\n2) Second best scenario (Write text to a file, then execute some program to print it for me) Notepad adds an annoying amount of space to the bottom of the printout wasting paper.</p>\n\n<p>Since the program is for end users, I have to find a way to do this automagically for them, so I can't expect them to click checkbox a in tab 36 after running command obscure_configuration from a powershell.</p>\n\n<p>Any help would be greatly appreciated.</p>\n\n<p>/Jason</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>This is the working code, before I go through an spruce it up a bit, which prints the contents of a QByteArray to a thermal printer.</p>\n\n<pre><code>qDebug() &lt;&lt; \"Executing windows code\";\nBOOL     bStatus = FALSE;\nDOC_INFO_1 DocInfo;\nDWORD      dwJob = 0L;\nDWORD      dwBytesWritten = 0L;\nHANDLE     hPrinter;\nwchar_t * name = new wchar_t[this-&gt;m_printer_path.length()+1];\nthis-&gt;m_printer_path.toWCharArray(name);\nname[this-&gt;m_printer_path.length() + 1] = 0;\nqDebug() &lt;&lt; \"opening printer\";\nbStatus = OpenPrinter(name,&amp;hPrinter, NULL);\n\nif (bStatus) {\n    qDebug() &lt;&lt; \"Printer opened\";\n    DocInfo.pDocName = L\"My Document\";\n    DocInfo.pOutputFile = NULL;\n    DocInfo.pDatatype = L\"RAW\";\n    dwJob = StartDocPrinter( hPrinter, 1, (LPBYTE)&amp;DocInfo );\n    if (dwJob &gt; 0) {\n        qDebug() &lt;&lt; \"Job is set.\";\n        bStatus = StartPagePrinter(hPrinter);\n        if (bStatus) {\n            qDebug() &lt;&lt; \"Writing text to printer\";\n            bStatus = WritePrinter(hPrinter,ba.data(),ba.length(),&amp;dwBytesWritten);\n            EndPagePrinter(hPrinter);\n        } else {\n            qDebug() &lt;&lt; \"could not start printer\";\n        }\n        EndDocPrinter(hPrinter);\n        qDebug() &lt;&lt; \"closing doc\";\n    } else {\n        qDebug() &lt;&lt; \"Couldn't create job\";\n    }\n    ClosePrinter(hPrinter);\n    qDebug() &lt;&lt; \"closing printer\";\n} else {\n    qDebug() &lt;&lt; \"Could not open printer\";\n}\nif (dwBytesWritten != ba.length()) {\n    qDebug() &lt;&lt; \"Wrong number of bytes\";\n} else {\n    qDebug() &lt;&lt; \"bytes written is correct \" &lt;&lt; QString::number(ba.length()) ;\n}\n</code></pre>\n\n<p><strong>Note</strong>: I do owe an apology to Skizz, what he wrote was actually helpful in debugging the fundamental issue. The characters in the QByteArray are preformatted specifically for the printer, the problem is, they contain several NULL bytes. When trying to send them to the printer, this causes TextOut to truncate the text, only printing the first few lines. Using WritePrinter, as suggested in the answer ignores null bytes and accepts a void * and a length, and just puts it all there.</p>\n\n<p>Further, his response recommending the use of PrintDlg did work to fectch the correct printer HDC, the issus is that, the user first chooses a printer once, and then doesn't need to choose it each time they print, because they will be printing alot (It's a Point of Sale).</p>\n\n<p>The problem with getting the printer HDC from the string name was due to not adding the all important NULL byte to wchar_* which was solved this way:</p>\n\n<pre><code>wchar_t * name = new wchar_t[this-&gt;m_printer_path.length()+1];\nthis-&gt;m_printer_path.toWCharArray(name);\nname[this-&gt;m_printer_path.length() + 1] = 0;\n</code></pre>\n\n<p>In the above, m_printer_path is a string representation of the name of the printer taken from Print Manager.</p>\n\n<p>Because the string has all the formatting necessary for the printer, there's no need to worry about new lines, or any formatting.</p>\n\n<p>All three answers to this question were actually very helpful in implementing the final working solution, and I have voted up each answer, and I appreciate the time each person took in responding.</p>\n"},{"tags":["c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12385163,"title":"FindResource() doesn't find my resource","body":"<p>I have some code template that i compiled, i would like to understand one part of the code that i am can't figure out what it does although i have spent a whole day tried to.</p>\n\n<p>the code in question is as follows:</p>\n\n<pre><code>#define IDR_STUB 1\nhRsrc = FindResource(NULL, MAKEINTRESOURCE(IDR_STUB), \"STUB\");\n</code></pre>\n\n<p>I have another two files in the same directory as the main file, the first one is called `something.rc' and is content is:</p>\n\n<pre><code>#define IDR_STUB 1\nIDR_STUB STUB DISCARDABLE \"stub.exe\"\n</code></pre>\n\n<p>The other file as you can guess is <code>stub.exe</code>.</p>\n\n<p>My question is what is wrong with the <code>FindResource</code> call above that it can't find whatever is trying to find, I have hard time to understand how that function is suppose to work.</p>\n\n<p>So if you can give me some help i would be glad :)</p>\n\n<p>THX.</p>\n"},{"tags":["delphi","winapi","registry","delphi-7"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":92,"score":2,"question_id":12382289,"title":"Delphi - Using NtCreateKey with HKCU","body":"<p>and thanks for taking the time to look over my issue.</p>\n\n<p>I am trying to create a key inside HKCU using the native NtCreateKey API.</p>\n\n<p>I have a source that helps me to understand how the API works, but I cannot seem to make it work for HKCU, only HKLM...is this possible?</p>\n\n<p>Source Code I have already:</p>\n\n<pre><code>const\n   KeyNameBuffer: AnsiString = '\\Registry\\Machine\\SOFTWARE'; //Assuming I need to change this.....\n   NewKeyNameBuffer: AnsiString = 'Parent Key To Create';\n   HiddenKeyNameBuffer: AnsiString = 'Main Key To Create';\n   HiddenValueNameBuffer: AnsiString = 'Value Key To Create';\n\n procedure TForm1.btnDemoClick(Sender: TObject);\n var\n    KeyName, ValueName: UNICODE_STRING;\n    SoftwareKeyHandle, SysKeyHandle, HiddenKeyHandle: THandle;\n    Status: ULONG;\n    ObjectAttributes: OBJECT_ATTRIBUTES;\n    Disposition: ULONG;\n    Buffer: array of WideChar;\n begin\n\n    //\n    // Open the Software key\n    //\n   SetLength(Buffer, Length(KeyNameBuffer));\n   MultiByteToWideChar(CP_UTF8, 0, @KeyNameBuffer[1], Length(KeyNameBuffer),\n       PWideChar(Buffer), Length(Buffer));\n   KeyName.Buffer := @Buffer[0];\n    KeyName.Length := Length(KeyNameBuffer) * SizeOf(WideChar);\n    InitializeObjectAttributes(ObjectAttributes, @KeyName, OBJ_CASE_INSENSITIVE,\n       0, nil);\n    Status := NtCreateKey(SoftwareKeyHandle, KEY_ALL_ACCESS, ObjectAttributes, 0,\n       nil, REG_OPTION_NON_VOLATILE, Disposition);\n    if not NT_SUCCESS(Status) then\n      raise Exception.Create('Error: Couldn''t open HKLM\\Software');\n end;\n</code></pre>\n\n<p>All of my Type Definitions and API Declarations have been made above that code, I just don't see it being necessarily to post it all.</p>\n\n<p>I am using the Delphi 7 IDE.</p>\n\n<p>Any help on solving this issue would be greatly appreciated.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c++","winapi","keyboard-layout"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":105,"score":2,"question_id":12379713,"title":"can't get current keyboard layout","body":"<p>I have tried <strong>GetKeyboardLayoutName()</strong> and <strong>GetKeyboardLayout()</strong> for getting the current keyboard layout, but they both give me the default layout and changing the layout doesn't affect the output!</p>\n\n<pre><code>while(1)\n{\n    Sleep(5);\n    for(int i = 8; i &lt; 191; i++)\n    {\n        if(GetAsyncKeyState(i)&amp;1 ==1)\n        {\n            TCHAR szKeyboard[KL_NAMELENGTH];\n            GetKeyboardLayoutName(szKeyboard);\n\n            if(GetAsyncKeyState(i)&amp;1 ==1)\n            {\n                TCHAR szKeyboard[KL_NAMELENGTH];\n                GetKeyboardLayoutName(szKeyboard);\n                cout &lt;&lt; szKeyboard &lt;&lt; endl ;\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>It always gives me \"00000409\" when the default layout is set to English, while I expect it to be \"00000429\" when I change the layout to Farsi.</p>\n\n<p>My first question here, I used to find all my answers by just searching. But right now I'm driving crazy after hours of searching around and getting nothing...</p>\n"},{"tags":["c","winapi","gcc","compiler-errors","eclipse-cdt"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12381601,"title":"Undefined reference to `WinMain@16' in Eclipse HELIOS CDT","body":"<p>I'm trying to compile and run a SHA256.c implementation in Eclipse CDT. I installed the plugin from this website:\n<a href=\"http://svn.codespot.com/a/eclipselabs.org/wascana/repo\" rel=\"nofollow\">http://svn.codespot.com/a/eclipselabs.org/wascana/repo</a></p>\n\n<p>Below is the main method from the program. When I try to build project, I get this error:</p>\n\n<pre><code>gcc -O0 -g3 -Wall -c -fmessage-length=0 -osrc\\SHA256.o ..\\src\\SHA256.c\ngcc -oSHHA.exe src\\SHA256.o\nd:/eclipse/mingw/bin/../lib/gcc/mingw32/4.4.1-dw2/../../../libmingw32.a(main.o):main.c:(.text+0xd2): \nundefined  reference to WinMain@16 collect2: ld returned 1 exit status\nBuild error occurred, build is stopped\n</code></pre>\n\n<p>The project which I created is new ->C Project->Hellow WOorld ANCI C project->next->next->Finish</p>\n\n<pre><code>int main(int argc, char *argv[]){\nprintf(\"\\n\");\nProcessVector(&amp;vector1);\nProcessVector(&amp;vector2);\nreturn 0;\n}\n</code></pre>\n\n<p>I have dowloaded above project from this site\n<a href=\"http://www.koders.com/cpp\" rel=\"nofollow\">http://www.koders.com/cpp</a>.</p>\n\n<p>It's not a Windows application, it's a normal SHA256 algorithm.</p>\n\n<p>I have also read the post on StackOverflow for this error but it did not supply the information I need. I have tried everything that was mentioned, but I'm still getting this error.\nCan anyone please help me out from this.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c++","c","winapi","winsock"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12382206,"title":"Difference between FAR and FAR * used in winsock","body":"<p>I would like to know the difference between <code>FAR</code> and <code>FAR *</code> used in\nthis function from <em>WinSock</em>.</p>\n\n<pre><code>int PASCAL FAR connect (SOCKET s, const struct sockaddr FAR * name, int len);\n</code></pre>\n"},{"tags":["windows","debugging","winapi","windows-7-x64"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":184,"score":2,"question_id":10973698,"title":"closehandle API, invalid handle exception on x64 Windows","body":"<p>as stated on the official documentation (<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms724211%28v=vs.85%29.aspx\" rel=\"nofollow\">closehandle API description</a>).</p>\n\n<blockquote>\n  <p>If the application is running under a debugger, the function will throw an exception if it receives either a handle value that is not valid or a pseudo-handle value. </p>\n</blockquote>\n\n<p>For this reason the following code can be used to detect if a program is being debugged (since handle 0x1 is always invalid).</p>\n\n<pre><code>#include \"stdafx.h\"\n#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string&gt;\n\nint _tmain(int argc, _TCHAR* argv[]){\n    bool flag = false;\n    __try {\n        CloseHandle((HANDLE)0x1);\n    }\n    __except (EXCEPTION_EXECUTE_HANDLER) {\n        flag = true;\n    }\n    if (flag == false){\n        printf(\"Not debugged\\n\");\n    }else{\n        printf(\"Debugged\\n\");\n    }\n}\n</code></pre>\n\n<p>I compiled this code using Visual Studio 2008, creating a 32bit binary.</p>\n\n<p>It works correctly on Windows XP and Windows 7 32bit, but it does not work on Windows 7 64bit, because it always returns \"Not debugged\".</p>\n\n<p>Do you have any idea why this happens?\nThank you.</p>\n"},{"tags":["c#","wpf","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":284,"score":0,"question_id":10617337,"title":"How to show Windows Login Dialog?","body":"<p>How to display Windows Login dialog box whitin a windows <strong>WPF</strong> application?</p>\n\n<p><img src=\"http://i.stack.imgur.com/B7VCI.jpg\" alt=\"Login dialog box\"></p>\n"},{"tags":["windows","winapi","textbox"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12376057,"title":"write functions as SETPARAFORMAT","body":"<p>What language should I learn, or what study material I need to study, so I can write functions as SETPARAFORMAT ect.<br>\nI will explain why I need it, I asked <a href=\"http://stackoverflow.com/questions/11953670/indent-only-in-second-line-in-paragraph-in-rich-text-box-c\">here</a> how you can format a paragraph as the image, and I did not get an answer. and I asked <a href=\"http://stackoverflow.com/questions/11671844/how-to-set-the-space-between-characters-or-words-in-a-richtextbox\">here</a>  how can I set the spacing between characters, and I did not get an answer.<br>\nSo I want to know what I need to learn to write such as this functions  </p>\n\n<p><img src=\"http://i.stack.imgur.com/u5bSV.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["windows","winapi","tracing","wdk","etw"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":106,"score":4,"question_id":12271850,"title":"Tracing to multiple ETW providers using WPP","body":"<p>I'm trying to use \"Event Tracing for Windows\" through WPP instumentation. Per documentation in <a href=\"http://www.google.co.il/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;ved=0CB4QFjAA&amp;url=http://download.microsoft.com/download/5/d/6/5d6eaf2b-7ddf-476b-93dc-7cf0072878e6/WPP_Intro.doc&amp;ei=enVGULjhPNHNsgau34CQAg&amp;usg=AFQjCNG5xOTtXcc6FGUL2kB75QfmvQ0FvA\" rel=\"nofollow\">Getting Started with Software Tracing in Windows Drivers</a> it is possible to issue traces to multiple providers from a single driver, but I saw no example for doing so:</p>\n\n<blockquote>\n  <p>A driver can specify more than one control GUID. Each control GUID identifies a unique provider. For example, if a driver defines two control GUIDs, one for a shared library and one for the driver, the library and the driver can be enabled as two different providers. Tracing can be enabled for either the library or the driver, or both.</p>\n</blockquote>\n\n<p>I tried to created two header files, each with <code>WPP_CONTROL_GUIDS</code> using different guid. Then I include the different header files from c/cpp files which I expect to issue traces to the different providers. But it seems the definition in the main file override this seperation and all traces arrive to the provider used by it...</p>\n\n<p>Any suggestion? Any sample? Thanks!!</p>\n"},{"tags":["c#","asp.net","visual-studio","api","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12375296,"title":"can I create lib or external package from part of namespace?","body":"<p>I have two projects. one as webapi, second as standalone desktop application. only common thing are data models. \nIn my webapi i got namespace <code>Api.Models</code> and i dekstop I got <code>Desktop.Models</code></p>\n\n<p>Can I export from my Api the <code>Api.Models</code> as a lib and include it in <code>Desktop</code> ? If yes how can I do this ?</p>\n"},{"tags":["delphi","winapi","listbox","delphi-7","listboxitems"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":253,"score":3,"question_id":12071172,"title":"Listbox content in another application","body":"<p>How can i read a listbox items in another application's window? I could get the window's handle but i dont know a clear way to access components within.</p>\n"},{"tags":["winapi","sid"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":275,"score":3,"question_id":9356633,"title":"Getting SID of users","body":"<p>I’m writing an application on Windows XP which gives the SID of  user.</p>\n\n<p>With the valid token handle, when I call <code>GetTokenInfomation</code> API with <code>TokenUser</code> as a second parameter then every time &amp; for all user account I get Valid SID in <code>PTOKEN_USER</code> structure variable.</p>\n\n<p>Valid Sid =>  Sid is <code>S-1-5-21-1121170692-2157880286-4158546613-1000</code></p>\n\n<p>Here RID is  => 1000</p>\n\n<p>But when I use <code>NetQueryDisplayInformation</code> API with <code>NET_DISPLAY_USER</code> as a information level (second parameter) then I get <code>NET_DISPLAY_USER</code> structure as a out Parameter.</p>\n\n<p><code>User123</code> is my one account which has the administrative rights.</p>\n\n<p>With the help of <code>NET_DISPLAY_USER</code> structure when I call to <code>LookupAccountName</code> API with variable of <code>NET_DISPLAY_USER.usri1_name</code> as a name of the user account then for a <code>User123</code> account I get SID without RID. </p>\n\n<p>e.g.\nLike this =>  Sid is <code>S-1-5-21-1121170692-2157880286-4158546613</code></p>\n\n<p>For other account with same procedure gives me the correct SID i.e. SID with RID</p>\n\n<p>e.g. \nValid Sid =>  Sid is <code>S-1-5-21-1121170692-2157880286-4158546613-1000</code></p>\n\n<p>Please provide me any pointers for returning SID without RID in second case.</p>\n"},{"tags":["c++","windows","winapi","video"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":821,"score":1,"question_id":3717454,"title":"How to play video?","body":"<p>I'm not c++ programmer so I have problem. Simple problem, I think. </p>\n\n<p>I need play movie, can be only e.g. .avi (I can convert). Static width, static height, no button, no loop. I will write in PHP something like</p>\n\n<pre><code>exec('window.exe movie23.avi');\n</code></pre>\n\n<p>And appears window, play video, window close.</p>\n\n<p>I rely code or good links.</p>\n\n<p>Best regards</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":12368866,"title":"Best way to measure the speed of an operation in Visual C++","body":"<p>I'm using MFC in Visual Studios. I wondered what the best way to measure the speed/efficiency of an operation (eg Function A vs Function B) working in this specific IDE. Can this be done with breakpoints?</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":118,"score":0,"question_id":12367391,"title":"Hiding command prompt while starting a process in C++","body":"<p>I have to start a process from my C++ code. I am using CreateProcess() function and I have set the following flags in the startupinfo struct. But still the command prompt shows up which I have to close manually to proceed. Please tell me how I can hide this command prompt during th e start up of the process.</p>\n\n<pre><code>si.cb = sizeof(STARTUPINFO);\n    si.dwFlags = STARTF_USESHOWWINDOW;\n    si.wShowWindow = SW_HIDE;\n</code></pre>\n\n<p>the create process call looks like this:</p>\n\n<pre><code>CreateProcess( NULL,   // No module name (use command line)\n        exe,            // Command line\n        NULL,           // Process handle not inheritable\n        NULL,           // Thread handle not inheritable\n        FALSE,          // Set handle inheritance to FALSE\n        CREATE_NEW_CONSOLE,              // No creation flags\n        NULL,           // Use parent's environment block\n        NULL,           // Use parent's starting directory \n        &amp;si,            // Pointer to STARTUPINFO structure\n        &amp;pi );\n</code></pre>\n\n<p>exe is a string containing the process name to start.</p>\n\n<p>Please tell me how to hide this command prompt during start up of the process.\nI tried the method described <a href=\"http://www.codeproject.com/Articles/2537/Running-console-applications-silently\" rel=\"nofollow\">here</a> but it doesn't work. I have a Windows 7 system.</p>\n\n<p>Thanks,\nRakesh.</p>\n"},{"tags":["c++","qt","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":78,"score":3,"question_id":12366881,"title":"Changing cursor hides the cursor","body":"<p>In my Qt application I am saving some data when application is being closed. Saving data is performed in the closeEvent(QCloseEvent*) method. I wanted to change the cursor before the saving data and restore it back after saving.</p>\n\n<p>From what I have read over the Internet the setCursor( const QCursor&amp; ) doesn't work globally, but only in the scope of some specified widget. Therefore I tried to use SetCursor( HCURSOR ) from WinAPI.</p>\n\n<p>The code looks like this:</p>\n\n<pre><code>void mainWin::closeEvent( QCloseEvent* e ) {\n    SetCursor( LoadCursor( GetModuleHandle( NULL ), ( LPCWSTR )IDC_WAIT ) );\n    saveData();\n    SetCursor( LoadCursor( GetModuleHandle( NULL ), ( LPCWSTR )IDC_ARROW ) );\n    e-&gt;accept();\n}\n</code></pre>\n\n<p>However, the first SetCursor() method just hides the cursor for the time when the data is saving instead of changing it to some kind of hourglass. Why?</p>\n"},{"tags":["winapi","mingw"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":190,"score":0,"question_id":8369494,"title":"Linking WSAAsyncSelect with Mingw - undefined reference","body":"<p>I am porting a voip application I wrote in Borland to Mingw so I know the code works.  I use the command line <code>gcc -lws2_32 -mwindows voipapp.c -o voipapp</code> and keep getting the error message </p>\n\n<blockquote>\n  <p>undefined reference to 'WSAAsyncSelect@16'\".  </p>\n</blockquote>\n\n<p>It appears to be properly locating <code>libws2_32.a</code> since no error messages come up telling me otherwise.  Any ideas as to what can be wrong?  I have one of the most recent versions of mingw installed.  Thanks!</p>\n\n<p>My code is as follows:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;windows.h&gt;\n#include &lt;winsock2.h&gt;\n#define __MT__\n#include &lt;mmreg.h&gt;\n#include &lt;time.h&gt;\n#include &lt;math.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;process.h&gt;\n\n#define WM_SOCKETREAD (WM_USER + 1)\n\nSOCKET ListenSocket;\n\nLRESULT CALLBACK WndProc(HWND, UINT, WPARAM, LPARAM);\n\nint WINAPI WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance,\n           LPSTR szCmdLine, int iCmdShow) {\n\n    static char szAppName[] = \"voip\";\n    HWND        hwnd;\n    MSG         msg;\n    WNDCLASSEX  wndclass;\n\n    wndclass.cbSize         = sizeof(wndclass);\n    wndclass.style          = CS_HREDRAW | CS_VREDRAW;\n    wndclass.lpfnWndProc    = WndProc;\n    wndclass.cbClsExtra     = 0;\n    wndclass.cbWndExtra     = 0;\n    wndclass.hInstance      = hInstance;\n    wndclass.hIcon          = LoadIcon(NULL, IDI_APPLICATION);\n    wndclass.hIconSm        = LoadIcon(NULL, IDI_APPLICATION);\n    wndclass.hCursor        = LoadCursor(NULL, IDC_ARROW);\n    wndclass.hbrBackground  = (HBRUSH) GetStockObject(WHITE_BRUSH);\n    wndclass.lpszClassName  = szAppName;\n    wndclass.lpszMenuName   = NULL;\n\n    RegisterClassEx(&amp;wndclass);\n\n    hwnd = CreateWindow(szAppName, \"VOIP prototype\",\n            WS_OVERLAPPEDWINDOW,\n            CW_USEDEFAULT, CW_USEDEFAULT,\n            CW_USEDEFAULT, CW_USEDEFAULT,\n            NULL, NULL, hInstance, NULL);\n\n    ShowWindow(hwnd, iCmdShow);\n    UpdateWindow(hwnd);\n\n\n    WSAAsyncSelect(ListenSocket, hwnd, WM_SOCKETREAD, FD_READ|FD_CLOSE);\n\n\n    while ( GetMessage(&amp;msg, NULL, 0, 0) ) {\n    TranslateMessage(&amp;msg);\n    DispatchMessage(&amp;msg); \n        } \n\n    return msg.wParam;\n}\n\nLRESULT CALLBACK WndProc(HWND hwnd, UINT iMsg, WPARAM wParam, LPARAM lParam) {\n\n    return DefWindowProc(hwnd, iMsg, wParam, lParam);\n}\n</code></pre>\n"},{"tags":["c#","winapi","hook"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2475,"score":3,"question_id":3464366,"title":"How to hook api calls in another application","body":"<p>I am trying to hook the ExtTextOut and DrawTextExt GDI method calls of another application.</p>\n\n<p>I know that I need to Use GetProcAddress to find the address of those methods in gdi32.dll, and overwrite the address in the process I want to hook with the address of my function.  Then in my function I do what I need, then call the original function.</p>\n\n<p>I want to make this hook functionality available to .net applications, and apparently this is do-able by creating an 'intermediate' unmanaged dll that does the hooking, and is capable of firing a event on the .net side, so that the new function can bet written in the managed environment.  I'm just not sure how to implement this.  Does anyone have any code samples or links to information?</p>\n"},{"tags":["c++","c","multithreading","winapi","concurrency"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":176,"score":0,"question_id":12362875,"title":"Concurrent log file access in C/C++","body":"<p>I am creating a multiple threads program and several threads may need to call a global function </p>\n\n<pre><code>writeLog(const char* pMsg);\n</code></pre>\n\n<p>and the writeLog will be implemented something like tihs:</p>\n\n<pre><code>void writeLog(const char* pMsg)\n{\n   CRITICAL_SECTION cs;\n\n   // initialize critical section\n   ...\n\n   EnterCriticalSection(&amp;cs);\n\n   // g_pLogFilePath is a global variable.\n   FILE *file;\n   if (0!=fopen_s(&amp;file, g_pLogFilePath, \"r+\"))  \n      return;\n\n   fprintf(file, pMsg);\n\n   fclose(file):\n   LeaveCriticalSection(&amp;cs);\n}\n</code></pre>\n\n<p>My questions are:</p>\n\n<pre><code>1) is it the best way to do concurrent logging? i.e., using critical section.\n\n2) since I will write log in many places in the threads, \nand since each log writing will involve open/close file,\ndoes the io will impact the performance significantly?\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["winapi","mfc"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12364659,"title":"Retrieving language name for keyboard layout from Win XP OS, using win API","body":"<p>I am developing an app using VC6 on WIn XP.\nTo retrieve default input language list from system GetKeyBoardLayoutList() and GetLocalInfo() APIs are used.</p>\n\n<p>Follwoing is the code.</p>\n\n<pre><code>`UINT uLayouts; \nchar szBuf[512];\nHKL  *lpList = NULL;\nuLayouts = GetKeyboardLayoutList(0, NULL);\nlpList   = (HKL*)LocalAlloc(LPTR, (uLayouts * sizeof(HKL)));\nuLayouts = GetKeyboardLayoutList(uLayouts, lpList);\nfor(UINT i = 0; i &lt; uLayouts; i++)\n{\n    DWORD temp = (UINT)lpList[i] &amp; 0xffffffff;\n    GetLocaleInfo(MAKELCID(temp,SORT_DEFAULT), LOCALE_SLANGUAGE , szBuf, 512);\n}`\n</code></pre>\n\n<p>In szBuf i am getting the input language name as \"English (United States)\" where as actaul name in OS is \"English (United States) - US\"</p>\n\n<p>How can we get the exact name of input language present in the OS?\nWe tried using different flags as well like, </p>\n\n<blockquote>\n  <p>LOCALE_SENGLANGUAGE //English</p>\n  \n  <p>LOCALE_ILANGUAGE, LOCALE_SLANGUAGE, LOCALE_ICOUNTRY, LOCALE_SABBREVLANGNAME, LOCALE_SNATIVELANGNAME, LOCALE_SABBREVCTRYNAME, LOCALE_SNATIVECTRYNAME </p>\n</blockquote>\n\n<p>however not able to fetch exact language name.</p>\n"},{"tags":["c#","winapi","hwnd"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12359552,"title":"How to get the next selected window?","body":"<p>I am writing an application that makes some changes to a selected window. I am trying to to figure out how to get the HWND of a window selected after a button press in c#.</p>\n\n<p>The flow would be something like:</p>\n\n<p>The user presses a form button that says select window, the form hides itself as to not allow the selection of itself, the user clicks in another window on the desktop, this can be any application, the form reappears and gathers the HWND of the selected window, the program uses the HWND to do its business.</p>\n\n<p>The part I don't know how to do is get which window was selected.</p>\n\n<p>Any help would be greatly appreciated!</p>\n"},{"tags":["c","winapi","device-driver","winddk","ddk"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12362586,"title":"SetupDiGetDriverInfoDetail returns ERROR_INSUFFICIENT_BUFFER","body":"<p>I used <code>SetupDiGetDriverInfoDetail</code> to retrive the details of the driver. I used the following code fragment for this. But each time I execute my exe I am getting  <code>ERROR_INSUFFICIENT_BUFFER</code>. How to solve this?</p>\n\n<blockquote>\n  <p>SetupDiGetDriverInfoDetail(hDevInfo, &amp;DeviceInfoData, &amp;drvInfoData,\n                                        &amp;drvInfoDetail, sizeof(drvInfoDetail), NULL);</p>\n</blockquote>\n\n<p>Thanks..</p>\n"},{"tags":["c++","multithreading","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":121,"score":0,"question_id":12363071,"title":"Critial section usage in multithreading?","body":"<p>I found this tutorial on web regarding multithreading and download code to try on visual studio 2010. <a href=\"http://www.codeproject.com/Articles/14746/Multithreading-Tutorial\" rel=\"nofollow\">http://www.codeproject.com/Articles/14746/Multithreading-Tutorial</a></p>\n\n<p>One of the program related to 'Thread Local Storage' which i copied below for your reference. It looks very simple as 2 threads, both increasing class data member 'm1', 'm2', 'm3'. In this example 'm2' is a static class variable that can be accessed by both threads.</p>\n\n<p>Notice in the code, critical section is enabled with '#define WITH_SYNCHRONIZATION' at the beginning of file. My understanding is that since the 'for loop' in 'TMain()' is protected by critical section, whichever thread that gets to 'TMain()' first would finish the 50,000 increment as a whole with no interleaving from the other thread, print out '50,020 for m2', and the other thread would continue the rest and print out '100,020 for m2' later.</p>\n\n<p>But no, the print out of m2 looks like there's no critical section at all. The 'm2' value is scrambled with values like:</p>\n\n<p>Thread t2: ... m2=50376 ...\nThread t1: ... m2=63964 ...</p>\n\n<p>I must have missed something basic. What is it?</p>\n\n<p>Any one helps?</p>\n\n<p>Below code is from the webpage with minor value change, can compile in VStuio readily.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;windows.h&gt;\n#include &lt;process.h&gt;\n#include &lt;string&gt;\n\nusing namespace std;\n\n#define WITH_SYNCHRONIZATION\n\nclass ThreadX\n{\nprivate:\n  int        m1;\n  static int m2;                       // shared variable\n  static  __declspec(thread)  int m3;  // thread local variable\n\n\n#ifdef WITH_SYNCHRONIZATION\n  CRITICAL_SECTION m_CriticalSection; \n#endif\n\npublic:\n  string threadName;\n\n  ThreadX()\n  {\n      m1 = 10;\n#ifdef WITH_SYNCHRONIZATION\n        InitializeCriticalSection(&amp;m_CriticalSection);\n#endif\n  }\n\n  virtual ~ThreadX()\n  {\n#ifdef WITH_SYNCHRONIZATION\n       // Release resources used by the critical section object.\n       DeleteCriticalSection(&amp;m_CriticalSection);\n#endif\n  }\n\n  void TMain(void) \n  {\n#ifdef WITH_SYNCHRONIZATION\n    EnterCriticalSection( &amp;m_CriticalSection );\n#endif\n\n    for ( int i = 1; i &lt;= 50000; i++ )\n    {\n        ++m1;  // init value 10\n        ++m2;  // init value 20\n        ++m3;  // init value 30\n    }\n\n    printf( \"Thread %s: m1 = %d, m2 = %d, m3 = %d\\n\", threadName.c_str(), m1, m2, m3 );\n\n#ifdef WITH_SYNCHRONIZATION\n    LeaveCriticalSection( &amp;m_CriticalSection );\n#endif\n\n  } \n\n  static unsigned __stdcall ThreadStaticTMain(void * pThis)\n  {\n      ThreadX * pthX = (ThreadX*)pThis;\n      pthX-&gt;TMain();\n\n      return 1;\n  }\n\n};\n\nint ThreadX::m2 = 20;\nint ThreadX::m3 = 30;\n\nint main()\n{\n    // In this program we create 2 threads and request that their\n    // entry-point-function be the TMain() function of the ThreadX\n    // class.  Because _beginthreadex() cannot accept a class member\n    // function we must employ a 2 step process involving a tricky\n    // cast to accomplish this.\n\n    ThreadX * o1 = new ThreadX();\n\n    HANDLE   hth1;\n    unsigned  uiThread1ID;\n\n    hth1 = (HANDLE)_beginthreadex( NULL,         \n                                   0,            \n                                   ThreadX::ThreadStaticTMain,\n                                   o1,           \n                                   CREATE_SUSPENDED, \n                                   &amp;uiThread1ID );\n\n    if ( hth1 == 0 )\n        printf(\"Failed to create thread 1\\n\");\n\n    DWORD   dwExitCode;\n\n    GetExitCodeThread( hth1, &amp;dwExitCode );\n    printf( \"initial thread 1 exit code = %u\\n\", dwExitCode );\n\n    o1-&gt;threadName = \"t1\";\n\n    ThreadX * o2 = new ThreadX();\n\n    HANDLE   hth2;\n    unsigned  uiThread2ID;\n\n    hth2 = (HANDLE)_beginthreadex( NULL,         \n                                   0,            \n                                   ThreadX::ThreadStaticTMain,\n                                   o2,           \n                                   CREATE_SUSPENDED, \n                                   &amp;uiThread2ID );\n\n    if ( hth2 == 0 )\n        printf(\"Failed to create thread 2\\n\");\n\n    GetExitCodeThread( hth2, &amp;dwExitCode ); \n    printf( \"initial thread 2 exit code = %u\\n\", dwExitCode );\n\n    o2-&gt;threadName = \"t2\";\n\n    ResumeThread( hth1 );   \n    ResumeThread( hth2 );   \n\n    WaitForSingleObject( hth1, INFINITE );  \n    WaitForSingleObject( hth2, INFINITE );  \n\n    GetExitCodeThread( hth1, &amp;dwExitCode );\n    printf( \"thread 1 exited with code %u\\n\", dwExitCode );\n\n    GetExitCodeThread( hth2, &amp;dwExitCode );\n    printf( \"thread 2 exited with code %u\\n\", dwExitCode );\n\n    // The handle returned by _beginthreadex() has to be closed\n    // by the caller of _beginthreadex().\n\n    CloseHandle( hth1 );\n    CloseHandle( hth2 );\n\n    delete o1;\n    o1 = NULL;\n\n    delete o2;\n    o2 = NULL;\n\n    printf(\"Primary thread terminating.\\n\");\n    return 0;\n}\n</code></pre>\n"},{"tags":["c++","multithreading","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":87,"score":2,"question_id":12351723,"title":"Synchronize I/O with calling thread?","body":"<p>In <a href=\"http://msdn.microsoft.com/en-us/library/ms810438.aspx\" rel=\"nofollow\">this article</a>, section 'More Waiting...', when author talked about synchronize i/o with thread, the 1st example he gives is:</p>\n\n<pre><code>hFile = CreateFile(....,FILE_IO_OVERLAPPED,...);\nReadFile(hFile,...)\n&lt; Do some computation.&gt;\nWaitForSingleObject(hFile,INFINITE);\n</code></pre>\n\n<p>I had the impression that both 'CreateFile' and 'ReadFile' are <strong>synchronous</strong> APIs, no? Why would a 'WaitForSingleObject' needed here? Wouldn't 'CreateFile' and 'ReadFile' block until the operation is over and then return?</p>\n\n<p>Then some more confusion coming when author talks about 'alertable waiting'. What is it, a thread state after WaitForSingleObjectEx()? then why author give:</p>\n\n<pre><code>while (WaitForSingleObject(hObject,TRUE)==WAIT_IO_COMPLETION);\n</code></pre>\n\n<p>as example instead of </p>\n\n<pre><code>while (WaitForSingleObjectEx(hObject,TRUE)==WAIT_IO_COMPLETION);\n</code></pre>\n\n<p>?</p>\n\n<p>and should 'ex' functions be together like:</p>\n\n<pre><code>hFile = CreateFile(....,FILE_IO_OVERLAPPED,...);\nReadFileEx(hFile,...)\n&lt; Do some computation.&gt;\nwhile (WaitForSingleObjectEx(hObject,TRUE)==WAIT_IO_COMPLETION);\n</code></pre>\n\n<p>Any one can explain a little more?</p>\n\n<p>Thanks,</p>\n"},{"tags":["winapi","vcl","widestring","c++builder-xe2","widechar"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":158,"score":0,"question_id":12360127,"title":"C++ Builder XE2: How to convert String to a wchar_t*","body":"<p>I have the SHBrowseForFolder to popup and work fine, but I would like to set the Title. I know it has to be a wchar_t* and when I use a const like (wchar_t*)L\"My Title\" the title is shown correct.</p>\n\n<p>But if I try to use a String value I only get the first letter 'M', it's like the wide string has been converted to new wide string once again, pading each character with a nul.</p>\n\n<pre><code>Winapi::Shlobj::BROWSEINFO bi = {0};\nbi.hwndOwner = Handle;\nbi.ulFlags = BIF_NEWDIALOGSTYLE | BIF_EDITBOX | BIF_BROWSEFORCOMPUTER;\nbi.lpszTitle = String(\"My Title\").w_str(); // This only shows the 'M'\n//bi.lpszTitle = (wchar_t*)\"My Title\";       // This shows the full string 'My Title'\nLPITEMIDLIST pidl = SHBrowseForFolder((_browseinfoA*)&amp;bi);\n\nif ( pidl != 0 ) {\n\n  // free memory used\n  IMalloc *imalloc = 0;\n  if (SUCCEEDED(SHGetMalloc(&amp;imalloc))) {\n    imalloc-&gt;Free(pidl);\n    imalloc-&gt;Release();\n  }\n}\n</code></pre>\n\n<p>The documentation for <a href=\"http://docwiki.embarcadero.com/Libraries/en/System.UnicodeString.c_str\" rel=\"nofollow\">UnicodeString</a> all conversion functions <code>c_str()</code>,<code>t_str()</code> and <code>w_str()</code> all returns a <code>wchar_t*</code> but the declaration shows <code>WideChar*</code>.</p>\n\n<p>Any ideas how to make this code work together with a String?</p>\n"},{"tags":["delphi","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":137,"score":0,"question_id":12338486,"title":"How to simulate Windows Theme behaviour when TComboBox uses csOwnerDrawFixed or csOwnerDrawVariable?","body":"<p>A very easy way to show different string values than the <a href=\"http://docwiki.embarcadero.com/Libraries/en/Vcl.StdCtrls.TCustomCombo.Items\" rel=\"nofollow\">Items</a> is to set the <a href=\"http://docwiki.embarcadero.com/Libraries/en/Vcl.StdCtrls.TCustomComboBox.Style\" rel=\"nofollow\">Style</a> property from <a href=\"http://docwiki.embarcadero.com/Libraries/en/Vcl.StdCtrls.TComboBoxStyle\" rel=\"nofollow\"><code>csDropDown</code> to <code>csOwnerDrawFixed</code></a> as <a href=\"http://stackoverflow.com/users/282848/andreas-rejbrand\">Andreas Rejbrand</a> has <a href=\"http://stackoverflow.com/a/3022956/29290\">answered a few years ago</a>.</p>\n\n<p>The thing is: as soon as you do that, you loose Windows Theming support.<br>\nThe same limitation applies to using <code>csOwnerDrawVariable</code></p>\n\n<p>These two <code>Style</code> values get translated into adding the <code>CBS_OWNERDRAWFIXED</code> or <code>CBS_OWNERDRAWVARIABLE</code> (in addition to <code>CBS_DROPDOWNLIST</code>) <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb775796\" rel=\"nofollow\">styles</a> of the Windows <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa380889\" rel=\"nofollow\">COMBOBOX control</a>.</p>\n\n<p>In turn, <code>CBS_OWNERDRAWFIXED</code> or <code>CBS_OWNERDRAWVARIABLE</code> cause you to <a href=\"http://stackoverflow.com/questions/10031621/cbs-dropdownlist-combo-fails-to-respond-to-wm-ctlcolor-under-windows-ux-themi\">instantly loose the Windows theming support</a>.</p>\n\n<p>When you do full custom painting <a href=\"http://www.codeforge.cn/read/9851/XColorPickerXP.cpp__html\" rel=\"nofollow\">like a colour picker</a>, that is all fine. But when you only want to replace the drawn text, it is not.</p>\n\n<p><a href=\"http://stackoverflow.com/questions/2125090/ownerdraw-combobox-is-not-styled-anymore\">The Windows COMBOBOX control does not seem to have a way around this</a>, so I'm wondering: how can you simulate the Windows theming from Delphi?</p>\n\n<p>I assume it has to do with <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb773289\" rel=\"nofollow\">DrawThemedBackground</a>, but it has been a while since I've done serious Delphi Control work, so any pointers on how to get started there are fine too (even if they invalidate my assumption).</p>\n"},{"tags":["c++","windows","winapi","power-management"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12359230,"title":"CallNtPowerInformation API fails with error code STATUS_INVALID_PARAMETER","body":"<p>I run the following code to get the video display timeout from a Windows OS:</p>\n\n<pre><code>SYSTEM_POWER_POLICY spp = {0};\nDWORD dwRes = CallNtPowerInformation(SystemPowerPolicyAc, NULL, 0, &amp;spp, sizeof(spp));\nif(dwRes != STATUS_SUCCESS)\n{\n    //Error 0xC000000D or STATUS_INVALID_PARAMETER\n    //An invalid parameter was passed to a service or function.\n}\nelse\n{\n    int nTimeout = spp.VideoTimeout;\n}\n</code></pre>\n\n<p>It works on my Windows 7 but then on another laptop running Windows 7 as well it returns the error code STATUS_INVALID_PARAMETER. Does anyone have any idea why? And how to remedy it?</p>\n"},{"tags":["c++","winapi","mfc"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":637,"score":1,"question_id":7913927,"title":"How to Remove the Readonly attribute of a File MFC","body":"<p>In my MFC application I have set the Readonly attribute to a particular file.\nI have done this by using the 'SetFileAttributes' Function\nBut at some point I have to remove that attribute of that file again so anyone please helpme saying how to do this....</p>\n\n<p>Thanks In advance.... :) \nWaiting for an Answer</p>\n\n<p>Jijesh</p>\n"},{"tags":["c++","windows","winapi","process"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":104,"score":2,"question_id":12348220,"title":"How integrity level of a process is determined?","body":"<p>I want to launch a process with high integrity level. The parent process is running as a System service, LocalSystem account. In one Windows 2008 machine, the sub process is of high level while in another 2008 machine, the process is the \"medium\" level. It looks like <code>CreateProcessAsUser</code> get different level in different machine.</p>\n\n<pre><code>if (!WTSQueryUserToken(sessionID, &amp;hToken)) \n{//The admin user logged in the rdp session of \"sessionID\".\n    return;\n}\nBOOL fSuccess = CreateProcessAsUser(hToken, NULL, cmdLine, NULL, NULL,\nTRUE,CREATE_NEW_CONSOLE,NULL, workDir, &amp;si, &amp;pi);\n</code></pre>\n\n<p>What bring about the difference? Is there a config or program way to solve it?</p>\n"},{"tags":["winapi","nsis"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12352162,"title":"Getting info from struct after calling system plugin","body":"<p>I am trying to get some info from windows via the System plugin and the <code>netapi32</code> library. </p>\n\n<p>I try to call <code>NetWkstaGetInfo()</code> after allocating a struct suitable as a <code>WKSTA_INFO_100</code>.</p>\n\n<p>The <code>NetWkstaGetInfo()</code> prototype states in MSDN:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>NET_API_STATUS NetWkstaGetInfo(\n  _In_   LPWSTR servername,\n  _In_   DWORD level,\n  _Out_  LPBYTE *bufptr\n);\n</code></pre>\n\n<p>While the <code>WKSTA_INFO_100</code> is </p>\n\n<pre class=\"lang-c prettyprint-override\"><code>typedef struct _WKSTA_INFO_100 {\n  DWORD wki100_platform_id;\n  LMSTR wki100_computername;\n  LMSTR wki100_langroup;\n  DWORD wki100_ver_major;\n  DWORD wki100_ver_minor;\n} WKSTA_INFO_100, *PWKSTA_INFO_100, *LPWKSTA_INFO_100;\n</code></pre>\n\n<p>For a preliminary test, I try to display the struct members in a messagebox. I first initialize the struct with dummy info to check if the api call replaces the content of my allocated block. </p>\n\n<p>But until now I got barely nothing after the first struct member, I suppose that the struct is not correctly defined, or that I have a struct alignment issue. Unfortunately the weird documentation of the System plugin <strike>is driving me nuts</strike> does not help me much.</p>\n\n<p>Here is my test script:</p>\n\n<pre class=\"lang-default prettyprint-override\"><code>outfile \"hello.exe\"\n\nsection\n\nSystem::Call /NOUNLOAD \"*(*i11,t 'some',t 'thing',i22,i44)i .r0\"\nDumpstate::debug\nSystem::Call /NOUNLOAD \"netapi32::NetWkstaGetInfo(i0, i100, i r0) i.r6\"\nDumpstate::debug\nSystem::Call /NOUNLOAD \"*$0(*i.r1, t.r2, t.r3, i.r4, i.r5)\"\nDumpstate::debug\nmessagebox MB_OK \"Hello, to $2 $3 domain (win $1 - $4.$5) !\"\nSystem::Free $0\n\nsectionEnd\n</code></pre>\n\n<p>The first retrieved value (500) is correct. But the other members keep their initial value. What I am missing?</p>\n\n<p><strong>(Edit)</strong> Corollary questions:</p>\n\n<ul>\n<li>it seems that following the documentation and MSDN, the first member of the struct should be <code>i</code> and not <code>*i</code> but I did not managed to get a correct returned value without the <code>*</code> (the Dumpstate plugin tends to show it is returned as an address)</li>\n<li>is the <code>/NOUNLOAD</code> parameter for the plugin mandatory? I have found several examples with it but did not find a precise reason for it. I feared that the allocated struct could have been freed prematurely without the parameter. Could you confirm / infirm?</li>\n</ul>\n"},{"tags":["c++","winapi"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":839,"score":4,"question_id":2925726,"title":"Win32 DLL importing issues (DllMain)","body":"<p>I have a native DLL that is a plug-in to a different application (one that I have essentially zero control of). Everything works just great until I link with an additional .lib file (links my DLL to another DLL named <code>ABQSMABasCoreUtils.dll</code>). This file contains some additional API from the parent application that I would like to utilize. I haven't even written any code to use any of the functions exported but just linking in this new DLL is causing problems. Specifically, I get the following error when I attempt to run the program:</p>\n\n<p><strong>The application failed to initialize properly (0xc0000025). Click on OK to terminate the application.</strong></p>\n\n<p>I believe I have read somewhere that this is typically due to a DllMain function returning FALSE. Also, the following message is written to the standard output:</p>\n\n<p><strong>ERROR: Memory allocation attempted before component initialization</strong></p>\n\n<p>I am almost 100% sure this error message is coming from the application and is not some type of Windows error.</p>\n\n<p>Looking into this a little more (aka flailing around and flipping every switch I know of) I linked with /MAP turned on and found this in the resulting .map file:</p>\n\n<pre><code> 0001:000af220       ??3@YAXPEAX@Z              00000001800b0220 f   ABQSMABasCoreUtils_import:ABQSMABasCoreUtils.dll\n 0001:000af226       ??2@YAPEAX_K@Z             00000001800b0226 f   ABQSMABasCoreUtils_import:ABQSMABasCoreUtils.dll\n 0001:000af22c       ??_U@YAPEAX_K@Z            00000001800b022c f   ABQSMABasCoreUtils_import:ABQSMABasCoreUtils.dll\n 0001:000af232       ??_V@YAXPEAX@Z             00000001800b0232 f   ABQSMABasCoreUtils_import:ABQSMABasCoreUtils.dll\n</code></pre>\n\n<p>If I undecorate those names using \"undname\" they give the following (same order):</p>\n\n<pre><code>void __cdecl operator delete(void * __ptr64)\nvoid * __ptr64 __cdecl operator new(unsigned __int64)\nvoid * __ptr64 __cdecl operator new[](unsigned __int64)\nvoid __cdecl operator delete[](void * __ptr64)\n</code></pre>\n\n<p>I am not sure I understand how anything from <code>ABQSMABasCoreUtils.dll</code> can exist within this .map file or why my DLL is even attempting to load ABQSMABasCoreUtils.dll if I don't have any code that references this DLL. Can anyone help me put this information together and find out why this isn't working? For what it's worth I have confirmed via \"dumpbin\" that the parent application imports <code>ABQSMABasCoreUtils.dll</code>, so it is being loaded no matter what. I have also tried delay loading this DLL in my DLL but that did not change the results.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I have double checked and all files involved are 64 bit.</p>\n"}]}
{"total":13828,"page":12,"pagesize":100,"questions":[{"tags":["windows","winapi","parallel-processing","thread-priority"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12356183,"title":"Is it advisable to use the Windows API 'SetThreadPriority' within a parallel_for_each loop","body":"<p>I would like to reduce the thread-priority of the threads servicing a parallel_for_each, because under heavy load conditions they consume too much processor time relative to other threads in my system.</p>\n\n<p>Questions:</p>\n\n<p>1) Do the servicing threads of a parallel_for_each inherit the thread-priority of the calling thread?  In this case I could presumably call SetThreadPriority before and after the parallel_for_each, and everything should be fine.</p>\n\n<p>2) Alternatively is it advisable to call SetThreadPriority within the parallel_for_each?  This will clearly invoke the API multiple times for the same threads.  Is there a large overhead of doing this?</p>\n\n<p>2.b) Assuming that I do this, will it affect thread-priorities the next time that parallel_for_each is called - ie do I need to somehow reset the priority of each thread afterwards?</p>\n\n<p>3) I'm wondering about thread-priorities in general.  Would anyone like to comment: supposing that I had 2 threads contending for a single processor and one was set to \"below-normal\" while the other was \"normal\" priority.  Roughly what percentage more processor time would the one thread get compared to the other?</p>\n"},{"tags":["c++","c","winapi"],"answer_count":4,"favorite_count":5,"up_vote_count":7,"down_vote_count":0,"view_count":342,"score":7,"question_id":9009333,"title":"How to check if the program is run from a console?","body":"<p>I'm writing an application which dumps some diagnostics to the standard output.</p>\n\n<p>I'd like to have the application work this way:</p>\n\n<ul>\n<li>If it is run from a standalone command prompt (via <code>cmd.exe</code>) or has standard output redirected/piped to a file, exit cleanly as soon as it finished,</li>\n<li>Otherwise (if it is run from a window and the console window is spawned automagically), then \nadditionally wait for a keypress before exiting (to let the user read the diagnostics) before the window disappears</li>\n</ul>\n\n<p>How do I make that distinction? <em>I suspect that examining the parent process could be a way but I'm not really into WinAPI, hence the question.</em></p>\n\n<p>I'm on MinGW GCC.</p>\n"},{"tags":["winapi","windows-2000"],"answer_count":5,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":12350063,"title":"Can I find out if a WinAPI function is not available in Windows 2000?","body":"<p>MSDN generally only lists Windows XP as \"Minimum supported client\", probably because Windows 2000 and older have reached the end of their lifecycle. However, some of our users are using our software on Windows 2000 machines, and I don't want to break this compatibility if I can avoid it. Can I find out if a Windows API function is not available in Windows 2000 (without testing each function on that system)?</p>\n"},{"tags":["c++","windows","winapi","mfc"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":5329,"score":5,"question_id":510845,"title":"How to determine if the current window is the active window?","body":"<p>How can I tell if my window is the current active window?\nMy current guess is to do GetForegroundWindow and compare the HWND with that of my window.\nIs there a better method than that?</p>\n\n<p>I'm using Win32 API / MFC.</p>\n"},{"tags":["c","winapi","windows-7"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12331439,"title":"Searching for directories only","body":"<pre><code>int main(void) \n{   \n\n    HANDLE hFoundFile;\n    WIN32_FIND_DATA foundFileData;\n\n    SetCurrentDirectory(TEXT(\"C:\\\\\"));\n\n    hFoundFile = FindFirstFileEx(TEXT(\"*\"),FINDEX_INFO_LEVELS::FindExInfoBasic,&amp;foundFileData ,FINDEX_SEARCH_OPS::FindExSearchLimitToDirectories ,NULL , NULL);\n\n    do\n    {\n        wprintf(TEXT(\"%s\\n\"),foundFileData.cFileName);\n\n    }\n    while(FindNextFile(hFoundFile,&amp;foundFileData));\n\n    system(\"Pause\");\n    return 0;\n}\n</code></pre>\n\n<p>Why does it output also \"regular\" files, although <code>FINDEX_SEARCH_OPS::FindExSearchLimitToDirectories</code> option is explicitly passed to the function?</p>\n"},{"tags":["c++","winapi","printing","epson","dot-matrix"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":932,"score":1,"question_id":7039673,"title":"Read Epson Printer Status using C++ and ESC/P","body":"<p>I'm trying to get the status of a <strong>PLQ-20 Espon</strong> printer, using <strong>C++</strong>, but with no success.</p>\n\n<p>I tried that using <strong>GDI API</strong> and <strong>Escape</strong> function with <strong>PASSTHROUGH</strong> parameter, but the printer never understands the escape codes with that function.</p>\n\n<p>I tried to use <strong>WIN 32 API</strong> and the example code found <a href=\"http://support.microsoft.com/kb/138594\" rel=\"nofollow\">here</a>. That works for sending some escape codes like <strong>BEL</strong> (to sound the buzzer) or <strong>FF</strong> (Form Feed, to eject paper from the rear of the printer), but not <strong>ESC O</strong> (to eject paper from the front of the printer), <strong>ESC 0</strong> / <strong>ESC 1</strong> (to initialize the printer / reset errors).</p>\n\n<p>So, I tried this way to get the status of the printer with a <strong>ESC j</strong> escape code but with no success (the <strong>ReadPrinter</strong> function returns 0). Moreover, the print buffer seems to be not empty nonetheless I only send escape commands.</p>\n\n<p>I don't know if I do a mistake sending escape codes or trying to read the printer status.</p>\n\n<p>If anyone could post examples, it could be fine for everyone because it's hard to find them on the web.</p>\n\n<p>Below is the code I use to send commands and read the result</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;StdIO.h&gt;\n\n\n// **********************************************************************\n// PrintError - uses printf() to display error code information\n// \n// Params:\n//   dwError       - the error code, usually from GetLastError()\n//   lpString      - some caller-defined text to print with the error info\n// \n// Returns: void\n// \nvoid PrintError( DWORD dwError, LPCTSTR lpString )\n{\n#define MAX_MSG_BUF_SIZE 512\n    TCHAR   *msgBuf;\n    DWORD   cMsgLen;\n\n    cMsgLen = FormatMessage( FORMAT_MESSAGE_FROM_SYSTEM |\n                FORMAT_MESSAGE_ALLOCATE_BUFFER | 40, NULL, dwError,\n                MAKELANGID(0, SUBLANG_ENGLISH_US), (LPTSTR) &amp;msgBuf,\n                MAX_MSG_BUF_SIZE, NULL );\n    printf(\"%s Error [%d]:: %s\\n\", lpString, dwError, msgBuf );\n    LocalFree( msgBuf );\n#undef MAX_MSG_BUF_SIZE\n}\n// end PrintError\n// **********************************************************************\n\n// **********************************************************************\n// ReadFileWithAlloc - allocates memory for and reads contents of a file\n// \n// Params:\n//   szFileName   - NULL terminated string specifying file name\n//   pdwSize      - address of variable to receive file bytes size\n//   ppBytes      - address of pointer which will be allocated and contain file bytes\n// \n// Returns: TRUE for success, FALSE for failure.\n//\n// Notes: Caller is responsible for freeing the memory using GlobalFree()\n// \nBOOL ReadFileWithAlloc( LPTSTR szFileName, LPDWORD pdwSize, LPBYTE *ppBytes )\n{\n    HANDLE      hFile;\n    DWORD       dwBytes;\n    BOOL        bSuccess = FALSE;\n\n    // Validate pointer parameters\n    if( ( pdwSize == NULL ) || ( ppBytes == NULL ) )\n        return FALSE;\n    // Open the file for reading\n    hFile = CreateFile( szFileName, GENERIC_READ, 0, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL );\n    if( hFile == INVALID_HANDLE_VALUE )\n    {\n        PrintError( GetLastError(), TEXT(\"CreateFile()\") );\n        return FALSE;\n    }\n    // How big is the file?\n    *pdwSize = GetFileSize( hFile, NULL );\n    if( *pdwSize == (DWORD)-1 )\n        PrintError( GetLastError(), TEXT(\"GetFileSize()\") );\n    else\n    {\n        // Allocate the memory\n        *ppBytes = (LPBYTE)GlobalAlloc( GPTR, *pdwSize );\n        if( *ppBytes == NULL )\n            PrintError( GetLastError(), TEXT(\"Failed to allocate memory\\n\") );\n        else\n        {\n            // Read the file into the newly allocated memory\n            bSuccess = ReadFile( hFile, *ppBytes, *pdwSize, &amp;dwBytes, NULL );\n            if( ! bSuccess )\n                PrintError( GetLastError(), TEXT(\"ReadFile()\") );\n        }\n    }\n    // Clean up\n    CloseHandle( hFile );\n    return bSuccess;\n}\n// End ReadFileWithAlloc\n// **********************************************************************\n\n// **********************************************************************\n// RawDataToPrinter - sends binary data directly to a printer\n// \n// Params:\n//   szPrinterName - NULL terminated string specifying printer name\n//   lpData        - Pointer to raw data bytes\n//   dwCount       - Length of lpData in bytes\n// \n// Returns: TRUE for success, FALSE for failure.\n// \nBOOL RawDataToPrinter( LPTSTR szPrinterName, LPBYTE lpData, DWORD dwCount )\n{\n    HANDLE     hPrinter;\n    DOC_INFO_1 DocInfo;\n    DWORD      dwJob;\n    DWORD      dwBytesWritten;\n\n    // Need a handle to the printer.\n    if( ! OpenPrinter( szPrinterName, &amp;hPrinter, NULL ) )\n    {\n        PrintError( GetLastError(), TEXT(\"OpenPrinter\") );\n        return FALSE;\n    }\n\n    // Fill in the structure with info about this \"document.\"\n    DocInfo.pDocName = TEXT(\"My Document\");\n    DocInfo.pOutputFile = NULL;\n    DocInfo.pDatatype = TEXT(\"RAW\");\n    // Inform the spooler the document is beginning.\n    if( (dwJob = StartDocPrinter( hPrinter, 1, (LPBYTE)&amp;DocInfo )) == 0 )\n    {\n        PrintError( GetLastError(), TEXT(\"StartDocPrinter\") );\n        ClosePrinter( hPrinter );\n        return FALSE;\n    }\n    // Start a page.\n    if( ! StartPagePrinter( hPrinter ) )\n    {\n        PrintError( GetLastError(), TEXT(\"StartPagePrinter\") );\n        EndDocPrinter( hPrinter );\n        ClosePrinter( hPrinter );\n        return FALSE;\n    }\n    // Send the data to the printer.\n    if( ! WritePrinter( hPrinter, lpData, dwCount, &amp;dwBytesWritten ) )\n    {\n        PrintError( GetLastError(), TEXT(\"WritePrinter\") );\n        EndPagePrinter( hPrinter );\n        EndDocPrinter( hPrinter );\n        ClosePrinter( hPrinter );\n        return FALSE;\n    }\n\n    /*********************************/\n    // CODE USED TO READ THE PRINTER\n    LPBYTE retData = NULL;\n    LPDWORD bbr = NULL;\n\n    if(ReadPrinter(hPrinter, retData, 1, bbr))\n    {\n        printf(\"OUT : %i\", retData);\n    }\n    else\n    {\n        printf(\"Failed to read printer\");\n    }\n    /*********************************/\n\n    // End the page.\n    if( ! EndPagePrinter( hPrinter ) )\n    {\n        PrintError( GetLastError(), TEXT(\"EndPagePrinter\") );\n        EndDocPrinter( hPrinter );\n        ClosePrinter( hPrinter );\n        return FALSE;\n    }\n    // Inform the spooler that the document is ending.\n    if( ! EndDocPrinter( hPrinter ) )\n    {\n        PrintError( GetLastError(), TEXT(\"EndDocPrinter\") );\n        ClosePrinter( hPrinter );\n        return FALSE;\n    }\n    // Tidy up the printer handle.\n    ClosePrinter( hPrinter );\n    // Check to see if correct number of bytes were written.\n    if( dwBytesWritten != dwCount )\n    {\n        //printf( TEXT(\"Wrote %d bytes instead of requested %d bytes.\\n\"), dwBytesWritten, dwCount );\n        return FALSE;\n    }\n    return TRUE;\n}\n// End RawDataToPrinter\n// **********************************************************************\n\nint main( int argc, char* argv[] )\n{\n    LPBYTE  pBytes = NULL;\n\n    int textSize = 2;\n\n    DWORD   dwSize = textSize;\n\n    pBytes = (LPBYTE) malloc (textSize*sizeof(BYTE));\n\n    pBytes[0] = 0x1B;\n    pBytes[1] = 0x6A;\n\n\n    if( ! RawDataToPrinter(L\"EPSON PLQ-20 ESC/P2\", pBytes, dwSize) )\n        printf(\"Failed to send data to printer.\\n\" );\n    else\n        printf(\"Data sent to printer.\\n\" );\n\n    free(pBytes);\n    return 0;\n}\n// end main\n// **********************************************************************\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["winapi","fullscreen","taskbar"],"answer_count":5,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":6049,"score":4,"question_id":2382464,"title":"Win32: full-screen and hiding taskbar","body":"<p>I have a window, which I <code>SetWindowPos(window, HWND_TOP, 0, 0, GetSystemMetrics(SM_CXSCREEN), GetSystemMetrics(SM_CYSCREEN), SWP_FRAMECHANGED);</code></p>\n\n<p>It covers the whole screen, ok, but it takes a while (0.5 sec) to cover the taskbar as well.</p>\n\n<p>Is there a way to come over the taskbar immediately? I found that setting <code>HWND_TOPMOST</code> does it immediately, but it stays above all the other windows, even if I switch the app - this is something I don't want. Also, if I first hide the window and then show it, it somehow forces the window to redraw and covers the taskbar immediately, but it flickers (because of the hiding). Is there another way?</p>\n"},{"tags":["c++","c","winapi","gui"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":137,"score":0,"question_id":12345435,"title":"Drag and Drop Support for win32 GUI","body":"<p>I've created non-MFC GUI with simple Edit controls and buttons using win32 API. Now i got the requirement to drag and drop the Browser URL into the one of the edit control of my GUI Application, How can i do this ? is Win32 Api support this feature ?</p>\n"},{"tags":["python","winapi","readdirectorychangesw"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":346,"score":2,"question_id":6828544,"title":"ReadDirectoryChangesW blocks deleting the watched directory","body":"<p>I am trying to watch a directory for create/delete/rename changes on windows with python using the ReadDirectoryChangesW API. This is my code and it is working fine:</p>\n\n<pre><code>        results = win32file.ReadDirectoryChangesW(self.hDir, 8192, True, self.type, None, None)\n\n        for action, file in results:\n            full_filename = os.path.join (self.source_path, file)\n            if   action == 1:                                                   # Created\n                self.fileCreated(full_filename)\n            elif action == 2:                                                   # Deleted\n                self.fileDeleted(full_filename)\n            elif action == 3:                                                   # Updated\n                self.fileUpdated(full_filename)\n            elif action == 4:                                                   # Renamed from something\n                renamed_file = full_filename\n            elif action == 5:                                                   # Renamed to something\n                self.fileRenamed(renamed_file, full_filename)\n</code></pre>\n\n<p>However, when I try to delete the watched folder from python or from windows explorer, I get:</p>\n\n<p><strong>WindowsError: [Error 32] The process cannot access the file because it is being used by another process: 'c:\\users\\user\\appdata\\local\\temp\\new_dir'</strong></p>\n\n<p>I believe this makes sense, but how should I solve this? Because my application should allow the user to remove a watched folder. I tried the solution for the asynchronous method <a href=\"http://www.themacaque.com/?p=859\" rel=\"nofollow\">http://www.themacaque.com/?p=859</a>, but it didnt help.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c++","winapi","cursor","zoom","mouse-cursor"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12344221,"title":"user32.dll ShowSystemCursor not making cursor visible again","body":"<p>I am using user32.dll's undocumented ShowSystemCursor to hide windows system cursor. This works perfectly for what I want, hoever when I try to un-hide the cursor by passing in TRUE, the cursor will not return. You have to move your cursor over another acting window before it comes back.</p>\n\n<p>I realise using undocumented methods isn't ideal but I have no other choice. I am trying to hide the cursor completely, but still have it visible when zooming in as I am writing a zoom program for Windows 7 and 8. Yes hiding the system cursor is exactly what I am trying to achieve. Any help would be appreciated.</p>\n"},{"tags":["c","windows","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":3,"view_count":124,"score":-1,"question_id":12339105,"title":"Variables addresses in C","body":"<p>This is my code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\nint main(){\n    char *dd,aaa[500];\n    strcpy(aaa,\"test 1\");\n    dd=aaa;\n    printf(\"1. %s\\n\",dd);\n    strcpy(aaa,\"test 2\");\n    printf(\"2. %s\\n\",dd);\n\n\nsystem(\"pause\");\nreturn 0;\n}\n</code></pre>\n\n<p>When i have changed <code>aaa</code> variable by <code>test 2</code> string, <code>dd</code> also changes, why?</p>\n"},{"tags":["c++","winapi","hook"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12342875,"title":"Hooking a procedure last","body":"<p>I'm currently making a plugin for one application and since it doesn't handle the WM_MBUTTONDOWN message I decided to hook the WNDPROC but it seems that another plugin hooks it too and handles this message (since the application loads the plugins in alphabetical order, there's a chance that I might not hook the WNDPROC last, resulting in the other plugin handling the message first). This means I'd have to be the last one to hook the WNDPROC to be able to get to those messages. </p>\n\n<p>So, are there any reliable (not relying on alphabetical order, etc.) ways of hooking a procedure last?</p>\n\n<p>EDIT: the hooking is done by changing the DWL_WNDPROC property of the window to the address hook procedure using the SetWindowLong function. The original DWL_WNDPROC is then called from the hook procedure using CallWindowProc. Sorry for not making this clear!</p>\n\n<p>Thanks,\nTuntuni.</p>\n"},{"tags":["c++","winapi","window"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12337637,"title":"change WindowClass to full screen","body":"<p>so am trying to make my window class full screen, but it's not working , it just flickers black then it does not become full screen here is the source code :-</p>\n\n<pre><code>void InitEngine::Init(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nShowCmd, DesktopScreenInfo * ScreenInfo, LPSTR WindowName)\n{\n    mWindoClass = new WNDCLASSEX();\n    ZeroMemory(mWindoClass,sizeof(WNDCLASSEX));\n    if(ScreenInfo) mScreenInfo = ScreenInfo;\n    else mScreenInfo = &amp;DesktopScreen::GetScreenInfo();\n\n    mWindoClass-&gt;cbSize        = sizeof(WNDCLASSEX);// window size\n    mWindoClass-&gt;style         = CS_HREDRAW | CS_VREDRAW; // so it draw when Horizontal or Vertical change\n    mWindoClass-&gt;lpfnWndProc   = WindowProc;\n    mWindoClass-&gt;hInstance     = hInstance;\n    mWindoClass-&gt;hCursor       = LoadCursor(NULL, IDC_ARROW); //load normal cursor\n    mWindoClass-&gt;hbrBackground = (HBRUSH)COLOR_WINDOW;\n    mWindoClass-&gt;lpszClassName = \"PoPEngineClass\";\n\n    DEVMODE screen;\n    memset(&amp;screen,0,sizeof(screen));\n    screen.dmSize = sizeof(screen);\n    screen.dmPelsWidth = mScreenInfo-&gt;Width;\n    screen.dmPelsHeight = mScreenInfo-&gt;Height;\n    screen.dmBitsPerPel = mScreenInfo-&gt;ScreenDepth;\n    screen.dmDisplayFrequency = mScreenInfo-&gt;FrameRate;\n    screen.dmFields = DM_BITSPERPEL|DM_PELSWIDTH|DM_PELSHEIGHT;\n    ChangeDisplaySettings(&amp;screen, CDS_FULLSCREEN);\n\n    RegisterClassEx(mWindoClass);\n\n    WindowHandel = CreateWindowEx(NULL , mWindoClass-&gt;lpszClassName , WindowName , WS_POPUP, 0 , 0, mScreenInfo-&gt;Width, mScreenInfo-&gt;Height, NULL, NULL, hInstance, NULL);\n    ShowWindow(WindowHandel, nShowCmd);\n    UpdateWindow(WindowHandel);\n\n    while (GetMessage(&amp;msg, NULL, 0, 0))\n    {\n        TranslateMessage(&amp;msg);\n        DispatchMessage(&amp;msg);\n    }\n}\n</code></pre>\n"},{"tags":["c#","winapi","listview","sendmessage"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":62,"score":-2,"question_id":12342433,"title":"I need to select an item of a sysListView32 using sendmessage in C#","body":"<p>I'm automating meta trader issues. I need to select an item on a syslistview32 (Listview) using sendmessage in C#. Anybody could help me?</p>\n\n<p>Prateek</p>\n"},{"tags":["c++","winapi","ntfs","file-security"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12338711,"title":"ERROR_ACCESS_DENIED setting file owner","body":"<p>I am trying to set the owner of a file to another user programmatically in C++.</p>\n\n<p>I have definitely enabled the <code>SeRestorePrivilege</code> for my process. I can confirm this using Process Explorer. I start the process, it is disabled, I run my code to enable it, ProcExp reports it as enabled, I go just up to the point where the owner is to be set, and it is still enabled (i.e. I am not accidentally disabling it).</p>\n\n<p>What other caused can there be for this access is denied message? What have I not considered?</p>\n\n<pre><code>std::wstring fileSystemObject = L\"C:\\test.txt\";\n*status_code = SetNamedSecurityInfo((wchar_t*)fileSystemObject.c_str(), SE_FILE_OBJECT, OWNER_SECURITY_INFORMATION, pSID, NULL, NULL, NULL);\nif (*status_code == ERROR_SUCCESS)\n{\n    Log(L\"Successfully set owner for \" + fileSystemObject);\n    return true;\n}\nelse\n{\n    Log(L\"Failed to set owner for \" + fileSystemObject + L\". Error code: \", *status_code);\n    return false;\n}\n</code></pre>\n\n<p>Thank you.</p>\n\n<p><strong>EDIT:</strong> Thank you very much for your continued assistance. It is greatly appreciated.</p>\n\n<p>I used your code for all of the following tests. Basically, I am also getting Access Denied messages from your code, however, I have tracked it down a little more.</p>\n\n<p>Firstly, \"C:\\test.txt\" was not my real code, and unfortunately the missing backslash is not the cause of my problem. Thank you for your keen eyes though :)</p>\n\n<p>Also, I am running an administrator account with UAC disabled, and my program has requireAdministrator set in the manifest.</p>\n\n<p>However, I have noticed that both my code and yours work for simple files. After much testing, I have discovered that I only get AccessDenied messages in the following scenarios:</p>\n\n<p>1: I am not the owner, and the \"Take Ownership\" permissions is set to Deny for e.g. Everyone. </p>\n\n<p>2: I am the owner, and the \"Take Ownership\" permissions is set to Deny for e.g. Everyone. Curiously, in this second instance, despite the failure code, the ownership change does actually occur.</p>\n\n<p>I don't see why this is happening. I, and you, have set SE_RESTORE_NAME in the process token. I should be allowed to arbitrarily set the owner SID. But it seems that I can't.</p>\n\n<p>It seems that any Deny on TakeOwnership DACLs overrides my ability to take ownership. However, I can't change permissions until I can take ownership! <em>sigh</em>. </p>\n\n<p>I might try setting SeTakeOwnershipPrivilege as you initially recommended, taking ownership to myself, changing permissions, setting ownership externally. What a pain. And I am not even very confident it will work.</p>\n\n<p>I also found this: <a href=\"http://us.generation-nt.com/setnamedsecurityinfo-failing-rc-1307-help-59729462.html\" rel=\"nofollow\">http://us.generation-nt.com/setnamedsecurityinfo-failing-rc-1307-help-59729462.html</a></p>\n\n<p>He seems to be in a similar situation (I get 1307 if I don't set up the process token properly). But CreatePrivateObjectSecurityEx takes a whole lot more setting up.</p>\n\n<p>Hmmmm. Thanks for your time.</p>\n"},{"tags":["c#","winforms","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":12340957,"title":"Set SelectionStart of a WinForms TextBox based on mouse location","body":"<p>How can I set the SelectionStart of a WinForms TextBox based on the mouse location? I am extending TextBox and would like to set the carot at the position under the mouse point when the user right-clicks the TextBox (i.e. same behavior as with left-click).</p>\n\n<p>Here's my OnMouseDown override so far:</p>\n\n<pre><code>protected override void OnMouseDown(MouseEventArgs e) {\n    if (e.Button == System.Windows.Forms.MouseButtons.Right) {\n        this.Focus();\n        //if we have a range of text selected, leave it\n        if (this.SelectionLength == 0) { \n            //set the SelectionStart here based on the mouse location in the MouseEventArgs e         \n        }\n        //...\n    } else\n        base.OnMouseDown(e);\n}\n</code></pre>\n\n<p>I've investigated using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms648405%28v=vs.85%29.aspx\" rel=\"nofollow\">SetCaretPos</a> (e.g. <code>SetCaretPos(e.Location.X, e.Location.Y);</code>), but couldn't make it work (I see the caret there for a moment, but it is just a flash and does't affect the SelectionStart).</p>\n"},{"tags":["c","winapi","windows-7"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12340504,"title":"Security identifier \"directory\" crashes my program","body":"<p>It fails only at the system volumine.</p>\n\n<pre><code>#ifndef UNICODE \n#define UNICODE\n#endif\n\n#include &lt;stdio.h&gt;\n#include &lt;Windows.h&gt;\n\nvoid EndWithBackslash(TCHAR* string)\n{\n    if(string[wcslen(string)-1] != TEXT('\\\\')) wcscat(string,TEXT(\"\\\\\"));\n}\n\n\nvoid Browse(const TCHAR* curdir)\n{\n    HANDLE hFoundFile;\n    WIN32_FIND_DATA foundFileData;\n    TCHAR buffer[MAX_PATH];\n\n    wcscpy(buffer,curdir);\n\n    EndWithBackslash(buffer);\n\n    SetCurrentDirectory(buffer);\n\n    hFoundFile = FindFirstFileEx(TEXT(\"*\"),FINDEX_INFO_LEVELS::FindExInfoBasic,&amp;foundFileData ,FINDEX_SEARCH_OPS::FindExSearchLimitToDirectories ,NULL , NULL);\n\n    if(hFoundFile != INVALID_HANDLE_VALUE)\n    {\n        do\n        {\n            if ((foundFileData.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY) &amp;&amp; wcscmp(foundFileData.cFileName,TEXT(\".\")) &amp;&amp; wcscmp(foundFileData.cFileName,TEXT(\"..\")) )\n            {   \n                 TCHAR pszItemPath[MAX_PATH];\n                 wcscpy(pszItemPath, buffer);\n\n\n                EndWithBackslash(pszItemPath);\n                wcscat(pszItemPath,foundFileData.cFileName);\n                wprintf(TEXT(\"%s\\n\"),pszItemPath);\n\n                Browse(pszItemPath);\n            }\n        }\n        while(FindNextFile(hFoundFile,&amp;foundFileData));     \n    }\n    FindClose(hFoundFile);\n}\n\nint main(void) \n{   \n    _wsystem(TEXT(\"chcp 65001\"));\n    Browse(TEXT(\"C:\\\\\"));\n\n    _wsystem(TEXT(\"Pause\"));\n    return 0;\n}\n</code></pre>\n\n<p>The last lines of output, just before run-time error:</p>\n\n<blockquote>\n  <p>C:\\$Recycle.Bin\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5\n  \\S-1-5-20\n  C:\\$Recycle.Bin\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5\n  \\S-1-5-20\n  C:\\$Recycle.Bin\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5-20\\S-1-5\n  \\S-1-5-20</p>\n</blockquote>\n\n<p>Is there any elegant way to fix it? I would like to avoid deleting this pseudo-directory(<a href=\"http://superuser.com/questions/471821/mysterious-folder-next-to-the-recycle-bin\">Super Users have explained it very well</a>)  or setting name filters inside my algorithm.</p>\n"},{"tags":["winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12340525,"title":"Create HANDLE to BITMAP","body":"<p>Is there any way to create HANDLE (specifically HBITMAP) to existing in memory BITMAP struct without using Device Contex(DC)?</p>\n"},{"tags":["c++","winapi","variant"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":87,"score":3,"question_id":12287583,"title":"Assigning an Integer to variant","body":"<p>I want to set Flag as <a href=\"http://msdn.microsoft.com/en-us/library/aa768360%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>navOpenInBackgroundTab</code> of <code>BrowserNavConstants enum</code></a> which soon will be passed as parameter to <a href=\"http://msdn.microsoft.com/en-us/library/aa752134%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>IWebBrowser2::Navigate2</code> Method</a>.</p>\n\n<p>Signature of <code>IWebBrowser2::Navigate2</code>:-</p>\n\n<pre><code>HRESULT Navigate2(\n    VARIANT *URL,\n    VARIANT *Flags,\n    VARIANT *TargetFrameName,\n    VARIANT *PostData,\n    VARIANT *Headers\n);\n</code></pre>\n\n<p>This is where I have problem:-</p>\n\n<pre><code>VARIANT SITE={0}, vFlags = {0},vTargetFrameName = {0},vPostData = {0},vHeaders = {0};\n...\n...\nvFlags.intVal=navOpenInBackgroundTab;//&lt;--Here,Don't know how to do it.Not Working..\n\nm_spWebBrowser-&gt;Navigate2(&amp;SITE, &amp;vFlags,&amp;vTargetFrameName, &amp;vPostData, &amp;vHeaders);\n</code></pre>\n\n<p>Thank you very much for your support.</p>\n"},{"tags":["c++","winapi","registry","monitor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12337310,"title":"Monitor registry using C++","body":"<p>I want to monitor when a key is changed/added/deleted to the registry whenever application is being installed or removed. I have tested the sample code from the msdn(<a href=\"http://msdn.microsoft.com/en-us/library/ms724892%28v=VS.85%29.aspx\" rel=\"nofollow\">link</a>) and it works fine.</p>\n\n<p>But the problem is that it does not tell me which key has actually been modified/added/deleted. How can i retrieve this information using c++?</p>\n"},{"tags":["c++","winapi","hook"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":12335622,"title":"WM_PASTE hook not working","body":"<p>I want to detect everytime I paste something. It's just something to make some data entry work simpler.\nI set a global hook and then \"wait\" for the wm_paste. This is part of the code I have:</p>\n\n<pre><code>LRESULT CALLBACK GetMsgProc(int nCode, WPARAM wParam, LPARAM lParam)\n{\n    if(nCode &lt; 0)//Do not process the message\n        return CallNextHookEx(msg_hook,nCode,wParam,lParam);\n\n    LPMSG m=(LPMSG)lParam;\n\n    if(m-&gt;message == WM_PASTE)\n    {\n        OutputString(\"Paste detected!\\n\");\n    }\n    if(m-&gt;message == WM_PASTE)\n    {\n        OutputString(\"Paste detected!\\n\");\n    }\n\n\n    return CallNextHookEx(msg_hook,nCode,wParam,lParam);\n    }\n\n\n\n\n\n//DLL_ATTACH:\n...\nif(strstr(ProcName, LOADERNAME))\n        {\n            InitCommonControls();\n\n            if(!(msg_hook=SetWindowsHookEx(WH_GETMESSAGE, GetMsgProc, hinstDLL, 0)))\n            {\n                ErrorExit(TEXT(\"SetWindowsHookEx\"));\n                //MessageBox(0, \"WH_GETMESSAGE\", 0, 0);\n                //return -1;\n            }\n        }\n</code></pre>\n\n<p>WM_PASTE debug string never gets printed. I'm aware that not all applications use WM_PASTE. But at least notepad should work.</p>\n\n<p>Any suggestions? \nThanks!</p>\n"},{"tags":["windows","winapi","ras"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":12336996,"title":"How to set HwFlowControl=1 using RASENTRY Structure","body":"<p>I need to set \"HwFlowControl=1\" in my rasphone.pbk file. I found RASENTRY structure could do this. But I cant see any corresponding parameters equivalent to this. Please guide how to set this Particular parameter programatically.</p>\n"},{"tags":["c","winapi","save","writefile"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12335421,"title":"save file without save dialog","body":"<p>I have 3 global variables:</p>\n\n<pre><code>OPENFILENAME ofn;\n\nTCHAR FileName[1024];\n\nTCHAR Title[1024];\n</code></pre>\n\n<p>In WM_CREATE, I fill the information for ofn:</p>\n\n<pre><code>static TCHAR filter[] = TEXT(\"Bitmap Files (*.BMP)\\0*.bmp\\0\") \\\n    TEXT(\"All Files (*.*)\\0*.*\\0\\0\");\n\nofn.lStructSize = sizeof(OPENFILENAME);\nofn.hwndOwner = hwnd;\nofn.hInstance = NULL;\nofn.lpstrFilter = filter;\nofn.lpstrCustomFilter = NULL;\nofn.nMaxCustFilter = 0;\nofn.nFilterIndex = 0;\nofn.lpstrFile = NULL;\nofn.nMaxFile = 1024;\nofn.lpstrFileTitle = NULL;\nofn.nMaxFileTitle = 1024;\nofn.lpstrInitialDir = NULL;\nofn.lpstrTitle = NULL;\nofn.Flags = 0;\nofn.nFileOffset = 0;\nofn.nFileExtension = 0;\nofn.lpstrDefExt = TEXT(\"bmp\");\nofn.lCustData = 0;\nofn.lpfnHook = NULL;\nofn.lpTemplateName = NULL;\n</code></pre>\n\n<p>In WM_COMMAND with <code>case ID_FILE_SAVE:</code>, I have</p>\n\n<pre><code>            case ID_FILE_SAVE:\n                if (!SaveAsBmpDialog(hwnd, FileName, Title))\n                    return 0;\n                SaveAsBmp(FileName);\n                return 0;\n</code></pre>\n\n<p>where <code>SaveAsBmpDialog</code> is</p>\n\n<pre><code>static bool SaveAsBmpDialog(HWND hwnd, TCHAR *fileName, TCHAR *title) \n{\nofn.hwndOwner = hwnd;\nofn.lpstrFile = fileName;\nofn.lpstrFileTitle = title;\nofn.Flags = NULL;\n\nreturn GetSaveFileName(&amp;ofn);\n}\n</code></pre>\n\n<p>It works fine to save HDC to a Bitmap file (which can be open).</p>\n\n<p>But in WM_CHAR with <code>wParam == 'p'</code>, I have</p>\n\n<pre><code>SaveAsBmp(FileName);\nreturn 0;\n</code></pre>\n\n<p>I use this function when <code>SaveAsBmpDialog</code> is called at once before, so <code>FileName</code> is a full-path already.</p>\n\n<p>But I get a Bitmap file, which can not be open. (Even if I delete the file first, it creates the file, but still cannot be open). The file size is as before, so I think <code>WriteFile</code> in <code>SaveAsBmp</code> works.</p>\n\n<p>I don't understand why it doesn't work without <code>GetSaveFileName(&amp;ofn)</code> in <code>WM_CHAR</code>.</p>\n\n<p>What I want is to save HDC to a exist file without save dialog.</p>\n\n<p>ps: In <code>SaveAsBmp</code>, I have</p>\n\n<pre><code>HANDLE hFile = CreateFile(FileName, GENERIC_WRITE, 0, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);\n\nDWORD dwBytesWritten;\n\n//SetFilePointer(hFile, 0, NULL, FILE_BEGIN);\nWriteFile(hFile, &amp;fileHeader, sizeof(BITMAPFILEHEADER), &amp;dwBytesWritten, NULL);\nWriteFile(hFile, &amp;info.bmiHeader, sizeof(BITMAPINFOHEADER) + info.bmiHeader.biClrUsed * sizeof(RGBQUAD), &amp;dwBytesWritten, NULL);\nWriteFile(hFile, pPixels, (int) info.bmiHeader.biSizeImage, &amp;dwBytesWritten, NULL);\n\nCloseHandle(hFile);\n</code></pre>\n"},{"tags":["c++","winapi","synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":12335200,"title":"Failure in synchronization APIs for C++ code under Windows","body":"<p>If I define a template struct like so:</p>\n\n<pre><code>template &lt;typename T&gt; \nstruct SYNCHED_DATA\n{\n    SYNCHED_DATA()\n    {\n        hMutex = ::CreateMutex(NULL, FALSE, NULL);\n    }\n    ~SYNCHED_DATA()\n    {\n        if(hMutex)\n            CloseHandle(hMutex);\n        hMutex = NULL;\n    }\n\n    void set(T* pV)\n    {\n        if(pV)\n        {\n            ::WaitForSingleObject(hMutex, INFINITE);\n            var = *pV;\n            ::ReleaseMutex(hMutex);\n        }\n    }\n    void get(T* pV)\n    {\n        if(pV)\n        {\n            ::WaitForSingleObject(hMutex, INFINITE);\n            *pV = var;\n            ::ReleaseMutex(hMutex);\n        }\n    }\n\nprivate:\n    HANDLE hMutex;\n    T var;\n\n    SYNCHED_DATA(const SYNCHED_DATA&amp; s)\n    {\n    }\n    SYNCHED_DATA&amp; operator = (const SYNCHED_DATA&amp; s)\n    {\n    }\n};\n</code></pre>\n\n<p>Can I be assured that those WaitForSingleObject() APIs will always return WAIT_OBJECT_0? And if no, in what circumstances can they fail and how am I supposed to handle it then?</p>\n"},{"tags":["c","winapi","windows-7"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12334043,"title":"Traversing directories recursivelly using FindFirstFileEx function","body":"<p>I've debugged it, but I still don't have any idea what could be the culprit. </p>\n\n<pre><code>#ifndef UNICODE \n#define UNICODE\n#endif\n\n\n#include &lt;stdio.h&gt;\n#include &lt;Windows.h&gt;\n\n\nvoid EndWithBackslash(TCHAR* string)\n{\n    if(string[wcslen(string)-1] != TEXT('\\\\')) wcscat(string,TEXT(\"\\\\\"));\n}\n\n\nvoid Browse(const TCHAR* curdir)\n{\n    HANDLE hFoundFile;\n    WIN32_FIND_DATA foundFileData;\n    TCHAR buffer[MAX_PATH];\n\n    wcscpy(buffer,curdir);\n\n    EndWithBackslash(buffer);\n\n    SetCurrentDirectory(buffer);\n\n    hFoundFile = FindFirstFileEx(TEXT(\"*\"),FINDEX_INFO_LEVELS::FindExInfoBasic,&amp;foundFileData ,FINDEX_SEARCH_OPS::FindExSearchLimitToDirectories ,NULL , NULL);\n\n    if(hFoundFile != INVALID_HANDLE_VALUE)\n    {\n        do\n        {\n            if ((foundFileData.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY) &amp;&amp; wcscmp(foundFileData.cFileName,TEXT(\".\")) &amp;&amp; wcscmp(foundFileData.cFileName,TEXT(\"..\")) )\n            {   \n                EndWithBackslash(buffer);\n                wcscat(buffer,foundFileData.cFileName);\n                wprintf(TEXT(\"%s\\n\"),buffer);\n\n\n                Browse(buffer);\n            }\n        }\n        while(FindNextFile(hFoundFile,&amp;foundFileData));\n        FindClose(hFoundFile);\n\n\n    }\n}\n\nint main(void) \n{   \n    Browse(TEXT(\"F:\\\\\"));\n\n    system(\"Pause\");\n    return 0;\n}\n</code></pre>\n\n<p>Output:</p>\n\n<blockquote>\n  <p>F:\\$RECYCLE.BIN <br>\n  F:\\$RECYCLE.BIN\\S-1-5-21-1271883188-2384997935-49719322-1000 <br>\n  F:\\$RECYCLE.BIN\\Seagate <br>\n  F:\\$RECYCLE.BIN\\Seagate\\Seagate Dashboard 2.0 <br>\n  F:\\$RECYCLE.BIN\\Seagate\\Seagate Dashboard 2.0\\System Volume Information <br>\n  F:\\$RECYCLE.BIN\\Seagate\\Seagate Dashboard 2.0\\System Volume Information\\Video <br></p>\n</blockquote>\n\n<p>How does \"the first layer\" realy looks:</p>\n\n<p><img src=\"http://i.stack.imgur.com/sFywS.png\" alt=\"enter image description here\"></p>\n\n<p>Could you point out my mistake(s)?</p>\n"},{"tags":["winapi","bitmap","hdc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12333315,"title":"can not save hdc to a bitmap correctly","body":"<p>I tried to save a memory DC to a bitmap file. But I can not get the right value about size for the following: </p>\n\n<pre><code>infoHeader.biSizeImage\n\nfileHeader.bfSize\n\n\nfileHeader.bfOffBits\n\nWriteFile(hFile, &amp;fileHeader, sizeof(BITMAPFILEHEADER), &amp;dwBytesWritten, NULL);\n\nWriteFile(hFile, &amp;infoHeader, sizeof(BITMAPINFOHEADER), &amp;dwBytesWritten, NULL);\n\nWriteFile(hFile, pPixels, info.bmiHeader.biSizeImage, &amp;dwBytesWritten, NULL);\n</code></pre>\n\n<p>I can get a file, but I can not open it, since it complains that it is broken or it is no longer supported.</p>\n\n<p>There are many source about saving to bmp, but many of them have different value for the size.\nSome also include Palette information. I am totoally confused.</p>\n\n<p>Could someone indicate how to fill the correct information?</p>\n\n<pre><code>static void SaveAsBmp(TCHAR *fileName)\n{\nHDC hdcView = GetDC(hwndView);\nHDC memDC = CreateCompatibleDC(hdcView);\n\nRECT rcView;\nGetClientRect(hwndView, &amp;rcView);\n\nint rcView_dx = rcView.right - rcView.left;\nint rcView_dy = rcView.bottom - rcView.top;\n\nHBITMAP hMemBmp = CreateCompatibleBitmap(hdcView, rcView_dx, rcView_dy);\nHBITMAP hOldBmp = (HBITMAP)SelectObject(memDC, hMemBmp);\n\nBitBlt(memDC, 0, 0, rcView_dx, rcView_dy, hdcView, 0, 0, SRCCOPY);\n\n//----------\n\nBITMAP bmp;\nGetObject(hMemBmp, sizeof(BITMAP), &amp;bmp);\n\n//----------\n\nWORD wBits = (WORD)(bmp.bmBitsPixel * bmp.bmPlanes);\n\nif(wBits &lt;=  1)                                                   \n    wBits = 1;             \nelse  if(wBits &lt;=  4)                               \n    wBits  = 4;             \nelse if(wBits &lt;=  8)                               \n    wBits  = 8;             \nelse if (wBits &lt;= 16)\n    wBits = 16;\nelse if (wBits &lt;= 24)\n    wBits = 24;\nelse wBits = 32; \n\n//----------\n\nBITMAPINFOHEADER infoHeader;\nBITMAPINFO info;\ninfo.bmiHeader = infoHeader;\n\ninfoHeader.biSize = sizeof(BITMAPINFOHEADER);    \ninfoHeader.biWidth = bmp.bmWidth; \ninfoHeader.biHeight = bmp.bmHeight;    \ninfoHeader.biPlanes = bmp.bmPlanes;    \ninfoHeader.biBitCount = bmp.bmBitsPixel;     \ninfoHeader.biCompression = BI_RGB;   \n\ninfoHeader.biSizeImage = 2 * ((bmp.bmWidth * bmp.bmBitsPixel + 15) / 16)  * bmp.bmPlanes * bmp.bmHeight;\ninfoHeader.biXPelsPerMeter = 0;  \ninfoHeader.biYPelsPerMeter = 0;\ninfoHeader.biClrUsed = 0;\ninfoHeader.biClrImportant = 0;\n\nRGBQUAD *pPixels = new RGBQUAD[bmp.bmWidth * bmp.bmWidth]; \nGetDIBits(memDC, hMemBmp, 0, bmp.bmWidth, pPixels, &amp;info, DIB_RGB_COLORS);\n\nBITMAPFILEHEADER fileHeader;\nfileHeader.bfType = 0x4d42;\nfileHeader.bfSize = (DWORD)(sizeof(BITMAPFILEHEADER) + sizeof(BITMAPINFOHEADER) + info.bmiHeader.biSizeImage);\nfileHeader.bfReserved1 = 0;\nfileHeader.bfReserved2 = 0;\nfileHeader.bfOffBits = (DWORD)(sizeof(BITMAPFILEHEADER) + info.bmiHeader.biSize);\n\nHANDLE hFile = CreateFile(fileName, GENERIC_WRITE, 0, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);\n\nDWORD dwBytesWritten;\n\nWriteFile(hFile, &amp;fileHeader, sizeof(BITMAPFILEHEADER), &amp;dwBytesWritten, NULL);\nWriteFile(hFile, &amp;infoHeader, sizeof(BITMAPINFOHEADER), &amp;dwBytesWritten, NULL);\nWriteFile(hFile, pPixels, info.bmiHeader.biSizeImage, &amp;dwBytesWritten, NULL);\n\nCloseHandle(hFile);\n\ndelete pPixels;\n\nSelectObject(memDC, hOldBmp);\nDeleteObject(hMemBmp);\nDeleteDC(memDC);\n</code></pre>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":10137571,"title":"Arrange windows after change resolution","body":"<p>Faced with the problem of moving\\mixing\\shuffle windows, after changing the screen resolution.</p>\n\n<p>I change resolution from 1920x1080(3 monitors) to 5760x1080 (eyefinity)</p>\n\n<p>I could write a script for the correct placement of the windows. (Python + winapi)</p>\n\n<p>But perhaps there is a program\\script which can memorize(for different resolutions) the location of windows?</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12329828,"title":"How to retrieve mouse position inside WM_COMMMAND","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6423729/get-current-cursor-position\">Get Current Cursor Position</a>  </p>\n</blockquote>\n\n\n\n<p>I creating the button like this:</p>\n\n<pre><code>button = CreateWindowEx(NULL,_T(\"Button\"),NULL,\n            WS_CHILD | WS_VISIBLE | BS_BITMAP | BS_NOTIFY ,\n            pos.x, pos.y, BTN_SIZE, BTN_SIZE,\n            hWndDlg, (HMENU)id,hIns, NULL);\n</code></pre>\n\n<p>I want to drag that button,can`t figure out how to get the mouse pos X,Y relatively DialogWindow?\nThank you for any help?</p>\n"},{"tags":["c++","class","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":6,"view_count":67,"score":-5,"question_id":12330389,"title":"Win32 Static Variable link error","body":"<p>Why does this happen?</p>\n\n<blockquote>\n  <p>1>------ Build started: Project: Client, Configuration: Debug Win32 ------<br>\n  1>  WindowManager.cpp<br>\n  1>  Generating Code...<br>\n  1>  Compiling...<br>\n  1>  Main.cpp<br>\n  1>  Generating Code...<br>\n  1>WindowManager.obj : error LNK2001: unresolved external symbol<br>\n  \"private: static int WindowManager::win_stat\" (?win_stat@WindowManager@@0HA)\n  1>C:\\Users\\user\\documents\\visual studio\n  2012\\Projects\\TalkToMe\\Debug\\Client.exe : fatal error LNK1120: 1 unresolved externals<br>\n  ========== Build: 0 succeeded, 1 failed, 0 up-to-date, 0 skipped ==========</p>\n</blockquote>\n\n<p>WindowManager.cpp</p>\n\n<pre><code>#include \"WindowManager.h\"\n\nvoid WindowManager::PekMessage()\n{\n    if(PeekMessage(&amp;msg, window, 0, 0, PM_REMOVE))\n    {\n        TranslateMessage(&amp;msg);\n        DispatchMessage(&amp;msg);\n    }\n}\n\nbool WindowManager::isWindowOpen()\n{\n    return win_stat != -1;\n}\n\nHWND WindowManager::textbox(int width, int height, int xPos, int yPos, LPCSTR content, bool edit_able)\n{\n    int type = (edit_able) ? (WS_CHILD|WS_VISIBLE|ES_AUTOHSCROLL) : (WS_CHILD|WS_VISIBLE|WS_HSCROLL|ES_AUTOHSCROLL);\n    return CreateWindowEx(\n        WS_EX_CLIENTEDGE,\n        \"EDIT\",\n        content,\n        type,\n        xPos,\n        yPos,\n        width,\n        height,\n        window,\n        (HMENU)50,\n        GetModuleHandle(NULL),\n        NULL\n    );\n}\n\nHWND WindowManager::textbox(Vector size, Vector position, LPCSTR content, bool edit_able)\n{\n    return textbox(size.getX(), size.getY(), position.getX(), position.getY(), content, edit_able);\n}\n\nLRESULT CALLBACK WindowManager::WindowProcedure(HWND winhan,UINT uint_Message,WPARAM parameter1,LPARAM parameter2)\n{\n    switch(uint_Message)\n    {\n        case 16: // exit button\n            win_stat = -1;\n        break;\n    }\n\n    return DefWindowProc(winhan,uint_Message,parameter1,parameter2);\n}\n\nWindowManager::WindowManager(LPCTSTR title,int x, int y, int width, int height)\n{\n    WNDCLASSEX wnd;\n    wnd.cbSize = sizeof(wnd);\n    wnd.style  = CS_HREDRAW | CS_VREDRAW;\n    wnd.lpfnWndProc = WindowProcedure;\n    wnd.cbClsExtra  = 0;\n    wnd.cbWndExtra  = 0;\n    wnd.hInstance   = GetModuleHandle(NULL);\n    wnd.hIcon       = NULL;\n    wnd.hCursor     = LoadCursor(NULL,IDC_ARROW);\n    wnd.hbrBackground = GetSysColorBrush(NULL);\n    wnd.lpszClassName = \"TalkToMe\";\n    wnd.lpszMenuName  = NULL;\n    wnd.hIconSm = LoadIcon(NULL, IDI_APPLICATION);\n\n    RegisterClassEx(&amp;wnd);\n\n    window = CreateWindowEx(WS_EX_CONTROLPARENT, wnd.lpszClassName, title, \n        WS_OVERLAPPED | WS_CAPTION | WS_SYSMENU | WS_MINIMIZEBOX | WS_VISIBLE, x, y, width, height,NULL, NULL, \n        GetModuleHandle(NULL), NULL);\n}\n\nWindowManager::~WindowManager()\n{\n    DestroyWindow(window);\n}\n</code></pre>\n\n<p>WindowManager.h</p>\n\n<pre><code>#pragma once\n#pragma comment(linker,\"\\\"/manifestdependency:type='win32' name='Microsoft.Windows.Common-Controls' version='6.0.0.0' processorArchitecture='*' publicKeyToken='6595b64144ccf1df' language='*'\\\"\")\n\n#include &lt;Windows.h&gt;\n#include \"Vector.h\"\n\nclass WindowManager\n{\nprivate:\n    MSG msg;\n    HWND window;\n\n    static int win_stat;\npublic:\n    WindowManager(LPCTSTR title,int x, int y, int width, int height);\n    ~WindowManager();\n    static LRESULT CALLBACK WindowProcedure(HWND winhan,UINT uint_Message,WPARAM parameter1,LPARAM parameter2);\n\n    HWND textbox(int width, int height, int xPos, int yPos, LPCSTR content, bool edit_able=true);\n    HWND textbox(Vector size, Vector position, LPCSTR content, bool edit_able=true);\n\n    bool isWindowOpen();\n    void PekMessage();\n};\n</code></pre>\n"},{"tags":["c#",".net","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12329976,"title":"Disable click on a 3rd party application","body":"<p>I'm writing an application that needs to record a click location on the screen, over the top of another window using the mouse. Is there anyway to disable the mouse click so that it doesn't affect the window that is being clicked over? </p>\n\n<p>e.g. I want to set a point over the top of my browser, but I don't want to click anything within my browswer whilst setting it.</p>\n"},{"tags":["c","winapi","ras","dial-up"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":65,"score":0,"question_id":12304636,"title":"Bitwise masking issues in RASDIAL APIS","body":"<p>This question is regarding Rasdial and pbk file.\nI am updating the pbk file using \"rassetentryproperties\"  and dialling through \"rasdialdlg\".</p>\n\n<p>The below flags decide the parameters of the pbk file inturn responisble for the property of the dial-up connection.\nI am presetting the flags as:</p>\n\n<pre><code>RasEntry.dwfOptions = 0x00000000;\nRasEntry.dwfOptions2 = 0x00000000;\n</code></pre>\n\n<p>Trying to do as below to set Flag1 and Flag2.</p>\n\n<pre><code>RasEntry.dwfOptions |= (Set Flag1 | Set Flag2) \n</code></pre>\n\n<p>However, my pbk file entries are not actually setting, as i set above.</p>\n\n<p>Also, for the same code, Win7 pbk and win xp pbk are different. \nWhere i am wrong?</p>\n\n<p>Code Sample for the reference:</p>\n\n<pre><code>BOOL Create_Phone_Book ( LPTSTR DeviceName ) {\n\n    DWORD regError;\n    TCHAR DeviceName[100];\n\n\n    if ( _tcscpy ( DeviceName, DeviceName ) != NULL ) {\n        Slog ( TEXT (\"Strcpy Success\"), APISUCCESS );\n    } else {\n        Slog ( TEXT (\"Strcpy Failed To copy deviceName to DeviceName\"), NOLASTERROR);\n        return FALSE;\n    }\n\n    RASENTRY RasEntry;\n    DWORD cb;\n    RASDIALPARAMS RasDialParams;\n\n    memset((LPTSTR)&amp;RasEntry, 0, sizeof(RASENTRY)); \n\n    RasEntry.dwSize = sizeof(RASENTRY);\n    cb = sizeof(RASENTRY);\n    regError = RasGetEntryProperties (NULL, TEXT (\"\"), &amp;RasEntry, &amp;cb, NULL, NULL);\n\n    if ( regError == ERROR_SUCCESS ) {\n        Slog ( TEXT (\"RasGetEntryProperties Success\"), APISUCCESS );\n    } else {\n        RAS_ErrorHandler ( regError );\n        return FALSE;\n    }\n\n    RasEntry.dwfOptions = 0x00000000;\n    RasEntry.dwfOptions2 = 0x00000000;\n\n\n    RasEntry.dwfOptions |= (  RASEO_IpHeaderCompression | RASEO_ModemLights |RASEO_SwCompression | \n    RASEO_ShowDialingProgress | RASEO_NetworkLogon | RASEO_DisableLcpExtensions );\n\n\n\n    RasEntry.dwfOptions2 |= ( RASEO2_UseGlobalDeviceSettings | RASEO2_Internet );\n\n\n    if ( _tcscpy ( RasEntry.szDeviceType,  RASDT_Modem ) != NULL ) {\n        Slog ( TEXT (\"Strcpy Success\"), APISUCCESS );\n    } else {\n        Slog ( TEXT (\"Strcpy Failed copy RASDT_MODEM to RasEntry.szDeviceType\"), NOLASTERROR);\n        return FALSE;\n    }\n\n    if ( _tcscpy ( RasEntry.szDeviceName, DeviceName ) != NULL ) {\n        Slog ( TEXT (\"Strcpy Success\"), APISUCCESS );   \n    } else {\n        Slog ( TEXT (\"Strcpy Failed copy DeviceName to RasEntry.szDeviceName\"), NOLASTERROR);\n        return FALSE;   \n    }\n\n    regError = RasSetEntryProperties( NULL , Dial_Up_Name, &amp;RasEntry, sizeof(RasEntry),NULL, 0);\n\n    if ( regError == ERROR_SUCCESS ) {\n        Slog ( TEXT (\"RasSetEntryProperties Succeeded\"), APISUCCESS);\n    } else {\n        RAS_ErrorHandler ( regError );\n        return FALSE;\n    }\n\n    memset((LPTSTR)&amp;RasDialParams, 0, sizeof(RasDialParams));\n\n    RasDialParams.dwSize = sizeof(RASDIALPARAMS);\n\n    if ( _tcscpy (RasDialParams.szEntryName, Dial_Up_Name ) != NULL ) {\n        Slog ( TEXT (\"Strcpy Success\"), APISUCCESS);\n    } else {\n        Slog ( TEXT (\"Strcpy Failed Copy Dial_Up_Name to RasDialParams.szEntryName\"), NOLASTERROR);\n        return FALSE;\n    }\n    if ( _tcscpy (RasDialParams.szUserName, TEXT (\"\")) != NULL ) {\n        Slog ( TEXT (\"Strcpy Success\"), APISUCCESS);    \n    } else {\n        Slog ( TEXT (\"Strcpy Failed Copy \"\" to RasDialParams.szUserName\"), NOLASTERROR);\n        return FALSE;   \n    }\n\n    if ( _tcscpy (RasDialParams.szPassword, TEXT (\"\")) != NULL ) {\n        Slog ( TEXT (\"Strcpy Success\"), APISUCCESS);    \n    } else {\n        Slog ( TEXT (\"Strcpy Failed Copy \"\" to RasDialParams.szPassword\"), NOLASTERROR);\n        return FALSE;\n    }\n\n    regError = RasSetEntryDialParams ( NULL, &amp;RasDialParams, FALSE);\n    if ( regError == ERROR_SUCCESS ) {\n        Slog ( TEXT (\"RasSetEntryDialParams Success\"), APISUCCESS );\n    } else {\n        RAS_ErrorHandler ( regError );\n        return FALSE;\n    }\n\nreturn TRUE;\n\n}\n</code></pre>\n\n<p>Updated 1:\nTypically, i need to create an Dial-Up connection as i like. Please look at the screen shot attached.</p>\n\n<p><img src=\"http://i.stack.imgur.com/kWGJs.jpg\" alt=\"enter image description here\"></p>\n\n<p>As seen in the snap, i have to set and reset many parameters(Set-Display Progress while connecting, Reset- Prompt for UN and PW). \nThese two flags use to set and reset whatever we want by \"or\"ing \n    RasEntry.dwfOptions<br>\n    RasEntry.dwfOptions2 </p>\n\n<p>So what i do in my code is :</p>\n\n<p>resetting the flag:</p>\n\n<pre><code>RasEntry.dwfOptions = 0x00000000;\n\nRasEntry.dwfOptions2 = 0x00000000;\n</code></pre>\n\n<p>and to set:</p>\n\n<pre><code> RasEntry.dwfOptions |= (  RASEO_IpHeaderCompression | RASEO_ModemLights  \n                           |RASEO_SwCompression | RASEO_ShowDialingProgress |  \n                            RASEO_NetworkLogon | RASEO_DisableLcpExtensions );\n</code></pre>\n\n<p>So, the remaining flags other than the above, will be remained Unset.</p>\n\n<p>Now the problem is, Whatever i am setting in the above steps are not actually setting in the dial-up connection. In another way, some parameters are not set even, if i set in the code.</p>\n\n<p>What should i do to get rid of my problem?</p>\n"},{"tags":["c#","c","vb.net","winapi","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12328154,"title":"windows application with web search","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1981670/programmatically-get-screenshot-of-page\">Programmatically get screenshot of page</a>  </p>\n</blockquote>\n\n\n\n<p>I am working on a small desktop program in winapi</p>\n\n<ol>\n<li><p>What I want is that the application will have textbox with some buttons.\nUser can type a string in the text box and hit the search button.</p></li>\n<li><p>After that the program will search that string on google and will save the search result page as an image file , all this will be done in the background with no new windows opening.</p></li>\n</ol>\n\n<p>And please comment if this can be done easily in some other programming language like VB or C# or MFC</p>\n"},{"tags":["windows","security","winapi","device-driver","scsi"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":118,"score":3,"question_id":12328106,"title":"SPTI/SCSI operations from a Windows 7 application","body":"<p>I need some help regarding a security problem in updating some Windows software for communicating with a non-storage SCSI device.</p>\n\n<p>The original software was written for Windows XP as a DLL, and talked with the device via Adaptec's ASPI API. ASPI didn't really have any security, so any application run by any user could use my DLL to talk to one of these devices, and everything worked great.</p>\n\n<p>I'm now updating the software to work with Windows 7 using Microsoft's modern SPTI (SCSI Pass-Through Interface) API. Things work fine with SPTI under XP, but Windows 7 has much tighter security, and for normal users or even administrators, SPTI calls return an error indicating insufficient permissions. If I log in using the hidden \"Administrator\" account, my software runs fine with SPTI, but that's not an acceptable deployment option.</p>\n\n<p>Here are some alternatives I've looked into so far, in order of decreasing level of having to rewrite existing code:</p>\n\n<ul>\n<li>Spinning off a thread and escalating its privileges to be pretend to be \"Administrator\" so it can talk with SPTI. [I haven't been able to get this to work using LogonUser()/ImpersonateLoggedOnUser()/LoadUserProfile(); the call to LoadUserProfile() fails, and SPTI calls fail as well with an insufficient permissions error.]</li>\n<li>Writing a Windows Service that has adequate permissions to talk with SPTI, and then having my DLL talk with that service.</li>\n<li>Userspace (UMDF) driver. It would be an expensive rewrite, and it's not clear to me whether UMDF supports accessing SCSI devices.</li>\n<li>Kernel (KMDF) driver. Should work, but would be a longer, more expensive rewrite.</li>\n</ul>\n\n<p>I hope the community here can help with some wisdom/experience/ideas that will let my code talk to this SCSI device under Windows 7, ideally without having to rewrite too much.</p>\n"},{"tags":["arrays","winapi","delete","heap-corruption"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12326890,"title":"Win32: Heap corruption when deleting global array","body":"<p>The following code seems to be causing heap corruption whenever the debugger hits the delete[] operator.  It's trying to delete a global array of structures which was defined as an extern in the header file and then declared in the global scope of the main .cpp file.</p>\n\n<pre><code>LRESULT CALLBACK WndProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)\n{ \n  switch(msg) \n  { \n    case WM_CREATE: \n      { \n        int main_win_x, main_win_y;\n\n        tiles_horiz = 10;  //temp code\n        tiles_vert = 10;   //temp code\n        num_mines = 5;    //temp code\n\n        main_win_x = (tiles_horiz * 22) + 20;\n        main_win_y = (tiles_vert * 22) + 20;\n\n        MoveWindow(hwnd, 100, 100, main_win_x, main_win_y, TRUE);\n\n        tiles_total = (tiles_horiz * tiles_vert);\n        tile_array = new tile[tiles_total];\n\n        SetupPlayField();\n        DrawInitTiles(hwnd);\n      }\n      break;\n    case WM_SIZE:\n      {\n\n      }\n      break;\n    case WM_CLOSE:\n      delete[] tile_array;\n      DestroyWindow(hwnd);\n      break;\n    case WM_DESTROY:\n      PostQuitMessage(0);\n      break;\n    default:\n      return DefWindowProc(hwnd, msg, wParam, lParam);\n  }\n  return 0;\n}\n</code></pre>\n\n<p>I've searched various heap corruptions topics on forums the last couple of days and so far have come up dry trying various things.</p>\n\n<p>One person suggested that maybe the pointer to my array tile_array had changed by the time the program hits delete[].  But I've checked this the a couple of times and the address of both the pointer and the first element of the array remain the same.</p>\n\n<p>Other forum answer from other people's posts usually suggest that I may be deleting the array more than once, but so far this is the only time the delete[] operator is used for that specific array.</p>\n"},{"tags":["c#","winapi","crash-reports","crash-dumps"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":86,"score":2,"question_id":12326706,"title":"in C# can I have code execute when an exception is thrown?","body":"<p>I've got a bug that is really difficult for me to track.   It's one of those that only occurs when the debugger isnt connected :)</p>\n\n<p>I've pinvoked MiniDumpWriteDump() and that works really well for creating .dmp files that I can debug after the fact.  </p>\n\n<p>however, I'm doing something like</p>\n\n<pre><code>try\n{\n    foo();\n}\ncatch(Exception)\n{\n    CreateMiniDump()\n}\n</code></pre>\n\n<p>this works great, however I dont get the callstack that is desired.   I'd really prefer to have the callstack (with all the member variables) at the point where the exception was thrown.</p>\n\n<p>is this possible?  Is there a mechanism to get first dibs on the exception?  such that I can create a minidump and preserve the callstack, etc?</p>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12323495,"title":"Is there any way to get a UTC time conversion for a future point?","body":"<p>In Windows, I can do a UTC conversion easily enough by calling <code>GetTimeZoneInformation</code>. The struct I get back as a result will have two different bias values, one for standard time and one for DST, and a <code>BiasCode</code> representing which one we're currently on.  And that's just fine if we only care about the current moment.</p>\n\n<p>But I've got an API that the user calls to retrieve data about upcoming events.  The data is stored in the database in local time, and the user wants it in UTC, so I run the conversion and everything's fine... except that we're coming up on a time change in a few weeks.  And if I report events on the other side of the time change with today's bias, they'll be off by an hour.</p>\n\n<p>Is there anything I can call which works like <code>GetTimeZoneInformation</code>, except that I pass it a date and time then the the <code>BiasCode</code> that it gives me is the one that <em>will be correct at that time,</em> instead of the current one?  (And yes, I know the rules change from year to year. I'm not looking for anything that looks beyond a few weeks into the future.)</p>\n"},{"tags":["c++","windows","winapi","windows-vista"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":1879,"score":6,"question_id":153257,"title":"Random MoveFileEx failures on Vista ","body":"<p>I noticed that writing to a file, closing it and moving it to destination place randomly fails on Vista. Specifically, MoveFileEx() would return <code>ERROR_ACCESS_DENIED</code> for no apparent reason. This happens on Vista SP1 at least (32 bit). Does not happen on XP SP3.</p>\n\n<p>Found <a href=\"http://groups.google.com/group/microsoft.public.windows.file_system/browse_thread/thread/e9774e86e98eb623/3348d92b8ba5858d?lnk=raot&amp;pli=1\">this thread</a> on the internets about exactly the same problem, with no real solutions. So far it looks like the error is caused by Vista's search indexer, see below.</p>\n\n<p>The code example given there is enough to reproduce the problem. I'm pasting it here as well:</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdlib.h&gt; \n#include &lt;stdio.h&gt; \n\nbool test() {\n    unsigned char buf[] = {\n        0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, \n        0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99 \n    }; \n    HANDLE h; \n    DWORD nbytes; \n    LPCTSTR fn_tmp = \"aaa\"; \n    LPCTSTR fn = \"bbb\"; \n    h = CreateFile(fn_tmp, GENERIC_WRITE, FILE_SHARE_READ | FILE_SHARE_WRITE, 0, OPEN_ALWAYS, 0, 0); \n    if (h == INVALID_HANDLE_VALUE) return 0; \n    if (!WriteFile(h, buf, sizeof buf, &amp;nbytes, 0)) goto error; \n    if (!FlushFileBuffers(h)) goto error; \n    if (!CloseHandle(h)) goto error; \n    if (!MoveFileEx(fn_tmp, fn, MOVEFILE_REPLACE_EXISTING | MOVEFILE_COPY_ALLOWED | MOVEFILE_WRITE_THROUGH)) { \n        printf(\"error=%d\\n\", GetLastError()); \n        return 0; \n    } \n    return 1; \nerror: \n    CloseHandle(h); \n    return 0; \n} \n\nint main(int argc, char** argv) { \n    unsigned int i; \n    for (i = 0;; ++i) { \n        printf(\"*%u\\n\", i); \n        if (!test()) return 1; \n    } \n    return 0; \n}\n</code></pre>\n\n<p>Build this as console app with Visual Studio. Correct behaviour would be infinite loop that prints test numbers. On Vista SP1, the program exits after random number of iterations (usually before 100 iterations are made).</p>\n\n<p>This does not happen on Windows XP SP2. There's no antivirus running at all; and no other strange background processes (machine is pretty much vanilla OS install + Visual Studio).</p>\n\n<p><strong>Edit</strong>: Digging further via Process Monitor (thanks @sixlettervariables), I can't see anything particularly bad. Each test iteration results in 176 disk operations, majority of them coming from SearchProtocolHost.exe (search indexer). If search indexing service is stopped, no errors occur, so it looks like it's the culprit.</p>\n\n<p>At the time of failure (when the app gets <code>ERROR_ACCESS_DENIED</code>), SearchProtocolHost.exe has two CreateFile(s) to the detination file (bbb) open with read/write/delete share modes, so it should be ok. One of the opens is followed by opportunistic lock (<code>FSCTL_REQUEST_FILTER_OPLOCK</code>), maybe that's the cause?</p>\n\n<p>Anyway, I found out that I can avoid the problem by setting <code>FILE_ATTRIBUTE_TEMPORARY</code> and <code>FILE_ATTRIBUTE_NOT_CONTENT_INDEXED</code> flags on the file. It looks like <code>FILE_ATTRIBUTE_NOT_CONTENT_INDEXED</code> is enough by itself, but marking file as temporary also dramatically cuts down disk operations caused by search indexer.</p>\n\n<p>But this is <strong>not a real solution</strong>. I mean, if an application can't expect to be able to create a file and rename it because some Vista's search indexer is messing with it, <strong>it's totally crazy</strong>! Should it keep retrying? Yell at the user (which is very undesirable)? Do something else?</p>\n"},{"tags":["winapi","windows-7"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":106,"score":1,"question_id":12322974,"title":"Using SetDisplayConfig to enable a secondary display","body":"<p>I am trying to use the Windows CCD APIs (SetDisplayConfig) to enable a secondary monitor, but haven't figured out how to do it. I've been successful at re-positioning and disabling displays, but haven't found any examples of how to enable a previously disabled monitor.</p>\n\n<p>Does anybody have experience with this? I've found other questions showing how to do it with ChangeDisplaySettingsEx, but I'm trying to use SetDisplayConfig.</p>\n"},{"tags":["c++","c","winapi","define","widechar"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":254,"score":3,"question_id":10051659,"title":"#define syntax with L identifier","body":"<pre><code>#define CONST_FILENAME \"okay.dat\"\nLPCWSTR lpFilename=L CONST_FILENAME; //obviously doesn't work\n</code></pre>\n\n<p>Basically, how do I get the equivalent of:</p>\n\n<pre><code>LPCWSTR lpFilename=L\"okay.dat\";\n</code></pre>\n\n<p>using <code>#define</code>?</p>\n"},{"tags":["winapi","microsoft-metro"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":12321028,"title":"Transforming exe to Metro App","body":"<p>I had developed an application using Win32 C++ API(around 2 years back, which works fine with XP, Vista and Windows 7). For Windows 8, I want to have my same application in Metro Style.</p>\n\n<p>To elaborate, I want my application to run in Metro App style, rather then going back to desktop and executing from there. </p>\n\n<p>I searched a lot on Google, but could not find anything that can save effort. It seems, I will have to re-program my application for Metro-style. </p>\n\n<p>If there is any setting or any tool, i am missing, Please suggest.    </p>\n"},{"tags":["windows","delphi","winapi","delphi-7"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":521,"score":2,"question_id":8089358,"title":"How to get the Windows version is Vista and up versus XP on Delphi?","body":"<p>Is there any way to know which verion of Windows we are working on? </p>\n\n<p>I need to set image to TBitButton in Windows XP and no image in Windows7. It should be done automatically.</p>\n"},{"tags":["c","winapi","gdi+","gdi","grid-layout"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":83,"score":0,"question_id":12315724,"title":"a better way to draw grid as background","body":"<p>I want to draw grid as in the below picture.<img src=\"http://i.stack.imgur.com/77uau.png\" alt=\"enter image description here\"></p>\n\n<p>I know a trick to draw this by draw 6 vertical and horizontal lines instead of 6 x 6 small rectangle.</p>\n\n<p>But if I want to have smaller zoom (zoom for viewing picture), the lines are many. For example, say my view window is of size 800 x 600 and viewing a picture of size 400 x 300 (so zoom in is 2). There will be 400 x 300 rectangle of size 2 x 2 (each rectangle represents a pixel).</p>\n\n<p>If I draw each cell (in a loop, say 400 x 300 times), it is very slow (when I move the window...).\nUsing the trick solves the problem.</p>\n\n<p>By I am still curious if there is a better way to do this task in winapi, GDI(+). For example, a function like <code>DrawGrid(HDC hdc, int x, int y, int numOfCellsH, int numOfCellsV)</code>?</p>\n\n<p>A further question is: If I don't resize, move the window or I don't change the zoom in, the grid won't be changed. So even if I update the picture continuously (capture screen), it is uncessary to redraw the grid. But I use <code>StretchBlt</code> and <code>BitBlt</code> to capture the screen (to memory DC then hdc of the window), if I didn't redraw the grid in memory DC, then the grid will disappear. Is there a way to make the grid stick there and update the bitmap of the screen capture?</p>\n\n<p>ps: This is not a real issue. Since I want to draw the grid when zoom is not less than 10 (so each cell is of size 10 x 10 or larger). In this case, there will be at most 100 + 100 = 200 lines to draw and it is fast. I am just  curious  if there is a faster way. </p>\n"},{"tags":["c++","winapi","file-permissions","qt4.7"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":12321684,"title":"how to set Windows file permissions in Qt/C++","body":"<p>In my Qt 4.7.4 x64 C++ app I'm building in Qt Creator 2.5.0, I want to give full access to everyone for a file.  I'm using <code>QFile::setPermissions</code>, which I believe works fine for Mac and Linux, but it doesn't work for Windows.  According to <a href=\"http://stackoverflow.com/questions/5021645/qt-setpermissions-not-setting-permisions\">Qt setPermissions not setting permisions</a>, I should use </p>\n\n<pre><code>SetNamedSecurityInfoA(\"C:\\file.txt\", SE_FILE_OBJECT, DACL_SECURITY_INFORMATION, NULL, NULL, NULL, NULL);\n</code></pre>\n\n<p>But I don't know what to #include to make it work.  I tried:</p>\n\n<pre><code>#ifdef Q_WS_WIN\n#include \"Windows.h\"\n#endif\n</code></pre>\n\n<p>based on what I found <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa379283%28v=vs.85%29.aspx\" rel=\"nofollow\">here</a>.  But when I compile, I get <code>C3861: 'SetNamedSecurityInfo': identifier not found</code> (among some other new errors).</p>\n\n<p>When I mouse over my <code>#include \"Windows.h\"</code>, I get the tooltip:  <code>C:\\Program Files\\Microsoft SDKs\\Windows\\v7.0\\include\\Windows.h</code>, and I can press F2 and jump to that file.  We have other files in our project that include that same Windows.h, and they compile fine.</p>\n\n<p>How do I set file permissions on Windows for everyone to read/write?  If SetNamedSecurityInfo is what I want (I guess SetNamedSecurityInfoW in my case since my users may be running OS's in any language), what do I #include to be able to use it?  Better yet, how do I figure out what to #include, so I know for next time I need to use the Windows API?</p>\n"},{"tags":["c","winapi","dll"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":12320763,"title":"Disabling WinAPI","body":"<p>I'm building a game where each player must program his bot. The key idea is that the player will program in C (or C++, or whatever compatible language), build a DLL and send this DLL to the server, so that no one can get his code. The problem is: how to make sure that he is not calling any illegal function? Like creating files or opening a socket. The DLL will be loaded with LoadLibrary and a function will be called. All interaction will happen with callback functions. A possible solution would be placing a empty kernel32.dll (and others) so that all winapi calls will fail. Is this safe and works on every case? Is there a better way to do it?</p>\n\n<p>Please note that the player thread (the one how called the dll) must still be able to comunicate with the game, maybe with an open socket. On Linux this can be easily done with <a href=\"http://en.wikipedia.org/wiki/Seccomp\" rel=\"nofollow\"><code>seccomp</code></a>.</p>\n"},{"tags":["c#","winapi","registerhotkey"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":107,"score":2,"question_id":12281442,"title":"How can I prevent RegisterHotKey from stopping the default key action?","body":"<p>I'm using the Window's API  <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms646309%28v=vs.85%29.aspx\" rel=\"nofollow\">RegisterHotKey</a> function to run a macro when the F2 key is pressed while a specific application is open and focused.</p>\n\n<p>The problem is, this is stopping the F2 key from working for other applications, such as Excel.</p>\n\n<p>How can I prevent <code>RegisterHotKey</code> from stopping the default action?</p>\n\n<p>I have a system tray application that uses the <code>HotKeyManager</code> class from <a href=\"http://stackoverflow.com/a/3654821/302677\">this answer</a> to register hotkeys. When a specific key is pressed (for example, F2), I use the Windows API to check if a closed-source application is open and focused, and if so send it a series of <a href=\"http://msdn.microsoft.com/en-us/library/system.windows.forms.sendkeys.aspx\" rel=\"nofollow\">SendKeys</a>.</p>\n"},{"tags":["c++","winapi","listview"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12182887,"title":"how to scroll lock first column of a report style listview in C++","body":"<p>I want to lock the first column of a report style listview from scrolling horizontally.  I'm programming in C++ using Win32 (no .NET).  This functionality does not appear to be available in the standard listview.  Any suggestions on how this can be accomplished with C++/Win32?  I've seen the suggestion of using a DataGridView in .NET, but I'm not using .NET...</p>\n\n<p>Thanks</p>\n"},{"tags":["c++","winapi","visual-studio-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":113,"score":2,"question_id":12285945,"title":"The same ID in dynamic array of HWND","body":"<p>I'm learning WinAPI and trying to write a Tic Tac Toe game. I`m using buttons in which will be displayed X,O or empty image.Buttons stored in a dynamic array(HWND).Why all this Buttons have the same ID?</p>\n\n<pre><code>if(GetDlgCtrlID(hBtns[0][0]) == GetDlgCtrlID(hBtns[0][1]))\n    MessageBox(hWndDlg,_T(\"TheSame\"),_T(\"\"),NULL);\n</code></pre>\n\n<p>MessageBox appears!, why. Please help.</p>\n\n<pre><code>//KA_SHAG\n//Miwa_Mikitin\n//XXXOOO\n#include&lt;windows.h&gt;\n#include&lt;tchar.h&gt;\n#include\"resource.h\"\n\n//Main Proc\nBOOL CALLBACK DialogProc(HWND hWndDlg,UINT message,WPARAM wParam,LPARAM lParam);\n//EnumChildProc\nBOOL CALLBACK DisableEnableButtons(HWND hwnd,LPARAM lParam);\n\nHWND** hBtns;//Global Dynamic Array of Buttons\nint size = 150;//Size of Side of field, Button Size = size/nButtons\n\n//BITMAPS\nHBITMAP hBmpX,hBmpO,hBmpNone;\n/////////\n\nvoid CreateButtons(HWND hWndDlg,int nBtnsOld,int nBtnsNew);\nvoid LoadBitmaps();\n\n\nINT WINAPI WinMain(HINSTANCE hIns,HINSTANCE hPrevIns,LPSTR cmdLine,INT nShowCmd)\n{   \n    HWND hWndDlg = CreateDialog(hIns,MAKEINTRESOURCE(IDD_DIALOG1),NULL,DialogProc);\n\n    MSG msg;\n    ShowWindow(hWndDlg,1);\n\n    while(GetMessage(&amp;msg,NULL,0,0))\n    {\n        TranslateMessage(&amp;msg);\n        DispatchMessage(&amp;msg);\n    }\n\n    return msg.wParam;\n}\n\nBOOL CALLBACK DialogProc(HWND hWndDlg,UINT message,WPARAM wParam,LPARAM lParam)\n{\n    HINSTANCE hIns = GetModuleHandle(0);            \n    static int nBtnsOld = 5;//intitial N of Buttons on a row|col\n    static int nBtnsNew;//next update N of Buttons on a row|col\n    static BOOL isPlaying = false;\n    static BOOL isMyMove = true;\n\n    switch(message)\n    {\n    case WM_INITDIALOG:\n        {       \n            LoadBitmaps();\n            CreateButtons(hWndDlg,nBtnsOld,nBtnsOld);\n        }\n        return true;\n\n    case WM_COMMAND:\n        if(HIWORD(wParam) == BN_CLICKED)\n        {\n            //Resize the Button field\n            if(LOWORD(wParam) == IDC_BTNSETSIZE)\n            {       \n                //Determine wich RadioBtn is Checked\n                if(IsDlgButtonChecked(hWndDlg,IDC_RADIO33))\n                    nBtnsNew = 3;//set new nBtns\n                if(IsDlgButtonChecked(hWndDlg,IDC_RADIO44))\n                    nBtnsNew = 4;//set new nBtns\n                if(IsDlgButtonChecked(hWndDlg,IDC_RADIO55))\n                    nBtnsNew = 5;//set new nBtns\n                ///////////////////////////////////////////\n                //If no difference than ignore\n                //else Create new Array of Btns\n                if(nBtnsOld != nBtnsNew)\n                {\n                    CreateButtons(hWndDlg,nBtnsOld,nBtnsNew);\n                    nBtnsOld = nBtnsNew;\n                }\n                /////////////////////////////////////////\n                return true;\n            }\n            if(LOWORD(wParam) == IDC_BTNBEGIN)\n            {   \n                //Enum Buttons,CheckBox,RadioBtns\n                //then Disable or Enable them depending on isPlaying var\n                //if TRUE - ENABLE\n                //else Disable\n                EnumChildWindows(hWndDlg,DisableEnableButtons,isPlaying);\n                //switch isPlaying )\n                isPlaying = !isPlaying;\n                //switch begin Button Text\n                if(isPlaying)\n                    SetWindowText(GetDlgItem(hWndDlg,IDC_BTNBEGIN),_T(\"Закінчити гру\"));\n                else\n                    SetWindowText(GetDlgItem(hWndDlg,IDC_BTNBEGIN),_T(\"Почати гру\"));\n                /////////////////////////////////////////////////////////////////////\n                return true;\n            }\n            //When Playing\n            if(isPlaying)\n            {\n                //Determine HWND of Pressed Btn\n                HWND pressedBtn = GetDlgItem(hWndDlg,LOWORD(wParam));\n                HBITMAP propBmp;\n                if(isMyMove)\n                    propBmp = hBmpX;\n                else\n                    propBmp = hBmpO;\n                //Change BMP\n                SendMessage(pressedBtn,\n                    BM_SETIMAGE,IMAGE_BITMAP,\n                    (LPARAM)propBmp);\n                //WHY???\n                if(GetDlgCtrlID(hBtns[0][0]) == GetDlgCtrlID(hBtns[0][1]))\n                    MessageBox(hWndDlg,_T(\"TheSame\"),_T(\"\"),NULL);\n\n                return true;\n            }\n        }\n        return true;\n    case WM_CLOSE:\n        DestroyWindow(hWndDlg);\n        PostQuitMessage(0);\n        return TRUE;\n    }\n\n    return FALSE;\n}\n\nvoid CreateButtons(HWND hWndDlg,int nBtnsOld,int nBtnsNew)\n{\n\n    HINSTANCE hIns = GetModuleHandle(0);//main instance\n\n    //Destroy Buttons\n    if(hBtns)\n    {\n        for(int i=0;i&lt;nBtnsOld;i++)\n            for(int j=0;j&lt;nBtnsOld;j++)\n                DestroyWindow(hBtns[i][j]);\n        ////////////////////////////////    \n        //Free memory\n        for(int n=0;n&lt;nBtnsOld;n++)\n            delete[]hBtns[n];\n        delete[]hBtns;  \n    }\n    /////////////////////////////////\n    //Allocate new memory\n    hBtns = new HWND*[nBtnsNew];\n    for(int n=0;n&lt;nBtnsNew;n++)\n        hBtns[n] = new HWND[nBtnsNew];\n    ////////////////////////////////\n    int x =0;//offset x\n    int y =0;//offset y\n    //tchar[] for diff name s of btns\n\n    //Create Buttons &amp; assign to hBtns Array\n    for(int i=0;i&lt;nBtnsNew;i++)\n    {\n        for(int j=0;j&lt;nBtnsNew;j++)\n        {\n\n            hBtns[i][j] = CreateWindowEx(\n                NULL,_T(\"Button\"),\n                NULL,\n                WS_CHILD | WS_VISIBLE | BS_BITMAP | BS_NOTIFY ,\n                x,y,size/nBtnsNew,size/nBtnsNew,\n                hWndDlg,NULL,\n                hIns,NULL);\n            //Set Default Image On Btns\n            SendMessage(hBtns[i][j],BM_SETIMAGE,IMAGE_BITMAP,(LPARAM)hBmpNone);\n\n            x+=size/nBtnsNew;\n\n        }\n        y+=size/nBtnsNew;\n        x=0;\n    }\n}\n\nBOOL CALLBACK DisableEnableButtons(HWND hwnd,LPARAM lParam)\n{\n    //Lparam is a BOOL if true Button will be Enabled\n    //else Buttons will be Disabled\n    if( GetDlgCtrlID(hwnd) == IDC_RADIO33 ||\n        GetDlgCtrlID(hwnd) == IDC_RADIO44 ||\n        GetDlgCtrlID(hwnd) == IDC_RADIO55 ||\n        GetDlgCtrlID(hwnd) == IDC_CHECKMOVE ||\n        GetDlgCtrlID(hwnd) == IDC_BTNSETSIZE)\n        EnableWindow(hwnd,lParam);//&lt;---lParam is BOOL\n\n    return TRUE;\n}\n\n//BOOL CALLBACK DrawBmpOnBtn(HWND hwnd,LPARAM lParam)\n//{\n//\n//  SendMessage(hwnd,BM_SETIMAGE,\n//  return TRUE;\n//}\n\nvoid LoadBitmaps()\n{\n    HINSTANCE hIns = GetModuleHandle(0);//main instance\n\n    hBmpX = LoadBitmap(hIns,MAKEINTRESOURCE(IDB_BMP_X));\n    hBmpO = LoadBitmap(hIns,MAKEINTRESOURCE(IDB_BMP_O));\n    hBmpNone = LoadBitmap(hIns,MAKEINTRESOURCE(IDB_BMP_NONE));\n}\n</code></pre>\n\n<p>The Project(VS2008) is here : <a href=\"http://www.filehosting.org/file/details/372626/XXXOOO.rar\" rel=\"nofollow\">http://www.filehosting.org/file/details/372626/XXXOOO.rar</a></p>\n\n<p>P.S.when execute the program - lower Button allow to draw in a blue buttons,upper button set the amount of blue buttons, but check some radioBtn.</p>\n"},{"tags":["winapi","shutdown","windows-7-embedded"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":226,"score":0,"question_id":8558421,"title":"Preventing Windows 7 embedded standard shutdown ","body":"<p>Other similar question mostly target Windows XP, where everything was easier. =)</p>\n\n<p>I'd like my application to be able to postpone the windows shutdown transparently, without having windows show this screen:</p>\n\n<p><img src=\"http://i.stack.imgur.com/Qjxgt.png\" alt=\"windows 7 shutdown screen\"></p>\n\n<p>Is there any option left to me after the Vista changes to the WM_QUERYENDSESSION handling? </p>\n\n<p>The target here is Windows 7 standard embedded on an embedded device that runs only my application. Before shutting down the user needs to perform some manual steps that can not be postponed until the next start and must not be forgotten. I'd like to have the user confirm these steps before shutting down.</p>\n"},{"tags":["winapi","connection","client-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12302746,"title":"Why can't people connect to my server app?","body":"<p>I have a server written in C under Windows, but I can only seem to connect to it from machines that are also connected to the router my computer is connected to. Any ideas why? Here's my code:</p>\n\n<pre><code>#ifndef WIN32_LEAN_AND_MEAN\n#define WIN32_LEAN_AND_MEAN\n#endif\n\n#include &lt;windows.h&gt;\n#include &lt;winsock2.h&gt;\n#include &lt;ws2tcpip.h&gt;\n#include &lt;iphlpapi.h&gt;\n#include &lt;stdio.h&gt;\n\n#pragma comment(lib,\"Ws2_32.lib\")\n\n#define PORT \"1234\"\n#define BUFLEN 512\n\nDWORD ErrorMessage(char* msg, int error)\n{\n    printf(\"ErrorMessage: %s\\nCodErr: %d\\n\", msg, error);\n    return -1;\n}\n\nvoid PrintArray(char* v, unsigned int len)\n{\n        for(unsigned int i = 0 ; i &lt; len ; i++)\n    printf(\"%c\",v[i]);\n    printf(\"\\n\");\n}\n\nDWORD WINAPI ClientHandler(LPVOID lpParam)\n{\nSOCKET ClientSocket = *((SOCKET*)lpParam);\n\nchar recvbuf[BUFLEN];\n\nint iResult,iSendResult;\n\ndo\n{\n    iResult = recv(ClientSocket, recvbuf, BUFLEN, 0);\n\n    if(iResult &gt; 0)\n    {\n        PrintArray(recvbuf,iResult);\n\n        iSendResult = send(ClientSocket, recvbuf, iResult, 0);\n\n        if(iSendResult == SOCKET_ERROR)\n        {\n            closesocket(ClientSocket);\n            WSACleanup();\n            return ErrorMessage(\"send\",WSAGetLastError());\n        }\n    }\n\n    else if(iResult == 0)\n        printf(\"Connection closing...\\n\");\n    else\n    {\n        closesocket(ClientSocket);\n        WSACleanup();\n        return ErrorMessage(\"recv\",WSAGetLastError());\n    }\n}\nwhile(iResult &gt; 0);\n\nreturn 0;\n}\n\nint main()\n{\nWSADATA wsaData;\n\nint iResult;\n\niResult = WSAStartup(MAKEWORD(2,2),&amp;wsaData);\n\nif(iResult != 0)\n{\n    printf(\"WSAStartup failed and with error code: %d\\n\",iResult);\n    return ErrorMessage(\"WSAStartup\",GetLastError());\n}\n\nstruct addrinfo *result = NULL, *ptr = NULL, hints;\n\nmemset(&amp;hints,0,sizeof(hints));\n\nhints.ai_family = AF_INET;\nhints.ai_socktype = SOCK_STREAM;\nhints.ai_protocol = IPPROTO_TCP;\nhints.ai_flags = AI_PASSIVE;\n\niResult = getaddrinfo(NULL,PORT,&amp;hints,&amp;result);\n\nif(iResult != 0)\n{\n    printf(\"getaddrinfo failed %d\\n\",iResult);\n    WSACleanup();\n    return -1;\n}\n\nSOCKET ListenSocket = INVALID_SOCKET;\n\nListenSocket = socket(result-&gt;ai_family, result-&gt;ai_socktype, result-&gt;ai_protocol);\n\nif(ListenSocket == INVALID_SOCKET)\n{\n    freeaddrinfo(result);\n    WSACleanup();\n    return ErrorMessage(\"socket\",WSAGetLastError());\n}\n\niResult = bind(ListenSocket, result-&gt;ai_addr, (int)result-&gt;ai_addrlen);\n\nif(iResult == SOCKET_ERROR)\n{\n    freeaddrinfo(result);\n    closesocket(ListenSocket);\n    WSACleanup();\n    return ErrorMessage(\"bind\", WSAGetLastError());\n}\n\nfreeaddrinfo(result);\n\nif(listen(ListenSocket,5) == SOCKET_ERROR)\n{\n    closesocket(ListenSocket);\n    WSACleanup();\n    return ErrorMessage(\"listen\",WSAGetLastError());\n}\n\nSOCKET ClientSocket = INVALID_SOCKET;\n\nsockaddr sa;\n\nwhile(true)\n{\n    ClientSocket = accept(ListenSocket, &amp;sa /*NULL*/, NULL);\n\n    if(ClientSocket == INVALID_SOCKET)\n    {\n        closesocket(ListenSocket);\n        WSACleanup();\n        return ErrorMessage(\"accept\",WSAGetLastError());\n    }\n\n    printf(\"New client arrived...\\n\");\n\n    if(CreateThread(NULL, 0, ClientHandler, &amp;ClientSocket, 0, NULL) == NULL)\n        ErrorMessage(\"CreateThread\",GetLastError());\n}\n\niResult = shutdown(ClientSocket,SD_BOTH);\n\nif(iResult == SOCKET_ERROR)\n{\n    closesocket(ClientSocket);\n    closesocket(ListenSocket);\n    WSACleanup();\n    return ErrorMessage(\"shutsown\",WSAGetLastError());\n}\n\nclosesocket(ListenSocket);\nWSACleanup();\n\nreturn 0;\n}\n</code></pre>\n"},{"tags":["windows","security","winapi","unix"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":2,"question_id":12299455,"title":"Speed of Windows' ImpersonateLoggedOnUser() + RevertToSelf() vs Unix's seteuid() + setegid()","body":"<p>In Unix, when doing some action on behalf of some user, a system program usually calls seteuid(UID) (with accompanying setegid()) to switch to that user first, perform the action, and on finish switch back to superuser using seteuid(0). I time seteuid() and it's in the order of one to several microseconds (meaning, it's quite cheap relative to the action that needs to be done like manipulating files or running a CGI program).</p>\n\n<p>I'm not familiar with Windows API. Do we do the same thing on Windows (but using ImpersonateLoggedOnUser() + RevertToSelf() API functions)? In general, how fast are these functions?</p>\n"},{"tags":["c++","winapi"],"answer_count":6,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1504,"score":4,"question_id":2511672,"title":"How can I quickly enumerate directories on Win32?","body":"<p>I'm trying to speedup directory enumeration in C++, where I'm recursing into subdirectories. I currently have an app which spends 95% of it's time in FindFirst/FindNextFile APIs, and it takes several minutes to enumerate all the files on a given volume. I know it's possible to do this faster because there is an app that does: <a href=\"http://www.voidtools.com/\" rel=\"nofollow\">Everything</a>. It enumerates my entire drive in seconds.</p>\n\n<p>How might I accomplish something like this?</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":164,"score":1,"question_id":12308974,"title":"C++ textbox font","body":"<p>I made a textbox in C++ (Win32)\nNow I want change the textbox form and font because it's look ugly\nHow I do it?</p>\n\n<p>It's how I create the textbox</p>\n\n<pre><code>HWND WindowManager::textbox(int width, int height, int xPos, int yPos, LPCSTR content, bool edit_able)\n{\n    int type = (edit_able) ? (WS_CHILD|WS_VISIBLE|ES_AUTOHSCROLL) : (WS_CHILD|WS_VISIBLE|WS_HSCROLL|ES_AUTOHSCROLL);\n    return CreateWindowEx(\n        WS_EX_CLIENTEDGE,\n        \"EDIT\",\n        content,\n        type,\n        xPos,\n        yPos,\n        width,\n        height,\n        window,\n        (HMENU)50,\n        GetModuleHandle(NULL),\n        NULL\n    );\n}\n</code></pre>\n"},{"tags":["winapi","record","pascal"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12291076,"title":"Pascal: Get field from LPSYSTEMTIME record","body":"<p>I'm using the Win32 api to get date and time of a file. I have a LPSYSTEMTIME structure, and I'm trying to print its wYear variable.</p>\n\n<p>I've got a function (GetFileDate):</p>\n\n<pre><code>function GetFileDate : LPSYSTEMTIME\nvar\n    CheckFile: Long;\n    FileTime: LPFILETIME;\n    FileTimeReturn: LPFILETIME;\n    SystemTimeReturn: LPSYSTEMTIME;\nbegin\n    CheckFile := CreateFile(PChar('main.pas'), GENERIC_READ, FILE_SHARE_READ, NIL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, 0);\n    GetFileTime(CheckFile, FileTime, NIL, NIL);\n    FileTimeToLocalFileTime(FileTime, FileTimeReturn);\n    FileTimeToSystemTime(FileTimeReturn, SystemTimeReturn);\n    GetFileDate := SystemTimeReturn;\nend;\n</code></pre>\n\n<p>But when I do this...</p>\n\n<pre><code>begin\n    Write(GetFileDate.wYear);\nend.\n</code></pre>\n\n<p>It spits back </p>\n\n<blockquote>\n<pre><code>main.pas(22,20) Error: Illegal qualifier\nmain.pas(22,20) Fatal: Syntax error, \")\" expected but \"identifier WYEAR\" found\nFatal: Compilation aborted\n</code></pre>\n</blockquote>\n\n<p>Any help on this?</p>\n"},{"tags":["windows","winforms","winapi","parent","sendkeys"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12294193,"title":"How can I pass Ctrl+Tab to the parent window in C#?","body":"<p>My WinForm dialog is attached to a 3rd party window (SolidWorks) via a call to <code>SetParent</code> (p/invoke). My dialog is in the 3rd parties process as an add-in.</p>\n\n<p>When my user has given my dialog/widget focus by clicking on it, if they then press <kbd>Ctrl</kbd>+<kbd>Tab</kbd> to switch views in the parent application, my dialog receives the key stroke sequence - I can see this by overriding <code>ProcessCmdKey</code>. The command is not passed to the parent window, and hence does nothing.</p>\n\n<p><strong>How can I pass this key sequence to the parent HWND?</strong></p>\n\n<p>It's not just <kbd>Ctrl</kbd>+<kbd>Tab</kbd> I need to forward, it's all key's including <kbd>Alt</kbd>+<kbd>F4</kbd>, <kbd>F1</kbd>, etc. etc.</p>\n"},{"tags":["winapi","pascal","systemtime"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12308617,"title":"Pascal - Win32api SYSTEMTIME struct wYear is always 97","body":"<p>I've got a function that returns a SYSTEMTIME.</p>\n\n<pre><code>function GetFileDate : SYSTEMTIME; //Stdcall;\nvar\n    CheckFile: Long;\n    FileTime: LPFILETIME;\n    FileTimeReturn: LPFILETIME;\n    SystemTimeReturn: LPSYSTEMTIME;\nbegin\n    CheckFile := CreateFile(PChar('main.dll'), GENERIC_READ, FILE_SHARE_READ, NIL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, 0);\n    GetFileTime(CheckFile, @FileTime, NIL, NIL);\n    FileTimeToLocalFileTime(@FileTime, @FileTimeReturn);\n    FileTimeToSystemTime(@FileTime, @SystemTimeReturn);\n    GetFileDate := SystemTimeReturn^;\nend;\n</code></pre>\n\n<p>It always returns 97 for the year, for both files from 2012 and 2006 and anything else.\nWhy?</p>\n"},{"tags":["c++","python","windows","winapi","pywinauto"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":166,"score":0,"question_id":12304092,"title":"What is wrong with my SendMessage/PostMessage part of code?","body":"<p>I have created simple script which try get equity computed by <a href=\"http://www.pokerstove.com/blog/\" rel=\"nofollow\">enter link description here</a>:</p>\n\n<pre><code>import time\nimport win32api\nimport win32con\n\nfrom pywinauto import application\n\ndef getEquity(ps_pid, hand1, hand2):\n    def set_hand(handle, hand, kf=0):\n        win32api.SendMessage(handle, win32con.WM_SETFOCUS, 0, 0) # f: losefocus\n        #win32api.SendMessage(handle, win32con.WM_GETDLGCODE, 0, 0)\n        time.sleep(0.05)\n        len = win32api.SendMessage(handle, win32con.WM_GETTEXTLENGTH, 0, 0)\n        time.sleep(0.05)\n        win32api.SendMessage(handle, win32con.EM_SETSEL, 0, len)\n        time.sleep(0.05)\n        for c in hand:\n            win32api.PostMessage(handle, win32con.WM_CHAR, ord(c), 0)\n            #win32api.SendMessage(handle, win32con.WM_GETDLGCODE, 0, 0)\n            time.sleep(0.05)\n        win32api.SendMessage(handle, win32con.WM_KILLFOCUS, 0, 0)\n\n    app = application.Application()\n    app.connect_(process=ps_pid)\n\n    set_hand(app.PokerStove.REdit1.handle, hand1)\n    set_hand(app.PokerStove.REdit2.handle, hand2)\n\n    app.PokerStove.Evaluate.Click()\n    while app.PokerStove.EvaluateButton.WindowText() != 'Evaluate':\n        time.sleep(0.1)\n\n    return app.PokerStove.Edit12.GetLine(0)\n\nimport sys\nprint getEquity(int(sys.argv[1]), sys.argv[2], sys.argv[3])\n</code></pre>\n\n<p>I decided to use window messages instead of SendKey because I need to have it working also when PokerStove is minimized. </p>\n\n<p>This script works fine when when PokerStove is minimized. But strange things happens when is not. Script correctly fills text edits and click button and I'm getting correct results. But after that change his caption to something strange:</p>\n\n<p><img src=\"http://i.stack.imgur.com/kwC8q.png\" alt=\"PokerStove\"></p>\n\n<p>So it looks like PokerStove is still computing, but results are ready. Because of this change when I start my script again it will fail. But when PokerStove is minimized I don't have this issue.</p>\n\n<p>I suspect that I did something wrong with sending messages to edit boxes. Because if I fill them manually and click button then everything is fine. When I fill it using <code>set_hand</code> function, then even if I click button manually I will get this strange result.</p>\n\n<p>So what is wrong with my script?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>When I connect spy++ to EvaluateButton I can see that button still gets WM_SETTEXT message which set it to \"Stop (99% Complete)\".</p>\n\n<p><strong>EDIT2:</strong></p>\n\n<p>It was tested on Windows 7. But at home on Windows XP in VirtualBox code is working fine...</p>\n"},{"tags":["winapi","copyfile","symantec"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":225,"score":2,"question_id":7084598,"title":"Using Win32's ::CopyFile to retrieve file from Symantec Enterprise Vault","body":"<p>I'm having a problem copying a file from a Symantec Enterprise Vault.  Usually, I use the Win32 ::CopyFile function to copy from one NTFS to another. Now, the NTFS has a special symbolic link or shortcut.  If you access the shortcut via Windows Explorer, the Symantec service intercepts the request and recovers the full file for you.  This does not seem to happen when using the API call.  It appears that the retrieval is occurring, but the API call doesn't wait for it to complete.</p>\n\n<p>Is there a method for interacting with these special shortcuts programmatically?</p>\n"},{"tags":["c#","winapi","pinvoke","netapi32"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":984,"score":1,"question_id":1134457,"title":"Need a way to change a remote user password - NetUserChangePassword fails with 2245","body":"<p>I am trying to call <code>NetUserChangePassword</code> to change the passwords on a remote computer.  I am able to change the password when I log-in to the machine, but I can't do it via code.  The return value is 2245 which equates to the Password Being too short.</p>\n\n<p>I read this link: <a href=\"http://support.microsoft.com/default.aspx?scid=kb;en-us;131226\" rel=\"nofollow\">http://support.microsoft.com/default.aspx?scid=kb;en-us;131226</a> but nothing in the link was helpful to me.  (My code did not seem to fit any of the issues indicated.)</p>\n\n<p>If you have any ideas how to fix this error or have a different way to programmatically change a users password on a remote (Windows 2003) machine I would be grateful to hear it.</p>\n\n<p>I am running the code on a windows xp machine.</p>\n\n<p>Here is my current code in-case it is helpful (Also shows my create user code which works just fine).</p>\n\n<pre><code>public partial class Form1 : Form\n{\n    [DllImport(\"netapi32.dll\", CharSet = CharSet.Unicode, SetLastError = true)]\n    private static extern int NetUserAdd(\n         [MarshalAs(UnmanagedType.LPWStr)] string servername,\n         UInt32 level,\n         ref USER_INFO_1 userinfo,\n         out UInt32 parm_err);\n\n    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]\n    public struct USER_INFO_1\n    {\n        [MarshalAs(UnmanagedType.LPWStr)]\n        public string sUsername;\n        [MarshalAs(UnmanagedType.LPWStr)]\n        public string sPassword;\n        public uint uiPasswordAge;\n        public uint uiPriv;\n        [MarshalAs(UnmanagedType.LPWStr)]\n        public string sHome_Dir;\n        [MarshalAs(UnmanagedType.LPWStr)]\n        public string sComment;\n        public uint uiFlags;\n        [MarshalAs(UnmanagedType.LPWStr)]\n        public string sScript_Path;\n    }\n\n    [DllImport(\"netapi32.dll\", CharSet = CharSet.Unicode, \n        CallingConvention = CallingConvention.StdCall, SetLastError = true)]\n    static extern uint NetUserChangePassword(\n        [MarshalAs(UnmanagedType.LPWStr)] string domainname,\n        [MarshalAs(UnmanagedType.LPWStr)] string username,\n        [MarshalAs(UnmanagedType.LPWStr)] string oldpassword,\n        [MarshalAs(UnmanagedType.LPWStr)] string newpassword);\n\n    // Method to change a Password of a user on a remote machine.\n    private static uint ChangeUserPassword(string computer, string userName,\n        string oldPassword, string newPassword)\n    {\n        return NetUserChangePassword(computer, userName, \n            oldPassword, newPassword);\n    }\n\n\n    // Method used to create a new user on a Remote Machine\n    private static uint CreateUser(string computer, string userName, \n        string password)\n    {\n        const int UF_DONT_EXPIRE_PASSWD = 0x10000;\n        const int UF_ACCOUNTDISABLE = 0x000002;\n\n        const int USER_PRIV_GUEST = 0; // lmaccess.h:656\n        const int USER_PRIV_USER = 1;   // lmaccess.h:657\n        const int USER_PRIV_ADMIN = 2;  // lmaccess.h:658\n\n        USER_INFO_1 userinfo = new USER_INFO_1()\n        {\n            sComment = \"Scan Track User\",\n            sUsername = userName,\n            sPassword = password,\n            sHome_Dir = \"\",\n            sScript_Path = \"\",\n            uiPriv = USER_PRIV_USER,\n            uiFlags = UF_DONT_EXPIRE_PASSWD\n        };\n\n\n        uint output;\n        NetUserAdd(computer, 1, ref userinfo, out output);\n        return output;\n    }\n\n    private void button1_Click(object sender, EventArgs e)\n    {\n\n        string computer = \"10.1.9.115\";\n        string userName = \"test2\";\n        string psswrd = \"ssssss\";\n        string fullname = \"\";\n\n        uint output = CreateUser(computer, userName, psswrd);\n        MessageBox.Show(output.ToString());\n    }\n\n\n    private void button2_Click(object sender, EventArgs e)\n    {\n        string computer = \"10.1.9.115\";\n        string userName = \"test\";\n        string oldPassword = \"!B3tt3rLuck!@!\";\n        string newPassword = \"!B3tt3r-Luck2\";\n\n        uint result = ChangeUserPassword(computer, userName, \n            oldPassword, newPassword);\n\n        MessageBox.Show(result.ToString());\n    }\n\n\n    public Form1()\n    {\n        InitializeComponent();\n    }\n\n\n}\n</code></pre>\n"},{"tags":["c","winapi","unicode","wdk","winddk"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12299123,"title":"prepend the \"\\\\?\\\" string to the path - DriverPackageUninstall","body":"<p>I used <code>DriverPackageUninstall</code>, to uninstall my driver. For this API I need to give \"Inf Path\" as the input. And I need to give this path as UNICODE string. To do this, I took the following statement from MSDN as reference.</p>\n\n<blockquote>\n  <p>For a Unicode string, the maximum length is 32,767 characters. If you\n  use the Unicode version, prepend the \"\\?\\\" string to the path. For\n  general information about the format of file path strings, see  Naming\n  a File in the MSDN Library.</p>\n</blockquote>\n\n<p>But when I  try the same in my code its not working. Can someone give me some examples on how to prepend the \"\\?\\\" before the path? Thanks..</p>\n\n<p>UPDATE :</p>\n\n<p>I tried with the below code as sample </p>\n\n<pre><code>#define UNICODE\n#define _UNIOCDE\n#define WINVER 0x501\n\n    #include &lt;stdio.h&gt;\n    #include &lt;windows.h&gt;\n    #include &lt;tchar.h&gt;\n\n    int main () {\n        PTCHAR DriverPackageInfPath = TEXT(\"\\\\?\\\\c:\\\\Documents and Settings\\\\Desktop\\\\My.inf\");\n\n        FILE * Log;\n         Log = _wfopen( TEXT(DriverPackageInfPath, TEXT(\"a\"));\n\n         if ( Log == NULL ) {\n           MessageBox(NULL, TEXT ( \"Unable to open INF file\\n\" ),\n               TEXT ( \"Installation Error\" ), 0 | MB_ICONSTOP );\n           exit ( 1 );\n         } else {\n                printf (\"INF file opened successfully\\n\");\n         }\n\n         return 0;\n    }\n</code></pre>\n\n<p>UPDATE:</p>\n\n<p>\".\\dist\\Driver\\My.inf\" How to add \"\\\\?\\\" before this kind of paths? \"\\\\?\\.\\dist\\Driver\\My.inf\" is not working.</p>\n"},{"tags":["c#","windows","winforms","winapi"],"answer_count":1,"favorite_count":4,"up_vote_count":4,"down_vote_count":0,"view_count":189,"score":4,"question_id":11750365,"title":"forward winapi events to another window","body":"<p>What i have now: my app in C# is half-transparent, and does not catch winapi events - every click, drag etc is catch by underlaying window, which is separate app (like webbrower). I use this to overlay information on top of what browser shows.  This is my code for this:</p>\n\n<pre><code>int exstyle = GetWindowLong(this.Handle, GWL_EXSTYLE);\nexstyle |= WS_EX_TRANSPARENT;\nSetWindowLong(this.Handle, GWL_EXSTYLE, exstyle);\n\nIntPtr hwndf = this.Handle;\nIntPtr hwndParent = GetDesktopWindow();\nSetParent(hwndf, hwndParent);\n</code></pre>\n\n<p>But now, i would like to send all events to both my app window (which is half-transparent on top) and web browser (under my app). So for example if i click, the click works in both windows as if they were on top. I imagine that only way to do that is to catch all events and then forward them to lower window, but is there any way to do that? \nI use winforms as window lib.</p>\n\n<hr>\n\n<p>What i do now is not that important, because i want to normally consume events, then forward them to underlaying window. So this is something completly different from what i'm doing now with WS_EX_TRANSPARENT. The point of this is to drag content in both windows simultaneously. If there is any better way of doing it, i would be glad to hear it.</p>\n\n<hr>\n\n<p>As least what i need is to transfer drag events to both windows, and all other events to underlaying window (not under my control). So, perhaps it will be easier to stay with my window as WS_EX_TRANSPARENT (makes events pass-thru to underlaying window) and simply install global hook to receive drag events? What do you think?</p>\n\n<p>BTW i don't have experience with Winapi, so solution might be obvious.</p>\n"},{"tags":["c++","windows","winapi","mouse"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":663,"score":1,"question_id":10462198,"title":"Raw mouse input with Windows","body":"<p>Reading this article \"Taking Advantage of High-Definition Mouse Movement\" -  <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ee418864(v=vs.100).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/ee418864(v=vs.100).aspx</a>, I surmise that one should use raw input for more precise readings from input devices.</p>\n\n<p>The article states that WM_MOUSEMOVE's primary disadvantage is that it is limited to the screen resolution.</p>\n\n<p>Upon close inspection of the RAWMOUSE structure I see that lLastX and lLastY are long values and you get the delta via them.</p>\n\n<p>To me it looks like WM_MOUSEMOVE and WM_INPUT is the same except with WM_INPUT you do not get acceleration (pointer ballistics) applied.</p>\n\n<p>Are both WM_MOUSEMOVE and WM_INPUT limited to the screen resolution?</p>\n\n<p>If so, what is the benefit of using WM_INPUT?</p>\n"},{"tags":["windows","winapi","sockets","winsock"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":125,"score":0,"question_id":12268811,"title":"WSAEventSelect, zero event","body":"<p>In my socket server I use WSAEventSelect() and WSAEnumNetworkEvents() to detect FD_ACCEPT and FD_CLOSE events.</p>\n\n<p>Here is the simplified version of my code:</p>\n\n<pre><code>HANDLE sockEv=CreateEvent(NULL,TRUE,FALSE,NULL);\nWSAEventSelect(servSocket,sockEv,FD_ACCEPT|FD_CLOSE);\nfor(;;) {\n  if(WSAWaitForMultipleEvents(1,&amp;sockEv,FALSE,INFINITE,FALSE)==WSA_WAIT_EVENT_0) {\n    WSANETWORKEVENTS wsaEvents={0};\n    WSAEnumNetworkEvents(servSocket,sockEv,&amp;wsaEvents);\n    if((wsaEvents.lNetworkEvents &amp; FD_ACCEPT)==FD_ACCEPT) {\n      SOCKET clntSock=accept(servSocket,(sockaddr*)clientAddr,&amp;addrlen);\n      ....\n    }\n    else if (wsaEvents.lNetworkEvents==0) {\n    // this event occurs after each FD_ACCEPT event\n    }\n    ....\n  }\n  ....\n}\n</code></pre>\n\n<p>The problem is that each time a new connection is accepted from a client, I receive 2 events: first with WSANETWORKEVENTS.lNetworkEvents set to FD_ACCEP, then with WSANETWORKEVENTS.lNetworkEvents set to zero. That is the for(;;) loop is executed 2 times each time a new client is accepted. Or maybe the sockEv is not reset by WSAEnumNetworkEvents after detecting FD_ACCEPT.</p>\n\n<p>What does this zero event mean and why it happens?\nI didn't find anything about it in the documentation.</p>\n\n<p><strong>UPDATE</strong>: Compilable sample</p>\n\n<pre><code>int _tmain(int argc, _TCHAR* argv[])\n{\n  WSADATA wsaData;\n  WSAStartup(MAKEWORD(2,2),&amp;wsaData);\n  try {\n    SOCKET servSocket=socket(AF_INET,SOCK_STREAM,IPPROTO_TCP);\n\n    sockaddr_in serv={0};\n    serv.sin_family=AF_INET;\n    serv.sin_addr.s_addr=htonl(INADDR_ANY);\n    serv.sin_port=htons(18081);\n    memset(serv.sin_zero,0,sizeof(serv.sin_zero));\n\n    if(bind(servSocket,(sockaddr*)&amp;serv,sizeof(serv))==SOCKET_ERROR)\n      throw WSAGetLastError();\n    if(listen(servSocket,SOMAXCONN)==SOCKET_ERROR)\n      throw WSAGetLastError();\n    HANDLE sockEv=CreateEvent(NULL,TRUE,FALSE,NULL);\n    if(WSAEventSelect(servSocket,sockEv,FD_ACCEPT|FD_CLOSE)==SOCKET_ERROR) \n      throw WSAGetLastError();\n\n    for(;;) {\n      if(WSAWaitForMultipleEvents(1,&amp;sockEv,FALSE,INFINITE,FALSE)!=WSA_WAIT_EVENT_0)\n        throw -1;\n      WSANETWORKEVENTS wsaEvents={0};\n      if(WSAEnumNetworkEvents(servSocket,sockEv,&amp;wsaEvents)==SOCKET_ERROR)\n        throw WSAGetLastError();\n      if((wsaEvents.lNetworkEvents &amp; FD_ACCEPT)==FD_ACCEPT) {\n        SOCKET clntSocket=accept(servSocket,0,0);\n        closesocket(clntSocket);\n        puts(\"accept\");\n      }\n      else if(wsaEvents.lNetworkEvents==0) {\n        puts(\"zero event\");\n      }\n    }\n  }\n  catch(int errorCode) {\n    printf(\"Last Error: %d\\n\",errorCode);\n  }\n  WSACleanup();\n  return 0;\n}\n</code></pre>\n\n<p>I tried this code on WinXP 32bit.</p>\n"},{"tags":["winapi","programming-languages"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12281292,"title":"Options to write Win32 GUI applications?","body":"<p>As SO returns \"4,476 search results for posts containing \"win32 gui applications\"\"... I'll have to ask a question that has probably been asked before but is lost in the midst of all those questions.</p>\n\n<p>Currently, what are the options to write GUI applications for Win32, that have a big-enough following so that the environment offers enough and well-supported third-party tools?</p>\n\n<p>I could come up with:</p>\n\n<ul>\n<li>C++</li>\n<li>Delphi, and possibly</li>\n<li>RealBasic (although the fact that it's originally a Macintosh tool could result in small but noticeable issues in look 'n feel).</li>\n</ul>\n\n<p>Besides their relative lack of well-supported third-party tools, solutions like Python + wxWidgets, or [Power|Pure|Free]Basic aren't good options: The former has too many 1.0 widgets (couldn't find a business-grade grid, for instance), and the latter are procedural languages so requires writing apps like Petzold's book with the lower productivity it entails.</p>\n\n<p>Are there other solutions available?</p>\n\n<p>Thank you.</p>\n\n<hr>\n\n<p>Edit: Sorry for not having been precise enough: Big tools like .Net and Java are not options. I'm looking for tools that can either build a whole EXE statically (eg. Delphi) or provide a light enough runtime (VBClassic).</p>\n"},{"tags":["c#","windows","winforms","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12294953,"title":"UAC Window On Top","body":"<p>I seem to be running into a dead end here.  I have a project that does the following:</p>\n\n<ul>\n<li>just runs and stays in notification area</li>\n<li>when user presses middle mouse button, it shows a form</li>\n<li>user can then chose whatever from the form, and be happy.</li>\n</ul>\n\n<p>This is working just fine, however what is NOT working is that when the form is shown, it does NOT activate.</p>\n\n<p>Now, prior to me modifying the app.manifest to <code>requireAdmin</code>, it was working fine.  Any time the form was shown, boom it was active.</p>\n\n<p>But now that i'm running the form as Administrator, given that I need to be able to control one of our other applications with it (that is ran as admin as well), the form comes up just fine, but doesn't activate.</p>\n\n<p>I have tried:\n - <code>TopMost = true</code> inside of the Form_Load method\n - Calling <code>SetForegroundWindow</code> with the forms handle on Form_Load\n - Calling <code>ShowDialog</code> both on Form_Load and also tried it when the form was built.\n - Calling <code>Activate</code> on Form_Load as well as when the form was built</p>\n\n<p>Here's my layout:</p>\n\n<ul>\n<li>Program runs, requires UAC permissions due to the manifest, user agrees, and it kicks off</li>\n<li>Only a notification icon appears, shows a nice little bubble saying it's running</li>\n<li>Program.cs monitors the keyboard/mouse hooks</li>\n<li>When middle mouse button, or any of the keyboard hooks are triggered, it creates a new form object</li>\n<li>sets the location of where the form should appear</li>\n<li>and then finally shows the form.</li>\n</ul>\n\n<p>Again, without UAC and <code>requireAdmin</code> inside of the app.manifest, this works fine.  But once it is running as admin, nope, wont stay in front.</p>\n\n<p>I know that MS has made the <code>SetForegroundWindow</code> requirements much stricter with later versions of windows (Vista, 7, 8), but i really need to be able to make this form show as the top most, active window (like a context menu).</p>\n\n<p>How can i do that properly?</p>\n"},{"tags":["windows","delphi","winapi"],"answer_count":1,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":164,"score":5,"question_id":12282952,"title":"How to Start an application and obtain a handle to it with Delphi?","body":"<p>I want to start an application from Delphi, and obtain a handle to it, so I can embed the main window of said application on a frame of type TFrame. So far I have tried:</p>\n\n<pre><code>Function TFrmEmbeddedExe.StartNewApplication : Boolean;\nvar\n  SEInfo: TShellExecuteInfo;\n  ExitCode : DWORD;\nbegin\n\n  FillChar(SEInfo, SizeOf(SEInfo), 0) ;\n  SEInfo.cbSize := SizeOf(TShellExecuteInfo) ;\n  with SEInfo do\n  begin\n    fMask := SEE_MASK_NOCLOSEPROCESS;\n    Wnd := self.Handle;\n    lpFile := PChar(self.fexecuteFileName) ;//  Example could be 'C:\\Windows\\Notepad.exe'\n    nShow := SW_SHOWNORMAL;//SW_HIDE;\n  end;\n\n  if ShellExecuteEx(@SEInfo) then\n  begin\n    sleep(1500);\n    self.fAppWnd := FindWindow(nil, PChar(self.fWindowCaption)); //Example : 'Untitled - Notepad'\n    if self.fAppWnd &lt;&gt; 0 then\n    begin\n      Windows.SetParent(self.fAppWnd, SEInfo.Wnd);\n      ShowWindow(self.fAppWnd, SW_SHOWMAXIMIZED);\n      result := true;\n    end\n    else\n      result := false;\n\n  end\n\n  else\n    result := false;\nend ;\n</code></pre>\n\n<p>The above code actually works, but findWindow will find any given instans of the application I started. I want to embed the exact instans that I Shellexecuted.\nSo if Notepad had been started a couple of times, there is no way I can get the correct one using FindWindow.</p>\n\n<p>I have tried:</p>\n\n<pre><code>Function TfrmEmbeddedExe.CreateProcessNewApplication : Boolean;\nvar\nzAppName: array[0..512] of char;\nStartupInfo: TStartupInfo;\nProcessInfo: TProcessInformation;\nRes : DWORD;\nDoWait : Boolean;\nbegin\n  DoWait := False;\n  StrPCopy(zAppName, self.fexecuteFileName);  //'C:\\Windows\\Notepad.exe'\n  FillChar(StartupInfo, Sizeof(StartupInfo), #0);\n  StartupInfo.cb := Sizeof(StartupInfo);\n  StartupInfo.dwFlags := STARTF_USESHOWWINDOW;\n  StartupInfo.wShowWindow := SW_SHOWNORMAL;\n\n  if CreateProcess (zAppName,\n  nil, { pointer to command line string }\n  nil, { pointer to process security attributes }\n  nil, { pointer to thread security attributes }\n  false, { handle inheritance flag }\n  CREATE_NEW_CONSOLE or { creation flags }\n  NORMAL_PRIORITY_CLASS,\n  nil, { pointer to new environment block }\n  nil, { pointer to current directory name }\n  StartupInfo, { pointer to STARTUPINFO }\n  ProcessInfo) then   { pointer to PROCESS_INF }\n  begin\n    if DoWait then  //just set it to false... so it will never enter here\n    begin\n      WaitforSingleObject(ProcessInfo.hProcess, INFINITE);\n      GetExitCodeProcess(ProcessInfo.hProcess, Res);\n    end\n    else\n    begin\n      self.fAppWnd := ProcessInfo.hProcess;\n\n      Windows.SetParent(self.fAppWnd, self.Handle);\n      ShowWindow(self.fAppWnd, SW_SHOWMAXIMIZED);\n      CloseHandle(ProcessInfo.hProcess);\n      CloseHandle(ProcessInfo.hThread);\n\n\n    end;\n\n    result := true;\n  end\n  else begin\n    Result := false;\n  end;\nend;\n</code></pre>\n\n<p>PLEASE DO NOT RUN ABOVE CODE! It produces weird results involving picking a seemingly random window anywhere in all running applications and embedding that (even menu-items from the Windows start menu..)</p>\n\n<p>So basically what I need is how do I start an application, and grab a handle to the applications main window.</p>\n\n<p>Any help is highly appreciated</p>\n\n<p>Regards</p>\n\n<p>Jens Fudge</p>\n"},{"tags":["c++","winapi","synchronization","mutex"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":12295030,"title":"WaitForMultipleObjects with a mutex and an event","body":"<p>If I have the following C++ code (for Windows Os):</p>\n\n<pre><code>HANDLE hEvent = ::CreateEvent(NULL, TRUE, FALSE, NULL);\nHANDLE hMutex = ::CreateMutex(NULL, FALSE, NULL);\n\nHANDLE hHandles[] = {\n    hEvent,\n    hMutex\n};\n\nDWORD dwR = ::WaitForMultipleObjects(2, hHandles, FALSE, INFINITE) - WAIT_OBJECT_0;\n\n//if dwR == 0, what state is hMutex in?\n//Or, do I need to call ReleaseMutex(hMutex) in that case?\n</code></pre>\n\n<p>I'm not sure how to handle this situation regarding the mutex.</p>\n"},{"tags":["winapi","session","printing","terminal-services"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":8232541,"title":"How do I retrieve the TS session ID of the user that submitted a print job?","body":"<p>I'm writing a port monitor, and want to display some UI to the end user.</p>\n\n<p>This port monitor must run under Terminal Services.</p>\n\n<p>I can get the username of the logged on user from the <a href=\"http://msdn.microsoft.com/en-us/library/dd145019\" rel=\"nofollow\">JOB_INFO_1</a> structure, but not the AD domain name nor the session ID.</p>\n\n<p>I understand that a print job can be submitted remotely (eg. from a network printer) and thus the session ID may not be passed, but <a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff562679%28v=vs.85%29.aspx\" rel=\"nofollow\">SplPromptUIInUsersSession</a> seems to indicate the the spooler knows what session the original job came from.</p>\n\n<p>Currently, I am disallowing network printing and using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa383833%28v=vs.85%29.aspx\" rel=\"nofollow\">WTSEnumerateSessions</a> function with <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa383838%28v=VS.85%29.aspx\" rel=\"nofollow\">WTSQuerySessionInformation</a> to match against the username and <code>WTSActive</code> session status. This works, but can cause the incorrect session to be returned if the end user has two active TS sessions.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["c++","winapi","visual-studio-2008","build","console"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12292819,"title":"VS2008 - Project Out of Date, not a line of code changed","body":"<p>I am having a very strange problem with Visual Studio 2008. I searched here on SO for similar problems with the \"Project Out of Date\" dialog, but their problem was that either they were using a header file that is deprecated/no longer exists, or their problem was occuring while building a multi-project solution or it had other dependencies.</p>\n\n<p>My project is a Win32 Console application, I went to File->New->Project...->Win32 Console Application. I used the default settings (precompiled header is checked), and I didn't change a single line of code in the project, as soon as the project created I pressed the debug button (though I get the exact same problem when I set the build target to Release).</p>\n\n<p>[main.cpp]</p>\n\n<pre><code>#include \"stdafx.h\"\n\nint _tmain(int argc, _TCHAR* argv[])\n{\n    return 0;\n}\n</code></pre>\n\n<p>^ Very standard source file, right? Well, no matter what I build in any project VS2008 tells me it is out of date. Why? This problem may not prevent me from building the project, but I would very much like everything to be in order and never have to see this dialog again. Again, I looked at similar questions, but their solutions involve removing some extra dependency or something of the sort, none of which applies to my situation.</p>\n\n<p>Thanks in advance for any possible suggestions as to why VS2008 is nit-picking on it's own project template.</p>\n"},{"tags":["c++","winapi","crash"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12290123,"title":"Editing EDIT causes program crash","body":"<p>I've problem with Editing EDIT window (both by writing or sending text to it). \n<a href=\"http://pastebin.com/ZBQ6TTGN\" rel=\"nofollow\">Here's my code</a>.</p>\n\n<p>Few days ago i had problem for which solution was deleting MSG handling loop from new windows.\nEverything would be fine, but it caused another problem. I can't edit EDIT windows.\nWhen that handling loop is in new window Editing works, when not it doesn't. </p>\n\n<p>Parent window - MainWindow<br>\nChild windows - ChatWindow</p>\n\n<p>There's very few tutorials about Winapi, so sometimes i have to use code that i don't fully understand(like 2 Wndproc methods to handle window action's)</p>\n\n<p>Thank's for your time</p>\n"},{"tags":["c","visual-studio-2010","winapi","visual-c++","winsock2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":127,"score":0,"question_id":12282827,"title":"getaddrinfo (WinAPI pure C) Visual C++ 2010 Access violation Error","body":"<pre><code>BOOL sendHTTPdata(char* data){\n    //MessageBox(NULL,data, \"aaa!\",MB_ICONEXCLAMATION | MB_OK);\n\n    char  *s=malloc(sizeof(char)*5000);\n    WSADATA wsaData;\n    SOCKET ConnectSocket = INVALID_SOCKET;\n    struct addrinfo *result= NULL,\n                    *ptr = NULL,\n                    hints={0};\n    char recvbuf[DEFAULT_BUFLEN];\n    int iResult;\n    int recvbuflen = DEFAULT_BUFLEN;\n\n    // Initialize Winsock\n    iResult = WSAStartup(MAKEWORD(2,2), &amp;wsaData);\n    if (iResult != 0) {\n        //printf(\"WSAStartup failed with error: %d\\n\", iResult);\n        MessageBox(NULL,\"WSAStartup failed with error: %d\\n\", \"Error!\",MB_ICONEXCLAMATION | MB_OK);\n        return FALSE;\n    }\n\n    memset (&amp;hints, 0, (sizeof (hints)+1000));\n    hints.ai_family = AF_UNSPEC;\n    hints.ai_socktype = SOCK_STREAM;\n    hints.ai_protocol = IPPROTO_TCP;\n    // Resolve the server address and port\n    //MessageBox(NULL,\"test2\", \"Error!\",MB_ICONEXCLAMATION | MB_OK);\n\n    iResult = getaddrinfo(\"example.com\",\"80\", &amp;hints, &amp;result);\n    //return FALSE;\n    if ( iResult != 0) {\n        sprintf(s, \"getaddrinfo failed with error: %d\\n\",iResult);\n        MessageBox(NULL,s, \"Error!\",MB_ICONEXCLAMATION | MB_OK);\n        WSACleanup();\n        return FALSE;\n    }\n    MessageBox(NULL,\"test\", \"Error!\",MB_ICONEXCLAMATION | MB_OK);\n    // Attempt to connect to an address until one succeeds\n    //return FALSE;\n    for(ptr=result; ptr != NULL ;ptr=ptr-&gt;ai_next) {\n\n        // Create a SOCKET for connecting to server\n        ConnectSocket = socket(ptr-&gt;ai_family, ptr-&gt;ai_socktype, \n            ptr-&gt;ai_protocol);\n        if (ConnectSocket == INVALID_SOCKET) {\n           sprintf(s, \"socket failed with error: %ld\\n\",WSAGetLastError());\n        MessageBox(NULL,s, \"Error!\",MB_ICONEXCLAMATION | MB_OK);\n        WSACleanup();\n        return FALSE;\n        }\n\n        // Connect to server.\n        iResult = connect( ConnectSocket, ptr-&gt;ai_addr, (int)ptr-&gt;ai_addrlen);\n        if (iResult == SOCKET_ERROR) {\n            closesocket(ConnectSocket);\n            ConnectSocket = INVALID_SOCKET;\n            continue;\n        }\n        break;\n    }\n\n    freeaddrinfo(result);\n\n    if (ConnectSocket == INVALID_SOCKET) {\n       MessageBox(NULL,\"Unable to connect to server!\\n\", \"Error!\",MB_ICONEXCLAMATION | MB_OK);\n        WSACleanup();\n        return FALSE;\n\n    }\n\n    // Send an initial buffer\n    iResult = send( ConnectSocket, data, (int)strlen(data), 0 );\n    if (iResult == SOCKET_ERROR) {\n        sprintf(s,\"send failed with error: %d\\n\",WSAGetLastError());\n        MessageBox(NULL,s, \"Error!\",MB_ICONEXCLAMATION | MB_OK);\n        closesocket(ConnectSocket);\n        WSACleanup();\n        return FALSE;\n    }\n\n    //printf(\"Bytes Sent: %ld\\n\", iResult);\n    sprintf(s,\"Bytes Sent: %ld\\n\",iResult);\n    MessageBox(NULL,s, \"Error!\",MB_ICONEXCLAMATION | MB_OK);\n\n    // shutdown the connection since no more data will be sent\n    iResult = shutdown(ConnectSocket, SD_SEND);\n    if (iResult == SOCKET_ERROR) {\n        //printf(\"shutdown failed with error: %d\\n\", WSAGetLastError());\n        sprintf(s,\"shutdown failed with error: %d\\n\", WSAGetLastError());\n        MessageBox(NULL,s, \"Error!\",MB_ICONEXCLAMATION | MB_OK);\n\n        closesocket(ConnectSocket);\n        WSACleanup();\n        return 1;\n    }\n\n    // Receive until the peer closes the connection\n    do {\n\n        iResult = recv(ConnectSocket, recvbuf, recvbuflen, 0);\n        if ( iResult &gt; 0 )\n        {\n            MessageBox(NULL,recvbuf, \"success!\",MB_ICONEXCLAMATION | MB_OK);\n        }\n        else if ( iResult == 0 )\n            MessageBox(NULL,\"Connection closed\\n\", \"Error!\",MB_ICONEXCLAMATION | MB_OK);\n        else {\n            sprintf(s,\"recv failed with error: %d\\n\", WSAGetLastError());\n            MessageBox(NULL,s, \"Error!\",MB_ICONEXCLAMATION | MB_OK);\n        }\n    } while( iResult &gt; 0 );\n\n    // cleanup\n    closesocket(ConnectSocket);\n    WSACleanup();\n\n    return TRUE;\n}\n</code></pre>\n\n<p>When i compile it with Visual C++ 2010 gives Access violation error but if I compile it with Visual C++ 6.0 it works...</p>\n\n<p>this is what i can see in error log:</p>\n\n<pre><code>First-chance exception at 0x1027d22f (msvcr100d.dll) in Work Time Managment.exe: 0xC0000005: Access violation writing location 0x00130000.\nFirst-chance exception at 0xfefefefe in Work Time Managment.exe: 0xC0000005: Access violation reading location 0xfefefefe.\nFirst-chance exception at 0xfefefefe in Work Time Managment.exe: 0xC0000005: Access violation reading location 0xfefefefe.\nFirst-chance exception at 0xfefefefe in Work Time Managment.exe: 0xC0000005: Access violation reading location 0xfefefefe.\nFirst-chance exception at 0xfefefefe in Work Time Managment.exe: 0xC0000005: Access violation reading location 0xfefefefe.\nFirst-chance exception at 0xfefefefe in Work Time Managment.exe: 0xC0000005: Access violation reading location 0xfefefefe.\nFirst-chance exception at 0xfefefefe in Work Time Managment.exe: 0xC0000005: Access violation reading location 0xfefefefe.\nFirst-chance exception at 0xfefefefe in Work Time Managment.exe: 0xC0000005: Access violation reading location 0xfefefefe.\nFirst-chance exception at 0xfefefefe in Work Time Managment.exe: 0xC0000005: Access violation reading location 0xfefefefe.\nFirst-chance exception at 0xfefefefe in Work Time Managment.exe: 0xC0000005: Access violation reading location 0xfefefefe.\nFirst-chance exception at 0xfefefefe in Work Time Managment.exe: 0xC0000005: Access violation reading location 0xfefefefe.\nUnhandled exception at 0xfefefefe in Work Time Managment.exe: 0xC0000005: Access violation reading location 0xfefefefe.\nThe program '[1456] Work Time Managment.exe: Native' has exited with code 0 (0x0).\n</code></pre>\n\n<p>what is wrong... ?  why cannt work getaddrinfo in Visual C++ 2010 ???? \nThis libraries i use in my code:</p>\n\n<pre><code>#define WIN32_LEAN_AND_MEAN\n#define _WSPIAPI_COUNTOF\n#include \"windows.h\"\n#include \"winsock2.h\"\n#include \"ws2tcpip.h\"\n#include \"stdio.h\"\n#pragma comment (lib, \"Ws2_32.lib\")\n</code></pre>\n"},{"tags":["windows","winapi","directx","directx-9"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":12289673,"title":"Rendering transparent windows","body":"<p>The only method I know for rendering transparent windows is call to UpdateLayeredWindows which is terribly slow in case when I need to render result of D3D9 Render target.<br>\nI have to read render target data into system memory by calling GetRenderTargetData and \nthen i have to render it on the screen by calling UpdateLayeredWindow.</p>\n\n<p>Here <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ee890072(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/ee890072(v=vs.85).aspx</a> \nthere is a description of how to optimized rendering via \"D3D9Ex Flip Mode Present to DWM\".</p>\n\n<p>Is there some kind of similar optimization for rendering top level transparent windows ?</p>\n\n<p>Thanks </p>\n"},{"tags":["windows","winapi","gdi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12251907,"title":"GDI FrameRgn calls completing only partially","body":"<p>I'm experiencing a weird issue where a call to the GDI function FrameRgn can sometimes paint only part of the border of the region I pass it. The return value in these situations is non-zero (i.e. 'successful').</p>\n\n<p>Typically the region I'm bordering gets the correct border from the top down to some percentage of the region's height, and doesn't change from there on down.</p>\n\n<p>What could cause this? I'm thinking of some race condition (I'm hooking mouse events in my code as well) but not quite sure if that's possible.</p>\n"},{"tags":["c++","windows","winapi","filesystems","operating-system"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":3,"view_count":68,"score":0,"question_id":12284703,"title":"Access unallocated space of HDD","body":"<p>How can I access and write to the unallocated space of a Hard Disk Drive, from Windows ?</p>\n\n<p>By unallocated HDD space I'm referring to the space that remains on the HDD after partitions have been created, or just free space on the HDD that has not been assigned to a partition.</p>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12282270,"title":"Is calling DispatchMessage in win32 programs necessary?","body":"<p>Win32 programs generally have a message loop that loops calling <strong>GetMessage</strong> or <strong>PeekMessage</strong>, and then calls <strong>DispatchMessage</strong> to dispatch the message to the window proceedure of the relevant window.</p>\n\n<p>But is there any need to actually do this? Can I instead just look in the <strong>MSG</strong> object directly in the message loop and perform the actions needed there without calling <strong>DispatchMessage</strong>? I'm talking about cases where I have one single window with no other window controls, for example if the window is only used as a direct3d display window, so messages will always be directed at the only window.</p>\n\n<p>Mostly I'm just curious but also it might lead to certain aspects of my code being cleaner too.</p>\n"},{"tags":["c++","winapi","sockets","winsock2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":12281113,"title":"How to get host name from ip address or sockaddr_in structure (C++/WinAPI)?","body":"<p>How to get host name (like \"www.google.com\") from ip address or sockaddr_in/sockaddr_in6/sockaddr structure (or another) in C++ (WinAPI)? </p>\n"},{"tags":["winapi","button","resources","manifest","d"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":164,"score":3,"question_id":12244082,"title":"How can I add resources into my D executable? How to embed a manifest?","body":"<p>I try to do some gui programming in D using the WinAPI. My problem is that buttons look ugly as in <a href=\"http://stackoverflow.com/questions/4486663/why-does-my-button-look-like-its-from-1990\">the question another user asked.</a> In order to solve that I want to embed a manifest into my D application. As soon as I can include resources into my executable, I should also be able to add a manifest by hand according to <a href=\"http://msdn.microsoft.com/en-us/library/aa289524%28v=VS.71%29.aspx\" rel=\"nofollow\">this Microsoft documentation.</a> </p>\n\n<p>So my question is: How can I include a resource into my D application on Visual Studio? Is it even possible to do that? If not, are there any other ways to make buttons look nice?</p>\n"},{"tags":["c++","winapi","timer"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":186,"score":1,"question_id":12280224,"title":"How to set a timer in a console Win32 app?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/7531650/can-i-use-a-settimer-api-in-a-console-c-app\">Can I use a SetTimer() API in a console c++ app</a>  </p>\n</blockquote>\n\n\n\n<p>I am looking to create a timer in c++ ,in a console win32 application .I google it and and find most results for SetTimer() ,but as example used for window control or others .</p>\n\n<p>I need my timer to start a count ,right after the timer starts i call a function and after the timer ends ,i call an other function .I will be using threads .</p>\n\n<p>I am a rookie in c++ ,so could this be done with SetTimer function ? </p>\n\n<p>Thanks .</p>\n"},{"tags":["c++","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12279135,"title":"ERROR_INSUFFICIENT_BUFFER returned from GetAdaptersAddresses","body":"<p>Using the following code, more or less copy-pasted from the <a href=\"http://msdn.microsoft.com/library/windows/desktop/aa365915%28v=vs.85%29.aspx\" rel=\"nofollow\">MSDN example of \nGetAdaptersAddresses</a>, I get the return value 122, which means ERROR_INSUFFICIENT_BUFFER (according to <a href=\"http://msdn.microsoft.com/library/windows/desktop/ms681382%28v=vs.85%29.aspx\" rel=\"nofollow\">this system error code list</a>).</p>\n\n<pre><code>ULONG outBufLen = 150000;   // Tried for different (large) values here...\nPIP_ADAPTER_ADDRESSES pAddresses = (IP_ADAPTER_ADDRESSES *) malloc(outBufLen);\nDWORD dwRetVal = GetAdaptersAddresses(AF_INET, 0, NULL, pAddresses, &amp;outBufLen);\n// ....\nfree(pAddresses);\n</code></pre>\n\n<p>The documentation of GetAdaptersAddresses does not list ERROR_INSUFFICIENT_BUFFER as one of the expected return values. (It lists ERROR_BUFFER_OVERFLOW, which should adjust outBufLen to the needed value, but that remains unchanged).</p>\n\n<p>Using GetAdaptersInfo instead leads to the same symptoms.</p>\n\n<p>This error does not occur on my development machine, but on one virtual and one real clean Windows 7 x86 SP1 installation (added the VC++ redistributables).</p>\n\n<p>As a c++ newbie, am I doing something wrong? What could cause this error and how to fix it? =)</p>\n"},{"tags":["windows","winapi","focus"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":12279979,"title":"telling which process grabs focus","body":"<p>All of a sudden my Windows 7 / 64 shows a strange behaviour in that every few seconds some process orunderbr whatever steals the focus of the window I gave the focus (e.g. Email editing window in Thunderbird or just this editor applet in Firefox I'm just typing in).</p>\n\n<p>I'm trying to find or write an application that grabs all windows events and tells me, which process has the focus or stole it.</p>\n\n<p>--\nChristoph</p>\n"},{"tags":["winapi","hook","deviceiocontrol"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12278529,"title":"SetWindowsHookEx for DeviceIOControl, what hookid to be used?","body":"<pre><code>HHOOK WINAPI SetWindowsHookEx(\n  _In_  int idHook,\n  _In_  HOOKPROC lpfn,\n  _In_  HINSTANCE hMod,\n  _In_  DWORD dwThreadId\n);\n</code></pre>\n\n<p>On MSDN listed available idHook values, there are:</p>\n\n<ul>\n<li>WH_CALLWNDPROC </li>\n<li>WH_CALLWNDPROCRET</li>\n<li>WH_CBT WH_DEBUG </li>\n<li>WH_FOREGROUNDIDLE</li>\n<li>WH_GETMESSAGE </li>\n<li>WH_JOURNALPLAYBACK </li>\n<li>WH_JOURNALRECORD </li>\n<li>WH_KEYBOARD</li>\n<li>WH_KEYBOARD_LL </li>\n<li>WH_MOUSE </li>\n<li>WH_MOUSE_LL </li>\n<li>WH_MSGFILTER </li>\n<li>WH_SHELL</li>\n<li>WH_SYSMSGFILTER</li>\n</ul>\n\n<p>So, what idHook should be used for hook DeviceIOControl function (for console application)? Or may i'd use some other hook method?</p>\n"},{"tags":[".net","winapi","active-directory","kerberos"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12265209,"title":".net or api to set spn programatically","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/416241/query-change-spns-on-windows-domain-without-setspn\">Query/Change SPNs on Windows Domain without SetSPN</a>  </p>\n</blockquote>\n\n\n\n<p>I have a service that needs to have a service principal name (SPN) registered.  I know I can do it using the setspn.exe utility.  I'd like to know how can I programmatically register a SPN (ServicePrincipalName) with the AD, without using the setspn.exe utility. </p>\n"},{"tags":["c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12273071,"title":"When you type a character in EditBox - MessagBox c create the character","body":"<p>When you type a character in EditBox - MessagBox c create the character.\nHe can not understand - I will be grateful for the help.\n<a href=\"http://pastie.org/4665420\" rel=\"nofollow\">Code here</a></p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":120,"score":0,"question_id":12252304,"title":"std::vector and winapi windows","body":"<p>I'm trying to manage my new windows in one vector, but I've got problems with it.\nTo create a working window class I have to put </p>\n\n<pre><code>while( GetMessage( &amp; Komunikat, NULL, 0, 0 ) )\n{\n    TranslateMessage( &amp; Komunikat );\n    DispatchMessage( &amp; Komunikat );\n}\n</code></pre>\n\n<p>because of this loop windows are added to the vector after destroying them. How to deal with that?</p>\n\n<hr>\n\n<p>After deleting that loop, i have problems with handling messages i child window. When i try to write something in Edit box program crashes (i think it's something with editing them because sending text to it also creshes program)</p>\n"},{"tags":["c++","winapi","scrollbar","hook","3rd-party"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":12256358,"title":"Get Scroll Information of 3rd party Application","body":"<p>how to do that?\ni've tried setting up a Hook using $WH_SYSMSGFILTER and $WH_MSGFILTER.Then checked if the msg-id was MSGF_SCROLLBAR. That does not work..any ideas?</p>\n"},{"tags":["c++","c","winapi","native"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":117,"score":2,"question_id":12254323,"title":"Setting the current directory of a running app in C++","body":"<p>The following <a href=\"http://stackoverflow.com/a/885081/655794\">answer</a> gives a solution using C#, I was wondering what the equivalent would be if one were using only c++ (not c++\\cli)</p>\n\n<pre><code>System.IO.Directory.SetCurrentDirectory(System.AppDomain.CurrentDomain.BaseDirectory);\n</code></pre>\n\n<p>Is there anything in boost that might do the trick?</p>\n\n<p>Based on this problem I've been having: <a href=\"http://stackoverflow.com/questions/12253921/correctly-creating-and-running-a-win32-service-with-file-i-o\">Correctly creating and running a win32 service with file I/O</a></p>\n"},{"tags":["winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":123,"score":1,"question_id":886513,"title":"Get the complete username a new username","body":"<p>When using <a href=\"http://msdn.microsoft.com/en-us/library/aa370649%28VS.85%29.aspx\" rel=\"nofollow\">NetUserAdd</a> the user will be created on the local computer or as a domain account depending the role of the server where you used this function.</p>\n\n<p>I want to retrieve the complete username (LOCALCOMPUTER\\USERNAME or DOMAIN\\USERNAME) to use it remotely.</p>\n\n<p>Is there a function to do this?</p>\n"},{"tags":["c++","windows","winapi","listview","tooltip"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":89,"score":0,"question_id":12268429,"title":"C++ Listview tooltip","body":"<p>I've got a listview in report view that I'm trying to display tooltips for, different per item.</p>\n\n<p>But I can't get any tooltip to be displayed at all...</p>\n\n<p>Here's what I figured out so far:</p>\n\n<pre><code>case LVN_GETINFOTIP:\n{\n    LPNMLVGETINFOTIP GetInfoTip = (LPNMLVGETINFOTIP) lParam;\n    GetInfoTip-&gt;pszText = L\"TESTING\";\n    // What do I do now? How do I display the tooltip?\n    return 0;\n}\n</code></pre>\n\n<p>After I have received the <code>LVN_GETINFOTIP</code> message, how do I display the tooltip?</p>\n"},{"tags":["c++","python","winapi","pywin32"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":127,"score":0,"question_id":12254054,"title":"Subclass existing window with Win32","body":"<p>I am currently trying to grab all of the user input to the windows calculator app. It seems the way to do this is to use Win32 to intercept all of the keyboard and mouse inputs that are intended for the calculator window. I have read the MSDN page on subclassing a window at the link below and have done some research on subclassing.</p>\n\n<p>I have the syntax for subclassing a window, but I am not sure how to tell the program which window I am looking to subclass. </p>\n\n<p>the code that I have so far is listed below. My problem right now is that I am not sure how the variable \"hWndEdit\" is assigned. I am pretty new to Win32 programming so any help is appreciated. </p>\n\n<p>(link)\n<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms633570(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/ms633570(v=vs.85).aspx</a></p>\n\n<pre><code>WNDPROC wpOrigEditProc; \n\nwpOrigEditProc = (WNDPROC) SetWindowLong(hWndEdit,GWL_WNDPROC,(long) WndEditProc);\n\nLRESULT CALLBACK WndEditProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    switch (message) \n        {\n        case WM_CHAR:\n        case WM_KEYUP:\n        case WM_KEYDOWN:\n            if (hWnd == hWndEdit)\n                return 0;\n        break;\n        case WM_DESTROY: \n            // Remove the subclass from the edit control. \n            SetWindowLong(hWndEdit, GWL_WNDPROC, (LONG) wpOrigEditProc); \n        break;\n        default:\n            return CallWindowProc((WNDPROC ) wpOrigEditProc, hWnd, message, wParam, lParam);\n        }\n    return CallWindowProc((WNDPROC ) wpOrigEditProc, hWnd, message, wParam, lParam);\n}\n</code></pre>\n"},{"tags":["wpf","windows","winapi","gdi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12261496,"title":"PrintWindow distorts window","body":"<p>I try to capture screenshots of a window and save it to a video. I use <code>PrintWindow()</code> to capture the screenshots. When my app is running and some other window is moved over the window being captured, I see the captured window getting distorted(traces of the moved over window remains on the captured window); however the saved video doesn't have any distortions.</p>\n\n<p>I suspected a redraw of the window might be needed and tried <code>InvalidateRect()</code>, <code>UpdateWindow()</code> after <code>PrintWindow()</code>, but it wasn't of any help.</p>\n\n<p>The issue is not observed on all the systems. I had the issue on Vista system and not on Win7. I suspect it happens on systems where the window is continuously drawn when dragged and not on systems where just a black border when the window is dragged.</p>\n"},{"tags":["windows","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":574,"score":0,"question_id":176318,"title":"Way to get the SearchPath API to not look in c:\\windows?","body":"<p>Is there a way to get the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa365527%28v=vs.85%29.aspx\" rel=\"nofollow\">SearchPath</a> API to not search in c:\\windows when using the default search path (passing NULL as the first param)? I can't modify the caller to send in a specific path.</p>\n\n<p>I have a system with an application ini file in c:\\windows (which I don't want it to use, but for legacy reasons has to remain there). I put my copy of the same ini file in c:\\users\\public, and put c:\\users\\public at the front of my system path environment variable, but a call to <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa365527%28v=vs.85%29.aspx\" rel=\"nofollow\">SearchPath</a> still finds the c:\\windows version. If I delete that version, it then finds the c:\\users\\public version, so I know the path was set correctly.</p>\n"},{"tags":["c++","windows","linux","multithreading","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":126,"score":2,"question_id":12231595,"title":"C++ Simple thread with parameter (no .net)","body":"<p>I've searched the internet for a while now and found different solutions but then all don't really work or are to complicated for my use.\nI used C++ until 2 years ago so it might be a bit rusty :D</p>\n\n<p>I'm currently writing a program that posts data to an URL. It only posts the data nothing else.\nFor posting the data I use curl, but it blocks the main thread and while the first post is still running there will be a second post that should start.\nIn the end there are about 5-6 post operations running at the same time.</p>\n\n<p>Now I want to push the posting with curl into another thread. One thread per post.\nThe thread should get a string parameter with the content what to push.</p>\n\n<p>I'm currently stuck on this. Tried the WINAPI for windows but that crashes on reading the parameter. (the second thread is still running in my example while the main thread ended (waiting on system(\"pause\")).</p>\n\n<p>It would be nice to have a multi plattform solution, because it will run under windows and linux!</p>\n\n<p>Heres my current code:</p>\n\n<pre><code>#define CURL_STATICLIB\n#include &lt;curl/curl.h&gt;\n#include &lt;curl/easy.h&gt;\n#include &lt;cstdlib&gt;\n#include &lt;iostream&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string&gt;\n#if defined(WIN32)\n    #include &lt;windows.h&gt;\n#else\n    //#include &lt;pthread.h&gt;\n#endif\n\nusing namespace std;\n\nvoid post(string post) { // Function to post it to url\n    CURL *curl; // curl object\n    CURLcode res; // CURLcode object\n    curl = curl_easy_init(); // init curl\n    if(curl) { // is curl init\n        curl_easy_setopt(curl, CURLOPT_URL, \"http://10.8.27.101/api.aspx\"); // set url\n        string data = \"api=\" + post; // concat post data strings\n        curl_easy_setopt(curl, CURLOPT_POSTFIELDS, data.c_str()); // post data\n        res = curl_easy_perform(curl); // execute\n        curl_easy_cleanup(curl); // cleanup\n    } else {\n        cerr &lt;&lt; \"Failed to create curl handle!\\n\";\n    }\n}\n\n#if defined(WIN32)\n    DWORD WINAPI thread(LPVOID data) { // WINAPI Thread\n        string pData = *((string*)data); // convert LPVOID to string [THIS FAILES]\n        post(pData); // post it with curl\n    }\n#else\n    // Linux version\n#endif\n\nvoid startThread(string data) { // FUnction to start the thread\n    string pData = data; // some Test\n    #if defined(WIN32)\n        CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)thread, &amp;pData, 0, NULL); // Start a Windows thread with winapi\n    #else\n        // Linux version\n    #endif\n}\n\nint main(int argc, char *argv[]) {\n    // The post data to send\n    string postData = \"test1234567890\";\n    startThread(postData); // Start the thread\n    system(\"PAUSE\"); // Dont close the console window\n    return EXIT_SUCCESS;\n}\n</code></pre>\n\n<p>Has anyone a suggestion?</p>\n\n<p>Thanks for the help!</p>\n"},{"tags":["winapi","visual-c++","mfc","hook"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12119867,"title":"passing reference object from win32 dll to mfc dll","body":"<p>I have hooked a exported MFC DLL function using naked function.</p>\n\n<p>the definition of naked function is as follows :</p>\n\n<pre>\n\n__declspec(naked)\nstatic void __cdecl GenericHook(void* __this,class CScrollViewAccess* objParam1, class CRect& objParam2,unsigned int iParam1, unsigned long iParam2, char* szParam1,\nvoid* vParam1, class CFont* objParam3,class CFont* objParam4,\n                                class CBrush* objParam5)\n{       /*function body start*/\n\n    __asm pushad;                   /* first \"argument\", which is also used to store registers */\n    __asm push ecx;                 /* padding so that ebp+8 refers to the first \"argument\" */\n\n    /* set up standard prologue */\n    __asm push ebp;\n    __asm mov ebp, esp;\n    __asm sub esp, __LOCAL_SIZE;\n\n\n\n    if(flg == false)\n    {\n\n        //RECT* rct = reinterpret_cast(&objParam2);\n\n        hInst   =   LoadLibrary(\"C:\\\\Sample.dll\"); /// MFC Dll\n        funcPTR =   (CMYCLASS_)(((int)hInst)+((int)0x00001032));\n        funcPTR(__this,objParam2);\n\n    /* standard epilogue */\n     __asm mov esp, ebp;\n     __asm pop ebp;\n\n     __asm pop ecx;                 /* clear padding */\n     __asm popad;                   /* clear first \"argument\" */\n     __asm jmp [Trampoline];\n\n}   \n\n    /*function body end*/\n</pre>\n\n<p>The Mfc dll has following function:</p>\n\n<pre>\n\n    void CMyClass::returnRect(class CRect& objParam)\n    {\n        int width   = objParam.Width();\n        int height  = objParam.Height();\n        CPoint pt   = objParam.TopLeft();\n\n        FILE* fp;\n        char szEnter[6] = {13,0,10,0,0,0};\n        fp = fopen(\"c:\\\\LogFolder\\\\log.txt\",\"ab+\");\n        fprintf(fp,\"Width: %d Height: %d X co-ord: %d Y co-ord: %d\\n%s\",width,height,pt.x,pt.y,szEnter);\n        fclose(fp);\n    }\n\n</pre>\n\n<p>after passing CRect&amp; parameter to the MFC DLL the values logged are wrong.</p>\n\n<p>How to process the reference object?</p>\n"},{"tags":["c++","winapi","wininet"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12233004,"title":"WinInet request to a friendly URL","body":"<p>I'm trying to post an HTTP request to an HTML form that is accessible through the friendly URL address.\nBut when I post it, it says 'bad URL'.</p>\n\n<pre><code>HINTERNET hRequest = HttpOpenRequest(hConn, L\"POST\", L\"newform\",NULL,L\"http://www.site.com/add/newform/\",\n    rgpszAcceptTypes, NULL, NULL);\nDWORD error_code = GetLastError();\nif(!hRequest){}\nbool hResult = HttpSendRequestW(hRequest,NULL,NULL,NULL,NULL);\nerror_code = GetLastError(); //12005 - bad URL provided  \n</code></pre>\n\n<p>Am I doing something wrong?</p>\n"},{"tags":["c#","winforms","winapi","events","hook"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":237,"score":0,"question_id":10104668,"title":"Hiding scanner progress bar window","body":"<p>I'm making an application that needs to scan an image, from a scanner.</p>\n\n<p>I've based my application on this project\n<a href=\"http://www.codeproject.com/Articles/171666/Twain-for-WPF-Applications-Look-Ma-No-Handles\" rel=\"nofollow\">http://www.codeproject.com/Articles/171666/Twain-for-WPF-Applications-Look-Ma-No-Handles</a>\nand the scanning part works excelently.</p>\n\n<p>But here is my problem: I need to make the scan without showing any window to the user.</p>\n\n<p>The above project allows me not to to display the scanner configuration option screen to the user,\nbut it still displays the progress bar.</p>\n\n<p>The progress bar shows up (and the scan begins) when I call</p>\n\n<pre><code>DSixfer(\n    appid,\n    srcds,\n    TwDG.Image,\n    TwDAT.ImageNativeXfer,\n    TwMSG.Get,\n    ref hbitmap );\n\n[DllImport(\"twain_32.dll\", EntryPoint=\"#1\")]\nprivate static extern TwRC DSixfer( [In, Out] TwIdentity origin, [In] TwIdentity dest, TwDG dg, TwDAT dat, TwMSG msg, ref IntPtr hbitmap );\n</code></pre>\n\n<p>I searched throughout all the parameters but was unable to see any that could disable the progress bar.</p>\n\n<p>So I decided to capture the event of the progress bar window being created, and hide it (is there any better way?) but the event isn't being caught.</p>\n\n<p>First I create a temporary window, because my application will be a windows service and also because TWAIN requires a window handle to which it associates the progress bar.</p>\n\n<p>This is my code</p>\n\n<pre><code>HookProc WindowCreationProcedure = new HookProc(WindowCreationHookProc);\n\nint hHook = SetWindowsHookEx(WH_SHELL,\n        WindowCreationProcedure,\n        (IntPtr)0,\n        AppDomain.GetCurrentThreadId()\n        );\n\nSystem.Windows.Window tmpWindow = new System.Windows.Window();\ntmpWindow.WindowState = WindowState.Minimized;  //So that the window isn't showed\ntmpWindow.Show();\n</code></pre>\n\n<p>I receive the event of my tmpWindow being created but not the progress bar. What am I missing here?</p>\n\n<p>*<strong>EDIT : *</strong> Had forgotten to add my hook function in this post</p>\n\n<pre><code>private const int WH_SHELL = 10;\nprivate const int HSHELL_WINDOWCREATED = 1;\n\npublic static int WindowCreationHookProc(int nCode, IntPtr wParam, IntPtr lParam)\n{\n    if (nCode == HSHELL_WINDOWCREATED)\n    {\n        Console.WriteLine(\"WINDOW CREATED\");\n        return 1;\n    }\n    return 0;\n}\n</code></pre>\n"},{"tags":["winapi","dll","com","windows-shell"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12238997,"title":"Load DLL with ShellServiceObjectDelayLoad","body":"<p>I found out that the <code>ShellServiceObjectDelayLoad</code>-Key in <code>HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion</code> can be used to run a DLL on logon. But when I add an Value with the CLSID the corresponding DLL is not loaded on logon, <code>DllMain()</code> seems not to be called.\nCould anyone help me to solve this problem? Thanks in advance.</p>\n"},{"tags":["c","string","winapi","edit-control"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12255545,"title":"Cant retrieve the length of the text in an edit control","body":"<pre><code>INT_PTR CALLBACK ConnectDlg(HWND hDlg, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    HDC hdc = GetDC(hDlg);\n    int wmId, wmEvent;\n    static HWND hIpControl;\n    static HWND hPort;\n    static LPWSTR lpIPAddress = (LPWSTR)malloc(sizeof(LPWSTR));\n    static LPWSTR lpPort       = (LPWSTR)malloc(sizeof(LPWSTR));\n    static char* IPArgtoFn;\n    static size_t IPAddressLength; \n    static size_t PortLength;\n    static POINT pt;\n    hIpControl = GetDlgItem(hDlg, IDC_IPADDRESS1);\n    hPort      = GetDlgItem(hPort, IDC_EDIT2);\n    switch (message)\n    {\n    case WM_INITDIALOG:\n        {\n\n        return (INT_PTR)TRUE;\n        break;\n        }\n    case WM_COMMAND:\n        {\n\n        wmId    = LOWORD(wParam);\n        wmEvent = HIWORD(wParam);\n        switch (wmId)\n            {\n            case IDCANCEL:\n                EndDialog(hDlg, wmId);\n                break;\n            case IDCONNECT:\n                IPAddressLength = GetWindowTextLength(hIpControl) + 1;\n                PortLength = SendMessage(hPort, WM_GETTEXTLENGTH, 0, 0);\n                GetWindowText(hIpControl, lpIPAddress, IPAddressLength);\n\n                pt.x = 10; pt.y = 10;\n                wcstombs(IPArgtoFn, lpIPAddress, IPAddressLength);\n                //TextOut(hdc, 10, 10, lpIPAddress , IPAddressLength);\n                mySocket.ConnectToServer(IPArgtoFn, (int)lpPort, hdc, pt); \n\n                return (INT_PTR)FALSE;\n                break;\n\n\n            default:\n                return DefWindowProc(hDlg, message, wParam, lParam);\n                break;\n            }\n        }\n    }\n    return (INT_PTR)FALSE;\n    }\n</code></pre>\n\n<p>I know I have the right control selected. Its identifier is IDC_EDIT2 and I know that is right. But whenever I try to retrieve the length of the edit control and save it to the variable PortLength, the value is always 0 when I debug it. I have already tried using GetWindowTextLength with works fine with the IP control but when I use it with the edit control, the length is always 0 no matter how long of a string I enter in the box.</p>\n"},{"tags":["c","winapi","ip-address"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":12240363,"title":"Retrieving Text from IP Address control in c","body":"<pre><code>    SendMessage(hIpControl, IPM_GETADDRESS, 0, (LPARAM)lpIPAddress);\n    TextOut(hdc, 10, 10, (LPCWSTR)lpIPAddress , 20);\n//where static LPDWORD lpIPAddress = (LPDWORD)malloc(sizeof(LPDWORD));\n</code></pre>\n\n<p>and \nhIpControl is a handle to an IP control. When I run this the Text Out just displays random chinese symbols and stuff. How can I safely retrieve the IP address and store it in a string. I need to get it in a string like: \"192.168.1.4\" in order for my app to work.</p>\n"},{"tags":["c","winapi","hook","mouseevent","mousemove"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":72,"score":-1,"question_id":12253585,"title":"Use WH_MOUSE globally without DLL","body":"<p>I have a code to display a part of screen when mouse moves. But the WH_MOUSE doesn't work. I need to change <code>GetModuleHandle(0), 0</code> to <code>hInst, GetCurrentThreadId()</code>.</p>\n\n<p>But then the application will work only when the mouse is over the application itself.</p>\n\n<p>I want it global and I tried WH_MOUSE_LL, it is slower then WH_MOUSE.</p>\n\n<p>Is that possible to use WH_MOUSE globally without DLL?</p>\n\n<pre><code>void SetHook()\n{\n    gMouseHook = SetWindowsHookEx(WH_MOUSE, MouseProc, GetModuleHandle(0), 0);\n}   \n\n//================================================================================\n// Mouse Hook\n\nstatic LRESULT CALLBACK MouseProc(int nCode, WPARAM wParam, LPARAM lParam)\n{\n    if (nCode &lt; 0) {\n    return CallNextHookEx(gMouseHook, nCode, wParam, lParam);\n    }\n\n    if (wParam == WM_MOUSEMOVE) {\n\n    MOUSEHOOKSTRUCT *mouseInfo = (MOUSEHOOKSTRUCT*)lParam;\n\n    int x = mouseInfo-&gt;pt.x;\n    int y = mouseInfo-&gt;pt.y;\n\n    PrintScreen(x, y);\n    }\n\n    return CallNextHookEx(gMouseHook, nCode, wParam, lParam);\n}\n</code></pre>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":12252864,"title":"winapi - SetLayeredWindowAttributes with LWA_COLORKEY only sets pixels to either fully opaque or fully transparent?","body":"<p>The border of my frame is white (0xfffffffe). The interior of my frame is black (0xff000000).\nI want to make the border translucent (alpha value of 100), and the interior opaque. Obviously, I've used <code>SetLayeredWindowAttributes</code> to do this, but it's not working.</p>\n\n<p>This variation: <code>SetLayeredWindowAttributes(RGB(0xxff, 0xff, 0xfe), 100, LWA_COLORKEY)</code> sets the border to alpha of 100, but the interior as completely transparent.</p>\n\n<p>This variation: <code>SetLayeredWindowAttributes(RGB(0xxff, 0xff, 0xfe), 100, LWA_COLORKEY | LWA_ALPHA)</code> sets the interior to an alpha of 100, but sets the border as completely transparet.</p>\n\n<p>How can I make the interior opaque and the border transparent? I can't use multiple top-level windows to achieve the affect in this situation. </p>\n"},{"tags":["python","internet-explorer","winapi","automation","pamie"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12254525,"title":"PAMIE: get hwnd of IE window","body":"<p>I'm using PAMIE, and I need the window handle of the IE window corresponding to the PAMIE instance. How would I go about getting it?</p>\n"}]}
{"total":13828,"page":13,"pagesize":100,"questions":[{"tags":["python","winapi","pywin32"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12253858,"title":"EnumChildWindows not working in pywin32","body":"<p>I want to get the children of a particular IE instance to see if there are any popups.</p>\n\n<p>I've made an .html page that pops up a window. The title of the popup is \"Message from webpage\", as it always is for this version of IE.</p>\n\n<p>I can get the parent from the child window:</p>\n\n<pre><code>&gt;&gt;&gt; child_handle = 15208472\n&gt;&gt;&gt; win32gui.GetWindowText(child_handle)\n'Message from webpage'\n&gt;&gt;&gt; win32gui.GetParent(child_handle)\n33230502\n&gt;&gt;&gt; parent_handle = 33230502\n&gt;&gt;&gt; win32gui.GetWindowText(parent_handle)\n'pop-up example - Windows Internet Explorer'\n</code></pre>\n\n<p>However, it seems that i can't get the child window from the parent:</p>\n\n<pre><code>&gt;&gt;&gt; def all_ok(hwnd, param): return True\n&gt;&gt;&gt; win32.EnumChildWindows(parent_handle, all_ok, None)\n&gt;&gt;&gt;\n</code></pre>\n\n<p>Why is this?</p>\n"},{"tags":["c++","c","winapi","service"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":112,"score":4,"question_id":12253921,"title":"Correctly creating and running a win32 service with file I/O","body":"<p>I've written a very simple service application based on this <a href=\"http://code.msdn.microsoft.com/windowsdesktop/CppWindowsService-cacf4948\" rel=\"nofollow\">code example</a>. </p>\n\n<p>The application as part of its normal running assumes there exists a file in the directory it is found, or in its execution path.</p>\n\n<p>When I 'install' the service and then subsequently 'start' the service from the service manager in control panel. The application fails because it can't find the file to open and read from (even though the file is in the same directory as the installed executable).</p>\n\n<p>My question is when a windows service is run, which is the expected running path supposed to be?</p>\n\n<p>When calling 'CreateService' there only seems to be a path parameter for the binary, not for execution. Is there someway to indicate where the binary should be executed from?</p>\n\n<p>I've tried this on windows vista and windows 7. Getting the same issues.</p>\n"},{"tags":["python","winapi","pywin32"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12254032,"title":"win32: child window not found in child's parent's children","body":"<p>I have an Internet explorer page which generated a pop-up. I can get the parent from the pop-up window's handle:</p>\n\n<pre><code>&gt;&gt;&gt; child.handle\n15208472\n&gt;&gt;&gt; win32gui.GetParent(child.handle)\n33230502\n</code></pre>\n\n<p>But I can't find the child's handle by using <code>EnumChildWindows</code>:</p>\n\n<pre><code>&gt;&gt;&gt; win32gui.EnumChildWindows(win32gui.GetParent(child.handle), lambda hwnd,p: child_handles.append(hwnd), None)\n&gt;&gt;&gt; len(child_handles)\n39\n&gt;&gt;&gt; child.handle in child_handles\nFalse\n</code></pre>\n\n<p>I've done this recursively as well (getting the children of all the children) and still no child handle to be found. Why might this be the case?</p>\n"},{"tags":["windows","winapi","console","io-redirection"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12251621,"title":"In Windows, how to get a standard device handle for a different console process?","body":"<p>I know I can call the <code>AttachConsole</code> and  <code>GetStdHandle</code> kernel32 functions to access the console screen buffers of a different console process, but if this process has its input/output/error redirected to a file or device, how can I get handles to those redirected locations instead?</p>\n\n<p>To put it clear: I don't have control on the application I'm trying to attach to, which is provided by a third party, so my chances with IPC are little.</p>\n"},{"tags":["c++","winapi","hook"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":12252651,"title":"Right ALT sends two virtual key codes","body":"<p>In my hook procedure (for keyboard) when I click right alt it sends me two codes on press and two on release:</p>\n\n<p>The code:</p>\n\n<pre><code>LRESULT CALLBACK Recorder::keyboardHookProcedure( int code, WPARAM wParam, LPARAM lParam ) {\n    if( code &lt; 0 )\n        return CallNextHookEx( m_mouseHook, code, wParam, lParam );   \n\n    DWORD _vkCode = reinterpret_cast&lt;KBDLLHOOKSTRUCT*&gt;( lParam )-&gt;vkCode;\n\n    qDebug( \"vkCode: %d, wparam: %d, lparam: %d\", _vkCode, wParam, lParam );\n\n    return CallNextHookEx( 0, code, wParam, lParam );\n}\n</code></pre>\n\n<p>on pressing</p>\n\n<pre><code>vkCode: 162, wparam: 260, lparam: 3398032\nvkCode: 165, wparam: 260, lparam: 3398032\n</code></pre>\n\n<p>on releasing</p>\n\n<pre><code>vkCode: 162, wparam: 257, lparam: 3398032\nvkCode: 165, wparam: 257, lparam: 3398032\n</code></pre>\n\n<p>moreover, notice that when you press the key it sends it as <strong>WM_SYSKEYDOWN (260)</strong>, but when you release it the wParam is <strong>WM_KEYUP (257)</strong>. What the...? Why does it work in such way?</p>\n"},{"tags":["windows","winapi","opengl","assembly","nasm"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12251861,"title":"What's wrong with my NASM OpenGL code?","body":"<p>I'm trying to write a simple program using OpenGL in NASM using NASMX. I have a working version of this code in C which works. The assembly version does not really work. It compiles and runs but it only shows a black screen instead of black screen with a white pixel :) <code>ChangeDisplaySettingsA</code> does not seem to change the display settings.</p>\n\n<p>I'd rather not use NASMX but I lack the knowledge on how to do this without NASMX.</p>\n\n<p>I guess there is something wrong with how I use the parameters. So what do you think? What's wrong with this code? A link to a working code sample would be great!</p>\n\n<pre><code>%include 'nasmx-1.0\\inc\\nasmx.inc'\n%include 'nasmx-1.0\\inc\\win32\\windows.inc'\n%include 'nasmx-1.0\\inc\\win32\\kernel32.inc'\n%include 'nasmx-1.0\\inc\\win32\\user32.inc'\n%include 'nasmx-1.0\\inc\\win32\\gdi32.inc'\n%include 'nasmx-1.0\\inc\\win32\\opengl32.inc'\n%include 'nasmx-1.0\\inc\\win32\\msvcrt.inc'\n\nentry entrypoint\n\nXRES    equ     1024\nYRES    equ     786\n\n[section .text]\nproc    entrypoint, ptrdiff_t argcount, ptrdiff_t cmdline\nlocals none\n    invoke  ChangeDisplaySettingsA, ptrdiff_t [dmScreenSettings], 0x00000004\n    invoke  CreateWindowExA, 0, szEdit, 0, WS_POPUP + WS_VISIBLE, 0, 0, XRES, YRES, 0, 0, 0, 0\n    invoke  GetDC, eax\n    mov     ptrdiff_t [hDc], eax\n    invoke  ChoosePixelFormat, ptrdiff_t [hDc], pfd\n    invoke  SetPixelFormat, ptrdiff_t [hDc], eax, pfd\n    invoke  wglCreateContext, ptrdiff_t [hDc]\n    invoke  wglMakeCurrent, ptrdiff_t [hDc], eax\n    invoke  ShowCursor, FALSE\n    invoke  glViewport, 0, 0, XRES, YRES\n    invoke  glMatrixMode, 0x1701\n    invoke  glLoadIdentity\n    invoke  glOrtho, 0, XRES, 0, YRES, -1, 1\n    invoke  glMatrixMode, 0x1700\n    invoke  glLoadIdentity\n.intro_loop:\n    invoke  glColor3ub, 255, 255, 255\n    invoke  glBegin, 0x0000\n    invoke  glVertex2i, 100, 100\n    invoke  glEnd\n    invoke  SwapBuffers, ptrdiff_t [hDc]\n    invoke  PeekMessageA, 0, 0, 0, 0, PM_REMOVE\n    invoke  GetAsyncKeyState, VK_ESCAPE\n    cmp     eax, dword 0\n    je      .intro_loop\n    invoke  ExitProcess, 0\nendproc\n\n[section .bss]\n    hDc:            reserve(ptrdiff_t) 1\n\n[section .data]\n    szEdit:         declare(NASMX_TCHAR) NASMX_TEXT(\"edit\"), 0x0\n    NASMX_ISTRUC pfd, PIXELFORMATDESCRIPTOR\n        NASMX_AT nSize, 0\n        NASMX_AT nVersion, 1\n        NASMX_AT dwFlags, 33\n        NASMX_AT iPixelType, 32\n        NASMX_AT cColorBits, 0\n        NASMX_AT cRedBits, 0\n        NASMX_AT cRedShift, 0\n        NASMX_AT cGreenBits, 0\n        NASMX_AT cGreenShift, 0\n        NASMX_AT cBlueBits, 0\n        NASMX_AT cBlueShift, 0\n        NASMX_AT cAlphaBits, 0\n        NASMX_AT cAlphaShift, 0\n        NASMX_AT cAccumBits, 0\n        NASMX_AT cAccumRedBits, 0\n        NASMX_AT cAccumGreenBits, 0\n        NASMX_AT cAccumBlueBits, 0\n        NASMX_AT cAccumAlphaBits, 32\n        NASMX_AT cDepthBits, 0\n        NASMX_AT cStencilBits, 0\n        NASMX_AT cAuxBuffers, 0\n        NASMX_AT iLayerType, 0\n        NASMX_AT bReserved, 0\n        NASMX_AT dwLayerMask, 0\n        NASMX_AT dwVisibleMask, 0\n        NASMX_AT dwDamageMask, 0\n    NASMX_IENDSTRUC\n    NASMX_ISTRUC dmScreenSettings, DEVMODE\n        NASMX_AT dmDeviceName, \"\"\n        NASMX_AT dmSpecVersion, 0\n        NASMX_AT dmDriverVersion, 0\n        NASMX_AT dmSize, 156\n        NASMX_AT dmDriverExtra, 0\n        NASMX_AT dmFields, 1572864\n        NASMX_AT dmOrientation, 0\n        NASMX_AT dmPaperSize, 0\n        NASMX_AT dmPaperiLength, 0\n        NASMX_AT dmPaperWidth, 0\n        NASMX_AT dmScale, 0\n        NASMX_AT dmCopies, 0\n        NASMX_AT dmDefaultSource, 0\n        NASMX_AT dmPrintQuality, 0\n        NASMX_AT dmColor, 0\n        NASMX_AT dmDuplex, 0\n        NASMX_AT dmYResolution, 0\n        NASMX_AT dmTTOption, 0\n        NASMX_AT dmCollate, 0\n        NASMX_AT dmFormName, \"\"\n        NASMX_AT dmUnusedPadding, 0\n        NASMX_AT dmBitsPerPel, 0\n        NASMX_AT dmPelsWidth, XRES\n        NASMX_AT dmPelsHeight, YRES\n        NASMX_AT dmDisplayFlags, 0\n        NASMX_AT dmDisplayFrequency, 0\n        NASMX_AT dmICMMethod, 0\n        NASMX_AT dmICMIntent, 0\n        NASMX_AT dmMediaType, 0\n        NASMX_AT dmDitherType, 0\n        NASMX_AT dmReserved1, 0\n        NASMX_AT dmReserved2, 0\n        NASMX_AT dmPanningWidth, 0\n        NASMX_AT dmPanningHeight, 0\n    NASMX_IENDSTRUC\n</code></pre>\n"},{"tags":[".net","winapi","visual-c++","clr"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":5089,"score":2,"question_id":1062962,"title":"'System::String ^' to 'LPCWSTR'","body":"<p>I want to convert <code>System::String ^</code> to <code>LPCWSTR</code>.</p>\n\n<p>for </p>\n\n<pre><code>FindFirstFile(LPCWSTR,WIN32_FIND_DATA); \n</code></pre>\n\n<p>Please help.</p>\n"},{"tags":["c++","c","windows","winapi","disk-partitioning"],"answer_count":3,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":1409,"score":5,"question_id":4042212,"title":"Obtain a list of partitions on Windows","body":"<h2>Goal</h2>\n\n<p>I'm porting a filesystem to Windows, and am writing a more Windows-like interface for the mounter executable. Part of this process is letting the user locate a partition and pick a drive letter. Ultimately the choice of partition has to result in something I can open using <code>CreateFile()</code>, <code>open()</code>, <code>fopen()</code> or similar.</p>\n\n<h2>Leads</h2>\n\n<p>Windows seems to revolve around the concept of volumes, which don't seem quite analogous to disks, and only occur for already mounted filesystems.</p>\n\n<p>Promising leads I've had include:</p>\n\n<ul>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/aa365174%28v=VS.85%29.aspx\" rel=\"nofollow\"><code>IOCTL_DISK_GET_DRIVE_LAYOUT_EX</code></a> </li>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/aa363858%28v=VS.85%29.aspx\" rel=\"nofollow\">Physical Disks and Volumes</a></li>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/cc542456%28VS.85%29.aspx\" rel=\"nofollow\">Displaying Volume Paths</a></li>\n</ul>\n\n<p>However these all end in volumes or offsets thereof, not the <code>/dev/sda1</code> partition-specific-style handle I'm after.</p>\n\n<p><a href=\"http://stackoverflow.com/questions/327718/how-to-list-physical-disks\">This question</a> is after a very similar thing, I considered a bounty until I observed the OP is after physical disk names, not partitions. <a href=\"http://stackoverflow.com/questions/327718/how-to-list-physical-disks/350304#350304\">This answer</a> contains a method to brute force partition names, I'd like to avoid that (or see documentation containing bounds for the possible paths).</p>\n\n<h2>Question</h2>\n\n<p>I'd like:</p>\n\n<ul>\n<li>Correct terminology and documentation for unmounted partitions in Windows.</li>\n<li>An effective and documented method to reliably retrieve all available partitions.</li>\n<li>The closest fit to the partition file abstraction as available in Linux, wherein all IO is bound to the appropriate area of the disk for the partition opened.</li>\n</ul>\n\n<h2>Update0</h2>\n\n<p>While the main goal is still opening raw partitions, it appears the solution may involve first acquiring a handle to each disk drive, and then using that in turn to acquire each partition. How to enumerate all the disk drives (even those without mounted volumes on them already) is required.</p>\n"},{"tags":["c++","multithreading","winapi","privileges"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12251060,"title":"Invalid HANDLE from AfxBeginThread","body":"<p>I am writing a multi-threaded networked application, and I'm using a separate thread with a blocking socket to receive data asynchronously from the server.</p>\n\n<p>When I need to shutdown the socket I use a function which checks if the receive thread is still running and if it is calls <code>TerminateThread</code> to end it as follows:</p>\n\n<pre><code>DWORD dwExitCode = 0;\nif( GetExitCodeThread( theApp.m_hRecvThread, &amp;dwExitCode ) &amp;&amp; dwExitCode == STILL_ACTIVE )\n     TerminateThread( theApp.m_hRecvThread, 0 );\n</code></pre>\n\n<p>However, <code>GetExitCodeThread</code> returns <code>FALSE</code>, and when polling <code>GetLastError()</code> it returns 6 (<code>ERROR_INVALID_HANDLE</code>). Which suggests that I do not have the <code>THREAD_QUERY_INFORMATION</code> or <code>THREAD_QUERY_LIMITED_INFORMATION</code> access rights on the <code>m_hRecvThread</code> handle.</p>\n\n<p>My <code>m_hRecvThread</code> handle is set when creating the thread like so:</p>\n\n<pre><code>m_hRecvThread = AfxBeginThread( RecvThread, hWndMainFrame );\n</code></pre>\n\n<p>This successfully creates the thread, and the thread is running fine and exhibiting expected functionality. The <code>TerminateThread</code> and <code>GetExitCodeThread</code> are being called from the same thread which created the Receive thread in the first place.</p>\n\n<blockquote>\n  <p>My understanding was that when using <code>AfxBeginThread</code>, the <code>HANDLE</code> returned had <code>THREAD_ALL_ACCESS</code> access rights, is this the case, and if so, why am I still getting <code>ERROR_INVALID_HANDLE</code>?</p>\n</blockquote>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c++","winapi","dll","c++11","std"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":12232093,"title":"Does std::lock_guard increment the dll reference counter? (LoadCount)","body":"<p>I have come across a weird thing while using the std::lock_guard.\nNOTE:  I am using MSVS 2012 and the std::lock_guard as declared in the mutex header from the new c++11 headers that are included and shipped in this version. </p>\n\n<p>The following is code to replicate this behaviour, and it seems like using this function increments the dll LoadCount for some reason, my question is if anyone can explain why, and is there a better lock function I can use that wont mess with the LoadCount?</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;mutex&gt;\n\ntypedef struct _PEB_LDR_DATA {\nULONG Length;\nBOOLEAN Initialized;\nPVOID SsHandle;\nLIST_ENTRY InLoadOrderModuleList;\nLIST_ENTRY InMemoryOrderModuleList;\nLIST_ENTRY InInitializationOrderModuleList;\n} PEB_LDR_DATA, *PPEB_LDR_DATA;\n\n\ntypedef struct _LSA_UNICODE_STRING {\n    USHORT Length;\n    USHORT MaximumLength;\n    PWSTR  Buffer;\n} LSA_UNICODE_STRING, *PLSA_UNICODE_STRING;\ntypedef LSA_UNICODE_STRING UNICODE_STRING, *PUNICODE_STRING;\n\ntypedef struct _RTL_USER_PROCESS_PARAMETERS {\n   BYTE           Reserved1[16];\n   PVOID          Reserved2[10];\n   UNICODE_STRING ImagePathName;\n   UNICODE_STRING CommandLine;\n} RTL_USER_PROCESS_PARAMETERS, *PRTL_USER_PROCESS_PARAMETERS;\n\ntypedef VOID (NTAPI *PPS_POST_PROCESS_INIT_ROUTINE) (VOID);\n\ntypedef struct _PEB {\n    BYTE                          Reserved1[2];\n    BYTE                          BeingDebugged;\n    BYTE                          Reserved2[1];\n    PVOID                         Reserved3[2];\n    PPEB_LDR_DATA                 Ldr;\n    PRTL_USER_PROCESS_PARAMETERS  ProcessParameters;\n    BYTE                          Reserved4[104];\n    PVOID                         Reserved5[52];\n    PPS_POST_PROCESS_INIT_ROUTINE PostProcessInitRoutine;\n    BYTE                          Reserved6[128];\n    PVOID                         Reserved7[1];\n    ULONG                         SessionId;\n} PEB, *PPEB;\ntypedef struct _PROCESS_BASIC_INFORMATION\n{\n    PVOID Reserved1;\n    PPEB PebBaseAddress;\n    PVOID Reserved2[2];\n    ULONG_PTR UniqueProcessId;\n    PVOID Reserved3;\n} PROCESS_BASIC_INFORMATION;\ntypedef enum _PROCESSINFOCLASS\n{\n    ProcessBasicInformation = 0,\n} PROCESSINFOCLASS, *PPROCESSINFOCLASS;\n\ntypedef struct _LDRP_CSLIST\n{\n    PSINGLE_LIST_ENTRY Tail;\n} LDRP_CSLIST, *PLDRP_CSLIST;\ntypedef enum _LDR_DDAG_STATE\n{\nLdrModulesMerged = -5,\nLdrModulesInitError = -4,\nLdrModulesSnapError = -3,\nLdrModulesUnloaded = -2,\nLdrModulesUnloading = -1,\nLdrModulesPlaceHolder = 0,\nLdrModulesMapping = 1,\nLdrModulesMapped = 2,\nLdrModulesWaitingForDependencies = 3,\nLdrModulesSnapping = 4,\nLdrModulesSnapped = 5,\nLdrModulesCondensed = 6,\nLdrModulesReadyToInit = 7,\nLdrModulesInitializing = 8,\nLdrModulesReadyToRun = 9\n} LDR_DDAG_STATE;\ntypedef struct _LDR_DDAG_NODE\n{\nLIST_ENTRY Modules;\nPVOID ServiceTagList;\nULONG LoadCount;//this is where its located in windows 8\nULONG ReferenceCount;\nULONG DependencyCount;\nunion\n{\n    LDRP_CSLIST Dependencies;\n    SINGLE_LIST_ENTRY RemovalLink;\n};\nLDRP_CSLIST IncomingDependencies;\nLDR_DDAG_STATE State;\nSINGLE_LIST_ENTRY CondenseLink;\nULONG PreorderNumber;\nULONG LowestLink;\n} LDR_DDAG_NODE, *PLDR_DDAG_NODE;\ntypedef struct _LDR_MODULE {\nLIST_ENTRY InLoadOrderModuleList;\n    LIST_ENTRY InMemoryOrderModuleList;\n    LIST_ENTRY InInitializationOrderModuleList;\n    PVOID BaseAddress;\n    PVOID EntryPoint;\n    ULONG SizeOfImage;\n    UNICODE_STRING FullDllName;\n    UNICODE_STRING BaseDllName;\n    ULONG Flags;\n    USHORT obsoleteLoadCount;//in windows 8 this is obsolete\n    USHORT TlsIndex;//but we can still use it in win 7 and below\nunion\n{\n        LIST_ENTRY HashLinks;\n        struct CheckPtr\n        {\n            PVOID SectionPointer;\n            ULONG CheckSum;\n        };\n};\nunion\n{\n        ULONG TimeDateStamp;\n        PVOID LoadedImports;\n};\nstruct _ACTIVATION_CONTEXT *EntryPointActivationContext;\nPVOID PatchInformation;\nPLDR_DDAG_NODE DdagNode;\n} LDR_MODULE, *PLDR_MODULE;\n\ntypedef NTSTATUS (__stdcall *pfnZwQueryInformationProcess) (HANDLE, PROCESSINFOCLASS,\n    PVOID, ULONG, PULONG);\npfnZwQueryInformationProcess ZwQueryInformationProcess;\n\nDWORD GetModuleLoadCount(HMODULE hmod)\n{\n    HMODULE hModule = LoadLibrary(\"ntdll.dll\");\n    if(hModule==NULL)\n       return NULL;\n    ZwQueryInformationProcess = (pfnZwQueryInformationProcess) GetProcAddress(hModule, \n        \"ZwQueryInformationProcess\");\n    if (ZwQueryInformationProcess == NULL) {\n        FreeLibrary(hModule)\n        return NULL;    // failed to get PEB\n    }\n\nPROCESS_BASIC_INFORMATION pbi;\n    PROCESSINFOCLASS pic = ProcessBasicInformation;\n    if (ZwQueryInformationProcess(GetCurrentProcess(), pic, &amp;pbi, sizeof(pbi), NULL) \n        != STATUS_SUCCESS)\n    {\n        // ZwQueryInformationProcess failed...\n        FreeLibrary(hModule);\n        return NULL;\n    }\n    FreeLibrary(hModule);\n\nLDR_MODULE *peb_ldr_module = (LDR_MODULE \n        *)pbi.PebBaseAddress-&gt;Ldr-&gt;InLoadOrderModuleList.Flink;\nwhile((peb_ldr_module = (LDR_MODULE \n        *)peb_ldr_module-&gt;InLoadOrderModuleList.Flink)!=(LDR_MODULE \n        *)pbi.PebBaseAddress-&gt;Ldr-&gt;InLoadOrderModuleList.Blink) {\n    if(peb_ldr_module-&gt;BaseAddress==hmod) {\n        //well this actualy works in windows 8...\n        //and probably vista with aero enabled as well...\n        //anyway if it is obsolete its always 6\n        //so we can if it out like this...\n        if(peb_ldr_module-&gt;obsoleteLoadCount==6)\n            return peb_ldr_module-&gt;DdagNode-&gt;LoadCount;\n        else\n            return peb_ldr_module-&gt;obsoleteLoadCount;\n    }\n}\nif(peb_ldr_module-&gt;BaseAddress==hmod) {\n    if(peb_ldr_module-&gt;obsoleteLoadCount==6)\n        return peb_ldr_module-&gt;DdagNode-&gt;LoadCount;\n    else\n        return peb_ldr_module-&gt;obsoleteLoadCount;\n}\n}\n\nmutable std::mutex g_logMutex;\nvoid test()//test is just a function inside of my dll\n{          //which is injected and running under low privileges in internet explorer as\n           //an addon, I dont think that matters, but i dont want to leave any info out \n           //that might help answer my question.\nint loadcount = GetModuleLoadCount((HMODULE)gModule);//its 1 here\n    std::lock_guard&lt;std::mutex&gt; lock(g_logMutex);\nloadcount = GetModuleLoadCount((HMODULE)gModule);//now its 2\n}\n</code></pre>\n"},{"tags":["winapi","visual-c++","system-programming","disk-partitioning"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":174,"score":0,"question_id":2646231,"title":"How to get Hidden Partitions in the Harddisk in VC++?","body":"<p>How to get Hidden Partitions in the Harddisk in VC++?</p>\n"},{"tags":["winapi","gdi+","gdi","rgb","pixel"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":12247821,"title":"fast way to get RGB value of a pixel (need this even when one move mouse)","body":"<p>From <a href=\"http://stackoverflow.com/questions/12220691/need-a-winapi-function-with-the-ability-to-print-screen#comment16373458_12220691\">Need a winapi function with the ability to print screen</a>, I know how to print a small rectangle containing the cursor to a window with zoom in. It uses <code>StretchBlt</code> function (not <code>BitBlt</code>) which is fast in the sense that <code>\"no delay when I move mouse (if mouse is moved, it calls StretchBlt)</code>\". I have to mentioned that I used mouse hook <code>WH_MOUSE_LL</code> to detect mouse events in the whole screen.</p>\n\n<p>But I also want to display the RGB value of the pixel that the cursor is over. I tried <code>GetPixel</code> but it is slow (in above sense). I also tried the <code>BitBlt + GetDIBits</code> method, but calling BitBlt each time the mouse is moved is very slow (mouse movement delay). The calling of BitBlt is:</p>\n\n<pre><code>BitBlt(memDC, 0, 0, Screen_dx, Screen_dy, hdcScreen, 0, 0, SRCCOPY);\n</code></pre>\n\n<p>I have to call <code>BitBlt</code> each time I move the mouse since the content in screen may changed after the bitmap is created. If using <code>GetPixel</code>, I don't have to worry about if the screen content is changed.</p>\n\n<p>I wonder, using winapi only (no DirectX, ..., etc), if there is a fast way to get the RGB value of a pixel, even I want to update this information when I move the mouse.</p>\n\n<p>Updated: OK, GetPixel is not that slow. But when I <code>use GetPixel</code> + <code>StretchBlt</code> (to print a small rectange into my custom window), it is slow. But only one of these task is fine. Maybe two such tasks are too heavy.</p>\n"},{"tags":["winapi","type-conversion","wstring"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12247887,"title":"assign a LPWSTR to an existing wstring","body":"<p>I am looking for a way to copy the content of a LPWSTR to an existing wstring.\nI've found a lot of examples to do the reverse but I am still looking for a way to do it.</p>\n\n<p>Thanks</p>\n"},{"tags":["c++","windows","winapi","hook"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":89,"score":1,"question_id":12242907,"title":"GET_X_LPARAM gives negative value","body":"<p>I have created a hook for mouse. I wanted to get mouse click coordinates, but the GET_X_LPARAM() gives me negative value (and always the same when clicking on different places). My problem becomes solved with GetCursorPos(), but I wonder why it is not working with GET_X_LPARAM/GET_Y_LPARAM. Here's the code:</p>\n\n<pre><code>LRESULT CALLBACK Recorder::mouseHook( int code, WPARAM wParam, LPARAM lParam ) {\n if( code &lt; 0 )\n     return CallNextHookEx( m_mouseHook, code, wParam, lParam );   \n\n switch( wParam ) {\n    case WM_LBUTTONDOWN:{\n        int _hereIsANegativeNumber = GET_X_LPARAM( lParam );\n        break;}\n }\n\n return CallNextHookEx( 0, code, wParam, lParam );\n}\n</code></pre>\n\n<p>This is how I set the hook:</p>\n\n<pre><code>m_mouseHook = SetWindowsHookEx( WH_MOUSE_LL, &amp;mouseHook, GetModuleHandle( NULL ), 0 );\n</code></pre>\n"},{"tags":["winapi","vb6"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":120,"score":2,"question_id":11993106,"title":"Position of Text in a TextBox","body":"<p>Hi I have a textbox containing some text. I am looking to replicate the red spelling mistake squiggle type behaviour.</p>\n\n<p>Using WinAPI I can</p>\n\n<ul>\n<li>draw the squiggle between 2 points.  </li>\n<li>find out the height and width of\nthe word to be \"squiggled\".</li>\n</ul>\n\n<p>What is the api call (or perhaps the methodology if it is more than a single api call) to find the position of that word in the text box so that I can position the sqiggle undeneath it.</p>\n\n<p>Also, what are the messages I need to trap to ensure that the squiggle is redrawn. I'm currently only using WM_PAINT, which obviously isn't good enough.</p>\n\n<p>EDIT (3 Sept 2012):\nFYI, Here's where I got to so far. Needs a lot of refining but shows basic principles</p>\n\n<p><a href=\"https://gist.github.com/3607272\" rel=\"nofollow\">https://gist.github.com/3607272</a></p>\n\n<p>Many thx</p>\n\n<p>S</p>\n"},{"tags":["c++","c","windows","winapi","win32-process"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":383,"score":1,"question_id":9683764,"title":"Why is RemoveDirectory function not deleting the top most folder?","body":"<p>refer: codeguru.com/forum/showthread.php?t=239271  </p>\n\n<p>When using the function below to delete folders, all folders, subfolders and files are getting deleted except for the top most folder. Say for the path <code>c:\\folder1\\folder2</code> every thing under <code>folder2</code> is deleted except for <code>folder2</code>.</p>\n\n<pre><code>BOOL DeleteDirectory(const TCHAR* sPath)  \n{  \n    HANDLE hFind; // file handle\n    WIN32_FIND_DATA FindFileData;\n\n    TCHAR DirPath[MAX_PATH];\n    TCHAR FileName[MAX_PATH];\n\n    _tcscpy(DirPath,sPath);\n    _tcscat(DirPath,_T(\"\\\\\"));\n    _tcscpy(FileName,sPath);\n    _tcscat(FileName,_T(\"\\\\*\")); // searching all files\n    int nRet = 0;\n    hFind = FindFirstFile(FileName, &amp;FindFileData); // find the first file\n    if( hFind != INVALID_HANDLE_VALUE ) \n    {\n        do\n        {\n            if( IsDots(FindFileData.cFileName) ) \n                continue; //if not directory continue\n\n            _tcscpy(FileName + _tcslen(DirPath), FindFileData.cFileName);\n            if((FindFileData.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY)) \n            {\n                // we have found a directory, recurse\n                if( !DeleteDirectory(FileName) ) \n                    break;   // directory couldn't be deleted\n            }\n            else \n            {\n                if(FindFileData.dwFileAttributes &amp; FILE_ATTRIBUTE_READONLY)\n                    _wchmod(FileName, _S_IWRITE); // change read-only file mode\n\n                if( !DeleteFile(FileName) ) \n                    break;  // file couldn't be deleted\n            }\n        }while( FindNextFile(hFind, &amp;FindFileData) );\n\n        nRet = FindClose(hFind); // closing file handle\n    }\n\n    return RemoveDirectory(sPath); // remove the empty (maybe not) directory and returns zero when RemoveDirectory function fails\n}  \n</code></pre>\n\n<p>Any help in finding the issue is appreciated.\nDuring debugging I noticed that the <code>FindClose</code> function was successfully closing the file handle but <code>GetLastError</code> was returning 32 (\"The process cannot access the file because it is being used by another process\") However I have no clue after trying with process explorer.</p>\n"},{"tags":["c++","windows","multithreading","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":150,"score":0,"question_id":12242252,"title":"CreateThread followed by TerminateThread leaves behind a lot of memory","body":"<p>I'm using CreateThread then TerminateThread to cancel threads. It seems like stack space is still allocated. Is there a way to deal with this? I am not using any form of dynamic memory calls such as malloc/new. Threads do not have to exit gracefully. 10 threads leave behind a whopping 5 MB of memory! The threads are all on varying parts of code, so is there a simple way to implement a interthread communication system which can tell them to all exit gracefully, and therefore reorient the stack? </p>\n"},{"tags":["windows","winapi","dll"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12235025,"title":"How to perform a task immediately on logon","body":"<p>I would like to know how it is possible to perform a task directly after the explorer process is started. My goal is to process some tasks directly after login on Windows 8, as the \"Run\" entry in the registry is not immediately executed.</p>\n"},{"tags":["delphi","winapi","delphi-7","messagebox","object-pascal"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":238,"score":2,"question_id":12238015,"title":"Messagebox delay in Delphi","body":"<p>I'm having problems with the messagebox API.\nI use messageboxw to ask a question to the user.\nFor example my program is very busy with threads, etc. and when a user clicks on a button that shows the messagebox it doesn't show the messagebox until my program is less busy than before. When I remove the messagebox the code after it gets executed fine. I have too much code to show but maybe there is something that I have to take care of...</p>\n\n<p>Anybody had this experience too?</p>\n\n<p>Thanks for your help.</p>\n"},{"tags":["c++","windows","winapi","shellexecute"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":143,"score":1,"question_id":12218195,"title":"ShellExecute get access to open folder","body":"<p>I'm using <code>ShellExecute(NULL, L\"open\", szSomeDirectory, 0, 0, SW_SHOWDEFAULT)</code> to open a directory in explorer.</p>\n\n<p>I'm trying to open a directory that I would normally be prompted with <code>You currently do not have permission to access this folder.</code> and would give me option to get access and show a UAC prompt.</p>\n\n<p>When I'm executing ShellExecute, Explorer gives me a error message saying <code>Access Denied</code>.</p>\n\n<p>My program is running with administrator privileges but that doesn't seem to matter.</p>\n\n<p>How can I get access to open this folder?</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":57,"score":-1,"question_id":12240042,"title":"NtQueryInformationThread for both x86 and x64","body":"<p>It seems NtQueryInformationThread needs DWORD for x86 and DWORD64 for x64 for both size and pointer variable?</p>\n\n<p>How could i make it generic to compile both in x86 and x64? It seems LPVOID is not going to help because it just gave me incorrect results.</p>\n"},{"tags":["c#","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12239518,"title":"EM_GETLINE does not return anything in second calling","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/7050755/cant-use-sendmessage-ex-twice-in-my-c-sharp-program\">can&#39;t use SendMessage_EX twice in my c# program</a>  </p>\n</blockquote>\n\n\n\n<p>I use EM_GETLINE message, to get the text in specific row, but when I call it the second time it returns an empty string.  </p>\n\n<p>Run this code, and click on button1 twice, in the first click the text will show in the message box, but in the second time, will show message box empty.</p>\n\n<pre><code>    private void button1_Click(object sender, EventArgs e)\n    {\n        StringBuilder str = new StringBuilder(256);\n        SendMessage_Ex(richTextBox1.Handle, EM_GETLINE, 0, str);\n        MessageBox.Show(str.ToString());\n    }\n    public const int EM_GETLINE = 0xc4;\n    [DllImport(\"user32.dll\", EntryPoint = \"SendMessageA\")]\n    public static extern int SendMessage_Ex(IntPtr hwnd, int wMsg, int wParam, StringBuilder lParam);\n</code></pre>\n"},{"tags":["c++","windows","winapi","error-handling"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12238867,"title":"SymInitialize failed with error 2147483661","body":"<p>Any idea why this happens? The method works flawlessly for the currentprocess and fails for remote process running on the same local machine with a garbage error code 2147483661 (0x80000000D) for me, since there is no hint at all anywhere about this particular error code, or am i missing something?. \nAlso, I feel; since <code>SymInitialize</code> itself failed, and so is <code>SymFromAddr</code>. Am I correct?</p>\n\n<p>The process in question is running as admin and does have the SeDebug and SeSecurity Privileges.</p>\n\n<pre><code>bool DbgHelpWrapper::MatchTargetSymbol( IntPtr processHandle, int procId, int threadId )\n{\n    DWORD dwStartAddress;\n    DWORD dwInitializeError;\n    DWORD dwThreadID = static_cast&lt;DWORD&gt;(threadId);\n    DWORD dwProcessId = static_cast&lt;DWORD&gt;(procId);\n    HANDLE hRemoteProcess = OpenProcess( PROCESS_ALL_ACCESS, FALSE, dwProcessId );\n\n    if (GetThreadStartAddress( processHandle, dwProcessId, dwThreadID, &amp;dwStartAddress ))\n    {\n        dwInitializeError = ERROR_SUCCESS;\n    } else {\n        dwInitializeError = Marshal::GetLastWin32Error();\n        System::Console::WriteLine( String::Format(\"GetThreadStartAddress failed: {0}\", dwInitializeError ));\n    }\n\n    try\n    {\n        DWORD dwSymSetOptStatus = SymSetOptions(SYMOPT_DEFERRED_LOADS | SYMOPT_UNDNAME | SYMOPT_LOAD_LINES);\n        DWORD dwSymInitStatus = ERROR_SUCCESS;\n        if (dwSymInitStatus = SymInitialize(hRemoteProcess, NULL, TRUE)) {\n            dwInitializeError = ERROR_SUCCESS;\n        } else {\n            dwInitializeError = Marshal::GetLastWin32Error();\n            System::Console::WriteLine( String::Format(\"SymInitialize failed: {0} error: {1}\", dwSymInitStatus, dwInitializeError ));\n            return false;\n        }\n        const int kMaxNameLength = 256;\n\n        ULONG64 buffer[(sizeof(SYMBOL_INFO) + kMaxNameLength * sizeof(wchar_t) + sizeof(ULONG64) - 1) / sizeof(ULONG64)];\n        memset(buffer, 0, sizeof(buffer));\n\n        // Initialize symbol information retrieval structures.\n        DWORD64 sym_displacement = 0;\n        PSYMBOL_INFO symbol = reinterpret_cast&lt;PSYMBOL_INFO&gt;(&amp;buffer[0]);\n        symbol-&gt;SizeOfStruct = sizeof(SYMBOL_INFO);\n        symbol-&gt;MaxNameLen = kMaxNameLength - 1;\n        if( SymFromAddr(hRemoteProcess, (DWORD64)dwStartAddress, &amp;sym_displacement, symbol ))\n        {\n            System::String^ name = gcnew System::String( symbol-&gt;Name );\n            System::Console::WriteLine( String::Format(\"Found thread with ModuleName: {0}\", name ));\n            if( name-&gt;Contains( this-&gt;symbolName ))\n            {\n                return true;\n            }\n        }\n        else\n        {\n            dwInitializeError = Marshal::GetLastWin32Error();\n            System::Console::WriteLine( String::Format(\"SymFromAddr failed: {0}\", dwInitializeError ));\n        }\n    }\n    finally\n    {\n        CloseHandle(hRemoteProcess);\n    }\n    return false;\n}\n</code></pre>\n"},{"tags":["c++","windows","winapi","error-handling"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":98,"score":1,"question_id":12234159,"title":"DuplicateHandle fails for remote thread with error ERROR_INVALID_HANDLE ","body":"<p>Hi I was trying to suspend a remote thread, but en route I'm stumbled upon DuplicateHandle failure with error 6, ERROR_INVALID_HANDLE . </p>\n\n<p>The below method works fine for the current process, but if a remote process like \"calc\" (in the same host machine) is given, the DuplicateHandle fails. </p>\n\n<p>The process runs with Admin priv and the SeDebugPriv and SeSecurityPriv is granted (Process Explorer confirms it), but no use. Any idea?\n`</p>\n\n<pre><code>bool DbgHelpWrapper::GetThreadStartAddress( IntPtr processHandle, DWORD processId, DWORD threadID, DWORD *dwStartAddress )\n{\n    // Get ntdll entry points.\n    HMODULE ntDLLHandle = LoadLibrary(L\"ntdll.dll\");\n    tNtQueryInformationThread NtQueryInformationThread = (tNtQueryInformationThread)GetProcAddress(ntDLLHandle, \"NtQueryInformationThread\");\n\n    // Open thread with wrong access rights.\n    HANDLE hRemoteProcess = OpenProcess( PROCESS_ALL_ACCESS, FALSE, processId );\n    HANDLE hRemoteThread = OpenThread(THREAD_SUSPEND_RESUME, FALSE, threadID);\n\n    if (hRemoteThread != 0 &amp;&amp; hRemoteProcess != 0 )\n    {\n        try\n        {\n            // Duplicate handle to get correct access rights.\n            HANDLE temporaryHandle = 0;\n            DWORD duplicateHandleResult = DuplicateHandle(hRemoteProcess, hRemoteThread, GetCurrentProcess(),\n                                                              &amp;temporaryHandle, THREAD_QUERY_INFORMATION, FALSE, 0 );\n            System::Console::WriteLine( String::Format(\"DuplicateHandle returned {0}\", duplicateHandleResult ));\n            System::Console::WriteLine( String::Format(\"DuplicateHandle error {0}\", Marshal::GetLastWin32Error()));\n            if (duplicateHandleResult != 0 )\n            {\n                try\n                {\n                    NTSTATUS ntStatus = NtQueryInformationThread(temporaryHandle, ThreadQuerySetWin32StartAddress, dwStartAddress, sizeof(DWORD), NULL);\n                    System::Console::WriteLine( String::Format(\"NtQueryInformationThread returned {0}\", ntStatus ));\n                    if (ntStatus == 0)\n                    {\n                        System::Console::WriteLine( String::Format(\"StartAddress: {0:X16}\", *dwStartAddress ));\n                        return true;\n                    }\n                    else\n                    {\n                        System::Console::WriteLine( String::Format(\"NtQueryInformationThread error {0}\", Marshal::GetLastWin32Error()));\n                        return false;\n                    }\n                }\n                finally\n                {\n                    CloseHandle(temporaryHandle);\n                }\n            }\n            else\n            {\n                System::Console::WriteLine( String::Format(\"Cannot duplicate the thread handle to THREAD_QUERY_INFORMATION rights\"));\n                return false;\n            }\n        }\n        finally\n        {\n            // Cleanup\n            CloseHandle(hRemoteThread);\n        }\n    }\n    else\n    {\n        System::Console::WriteLine( String::Format(\"Cannot open the thread with THREAD_SUSPEND_RESUME rights\"));\n        return FALSE;\n    }\n}\n</code></pre>\n\n<p>` </p>\n"},{"tags":["c++","file","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":158,"score":0,"question_id":12234480,"title":"Unable to open file using CreateFile function","body":"<p>Ok so I've been following this tutorial: <a href=\"http://www.planet-source-code.com/vb/scripts/ShowCode.asp?txtCodeId=4422&amp;lngWId=3\" rel=\"nofollow\">http://www.planet-source-code.com/vb/scripts/ShowCode.asp?txtCodeId=4422&amp;lngWId=3</a></p>\n\n<p>And so far I've gotten everything to work, up until I need the program to load in a .raw audio file. </p>\n\n<p>Here's the relevant code:</p>\n\n<pre><code>LPSTR loadAudioBlock(const char* filename, DWORD* blockSize)\n{\nHANDLE hFile = INVALID_HANDLE_VALUE;\nDWORD size = 0;\nDWORD readBytes = 0;\nvoid* block = NULL;\n\n//open the file\n\nif((hFile = CreateFile((LPCWSTR)filename, GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, 0, NULL)) == INVALID_HANDLE_VALUE)\n    return NULL;\n\n// get it's size, allocate memory, and then read it into memory\n\nsize = GetFileSize(hFile, NULL);\nblock = HeapAlloc(GetProcessHeap(), 0, size);\nReadFile(hFile, block, size, &amp;readBytes, NULL);\n\nCloseHandle(hFile);\n*blockSize = size;\nreturn (LPSTR)block;\n}\n</code></pre>\n\n<p>And then my main function which calls it:</p>\n\n<pre><code>int _tmain(int argc, _TCHAR* argv[])\n{\nHWAVEOUT hWaveOut; //device handle\nWAVEFORMATEX wfx; //struct for format info\nMMRESULT result; // for waveOut return values\nLPSTR block;\nDWORD blockSize;\n\n// first let's set up the wfx format struct\n\nwfx.nSamplesPerSec = 44100; // rate of the sample\nwfx.wBitsPerSample = 16; //sample size\nwfx.nChannels = 2; // 2 channels = stereo\nwfx.cbSize = 0; // no extra info\nwfx.wFormatTag = WAVE_FORMAT_PCM; //PCM format\nwfx.nBlockAlign = (wfx.wBitsPerSample &gt;&gt; 3) * wfx.nChannels;\nwfx.nAvgBytesPerSec = wfx.nBlockAlign * wfx.nSamplesPerSec;\n\n// then let's open the device\n\nif(waveOutOpen(&amp;hWaveOut, WAVE_MAPPER, &amp;wfx, 0, 0, CALLBACK_NULL) != MMSYSERR_NOERROR)\n{\n    fprintf(stderr, \"unable to open Wave Mapper device.\\n\");\n    Sleep(1000);\n    ExitProcess(1);\n}\n\n// if no errors then close it\nprintf(\"The Wave Mapper device was opened successfully!\\n\");\n\n//load and play file\nif((block = loadAudioBlock(\"ding.raw\", &amp;blockSize)) == NULL)\n{\n    fprintf(stderr, \"Unable to load file\\n\");\n    Sleep(1000);\n    ExitProcess(1);\n}\nwriteAudioBlock(hWaveOut, block, blockSize);\nSleep(1000);\nwaveOutClose(hWaveOut);\nreturn 0;\n}\n</code></pre>\n\n<p>Everytime I run the program I get the: \"Unable to load file\" output. I've got the \"ding.raw\" file in the same directory as my exe. I've also tried doing the full path as \"C://path\" and \"C:/path\" but then the compiler just gives me more errors about being unable to load a pdb file.</p>\n\n<p>Any ideas? I'm using the Visual Studio 2012 Professional IDE and compiler.</p>\n"},{"tags":["c#","c++","winapi","keyboard","hook"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":2,"view_count":147,"score":0,"question_id":12236934,"title":"Keyboard Hook and Change User Input","body":"<p>I want to write a software that intercepts the user input and changes it. In late windows 98 and before our language wasn't supported officially so programmers decided to invent a writing method based on ASCII characters (ArmSCII) and a font so that we could write in our language. The software is just changing the english inpur to relevant characters in ArmSCII. The program is now old. I want to write a new one. and it should be system-wide. Any suggestions how can I hook into keyboard and change the input? C , C++ or C# that doesn't matter. Im fine with all of them..</p>\n"},{"tags":["internet-explorer","winapi","visual-c++","com","automation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12234042,"title":"Sinking Events of DWebBrowserEvent2 hangs the navigation","body":"<p>I have a problem just like JimEvans in <a href=\"http://stackoverflow.com/questions/3919170/sinking-dwebbrowserevents2-events-appears-to-hang-programmatic-navigation\">Sinking DWebBrowserEvents2 events appears to hang programmatic navigation</a> but I can't understand the anwser, can somebody tell me more about it??</p>\n\n<p>I'm manuplating the IE Explorer by plaint C++. Some codes are copied from the Codeproject. But my IE got hung when I'm handling the Events, and I can't get the DISPID_NAVIGETCOMPLETE event before my main funtion finish.</p>\n\n<p>This has stuck me for a whole week, please help me, thank you.</p>\n\n<p>my code below:</p>\n\n<pre><code>#include &lt;afxwin.h&gt;\n#include &lt;afxdisp.h&gt;\n#include &lt;iostream&gt;\n#include &lt;MsHTML.h&gt;\n#include &lt;Exdisp.h&gt;\n#include &lt;ExDispid.h&gt;\n\nclass IE_Events_Sinker : public DWebBrowserEvents2\n{\n\npublic:\n// No constructor or destructor is needed\n// IUnknown methods\nSTDMETHODIMP QueryInterface(REFIID riid,void **ppvObject);\nSTDMETHODIMP_(ULONG) AddRef();\nSTDMETHODIMP_(ULONG) Release();\n// IDispatch methods\nSTDMETHODIMP GetTypeInfoCount(UINT *pctinfo);\nSTDMETHODIMP GetTypeInfo(UINT iTInfo,LCID lcid,ITypeInfo **ppTInfo);\nSTDMETHODIMP GetIDsOfNames(REFIID riid,LPOLESTR *rgszNames,UINT cNames,LCID lcid,DISPID *rgDispId);\nSTDMETHODIMP Invoke(DISPID dispIdMember,REFIID riid,LCID lcid,WORD wFlags,\n    DISPPARAMS *pDispParams,VARIANT *pVarResult,EXCEPINFO *pExcepInfo,UINT   *puArgErr);\n};\n\nIE_Events_Sinker IESinker;\n\nSTDMETHODIMP IE_Events_Sinker::Invoke(DISPID dispIdMember, \n    REFIID riid, \n    LCID lcid, \n    WORD wFlags, \n    DISPPARAMS FAR* pDispParams, \n    VARIANT FAR* pVarResult, \n    EXCEPINFO FAR* pExcepInfo, \n    unsigned int FAR* puArgErr )\n{\nswitch(dispIdMember)\n{\ncase DISPID_NAVIGATEERROR:\n    {\n    //Extract the status code from the DISPPARAMS structure\n    VARIANT * vt_statuscode = pDispParams-&gt;rgvarg[1].pvarVal;\n    DWORD  dwStatusCode =  vt_statuscode-&gt;lVal;\n    //Extract the event's IDispatch pointer\n    IDispatch *pdispFiredEvent = pDispParams-&gt;rgvarg[4].pdispVal;\n    printf(\"Status Code: %d\\n\", dwStatusCode);\n    break;\n    }\ncase DISPID_NAVIGATECOMPLETE2:\n    printf(\"Navigate Complete!\\n\");\n    break;\n\ncase DISPID_BEFORENAVIGATE2:\n    printf(\"Before Navigate is fired!\\n\");\n    break;\n\ndefault:\n    //MessageBox(NULL, L\"A Message\", NULL, NULL);\n    printf(\"A Message !\\n the dispIdMemberis %d\\n\", dispIdMember);\n    break;\n}\n\nreturn S_OK;\n}\n\nSTDMETHODIMP IE_Events_Sinker::QueryInterface(REFIID riid,void **ppvObject)\n{\n// Check if ppvObject is a valid pointer\nif(IsBadWritePtr(ppvObject,sizeof(void*))) return E_POINTER;\n// Set *ppvObject to NULL\n(*ppvObject)=NULL;\n// See if the requested IID matches one that we support\n// If it doesn't return E_NOINTERFACE\nif(!IsEqualIID(riid,IID_IUnknown) &amp;&amp; !IsEqualIID(riid,IID_IDispatch) &amp;&amp; !IsEqualIID(riid,DIID_DWebBrowserEvents2)) return E_NOINTERFACE;\n// If it's a matching IID, set *ppvObject to point to the global EventSink object\n(*ppvObject)=(void*)&amp;IESinker;\nreturn S_OK;\n}\n\nSTDMETHODIMP_(ULONG) IE_Events_Sinker::AddRef()\n{\nreturn 1; // We always have just one static object\n}\n\nSTDMETHODIMP_(ULONG) IE_Events_Sinker::Release()\n{\nreturn 1; // Ditto\n}\n\n// We don't need to implement the next three methods because we are just a pure event sink\n// We only care about Invoke() which is what IE calls to notify us of events\n\nSTDMETHODIMP IE_Events_Sinker::GetTypeInfoCount(UINT *pctinfo)\n{\nUNREFERENCED_PARAMETER(pctinfo);\n\nreturn E_NOTIMPL;\n}\n\nSTDMETHODIMP IE_Events_Sinker::GetTypeInfo(UINT iTInfo,LCID lcid,ITypeInfo **ppTInfo)\n{\nUNREFERENCED_PARAMETER(iTInfo);\nUNREFERENCED_PARAMETER(lcid);\nUNREFERENCED_PARAMETER(ppTInfo);\n\nreturn E_NOTIMPL;\n}\n\nSTDMETHODIMP IE_Events_Sinker::GetIDsOfNames(REFIID riid,LPOLESTR *rgszNames,UINT     cNames,LCID lcid,DISPID *rgDispId)\n{\nUNREFERENCED_PARAMETER(riid);\nUNREFERENCED_PARAMETER(rgszNames);\nUNREFERENCED_PARAMETER(cNames);\nUNREFERENCED_PARAMETER(lcid);\nUNREFERENCED_PARAMETER(rgDispId);\n\nreturn E_NOTIMPL;\n}\n\nint main()\n{\nHRESULT hr;\nIWebBrowser2* IWbr;\n\nIConnectionPointContainer* pCPContainer;\nIConnectionPoint* m_pConnectionPoint;\n\nCoInitialize(NULL);\n\n//hr = CoCreateInstance(CLSID_InternetExplorer, NULL, CLSCTX_LOCAL_SERVER, IID_IWebBrowser2, (void**)&amp;IWbr);\nhr = CoCreateInstance(CLSID_InternetExplorer, NULL, CLSCTX_LOCAL_SERVER, IID_IWebBrowser2, (void**)&amp;IWbr);\nIWbr-&gt;put_Visible(TRUE);\n\nhr = IWbr-&gt;QueryInterface(IID_IConnectionPointContainer, (void**)&amp;pCPContainer);\n\nhr = pCPContainer-&gt;FindConnectionPoint(DIID_DWebBrowserEvents2, &amp;m_pConnectionPoint);\n\n//Important Point!\nDWORD m_dwCookie;\nm_pConnectionPoint-&gt;Advise(&amp;IESinker, &amp;m_dwCookie);\n\nCOleVariant vtEmpty;\nBSTR url2 = SysAllocString(L\"http://www.qq.com/\");\nIWbr-&gt;Navigate(url2, &amp;vtEmpty, &amp;vtEmpty, &amp;vtEmpty, &amp;vtEmpty);\n\nSleep(20000);\n//hr = IWbr-&gt;Quit();\n//while(FAILED(hr))\n//{\n    //a++;\n    //hr = IWbr-&gt;Quit();\n//}\n//printf(\"shut down %d times\\n\", a);\n\nm_pConnectionPoint-&gt;Unadvise(m_dwCookie);\n\nm_pConnectionPoint-&gt;Release();\nIWbr-&gt;Release();\npCPContainer-&gt;Release();\n\nCoUninitialize();\n}\n</code></pre>\n"},{"tags":["windows","winapi","assembly","x64","x86-64"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":97,"score":1,"question_id":12233648,"title":"Confusion with x86_64 Windows calling convention","body":"<p>The platform is x86_64 Windows 7.</p>\n\n<p>Here is the C source code:</p>\n\n<pre><code>#include&lt;windows.h&gt;\nint main(void){\n    asm(\"int3\");\n    CreateWindowEx(0,NULL,NULL,0,5,6,7,8,NULL,NULL,NULL,NULL);\n    return(0);\n}\n</code></pre>\n\n<p>Which compiles to the following assembly:</p>\n\n<pre><code>push rbp\nmov rbp,rsp\nsub rsp,60h\nint3\nmov qword[rsp+58h],0\nmov qword[rsp+50h],0\nmov qword[rsp+48h],0\nmov qword[rsp+40h],0\nmov qword[rsp+38h],8\nmov qword[rsp+30h],7\nmov qword[rsp+28h],6\nmov qword[rsp+20h],5\nmov r9d,0\nmov r8d,0\nmov edx,0\nmov ecx,0\ncall CreateWindowEx\nmov eax,0\nadd rsp,60h\npop rbp\nret\n</code></pre>\n\n<p>And conceptually this is what I have for the stack at various points of execution (the addresses are arbitrary):</p>\n\n<pre><code>90 -rsp-\n\n90 old rbp\n88 -rsp-\n\n90 old rbp\n88 -rsp- -rbp-\n\n90 old rbp\n88 -rbp- (never used?)\n80 (rsp+58h)\n78 (rsp+50h)\n70 (rsp+48h)\n68 (rsp+40h)\n60 (rsp+38h)\n58 (rsp+30h)\n50 (rsp+28h)\n48 (rsp+20h)\n40 (shadow)\n38 (shadow)\n30 (shadow)\n28 -rsp- (shadow) (will contain call instruction's return pointer...)\n</code></pre>\n\n<p>As you can see there are problems with the stack according to the compiled output of the C program. First off there's 8 bytes that never get used, and 8 bytes of the shadow space will be overwritten by the call instruction for the return pointer. It seems that everything is shifted down 8 bytes more than it should be, because it would be fine if it was shifted 8 bytes up. However the API calls work just as expected, is this just an overlook of Microsoft's implementation of the calling convention?</p>\n"},{"tags":["internet-explorer","winapi","64bit","x64","watin"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":516,"score":3,"question_id":2825694,"title":"How to use Watin 64-bit with MSIE 32-bit","body":"<p>I have a C#-application running on Windows 7. I am using Watin to test some flash and quicktime movies in Internet Explorer. I am running in x64 mode due to some memory limitations I encountered in x86-mode. So I run my application which uses Watin, which starts MSIE. Watin starts the 64-bit version of MSIE. So far so good.</p>\n\n<p>The problem is, flash and quicktime do not seem to work in MSIE 64-bit, so testing playing of movies will not work.</p>\n\n<p>What must be done to run my C# application in 64-bit mode but to get Watin to run MSIE in 32-bit mode?</p>\n"},{"tags":["c++","windows","winapi","shellexecute"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":104,"score":1,"question_id":12233396,"title":"Open 64 bit regedit from 32 bit application","body":"<p>I'm trying to use ShellExecute to open the 64 bit Regedit from my 32 bit application.</p>\n\n<p>I noticed in Process Explorer that if I open Regedit normally, it says the image is 64 bit, but if I open <code>C:\\Windows\\Regedit.exe</code> from my 32 bit application with ShellExecute, Process Explorer says the image is 32 bit.</p>\n\n<p>(and it does open the regedit in the Windows directory, not in SysWOW64)</p>\n\n<p>I've found that if I use the <code>Wow64DisableWow64FsRedirection</code> function before calling ShellExecute, it opens the 64 bit image of it. But my application won't run on 32 bit XP.</p>\n\n<p>What puzzles me is regardless of which way I open regedit, they both reside in <code>C:\\Windows</code>, and are both the same executable. How can the same executable have 2 different image types? And how can I open the 64 bit one without <code>Wow64DisableWow64FsRedirection</code>?</p>\n"},{"tags":["api","winapi","visual-c++","draw","paint"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":2,"view_count":65,"score":-2,"question_id":12228424,"title":"Why can't my Win32 program draw more than once?","body":"<p>I am trying to make a program that detects a key press and draws the corresponding letter on the window. Everything works fine but it only draws once... when I press another key nothing happens. </p>\n\n<pre><code>case WM_KEYDOWN:\n{ \n   if (GetKeyState(0x41))\n   {\n      pCtrl-&gt;Paint (65);\n   }    \n</code></pre>\n\n<p>The Paint function calls a Char function which draws a character using <code>::Textout</code>\nAll I cannot understand is why doesn't it draw more than once</p>\n"},{"tags":["c++","windows","winapi","dns"],"answer_count":6,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":1627,"score":5,"question_id":206172,"title":"How do you programmatically determine whether a Windows computer is a member of a domain?","body":"<p>I need a way to determine whether the computer running my program is joined to any domain. It doesn't matter what specific domain it is part of, just whether it is connected to anything. I'm coding in vc++ against the Win32 API.</p>\n"},{"tags":["c++","c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":182,"score":2,"question_id":1596104,"title":"How to change the color of a textual cue when sending an EM_SETCUEBANNER Message?","body":"<p>When you send an <a href=\"http://msdn.microsoft.com/en-us/library/bb761639%28VS.85%29.aspx\" rel=\"nofollow\">EM_SETCUEBANNER</a> message, you get a grey textual cue in your edit control. How do you change the color of the textual cue in Win32/C ?</p>\n"},{"tags":["c++","windows","winapi","visual-c++","menu"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12231199,"title":"How to hide a window's menubar?","body":"<p>I'm trying to hide the menubar in a C++ application using the windows API. I'm using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms647629%28v=vs.85%29.aspx\" rel=\"nofollow\">AppendMenu / RemoveMenu</a> to edit items. But I'm sick of the whole menu based interface and I just want to hide the whole application menubar. How can I do that using the windows API?</p>\n"},{"tags":["winapi","dns"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":12229257,"title":"WinAPI AddrArray field of DNS_ADDR_ARRAY structure?","body":"<p>I'm using the Windows 8 SDK that ships with Visual Studio 2012.</p>\n\n<p>The DNS_ADDR_ARRAY structure describes a list of DNS server addresses. The DNS_ADDR_ARRAY is defined as follows in WinDNS.h:</p>\n\n<pre><code>typedef struct _DnsAddrArray\n{\n    DWORD           MaxCount;\n    DWORD           AddrCount;\n    DWORD           Tag;\n    WORD            Family;\n    WORD            WordReserved;\n    DWORD           Flags;\n    DWORD           MatchFlag;\n    DWORD           Reserved1;\n    DWORD           Reserved2;\n    DNS_ADDR        AddrArray[ 1 ];\n}\nDNS_ADDR_ARRAY, *PDNS_ADDR_ARRAY;\n</code></pre>\n\n<p>There is a typo in the AddrArray field according to the SDK reference.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/cc448922%28v=prot.10%29\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/cc448922(v=prot.10)</a></p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/hh447192%28v=vs.85%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/hh447192(v=vs.85).aspx</a></p>\n\n<p>It should be:</p>\n\n<pre><code>DNS_ADDR        AddrArray[];\n</code></pre>\n\n<p>The docs say that this member should be a pointer to an array of DNS_ADDR structs. So what is the proper way to fill this structure for use with the DnsQueryEx? I would prefer to list two DNS servers if possible. There may also be problems with the MaxCount field which is the size of the DNS_ADDR_ARRAY struct.</p>\n"},{"tags":["winapi","gdi+"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":132,"score":1,"question_id":12227021,"title":"BS_OWNERDRAW and GDI+","body":"<p>I'm trying to create a launcher window with 5 \"invisible\" buttons that have a smaller partially transparent image centered inside them. The image inside changes depending on whether the user is hovering over the button. In this example the images are resources IDB_Website1 and IDB_Website2.</p>\n\n<p>The images are in .png format. I'm using GDI+ and loading PNG files from resources with <a href=\"http://www.codeproject.com/Articles/3537/Loading-JPG-PNG-resources-using-GDI\" rel=\"nofollow\">http://www.codeproject.com/Articles/3537/Loading-JPG-PNG-resources-using-GDI</a>.</p>\n\n<p>I've used BS_OWNERDRAW to handle the graphics of the button. The problem is that <strong>I don't know how to link the \"PNG from resources\" code to the parent's WM_DRAWITEM</strong>. With the current way I've done the code, I lose the transparency of the .png by going through HBITMAP.</p>\n\n<p>Global variable:</p>\n\n<pre><code>HBITMAP globalpic;\n</code></pre>\n\n<p>Main wndproc:</p>\n\n<pre><code>    case WM_CREATE:\n    {\n        HWND hwndButton = CreateWindow(TEXT(\"button\"), NULL,\n                          WS_CHILD | WS_VISIBLE | BS_OWNERDRAW,\n                          190, 230, 260, 50, // &lt;- the larger rect size\n                          hWnd, (HMENU) HT_BUTTON1, hInst, NULL);\n        HTButton = (WNDPROC) SetWindowLong(hwndButton, GWL_WNDPROC, (LONG) ButtonProc);\n    }\n\n    case WM_DRAWITEM:\n    {\n        DRAWITEMSTRUCT* lpDrawItem = (DRAWITEMSTRUCT*)lParam;\n        HBITMAP hBmp;\n        HDC hdc = CreateCompatibleDC(NULL);\n\n        if (hovering) // &lt;- mousehover detection, not included\n        {\n            gdi.CreateBM(IDB_Website2, _T(\"PNG\"), hInst, hdc, 62, 100, 200, 40);\n        } else {\n            gdi.CreateBM(IDB_Website1, _T(\"PNG\"), hInst, hdc, 62, 100, 200, 40);\n        }\n\n        hBmp = globalpic; // get the global var gdi.CreateBM created\n        DeleteDC(hdc);\n\n        BITMAP bm;\n        GetObject(hBmp, sizeof(bm), &amp;bm);\n        HDC hMemDC = CreateCompatibleDC(NULL);\n        HBITMAP hOldBmp = (HBITMAP)SelectObject(hMemDC, hBmp);\n        StretchBlt (lpDrawItem-&gt;hDC,\n                    lpDrawItem-&gt;rcItem.left + 30,\n                    lpDrawItem-&gt;rcItem.top + 5,\n                    200, &lt;- the width of image\n                    40, &lt;- the height of image\n                    hMemDC,\n                    0, 0,\n                    bm.bmWidth,\n                    bm.bmHeight,\n                    SRCCOPY);\n        SelectObject(hMemDC, hOldBmp);\n        DeleteDC(hMemDC);\n        DeleteObject(hBmp);\n        break;\n    }\n</code></pre>\n\n<p>class GDI's method CreateBM.</p>\n\n<p>Currently, since I don't know of a better way, it sends the HBITMAP to the global variable globalpic. The problem is that by doing this, I lose transparency.</p>\n\n<pre><code>void CreateBM(UINT menuid, LPCTSTR pType, HMODULE hInst, HDC hdc, int x, int y, int w, int h)\n{\n    CGdiPlusBitmapResource m_pBitmap;\n    m_pBitmap.Load(menuid, pType, hInst);\n    m_pBitmap.m_pBitmap-&gt;GetHBITMAP(RGB(255, 255, 0), &amp;globalpic);\n    //m_pBitmap.m_pBitmap-&gt;GetHBITMAP(GetBkColor(hdc), &amp;globalpic); // &lt;- no-go either\n}\n</code></pre>\n\n<p>Any way I could do this more directly? I feel that going through the HBITMAP route is completely unnecessary but I couldn't for the life of me figure out how I should do it.</p>\n\n<p>Then again, if using the HBITMAP way is fine, any pointers on how I could make the color (I guess (RGB(255, 255, 0) ...?) transparent with the current implementation?</p>\n\n<hr>\n\n<p>Answering to Hans:</p>\n\n<p>I also have a GDI method like this, but it's unused at the moment because I couldn't get the image removed after drawing it (as is needed when hovering changes the image):</p>\n\n<pre><code>void Create(UINT menuid, LPCTSTR pType, HMODULE hInst, HDC hdc, int x, int y, int w, int h)\n{\n    Graphics grpx(hdc);\n\n    ht_img = new CGdiPlusBitmapResource();\n    ht_img -&gt; Load(menuid, pType, hInst);\n    grpx.DrawImage(*ht_img, x, y, w, h);\n    delete ht_img;\n}\n</code></pre>\n"},{"tags":["winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":12220110,"title":"Is it possible to use Windows Api (win7) in order to mass rename files?","body":"<p>While in a folder with lots of files, one can select many and rename only one. This one will get the name <code>NewName (1)</code> and the rest will follow as <code>NewName (2)</code> etc..</p>\n\n<p>Is there a way to use this algorithm?</p>\n\n<p>I mostly interested in using WinApi methods in general. It is easy to implement this specific algorithm. I don't know how to dig into <code>explorer.exe</code> and see what method it uses but probably it would be something reusable.</p>\n\n<p>I mostly use <code>c#</code> but any language example would be accepted.</p>\n"},{"tags":["winapi","opengl","graphics","gdi+","gdi"],"answer_count":5,"favorite_count":2,"up_vote_count":9,"down_vote_count":0,"view_count":1182,"score":9,"question_id":10007789,"title":"Are GDI, GDI+ and OpenGL really obsolete/deprecated?","body":"<p>If you open the page <a href=\"http://msdn.microsoft.com/en-us/library/ee663279%28v=vs.85%29.aspx\">\"Graphics and Gaming (Windows)\" on microsoft.com</a></p>\n\n<p>the last category is described as </p>\n\n<blockquote>\n  <p>Legacy Graphics: Technologies that are obsolete and should not be used in new\n  applications.</p>\n</blockquote>\n\n<p>This category includes (among others) the following APIs:</p>\n\n<ul>\n<li>GDI</li>\n<li>GDI+</li>\n<li>OpenGL</li>\n</ul>\n\n<p>What's your opinion? If i want to roll out a new software today it must support Windows XP (still about 50% of all installed systems). Direct2D requires Windows 7/Vista. What else should be used?</p>\n"},{"tags":["c++","performance","winapi","bitblt"],"answer_count":2,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":891,"score":7,"question_id":7154574,"title":"BitBlt performance with Aero enabled","body":"<p>I'd like to get more performance out of BitBlt for capturing the screen. When Aero remains enabled, capturing only a 400x400 pixel area of the screen reduces capture time from an average of 50ms (full 1920x1200) to about 33ms (for 400x400) on my machine. This is a disappointingly low improvement. </p>\n\n<p>Is my only option disabling Aero? I do know that i can get a blinding fast 3ms capture on the full screen when Aero is disabled. </p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12219217,"title":"winapi - How can I add multiple Menu bars to a Frame in MFC programmically","body":"<p>I know how to manipulate the top level CMenu for a CFrameWnd,(CFrameWnd::SetMenu) but I wondered how I can add multiple Menu bars to the Frame? Would this maybe require using Toolbars instead?</p>\n"},{"tags":["c++","winapi","keyboard","keylogger","keystrokes"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":333,"score":0,"question_id":10394292,"title":"How to intercept keystrokes to windows command prompt?","body":"<p>I am working on an application specific keystroke dynamics tool. My requirement is to get keystroke <strong>timing data</strong> of a user in the <strong>Windows CMD prompt</strong>. After a few searches, I have found 2 ways of doing doing this:\n1) Use windows hooks\n2) Pyhook - a python wrapper module </p>\n\n<p>It appears to me that my applications functionality will be quite similar to that of a key-logger. But I am unable to figure out if I should use global hooks or thread specific hook for intercepting keystrokes to the CMD prompt. And If using a global hook, is it possible to filter keystrokes based on the target application?</p>\n"},{"tags":[".net","winapi","cross-threading","system.componentmodel","synchronizationcontext"],"answer_count":2,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":1107,"score":5,"question_id":4843010,"title":".NET: How do I invoke a delegate on a specific thread? (ISynchronizeInvoke, Dispatcher, AsyncOperation, SynchronizationContext, etc.)","body":"<blockquote>\n  <p><em>Note first of all that this question is not tagged <a href=\"/questions/tagged/winforms\" class=\"post-tag\" title=\"show questions tagged 'winforms'\" rel=\"tag\">winforms</a> or <a href=\"/questions/tagged/wpf\" class=\"post-tag\" title=\"show questions tagged 'wpf'\" rel=\"tag\">wpf</a> or anything else GUI-specific. This is intentional, as you will see shortly.</em></p>\n  \n  <p><em>Second, sorry if this question is somewhat long. I try to pull together various bits of information floating around here and there so as to also provide valuable information. My question, however, is right under \"What I would like to know\".</em></p>\n</blockquote>\n\n<p>I'm on a mission to finally understand the various ways offered by .NET to invoke a delegate on a specific thread.</p>\n\n<hr>\n\n<h2>What I would like to know:</h2>\n\n<ul>\n<li><p>I am looking for the most general way possible (that is not Winforms or WPF-specific) to invoke delegates on specific threads.</p></li>\n<li><p>Or, phrased differently: I would be interested if, and how, the various ways to do this (such as via WPF's <code>Dispatcher</code>) make use of each other; that is, if there is one common mechanism for cross-thread delegate invocation that's used by all the others.</p></li>\n</ul>\n\n<hr>\n\n<h2>What I know already:</h2>\n\n<ul>\n<li><p>There's many classes related to this topic; among them:</p>\n\n<ul>\n<li><p><a href=\"http://msdn.microsoft.com/en-us/library/system.threading.synchronizationcontext.aspx\" rel=\"nofollow\"><code>SynchronizationContext</code></a> <em>(in <code>System.Threading</code>)</em><br/>\nIf I had to guess, that would be the most  basic one; although I don't understand what exactly it does, nor how it is used.</p></li>\n<li><p><a href=\"http://msdn.microsoft.com/en-us/library/system.componentmodel.asyncoperation.aspx\" rel=\"nofollow\"><code>AsyncOperation</code></a> &amp; <a href=\"http://msdn.microsoft.com/en-us/library/system.componentmodel.asyncoperationmanager.aspx\" rel=\"nofollow\"><code>AsyncOperationManager</code></a> <em>(in <code>System.ComponentModel</code>)</em><br/>\nThese seem to be wrappers around <code>SynchronizationContext</code>. No clue how to use them.</p></li>\n<li><p><a href=\"http://msdn.microsoft.com/en-us/library/system.windows.forms.windowsformssynchronizationcontext.aspx\" rel=\"nofollow\"><code>WindowsFormsSynchronizationContext</code></a> <em>(in <code>System.Windows.Forms</code>)</em><br/>\nA subclass of <code>SynchronizationContext</code>.</p></li>\n<li><p><a href=\"http://msdn.microsoft.com/en-us/library/system.componentmodel.isynchronizeinvoke.aspx\" rel=\"nofollow\"><code>ISynchronizeInvoke</code></a> <em>(in <code>System.ComponentModel</code>)</em><br/>\nUsed by Windows Forms. (The <code>Control</code> class implements this. If I'd have to guess, I'd say this implementation makes use of <code>WindowsFormsSynchronizationContext</code>.)</p></li>\n<li><p><a href=\"http://msdn.microsoft.com/en-us/library/system.windows.threading.dispatcher%28VS.85%29.aspx\" rel=\"nofollow\"><code>Dispatcher</code></a> &amp;<a href=\"http://msdn.microsoft.com/en-us/library/system.windows.threading.dispatchersynchronizationcontext%28VS.85%29.aspx\" rel=\"nofollow\"><code>DispatcherSynchronizationContext</code></a> <em>(in <code>System.Windows.Threading</code>)</em><br/>\nSeems like the latter is another subclass of <code>SynchronizationContext</code>, and the former delegates to it.</p></li>\n</ul></li>\n<li><p>Some threads have their own message loop, along with a message queue.</p>\n\n<p>(The MSDN page <a href=\"http://msdn.microsoft.com/en-us/library/ms644927%28VS.85%29.aspx\" rel=\"nofollow\"><em>About Messages and Message Queues</em></a> has some introductory background information on how message loops work at the system level, i.e. message queues as the Windows API.)</p>\n\n<p>I can see how one would implement cross-thread invocation for threads with a message queue. Using the Windows API, you would put a message into a specific thread's message queue via <a href=\"http://msdn.microsoft.com/en-us/library/ms644946%28VS.85%29.aspx\" rel=\"nofollow\"><code>PostThreadMessage</code></a> that contains an instruction to call some delegate. The message loop &mdash; which runs on that thread &mdash; will eventually get to that message, and the delegate will be called.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/ms644928%28VS.85%29.aspx#creating_loop\" rel=\"nofollow\">From what I've read on MSDN</a>, a thread doesn't automatically have its own message queue. A message queue will become available e.g. when a thread has created a window. Without a message queue, it doesn't make sense for a thread to have a message loop.</p>\n\n<p>So, is cross-thread delegate invocation possible at all when the target thread has no message loop? Let's say, in a .NET console application? (Judging from the answers to <a href=\"http://stackoverflow.com/questions/3656250/invoke-delegate-on-main-thread-in-console-application\">this question</a>, I suppose it's indeed impossible with console apps.)</p></li>\n</ul>\n"},{"tags":["winapi","gdi+"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":12214895,"title":"WinAPI: Image on hover","body":"<p>A friend of mine is about to release an application and asked me to create a launcher for it. I found it a good excuse to finally study WinAPI and thought that a simple launcher would be easily doable even in a relatively small time window. </p>\n\n<p>I was wrong.</p>\n\n<p>I'm trying to create a launcher window with 5 buttons that start different things. The goal is to have transparent buttons (not done yet) that have a smaller image inside them. The image should only be displayed when the user hovers over the larger button area.</p>\n\n<p>The images are in .png format. I'm using GDI+ and loading PNG files from resources with <a href=\"http://www.codeproject.com/Articles/3537/Loading-JPG-PNG-resources-using-GDI\" rel=\"nofollow\">http://www.codeproject.com/Articles/3537/Loading-JPG-PNG-resources-using-GDI</a>.</p>\n\n<p>I'm using MouseTrackEvents to keep track of the mouse and I've also subclassed a button. The problem is that I don't know how I should handle the WM_MOUSELEAVE message. I don't know how to erase the image I've drawn. If I have to save the ht_img as a variable and refer to it later, I don't know how.</p>\n\n<p>Here's what I have so far. This example loads the .png from resource IDB_Website2. Displaying the image works (although it keeps being rendered over and over again currently):</p>\n\n<p>WndProc:</p>\n\n<pre><code>LRESULT CALLBACK WndProc(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam)\n{\nint wmId, wmEvent;\nPAINTSTRUCT ps;\nHDC hdc;\nGDI gdi;\n\nswitch (Msg)\n{\n    case WM_CREATE:\n    {\n        HWND hwndButton = CreateWindow(TEXT(\"button\"), NULL,\n                          WS_VISIBLE | WS_CHILD | BS_PUSHBUTTON,\n                          80, 10, 100, 50,\n                          hWnd, (HMENU) HT_BUTTON1, NULL, NULL);\n        HTButton = (WNDPROC) SetWindowLong(hwndButton, GWL_WNDPROC, (LONG) ButtonProc);\n    }\n...\n\n    case WM_PAINT:\n        hdc = BeginPaint(hWnd, &amp;ps);\n        gdi.InitList(hInst, hdc);\n        EndPaint(hWnd, &amp;ps);\n        break;\n</code></pre>\n\n<p>Buttonproc (subclassed button):</p>\n\n<pre><code>LRESULT CALLBACK ButtonProc(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam)\n{\nMouseTrackEvents MouseTrack;\nGDI gdi;\n\nHDC odc = GetDC(GetParent(hWnd));\n\nswitch(Msg)\n{\n    case WM_MOUSEMOVE:\n        MouseTrack.OnMouseMove(hWnd);\n        break;\n\n    case WM_MOUSEHOVER:\n        gdi.Create(IDB_Website2, _T(\"PNG\"), hInst, odc, 62, 347, 200, 40, true);\n        MouseTrack.Reset(hWnd);\n        break;\n\n    case WM_MOUSELEAVE:\n        MouseTrack.Reset(hWnd);\n        break;\n}\n\nreturn CallWindowProc (HTButton, hWnd, Msg, wParam, lParam);\n}\n</code></pre>\n\n<p>class GDI's Create graphic method:</p>\n\n<pre><code>void Create(UINT menuid, LPCTSTR pType, HMODULE hInst, HDC hdc, int x, int y, int w, int h)\n{\n    Graphics grpx(hdc);\n\n    ht_img = new CGdiPlusBitmapResource();\n    ht_img -&gt; Load(menuid, pType, hInst);\n    grpx.DrawImage(*ht_img, x, y, w, h);\n    delete ht_img;\n}\n</code></pre>\n\n<p>This has been quite a challenge so far! It's been fun although a bit tear-my-hair-out inducing at times. :-) I'd be grateful for any advice on how I should proceed.</p>\n\n<hr>\n\n<p>EDIT: Answering Adrian</p>\n\n<p>I tried changing my Buttonproc, but the image doesn't seem to be rendered. Here's what I did:</p>\n\n<pre><code>LRESULT CALLBACK ButtonProc(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam)\n{\n    MouseTrackEvents MouseTrack;\n    GDI gdi;\n    HDC odc = GetDC(GetParent(hWnd));\n    PAINTSTRUCT ps;\n\n    int result;\n\n    switch(Msg)\n    {\n    case WM_MOUSEMOVE:\n        MouseTrack.OnMouseMove(hWnd);\n        break;\n\n    case WM_MOUSEHOVER:\n        hovering = true;\n        break;\n\n    case WM_MOUSELEAVE:\n        hovering = false;\n        MouseTrack.Reset(hWnd);\n        break;\n\n    case WM_PAINT:\n        hdc = BeginPaint(hWnd, &amp;ps);\n        result = CallWindowProc(HTButton, hWnd, Msg, wParam, lParam);\n        if (hovering == true) {\n            gdi.Create(IDB_Play2, _T(\"PNG\"), hInst, hdc, 62, 100, 200, 40);\n        }\n        EndPaint(hWnd, &amp;ps);\n        return result;\n    }\n    return CallWindowProc (HTButton, hWnd, Msg, wParam, lParam);\n}\n</code></pre>\n"},{"tags":["c","winapi","colors","screenshot","printscreen"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12220691,"title":"Need a winapi function with the ability to print screen","body":"<p>I want to create a small utility 'ColorPic', below is its picture.</p>\n\n<p>In fact, I can get RGB of the pixel where the cursor is over.</p>\n\n<p>But I want to create a window which \"prints\" part of the screen (near the cursor) into this window.</p>\n\n<p>The most important is that I need an option to zoom in and zoom out, which means that I could represent a pixel by a 4x4, 8x8, 16x16 or 32x32 rectangle...</p>\n\n<p>I know there is a SetPixel function, but this is not what I want.</p>\n\n<p>Is there a very efficient functon to do this, something like \"PrintScreen\" (and one can specified a rectangle as argument)?? By very efficient, I mean when one move the mouse, the function can refresh the window very fast and do not use too much system resource.</p>\n\n<p><img src=\"http://i.stack.imgur.com/1TOZz.png\" alt=\"enter image description here\">s</p>\n"},{"tags":["winapi","waitforsingleobject"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":12199872,"title":"Resolution of WaitForSingleObject with timeSetEvent & SetWaitableTimer","body":"<p>I am using a Win32 multimedia timer to put a delay between the dispatch of large numbers of UDP packets, but i am finding that the resulting delay is substantially longer than it should be. Delays of ~40ms are sometimes nearer 1000ms, even when using Windows Miltimedia timers and upping the timer resolution. Below is a simplifed version of the code i used:</p>\n\n<pre><code>if( timeGetDevCaps(&amp;tc,sizeof(TIMECAPS)) == TIMERR_NOERROR) \n    {\n    timeRes = min( max(tc.wPeriodMin,1), tc.wPeriodMax);\n    timeBeginPeriod(timeRes);\n    printf(\"Timer Res: %u\\n\", timeRes);\n    }\n/* ... */\nwhile( ptrHead )\n    {\n    NALU_t *ptrLink = ptrHead;\n    unsigned long tsNALU = ptrLink-&gt;timestamp - tsFirst;\n    printf(\"Timestamp: %umsec\\n\", ptrLink-&gt;timestamp / 90 );\n    int idxPort;\n    for(idxPort=0;idxPort&lt;12;idxPort++)\n        {\n        ip4Addr.sin_port = htons( 60000 + idxPort );\n        struct sockaddr *saAddr = (struct sockaddr*)&amp;ip4Addr;\n        sendto(fdSocket,(char*)ptrLink-&gt;ptrData,ptrLink-&gt;lenData,\n           0,saAddr,lenAddr);\n        }\n    if( 1 )\n        {\n        unsigned long millis = (tsNALU - tsPrev) / 90;\n        valTime.QuadPart  = 10000;\n        valTime.QuadPart *= millis;\n        valTime.QuadPart *= -1;\n        if(SetWaitableTimer(hdlTimer,&amp;valTime,0,NULL,NULL,TIME_ONESHOT))\n            WaitForSingleObject(hdlTimer,INFINITE);\n        }\n    tsPrev = tsNALU;\n    ptrHead = ptrLink-&gt;next;\n    free( ptrLink );\n    }\n</code></pre>\n\n<p>I <em>suspect</em> the problem is that Windows7 no longer guarantees the resolution of timers when signalled by events as opposed to call-backs, but i am loathed to use the latter. Anyone know why even supposedly high-resolution timers in single-threaded test cases are so wildly inaccurate?</p>\n"},{"tags":["windows","winforms","windows-phone-7","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12200193,"title":"How to find path of certifcate installed","body":"<p>Consider following case, suppose I have register path HKLM\\XXX so whenever a new certificate installed there is new key will be added in this path.</p>\n\n<p>I have register a callback on this registry path but is there is any way to figure out from which path the certificate was installed.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12215719,"title":"Reading the start address and length  (virtual memory map) of a process","body":"<p>As started <a href=\"http://stackoverflow.com/questions/12215299/reading-a-process-memory#comment16363546_12215299\">here</a></p>\n\n<p>I need to know how to read the start address and length (virtual memory map) of a process.</p>\n\n<p>I would like to map a process memory. I would like to read values of a process memory and write values to them.</p>\n\n<p>I'm curious about how programs like Cheat-O'matic (cheat-o-matic.softonic.com.br) work. First thing I thought was that the process would be loaded in a contiguous memory location. But that seems not right.</p>\n"},{"tags":["c++","winapi","threadpool"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12215516,"title":"Thread pool is is taking all CPU resources","body":"<p>I've been working lately on my own thread pool implementation, and it works fine( pretty much). The problem is it takes almost all CPU resources.\nPlease, take a look on my implementation:</p>\n\n<p><strong>ThreadPool.h</strong></p>\n\n<pre><code>#include &lt;vector&gt;\n#include &lt;list&gt;\n#include &lt;Windows.h&gt;\n\nconst int DefaultThreadsNumber = 5;\n\nclass thread_pool\n{\n    typedef void ( *Task )( );\n\n    void* m_hEvent;\n\n    CRITICAL_SECTION m_hExecuteFunc;\n    CRITICAL_SECTION m_hRunFunc;\n\n\n    std::vector&lt;void*&gt; m_ThreadHandles;\n    std::list&lt;Task&gt; m_TasksQueue;\n    int m_nThreadInQueue;\n    static unsigned __stdcall Run( void* thisParam );\npublic:\n    thread_pool( int nMaxThreadNo );\n    ~thread_pool();\n    void Execute( Task task );\n};\n</code></pre>\n\n<p><strong>ThreadPool.cpp</strong></p>\n\n<pre><code>#include \"thread_pool.h\"\n#include &lt;process.h&gt;\n\nvoid* g_hTaskFinishedEvent;\n\nthread_pool::thread_pool( int nMaxThreadNo )\n{\n    if ( nMaxThreadNo &lt;= 0 )\n        nMaxThreadNo = DefaultThreadsNumber;\n\n    m_nThreadInQueue = nMaxThreadNo;\n    for( int i = 0; i &lt; nMaxThreadNo; ++i )\n    {\n        m_ThreadHandles.push_back((void*)_beginthreadex(NULL, 0, &amp;Run, (void*)this, 0, 0 ));\n    }\n\n    InitializeCriticalSection( &amp;m_hExecuteFunc );\n    InitializeCriticalSection( &amp;m_hRunFunc );\n}\n\n\nthread_pool::~thread_pool()\n{\n    for ( std::vector&lt;void*&gt;::iterator it = m_ThreadHandles.begin(); \n            it != m_ThreadHandles.end(); \n            ++it )\n    {\n        CloseHandle( *it );\n    }\n\n    DeleteCriticalSection( &amp;m_hExecuteFunc );\n    DeleteCriticalSection( &amp;m_hRunFunc );\n\n}\n\nvoid thread_pool::Execute( Task task )\n{\n    EnterCriticalSection( &amp;m_hExecuteFunc );\n\n    m_TasksQueue.push_back( task );\n\n    LeaveCriticalSection( &amp;m_hExecuteFunc );\n\n    m_hEvent = CreateEvent(NULL, true, false, NULL);\n    SetEvent( m_hEvent ); // TODO: what if setEvent will fail???\n}\n\nunsigned __stdcall thread_pool::Run(void* thisParam )\n{\n    thread_pool *This = (thread_pool*)thisParam;\n    while(true)\n    {\n        WaitForSingleObject( This-&gt;m_hEvent, INFINITE );\n        while(!This-&gt;m_TasksQueue.empty())\n        {\n\n\n            EnterCriticalSection( &amp;This-&gt;m_hExecuteFunc );\n\n            if ( !This-&gt;m_TasksQueue.empty() ) \n            {\n                This-&gt;m_TasksQueue.front()();\n                This-&gt;m_TasksQueue.pop_front();\n\n                g_hTaskFinishedEvent = CreateEvent(NULL, true, false, NULL);\n                SetEvent( g_hTaskFinishedEvent );\n            }\n\n            LeaveCriticalSection( &amp;This-&gt;m_hExecuteFunc );\n        }\n    }\n    return 0;\n}\n</code></pre>\n\n<p>How can it be improved?</p>\n\n<p>Thanks on advance.</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":12215249,"title":"LoadLibraryA fails with module not found, but the filename is correct","body":"<p>I am trying to load a dll like this:</p>\n\n<pre><code>dll_handle = LoadLibraryA(QString(\"%1\\\\module.dll\")\n                        .arg(QApplication::applicationDirPath().replace(\"/\", \"\\\\\"))\n                        .toLocal8Bit().data());\n</code></pre>\n\n<p>The resulting filename that I pass to LoadLibraryA is correct, the file exists and is readable by the process. What is the problem? </p>\n"},{"tags":["c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12215299,"title":"Reading a process memory ","body":"<p>I'm trying to read memory from a process (calc.exe). But I'm hitting \"Could not read memory\" message. Where is my mistake?</p>\n\n<pre><code>int main() {\n    HWND handle = FindWindow(0, TEXT(\"Calculadora\"));\n    if (!handle) {\n        msg(\"Could not find window\");\n        return 0;\n    }\n\n    DWORD id;\n    GetWindowThreadProcessId(handle, &amp;id);\n    HANDLE proc = OpenProcess(PROCESS_VM_READ | PROCESS_VM_WRITE | PROCESS_VM_OPERATION, FALSE, id);\n    if (!proc) {\n        msg(\"Could not open process\");\n        return 0;\n    }\n\n    char buffer[128];\n    if (ReadProcessMemory(proc, 0, &amp;buffer, 128, NULL)) {\n        msg(\"yes!!\");\n    }\n    else {\n        msg(\"Could not read memory\");\n    }\n\n    CloseHandle(proc);\n}\n</code></pre>\n"},{"tags":["c++","winapi"],"answer_count":8,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":4412,"score":1,"question_id":168017,"title":"Convert BSTR to int","body":"<p>Does any one know how can I convert a BSTR to an int in VC++ 2008</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c++","winapi","events","handle"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":83,"score":1,"question_id":12212628,"title":"win32 Handles and multithread","body":"<p>In our application, there is a heavy use of win32 HANDLEs, using CreateEvent, SetEvent/ResetEvent, so as to perform synchronization mechanisms.</p>\n\n<p>A colleague of mine has asked me if accessing the HANDLEs for events was thread-safe.</p>\n\n<p>I could not answer, since HANDLEs are not thread safe for any GDI object...</p>\n\n<p>But since events are aimed towards multithread synchronization, I could not imagine they arent thread safe.</p>\n\n<p>Could you confirm this ?</p>\n"},{"tags":["c","winapi","hwnd","ppm","getdibits"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12212951,"title":"bitmap inverted color","body":"<p>Some time ago I asked a question about saving hwnd into ppm file. Thanks to a stackoverflow user I have solved my issue. Iy's work correctly but I still have a problem: the red and blue color are inverted.</p>\n\n<p>the code and my previous question where here:\n<a href=\"http://stackoverflow.com/questions/11991675/hwnd-to-ppm-issue\">hwnd to ppm issue</a></p>\n\n<p>Here is the bitmap info data:</p>\n\n<pre><code>bi.biSize = sizeof(BITMAPINFOHEADER);    \nbi.biWidth = w;    \nbi.biHeight = -h;  \nbi.biPlanes = 1;    \nbi.biBitCount = 24;    \nbi.biCompression = BI_RGB;    \n\nbi.biSizeImage = 0;  \nbi.biXPelsPerMeter = 0;    \nbi.biYPelsPerMeter = 0;    \nbi.biClrUsed = 0;    \nbi.biClrImportant = 0;\n</code></pre>\n\n<p>I googled and it seems the problem is BI_RGB, and I should use BI_BITFIELDS ... but I didn't find documentation on how to use it.\nAnd I really don't want to read all data pixel by pixel in order to revert blue and red color.\nIs there any way to get it done without doing it pixel by pixel ?</p>\n\n<p>thanks in advance for your help</p>\n"},{"tags":["multithreading","winapi","synchronization"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":99,"score":1,"question_id":12196961,"title":"Is it possible to use multi-threading effectively for a short period of time","body":"<p>Consider I have a one-thread code that does something in the main thread and it takes about 10-20 ms. I would like to utilize two cores of my processor and split the task for two threads living at different cores. Technically I should probably resume two sleeping threads and make myself to sleep until they're done and sleep again. Nothing scaring if the task is long enough to execute. But for 10-20 ms I suspect the penalty of using well-known synchronization techniques would cost me a large share of time. If I'm too suspicious and the Windows/CPU does good job making all sleeping/waking requests effective, then what is the smallest time it still makes sense to split, 1ms, 10ms, 100ms? </p>\n"},{"tags":["c++","winapi","qt","wallpaper","desktop-wallpaper"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":3078,"score":2,"question_id":3331682,"title":"Change wallpaper programmatically using c++ and windows api","body":"<p>I've been trying to write an application, using Qt and mingw32, to download images and set them as the background Wallpaper. I have read several articles online about how to do this, in VB and C#, and to some extent how to do it in c++. I am currently calling the <code>SystemParametersInfo</code> with what seems to be all the correct arguments (no compiler errors) and it fails. No great crash of cymbals, just a <code>0</code> returned. <code>GetLastError()</code> returns an equally enlightening <code>0</code>.</p>\n\n<p>Below is the code I am using (In a slightly modified form, so you do not have to view the object internals).</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n#include &lt;QString&gt;\n\nvoid setWall()\n{\n    QString filepath = \"C:\\\\Documents and Settings\\\\Owner\\\\My Documents\\\\Wallpapers\\\\wallpaper.png\";\n    char path[150];\n    strcpy(path, currentFilePath.toStdString().c_str());\n    char *pathp;\n    pathp = path;\n\n    cout &lt;&lt; path;\n\n    int result;\n    result = SystemParametersInfo(SPI_SETDESKWALLPAPER, 0, pathp, SPIF_UPDATEINIFILE);\n\n    if (result)\n    {\n        cout &lt;&lt; \"Wallpaper set\";\n    }\n    else\n    {\n        cout &lt;&lt; \"Wallpaper not set\";\n        cout &lt;&lt; \"SPI returned\" &lt;&lt; result;\n    }\n}\n</code></pre>\n"},{"tags":["c#","winforms","winapi","richtextbox"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12211098,"title":"How can I do full justify alignment","body":"<p>I am displaying the text in pages layout, such as Microsoft Word, That every page is a new RichTextBox. and the text alignment is justify (with SETPARAFORMAT message).<br>\nBut when there is a paragraph that begins on the first page (first RichTextBox) and ends on the second page, the last line of the first page is not justify, how can I do that also last line will be justified?</p>\n"},{"tags":["delphi","winapi","delphi-7","vcl","keylogger"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":184,"score":2,"question_id":12203274,"title":"Delphi FormKeyDown ALT Key Stuck","body":"<p>I have a form with 2 CheckBoxes (1 is for Holding CTRL - 1 is for Holding ALT)\nBoth CheckBoxes are disabled so the KeyDown Event of the form works properly.\nThere is also a TTimer that synchronizes every 10ms if the ALT/CTRL key is pressed.</p>\n\n<p>That's my timer:</p>\n\n<pre><code>procedure TForm1.Timer1Timer(Sender: TObject);\nbegin\n CheckBox1.Checked := ALTDOWN;  // ALTDOWN IS GLOBAL\n CheckBox2.Checked := CTRLDOWN; // CTRLDOWN IS GLOBAL\nend;\n</code></pre>\n\n<p>That's my KeyDown Event:</p>\n\n<pre><code>procedure TForm1.FormKeyDown(Sender: TObject; var Key: Word;\nShift: TShiftState);\nbegin\n if Key = VK_MENU then begin\n  ALTDOWN := TRUE;\n  exit;\n end;\n if Key = VK_CONTROL then begin\n  CTRLDOWN := TRUE;\n  exit;\n end;\nend;\n</code></pre>\n\n<p>That's my KeyUP Event:</p>\n\n<pre><code>procedure TForm1.FormKeyUp(Sender: TObject; var Key: Word;\nShift: TShiftState);\nbegin\n if Key = VK_MENU then begin\n  ALTDOWN := FALSE;\n  exit;\n end;\n if Key = VK_CONTROL then begin\n  CTRLDOWN := FALSE;\n  exit;\n end;\nend;\n</code></pre>\n\n<p>This works without any problems with the CTRL Key.\nBut the ALT Key get's stuck sometimes or does not even show up at all.\nThis happens when I press ONLY the ALT Key (without any other keys in combination)\nWhy is that and how can I fix this?</p>\n\n<p>Thanks for your help.</p>\n"},{"tags":["windows","winapi","rtl"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":100,"score":2,"question_id":10391669,"title":"how to detect if a windows installation is RTL","body":"<p>(i'm using windows XP, but the question is relevant to all/any windows version)</p>\n\n<p>windows setup comes in 2 \"flavoers\": LTR or RTL.\nmeaning, the GUI (buttons, windows' controls, menus, and more) is displayed from left to right, or from left to right.</p>\n\n<p>This is relevant mostly to Hebrew and Arabic versions of windows.</p>\n\n<p>My program needs to find out the default behavior of displaying its widgets.</p>\n\n<p>The LOCALE is not the right answer!</p>\n\n<p>Local pertains to date format, thousands separator, UI language, and other language/culture specific settings, but in Windows, locale doesn't affect the UI direction.</p>\n\n<p>How can I find out (registry, env, etc) the OS's direction?</p>\n"},{"tags":["debugging","winapi","assembly","decompiling"],"answer_count":12,"favorite_count":35,"up_vote_count":30,"down_vote_count":0,"view_count":74251,"score":30,"question_id":273145,"title":"Is it possible to \"decompile\" a Windows .exe? Or at least view the Assembly?","body":"<p>A friend of mine downloaded some malware from Facebook, and I'm curious to see what it does without infecting myself. I know that you can't really decompile an .exe, but can I at least view it in Assembly or attach a debugger? </p>\n\n<p>Edit to say it is not a .NET executable, no CLI header.</p>\n"},{"tags":["delphi","winapi","serial-port","wmi","port"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":304,"score":3,"question_id":12163106,"title":"Getting device names using a COM port number through the Windows API in Delphi","body":"<p>I need a way to use the WMI to find the name of a modem (or other device) which is currently attatched to a COM port which I already know.</p>\n\n<p>For example lets say I have already extracted that the device I want is on COM port 3 and I also know it is a modem, how can I find the name of the modem associated with that COM port.</p>\n\n<p>Currently I have code using <strong>Win32_PnPEntity</strong> which can extract a list of pnp devices with either modem or COM in the name but unfortunatley when I return the COM devices they do not carry the modem name and when I extract modem device they do not associate with a COM port (so if I have two modems attached I do not know which is in COM port 3). I have also found a <strong>Win32_SerialPort</strong> function but this does not return all devices attatched to my computer via serial ports.</p>\n\n<pre><code>const   wbemFlagForwardOnly = $00000020;\n\nvar\n\n    FSWbemLocator : OLEVariant;\n    FWMIService   : OLEVariant;\n    FWbemObjectSet: OLEVariant;\n    FWbemObject   : OLEVariant;\n    oEnum         : IEnumvariant;\n    iValue        : LongWord;\n    ts            : String;\n\nbegin;\n\n    FSWbemLocator := CreateOleObject('WbemScripting.SWbemLocator');\n    FWMIService   := FSWbemLocator.ConnectServer('localhost', 'root\\cimv2', '', '');\n\n//This WMI service checks for plug and play devices\nFWbemObjectSet:= FWMIService.ExecQuery('SELECT * FROM Win32_PnPEntity','WQL',wbemFlagForwardOnly);\n\n\n//This WMI service which I didn't use checks for serial ports and what is on them - currently not displaying sufficient information}\n//FWbemObjectSet:= FWMIService.ExecQuery('SELECT * FROM  Win32_SerialPort','WQL',wbemFlagForwardOnly);\n\noEnum := IUnknown(FWbemObjectSet._NewEnum) as IEnumVariant;\n\nwhile oEnum.Next(1, FWbemObject, iValue) = 0 do\n    begin\n        if not VarIsNull(FWbemObject.name) then\n            begin\n                ts:= String(FWbemObject.name);\n\n                if pos('(COM',ts)&lt;&gt;0 then\n                    pnpForm.listbox1.items.add(ts);\n            end;\n\n        FWbemObject:=Unassigned;\n    end;\nend;\n</code></pre>\n"},{"tags":["c#",".net","winapi","interop","timezone"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":5495,"score":4,"question_id":808736,"title":"Set System Time Zone from .NET","body":"<p>Does anyone have some code that will take a TimeZoneInfo field from .NET and execute the interop code to set the system time zone via SetTimeZoneInformation? I realize that it's basically mapping the TimeZoneInfo members to the struct members, but it does not appear obvious to me how the fields will map exactly or what I should care about beyond the bias. </p>\n"},{"tags":["c++","winapi","windows-8","windowsversion"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2841,"score":4,"question_id":9817160,"title":"GetVersionEx under Windows 8","body":"<p>I'm writing a C++ code to determine what OS it is running on. I use GetVersionEx() API to do that, and <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms724429%28v=vs.85%29.aspx\" rel=\"nofollow\">this code</a> as a tutorial, but it doesn't seems to handle Windows 8. Does anyone know how to fix it to run under Windows 8?</p>\n"},{"tags":["c++","windows","winapi","events"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":76,"score":3,"question_id":12207692,"title":"How to get an auto-reset event's state with C++?","body":"<p>Say, if I created an event like so:</p>\n\n<pre><code>HANDLE hGlobalEvent = ::CreateEvent(NULL, FALSE, FALSE, NULL);\n</code></pre>\n\n<p>Is it possible to get its state by its handle w/o changing it?</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12206839,"title":"Owner draw the text of a button with the Windows API","body":"<p>I want to owner/custom draw the text of a button, but only the text (or the content). So I can  render the button with multiple colored fonts.</p>\n\n<p>If I handle <code>WM_DRAWITEM</code> I have to paint the entire button. I want to only paint the text.</p>\n\n<p>Is there some API I can call to have windows paint the button without the text, and then I can paint the text myself?</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12205955,"title":"File search progress bar","body":"<p>I'm using <code>FindFirstFile</code> and <code>FindNextFile</code> recursively to search for a file by searching 20 levels deep.<br>\nHow would I go about adding a progress bar? To show the progress of the search?</p>\n\n<p>I want something similar to the progress bar in explorer when you search for a file.</p>\n\n<p>But how would I figure out how many total files I have to search through to figure out the % completed?</p>\n"},{"tags":["c","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12204289,"title":"Can't switch keyboard language while window is active","body":"<p>I'm learning Win32 API. I've created an empty window and added an Edit box in it to type some text. I can type a text in it, but can't switch the keyboard language.</p>\n\n<p>Shortcuts like Alt+Shift don't work. If I click the language icon in the tray, it will pause for a few seconds, then it will open the list finally, but my window will become inactive, so the change won't affect it.</p>\n\n<p>I can make the language change happen if I do this:</p>\n\n<ol>\n<li>press Alt+Shift (or whatever the combination is)</li>\n<li>press Alt, Space</li>\n</ol>\n\n<p>Step 2 will result, as usual, in the popping of the window menu at the left top, but simultaneously the step 1 will become actual too.</p>\n\n<p>I guess, I'm not processing some kind of message, or creating the window wrong, but I can't find what is it that is wrong. Here is the full code:</p>\n\n<pre><code>#include &lt;windows.h&gt;\n\n// handle of the edit box\nHWND testEditBox;\n\n// shows a message\nvoid showMessage( LPSTR message ){\n    MessageBox( GetActiveWindow(), message, \"\", MB_OK );\n}\n\n// a simple window procedure\nLRESULT CALLBACK windowProc( HWND window, UINT message, WPARAM wparam, LPARAM lparam )\n{\n    switch( message )\n    {\n        case WM_CLOSE:\n            DestroyWindow( window );\n            break;\n        case WM_DESTROY:\n            PostQuitMessage( 0 );\n            break;\n        default:\n            return DefWindowProc( window, message, wparam, lparam );\n    }\n    return 0;\n}\n\nint WINAPI WinMain( HINSTANCE instance, HINSTANCE prevInstance, LPSTR commandLine, int showMode )\n{\n    // create window class\n    WNDCLASS windowClass;\n    windowClass.cbClsExtra = 0;\nwindowClass.cbWndExtra = 0;\nwindowClass.style = 0;\n    windowClass.hInstance = instance;\n    windowClass.hCursor = LoadCursor( NULL, IDC_ARROW );\n    windowClass.hbrBackground = (HBRUSH)(COLOR_BTNFACE + 1);\n    windowClass.hIcon = LoadIcon( NULL, IDI_APPLICATION );\n    windowClass.lpszClassName = \"testWindow\";\n    windowClass.lpfnWndProc = windowProc;\n\n    if( !RegisterClass( &amp;windowClass ) )\n    {\n        showMessage( \"Some trouble, sir\" );\n        return GetLastError();\n    }\n\n    HWND window = CreateWindow\n    (\n        \"testWindow\",\n        \"Test Window\",\n        WS_OVERLAPPEDWINDOW,\n        CW_USEDEFAULT, CW_USEDEFAULT,\n        400, 300,\n        NULL, // no parent\n        NULL, // no menu\n        instance,\n        NULL // no 'window-creation data'\n    );\n\n    if( !window ){\n        showMessage( \"Some trouble, sir\" );\n        return GetLastError();\n    }\n\n    ShowWindow( window, showMode );\n\n\n    // add an EDIT box to our window\n    testEditBox = CreateWindow\n    (\n        \"EDIT\",\n        \"input here\",\n        WS_CHILD,\n        10, 10,\n        200, 20,\n        window,\n        NULL,\n        instance,\n        NULL\n    );\n    ShowWindow( testEditBox, SW_SHOW );\n\n    // start message loop\n    MSG message;\n    while( GetMessage( &amp;message, window, 0, 0 ) &gt; 0 )\n    {\n        TranslateMessage( &amp;message );\n        DispatchMessage( &amp;message );\n    }\n\n\n    return message.wParam;\n}\n</code></pre>\n"},{"tags":[".net","windows","winapi","windows-services","windows-installer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":12203411,"title":". msi file fails with \"Product :XXX Configuration failed\" when called","body":"<p><strong>Scenario 1:</strong>\nI run this code from a Windows Service and it fails with the windows event log:</p>\n\n<blockquote>\n  <p>\"Product: XXX -- Configuration failed\"</p>\n</blockquote>\n\n<p><strong>Scenario 2:</strong>\nI run this as a plain exe and it works.</p>\n\n<p>Code I tried :</p>\n\n<pre><code>var installerFilePath = &lt;Path of msi&gt;;\nSystem.Diagnostics.Process installerProcess;                       \ninstallerProcess = System.Diagnostics.Process.Start(installerFilePath, \" /q\");\nwhile (installerProcess.HasExited == false)\n{\n    System.Threading.Thread.Sleep(250);\n}\n</code></pre>\n\n<p>I tried installing the Windows MSIInstaller extra logging but it didnt log anything.</p>\n\n<p>Please advise.</p>\n\n<p>KG</p>\n"},{"tags":["qt","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12195413,"title":"qt how to link win32 libraries","body":"<p>I am using QT Creator 2.4.1. I want to make a network utility. I am using windows function:\nGetAdaptersInfo().</p>\n\n<p>This requires iphlpapi.lib to be linked. </p>\n\n<p>To link the libraries I tried to add following argument in <strong>Projects->Build-Setup->Additional Arguments</strong> :</p>\n\n<p>LIBS += -liphlpapi</p>\n\n<p>or</p>\n\n<p>win32:LIBS += -liphlpapi</p>\n\n<p>or</p>\n\n<p>LIBS += iphlpapi.lib</p>\n\n<p>Without any success. I tried to give full path too. Can anyone tell me whats the correct way of linking?</p>\n"},{"tags":["multithreading","delphi","winapi","indy"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":103,"score":1,"question_id":12196121,"title":"How can I prevent deadlocks in ApplicationRecoveryCallback()?","body":"<p>I have registered my application for <a href=\"http://msdn.microsoft.com/en-us/library/cc948909%28v=vs.85%29\" rel=\"nofollow\">ARR</a>. Assume that my application has a <code>IdTCPServer</code> which reads data from the serial port using <a href=\"http://www.eterlogic.com/Products.VSPE.html\" rel=\"nofollow\"><code>VSPE</code></a> and adds it to a <code>ClientDataSet</code>. If the main thread freezes, ARR will call my ApplicationRecoveryCallback(). Can I access the <code>IdTCPServer</code> in the recovery callback function safely? I want it to stop so that I can save my <code>ClientDataSet</code> to the disk before restarting. Can I simply write my function this way?</p>\n\n<pre><code>function RecoveryFunction(pvParameter: Pointer): DWORD; stdcall;\nvar\n  ContinueRecovery: Boolean;\nbegin\n  Result := 0; // happy compiler ;-)\n  repeat\n    ApplicationRecoveryInProgress(ContinueRecovery);\n    if not ContinueRecovery then\n      ApplicationRecoveryFinished(False);\n  until frmInstrument.CriticalSection.TryEnter;\n  frmInstrument.IdTCPServer.Active := False;\n  frmInstrument.CDS.SaveToFile(RecoveryFile);\n  ApplicationRecoveryFinished(True);\nend;\n</code></pre>\n"},{"tags":["delphi","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":115,"score":4,"question_id":12194404,"title":"How can I use Application Recovery and Restart in Delphi?","body":"<p>MSDN <a href=\"http://msdn.microsoft.com/en-us/library/cc948909%28VS.85%29.aspx\" rel=\"nofollow\">states</a> that \"ARR is designed for C and C++ developers.\" After googling around for a while, I could not find any Delphi example for ARR. Is it possible to use ARR in a Delphi application?</p>\n"},{"tags":["c++","winapi","tooltip"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":153,"score":2,"question_id":11429559,"title":"How to show tool tip on click on static control and hide tool tip when clicked elsewhere using specifically win32 c++ api","body":"<p>I know how to normally make tool tip. But the problem is tool tip appears when mouse pointer is over control. I want tool tip to appear when static control is clicked.</p>\n\n<p>I want to show tool tip only when user clicks the static control and hide the tool tip if user clicks outside the control. What messages should be handled and how to proceed? Any help will be highly appreciated...</p>\n"},{"tags":["multithreading","delphi","winapi","ipc"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":139,"score":1,"question_id":12194216,"title":"What is the proper way to use CreateRemoteThread to inject code into another process in Delphi?","body":"<p>I read on <a href=\"http://blogs.msdn.com/b/oldnewthing/archive/2004/07/22/191123.aspx\" rel=\"nofollow\">this blog</a> that sysinernals uses <code>CreateRemoteThread()</code> to inject <code>ExitProcess</code> into another process to terminate it. Is it true? And, if yes, can someone show me how to do it in my Delphi application? I want to terminate the process which started my application.</p>\n"},{"tags":["c++","winapi","listview","common-controls"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12195174,"title":"How can I permanently change the color of an item in a ListView?","body":"<p>I have create list a listview</p>\n\n<pre><code>list[0]=CreateWindow(WC_LISTVIEW,L\"\",WS_DLGFRAME|WS_CHILD|WS_VISIBLE|LVS_REPORT|LVS_SINGLESEL,-,-,-,-,hwnd,NULL,hInstance,NULL);\nLVCOLUMN lvcolumn;\n    lvcolumn.mask = LVCF_FMT|LVCF_TEXT|LVCF_WIDTH;\n    lvcolumn.fmt = LVCFMT_CENTER;\n    lvcolumn.pszText = L\"a\";\n    lvcolumn.cx = 100;\n    ListView_InsertColumn(list[0],0,&amp;lvcolumn);\n    lvcolumn.pszText = L\"b\";\n    ListView_InsertColumn(list[0],1,&amp;lvcolumn);\n    lvcolumn.pszText = L\"c\";\n    ListView_InsertColumn(list[0],2,&amp;lvcolumn);\n    lvcolumn.pszText = L\"d\";\n    ListView_InsertColumn(list[0],3,&amp;lvcolumn);\n</code></pre>\n\n<p>And I use LPNMLVCUSTOMDRAW to insert color item</p>\n\n<pre><code>    case WM_NOTIFY:\n                    if( ((LPNMHDR)lParam)-&gt;code == NM_CUSTOMDRAW){\n                                switch( ((LPNMLVCUSTOMDRAW)lParam)-&gt;nmcd.dwDrawStage){\n                                    case CDDS_PREPAINT:\n                                        return CDRF_NOTIFYITEMDRAW;\n                                        break;\n                                    case CDDS_ITEMPREPAINT:\n                                    {\n                                    LPNMLVCUSTOMDRAW customDraw = (LPNMLVCUSTOMDRAW)lParam;\n\n              customDraw-&gt;clrText = getcolor();\n                                        return CDRF_NEWFONT;\n                                        break;\n                                    }\n                                    default: return CDRF_DODEFAULT;\n                                }\n                            }\n                    break;\n</code></pre>\n\n<p>getcolor is function response colorref. Each item have it own text color. But when the parent window is hide and show again the item color is change. So how to keep it not change or we have another way to set text color</p>\n\n<p>One more I create an new listview item by this way (in case someone need it)</p>\n\n<pre><code>ListView_InsertItem(hwndlist,&amp;lvitem);\nListView_SetItemText(hwndlist,i,k,(LPWSTR)strarr[k].c_str());\n</code></pre>\n"},{"tags":["php","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2047,"score":1,"question_id":1411657,"title":"How do I make Win32 API calls from PHP?","body":"<p>I know that I can consume COM components but is there a way to directly call into the Win32 API's (user32.dll, advapi32.dll etc) from PHP or do I need to wrap in a PHP extension or COM object?</p>\n"},{"tags":["winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":11808410,"title":"Registering Window Class","body":"<p>I guess my question is relatively easy for those of you who spent time dealing with Win32 API.</p>\n\n<p>So my question is:\n<br/>After initializing a WNDCLASSEX instance we need to \"register\" it using the \"RegisterClassEx\" function, why? Why do we do that? What's the meaning of this registration and in what cases I need to register things?</p>\n"},{"tags":["windows","winapi","error-code"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":71,"score":0,"question_id":12175430,"title":"'net stop spooler' fails with exit code 259","body":"<p>I launch 'net stop spooler' using CreateProcess from my C++ program. It fails and the exit code is 259.</p>\n\n<p>Anyone know what that error code means? Also if someone can give me a link to some documentation about the possible error codes for this command and their meanings I'd much appreciate it.</p>\n"},{"tags":["c++","winapi","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12191262,"title":"why receive wrong message in MFC instead of timer message?","body":"<p>I have a class ClistCtrlEx class that  inherits from ClistCtrl.</p>\n\n<p>I add </p>\n\n<ul>\n<li>ON_WM_TIMER() to message table</li>\n<li>OnTimer function</li>\n</ul>\n\n<p>but before that call to SetTimer function program recevice WM_TIMER messages by event id 45 and when I call to SetTimer don't send WM_TIMER at all.</p>\n\n<p>how I can start to debug it or fix the problem ?</p>\n"},{"tags":["windows","delphi","winapi","mdi"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":246,"score":4,"question_id":12178720,"title":"How to hide a MDI Child form in Delphi?","body":"<p>How can I hide a MDIChild window in Delphi?</p>\n\n<p>I'm using this code in FormClose() event of my MDI children, but it doesn't seem to work:</p>\n\n<pre><code>procedure TfrmInstrument.FormClose(Sender: TObject; var Action: TCloseAction);\nbegin\n  Action := caNone;\n  ShowWindow(Handle, SW_HIDE);\n  frmMainForm.MDIChildClosed(Handle);\nend;\n</code></pre>\n\n<p>My child window is minimized instead of being hidden.</p>\n"},{"tags":["c++","winapi","event-log"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12190574,"title":"How can I register app with * in the name for the event log?","body":"<p>I'm trying to register my Windows local service that has an asterisk (*) in the name in the event log. I follow instructions <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa363661%28v=vs.85%29.aspx\" rel=\"nofollow\">here</a> and then the call to <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa363678%28v=vs.85%29.aspx\" rel=\"nofollow\">RegisterEventSource</a> with that name succeeds and events are logged OK, but when I try to view them in the Windows Event Viewer all my entries have the following attached to them:</p>\n\n<blockquote>\n  <p>The description for event ID for source App*Name could not be found.</p>\n</blockquote>\n\n<p>This happens only on OS earlier than Windows 7. Also if I remove the asterisk everything works OK.</p>\n\n<p>Any idea how to fix this? Well, besides dropping the asterisk from the app name :)</p>\n"},{"tags":["c++","winapi","device","wlan","setupapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":119,"score":0,"question_id":12172586,"title":"SetupDiGetClassDevs with DIGCF_PRESENT, Not all present devices are found","body":"<p>I've a problem with <code>SetupDiGetClassDevs</code> call in combination with <code>DIGCF_PRESENT</code> flag. Following code snippet is working as expected on my development system (Windows 7), but not on Windows 7 Embedded system.</p>\n\n<p>What is not working? SetupDiEnumDeviceInfo don't include the USB WLAN network interface on my embedded device as long as <code>DIGCF_PRESENT</code> flag is set. On my development system the same device is included in the list. Without this flag the device is included on both systems.</p>\n\n<p>The USB WLAN stick is working properly on both systems. What could cause this behaviour?</p>\n\n<pre><code>    GUID ClassGuidNetwork = {\n        0x4D36E972,\n        0xE325,\n        0x11CE,\n        {0xbf, 0xc1, 0x08, 0x00, 0x2b, 0xe1, 0x03, 0x18}\n    };\n\n    HDEVINFO hDevList = ::SetupDiGetClassDevs(&amp;ClassGuidNetwork, 0, 0, DIGCF_PRESENT);\n    if (hDevList != INVALID_HANDLE_VALUE) {\n        SP_DEVINFO_DATA Did = {0};\n        Did.cbSize = sizeof(SP_DEVINFO_DATA);\n\n        unsigned int j = 0;\n        while (SetupDiEnumDeviceInfo(hDevList, j, &amp;Did)) {\n        // ...\n        }\n        // ...\n    }\n</code></pre>\n"},{"tags":["windows","winapi","visual-c++","usb","hid"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12190399,"title":"USB ReadFile() works only after the third time?","body":"<p>I am developing a custom USB HID device with both IN and OUT interrupt endpoints of 64 bytes length each. There are 2 reports (one with report ID 1 and other with report ID 2) with report count of 63 bytes each. When the PC app developed in VC++ sends a 64 byte buffer using WriteFile(), I receive the entire buffer properly at the device on the OUT interrupt endpoint. But when I send a 64 byte buffer from the device to the PC on the IN endpoint, the ReadFile() returns with a value of 4 (timeout). This happens only 2 times when the device is plugged in. After that everything works fine and the PC reads the 64 bytes sent by the device properly. </p>\n\n<p>I am using USBlyzer tool to sniff the USB bus traffic. That software shows that for the first two times the device sends a 64 byte buffer on the interrupt IN endpoint, but it too is not able to show the data in it. And the 3rd time onwards, everything works magically, both PC application and USBlyzer receive and display the 64 bytes buffer contents on the screen. </p>\n\n<p>I am not sure where exactly the problem lies, is it on the PC side code or in the device firmware? Please share your thoughts.</p>\n"},{"tags":["c++","winapi"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":158,"score":3,"question_id":11884021,"title":"C++ : Why this window title gets truncated?","body":"<p>Visual C++ 2012 RC, Win7</p>\n\n<p>Chinese simplified</p>\n\n<p>Project Properties > use multi byte character set</p>\n\n<p>When I run this program, the window's title shows a single letter \"S\", not a whole word \"Sample\".</p>\n\n<pre><code>#pragma comment(linker, \"/SubSystem:Windows\")\n\n#include &lt;windows.h&gt;\n\nint WINAPI WinMain(HINSTANCE hInstance, HINSTANCE, PSTR, int) {\n    WNDCLASSW wc = { 0 };\n\n    wc.style            = CS_VREDRAW | CS_HREDRAW;\n    wc.hInstance        = hInstance;\n    wc.hIcon            = LoadIcon(nullptr, IDI_APPLICATION);\n    wc.hCursor          = LoadCursor(nullptr, IDC_ARROW);\n    wc.hbrBackground    = reinterpret_cast&lt;HBRUSH&gt;(GetStockObject(WHITE_BRUSH));\n    wc.lpszClassName    = L\"MyWindowClass\";\n\n    wc.lpfnWndProc = [](HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam) {\n        if (uMsg - WM_DESTROY)\n            return DefWindowProc(hWnd, uMsg, wParam, lParam);\n        else {\n            PostQuitMessage(0);\n            return HRESULT();\n        }\n    };\n\n    RegisterClassW(&amp;wc);\n\n    CreateWindowExW(0, L\"MyWindowClass\", L\"Sample\",\n        WS_OVERLAPPEDWINDOW | WS_VISIBLE, CW_USEDEFAULT, SW_SHOW, CW_USEDEFAULT, 0,\n        nullptr, nullptr, hInstance, nullptr);\n\n    for (MSG msg; GetMessage(&amp;msg, nullptr, 0, 0); DispatchMessage(&amp;msg));\n}\n</code></pre>\n\n<p>If I use Unicode (Project Properties), keep source code unchanged, window title shows \"Sample\", looks correct.</p>\n\n<p>If I use multi byte, in source code I use WNDCLASS = { ..., \"MyWindowClass\" } and RegisterClassA, keep CreateWindowExW unchanged, window title shows word \"Sample\", looks correct.</p>\n\n<p>If I use multi byte, in source code I use CreateWindowExA(\"MyWindowClass\", \"Sample\"), keep WNDCLASSW and RegisterClassW unchanged, window title shows letter \"S\".</p>\n\n<p>What makes it show a single \"S\", am I doing something wrong?</p>\n\n<p><strong>Append</strong></p>\n\n<p>If I keep all unchanged, that is, use multi byte, use code shown above, window title shows letter \"S\".</p>\n\n<p>(If you run this program and see \"Sample\" on window title, rather than \"S\", then it's more likely a specific problem on chs version of vc++ 2012 (or OS)).</p>\n"},{"tags":["winapi","gdi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":12189163,"title":"create HBITMAP with alpha channel from BMP files","body":"<p>I started with a PNG image. I then split the alpha channel into a grey scale BMP file and converted the PNG into a BMP.\nI would like to load both BMP files and merge them to give a HBITMAP with an alpha channel:</p>\n\n<pre><code>HBITMAP splash = LoadBitmap(hInstance, MAKEINTRESOURCE(IDB_SPLASH));\nHBITMAP splashMask = LoadBitmap(hInstance, MAKEINTRESOURCE(IDB_SPLASH_MASK));\nHBITMAP splashAlpha = ....\n</code></pre>\n\n<p>I found an <a href=\"http://code.logos.com/blog/2008/09/displaying_a_splash_screen_with_c_part_i.html\" rel=\"nofollow\">example</a> of creating a HBITMAP directly from a PNG. It uses IStream and COM to do the import. I'd rather not include more dependencies. Surely there is a better way to do this?</p>\n"},{"tags":["python","winapi","ctypes","dde"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":134,"score":0,"question_id":12189592,"title":"Python and DDE - connection","body":"<p>I'm trying to write some app using windows' DDE and Python's ctypes.\nI know there is a library written DDE but it has some features that make it unsuitable for my problems.</p>\n\n<p>As reference I used this example:\n<a href=\"http://code.activestate.com/recipes/577654-dde-client/\" rel=\"nofollow\">http://code.activestate.com/recipes/577654-dde-client/</a> (it has a lot of mistakes and does not ran as is)\nand an excerpt from the book on C++ (I think it is C++) in my language <a href=\"http://frolov-lib.ru/books/bsp/v17/ch3.htm\" rel=\"nofollow\">http://frolov-lib.ru/books/bsp/v17/ch3.htm</a> .\nI do not know C++ so I made ​​by analogy.</p>\n\n<p>I found some problems with establishing a connection between the client and the server.</p>\n\n<p>I guess I do not understand some important aspects of Windows programming and because of that I would not succeed.</p>\n\n<p>Help please.</p>\n\n<p>Now I have some definitions from activestate's code and this:\n(simplified a little)</p>\n\n<pre><code># wrapped functions\nDDECALLBACK = WINFUNCTYPE(HDDEDATA, UINT, UINT, HCONV, HSZ, HSZ, HDDEDATA, ULONG_PTR, ULONG_PTR)\nDDE_Initialize = get_winfunc(\"user32\", \"DdeInitializeW\", UINT, (LPDWORD, DDECALLBACK, DWORD, DWORD))\nDDE_Uninitialize = get_winfunc(\"user32\", \"DdeUninitialize\", BOOL, (DWORD,))\nDDE_CreateStringHandle = get_winfunc(\"user32\", \"DdeCreateStringHandleW\", HSZ, (DWORD, LPCWSTR, UINT))\nDDE_FreeStringHandle = get_winfunc(\"user32\", \"DdeFreeStringHandle\", BOOL, (DWORD, HSZ))\nDDE_NameService = get_winfunc(\"user32\",\"DdeNameService\", HDDEDATA, (DWORD,HSZ,HSZ,UINT) )\nDDE_QueryString = get_winfunc(\"user32\", \"DdeQueryStringW\", DWORD, (DWORD, HSZ, LPSTR, DWORD, c_int))\nDDE_Connect = get_winfunc(\"user32\", \"DdeConnect\", HCONV, (DWORD, HSZ, HSZ, PCONVCONTEXT))\nDDE_Disconnect = get_winfunc(\"user32\", \"DdeDisconnect\", BOOL, (HCONV,))\n\nclass DDE_Server(object):\n    def __init__(self, service, topic, item):\n        self.idInst = DWORD(0)\n        DDE_Initialize(byref(self.idInst), DDECALLBACK(self.cb), APPCLASS_STANDARD, 0) # Ok\n        self.hszService  = DDE_CreateStringHandle(self.idInst, service, 1200) # Ok\n        DDE_NameService(self.idInst, self.hszService, 0, DNS_REGISTER) # Ok\n        self.hszTopic = DDE_CreateStringHandle(self.idInst, topic, 1200) # Ok\n        self.hszItem = DDE_CreateStringHandle(self.idInst, item, 1200) # Ok\n    def cb(self, *a, **k):\n        print *a, **k\n        return 1;\n\nclass DDE_Client(object):\n    def __init__(self, service, topic, item):\n        self.idInst = DWORD(0)\n        DDE_Initialize(byref(self.idInst), DDECALLBACK(self.cb), APPCLASS_STANDARD, 0) # Ok\n        self.hszService  = DDE_CreateStringHandle(self.idInst, service, 1200) # Ok\n        self.hszTopic = DDE_CreateStringHandle(self.idInst, topic, 1200) # Ok\n        self.hszItem = DDE_CreateStringHandle(self.idInst, item, 1200) # Ok\n    def cb(self, *a, **k):\n        print *a, **k\n        return 1;\n    def connect(self):\n        self.hConv = DDE_Connect(self.idInst, self.hszService, self.hszTopic, PCONVCONTEXT())\n</code></pre>\n\n<p>Then I ran this:</p>\n\n<pre><code>srv = DDE_Server('DDES','DDEST','DDESI')\nclt = DDE_Client('DDES','DDEST','DDESI')\nclt.connect()\n</code></pre>\n\n<p>Server is created ok, the client is created ok, I checked.\nBut the connection is not established. I tried to do that in different threads, in a single script, and in different scripts.</p>\n\n<p>Constantly, <code>self.hConv = None</code> and callbacks are not called.</p>\n\n<p>What am I doing wrong?\nWhere to fix?</p>\n"},{"tags":["winapi","windows-7","multiple-monitors"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12189139,"title":"Windows 7 monitor swapping bug","body":"<p>I wrote a small application to switch the primary monitor on button click as follows:</p>\n\n<pre><code>Monitor 0 --&gt; Monitor 1 --&gt; Monitor 2\n</code></pre>\n\n<p>For every button click, the primary monitor switches between the three. </p>\n\n<p>I am able to successfully switch the monitor every time I click the button and the monitor coordinates are supposed to be</p>\n\n<pre><code>(0,0)\n(1920,0)\n(3840,0)\n</code></pre>\n\n<p>I am also able to achieve it under all the three cases. However, when I try to switch the monitor from Monitor 2 to Monitor 0, the monitor coordinates returned are:</p>\n\n<pre><code>(0,0)\n(0,0)\n(1920,0)\n</code></pre>\n\n<p>The ChangeDisplaySettingEx function does not return any error and monitors just work as they are expected. Since the coordinates returned are incorrect, the windows that I am trying to position are placed incorrectly. The window that has to be placed on the second screen gets placed on the first.</p>\n\n<p>Here is a code sample of how I am currently switching monitors:</p>\n\n<pre><code>             next_position++;\n\n        if(next_position&gt;2)\n        {\n            next_position=0;            \n        }\n\n     POINTL posPrimary={0};\n     posPrimary.x=0\n     posPrimary.y=0;\n\n     DEVMODE mode_primary = {0};\n     mode_primary.dmSize = sizeof(mode_primary);\n     mode_primary.dmFields = DM_POSITION;\n     mode_primary.dmPosition = posPrimary;\n\n    LONG status = ChangeDisplaySettingsEx(\n        nameofMonitor[next_position],\n        &amp;mode_primary,\n        nullptr, // reserved\n       CDS_SET_PRIMARY | CDS_UPDATEREGISTRY,\n        nullptr // no video parameter\n    );\n      if (DISP_CHANGE_SUCCESSFUL != status) {\n        printf(\"ChangeDisplaySettingsEx returned %d\", status);\n        return -__LINE__;\n    }\n\n    int m =1;\n    for(int var =0; var&lt;=2;var++)\n    {\n\n         posPrimary.y=0;\n         posPrimary.x=dxWidthPrimary*m;\n         m++;\n         DEVMODE mode_primary = {0};\n         mode_primary.dmSize = sizeof(mode_primary);\n         mode_primary.dmFields = DM_POSITION;\n         mode_primary.dmPosition = posPrimary;\n\n        if(var!=next_position)\n        {\n        status = ChangeDisplaySettingsEx(\n        nameofMonitor[var],\n        &amp;mode_primary,\n        nullptr, // reserved\n       CDS_GLOBAL | CDS_UPDATEREGISTRY,\n        nullptr // no video parameter\n    );\n          if (DISP_CHANGE_SUCCESSFUL != status) {\n        printf(\"ChangeDisplaySettingsEx returned %d\", status);\n        return -__LINE__;\n    }\n        }\n    }\n\n\n    ChangeDisplaySettingsEx (NULL, NULL, NULL, 0, NULL);\n</code></pre>\n\n<p>Since my code works as expected, should I just override this faulty condition by changing (0,0) to (3840,0)? I am not able to find the problem here</p>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":104,"score":2,"question_id":12180732,"title":"Do I need to adjust token privileges in order to successfully call CreateRemoteThread?","body":"<p>I'm developing a debugging facility for my application to help me diagnose deadlocks. The application runs on my client's machines and so I expect a wide range of operating systems, security policies etc.</p>\n\n<p>The technique I am using is to implement a function in the target application which generates stack traces for all threads, together with other diagnostics information. This is then written to a memory mapped file. I am also creating a utility application that is used to trigger the creation of the diagnostics report, and then read it from the memory mapped file.</p>\n\n<p>Because the target application is expected to be dead, the utility program can't send it a message to trigger the diagnostics collection. Instead I am using <code>CreateRemoteThread</code> so that I can be sure to get a live thread to do the work.</p>\n\n<p>Note that this is different from DLL injection methods which typically use <code>LoadLibrary</code> as the thread proc for <code>CreateRemoteThread</code>. My thread proc is an entry point in the target application. So, I don't need to call <code>WriteProcessMemory</code>.</p>\n\n<p>I've implemented this and in my test environments it works well. According to the documentation of <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms682437.aspx\" rel=\"nofollow\"><code>CreateRemoteThread</code></a>, I need a process handle with the following access rights:</p>\n\n<blockquote>\n  <p><code>PROCESS_CREATE_THREAD</code>, <code>PROCESS_QUERY_INFORMATION</code>, <code>PROCESS_VM_OPERATION</code>, <code>PROCESS_VM_WRITE</code>, and <code>PROCESS_VM_READ</code></p>\n</blockquote>\n\n<p>So, I passed those flags when calling <code>OpenProcess</code>.</p>\n\n<p>Now, at last, to my question: what privileges do I need my token to have in order for the call to <code>OpenProcess</code> to succeed?</p>\n\n<p>In my test environment (Windows 7, UAC enabled, admin user), I have encountered no problems with just a default token. I have seen various sample code that acquires the <code>SE_DEBUG_NAME</code> privilege before calling <code>OpenProcess</code>. My guess is that is needed for <code>WriteProcessMemory</code> when doing DLL injection and that I don't need that privilege. Are there scenarios where I would need to adjust my token's privileges?</p>\n\n<p>I know precisely nothing about Windows security so I would really appreciate wise words from anyone that does!</p>\n"},{"tags":["c","winapi","background","tooltip","transparent"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12186250,"title":"transparent background on tooltip control","body":"<p>I was able to do custom painting on the tooltip control, by disable its visual style.</p>\n\n<p>I am curious that if we can make the tooltip control to be \"Layered\" (i.e transparent).</p>\n\n<p>I tried to add WS_EX_LAYERED style on it and call</p>\n\n<pre><code>SetLayeredWindowAttributes(hwndTooltip, 0, 50, LWA_ALPHA);\n</code></pre>\n\n<p>But it doesn't become transparent.</p>\n\n<p>I did this for the manin window and the main window become transparent.</p>\n\n<p>After searching, there is no further information about how to make tooltip transparent.</p>\n\n<p>So <code>How to make tooltip control transparent background?</code></p>\n\n<p>p.s: hwndTooltip is a child of Desktop, not of main window.</p>\n"},{"tags":["winapi","user-interface","frameworks","automation","treeview"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12172843,"title":"Multi selection Tree in .NET ( visible in UIA ) with win32 treeview?","body":"<p>I need a treeview in .net with supported multi selection.\nA own implementation in wpf or winforms ( this two don't have multi selection out of the box !? ) is a no go, i need the multi selection visible in the ms ui automation framework.</p>\n\n<p>Do anyone know if this is possible with the win32 treeview ? Or know a way how to implement multiselection in wpf / winforms which is also visible in the automation framework ?</p>\n"},{"tags":["c++","winapi","char","file-read","editcontrol"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":146,"score":1,"question_id":12184430,"title":"Win32 Edit Control shows '|' like symbol for each new line","body":"<p>I am reading text from a file and showing in an edit control. The file has multiple lines. But whenever a line ends, the edit control is showing a '|' symbol and then goes to the new line.</p>\n\n<p>For example, if the content of the file is</p>\n\n<pre><code>First\nSecond\nThird\n</code></pre>\n\n<p>The edit control shows</p>\n\n<pre><code>First|\nSecond|\nThird\n</code></pre>\n\n<p>Note that, the edit control shows the pipe symbol, <strong>and then goes to a new line</strong>. I think that symbol represents either \\n or \\r which it couldn't show properly. But when I display the same text inside the loop using a MessageBox() function, I don't get the pipe symbol at the end each line.</p>\n\n<p><strong>Here is the relevent portion of my code:</strong></p>\n\n<pre><code>TCHAR buffer[256];\nTCHAR file[256] = L\"C:\\\\Documents and Settings\\\\Dil\\\\Desktop\\\\Test.txt\";\nFILE* fp;\n\n_wfopen_s(&amp;fp, file, L\"rt\");\nwhile(fgetws(buffer, sizeof(buffer), fp) != NULL)\n{\n  int len = GetWindowTextLength(hDestEdit);\n  SendMessage(hDestEdit, EM_SETSEL, (WPARAM)len, (LPARAM)len);\n  SendMessage(hDestEdit, EM_REPLACESEL, 0, reinterpret_cast&lt;LPARAM&gt;(buffer));\n}\nfclose(fp);\n</code></pre>\n\n<p><strong>Code used to create the edit control:</strong></p>\n\n<pre><code>hDestEdit = CreateWindowEx(\n    WS_EX_CLIENTEDGE, L\"EDIT\", L\"\",\n    ES_MULTILINE|ES_AUTOVSCROLL|ES_AUTOHSCROLL|WS_TABSTOP|WS_VISIBLE|WS_CHILD,\n    100,100,400,300, hWnd, (HMENU)IDC_DEST_EDIT, GetModuleHandle(NULL), NULL);\n</code></pre>\n\n<p>How can I stop that weird character from showing up inside the edit control?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>I checked using debugger. For each line that is read into <code>buffer</code>, the final character before the null terminator is 0x000a - the line feed. The carriage return 0x000D is not present.</p>\n\n<p><strong>Edit 2</strong></p>\n\n<p>I tried the following code; the pipes are not there at end of each line, but I get 8 or 9 continuous pipes at the end of the last line. I am unable to inspect ndividual characters of <em>buffer</em> in the debugger.</p>\n\n<pre><code>TCHAR * buffer;\nint length;\nwifstream is;\nis.open (file, ios::binary );\n\n// get length of file:\nis.seekg (0, ios::end);\nlength = is.tellg();\nis.seekg (0, ios::beg);\n\n// allocate memory:\nbuffer = new TCHAR [length];\n\n// read data as a block:\nis.read (buffer,length);\nis.close();\n\n// send message to edit control\nint len = GetWindowTextLength(hDestEdit);\nSendMessage(hDestEdit, EM_SETSEL, (WPARAM)len, (LPARAM)len);\nSendMessage(hDestEdit, EM_REPLACESEL, 0, reinterpret_cast&lt;LPARAM&gt;(buffer));\n</code></pre>\n"},{"tags":["winapi","printing","createfile"],"answer_count":3,"favorite_count":1,"up_vote_count":10,"down_vote_count":0,"view_count":707,"score":10,"question_id":10651949,"title":"Figuring which printer name corresponds to which device ID","body":"<p>My goal is to open a printer connected via USB using the <code>CreateFile</code> (and then issue some <code>WriteFile</code>s and <code>ReadFile</code>s).</p>\n\n<p>If the printer was an LPT one, I would simply do <code>CreateFile(\"LPT1:\", ...)</code>. But for USB printers, there is a special device path that must be passed to <code>CreateFile</code> in order to open that printer.</p>\n\n<p>This device path, <a href=\"http://www.dreamincode.net/forums/topic/52713-communicating-with-usb-printer/\">as I was able to find</a>, is retrieved via <a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff551069.aspx\"><code>SetupDiGetClassDevs</code></a> -> <a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff551015.aspx\"><code>SetupDiEnumDeviceInterfaces</code></a> -> <a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff551120.aspx\"><code>SetupDiGetDeviceInterfaceDetail</code></a> -> <a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff552343.aspx\"><code>DevicePath</code> member</a> and looks like this:</p>\n\n<blockquote>\n  <p><code>\\\\?\\usb#vid_0a5f&amp;pid_0027#46a072900549#{28d78fad-5a12-11d1-ae5b-0000f803a8c2}</code></p>\n</blockquote>\n\n<p>All that is fine, but what I have as the input is the human-readable printer name, as seen in <code>Devices and Printers</code>. The <code>SetupDi*</code> functions don't seem to use that, they only operate on <a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff541327.aspx\">device instance IDs</a>. So the question is now <strong>how to get device instance ID from the printer name one would pass to <code>OpenPrinter</code></strong>.</p>\n\n<p>It's not difficult to observe that the GUID part of the above is the <code>GUID_DEVINTERFACE_USBPRINT</code>, and <code>\\\\?\\usb</code> is fixed, so the only bit I'm really interested in is <code>vid_0a5f&amp;pid_0027#46a072900549#</code>. This path I can easily look up manually in the printer properties dialog:</p>\n\n<blockquote>\n  <p>Go to Devices and Printers<br>\n  Right-click the printer<br>\n  Properties<br>\n  Switch to Hardware tab<br>\n  Select the printing device, such as ZDesigner LP2844-Z<br>\n  Properties<br>\n  Switch to Details tab<br>\n  Select 'Parent' from the dropdown.</p>\n</blockquote>\n\n<p>But I have no idea how to do that programmatically provided the only thing given is the printer name as seen in the Device and Printers panel.</p>\n\n<hr>\n\n<p>P.S. 1: I'm not interested in opening the printer with <code>OpenPrinter</code> and then using <code>WritePrinter</code> / <code>ReadPrinter</code>. That has been done, works fine, but now the goal is different.</p>\n\n<p>P.S. 2: <strong>I'll be OK with a simpler way to convert the readable printer name to something that can be passed to <code>CreateFile</code></strong>.</p>\n\n<p>P.S. 3: <a href=\"http://stackoverflow.com/questions/1846340/reading-status-from-zebra-printer\">This question</a>, to which I have posted an <a href=\"http://stackoverflow.com/a/10659778/11683\">answer</a>, is very related to what I ultimately want to do.</p>\n\n<p>P.S. 4: The other way round is also fine: <strong>If it is possible to obtain the readable name from the <a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff552344.aspx\"><code>SP_DEVINFO_DATA</code></a> structure, that will also be the answer</strong>, although a less convenient one.</p>\n"},{"tags":["winapi","usb","harddrive"],"answer_count":5,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":3488,"score":2,"question_id":220123,"title":"How do I detected whether a hard drive is connected via USB?","body":"<p>I am trying to write a little backup program for friends and family and want it to be as simple to use a possible. I don't want to have to ask the user where to backup their data to, I just want to search for and use the first USB hard drive connected to the computer. Obtaining the unique ID of the hard drive would probably be a good idea too, just as a double check for next time the backup runs.</p>\n"},{"tags":["winapi","interop","internet-explorer-9","com-interop","bho"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12170004,"title":"SetWinEventHook crahes IE when used in BHO (Browser Helper Object)","body":"<p>I have a C# BHO which sets a hook so that I can track when IE gets focus:</p>\n\n<pre><code>public class BHO : IObjectWithSite, IOleCommandTarget\n{\n    delegate void WinEventDelegate(IntPtr hWinEventHook,\n       uint eventType, IntPtr hwnd, int idObject,\n       int idChild, uint dwEventThread, uint dwmsEventTime);\n\n    const uint WINEVENT_OUTOFCONTEXT = 0;\n    const uint EVENT_SYSTEM_FOREGROUND = 3;\n\n    [DllImport(\"user32.dll\")]\n    static extern bool UnhookWinEvent(IntPtr hWinEventHook);\n    [DllImport(\"user32.dll\")]\n    static extern IntPtr SetWinEventHook(uint eventMin,\n        uint eventMax, IntPtr hmodWinEventProc,\n        WinEventDelegate lpfnWinEventProc, uint idProcess,\n        uint idThread, uint dwFlags);\n\n   private static IntPtr m_hhook; \n\n\n       ............\n\n        m_hhook = SetWinEventHook(EVENT_SYSTEM_FOREGROUND,\n           EVENT_SYSTEM_FOREGROUND, IntPtr.Zero,\n           WinEventProc, 0, 0, WINEVENT_OUTOFCONTEXT);\n\n\n\n       ............\n\n\n   void WinEventProc(IntPtr hWinEventHook, uint eventType,\n             IntPtr hwnd, int idObject, int idChild,\n             uint dwEventThread, uint dwmsEventTime)\n    {\n\n    }\n</code></pre>\n\n<p>It works for a while and then IE crashes with \"Attempted to read or write protected memory. This is often an indication that other memory is corrupt\"</p>\n\n<p>Note that it crashes even when there is nothing in WinEventProc (as shown above). If I don't set the hook, it never crashes.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["winapi","firefox","registry"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1224,"score":0,"question_id":1243037,"title":"How to get the install directory from registryusing win32 API","body":"<p>I am using <code>RegOpenKeyEx()</code> and giving registry path <code>Software\\\\Mozilla\\\\Mozilla Firefox</code> ,its giving <code>error_sucess</code>.</p>\n\n<p>But after that how can I get the install directory <code>Data</code> of Mozilla Firefox from that path using <code>RegQueryValueEx()</code>?</p>\n"},{"tags":["windows","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12179631,"title":"regsvr32 and standard output","body":"<p>The <code>regsvr32</code> utility suppresses standard output. For example:</p>\n\n<pre><code>STDAPI DllRegisterServer(void)\n{\n    std::cout &lt;&lt; \"RegisterServer\\n\";\n    return S_OK;\n}\n</code></pre>\n\n<p>When executed with:</p>\n\n<blockquote>\n  <p>regsvr32 my.dll</p>\n</blockquote>\n\n<p>nothing appears in standard ouput (the successful message box is displayed). Is there anyway to make standard output appear?</p>\n"},{"tags":["winapi","hook","setwindowshookex","findwindow"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":83,"score":1,"question_id":12169777,"title":"Local Hook not working","body":"<p>I have an application and wish to monitor <em>MSWord</em> keypressing (LOCAL HOOK), but I cant figure out how to find the pid to be used! The bellow CODE WORKS GOOD with global hook (<code>pid</code> = <code>0</code>) and with (<code>pid</code> = <code>GetCurrentThreadId</code>). But doesn´t work with <code>GetWindowThreadProcessId</code>:</p>\n\n<pre><code>      HWND hWindow = FindWindowEx(NULL,NULL,String(\"Notepad\").w_str(),NULL);\nif (!hWindow) {\n   ShowMessage(\"hWindow fail\");\n   return;\n}\n\nunsigned long pid;\nGetWindowThreadProcessId(hWindow ,&amp;pid);\n\n//pid = GetCurrentThreadId();\nif (!hWindow) {\n   ShowMessage(\"pid fail\");\n   return;\n}\n\nString s = \"HookDLL.dll\";\nDllHandle=LoadLibrary(s.w_str());\nHOOKFCT_2 InstHook=reinterpret_cast&lt;HOOKFCT_2&gt; (GetProcAddress(DllHandle,\"InstallHook\"));\n\nif(!InstHook(pid, (void *)(callIt) ))\n{\n    Label1-&gt;Caption=\"Unable to install mouse hook!\";\n}\nelse Label1-&gt;Caption=\"Mouse hook installed!\";\n</code></pre>\n\n<p>I will be very, very gratefuLl for any light on the problem...</p>\n\n<p>Notice:</p>\n\n<ol>\n<li><p>I wish a hook to <em>MSWord</em> only.</p></li>\n<li><p>The above code works, failling only when trying to hook on another application (i.e.: not using <code>pid</code>=<code>0</code> or <code>pid</code>=<code>GetCurrentThreadId</code>), resulting in = <em>\"Unable to install mouse hook!\"</em>.</p></li>\n<li><p>I already try <code>FindWindow</code>, <code>FindWindowEx</code>, <code>GetForegroundWindow</code>, <code>GetActiveWindow</code>; since not of this works, I belive the problem is <code>GetWindowThreadProcessId</code>.</p></li>\n</ol>\n"},{"tags":["c#","c++","winapi","dll","hook"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":185,"score":2,"question_id":12115244,"title":"Strange behaviour of windows hooks","body":"<p>I was looking for a possibility to be notified in a .NET windows application when any window is activated in the OS (Windows XP 32-bit). On CodeProject I have found a solution by using global system hooks.</p>\n\n<p><a href=\"http://www.codeproject.com/Articles/18638/Using-Window-Messages-to-Implement-Global-System-H\" rel=\"nofollow\">http://www.codeproject.com/Articles/18638/Using-Window-Messages-to-Implement-Global-System-H</a> .</p>\n\n<p>Here is a short summary of this procedure:</p>\n\n<p>In an unmanaged assembly (written in C++) a method is implemented which installs the <code>WH_CBT</code> hook.</p>\n\n<pre><code>bool InitializeCbtHook(int threadID, HWND destination) \n{ \n    if (g_appInstance == NULL) \n    { \n       return false; \n    }  \n\n    if (GetProp(GetDesktopWindow(), \" HOOK_HWND_CBT\") != NULL) \n    { \n        SendNotifyMessage((HWND)GetProp(GetDesktopWindow(), \"HOOK_HWND_CBT\"), \n            RegisterWindowMessage(\"HOOK_CBT_REPLACED\"),  0, 0); \n    } \n\n    SetProp(GetDesktopWindow(), \" HOOK_HWND_CBT\", destination); \n\n\n    hookCbt = SetWindowsHookEx(WH_CBT, (HOOKPROC)CbtHookCallback,     g_appInstance, threadID); \n\n    return hookCbt != NULL; \n\n} \n</code></pre>\n\n<p>In the callback method (filter function) depending on the hook type windows messages are sent to a destination window.</p>\n\n<pre><code>static LRESULT CALLBACK CbtHookCallback(int code, WPARAM wparam, LPARAM lparam) \n{ \n    if (code &gt;= 0) \n    { \n        UINT msg = 0; \n\n        if (code == HCBT_ACTIVATE) \n            msg = RegisterWindowMessage(\"HOOK_HCBT_ACTIVATE\"); \n        else if (code == HCBT_CREATEWND) \n            msg = RegisterWindowMessage(\"HOOK_HCBT_CREATEWND\"); \n        else if (code == HCBT_DESTROYWND) \n            msg = RegisterWindowMessage(\"HOOK_HCBT_DESTROYWND\"); \n        else if (code == HCBT_MINMAX) \n            msg = RegisterWindowMessage(\"HOOK_HCBT_MINMAX\"); \n        else if (code == HCBT_MOVESIZE) \n            msg = RegisterWindowMessage(\"HOOK_HCBT_MOVESIZE\"); \n        else if (code == HCBT_SETFOCUS) \n            msg = RegisterWindowMessage(\"HOOK_HCBT_SETFOCUS\"); \n        else if (code == HCBT_SYSCOMMAND) \n            msg = RegisterWindowMessage(\"HOOK_HCBT_SYSCOMMAND\"); \n\n        HWND dstWnd = (HWND)GetProp(GetDesktopWindow(), HOOK_HWND_CBT\"); \n\n        if (msg != 0) \n            SendNotifyMessage(dstWnd, msg, wparam, lparam); \n    } \n\n    return CallNextHookEx(hookCbt, code, wparam, lparam); \n} \n</code></pre>\n\n<p>To use this assembly in a .NET Windows Application the following method has to be imported:</p>\n\n<pre><code>[DllImport(\"GlobalCbtHook.dll\", CallingConvention = CallingConvention.Cdecl)] \npublic static extern bool InitializeCbtHook (int threadID, IntPtr DestWindow);\n\n[DllImport(\"GlobalCbtHook.dll\", CallingConvention = CallingConvention.Cdecl)]\npublic static extern void UninitializeCbtHook(int hookType);\n</code></pre>\n\n<p>After calling <code>InitializeCbtHook</code> the messages received from <code>GlobalCbtHook.dll</code> can be processed in:</p>\n\n<pre><code>protected override void WndProc(ref Message msg) \n</code></pre>\n\n<p>The messages have to be registered in both the assembly and the application by calling \n<code>RegisterWindowMessage</code>.</p>\n\n<pre><code>[DllImport(\"user32.dll\")]\nprivate static extern int RegisterWindowMessage(string lpString);\n</code></pre>\n\n<p>This implementation works fine. But in most cases when I activate Microsoft Office Outlook\nmy .NET Application receives the activate-event after I minimize Outlook or activate an other window. At first I thought that my .NET wrapper is the cause of the problem. But after I used the sources from the above link I could recognized the same behaviour. \nMy actually workaround is to use <code>WH_SHELL</code> hook. I know that one difference between <code>WH_CBT</code> and <code>WH_SHELL</code> hook is when using <code>WH_CBT</code> hook it is possible to interrupt the filter function chain by not calling the <code>CallNextHookEx</code> method. Could this play a role in my problem? \nPlease provide help.</p>\n"},{"tags":["c#","winapi","syslistview32"],"answer_count":4,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":1271,"score":1,"question_id":5369155,"title":"Getting Text from SysListView32 in 64bit","body":"<p>here is my code :</p>\n\n<pre><code>   public static string ReadListViewItem(IntPtr lstview, int item)\n    {\n        const int dwBufferSize = 1024;\n\n        int dwProcessID;\n        LV_ITEM lvItem;\n        string retval;\n        bool bSuccess;\n        IntPtr hProcess = IntPtr.Zero;\n        IntPtr lpRemoteBuffer = IntPtr.Zero;\n        IntPtr lpLocalBuffer = IntPtr.Zero;\n        IntPtr threadId = IntPtr.Zero;\n\n        try\n        {\n            lvItem = new LV_ITEM();\n            lpLocalBuffer = Marshal.AllocHGlobal(dwBufferSize);\n            // Get the process id owning the window\n            threadId = GetWindowThreadProcessId(lstview, out dwProcessID);\n            if ((threadId == IntPtr.Zero) || (dwProcessID == 0))\n                throw new ArgumentException(\"hWnd\");\n\n            // Open the process with all access\n            hProcess = OpenProcess(PROCESS_ALL_ACCESS, false, dwProcessID);\n            if (hProcess == IntPtr.Zero)\n                throw new ApplicationException(\"Failed to access process\");\n\n            // Allocate a buffer in the remote process\n            lpRemoteBuffer = VirtualAllocEx(hProcess, IntPtr.Zero, dwBufferSize, MEM_COMMIT,\n              PAGE_READWRITE);\n            if (lpRemoteBuffer == IntPtr.Zero)\n                throw new SystemException(\"Failed to allocate memory in remote process\");\n\n            // Fill in the LVITEM struct, this is in your own process\n            // Set the pszText member to somewhere in the remote buffer,\n            // For the example I used the address imediately following the LVITEM stuct\n            lvItem.mask = LVIF_TEXT;\n\n            lvItem.iItem = item;\n            lvItem.iSubItem = 2;\n            lvItem.pszText = (IntPtr)(lpRemoteBuffer.ToInt32() + Marshal.SizeOf(typeof(LV_ITEM)));\n            lvItem.cchTextMax = 50;\n\n            // Copy the local LVITEM to the remote buffer\n            bSuccess = WriteProcessMemory(hProcess, lpRemoteBuffer, ref lvItem,\n              Marshal.SizeOf(typeof(LV_ITEM)), IntPtr.Zero);\n            if (!bSuccess)\n                throw new SystemException(\"Failed to write to process memory\");\n\n            // Send the message to the remote window with the address of the remote buffer\n            SendMessage(lstview, LVM_GETITEMText, 0, lpRemoteBuffer);\n\n            // Read the struct back from the remote process into local buffer\n            bSuccess = ReadProcessMemory(hProcess, lpRemoteBuffer, lpLocalBuffer, dwBufferSize,IntPtr.Zero);\n            if (!bSuccess)\n                throw new SystemException(\"Failed to read from process memory\");\n\n            // At this point the lpLocalBuffer contains the returned LV_ITEM structure\n            // the next line extracts the text from the buffer into a managed string\n            retval = Marshal.PtrToStringAnsi((IntPtr)(lpLocalBuffer +\n              Marshal.SizeOf(typeof(LV_ITEM))));\n        }\n        finally\n        {\n            if (lpLocalBuffer != IntPtr.Zero)\n                Marshal.FreeHGlobal(lpLocalBuffer);\n            if (lpRemoteBuffer != IntPtr.Zero)\n                VirtualFreeEx(hProcess, lpRemoteBuffer, 0, MEM_RELEASE);\n            if (hProcess != IntPtr.Zero)\n                CloseHandle(hProcess);\n        }\n        return retval;\n    }\n</code></pre>\n\n<p>no matter what i do retval returns empty, although lpLocalBuffer  doesnt .</p>\n\n<p>here is the def of ListItem :</p>\n\n<pre><code>   [StructLayout(LayoutKind.Sequential)]\n    private struct LV_ITEM\n    {\n        public int mask;\n        public int iItem;\n        public int iSubItem;\n        public int state;\n        public int stateMask;\n        public IntPtr pszText;\n        public int cchTextMax;\n        public int iImage;\n        internal int lParam;\n        internal int iIndent;\n    }\n</code></pre>\n\n<p>i tried compiling for 86x , 64bit, any cpu , nothing seems to work at all ! </p>\n\n<p>any idea why this might be happening ?</p>\n\n<p>C# + .net4 , windows 7 64bit.</p>\n"},{"tags":["c++","winapi","gpu","hardware-acceleration"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":12171475,"title":"Does GDI+ support graphics acceleration?","body":"<p>I'm trying to write a screensaver for a Windows platform using C++ and Win APIs. To render graphics I'm using GDI+, but the issue is rendering png's with some small amount of animation (fade-in and -out) becomes very \"CPU heavy.\"</p>\n\n<p>So I was wondering if there's a way to enable GPU acceleration for GDI+ APIs? And if it's not possible, is there something that I can use from a non-managed code that supports GPU acceleration (apart from OpenGL or DirectX)?</p>\n"},{"tags":["c","windows","winapi","sdk"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":78,"score":-1,"question_id":12163718,"title":"shellexecuteEx with multiple parameters","body":"<p>I want to call <code>dpinst.exe /u .\\\\foldername\\\\foldername\\\\inffile.inf \\d</code> using <code>shellexecuteEX</code>. How to do this. Sorry I am confused with multiple parameters. and I tried the below code which is not working.</p>\n\n<pre><code>hExecInfo.lpParameters = TEXT (\"/u .\\\\dist\\\\Driver\\\\inffile.inf /d\");\nShExecInfo.lpFile = TEXT (\".\\\\dist\\\\dpinstx86.exe\");\n</code></pre>\n\n<p>How to make it work?</p>\n"},{"tags":["delphi","winapi","tfilestream"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":65,"score":3,"question_id":12168490,"title":"How to use TFileStream with FILE_SHARE_DELETE?","body":"<p>This QC report say that Delphi doesn't support the file sharing mode <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa363858%28v=vs.85%29.aspx\" rel=\"nofollow\">FILE_SHARE_DELETE</a></p>\n\n<p><a href=\"http://qc.embarcadero.com/wc/qcmain.aspx?d=45628\" rel=\"nofollow\">http://qc.embarcadero.com/wc/qcmain.aspx?d=45628</a></p>\n\n<p>I need to use this mode with TFileStreams - Can anyone think of a straightforward workaround that doesn't involve modifying the library code, or duplicating reams of stuff from the library?</p>\n"}]}
{"total":13828,"page":14,"pagesize":100,"questions":[{"tags":["c","winapi","fonts","tooltip"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12166876,"title":"use fixed-width font for tooltip","body":"<p>I want to display some mouse event information in a tooltip. It looks like:</p>\n\n<pre><code>Win1 : x =  100; y =   99; dx =  655; dy = 1789;\nWin2 : x = 2396; y =  133; dx =   78; dy =  111;\n....\n....\n</code></pre>\n\n<p>Even if I use <code>%4d</code> and other things to format the text, it doesn't give the perfect result as above.\nIs there any way to display data in the format as above in tooltip? I can only imagine that one can use fixed-width font, but I don't have any idea how to change font in tooltip.</p>\n"},{"tags":["winapi","parsing","token","delimiter","tchar"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12167016,"title":"parsing tchars using _tcstok_s in winapi","body":"<p>With the following code I get an error \"Unhandled exception at 0x59be5d2e (msvcr100d.dll) in simpleWindow.exe: 0xC0000005: Access violation writing location 0x00e750f8.\"</p>\n\n<pre><code>TCHAR *string1 = _T(\"last.first\");\nTCHAR *delim = _T(\".\");\nTCHAR *context;\nTCHAR *name = _tcstok_s(string1, delim, &amp;context);\n</code></pre>\n\n<p>This is just an example I'm using, ultimately I am trying to pull in a string from another class, but I wanted to get the parsing working first.</p>\n"},{"tags":["winapi","unicode","thread-safety"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":12165558,"title":"Is MultiByteToWideChar reentrant or threadsafe?","body":"<p>Multiple threads in my application will be calling MultiByteToWideChar for converting UTF-8 to wchar_t strings. \nI've been unable to find any documentation which states whether this function is re-entrant or  thread safe. I want to avoid synchronizing calls to this method if not needed. Does anyone know the answer or how to find it?</p>\n"},{"tags":["winapi","vbscript","dns","reverse-lookup"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":331,"score":1,"question_id":6320403,"title":"How to call Windows gethostbyaddr API using BATCH script","body":"<p>I already have a small script in perl to do reverse lookup, but it is not portable unless the other machine also has perl installed. I want a script that can run on colleagues machines seamlessly and also can be converted into a custom command (by updating PATH &amp; PATHEXT environment variables). The script file must be portable and available to non admin users.</p>\n\n<p>Batch script seems to fit this purpose, but I cannot figure out how to call the gethostbyaddr API. I suppose VBScript is also an option and open to that.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/ms738521%28v=vs.85%29.aspx\" rel=\"nofollow\">gethostbyaddr API</a></p>\n"},{"tags":["windows","winapi","dll","windows-services","rundll32"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":111,"score":1,"question_id":12163115,"title":"Running a dll using rundll32.exe as a windows service","body":"<p>I was able to run a dll using rundll32.exe .</p>\n\n<p>Now I want to run it as a windows service but it doesn't seem to start and gets timeout.</p>\n\n<p>I am not sure how I could pass the parameters.</p>\n\n<p>Trying something along the lines of ..</p>\n\n<p>sc.exe create service binPath= \"c:\\windows\\system32\\rundll32.exe -test.dll -Main\"</p>\n\n<p>Trying the suggestions from \n<a href=\"http://stackoverflow.com/questions/3663331/creating-a-service-with-sc-exe-how-to-pass-in-context-parameters\">creating a service with sc.exe; how to pass in context parameters</a>\nbut it doesnt seem to work.</p>\n\n<p>Any suggestions?</p>\n\n<p>Thanks,</p>\n\n<p>Karthik</p>\n"},{"tags":["windows","winapi","dll","window","rundll32"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12161813,"title":"Running a dll using rundll32.exe.. no output or error seen","body":"<p>I am running a dll using a rundll32.exe but I dont see the output as expected \nnor my log statements \nnor do I see any error of any sort.</p>\n\n<p>How do I debug this ?</p>\n\n<p>Thanks,</p>\n\n<p>KG</p>\n"},{"tags":["winapi","visual-c++"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12157975,"title":"Register window before creating it in win32 programming","body":"<p>When we register a window, we must create it before we register another window.</p>\n\n<p>I read it on this page(Next Line after Figure:Windows)</p>\n\n<p><a href=\"http://zetcode.com/gui/winapi/firststeps/\" rel=\"nofollow\">http://zetcode.com/gui/winapi/firststeps/</a></p>\n\n<p>and was wondering why ???? </p>\n\n<p>or is it only a good programming practise????</p>\n\n<p>I am a newbie trying to learn win32 programming.Help will be greatly appreciated </p>\n"},{"tags":["multithreading","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1223,"score":0,"question_id":782769,"title":"Sharing message queues among threads (in Windows)","body":"<p>Is there any way to share a message queue among several threads, or otherwise to read a message queue of a different thread, without using hooks?</p>\n"},{"tags":["winapi"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":1706065,"title":"What are must-have free/gnu/open-source orignal/ported develop-related tools under windows?","body":"<p>I'll start with\n<a href=\"http://unxutils.sourceforge.net/\" rel=\"nofollow\">GNU utilities for Win32</a>.</p>\n\n<p>Per tool per post please.</p>\n\n<p>thanks.</p>\n"},{"tags":["c++","windows","winapi","visual-c++","windows-shell"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12161703,"title":"Recycle Bin items shredding","body":"<p>I'd like to shred the recycle bin data, but I don't know which is the best approach, so it goes:\n -  In windows vista and 7 the files are renamed starting with $R and a bunch of random chars and also a file starting with $I and the same random chars is created, this file contains some info about the file, including it's name. The $Recycler.bin directory also contains a Desktop.ini, I don't know what it does.\n - In below vista the management of the recycled files is done using hidden INFO2 files, which do the association between random file name and real name.</p>\n\n<p>Now, let's say I want to build an app that can run on both below and above vista systems, what common strategy would you use? My first lead woud be to navigate the namespace, get the absolute path to the Recycler directories ovewrite the data within the files and delete them manually from the Recycler directories. I also need to notify the shell afterwards. </p>\n\n<p>What other approaches would you use?</p>\n\n<p>*Correct me if I'm wrong in the above statements. \nsources: <a href=\"http://www.pcmag.com/article2/0,2817,1159633,00.asp\" rel=\"nofollow\">Here</a> and <a href=\"http://www.raymond.cc/blog/what-is-info2-file-hidden-in-recycled-or-recycler-folder/\" rel=\"nofollow\">here</a></p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12160935,"title":"Check if service is from Microsoft","body":"<p>How would I determine if a service is from Microsoft or not? Similar to how msconfig does.</p>\n\n<p>Been looking through the service APIs and I can't find anything.</p>\n\n<p><strong>EDIT:</strong><br>\nFor clarification, I'm talking about Windows Services (Windows Update, Windows Search, Computer Browser, etc)</p>\n"},{"tags":["winapi","cursor","mouse","gdi"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":201,"score":3,"question_id":12109560,"title":"draw mouse cursor in win32","body":"<p>Newbie to GDI. </p>\n\n<p>I'm trying to simulate a mouse cursor in Win32 forms. On every WM_MOUSEMOVE I have </p>\n\n<pre><code>hCursor = LoadCursor(NULL, IDC_ARROW);\n////Get device context\nhDeviceContext = GetDC(hwnd);\nhDCMem = CreateCompatibleDC(hDeviceContext);\nhBitmap = CreateCompatibleBitmap(hDCMem, 50, 50);\nhbmOld = SelectObject(hDCMem, hBitmap);\nDrawIcon(hDCMem, x, y, hCursor);\nSelectObject(hDCMem, hbmOld);\n</code></pre>\n\n<p>But I don't see anything being drawn. However if I drew directly on the to DC:</p>\n\n<pre><code>    DrawIcon(hDeviceContext , x, y, hCursor);\n</code></pre>\n\n<p>I do see the cursor but it does not erase the image as I move the cursor, leaving a long tail behind. </p>\n"},{"tags":["c","performance","winapi","file-io"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1127,"score":1,"question_id":1947565,"title":"Win32 IO Performance Problem","body":"<p>Recently I ran into a \"fun\" problem with the Microsoft implementation of the CRTL. <a href=\"http://msdn.microsoft.com/en-us/library/x8x7sakw%28VS.80%29.aspx\" rel=\"nofollow\"><code>tmpfile</code></a> places temp files in the root directory and completely ignores the temp file directory. This has issues with users who do not have privileges to the root directory (say, on our cluster). Moreover, using <a href=\"http://msdn.microsoft.com/en-us/library/hs3e7355%28VS.80%29.aspx\" rel=\"nofollow\"><code>_tempnam</code></a> would require the application to remember to delete the temporary files, which it is unable to do without a considerable amount of rework.</p>\n\n<p>Therefore I bit the bullet and wrote Win32 versions of all of the IO routines (create_temp, read, write, seek, flush) which call the appropriate method. One thing I've noticed is the now abysmal performance of the library.</p>\n\n<p>Results from the test suite:</p>\n\n<pre><code>CRTL:    4:30.05 elapsed\nWin32:  11:18.06 elapsed\n\nStats measured in my routines:\nWrites:  3129934 (   44,642,745,008 bytes)\nReads:    935903 (    8,183,423,744 bytes)\nSeeks:   2205757 (2,043,782,657,968 bytes traveled)\nFlushes:   92442\n</code></pre>\n\n<p>Example of a CRTL v. Win32 method:</p>\n\n<pre><code>int io_write(FILE_POINTER fp, size_t words, const void *buffer)\n{\n#if !defined(USE_WIN32_IO)\n    {\n        size_t words_written = 0;\n\n        /* read the data */\n        words_written = fwrite(buffer, sizeof(uint32_t), words, fp);\n        if (words_written != words)\n        {\n            return errno;\n        }\n    }\n#else /* !defined(USE_WIN32_IO) */\n    {\n        DWORD bytesWritten;\n\n        if (!WriteFile(fp, buffer, words * sizeof(uint32_t), &amp;bytesWritten, NULL)\n            || (bytesWritten != words * sizeof(uint32_t)))\n        {\n            return GetLastError();\n        }\n    }\n#endif /* USE_WIN32_IO */\n\n    return E_SUCCESS;\n}\n</code></pre>\n\n<p>As you can see, they are effectively identical, yet the performance (in release mode) is wildly divergent. Time spent in <code>WriteFile</code> and <code>SetFilePointer</code> dwarf the time spent in <code>fwrite</code> and <code>fseeko</code>, which seems counterintuitive.</p>\n\n<p>Ideas?</p>\n\n<p>UPDATE: perfmon notes that <code>fflush</code> is about 10x cheaper than <code>FlushFileBuffers</code> and <code>fwrite</code> is ~1.1x slower than <code>WriteFile</code>. The net result is a huge performance loss with <code>FlushFileBuffers</code> used in the same manner as <code>fflush</code>. There is no change from <code>FILE_ATTRIBUTE_NORMAL</code> to <code>FILE_FLAG_RANDOM_ACCESS</code> either.</p>\n"},{"tags":["c#",".net","winapi","gac"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":61,"score":3,"question_id":12158170,"title":"Querying the x64-GAC","body":"<p>With the following code I'm querying the GAC to see if there is a certain assembly installed i it. The code itself works fine, but I only get the result for the <a href=\"http://i.stack.imgur.com/h8j09.png\" rel=\"nofollow\">x86 GAC</a>. The assembly is installed in both GACs GAC_64 and GAC_32. </p>\n\n<p>What do I have to do so that 'QueryAssemblyInfo' checks the x64 GAC?</p>\n\n<pre><code>  public bool IsInGac(string assemblyName)\n  {\n     ASSEMBLY_INFO assembyInfo = new ASSEMBLY_INFO();\n     assembyInfo.cchBuf = 512;\n     assembyInfo.currentAssemblyPath = new string('\\0', assembyInfo.cchBuf);\n\n     IAssemblyCache assemblyCache = null;\n\n     IntPtr hr = NativeMethods.CreateAssemblyCache(out assemblyCache, 0);\n     if (hr == IntPtr.Zero)\n     {\n        hr = assemblyCache.QueryAssemblyInfo(1, assemblyName, ref assembyInfo);\n        if (hr != IntPtr.Zero)\n        {\n           return false;\n        }\n\n        return true;\n     }\n\n     return false;\n  }\n\n  internal static class NativeMethods\n  {\n     [DllImport(\"fusion.dll\")]\n     public static extern IntPtr CreateAssemblyCache(out IAssemblyCache ppAsmCache, int reserved);\n  }\n\n  [ComImport, InterfaceType(ComInterfaceType.InterfaceIsIUnknown), Guid(\"e707dcde-d1cd-11d2-bab9-00c04f8eceae\")]\n  internal interface IAssemblyCache\n  {\n     int Dummy1();\n     [PreserveSig]\n     IntPtr QueryAssemblyInfo(int flags, [MarshalAs(UnmanagedType.LPWStr)]string assemblyName, ref ASSEMBLY_INFO assemblyInfo);\n     int Dummy2();\n     int Dummy3();\n     int Dummy4();\n  }\n\n  [StructLayout(LayoutKind.Sequential)]\n  internal struct ASSEMBLY_INFO\n  {\n     public int cbAssemblyInfo;\n     public int assemblyFlags;\n     public long assemblySizeInKB;\n\n     [MarshalAs(UnmanagedType.LPWStr)]\n     public String currentAssemblyPath;\n\n     public int cchBuf;\n  }\n</code></pre>\n"},{"tags":["windows","winapi"],"answer_count":22,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":1962,"score":5,"question_id":209778,"title":"Native Windows Application Development Options","body":"<p>Long winded title, short question:</p>\n\n<p>If one wants to develop for Windows but not have to rely on any external dependency (no runtime, thus ruling out .net), what supported, alive and fully functioning* alternatives are there?</p>\n\n<p>Visual Basic 6 is dead, Visual C++ is obvious and Delphi seems to be the prime choice for that, but I wonder if there are any other alternatives?</p>\n\n<p>*as in: Being able to use all the Windows Features like putting an icon in the Notification Area, making the Taskbar Icon flash etc.</p>\n"},{"tags":["c++","mfc","winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":528,"score":0,"question_id":1448188,"title":"How to set the picturebox style using SendMessage","body":"<p>I want to set the style of picturebox using <code>SendMessage()</code> in win32.</p>\n\n<p>I would like a sample piece of code with enum values for setting style.</p>\n"},{"tags":["wpf","winapi","resourcedictionary","cursors","hwndhost"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12152425,"title":"How to use Win32 SetCursor() with WPF resource and HwndHost","body":"<p>We have an HwndHost UIElement in our WPF application which is used to display Direct3d graphics, and the only way I have found to set a cursor for the HwndHost UIElment is to call the Win32 API SetCursor().  All of our cursors are resources in managed assemblies, and I would prefer to not change that, but I have not been able to find a way to load one of these cursors via any Win32 APIs like LoadImage().</p>\n\n<p>Does anybody know how to get a handle(hCursor) to a cursor which is a resource in a managed assembly?</p>\n\n<p>Or, is there another way to set a cursor on an HwndHost displaying Direct3D graphics?</p>\n"},{"tags":["c#",".net","windows","winapi","com"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":128,"score":2,"question_id":12131100,"title":"Run the command for a ProgId verb","body":"<p>Is there a way to execute the command for a progid verb without having to go digging in the registry and doing string manipulation?</p>\n\n<p>Using ShObjIdl.idl I can run the following command to get the ProgId for the default browser:</p>\n\n<pre><code>var reg = new ShellObjects.ApplicationAssociationRegistration();\n\nstring progID;\nreg.QueryCurrentDefault(\"http\", ShellObjects.ASSOCIATIONTYPE.AT_URLPROTOCOL, ShellObjects.ASSOCIATIONLEVEL.AL_EFFECTIVE, out progID);\n</code></pre>\n\n<p>This gives me \"ChromeHTML.FHXQEQDDJYXVQSFWM2SVMV5GNA\". In the registry I can see this progid has the following shell/open/command:</p>\n\n<pre><code>\"C:\\Users\\Paul\\AppData\\Local\\Google\\Chrome\\Application\\chrome.exe\" -- \"%1\"\n</code></pre>\n\n<p>Is there an API that I can pass the ProgId to, along with the verb and argument and it will run it?</p>\n\n<p>One route I went down is using ShellExecuteEx:</p>\n\n<pre><code>var shellExecuteInfo = new SHELLEXECUTEINFO();\nshellExecuteInfo.cbSize = Marshal.SizeOf(shellExecuteInfo);\nshellExecuteInfo.fMask = SEE_MASK_CLASSNAME;\nshellExecuteInfo.hwnd = IntPtr.Zero;\nshellExecuteInfo.lpVerb = \"open\";\nshellExecuteInfo.lpFile = \"google.com\";\nshellExecuteInfo.nShow = SW_SHOWNORMAL;\nshellExecuteInfo.lpClass = \"http\";\n\nShellExecuteEx(ref shellExecuteInfo);\n</code></pre>\n\n<p>However this fails with a 'Windows cannot find' error due to Window's doing checking on lpFile which I don't want to happen as it isn't relevant for a URL (from: <a href=\"http://blogs.msdn.com/b/oldnewthing/archive/2010/07/01/10033224.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/oldnewthing/archive/2010/07/01/10033224.aspx</a> )</p>\n\n<hr>\n\n<p>This is the solution I have come up with:</p>\n\n<pre><code>    private static void Main(string[] args)\n    {\n        if (!OpenUrlInDefaultBrowser(\"google.com\"))\n            Console.WriteLine(\"An error happened\");\n    }\n\n    [DllImport(\"Shlwapi.dll\")]\n    private static extern int AssocQueryString(ASSOCF flags, ASSOCSTR str, string pszAssoc, string pszExtra, StringBuilder pszOut, ref uint pcchOut);\n\n    private enum ASSOCF\n    {\n        ASSOCF_NONE = 0x00000000\n    }\n\n    private enum ASSOCSTR\n    {\n        ASSOCSTR_COMMAND = 1\n    }\n\n    [DllImport(\"Shell32.dll\", CharSet=CharSet.Auto)]\n    private static extern int SHEvaluateSystemCommandTemplate(string pszCmdTemplate, out string ppszApplication, out string ppszCommandLine, out string ppszParameters);\n\n    private static bool OpenUrlInDefaultBrowser(string url)\n    {\n        string browserProgId;\n        if (!GetDefaultBrowserProgId(out browserProgId))\n            return false;\n\n        string browserCommandTemplate;\n        if (!GetCommandTemplate(browserProgId, out browserCommandTemplate))\n            return false;\n\n        string browserExecutable;\n        string parameters;\n        if (!EvaluateCommandTemplate(browserCommandTemplate, out browserExecutable, out parameters))\n            return false;\n\n        parameters = ReplaceSubstitutionParameters(parameters, url);\n\n        try\n        {\n            Process.Start(browserExecutable, parameters);\n        }\n        catch (InvalidOperationException) { return false; }\n        catch (Win32Exception) { return false; }\n        catch (FileNotFoundException) { return false; }\n\n        return true;\n    }\n\n    private static bool GetDefaultBrowserProgId(out string defaultBrowserProgId)\n    {\n        try\n        {\n            // midl \"C:\\Program Files (x86)\\Windows Kits\\8.0\\Include\\um\\ShObjIdl.idl\"\n            // tlbimp ShObjIdl.tlb\n            var applicationAssociationRegistration = new ApplicationAssociationRegistration();\n            applicationAssociationRegistration.QueryCurrentDefault(\"http\", ShellObjects.ASSOCIATIONTYPE.AT_URLPROTOCOL, ShellObjects.ASSOCIATIONLEVEL.AL_EFFECTIVE, out defaultBrowserProgId);\n        }\n        catch (COMException)\n        {\n            defaultBrowserProgId = null;\n            return false;\n        }\n        return !string.IsNullOrEmpty(defaultBrowserProgId);\n    }\n\n    private static bool GetCommandTemplate(string defaultBrowserProgId, out string commandTemplate)\n    {\n        var commandTemplateBufferSize = 0U;\n        AssocQueryString(ASSOCF.ASSOCF_NONE, ASSOCSTR.ASSOCSTR_COMMAND, defaultBrowserProgId, \"open\", null, ref commandTemplateBufferSize);\n        var commandTemplateStringBuilder = new StringBuilder((int)commandTemplateBufferSize);\n        var hresult = AssocQueryString(ASSOCF.ASSOCF_NONE, ASSOCSTR.ASSOCSTR_COMMAND, defaultBrowserProgId, \"open\", commandTemplateStringBuilder, ref commandTemplateBufferSize);\n        commandTemplate = commandTemplateStringBuilder.ToString();\n\n        return hresult == 0 &amp;&amp; !string.IsNullOrEmpty(commandTemplate);\n    }\n\n    private static bool EvaluateCommandTemplate(string commandTemplate, out string application, out string parameters)\n    {\n        string commandLine;\n        var hresult = SHEvaluateSystemCommandTemplate(commandTemplate, out application, out commandLine, out parameters);\n\n        return hresult == 0 &amp;&amp; !string.IsNullOrEmpty(application) &amp;&amp; !string.IsNullOrEmpty(parameters);\n    }\n\n    private static string ReplaceSubstitutionParameters(string parameters, string replacement)\n    {\n        // Not perfect but good enough for this purpose\n        return parameters.Replace(\"%L\", replacement)\n                         .Replace(\"%l\", replacement)\n                         .Replace(\"%1\", replacement);\n    }\n</code></pre>\n"},{"tags":["c#","vb.net","winapi","vb6","browser-cache"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":167,"score":1,"question_id":12101969,"title":"How To Get DeleteUrlCacheEntry() Error Codes? (Or additional information on why a particular deletion didn't work)?","body":"<p>Basically, when I call DeleteUrlCacheEntry (which is part of the Wininet.dll API) I either get returned the number 1 (which means, deletion successful) or the number 0 (which meant, deletion didn't work).</p>\n\n<p>My question is, how can I find out why a deletion did not work? (that is, when a 0 is returned). I heard there is a GetLastError() function in C++, however I am using VB6 and apparently the GetLastError equivalent in VB6 is the Err.LastDllError property.</p>\n\n<p>After a DeleteUrlCacheEntry attempted deletion fails (returns 0) I call/query the Err.LastDllError and it always returns 0 - no matter what. It returns 0 even if DeleteUrlCacheEntry returns 0 (deletion didn't work) and even when it returns 1 (deletion did work). I also make the call/query to Err.LastDllError as soon as possible (as in, right after the DeleteUrlCacheEntry call).</p>\n\n<p>I am really confused, because I don't even get a runtime error or any typical exception (or any exception for that matter). I do not have On Error Resume Next to ignore exception anywhere in my application, so every means of an error being reported to me is available but I cannot for the life of me figure out why a particular DeleteUrlCacheEntry() attempt will fail and return 0 (there doesn't seem to be a way for me to find out).</p>\n\n<p>So, my question is, how do I get extended error information from the DeleteUrlCacheEntry() function (residing in the wininet.dll API)?</p>\n\n<p>If you would like more information on the reason why I am looking for extended error information from the DeleteUrlCacheEntry() function, I have another question which details this (together with actual examples of cache items that work and don't work when a deletion is attempted): <a href=\"http://stackoverflow.com/questions/12096546/deleteurlcacheentry-function-of-wininet-api-not-deleting-some-internet-explo\">DeleteUrlCacheEntry() function (of WinINet API) not deleting some Internet Explorer Cache items begining with &quot;Visited: &quot;</a></p>\n\n<p>Also, just to add, I am using VB6 - but principally it should be the same across most languages as it is an API call. Here is my declaration in VB6:</p>\n\n<blockquote>\n  <p>Public Declare Function DeleteUrlCacheEntry Lib \"WININET\" Alias\n  \"DeleteUrlCacheEntryA\" (ByVal lpszUrlName As String) As Long</p>\n</blockquote>\n\n<p>Also, I am calling it like this:</p>\n\n<blockquote>\n  <p>Dim lReturnValue As Long</p>\n  \n  <p>Dim cacheFileString As String</p>\n  \n  <p>' GetStrFromPtrA turns Pointer (Long) to String. cacheFileString is the actual text/string of the lpszSourceUrlName turned from Pointer (Long) to String (human readable cache file name/string). Also, cacheFileString is retreived from FindFirst/NextEntry functions in a loop, so can't be incorrectly formatted or anything, as it also works when deleting most other items.</p>\n  \n  <p>cacheFileString = GetStrFromPtrA(icei.lpszSourceUrlName)</p>\n  \n  <p>lReturnValue = DeleteUrlCacheEntry(cacheFileString)</p>\n</blockquote>\n\n<p>The lReturnValue ends up being 0 if deletion didn't work, and 1 when deletion does work, and that is it. Also, <code>Err.LastDllError</code> always returns 0.</p>\n\n<p>Thank you for your anticipated assistance.</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12149906,"title":"ValidateRect vs BeginPaint","body":"<p>From the MSDN documentation:</p>\n\n<blockquote>\n  <p>The BeginPaint function validates the entire client area.</p>\n  \n  <p>The ValidateRect function should not be called if a portion of the\n  update region must be validated before the next WM_PAINT message is\n  generated.<a href=\"http://msdn.microsoft.com/en-us/library/ms914091.aspx\" rel=\"nofollow\">1</a></p>\n</blockquote>\n\n<p>I've been programming with Win32 API for years, and I've never thought to call the ValidateRect function.  A co-worker of mine today pointed that we were missing a call to ValidateRect, which fixed a bug we were having doing some high-speed animation using GDI (I know, an oxymoron)</p>\n\n<p>Can someone tell me whether or not a call to ValidateRect is neccessary after a BeginPaint/EndPaint pair?  I have seen no documentation at MSDN that sheds light on this, and what documentation and examples I do see that you do not need to.</p>\n"},{"tags":["c++","winapi","widget"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":134,"score":0,"question_id":12154185,"title":"Change static background in tab color c++","body":"<p>I have create tab</p>\n\n<pre><code>INITCOMMONCONTROLSEX icc;\n        icc.dwSize = sizeof(INITCOMMONCONTROLSEX);\n        icc.dwICC = (DWORD)ICC_TAB_CLASSES;\n        InitCommonControlsEx(&amp;icc);\n        icc.dwICC = (DWORD)ICC_LISTVIEW_CLASSES;\n        InitCommonControlsEx(&amp;icc);\n        hwndTab = CreateWindow(WC_TABCONTROL,L\"\",WS_CHILD|WS_VISIBLE|WS_DLGFRAME|WS_CLIPSIBLINGS\n    ,10,10,780,271,hwnd,(HMENU)3,hInstance,NULL);\n        TCITEM tcitem; tcitem.mask = TCIF_TEXT;\n        tcitem.pszText = L\"Tab1\";\n        TabCtrl_InsertItem(hwndTab,0,&amp;tcitem);\n</code></pre>\n\n<p>and put a static control into the tab</p>\n\n<pre><code>CreateWindow(L\"STATIC\",L\"Static control 1\",\n        WS_CHILD|WS_VISIBLE,50,30,65,24,hwndTab,(HMENU)NULL,hInstance,NULL);\n</code></pre>\n\n<p>But the Static control 1 have the grey background. How can I give it a color.\nThanks</p>\n"},{"tags":["winapi","gdi+","gdi","wm-paint"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":105,"score":0,"question_id":12153472,"title":"GetDC vs BeginPaint performance considerations","body":"<p>MSDN and numerous post have suggested that BeginPaint/EndPaint should used in WM_PAINT. I've also seen numerous places suggesting that if double buffering is employed in painting, it makes more sense to initialize the DC and mem allocation in WM_CREATE and reuse those handles in WM_PAINT. </p>\n\n<p>For example, using BeginPaint, I commonly see:</p>\n\n<pre><code>case WM_PAINT:\nhdc = BeginPaint(hWnd, &amp;ps);\nMemDC = CreateCompatibleDC(hdc);\nbmp = CreateCompatibleBitmap(hdc, width, height);\noldbmp = SelectObject(MemDC,bmp);\ng = new Graphics(MemDC);\n\n//do paint on bmp\n//blt bmp back to hdc\n\nEndPaint(hWnd, &amp;ps);\nDeleteObject(bmp);\ng-&gt;ReleaseHDC(MemDC);\nDeleteDC(MemDC);\ndelete g;\n</code></pre>\n\n<p>To save the initialization and tearing down, is it possible to do this :</p>\n\n<pre><code>case WM_CREATE:\nhdc   = GetDC(hWnd);\n//create memDC and graphics object references ...\ncase WM_DESTROY\n//delete memDC and graphics object references...\ncase WM_PAINT\nBeginPaint(hWnd, &amp;ps);\n//use previously create mem and graphics object to paint \nEndPaint(hWnd, &amp;ps);\n</code></pre>\n\n<p>So we only use EndPaint to clear the update region but delegate the drawing to prev created objects. </p>\n"},{"tags":["c++","windows-mobile","mfc","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1017,"score":2,"question_id":1532293,"title":"How do I retrieve a process ID for the Win32 Windows Mobile platform?","body":"<p>I would like to retrieve the process ID and handle of a process by querying for it by process name.  Is this possible to do on the Win32 Windows Mobile platform?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c++","winapi","console"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1530,"score":2,"question_id":5068392,"title":"Create window console inside main win32 window","body":"<p>I have a win32 application that need to open a console like the games when tilde is pressed. I tought that the best solution is to use the CreateWindow function. Is this right? How could I make it overlapping the main window and hiding it when tilde is pressed again? Thank you all</p>\n"},{"tags":["c","winapi","gui"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12151994,"title":"How to handle control‘s notifications when subclassing a control? Such as EN_CHANGE?","body":"<p>A notification is sent by a control to its parent. When I subclass a control using <code>SetWindowSubclass</code>, how can I handle the notifications? I don't want to handle them in the parent's window proc. Is there some thing I can do in subclass proc?</p>\n\n<p>If I subclass a Edit control, how to handle <code>EN_CHANGE</code> notification in the subclass?</p>\n\n<p><strong>Update</strong></p>\n\n<p>This is the subclass proc:</p>\n\n<pre><code>LRESULT CALLBACK MyEditWindowProc(HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam, UINT_PTR uIdSubclass, DWORD_PTR dwRefData)\n{\n  switch (uMsg)\n  {\n  default:\n    return DefSubclassProc(hWnd, uMsg, wParam, lParam);\n  }\n}\n</code></pre>\n\n<p>I use</p>\n\n<pre><code>SetWindowSubclass(GetDlgItem(hWnd, ID_MYEDIT), MyEditWindowProc, 0, 0);\n</code></pre>\n\n<p>to subclass the Edit control.</p>\n\n<p>But which message should I handle? Certainly not <code>WM_NOTIFY</code> because it's handled by the parent.</p>\n"},{"tags":["python","winapi","ctypes"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12151938,"title":"Using python how can i get information from EnumDisplayMonitors?","body":"<p>So i have been using win32 in python with ctypes.</p>\n\n<p>So i have a OpenGL window (Using my own OpenGL ctypes wrapper) but i have run into problems i was going to use EnumDisplayMonitors to get the Monitor's RECT. It works for the most part it gives my callback the correct information and everything. </p>\n\n<p>The issue is when i try to store that info somewhere ideally i would like to put it into a list but i try to put it into one that is outside of the method, and each time the callback is called it attempts to append to that list but totally fails. </p>\n\n<p>It like corrupts the list or something, all items become the same value, and even items that shouldn't work give me the same RECT values.</p>\n\n<p>So any clue why this is happening. </p>\n\n<p>Here is that section of code</p>\n\n<pre><code>def disp_proc(self, hMonitor, hdcMonitor, lprcMonitor, dwData):\n    print lprcMonitor\n    lprcMonitor = cast(lprcMonitor, POINTER(RECT)).contents\n    print lprcMonitor\n    self.monitors.append(lprcMonitor)\n\n    print self.monitors[0].left\n    print lprcMonitor.left\n    print ''\n\n    return True\n\ndef get_monitors(self):\n    self.monitors = []\n\n    dispProc = MONITORENUMPROC(self.disp_proc)\n    EnumDisplayMonitors(None, None, dispProc, 0)\n\n    print self.monitors\n    print ''\n    for item in self.monitors:\n        print item.left\n\ndef get_screen_res(self, screenNum):\n\n    self.get_monitors()\n\n    monitors = self.monitors\n\n    monRect = monitors[screenNum]\n\n    resolution = []\n\n    resolution.append(monRect.right-monRect.left)\n    resolution.append(monRect.bottom-monRect.top)\n\n    return resolution\n</code></pre>\n\n<p>Here are the values of things i had printed to the console:</p>\n\n<pre><code>&lt;win32.window.LP_RECT object at 0x02E21EE0&gt;\n&lt;ctypes.wintypes.RECT object at 0x02E21F80&gt;\n0\n0\n\n&lt;win32.window.LP_RECT object at 0x02E3D030&gt;\n&lt;ctypes.wintypes.RECT object at 0x02E3D0D0&gt;\n1920\n1920\n\n[&lt;ctypes.wintypes.RECT object at 0x02E21F80&gt;, &lt;ctypes.wintypes.RECT object at 0x02E3D0D0&gt;]\n\n1920\n1920\n</code></pre>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12143868,"title":"Listview tristate checkbox","body":"<p>I have a listview in report style with checkboxes.<br>\nIs there any easy way to make the check box appear disabled? To give it a tristate sort of effect?<br>\nI want to have 3 states: Enabled, Disabled, and Unset.</p>\n"},{"tags":["ruby","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":380,"score":1,"question_id":2137836,"title":"Trying to show a balloon notification with Ruby","body":"<p>I'm trying to make a little class in ruby allowing me to make a system tray icon and use the notification balloons. But I'm having problems using structs with Win32API calls.</p>\n\n<p><a href=\"http://www.ruby-forum.com/topic/18102\" rel=\"nofollow\">http://www.ruby-forum.com/topic/18102</a><br>\n<a href=\"http://msdn.microsoft.com/en-us/library/bb762159%28VS.85%29.aspx\" rel=\"nofollow\">Shell_NotifyIcon Function</a><br>\n<a href=\"http://msdn.microsoft.com/en-us/library/bb773352%28VS.85%29.aspx\" rel=\"nofollow\">NOTIFYICONDATA Struct</a></p>\n\n<p>Heres the code I have now, all it does is add an icon to the system tray:</p>\n\n<pre><code>require 'Win32API'\n\nNIF_MESSAGE = 1\nNIF_ICON    = 2\nNIF_TIP     = 4\nNIF_STATE   = 8\nNIF_INFO    = 10\n\nNIM_ADD     = 0\nNIM_MODIFY  = 1\nNIM_DELETE  = 2\n\nNIS_HIDDEN     = 1\nNIS_SHAREDICON = 2\n\nclass NotifyIconData &lt; Struct.new(:cbsize, :hwnd, :uid, :uflags, :ucallbackmessage, :hicon)#, :sztip, :dwstate, :dwstatemask, :szinfo, :utimeout, :uversion, :szinfotitle, :dwinfoflags, :guiditem, :hballoonicon)\n    def pack\n        values.pack('LLIIIL')\n    end\n    # def self.unpack(s)\n        # new(*s.unpack('LLIIIL'))\n    # end\nend\n\n#===---\n\nExtractIcon       = Win32API.new('shell32',  'ExtractIcon',       'LPI', 'L')\nShell_NotifyIcon  = Win32API.new('shell32',  'Shell_NotifyIconA', 'LP',  'I')\n\nhicoY = ExtractIcon.call(0, 'C:\\WINDOWS\\SYSTEM32\\INETCPL.CPL', 21)  # Green tick\nhicoN = ExtractIcon.call(0, 'C:\\WINDOWS\\SYSTEM32\\INETCPL.CPL', 22)  # Red minus\n\n#===---\n\ntiptxt = \"hai\"\n\nnid = NotifyIconData.new\nnid.cbsize           = Marshal.dump(NotifyIconData).size#6*4+64\nnid.hwnd             = 0\nnid.uid              = 'ruby'.hash\nnid.uflags           = NIF_INFO\nnid.ucallbackmessage = 0\nnid.hicon             = hicoY\n\nret = Shell_NotifyIcon.call( NIM_ADD, nid.pack &lt;&lt; tiptxt &lt;&lt; \"\\0\"*(64 - tiptxt.size) )\np 'Err: NIM_ADD' if ret == 0\n\n      sleep(3)   #  &lt;----&lt;&lt;\n\n# pnid = [6*4+64, 0, 'ruby'.hash, NIF_ICON | NIF_TIP, 0, hicoN].pack('LLIIIL') &lt;&lt; tiptxt &lt;&lt; \"\\0\"*(64 - tiptxt.size)\n# ret = Shell_NotifyIcon.call(NIM_MODIFY, pnid)\n# p 'Err: NIM_MODIFY' if ret == 0\n\n      # sleep(6)   #  &lt;----&lt;&lt;\nnid.uflags = 0\n\nret = Shell_NotifyIcon.call( NIM_DELETE, nid.pack &lt;&lt; \"\\0\" )\np 'Err: NIM_DELETE' if ret == 0\n</code></pre>\n"},{"tags":["winapi","nonclient","layered-windows","nonclient-area"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12148906,"title":"WM_NCHITTEST not changing mouse cursor","body":"<p>I have a Layered Window (WS_EX_LAYERED) that implements a custom NCHITTEST and NCCALCSIZE to make the client rect of my window the same as the window rect.  My window sizes and paints correctly; I can return HTBOTTOM from WM_NCHITTEST when the cursor is near the bottom edge of my window to cause a vertical-resize-window-from-the-bottom type action.  However, I am not getting the vertical resize cursor.   Is there way a do fix this without having to implement WM_SETCURSOR and test the pointer's position vs the edges of the windows?</p>\n\n<p>Here's a snippet of my code:</p>\n\n<pre><code>case WM_NCCALCSIZE:                   \n    // Bypass DefWindowProc, so the Window Rect == Client Rect\n    return 0;\ncase WM_NCHITTEST:  {            \n    RECT w;\n    ::GetWindowRect(hwnd, &amp;w);  \n    // Compare the mouse X/Y vs the rect of the window to detect\n    // resizing from the bottom edges\n    int r = HTCLIENT;\n    int x = GET_X_LPARAM(lParam);\n    int y = GET_Y_LPARAM(lParam);            \n    if (w.bottom - y &lt; 10) {\n         // If I was not using NCHITTEST, I should get a verticle resize pointer here\n        if (x - w.left &lt; 10)\n            r = HTBOTTOMLEFT;\n        else if (w.right - x &lt; 10)\n            r = HTBOTTOMRIGHT;\n        else\n            r = HTBOTTOM;\n    }   \n    return r;\n    }   \n</code></pre>\n"},{"tags":["c++","winapi","keypress"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":285,"score":1,"question_id":11890972,"title":"Simulating key press with PostMessage only works in some applications?","body":"<p>My approach to this problem turned out to be correct only in several programs. Why it isn't universal?</p>\n\n<p>Works fine on:\n<br>\n<li>Firefox</li><br>\n<li>Visual Studio Text Editor</li>\n</p>\n\n<p>Unfortunately, in some cases nothing happens(even if I click into a textbox area before execution of my program):\n\n<li>Google Chrome</li>\n<li>Notepad</li>\n</p>\n\n<p>GetLastError returns always 0, even using SendMessage instead of PostMessage.Could you point out my mistake?</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;iostream&gt;\n\nint main()\n{\n    HWND hCurrentWindow;\n\n    Sleep(5000);\n\n    hCurrentWindow = GetForegroundWindow();\n\n    std::cout&lt;&lt;\"GO!!!\\n\";\n\n    for(int i=0; i&lt;500; i++) //simulate 500 keystrokes of 'E'.\n        {\n            PostMessage(hCurrentWindow,WM_KEYDOWN,0x45,NULL);\n            PostMessage(hCurrentWindow,WM_KEYUP,0x45,NULL);\n        }\n\n    std::cout&lt;&lt;GetLastError()&lt;&lt;std::endl;\n\n    system(\"Pause\");\n    return 0;\n}\n</code></pre>\n\n<p><strong>UPDATE after Maximus sugestion</strong></p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;iostream&gt;\n\nint main()\n{\n    HWND hCurrentWindow;\n\n    Sleep(5000);\n\n    hCurrentWindow = GetForegroundWindow();\n\n    if(!hCurrentWindow)\n        std::cout&lt;&lt;\"Failed get set the window handle\\n\";\n\n    std::cout&lt;&lt;\"GO!!!\\n\";\n\n    for(int i=0; i&lt;500; i++)\n        {\n            PostMessage(hCurrentWindow,WM_KEYDOWN,0x45,0x45);\n            PostMessage(hCurrentWindow,WM_KEYUP,0x45,0x45);\n        }\n\n    std::cout&lt;&lt;GetLastError()&lt;&lt;std::endl;\n\n    system(\"Pause\");\n    return 0;\n}\n</code></pre>\n\n<p>There is no difference in effect.</p>\n\n<p><strong>UPDATE after Rob Kennedy's comment and Hans Passant's answer</strong></p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;iostream&gt;\n\nint main()\n{\n    HWND hCurrentWindow;\n    DWORD procID;\n    GUITHREADINFO currentWindowGuiThreadInfo;\n\n    Sleep(5000);\n\n    hCurrentWindow = GetForegroundWindow();\n\n    if(!hCurrentWindow)\n        std::cout&lt;&lt;\"Failed get main the window handle\\n\";\n\n    GetWindowThreadProcessId(hCurrentWindow,&amp;procID); \n    GetGUIThreadInfo(procID,&amp;currentWindowGuiThreadInfo);               \n    hCurrentWindow = currentWindowGuiThreadInfo.hwndFocus;\n\n    if(!hCurrentWindow)\n        std::cout&lt;&lt;\"Failed get the child window handle\\n\";\n\n    std::cout&lt;&lt;\"GO!!!\\n\";\n\n    for(int i=0; i&lt;500; i++)\n        {\n            PostMessage(hCurrentWindow,WM_KEYDOWN,0x45, MapVirtualKey(0x45,MAPVK_VK_TO_VSC));\n            PostMessage(hCurrentWindow,WM_KEYUP,0x45, MapVirtualKey(0x45,MAPVK_VK_TO_VSC));\n        }\n\n    std::cout&lt;&lt;GetLastError()&lt;&lt;std::endl;\n\n    system(\"Pause\");\n    return 0;\n}\n</code></pre>\n\n<p>Now, \"transparent\" messages are sent every time. GetLastError() says:</p>\n\n<blockquote>\n  <p>ERROR_INVALID_WINDOW_HANDLE</p>\n\n<pre><code>1400 (0x578)\n\nInvalid window handle.\n</code></pre>\n</blockquote>\n\n<p><strong>GetLastError() \"fixed\"</strong></p>\n\n<pre><code>int main()\n{\n    HWND hCurrentWindow;\n    DWORD procID;\n    GUITHREADINFO currentWindowGuiThreadInfo;\n\n    Sleep(5000);\n\n    hCurrentWindow = GetForegroundWindow();\n\n    if(!hCurrentWindow)\n        std::cout&lt;&lt;\"Failed get main the window handle\\n\";\n\n    GetWindowThreadProcessId(hCurrentWindow,&amp;procID); \n    GetGUIThreadInfo(procID,&amp;currentWindowGuiThreadInfo);               \n    hCurrentWindow = currentWindowGuiThreadInfo.hwndFocus;\n\n    if(!hCurrentWindow)\n        std::cout&lt;&lt;\"Failed get the child window handle\\n\";\n\n    std::cout&lt;&lt;\"GO!!!\\n\";\n\n    for(int i=0; i&lt;500; i++)\n        {\n\n            if(!PostMessage(hCurrentWindow,WM_KEYDOWN,0x45, MapVirtualKey(0x45,MAPVK_VK_TO_VSC))) std::cout&lt;&lt;GetLastError()&lt;&lt;std::endl;\n            if(!PostMessage(hCurrentWindow,WM_KEYUP,0x45, MapVirtualKey(0x45,MAPVK_VK_TO_VSC)))   std::cout&lt;&lt;GetLastError()&lt;&lt;std::endl;\n        }\n\n\n\n    system(\"Pause\");\n    return 0;\n}\n</code></pre>\n\n<p>...outputs <code>1400</code> thousand times. Except this, nothing has changed.</p>\n"},{"tags":["winapi","nsis"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12147540,"title":"How to use System::Call to call WindowFromPoint windows API function","body":"<p>How do you pass a POINT struct to <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms633558%28v=vs.85%29.aspx\" rel=\"nofollow\">WindowFromPoint()</a> in system plugin syntax?</p>\n"},{"tags":["c++","visual-studio-2010","winapi","casting","compiler-errors"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12147108,"title":"Passing 'this' pointer as LPARAM","body":"<p>I have as class as follows:</p>\n\n<pre><code>#include &lt;Windows.h&gt;\nclass MyClass\n{\n   void A();\n   static BOOL CALLBACK proc(HWND hwnd, LPARAM lParam);\n};\n\nvoid MyClass::A()\n{\n   EnumChildWindows(GetDesktopWindow(), MyClass::proc, static_cast&lt;LPARAM&gt;(this));\n}\n\nBOOL CALLBACK MyClass::proc(HWND hwnd, LPARAM lParam)\n{\n   // ...\n   return TRUE;\n}\n</code></pre>\n\n<p>When I attempt to compile this in Visual C++ 2010, I get the following compiler error:</p>\n\n<p>error C2440: 'static_cast' : cannot convert from 'MyClass *const ' to 'LPARAM'\nThere is no context in which this conversion is possible</p>\n\n<p>If I change the definition of <code>MyClass::A</code> as follows, then the compile succeeds:</p>\n\n<pre><code>void MyClass::A()\n{\n   EnumChildWindows(GetDesktopWindow(), MyClass::proc, (LPARAM)this);\n}\n</code></pre>\n\n<p>What is the explanation for the error in the first example?</p>\n"},{"tags":["c++","winapi","bitmap","gdi"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":12145313,"title":"Win32 API - GDI : save part of applicative window in memory","body":"<p>I want to move a bitmap like a sprite : when it moves, it restores the previously saved part of the windows before beeing displayed at its new place (with save of the screen behind).\nHere is my relexions :</p>\n\n<ul>\n<li>I create a DC of the applicative window : <code>hDC = GetDC(hwnd)</code></li>\n<li>I create a compatible DC of the the previoux DC : <code>htmpDC = CreateCompatibleDC(hDC)</code>. It's the DC that will contain the saved part of the window</li>\n<li>I load (with LoadImage) the bitmap to display : <code>hbitmap=(HBITMAP)LoadImage(GetModuleHandle(0), MAKEINTRESOURCE(Id), IMAGE_BITMAP, 0, 0, LR_DEFAULTCOLOR);</code>. It is to get the size of the part to be saved.</li>\n<li>I receive the size of the image with <code>GetObject(hbitmap, sizeof(BITMAP), &amp;bitmap);</code></li>\n<li>I create a compatible bitmap with the size of the bitmap loaded : <code>tmpbm = CreateCompatibleBitmap(htmpDC, bitmap.bmWidth, bitmap.bmHeight);</code></li>\n<li>I select this bitmap in the compatible DC : <code>SelectObject(htmpDC,tmpbm);</code></li>\n<li>Now I can save the part of the window that will erased by the bitmap loaded : <code>BitBlt(htmpDC, 0, 0, bitmap.bmWidth, bitmap.bmHeight, hdc, x, y, SRCCOPY);</code>. x and y are the coordonates of the part of the window.</li>\n<li>I can now display the bitmap loaded : <code>DrawState(hDC, NULL, NULL, (LPARAM)hbitmap, (WPARAM)NULL, x, y, 0, 0, DST_BITMAP | DSS_NORMAL);</code></li>\n<li>I release the DCs.</li>\n</ul>\n\n<p>The bitmap is displayed, but when I try to display the saved part to erase the bitmap, nothing happens...</p>\n\n<p>Where is saved the part of the window ? When I release the htmpDC, where is the saved part ?</p>\n\n<p>This stuff is made in an object : can I keep the htmpDC alive and save many parts before releasing in the destructor ?</p>\n\n<p>I copied parts of codes found in internet but I don't understand all this GDI process.</p>\n\n<p>Thank you for your answers !</p>\n"},{"tags":["winapi","memory","memory-management"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12121843,"title":"MapViewOfFileEx - valid lpBaseAddress","body":"<p>In answer to a question about mapping non-contiguous blocks of files into contiguous memory, <a href=\"http://stackoverflow.com/questions/10454964/mapping-non-contiguous-blocks-from-a-file-into-contiguous-memory-addresses\">here</a>, it was suggested by one respondent that I should use <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa366887%28v=vs.85%29.aspx\" rel=\"nofollow\">VirtualAllocEx</a>() with MEM_RESERVE in order to establish a 'safe' value for the final (lpBaseAddress) parameter for <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa366763%28v=vs.85%29.aspx\" rel=\"nofollow\">MapViewOfFileEx</a>().</p>\n\n<p>Further investigation revealed that this approach causes MapViewofFileEx() to fail with error 487: \"Attempt to access invalid address.\"  <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa366887%28v=vs.85%29.aspx\" rel=\"nofollow\">The MSDN page says</a>:</p>\n\n<blockquote>\n  <p>\"No other memory allocation can take place in the region that is used for mapping, including the use of the VirtualAlloc or VirtualAllocEx function to reserve memory.\"</p>\n</blockquote>\n\n<p>While the documentation might be considered ambiguous with respect to valid sequences of calls, experimentation suggests that it is not valid to reserve memory for MapViewOfFileEx() using VirtualAllocEx().</p>\n\n<p>On the web, I've found examples with hard-coded values - <a href=\"http://publib.boulder.ibm.com/infocenter/comphelp/v7v91/index.jsp?topic=/com.ibm.vacpp7a.doc/proguide/ref/xumemex1.htm\" rel=\"nofollow\">example</a>:</p>\n\n<pre><code>#define BASE_MEM     (VOID*)0x01000000\n</code></pre>\n\n<p>...</p>\n\n<pre><code>hMap = MapViewOfFileEx( hFile, FILE_MAP_WRITE, 0, 0, 0, BASE_MEM );\n</code></pre>\n\n<p>To me, this seems inadequate and unreliable... It is far from clear to me why this address is safe, or how many blocks can be safely be mapped there.  It seems even more shaky given that I need my solution to work in the context of other allocations... and that I need my source to compile and work in both 32 and 64 bit contexts.</p>\n\n<p>What I'd like to know is if there is <strong>any</strong> way to reliably reserve a pool of address space in order that - subsequently - it can be reliably used by MapViewOfFileEx to map blocks to explicit memory addresses.</p>\n"},{"tags":["c++","winapi","windows-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12144111,"title":"Service always in STOPPED state","body":"<p>I have a problem with a service, when I try to install it like this :</p>\n\n<pre><code>sc create MemoryStatus binpath= \"C:\\Users\\rock\\Documents\\Visual Studio 2010\\Projects\\ServiceInC\\Release\\ServiceInC.exe\"\n</code></pre>\n\n<p>I get a message in cmd that service is installed successfully, but when I take a look on it via Task Manager it is always in stopped state. The one more thing is that service is not even started, cause I dont see any log messages.</p>\n\n<p>It seems like there is some problem with permissions or something like that, can you please help me with that?</p>\n\n<p>MY main Service function is :</p>\n\n<pre><code>void ServiceMain(int argc, char** argv) \n{ \n    int error; \n\n    ServiceStatus.dwServiceType        = SERVICE_WIN32; \n    ServiceStatus.dwCurrentState       = SERVICE_START_PENDING; \n    ServiceStatus.dwControlsAccepted   = SERVICE_ACCEPT_STOP | SERVICE_ACCEPT_SHUTDOWN;\n    ServiceStatus.dwWin32ExitCode      = 0; \n    ServiceStatus.dwServiceSpecificExitCode = 0; \n    ServiceStatus.dwCheckPoint         = 0; \n    ServiceStatus.dwWaitHint           = 0; \n\n    hStatus = RegisterServiceCtrlHandler(\n        \"MemoryStatus\", \n        (LPHANDLER_FUNCTION)ControlHandler); \n    if (hStatus == (SERVICE_STATUS_HANDLE)0) \n    { \n        // Registering Control Handler failed\n        WriteToLog(\"Registering Control Handler failed\");\n        return; \n    }  \n    // Initialize Service \n    error = InitService(); \n    if (error) \n    {\n        // Initialization failed\n        WriteToLog(\"Initialization failed\");\n        ServiceStatus.dwCurrentState       = SERVICE_STOPPED; \n        ServiceStatus.dwWin32ExitCode      = -1; \n        SetServiceStatus(hStatus, &amp;ServiceStatus); \n        return; \n    } \n    // We report the running status to SCM. \n    ServiceStatus.dwCurrentState = SERVICE_RUNNING; \n    SetServiceStatus (hStatus, &amp;ServiceStatus);\n\n    MEMORYSTATUS memory;\n    // The worker loop of a service\n    while (ServiceStatus.dwCurrentState == SERVICE_RUNNING)\n    {\n        char buffer[16];\n        GlobalMemoryStatus(&amp;memory);\n        sprintf(buffer, \"%d\", memory.dwAvailPhys);\n        int result = WriteToLog(buffer);\n        if (result)\n        {\n            ServiceStatus.dwCurrentState       = SERVICE_STOPPED; \n            ServiceStatus.dwWin32ExitCode      = -1; \n            SetServiceStatus(hStatus, &amp;ServiceStatus);\n            return;\n        }\n\n        Sleep(SLEEP_TIME);\n    }\n    return; \n}\n</code></pre>\n\n<p>One more thing that I forgot to say, when I force run service frfom task manager it seems to work.</p>\n"},{"tags":["windows","winapi","video","directx","video-streaming"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12143969,"title":"fastast way of 'upstreaming' rambuffers as video (under windows)","body":"<p>Hullo. I am curious how would be the fastest way of sending 'ram data' to screen (as graphics video-like data) and how fast it would be on today's pc's </p>\n\n<p>Is it something like blit under windows gdi or rather some things form DX or openGl will be much more effective? Are big values such as 500 fps (or more) possible or not? </p>\n\n<p>I am interested in both - 'window client area' and 'fullscren' modes.\nDoes anybody know? Much tnx for answer. (I dont even know how tags are applied for that)</p>\n\n<p>//edit:</p>\n\n<p>ps. Once ago I tested ram to window blits under windows gdi and there were not \nterribly fast (it was about 1-15 ms depending on windows size (say about 5 ms on average) - though I had old computer machine to test it ( 7 years old pentium 4 )) - is there some much quickiest way of doin \nsuch streaming / blitting? tnx</p>\n"},{"tags":["winapi","windows-7","kernel32","readprocessmemory"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":189,"score":0,"question_id":12122323,"title":"ReadProcessMemory fails on some Pages (GetLastError()=299)","body":"<p>I try to read all commited pages of a process (Win7-64). On most pages it works but it fails for a few pages. I cannot explain why. Here is my test programme (compiled x32, tested in Win7-64):</p>\n\n<pre><code>#include &lt;windows.h&gt;\n\nvoid main()\n{\n    HANDLE hProc = OpenProcess(PROCESS_VM_READ | PROCESS_QUERY_INFORMATION,FALSE,GetCurrentProcessId());\n\n    SYSTEM_INFO si;\n    ZeroMemory(&amp;si,sizeof(SYSTEM_INFO));\n    GetSystemInfo(&amp;si);\n\n    char* buf = new char[si.dwPageSize];\n\n    for (unsigned i = 0; i &lt; 0x7fff0; i++)\n    {\n        void* baseOffs = (void*) (i * si.dwPageSize);\n        MEMORY_BASIC_INFORMATION mbi;\n        ZeroMemory(&amp;mbi,sizeof(MEMORY_BASIC_INFORMATION));\n\n        if (VirtualQueryEx(hProc, baseOffs, &amp;mbi, sizeof(MEMORY_BASIC_INFORMATION)) == 0)\n        {\n            MessageBox(NULL, TEXT(\"VirtualQueryEx failed\"),TEXT(\"\"),MB_OK);\n        }\n\n        if (mbi.State == MEM_COMMIT)\n        {\n            SIZE_T numByteWritten = 0;\n            if(ReadProcessMemory(hProc, baseOffs,buf,si.dwPageSize,&amp;numByteWritten) == FALSE)\n                OutputDebugString(TEXT(\"bad\\n\")); //GetLastError()==ERROR_PARTIALLY_READ; numByteWritten == 0;\n            else\n                OutputDebugString(TEXT(\"good\\n\"));\n\n        }\n    }\n\n    delete[] buf;\n}\n</code></pre>\n\n<p>I tired to look into the MEMORY_BASIC_INFORMATION for the failing pages but I didn't find anything strange there. Also the number of failing pages varies from run to run (in average about 5). WHat prevents me from reading these pages? Do I need to adjust some privilges in the process token?</p>\n"},{"tags":["c++","windows","winapi","windows-7","windows-shell"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":12057270,"title":"How can I add a context menu for recycle bin","body":"<p>How can I manage to add a context menu for windows recycle bin? And how could I eventually access the files within? I know Recycle bin is a virtual folder and that it has a tree-like structure, do I have to go all the way to access the files within?</p>\n\n<p><strong>edited:</strong></p>\n\n<pre><code>HKLM\n{\nNoRemove Software\n{\n    NoRemove Classes \n    {\n        NoRemove CLSID\n        {\n            NoRemove {645FF040-5081-101B-9F08-00AA002F954E}\n            {\n                NoRemove shellex\n                {\n                    NoRemove ContextMenuHandlers\n                    {\n                        ForceRemove {FC944A65-4422-4A2C-B867-1BA01318A944}\n                    }\n                }\n            }\n        }\n     }      \n   }\n}   \n</code></pre>\n"},{"tags":["winapi","x86","x64","createprocess"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":121,"score":0,"question_id":7143769,"title":"create x86 process under VISTAx64","body":"<p>I create a x86 process under WindowsServer2003 x64, ok, it work fine!</p>\n\n<p>but I try creating a x86 process under VISTA x64.\nit's failed with error code = 216. (ERROR_EXE_MACHINE_TYPE_MISMATCH).</p>\n\n<p>anything difference between 2003x64 and VISTAx64?</p>\n"},{"tags":["c++","winapi","synchronization","critical-section"],"answer_count":5,"favorite_count":9,"up_vote_count":11,"down_vote_count":0,"view_count":5070,"score":11,"question_id":853316,"title":"Is Critical Section always faster?","body":"<p>I was debugging a multi-threaded application and found the internal structure of <code>CRITICAL_SECTION</code>. I found data member <code>LockSemaphore</code> of CRITICAL_SECTION an interesting one. </p>\n\n<p>It looks like <code>LockSemaphore</code> is an auto-reset event (not a semaphore as the name suggests) and operating system creates this event silently when first time a thread waits on <code>Critcal Section</code> which is locked by some other thread. </p>\n\n<p>Now, I am wondering is Critical Section always faster? Event is a kernel object and each Critical section object is associated with event object then how <code>Critical Section</code> can be faster compared to other kernel objects like Mutex? Also, how does internal event object actually affects the performance of Critical section ? </p>\n\n<p>Here is the structure of the <code>CRITICAL_SECTION</code>:</p>\n\n<pre><code>struct RTL_CRITICAL_SECTION\n{\n    PRTL_CRITICAL_SECTION_DEBUG DebugInfo;\n    LONG LockCount;\n    LONG RecursionCount;\n    HANDLE OwningThread;\n    HANDLE LockSemaphore;\n    ULONG_PTR SpinCount;\n};\n</code></pre>\n"},{"tags":["c++","winapi","visual-c++","internationalization"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":1021,"score":5,"question_id":1653874,"title":"Implementing Globalization / Multilingual feature in win32 API application","body":"<p>I have developend a window application(Win32 API) in visual C++. I have to add multilingual feature in this application. Can any one Pls guide me how to get forward with this task. </p>\n"},{"tags":["c++","winapi","dll","injection"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":188,"score":-1,"question_id":12138841,"title":"DLL Injection fails with code 127","body":"<p>I am trying to do some dll injection. I think I tried everything I could but cound not solve the problem unfortunately. I always get ERROR CODE 127 which means ERROR_PROC_NOT_FOUND. I am using Windows 7 64 bit.</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;Windows.h&gt;\n#include &lt;TlHelp32.h&gt;\n\nusing namespace std;\n\nchar FileToInject[] = \"theDll.dll\";\nchar ProcessName[] = \"calc.exe\";\n\ntypedef HINSTANCE (*fpLoadLibrary)(char*);\n\nbool InjectDLL(DWORD processId);\n\nint main() {\n    DWORD processId = NULL;\n\n    PROCESSENTRY32 pre32 = {sizeof(PROCESSENTRY32)};\n    HANDLE hProcSnap;\n    cout &lt;&lt; \"BEFORECreateToolhelo32Snapshot:\" &lt;&lt; GetLastError() &lt;&lt;endl;\n    while(!processId) {\n\n            system(\"CLS\");\n            cout &lt;&lt; \"Searching...\" &lt;&lt; endl;\n            hProcSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);\n            cout &lt;&lt; \"CreateToolhelo32Snapshot:\" &lt;&lt; GetLastError() &lt;&lt;endl;\n\n            if(Process32First(hProcSnap, &amp;pre32)) {\n\n                    do {\n\n                        if(!(strcmp(pre32.szExeFile, ProcessName))) {\n\n                           processId = pre32.th32ProcessID;\n                           break;\n\n                        }\n\n                    }\n                    while(Process32Next(hProcSnap, &amp;pre32));\n            }\n            Sleep(1000);\n    }\n    cout &lt;&lt; GetLastError() &lt;&lt;endl;\n    while(!InjectDLL(processId)) {\n        cout &lt;&lt; \"DLL Injection failed\" &lt;&lt; endl;\n        Sleep(1000);\n    }\n\n    cout &lt;&lt; \"DLL Injected successfully\" &lt;&lt; endl;\n    getchar();\n    CloseHandle(hProcSnap);\n\n    return 0;\n}\n\nbool InjectDLL(DWORD processId) {\n\n    HANDLE hProc;\n    LPVOID paramAddr;\n    cout &lt;&lt; \"START:\" &lt;&lt; GetLastError() &lt;&lt;endl;\n    HINSTANCE hDll = LoadLibrary(\"KERNEL32\");\n    cout &lt;&lt; \"LoadLibrary:\" &lt;&lt; GetLastError() &lt;&lt;endl;\n\n    fpLoadLibrary LoadLibraryAddr = (fpLoadLibrary)GetProcAddress(hDll, \"LibraryLoadA\");\n    cout &lt;&lt; \"LoadLibraryArr:\" &lt;&lt; GetLastError() &lt;&lt;endl;\n    hProc = OpenProcess(PROCESS_ALL_ACCESS, false, processId);\n    cout &lt;&lt; \"OpenProcess:\" &lt;&lt; GetLastError() &lt;&lt;endl;\n    char DllPath[250] = \"C:\\\\Hacks\\test.dll\";\n\n    paramAddr = VirtualAllocEx(hProc, 0, strlen(DllPath) + 1, MEM_COMMIT, PAGE_READWRITE);\n    cout &lt;&lt; \"VirtualAlloxEx:\" &lt;&lt;GetLastError() &lt;&lt;endl;\n    bool MemoryWritten = WriteProcessMemory(hProc, paramAddr, DllPath, strlen(DllPath) + 1, NULL);\n    cout &lt;&lt; \"WriteProcessMemory:\" &lt;&lt; GetLastError() &lt;&lt;endl;\n    CreateRemoteThread(hProc, 0, 0, (LPTHREAD_START_ROUTINE)LoadLibraryAddr, paramAddr, 0, 0);\n    cout &lt;&lt; \"CreateRemoteThread:\" &lt;&lt;GetLastError() &lt;&lt;endl;\n    CloseHandle(hProc);\n    return MemoryWritten;\n}\n</code></pre>\n\n<p>The output is the following:</p>\n\n<pre><code>Searching...\nCreateToolhelp32Snapshot: 18 ERROR_NO_MORE_FILES\nLoadLibrary:18 ERROR_NO_MORE_FILES\nLoadLibraryArr:127 ERROR_PROC_NOT_FOUND\nOpenProcess:127 ERROR_PROC_NOT_FOUND\nVirtualAlloxEx:127 ERROR_PROC_NOT_FOUND\nWriteProcessMemory:127 ERROR_PROC_NOT_FOUND\nCreateRemoteThread:5 ACCESS DENIED\nDLL Injected successfully\n</code></pre>\n\n<p>The program finds the calc.exe as a process with no problem, but after that something goes wrong. Could someone please help me with this?</p>\n\n<p>Thank you,</p>\n\n<p>Tamas</p>\n"},{"tags":["c++","windows","winapi","screensaver"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12137105,"title":"To read/set a user screensaver on Windows, do I need to use system registry or SystemParametersInfo API?","body":"<p>There seems to be two methods of setting and getting a user screensaver parameters on a Windows platform:</p>\n\n<p>1: Via the SystemParametersInfo() API:</p>\n\n<pre><code>//To read\nSystemParametersInfo(SPI_GETSCREENSAVEACTIVE, 0, &amp;bScreensaverAcrtive, NULL);\nSystemParametersInfo(SPI_GETSCREENSAVETIMEOUT, 0, &amp;nScreensaverTimeout, NULL);\n//No API to get the screensaver file used\n\n//To set\nSystemParametersInfo(SPI_SETSCREENSAVEACTIVE, 0, bScreensaverAcrtive, NULL);\nSystemParametersInfo(SPI_SETSCREENSAVETIMEOUT, 0, nScreensaverTimeout, NULL);\n//No API to change the screensaver file\n</code></pre>\n\n<p>2: Through the system registry keys:</p>\n\n<pre><code>HKCU\\Control Panel\\Desktop - \"ScreenSaveActive\"\nHKCU\\Control Panel\\Desktop - \"ScreenSaveTimeOut\"\nHKCU\\Control Panel\\Desktop - \"SCRNSAVE.EXE\"\n</code></pre>\n\n<p>But since there're two competing methods that seem to do the same, what is the recommended way to use?</p>\n\n<p>PS. I highly favor method #2 (or writing directly into registry) due to the following reasons:</p>\n\n<p>A. If you read the explanation of a bug in the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms724947%28v=vs.85%29.aspx\" rel=\"nofollow\">SPI_GETSCREENSAVEACTIVE flag</a>, you'll see that MS themselves <a href=\"http://support.microsoft.com/kb/318781\" rel=\"nofollow\">recommend</a> to use registry.</p>\n\n<p>B. If you read the documentation for the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms724947%28v=vs.85%29.aspx\" rel=\"nofollow\">SPI_SETSCREENSAVEACTIVE</a> and <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms724947%28v=vs.85%29.aspx\" rel=\"nofollow\">SPI_SETSCREENSAVETIMEOUT</a> flags, there's this mystical line that says, \"*If the machine has entered power saving mode or system lock state, an ERROR_OPERATION_IN_PROGRESS exception occurs.*\" I first ignored this situation until it actually started happening on my test installation of Windows 8. This is the most asinine error, I should tell you. There's absolutely no graceful way of interpreting what it means or do any workaround (except, writing directly into the registry.)</p>\n"},{"tags":["c++","winapi","screen","power-management"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12116893,"title":"c++ set monitor timeout on Windows","body":"<p>I was wondering if there's a way to enable or disable monitor/screen timeout from a C++ program on a global scale? (I have one catch though, it must be backward compatible with Windows XP SP3.)</p>\n\n<p>I'm talking about this global setting:</p>\n\n<p><img src=\"http://i.stack.imgur.com/p8utd.png\" alt=\"Windows 8 screenshot\"></p>\n\n<p>of this one for XP:</p>\n\n<p><img src=\"http://i.stack.imgur.com/gL2JU.png\" alt=\"XP screenshot\"></p>\n"},{"tags":["winapi","installer","nsis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12134917,"title":"Add a window to an existing MUI Page","body":"<p><strong>Is it possible to add a window(a Label) to an existing MUI page; like the installer page, welcome page?</strong></p>\n\n<p>I would like to add a new label to the installer page. My code below adds a new Static window to the window but its never shown/sits above other windows. <em>I know the window exists because I can see it using WinSpy++ but it sits behind another window.</em> Also the new window has a funny style \"Style: 50000000  (hidden, enabled)\" whilst other normal static windows have the style \"Style: 5000008C  (visible, enabled)\".</p>\n\n<p><strong>How can I get my label(Static Window) to show?</strong></p>\n\n<pre><code>!include nsdialogs.nsh\n!include MUI2.nsh\n\n!define MUI_PAGE_CUSTOMFUNCTION_SHOW instshow\n\n!insertmacro MUI_PAGE_INSTFILES\n!insertmacro MUI_LANGUAGE \"English\"\n\nOutFile \"test.exe\"\n\nFunction instshow\n    FindWindow $0 \"#32770\" \"\" $HWNDPARENT\n    GetDlgItem $2 $0 1016\n    System::Call 'USER32::CreateWindowEx(i0,t \"STATIC\",t \"Some option\",i ${WS_CHILD}|${WS_VISIBLE},i100,i100,i100,i20,i$2,i666,i0,i0) $R2'\n    System::Call `user32::SetWindowPos(i $R2, i ${HWND_TOP}, i 0, i 0, i 0, i 0, i ${SWP_NOSIZE}|${SWP_NOMOVE})` # attempt to push new label to front\n\n    # Attempt to refresh new labels parent window\n    GetDlgItem $R0 $HWNDPARENT 1016\n    ShowWindow $R0 ${SW_HIDE}\n    ShowWindow $R0 ${SW_SHOW}\n    # Attempt to refresh new label \n    ShowWindow $R2 ${SW_HIDE}\n    ShowWindow $R2 ${SW_SHOW}\nFunctionEnd\n\n\nSection \"Dummy\"\n\nSectionEnd\n</code></pre>\n"},{"tags":["c++","winapi","file","delete"],"answer_count":7,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1224,"score":3,"question_id":1753209,"title":"DeleteFile fails on recently closed file","body":"<p>I have a single threaded program (C++, Win32, NTFS) which first creates a quite long temporary file, closes it, opens for read, reads, closes again and tries to delete using DeleteFile().</p>\n\n<p>Usually it goes smoothly, but sometimes DeleteFile() fails, and GetLastError() returns  ERROR_ACCESS_DENIED. File is not read-only for sure. It happens on files on any size, but the probability grows with the file size.</p>\n\n<p>Any ideas what may be locking the file? I tried WinInternals tools to check and found nothing suspicious.</p>\n"},{"tags":["winapi","installer","nsis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12135196,"title":"Call Function When Someone Selects a Component on the Component MUI Page","body":"<p>I am trying to add some custom functionality to the MUI2 Components Page.</p>\n\n<p>When the user selects a Component(Checkbox) I want to call my custom function. If the 1st component has bee selected then I want to check/select the 2nd component also.</p>\n\n<p>My code below attempts to code this functionality but I am getting compile errors:</p>\n\n<blockquote>\n  <p>Error in macro __NSD_OnControlEvent on macroline 8</p>\n</blockquote>\n\n<pre><code>!include nsdialogs.nsh\n!include MUI2.nsh\n\n!define MUI_PAGE_CUSTOMFUNCTION_SHOW compshow\n\n!insertmacro MUI_PAGE_COMPONENTS\n!insertmacro MUI_PAGE_INSTFILES\n!insertmacro MUI_LANGUAGE \"English\"\n\nOutFile \"test.exe\"\n\nFunction OnCustomisationComponentClick \n    #SendMessage 1032 ${TVM_SETITEM} 0 $someTVItem\n    MessageBox MB_OK \"abc\"\nFunctionEnd\n\nFunction compshow\n    FindWindow $0 \"#32770\" \"\" $HWNDPARENT\n    GetDlgItem $0 $0 1032 # 1032 is the Treeview that holds the components\n    !insertmacro __NSD_OnControlEvent ${TVM_SELECTITEM} $0 OnCustomisationComponentClick\nFunctionEnd\n\n\nSection \"Dummy\"\n\nSectionEnd\n</code></pre>\n"},{"tags":["c++","c","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":101,"score":-3,"question_id":12124470,"title":"Win32 C application that opens randomly installed application","body":"<p>I'm a newbie to the world of win32 API.\nI conduct a small research about the <strong>CreateProcess</strong> function.</p>\n\n<p>I would like to open a randomly installed program (notepad, mspaint, calc,...) with the <strong>CreateProcess</strong> function.</p>\n\n<p>My question has two parts:</p>\n\n<ol>\n<li><p>How do i retrieve a list of such installed programs via the registry?</p></li>\n<li><p>After i have a list of the installed programs, how do I find their path to pass as the first parameter to the <strong>CreateProcess</strong> function?</p></li>\n</ol>\n\n<p>Thank you very much,</p>\n\n<p>Alex</p>\n"},{"tags":["winapi","nsis"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":839,"score":0,"question_id":9348346,"title":"How to restart chrome browser without getting it crashed","body":"<p>I'm killing the process in order to close chrome.exe but when I re-open, it says that chrome has crashed.</p>\n\n<p>I also tried:</p>\n\n<pre><code>FindWindow $0 \"Chrome_WidgetWin_0\"\n${If} $0 &lt;&gt; 0 \n    SendMessage $0 0x0112 0xF060 0\n${EndIf}\n</code></pre>\n\n<p>But it doesn't seems to work</p>\n\n<p>The code is NSIS but it uses WIN32 calls (findwindow, sendmessage).</p>\n\n<p>Thanks</p>\n"},{"tags":["vb.net","winapi","topmost"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":2,"view_count":270,"score":4,"question_id":12125685,"title":"Find the Handle of the window at the top of the screen","body":"<p>I want to check when the window of an external application (a Poker On Line Game Table) jumps over all other windows because it's my turn to play.</p>\n\n<p>The problem is that the Game table jumps in the foreground... but the window DOES NOT BECOME ACTIVE... this means that I can't check if it is jumped over all the other visible windows by the API GetForegroundWindow (and in fatc this API continue to return the Handle of the previous window, also if it is UNDER the Game Table that is jumped over ALL the desktop windows). Also the GetTopWindow API don't works.</p>\n\n<p>Now the question is: how to find the handle of the top VISIBLE window (the window that is over all the other open windows for my eyes) also if it is not active???</p>\n\n<hr>\n\n<p>No, the Window IS NOT a TopMost window: in fact if I click on another window it goes in background. If it should be a TopMost window it would remain on the top.</p>\n\n<p>Probably it is put in the foreground by a WM_SHOW or WM_NOACTIVATE flag.</p>\n"},{"tags":["c#","vb.net","winapi","browser-cache","protected-mode"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":627,"score":2,"question_id":4588788,"title":"DeleteURLCacheEntry doesnot delete Temporary Internet files when Protected Mode is ON","body":"<p>I am using \"deleteURLCacheEntry\" Wininet API to delete temporary internet files on Win7/Vista IE 7/8 respectively. The API works perfectly fine when IE's protected mode is OFF. But it fails silently when the protected mode is ON. Can somebody advise me how to delete the temporary internet files programmatically when PROTECTED MODE is ON?</p>\n\n<p>I am basically using the program given in the following msdn link:</p>\n\n<p><a href=\"http://support.microsoft.com/kb/815718\" rel=\"nofollow\">http://support.microsoft.com/kb/815718</a></p>\n\n<p>Thank you.</p>\n"},{"tags":["c#",".net","winforms","winapi","gui"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12131692,"title":"Make VScroll disabled instead of hidden in ListView","body":"<p>Is there any way to make vertical scrollbar look disabled instead of hidden in ListView?\nThanks in advance.</p>\n"},{"tags":["c","winapi","double-buffering"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":116,"score":3,"question_id":12130534,"title":"Is it possible to eliminate flickering entirely when resizing a window?","body":"<p>Normally, even when using double buffering, when resizing a window, it seems that it's inevitable that the flickering will happen.</p>\n\n<p>Step 1, the original window.</p>\n\n<blockquote>\n  <p><img src=\"http://i.stack.imgur.com/6ABf2.png\" alt=\"Step 1\"></p>\n</blockquote>\n\n<p>Step 2, the window is resized, but the extra area hasn't been painted.</p>\n\n<blockquote>\n  <p><img src=\"http://i.stack.imgur.com/1BDpy.png\" alt=\"Step 2\"></p>\n</blockquote>\n\n<p>Step 3, the window is resized, and the extra area has been painted.</p>\n\n<blockquote>\n  <p><img src=\"http://i.stack.imgur.com/1Z2TP.png\" alt=\"Step 3\"></p>\n</blockquote>\n\n<p>Is it possible somehow to hide setp 2? Can I suspend the resizing process until the painting action is done?</p>\n\n<p>Here's an example:</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;windowsx.h&gt;\n#include &lt;Uxtheme.h&gt;\n\n#pragma comment(lib, \"Uxtheme.lib\")\n\nLRESULT CALLBACK WindowProc(HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam);\nBOOL MainWindow_OnCreate(HWND hWnd, LPCREATESTRUCT lpCreateStruct);\nvoid MainWindow_OnDestroy(HWND hWnd);\nvoid MainWindow_OnSize(HWND hWnd, UINT state, int cx, int cy);\nvoid MainWindow_OnPaint(HWND hWnd);\n\nint APIENTRY wWinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPWSTR lpCmdLine, int nCmdShow)\n{\n  WNDCLASSEX wcex = { 0 };\n  HWND hWnd;\n  MSG msg;\n  BOOL ret;\n\n  wcex.cbSize = sizeof(wcex);\n  wcex.lpfnWndProc = WindowProc;\n  wcex.hInstance = hInstance;\n  wcex.hIcon = (HICON)LoadImage(NULL, IDI_APPLICATION, IMAGE_ICON, 0, 0, LR_SHARED);\n  wcex.hCursor = (HCURSOR)LoadImage(NULL, IDC_ARROW, IMAGE_CURSOR, 0, 0, LR_SHARED);\n  wcex.lpszClassName = TEXT(\"MainWindow\");\n  wcex.hIconSm = wcex.hIcon;\n\n  if (!RegisterClassEx(&amp;wcex))\n  {\n    return 1;\n  }\n\n  hWnd = CreateWindow(wcex.lpszClassName, TEXT(\"CWin32\"), WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, HWND_DESKTOP, NULL, hInstance, NULL);\n  if (!hWnd)\n  {\n    return 1;\n  }\n\n  ShowWindow(hWnd, nCmdShow);\n  UpdateWindow(hWnd);\n\n  while ((ret = GetMessage(&amp;msg, NULL, 0, 0)) != 0)\n  {\n    if (ret == -1)\n    {\n      return 1;\n    }\n    TranslateMessage(&amp;msg);\n    DispatchMessage(&amp;msg);\n  }\n\n  return msg.wParam;\n}\n\nLRESULT CALLBACK WindowProc(HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam)\n{\n  switch (uMsg)\n  {\n    HANDLE_MSG(hWnd, WM_CREATE, MainWindow_OnCreate);\n    HANDLE_MSG(hWnd, WM_DESTROY, MainWindow_OnDestroy);\n    HANDLE_MSG(hWnd, WM_SIZE, MainWindow_OnSize);\n    HANDLE_MSG(hWnd, WM_PAINT, MainWindow_OnPaint);\n  default:\n    return DefWindowProc(hWnd, uMsg, wParam, lParam);\n  }\n}\n\nBOOL MainWindow_OnCreate(HWND hWnd, LPCREATESTRUCT lpCreateStruct)\n{\n  BufferedPaintInit();\n  return TRUE;\n}\n\nvoid MainWindow_OnDestroy(HWND hWnd)\n{\n  BufferedPaintUnInit();\n  PostQuitMessage(0);\n}\n\nvoid MainWindow_OnSize(HWND hWnd, UINT state, int cx, int cy)\n{\n  InvalidateRect(hWnd, NULL, FALSE);\n}\n\nvoid MainWindow_OnPaint(HWND hWnd)\n{\n  PAINTSTRUCT ps;\n  HPAINTBUFFER hpb;\n  HDC hdc;\n\n  BeginPaint(hWnd, &amp;ps);\n  hpb = BeginBufferedPaint(ps.hdc, &amp;ps.rcPaint, BPBF_COMPATIBLEBITMAP, NULL, &amp;hdc);\n\n  FillRect(hdc, &amp;ps.rcPaint, GetStockBrush(DKGRAY_BRUSH));\n  Sleep(320); // This simulates some slow drawing actions.\n\n  EndBufferedPaint(hpb, TRUE);\n  EndPaint(hWnd, &amp;ps);\n}\n</code></pre>\n\n<p>Is it possible to eliminate the flickering?</p>\n"},{"tags":["c++","winapi","text","control"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":137,"score":0,"question_id":12125293,"title":"unable to get text from edit control in winapi","body":"<p>I'm not able to retrieve any text from the edit control I have on my main window. I can set the text, which does show up when the window is drawn, but I can not get the text, which I would like to display in a MessageBox. I tried both \"SendMessage()\" and \"GetWindowText()\" but both do the same thing. It appears the length of text I'm retrieving is also invalid, so the edit has no value even though I can see text in it.</p>\n\n<pre><code>LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam) {\nint wmId, wmEvent;\nPAINTSTRUCT ps;\nHDC hdc;\nHWND addCust, editCust1, editCust2;\n\nswitch (message) {\ncase WM_CREATE: {\n    addCust = CreateWindow(L\"BUTTON\",L\"addCust\",\n                   WS_CHILD|WS_VISIBLE|BS_DEFPUSHBUTTON,\n                   140,70,100,25,hWnd,(HMENU)IDC_ADDCUST,NULL,NULL);\n    editCust1 = CreateWindowEx(WS_EX_CLIENTEDGE,L\"EDIT\",L\"\",\n                    WS_CHILD|WS_VISIBLE|ES_AUTOHSCROLL,\n                    50,100,200,20,hWnd,(HMENU)IDC_EDITCUST1,NULL,NULL);\n    editCust2 = CreateWindowEx(WS_EX_CLIENTEDGE,L\"EDIT\",L\"\",\n                    WS_CHILD|WS_VISIBLE|ES_AUTOHSCROLL,\n                    50,130,200,20,hWnd,(HMENU)IDC_EDITCUST2,NULL,NULL);\n    SendMessage(editCust1,WM_SETTEXT,NULL,(LPARAM)L\"first name\");\n    SendMessage(editCust2,WM_SETTEXT,NULL,(LPARAM)L\"last name\");\n    break;\n}\ncase WM_COMMAND:\n    wmId    = LOWORD(wParam);\n    wmEvent = HIWORD(wParam);\n    case IDC_ADDCUST: {\n        TCHAR buff[64] = { '\\0' };\n        int len = SendMessage(editCust1, WM_GETTEXTLENGTH, 0, 0);\n        SendMessage(editCust1, WM_GETTEXT, len+1, (LPARAM)buff);\n        GetWindowText(editCust1, buff, len+1);\n        MessageBox(NULL, buff, L\"Information\", MB_ICONINFORMATION);\n        break;\n        }\n    default:\n        return DefWindowProc(hWnd, message, wParam, lParam);\n    }\n    break;\ndefault:\n    return DefWindowProc(hWnd, message, wParam, lParam);\n}\nreturn 0;\n}\n</code></pre>\n"},{"tags":["perl","winapi","gui","hook"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12123774,"title":"How to use the Windows \"hook function\" with Perl Win32::GUI?","body":"<p>I am working on Windows XP SP 3, Strawberry Perl.\nI would like to let the user of my Perl program select a file; but when using Win32::GUI::GetOpenFileName(), I would like the Windows file selection dialog to open in the \"Details\" file list option, and not in the default \"List\" file list option.</p>\n\n<p>Googling on the Net, it seems that I have to use the Windows \"hook\" function, and send certain messages to the file selection control. The documentation about that is MSDN, and I don't seem to master how to apply it in Perl. </p>\n\n<p>Can anyone recommend what should be the right call syntax in Perl?</p>\n\n<p>Here is my code sample, where the file selection dialog opens with the (default) \"List\" option:</p>\n\n<pre><code> use strict;\n use warnings;\n use 5.014;    \n use Win32::Console;\n use Win32::GUI();\n use autodie; \n use warnings    qw&lt; FATAL  utf8     &gt;;\n use Carp::Always;\n use Win32API::File::Time qw{:win};\nuse Image::ExifTool qw(:Public);\nuse Date::Parse;\n\n# ...\nmy ( $FileName, $ImageDir, $DIR, $TopDir);\n# ...\n$TopDir = 'D:\\My Documents';\n    $ImageDir = Win32::GUI::BrowseForFolder( -root =&gt; $TopDir, -includefiles =&gt; 1,);\n    unless ($ImageDir) { \n        say '$DirName not defined after calling Win32::GUI::BrowseForFolder, ',\n        'Photo date set line'.__LINE__;\n        exit;\n    }\n    else {\n        say \"Identified directory: $ImageDir\";\n    }    \n    # now select a file\n\n    $FileName = Win32::GUI::GetOpenFileName( -title  =&gt; 'Select an image file', -directory =&gt; $ImageDir,\n        -file   =&gt; \"\\0\" . \" \" x 256,\n        -filter =&gt; [\"Image files (*.jpg)\" =&gt; \"*.jpg;*.jpeg\", \"All files\", \"*.*\", ],);\n    unless ($FileName) {\n        say '$FileName not defined after calling Win32::GUI::GetOpenFileName, ',\n        'Photo date set line'.__LINE__;\n    }\n    else {\n        say \"Identified image file: $FileName\";\n    }\n# ...\n</code></pre>\n\n<p>Note: (somewhat) similar post at: <a href=\"http://www.perlmonks.org/?node_id=989418\" rel=\"nofollow\">http://www.perlmonks.org/?node_id=989418</a></p>\n"},{"tags":["windows","winapi","multi-touch","gestures","ogre"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":103,"score":1,"question_id":9861405,"title":"Including Windows API calls in my Ogre Application","body":"<p>i'm developing an Ogre application and i'm adding support to touch and gestures to it, because i want to use it on touch-enabled PCs.</p>\n\n<p>Very well, after searching the web, i've found the Windows Gestures API <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd371578%28v=vs.85%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/dd371578%28v=vs.85%29.aspx</a> . It suports not only touch recognition but gesture interpretation, which sounds just great! </p>\n\n<p>I want to include it in my application, but my question is: this Windows sample creates its own window, its own main loops, how do i include it in my ogre app using my ogre window?</p>\n"},{"tags":["c++","winapi","data-structures"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":114,"score":2,"question_id":8371556,"title":"Line management in a text editor","body":"<p>I've been working on a text editor for some time. I made a custom edit control, from scratch, and I've got the basics down now. The problem I am facing is regarding line management. Since, my program relies on dividing the input text into lines(the text is printed line by line), line management is pretty important. I was using std::vector to store the line positions. I am using a Piece Table for my text processing, but for the sake of simplicity, let's say that I have an array of characters. I add/insert an element into the line vector every time the user presses enter. The issue is that every time the user inserts a character, the whole structure is disturbed. For example : </p>\n\n<pre><code>         0   1   2   3   4   5    6   7   8   9   10\ntext = ['h','e','l','l','o','\\n','W','o','r','l','d']\nstate of line vector : \nline[0] = 0 \nline[1] = 6\n</code></pre>\n\n<p>Let's say the user inserts a character('x') after the  text[2]:</p>\n\n<pre><code>         0   1   2   3   4   5    6   7   8   9   10  11\ntext = ['h','e','l','x','l','o','\\n','W','o','r','l','d'] \nstate of line vector : \nline[0] = 0 \nline[1] = 6\n</code></pre>\n\n<p>Because of the insertion, I would need to update the value of each element in the lines vector after the current line. The same for deletion. If there are 1000 lines in a program and the user edits the first line, it would be quite inefficient to update all 999 elements(except the first one). </p>\n\n<p>What I was thinking of was to keep each line independent of each other. But that would lead to complications when an existing line is divided into two lines. So I'd like to know what's a good way to go about the problem?</p>\n\n<p>Edit: \nJust to clarify, I am using a data structure called Piece Table. I am not using an array of characters. Here is what a piece table data structure is :\n<a href=\"http://www.cs.unm.edu/~crowley/papers/sds.pdf\" rel=\"nofollow\">http://www.cs.unm.edu/~crowley/papers/sds.pdf</a></p>\n"},{"tags":["c#","winapi","multiple-monitors","mouse-hook"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":113,"score":1,"question_id":12122801,"title":"Obtain mouse click position relative to active window","body":"<p>Having worked out how to obtain the mouse click position anywhere along the monitor boundaries using low level hooks I receive an X Y coordinate that will contain a value typically between <code>x: -1680 to +1920</code> and <code>y: 0 to 1200</code> in my pcs case. Easy enough!</p>\n\n<p>Now the problem is that I now want to calculate the mouse position relative to a given window that I have so I use <code>GetForegroundWindow()</code> and <code>GetWindowRect(HandleRef hWnd, out RECT lpRect)</code> to obtain my active window coordinates.</p>\n\n<p>Where I am stuck is I require the current active desktop (By active I mean which monitor the click occurred on) to calculate the coordinates of my mouse click relative to a window.</p>\n\n<p>Unfortunately I have not been able to find an API call like <code>GetActiveMonitor()</code> or similar so hopefully someone can point me in the right direction? </p>\n"},{"tags":["c","winapi","registry"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":113,"score":0,"question_id":11802590,"title":"RegEnumKeyEx doesn't work properly","body":"<p>I'm trying make a function that lists all subkeys of a specific (windows registry) key.</p>\n\n<p>What's happening is that only the 1st item is outputted correctly, all the others are truncated or repeated - I think it's a buffer issue.</p>\n\n<p>I've already read the function documentation, but it hasn't helped me much.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;windows.h&gt;\n\nvoid print_list(HKEY hkey, char* path){\n\nchar dwValue[255];\nDWORD  dwSize = 0;\nDWORD n; // subkeys\nHKEY tmp;\nint i;\n\nif(RegOpenKeyEx(hkey, path, 0, KEY_READ, &amp;tmp) == ERROR_SUCCESS){\n\n    DWORD  dwSize = sizeof(dwValue);\n\n    RegQueryInfoKey(tmp,NULL,NULL,NULL,&amp;n,NULL,NULL,NULL,NULL,NULL,NULL,NULL);      \n\n    for(i=0; i&lt; n; i++){\n        RegEnumKeyEx(tmp,i,dwValue,&amp;dwSize,NULL,NULL,NULL,NULL);\n        printf(\"%s\\n\", dwValue);\n    }\n\n    RegCloseKey(tmp);\n}\n}\n\nint main(){\nprint_list(HKEY_LOCAL_MACHINE, \"SOFTWARE\");\nreturn 0;\n}\n</code></pre>\n"},{"tags":["visual-studio-2008","winapi","visual-c++","api-hook"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":58,"score":0,"question_id":12106490,"title":"My Build is not working on machines in which visual studio is not installed","body":"<p>Hi all i have developed one build by hooking two functions that are 1) NtCreateFile and\n2) NtSetInformationFile for monitoring File Raname, Delete, Create . it is working fine on windows-7 32 and 64 bit on which visual studio installed but it is not working on same if the visual studio is not installed.please help me. my code is as follow</p>\n\n<pre><code>#include \"stdafx.h\"\n#include &lt;windows.h&gt;\n#include \"MinHook.h\"\n#include &lt;Winternl.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;shlwapi.h&gt;\n#include &lt;tchar.h&gt;\n#include &lt;string.h&gt;\n\n\n#if defined _M_X64\n#pragma comment(lib, \"libMinHook.x64.lib\")\n#elif defined _M_IX86\n#pragma comment(lib, \"libMinHook.x86.lib\")\n#endif\n\n\n#define FILE_SUPERSEDED                         0x00000000\n#define FILE_OPENED                             0x00000001\n#define FILE_CREATED                            0x00000002\n#define FILE_OVERWRITTEN                        0x00000003\n#define FILE_EXISTS                             0x00000004\n#define FILE_DOES_NOT_EXIST                     0x00000005\n\n#define FILE_RENAMED 10\n#define FILE_DELETED 13\n#define FILE_MODIFIED 19\n\nenum OBJECT_INFORMATION_CLASS \n{ \nObjectNameInformation = 1\n};\n\nstruct MOUNTMGR_TARGET_NAME \n{\nUSHORT DeviceNameLength; \nWCHAR DeviceName[1]; \n};\n\nstruct MOUNTMGR_VOLUME_PATHS \n{ \nULONG MultiSzLength; \nWCHAR MultiSz[1];\n};\n\nstruct FILE_NAME_INFORMATION \n{ \nULONG FileNameLength;\nWCHAR FileName[1];\n};\n\nunion ANY_BUFFER \n{\nWCHAR Buffer[USHRT_MAX];\nMOUNTMGR_TARGET_NAME TargetName;\nMOUNTMGR_VOLUME_PATHS TargetPaths;\nFILE_NAME_INFORMATION NameInfo;\nUNICODE_STRING UnicodeString;\n};\n\ntypedef struct _FILE_RENAME_INFORMATION \n{\nBOOLEAN ReplaceIfExists;\nHANDLE  RootDirectory;\nULONG   FileNameLength;\nWCHAR   FileName[1];\n} FILE_RENAME_INFORMATION, *PFILE_RENAME_INFORMATION;\n\nextern \"C\" NTSYSAPI NTSTATUS NTAPI NtQueryObject(HANDLE Handle OPTIONAL, OBJECT_INFORMATION_CLASS ObjectInformationClass, PVOID ObjectInformation OPTIONAL, ULONG ObjectInformationLength, PULONG ReturnLength OPTIONAL);\n\nextern \"C\" NTSYSAPI NTSTATUS NTAPI NtCreateFile(PHANDLE FileHandle, ACCESS_MASK DesiredAccess, POBJECT_ATTRIBUTES ObjectAttributes,\n                                 PIO_STATUS_BLOCK IoStatusBlock, PLARGE_INTEGER AllocationSize, ULONG FileAttributes,\n                                 ULONG ShareAccess, ULONG CreateDisposition, ULONG CreateOptions, PVOID EaBuffer, ULONG EaLength);\n\nextern \"C\" NTSYSAPI NTSTATUS NTAPI NtSetInformationFile(HANDLE FileHandle, PIO_STATUS_BLOCK IoStatusBlock, PVOID FileInformation,\n                                         ULONG Length, FILE_INFORMATION_CLASS FileInformationClass);\n\n//AnsiToUnicode Function ;\nHRESULT __fastcall AnsiToUnicode(LPCSTR pszA, LPOLESTR* ppszW)\n{\nULONG cCharacters;\nDWORD dwError;\n\nif (NULL == pszA)\n{\n    *ppszW = NULL;\n    return NOERROR;\n}\ncCharacters =  strlen(pszA) + 1;\n\n*ppszW = (LPOLESTR) CoTaskMemAlloc(cCharacters*2);\nif (NULL == *ppszW)\n    return E_OUTOFMEMORY;\n\n// Covert to Unicode.\nif (0 == MultiByteToWideChar(CP_ACP, 0, pszA, cCharacters, *ppszW, cCharacters))\n{\n    dwError = GetLastError();\n    CoTaskMemFree(*ppszW);\n    *ppszW = NULL;\n    return HRESULT_FROM_WIN32(dwError);\n}\nreturn NOERROR;\n}\n\n//UnicodeToAnsi Function;\nHRESULT __fastcall UnicodeToAnsi(LPCOLESTR pszW, LPSTR* ppszA)\n{\nULONG cbAnsi, cCharacters;\nDWORD dwError;\n\nif (pszW == NULL)\n{\n    *ppszA = NULL;\n    return NOERROR;\n}\ncCharacters = wcslen(pszW) + 1;  \ncbAnsi = cCharacters*2;\n\n*ppszA = (LPSTR) CoTaskMemAlloc (cbAnsi);\nif (NULL == *ppszA)\n    return E_OUTOFMEMORY;\n\n// Convert to ANSI.\nif (0 == WideCharToMultiByte(CP_ACP, 0, pszW, cCharacters, *ppszA, cbAnsi, NULL, NULL))\n{\n    dwError = GetLastError();\n    CoTaskMemFree(*ppszA);\n    *ppszA = NULL;\n    return HRESULT_FROM_WIN32(dwError);\n}\nreturn NOERROR;\n}\n\nchar *replace(const char *s, const char *old, const char *newstr)\n{\nchar *ret = NULL, *sr = NULL;\nsize_t i, count = 0;\nsize_t newlen = strlen(newstr);\nsize_t oldlen = strlen(old);\n\nif (newlen != oldlen)\n{\n    for (i = 0; s[i] != '\\0'; ) \n    {\n        if (memcmp(&amp;s[i], old, oldlen) == 0)\n            count++, i += oldlen;\n        else\n            i++;\n    }\n}\nelse\n    i = strlen(s);\nret = (char*) malloc(i + 1 + count * (newlen - oldlen));\n\nif (ret == NULL)\n    return NULL;\n\nsr = ret;\nwhile (*s)\n{\n    if (memcmp(s, old, oldlen) == 0)\n    {\n        memcpy(sr, newstr, newlen);\n        sr += newlen;\n        s += oldlen;\n    }\n    else\n        *sr++ = *s++;\n}\n*sr = '\\0';\nreturn ret;\n}\n\nvoid GetFileNameFromVolumeName(wchar_t * VolumeName, wchar_t * FilePath)\n{\nwchar_t *Ptr = NULL ;\nif ((Ptr = StrStrIW(VolumeName, L\"\\\\device\\\\mup\"))!= NULL)\n{ \n    wcscpy(FilePath, Ptr + 11);\n    return;\n}\nif ((Ptr = StrStrIW(VolumeName, L\"\\\\??\\\\UNC\"))!= NULL)\n{\n    wcscpy(FilePath, Ptr + 7);\n    return;\n}   \nif ((Ptr = StrStrIW(VolumeName, L\"\\\\??\\\\\"))!= NULL)\n{\n    wcscpy(FilePath, Ptr + 4);\n    return;\n}\n}\n\nvoid GetFileNameFromDeviceName (wchar_t * DevicePath,wchar_t * FilePath)\n{\nint i, j = 0;\nDWORD  test, mydrives = 100;\nwchar_t *lpBuffer = new wchar_t[100];\nwchar_t *lpTargetPath = new wchar_t[1000];\nwchar_t *drives = new wchar_t[26];\nwchar_t *str1 = new wchar_t[512] ;\n\nwchar_t *pch;\ntest = GetLogicalDriveStringsW(mydrives, lpBuffer);\n\nif (test != 0)\n{\n    for (i = 0; i &lt; 100; i += 4)\n    {\n        wsprintf(drives + j,L\"%c:\", lpBuffer[i]);\n        if (wcslen(drives + j) == 0) break;\n        QueryDosDeviceW((LPCWSTR)drives + j, lpTargetPath, 1000);\n\n        if ((pch = StrStrIW(DevicePath, lpTargetPath)) != NULL)\n        {\n            wcscpy(str1, drives + j);\n            wcsncat(str1, DevicePath + wcslen(lpTargetPath), wcslen(DevicePath) - wcslen(lpTargetPath));\n            wcscpy(FilePath, str1);\n            delete drives;\n            delete str1 ;\n            break;\n        }\n        j+= 2;\n    }\n    delete lpBuffer;\n    delete lpTargetPath;\n}\n}\n\nvoid GetFilePath(HANDLE hFile, wchar_t *filename)\n{\nstatic ANY_BUFFER nameFull, nameRel, nameMnt;\nULONG returnedLength; \nNTSTATUS status;\nstatus = NtQueryObject(hFile, ObjectNameInformation, nameFull.Buffer, sizeof(nameFull.Buffer), &amp;returnedLength);\nwchar_t *ptr = wcschr(nameFull.UnicodeString.Buffer, L'\\\\');\n\nif (StrStrIW(ptr, L\"device\\\\mup\") == NULL)\n    GetFileNameFromDeviceName(ptr, filename);\nelse\n    GetFileNameFromVolumeName(ptr, filename);\n}\n\ntypedef NTSTATUS(WINAPI *NtCreateFileNext)(PHANDLE FileHandle, ACCESS_MASK DesiredAccess, POBJECT_ATTRIBUTES ObjectAttributes,\n                                       PIO_STATUS_BLOCK IoStatusBlock, PLARGE_INTEGER AllocationSize, ULONG FileAttributes,\n                                       ULONG ShareAccess, ULONG CreateDisposition, ULONG CreateOptions, PVOID EaBuffer, ULONG EaLength);\n\nNtCreateFileNext Real_NtCreateFileData = NULL;\n\nNTSTATUS WINAPI NtCreateFileCallback(PHANDLE FileHandle, ACCESS_MASK DesiredAccess, POBJECT_ATTRIBUTES ObjectAttributes,\n                                 PIO_STATUS_BLOCK IoStatusBlock, PLARGE_INTEGER AllocationSize, ULONG FileAttributes,\n                                 ULONG ShareAccess, ULONG CreateDisposition, ULONG CreateOptions, PVOID EaBuffer, ULONG EaLength)\n{\nLPSTR  buff = NULL ;\nHRESULT res = 0;\nLPOLESTR AnsiToUniBuf = {0};\nNTSTATUS status;\nPOBJECT_ATTRIBUTES OAttributes ; \n\nstatus = Real_NtCreateFileData(FileHandle, DesiredAccess, ObjectAttributes, IoStatusBlock, AllocationSize, FileAttributes, ShareAccess, CreateDisposition, CreateOptions, EaBuffer, EaLength);\n\nchar * buffer = new char [MAX_PATH];\nchar * buff2  = new char [MAX_PATH];\nwchar_t  *FileCreated = new wchar_t[512];\n\nif (IoStatusBlock-&gt;Information == FILE_CREATED)\n{\n    GetFileNameFromVolumeName(ObjectAttributes-&gt;ObjectName-&gt;Buffer, FileCreated); \n    MessageBoxW(NULL, FileCreated, L\"Created\", MB_OK);\n\n    /*UnicodeToAnsi( ObjectAttributes-&gt;ObjectName-&gt;Buffer, &amp;buff);\n    for (int i = 0 ; i &lt; strlen(buff) ; i++)\n    {\n        buff2[i] = tolower(buff[i]);\n    }\n    buffer = replace(buff2, \"\\\\??\\\\c:\", \"\\\\??\\\\d:\");\n    AnsiToUnicode(buffer,&amp;AnsiToUniBuf); \n    wcscpy(ObjectAttributes-&gt;ObjectName-&gt;Buffer, AnsiToUniBuf);*/\n}\ndelete buffer;\ndelete buff2;\ndelete FileCreated;\nreturn status;\n}\n\ntypedef NTSTATUS(WINAPI *NtSetInformationFileNext)(HANDLE FileHandle, PIO_STATUS_BLOCK IoStatusBlock, PVOID FileInformation,\n                                               ULONG Length, FILE_INFORMATION_CLASS FileInformationClass);\n\nNtSetInformationFileNext Real_NtSetInformationFileData = NULL;\n\nNTSTATUS WINAPI NtSetInformationFileCallback(HANDLE FileHandle, PIO_STATUS_BLOCK IoStatusBlock, PVOID FileInformation,\n                                         ULONG Length, FILE_INFORMATION_CLASS FileInformationClass)\n{\nwchar_t  * renfrom = new wchar_t[512];\n\nif (FileInformationClass == FILE_DELETED)\n{\n    memset(renfrom, 0, sizeof(wchar_t)*512);\n    GetFilePath(FileHandle,renfrom);\n    MessageBoxW(NULL, renfrom, L\"Deleted File\", MB_OK);\n}\n\nif (FileInformationClass == FILE_RENAMED)\n{   \n    memset(renfrom, 0, sizeof(wchar_t)*512);\n    FILE_RENAME_INFORMATION *pInfo = NULL;\n    pInfo=(PFILE_RENAME_INFORMATION)FileInformation;\n    GetFilePath(FileHandle,renfrom);\n    MessageBoxW(NULL, renfrom, L\"Renamed From\", MB_OK);\n    memset(renfrom, 0, sizeof(wchar_t)*512);\n    GetFileNameFromVolumeName(pInfo-&gt;FileName, renfrom);\n    MessageBoxW(NULL, renfrom, L\"Renamed To\", MB_OK);   \n}\n\nif (FileInformationClass == FILE_MODIFIED)\n{\n    memset(renfrom, 0, sizeof(wchar_t)*512);\n    GetFilePath(FileHandle,renfrom);\n    MessageBoxW(NULL, renfrom, L\"Modified File\", MB_OK);\n}\n\ndelete renfrom;\nreturn Real_NtSetInformationFileData(FileHandle, IoStatusBlock, FileInformation, Length, FileInformationClass);\n}\n\n//DllMain Function \nBOOL APIENTRY DllMain(HMODULE hModule, DWORD  ul_reason_for_call, LPVOID lpReserved)\n{\n//HINSTANCE hwnd = LoadLibraryA(\"ntdll.dll\");\n//if (hwnd != NULL)\n//{\n//  Actual_NtCreateFileData = (NtCreateFileNext)GetProcAddress(hwnd, \"NtCreateFile\");\n//  //Actual_NtSetInformationFileData = (NtSetInformationFileNext)(hwnd, \"NtSetInformationFile\");\n//}\n\nswitch (ul_reason_for_call)\n{\ncase DLL_PROCESS_ATTACH:\n    if (MH_Initialize() != MH_OK)\n    {\n        MessageBoxW(NULL, L\"Failed Initialize\", L\"Info!\", MB_ICONWARNING|MB_OK);    \n    }\n    if (MH_CreateHook(&amp;NtCreateFile, &amp;NtCreateFileCallback, reinterpret_cast&lt;void**&gt;(&amp;Real_NtCreateFileData)) != MH_OK)\n    {\n        MessageBoxW(NULL, L\"Failed CreateHook NtCreateFile\", L\"Info!\", MB_ICONWARNING|MB_OK);\n    }\n    if (MH_EnableHook(&amp;NtCreateFile) != MH_OK)\n    {\n        MessageBoxW(NULL, L\"Failed EnableHook NtCreateFile\", L\"Info!\", MB_ICONWARNING|MB_OK);\n    }\n    if (MH_CreateHook(&amp;NtSetInformationFile, &amp;NtSetInformationFileCallback, reinterpret_cast&lt;void**&gt;(&amp;Real_NtSetInformationFileData)) != MH_OK)\n    {\n        MessageBoxW(NULL, L\"Failed CreateHook NtSetInformationFile\", L\"Info!\", MB_ICONWARNING|MB_OK);\n    }\n    if (MH_EnableHook(&amp;NtSetInformationFile) != MH_OK)\n    {\n        MessageBoxW(NULL, L\"Failed EnableHook NtSetInformationFile\", L\"Info!\", MB_ICONWARNING|MB_OK);\n    }\n    break;\n\ncase DLL_PROCESS_DETACH:\n    if (MH_Uninitialize() != MH_OK)\n    {               \n    }\n    if (MH_DisableHook(&amp;NtCreateFile) != MH_OK)\n    {\n    }\n    if (MH_DisableHook(&amp;NtSetInformationFile) != MH_OK)\n    {\n    }\n    break;\n}\nreturn TRUE;\n}\n</code></pre>\n\n<p>The above code is building fine and after it get build if try to inject this dll in explorer process on windows-7 32/64 bit with visual studio installed it is injecting and working fine but it is not injecting in any of the process for windows-7 32/64 bit machines with visual studio not installed.please help me</p>\n"},{"tags":["c++","winapi","mfc","pdf-generation"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":119,"score":2,"question_id":12114909,"title":"Converting HTML file to PDF using Win32/MFC","body":"<p>As part of my application, my client has requested that I include an automated e-mailing system. As part of this system, I generate HTML code and use automation to send it via. Outlook.</p>\n\n<p>However, they also require a PDF copy of the HTML document to be sent as an attachment. My initial attempts involved using <a href=\"http://libharu.org/wiki/Main_Page\" rel=\"nofollow\">libHaru</a>, which proved difficult to use efficiently, as I was required to create the PDF document from scratch, which required computation of the position of each of the lines in a table, and positioning of all the text, etc.</p>\n\n<blockquote>\n  <p>I was wondering if there would be a way to programmatically convert HTML code (or an HTML file if need be) into a PDF document either by using Win32/MFC itself or an external library.</p>\n</blockquote>\n\n<p>Thanks in advance!</p>\n\n<p>EDIT: Just to clarify, I am looking for solutions which minimize external dependencies.</p>\n"},{"tags":["winapi","visual-c++","msvcrt","wdk","ddk"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":522,"score":2,"question_id":7006541,"title":"Where is msvcrtd.dll?","body":"<p>Where can I find <code>msvcrtd.dll</code> (the <strong>debug</strong> CRT), corresponding to <code>\\WinDDK\\7600.16385.1\\lib\\Crt\\i386\\msvcrtd.lib</code> in the <a href=\"http://msdn.microsoft.com/en-us/windows/hardware/gg487463\" rel=\"nofollow\">Windows Driver Kit</a>?</p>\n"},{"tags":["windows","winapi","cmd","executable","command-line-arguments"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12110285,"title":"Is the caller of a Windows program responsible for adding \\\\?\\ to long file name arguments","body":"<p>In my Java program, I am using a command line library to fork a Java process. This fails (depending on how the program is used) when the file path of the JAR file that I pass in the <code>java.exe -jar</code> call exceeds the 260 character path length limit of Windows. (The error message is <code>Error: Unable to access jarfile</code> followed by the path name.) I can make the Java call work by (manually) adding a <code>\\\\?\\</code> prefix to the JAR file name. This solves the one particular problem instance, but is this generally the right approach?</p>\n\n<p>Should I expect Windows programs to correctly handle long paths passed as command line arguments, - or - is it the caller's responsibility to detect long paths and to add the <code>\\\\?\\</code> prefix?</p>\n\n<p>Or less general: Is there a bug in the <code>java.exe</code> or in the command line library?</p>\n"},{"tags":["c++","windows","winapi","sendmessage","sendkeys"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":151,"score":0,"question_id":12099957,"title":"How to send a keystroke to an other process (ex a notepad)?","body":"<p>I got a notepad which has a PID: 2860<br></p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;windows.h&gt;\n#include &lt;psapi.h&gt;\nusing namespace std;\nHWND SendIt (DWORD dwProcessID){\n    HWND hwnd = NULL;\n    do {\n         hwnd = FindWindowEx(NULL, hwnd, NULL, NULL);\n         DWORD dwPID = 0;\n         GetWindowThreadProcessId(hwnd, &amp;dwPID);\n         if (dwPID == dwProcessID) {\n            cout&lt;&lt;\"yay:\"&lt;&lt;hwnd&lt;&lt;\":pid:\"&lt;&lt;dwPID&lt;&lt;endl;//debug\n            PostMessage(hwnd,WM_KEYDOWN,'A',1); //send\n         }\n    } while (hwnd != 0);\n    return hwnd; //Ignore that\n\n}\nint main()\n{\n    SendIt(2680); //notepad ID\n    return 0;\n}\n</code></pre>\n\n<p>and notepad should write <code>A</code> to it but nothing happens.<br>\nI tried <code>WM_DESTROY</code> message on it and it's working but <code>WM_KEYDOWN</code> is not working.<br>\nI have also done <code>GetLastError()</code> and it prints error 2 <code>ERROR_FILE_NOT_FOUND</code>.<br><br></p>\n\n<p>Why is this not working and is it possible to fix it? </p>\n"},{"tags":["python","windows","winapi","time"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12110748,"title":"In Python, using win32api doesn't set the correct date","body":"<p>I am trying to set system date (not time) using following code. I want to set the current time  to the new date. Following is a sample code and I found the time is not correct after change.</p>\n\n<pre><code>day = 20\nmonth = 3\nyear = 2010\n\ntimetuple = time.localtime()\nprint timetuple\nprint timetuple[3], timetuple[4], timetuple[5]\nwin32api.SetSystemTime(year, month, timetuple[6]+1, \n    day, timetuple[3], timetuple[4], timetuple[5], 1)\n</code></pre>\n"},{"tags":["delphi","winapi","delphi-xe"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":232,"score":2,"question_id":12108295,"title":"Problems with extracting  file summary information","body":"<p>I apologize for my English, it's not good, but I hope you will understand my question. I have problem with usage of WinAPI function <code>StgOpenStorageEx</code>. I need to get file's summary information. I found some solutions, but in all of them I need to use <code>StgOpenStorageEx</code>. Because it is not in standard modules, I declared it myself as exported from ole32.dll like this</p>\n\n<pre><code>function StgOpenStorageEx (\n  const pwcsName : POleStr;  //Pointer to the path of the\n                             //file containing storage object\n  grfMode : LongInt;         //Specifies the access mode for the object\n  stgfmt : DWORD;            //Specifies the storage file format\n  grfAttrs : DWORD;          //Reserved; must be zero\n  pStgOptions : Pointer;     //Address of STGOPTIONS pointer\n  reserved2 : Pointer;       //Reserved; must be zero\n  riid : PGUID;              //Specifies the GUID of the interface pointer \n  out stgOpen :              //Address of an interface pointer\n  IStorage ) : HResult; stdcall; external 'ole32.dll';   \n</code></pre>\n\n<p>Next I need to use this function like this</p>\n\n<pre><code>    var\n        res, open: hresult;\n        stg: IStorage;\n        PropSetStg: IPropertySetStorage;\n        PropStg: IPropertyStorage;\n        FileName: string;\n\n    const\n        IID_IPropertySetStorage : TGUID =     '{0000013A-0000-0000-C000-000000000046}';\n        FmtID_SummaryInformation: TGUID =     '{F29F85E0-4FF9-1068-AB91-08002B27B3D9}';\n\n    function StgOpenStorageEx (\n     const pwcsName : POleStr;  //Pointer to the path of the\n                                //file containing storage object\n     grfMode : LongInt;         //Specifies the access mode for the object\n     stgfmt : DWORD;            //Specifies the storage file format\n     grfAttrs : DWORD;          //Reserved; must be zero\n     pStgOptions : Pointer;     //Address of STGOPTIONS pointer\n     reserved2 : Pointer;       //Reserved; must be zero\n     riid : PGUID;              //Specifies the GUID of the interface pointer\n     out stgOpen :              //Address of an interface pointer\n     IStorage ) : HResult; stdcall; external 'ole32.dll';\n     ...\n     implementation\n     ...\n     FileName:=OpenDialog1.FileName;\n     res:=StgOpenStorageEx(PWideChar(FileName),\n        STGM_READ or STGM_SHARE_DENY_WRITE,\n        STGFMT_FILE,\n        0, nil,  nil, @IID_IPropertySetStorage, stg);\n     OleCheck(res);\n\n     PropSetStg := Stg as IPropertySetStorage;\n\n     open:=PropSetStg.Open(FmtID_SummaryInformation,\n        STGFMT_FILE or STGM_READ or STGM_SHARE_EXCLUSIVE, PropStg); //open=-2147287038 \n     OleCheck(open); // EOleSysError \"%1 could not be found\n     ...\n</code></pre>\n\n<p>On instruction <code>OLECheck(Open)</code> I have an EOleSysError \"%1 could not be found\".\n<code>Open</code> returns -2147287038 </p>\n\n<p>Please tell me what I'm doing wrong\n<a href=\"http://www.tek-tips.com/viewthread.cfm?qid=992447\" rel=\"nofollow\">Article with full function code</a></p>\n\n<p>IDE: Embarcadero® Delphi® XE Version 15.0.3890.34076 </p>\n"},{"tags":["c#","winforms","winapi","winforms-interop"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":216,"score":3,"question_id":12102000,"title":"Send Win API paste cmd from background C# app","body":"<p><strong>Goal</strong>: write a C# app that runs in the background, listens for the key combination Win-V, and when that occurs, pastes the clipboard contents into the current active window (some arbitrary app). Essentially I'm trying to mimic <a href=\"http://www.stevemiller.net/puretext/\" rel=\"nofollow\">PureText</a>, but I'm not bothering to convert the text to plain text first.</p>\n\n<p><strong>Problem</strong>: pasting into the currently active windows is not working.</p>\n\n<p><strong>Details</strong>: To listen in the background for key presses I'm using the <em>globalKeyboardHook</em> class from <a href=\"http://www.codeproject.com/Articles/19004/A-Simple-C-Global-Low-Level-Keyboard-Hook\" rel=\"nofollow\">A Simple C# Global Low Level Keyboard Hook</a>. I'm able to catch Win-V events, but I'm not able to send the paste command properly. I can send the paste by using the functions <strong>SendKeys.Send</strong> or <strong>keybd_event</strong>. However, they send another \"V\" press down the pipeline which gets caught by the <strong>gkh_KeyDown</strong> event and causes multiple paste events to fire.</p>\n\n<p>I'm expecting that I need to use <strong>SendMessage</strong> or <strong>PostMessage</strong>, but all my attempts to do that have failed so far. Below is the full code with the last function, <strong>SendCtrlV</strong>, being the one of interest. The comments explain everything I've tried so far. Can you see what I'm missing?</p>\n\n<pre><code>using System;\nusing System.IO;\nusing System.Runtime.InteropServices;\nusing System.Windows.Forms;\nusing Utilities;\n\nnamespace KeyHookTest\n{\n    public partial class Form1 : Form\n    {\n        private bool LWin_down;\n        private bool V_down;\n        globalKeyboardHook gkh = new globalKeyboardHook();\n\n        [DllImport(\"user32.dll\", CharSet = CharSet.Auto)]\n        static public extern IntPtr GetForegroundWindow();\n\n        [DllImport(\"user32.dll\")]\n        static extern void keybd_event(byte bVk, byte bScan, uint dwFlags, uint dwExtraInfo);\n\n        [DllImport(\"user32.dll\")]\n        private static extern int SendMessage(IntPtr hwnd, int msg, int wParam, int lParam);\n\n        [DllImport(\"user32.dll\")]\n        public static extern IntPtr PostMessage(IntPtr hWnd, uint Msg, IntPtr wParam, IntPtr lParam);  \n\n        public Form1()\n        {\n            InitializeComponent();\n        }\n\n        private void Form1_Load(object sender, EventArgs e)\n        {\n            gkh.HookedKeys.Add(Keys.V);\n            gkh.HookedKeys.Add(Keys.LWin);\n            gkh.KeyDown += new KeyEventHandler(gkh_KeyDown);\n            gkh.KeyUp += new KeyEventHandler(gkh_KeyUp);\n        }\n\n        void gkh_KeyUp(object sender, KeyEventArgs e)\n        {\n            if (e.KeyCode == Keys.LWin)\n                LWin_down = false;\n            else\n                V_down = false;\n        }\n\n        void gkh_KeyDown(object sender, KeyEventArgs e)\n        {\n            if (e.KeyCode == Keys.LWin)\n                LWin_down = true;\n            else\n                V_down = true;\n\n            if (LWin_down &amp;&amp; V_down)\n            {\n                LogDebug(\"Enter Win+V\");\n\n                try\n                {\n                    SendCtrlV();\n                }\n                catch { }\n            }\n\n        }\n\n        private void SendCtrlV()\n        {\n            uint KEYEVENTF_KEYUP = 2;\n            int KEYDOWN = 0x0100;\n            int KEYUP = 0x0101;\n            byte KEY_LCONTROL1 = 0x11;\n            IntPtr KEY_LCONTROL2 = new IntPtr(0x11);\n            byte KEY_V1 = 0x56;\n            IntPtr KEY_V2 = new IntPtr(0x56);\n            int WM_PASTE1 = 0x302;\n            uint WM_PASTE2 = 0x302;\n\n            IntPtr hWnd = GetForegroundWindow();\n\n            // Works, but causes multiple gkh_KeyDown to fire so it's slow and buggy\n            /*keybd_event(KEY_LCONTROL1, 0, 0, 0);\n            keybd_event(KEY_V1, 0, 0, 0);\n            keybd_event(KEY_V1, 0, KEYEVENTF_KEYUP, 0);\n            keybd_event(KEY_LCONTROL1, 0, KEYEVENTF_KEYUP, 0);*/\n\n            // Works, but causes multiple gkh_KeyDown to fire so it's slow and buggy\n            //SendKeys.Send(\"^v\");\n\n            // Doesn't work, causes UAC prompt\n            //SendKeys.Send(\"{^}v\");\n\n            // Doesn't work, nothing gets pasted to the foregroundwindow\n            //SendMessage(hWnd, WM_PASTE1, 0, 0);\n\n            // Doesn't work, nothing gets pasted to the foregroundwindow\n            //PostMessage(hWnd, WM_PASTE2, IntPtr.Zero, IntPtr.Zero);\n\n            // Doesn't work, nothing gets pasted to the foregroundwindow\n            /*SendMessage(hWnd, KEYDOWN, KEY_LCONTROL1, 0);\n            SendMessage(hWnd, KEYDOWN, KEY_V1, 0);\n            SendMessage(hWnd, KEYUP, KEY_V1, 0);\n            SendMessage(hWnd, KEYUP, KEY_LCONTROL1, 0);*/\n\n            // Doesn't work, nothing gets pasted to the foregroundwindow\n            /*PostMessage(hWnd, 0x0100, KEY_LCONTROL2, IntPtr.Zero);\n            PostMessage(hWnd, 0x0100, KEY_V2, IntPtr.Zero);\n            PostMessage(hWnd, 0x0101, KEY_V2, IntPtr.Zero);\n            PostMessage(hWnd, 0x0101, KEY_LCONTROL2, IntPtr.Zero);*/\n        }\n\n        private void LogDebug(string msg)\n        {\n            string logpath = Environment.GetEnvironmentVariable(\"USERPROFILE\") + @\"\\Desktop\\KeyHookTest.txt\";\n            File.AppendAllText(logpath, DateTime.Now.ToString(\"HH:mm:ss:fff\") + \": \" + msg + \"\\r\\n\");\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c++","windows","winapi","icons","save"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1607,"score":4,"question_id":2289894,"title":"How can I save HICON to an .ico file?","body":"<p>I am extracting an icon from .exe/.dll and want to save it in an .ico file. What is the best way to do this?</p>\n\n<p>I have tried to use <code>::OleCreatePictureIndirect()</code> and then <code>IPicture-&gt;SaveAsFile()</code>. It works but transparent parts of the icon are painted black (and obviously are not transparent any more :( ).</p>\n\n<p>I tried manual parsing. It works OK but is cumbersome and I am afraid of complications with Vista icons/.icl files/etc.</p>\n\n<p>Please, help. Thanks.</p>\n"},{"tags":[".net","winapi","pinvoke","ioctl","cd"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":126,"score":0,"question_id":12078032,"title":"PInvoke DeviceIOControl for reading ISRC returns no data","body":"<p>I am using the sample Win32Functions Class by Idael Cardoso to interact with CD-Drive. I want to read the ISRC Code of a cd in the tray.</p>\n\n<p>First some Code - this is the Win32Functions Class - I added the hopefully correct code for reading the Q_CHANNEL of the cd, some C++ structures found here (<a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff567601%28v=vs.85%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/hardware/ff567601%28v=vs.85%29.aspx</a>)  and tried to conert them into C#. Finally I added a call of DeviceIOControl for reading ISRC code of a track:</p>\n\n<pre><code>    namespace MyISRCReader\n    {\n  /// &lt;summary&gt;\n  /// Wrapper class for Win32 functions and structures needed to handle CD.\n  /// &lt;/summary&gt;\n  internal class Win32Functions\n  {   \n    public enum DriveTypes:uint \n    {\n      DRIVE_UNKNOWN = 0,\n      DRIVE_NO_ROOT_DIR,\n      DRIVE_REMOVABLE,\n      DRIVE_FIXED,\n      DRIVE_REMOTE,\n      DRIVE_CDROM,\n      DRIVE_RAMDISK\n    };\n\n    [System.Runtime.InteropServices.DllImport(\"Kernel32.dll\")]\n    public extern static DriveTypes GetDriveType(string drive);\n\n    //DesiredAccess values\n    public const uint GENERIC_READ      = 0x80000000;\n    public const uint GENERIC_WRITE     = 0x40000000;\n    public const uint GENERIC_EXECUTE   = 0x20000000;\n    public const uint GENERIC_ALL       = 0x10000000;\n\n    //Share constants\n    public const uint FILE_SHARE_READ   = 0x00000001;  \n    public const uint FILE_SHARE_WRITE  = 0x00000002;  \n    public const uint FILE_SHARE_DELETE = 0x00000004;  \n\n    //CreationDisposition constants\n    public const uint CREATE_NEW        = 1;\n    public const uint CREATE_ALWAYS     = 2;\n    public const uint OPEN_EXISTING     = 3;\n    public const uint OPEN_ALWAYS       = 4;\n    public const uint TRUNCATE_EXISTING = 5;\n\n    /// &lt;summary&gt;\n    /// Win32 CreateFile function, look for complete information at Platform SDK\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"FileName\"&gt;In order to read CD data FileName must be \"\\\\.\\\\D:\" where D is the CDROM drive letter&lt;/param&gt;\n    /// &lt;param name=\"DesiredAccess\"&gt;Must be GENERIC_READ for CDROMs others access flags are not important in this case&lt;/param&gt;\n    /// &lt;param name=\"ShareMode\"&gt;O means exlusive access, FILE_SHARE_READ allow open the CDROM&lt;/param&gt;\n    /// &lt;param name=\"lpSecurityAttributes\"&gt;See Platform SDK documentation for details. NULL pointer could be enough&lt;/param&gt;\n    /// &lt;param name=\"CreationDisposition\"&gt;Must be OPEN_EXISTING for CDROM drives&lt;/param&gt;\n    /// &lt;param name=\"dwFlagsAndAttributes\"&gt;0 in fine for this case&lt;/param&gt;\n    /// &lt;param name=\"hTemplateFile\"&gt;NULL handle in this case&lt;/param&gt;\n    /// &lt;returns&gt;INVALID_HANDLE_VALUE on error or the handle to file if success&lt;/returns&gt;\n    [System.Runtime.InteropServices.DllImport(\"Kernel32.dll\", SetLastError=true)]\n    public extern static IntPtr CreateFile(string FileName, uint DesiredAccess, \n      uint ShareMode, IntPtr lpSecurityAttributes, \n      uint CreationDisposition, uint dwFlagsAndAttributes,\n      IntPtr hTemplateFile);\n\n    /// &lt;summary&gt;\n    /// The CloseHandle function closes an open object handle.\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"hObject\"&gt;Handle to an open object.&lt;/param&gt;\n    /// &lt;returns&gt;If the function succeeds, the return value is nonzero. If the function fails, the return value is zero. To get extended error information, call GetLastError.&lt;/returns&gt;\n    [System.Runtime.InteropServices.DllImport(\"Kernel32.dll\", SetLastError=true)]\n    public extern static int CloseHandle(IntPtr hObject);\n\n    public const uint IOCTL_CDROM_READ_TOC         = 0x00024000;\n    public const uint IOCTL_STORAGE_CHECK_VERIFY   = 0x002D4800;\n    public const uint IOCTL_CDROM_RAW_READ         = 0x0002403E;\n    public const uint IOCTL_STORAGE_MEDIA_REMOVAL  = 0x002D4804;\n    public const uint IOCTL_STORAGE_EJECT_MEDIA    = 0x002D4808;\n    public const uint IOCTL_STORAGE_LOAD_MEDIA     = 0x002D480C;\n    public const uint IOCTL_CDROM_READ_Q_CHANNEL   = 0x0002402C;  // found here: http://mu97bot.googlecode.com/svn-history/r2/trunk/Include/WinAPIEx.au3\n                                                                  // and here:   http://www.ioctls.net/\n\n\n    /// &lt;summary&gt;\n    /// Most general form of DeviceIoControl Win32 function\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"hDevice\"&gt;Handle of device opened with CreateFile, &lt;see cref=\"Ripper.Win32Functions.CreateFile\"/&gt;&lt;/param&gt;\n    /// &lt;param name=\"IoControlCode\"&gt;Code of DeviceIoControl operation&lt;/param&gt;\n    /// &lt;param name=\"lpInBuffer\"&gt;Pointer to a buffer that contains the data required to perform the operation.&lt;/param&gt;\n    /// &lt;param name=\"InBufferSize\"&gt;Size of the buffer pointed to by lpInBuffer, in bytes.&lt;/param&gt;\n    /// &lt;param name=\"lpOutBuffer\"&gt;Pointer to a buffer that receives the operation's output data.&lt;/param&gt;\n    /// &lt;param name=\"nOutBufferSize\"&gt;Size of the buffer pointed to by lpOutBuffer, in bytes.&lt;/param&gt;\n    /// &lt;param name=\"lpBytesReturned\"&gt;Receives the size, in bytes, of the data stored into the buffer pointed to by lpOutBuffer. &lt;/param&gt;\n    /// &lt;param name=\"lpOverlapped\"&gt;Pointer to an OVERLAPPED structure. Discarded for this case&lt;/param&gt;\n    /// &lt;returns&gt;If the function succeeds, the return value is nonzero. If the function fails, the return value is zero.&lt;/returns&gt;\n    [System.Runtime.InteropServices.DllImport(\"Kernel32.dll\", SetLastError=true)]\n    public extern static int DeviceIoControl(IntPtr hDevice, uint IoControlCode, \n      IntPtr lpInBuffer, uint InBufferSize,\n      IntPtr lpOutBuffer, uint nOutBufferSize,\n      ref uint lpBytesReturned,\n      IntPtr lpOverlapped);\n\n    [ StructLayout( LayoutKind.Sequential )]\n    public struct TRACK_DATA \n    {\n      public  byte  Reserved;\n      private byte  BitMapped;\n      public  byte  Control \n      { \n        get\n        {\n          return (byte)(BitMapped &amp; 0x0F);\n        }\n        set\n        {\n          BitMapped = (byte)((BitMapped &amp; 0xF0) | (value &amp; (byte)0x0F));\n        }\n      }\n      public byte Adr\n      {\n        get\n        {\n          return (byte)((BitMapped &amp; (byte)0xF0) &gt;&gt; 4);\n        }\n        set\n        {\n          BitMapped = (byte)((BitMapped &amp; (byte)0x0F) | (value &lt;&lt; 4));\n        }\n      }\n      public byte  TrackNumber;\n      public byte  Reserved1;\n      /// &lt;summary&gt;\n      /// Don't use array to avoid array creation\n      /// &lt;/summary&gt;\n      public byte  Address_0;\n      public byte  Address_1;\n      public byte  Address_2;\n      public byte  Address_3;\n    };\n\n    public const int MAXIMUM_NUMBER_TRACKS = 100;\n\n    [ StructLayout( LayoutKind.Sequential )]\n    public class TrackDataList\n    {\n      [MarshalAs(UnmanagedType.ByValArray, SizeConst=MAXIMUM_NUMBER_TRACKS*8)]\n      private byte[] Data;\n      public TRACK_DATA this [int Index]\n      {\n        get\n        {\n          if ( (Index &lt; 0) | (Index &gt;= MAXIMUM_NUMBER_TRACKS))\n          {\n            throw new IndexOutOfRangeException();\n          }\n          TRACK_DATA res;\n          GCHandle handle = GCHandle.Alloc(Data, GCHandleType.Pinned);\n          try\n          {\n            IntPtr buffer = handle.AddrOfPinnedObject();\n            buffer = (IntPtr)(buffer.ToInt32() + (Index*Marshal.SizeOf(typeof(TRACK_DATA))));\n            res = (TRACK_DATA)Marshal.PtrToStructure(buffer, typeof(TRACK_DATA));\n          }\n          finally\n          {\n            handle.Free();\n          }\n          return res;\n        }\n      }\n      public TrackDataList()\n      {\n        Data = new byte[MAXIMUM_NUMBER_TRACKS*Marshal.SizeOf(typeof(TRACK_DATA))];\n      }\n    }\n\n    //Struktur für den Input Parameter:\n    public const uint IOCTL_CDROM_TRACK_ISRC = 0x3;\n\n    [StructLayout(LayoutKind.Sequential)]\n    public class _CDROM_SUB_Q_DATA_FORMAT\n    {\n        public byte Format;\n        public byte Track;\n    }\n    //Strukturen für den Output Parameter\n    [StructLayout(LayoutKind.Explicit)]\n    public class _SUB_Q_CHANNEL_DATA\n    {\n        [FieldOffset(0)]\n        public _SUB_Q_CURRENT_POSITION     CurrentPosition;\n        [FieldOffset(0)]\n        public _SUB_Q_MEDIA_CATALOG_NUMBER MediaCatalog;\n        [FieldOffset(0)]\n        public _SUB_Q_TRACK_ISRC TrackIsrc;\n    }\n\n\n    [StructLayout(LayoutKind.Sequential)]\n    public class _SUB_Q_CURRENT_POSITION\n    {\n        public _SUB_Q_HEADER Header;\n        public byte          FormatCode;\n        //private byte        BitMapped;\n        public byte BitMapped;\n        //public byte Control\n        //{\n        //    get\n        //    {\n        //        return (byte)(BitMapped &amp; 0x0F);\n        //    }\n        //    set\n        //    {\n        //        BitMapped = (byte)((BitMapped &amp; 0xF0) | (value &amp; (byte)0x0F));\n        //    }\n        //}\n        //public byte Adr\n        //{\n        //    get\n        //    {\n        //        return (byte)((BitMapped &amp; (byte)0xF0) &gt;&gt; 4);\n        //    }\n        //    set\n        //    {\n        //        BitMapped = (byte)((BitMapped &amp; (byte)0x0F) | (value &lt;&lt; 4));\n        //    }\n        //}\n        public byte          TrackNumber;\n        public byte          IndexNumber;\n\n        [MarshalAs(UnmanagedType.ByValArray, SizeConst=4)]\n        public byte[]        AbsoluteAddress;\n        [MarshalAs(UnmanagedType.ByValArray, SizeConst=4)]\n        public byte[]        TrackRelativeAddress;\n    }\n\n    [StructLayout(LayoutKind.Sequential)]\n    public class _SUB_Q_MEDIA_CATALOG_NUMBER\n    {\n        _SUB_Q_HEADER Header;\n        byte        FormatCode;\n        [MarshalAs(UnmanagedType.ByValArray, SizeConst=3)]\n        public byte[]        Reserved;\n        //private byte BitMapped;\n        public byte BitMapped;\n        //public byte Reserved1\n        //{\n        //    get\n        //    {\n        //        return (byte)(BitMapped &amp; 0xFE);\n        //    }\n        //    set\n        //    {\n        //        BitMapped = (byte)((BitMapped &amp; 0x01) | (value &amp; (byte)0xFE));\n        //    }\n        //}\n        //public byte Mcval\n        //{\n        //    get\n        //    {\n        //        return (byte)((BitMapped &amp; (byte)0x01) &gt;&gt; 7);\n        //    }\n        //    set\n        //    {\n        //        BitMapped = (byte)((BitMapped &amp; (byte)0xFE) | (value &lt;&lt; 7));\n        //    }\n        //}\n        [MarshalAs(UnmanagedType.ByValArray, SizeConst=15)]\n        public byte[]  MediaCatalog;\n    }\n\n    [StructLayout(LayoutKind.Sequential)]\n    public class _SUB_Q_TRACK_ISRC\n    {\n\n        public _SUB_Q_HEADER Header;\n        public byte FormatCode;\n        public byte Reserved0;\n        public byte Track;\n        public byte Reserved1;\n        //private byte BitMapped;\n        public byte BitMapped;\n        //public byte Reserved2\n        //{\n        //    get\n        //    {\n        //        return (byte)(BitMapped &amp; 0xFE);\n        //    }\n        //    set\n        //    {\n        //        BitMapped = (byte)((BitMapped &amp; 0x01) | (value &amp; (byte)0xFE));\n        //    }\n        //}\n        //public byte Tcval\n        //{\n        //    get\n        //    {\n        //        return (byte)((BitMapped &amp; (byte)0x01) &gt;&gt; 7);\n        //    }\n        //    set\n        //    {\n        //        BitMapped = (byte)((BitMapped &amp; (byte)0xFE) | (value &lt;&lt; 7));\n        //    }\n        //}\n        [MarshalAs(UnmanagedType.ByValArray, SizeConst=15)]\n        public byte[]       TrackIsrc;\n\n    }\n\n    [StructLayout(LayoutKind.Sequential)]\n    public class _SUB_Q_HEADER\n    {\n        public byte Reserved;\n        public byte AudioStatus;\n        [MarshalAs(UnmanagedType.ByValArray, SizeConst=2)]\n        public byte[] DataLength;\n    }\n\n\n\n    [StructLayout( LayoutKind.Sequential )]\n    public class CDROM_TOC \n    {\n      public ushort Length;\n      public byte FirstTrack = 0;\n      public byte LastTrack = 0;\n\n      public TrackDataList TrackData;\n\n      public CDROM_TOC()\n      {\n        TrackData = new TrackDataList();\n        Length = (ushort)Marshal.SizeOf(this);\n      }\n    } \n\n    [ StructLayout( LayoutKind.Sequential )]\n    public class PREVENT_MEDIA_REMOVAL \n    {\n      public byte PreventMediaRemoval = 0;\n    }\n\n\n\n    public enum TRACK_MODE_TYPE { YellowMode2, XAForm2, CDDA }\n    [ StructLayout( LayoutKind.Sequential )]\n      public class RAW_READ_INFO \n    {\n      public long  DiskOffset = 0;\n      public uint  SectorCount = 0;\n      public TRACK_MODE_TYPE  TrackMode = TRACK_MODE_TYPE.CDDA;\n    }\n\n    /// &lt;summary&gt;\n    /// Overload version of DeviceIOControl to read the TOC (Table of contents)\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"hDevice\"&gt;Handle of device opened with CreateFile, &lt;see cref=\"Ripper.Win32Functions.CreateFile\"/&gt;&lt;/param&gt;\n    /// &lt;param name=\"IoControlCode\"&gt;Must be IOCTL_CDROM_READ_TOC for this overload version&lt;/param&gt;\n    /// &lt;param name=\"InBuffer\"&gt;Must be &lt;code&gt;IntPtr.Zero&lt;/code&gt; for this overload version &lt;/param&gt;\n    /// &lt;param name=\"InBufferSize\"&gt;Must be 0 for this overload version&lt;/param&gt;\n    /// &lt;param name=\"OutTOC\"&gt;TOC object that receive the CDROM TOC&lt;/param&gt;\n    /// &lt;param name=\"OutBufferSize\"&gt;Must be &lt;code&gt;(UInt32)Marshal.SizeOf(CDROM_TOC)&lt;/code&gt; for this overload version&lt;/param&gt;\n    /// &lt;param name=\"BytesReturned\"&gt;Receives the size, in bytes, of the data stored into OutTOC&lt;/param&gt;\n    /// &lt;param name=\"Overlapped\"&gt;Pointer to an OVERLAPPED structure. Discarded for this case&lt;/param&gt;\n    /// &lt;returns&gt;If the function succeeds, the return value is nonzero. If the function fails, the return value is zero.&lt;/returns&gt;\n    [System.Runtime.InteropServices.DllImport(\"Kernel32.dll\", SetLastError=true)]\n    public extern static int DeviceIoControl(IntPtr hDevice, uint IoControlCode, \n      IntPtr InBuffer, uint InBufferSize,\n      [Out] CDROM_TOC OutTOC, uint OutBufferSize,\n      ref uint BytesReturned,\n      IntPtr Overlapped);\n\n    /// &lt;summary&gt;\n    /// Overload version of DeviceIOControl to lock/unlock the CD\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"hDevice\"&gt;Handle of device opened with CreateFile, &lt;see cref=\"Ripper.Win32Functions.CreateFile\"/&gt;&lt;/param&gt;\n    /// &lt;param name=\"IoControlCode\"&gt;Must be IOCTL_STORAGE_MEDIA_REMOVAL for this overload version&lt;/param&gt;\n    /// &lt;param name=\"InMediaRemoval\"&gt;Set the lock/unlock state&lt;/param&gt;\n    /// &lt;param name=\"InBufferSize\"&gt;Must be &lt;code&gt;(UInt32)Marshal.SizeOf(PREVENT_MEDIA_REMOVAL)&lt;/code&gt; for this overload version&lt;/param&gt;\n    /// &lt;param name=\"OutBuffer\"&gt;Must be &lt;code&gt;IntPtr.Zero&lt;/code&gt; for this overload version &lt;/param&gt;\n    /// &lt;param name=\"OutBufferSize\"&gt;Must be 0 for this overload version&lt;/param&gt;\n    /// &lt;param name=\"BytesReturned\"&gt;A \"dummy\" varible in this case&lt;/param&gt;\n    /// &lt;param name=\"Overlapped\"&gt;Pointer to an OVERLAPPED structure. Discarded for this case&lt;/param&gt;\n    /// &lt;returns&gt;If the function succeeds, the return value is nonzero. If the function fails, the return value is zero.&lt;/returns&gt;\n    [System.Runtime.InteropServices.DllImport(\"Kernel32.dll\", SetLastError=true)]\n    public extern static int DeviceIoControl(IntPtr hDevice, uint IoControlCode, \n      [In] PREVENT_MEDIA_REMOVAL InMediaRemoval, uint InBufferSize,\n      IntPtr OutBuffer, uint OutBufferSize,\n      ref uint BytesReturned,\n      IntPtr Overlapped);\n\n    /// &lt;summary&gt;\n    /// Overload version of DeviceIOControl to read digital data\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"hDevice\"&gt;Handle of device opened with CreateFile, &lt;see cref=\"Ripper.Win32Functions.CreateFile\"&lt;/param&gt;\n    /// &lt;param name=\"IoControlCode\"&gt;Must be IOCTL_CDROM_RAW_READ for this overload version&lt;/param&gt;\n    /// &lt;param name=\"rri\"&gt;RAW_READ_INFO structure&lt;/param&gt;\n    /// &lt;param name=\"InBufferSize\"&gt;Size of RAW_READ_INFO structure&lt;/param&gt;\n    /// &lt;param name=\"OutBuffer\"&gt;Buffer that will receive the data to be read&lt;/param&gt;\n    /// &lt;param name=\"OutBufferSize\"&gt;Size of the buffer&lt;/param&gt;\n    /// &lt;param name=\"BytesReturned\"&gt;Receives the size, in bytes, of the data stored into OutBuffer&lt;/param&gt;\n    /// &lt;param name=\"Overlapped\"&gt;Pointer to an OVERLAPPED structure. Discarded for this case&lt;/param&gt;\n    /// &lt;returns&gt;If the function succeeds, the return value is nonzero. If the function fails, the return value is zero.&lt;/returns&gt;\n    [System.Runtime.InteropServices.DllImport(\"Kernel32.dll\", SetLastError=true)]\n    public extern static int DeviceIoControl(IntPtr hDevice, uint IoControlCode, \n      [In] RAW_READ_INFO rri, uint InBufferSize,\n      [In, Out] byte[] OutBuffer, uint OutBufferSize,\n      ref uint BytesReturned,\n      IntPtr Overlapped);\n\n    /// &lt;summary&gt;\n    /// Overload Version of DeviceIOControl to read ISRC Code from CD for special track\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"hDevice\"&gt;Handle of device opened with CreateFile, &lt;see cref=\"MyISRCReader.Win32Functions.CreateFile\"&lt;/param&gt;\n    /// &lt;param name=\"IoControlCode\"&gt;Must be IOCTL_CDROM_READ_Q_CHANNEL&lt;/param&gt;\n    /// &lt;param name=\"fmt\"&gt;_CDROM_SUB_Q_DATA_FORMAT structure &lt;/param&gt;\n    /// &lt;param name=\"InBufferSize\"&gt;Size of _CDROM_SUB_Q_DATA_FORMAT&lt;/param&gt;\n    /// &lt;param name=\"OutData\"&gt;_SUB_Q_CHANNEL_DATA structure&lt;/param&gt;\n    /// &lt;param name=\"OutBufferSize\"&gt;Size of _SUB_Q_CHANNEL_DATA buffer&lt;/param&gt;\n    /// &lt;param name=\"BytesReturned\"&gt;Receives the size, in bytes, of the data stored into OutBuffer&lt;/param&gt;\n    /// &lt;param name=\"Overlapped\"&gt;Pointer to an OVERLAPPED structure. Discarded for this case&lt;/param&gt;\n    /// &lt;returns&gt;0 if the function fails and nonzero if the function succeeded&lt;/returns&gt;\n    [System.Runtime.InteropServices.DllImport(\"Kernel32.dll\", SetLastError = true)]\n    public extern static int DeviceIoControl(IntPtr hDevice, uint IoControlCode,\n      [In] _CDROM_SUB_Q_DATA_FORMAT fmt, uint InBufferSize,\n      [In, Out] _SUB_Q_CHANNEL_DATA OutData, uint OutBufferSize,\n      ref uint BytesReturned,\n      IntPtr Overlapped);\n  }\n}\n</code></pre>\n\n<p>This is my simple Test-Program - I open a handle to the CD and get the correct track count of my cd. The error code after my ISRC-Read is 1 which means \"wrong function\". The output structure data is all values 0...</p>\n\n<pre><code>namespace MyISRCReader\n{    \n    class Program\n    {\n        static void Main(string[] args)\n        {\n            IntPtr cdHandle = IntPtr.Zero;\n            char Drive = 'D';\n            Win32Functions.CDROM_TOC Toc = new Win32Functions.CDROM_TOC();\n            bool TocValid;\n\n            if (Win32Functions.GetDriveType(Drive + \":\\\\\") == Win32Functions.DriveTypes.DRIVE_CDROM)\n            {\n                cdHandle = Win32Functions.CreateFile(\"\\\\\\\\.\\\\\" + Drive + ':', Win32Functions.GENERIC_READ, Win32Functions.FILE_SHARE_READ, IntPtr.Zero, Win32Functions.OPEN_EXISTING, 0, IntPtr.Zero);\n                if (((int)cdHandle != -1) &amp;&amp; ((int)cdHandle != 0))\n                {\n                    uint Dummy = 0;\n                    Win32Functions.DeviceIoControl(cdHandle, Win32Functions.IOCTL_STORAGE_LOAD_MEDIA, IntPtr.Zero, 0, IntPtr.Zero, 0, ref Dummy, IntPtr.Zero);\n                    uint BytesRead = 0;\n                    TocValid = Win32Functions.DeviceIoControl(cdHandle, Win32Functions.IOCTL_CDROM_READ_TOC, IntPtr.Zero, 0, Toc, (uint)Marshal.SizeOf(Toc), ref BytesRead, IntPtr.Zero) != 0;\n                    if (TocValid)\n                    {\n                        Console.WriteLine(\"track count: \" + (Toc.LastTrack - Toc.FirstTrack + 1));\n\n                        Win32Functions._CDROM_SUB_Q_DATA_FORMAT format = new Win32Functions._CDROM_SUB_Q_DATA_FORMAT();\n                        Win32Functions._SUB_Q_CHANNEL_DATA data = new Win32Functions._SUB_Q_CHANNEL_DATA();\n\n                        format.Format = (byte)Win32Functions.IOCTL_CDROM_TRACK_ISRC;\n                        format.Track = (byte)2;\n\n                        Console.WriteLine(\"Last Win32 Error beforde ISRC read: \" + Marshal.GetLastWin32Error().ToString());\n\n                        int erg = Win32Functions.DeviceIoControl(cdHandle,\n                                                       Win32Functions.IOCTL_CDROM_TRACK_ISRC,\n                                                       format,\n                                                       (uint)Marshal.SizeOf(format),\n                                                       data,\n                                                       (uint)Marshal.SizeOf(data),\n                                                       ref Dummy,\n                                                       IntPtr.Zero);\n\n                        Console.WriteLine(\"Last Win32 error: \" + Marshal.GetLastWin32Error().ToString());\n                        if (erg == 0)\n                        {\n                            //Reading ISRC failed\n                            Console.WriteLine(\"Could not read ISRC!\");\n                        }\n                        else\n                        {\n                            //Reading ISRC succeeded\n                            Console.WriteLine(\"Tracknumber: \" + data.TrackIsrc.Track + \" - ISRC: \" + data.TrackIsrc.TrackIsrc[data.TrackIsrc.Track].ToString());\n                        }\n                    }\n                    else\n                    {\n                        Console.WriteLine(\"Toc invalid\");\n                    }\n\n                }\n                else\n                {\n                    Console.WriteLine(\"Handle Error\");\n                }\n            }\n            Console.Write(\"Eject media? (y/n)\");\n            var ch  = Console.ReadKey();\n            if (ch.KeyChar == 'y' || ch.KeyChar=='Y')\n            {\n                uint Dummy = 0;\n                Win32Functions.DeviceIoControl(cdHandle, Win32Functions.IOCTL_STORAGE_EJECT_MEDIA, IntPtr.Zero, 0, IntPtr.Zero, 0, ref Dummy, IntPtr.Zero);\n            }\n            Console.ReadKey();\n        }\n    }\n}\n</code></pre>\n\n<p>Are the PInvoke calls and the structures (classes) correct? The commented parts of the classes in Win32Functions (which simulate the C++ structures) are kind of alternative for simulating the C++ bitfields. I don't know how to debug this or where I can find the error... Someone has an idea?</p>\n"},{"tags":["c++","winapi","unicode","c++11"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":191,"score":2,"question_id":12101669,"title":"WinAPI LPWSTR, C++11 u16string?","body":"<p>If I'm developing for Windows and some WinAPI functions require me to use LPWSTR as string data type. Is it okay to use C++11's u16string in my library? Are those two data types the same thing?</p>\n\n<p>It looks more like LPWSTR is wchar_t, but nobody likes wchar_t anymore...</p>\n"},{"tags":["c","winapi","windows-xp"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12104589,"title":"Add checkbox to SHBrowseForFolder in Windows XP","body":"<p>I need a folder browser dialog with extra control, e.g. checkbox.</p>\n\n<p>Program supports Windows XP, so that using CFileDialog with vista style and IFileDialogCustomize don't suit me:</p>\n\n<pre><code>   CFileDialog od(TRUE/*bOpenFileDialog*/, NULL, NULL,\n      OFN_HIDEREADONLY | OFN_OVERWRITEPROMPT , NULL, NULL, 0,\n      TRUE/*bVistaStyle*/);\n\n   IFileDialogCustomize * customDlgPtr = od.GetIFileDialogCustomize();\n   if ( customDlgPtr != NULL )\n   {\n      HRESULT res = customDlgPtr-&gt;AddCheckButton(IDC_CUST_TEXT, _T(\"Include subtree\"), FALSE);\n      customDlgPtr-&gt;Release();\n   }\n\n   IFileOpenDialog * openDlgPtr = od.GetIFileOpenDialog();\n   if ( openDlgPtr != NULL )\n   {\n      openDlgPtr-&gt;SetOptions(FOS_PICKFOLDERS);\n      openDlgPtr-&gt;Release();\n   }\n\n   od.DoModal();\n</code></pre>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12104182,"title":"Use installed a 3rd party file explorers. How do I get the register default explorer program via win32?","body":"<p>I guess it's like total commander or similar type program where they replace the default folder browser. How do I know via win32, what replacement program the user is used instead of explorer.exe</p>\n"},{"tags":["c++","winapi","visual-c++","malloc","strdup"],"answer_count":2,"favorite_count":3,"up_vote_count":2,"down_vote_count":2,"view_count":191,"score":0,"question_id":9393440,"title":"How to use Malloc and StrDup together when StrDup is in a while loop?","body":"<p>I have a code here. I am using malloc to allocate memory to my struct. One member of this struct is assigned a string using StrDup inside a while loop though other members dont have to change their values. Now, as I am using StrDup, I have to clean memory otherwise there would be memory leaks but the cleaning of memory corrupts my struct malloc. What should I do? Thanks in Advance.</p>\n\n<pre><code>    do\n    {\n       if( pURL == NULL )\n           break ;\n       pData-&gt;URL = StrDupA(pURL) ;\n\n    }while(pURL != NULL) ;\n</code></pre>\n"},{"tags":["c++","winapi"],"answer_count":5,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":2795,"score":4,"question_id":3772233,"title":"Win32 SetForegroundWindow unreliable","body":"<p>Hey guys, I have a rather complex series of applications which depend on the ability to switch applications in the foreground.</p>\n\n<p>My problem is, every 5 or 6 times of switching the applications in the foreground, it simply fails to bring the application forward. GetLastError does not report any issues. Often times I see the correct application flash in the foreground for a moment then the previous application is visible.</p>\n\n<p>I have a Manager application which I have source for, it spawns and controls about 4 applications which I do not have source for. one of the applications it spawns/controls is also a manager which spawns/controls about 5 applications.</p>\n\n<p>This is a sort of kiosk design so the user wont even have a keyboard or mouse, just a touch screen.</p>\n\n<p>I have tried every combination of the Win32 calls to control them I am just out of ideas.</p>\n\n<p>My first attempt was:</p>\n\n<pre><code>SetWindowPos(hApp, HWND_TOPMOST, NULL, NULL, NULL, NULL, SWP_NOMOVE | SWP_NOSIZE);\nSetWindowPos(hApp, HWND_NOTOPMOST, NULL, NULL, NULL, NULL, SWP_NOMOVE | SWP_NOSIZE);\n</code></pre>\n\n<p>My second attempt was:</p>\n\n<pre><code>SetForegroundWindow(hApp);\nSetActiveWindow(hApp);\nSetFocus(hApp);\n</code></pre>\n\n<p>my third attempt:\n    DWORD dwThreadID = GetWindowThreadProcessId(hApp, NULL);\n    AttachThreadInput( dwThreadID, GetCurrentThreadId(), true);</p>\n\n<pre><code>SetForegroundWindow(hApp);\nSetActiveWindow(hApp);\nSetFocus(hApp);\n\nAttachThreadInput( dwThreadID, GetCurrentThreadId(), false);\n</code></pre>\n\n<p>my forth attempt:</p>\n\n<pre><code>DWORD dwThreadID = GetWindowThreadProcessId(hApp, NULL);\nAttachThreadInput( dwThreadID, GetCurrentThreadId(), true);\n\nSetWindowPos(hApp, HWND_TOPMOST, NULL, NULL, NULL, NULL, SWP_NOMOVE | SWP_NOSIZE);\nSetWindowPos(hApp, HWND_NOTOPMOST, NULL, NULL, NULL, NULL, SWP_NOMOVE | SWP_NOSIZE);\n\nSetForegroundWindow(hApp);\nSetActiveWindow(hApp);\nSetFocus(hApp);\n\n AttachThreadInput( dwThreadID, GetCurrentThreadId(), false);\n</code></pre>\n\n<p>I feel like I am missing an important gotcha when it comes to window switching. I know that only the foreground process can switch windows around but as my main Manager program is spawning and starting all the other processes which I need to control, I feel like it should be capable of moving these windows around. I am really under the gun to finish this (up all night all week), any suggestions or advice is greatly appreciated. Thank you!</p>\n"},{"tags":["c#","vb.net","winapi","vb6","browser-cache"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12096546,"title":"DeleteUrlCacheEntry() function (of WinINet API) not deleting some Internet Explorer Cache items begining with \"Visited: \"","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12101969/how-to-get-deleteurlcacheentry-error-codes-or-additional-information-on-why\">How To Get DeleteUrlCacheEntry() Error Codes? (Or additional information on why a particular deletion didn&#39;t work)?</a>  </p>\n</blockquote>\n\n\n\n<p>Basically, I am calling DeleteUrlCacheEntry (while looping through all cache items using FindFirst/NextEntry functions etc), using correct arguments (being, the pointer to the cache entry turned into a String). This argument I'm passing is typically a URL or other cache name begining with \"Cookie:\" or \"Visited:\" or just a URL (which begins with \"http://\" or \"https://\" etc).</p>\n\n<p>Now, most cached items, URL's, Cookies and Visited items get deleted with my looping function, but here are a list of items that I've included (with diagnostic information) that are not getting deleted, and DeleteUrlCacheEntry keeps returning 0 on these (as opposed to returning 1 when there is a successful deletion). A list of erroring items (with some non-erroring items for comparison) is attached after the next paragraph.</p>\n\n<p>The number at the begining of each entry is the Return Value from DeleteUrlCacheEntry, and I've noticed a pattern where the items that are failing deletion are from about 2 to 3 months ago (none of them are recent), and they are all begining with \"Visited: \". I've included items that were successfully deleted (items begining with [1]) and items that were not deleted due to the unknown problem at hand (these items begin with [0], and are due to DeleteUrlCacheEntry returning 0), here they are:</p>\n\n<blockquote>\n  <p>[1] Deleting Cached Item: Visited:\n  Jay@http://ninemsn.com.au/?ocid=iehp   LastAccessTime: 24/08/2012\n  2:31:50 AM, LastSyncTime: 24/08/2012 2:31:52 AM, LastModifiedTime:\n  24/08/2012 2:31:50 AM  LocalFileName: , FileExtension: \n     CacheEntryType: 2097153 (), ExemptDelta: 0, ExpireTime: 26/05/2015\n  2:24:42 AM     HeaderInfo: 146591552: </p>\n  \n  <p>[1] Deleting Cached Item: Visited:\n  Jay@http://m.adnxs.com/tt?member=280&amp;inv_code=AUHRAO&amp;code2=348230117&amp;ext_inv_code=348230117&amp;cb=2047478514\n     LastAccessTime: 24/08/2012 2:31:50 AM, LastSyncTime: 24/08/2012\n  2:31:52 AM, LastModifiedTime: 24/08/2012 2:31:50 AM    LocalFileName: ,\n  FileExtension:     CacheEntryType: 2097153 (), ExemptDelta: 0,\n  ExpireTime: 26/05/2015 2:24:42 AM  HeaderInfo: 291543412: </p>\n  \n  <p>[0] Deleting Cached Item: Visited:\n  Jay@http://load.exelator.com/load/?p=201&amp;j=w&amp;g=094     LastAccessTime:\n  25/05/2012 3:23:44 AM, LastSyncTime: 25/05/2012 3:23:46 AM,\n  LastModifiedTime: 25/05/2012 3:23:44 AM    LocalFileName: ,\n  FileExtension:     CacheEntryType: 2097153 (), ExemptDelta: 0,\n  ExpireTime: 24/02/2015 3:16:36 AM  HeaderInfo: 146196132: </p>\n  \n  <p>[1] Deleting Cached Item: Visited:\n  Jay@http://static.ak.facebook.com/connect/xd_arbiter.php?version=10\n     LastAccessTime: 24/08/2012 2:31:51 AM, LastSyncTime: 24/08/2012\n  2:31:52 AM, LastModifiedTime: 24/08/2012 2:31:51 AM    LocalFileName: ,\n  FileExtension:     CacheEntryType: 2097153 (), ExemptDelta: 0,\n  ExpireTime: 26/05/2015 2:24:42 AM  HeaderInfo: 146824120: </p>\n  \n  <p>[0] Deleting Cached Item: Visited:\n  Jay@http://static.castto.me/ads/300x250.html   LastAccessTime:\n  7/05/2012 3:26:34 AM, LastSyncTime: 7/05/2012 3:26:36 AM,\n  LastModifiedTime: 7/05/2012 3:26:34 AM     LocalFileName: ,\n  FileExtension:     CacheEntryType: 2097153 (), ExemptDelta: 0,\n  ExpireTime: 6/02/2015 3:26:36 AM   HeaderInfo: 146196128: </p>\n  \n  <p>[0] Deleting Cached Item: Visited:\n  Jay@http://www.youtube.com/subscribe_widget?p=gamespot\n     LastAccessTime: 6/05/2012 8:09:08 PM, LastSyncTime: 6/05/2012 8:09:10\n  PM, LastModifiedTime: 6/05/2012 8:09:08 PM     LocalFileName: ,\n  FileExtension:     CacheEntryType: 2097153 (), ExemptDelta: 0,\n  ExpireTime: 5/02/2015 8:09:10 PM   HeaderInfo: 292428152: </p>\n  \n  <p>[1] Deleting Cached Item: Visited: Jay@javascript:false\n     LastAccessTime: 24/08/2012 2:31:51 AM, LastSyncTime: 24/08/2012\n  2:31:52 AM, LastModifiedTime: 24/08/2012 2:31:51 AM    LocalFileName: ,\n  FileExtension:     CacheEntryType: 2097153 (), ExemptDelta: 0,\n  ExpireTime: 26/05/2015 2:24:44 AM  HeaderInfo: 292414576: </p>\n  \n  <p>[0] Deleting Cached Item: Visited:\n  Jay@http://ads.pubmatic.com/AdServer/js/dpsync.html?upixid=117&amp;pubid=29105&amp;dp=7\n     LastAccessTime: 25/05/2012 3:23:44 AM, LastSyncTime: 25/05/2012\n  3:23:46 AM, LastModifiedTime: 25/05/2012 3:23:44 AM    LocalFileName: ,\n  FileExtension:     CacheEntryType: 2097153 (), ExemptDelta: 0,\n  ExpireTime: 24/02/2015 3:16:36 AM  HeaderInfo: 291314260: </p>\n  \n  <p>[1] Deleting Cached Item: Visited:\n  Jay@http://ninemsn.com.au/?ocid=iehp&amp;rf=true   LastAccessTime:\n  24/08/2012 2:31:44 AM, LastSyncTime: 24/08/2012 2:31:46 AM,\n  LastModifiedTime: 24/08/2012 2:31:44 AM    LocalFileName: ,\n  FileExtension:     CacheEntryType: 2097153 (), ExemptDelta: 0,\n  ExpireTime: 26/05/2015 2:24:36 AM  HeaderInfo: 146595600: </p>\n  \n  <p>[0] Deleting Cached Item: Visited:\n  Jay@http://m.adnxs.com/tt?member=280&amp;inv_code=AUHRAP&amp;code2=348230115&amp;ext_inv_code=348230104&amp;cb=154864468\n     LastAccessTime: 7/05/2012 12:29:05 AM, LastSyncTime: 7/05/2012\n  12:29:06 AM, LastModifiedTime: 7/05/2012 12:29:05 AM   LocalFileName: ,\n  FileExtension:     CacheEntryType: 2097153 (), ExemptDelta: 0,\n  ExpireTime: 6/02/2015 12:21:56 AM  HeaderInfo: 292660948: </p>\n</blockquote>\n\n<p>Also, I have an additional question which has come about from this question, about getting extended error codes on why a deletion may not be successful on DeleteUrlCacheEntry: for those interested, here is that question (which seems to have gotten some traction): <a href=\"http://stackoverflow.com/questions/12101969/how-to-get-deleteurlcacheentry-error-codes-or-additional-information-on-why\">How To Get DeleteUrlCacheEntry() Error Codes? (Or additional information on why a particular deletion didn&#39;t work)?</a></p>\n\n<p>Thank you.</p>\n"},{"tags":["c","winapi","dll"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12101933,"title":"Resolving the 'WinMain@16' Link Error for Console","body":"<p>I've been using the default template in Code::Blocks to create a DLL, but when I compile, I get the <strong>undefined reference to'WinMain@16' error</strong>.</p>\n\n<p>I Googled out this error and it seems that the <code>main()</code> I'm using is for a Window application rather than console application but there's no clear solution to this problem.</p>\n\n<p>Now, do I just replace this line</p>\n\n<pre><code>BOOL WINAPI DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved)\n</code></pre>\n\n<p>by this\nint <code>main()</code>?</p>\n\n<p>Also, I want to insist that whatever alternative causes the least security gap and/or is the most correct solution.</p>\n\n<p>Thanks! </p>\n"},{"tags":["c++","c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":62,"score":3,"question_id":12096279,"title":"Linker error in WINAPI code","body":"<p>I am trying to compile the following code but I am getting linker errors. Thankyou to tell what I am missing.</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#pragma comment(lib,\"user32.dll\")\n\nint main()\n{\n    return MessageBoxA(0,\"Message\",\"Warn\",0x01);\n}\n</code></pre>\n\n<p><code>fatal error LNK1104: cannot open file 'user32.dll'</code></p>\n"},{"tags":["c++","windows","winapi"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":144,"score":0,"question_id":12095581,"title":"Got error code(5) access denied when use TerminateProcess to terminate the \"mstsc.exe\" process","body":"<p>I use the CreateProcess function to launch the rdp client app using \"mstsc.exe\". After that, I want to terminate it so I use \"TerminateProcess\" function, but it fails with error code of 5. If I replace the \"mstsc.exe\" with \"notepad.exe\", the terminate function works. The code are as follows:</p>\n\n<pre><code>TCHAR szCommandLine[] = TEXT(\"mstsc.exe\");\nSTARTUPINFO si = {sizeof(si)};\nPROCESS_INFORMATION pi;\nBOOL bResult = CreateProcess(NULL, szCommandLine, NULL, NULL,FALSE, NORMAL_PRIORITY_CLASS, NULL, NULL, &amp;si, &amp;pi);\n::Sleep(3000);\nif (TerminateProcess(pi.hProcess, 0) == 0) {\nprintf(\"failed: %d\", GetLastError());\n}\n</code></pre>\n\n<p>Can anyone help explain it and solve it?\nWhat I observed is that the pid of the \"pi\" returned is different from the id of the process \"mstsc.exe\" observed in taksmanager or \"Process Explorer\".</p>\n"},{"tags":["c++","multithreading","winapi","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12090863,"title":"WaitForMultipleObjects with an array of CWinThread pointers","body":"<p>I have a loop generating threads via <code>AfxBeginThread</code>, which stores the <code>CWinThread</code> pointers in an array. In each iteration, I check the thread is not null and store the thread's handle in another array.</p>\n\n<pre><code>const unsigned int maxThreads = 2;\nCWinThread* threads[maxThreads];\nHANDLE* handles[maxThreads];\nfor(unsigned int threadId=0; threadId &lt; maxThreads; ++threadId)\n{\n    threads[threadId] = AfxBeginThread(endToEndProc, &amp;threadId,\n                                            0,0,CREATE_SUSPENDED);\n    if(threads[threadId] == NULL) \n    {\n        // die carefully\n    }\n    threads[threadId]-&gt;m_bAutoDelete = FALSE;\n    handles[threadId] = &amp;threads[threadId]-&gt;m_hThread;\n    ::ResumeThread(handles[threadId]);\n}\n\nDWORD result = ::WaitForMultipleObjects(maxThreads, handles[0], \n                                            TRUE, 20000*maxThreads);\n</code></pre>\n\n<p>But <code>WaitForMultipleObjects</code> always returns with <code>WAIT_FAILED</code>, and <code>GetLastError</code> yields <code>6</code> for invalid handle. Either the test for the <code>AfxBeginThread</code> return is insufficient to guarantee the thread was created successfully and the handle will be valid, or the handle is becoming invalid before the WaitForMultipleObjects call, which I thought would be prevented by setting <code>m_bAutoDelete</code> to <code>FALSE</code>.</p>\n\n<p>Is there a better way to wait on multiple threads when they are created by <code>AfxBeginThread</code>?</p>\n\n<p>Note that it is fine when <code>maxThreads=1</code>.</p>\n"},{"tags":["delphi","winapi","windows-8","microsoft-metro","winrt"],"answer_count":2,"favorite_count":10,"up_vote_count":17,"down_vote_count":1,"view_count":1442,"score":16,"question_id":9653260,"title":"Resources for native Metro app development with Delphi","body":"<p>Are there resources on the web which help to get started with <strong>native <a href=\"http://en.wikipedia.org/wiki/Metro_%28design_language%29\">Metro</a> app development</strong> with <strong>Delphi</strong> (Win32)?</p>\n\n<p>So far I found the MSDN introduction, <strong><a href=\"http://msdn.microsoft.com/en-us/library/windows/apps/br211386.aspx\">Getting started with Metro style apps</a></strong>, which links to the available API sets, including two native APIs:</p>\n\n<ul>\n<li><strong><a href=\"http://msdn.microsoft.com/en-us/library/windows/apps/br211377.aspx\">Windows Runtime</a></strong> (<a href=\"http://en.wikipedia.org/wiki/Windows_Runtime\">WinRT</a>) - \"A native API built into the operating system.\nFundamental to Metro style apps. Implemented in C++ and supported in\nJavaScript, C#, Visual Basic, and C++ in a way that feels natural for\neach language\".</li>\n<li><strong><a href=\"http://msdn.microsoft.com/en-us/library/windows/apps/br205757.aspx\">Win32 and COM for Metro style apps</a></strong> - \"The subset of the Win32\nand COM APIs that you can use in a Metro style app\". Quote:</li>\n</ul>\n\n<blockquote>\n  <p>Metro style apps can use a subset of the Win32 and COM API. This\n  subset of APIs was chosen to support key scenarios for Metro style\n  apps that were not already covered by the Windows Runtime, HTML/CSS,\n  or other supported languages or standards. The Windows App\n  Certification Kit ensures that your app uses only this subset of the\n  Win32 and COM API.</p>\n</blockquote>\n\n<hr>\n\n<p>Side note: the first <strong>Metro app contest</strong> already <a href=\"http://blogs.msdn.com/b/windowsstore/archive/2011/12/07/get-your-app-in-the-store-on-opening-day.aspx\">closed on January 8, 2012</a> according to the Metro <a href=\"http://blogs.msdn.com/b/windowsstore/\">Windows Store</a> blog and the winners have been <a href=\"http://blogs.msdn.com/b/windowsstore/archive/2012/02/29/introducing-the-winners-of-the-first-apps-contest.aspx\">introduced</a> end of February - these Metro apps are already available through the <a href=\"http://preview.windows.com/\">Windows 8 Consumer Preview</a>.</p>\n"},{"tags":["c++","winapi","bitmap","screenshot","hdc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12089736,"title":"Get HDC context of screen minus application window","body":"<p>I want to be able to get the pixels under the application window within a rectangle the size of the application window and and to <code>ReadPixel</code>'s from it using an HDC.</p>\n\n<p>Simply put, I want to take a screenshot of the screen minus the application window and get just the pixels of a certain rectangle (in this case, the size and position of the screen) and be able to read from them (obviously not writing anything - that's not what I'm expecting).</p>\n\n<p>How would I even begin to go about this?</p>\n"},{"tags":["c","winapi","static","flicker","editbox"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":11809657,"title":"flicker issue but don't want to use CLIPCHILDREN style","body":"<p>I have a toolbar, on which there are some static child control which display text (e.g: \"Find\"... ).\nThere are 2 edit control on this toolrbar. When I resize the main window, I got flicker on some part of the toolbar. So I tried to use <code>WS_CLIPCHILDREN</code> for the toolbar, and it solves the flikcer issue.</p>\n\n<p>But I don't want to use <code>WS_CLIPCHILDREN</code> for the following reason:</p>\n\n<p>My toolbar has a beautiful background (using REBARCLASSNAME). So I don't want to the (not good looking) background of the static control appear. Hence in the wndproc of toolbar, I have the following code:</p>\n\n<pre><code>if (WM_CTLCOLORSTATIC == message) {\n    HWND hStatic = (HWND)lParam;\n\n    if (......)\n    {\n        SetBkMode((HDC)wParam, TRANSPARENT);\n        SelectBrush((HDC)wParam, GetStockBrush(NULL_BRUSH));\n        return 0;\n    }\n}\n</code></pre>\n\n<p>Hence the static display text content with the same background as the toolbar. If I use <code>WS_CLIPCHILDREN</code>, this effect don't work anymore.</p>\n\n<p>I also tried to use a background bitmap and set the static control to <code>SS_BITMAP</code>, but the function <code>SetText</code> doesn't work anymore.</p>\n\n<p>So here is the question:</p>\n\n<pre><code>Is there anyway to specify a control that would not be affected by the painting of the parent.  \nIn my case, the specific control is edit control. But for the static control, I want the parent \nto take the control.\n\nOr how to fix the flicker issue in another way? I tried to double buffer the toolrbar, but it \ndoesn't work.\n</code></pre>\n"},{"tags":["c++","windows","winapi","mouse"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12088004,"title":"Draw moving icon that is top most all the time like mouse cursor and work for full screen apps","body":"<p>I need to draw an icon that moves approximately in sync with mouse cursor and is always on top of all windows. \nOS: Windows 7</p>\n\n<p>I have a solutions that work to some extend by drawing my icon in a top most transparent window. There are some major drawbacks in this solution since that top most window interferes with other top most windows and some full screen apps do not work correctly. Examples are start menu and task bar that will overlay my window if I do not regulary set it to be top most. For some full screen applications performance of updating position of window with icon hugely drops and it does not follow mouse smoothly.</p>\n\n<p>There is another method that I came across where an icon is drawn directly to the device context of desktop <a href=\"http://stackoverflow.com/questions/10823022/draw-mouse-pointer-icon\">Draw mouse pointer icon?</a>. This solution has a drawback that there seems to be no good way of how to remove \"trail\", especially if desktop content changes quickly.</p>\n\n<p>So my question: is there an ultimate solution that does not have the above mentioned problems? \nIs it possible to draw above all windows in the \"layer\" of mouse cursor? Or make a second mouse cursor with my custom icon that I will control (I know that widows can display two independently controlled mouse cursors like CPNMouse)?</p>\n\n<p>Can someone point me to the right direction?</p>\n\n<p>Thanks!</p>\n"},{"tags":["c++","winapi","mfc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12088114,"title":"GetDlgItemInt returns 0","body":"<p>I have a dialog and a picture control inside of it. During OnInitDialog I try to obtain the text part of the picture control like this</p>\n\n<pre><code>CWnd *dialogHandle; // Handle of the dialog  \nCWnd *itemHandle; // Handle of the picture control  \nBOOL error;  \ndialogHandle-&gt;GetDlgItemInt(itemHandle-&gt;GetDlgCtrlID(), &amp;error, 0);  \n</code></pre>\n\n<p>however GetDlgItemInt function set error to 0 which says there is an error</p>\n\n<p>here is the resource line</p>\n\n<pre><code>CONTROL 65443, IDC_PICTURE, \"Static\", SS_BITMAP, 13, 13, 40, 40\n</code></pre>\n\n<p>I want this number 65443</p>\n"},{"tags":["c++","winapi","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":129,"score":-1,"question_id":12073276,"title":"Getting Resource Id from dialog Item","body":"<p>I put a picture control to a dialog, and did this settings\nMisc->Type->Bitmap\nMisc->Image->999</p>\n\n<p>now in the OnInitDialog function of the dialog, I catched CWnd* of the picture control and I want to obtain a handle to either image I assign to the controller or image's id (which is 999)\nHow can I do this ?</p>\n\n<p>thank you for your help.</p>\n\n<p>CONTROL 65443, IDC_TRUSS_CTRL, \"Static\", SS_BITMAP, 13, 13, 517, 212</p>\n\n<p>to be more precise about the problem, I want the number 65443 I've got the dialog's handle which holds this control and I also got the handle of the IDC_TRUSS_CTRL</p>\n\n<p>what I do is:\nbool error;\ndialogWnd->GetDlgItemInt(controlWnd->GetDlgCtrlID(), &amp;error, 0);</p>\n\n<p>however error is 0 which means it encounter an error :\\</p>\n"},{"tags":[".net","winapi","microsoft"],"answer_count":4,"favorite_count":3,"up_vote_count":9,"down_vote_count":0,"view_count":671,"score":9,"question_id":9539941,"title":"How long will my .NET 2.0 application continue to work?","body":"<p>Each version of Microsoft's .NET frameworks have <a href=\"http://support.microsoft.com/lifecycle/search/default.aspx?sort=pn&amp;alpha=.net%20framework\" rel=\"nofollow\">a limited support lifetime</a>, e.g.:</p>\n\n<ul>\n<li>support for .NET Framework 1.1 ended 09/09/2005</li>\n<li>support for .NET Framework 2.0 ended 12/01/2010</li>\n<li>support for .NET Framework 3.0 ended 12/07/2011</li>\n</ul>\n\n<p>I own <a href=\"http://www.ptc.com/products/mathcad/mathcad14-whats-new.htm\" rel=\"nofollow\">an application from 2004</a> that was written with .NET Framework 1.1. If you try to install the .NET Framework version 1.1 on a modern Windows 7 64-bit machine you will get an error - it just won't work. A program written in 2006 is no longer usable; you might as well throw it away.</p>\n\n<p>Does this mean that a program that I write in <strong>.NET 3.5</strong> today will, at some point in the future, just be unusable?</p>\n\n<blockquote>\n  <p>Microsoft went to great lengths with the Windows API to maintain backwards compatibility. A program written 18 years ago (for Win32 or <a href=\"http://en.wikipedia.org/wiki/Win32s\" rel=\"nofollow\">Win32s</a>) will still run on Windows of today. (I know - I own one. It originally ran on Windows 3.1 and still runs on Windows 7 64-bit.)</p>\n</blockquote>\n\n<p>A <em>native</em> program that I write today will still work 18 years from now (likely). But it seems that a .NET program I write today has no assurance that it will continue to function. </p>\n\n<p>Is there any compatibility commitments from Microsoft regarding .NET framework 2.0 or later? I know <strong>.NET Framework 1/1.1</strong> was an ugly stepchild; that .NET framework 2.0 broke compatibility with 1.1; but every framework since 2.0 has been compatible with 2.0.</p>\n\n<p>Is there a note somewhere that if I write a managed application with .NET 2.0 or newer, that it should continue to run on Windows 8, Windows 9, Windows 10, etc.?</p>\n\n<hr>\n\n<h2>The Case of the .NET Framework 1.1 error</h2>\n\n<p>Spying on the program using Process Explorer, i found the .NET object it's trying, and failing, to create:</p>\n\n<p><img src=\"http://i.stack.imgur.com/zZBEP.png\" alt=\"enter image description here\"></p>\n\n<p>It's class: </p>\n\n<ul>\n<li>clsid: <code>{60EBA0BC-D6AF-41C2-9584-D48D3DA39999}</code></li>\n<li>progid: <code>Engine.Factory</code></li>\n</ul>\n\n<p>So i created a little test application to see if <strong><em>i</em></strong> could create the same COM object:</p>\n\n<pre><code>const Guid CLSID_EngineFactory = '{60EBA0BC-D6AF-41C2-9584-D48D3DA39999}';\n\nIUnknown unk = CoCreateIntance(CLSID_EngineFactory, null, CLSCTX_INPROC_SERVER | CLSCTX_LOCAL_SERVER, IUnknown);\n</code></pre>\n\n<p>Which fails for me too. i find the registration details in the registry:</p>\n\n<pre><code>HKEY_CLASSES_ROOT\\Wow6432Node\\CLSID\n   {60EBA0BC-D6AF-41C2-9584-D48D3DA39999}\n      InprocServer32\n            (Default)       mscoree.dll\n            Assembly        mcengr, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null\n            Class           Engine.Factory\n            RuntimeVersion  v1.1.4322\n            ThreadingModel  Both\n</code></pre>\n\n<p>If the program <em>should</em> run with .NET framework 4 installed, then i suppose i can blame the application's installer. </p>\n\n<p>That very well may be the answer to my question:</p>\n\n<ul>\n<li>while .NET Framework 1.1 is no longer supported,</li>\n<li>.NET Framework 1.1 is still supported</li>\n</ul>\n\n<p>i just assumed both those statements couldn't be true at the same time.</p>\n"},{"tags":["c++","visual-studio-2008","winapi","x64","operator-precedence"],"answer_count":1,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":196,"score":8,"question_id":3463261,"title":"Operator precedence for \"<<\" and \"++\" in VS2008 with optimization","body":"<p>I'm stuck with a weird VS2008 C++ issue, that looks like operator precedence is not respected.</p>\n\n<p>My question is what is the output of this:  </p>\n\n<pre><code>int i = 0;  \nstd::cout &lt;&lt; ((i != 0) ? \"Not zero \" : \"zero \") &lt;&lt; ++i &lt;&lt; std::endl;  \n</code></pre>\n\n<p>Normally the <code>++</code> has precedence over the <code>&lt;&lt;</code>, right?  Or is the <code>&lt;&lt;</code> considered like a function call giving it a higher precedence than the <code>++</code>?  What is the 100% correct standard answer to this?</p>\n\n<p>To check, I created a new empty project (VS2008 console app), pasted only this code in the main and here are the results:  </p>\n\n<pre><code>Debug|Win32: “zero 1”  \nRelease|Win32: “zero 1”  \nDebug|x64: “zero 1”  \nRelease|x64: “Not zero 1”\n</code></pre>\n\n<p>Btw, the following example produces the exact same results:  </p>\n\n<pre><code>i = 0;  \nprintf(\"%s %d\\n\", ((i != 0) ? \"Not zero\" : \"zero\"), ++i);  \n</code></pre>\n\n<p>And also changing the type of optimization in release has no effect, but disabling optimization outputs “zero 1” like other configurations.</p>\n"},{"tags":["c++","winapi","directx"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":127,"score":1,"question_id":8843812,"title":"DirectX primitive doesn't move on screen when rotating camera","body":"<p>I'm trying to place a cube on the screen using vertices...i have a camera that rotates and translates with mouse and keyboard commands...during runtime, however, the square surface of the cube lays flat on the screen and doesn't move while the camera is rotating...the other items on the screen appear behind the square surface...can anyone explain the process of rendering a primitive? Thanks in advance for any help...it's much appreciated!</p>\n\n<pre><code>#define SQUAREFVF (D3DFVF_XYZ | D3DFVF_DIFFUSE)\n\nstruct SQUARE {\n    float x, y, z;\n    DWORD color;\n};\n\nSQUARE vert[] = \n{\n    // 1\n        { -64.0f,  -64.0f, 64.0f, D3DCOLOR_ARGB(0,0,0,255)},\n        {  -64.0f,  64.0f, 64.0f, D3DCOLOR_ARGB(0,0,0,255)},\n        { 64.0f, 64.0f, 64.0f, D3DCOLOR_ARGB(0,0,0,255)},\n        {  64.0f, -64.0f, 64.0f, D3DCOLOR_ARGB(0,0,0,255)},\n};\nbool CGraphics::TerrainTwo(D3DXVECTOR3 minB, D3DXVECTOR3 maxB, int numCellsW, int numCellsL)\n{\n    HRESULT hr;\n    void* pVoid;\n\n    hr = m_d3ddev-&gt;CreateVertexBuffer(sizeof(SQUARE)*sizeof(vert),0,\n        CUSTOMFVF,D3DPOOL_DEFAULT,&amp;m_terrainVertexBuffer,NULL);\n    if(FAILED(hr)){\n        MessageBox(NULL, L\"Could not Create Vertex Buffer\", L\"ERROR\", MB_OK);\n        return false;\n    }\n    hr = m_terrainVertexBuffer-&gt;Lock(0, 0, (void**)&amp;pVoid, NULL);\n    if(FAILED(hr)){\n        MessageBox(NULL, L\"Could not Lock Vertex Buffer\", L\"ERROR\", MB_OK);\n        return false;\n    }   \n    memcpy(pVoid, &amp;vert, sizeof(vert));\n    m_terrainVertexBuffer-&gt;Unlock();\n\n    /*hr = m_d3ddev-&gt;CreateIndexBuffer(sizeof(DWORD)*sizeof(indices),0,\n        D3DFMT_INDEX16, D3DPOOL_DEFAULT, &amp;m_terrainIndexBuffer, NULL);\n    if(FAILED(hr)){\n        MessageBox(NULL, L\"Could not Create Index Buffer\", L\"ERROR\", MB_OK);\n        return false;\n    }   \n    hr = m_terrainIndexBuffer-&gt;Lock(0, 0, (void**)&amp;pVoid, 0);\n    if(FAILED(hr)){\n        MessageBox(NULL, L\"Could not Create Vertex Buffer\", L\"ERROR\", MB_OK);\n        return false;\n    }   \n    memcpy(pVoid, indices, sizeof(indices));\n    if(FAILED(hr)){\n        MessageBox(NULL, L\"Could not Create Vertex Buffer\", L\"ERROR\", MB_OK);\n        return false;\n    }   \n    m_terrainIndexBuffer-&gt;Unlock();*/\n\n    return true;\n}\nvoid CGAME::Update()\n{\n\nif(m_graphics){\n        //m_graphics-&gt;UpdateSkyBox();\n        D3DXMATRIX matRotX, matRotY, matRotZ, matTrans;\n\n        D3DXMatrixRotationX (&amp;matRotX, 0);\n        D3DXMatrixRotationY( &amp;matRotY, 0 );  \n        D3DXMatrixRotationZ( &amp;matRotZ, 0 ); \n        // Calculate a translation matrix\n        D3DXMatrixTranslation(&amp;matTrans,5.0,1.0,5.0);\n        D3DXMATRIX matWorld = (matRotX*matRotY*matRotZ)*matTrans;\n        m_graphics-&gt;RenderTerrain(matWorld);\n    }\n}\n\nvoid CGraphics::RenderTerrain(D3DXMATRIX matW)\n{\n    m_d3ddev-&gt;SetTransform(D3DTS_WORLD, &amp;matW);\n    m_d3ddev-&gt;SetTexture(0, NULL);\n    m_d3ddev-&gt;SetStreamSource(0, m_terrainVertexBuffer, 0, sizeof(SQUARE));\n\n    m_d3ddev-&gt;SetFVF(CUSTOMFVF);\n\n    m_d3ddev-&gt;DrawPrimitive( D3DPT_TRIANGLESTRIP,  0, 2 );\n}\n</code></pre>\n"},{"tags":["c++","windows","winapi","shell-extensions"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":420,"score":1,"question_id":8438066,"title":"Writing namespace extensions with Windows 7 integration","body":"<p>I'm new to the topic shell extensions and I'm looking for resources about namespace extensions. I would like to write a namespace extension which supports SFTP with all options to browse like FTP in the explorer.</p>\n\n<p>I read the examples <a href=\"http://www.codeproject.com/KB/shell/TipsInNSE_SubFld.aspx\" rel=\"nofollow\">1</a>, <a href=\"http://www.codeproject.com/KB/shell/NSExtAddDelFld.aspx\" rel=\"nofollow\">2</a> of zengxi from codeproject, but they don't compile right and seems to be old. I think that there were also many changes like the folder selection in the address bar.</p>\n\n<p>Can somebody provide me some resources in the right direction or some working examples?</p>\n\n<p><strong>UPDATE:</strong>\nIt is important that the source is free. This is a non-profit project.</p>\n\n<p>At the moment I found a good source on the MSDN called <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd940360.aspx\" rel=\"nofollow\">Explorer Data Provider Sample</a>. This is up to date and provides some aliases <code>Explorer Data Provider</code> and <code>Shell Data Source</code>. What is yet missing is drop &amp; drag support and a glue for supporting protocol links.</p>\n\n<p>For future usage it would be great to find a way to associate a file extension with that <code>shell data source</code> like zip files.</p>\n"},{"tags":["winapi","tabs","tooltip","tabcontrol","tooltips"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12083243,"title":"position of a tab control tooltip","body":"<p>I created a tab control with TCS_TOOLTIPS style, hence when mouse is over tab items, it displays a tooltip which shows some information.</p>\n\n<p>The tooltip always has the same x-position as the cursor and below the cursor.</p>\n\n<p>I want to make the y-position of the tooltip exact at the bottom of the tab control. In this case, I need to increase the x-position of the tooltip also, in order to avoid the cursor and the tooltip overlap.</p>\n\n<p>But I can not find any information to adjust the position of a tooltip of a tab control.\nIs this related to <code>TTM_TRACKPOSITION</code> flag of <code>TOOLINFO</code>? When I created this tab control, I knows only : get hwnd of tooltip by sending TCM_GETTOOLTIPS message ; Treat WM_NOTIFY message and fill TTN_GETDISPINFO structure to display the tooltip. But I didn't find any information about the position.</p>\n"},{"tags":["winapi","ipython"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":132,"score":2,"question_id":4683015,"title":"IPython fails to load win32api","body":"<p>I'm running Python 2.7 on windows and I've installed the <a href=\"http://sourceforge.net/projects/pywin32/\" rel=\"nofollow\">pywin extension here</a>.</p>\n\n<p>Having done so, if I launch a normal python shell, I can import win32api perfectly.</p>\n\n<p>If I do the same on IPython, I get this :</p>\n\n<pre><code>In [1]: import win32api\n---------------------------------------------------------------------------\nImportError                               Traceback (most recent call last)\n\nC:\\Windows\\system32\\&lt;ipython console&gt; in &lt;module&gt;()\n\nImportError: DLL load failed: The specified module could not be found.\nIn [2]:\n</code></pre>\n\n<p>Why would it work in a normal python shell, but not IPython?</p>\n"},{"tags":["java","winapi","jni","jna","ffi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":354,"score":1,"question_id":5953149,"title":"Detect the location of AppData\\LocalLow with JNA","body":"<p>I'm trying to detect the location of <code>AppData\\LocalLow</code> work on Java with JNA on Windows 7. But the closest function available for the job is: </p>\n\n<pre><code>W32API.HRESULT SHGetFolderPath(W32API.HWND hwndOwner,int nFolder,W32API.HANDLE\n                               hToken,W32API.DWORD dwFlags,char[] pszPath)\n</code></pre>\n\n<p>Here we have the <a href=\"http://stackoverflow.com/questions/4494290/detect-the-location-of-appdata-locallow/4495081#4495081\">Solution in C#</a></p>\n\n<p>But in my case, JAVA + JNA, I'm wondering how I can use the <code>LocalLow GUID</code> with <code>SHGetFolderPath</code> only, or maybe I should look at the problem from a different angle (maybe JNI would be better here?)</p>\n\n<p>If somebody can help on that, thanks</p>\n\n<p>Cheers</p>\n\n<p>EDIT:\nOk, now I added SHGetKnownFolderPath, but here, it keeps returning me strings like that \"?f\"</p>\n\n<pre><code>static interface Shell32 extends Library {\n\n    public static final int     MAX_PATH            = 260;\n    public static final String  FOLDERID_APPDATALOW = \"{A520A1A4-1780-4FF6-BD18-167343C5AF16}\";\n\n    static Shell32 INSTANCE = (Shell32) Native.loadLibrary(\"shell32\",\n                    Shell32.class, OPTIONS);\n\n    public int SHGetKnownFolderPath(Guid.GUID rfid, int dwFlags, HANDLE hToken,\n                    char[] pszPath);\n}\n\npublic static void main(String[] args) {\n\n   char[] pszPath = new char[Shell32.MAX_PATH];\n   Guid.GUID localLowId = Ole32Util.getGUIDFromString(Shell32.FOLDERID_APPDATALOW);\n   int hResult = Shell32.INSTANCE.SHGetKnownFolderPath(localLowId, 0, null, pszPath);\n\n   if (hResult == 0) {\n       String path = new String(pszPath);\n       int len = path.indexOf('\\0');\n       path = path.substring(0, len);\n       System.out.println(path);\n   } else {\n       System.err.println(\"Error: \" + hResult);\n   }\n</code></pre>\n\n<p>}</p>\n"},{"tags":["c#","internet-explorer","winapi","pinvoke","ntlm"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":166,"score":1,"question_id":12064530,"title":"How can I launch an Internet Explorer process as another user, a la /netonly?","body":"<p>I'm trying to launch Internet Explorer as another user from our WPF app, so that when our users visit the (internal) website, they silently authenticate via Integrated Windows Authentication.</p>\n\n<p>We do not want to launch iexplore.exe as the other user because of weird deployment/environment issues that occur when you launch a process for the first time on a computer and it attempts to set up IE7/8 for the first time. Though, if you have a solution for how to mute every IE installer on every machine, I'd love to hear it.</p>\n\n<p>Back to my intended question. I'm able to get the exact IE impersonating behavior I want* from the command prompt  using <code>runas</code> (thanks to <a href=\"http://serverfault.com/questions/70376/runas-domain-account-still-asks-for-password\">http://serverfault.com/questions/70376/runas-domain-account-still-asks-for-password</a>):</p>\n\n<pre><code>c:\\&gt; runas /noprofile /netonly /user:MyDomain\\MyUser iexplore.exe\n</code></pre>\n\n<p>*note: I can't use <code>runas</code> for our WPF app for many reasons, but the <em>end result</em> is what I want.</p>\n\n<p>Anyway, I'd like the C# equivalent code that does a <code>runas /noprofile /netonly iexplore.exe</code>.</p>\n\n<p>I am halfway there with P/Invoke on <code>CreateProcessWithLogonW</code>. This is what I have:</p>\n\n<pre><code>uint LOGON_NETCREDENTIALS_ONLY = 2;\nvar lpStartupInfo = new CreateProcessWithLogonW_PInvoke.STARTUPINFO();\nCreateProcessWithLogonW_PInvoke.PROCESS_INFORMATION processInformation;\n\nCreateProcessWithLogonW_PInvoke.CreateProcessWithLogonW(\n                userName,\n                domain,\n                pw,\n                LOGON_NETCREDENTIALS_ONLY,\n                null,\n                commandLine,\n                0,\n                null,\n                null,\n                ref lpStartupInfo,\n                out processInformation);\n</code></pre>\n\n<p>This successfully launches Internet Explorer, but does not seem to impersonate the user at all. I am able to impersonate the user via the runas command, so I'm 98% sure the failure to authenticate isn't an IE/zone/password/IIS setting, it's just something I'm not doing right in my call to <code>CreateProcessWithLogonW()</code>.</p>\n\n<p>One thing I've noticed is that the <code>runas /netonly</code> command only works if I add the <code>/noprofile</code> switch, which is something that is stumping me. I have no idea how to set the equivalent of this switch via P/Invoke in C#.</p>\n\n<p>Help is appreciated with either solution (solving the \"IE runs a wizard when I launch it the first time\", or finding the weirdo P/Invoke setting I'm missing).</p>\n"},{"tags":["winapi","winhttp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":112,"score":1,"question_id":12080824,"title":"How to ignore invalid certificates with IWinHttpRequest?","body":"<p>i am using Microsoft's <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa384106.aspx\" rel=\"nofollow\"><code>WinHttpRequest</code></a> COM object to request a web-page with an invalid certificate:</p>\n\n<pre><code>IWinHttpRequest http = new WinHttpRequest();\nhttp.Open(\"GET\", url, false);\nhttp.Send(null);\n</code></pre>\n\n<p>Except that the call to <code>Send</code> throws an exception:</p>\n\n<pre><code>0x80072F0D - The certificate authority is invalid or incorrect\n</code></pre>\n\n<p>How do i tell <code>WinHttpRequest</code> that i don't care, and i want it to retrieve the page i asked for?</p>\n"},{"tags":["winapi","doublebuffered"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":154,"score":2,"question_id":12073721,"title":"What is the correct way to suppress WM_ERASEBKGND?","body":"<p>If I need to use double buffering, I need to suppress <code>WM_ERASEBKGND</code> message.</p>\n\n<p>I can handle <code>WM_ERASEBKGND</code> and return immediately. But can I set the <code>WNDCLASS</code>/<code>WNDCLASSEX</code>'s <code>hbrBackground</code> to <code>NULL</code> and not handle the <code>WM_ERASEBKGND</code> message? Is this a correct way?</p>\n"},{"tags":[".net","windows","winforms","winapi","windows-7"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12077645,"title":"Bring window to front w/out focus","body":"<p>My .NET app is running in the background, and occasionally creates and shows a form. The form should be visible above all other windows, but without focus.</p>\n\n<p>My first approach was to set the TopMost property of the form, but that fails in many cases for reasons I can't explain.</p>\n\n<p>Then I tried calling BringToFront in the Shown event handler, but that didn't do anything.</p>\n\n<p>I also tried BringWindowToTop API, which returned true (= success), but without result.</p>\n\n<p>Now I'm stuck with SetForegroundWindow, which works, but also gives focus to the window (as it should).</p>\n\n<p>Any suggestions would be appreciated.</p>\n\n<p>(Also, is it normal that I can just steal focus without any problem?)</p>\n"},{"tags":["c++","winapi","screen"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":12077939,"title":"error LNK2019: unresolved external symbol __imp__EnumDisplayDevicesA@16 referenced in function \"private: struct _DISPLAY_DEVICEA __thiscall","body":"<p>what am trying to do is getting my Screen info like resolution/refresh rate etc:</p>\n\n<pre><code>#pragma once\n#include &lt; windows.h &gt;\n#include &lt;string&gt;\n#include &lt;sstream&gt;\n\nstruct DesktopScreenInfo\n{\n    int Width;\n    int Height;\n    int ScreenDepth;\n    int FrameRate;\n    std::string ScreenInfoString;\n};\n\nclass DesktopScreen\n{\npublic:\n    DesktopScreen(void);\n    ~DesktopScreen(void);\n\n    DesktopScreenInfo GetScreenInfo();\nprivate:\n    DISPLAY_DEVICE GetPrimaryDevice();\n};\n\n#include \"DesktopScreen.h\"\n\nDesktopScreen::DesktopScreen(void)\n{\n}\n\nDesktopScreen::~DesktopScreen(void)\n{\n}\n\nDISPLAY_DEVICE DesktopScreen::GetPrimaryDevice(){\n    int index=0;\n    DISPLAY_DEVICE dd;\n    dd.cb = sizeof(DISPLAY_DEVICE);\n\n    while (EnumDisplayDevices(NULL, index++, &amp;dd, 0))\n    {\n        if (dd.StateFlags &amp; DISPLAY_DEVICE_PRIMARY_DEVICE) return dd;\n    }\n    return dd;\n}\n\nDesktopScreenInfo DesktopScreen::GetScreenInfo(){\n    DISPLAY_DEVICE dd = GetPrimaryDevice();\n    DesktopScreenInfo info;\n    DEVMODE dm;\n    dm.dmSize = sizeof(DEVMODE);\n\n    if (!EnumDisplaySettings(dd.DeviceName, ENUM_CURRENT_SETTINGS, &amp;dm))\n    {\n        //printf(\"EnumDisplaySettings failed:%d\\n\", GetLastError());\n        return info;\n    }\n    info.Width = dm.dmPelsWidth;\n    info.Height = dm.dmPelsHeight;\n    info.ScreenDepth = dm.dmBitsPerPel;\n    info.FrameRate = dm.dmDisplayFrequency;\n    std::stringstream ss;\n    ss &lt;&lt; info.Width &lt;&lt; \"x\" &lt;&lt; info.Height &lt;&lt; \":\" &lt;&lt; info.ScreenDepth &lt;&lt; \"@\" &lt;&lt; info.FrameRate;\n    info.ScreenInfoString = ss.str();\n}\n</code></pre>\n\n<p>but when am trying to build it , it gives me this errors</p>\n\n<pre><code>Error   2   error LNK2019: unresolved external symbol __imp__EnumDisplayDevicesA@16 referenced in function \"private: struct _DISPLAY_DEVICEA __thiscall DesktopScreen::GetPrimaryDevice(void)\" (?GetPrimaryDevice@DesktopScreen@@AAE?AU_DISPLAY_DEVICEA@@XZ)\nError   3   error LNK2019: unresolved external symbol __imp__EnumDisplaySettingsA@12 referenced in function \"public: struct DesktopScreenInfo __thiscall DesktopScreen::GetScreenInfo(void)\" (?GetScreenInfo@DesktopScreen@@QAE?AUDesktopScreenInfo@@XZ)\n</code></pre>\n\n<p>I have no clue what is wrong :S</p>\n"},{"tags":["c++","windows","dll","winapi","entry-point"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":619,"score":2,"question_id":1903008,"title":"Why not call FreeLibrary from entry point function?","body":"<p>I'm writing a DLL that needs to call a separate DLL dynamically multiple times. I would like to keep the callee loaded and then just unload it when my DLL is unloaded. But according to Microsoft, that's a <a href=\"http://support.microsoft.com/kb/815065\" rel=\"nofollow\">bad idea</a>.</p>\n\n<blockquote>\n  <p>The entry point function should only\n  perform simple initialization tasks\n  and should not call any other DLL\n  loading or termination functions. For\n  example, in the entry point function,\n  you should not directly or indirectly\n  call the LoadLibrary function or the\n  LoadLibraryEx function. Additionally,\n  you should not call the FreeLibrary\n  function when the process is\n  terminating.</p>\n</blockquote>\n\n<p>Here's the offending code. Can somebody explain why I shouldn't call LoadLibrary and FreeLibrary from my DLL's entry point?</p>\n\n<pre><code>BOOL APIENTRY DllMain( HANDLE hModule, \n                       DWORD  ul_reason_for_call, \n                       LPVOID lpReserved\n                     )\n{\nswitch (ul_reason_for_call) {\n    case DLL_PROCESS_DETACH :\n            if (hLogLib != NULL) FreeLibrary(hLogLib);\n            break;\n    }\n    return TRUE;\n}\n</code></pre>\n"},{"tags":["winapi","chm"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12073947,"title":"::HtmlHelp() call not working with a \"remote\" topic string","body":"<p>Here's my code</p>\n\n<pre><code>if (!::HtmlHelp(NULL, pApp-&gt;m_pszHelpFilePath, nCmd, dwData))\n    AfxMessageBox(AFX_IDP_FAILED_TO_LAUNCH_HELP);\n</code></pre>\n\n<p>it brings up the right topic when the topic is \"local\" (i.e. topic in the specified .chm help file like \"abc.htm\"), but when it is a \"remote\" topic (a topic in another .chm file that is a \"child\" chm to he specified .chm), the original help file comes up in the default topic or comes up with the IE \"This program cannot display this web page\" error.</p>\n\n<p>I have links throughout the \"local\" html help file to the \"remote\" chm file, and they all work</p>\n\n<pre><code>&lt;a href=\"CSMainDM.chm::/CommLinks/ConfigureLink.htm\"&gt;Configure Link&lt;/a&gt;\n</code></pre>\n\n<p>but when I programatically try to access the same remote topic via the api, the HTML Help file comes up, but it displays the IE \"This program cannot display this web page\" page in the client area of the help window.</p>\n\n<p>Here's what I'm sending via the call above:</p>\n\n<pre><code>pApp-&gt;m_pszHelpFilePath = 'D:\\DSPMX\\Debug\\Help\\DmDesigner.chm'\nnCommand: 0 (HH_DISPLAY_TOPIC)\n(LPCSTR)dwdata: 'CSMainDM.chm::/CommLinks/ConfigureLink.htm'\n</code></pre>\n\n<p>the dwdata as a string is IDENTICAL to the html link.</p>\n"},{"tags":["c","winapi","ras"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12073460,"title":"code correction to make RASENUM connections to work in XP","body":"<p>As commented on <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa377284%28v=vs.85%29.aspx\" rel=\"nofollow\">MSDN RasEnum code</a> I face the same problem:</p>\n\n<blockquote>\n  <p>Possible inaccuracy in the Note section to lpcb param. Calling\n  RasEnumConnections with lprasconn set to NULL to determine the\n  required buffer size, it doesn't seem to work on Window ver &lt; Vista.</p>\n</blockquote>\n\n<p>I added the below two lines before calling the RasEnumConnections, and it works fine. Is it right? Please correct me if I am wrong.</p>\n\n<blockquote>\n  <p>lpRasConn = (LPRASCONN) HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY,\n  dwCb); lpRasConn[0].dwSize = sizeof(RASCONN);</p>\n</blockquote>\n\n<p>Please add your suggestions.</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#include \"ras.h\"\n#include \"raserror.h\"\n#pragma comment(lib, \"rasapi32.lib\")\n\nDWORD __cdecl wmain(){\n\n    DWORD dwCb = 0;\n    DWORD dwRet = ERROR_SUCCESS;\n    DWORD dwConnections = 0;\n    LPRASCONN lpRasConn = NULL;\n\n    // Call RasEnumConnections with lpRasConn = NULL. dwCb is returned with the required buffer size and \n    // a return code of ERROR_BUFFER_TOO_SMALL\n    /*I ADDED THE BELOW TWO LINES */\n\n    lpRasConn = (LPRASCONN) HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, dwCb);\n    lpRasConn[0].dwSize = sizeof(RASCONN);\n\n    dwRet = RasEnumConnections(lpRasConn, &amp;dwCb, &amp;dwConnections);\n\n    if (dwRet == ERROR_BUFFER_TOO_SMALL){\n        // Allocate the memory needed for the array of RAS structure(s).\n        lpRasConn = (LPRASCONN) HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, dwCb);\n        if (lpRasConn == NULL){\n            wprintf(L\"HeapAlloc failed!\\n\");\n            return 0;\n        }\n        // The first RASCONN structure in the array must contain the RASCONN structure size\n        lpRasConn[0].dwSize = sizeof(RASCONN);\n\n        // Call RasEnumConnections to enumerate active connections\n        dwRet = RasEnumConnections(lpRasConn, &amp;dwCb, &amp;dwConnections);\n\n        // If successful, print the names of the active connections.\n        if (ERROR_SUCCESS == dwRet){\n            wprintf(L\"The following RAS connections are currently active:\\n\");\n            for (DWORD i = 0; i &lt; dwConnections; i++){\n                         wprintf(L\"%s\\n\", lpRasConn[i].szEntryName);\n                  }\n        }\n        //Deallocate memory for the connection buffer\n        HeapFree(GetProcessHeap(), 0, lpRasConn);\n        lpRasConn = NULL;\n        return 0;\n    }\n\n    // There was either a problem with RAS or there are no connections to enumerate    \n    if(dwConnections &gt;= 1){\n        wprintf(L\"The operation failed to acquire the buffer size.\\n\");\n    }else{\n        wprintf(L\"There are no active RAS connections.\\n\");\n    }\n\n    return 0;\n}\n</code></pre>\n"}]}
{"total":13828,"page":15,"pagesize":100,"questions":[{"tags":["c++","winapi","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":240,"score":0,"question_id":11988863,"title":"launch another application as popup window","body":"<p>I have a MFC application that launches other (generic windowed, black box) applications as a pop-up and waits for their completion. No communication/interaction between parent and child is required and should be avoided. Only the \"child app behaves as modal dialog of parent app\" behavior is wanted.\nWhat is the correct way to do this?</p>\n\n<p>An example of \"launch another application as <em>child</em> window\" can be seen at: <a href=\"http://stackoverflow.com/questions/1483566/activating-an-application-as-a-child-popup-of-another-application\">Activating an application as a child/popup of another application</a> which leads to <a href=\"http://www.codeproject.com/Articles/18724/Hosting-exe-applications-into-a-dialog\" rel=\"nofollow\">http://www.codeproject.com/Articles/18724/Hosting-exe-applications-into-a-dialog</a> (this is not what I want, I want modal popup behavior)</p>\n\n<p>For simplicity we can assume that both launching and launched applications have single \"stack\" of windows (one main window with modal dialogs that can have own modal dialogs).</p>\n\n<p>My current pseudo-code (error handling and callback function omitted for simplicity)</p>\n\n<pre><code>//get the current MFC dialog of launcher program we are launching the other app from\nparentWnd = AfxGetMainWnd()-&gt;GetActiveWindow(); \nparentHwnd = parentWnd-&gt;GetSafeHwnd(); //HWND\n\n// launch child and retrieve basic info from PROCESSINFO structure\nCreateProcess(childExecutable); // =&gt; childProcessHandle, childProcessId \n\n//get the \"main\" window of child application\nEnumWindows(EnumProc_That_Retrieves_TopLevelWindow_With_childProcessId); // =&gt; childHwnd\n\n//link the child window as popup\nSetWindowLong(childHwnd, GW_OWNER, parentHwnd);\n\n//disable input into parent window\nparentWnd-&gt;EnableWindow(FALSE);\n\n//remove taskbar entry for child\nSetWindowLong(child, GWL_EXSTYLE, GetWindowLong(child, GWL_EXSTYLE)&amp;~WS_APPWINDOW);\n\n//now keep waiting for the child process termination and process parent messages (e.g. WM_PAINT)\nwhile (MsgWaitForMultipleObjects(childProcessHandle and process QS_ALLINPUT) {\n   while (PeekMessage(PM_NOREMOVE)) AfxGetApp()-&gt;PumpMessage();\n}\n\n//re-enable input into parent window\nparentWnd-&gt;EnableWindow(TRUE);\n</code></pre>\n\n<p>Now what my lesser problems are with foreground visual style (e.g. foreground = blue titlebar vs. background = gray titlebar) and keyboard input focus behavior:</p>\n\n<p>1) initial removal of childs WS_APPWINDOW style removes foreground visual and input focus from child app. No application has focus at that point.</p>\n\n<p>2) when user clicks any parent application window, the child foreground visual style is toggled. Keyboard focus is retained in the child application.\nexample: child app has foreground + focus -> click parent 1st time -> child <strong>loses</strong> foreground, retains focus -> click parent 2nd time -> child <strong>gains</strong> foreground, keeps focus -> etc.</p>\n\n<p>expected behavior (what \"normal\" MFC popups do): \nchild app has foreground + focus -> click parent -> child titlebar <strong>flashes briefly</strong> and retains foreground + focus\nchild app does not have foreground + focus -> click parent -> child titlebar <strong>gains foreground</strong> and keyboard focus</p>\n\n<p>And now this is <strong>worst problem</strong>:\n3) I have encountered a MFC application that when launched separately user can open a \"stack of modal dialogs\" A->B->C->D->E, the ownership of windows is exactly matching this (E is owned by D, D owned by C etc.). But if I open it from my MFC application (M), the ownership looks like M->A->B->C,D,E  (C,D,E are all owned by B, B owned by A, A owned by my app window M). This leads to \"stack without support\" <a href=\"http://blogs.msdn.com/b/oldnewthing/archive/2005/02/24/379635.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/oldnewthing/archive/2005/02/24/379635.aspx</a> problem.\nThis behavior disappears when I remove <code>SetWindowLong(childHwnd, GW_OWNER, parentHwnd)</code> so messing with ownership probably triggers the unwanted behavior of child application, but without that I can't seem to guarantee the \"one is positioned over the other\" premise of modal dialog.</p>\n\n<p>So the grand question again: what is the correct way to do this task and avoid the problems I have described.</p>\n\n<p>Edit</p>\n\n<h2>Solution so far</h2>\n\n<p>We must avoid messing with owner-owned structures as @mfc suggests below, so the task is basically to reimplement this aspect of window manager for just our parent-child pair in another way. I have prototyped part of solution using Windows Hooks. However it seems quite complex and tedious to complete, so I decided to go with another primitive approach (deadlines, oh deadlines). For the sake of example, I will describe basic ideas of both.</p>\n\n<h3>Hook solution</h3>\n\n<p>Disclaimer: only parent focus hook has been confirmed to work, rest is theorycrafting. Maybe there is be cleaner/more lightweight implementation, one could get inspiration in actual Windows window manager implementation (remember the whole point is avoiding setting GW_OWNER which works fine for window manager, but can break the child black-box app behavior).</p>\n\n<ul>\n<li>add some \"ignore input while child is running\" into parent message loop for when child app is running (intermittently) without windows</li>\n<li>create shared memory and structures to hold [parentPid, parentHwnd,childPid] for each invocation</li>\n<li>create DLL instanced memory for [list of parent nonowned windows, their UI thread, child hook]</li>\n<li>hook systemwide to WH_CBT -> HCBT_CREATEWND, if childPid matches, register window in list, register another hook HCBT_ACTIVATE just for that child thread if not already present</li>\n<li>hook systemwide to WH_CBT -> HCBT_DESTROYWND, if childPid matches, unregister window in list, unregister HCBT_ACTIVATE hook if this was last window for given thread, if this was last window for child app, unhook parent HCBT_ACTIVATE hook and focus parent</li>\n<li>parent thread HCBT_ACTIVATE hook prevents gaining focus and focuses child app instead using EnumWindows.</li>\n<li>child thread HCBT_ACTIVATE hooks prevent focus loss if the target is parent, keep parent just below child in Z-order</li>\n<li>create child process suspended and resume only when hooks are in place</li>\n<li>remember to unhook everywhere</li>\n</ul>\n\n<h3>Primitive approach</h3>\n\n<p>basically applying focus switch in first point of previous solution, when parent is clicked it flickers over child as focus is transferred back and forth.</p>\n\n<ul>\n<li>\"ignore input while child is running\" (discard various keypress, click, etc. messages) in parent message loop for when child app is running, focus child app instead using EnumWindows.</li>\n</ul>\n"},{"tags":["c++","winapi","error-handling"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":2144,"score":2,"question_id":3006229,"title":"get a text from the error code returns from the GetLastError() function","body":"<p>I need to get the text of an error code that i got from the GetLastError function.\nI saw a few examples but i want a function that get the code and return the string.\nThank's you all</p>\n"},{"tags":["c++","winapi","mfc","clistbox"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":98,"score":0,"question_id":12068442,"title":"Move an item up or down in a list box","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4796109/how-to-move-item-in-listbox-up-and-down\">How to move item in listBox up and down?</a>  </p>\n</blockquote>\n\n\n\n<p>I have a CListBox, and I want to have a Move Up/Move Down buttons, which move the currently selected item up or down.</p>\n\n<p>Right now I think the only solution is to delete the item and then insert it the new position. </p>\n\n<p>Is there a more effiecient way to do it?</p>\n"},{"tags":["c++","winapi","windows-7","windows-services"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":173,"score":0,"question_id":12018545,"title":"How to run a service as LocalSystem in Windows 7?","body":"<p>I am trying to write my first service application following instructions in Windows SDK. I installed the service using the following code:</p>\n\n<pre><code>SC_HANDLE schs=CreateService(sch,\n                             SERVICENAME,\"VMFS - Servidor de arquivos\",\n                             SC_MANAGER_CREATE_SERVICE,\n                             SERVICE_WIN32_OWN_PROCESS,\n                             SERVICE_AUTO_START,\n                             SERVICE_ERROR_NORMAL,\n                             pathexe,\n                             NULL/*LoadOrderGroup*/,\n                             NULL/*TagId*/,\n                             NULL/*Dependencies*/,\n                             NULL/*Account:Local System*/,\n                             NULL/*Password*/);\n</code></pre>\n\n<blockquote>\n  <p>The server does not start(error 1053).</p>\n</blockquote>\n\n<p>But, if I go to services.msc and change service to logon as my account name (Valdeci), the service starts. So this seems to be a logon error. What is wrong? I want to run my service also in Windows XP and Vista, but didn´t try it because my developing machine has Windows 7.</p>\n"},{"tags":["winapi","file","locking","handle"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":2092,"score":2,"question_id":1293398,"title":"Under which circumstances does the System process (PID 4) retain an open file handle?","body":"<p>My application running on a Windows server makes use of a Jet/Access database. For some reasons around every two weeks that database file gets locked by the System process (PID 4, seems to be fixed)</p>\n\n<p>After some googling I found some other users having their files locked by that special process, but different files (of course).</p>\n\n<ul>\n<li>What's the general reason for the System process to keep an open file handle?</li>\n<li>Is my application the cause for this locking situation?</li>\n<li>Are all handles implicitly opened by the System process? I could imagine that after a process has crashed, the handle may still be open and the System process somehow takes owernship of that handle.</li>\n<li>Can I do something in my application to prevent it from happening?</li>\n</ul>\n"},{"tags":["c#",".net","winapi","console","console-application"],"answer_count":3,"favorite_count":4,"up_vote_count":8,"down_vote_count":0,"view_count":358,"score":8,"question_id":11959643,"title":"Why does closing a console that was started with AllocConsole cause my whole application to exit? Can I change this behavior?","body":"<p>What I want to have happen is that the console window just goes away, or better yet that it is hidden, but I want my application to keep running. Is that possible? I want to be able to use Console.WriteLine and have the console serve as an output window. I want to be able to hide and show it, and I don't want the whole app to die just because the console was closed.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Code:</p>\n\n<pre><code>internal class SomeClass {\n\n    [DllImport(\"kernel32\")]\n    private static extern bool AllocConsole();\n\n    private static void Main() {\n        AllocConsole();\n        while(true) continue;\n    }\n}\n</code></pre>\n\n<p><strong>EDIT 2</strong></p>\n\n<p>I tried the accepted solution here [ <a href=\"http://stackoverflow.com/questions/474679/capture-console-exit-c-sharp\">Capture console exit C#</a> ], per the suggestion in the comments on this question. The example code is bugged in that the DLLImport needs to be \"kernel32.dll\" or \"kernel32\", not \"Kernel32\". After making that change, I'm getting a message to my handler for CTRL_CLOSE_EVENT when I click the X on the console window. However, calling FreeConsole and/or returning true doesn't prevent the application from terminating.</p>\n"},{"tags":["c++","windows","winapi","terminalservices","usersession"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12063873,"title":"Trying to interpret user session states on Windows OS","body":"<p>If I call the following API from a local service running on Windows 7:</p>\n\n<pre><code>WTS_SESSION_INFO* pWSI;\nDWORD nCntWSI;\nWTSEnumerateSessions(WTS_CURRENT_SERVER_HANDLE, NULL, 1, &amp;pWSI, &amp;nCntWSI);\n</code></pre>\n\n<p>and then go through all returned <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa383864%28v=vs.85%29.aspx\" rel=\"nofollow\">WTS_SESSION_INFO</a> structs in pWSI and check WTS_CONNECTSTATE_CLASS State members, can someone explain what is the difference between <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa383860%28v=vs.85%29.aspx\" rel=\"nofollow\">WTSActive</a> and <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa383860%28v=vs.85%29.aspx\" rel=\"nofollow\">WTSConnected</a>?</p>\n"},{"tags":["winapi","modem","ras","dial-up"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":147,"score":0,"question_id":12066557,"title":"rasphone.pbk behaviour difference and Dial-up Connection behaviour","body":"<p>I finsihed developing an Auto-dialup connection using RAS functions. I face the below problems in it</p>\n\n<p>1) The problem is if the device or modem is not plugged in and if the created connection ( for ex: DIAL-UP )  from \"CONTROL PANEL -> NETWORK CONNECTIONS\"  is clicked the modem section in the PBK file for corresponding connection get changed. And after that I cant make a dial-up connection by clicking the created connection, by plugging my device in different ports. If I again connect the device in same port ( where I created the connection for first time) and click the connection get established successfully.</p>\n\n<p><strong>Brief description:</strong></p>\n\n<p>Once I clicked my exe, a connection named \"DIAL-UP\" got established and I can access my device via the created  connection. But when I disconnect my device (i.e with out a Modem), and if I click the created connection from \"Network Connections\", the values in the corresponding PBK file ( rasphonebook.pbk) got changed to some other values. Because of this, when I reconnect the device in another port \"I am getting ERROR 633: The modem is already in use or not Configured properly\". Now I unplugged the device and connected in the same port where I created the dial up connection  and clicked the \"DIAL-UP\" connection, this time a connection gets created successfully (  here the PBK file get restored with right parameters), and from here I can plug in any port and the connection will get created automatically.</p>\n\n<p>Any advice on this issue?</p>\n\n<p>2) I used the below code snippet to set the parameters of PBK file.</p>\n\n<pre><code>RASENTRY RasEntry;\n\n RasEntry.dwfOptions = 0;\n RasEntry.dwfOptions2 = 0;\n\nRasEntry.dwfOptions |= (  RASEO_IpHeaderCompression | RASEO_ModemLights |RASEO_SwCompression | \n RASEO_ShowDialingProgress | RASEO_NetworkLogon | RASEO_DisableLcpExtensions );\n\nRasEntry.dwfOptions2 |= ( RASEO2_UseGlobalDeviceSettings | RASEO2_Internet );\n</code></pre>\n\n<p>the problem I face here is the parameters in \"rasphonebook.pbk\" are set as expected in \"Windows XP\". But when I run my exe in \"Windows 7\" I can see a huge difference in the parameters set in phonebook file. Any idea in this issue, do I want do something differnet for windows 7 ?</p>\n"},{"tags":["windows","winapi","pipes"],"answer_count":6,"favorite_count":6,"up_vote_count":12,"down_vote_count":0,"view_count":11998,"score":12,"question_id":258701,"title":"How can I get a list of all open named pipes in Windows?","body":"<p>Is there an easy way to test whether your named pipe is working correctly? I want to make sure that the data I'm sending from my app is actually being sent. Is there a quick and easy way to get a list of all the named pipes?</p>\n"},{"tags":["c","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12064534,"title":"WM_MOUSELEAVE and Parent-Child windows","body":"<p>In a main window <code>hwndFrame</code>, it has a child <code>hwndChild</code> which has a child <code>hwndDescendant</code>. These two childs have no non-client area. <code>hwndDescendant</code> occupy most of the region of <code>hwndChild</code>, so <code>hwndChild</code> looks like just a \"boundry\" of <code>hwndDescendant</code>. This \"boundry\" has width 4 pixels only. (But the size of <code>hwndChild</code> is much big than this).</p>\n\n<p>I want to track <code>WM_MOUSELEAVE</code> for 'hwndChild'. If I move the mouse slowly, this works fine.\nBut if I move mouse very quickly from <code>hwndFrame</code> to <code>hwndDescendant</code> or vice versa, <code>hwndChild</code> didn't receive <code>WM_MOUSEMOVE</code>, hence neither <code>WM_MOUSELEAVE</code>.</p>\n\n<p>Also when mouse move from <code>hwndChild</code> to either <code>hwndFrame</code> or <code>hwndDescendant</code> will generate WM_MOUSELEAVE. But I wish that when move from <code>hwndChild</code> to <code>hwndDescendant</code> don't generate <code>WM_MOUSELEAVE</code>.</p>\n\n<p>I don't want to solve this issue by subclass the window procedure of <code>hwndDescendant</code>, because if <code>hwndChild</code> has many childs, it is not a good way.</p>\n\n<p><code>SetCapture</code> method is not preferable. In this case, what is the best way taht I can deal with this issue?</p>\n"},{"tags":["delphi","winapi","api","hotkey","registerhotkey"],"answer_count":7,"favorite_count":21,"up_vote_count":49,"down_vote_count":0,"view_count":4990,"score":49,"question_id":829007,"title":"Find out what process registered a global hotkey? (Windows API)","body":"<p>As far as I've been able to find out, Windows doesn't offer an API function to tell what application has registered a global hotkey (via RegisterHotkey). I can only find out that a hotkey is registered if RegisterHotkey returns false, but not who \"owns\" the hotkey.</p>\n\n<p>In the absence of a direct API, could there be a roundabout way? Windows maintains the handle associated with each registred hotkey - it's a little maddening that there should be no way of getting at this information.</p>\n\n<p>Example of something that likely wouldn't work: send (simulate) a registered hotkey, then intercept the hotkey message Windows will send to the process that registered it. First, I don't think intercepting the message would reveal the destination window handle. Second, even if it were possible, it would be a bad thing to do, since sending hotkeys would trigger all sorts of potentially unwanted activity from various programs. </p>\n\n<p>It's nothing critical, but I've seen frequent requests for such functionality, and have myself been a victim of applications that register hotkeys without even disclosing it anywhere in the UI or docs. </p>\n\n<p>(Working in Delphi, and no more than an apprentice at WinAPI, please be kind.)</p>\n"},{"tags":[".net","winapi","marshalling","windows-api-code-pack","overflowexception"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12059736,"title":"TaskDialog from WinAPICodePack does not work on .NET 4.0","body":"<p>I am writing an application and wanted to use the <code>TaskDialogIndirect</code> function - however I did not want to write a huge amount of P/Invoke stuff etc. so I have included the WinAPICodePack. There is one problem though! When I create a control for the <code>TaskDialog</code> and add it to the dialog everything works fine. However running the <code>Show</code> methods results in an <code>OverflowException</code> in mscorlib. I tracked this down to some pointer handling and marshalling.</p>\n\n<p>Experimenting with the code had the result, that I found out, that the DLL <strong>MUST</strong> be compiled for .NET 3.5 and the including app <strong>TOO</strong>. Having my app on .NET 4.0 invokes this error... any idea about a workaround - or can you even reproduce this error?</p>\n\n<p>Another issue is that I can set the the <code>Icon</code> property to whatevery I want, but the icon is not shown at all. I have to setup an <code>Opened</code> event which dynamically sets the icon...</p>\n\n<p>Information: Running Visual Studio 2012 RTM on Windows 8 Pro x64 RTM. Application is a standard WPF app.</p>\n\n<p>Sample code:</p>\n\n<pre><code>TaskDialog td = new TaskDialog();\ntd.Cancelable = true;\ntd.Caption = \"Caption\";\ntd.InstructionText = \"Instructions\";\ntd.Text = \"Text\";\n\nTaskDialogCommandLink buttonElevation =\n    new TaskDialogCommandLink(\"elevation\", \"Elevation Required Sample\");\nbuttonElevation.UseElevationIcon = true;\n\ntd.Controls.Add(buttonElevation);\ntd.Show(); // OverflowException occurs here!\n</code></pre>\n"},{"tags":["c++","delphi","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12057331,"title":"SHGetImageList & Icons 64x64","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1703186/can-48x48-or-64x64-icons-be-obtained-from-the-vista-shell\">Can 48x48 or 64x64 icons be obtained from the Vista Shell?</a>  </p>\n</blockquote>\n\n\n\n<p>I would like to get 64x64 icons for Documents/Pictures/Music libraries. Explorer.exe is able to do it. </p>\n\n<p>I use API function SHGetImageList and I don't have any problem to get 48x48 or 256x56 but I don't know  how to get 64x64 icons.</p>\n\n<p>When I use SHGetImageList with SHIL_EXTRALARGE I get 48x48 and when with SHIL_JUMBO I get 256x256....</p>\n\n<p>Is there any way how to get icons 64x64 for Documents/Pictures/Music libraries in W7 ??? </p>\n\n<p>thx</p>\n"},{"tags":["winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12059213,"title":"Why make pointers static in dialog procs?","body":"<p>I'm going through many examples of basic win32 dialog procedures. They seem to take this basic pattern.</p>\n\n<pre><code>class Person\n{\n     char Name[63];\n     int Age;\n};\n\nBOOL CALLBACK EditDlgProc ( HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam)\n{\n     static Person* person;\n     switch(uMsg)\n     {\n     case WM_INITDIALOG:\n         person = (Person*)lParam;\n         return FALSE;\n     case WM_COMMAND:\n           .....\n     }\n     return FALSE;\n}\n</code></pre>\n\n<p>I want to know why make person <em>static</em>? </p>\n\n<ul>\n<li>Is this for efficiency? (avoid assigning person to lParam every call)</li>\n<li>Is this for sharing? </li>\n</ul>\n"},{"tags":["winapi","winsock"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":95,"score":1,"question_id":11847793,"title":"Are TCP SOCKET handles inheritable?","body":"<p>On Windows, most sorts of handles can be inherited by child processes. The expectation is that TCP sockets can also be inherited. However, when certain Layered Service Providers are installed, this does not work as expected (A/V products such as PCTools from Symantec used to cause problems with our application for customers).</p>\n\n<p>The way Microsoft has architectured WinSock, should we expect to be able to inherit SOCKETs correctly?</p>\n"},{"tags":["winapi","winsock"],"answer_count":1,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12058911,"title":"Can TCP SOCKET handles be set not inheritable?","body":"<p>Windows handles can be set to be either inheritable or not, to control whether child processes will receive them (when <code>bInheritHandles</code> in <code>CreateProcess</code> is TRUE). However, using <code>SetHandleInformation</code> to mark a SOCKET non-inheritable does not always work. In particular, when certain Layered Service Providers (LSPs) are installed, the child process inherits the handle anyway. This is particularly likely to cause bugs with listening sockets. (But, because of <a href=\"http://stackoverflow.com/questions/11847793/\">another issue</a>, if the child were to try using the socket, it would not be able! A real catch-22!)</p>\n\n<h3>Steps to reproduce</h3>\n\n<ol>\n<li>Create eg a listening socket. Mark it non-inheritable using <code>SetHandleInformation</code>.</li>\n<li>Spawn a child, with <code>bInheritHandles</code> true.</li>\n<li>Close the socket in the parent, and attempt to re-bind to the port.</li>\n</ol>\n\n<p>When a (non-IFS) LSP is installed, eg. PCTools Internet Security, the listening socket will be open in the child (visible in <code>netstat</code>), despite <code>SetHandleInformation</code> being called on the socket to disable inheritance before creating the child.</p>\n\n<p>For an alternative scenario, see the (brief) steps in <a href=\"http://support.microsoft.com/kb/2398202\" rel=\"nofollow\">KB2398202</a>.</p>\n\n<h3>What workarounds are available?</h3>\n"},{"tags":["c#","winforms","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":130,"score":1,"question_id":12058394,"title":"SendMessage WM_SETTEXT throws SecurityPermission Error","body":"<p>I am having trouble with on of our clients machines throwing an error when the SendMessage(WM_SETTEXT..) API is called. It works fine on other customer's machines and all our machines here. The error thrown is a System.Security.Permissions.SecurityPermission. I Googled but could not find any references as to a reason. Even when the hwnd does not point to a real window there is no error in my testing. Any help would be appreciated.</p>\n\n<pre><code>[DllImport(\"user32.dll\", CharSet = CharSet.Auto)]\nstatic extern IntPtr SendMessage(IntPtr hWnd, uint Msg, int wParam, string lParam);\n...\n\nprivate void RegisterWithCaller()\n{\n    if (this.hwndCaller != IntPtr.Zero)\n    {\n        if (FormMode.DELIVERY == this.formMode)\n        {\n            SendMessage(this.hwndCaller, WM_SETTEXT, 0, \"hWndInvoiceDisplay=\" + this.txtCommunicate.Handle.ToInt32().ToString());\n        }\n        else\n        {\n            SendMessage(this.hwndCaller, WM_SETTEXT, 0, \"hWndBOLsDisplay=\" + this.txtCommunicate.Handle.ToInt32().ToString());\n        }\n    }\n}\n</code></pre>\n"},{"tags":["winapi","windows-8","wireless","airplane"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":422,"score":2,"question_id":11671557,"title":"How to check/switch the airplane mode programmatically in Windows 8?","body":"<p>I have to check if the Airplane Mode is enabled in Windows 8 and maybe switch its state. I am currently working on a C# .NET 4.0 Windows Forms application but the answers in this question shouldn't be limited by that.</p>\n"},{"tags":["winapi","google-chrome","google-chrome-extension","message","desktop-application"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":71,"score":3,"question_id":12056380,"title":"How can I send a message from Google Chrome extension to desktop application?","body":"<p>I have a Windows desktop application which must work in collaboration with my Chrome extension. </p>\n\n<p>Can I send a message to my desktop app somehow from Google Chrome extension?</p>\n\n<p>Which IPC objects can I use?</p>\n"},{"tags":["c","winapi","dll","prototyping"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":12055405,"title":"Prototyping extern function in Visual C++","body":"<p>I have some exe application. This app has an exporting table and export a bunch of functions. I'd like to use some of them. For example, I need to use ABS function. I opened Ida Pro, looked at pseudocode, and i have the next one:</p>\n\n<pre><code>double __cdecl ABS(double *a1, double *a2)\n{\n if ( *a2 &lt; 0.0 )\n {\n   *a1 = -1.0 * *a2;\n }\n else\n {\n   *a1 = *a2;\n   *(a1 + 4) = *(a2 + 4);\n }\n return *a1;\n}\n</code></pre>\n\n<p>Then i wrote prototype:</p>\n\n<pre><code>typedef double (*ABS)(double *,double *);\n\nint _tmain(int argc,_TCHAR* argv[])\n{\n    HINSTANCE hMod = LoadLibrary(L\"exe.exe\");\n    if (hMod!=NULL)\n    {\n        ABS func = (ABS)GetProcAddress(HMod,\"ABS\");\n        if (func!=NULL)\n        {\n            double x=0;\n            double y =-2;\n            double z = func(&amp;x,&amp;y);\n        }\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>prototype in my project:</p>\n\n<pre><code>typedef double (*ABS)(double *, double *);\n</code></pre>\n\n<p>ok, hMod and func not NULL, but al a result I have  an error (while reading memory) or some not right values. (exmpl: 483435, -343524)\nHelp me, please, to correct this situation</p>\n\n<p>Here origin Ida pro pseudosode:</p>\n\n<pre><code>double __cdecl ABS(int a1, int a2)\n{\n  if ( *(double *)a2 &lt; 0.0 )\n  {\n    *(double *)a1 = -1.0 * *(double *)a2;\n  }\n  else\n  {\n    *(_DWORD *)a1 = *(_DWORD *)a2;\n    *(_DWORD *)(a1 + 4) = *(_DWORD *)(a2 + 4);\n  }\n  return *(double *)a1;\n}\n</code></pre>\n\n<p>I thought it is equal to my optimization</p>\n\n<p>PS: <code>*(a1 + 4) = *(a2 + 4);</code> is not means that we move address? Becouse we move pointer values</p>\n"},{"tags":["windows","winapi","sysinternals"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12056692,"title":"Spawning a process from a process with admin privilages","body":"<p>I would like to spawn a process (browser) from a potential process which have admin privilages.</p>\n\n<p>However, I would like to make sure that the new spawned process will have no admin privilages.</p>\n\n<p>To make it easy to understand, I have an admin privilage process and I am going to run the default browser of the user. I do not want it to have admin privilages to remove potential security-issues.</p>\n"},{"tags":["c#",".net","winapi","keyboard-hook"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":1,"view_count":167,"score":3,"question_id":12011579,"title":"Global low level keyboard hook - Race Condition","body":"<p>I have written a c# application that contains a WinAPI low level keyboard hook that I use to prevent all but alphanumeric keys.</p>\n\n<p>The problem is - other programs (those that start at login) also have keyboard hooks (to start applications such as calculator, browser, etc).  These programs have already opened these applications before my hook callback has been reached, therefore, there is no way for me to stop the action.</p>\n\n<p>Is there any way to ensure that my hook is called before any others?</p>\n\n<hr>\n\n<p><strong>EDIT</strong></p>\n\n<p>To clear up confusion - My application is a single executable that has no installer.  It is run on demand.</p>\n\n<p>I need to be able to take over other hooks - or simply force my hook callback to be called first - Even though others have already called the <code>SetWindowsHookEx</code> method.</p>\n"},{"tags":["c++","c","winapi","gdi"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":154,"score":3,"question_id":3614253,"title":"Prevent default click event (WinAPI)","body":"<p>I'm making a color dropper tool and while this tool is active, when the user clicks or taps I only want it to run my mouse event, not anything else,so while this tool is running,if the user clicks the start orb, it should not open the start menu (or if the user clicks anything else). How could I do this?</p>\n\n<p>Thanks</p>\n"},{"tags":["c++","winapi","richedit","dialogbox"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":326,"score":1,"question_id":6429881,"title":"Rich Edit Control changes the DialogBox return value behavior?","body":"<p>I'm a bit puzzled: i created a dialogbox with <code>Edit Control</code>, then i noticed the text isn't word wrapped, so i googled and found out that i should use <code>Rich Edit Control</code> instead. So i did. Now, when ever there is a <code>Rich Edit Control</code> in my dialog box, the functionality changes: without <code>Rich Edit Control</code> the dialogbox returned either <code>IDOK</code> or <code>IDCANCEL</code>, which i handle outside of the message handler code. BUT, if there is a <code>Rich Edit Control</code> anywhere in the dialogbox, it always returns something else than <code>IDOK</code>, before i even click any buttons in the dialog box: the dialogbox seems to not even be created at all.</p>\n\n<p>Here is the message handler:</p>\n\n<pre><code>INT_PTR CALLBACK MyDialogBox(HWND hDlg, UINT message, WPARAM wParam, LPARAM lParam){\n    switch(message){\n        case WM_INITDIALOG: {\n            SetDlgItemText(hDlg, IDC_EDIT1, (LPCTSTR)some_string.c_str());\n            return (INT_PTR)TRUE;\n        }\n        case WM_COMMAND:\n            switch(LOWORD(wParam)){\n                case IDOK: case IDCANCEL: {\n                    EndDialog(hDlg, LOWORD(wParam));\n                    return (INT_PTR)TRUE;\n                }\n            }\n        break;\n    }\n    return (INT_PTR)FALSE;\n}\n</code></pre>\n\n<p>And here is the code where i use the dialogbox:</p>\n\n<pre><code>if(DialogBox(hInstance, MAKEINTRESOURCE(IDD_DIALOG1), hWnd, MyDialogBox) == IDOK){\n    // without rich edit control it goes here or below depending on the user choice.\n}else{\n    // with rich edit it always goes here.\n}\n</code></pre>\n\n<p>So, the ultimate question here is: how do i get this thing work like it works with normal <code>Edit Control</code> ?</p>\n\n<p><strong>Edit:</strong> when it fails, the values are: -1 for DialogBox(), and 0 for GetLastError(), if that helps ?</p>\n\n<p><strong>Edit2:</strong> Problem solved by antinome's <a href=\"http://social.msdn.microsoft.com/Forums/en-US/vcgeneral/thread/c325a6ab-5e58-4970-a123-cda46fb096ff/\" rel=\"nofollow\">link</a>: include <code>afxwin.h</code> and call <code>AfxInitRichEdit2()</code> at the window <code>WM_CREATE</code> message.</p>\n"},{"tags":["winapi","visual-c++","scheduled-tasks","windows-server-2003"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":289,"score":0,"question_id":12050668,"title":"CoCreateInstance failed error 80040154 in Win 2003","body":"<p>I got error \"Failed to create an instance of ITaskService: <strong>80040154</strong>\" when i call the function <strong>CoCreateInstance</strong> with <strong>CLSID_TaskSchedule</strong> and <strong>IID_ITaskService</strong>.</p>\n\n<p>I am using ITaskService interface for creating the scheduled task.<strong>Same appln works fine in Win7 but failed in Win2003</strong>.</p>\n\n<pre><code> ITaskService *pService = NULL;\nhr = CoCreateInstance( CLSID_TaskScheduler,\n                       NULL,\n                       CLSCTX_INPROC_SERVER,\n                       IID_ITaskService,\n                       (void**)&amp;pService ); \n</code></pre>\n\n<p>Is this ITaskService interface support only Win7/Server 2k8 R2 OR else it support all Windows platfor?</p>\n\n<p>Thanks in aadvance.</p>\n"},{"tags":["c","winapi","dll","code-signing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":12044691,"title":"GetModuleInformation fails when using LoadLibraryExA(...,...,LOAD_LIBRARY_AS_DATAFILE)?","body":"<p>I am using <code>dliNotePreLoadLibrary</code> in my own delay loading hook to verify the code signature of a DLL to be loaded before actually loading it. In order to avoid it to execute <em>any</em> code whatsoever, I load it by means of <code>LoadLibraryExA(...,...,LOAD_LIBRARY_AS_DATAFILE)</code> (the hook only provides the ANSI name, so that's okay) and unload it after verification so that it can be loaded as a DLL with code.</p>\n\n<p>Stepping through the code in the debugger I can see that I receive a handle and that handle is <code>&lt;baseaddress&gt;+1</code> as expected for a \"data module\". However, once I attempt to pass this handle to <code>GetModuleFileName</code> inside a library function (that is also the reason why I can't pass the name, only the module handle), the function returns <code>0</code> and GetLastError gives me <code>ERROR_MOD_NOT_FOUND</code>. However, the module got loaded, so it was definitely found. Also, this is in the current process, so access to the \"target process\" is no issue here.</p>\n\n<p>So I thought why not use <code>VirtualQuery</code> to retrieve the actual base address (<code>MEMORY_BASIC_INFORMATION::BaseAddress</code>) of the DLL I just loaded (in case the <code>&lt;baseaddress&gt;+1</code> is an issue), but the result remains the same: <code>ERROR_MOD_NOT_FOUND</code>.</p>\n\n<p>I'm out of ideas. Does anyone have any ideas what is going on here?</p>\n\n<p>Platform of the tests: Windows 7 SP1, x64 (latest patches)</p>\n\n<p>Here's the code of the:</p>\n\n<pre><code>FARPROC WINAPI MyDliHook(unsigned dliNotify, PDelayLoadInfo pdli)\n{\n    switch(dliNotify)\n    {\n    case dliNotePreLoadLibrary:\n        if(0 == lstrcmpiA(pdli-&gt;szDll, \"DLLNAME.dll\"))\n        {\n            HMODULE hVerifiedDll = LoadLibraryExA(pdli-&gt;szDll, NULL, LOAD_LIBRARY_AS_DATAFILE);\n            if(hVerifiedDll)\n            {\n                MEMORY_BASIC_INFORMATION mbi;\n                if(0 != VirtualQuery(hVerifiedDll, &amp;mbi, sizeof(mbi)));\n                {\n                    VerifyModuleSignature((HMODULE)mbi.BaseAddress, pdli-&gt;szDll);\n                }\n                FreeLibrary(hVerifiedDll);\n            }\n        }\n        break;\n    default:\n        break;\n    }\n    return NULL;\n}\nPfnDliHook __pfnDliNotifyHook2 = MyDliHook;\n</code></pre>\n\n<p>The function <code>VerifyModuleSignature</code> calls first of all <code>GetModuleFileName</code> to retrieve the file name and it fails at that step. I verified that with the <code>.exe</code> that creates the process, the code signature verification works fine.</p>\n\n<p><strong>Side-note:</strong> I have verified that the <code>ERROR_MOD_NOT_FOUND</code> error comes from <code>GetModuleFileName</code> and not, for example, from the earlier call to <code>LoadLibraryExA</code>. In order to make sure I don't get a \"polluted\" last error code I called <code>SetLastError(ERROR_SUCCESS)</code> right before the call to <code>GetModuleFileName</code>.</p>\n"},{"tags":["winapi","service","runas"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":12049485,"title":"Is the profile of the user loaded when running a service as another user?","body":"<p>Basically I want to new if there is any difference between using WinAPI functions like CreateProcessWithLogonW from a Windows service compared to just changing the user that runs the service. Will the profile be loaded when running service as another user?</p>\n\n<p>Thanks</p>\n"},{"tags":["c++","windows","winapi","input"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12046393,"title":"Windows BlockInput function is not working","body":"<p>Why <code>BlockInput</code> isn't working</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;windows.h&gt;\n#include &lt;winable.h&gt;\nint main() {\n    BlockInput(true);\n    Sleep(10000);\n    return 0;\n}\n</code></pre>\n\n<p>and it simply doesn't block anything!<br>\nI can still do everything like I haven't even done that.<br>what I also find weird is that <a href=\"http://msdn.microsoft.com/en-us/library/ms646290%28v=vs.85%29\" rel=\"nofollow\">MSDN</a> sais that it should be declared in <code>winuser.h</code> and it is in <code>Winable.h</code> + I thought that <code>winable.h</code> is in <code>windows.h</code> but It's not, I had to include it seperatly >_> <br></p>\n\n<p>If it helps my IDE is:<br>\nCode::Blocks 10.05 MinGW</p>\n\n<p>EDIT: Actually I did the <code>GetLastError()</code> and it prints error 5 <code>ERROR_ACCESS_DENIED</code><br>\nHow may I get the access?</p>\n"},{"tags":["winapi","dll","code-signing"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":3938,"score":5,"question_id":341168,"title":"Can I remove a digital signature from a DLL?","body":"<p>My installer build \"signs\" a DLL using a Code Signing certificate during the build process. </p>\n\n<p>I've noticed that if I try to build twice in succession, the second build fails because the DLL is already signed so signcode chokes. Obviously I can fix this by signing a copy of the DLL in the build, but the problem intrigued me: </p>\n\n<p>Is it possible to \"unsign\" a DLL, and if not, why not...?</p>\n"},{"tags":["python","winapi","pyhook","pythoncom"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":97,"score":2,"question_id":12038608,"title":"Python win32api.mouse_event TypeError","body":"<pre><code>import sys\nimport win32api, win32con\nimport pyHook\nimport pythoncom\n\ndef CursorLeft():\n    win32api.mouse_event(win32con.MOUSEEVENTF_MOVE, -1, 0)\n    win32api.mouse_event(win32con.MOUSEEVENTF_LEFTDOWN, 0, 0)\n    win32api.mouse_event(win32con.MOUSEEVENTF_LEFTUP, 0, 0)\n\ndef Quit():\n    print \"Quitting\"\n    sys.exit()\n\n# create a keyboard hook\ndef OnKeyboardEvent(event):\n    print 'MessageName:', event.MessageName\n    print 'Key:', event.Key\n    if event.Key in ['Numpad2']:\n        CursorLeft()\n    elif event.Key in ['End']:\n        Quit()\n    return True\n\ndef OnMouseEvent(event):\n    print 'Position:', event.Position\n    return True\n\nhm = pyHook.HookManager()\nhm.MouseAll = OnMouseEvent\nhm.HookMouse()\nhm.KeyDown = OnKeyboardEvent\nhm.HookKeyboard()\npythoncom.PumpMessages()\n</code></pre>\n\n<p>The function CursorLeft works fine every other time.  It also works fine without any negative numbers as parameters.  I am completely lost as to why this is happening!</p>\n\n<p>First call, fine.</p>\n\n<p>Second call,</p>\n\n<blockquote>\n  <p>TypeError: an integer is required</p>\n</blockquote>\n\n<p>Third call, fine.</p>\n\n<p>Fourth call,</p>\n\n<blockquote>\n  <p>TypeError: an integer is required.</p>\n</blockquote>\n\n<p>so on and so on.</p>\n\n<p><br><br><br>\n<hr>\n<strike></p>\n\n<h2>Solved</h2>\n\n<pre><code>win32api.mouse_event(win32con.MOUSEEVENTF_MOVE, -1, 0, 0, 0)\n</code></pre>\n\n<p>The last two parameters passed allow the function to behave properly.  I am still not sure as to why and would <strong>still like to know</strong> but at least <strong>it is working now</strong>.\n</strike></p>\n\n<h2>Solved</h2>\n\n<pre><code>return True\n</code></pre>\n\n<p>Very important that the event functions return true.</p>\n"},{"tags":["c++","winapi","networking"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":162,"score":0,"question_id":12007063,"title":"Finding the IP and MAC address of DNS Server and Gateway","body":"<p>Hello I am trying to programmatically(C++) find the Gateway IP and DNS Server IP and their MAC address of a local network. Do you have any suggestions on how to do that? Also is there a way to do it using WinPcap? Code samples would be great.</p>\n"},{"tags":["python","windows","winapi","printing","wmi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":12041648,"title":"Python win32print printer status confusion","body":"<p>I've been using the <a href=\"http://docs.activestate.com/activepython/2.4/pywin32/win32print.html\" rel=\"nofollow\">win32print</a> module for Python to try to get various information about sets of printers, such as driver name, job count, port being used, status, etc. It's been mostly successful, however I am having a lot of trouble making any use of the status code that win32print returns from the API. </p>\n\n<p>I've been using the win32print.GetPrinter method, which returns a PRINTER_INFO_ dictionary, with one mapping being Status. However, it isn't documented what status code corresponds to what printer status. It seems that 0 is idle, 1 is paused, but other than that I'm not sure what it means.</p>\n\n<p>When I looked up values of constants for the windows 32bit API, I found <a href=\"http://doc.pcsoft.fr/en-US/?6510001&amp;name=valeur-des-constantes-api-windows-32-bits&amp;q=Find%20out\" rel=\"nofollow\">this page</a>, but none of the status codes I ever get back seem to match that. Often times, I get a status code like 1052800 (got that one from an Epson printer), which is not on the list from the win32api constants.</p>\n\n<p>I have also tried using WMI modules to do this with even less success.</p>\n\n<p>I would like to get printer status codes for printer out of paper, printer door open, toner low, paper jam, etc. Does anyone have any tips on where to find what these status codes mean, or even a better solution to finding printer status completely?</p>\n\n<p>Thanks!</p>\n"},{"tags":["c#",".net","flash","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":66,"score":0,"question_id":12039932,"title":"Prevent keypressing in another process","body":"<p>I have the next task - prevent flash player from collapsing on Escape key. So in my C# app I want to track Escape key pressing (in the process with the flash app) and prevent it from sending to the flash app. How can I do it? Maybe using windows hook?</p>\n\n<p>UPD: Escape key can be pressed by a user in the flash app. And the task of my app is to block native behaviour (collapsing) for flash player.</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12039772,"title":"listview_insertcolumn","body":"<p>in WM_CREATE message of my main window procedure I do:</p>\n\n<pre><code>hMyList = CreateWindowA(WC_LISTVIEW,TEXT(\"\"),WS_CHILD|WS_VISIBLE|LVS_LIST|LVS_TYPEMASK,XPOS(450),YPOS(20),NWIDTH(200),NHEIGHT(200),hWnd,(HMENU) 9876, hInst, NULL);\n</code></pre>\n\n<p>Then:  </p>\n\n<pre><code>LVCOLUMN column;    \ncolumn.mask = LVCF_TEXT; \ncolumn.pszText = \"Name\";\nSendMessage(hMyList,LVM_INSERTCOLUMN,0,(LPARAM)&amp;column);//returns 0; so everything is fine  \n</code></pre>\n\n<p>But I don't see the column!\n Code works fine wen i try to add an item to a listview,  but I cann't add column. What's wrong?</p>\n"},{"tags":["winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12015200,"title":"ClipCursor succeeds, but effectively does nothing","body":"<p>I'm writing a very simple program to clip the mouse to a specified window.  It runs from the system tray without a visible window.  Because there will be multiple instances of the same window, it uses <code>EnumWindows()</code> to iterate through every top-level window and compare their hwnd with <code>GetForegroundWindow()</code>.  When true, it runs the standard <code>ClipCursor()</code> code.  <code>ClipCursor()</code> returns <code>TRUE</code>, and, I've asserted that the <code>RECT</code> set by <code>GetClipCursor()</code> is the exact same as the <code>RECT</code> passed to <code>ClipCursor()</code>.  Yet, the cursor is free to move anywhere on the screen.</p>\n\n<p>I've checked that the values in the <code>RECT</code> are the exact values of the window, I've compiled the program in release mode and ran it with admin rights, still nothing.  The code below is exactly what runs after we've found the <code>HWND</code> of the <code>GetForegroundWindow()</code>:</p>\n\n<pre><code>// Get the window client area.\nGetClientRect(hwnd, &amp;rc);\n\n// Convert the client area to screen coordinates.\nPOINT pt = { rc.left, rc.top };\nPOINT pt2 = { rc.right, rc.bottom };\nClientToScreen(hwnd, &amp;pt);\nClientToScreen(hwnd, &amp;pt2);\nSetRect(&amp;rc, pt.x, pt.y, pt2.x, pt2.y);\n\nclipped = true;\nClipCursor(&amp;rc);\n\nRECT rect;\nGetClipCursor(&amp;rect);\n\nassert(rect.bottom == rc.bottom);\nassert(rect.left == rc.left);\nassert(rect.right == rc.right);\nassert(rect.top == rc.top);\n</code></pre>\n\n<p>I've removed a lot of the checks because they were getting annoying (I was using <code>MessageBox()</code>'s), but this code is certainly running when it's supposed to.  The cursor just isn't getting clipped, and I can't fathom why.</p>\n"},{"tags":["c#",".net","winapi","sockets","lan"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":110,"score":1,"question_id":12038554,"title":"How can I make two apps find and connect via LAN?","body":"<p>I need to scan the LAN for similar app running and then establish connection between them so I can exchange some commands between them. I code in C#.\nThe only way I've found so far is to generate IP's and ping them... but it'd take too many time. Is there a quicker way?\nMaybe it can be done via WIN_API and then wrapped by C# [DllImport(\"..\")] extern methods?</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12036150,"title":"losing files when using ReadDirectoryChangesW","body":"<p>I'm using ReadDirectoryChangesW to monitor a directory.<br>\nHere's my simple code  </p>\n\n<pre><code> #include &lt;windows.h&gt;\n        #include &lt;stdlib.h&gt;\n        #include &lt;stdio.h&gt;\n        #include &lt;tchar.h&gt;\n        #include &lt;iostream&gt;\n        #include &lt;string&gt;\n        #include &lt;cwctype&gt;\n\n        using namespace std;\n        wstring getname(FILE_NOTIFY_INFORMATION *tmp)\n        {\n            wstring s = L\"\";\n            for (int i = 0;i &lt; tmp-&gt;FileNameLength / 2;i++)\n                s += tmp-&gt;FileName[i];\n            return s;\n        }\n        void _tmain(int argc, TCHAR *argv[])\n        {\n\n            HANDLE hDir; \n            char notify[1024]; \n            DWORD cbBytes,i; \n            char AnsiChar[3]; \n            wchar_t UnicodeChar[2]; \n            LPTSTR path;\n\n            FILE_NOTIFY_INFORMATION *pnotify=(FILE_NOTIFY_INFORMATION *)notify; \n            FILE_NOTIFY_INFORMATION *tmp ; \n\n        //    GetCurrentDirectory(MAX_PATH,path.GetBuffer(MAX_PATH+1));\n            wcout.imbue(locale(\"chs\"));\n            path = argv[1];\n            hDir = CreateFile( path, FILE_LIST_DIRECTORY,\n                FILE_SHARE_READ | \n                FILE_SHARE_WRITE | \n                FILE_SHARE_DELETE, NULL, \n                OPEN_EXISTING, FILE_FLAG_BACKUP_SEMANTICS | \n                FILE_FLAG_OVERLAPPED, NULL); \n            wcout &lt;&lt; L\"===CreateFile complete===\" &lt;&lt; endl;\n            if (hDir == INVALID_HANDLE_VALUE) \n            { \n                wcout &lt;&lt; L\"invalid handle value\" &lt;&lt; endl;       \n                return;\n            } \n            FILE_NOTIFY_INFORMATION buffer[1024];\n            FILE_NOTIFY_INFORMATION *pbuffer;\n            while (TRUE) \n            { \n                wcout &lt;&lt; L\"waiting...\" &lt;&lt; endl;\n                if(ReadDirectoryChangesW(hDir, &amp;buffer, sizeof(buffer),\n                    TRUE, FILE_NOTIFY_CHANGE_FILE_NAME| FILE_NOTIFY_CHANGE_LAST_WRITE, \n                    &amp;cbBytes, NULL, NULL)) \n                { \n                    pbuffer = buffer;\n                    do{\n                        tmp = pbuffer; \n                        switch(tmp-&gt;Action) \n                        { \n                        case FILE_ACTION_ADDED: \n                            wcout &lt;&lt; L\"Directory/File added - \" &lt;&lt; getname(tmp) &lt;&lt; endl;\n                            break; \n                        case FILE_ACTION_REMOVED:\n                            wcout &lt;&lt; L\"Directory/File removed - \" &lt;&lt; getname(tmp) &lt;&lt; endl;\n                            break; \n                        case FILE_ACTION_MODIFIED: \n                            wcout &lt;&lt; L\"Directory/File modfied - \" &lt;&lt; getname(tmp) &lt;&lt; endl;\n                            break; \n                        case FILE_ACTION_RENAMED_OLD_NAME: \n                            wcout &lt;&lt; L\"Directory/File old name - \" &lt;&lt; getname(tmp) &lt;&lt; endl;\n                            break; \n                        case FILE_ACTION_RENAMED_NEW_NAME: \n                            wcout &lt;&lt; L\"Directory/File new name - \" &lt;&lt; getname(tmp) &lt;&lt; endl;\n                            break; \n                        default:\n                            wcout &lt;&lt; L\"unknown action\\n\" &lt;&lt; endl;\n                            break; \n                        }\n                        pbuffer += pbuffer-&gt;NextEntryOffset;\n                    }while(pbuffer-&gt;NextEntryOffset);\n                } else\n                {\n                    wcout &lt;&lt; \"readChangesW failed  now return\" &lt;&lt; endl;\n                    return;\n                }\n            }\n        }\n</code></pre>\n\n<p>It looks fine, however, when I'm adding or deleting a large number of files in my directory, it will not report some of the changes, how can I fix this?</p>\n"},{"tags":["c","winapi","compiler","linker"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":112,"score":0,"question_id":11994075,"title":"hidden routines linked in c program","body":"<p>Hullo,\nWhen one disasembly some win32 exe prog compiled by c compiler it\nshows that some compilers links some 'hidden' routines in it -\ni think even if c program is an empty one and has a 5 bytes or so.</p>\n\n<p>I understand that such 5 bytes is enveloped in PE .exe format but\nwhy to put some routines - it seem not necessary for me and even \nsomewhat annoys me. What is that? Can it be omitted? As i understand\nc program (not speaking about c++ right now which i know has some \ninitial routines) should not need such complementary hidden functions..</p>\n\n<p>Much tnx for answer, maybe even some extended info link, cause this\ntopic interests me much </p>\n\n<p>//edit</p>\n\n<p>ok here it is some disasembly Ive done way back then\n(digital mars and old borland commandline (i have tested also)\nboth make much more code, (and Im specialli interested in bcc32) \nbut they do not include readable names/symbols in such dissassembly \nso i will not post them here</p>\n\n<p>thesse are somewhat readable - but i am not experienced in understending\nwhat it is ;-)</p>\n\n<p><a href=\"https://dl.dropbox.com/u/42887985/prog_devcpp.htm\" rel=\"nofollow\">https://dl.dropbox.com/u/42887985/prog_devcpp.htm</a></p>\n\n<p><a href=\"https://dl.dropbox.com/u/42887985/prog_lcc.htm\" rel=\"nofollow\">https://dl.dropbox.com/u/42887985/prog_lcc.htm</a></p>\n\n<p><a href=\"https://dl.dropbox.com/u/42887985/prog_mingw.htm\" rel=\"nofollow\">https://dl.dropbox.com/u/42887985/prog_mingw.htm</a></p>\n\n<p><a href=\"https://dl.dropbox.com/u/42887985/prog_pelles.htm\" rel=\"nofollow\">https://dl.dropbox.com/u/42887985/prog_pelles.htm</a></p>\n\n<p>some explanatory comments whats that heere? \n(I am afraid maybe there is some c++ sh*t here, I am\ninterested in pure c addons not c++ though,\nbut too tired now to assure that it was compiled in c\nmode, extension of compiled empty-main prog was c\nso I was thinking it will be output in c not c++)</p>\n\n<p>tnx for longer explanations what it is</p>\n"},{"tags":["c","windows","winapi","ras","dial-up"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12036157,"title":"RasDialDlg function, to check the connection status after redial","body":"<p>I used <code>RasDialDlg</code> API to create a dial-up connection. When dial up connection is created successfully its return value is true. when a 777 error occured, and if I press the redial button the connection gets established. In this case how to check whether the connection is successfully established or not after the redial? how to handle whether the connection is created or not after redial? Please help.</p>\n"},{"tags":["winapi","visual-c++","com","api-hook"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":66,"score":4,"question_id":12032828,"title":"CopyItems and MoveItems Crashes on windows-7 64 bit","body":"<p>I am hooking the function i.e IFileOperation::CopyItems to implement File Copy Monitoring. my Code works perfect on windows-7 32 bit machine but it is getting crash on windows-7 64 bit machine please help me , My Code is as below.</p>\n\n<pre><code>PVOID GetInterfaceMethod(PVOID intf, DWORD methodIndex)\n{\n   return *(PVOID*)(*(DWORD*)intf + methodIndex * 4);\n}\n\ntypedef HRESULT (WINAPI  *CopyItemsNext)(IFileOperation * pThis, IUnknown *punkItems,IShellItem *psiDestinationFolder);\nCopyItemsNext Real_CopyItems = NULL;\nCopyItemsNext Actual_CopyItems;\n\n\nHRESULT WINAPI CopyItemsCallback(IFileOperation * pThis, IUnknown *punkItems,IShellItem *psiDestinationFolder)\n{\n\n    MessageBoxW(NULL,L\"CopyItems Function Called\", L\"HookedCopyItemS\", MB_OK);\n    return Real_CopyItems(pThis, punkItems, psiDestinationFolder);\n}\n\n\nHRESULT WINAPI CoCreateInstanceCallback(REFCLSID rclsid, LPUNKNOWN pUnkOuter, DWORD dwClsContext, REFIID riid, LPVOID *ppv)\n{\n       const char *IFileOperation_GUID = \"{3AD05575-8857-4850-9277-11B85BDB8E09}\";\n       char GUIDString[64];\n\n       HRESULT HR = Real_CoCreateInstance(rclsid, pUnkOuter, dwClsContext, riid, ppv);\n\n      sprintf_s(GUIDString,64, \"{%08X-%04X-%04X-%02X%02X-%02X%02X%02X%02X%02X%02X}\\0\",\n      rclsid.Data1, rclsid.Data2, rclsid.Data3,\n      rclsid.Data4[0], rclsid.Data4[1],\n      rclsid.Data4[2], rclsid.Data4[3],\n      rclsid.Data4[4], rclsid.Data4[5],\n      rclsid.Data4[6], rclsid.Data4[7]);\n\nif(strcmp(GUIDString, IFileOperation_GUID) == 0)\n{\n   MessageBoxA(NULL, \"IFileOperation_GUID Found\", GUIDString, MB_OK);\n\n   if(Real_CopyItems == NULL)\n   {\n    Actual_CopyItems = (CopyItemsNext)GetInterfaceMethod(*ppv, 17);\n    MessageBoxA(NULL,\"AFTER GetInterfaceMethod\", \"TEST\", MB_OK);\n\n    if (MH_CreateHook(Actual_CopyItems, &amp;CopyItemsCallback, reinterpret_cast&lt;void**&gt;(&amp;Real_CopyItems)) != MH_OK)\n    {\n        MessageBoxW(NULL, L\"Failed CreateHook Real_CopyItem\", L\"Info!\", MB_ICONWARNING|MB_OK);\n    }\n    if (MH_EnableHook(Actual_CopyItems) != MH_OK)\n    {\n        MessageBoxW(NULL, L\"Failed EnableHook Real_CopyItem\", L\"Info!\", MB_ICONWARNING|MB_OK);\n    }\n  }\n}\nreturn HR;\n}\n\n  //DllMain Function \n  BOOL APIENTRY DllMain(HMODULE hModule, DWORD  ul_reason_for_call, LPVOID lpReserved)\n  {\n     switch (ul_reason_for_call)\n     {\n      case DLL_PROCESS_ATTACH:\n      if (MH_Initialize() != MH_OK)\n      {\n         MessageBoxW(NULL, L\"Failed Initialize\", L\"Info!\", MB_ICONWARNING|MB_OK);    \n      }\n      if (MH_CreateHook(&amp;CoCreateInstance, &amp;CoCreateInstanceCallback, reinterpret_cast&lt;void**&gt;(&amp;Real_CoCreateInstance)) != MH_OK)\n      {\n          MessageBoxW(NULL,L\"Failed MH_CreateHook CoCreateInstance\",L\"Info!\",MB_ICONWARNING|MB_OK);\n      }\n      if (MH_EnableHook(&amp;CoCreateInstance) != MH_OK)\n      {\n          MessageBoxW(NULL,L\"Failed MH_EnableHook StartDocA\",L\"Info!\",MB_ICONWARNING|MB_OK);\n      }\n break;\n\n   case DLL_PROCESS_DETACH:\n   if (MH_Uninitialize() != MH_OK)\n   {               \n   }\n   if (MH_DisableHook(Actual_CopyItems) != MH_OK)\n   {\n   }\n   if (MH_DisableHook(&amp;CoCreateInstance) != MH_OK)\n   {\n   }\n\n   break;\n  }\n return TRUE;\n}\n</code></pre>\n\n<p>while debugging for windows-7 64 bit what i got is , it is crashing inside GetInterfaceMethod () function while returning , please go through it and find the what is wrong with my code plz ..</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":82,"score":0,"question_id":12022380,"title":"Dialog in wrong place","body":"<p>I'm at a loss on this one, not really even sure what code to post.</p>\n\n<p>I have a c++ application. The initial window has an edit control, custom control, and menu. When the user presses F5, a new window open with its own message loop. The new window then opens a DialogBox, and is modal as expected.</p>\n\n<p>The odd part is that the DialogBox seems to be hidden behind the 2nd window. I have to alt-tab to the first window, then alt-tab back to the second window to get to the dialog box. </p>\n\n<p>If I cancel out of the DialogBox, the second window is destroyed (as expected), and a MessageBox is shown (as expected), but that message box seems to be hidden behind the first window. Again, I have to alt-tab twice to get the MessageBox to the forefront, and OK out of it.</p>\n\n<p>Does anyone have any ideas what could cause this odd Pop-Under behavior with both the DialogBox and MessageBox?</p>\n\n<p>Thanks!</p>\n\n<p>Code to create the Dialog Box</p>\n\n<p>INT_PTR ip = DialogBox(GetModuleHandle(NULL), MAKEINTRESOURCE(IDD_AMBIGUOUS), this->hWnd, DlgAmbiguous);</p>\n\n<p>Code for the DlgAmbiguous Proceduels</p>\n\n<pre><code>INT_PTR CALLBACK DlgAmbiguous(HWND hDlg, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    UNREFERENCED_PARAMETER(lParam);\n    switch (message)\n    {\n    case WM_INITDIALOG:\n        {\n            HWND hStaticTerm = GetDlgItem(hDlg, IDC_TERM);\n            SetWindowText(hStaticTerm, lpAmbiguousTerm);\n\n            if (wcscmp(lpAmbiguousTerm, L\"canvas\") == 0)\n            {\n                HWND hComboBox = GetDlgItem(hDlg, IDC_MEANING);\n                SendMessage(hComboBox, CB_ADDSTRING, NULL, reinterpret_cast&lt;LPARAM&gt;(_T(\"Program Window\")));\n                SendMessage(hComboBox, CB_ADDSTRING, NULL, reinterpret_cast&lt;LPARAM&gt;(_T(\"Region in Program Window\")));\n            }\n\n            return (INT_PTR)TRUE;\n        }\n    case WM_COMMAND:\n        if (LOWORD(wParam) == IDOK)\n        {\n            HWND hComboBox = GetDlgItem(hDlg, IDC_MEANING);\n            iAmbiguousResult = SendMessage(hComboBox, CB_GETCURSEL, NULL, NULL);\n            EndDialog(hDlg, iAmbiguousResult + 100);\n            return (iAmbiguousResult == -1) ? FALSE : TRUE;\n        }\n        else if (LOWORD(wParam) == IDCANCEL)\n        {\n            EndDialog(hDlg, DLG_CANCEL);\n            return (INT_PTR)FALSE;\n        }\n        break;\n    }\n    return (INT_PTR)FALSE;\n</code></pre>\n"},{"tags":["python","windows","winapi","pywin32"],"answer_count":4,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":1172,"score":7,"question_id":3192232,"title":"GetWindowRect too small on Windows 7","body":"<p>The actual problem I'm trying to solve is, I want to automatically find out the size of the margins around windows. If you can find a better way, please by all means answer that instead of this.</p>\n\n<p>To do this I decided to take a screenshot of a test window and measure the margins. This is simple enough, as I expect no margins will ever be bright pink, but I admit it's a hack. I use <a href=\"http://msdn.microsoft.com/en-us/library/ms633519%28VS.85%29.aspx\" rel=\"nofollow\">GetWindowRect</a> (<a href=\"http://timgolden.me.uk/pywin32-docs/win32gui__GetWindowRect_meth.html\" rel=\"nofollow\">py</a>) to get the bounding box, and <a href=\"http://www.pythonware.com/library/pil/handbook/imagegrab.htm\" rel=\"nofollow\">PIL</a> to grab a screenshot and crop to the bounding box. The problem is that while the crop operates correctly, the bounding box is <a href=\"http://imgur.com/dgc5E.png\" rel=\"nofollow\">not accurate</a>. The Windows 7 \"Snipping Tool\" gets the <a href=\"http://imgur.com/bON6P.png\" rel=\"nofollow\">correct dimensions</a>. How may I do the same?</p>\n"},{"tags":["c++","visual-c++","winapi","directx-9"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":309,"score":1,"question_id":3799529,"title":"DirectX 9 advanced tutorials C++ ","body":"<p>I don't need tutorials talking about fvf or how to draw a triangle. I need some free tutorials that are about advanced things like meshes shadering.</p>\n"},{"tags":["winapi","visual-c++","application","command-prompt"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":129,"score":0,"question_id":12026608,"title":"Visual C - Win32 APP - how to use system call with system() without opening a command prompt window?","body":"<p>I am new to VC++\nI build a simple Win32 Application via default templet.\nwhen i run it it shows a normal window with a menubar.</p>\n\n<p>I added a system call that does a curl operation in InitInstance function:</p>\n\n<pre><code>BOOL InitInstance(HINSTANCE hInstance, int nCmdShow)\n\n{\n\n   HWND hWnd;\n   hInst = hInstance; // Store instance handle in our global variable\n\n   hWnd = CreateWindow(szWindowClass, szTitle, WS_OVERLAPPEDWINDOW,\n      CW_USEDEFAULT, 0, CW_USEDEFAULT, 0, NULL, NULL, hInstance, NULL);\n   if (!hWnd)\n   {\n      return FALSE;\n   }\n\n   ShowWindow(hWnd, nCmdShow);\n\n   UpdateWindow(hWnd);\n\n   //EDITED THIS WILL CREATE A FILE.HTML\n\n   system(\"curl www.google.co.in &gt; file.html\");\n\n\n   return TRUE;\n}\n</code></pre>\n\n<p>all works fine.</p>\n\n<p>But the problem is when ever i call system it opens in console window.\nI want it to be a hidden process that does not shows that command prompt window..</p>\n\n<p>help me with this.</p>\n"},{"tags":["c++","windows","winapi","access-violation"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12008621,"title":"First-chance exception settings check state in Listview","body":"<p>I'm getting the following error in the output window in Visual Studio:</p>\n\n<p><code>First-chance exception at 0x5d0d47af (msvcr100d.dll) in Program.exe: 0xC0000005: Access violation reading location 0xcccccccc.</code></p>\n\n<p>Each time this code is executed:</p>\n\n<pre><code>const int iItem = ListView_GetItemCount(hListOutput);\n\nLVITEM lvI;\n\nlvI.mask        = LVIF_TEXT | LVIF_GROUPID;\nlvI.iSubItem    = 0;\nlvI.iGroupId    = 101;\nlvI.iItem       = iItem;\nlvI.pszText     = const_cast&lt;LPWSTR&gt;(mystr.c_str());\n\nif (ListView_InsertItem(hListOutput, &amp;lvI) != -1)\n{\n    ListView_SetCheckState(hListOutput, iItem, TRUE);\n}\n</code></pre>\n\n<p>If I comment out the <code>ListView_SetCheckState</code>, I stop getting the access violation.</p>\n\n<p>All items are being inserted and the item check states are being set.<br>\nBut I would like to figure out why I am getting an access violation.</p>\n"},{"tags":["c++","c","windows","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":2036,"score":7,"question_id":4021307,"title":"EnumProcesses() vs CreateToolhelp32Snapshot()","body":"<p>I was wondering if there are any differences - mostly performance wise - between the two Win32 API functions <em>EnumProcesses()</em> and <em>CreateToolhelp32Snapshot()</em> for enumerating all active processes and loaded modules. Or if one is better than the other to use and why.</p>\n"},{"tags":["c++","winapi","unicode","filenames","max-path"],"answer_count":5,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":1398,"score":8,"question_id":341550,"title":"On Windows, when should you use the \"\\\\\\\\?\\\\\" filename prefix?","body":"<p>I came across a c library for opening files given a Unicode filename. Before opening the file, it first converts the filename to a path by prepending \"\\\\?\\\". Is there any reason to do this other than to increase the maximum number of characters allowed in the path, per <a href=\"http://msdn.microsoft.com/en-us/library/aa365247.aspx\" rel=\"nofollow\">this msdn article</a>? </p>\n\n<p>It looks like these \"\\\\?\\\" paths require the Unicode versions of the Windows API and standard library.</p>\n"},{"tags":["winapi","themes","system-tray"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12029043,"title":"What is the best way to get tray area clock visual theme?","body":"<p>System's tray area clock visual theme is <a href=\"http://msdn.microsoft.com/en-us/library/bb773210%28v=VS.85%29.aspx\" rel=\"nofollow\">documented</a> in MSDN, so I suppose Microsoft expects us to be able to use it. I'd like to use it to draw my taskbar band's background, in order to blend better with the tray area. When I try to</p>\n\n<blockquote>\n  <p><a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb759821%28v=vs.85%29.aspx\" rel=\"nofollow\">OpenThemeData</a>(NULL, L\"CLOCK\");</p>\n</blockquote>\n\n<p>It <strong>always fails</strong>. The only way I found to get that theme, is locate the actual clock window, and to request its theme:</p>\n\n<ul>\n<li><p>Use <code>FindWindowEx</code> to  locate a window with <code>Shell_TrayWnd</code> class, then locate its child with class <code>TrayNotifyWnd</code>, then this window's child with <code>TrayClockWClass</code> class.</p></li>\n<li><p>Call OpenThemeData and pass the actual clock's window handle.</p></li>\n</ul>\n\n<p>Obviously, internal Windows window class names are undocumented. Although the method above seems to work, I'd rather use something less fragile.</p>\n\n<p><strong>Question:</strong> Is there any sane way to get tray area's clock visual theme?</p>\n"},{"tags":["winapi","mfc","win32gui"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":287,"score":0,"question_id":8220872,"title":"Getting select all(ctrl-a) to work on a CEdit control","body":"<p>I am trying to implement select all(via ctrl-a) in a CEdit control.  I'm doing this by making a class which inherits CEdit and adding a handler for WM_KEYDOWN like this:</p>\n\n<pre><code>void CEditExtended::OnKeyDown( UINT nChar, UINT nRepCnt, UINT nFlags )\n{   \n  if((nChar == 0x41) &amp;&amp; (GetKeyState(VK_CONTROL) &amp; 0x8000) != 0))\n    SetSel(0, -1);\n\n  CEdit::OnKeyDown(nChar, nRepCnt, nFlags);\n}\n</code></pre>\n\n<p>Looking around on the web, this should work, but it never registers both ctrl and a at the same time, either one or the other.    </p>\n"},{"tags":["c","security","winapi","pipe","uac"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12026971,"title":"Get client user token from named pipe","body":"<p>How to get user token for named pipe client from server side. I have found ImpersonateNamedPipeClient ,but I just want to query some information from it's token like sessionId.(I don't have access to client side code)\n                                       Thanks in advance.</p>\n"},{"tags":["winapi","handle","createfile"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12023136,"title":"WinApi FindFirstFile and the file handle","body":"<p>I got some problem with using FindFirstFile/FindNextFile. As I know it returns a handle but I'm not capable to use it with CreateFileMapping/ReadFile because value of returned handle is different than returned from CreateFile. First question: What's the difference between these two handles and the second: is it possible to convert this handle? My only idea is to get the file name and than use CreateFile.</p>\n\n<p>Regards</p>\n"},{"tags":["c","winapi","com","ole","wininet"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12024363,"title":"Handling GZIP Compression using WININET API's","body":"<p>My Server sends me a JSON data stream which is compressed using GZIP Compression.</p>\n\n<p>When I request this data on the normal IE Browser, I get the data and when I mention the application to open with, The Browser automatically decompresses that data stream and shows me my JSON data.</p>\n\n<p>My C Application is using COM/OLE to embed an IE Browser Instance and I am using WININET for GET/POST operations So here I get the data compressed.</p>\n\n<p>Since its IE Browser Functionality that decompresses the GZIP data automatically in the case of the default IE browser \nHow can I get the data decrypted automatically via WININET in my C Application?</p>\n"},{"tags":["c++","c","visual-studio-2010","winapi","64bit"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":12014085,"title":"CreateThread in 64bit DLL won't work","body":"<p>I have a 32 bit and a 64 bit executable. Both load a DLL that is of the same bit, as in the 64 bit executable loads a 64bit dll. Anyway, the 32 bit DLL works perfectly, it creates a thread and pops a hello world messagebox. The 64bit DLL however, that piece of code never executes. It's like the createthread fails.</p>\n\n<pre><code>    case DLL_PROCESS_ATTACH:\n        myFunc();\n        break;\n    case DLL_THREAD_ATTACH:\n    case DLL_THREAD_DETACH:\n    case DLL_PROCESS_DETACH:\n        break;\n    }\n    return TRUE;\n}\n\nvoid myFunc()\n{\n\n    HANDLE hThread = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)&amp;MyThread, NULL, 0, NULL);\n}\n\nDWORD WINAPI MyThread(LPVOID param)\n{\n    MessageBoxA(0, \"HELLO 64\", 0,0);\n    ExitThread(0);\n}\n</code></pre>\n\n<p>Those are the some  snippets from the DLL. I've googeled and all I can come up with is that it's the stack alignment failing? If that is the reason, how do I properly call CreateThread to make it work? If that isnt the reason, does anyone know what might be wrong? </p>\n\n<p>I'd be outmost grateful for any help, thanks in advance!</p>\n"},{"tags":["delphi","winapi","hook","easyhook"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":175,"score":0,"question_id":12023874,"title":"EasyHook Delphi Sample Project","body":"<p>Could someone point me in the direction of an example \"starter\" project for EasyHook written in Delphi?</p>\n\n<p>(e.g., Header Translation or more)</p>\n\n<p><a href=\"http://easyhook.codeplex.com/\" rel=\"nofollow\">http://easyhook.codeplex.com/</a></p>\n\n<p>Thank You</p>\n"},{"tags":["c++","winapi","ip"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":98,"score":1,"question_id":12021265,"title":"Most simple way to resolve external IP of computer?","body":"<p>How can I resolve the external IP of a computer in C++? The external IP being the address the server sees when you connect to it via HTTP, FTP etc.</p>\n\n<p>No external libraries allowed.</p>\n"},{"tags":["c++","windows","winapi","kernel-programming","power-management"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":114,"score":0,"question_id":12022462,"title":"Installation of power management API hooks on Windows OS using C++","body":"<p>Let me preface this by saying that my original goal was to determine the power state that a Windows OS is entering into before the actual power state kicks in. I asked a similar question on another thread for which I received a bunch of smirks regarding <em>why I need to know this</em>. So without going into lengthy explanation regarding why I need this, let me briefly say that the hardware I have connected to a PC will need this information for its own power management.</p>\n\n<p>At this point I am also trying to avoid writing a device driver so instead I want to try to find a solution from a user mode/local service code.</p>\n\n<p>OK, now back to the matter at hand. Since the Windows OS provides just the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa373247%28v=vs.85%29.aspx\" rel=\"nofollow\">basic power notification</a> that, for instance, won't let me differentiate between rebooting vs. shut-down, or sleep vs. hibernation, I thought to implement a global hook on Windows APIs that initiate these power states (which are <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa373201%28v=vs.85%29.aspx\" rel=\"nofollow\">SetSuspendState</a> for sleep/hibernation and <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa376873%28v=vs.85%29.aspx\" rel=\"nofollow\">InitiateSystemShutdown</a> for rebooting/shut-down.) I also found <a href=\"http://www.codeproject.com/Articles/49319/Easy-way-to-set-up-global-API-hooks\" rel=\"nofollow\">this article</a> that explains how to implement the global API hook with C++/WinAPIs.</p>\n\n<p>So being able to intercept a command for a power event before it happens the idea is to write into the system registry the type of the power event (see POWER_ACTION and SYSTEM_POWER_STATE below) and read it from the user-mode/local service code after it receives the WM_POWERBROADCAST notification.</p>\n\n<p>I've never done global API hooking so before I jump into coding it, I'm asking for advice of professionals on this site -- what do you think, can this work? </p>\n\n<p>Also a couple of technical questions about APIs themselves:</p>\n\n<p><strong>1:</strong> I did some research and it seems like most higher level power APIs on a kernel level boil down to either <em>NtInitiatePowerAction</em> or <em>ZwInitiatePowerAction</em> exported from Ntdll.dll. Both seem to do the same, but the question is, which one should I hook to?</p>\n\n<p><strong>2:</strong> There's a lack of documentation from Microsoft on those kernel level APIs. The only stuff I was able to find is this. Does anyone have any info to add to it?</p>\n\n<pre><code>NTSYSAPI\nNTSTATUS\nNTAPI\nNtInitiatePowerAction(\n    IN POWER_ACTION SystemAction,\n    IN SYSTEM_POWER_STATE MinSystemState,\n    IN ULONG Flags,\n    IN BOOLEAN Asynchronous\n);\n\ntypedef enum _POWER_ACTION {\nPowerActionNone,\nPowerActionReserved,\nPowerActionSleep,\nPowerActionHibernate,\nPowerActionShutdown,\nPowerActionShutdownReset,\nPowerActionShutdownOff\n} POWER_ACTION, *PPOWER_ACTION;\n\ntypedef enum _SYSTEM_POWER_STATE {\nPowerSystemUnspecified = 0,\nPowerSystemWorking,\nPowerSystemSleeping1,\nPowerSystemSleeping2,\nPowerSystemSleeping3,\nPowerSystemHibernate,\nPowerSystemShutdown\n} SYSTEM_POWER_STATE, *PSYSTEM_POWER_STATE;\n\n//Flags seem to be the these ones\nPOWER_ACTION_QUERY_ALLOWED\nPOWER_ACTION_UI_ALLOWED\nPOWER_ACTION_OVERRIDE_APPS\nPOWER_ACTION_LOCK_CONSOLE\nPOWER_ACTION_DISABLE_WAKES\nPOWER_ACTION_CRITICAL\n</code></pre>\n\n<p>Actual values for flags above can be <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa373148%28v=vs.85%29.aspx\" rel=\"nofollow\">these here</a>.</p>\n\n<p><strong>3:</strong> I need this to work under Windows XP SP3 and later OS. It seems like all this stuff is supported since XP, but my concern is those kernel level APIs that don't seem to be mentioned in the official MSDN documentation.</p>\n\n<p>So anyway, I'd appreciate to hear any insight on this? </p>\n"},{"tags":["c#","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12022201,"title":"EN_MAXTEXT message in richtextbox","body":"<p>According to what is written on msdn <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb761684%28v=vs.85%29.aspx\" rel=\"nofollow\">here</a>, I should get EN_MAXTEXT message, when the number of characters to be inserted would exceed the width of the richTextBox, if it does not have the ES_AUTOHSCROLL style.<br>\nBut it does not work for me.</p>\n\n<p>I wrote this code:</p>\n\n<pre><code>    public class myRTB : RichTextBox\n        {\n\n            protected override void WndProc(ref Message m)\n            {\n                if (m.Msg == (WM_REFLECT | WM_COMMAND))\n                {\n                    int code = (int)m.WParam;\n                    code = (code &gt;&gt; 16) &amp; 0xffff;  // convert to hiword   \n                    if (code == EN_MAXTEXT)\n                    {\n                        MessageBox.Show(\"max text\");\n                    }\n                }\n\n                base.WndProc(ref m);\n            }\n\n            public const int WM_USER = 0x400;\n            public const int WM_REFLECT = WM_USER + 0x1C00;\n            public const int WM_COMMAND = 0x111;\n            public const int EN_MAXTEXT = 0x0501;\n\n        }\n</code></pre>\n\n<p>And I used this code to remove the ES_AUTOHSCROLL style:</p>\n\n<pre><code>            private void button1_Click(object sender, EventArgs e)\n            {\n                // get the style\n                IntPtr style = GetWindowLongPtr32(myRTB1.Handle, GWL_STYLE);\n                // remove the ES_AUTOHSCROLL style\n                SetWindowLong32(myRTB1.Handle, GWL_STYLE, (int)style - ES_AUTOHSCROLL);\n            }\n\n            public const int GWL_STYLE = -16;\n            public const int ES_AUTOHSCROLL = 0x0080;\n\n            [DllImport(\"user32.dll\", EntryPoint = \"SetWindowLong\")]\n            private static extern int SetWindowLong32(IntPtr hWnd, int nIndex, int dwNewLong);\n\n            [DllImport(\"user32.dll\", EntryPoint = \"GetWindowLong\")]\n            private static extern IntPtr GetWindowLongPtr32(IntPtr hWnd, int nIndex);\n</code></pre>\n"},{"tags":["winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12015646,"title":"How to resize and move every window on the desktop using win32 so that it doesn't overlap a menu bar on top of the desktop","body":"<p>This is a tricky one. I want to make a program that draws a bar across the top of the desktop. I then want every window that opens up to not draw over this title bar even if a given desktop window is maximized. I remember I saw something similar to this being done but I don't remember the program. I guess those extend taskbar type programs must do something similar to have windows not overlap the extended taskbar on the second monitor. </p>\n\n<p>What framework in windows is require to make this happen? active accessibility to see when windows are created and then somehow get the window handle and resize and position it?</p>\n\n<p>I can iterate through the window list and move them but what about when they open or are maximized?</p>\n\n<p>Any ideas how this behavior is achieved?</p>\n"},{"tags":["c++","winapi","ftp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":12019819,"title":"C++/Win32 The basics of FTP security and using SSL","body":"<p>My application downloads files from an FTP server.</p>\n\n<p>Using a packet sniffer I can see the user name and password easily, I would like to have this avoided.</p>\n\n<p>I can't make an FTP account with limited privileges ATM.</p>\n\n<p>How do I know if the server supports SSL? (Apache 2.x.x)</p>\n\n<p>Any other way to hide user : pass of FTP account?</p>\n"},{"tags":["c++","winapi","synchronization","parallel-processing"],"answer_count":3,"favorite_count":3,"up_vote_count":7,"down_vote_count":0,"view_count":1470,"score":7,"question_id":1470741,"title":"Problem with own Spinlock implementation","body":"<p>I made a very simple spinlock using the Interlocked functions in Windows and tested it on a dual-core CPU (two threads that increment a variable); </p>\n\n<p>The program seems to work OK (it gives the same result every time, which is not the case when no synchronization is used), but <em>Intel Parallel Inspector</em> says that there is a race condition at <em>value += j</em> (see the code below). The warning disappears when using Critical Sections instead of my SpinLock.  </p>\n\n<p>Is my implementation of SpinLock correct or not ? It's really strange, because all the used operations are atomic and have the proper memory barriers and it shouldn't lead to race conditions.</p>\n\n<pre><code>class SpinLock\n{\n   int *lockValue;\n   SpinLock(int *value) : lockValue(value) { }\n\n   void Lock() {\n      while(InterlockedCompareExchange((volatile LONG*)lockValue, 1, 0) != 0) {\n          WaitABit();\n      }\n   }\n\n   void Unlock() { InterlockedExchange((volatile LONG*)lockValue, 0); }\n};\n</code></pre>\n\n<p>The test program:  </p>\n\n<pre><code>static const int THREADS = 2;\nHANDLE completedEvents[THREADS];\nint value = 0;\nint lock = 0; // Global.\n\nDWORD WINAPI TestThread(void *param) {\n    HANDLE completed = (HANDLE)param;\n    SpinLock testLock(&amp;lock);\n\n    for(int i = 0;i &lt; 1000*20; i++) {\n        for(int j = 0;j &lt; 10*10; j++) {\n            // Add something to the variable.\n            testLock.Lock();\n            value += j;\n            testLock.Unlock();\n        }\n    }\n    SetEvent(completed);\n}\n\nint main() {\n   for(int i = 0; i &lt; THREADS; i++) {\n        completedEvents[i] = CreateEvent(NULL, true, false, NULL);\n   }\n   for(int i = 0; i &lt; THREADS; i++) {\n        DWORD id;\n        CreateThread(NULL, 0, TestThread, completedEvents[i], 0, &amp;id);\n   }\n\n   WaitForMultipleObjects(THREADS, completedEvents, true, INFINITE);\n   cout&lt;&lt;value;\n}\n</code></pre>\n"},{"tags":["c++","winapi","visual-c++"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":12019163,"title":"Listen For Process Start and End","body":"<p>I'm new to Windows API programming. I am aware that there are ways to check if a process is already running (via enumeration). However, I was wondering if there was a way to listen for when a process starts and ends (for example, notepad.exe) and then perform some action when the starting or ending of that process has been detected. I assume that one could run a continuous enumeration and check loop for every marginal unit of time, but I was wondering if there was a cleaner solution.</p>\n"},{"tags":["c","winapi","winddk","ddk"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12019562,"title":"DeleteOemInfFiles code displays only the last installed oem file","body":"<p>I used <a href=\"http://nsis.sourceforge.net/InstDrv_plug-in\" rel=\"nofollow\">this link</a> as reference to delete the old oem inf files. And <a href=\"http://pastebin.com/cTY6Pgpr\" rel=\"nofollow\">this is my code for your reference</a>, in this code I get only the last installed oem file. but in my inf directory there are two inf files for my device. How to list both the oem files?</p>\n"},{"tags":["python","winapi","ntfs","win32com","alternate-data-stream"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":112,"score":1,"question_id":12013450,"title":"Alternate Data Streams on a folder","body":"<p>I'm using StgCreateStorageEx from python win32com based adapting the code in <a href=\"http://pywin32.hg.sourceforge.net/hgweb/pywin32/pywin32/file/9f6fdae45eb7/com/win32com/test/testStorage.py\" rel=\"nofollow\">testStorage.py</a> to write my own file_id attribute onto any file.</p>\n\n<p>According to <a href=\"http://www.flexhex.com/docs/articles/alternate-streams.phtml\" rel=\"nofollow\">alternate-streams</a> (though not necessarily from this API call) it should be possible to save to a directory/folder, but changing the flags yield different errors, eg:</p>\n\n<pre><code>from win32com import storagecon\nimport pythoncom, os, win32api\n\nfname = r\"c:\\temp\\test\\test.txt\" #works\nfname = r\"c:\\temp\\test\\test2\"\n\ndef testit():\n    m=storagecon.STGM_READWRITE | storagecon.STGM_SHARE_EXCLUSIVE\n    pss=pythoncom.StgOpenStorageEx(fname, m, storagecon.STGFMT_FILE, 0, pythoncom.IID_IPropertySetStorage)\n</code></pre>\n\n<p>results in:</p>\n\n<blockquote>\n  <p>pywintypes.com_error: (-2147024895, 'Incorrect function.', None, None)</p>\n</blockquote>\n\n<p><strong>EDIT:</strong>\nAny suggestions on how to get this to work from both WinXP, Win7 and Windows Server 2003/R2?</p>\n\n<p>Note that the end result does not necessarily need to use this API, I just need to be able to do it efficiently from Python. By efficiently I mean not through many different technology layers.</p>\n"},{"tags":["c++","winapi","uart"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":162,"score":0,"question_id":12013161,"title":"How to check if WriteFile function is done","body":"<p>I want to check if the WriteFile function is done writing to UART so that i can call ReadFile on the same ComDev without causing an Exception.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa365747%28v=vs.85%29.aspx\" rel=\"nofollow\">WriteFile function</a>\nIt seems the WriteFile function can return before writing is done.</p>\n\n<pre><code>BOOL WriteCommBlock(HANDLE * pComDev, char *pBuffer , int BytesToWrite)\n{\nwhile(fComPortInUse){}\n\nfComPortInUse = 1; \n\nBOOL       bWriteStat   = 0;\nDWORD      BytesWritten = 0;\nCOMSTAT    ComStat      = {0};\nOVERLAPPED osWrite      = {0,0,0};\n\nif(WriteFile(*pComDev,pBuffer,BytesToWrite,&amp;BytesWritten,&amp;osWrite) == FALSE)\n{\n    short Errorcode = GetLastError();\n    if( Errorcode != ERROR_IO_PENDING )\n        short breakpoint = 5; // Error\n\n    Sleep(1000); // complete write operation TBD\n\n    fComPortInUse = 0; \n    return (FALSE);\n}\n\n\nfComPortInUse = 0; \nreturn (TRUE);\n}\n</code></pre>\n\n<p>I used Sleep(1000) as an workaround, but how can i wait for an appropriate time?</p>\n"},{"tags":["winapi","assembly","masm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12014856,"title":"ReadFile() WinApi assembler","body":"<p>I came across a strange problem with ReadFile(). The textfile is opened correctly but it reads only 4 bytes instead of number of bytes declared in MemorySize. The same code in C is executed properly. Somebody knows what's wrong?</p>\n\n<p>Regards</p>\n\n<pre><code>.DATA\nFileName DB \"test.txt\",0\nMemorySize  DWORD 10\n\n.DATA?\nhFile    HANDLE ?\npMemory  DWORD  ?\nSizeR    DWORD  ?\n\n.CODE\nstart:\n\nINVOKE CreateFile, ADDR FileName,\\ \n    GENERIC_READ, 0, NULL,\\\n    OPEN_EXISTING, 0, NULL\nmov hFile, eax\nINVOKE GlobalAlloc, GMEM_FIXED or GMEM_ZEROINIT, MemorySize+1\nmov pMemory, eax\nINVOKE ReadFile, hFile, ADDR pMemory, MemorySize, ADDR SizeR, NULL\nINVOKE MessageBox, 0, ADDR pMemory, 0, 0\nINVOKE LocalFree, pMemory\nINVOKE CloseHandle, hFile\nret\nend start\n</code></pre>\n"},{"tags":["winapi","dialog","webbrowser"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12015468,"title":"Windows App: Embedded Browser on Dialog stopped working","body":"<p>We made two changes at once: upgraded to VS2008 (yeah, well that is still futuristic for us) and switched to an oconfig-based build system.</p>\n\n<p>Between the two of those, something broke the ability of an embedded web browser to work on one of our dialog boxes.  </p>\n\n<p>DIALOG DEFINITION:</p>\n\n<pre>\nID_DIALOG_AGREEMENT DIALOG DISCARDABLE  0, 0, 470, 340\nSTYLE DS_MODALFRAME | WS_POPUP\nFONT 8, \"MS Shell Dlg\"\nBEGIN\n    CONTROL         \"\",ID_CUSTOM_BROWSER,\n                    \"{8856F961-340A-11D0-A96B-00C04FD705A2}\",\n                    WS_TABSTOP | WS_BORDER,\n                    0,0,469,315\n    PUSHBUTTON      \"&Yes\",IDYES,360,321,50,14\n    PUSHBUTTON      \"&No\",IDNO,415,321,50,14\n    RTEXT           \"Do you agree to these terms?\",ID_TEXT_PROMPT,255,324,98,\n                    8,SS_NOPREFIX | NOT WS_GROUP\n    ICON            32514,ID_PIC_ICON,234,318,20,20\nEND\n\n</pre>\n\n<p>DIALOG CREATION:</p>\n\n<pre><code>AtlAxDialogBoxW( instance_, MAKEINTRESOURCEW( ID_DIALOG_AGREEMENT ), dlg, agreementDlgProc, NULL );\n</code></pre>\n\n<p>WM_INITDIALOG HANDLER</p>\n\n<pre><code>  // this returns NULL, so we failed to even create the control\n  ctrl = GetDlgItem( dlg, ID_CUSTOM_BROWSER );\n  GetWindowRect( ctrl, &amp;rect3 );\n  rect3.right -= rect2.right;\n  rect3.bottom -= rect2.bottom;\n  SetWindowPos( ctrl, NULL, 0, 0, rect3.right - rect3.left + 1,\n                rect3.bottom - rect3.top + 1,\n                SWP_NOACTIVATE | SWP_NOMOVE | SWP_NOZORDER );\n  // Configure the browser control to show the agreement\n  IUnknown *iunknown = NULL;\n  if( SUCCEEDED( AtlAxGetControl( ctrl, &amp;iunknown ) ) ) {\n</code></pre>\n\n<p>As per the comment, the closest I can come to a symptom is that GetDlgItem returns null... so nothing works past that.</p>\n\n<p>The exe is dynamically linked to atl90.dll (and complains nicely if you hide that dll)</p>\n\n<p>The dialog itself works fine (buttons are fine, for example).  It just has a big blank area where the browser used to be.</p>\n\n<p>I believe it is compiling in \"MultiThreaded DLL\" mode, though my oconfig fu is too weak to state that with any confidence (it says that in the VS properties for the app).</p>\n\n<hr>\n\n<p>I'm open to suggestions as to where to look for error messages even.  This code worked for years until we 'upgraded' :-)</p>\n"},{"tags":["c++","winapi","screensaver"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":142,"score":2,"question_id":12012318,"title":"c++ WinApi : GetClientRect fails","body":"<p>I am coding a screensaver program running on Windows.  </p>\n\n<p>In preview mode, Windows calls the program this way :<br>\n<code>Screensaver.exe /p ParentWindowHandle</code>  </p>\n\n<p>However, when I make this call in my program :<br>\n<code>BOOL res = GetClientRect(parentWindowHandle, rect)</code><br>\nres is FALSE, rect is NULL and I get <code>ERROR_INVALID_WINDOW_HANDLE</code> with <code>GetLastError()</code></p>\n\n<p><code>GetWindowRect</code> gives me the same results.</p>\n\n<p>But, if I make a call to <code>BOOL res = IsWindow(parentWindowHandle)</code> instead, I get res == TRUE. Does this not mean I have a valid window handle ?</p>\n\n<p>The code looks like this :  </p>\n\n<pre><code>int WINAPI wWinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, PWSTR pCmdLine, int nCmdShow)\n{\n    unsigned int handle = GetHandleFromCommandLine(pCmdLine); // Custom function (tested and approved :) )\n    HWND parentWindowHandle = (HWND) handle;\n    LPRECT rect = NULL;\n    BOOL res = GetClientRect(parentWindowHandle, rect);\n    // here, rect == NULL, res == FALSE and GetLastError() returns ERROR_INVALID_WINDOW_HANDLE\n\n    // ...\n    // ...\n}\n</code></pre>\n"},{"tags":["winapi","com","variant","safearray"],"answer_count":1,"favorite_count":2,"up_vote_count":4,"down_vote_count":1,"view_count":286,"score":3,"question_id":11977806,"title":"How to pass SAFEARRAY to COM object through IDispatch?","body":"<p>i am trying to call a method of COM object, where one of the <strong><em>documented</em></strong> parameters is an <em>\"array of bytes</em>\". The actual declartion depends on the per-language documentation you're looking at:</p>\n\n<ul>\n<li><p>in <strong>C#</strong> language:</p>\n\n<pre><code>byte[] TransformFinalBlock(\n    byte[] inputBuffer,\n    int inputOffset,\n    int inputCount\n)\n</code></pre></li>\n<li><p>in <strong>C++</strong> language;</p>\n\n<pre><code>array&lt;unsigned char&gt;^ TransformFinalBlock(\n    array&lt;unsigned char&gt;^ inputBuffer, \n    int inputOffset, \n    int inputCount\n)\n</code></pre></li>\n<li><p>in <strong>VB</strong> language:</p>\n\n<pre><code>Function TransformFinalBlock ( _\n    inputBuffer As Byte(), _\n    inputOffset As Integer, _\n    inputCount As Integer _\n) As Byte()\n</code></pre></li>\n<li><p>in <strong>F#</strong> language:</p>\n\n<pre><code>abstract TransformFinalBlock : \n        inputBuffer:byte[] * \n        inputOffset:int * \n        inputCount:int -&gt; byte[] \n</code></pre></li>\n</ul>\n\n<p>The object i'm using can also be accessed using <strong>COM</strong>. The object provides an early binding interface, <code>ICryptoTransform</code>, which declares the method as using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms221482%28v=vs.85%29.aspx\" rel=\"nofollow\"><strong><code>SAFEARRAY</code></strong></a>. </p>\n\n<p>From the <strong>type library</strong>:</p>\n\n<ul>\n<li><p>using <strong>IDL</strong> syntax</p>\n\n<pre><code>[\n  odl,\n  uuid(8ABAD867-F515-3CF6-BB62-5F0C88B3BB11),\n  version(1.0),\n  dual,\n  oleautomation,\n  custom(0F21F359-AB84-41E8-9A78-36D110E6D2F9, \"System.Security.Cryptography.ICryptoTransform\")    \n]\ninterface ICryptoTransform : IDispatch {\n   ...\n   [id(0x60020005)]\n   HRESULT TransformFinalBlock(\n                [in] SAFEARRAY(unsigned char) inputBuffer, \n                [in] long inputOffset, \n                [in] long inputCount, \n                [out, retval] SAFEARRAY(unsigned char)* pRetVal);\n};\n</code></pre></li>\n<li><p>using <strong>object Pascal</strong> syntax:</p>\n\n<pre><code>ICryptoTransform = interface(IDispatch)\n     ['{8ABAD867-F515-3CF6-BB62-5F0C88B3BB11}']\n     ...\n     function TransformFinalBlock(inputBuffer: PSafeArray; inputOffset: Integer; inputCount: Integer): PSafeArray; safecall;\nend;\n</code></pre></li>\n</ul>\n\n<p>This means that when using <em>early-binding</em> you must pass the method a <code>SAFEARRAY</code>. The language i use has support for SafeArray APIs, can i can perform the call easily enough:</p>\n\n<pre><code>var\n   inputBuffer: PSafeArray;\n   xform: ICryptoTransform;\n   ...\nbegin\n   ...\n\n   xform.TransformFinalBlock(inputBuffer, ...);\n   ...\nend;\n</code></pre>\n\n<p>Here's the same code in a java-like language:</p>\n\n<pre><code>PSafeArray inputBuffer;\nICryptoTransform xform;\n\n...\n\nxform.TransformFinalBlock(inputBuffer, ...);\n</code></pre>\n\n<p>And everything works <em>fine</em>; but that's not my question.</p>\n\n<blockquote>\n  <p><strong>Note</strong>: i'm trying drive home the point that this is a <strong>language-agnostic</strong> question, as <strong>COM is a language agnostic technology</strong>. But at some point we have to actually <em>use</em> a language that we will demonstrate code in. <a href=\"http://stackoverflow.com/questions/11972829/how-to-call-use-net-rijndaelmanaged-from-native-com\">Some people confuse a language with a technology</a>. If i knew Knuth's invented language, i would have used that.</p>\n</blockquote>\n\n<h2>But what about late-binding <code>IDispatch</code>?</h2>\n\n<p>Now that we know we <em>can</em> pass a <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms221482%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>SAFEARRAY</code></a> to a COM object (when using <strong><em>early-binding</em></strong>), i need to solve the problem of passing an array using <strong><em>late-binding</em></strong>.</p>\n\n<blockquote>\n  <p><strong>Note</strong>: The question of how to pass a SAFEARRAY to a COM object through IDispatch is useful me to in circumstances besides <code>ICryptoTransform</code>. </p>\n  \n  <ul>\n  <li><a href=\"http://stackoverflow.com/questions/489048/net-mshtml-how-to-pass-a-bstr-safearray\">passing an array of <code>BSTR</code> to MSHTML control</a></li>\n  <li><a href=\"http://stackoverflow.com/questions/11972829/how-to-call-use-net-rijndaelmanaged-from-native-com\">passing an array of byte to other COM objects</a></li>\n  </ul>\n</blockquote>\n\n<p>Some languages provide automatic mechanisms to invoke methods through an <code>IDispatch</code> interface at run-time (i.e. <em>late-binding</em>). In fact <code>IDispatch</code> late binding was invented for VBScript:</p>\n\n<pre><code>Dim xform = CreateObject(\"System.Security.Cryptography.SHA256Managed\");\nDim buffer;\no.TransformFinalBlock(buffer, 0, 8);\n</code></pre>\n\n<p>And late-binding compiler auto-magic was added in .NET 4.0:</p>\n\n<pre><code>dynamic xform = Activator.CreateInstance(Type.GetTypeFromProgID(\"System.Security.Cryptography.SHA256Managed\", true));\nxform.TransformFinalBlock(buffer, 0, 8);\n</code></pre>\n\n<p>Late-binding compiler magic also existed in Delphi:</p>\n\n<pre><code>xform: OleVariant;\nbuffer: OleVariant;\nxform.TransformFinalBlock(buffer, 0, 8);\n</code></pre>\n\n<p>i <em>happen</em> to be using Dephi, and this call fails. </p>\n\n<h2>But it's not really compiler magic</h2>\n\n<p>It's not really magic what VBScript, C# dynamic, and Delphi are doing. They're just calling <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms221479%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>IDispatch.Invoke</code></a>:</p>\n\n<pre><code>IDispatch = interface(IUnknown)\n   ['{00020400-0000-0000-C000-000000000046}']\n   function Invoke(DispID: Integer; const IID: TGUID; LocaleID: Integer;\n         Flags: Word; var Params; VarResult, ExcepInfo, ArgErr: Pointer): HResult; stdcall;\nend;\n</code></pre>\n\n<p>The mess is setting up these parameters:</p>\n\n<pre><code>xform.Invoke(\n      1610743820,      //DispID\n      IID_NULL,        //riid (reserved for future use, must be IID_NULL)\n      0,               //locale id (lcid)\n      DISPATCH_METHOD, //flags\n      dispParams,      //Pointer to a DISPPARAMS structure\n      null,            //Pointer to the location where the result is to be stored, or NULL if the caller expects no result\n      exceptInfo,      //Pointer to a structure that contains exception information\n      null);           //This argument can be set to null. \n</code></pre>\n\n<p>The real trick is the <code>dispParams</code> structure, that contains the arguments.</p>\n\n<h2>The argument will be an variant</h2>\n\n<p>The arguments that get passed through DISPPARAMS are all variants:</p>\n\n<pre><code>typedef struct tagDISPPARAMS {\n  VARIANTARG *rgvarg;\n  DISPID     *rgdispidNamedArgs;\n  UINT       cArgs;\n  UINT       cNamedArgs;\n} DISPPARAMS;\n</code></pre>\n\n<p>So no matter what happens, my <em>\"array of bytes\"</em> is going to be a variant.</p>\n\n<p>A <a href=\"http://msdn.microsoft.com/en-us/library/aa908601.aspx\" rel=\"nofollow\"><code>VARIANT</code></a>, in Win32, is simply a union that contains:</p>\n\n<ul>\n<li><code>VARTYPE vt</code>: The type of data in the union.</li>\n<li><p>the appropriate union member, e.g.:</p>\n\n<pre><code>BYTE        bVal;\nIDispatch  *pdispVal;\nSAFEARRAY  *parray;\nBYTE       *pbVal;\nIDispatch  *ppdispVal;\nSAFEARRAY  *pparray;\nVARIANT    *pvarVal;\nPVOID       byref;\nCHAR        cVal;\n</code></pre></li>\n</ul>\n\n<p>Up to now i have been passing a variant of type:</p>\n\n<pre><code>vt = VT_ARRAY | VT_UI1\n</code></pre>\n\n<p>MSDN documents what you must do when you want to use the <strong>parray</strong> union with <code>VT_ARRAY | *</code>:</p>\n\n<blockquote>\n  <p><strong>Value</strong>: <code>VT_ARRAY | &lt;anything&gt;</code></p>\n  \n  <p><strong>Description</strong>: An array of data type  was passed. VT_EMPTY and VT_NULL are invalid types to combine with VT_ARRAY. The pointer in <strong>pbyrefVal</strong> points to an array descriptor, which describes the dimensions, size, and in-memory location of the array.</p>\n</blockquote>\n\n<p>What this means is that using the <strong><code>parray</code></strong> member:</p>\n\n<pre><code>    SAFEARRAY  *parray;\n</code></pre>\n\n<p>You need to set <code>parray</code> member to a pointer to a <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms221482%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>SAFEARRAY</code></a> structure:</p>\n\n<pre><code>typedef struct tagSAFEARRAY {\n  USHORT         cDims;\n  USHORT         fFeatures;\n  ULONG          cbElements;\n  ULONG          cLocks;\n  PVOID          pvData;\n  SAFEARRAYBOUND rgsabound[1];\n} SAFEARRAY, *LPSAFEARRAY;\n</code></pre>\n\n<p>In my case, my <strong><em>array of bytes</em></strong> is actually a <code>SAFEARRAY</code>, which is then being stored in a variant:</p>\n\n<pre><code>VARIANT *inputBuffer;\nSAFEARRAY *safeArray;\n\n//Setup our SAFEARRAY of data\nsafeArray.cDims = 1;\nsafeArray.fFeatures = FADF_HAVEVARTYPE;\nsafeArray.cbElements = 1;\nsafeArray.cbLocks = 0;\nsafeArray.pvData = pMyData;\nsafeArray.rgsabound[0].ElementCount = 1;\nsafeArray.rgsabound[0].LowBound = 0;\n\n//Wrap the safearray in a variant\ninputBuffer.vt = VT_ARRAY | VT_UI1; //$2011\nvt.parray = safeArray;\n</code></pre>\n\n<blockquote>\n  <p><strong>Note</strong>: Of course i'm not crazy enough to have created this safearray myself; i'm using the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms221234%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>SafeArrayCreate</code></a> api function. i'm just demonstrating that it's all knowable, and not magic.</p>\n</blockquote>\n\n<h2>In other words i pass an array variant of bytes</h2>\n\n<p>In other words i <em>am</em> passing an array of bytes, wrapped in a variant, as all calls to:</p>\n\n<pre><code>dispatch.Invoke(...);\n</code></pre>\n\n<p>must be. Except that the <em>late-binding</em> call throws an error:</p>\n\n<pre><code>The parameter is incorrect.\n</code></pre>\n\n<p>So what am i possibly doing wrong?</p>\n\n<p>How does one pass an <strong>array of byte</strong> to a <strong>late-bound</strong> <code>IDispatch</code> call?</p>\n\n<h2>My Question</h2>\n\n<p>How to pass SAFEARRAY to COM object through IDispatch?</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12010825,"title":"LVN_ITEMCHANGING - Distinguish user input","body":"<p>I'm handling the <code>LVN_ITEMCHANGING</code> message, but it gets signaled every time the check state is changed.</p>\n\n<p>I need a way to distinguish between the user changing the check state, and me calling <code>ListView_SetCheckState</code></p>\n\n<p>Is there any easy way to do this? A different message I don't know about maybe? Or does anyone have any suggestions?</p>\n"},{"tags":["c++","multithreading","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":11914659,"title":"C++\\Win32 Running application/thread in low priority mode?","body":"<p>I'm using CreateThread for my threads.</p>\n\n<p>One thread is taking a lot of cpu %, I need to have that reduced.</p>\n\n<p>Yes, I know I can just call Sleep(), but in this case its complicated to implement.</p>\n\n<p>How do I set the thread to run in low priority or if not possible, then how do I run my application in low priority?</p>\n"},{"tags":["winapi","dll","dll-injection"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":97,"score":1,"question_id":12009882,"title":"DLL Injection: Calling a function inside the dll","body":"<p>First of all some parts of the code are from <a href=\"http://stackoverflow.com/questions/10057687/calling-function-in-injected-dll\">Calling function in injected DLL</a> but somewhere it doesn't work.</p>\n\n<p>I have a question regarding DLL Injection: after I loaded the library into another process:</p>\n\n<pre><code>HANDLE InjectDLL(DWORD ProcessID, char *dllName)\n{\n    HANDLE Proc;\n    char buf[50]={0};\n    LPVOID RemoteString, LoadLibAddy;\n\n    if(!ProcessID)\n        return NULL;\n\n    Proc = OpenProcess(CREATE_THREAD_ACCESS, FALSE, ProcessID);\n\n    if(!Proc)\n    {\n        sprintf(buf, \"OpenProcess() failed: %d\", GetLastError());\n        MessageBox(NULL, buf, \"Loader\", NULL);\n        return NULL;\n    }\n\n    LoadLibAddy = (LPVOID)GetProcAddress(GetModuleHandle(\"kernel32.dll\"), \"LoadLibraryA\");\n\n    RemoteString = (LPVOID)VirtualAllocEx(Proc, NULL, strlen(dllName), MEM_RESERVE|MEM_COMMIT, PAGE_READWRITE);\n    WriteProcessMemory(Proc, (LPVOID)RemoteString, dllName, strlen(dllName), NULL);\n    HANDLE hThread = CreateRemoteThread(Proc, NULL, NULL, (LPTHREAD_START_ROUTINE)LoadLibAddy, (LPVOID)RemoteString, NULL, NULL);   \n\n    if( hThread != 0 ) {\n        WaitForSingleObject( hThread, INFINITE );\n        GetExitCodeThread( hThread, ( LPDWORD )&amp;hInjected );\n        CloseHandle( hThread );\n    }\n\n    CloseHandle(Proc);\n\n    return  hThread != 0 ? Proc : NULL;\n}\n</code></pre>\n\n<p>I wanted to call a function from inside that space:</p>\n\n<pre><code>void* GetPayloadExportAddr( LPCSTR lpPath, HMODULE hPayloadBase, LPCSTR lpFunctionName ) \n{\n    // Load payload in our own virtual address space\n    HMODULE hLoaded = LoadLibrary( lpPath );\n\n    if( hLoaded == NULL ) {\n        return NULL;\n    } else {\n        void* lpFunc   = GetProcAddress( hLoaded, lpFunctionName );\n        DWORD dwOffset = (char*)lpFunc - (char*)hLoaded;\n\n        FreeLibrary( hLoaded );\n        return (void*)((DWORD)hPayloadBase + dwOffset);\n    }\n}\n\nBOOL InitPayload( HANDLE hProcess, LPCSTR lpPath, HMODULE hPayloadBase) \n{   \n    void* lpInit = GetPayloadExportAddr( lpPath, hPayloadBase, \"Start\" );\n    if( lpInit == NULL ) {\n        return FALSE;\n    }\n    else {\n        HANDLE hThread = CreateRemoteThread( hProcess, NULL, 0,\n            (LPTHREAD_START_ROUTINE)lpInit, (LPVOID) NULL, 0, NULL );\n\n        if( hThread == NULL ) {\n          return FALSE;\n        } \n        else {\n          CloseHandle( hThread );\n        }\n      }\n    return TRUE;\n}\n</code></pre>\n\n<p>The <code>GetPayloadExportAddr</code> returns the Current Location from IDA (i guess that is the space where my function starts).</p>\n\n<p>So the problem is at the <code>InitPayload</code> function when I try to create the new thread, it fails to do so and I don't know why.</p>\n\n<p>My dll is the following:</p>\n\n<pre><code>extern \"C\"\n{\n    __declspec(dllexport) void* Start(LPVOID param)\n    {\n        MessageBox(NULL, L\"Start\", L\"Hello\", MB_OK);\n        return NULL;\n    }\n}\n\nBOOL APIENTRY DllMain( HMODULE hModule,\n                       DWORD  ul_reason_for_call,\n                       LPVOID lpReserved\n                     )\n{\n    switch (ul_reason_for_call)\n    {\n    case DLL_PROCESS_ATTACH:\n    case DLL_THREAD_ATTACH:\n    case DLL_THREAD_DETACH:\n    case DLL_PROCESS_DETACH:\n        break;\n    }\n    return TRUE;\n}\n</code></pre>\n\n<p>The thing is if I put the Start method at DLL_PROCESS_ATTACH it works, but otherwise it doesn't.</p>\n"},{"tags":["c++","windows","winapi","registry"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":12002949,"title":"C++, parse binary registry file (regf)","body":"<p>I have a question. There is a WinApi function RegSaveKey, which saves a registry key into a binary file. I know that this file can be loaded by RegLoadKey. </p>\n\n<p>But, how can I parse this binary file without that function? Actually, I'm looking not for a complete code, but for description of format of that files. </p>\n\n<p>Again, no need to parse TEXT *.reg files, I want to parse BINARY files like NTUSER.DAT and others at %system32%\\config\\ directory.</p>\n\n<p>UPD: no need to write to registry in that way, only read </p>\n"},{"tags":["windows","winapi","control"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":637,"score":3,"question_id":2129107,"title":"What is a windowless control?","body":"<p>Under Windows their is something called a Windowless Control.</p>\n\n<ul>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/bb787609%28VS.85%29.aspx\" rel=\"nofollow\">RichEdit</a></li>\n</ul>\n\n<p>What is a Windowless Control and what are its benefits?</p>\n"},{"tags":["c++","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":112,"score":0,"question_id":11081064,"title":"File time structure in VC++","body":"<pre><code>typedef struct _FILETIME {\n  DWORD dwLowDateTime;\n  DWORD dwHighDateTime;\n} FILETIME, *PFILETIME;\n</code></pre>\n\n<p>What part of time is stored in low date time and high data time? and how it will be stored in computer and how it will be displayed in 64 bit integer.</p>\n\n<p>For example if I have <code>2012-06-18 09:45:03.180</code>.</p>\n\n<p>I have to substract two file times so I am converting to int64 and subsracting, is this right way do it?</p>\n"},{"tags":["winapi","mingw","mingw32","mingw64","mingw-w64"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":72,"score":-1,"question_id":12001479,"title":"What's the difference between Mingw32 and Mingw64 include files?","body":"<p>I used Mingw32 and devc++ IDE to develop my application. I included the lib files and include files of Mingw32 and compiled my application.</p>\n\n<p>My application should run in both 32 bit and 64 bit versions of windows. My doubt here is whether my application run in windows 64 bit system? Even if it works perfectly will there be any problem?  </p>\n\n<p>What is the difference between Mingw32 and Mingw64 include files? My ultimate aim is to run my   application both in 32-bit and 64-bit windows. What include files should I add and compile?</p>\n"},{"tags":["winapi","visual-c++","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12000458,"title":"How to handle wm_print message in a CWnd (using MFC)?","body":"<p>Is there a way to handle wm_print message in a CWnd (using MFC) ?. I'm trying to intercept this message and prevent printing of a child control. Adding ON_WM_PRINT() to my message map throws compilation errors.</p>\n"},{"tags":["c++","winapi","ipc"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2327,"score":2,"question_id":819710,"title":"DuplicateHandle(), use in first or second process?","body":"<p>The Windows API DuplicateHandle() \n<a href=\"http://msdn.microsoft.com/en-us/library/ms724251\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms724251</a>(VS.85).aspx\nRequires the Object handle to be duplicated and a handle to both the original process AND the other process that you want to use the duplicated handle in.</p>\n\n<p>I am assuming that if I have two UNRELATED processes, I could call DuplicateHandle() in either one so long as I had the required handles available?</p>\n\n<p>My Question is about using a Pipe to communicate between the two processes to achieve this with an Event.</p>\n\n<p>In the first process I CreateEvent(). Now I want to use WaitForSingleObject() in the second process.</p>\n\n<p>If I try to duplicate the handle in the first process, I will need to first send the second process handle to the first process via the pipe, duplicate the handle and then send the handle over to the second process?</p>\n\n<p>Alternativly, I could begin by sending the first process handle and the Event handle to the second process and just duplicate it there.</p>\n\n<p>Is there a reason I should choose one over the other?</p>\n\n<p>To add a wrinkle, the Event handle is actually inherited from the parent process that actually called the first process (which is a CGI application). If that Event handle was created with HANDLE_DO_NOT_DUPLICATE (something like that) then can I in fact use DuplicateHandle() to duplicate it for the second process?</p>\n\n<p>Response:</p>\n\n<p>Well I could create a new NAMED event in the first process and find it in the second process as suggested, but I am trying to DUPLICATE the event that was created in the parent of the first process and foreward it to the second process. This event is not a named event so I need to use DuplicateHandle().</p>\n\n<p>I am using a pipe for the IPC. I am realizing that DuplicateHandle() will have to be called in the first process because the event handle is out of context when sent to the second process.</p>\n\n<pre><code>        hProcPseudo  = GetCurrentProcess() \n\n    //Then call either:\n        lpRealHandle = OpenProcess( PROCESS_DUP_HANDLE, 0, hProcPseudo ) \n//This fails with GetLastError= 87 - The parameter is incorrect ???\n// same thing with PROCESS_ALL_ACCESS ??\n\n\n    //OR\n        lRet = DuplicateHandle( hProcPseudo, hProcPseudo, hProcPseudo, lpRealHandle, DUPLICATE_SAME_ACCESS, 0, 0 )\n\n    //then I can Duplicate my Event Handle in the first thread with:\n        lRet = DuplicateHandle( hLocalProcess, hEvent, lpRealHandle, hDupEvent, DUPLICATE_SAME_ACCESS, 0, 0)\n</code></pre>\n\n<p>The second process converts its handle with DuplicateHandle() detailed above converting</p>\n\n<p>hProcPseudo= 4294967295</p>\n\n<p>to</p>\n\n<p>hProcess= 152</p>\n\n<p>Then I pass this process handle to the first process via the named pipe.\nIn the first process (where the event handle is valid) I call Duplicate handle:</p>\n\n<pre><code>DuplicateHandle( hFirstProcess, hEvent, hSecondProc, hDupEvent, DUPLICATE_SAME_ACCESS, 0, 0)\n</code></pre>\n\n<p>Unfortunatly I get the error:</p>\n\n<p>DuplicateHandle hPipeFCGI GetLastError= 6 - The handle is invalid. </p>\n\n<p>Further testing (substituting hFirstProcess) reveals it is hSecondProc that is invalid!??</p>\n\n<p>Big Mystery.</p>\n"},{"tags":["c#","dll","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":352,"score":1,"question_id":4498651,"title":"Is this possible to write Win32 .dll files by C#.NET?","body":"<p>Is this possible to write Win32 .dll files by C#.NET ?\nIf yes, where i can find some tutorials?\nIf no, so what's your suggestion to write Win32 .DLLs?</p>\n\n<p>Thanks.</p>\n"},{"tags":["winapi","listview","windows-7","windows-vista"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":274,"score":0,"question_id":1742863,"title":"Vista/Win7 Listview \"View Slider\"","body":"<p>In Vista and Windows 7 almost any time the system uses a standard Listview (ie: Explorer Windows) it's accompanied by a little split button that shows a slider when the split is clicked that allows you to switch between the different views available for that listview (Tile, Details, List, etc.) as well as sliding smoothly between icon sizes (from 32x32 is to 256x256) using the top half of the slider. </p>\n\n<p>This is a cool little bit of functionality, so I was wondering: Is that control available to developers, and if so what is it called and where is it documented? (Win32/C++ preferred)</p>\n"},{"tags":["winapi","visual-c++","api-hook"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":11985969,"title":"CopyItems Function Hook crashes","body":"<p>i am trying to hook CopyItems function ,its working fine but when i am trying to call Real CopyItems Function in the Callback function it is getting crash , my code is as below, please help me.</p>\n\n<pre><code> PVOID GetInterfaceMethod(PVOID intf, DWORD methodIndex)\n {\n  return *(PVOID*)(*(DWORD*)intf + methodIndex * 4);\n }\n\ntypedef HRESULT (WINAPI  *CopyItemsNext)(IUnknown *punkItems,IShellItem *psiDestinationFolder);\nCopyItemsNext Real_CopyItems = NULL;\nCopyItemsNext Actual_CopyItems;\n\n\nHRESULT WINAPI CopyItemsCallback(IUnknown *punkItems,IShellItem *psiDestinationFolder)\n{\n\n    MessageBoxW(NULL,L\"CopyItems Function Called\", L\"HookedCopyItemS\", MB_OK);\n    return Real_CopyItems(punkItems, psiDestinationFolder);\n}\n\n\nHRESULT WINAPI CoCreateInstanceCallback(REFCLSID rclsid, LPUNKNOWN pUnkOuter, DWORD dwClsContext, REFIID riid, LPVOID *ppv)\n{\n   const char *IFileOperation_GUID = \"{3AD05575-8857-4850-9277-11B85BDB8E09}\";\n   char GUIDString[64];\n\n   HRESULT HR = Real_CoCreateInstance(rclsid, pUnkOuter, dwClsContext, riid, ppv);\n\n   sprintf_s(GUIDString,64, \"{%08X-%04X-%04X-%02X%02X-%02X%02X%02X%02X%02X%02X}\\0\",\n    rclsid.Data1, rclsid.Data2, rclsid.Data3,\n    rclsid.Data4[0], rclsid.Data4[1],\n    rclsid.Data4[2], rclsid.Data4[3],\n    rclsid.Data4[4], rclsid.Data4[5],\n    rclsid.Data4[6], rclsid.Data4[7]);\n\n   if(strcmp(GUIDString, IFileOperation_GUID) == 0)\n   {\n       MessageBoxA(NULL, \"IFileOperation_GUID Found\", GUIDString, MB_OK);\n\n       if(Real_CopyItems == NULL)\n       {\n        Actual_CopyItems = (CopyItemsNext)GetInterfaceMethod(*ppv, 17);\n        MessageBoxA(NULL,\"AFTER GetInterfaceMethod\", \"TEST\", MB_OK);\n\n        if (MH_CreateHook(Actual_CopyItems, &amp;CopyItemsCallback, reinterpret_cast&lt;void**&gt;(&amp;Real_CopyItems)) != MH_OK)\n        {\n            MessageBoxW(NULL, L\"Failed CreateHook Real_CopyItem\", L\"Info!\", MB_ICONWARNING|MB_OK);\n        }\n        if (MH_EnableHook(Actual_CopyItems) != MH_OK)\n        {\n            MessageBoxW(NULL, L\"Failed EnableHook Real_CopyItem\", L\"Info!\", MB_ICONWARNING|MB_OK);\n        }\n    }\n}\nreturn HR;\n}\n\n//DllMain Function \nBOOL APIENTRY DllMain(HMODULE hModule, DWORD  ul_reason_for_call, LPVOID lpReserved)\n{\nswitch (ul_reason_for_call)\n{\ncase DLL_PROCESS_ATTACH:\n    if (MH_Initialize() != MH_OK)\n    {\n        MessageBoxW(NULL, L\"Failed Initialize\", L\"Info!\", MB_ICONWARNING|MB_OK);    \n    }\n    if (MH_CreateHook(&amp;CoCreateInstance, &amp;CoCreateInstanceCallback, reinterpret_cast&lt;void**&gt;(&amp;Real_CoCreateInstance)) != MH_OK)\n    {\n        MessageBoxW(NULL,L\"Failed MH_CreateHook CoCreateInstance\",L\"Info!\",MB_ICONWARNING|MB_OK);\n    }\n    if (MH_EnableHook(&amp;CoCreateInstance) != MH_OK)\n    {\n        MessageBoxW(NULL,L\"Failed MH_EnableHook StartDocA\",L\"Info!\",MB_ICONWARNING|MB_OK);\n    }\n    break;\n\ncase DLL_PROCESS_DETACH:\n    if (MH_Uninitialize() != MH_OK)\n    {               \n    }\n    if (MH_DisableHook(Actual_CopyItems) != MH_OK)\n    {\n    }\n    if (MH_DisableHook(&amp;CoCreateInstance) != MH_OK)\n    {\n    }\n\n    break;\n}\nreturn TRUE;\n}\n</code></pre>\n\n<p>In the above code inside the CopyItemsCallback function i am displaying Message box just to confirm weather the function is getting hook r not ,so i got that message box after that i am calling Real CopyItems Function but there it is getting crash so please check what is the problem with my code  . </p>\n"},{"tags":["windows","winapi","windows-7","windows-shell","multiple-monitors"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":97,"score":3,"question_id":11348136,"title":"How can I get monitors numbers from Screen Resolution dialog in win7 programmatically?","body":"<p>When you press Identify button in Screen Resolution dialog then Windows shows you big white monitor numbers on each monitor. It was easy to find them programmatically together with monitor coordinates in Windows XP (with EnumDisplayDevices) but on Windows 7 it's broken. How can I do that?</p>\n\n<ol>\n<li>EnumDisplayDevices and GetMonitorInfo are <a href=\"http://windows7forums.com/windows-7-programming-scripting/43596-multi-monitor-display-numbers-unreliable.html?language=ga\" rel=\"nofollow\">not reliable anymore</a> for that purpose in Windows 7.</li>\n<li>I tried GetMonitorInfo and then extracting monitor number from MONITORINFOEX.szDevice (I.E. \\.\\Display2) with no success. Another guy <a href=\"http://social.msdn.microsoft.com/Forums/en/windowsgeneraldevelopmentissues/thread/668e3cf9-4e00-4b40-a6f8-c7d2fc1afd39?prof=required&amp;lc=1033&amp;ppud=4\" rel=\"nofollow\">did that too</a> two years ago and claimed that getMonitorInfo has a bug. <a href=\"http://connect.microsoft.com/VisualStudio/feedback/details/545217/windows-7-getmonitorinfo-returns-wrong-information#\" rel=\"nofollow\">This bug</a> was marked as fixed by Microsoft without any comments but it still can be reproduced on a win7 machine having latest updates. (Btw, can anybody tell me - maybe this bug is absent on win8 ?)</li>\n<li>I tried <a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff569216%28v=vs.85%29.aspx\" rel=\"nofollow\">QueryDisplayConfig</a> from new CCD API but didn't find needed info.</li>\n</ol>\n\n<p>Does anybody know the way?</p>\n"},{"tags":["windows","winapi","windows-services"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":11996700,"title":"How to keep a Win64 C++ console app running like a service as it controls other executables?","body":"<p>I have a series of Win64 console apps, one is the \"master\" and 16 others are the \"slaves\". </p>\n\n<p>The original version of this logic only had one executable, which when launched with a command line parameter \"init\" would initialize a very large data set (3gigs) and then sit on the Windows Message Pump waiting for messages requesting analysis of that large data set. When analysis of the data set is needed, that same executable is launched with analysis requesting parameters, and the newly launched executable would find the Window Handle of the already initialized instance of itself, and send the analysis request and parameters to the already initialized instance via the Windows Message WM_COPYDATA. This works like a charm for a single executable architecture.</p>\n\n<p>However, now I have a more powerful system, and I want to run multiple analysis executables at once, each on a different core. So I made a new architecture where there are 16 analysis executables that act as \"slaves\" to a Manager console application which acts as \"master\". (FYI, one analysis request can take anywhere from 0.5 to 4.0 seconds - hence my desire to run multiples at once.)</p>\n\n<p>Still using the Windows Messages as my communication means, use of SendMessage() blocks the caller until the message is handled by the receiver. That's no good, because I want these messages to be handled concurrently. So, I tried to use the asynchronous Windows Message functions, such as SendMessageCallback() and SendNotifyMessage(). They either failed or executed in a blocking manner, not concurrently. </p>\n\n<p>More research led me to \"Named Shared Memory\" as a means of communicating between my executables (essentially a memory-mapped file). So I set that up, and my master is now able to create the Named Shared Memory block, and all my executables are able to request views of that same memory, and via a state machine handling of the data in the Named Shared Memory, I have synchronization between the master and the slaves.</p>\n\n<p>HOWEVER, I am finding that the master and the slaves do not appear to be running continuously. </p>\n\n<p>I'm still using the basic idea of the master is launched via a command line holding analysis parameters, that executable sends a message to the already running version of itself with the Named Shared Memory setup plus the current state of all the slaves, and then an available slave is selected and it's Named Shared Memory resident state machine gets the analysis request.</p>\n\n<p>This portion is working fine. However, the slave(s) appear to be in a sleep or other dormant state, because my modified Windows Message Loop does not appear to be looping.</p>\n\n<p>Here's what my current Windows Message handling loop looks like:</p>\n\n<pre><code>while (1) {\n    int status = ::GetMessage(&amp;msg, 0, 0, 0);\n    if (status != 0) {\n        if (status == -1) return -1\n        ::DispatchMessage(&amp;msg);\n    } \n    else if (status == 0)\n        break;\n    HandleSharedMemoryDeliveredTasks(); // NOTE: checking Named Shared Memory\n}\n</code></pre>\n\n<p>Placing a break point inside this loop does not get triggered unless a Windows Message is received.</p>\n\n<p>So, I'm wondering how to keep my loop alive so the checking of Named Shared Memory continues without having to send a (blocking) message.</p>\n\n<p>I aware that I'm operating in a problem space where I should convert my master and slave executables into Windows Services. However, I am very, very close to getting this working (it seems), and rewriting to a Windows Service is an area I have no experience. </p>\n\n<p>Also, I am using this in my executables to keep them active (but it does not appear to be helping):</p>\n\n<pre><code>// during program init:\nSetThreadExecutationState(ES_CONTINIOUS | ES_SYSTEM_REQUIRED | ES_AWAYMODE_REQUIRED);\n</code></pre>\n\n<p>Any suggestions how I can \"wake up\" a slave asynchronously when the master sets their state machine for work, and likewise have the slave \"wake up\" the master when the work is completed? </p>\n"},{"tags":["asp.net","windows","winapi","web-applications"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":11998709,"title":"Send Keystrokes to Windows App From Web App","body":"<p>I have a bit of an odd requirement that involves integrating with a legacy windows application via a browser-based application.</p>\n\n<p>What needs to happen is pretty simple, but I'm not sure it's technically possible.  The browser application will need to locate the windows application by its window name, then send a series of keystrokes to it.</p>\n\n<p>I have no control over the windows application (it's third party), so can make no modifications to it.</p>\n\n<p>Forcing the user to use a specific browser is not desirable, but is acceptable if there is no other way.</p>\n\n<p>A macro approach would also be acceptable, but some data would have to come from the web app (maybe via the clipboard)?</p>\n"},{"tags":["c++","windows","visual-studio","winapi","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":71,"score":1,"question_id":11980735,"title":"I want to find out where the focus belongs after EN_KILLFOCUS?","body":"<p>Now I have build my application like this: it runs in the container of Internet browser(IE, FireFox, Chrome and so on). There is a modeless dialog in my program, the dialog contains one CEdit control.</p>\n\n<p>Here is my problem: when user activate the Edit control to type into something, the edit control get the focus. When the edit control loses the focus, I must check whether the input is valid. If not, I will display a model dialog with</p>\n\n<p>AfxMessageBox</p>\n\n<p>. But now I cannot determine whether my edit control loses in my own application. Because the edit control may loses focus by a lot of means, for example, when user close the browser, when user open a text program. In these cases, I will just skip the invalidation check.</p>\n\n<p>Any one can tell me how to find that in which way my edit control loses focus.</p>\n"},{"tags":["c","winapi","struct","unions"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":261,"score":5,"question_id":7376552,"title":"What's the difference between struct { ... } and struct { union { struct { ... } } }?","body":"<p>Is there a reason why <a href=\"http://msdn.microsoft.com/en-us/library/aa363965.aspx\" rel=\"nofollow\"><code>DISK_DETECTION_INFO</code> is defined as</a></p>\n\n<pre><code>typedef struct _DISK_DETECTION_INFO {\n  DWORD          SizeOfDetectInfo;\n  DETECTION_TYPE DetectionType;\n  union {\n    struct {\n      DISK_INT13_INFO    Int13;\n      DISK_EX_INT13_INFO ExInt13;\n    };\n  };\n} DISK_DETECTION_INFO, *PDISK_DETECTION_INFO;\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>typedef struct _DISK_DETECTION_INFO {\n  DWORD          SizeOfDetectInfo;\n  DETECTION_TYPE DetectionType;\n  DISK_INT13_INFO    Int13;\n  DISK_EX_INT13_INFO ExInt13;\n} DISK_DETECTION_INFO, *PDISK_DETECTION_INFO;\n</code></pre>\n\n<p>or am I just overanalyzing this piece of code?</p>\n"},{"tags":["c","winapi","hwnd","ppm","getdibits"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":11991675,"title":"hwnd to ppm issue","body":"<p>I have a function which save a hwnd into a ppm file.\nThis function is inspired by a msdn example.\nBoth the msdn sample and my function work but ... I have an issue ...</p>\n\n<p>But first, here is the function.</p>\n\n<pre><code>int CaptureAnImage(HWND hWnd)\n{\n    HDC hdcWindow;\n    HDC hdcMemDC = NULL;\n    HBITMAP hbmScreen = NULL;\n    RECT rc;\n    BITMAPINFOHEADER   bi;\n\n    DWORD dwBmpSize;\n    HANDLE hDIB;\n    char *lpbitmap;\n    int w, h;\n    FILE *f;\n\n    // Retrieve the handle to a display device context for the client \n    // area of the window. \n    hdcWindow = GetDC(hWnd);\n\n    // Create a compatible DC which is used in a BitBlt from the window DC\n    hdcMemDC = CreateCompatibleDC(hdcWindow); \n    if(!hdcMemDC) {\n        MessageBox(hWnd, \"CreateCompatibleDC has failed\",\"Failed\", MB_OK);\n        goto done;\n    }\n\n    // Get the client area for size calculation\n    GetClientRect(hWnd, &amp;rc);\n    w = rc.right - rc.left;\n    h=rc.bottom-rc.top;\n\n    // Create a compatible bitmap from the Window DC\n    hbmScreen = CreateCompatibleBitmap(hdcWindow, w, h);\n    if(!hbmScreen) {\n        MessageBox(hWnd, \"CreateCompatibleBitmap Failed\",\"Failed\", MB_OK);\n        goto done;\n    }\n\n    // Select the compatible bitmap into the compatible memory DC.\n    SelectObject(hdcMemDC,hbmScreen);\n\n    // Bit block transfer into our compatible memory DC.\n    if(!BitBlt(hdcMemDC, \n               0,0, \n               w, h, \n               hdcWindow, \n               0,0,\n               SRCCOPY)) {\n        MessageBox(hWnd, \"BitBlt has failed\", \"Failed\", MB_OK);\n        goto done;\n    }\n\n    bi.biSize = sizeof(BITMAPINFOHEADER);    \n    bi.biWidth = w;    \n    bi.biHeight = h;  \n    bi.biPlanes = 1;    \n    bi.biBitCount = 24;    \n    bi.biCompression = BI_RGB;    \n\n    bi.biSizeImage = 0;  \n    bi.biXPelsPerMeter = 0;    \n    bi.biYPelsPerMeter = 0;    \n    bi.biClrUsed = 0;    \n    bi.biClrImportant = 0;\n\n    dwBmpSize = w*bi.biBitCount*h;\n\n    // Starting with 32-bit Windows, GlobalAlloc and LocalAlloc are implemented as wrapper functions that \n    // call HeapAlloc using a handle to the process's default heap. Therefore, GlobalAlloc and LocalAlloc \n\n    // have greater overhead than HeapAlloc.\n    hDIB = GlobalAlloc(GHND,dwBmpSize); \n    lpbitmap = (char *)GlobalLock(hDIB);    \n\n    // Gets the \"bits\" from the bitmap and copies them into a buffer \n    // which is pointed to by lpbitmap.\n    GetDIBits(hdcWindow, hbmScreen, 0,\n        (UINT)h,\n        lpbitmap,\n        (BITMAPINFO *)&amp;bi, DIB_RGB_COLORS);\n\n    f = fopen(\"./test.ppm\", \"wb\");\n    if (!f) {\n        fprintf(stderr, \"cannot create ppm file\\n\");\n    goto done;\n    }\n    fprintf(f, \"P6\\n%d %d\\n255\\n\", w, h);\n    fwrite((LPSTR)lpbitmap, dwBmpSize, 1, f);\n    fclose(f);\n\n    //Unlock and Free the DIB from the heap\n    GlobalUnlock(hDIB);    \n    GlobalFree(hDIB);\n\n    //Clean up\ndone:\n    DeleteObject(hbmScreen);\n    DeleteObject(hdcMemDC);\n    ReleaseDC(hWnd,hdcWindow);\n\n    return 0;\n}\n</code></pre>\n\n<p>So here is the resulting image:</p>\n\n<p><a href=\"http://imageshack.us/photo/my-images/853/test2ne.jpg/\" rel=\"nofollow\">http://imageshack.us/photo/my-images/853/test2ne.jpg/</a></p>\n\n<p>As you can see, there is a problem in the width size. Maybe because of the border of the window ?\nIf in the code, I change \"w = rc.right - rc.left;\" into \"w = rc.right - rc.left - 10;\", it's better. But I don't understand why I have to put \"-10\" and ... some pixel are missing on the right of the picture (maybe 10 pixels ?)</p>\n\n<p><a href=\"http://imageshack.us/photo/my-images/207/test3jq.jpg\" rel=\"nofollow\">http://imageshack.us/photo/my-images/207/test3jq.jpg</a></p>\n\n<p>And the last question:\nis there any way to ask to GetDIBits function to put my byte in the inverted order ?\nI don't wand to do a pixel by pixel copy since it will cost some cpu time. (ok, you may say that since I'm saving this file to disk, then I should not be concerned by cpu time, but my goal is not to save this picture to the disk. I'm doing it for debug purpose only)</p>\n\n<p>thanks in advance for any help</p>\n"},{"tags":["c++","c","winapi","unicode","utf-8"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":1015,"score":0,"question_id":4635259,"title":"converting array of bytes to UTF-8 unicode","body":"<p>I have a file saved as UTF-8, and i'm reading it like this:</p>\n\n<pre><code>ReadFile(hFile, pContents, pFile-&gt;nFileSize, &amp;dwRead, NULL);\n</code></pre>\n\n<p>(pContents is a BYTE* of size nFileSize)</p>\n\n<p>its just a small file with 100 bytes or so, contains text which i want to read into memory in wchar_t* format, so i can set the text of edit and static controls with the unicode text. </p>\n\n<p>How can i convert the bytes to UTF-8?</p>\n\n<p>edit (i don't want to use fstream or wfstream)</p>\n"},{"tags":["c++","windows","winapi","service"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":90,"score":2,"question_id":11973228,"title":"Stopping Windows service asynchronously","body":"<p>I am trying to control a service within an application. Starting the service via StartService (<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms686321%28v=vs.85%29.aspx\" rel=\"nofollow\">MSDN</a>) works fine, the service needs about 10 seconds to start, but after calling StartService it gives the control back to the main-application immediately. </p>\n\n<p>However, when stopping the service via ControlService (<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms682110%28v=vs.85%29.aspx\" rel=\"nofollow\">MSDN</a>) - AFAIK there is no StopService - it blocks the main-application for the complete time until the service is stopped, which takes about 10 seconds.</p>\n\n<pre><code>Start: StartServiceW( handle, 0, NULL)\nStop: ControlService( handle, SERVICE_CONTROL_STOP, status )\n</code></pre>\n\n<p>Is there a way for a non-blocking / asynchronously stopping of a windows service?</p>\n"},{"tags":["c","winapi","mingw","mingw32"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":117,"score":0,"question_id":11989048,"title":"LPCTSTR to LPWSTR conversion is not defined in Mingw32 in winnt.h","body":"<p>I am using mingw32, where I cant find type definition of LPCTSTR to LPCWSTR. But the same is defined in  mingw64 as below. </p>\n\n<p><code>typedef LPCWSTR PCTSTR,LPCTSTR;</code></p>\n\n<p>But my code <code>works fine in mingw32</code> without any error even I added <code>LPCTSTR</code> in my code, and if I change the compiler options to mingw64 I am getting  lots of errors.</p>\n\n<p>Winnt.h in mingw32:</p>\n\n<pre><code>typedef TCHAR TBYTE,*PTCH,*PTBYTE;\ntypedef TCHAR *LPTCH,*PTSTR,*LPTSTR,*LP,*PTCHAR;\ntypedef const TCHAR *LPCTSTR;\n</code></pre>\n\n<p>winnt.h in mingw64:</p>\n\n<pre><code>typedef LPWSTR LPTCH,PTCH;\ntypedef LPWSTR PTSTR,LPTSTR;\ntypedef LPCWSTR PCTSTR,LPCTSTR;\ntypedef LPUWSTR PUTSTR,LPUTSTR;\ntypedef LPCUWSTR PCUTSTR,LPCUTSTR;\ntypedef LPWSTR LP;\n</code></pre>\n\n<p>How to solve this? why I am not getting any error in mingw32, with UNICODE defined?</p>\n"},{"tags":["c#","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":11993009,"title":"winapi declaration in c#","body":"<p>Somebody could tell me how to declare winapi in c#?\nI'm having this error:</p>\n\n<pre><code>Error   1   The name 'WinApi' does not exist in the current context bla bla bla...\n</code></pre>\n\n<p>in line:</p>\n\n<pre><code> WinApi.OpenProcess(WinApi.PROCESS_ALL_ACCESS, 0, (uint)aProc[0]);\n</code></pre>\n"},{"tags":["c#",".net","wpf","winapi","pinvoke"],"answer_count":11,"favorite_count":7,"up_vote_count":47,"down_vote_count":0,"view_count":29532,"score":47,"question_id":257587,"title":"Bring a window to the front in WPF","body":"<p>How can I bring my WPF application to the front of the desktop? So far I've tried:</p>\n\n<p><code>SwitchToThisWindow(new WindowInteropHelper(Application.Current.MainWindow).Handle, true);</code></p>\n\n<p><code>SetWindowPos(new WindowInteropHelper(Application.Current.MainWindow).Handle, IntPtr.Zero, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE);</code></p>\n\n<p><code>SetForegroundWindow(new WindowInteropHelper(Application.Current.MainWindow).Handle);</code></p>\n\n<p>None of which are doing the job (<code>Marshal.GetLastWin32Error()</code> is saying these operations completed successfully, and the P/Invoke attributes for each definition do have <code>SetLastError=true</code>).</p>\n\n<p>If I create a new blank WPF application, and call <code>SwitchToThisWindow</code> with a timer, it works exactly as expected, so I'm not sure why it's not working in my original case.</p>\n\n<p><strong>Edit</strong>: I'm doing this in conjunction with a global hotkey.</p>\n"},{"tags":["c#",".net","winapi","selenium","screenshot"],"answer_count":5,"favorite_count":2,"up_vote_count":11,"down_vote_count":0,"view_count":824,"score":11,"question_id":11698222,"title":"Best way to take screenshot of a web page","body":"<p>What is the best way to take screenshot of a web page?\nAt the moment I just start an selenium instance of firefox and using winapi bring it to the front and make a screenshot.\nI ask similar <a href=\"http://stackoverflow.com/questions/11526260/get-window-handle-intptr-from-selenium-webdrivers-current-window-guid\">question</a>  already.</p>\n\n<p>There is two points:</p>\n\n<ul>\n<li>Slowness.</li>\n<li>If any window occurently gets higher than our web browser's window, this window will imprint in our screenshot.</li>\n</ul>\n\n<p>Is there any method to take screenshot more 'programmly'?</p>\n\n<p>Here is some code I use now:</p>\n\n<pre><code>class FirefoxDriverEx : FirefoxDriver\n{\n    public Process GetFirefoxProcess()\n    {\n        var fi = typeof(FirefoxBinary).GetField(\"process\", BindingFlags.NonPublic | BindingFlags.Instance);\n        return fi.GetValue(this.Binary) as Process;\n    }\n}\n</code></pre>\n\n<p>Here is the code illustrating process of taking screenshot itself:</p>\n\n<pre><code>using (FirefoxDriverEx driver = new FirefoxDriverEx())\n{\n    driver.Navigate().GoToUrl(url);\n\n    var process = driver.GetFirefoxProcess();\n\n    if (process != null)\n    {\n        var screenCapture = new ScreenCapture();\n        Win.SetForegroundWindow(process.MainWindowHandle.ToInt32());\n    }\n}\n</code></pre>\n\n<p>Right now, I'm thinking about some manager that will control a queue of windows to take the screenshots from.</p>\n\n<p><em><strong>Question edit.</em></strong></p>\n\n<p>I'm not looking for a solution to just get screenshot 'in memory' and return it back to HTTP stream. So any ways to save screenshot and save it to file and then get it from there is very ambiguous for that purpose.</p>\n\n<p><em><strong>Question edit #2.</em></strong></p>\n\n<p>I forgot to mention. Needed screenshot should be made as it seen by user. So, screenshot should have browser window and a site inside of web browser window's bounds. I can't find any way to change mode of taking a screenshot in WebDriver of selenium. WebDriver just take screenshot of a page without any browser window.</p>\n"},{"tags":["c++","c","winapi","dll"],"answer_count":7,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":1662,"score":4,"question_id":1279292,"title":"How do I create a Win32 DLL without a dependency on the C runtime","body":"<p>Using Visual Studio 2008 and its C/C++ compiler, how do I create a Win32 DLL that is dependent only on other Windows DLLs, and has no dependency on the Microsoft C runtime?</p>\n\n<p>I have some C code I want to place in a DLL that is entirely computation, and makes almost no use of C library functions.</p>\n\n<p>For those it does use (eg memcpy), I'm happy to rework the code to use the Win32 API equivalents (eg CopyMemory).</p>\n"},{"tags":["c","winapi","events","game-engine","quake"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":11989827,"title":"Use of CreateEvent() in Quake","body":"<p>I'm curious about the use of the CreateEvent() function in Quake.</p>\n\n<p>We have the following global in the c file that WinMain() is defined in:</p>\n\n<pre><code>static HANDLE tevent;\n</code></pre>\n\n<p>In the WinMain() function itself, we see this:</p>\n\n<pre><code>tevent = CreateEvent(NULL, FALSE, FALSE, NULL);\n</code></pre>\n\n<p>The game exits if this creation fails.</p>\n\n<p>It then appears in a following function:</p>\n\n<pre><code>void SleepUntilInput (int time)\n{\n    MsgWaitForMultipleObjects (1, &amp;tevent, FALSE, time, QS_ALLINPUT);\n}\n</code></pre>\n\n<p>And finally CloseHandle(tevent) is called in the Quit function.</p>\n\n<p>I'm unfamiliar with WinAPI, so this leaves me with two questions.</p>\n\n<p>-What does this use of CreateEvent() return?</p>\n\n<p>-How does this make the SleepUntilInput() function work properly?</p>\n"},{"tags":["c++","multithreading","winapi"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":713,"score":1,"question_id":5136775,"title":"Increasing MAXIMUM_WAIT_OBJECTS for WaitforMultipleObjects","body":"<p>What is the simplest way to wait for more objects than <code>MAXIMUM_WAIT_OBJECTS</code>? \nMSDN lists this:</p>\n\n<ul>\n<li>Create a thread to wait on <code>MAXIMUM_WAIT_OBJECTS</code> handles, then wait on that thread plus the other handles. Use this technique to break the handles into groups of <code>MAXIMUM_WAIT_OBJECTS</code>.</li>\n<li>Call <code>RegisterWaitForSingleObject</code> to wait on each handle. A wait thread from the thread pool waits on <code>MAXIMUM_WAIT_OBJECTS</code> registered objects and assigns a worker thread after the object is signaled or the time-out interval expires.</li>\n</ul>\n\n<p>But neither are them are very clear.  The situation would be waiting for an array of over a thousand handles to threads.</p>\n"},{"tags":["c++","winapi","windows-xp","monitor","lcd"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":1,"view_count":96,"score":3,"question_id":11943099,"title":"How to get the type of connected monitor(s) on Windows XP?","body":"<p>I need to know the type of the monitor(s) -- i.e. flat screen, CRT, etc -- that is used by the computer from a C++ program. The main requirement is for this code to work on Windows XP SP3 (because otherwise it's almost a given that the system runs on an LCD screen.)</p>\n\n<p>I need it to implement screen dimming to save energy, which will work only on CRTs and have an opposite effect on flat screens.</p>\n\n<p>Any idea how to do this?</p>\n"},{"tags":["windows","winapi"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":11982387,"title":"How to pass a Window Handle to a sub-process?","body":"<p>I am working on a special project with an unusual design.</p>\n\n<p>In my application/process, I will create a sub process to do some work. In my process, I need to get the feedback from sub process. I want to pass the Windows handle of my application/process to this sub process, so I am post message from this sub process.</p>\n\n<p>How can I pass Window Handle to sub process? My sub process is an command line application without Window UI and with the main function like this:</p>\n\n<pre><code>int APIENTRY _tWinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance,\n                   LPTSTR lpCmdLine, int nCmdShow)\n</code></pre>\n\n<p>Should I pass Window Handle to the main function? How?</p>\n\n<p>Thanks</p>\n"},{"tags":["c","winapi","file-io","webdav"],"answer_count":1,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":105,"score":6,"question_id":11984932,"title":"Read as need, how to read first 256 bytes from online large file without downloading?","body":"<p>I need to read just first 256 B from large file, from mapped WebDAV drive.</p>\n\n<p>I open file with</p>\n\n<pre><code>h_second = CreateFileA(second_server, GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, FILE_FLAG_SEQUENTIAL_SCAN, NULL);\n</code></pre>\n\n<p>but it first downloads whole file, and after that can I read it. And I want something, that downloads just a small part of file and I read that.</p>\n\n<p>Can anyone help me?</p>\n"},{"tags":["c","windows","winapi","stack"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":195,"score":3,"question_id":8683335,"title":"How can we poll the stack status - unused (available) memory","body":"<p>How can we get this information? I guess it is OS dependent, and I'm running Windows so my question refers to the windows API.</p>\n\n<p>Is there any function that can do that for us - get the remaining stack memory for the calling thread?</p>\n\n<p>Alternatively, if we could find out the following details, we will be able to calculate that on our own:</p>\n\n<ol>\n<li><em>Get the thread stack base address</em>. There must be some function that takes a thread identifier as a parameter, and returns some information about it (Such as... Stack base address?)</li>\n<li><em>Get the thread stack size</em>. If the thread was started by us, we can know it (Since we specified it when calling <code>CreateThread</code>). But if it is the main thread, which was started by the OS for our program, or any other thread we did not start explicitly, how do we find it?</li>\n<li><em>Get the current stack pointer</em>. Well, that's easier. we can either check it with <code>esp</code>, or take the address of a local variable, to get a close location.</li>\n</ol>\n\n<p>This is for educational purposes, but I guess it could be used to stop a recursive algorithm from causing a stack overflow - Instead of using any max-depth limiting function.</p>\n"},{"tags":["c","winapi","dll","linker"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":11983352,"title":"Run time linking for APIs and \"-ldllname\" compiler option","body":"<p>I used <code>Loadlibrary</code> and <code>Getprocaddress</code> to link some of the WinApis for runtime linking. It works fine, as expected.</p>\n\n<p>But for some Apis I just used <code>-ldllname</code> as the compiler option. The same option gives linker error for some APIs, and needs the dll to be loaded.</p>\n\n<p>Is there any particular difference in this, that is some particular APIs need runtime linking and other APIs will work with <code>-ldllname</code> option?? How to clasify APIs of these kind?</p>\n\n<blockquote>\n  <p>Update: What I observed is the APIs supporting UNICODE and ANSI i.e.,\n  The API which is suffixed with \"W\" and \"A\" , get resolved with static\n  linking itself? Am I correct? Correct me if I am wrong!</p>\n  \n  <p>why some APIs need Run time linking and others get resolved with Static\n  linking itself(-l option)? Any reason for this?</p>\n</blockquote>\n"}]}
{"total":13828,"page":16,"pagesize":100,"questions":[{"tags":["c#","winapi","file-io","process"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":84,"score":1,"question_id":11980494,"title":"free a file used by others process in c#","body":"<p>I would like in a software to log:\nwhich processes are accessing a file\nand\nhow to force free file from access by others processes (is it possible with API window?)\nnotice that you are enable to open a file with notepad and delete this file in disk without kill notepad.but for other program like word excel it is not possible. so there some program that lock resource other no.It means you can free but how? secondly it is possible that for some process they crash when you free but in my case it was only custom services that access those files \nThank you</p>\n"},{"tags":["winapi","assembly","masm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":11980300,"title":"Assembler + WinApi MapViewOfFile","body":"<p>I ve got a little problem with using MapViewOfFile. This function returns the starting address of the mapped view so as I think it's a sequence of bytes. And this is where I ve stacked: </p>\n\n<pre><code>INVOKE MapViewOfFile, hMapFile, FILE_MAP_READ, 0, 0, 0\nmov pMemory, eax\nmov edx, DWORD PTR [pMemory]\n</code></pre>\n\n<p>The pointer is correct cause during saving as a whole block of memory to file, everything is fine. So my question is: how to refer to every single elements(bytes).</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["winapi","windows-8","startmenu"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":343,"score":2,"question_id":11980917,"title":"Can I create/update Windows 8 Start menu tiles from my WinApi application?","body":"<p>I have a regular Windows API (<em>not metro</em>) application that I would like to have a live (periodically updating) Start Menu tile on Windows 8, instead of a static start menu shortcut.</p>\n\n<p>I tried to navigate the MSDN maze related to this topic, but it appears to come with the assumption that I'm building a Metro app. I don't need a Metro application, I just would like to push some information into a tile that when clicked will still execute my regular WinApi application.</p>\n\n<p>If these APIs are not available in WinAPI, what is the smallest \"glue\" that can be used for this purpose? E.g. can I have some minimal HTML + Javascript Metro component that will access my application via COM and just craft the needed text + images for the tile? </p>\n"},{"tags":["c++","windows","winapi","shell-extension"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":11975655,"title":"How to check total number ShellIconOverLayIdentifers installed in a computer using C++","body":"<p>I need to check the total number ShellIconOverLayIdentifers installed in a computer  programmatically using C++ and win32 API.</p>\n\n<p>Can I check the identifiers under the below path to get the total count?</p>\n\n<pre><code>HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\explorer\\ShellIconOverlayIdentifiers\n</code></pre>\n"},{"tags":["windows","winapi","file-io","ntfs"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":11975768,"title":"Is there anyway to do an asynchronous FindNextFile?","body":"<p>On a large folder (~300,000 objects) FindNextFile can take up to 20 secs to respond with just a single file. I assume there's some bulk operation going on in the background but it makes the operation very difficult to cancel.</p>\n\n<p>Is there a way to run FindNextFile in an asynchronous mode so that it can be cancelled if the information is no longer required?</p>\n\n<p>Win7, x64, NTFS.</p>\n\n<p>Side note: Once the information has been cached by Windows FindNextFile doesn't appear to have this issue. It's only on the first time it tries to enumerate files in a large folder.</p>\n"},{"tags":["c++","winapi","midi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":11946016,"title":"midiOutShortMsg and midiOutSetVolume with output in stereo","body":"<p>I'm writing C++ code to output midi messages. I need this to work in stereo, so that some notes are played through the left channel/speaker, others through the right. If I call midiOutSetVolume(midiOutHandle, 0xFFFF) followed by several calls to midiOutShortMsg, with each call separated by a few hundred milliseconds, the notes come through the left speaker. Likewise if I first call midiOutSetVolume(midiOutHandle, 0xFFFF0000) before the calls to midiOutShortMsg everything comes out the right speaker. However if I attempt to simultaneously output one note through the left speaker and one through the right by doing the following:</p>\n\n<pre><code>midiOutSetVolume(midiOutHandle, 0xFFFF);\nmidiOutShortMsg(...);\nmidiOutSetVolume(midiOutHandle, 0xFFFF0000);\nmidiOutShortMsg(...);\n</code></pre>\n\n<p>Both notes simply come out the right speaker. I thought if I perhaps had 2 separate handles to the device I could set one to play the left channel notes, the other the right. However if I try and open 2 handles to the same device via 2 calls to midiOutOpen I get an MMSYSERR_ALLOCATED error on the second call.</p>\n\n<p>Any advice much appreciated.</p>\n"},{"tags":["c++","winapi","sockets","winsock"],"answer_count":3,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":739,"score":3,"question_id":3255899,"title":"Why are there WSA pendants for socket(), connect(), send() and so on, but not for closesocket()?","body":"<p>I'm going to try to explain what I mean using a few examples:</p>\n\n<ul>\n<li>socket() -> WSASocket()</li>\n<li>connect() -> WSAConnect()</li>\n<li>send() -> WSASend()</li>\n<li>sendto() -> WSASendTo()</li>\n<li>recv() -> WSARecv()</li>\n<li>recvfrom() -> WSARecvFrom()</li>\n<li>...</li>\n<li>closesocket() -> WSA???()</li>\n</ul>\n\n<p>This is nothing that matters much, but is still something that gives me a splitting headache.</p>\n"},{"tags":[".net","winapi","com","rijndael"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":130,"score":2,"question_id":11972829,"title":"How to call use .NET RijndaelManaged from native COM?","body":"<p>Can anyone give example usage for using <a href=\"http://msdn.microsoft.com/en-us/library/system.security.cryptography.rijndaelmanaged.aspx\" rel=\"nofollow\"><code>System.Security.Cryptography.RijndaelManaged</code></a> from native Win32 using COM?</p>\n\n<hr>\n\n<p>Here is a functional example of how to use .NET's <a href=\"http://msdn.microsoft.com/en-us/library/system.security.cryptography.sha256managed.aspx\" rel=\"nofollow\"><code>System.Security.Cryptography.SHA256Managed</code></a> </p>\n\n<blockquote>\n  <p><strong>Note</strong>: This is an example of how to call SHA256Managed, and <strong>not</strong> RijndaelManaged**. i show this code to introduce some of the tricky concepts of calling COM objects with early and late-binding, and to show that calling .NET objects with COM Callable Wrappers <em>is</em> possible. Some people might throw up that hands when hearing i want to mix .NET and Win32 COM.</p>\n</blockquote>\n\n<p><strong>Note:</strong> The language is Delphi (which is what i wrote and tested it in), but transcoded to make it look slightly more like C# or Java, so the question is more accessible to a wider audience:</p>\n\n<pre><code>public static string HashStr256(String szPlaintext)\n{\n   OleVariant sha = CreateOleObject('System.Security.Cryptography.SHA256Managed');\n\n   OleVariant inputBuffer = VarByteArrayOf(szPlaintext);\n\n   Integer l = VarArrayLowBound(inputBuffer, 1);\n   Integer h = VarArrayHighBound(inputBuffer, 1);\n\n   ICryptoTransform crypto = IDispatch(sha) as ICryptoTransform;\n   crypto.TransformFinalBlock(\n         PSafeArray(TVarData(inputBuffer).VArray), //inputArray,\n         l,  //input array offset\n         h-l+1); //input array count\n\n   OleVariant digest := sha.Hash;\n\n   Result := ToBase64String(BytesOfVarByteArray(digest));\nend;\n</code></pre>\n\n<p>With the helper function:</p>\n\n<pre><code>function VarByteArrayOf(const s: string): OleVariant;\nvar\n    Data: Pointer;\nbegin\n    //Create variant byte array to hold the bytes\n    Result := VarArrayCreate([0, Length(s)-1], varByte);\n\n    //Copy from Delphi array to Variant Array\n    if Length(s) &gt; 0 then\n    begin\n        Data := VarArrayLock(Result);\n        try\n            System.Move(s[1], Data^, Length(s));\n        finally\n            VarArrayUnlock(Result);\n        end;\n    end;\nend;\n</code></pre>\n\n<p>The real reason i show code calling <code>SHA256Managed</code> is to demonstrate the difficulties i'm encountering when passing <code>arrays</code> to COM in Delphi. For example, if you simply relied on <code>IDispatch</code> late binding:</p>\n\n<pre><code>sha: OleVariant;\ninputBuffer: OleVariant;\n...\nsha.TransformFinalBlock(inputBuffer, i, count);\n</code></pre>\n\n<p>Then at runtime you get <em>The parameter is incorrect</em>; something about <code>IDispatch</code> late binding doesn't support passing an <code>OleVariant</code> that is an array of bytes.</p>\n\n<p>That's why i have to instead pass the <code>safearray</code> that is inside the <code>OleVariant</code>. As we all know a <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms221627%28v=vs.85%29.aspx\" rel=\"nofollow\"><strong>Variant</strong></a> is just a <a href=\"http://docwiki.embarcadero.com/Libraries/en/System.TVarData\" rel=\"nofollow\">union structure</a>, where we care about the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms221482%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>SAFEARRAY</code></a> member:</p>\n\n<pre><code>data: PSafeArray;\n\ndata := PSafeArray(TVarData(inputBuffer).VArray);\nsha.TransformFinalBlock(data, i, count);\n</code></pre>\n\n<p>Except trying to pass a <code>PSafeArray</code> using <code>IDispatch</code> late-binding causes Delphi to throw-up:</p>\n\n<blockquote>\n  <p>Type not allowed in OLE Automation call</p>\n</blockquote>\n\n<p>Which is why we're forced to partially abandon <code>IDispatch</code> late binding for <code>ICryptoTransform</code> early binding:</p>\n\n<pre><code>ICryptoTransform_Native = interface(IDispatch)\n   ['{8ABAD867-F515-3CF6-BB62-5F0C88B3BB11}']\n   ...\n   function TransformFinalBlock(inputBuffer: PSafeArray; inputOffset: Integer; inputCount: Integer): PSafeArray; safecall;\n   ...\nend;\n</code></pre>\n\n<p>with</p>\n\n<pre><code>crypto: ICryptoTransform;\nsha: OleVariant;\ninputBuffer: OleVariant;\n\ncrypto = IDispatch(sha) as ICryptoTransform;\ncrypto.TransformFinalBlock(\n         PSafeArray(TVarData(inputBuffer).VArray), //inputArray,\n         i, n);\n</code></pre>\n\n<p>So that should be it, right? We've solved how to pass arrays to COM .NET objects? i should be all set to use <code>Rijndael</code> now; use early-binding with <code>PSafeArray</code>. </p>\n\n<p>This is what we want to try with late-binding:</p>\n\n<pre><code>OleVariant aes := CreateOleObject('System.Security.Cryptography.RijndaelManaged');\n\nOleVariant keyBytes = VarByteArrayOf(Key);\naes.Key := key;\n</code></pre>\n\n<p>that fails for the same reason above - you cannot passed <code>OleVariant</code> arrays to COM objects (The parameter is incorrect). </p>\n\n<p>So we we should just use the early binding of <a href=\"http://msdn.microsoft.com/en-us/library/system.security.cryptography.symmetricalgorithm.key.aspx\" rel=\"nofollow\"><code>SymmetricAlgorithm.Key</code></a> and pass the <code>Key</code> as a <code>PSafeArray</code>:</p>\n\n<pre><code>var\n   symmetric: ISymmetricAlgorithm;\n   aes: OleVariant;\n   keyBytes: OleVariant;\nbegin\n   aes := CreateOleObject('System.Security.Cryptography.RijndaelManaged');\n\n   symmetric:= (IDispatch(aes) as ISymmetricAlgorithm;\n   symmetric.Key := PSafeArray(TVarData(inputBuffer).VArray);\n   ...\nend;\n</code></pre>\n\n<p>Except there is no <a href=\"http://msdn.microsoft.com/en-us/library/system.security.cryptography.isymmetricalgorithm.aspx\" rel=\"nofollow\"><code>ISymmetricAlgorithm</code></a> interface; i made it up.</p>\n\n<p>If you import the type library from <code>mscorelib.tlb</code>, which contains <code>ICryptoTransform</code>, there is no early binding <code>ISymmetricAlgorithm</code>. There <em>is</em> a <em>late-bound</em> <code>ISymmetricAlgorithm</code>:</p>\n\n<pre><code>IID__SymmetricAlgorithm: TGUID = '{05BC0E38-7136-3825-9E34-26C1CF2142C9}';\nCLASS_SymmetricAlgorithm: TGUID = '{5B67EA6B-D85D-3F48-86D2-8581DB230C43}';\n_SymmetricAlgorithm = interface;\nSymmetricAlgorithm = _SymmetricAlgorithm;\n\n_SymmetricAlgorithm = interface(IDispatch)\n   ['{05BC0E38-7136-3825-9E34-26C1CF2142C9}']\nend;\n_SymmetricAlgorithmDisp = dispinterface\n   ['{05BC0E38-7136-3825-9E34-26C1CF2142C9}']\nend;\n</code></pre>\n\n<p>So how can i set the <strong>RijndaelManaged</strong> <code>Key</code> and <code>IV</code> from native Win32 COM? What late-binding syntax can i use?</p>\n\n<p>How to call use .NET RijndaelManaged from native COM?</p>\n\n<h2>Further Attempts</h2>\n\n<p>Since there is no early-bound <code>interface</code> i can use, i have to focus on how to pass a byte array through <code>IDispatch</code>. The secret is what should be in the <code>Variant</code> that i pass to the COM object.</p>\n\n<p>Since the early-bound version used <code>safearrays</code>, i'll start with that. First of all i will <em>manually</em> set <code>OleVariant</code> structure myself. </p>\n\n<p>For each of the following attempts the following is true:</p>\n\n<pre><code>key: OleVariant;\ndata: PSafeArray;\n\ndata := PSafeArray(TVarData(keyBytes).VArray);\n</code></pre>\n\n<p>setting the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms221170.aspx\" rel=\"nofollow\">variant enum myself</a>.</p>\n\n<ul>\n<li><p><strong>Attempt 1</strong>: <code>VT_ARRAY</code> <em>A SAFEARRAY pointer.</em></p>\n\n<pre><code>TVarData(key).VType := VT_ARRAY;\nTVarData(key).VArray := data;\n</code></pre></li>\n<li><p><strong>Attempt 2</strong>: <code>VT_ARRAY</code> <em>A SAFEARRAY pointer.</em></p>\n\n<pre><code>TVarData(key).VType := VT_ARRAY or VT_I1;\nTVarData(key).VArray := data;\n</code></pre></li>\n<li><p><strong>Attempt 3</strong>: <code>VT_SAFEARRAY</code> *A safe array. Use VT_ARRAY in VARIANT.*</p>\n\n<pre><code>TVarData(key).VType := VT_SAFEARRAY or VT_I1;\nTVarData(key).VArray := data;\n</code></pre></li>\n<li><p><strong>Attempt 4</strong>: <code>VT_SAFEARRAY</code> *A safe array. Use VT_ARRAY in VARIANT.*</p>\n\n<pre><code>TVarData(key).VType := VT_SAFEARRAY;\nTVarData(key).VArray := data;\n</code></pre></li>\n</ul>\n\n<p>All of them fail with a <code>The parameter is incorrect</code> error.</p>\n\n<p>Get i get the sense that <code>VT_ARRAY</code> (a safearray) and <code>VT_SAFEARRAY</code> (a safearray) are just not what the COM Callable wrapper IDispatch interface is prepared to accept. Perhaps it needs to be <code>VT_CARRAY</code>.</p>\n\n<p>Or maybe not. Maybe someone smarter than me can figure it out.</p>\n\n<h2>Bonus Reading</h2>\n\n<p>This is, essentially, a re-phrasing of a question i asked in 2008 on the Borland Newsgroups</p>\n\n<blockquote>\n  <p><a href=\"http://www.delphigroups.info/2/10/1029333.html\" rel=\"nofollow\">Delphi compiler has built-in knowledge of COM SafeArrays?</a></p>\n</blockquote>\n\n<ul>\n<li><a href=\"http://stackoverflow.com/questions/489048/net-mshtml-how-to-pass-a-bstr-safearray\">.NET mshtml: How to pass a BSTR SAFEARRAY?</a></li>\n</ul>\n"},{"tags":["c++","wcf","winapi","named-pipes"],"answer_count":0,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":222,"score":2,"question_id":11767072,"title":"How do I call a WCF method from c++ using Named pipes?","body":"<p>UPDATE:\nLooking through the protocol <a href=\"http://msdn.microsoft.com/en-us/library/cc219293%28v=PROT.10%29.aspx\" rel=\"nofollow\">here</a>, I can't figure out what goes into the Unsized Envelope Record. I can't find any examples online.</p>\n\n<p>ORIGINAL: </p>\n\n<p>I have the following WCF service</p>\n\n<pre><code>    static void Main(string[] args)\n    {\n        var inst = new PlusFiver();\n        using (ServiceHost host = new ServiceHost(inst,\n            new Uri[] { new Uri(\"net.pipe://localhost\") }))\n        {\n            host.AddServiceEndpoint(typeof(IPlusFive), new NetNamedPipeBinding(NetNamedPipeSecurityMode.None), \"PipePlusFive\");\n            host.Open();\n            Console.WriteLine(\"Service is Available. Press enter to exit.\");\n            Console.ReadLine();\n            host.Close();\n        }\n    }\n\n   [ServiceContract]\n   public interface IPlusFive\n   {\n       [OperationContract]\n       int PlusFive(int value);\n   }\n\n\n   [ServiceBehavior(InstanceContextMode = InstanceContextMode.Single)]\n   public class PlusFiver : IPlusFive\n   {\n      public int PlusFive(int value)\n      {\n          Console.WriteLine(\"Adding 5 to \" + value);\n          return value + 5;\n      }      \n   }\n</code></pre>\n\n<p>I output the adding 5 line so I know if the server processed the\n   request or not.</p>\n\n<p>I have a .NET client that I used to test this and everything works as\n   expected.</p>\n\n<p>Now I want to make an unmanaged C++ client for this.</p>\n\n<p>I figured out how to get the name of the pipe, and write to it.<br>\nI've downloaded the protocol from <a href=\"http://msdn.microsoft.com/en-us/library/cc219293%28v=PROT.10%29.aspx\" rel=\"nofollow\">here</a></p>\n\n<p>I can write to the pipe but I can't read to it.  Whenever I try to read from it I get a <code>ERROR_BROKEN_PIPE 109 (0x6D) The pipe has been ended.</code> error.  If I replace the read with a write, the write is successful, so I don't think that the pipe is closed, at least not until I try to do a read. </p>\n\n<p>Here is how I'm connecting to the pipe.</p>\n\n<pre><code>HANDLE OpenPipe(OLECHAR* bstrGuid)\n{\n    wstring pipeName = L\"\\\\\\\\.\\\\pipe\\\\\";\n    wstring strGuid = bstrGuid;\n    pipeName.append(strGuid.substr(1,36));\n    wcout &lt;&lt; \"Pipe Name \" &lt;&lt; endl;\n    wcout &lt;&lt; pipeName.c_str() &lt;&lt; endl;\n\n    HANDLE hPipe = CreateFile(pipeName.c_str(), GENERIC_WRITE | GENERIC_READ, FILE_SHARE_WRITE | FILE_SHARE_READ, NULL, OPEN_EXISTING, NULL, NULL);\n    if(hPipe == INVALID_HANDLE_VALUE)\n    {\n        wcout &lt;&lt; \"failed to create pipe\" &lt;&lt; endl;\n        system(\"pause\");\n        return NULL;\n    }\n    return hPipe;\n}\n</code></pre>\n\n<p>this is how i'm creating the first message that I'm sending</p>\n\n<pre><code>std::list&lt;wchar_t&gt; GetFirstMessage()\n{\n    std::list&lt;wchar_t&gt; message;\n    message.push_back(0x00);// version record\n    message.push_back(0x01);// major version\n    message.push_back(0x00);// minor version\n    message.push_back(0x01);// mode record\n    message.push_back(0x01);// singleton-unsized mode\n    message.push_back(0x02);// via record\n\n    wstring url = L\"net.pipe://localhost/PipePlusFive\";\n    message.push_back(url.length());// via length\n    for(int x= 0;x&lt;url.length();x++)\n    {\n        message.push_back(url[x]); // via\n    }\n    message.push_back(0x03);\n    message.push_back(0x08);\n    return message;\n}\n</code></pre>\n\n<p>This is how I'm writing it to the file.</p>\n\n<pre><code>int WriteMessage(HANDLE hPipe, LPVOID message, int size)\n{\n    DWORD bytesWritten;\n\n    BOOL bWrite = WriteFile(hPipe, &amp;message, size, &amp;bytesWritten, NULL);\n    wcout &lt;&lt; \"Bytes Written: \" &lt;&lt; bytesWritten &lt;&lt; endl;\n    if(bWrite == false)\n    {\n        wcout &lt;&lt; \"fail\"&lt;&lt;endl;\n        CloseHandle(hPipe);\n        system(\"pause\");\n        return 1;\n    }\n    return 0;\n}\n\n    list&lt;wchar_t&gt; full_message = GetFirstMessage();\nint result = WriteMessage(hPipe, &amp;full_message, full_message.size());   \nif (result == 1)\n{ return 1;}\n</code></pre>\n\n<p>Here is how I'm writing the end message</p>\n\n<pre><code>    wchar_t message = 12;\nresult = WriteMessage(hPipe, &amp;message, 1);\nif (result == 1)\n{ return 1;}\n</code></pre>\n\n<p>here is how I'm trying to read the response</p>\n\n<pre><code>    char buffer[10];\nDWORD bytesRead;\nBOOL bRead = ReadFile(hPipe, buffer, 1, &amp;bytesRead, NULL);\nif(bRead == false)\n{\n    wcout &lt;&lt; \"fail read\"&lt;&lt;endl;\n    wcout &lt;&lt; \"error: \" &lt;&lt; GetLastError() &lt;&lt; endl;\n    CloseHandle(hPipe);\n    system(\"pause\");\n    return 1;\n}\n</code></pre>\n\n<p>I'm new to c++, so I don't know if I'm not following the protocol correctly or making a stupid mistake in the way I'm trying to do this?</p>\n\n<p>UPDATE:\nThe problem was that I was writing the pointer address to the named pipe instead of the contents of the list.  I've fixed that And I'm now able to read the Preamble Ack Record.  Now I have to figure out what needs to be sent for the next part of the protocol.</p>\n"},{"tags":["python","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":109,"score":1,"question_id":11971940,"title":"Is it possible to show a balloon tip from the system tray via Python?","body":"<p>I think I've found the relevant MSDN doc here: <a href=\"http://msdn.microsoft.com/en-us/library/system.windows.forms.notifyicon.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/system.windows.forms.notifyicon.aspx</a> But I'm unsure how to (or if it is possible) go about accessing such functionality via pywin32. </p>\n"},{"tags":["c++","visual-studio","winapi","windows-7","file-mapping"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":120,"score":2,"question_id":11968898,"title":"MapViewOfFile and VirtualLock","body":"<p>Will the following code load data from file into system memory so that access to the resulting pointer will never block threads?</p>\n\n<pre><code>auto ptr = VirtualLock(MapViewOfFile(file_map, FILE_MAP_READ, high, low, size), size); // Map file to memory and wait for DMA transfer to finish.\nint val0 = reinterpret_cast&lt;int*&gt;(ptr)[0]; // Will not block thread?\nint val1 = reinterpret_cast&lt;int*&gt;(ptr)[size-4]; // Will not block thread?\n\nVirtualUnlock(ptr);\nUnmapViewOfFile(ptr);\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>Updated after Dammons answer.</p>\n\n<pre><code>auto ptr = MapViewOfFile(file_map, FILE_MAP_READ, high, low, size);\n\n#pragma optimize(\"\", off)\nchar dummy;\nfor(int n = 0; n &lt; size; n += 4096)\n    dummy = reinterpret_cast&lt;char*&gt;(ptr)[n];\n#pragma optimize(\"\", on)\n\nint val0 = reinterpret_cast&lt;int*&gt;(ptr)[0]; // Will not block thread?\nint val1 = reinterpret_cast&lt;int*&gt;(ptr)[size-4]; // Will not block thread?\n\nUnmapViewOfFile(ptr);\n</code></pre>\n"},{"tags":["c++","winapi","encryption"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":11969271,"title":"C++/Win32 Best encryption to fit my needs?","body":"<p>I'm looking to encrypt data in chunks of 1024 bytes (not many). I don't mean generating a hash or compressing - just encrypt.</p>\n\n<p>Looking for open source implementation + good algorithm.</p>\n\n<p><strong>Order of importance</strong>: (1) Simplicity (2) Speed (3) Strength</p>\n\n<p><strong>Strength</strong>: Solvable in reasonable time with a high end supercomputer</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":130,"score":1,"question_id":11949738,"title":"C++ and writing enum values into Windows registry","body":"<p>I am writing a function as follows:</p>\n\n<pre><code>bool abc::GetLoggingStatus() {\n    //true or false is returned\n    int value;\n    if (regKey-&gt;HasValue(\"LoggingStatus\")) {\n        regKey-&gt;QueryValue(\"LoggingStatus\", &amp;value);\n        if (value == 1)\n            return true; //no logging possible\n        else\n            return false;\n    }\n    regKey-&gt;SetValue(\"LoggingStatus\", 1);\n    return true;\n}\n</code></pre>\n\n<p>Logging level is defined as:</p>\n\n<pre><code>typedef enum {\n    Entry,\n    Exit,\n    Debug,\n    Warning,\n    Notification,\n    Error\n} TYPE;\n</code></pre>\n\n<p>What I need if I select 1 the levels for logging must be shown namely debug,error ... In regedit and if 0 nothing should be shown and logging be disabled.</p>\n"},{"tags":["delphi","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":218,"score":0,"question_id":11950227,"title":"CreateProcess procedure not working","body":"<p>The following piece of code doesn't make an application to run. Can some one please point out what could be the problem? </p>\n\n<pre><code>procedure TTestForm1.DR_DBA_StartAppButtonClick(Sender: TObject);\nvar\n  StartInfo: TStartupInfo;\n  ProcInfo: TProcessInformation;\n  filename : String;\n  sa : TSecurityAttributes;\n  sd : TSecurityDescriptor;\n\nbegin\n\n  InitializeSecurityDescriptor( @sd, SECURITY_DESCRIPTOR_REVISION );\n  SetSecurityDescriptorDacl( @sd, true, nil, false);\n\n  sa.nLength := sizeof( sa );\n  sa.lpSecurityDescriptor := @sd;\n  sa.bInheritHandle := true;\n\n  // start app process\n  ZeroMemory(@StartInfo, SizeOf(TStartupInfo));\n  StartInfo.cb := SizeOf(TStartupInfo);\n\n  if not\n    CreateProcess (nil, PChar(SF_AppPathBox.Text), @sa, @sa, False,\n    PROCESS_VM_WRITE or PROCESS_VM_OPERATION, nil, nil, StartInfo, ProcInfo) then\n  begin\n\n    showmessage ('Cannot Start App');\n    exit;\n\n  end;\n\nend;\n</code></pre>\n\n<p>This code ran perfectly well for an older alpha build with different UI but now after the implementation of a new UI design, it doesn't. </p>\n\n<p>The GetLastError function returns an error code of 2, the system cannot find the file specified. </p>\n\n<p>The path defined is correct as it is extracted from the installdir registry entry made by the application. I have also tried manually including it but to no avail.</p>\n\n<p><code>'X:\\App\\PB 0.93\\PB.exe'</code></p>\n\n<p>I am using DxScene v4.42 for UI design and the path is extracted from TVxTextBox. Putting in constant path works but not from the text box although both are system strings. I have compared both strings with each other through CompareStr which resulted in a complete match.</p>\n\n<p>I am working on Windows 7 64/32bit and Windows XP SP2/3 32bit.</p>\n\n<h1>Findings</h1>\n\n<p>DxScene components inherently use unicode strings which are incompatible with createprocess procedure. </p>\n\n<p>So I stored the required path strings first in normal strings and then passed them as parameter to create process which worked.</p>\n"},{"tags":["c#","winapi"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":397,"score":2,"question_id":8840926,"title":"asynchronously GetForegroundWindow via SendMessage or something?","body":"<p>Is there a way to be notified of when focus changes from any window to another window(even between windows applications) such that I can just have my delegate called immediately when the user changes focus??</p>\n\n<p>I keep thinking I may just have to do polling :( :( every 1 second and call GetForegroundWindow but I really don't want to do that.</p>\n"},{"tags":["qt","winapi","qpainter","ws-ex-layered"],"answer_count":0,"favorite_count":3,"up_vote_count":4,"down_vote_count":1,"view_count":142,"score":3,"question_id":11880888,"title":"win32 controls (QWinHost) not painted on layered (ie. semi-transparent) widget (WS_EX_LAYERED)","body":"<p>I ported a win32 control using QWinHost, and put it on a layered (semi-transparent) widget. When I set WS_EX_LAYERED flag, then paint not occurred for win32 ported control.</p>\n\n<pre><code>SetWindowLong(winId(),\n           GWL_EXSTYLE,\n           GetWindowLong(winId(), GWL_EXSTYLE) | *WS_EX_LAYERED*);\n</code></pre>\n"},{"tags":["c","winapi","unicode","wchar-t"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":11953363,"title":"wchar_t is unsigned or signed","body":"<p>In this <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd374131.aspx\" rel=\"nofollow\">link</a> <code>unsigned wchar_t</code> is <code>typedef</code>ed as <code>WCHAR</code>. But I cant find this kind of typedef in my SDK <code>winnt.h</code> or mingw <code>winnt.h</code>.</p>\n\n<p><code>wchar_t</code> is signed or unsigned?</p>\n\n<p>I am using WINAPIs in C language. </p>\n"},{"tags":["winapi","packet-capture"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":195,"score":0,"question_id":11181937,"title":"WinDivert: What is the reason behind the error message \"error: failed to open Divert device (110)\"?","body":"<p>I tried to install WinDivert in my machine (Windows 7 64-bit OS). I tried with both 32-bit and 64-bit version. However, I failed at both of the cases and received the error message: \"error: failed to open Divert device (110)\". I followed Section 2 (Steps 2.1 and 2.2) of the tutorial:  <a href=\"http://reqrypt.org/windivert-doc.html\" rel=\"nofollow\">http://reqrypt.org/windivert-doc.html</a>. I used \"Free Build Environment\" (x86/x64). I invoked wddk-build.bat. Then I signed the driver as it has been shown in the document (just as it is written). I restarted the machine and tried to run \"netdump\" and \"netfilter\" from \"install/WDDK/...\" from the command prompt. However, nothing works for me. Even I tried with the MS Visual Studio 10 (masvc-build.bat). What is the issue, I am suffering with?  </p>\n"},{"tags":["c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":11965413,"title":"hard time with createprocess function","body":"<p>First off, I've read everything on the net related to this function for a few days but still couldn't get it right. I'm using the same example used in msdn page here: </p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/ms682512(VS.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms682512(VS.85).aspx</a></p>\n\n<p>My code:</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;tchar.h&gt;\n\nvoid _tmain( int argc, TCHAR *argv[] )\n{\n    STARTUPINFO si;\n    PROCESS_INFORMATION pi;\n\n    SecureZeroMemory( &amp;si, sizeof(si) );\n    si.cb = sizeof(si);\n    SecureZeroMemory( &amp;pi, sizeof(pi) );\n\n    if( argc != 2 )\n    {\n        printf(\"Usage: %s [cmdline]\\n\", argv[0]);\n        return;\n    }\n\n    // Start the child process. \n    if( !CreateProcess( NULL,   // No module name (use command line)\n        \"C:\\\\Users\\\\user\\\\Desktop\\\\FreeCell.lnk\",        // Command line\n        NULL,           // Process handle not inheritable\n        NULL,           // Thread handle not inheritable\n        FALSE,          // Set handle inheritance to FALSE\n        0,              // No creation flags\n        NULL,           // Use parent's environment block\n        NULL,           // Use parent's starting directory \n        &amp;si,            // Pointer to STARTUPINFO structure\n        &amp;pi )           // Pointer to PROCESS_INFORMATION structure\n    ) \n    {\n        printf( \"CreateProcess failed (%d).\\n\", GetLastError() );\n        return;\n    }\n\n\n\n    // Wait until child process exits.\n    WaitForSingleObject( pi.hProcess, INFINITE );\n\n    // Close process and thread handles. \n    CloseHandle( pi.hProcess );\n    CloseHandle( pi.hThread );\n}\n</code></pre>\n\n<p>As you see i've only changed the directory part. When i run it doesn't give any error but it is also not working.  </p>\n"},{"tags":["c++","winapi","sockets","setsockopt"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":761,"score":0,"question_id":1115511,"title":"Set IP_HDRINCL to setsockopt function in win32","body":"<p><br />\nI'm fighting with raw sockets in Win32 and now I'm stuck, the soetsockopt funtion give me the 10022 error (invalid argument), but I think I pass the correct arguments... of course I'm wrong u_u' </p>\n\n<pre><code>sock = socket(AF_INET,SOCK_RAW,IPPROTO_UDP);\nif (sock == SOCKET_ERROR)\n{\n  printf(\"Error socket(): %d\", WSAGetLastError());\n  return;\n}\nchar on = 1;\nerror =  setsockopt(sock,IPPROTO_IP,IP_HDRINCL,&amp;on,sizeof(on)); \nif (sock == SOCKET_ERROR)\n{\n  printf(\"Error setsockopt(): %d\", WSAGetLastError());\n  return;\n}\n</code></pre>\n\n<p>Anybody knows what happen to my code?</p>\n"},{"tags":["c++","winapi","midi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":11964318,"title":"midiOutShortMsg on channel 10 (percussion) with output in stereo","body":"<p>I'm writing C++ code to output midi messages on channel 10 (percussion). I need this to work in stereo, so that some notes/beats are played through the left channel/speaker, others through the right. If I try the following:</p>\n\n<pre><code>#define MIDI_PERCUSSION_MESSAGE(volume, sound) ((volume &lt;&lt; 16) | (sound &lt;&lt; 8 ) | 0x99)\nmidiOutSetVolume(midiOutHandle, 0xFFFF);\nmidiOutShortMsg(midiOutHandle, MIDI_PERCUSSION_MESSAGE(127, 35);\nmidiOutSetVolume(midiOutHandle, 0xFFFF0000);\nmidiOutShortMsg(midiOutHandle, MIDI_PERCUSSION_MESSAGE(127, 38);\n</code></pre>\n\n<p>Both notes simply come out the right speaker. If I try using panning:</p>\n\n<pre><code>#define MIDI_SET_PAN(pan, channel) ( (pan &lt;&lt; 16) | 0xAB0 | channel)\nmidiOutShortMsg(midiOutHandle, MIDI_SET_PAN(0, 0x9));\nmidiOutShortMsg(midiOutHandle, MIDI_PERCUSSION_MESSAGE(127, 35);\nmidiOutShortMsg(midiOutHandle, MIDI_SET_PAN(127, 0x9));\nmidiOutShortMsg(midiOutHandle, MIDI_PERCUSSION_MESSAGE(127, 38);\n</code></pre>\n\n<p>I get the same result. Is it possible to get another channel to play the GM percussion sound set? Any advice much appreciated.</p>\n"},{"tags":["c#",".net","winapi","keyboard-hook"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":11962302,"title":"Global low level keyboard hook not preventing OEM keys","body":"<p>I have written the following method that prevents all keys from being pressed:</p>\n\n<pre><code>private IntPtr HookHandler(int nCode, IntPtr wParam, ref KBDLLHOOKSTRUCT lParam)\n{\n    if (nCode &gt;= 0)\n    {\n        ...\n\n        //Return a nonzero value to prevent the system from passing the message to the\n        //rest of the hook chain or the target window procedure.\n        return (IntPtr)1;\n    }\n\n    return NativeMethods.CallNextHookEx(_hookID, nCode, wParam, ref lParam);\n}\n</code></pre>\n\n<p>When the above code runs, though, it allows keys like my keyboard's calc key or the email key, etc.</p>\n\n<p>I debug, and the code does get to the <code>return (IntPtr)1;</code> line (and it does show correctly what key is being pressed), but by then, the calc window (or other) has already opened.  Even if I return a 1, its too late.</p>\n\n<p>Is there something I can be doing different here?</p>\n"},{"tags":["winapi","opengl-3"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":11875003,"title":"OpenGL Calls corrupt memory","body":"<p>When I call glGetIntergerv, or any other opengl function, and step through it in gdb, upon reaching it, gdb would skip a few lines and continue stepping later in the code.</p>\n\n<p>Below is the code for loading opengl, and windows. It is the only code that runs before glGetIntergerv, the first opengl call.</p>\n\n<pre><code>HWND window;\nHDC dev_context;\n\nHGLRC rend_context;\n//Creating the Window\n    char const *name = \"Opengl Test\";\n    HINSTANCE inst = (HINSTANCE)GetModuleHandle(0);\n    WNDCLASS windowClass;\n    DWORD dwExStyle = WS_EX_APPWINDOW | WS_EX_WINDOWEDGE;\n    windowClass.style = CS_HREDRAW | CS_VREDRAW | CS_OWNDC;\n    windowClass.lpfnWndProc = (WNDPROC) WndProcedure;\n    windowClass.cbClsExtra = 0;\n    windowClass.cbWndExtra = 0;\n    windowClass.hInstance = inst;\n    windowClass.hIcon = LoadIcon(NULL, IDI_WINLOGO);\n    windowClass.hCursor = LoadCursor(NULL, IDC_ARROW);\n    windowClass.hbrBackground = NULL;\n    windowClass.lpszMenuName = NULL;\n    windowClass.lpszClassName = name;\n    RegisterClass(&amp;windowClass);\n\n    window = CreateWindowEx(dwExStyle, name, name, WS_OVERLAPPEDWINDOW,\n      CW_USEDEFAULT, 0, 0, 0, NULL, NULL, inst, NULL);\n\n//Context\n    dev_context = GetDC( window );\n    std::cout &lt;&lt; dev_context &lt;&lt; std::endl;\n    //Get pixel format\n    PIXELFORMATDESCRIPTOR pfd;\n    memset(&amp;pfd, 0, sizeof(PIXELFORMATDESCRIPTOR));\n    pfd.nSize  = sizeof(PIXELFORMATDESCRIPTOR);\n    pfd.nVersion   = 1;\n    pfd.dwFlags    = PFD_DOUBLEBUFFER | PFD_SUPPORT_OPENGL | PFD_DRAW_TO_WINDOW;\n    pfd.iPixelType = PFD_TYPE_RGBA;\n    pfd.cColorBits = 32;\n    pfd.cDepthBits = 32;\n    pfd.iLayerType = PFD_MAIN_PLANE;\n\n    int nPixelFormat = ChoosePixelFormat(dev_context, &amp;pfd);\n    SetPixelFormat( dev_context, nPixelFormat, &amp;pfd );\n\n    HGLRC temp_rend_context = wglCreateContext( dev_context );\n    wglMakeCurrent( dev_context, temp_rend_context );\n\n    HGLRC (WINAPI *wglCreateContextAttribsARB) (HDC hDC, HGLRC hShareContext, const int *attribList) = (HGLRC (WINAPI *) (HDC hDC, HGLRC hShareContext, const int *attribList)) gl3wGetProcAddress(\"wglCreateContextAttribsARB\");\n\n    const int attribs[] = { WGL_CONTEXT_MAJOR_VERSION_ARB, 3,  WGL_CONTEXT_MINOR_VERSION_ARB, 0, WGL_CONTEXT_FLAGS_ARB, /*WGL_CONTEXT_FORWARD_COMPATIBLE_BIT_ARB*/0, 0};\n\n    rend_context = wglCreateContextAttribsARB(dev_context, 0, attribs);\n    wglMakeCurrent(0,0);\n    wglDeleteContext(temp_rend_context);\n    wglMakeCurrent(dev_context, rend_context);\n\n    gl3wInit();\n\n    int glVersion[2] = {-1, -1};\n    glGetIntegerv(GL_MAJOR_VERSION, &amp;glVersion[0]); //First gl call\n    glGetIntegerv(GL_MINOR_VERSION, &amp;glVersion[1]);\n</code></pre>\n\n<p>Below is my WndProcedure function:</p>\n\n<pre><code>static LRESULT CALLBACK WndProcedure(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam){\n    switch(Msg){\n        case WM_DESTROY:\n            PostQuitMessage(WM_QUIT);\n            return 0;\n        default:\n            return DefWindowProc(hWnd, Msg, wParam, lParam);\n    }\n}\n</code></pre>\n\n<p>I am using the gl3w library for loading the opengl functions.</p>\n"},{"tags":["c++","winapi"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":344,"score":3,"question_id":5791996,"title":"Re-registering User-defined Window Class - C++","body":"<p>I'm getting a class already exists error from the call to <code>RegisterClassEx</code> in the following code.  This code is in a class constructor:</p>\n\n<pre><code>this-&gt;m_wcx.cbSize = sizeof(WNDCLASSEX);  // size of structure\nthis-&gt;m_wcx.style = CS_HREDRAW | CS_VREDRAW; // initially minimized\nthis-&gt;m_wcx.lpfnWndProc = &amp;WndProc;       // points to window procedure\nthis-&gt;m_wcx.cbClsExtra = 0;               // no extra class memory\nthis-&gt;m_wcx.cbWndExtra = 0;               // no extra window memory\nthis-&gt;m_wcx.hInstance = m_hInstance;      // handle to instance\nthis-&gt;m_wcx.hIcon = ::LoadIcon( NULL, IDI_APPLICATION ); // default app icon\nthis-&gt;m_wcx.hCursor = ::LoadCursor( NULL, IDC_ARROW ); // standard arrow cursor\nthis-&gt;m_wcx.hbrBackground = NULL;         // no background to paint\nthis-&gt;m_wcx.lpszMenuName = NULL;          // no menu resource\nthis-&gt;m_wcx.lpszClassName = s_pwcWindowClass; // name of window class\nthis-&gt;m_wcx.hIconSm = NULL;               // search system resources for sm icon\n\n// Register window class.\nif ( (this-&gt;m_atom = ::RegisterClassEx( &amp;m_wcx )) == 0 )\n{\n    dwError = ::GetLastError();\n    TRACE(_T(\"Failed to register window class.\\r\\n\\tError: %d\\r\\n\\tFile: %s\\r\\n\\tLine: %d\\r\\n\"), dwError, _T(__FILE__), __LINE__);\n    THROW(dwError);\n}\n</code></pre>\n\n<p>This first time this code executes, it works without any problems.  When the class destructor is called it unregisters the class:</p>\n\n<pre><code>::UnregisterClass( s_pwcWindowClass, this-&gt;m_hInstance );\n</code></pre>\n\n<p>This all works fine the first time through.  Subsequent calls to the constructor result in <code>RegisterClassEx</code> failing with <code>ERROR_CLASS_ALREADY_EXISTS</code>.  What am I doing wrong?</p>\n"},{"tags":["c#",".net","winapi","networking","passwords"],"answer_count":7,"favorite_count":13,"up_vote_count":19,"down_vote_count":0,"view_count":14798,"score":19,"question_id":295538,"title":"How to provide user name and password when connecting to a network share","body":"<p>When connecting to a network share for which the current user (in my case, a network enabled service user) has no rights, name and password have to be provided.</p>\n\n<p>I know how to do this with Win32 functions (the <code>WNet*</code> family from <code>mpr.dll</code>), but would like to do it with .Net (2.0) functionality.</p>\n\n<p>What options are available?</p>\n\n<p><strong>Maybe some more information helps:</strong></p>\n\n<ul>\n<li>The use case is a windows service, not an Asp.Net application.</li>\n<li>The service is running under an account which has no rights on the share.</li>\n<li>The user account needed for the share is not known on the client side.</li>\n<li>Client and server are not members of the same domain.</li>\n</ul>\n"},{"tags":["c++","windows","winapi","image-manipulation","bmp"],"answer_count":7,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":16533,"score":6,"question_id":199403,"title":"C++: What's the simplest way to read and write BMP files using C++ on Windows?","body":"<p>I would like to load a BMP file, do some operations on it in memory, and output a new BMP file using C++ on Windows (Win32 native). I am aware of <a href=\"http://www.imagemagick.org/\">ImageMagick</a> and it's C++ binding <a href=\"http://www.imagemagick.org/Magick%2B%2B/\">Magick++</a>, but I think it's an overkill for this project since I am currently not interested in other file formats or platforms.</p>\n\n<p>What would be the simplest way in terms of code setup to read and write BMP files? The answer may be \"just use Magick++, it's the simplest.\"</p>\n\n<p>Related Question: <a href=\"http://stackoverflow.com/questions/158756/what-is-the-best-image-manipulation-library\">What is the best image manipulation library?</a></p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":11961421,"title":"Syslink in ListView","body":"<p>If I have a listview control in report mode, how could I stick a syslink control into one of the columns?<br>\nI want to have a link the user can click in one of the columns.</p>\n"},{"tags":["c","winapi","sockets","bitmap","resolution"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":11948890,"title":"change HBITMAP resolution for reducing file size","body":"<p>i create screenshot of desktop as bitmap file. </p>\n\n<p>What is best method to reduce the resolution of this large image file (~3 MB) in win32 C? </p>\n\n<p>I want to send it over the network, so the file should be smaller.</p>\n"},{"tags":["visual-studio-2010","visual-studio","winapi","visual-c++","printing"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":11960688,"title":"Win API (printers) - winspool.h","body":"<p>Im' using the win api and some funcions from winspool.h to work with my printers. Functions like OpenPrinter/StartDoc/ etc...</p>\n\n<p>I'm able to print and everything looks fine. The only problem, or issue i can't addrress is about margins.\nMy printer seems to add some weird bottom margin and some images/text that are close to bottom are cutted off.\nI want to remove this margin, and from other programs i can use the print setup to remove them. \nbut i can't find out how to do it from my code. Something like:</p>\n\n<pre><code>dc-&gt;margin = &amp;rect;\n\nor:\ndc-&gt;margin-&gt;bottom_margin = 0;\n</code></pre>\n\n<p>Any ideas?</p>\n"},{"tags":["windows","winapi","ipc"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":11959647,"title":"Secure Named Shared Memory on Windows so only specific processes can open","body":"<p>Is there a way to set the permissions with Named Shared Memory in Windows so that the access control is done by process rather than by user?  I'd like to have one program create the memory, pass a handle or pass back a PID so that the client process can access the memory.  All other processes should be denied access. Thanks</p>\n"},{"tags":["windows","winapi","exit","explorer"],"answer_count":4,"favorite_count":3,"up_vote_count":14,"down_vote_count":1,"view_count":1280,"score":13,"question_id":5689904,"title":"Gracefully Exit Explorer (Programmatically)","body":"<p>How do you <strong>gracefully</strong> close Explorer programmatically?</p>\n\n<p>By that I mean, how do you invoke this function programmatically:</p>\n\n<p><img src=\"http://i.imgur.com/D94KL.png\" alt=\"\"></p>\n\n<p>Edit: Typo in the picture, it should say \"Ctrl-Shift-Right-Click\" instead of \"Shift-Click\".</p>\n"},{"tags":["c++","winapi","simulation"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":244,"score":1,"question_id":11950508,"title":"C++ simulate left mouse click on minimized program","body":"<p>I have been searching for a bit about this particular problem I am having, I want to be able to simulate a left mouse click on a program that I am currently attached to.</p>\n\n<p>Right now, I create a thread that checks a database for certain values, and when those values come back (the ones I am looking for), I want to be able to then send a left mouse click in any x,y coord of the program (while minimized).</p>\n\n<p>How can this be done for Windows 7?  Thanks!</p>\n\n<p>EDIT: Here is how I am calling the thread ...</p>\n\n<pre><code>HWND child = GetActiveWindow();\nif ( child == NULL )\nMessageBox(0,\"Couldn't get the child hwnd!\",\"\",0);\n\nDWORD ID;\nHANDLE thread_check_game = CreateThread ( NULL , 0 , (LPTHREAD_START_ROUTINE) game_check_thread , (LPVOID)child, 0 , &amp;ID ); CloseHandle ( game_check_thread );\n</code></pre>\n\n<p>and then ...</p>\n\n<pre><code>DWORD WINAPI game_check_thread(LPVOID lpParam) {\n\nHWND    Window;\nWindow = (HWND)lpParam;\n// ... some other code ...\n// ...\nWORD mouseX = 398;\nWORD mouseY = 398;\n\n\nSendMessage(Window,WM_LBUTTONDOWN,MK_LBUTTON,MAKELPARAM(mouseX,mouseY));\nSendMessage(Window, WM_LBUTTONUP, MK_LBUTTON, MAKELPARAM(mouseX, mouseY));\nWrite(\"Sent Left Click\\n\");\n\nExitThread(0);\nreturn 0;\n}\n</code></pre>\n"},{"tags":["winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":11950621,"title":"Windows API, to create users, user profiles, copy files remotely","body":"<p>By the moment I wouldn't like to have piece of code (if it is possible it would be great), what I would like to know what windows API I can use to be able to create users, user profiles, copy files, create registry keys remotely. Currently, I know that the UserEnv.dll brings methods that allows me to create users, but the most hard for me is to find a way to do it remotely, originaly I was thinking to use sockets, but I was wondering if Windows has some API, or services that I could use to connect and create the users, copy files remotely. I started to review the services that Windows has and it is taking too long to find something that could help me.</p>\n\n<p>Thanks,\njimmy</p>\n"},{"tags":["c++","windows","winapi","gui","wtl"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":11927622,"title":"Main dialog destroys before command message handler returns","body":"<p>My program use a modeless dialog to interact with the user and also has a tray icon.\nA user can quit the app immediately by using the tray icon.</p>\n\n<pre><code>BOOL OnInitDialog()\n{\n    init data...\n}\n\nvoid OnDestroy()\n{\n    destroy data...\n}\n\nvoid OnSomeButton()\n{\n    CFileDialog dlg;\n    ...\n    dlg.DoModal(m_hWnd));\n    access data...\n    ...\n}\n\nvoid OnMenuExit()\n{\n    DestroyWindow();\n}\n</code></pre>\n\n<p>The problem is that when I popup a modal dialog(<code>OnSomeButton</code>), and then quit using the tray icon menu, the main dialog is destroyed first, and then the modal one returns, trying to access some invalid data, causing a crash.</p>\n\n<p>I know i can add some check code before accessing the data, but is there any other way? \nIs there any way to ensure OnSomeButton() returns before window destroy?</p>\n"},{"tags":["c++","c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":90,"score":2,"question_id":11925256,"title":"SHAutoComplete on edit control without dialog boxes","body":"<p>I am having trouble using the function <code>SHAutoComplete</code>. It simply does not work correctly when I use it on a edit box whose parent window is not a dialog box.</p>\n\n<p>The auto-complete functionality seems to be working fine, but the rendering of the drop-down list with the possible candidates based on what was typed on the edit box is very messed up. Basically only the borders of the drop-down are shown. The borders are rendered wide enough to fit the possible suggestions, but the suggestions themselves are never drawn. Even the drop-down list background color is wrong. It is as if it was never painted and remains with the original parent window color. </p>\n\n<p>And if the number of suggestions is big enough so the drop-down needs a scroll-bar, the scrollbar also does not get rendered correctly - the arrows do not get drawn.</p>\n\n<p>On both cases, with or without scrollbars, the drop-down list does not accept mouse input, i.e., I cannot click on the items. If I press the \"down\" key on the keyboard while the drop-down is being shown, it kind of works as expected. After the second or third press the items finally start to appear. But the scrollbar still is does not get rendered correctly.</p>\n\n<p>If instead of registering my own windows class I simply use a dialog with <code>::DialogBoxParam()</code>, then it all goes as expected. The auto-complete works without any problems at all.</p>\n\n<p>Here is what I am doing. This code will register a window class, create the main window, create an edit box and then call <code>SHAutoComplete</code> on it. It must be linked with <code>Shlwapi.lib</code></p>\n\n<pre><code>// this code must be linked with Shlwapi.lib\n\n#include &lt;Windows.h&gt;\n#include &lt;Shlwapi.h&gt;\n\n\n// name of the class that will be created for the main window\nstatic const char WindowClassName[] = \"SHAutoCompleteDoesNotWorkWithoutADialogWindowClassName\";\n\n\n// the main window procedure\nstatic LRESULT CALLBACK WindowProc(\n    HWND   hwnd,\n    UINT   uMsg,\n    WPARAM wParam,\n    LPARAM lParam)\n{\n    switch(uMsg)\n    {   \n        case WM_CREATE:\n        {\n            HWND hwndEdit = ::CreateWindowEx(\n                0,\n                \"EDIT\",\n                0,\n                WS_CHILD | WS_VISIBLE,\n                10, \n                10, \n                300,\n                25,\n                hwnd, \n                NULL,\n                NULL,\n                0);     \n\n            ::SHAutoComplete(hwndEdit, SHACF_DEFAULT);\n\n            return 0;\n        }            \n\n        case WM_DESTROY:\n            ::PostQuitMessage(1);\n            return 0;\n\n        default:\n            return ::DefWindowProc(hwnd, uMsg, wParam, lParam);\n    }\n}\n\n\n// the app entry point\nint CALLBACK WinMain(\n    HINSTANCE hInstance,\n    HINSTANCE hPrevInstance,\n    LPSTR    lpCmdLine,\n    int       nCmdShow)\n{\n    ::CoInitialize(NULL);\n\n    WNDCLASSEX wcex    = {0};\n    wcex.cbSize        = sizeof(wcex);\n    wcex.style         = CS_OWNDC | CS_HREDRAW | CS_VREDRAW ;\n    wcex.lpfnWndProc   = WindowProc;\n    wcex.hInstance     = hInstance;        \n    wcex.lpszClassName = WindowClassName;\n    wcex.hbrBackground = (HBRUSH)(COLOR_BTNFACE+1); \n\n    ATOM atom = ::RegisterClassEx(&amp;wcex);\n\n    HWND hwnd = ::CreateWindowEx(\n        0,\n        MAKEINTATOM(atom),\n        \"SHAutoComplete Test\",\n        WS_OVERLAPPEDWINDOW | WS_VISIBLE |  WS_CLIPCHILDREN | WS_CLIPSIBLINGS,\n        CW_USEDEFAULT,\n        CW_USEDEFAULT,\n        CW_USEDEFAULT,\n        CW_USEDEFAULT,\n        NULL,\n        NULL,\n        hInstance,\n        NULL);\n\n    MSG msg;\n    while(::GetMessage(&amp;msg, hwnd, 0, 0) &gt; 0)\n    {\n        ::TranslateMessage(&amp;msg);\n        ::DispatchMessage(&amp;msg);\n    }\n\n    ::UnregisterClass((LPCTSTR)atom, NULL);\n\n    ::CoUninitialize();\n\n    return 0;\n}       \n</code></pre>\n\n<p>That code produces the following:</p>\n\n<ol>\n<li><p>the drop-down when a scroll bar is needed\n<a href=\"http://www.abload.de/img/shautocomplete_2i1sk4.jpg\" rel=\"nofollow\">http://www.abload.de/img/shautocomplete_2i1sk4.jpg</a></p></li>\n<li><p>the drop-down after a couple of presses to the \"down\" key. Notice how the scroll bar still is not rendered correctly.\n<a href=\"http://www.abload.de/img/shautocomplete_3efsgw.jpg\" rel=\"nofollow\">http://www.abload.de/img/shautocomplete_3efsgw.jpg</a></p></li>\n</ol>\n\n<p>Now, when I switch to Dialog Boxes, works like a charm. In the code below, IDD_DIALOG1 is simply an empty dialog box resource, created automatically by the IDE.</p>\n\n<p>Here is the relevant part of the rc file</p>\n\n<pre><code>IDD_DIALOG1 DIALOGEX 0, 0, 316, 185\nSTYLE DS_SETFONT | DS_MODALFRAME | DS_FIXEDSYS | WS_POPUP | WS_CAPTION | WS_SYSMENU\nCAPTION \"Dialog\"\nFONT 8, \"MS Shell Dlg\", 400, 0, 0x1\nBEGIN\nEND\n</code></pre>\n\n<p>And here is the code that uses it</p>\n\n<pre><code>// this code must be linked with Shlwapi.lib\n\n#include &lt;windows.h&gt;\n#include &lt;Shlwapi.h&gt;\n\n#include \"Resource.h\"\n\n\nBOOL CALLBACK DialogProc(\n    HWND   hwnd,\n    UINT   uMsg,\n    WPARAM wParam,\n    LPARAM lParam)\n{    \n\n    switch(uMsg)\n    {        \n        case WM_INITDIALOG:\n        {\n            HWND hwndEdit = ::CreateWindowEx(\n                0,\n                \"EDIT\",\n                0,\n                WS_VISIBLE | WS_CHILD,                    \n                0, \n                0, \n                300,\n                20,\n                hwnd, \n                NULL,\n                NULL,\n                0);      \n\n            ::SHAutoComplete(hwndEdit, SHACF_DEFAULT);\n\n            return 1;\n        }\n\n\n        case WM_CLOSE:            \n            ::EndDialog(hwnd, 0);\n            return 1;   \n\n\n        default:\n            return 0;\n    }\n}\n\n\n\nint WINAPI WinMain(\n    HINSTANCE hInstance,\n    HINSTANCE hPrevInstance,\n    LPSTR     lpCmdLine,\n    int       nShowCmd)\n{       \n    ::CoInitialize(NULL);\n\n    ::DialogBoxParam(\n        NULL,\n        MAKEINTRESOURCE(IDD_DIALOG1),\n        NULL,\n        DialogProc,\n        0);    \n\n    ::CoUninitialize();\n\n    return 0;\n}\n</code></pre>\n\n<p>Could you please point out where I am going wrong? As far as I can see, other than the creation and destruction of the main window, there seems to be no difference at all between the two of them. Am I missing something on the SHAutoComplete docs that states it can only be used on edit boxes inside dialogs?</p>\n"},{"tags":["c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":53,"score":2,"question_id":11922666,"title":"How to identify a crashing child with CreateProcess","body":"<p>I have a program where I call <code>CreateProcess</code>, then wait for it to finish with <code>WaitForSingleObject</code>, and finally I grab its exit status with <code>GetExitCode</code>. (However, the status variable contains 0 for crashed processes.) &lt;- My apologies, this was incorrect. I was printing with the wrong size of variable.</p>\n\n<p>How do I detect when the child crashed?</p>\n"},{"tags":["winapi","gdi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":11948920,"title":"Mysterious access violations/skipped statements/silent failure with DIB sections","body":"<p>I'm making a DIB section like this:</p>\n\n<pre><code>BITMAPINFO bmi;\nbmi.bmiHeader.biSize = sizeof(BITMAPINFO);\nbmi.bmiHeader.biWidth = MY_WIDTH;\nbmi.bmiHeader.biHeight = -MY_HEIGHT; // Order pixels from top to bottom\nbmi.bmiHeader.biPlanes = 1;\nbmi.bmiHeader.biBitCount = 32; // last byte not used, 32 bit for alignment\nbmi.bmiHeader.biCompression = BI_RGB;\nbmi.bmiHeader.biSizeImage = 0;\nbmi.bmiHeader.biXPelsPerMeter = 0;\nbmi.bmiHeader.biYPelsPerMeter = 0;\nbmi.bmiHeader.biClrUsed = 0;\nbmi.bmiHeader.biClrImportant = 0;\nbmi.bmiColors[0].rgbBlue = 0;\nbmi.bmiColors[0].rgbGreen = 0;\nbmi.bmiColors[0].rgbRed = 0;\nbmi.bmiColors[0].rgbReserved = 0;\n\nhbm = CreateDIBSection(hdc, &amp;bmi, DIB_RGB_COLORS, (void**)&amp;pixels, NULL, 0);\n</code></pre>\n\n<p>When painting:</p>\n\n<pre><code>HDC hdcMem = CreateCompatibleDC(hdc);\n\nHBITMAP hbmOld = (HBITMAP)SelectObject(hdcMem, hbm);\nonFrame(pixels);\nBitBlt(hdc, 0, 0, MY_WIDTH, MY_HEIGHT, hdcMem, 0, 0, SRCCOPY);\nSelectObject(hdcMem, hbmOld);\nDeleteDC(hdcMem);\n</code></pre>\n\n<p>onFrame():</p>\n\n<pre><code>void onFrame(pixel *pixels) {\n// This is where all the drawing takes place\npixel *p;\n// +0.005 each frame\nstatic float frameOffset = 0;\nfloat px; // % of the way across the bitmap\nfloat py; // % of the way down the bitmap\nfor (int x = 0; x &lt; MY_WIDTH; ++x) {\n    for (int y = 0; y &lt; MY_HEIGHT; ++y) {\n        p = &amp;pixels[y * MY_WIDTH + x];\n        px = float(x) / float(MY_WIDTH);\n        py = float(y) / float(MY_HEIGHT);\n        p-&gt;r = 0;//(unsigned char)(((cos(px + frameOffset * 10) / sin(py + frameOffset)) * cos(frameOffset * 3) * 10) * 127 + 127);\n        p-&gt;g = 255;//~p-&gt;r;\n        p-&gt;b = 255;\n    }\n}\nframeOffset += 0.005f;\n}\n</code></pre>\n\n<p>Sometimes the Visual Studio debugger simply exits the paint method without executing all the statements (!), sometimes there is an access violation, and sometimes everything is executed but nothing happens (the window just stays white). It never works. I based this off the code from <a href=\"http://www.daniweb.com/software-development/cpp/code/241875/fast-animation-with-the-windows-gdi\" rel=\"nofollow\">http://www.daniweb.com/software-development/cpp/code/241875/fast-animation-with-the-windows-gdi</a>; the code there works, but mine is apparently subtly different. A big problem for me is that I don't know how to debug the issue: I don't know how to inspect the objects, the access violation is in ntdll.dll (so no stack trace), and when it fails less spectacularly it fails silently. BitBlt is returning true (in the 1/4 runs that it actually is called). I tried calling GdiFlush before and after the onFrame() call, but that didn't really help. What on Earth could be causing this issue?</p>\n"},{"tags":["winapi","windows-shell"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":11941072,"title":"manipulating ShellItemArray","body":"<p>How can I remove items from a given ShellItemArray? or alternatively, create a new ShellItemArray from specific shell items of the current array?\nNon of the SHCreateShellItemArray*** functions help me in that (there is one function named SHCreateShellItemArrayFromShellItem, but it creates an array from single shell item, not a few)</p>\n"},{"tags":["c","windows","winapi","visual-c++"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":180,"score":3,"question_id":11945990,"title":"Difference between char * and LPSTR in windows","body":"<p>I apologise if it is a basic or silly question. What is the difference between <code>char*</code> and <code>LPSTR</code>. where the <code>sizeof</code> both gives 4 bytes in my compiler. Can someone explain me in detail. thanks.. </p>\n"},{"tags":["security","winapi","authentication","credentials","dpapi"],"answer_count":1,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":834,"score":6,"question_id":9221245,"title":"How do I store and retrieve credentials from the Windows Vault credential manager?","body":"<p>I want to securely store a plaintext password on Windows PC. I am currently using DPAPI <a href=\"http://msdn.microsoft.com/en-us/library/aa380261%28VS.85%29.aspx\" rel=\"nofollow\"><code>CryptProtectData</code></a> to encrypt it, then store the encrypted blob in a file in user's local AppData. </p>\n\n<p>In Windows 7, there is Windows Vault, a credential manager (Control Panel\\User Accounts and Family Safety\\Credential Manager) that stores logon data for a variety of logon types, including \"generic credential\". On the surface this looks like the right place for a program to store credentials. However, I was not able to find any API for it. I read <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa374731%28v=vs.85%29.aspx#other_functions\" rel=\"nofollow\">Authentication function</a> reference in MSDN, but frankly got lost in it.</p>\n\n<p>Is there an API to Windows Vault to store and retrieve credentials from a program, and, if yes, where can I find documentation?</p>\n"},{"tags":["c++","windows","winapi","power-management"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":169,"score":0,"question_id":11944335,"title":"Is Windows entering sleep mode or hibernating with C++?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6012219/how-to-detect-if-windows-is-going-to-hibernate-or-suspend\">How to detect if windows is going to hibernate or suspend?</a>  </p>\n</blockquote>\n\n\n\n<p>Can someone refresh my memory, from a standpoint of a program running on Windows there's no way to know if the system is entering a sleep mode or hibernating, correct? (I need to know the mode that the system entered, or was just resumed from.)</p>\n"},{"tags":["c++","winapi","visual-c++","seh","structured-exception"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":11944558,"title":"The 'get' equivalent of _set_se_translator?","body":"<p>I need to translate structured exceptions manually, using the current translator.</p>\n\n<p>How do I 'get' the value someone has set by <code>_set_se_translator</code>?</p>\n"},{"tags":["ruby","winapi","com","ole","com-server"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":110,"score":2,"question_id":7402611,"title":"Create COM server with Ruby?","body":"<p>Ruby on Windows has the win32::ole library that allows Ruby to act as a COM client, similar to VBScript and other scripting languages (Python, Perl, etc. with win32 bindings). However, I am wondering if it is possible to create a COM server with Ruby that can be accessed from other clients. Python makes this possible, even simple, with its win32 package, but I have not been able to find any examples of this with Ruby. </p>\n"},{"tags":["c#",".net","winapi","c++-cli","winsock"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":122,"score":2,"question_id":11889227,"title":"Asynchronous .NET sockets & standard sockets using select(): Why does select() prevent the async callbacks from happening?","body":"<p>I have an application written in C++/CLI that uses a library written in C#.  The application was written using standard socket APIs and uses select() to multiplex a bunch of ordinary non-async sockets.  However, the third party library uses .NET sockets and uses the asynchronous results and callbacks.</p>\n\n<p>Here's the scenario:  I create a bunch of regular sockets in the main thread (a C++/CLI application that uses mostly native-style code).  I create the third party library vendor's C# \"session\" object which, internally, has a bunch of asynchronous sockets from the .NET classes.</p>\n\n<p>What I noticed was that if I put a NULL timeout parameter into select() in the main thread in which I instantiate the C# \"session\" object, that no asynchronous callbacks are made at all for their .NET sockets.  If I use a time-out of, say, 1-second, and no other activity happens on my non-async sockets, then no async-socket callbacks are delivered until select() times out.</p>\n\n<p>Somehow, select() is preventing the callbacks to happen for the .NET sockets.  How do I avoid this?  Is there some alternative polling method I can use for the old sockets that would still allow the .NET sockets to have their asynchronous callbacks delivered?</p>\n"},{"tags":["windows","winapi","multiprocessing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":11942856,"title":"windows 7 does not allow creation of more than 2 groups in an 8 core system","body":"<p>I have a intel r xeon r cpu w3565 system. I am running a 64 bit windows 7 on top of it.</p>\n\n<p>with no group awareness the task manager shows 8 logical cores as needed(4 cores and 8 threads).</p>\n\n<p>Now if I need 4 groups with 2 prcessors each I did this:</p>\n\n<p>bcdedit/set groupsize 2  and restarted my machine. I could see 2 groups with 2 logical processors each.\nI also ran a small test program :</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n\nint main(int argc, char *argv[]) {   \n    WORD numProcs = 0,i;    \n    int sum=0;\n    numProcs = GetActiveProcessorGroupCount();   \n\n    for(i=0;i&lt;numProcs;i++)\n    {\n         int procs;\n         procs =GetActiveProcessorCount(i);         \n         printf(\"\\ngroup %d count :%d\\n\",i,procs);       \n         sum += procs;   \n    }   \n    printf(\"numProcs: %d\\n\", sum);    char abc;    scanf(\"\\n%c\",&amp;abc);   \n    return 0; \n}\n</code></pre>\n\n<p>Which also gave core count as 4. earlier this gave it as 8(without group awareness on)</p>\n\n<p>Now if I set group size to 4 I get 2 groups with 4 cores each. and my test program output is 8 this time.</p>\n\n<p>I then set groupsize to 1 and this time I again got 2 groups with a single logical core in each core.</p>\n\n<p>I am unable to understand why windows cannot expand the number of groups to 4 when actually the documentation says that it can go max uptil 4.</p>\n\n<p>Any idea what I am missing here?</p>\n"},{"tags":["winapi","openssl"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":533,"score":0,"question_id":4302179,"title":"PRIVATEKEYBLOB to RSA struct of OpenSSL","body":"<p>how can i convert Microsoft exported key in privatekeyblob to struct RSA, which can be used with openSSL?</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":123,"score":0,"question_id":11941858,"title":"Call function in another class from Win32 wrapper WndProc","body":"<p>I have a win32 wrapper class with a functioning WndProc (i use a static wndproc to forward messages to the WndProc member function).</p>\n\n<p>I also have another app class which creates an instance of my win32 wrapper class.</p>\n\n<p>I want the user of the app class to be able to write their own functions that represent events, such as OnMouseClick(), or OnMouseMove(), but in order for this to work, I need to call the event functions from the win32 wrapper class's Wndproc (which has no knowledge of the app class).</p>\n\n<p>What's the best way to do this? Should I send a pointer to each event function to my win32 wrapper class, and call it via pointer? Or is there a better way?</p>\n"},{"tags":["winapi","windows-ce"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":240,"score":1,"question_id":1951886,"title":"What is alphablend and what functions are used for it?","body":"<p>What is alphablend and what functions are used for it?</p>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":11939290,"title":"How do I find out if my program has a certain DLL already loaded?","body":"<p>I'm working on a program with a plugin-based architecture.  All the plugins are DLLs, and some of them can have dependencies on other plugin DLLs.  I'd like to be able to do the following:</p>\n\n<ul>\n<li>At program startup time, scan the plugins folder.</li>\n<li>For each plugin found, check if that plugin is already loaded.  (Which it could be, if a previously-loaded plugin caused it to be loaded as a dependency).</li>\n<li>If not, load it.</li>\n</ul>\n\n<p>The first and third steps are trivial, but how do I do the second?  Is there a winapi call that, given a filename of a DLL, will tell me if that DLL is currently loaded into the current process?  (Or perhaps one that takes a filename and a process handle?)</p>\n\n<p>Please, no answers saying \"just load it anyway.\"  I know that will work. I'm trying to avoid that.</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":131,"score":1,"question_id":11938083,"title":"C++/Win32 Create a file in virtual memory","body":"<p>How do I create a file in virtual memory and can I use normal file functions on it as CreateFile, WriteFile etc. ?</p>\n\n<p>I am trying to implement a buffered file writer class, but the problem is managing a buffer that needs dynamic constant reallocation.</p>\n"},{"tags":["winapi","contextmenu","idle"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":11938282,"title":"do other tasks when a context menu is shown (hence WM_ENTERIDLE is sent)","body":"<p>In firefox, after users right click at a tab item and the context menu is shown, if he moves the mouse to another tab item, the \"another\" tab item will be highlighted. But in IE, the \"another\" tab item won't be highlighted, and the same as in many WIN32 applications with tab control.</p>\n\n<p>I think this is because the <code>WM_ENTERIDLE</code> message is sent. For <code>dialog box</code>, we have <code>DS_NOIDLEMSG</code> style to suppress the <code>WM_ENTERIDLE</code> message.</p>\n\n<p>Do we have similar style for context menu? Or could the app continue to execute tasks even the context menu is shown?</p>\n"},{"tags":["windows","winapi","file-io","ntfs"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":114,"score":2,"question_id":11934550,"title":"Get file offset on disk/cluster number","body":"<p>I need to get any information about where the file is physically located on the NTFS disk. Absolute offset, cluster ID..anything.\nI need to scan the disk twice, once to get allocated files and one more time I'll need to open partition directly in RAW mode and try to find the rest of data (from deleted files). I need a way to understand that the data I found is the same as the data I've already handled previously as file. As I'm scanning disk in raw mode, the offset of the data I found can be somehow converted to the offset of the file (having information about disk geometry). Is there any way to do this? Other solutions are accepted as well.\nNow I'm playing with FSCTL_GET_NTFS_FILE_RECORD, but can't make it work at the moment and I'm not really sure it will help.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I found the following function\n<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa364952(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/aa364952(v=vs.85).aspx</a>\nIt returns structure that contains nFileIndexHigh and nFileIndexLow variables.\nDocumentation says</p>\n\n<p><code>The identifier that is stored in the nFileIndexHigh and nFileIndexLow members is called the file ID. Support for file IDs is file system-specific. File IDs are not guaranteed to be unique over time, because file systems are free to reuse them. In some cases, the file ID for a file can change over time.</code></p>\n\n<p>I don't really understand what is this. I can't connect it to the physical location of file. Is it possible later to extract this file ID from MFT?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Found this:\n<code>This identifier and the volume serial number uniquely identify a file. This number can change when the system is restarted or when the file is opened.</code></p>\n\n<p>This doesn't satisfy my requirements, because I'm going to open the file and the fact that ID might change doesn't make me happy.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["c++","winapi","unicode","ascii","stringstream"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":256,"score":0,"question_id":11929662,"title":"wostringstream, Ascii, Unicode, Win32 and integer concatenation to string","body":"<p>I am writing a library that uses Win32 APIs, and I would like to be able to compile it for both ASCII and Unicode (wide character is the <code>type</code>), and I am generating an internal class name (read: WinAPI \"class\") that I am appending an integer to a string to to create unique class names for various windows functions.</p>\n\n<p>The definitions of the variables used:</p>\n\n<pre><code>LPCTSTR lpszClassName;    //  This is char* if ASCII, wchar_t* if Unicode.\n#ifdef UNICODE\nstd::wostringstream Convert;\n#else\nstd::ostringstream Convert;\n#endif\n</code></pre>\n\n<p>The function in question:</p>\n\n<pre><code>void Base::MakeClassName () {\n#ifdef _DEBUG_\n    cerr &lt;&lt; \"Base::MakeClassName() called\\n\";\n#endif\nstatic int name_mod = 0;\nname_mod++;\nlpszClassName = TEXT(\"Win32WinNo\");\nConvert &lt;&lt; lpszClassName &lt;&lt; name_mod;\nlpszClassName = Convert.str().c_str();\n\n#ifdef _DEBUG_\n    cerr &lt;&lt; \"Generated class name = \" &lt;&lt; lpszClassName &lt;&lt; \"\\n\";\n#endif\n}\n</code></pre>\n\n<p>In ASCII, I get <code>Generated class name = Win32WinNo1</code></p>\n\n<p>In Unicode, I get a hex value. Which suggests to me the wide character <code>wostringstream</code> is not doing what I want. Either way, CreateWindow doesn't seem to like it (program hangs, if I debug it, it crashes.)</p>\n\n<p>I am not 100% familiar with stringstream, and going by the limited documentation, it returns a 'string' object, but I need a pointer to a C style string for LPCTSTR, so thus, the <code>Convert.str().c_str()</code>.  What I am getting is not working right, and If I try TEXT(\"Win32WinNo1\") in my RegisterClass and CreateWindow calls, it works, but this returned string from above is junk.</p>\n\n<p>What am I doing wrong? I am also concerned if it is not appending the integer to the string.  does wostringstream covert the integer to wchar_t?</p>\n"},{"tags":["c++","windows","winapi","windows-services","terminalservices"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":11933822,"title":"How to - Windows Multiple-Sessions?","body":"<p>I recently found <a href=\"http://www.windows7hacker.com/index.php/2009/09/how-to-enable-multiple-concurrent-user-in-remote-desktop-windows-7/\" rel=\"nofollow\">this</a> tutorial.</p>\n\n<p>Its about how to make Windows 7 to be like terminal server and multiple users to login via Remote Desktop.\nI was wondering is there way programmatically to create multiple sessions and to run applications on them ?\nLike instead of using RDP, i may want to run TeamViewer directly in new session so the users be able to use TeamViewer without touching RDP.</p>\n\n<p>Please ask for additional information if my question is unclear.</p>\n"},{"tags":["delphi","winapi","registry","delphi-7","object-pascal"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":229,"score":2,"question_id":11931573,"title":"Read REG_BINARY to String","body":"<p>I use this code to read binary data from the registry to a string</p>\n\n<pre><code>function ReadBinary (RootKey: HKEY; SubKey,ValueName: WideString; var Data : String): Bool;\nvar\n  Key     : HKey;\n  Buffer  : array of char;\n  Size    : Cardinal;\n  RegType : DWORD;\nbegin\n  result  := FALSE;\n  RegType := REG_BINARY;\n  if RegOpenKeyExW(RootKey, pwidechar(SubKey), 0, KEY_READ, Key) = ERROR_SUCCESS then begin\n    if RegQueryValueExW(Key,pwidechar(ValueName),NIL,@RegType, NIL,@Size) = ERROR_SUCCESS then begin\n      SetLength (Buffer, Size + 1);\n      FillChar(Buffer, SizeOf (Buffer), #0);\n      if RegQueryValueExW(Key,pwidechar(ValueName),NIL,@RegType, @Buffer[0],@Size) = ERROR_SUCCESS then begin\n        result := TRUE;\n        Data := String (Buffer); // Shows empty or sometimes 1 random char.\n      end;\n    end;        \n  end;\n  RegCloseKey (Key);\nend;\n</code></pre>\n\n<p>EDIT2:</p>\n\n<p>It works fine with a fixed declared array of byte/char</p>\n\n<pre><code>function ReadBinary (RootKey: HKEY; SubKey,ValueName: WideString; var Data : String): Bool;\nvar\n  Key     : HKey;\n  Buffer  : array [0..200] of char;\n  Size    : Cardinal;\n  RegType : DWORD;\nbegin\n  result  := FALSE;\n  RegType := REG_BINARY;\n  if RegOpenKeyExW(RootKey, pwidechar(SubKey), 0, KEY_READ, Key) = ERROR_SUCCESS then begin\n    if RegQueryValueExW(Key,pwidechar(ValueName),NIL,@RegType, NIL,@Size) = ERROR_SUCCESS then begin\n      FillChar(Buffer, SizeOf (Buffer), #0);\n      if RegQueryValueExW(Key,pwidechar(ValueName),NIL,@RegType, @Buffer,@Size) = ERROR_SUCCESS then begin\n        result := TRUE;\n        Data   := String (Buffer);\n      end;\n    end;        \n  end;\n  RegCloseKey (Key);\nend;\n</code></pre>\n\n<p>I'm stuck.\nWhat do I do wrong and what is the solution?</p>\n\n<p>Thank you for your help.</p>\n\n<p>EDIT:</p>\n\n<p>I am aware of that I am reading binary data from the registry. So it might be already 0 terminated and can return false results. I can guarantee that there are no #0 chars in the binary data because I wrote a long text (String with CR/LF) in the Value before.</p>\n"},{"tags":["visual-studio-2010","winapi","localization"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":11933064,"title":"MUIRCT & VS10. ERROR: The source file has multilingual resources","body":"<p>I followed the sample from <a href=\"http://msdn.microsoft.com/en-us/libr...=vs.85%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/libr...=vs.85%29.aspx</a> .\nSetting Resource View with right-click at String Table into ru-RU, .rc generated code is the following:</p>\n\n<pre><code>// Microsoft Visual C++ generated resource script.\n//\n#include \"resource1.h\"\n\n#define APSTUDIO_READONLY_SYMBOLS\n/////////////////////////////////////////////////////////////////////////////\n//\n// Generated from the TEXTINCLUDE 2 resource.\n//\n#include \"afxres.h\"\n\n/////////////////////////////////////////////////////////////////////////////\n#undef APSTUDIO_READONLY_SYMBOLS\n\n/////////////////////////////////////////////////////////////////////////////\n// Russian resources\n\n#if !defined(AFX_RESOURCE_DLL) || defined(AFX_TARG_RUS)\nLANGUAGE LANG_RUSSIAN, SUBLANG_NEUTRAL\n\n/////////////////////////////////////////////////////////////////////////////\n//\n// String Table\n//\n\nSTRINGTABLE\nBEGIN\nHELLO_MUI_STR_0 \"Привет\"\nEND\n\n#endif // Russian resources\n/////////////////////////////////////////////////////////////////////////////\n\n\n/////////////////////////////////////////////////////////////////////////////\n// Russian (Russia) resources\n\n#if !defined(AFX_RESOURCE_DLL) || defined(AFX_TARG_RUS)\nLANGUAGE LANG_RUSSIAN, SUBLANG_DEFAULT\n\n#ifdef APSTUDIO_INVOKED\n/////////////////////////////////////////////////////////////////////////////\n//\n// TEXTINCLUDE\n//\n\n1 TEXTINCLUDE\nBEGIN\n\"resource1.h\\0\"\nEND\n\n2 TEXTINCLUDE\nBEGIN\n\"#include \"\"afxres.h\"\"\\r\\n\"\n\"\\0\"\nEND\n\n3 TEXTINCLUDE\nBEGIN\n\"\\r\\n\"\n\"\\0\"\nEND\n\n#endif // APSTUDIO_INVOKED\n\n#endif // Russian (Russia) resources\n/////////////////////////////////////////////////////////////////////////////\n\n\n\n#ifndef APSTUDIO_INVOKED\n/////////////////////////////////////////////////////////////////////////////\n//\n// Generated from the TEXTINCLUDE 3 resource.\n//\n\n\n/////////////////////////////////////////////////////////////////////////////\n#endif // not APSTUDIO_INVOKED\n</code></pre>\n\n<p>Using script for MUIRCT from above mentioned link, I get error:\nERROR: The source file has multilingual resources and is not compatible for splitting.</p>\n\n<p>Setting Resource View with right-click at String Table into en-US language, .rc generated code is the following:</p>\n\n<pre><code>// Microsoft Visual C++ generated resource script.\n//\n#include \"resource1.h\"\n\n#define APSTUDIO_READONLY_SYMBOLS\n/////////////////////////////////////////////////////////////////////////////\n//\n// Generated from the TEXTINCLUDE 2 resource.\n//\n#include \"afxres.h\"\n\n/////////////////////////////////////////////////////////////////////////////\n#undef APSTUDIO_READONLY_SYMBOLS\n\n/////////////////////////////////////////////////////////////////////////////\n// Russian (Russia) resources\n\n#if !defined(AFX_RESOURCE_DLL) || defined(AFX_TARG_RUS)\nLANGUAGE LANG_RUSSIAN, SUBLANG_DEFAULT\n\n#ifdef APSTUDIO_INVOKED\n/////////////////////////////////////////////////////////////////////////////\n//\n// TEXTINCLUDE\n//\n\n1 TEXTINCLUDE\nBEGIN\n\"resource1.h\\0\"\nEND\n\n2 TEXTINCLUDE\nBEGIN\n\"#include \"\"afxres.h\"\"\\r\\n\"\n\"\\0\"\nEND\n\n3 TEXTINCLUDE\nBEGIN\n\"\\r\\n\"\n\"\\0\"\nEND\n\n#endif // APSTUDIO_INVOKED\n\n#endif // Russian (Russia) resources\n/////////////////////////////////////////////////////////////////////////////\n\n\n/////////////////////////////////////////////////////////////////////////////\n// English (United States) resources\n\n#if !defined(AFX_RESOURCE_DLL) || defined(AFX_TARG_ENU)\nLANGUAGE LANG_ENGLISH, SUBLANG_ENGLISH_US\n\n/////////////////////////////////////////////////////////////////////////////\n//\n// String Table\n//\n\nSTRINGTABLE\nBEGIN\nHELLO_MUI_STR_0 \"Привет\"\nEND\n\n#endif // English (United States) resources\n/////////////////////////////////////////////////////////////////////////////\n\n\n\n#ifndef APSTUDIO_INVOKED\n/////////////////////////////////////////////////////////////////////////////\n//\n// Generated from the TEXTINCLUDE 3 resource.\n//\n\n\n/////////////////////////////////////////////////////////////////////////////\n#endif // not APSTUDIO_INVOKED\n</code></pre>\n\n<p>With that sciprt is working successfully.</p>\n\n<p>Why? </p>\n"},{"tags":["c","winapi"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":405,"score":2,"question_id":6734095,"title":"How to get Module HANDLE from func ptr in Win32?","body":"<p>I'm working on native call bindings for a virtual machine, and one of the features is to be able to look up standard libc functions by name at runtime. On windows this becomes a bit of a hassle because I need to get a handle to the msvcrt module that's currently loaded in the process. Normally this is msvcrt.dll, but it could be other variants as well (msvcr100.dll, etc) and a call to GetModuleHandle(\"msvcrt\") could fail if a variant with a different name is used.</p>\n\n<p>What I would like to be able to do is a reverse lookup, take a function pointer from libc (which I have in abundance) and get a handle to the module that provides it. Basically, something like this:</p>\n\n<pre><code>HANDLE hlibc = ReverseGetModuleHandle(fprintf); // Any func from libc should do the trick\nvoid *vfunc = GetProcAddress(hlibc);\n</code></pre>\n\n<p>Is there such a thing in the win32 API, without descending into a manual walk of process handles and symbol tables? Conversely, if I am over-thinking the problem, is there an easier way to look up a libc function by name on win32?</p>\n"},{"tags":["windows","winapi","scrollbar"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":11747721,"title":"How to set nTackPos value for scrollbar","body":"<p>How to set <code>nTrackPos</code> value for the scrollbar? The <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb787595%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>SetScrollInfo</code></a> function ignores it.</p>\n"},{"tags":["c++","winapi","windows-8","screensaver","usermode"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":11928953,"title":"SystemParametersInfo and ERROR_OPERATION_IN_PROGRESS","body":"<p>I'm coding this user-mode executable that can be run from a local service on a Windows platform in a context of logged in users. Its main purpose is to configure a desktop of all logged in users. It calls the following API to set up screensaver:</p>\n\n<pre><code>if(!SystemParametersInfo(SPI_SETSCREENSAVETIMEOUT, nTimeoutSec, 0, 0))\n{\n    //Error\n    GetLastError();\n}\n\nif(!SystemParametersInfo(SPI_SETSCREENSAVEACTIVE, nActive, 0, 0))\n{\n    //Error\n    GetLastError();\n}\n</code></pre>\n\n<p>The code above works in most cases, except at times when I have more than one user logged on to the Windows console I get this weird error ERROR_OPERATION_IN_PROGRESS. I looked up the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms724947%28v=vs.85%29.aspx\" rel=\"nofollow\">documentation</a> and it has this explanation:</p>\n\n<blockquote>\n  <p>If the machine has entered power saving mode or system lock state, an\n  ERROR_OPERATION_IN_PROGRESS exception occurs.</p>\n</blockquote>\n\n<p>OK, but how shall I treat this error?</p>\n\n<p>PS. This happens most often on Windows 8.</p>\n"},{"tags":["c++","winapi","windows-8","screensaver"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":11930827,"title":"Is it possible to make a Windows screensaver without Scrnsave.lib?","body":"<p>I coded a Windows screensaver using C++/WinAPIs some time ago but now when I try it on Windows 8 at a logon screen (when no users are yet logged in) it doesn't seem to work. It is clearly a bug in Windows 8, because when I reboot the system my screensaver begins to work just fine. (Note that this behavior never happened on any previous version of Windows.)</p>\n\n<p>What happens is that when the screensaver starts, the screen turns black and nothing happens after that moment. Obviously I can't debug it with the Visual Studio, so I added a trace statement into the first line where it should begin executing in WM_CREATE in ScreenSaverProc() but that line never gets called when the screensaver hangs up like I described above.</p>\n\n<p>This tells me that some initialization code hangs up before the WM_CREATE message is sent, but to fix that I do not have access to that code because <a href=\"http://msdn.microsoft.com/en-us/library/cc144066%28v=vs.85%29.aspx\" rel=\"nofollow\">Microsoft's tutorial on WinAPI screensavers</a> instructs to link to Scrnsave.lib (or ScrnsavW.lib in my case.)</p>\n\n<p>So I was wondering, is there any way to build a WinAPI screensaver without using Scrnsave.lib?</p>\n"},{"tags":["c++","api","winapi","x64"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":11928583,"title":"_WIN64 is not defined in x64 project","body":"<p>I'm using VS2008 and the project properties are set for (active) x64</p>\n\n<p>and the weird thing is _WIN64 is not defined and WPARAM and LPARAM are still 32-bit.</p>\n\n<p>Should I define _WIN64 manually?</p>\n\n<p>If so, where should I put #define _WIN64? Preprocessor setting doesn't seem to work.</p>\n\n<p>I'm quite certain it's compiled as x64 because in task manager the exe has no *32 postfix.</p>\n"},{"tags":["c++","winapi","windows-8","username","sessionid"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":243,"score":0,"question_id":11927625,"title":"Get logged on user's name or email on Windows 8 using C++ and WinAPIs","body":"<p>On Windows 7 to retrieve the name of a logged on user I can do this:</p>\n\n<pre><code>LPTSTR pUserName = NULL;\nDWORD dwcbSzUserName = 0;\n\n//'dwSessID' = user session ID\nif(WTSQuerySessionInformation(WTS_CURRENT_SERVER_HANDLE, dwSessID, WTSUserName, &amp;pUserName, &amp;dwcbSzUserName))\n{\n    //Got user name in 'pUserName'\n}\n\nif(pUserName)\n    WTSFreeMemory(pUserName);\n</code></pre>\n\n<p>But on Windows 8 it returns some abbreviated name, for instance, \"john_000\" when the actual user's name is \"John A. Doe\".</p>\n\n<p>So what is the way to retrieve the name of the logged on user (and possibly their email) on Windows 8 with C++ using WinAPIs as it's shown at log-on screen?</p>\n"},{"tags":["c","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":11926917,"title":"Temporarily capture stdout of a console app in Windows","body":"<p>Is it possible (and if so, how?) to redirect <code>stdout</code> (and, optionally, stderr) temporarily to a file, and later recover the original <code>stdout</code>?</p>\n\n<p>In a POSIX environment, I use <code>dup</code> and <code>dup2</code> to store and replace <code>STDOUT_FILENO</code>. <code>freopen</code> isn't a good solution, since <code>stdout</code> cannot be recovered that way.</p>\n\n<p>Is it possible to do this with the Windows API? I believe it is possible using the POSIX-like functions <code>_DUP</code> and <code>_DUP2</code>. Is there a solution that doesn't involve them?</p>\n"},{"tags":["c++","winapi","virtual-memory"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":11911303,"title":"Can CreateThread interfere with VirtualAlloc usage?","body":"<p>Is it possible for stack space allocated by <code>CreateThread</code> to interfere with the usage of <code>VirtualAlloc</code>? I can't find any discussion or documentation explaining precisely where stack space is allowed to be allocated...</p>\n\n<p>The following more precisely illustrates my question:</p>\n\n<pre><code>uint8_t *baseA = (uint8_t*)VirtualAlloc(NULL,1,MEM_RESERVE,PAGE_NOACCESS);\n\n// Create a thread with the default stack size\nHANDLE hThread = CreateThread(NULL,0,SomeThreadProc,NULL,NULL,NULL);\n\n// Possibly create even more threads here.\n\n// Can this ever fail in the absence of other allocators? It doesn't here...\nuint8_t *baseB = (uint8_t*)VirtualAlloc(NULL,1,MEM_RESERVE,PAGE_NOACCESS);\n\n// Furthermore, in this test, baseB-baseA == 65536 (unless the debugger did something),\n// so nothing appeared between baseA and baseB... not even enough space for the\n// full 64kb of wastage, as baseA points to 4096 bytes by itself\n</code></pre>\n\n<p>If it <i>does</i> in fact use some analogue of <code>VirtualAlloc</code>, is there a way to change how Windows allocates stack space in a given process?</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":132,"score":0,"question_id":11923925,"title":"Disable horizontal scroll bar in list view","body":"<p>I have a list view where I want to disable the horizontal scroll bar.</p>\n\n<p>Basically, I know none of my data will exceed the width of the single column, but if enough entries get added to the list view, the vertical scroll bar pops up, reducing the width available, making the horizontal scroll bar pop up.</p>\n\n<p><strike>I was thinking about some how catching a message right before the vertical scroll bar gets added, and then re-sizing the column to make enough room, but I don't know what message I would need to catch to do this.</strike></p>\n\n<p><strong>EDIT:</strong><br>\nDoes anyone know if there is a message sent after an item in a list view is deleted? <code>LVN_ITEMCHANGED</code> appeared to only be sent after an item is added. And <code>LVN_DELETEITEM</code> only before an item is deleted.</p>\n"},{"tags":["winapi","memory","process","stack","heap"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":11925397,"title":"windows stack and heap address ranges","body":"<p>Working with Linux until now where stack addresses are very high and heap addresses\nare pretty low (as seen by printing heap and stack addresses using a C program),\nI have a problem with the win32 process memory layout. It says in msdn that stack \naddresses are higher than heap addresses, but from what I saw in practice, stack addresses\nare lower than heap addresses. So I am confused. Someone please explain.</p>\n"},{"tags":["c++","winapi","mfc"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":242,"score":0,"question_id":11924133,"title":"Code injection in a MFC application","body":"<p>I have a Win32 application that gets the HANDLE of a MFC application. My goal is to force the MFC program not to display ASSERT error message box.</p>\n\n<p>Basically, I have made a prototype that allows my Win32 application to force the MFC application to show a message box, just to check if the idea is possible. Now I need to force the MFC application not to display such ASSERT error message boxes.</p>\n\n<p>Is that possible?</p>\n"},{"tags":["c++","winapi","pointers","handle","format-specifiers"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":96,"score":1,"question_id":11719489,"title":"Can I output a Windows handle using %p specifier?","body":"<p>This is a kind of follow-up to <a href=\"http://stackoverflow.com/q/11688162/57428\">this question</a>. Windows SDK features <code>HANDLE</code> datatype that is defined in <code>WinNT.h</code> as follows:</p>\n\n<pre><code>typedef void *HANDLE;\n</code></pre>\n\n<p>This datatype is used to represent handles. Technically a handle is not a pointer - it's magic value that can only be used with Win32 functions. Yet it is declared to be represented with a datatype that is a <code>void*</code> typedef.</p>\n\n<p>If I want to output the handle hex value with the following code:</p>\n\n<pre><code>HANDLE handle = ...;\nprintf(\"%p\", handle);\n</code></pre>\n\n<p>will it be legal?</p>\n"},{"tags":["c++","winapi","debugging","windbg"],"answer_count":2,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":2187,"score":7,"question_id":4849530,"title":"Creating minidump for access violation exception using SetUnhandledExceptionFilter()","body":"<p>I am using the following code to create a minidump file whenever there is a structured exception generated from my code:</p>\n\n<pre><code>void CreateMiniDump( EXCEPTION_POINTERS* pep ) \n{\n  // Open the file \ntypedef BOOL (*PDUMPFN)( \n  HANDLE hProcess, \n  DWORD ProcessId, \n  HANDLE hFile, \n  MINIDUMP_TYPE DumpType, \n  PMINIDUMP_EXCEPTION_INFORMATION ExceptionParam, \n  PMINIDUMP_USER_STREAM_INFORMATION UserStreamParam, \n  PMINIDUMP_CALLBACK_INFORMATION CallbackParam\n);\n\n\n    HANDLE hFile = CreateFile( _T(\"C:/temp/MiniDump.dmp\"), GENERIC_READ | GENERIC_WRITE, \n    0, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL ); \n\n    HMODULE h = ::LoadLibrary(L\"DbgHelp.dll\");\n    PDUMPFN pFn = (PDUMPFN)GetProcAddress(h, \"MiniDumpWriteDump\");\n\n  if( ( hFile != NULL ) &amp;&amp; ( hFile != INVALID_HANDLE_VALUE ) ) \n  {\n    // Create the minidump \n\n    MINIDUMP_EXCEPTION_INFORMATION mdei; \n\n    mdei.ThreadId           = GetCurrentThreadId(); \n    mdei.ExceptionPointers  = pep; \n    mdei.ClientPointers     = TRUE; \n\n    MINIDUMP_TYPE mdt       = MiniDumpNormal; \n\n    BOOL rv = (*pFn)( GetCurrentProcess(), GetCurrentProcessId(), \n      hFile, mdt, (pep != 0) ? &amp;mdei : 0, 0, 0 ); \n\n\n\n    // Close the file \n\n    CloseHandle( hFile ); \n\n  }\n\n}\n\nLONG WINAPI MyUnhandledExceptionFilter(\n struct _EXCEPTION_POINTERS *ExceptionInfo\n)\n {\n     CreateMiniDump(ExceptionInfo);\n     return EXCEPTION_EXECUTE_HANDLER;\n }\n</code></pre>\n\n<p>And I am doing <code>SetUnhandledExceptionFilter(MyUnhandledExceptionFilter);</code> from the main entry point of my app ( I am not setting it for each thread though). After this to test this code I did the following to generate an access violation: <code>int* p = 0; *p = 0;</code> The dump file did get generated. Then I used windbg and opened the dump file and used <code>.ecxr</code> command to get the exception record. However, no information is coming there (i.e. I am not getting the call stack).  Also if I use <code>!analyze -v</code> command then it is able to show the line where the crash occured. Does anybody know what I am missing and how to solve this?</p>\n\n<p>BTW, I am using VC7 compiler with /EHa (asynchronuos exception model) flag.</p>\n"},{"tags":["c","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":11922741,"title":"Prevent the \"program stopped working\" message on a CreateProcess","body":"<p>I create a child with CreateProcess and wait for it to finish. This process is very likely to crash. Is it possible to prevent the \"%PROGRAMNAME% stopped working\" dialog for the child?</p>\n"},{"tags":["windows","winapi","multiprocessing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":11922777,"title":"GetNativeSystemInfo() and processor groups","body":"<p>Does the dwNumberOfProcessors member of SYSTEM_INFO populated by the GetNativeSystemInfo() function count all logical cores, or only those in the first processor group?</p>\n"},{"tags":["c++","winapi","bitmap","rotation","dib"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":11917466,"title":"What is the most efficient method of orthogonally rotating a device-independent bitmap (DIB) for display in a window?","body":"<p>I'm writing some code which takes a bitmap from an attached webcam, rotates it either 90, 180 or 270 degrees clockwise and displays it in a window.</p>\n\n<p>The bitmap is originally supplied as a device independent bitmap. What is the most efficient series of calls (in terms of copying memory) that would allow me to go from source (bitmap) to destination (rotated on screen)?</p>\n\n<p>I'm using C++ and Win32 API.</p>\n"},{"tags":["c#","winapi","pinvoke","uac"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":153,"score":3,"question_id":11922260,"title":"How to force an app to not be run as administrator","body":"<p>Is it possible to disable run as administrator for an app alowing it just to be run as local user.</p>\n"},{"tags":["c#","winapi","usb","gsm","tapi"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":317,"score":2,"question_id":11921630,"title":"Is it possible to make calls and receive calls using USB GSM Modem from a TAPI (TAPI 2.x or TAPI 3.x) application?","body":"<p>The USB modem has default software with the driver for PC to make calls and to receive calls which work fine. I want to program it myself if possible with Telephony API so that I have more control and I can process the voice data.</p>\n\n<p>Moreover, there is sample application in codeproject(http://www.codeproject.com/Articles/10994/TAPI-3-0-Application-development-using-C-NET) I tried too. However, the code gave an error saying a dll is too old.\nChanging this line,</p>\n\n<pre><code>bcc = ln.CreateCall(textBox1.Text,TapiConstants.LINEADDRESSTYPE_PHONENUMBER|TapiConstants.LINEADDRESSTYPE_IPADDRESS,TapiConstants.TAPIMEDIATYPE_DATAMODEM|TapiConstants.TAPIMEDIATYPE_AUDIO);\n</code></pre>\n\n<p>to this,</p>\n\n<pre><code>bcc = ln.CreateCall(textBox1.Text, TapiConstants.LINEADDRESSTYPE_PHONENUMBER, TapiConstants.TAPIMEDIATYPE_AUDIO);\n</code></pre>\n\n<p>I had been able to compile and run the application. Whenever, I select the modem line and press call providing a number it gets disconnected just after dialing. Hence, I have misgivings whether this TAPI application had a different purpose and may not work with USB GSM Modems.</p>\n"},{"tags":["c++","c","api","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":142,"score":0,"question_id":11920195,"title":"Win32 API check if current window is dialog or normal window","body":"<p>I'm dealing with win32 api subclass. My issue is I don't know my subclass procedure is running on a dialog or a \"normal window\". Can anyone tell me how can I determine current window is a dialog or a normal window?</p>\n"},{"tags":["c#","c++","winapi","opengl","directx"],"answer_count":3,"favorite_count":1,"up_vote_count":5,"down_vote_count":1,"view_count":584,"score":4,"question_id":11810854,"title":"OpenGL/DirectX Hook - Similar to FRAPS","body":"<p>Is it possible to detect what applications are using OpenGL or DirectX similar to what FRAPS does? (Possibly using some form of hook)? I probably won't need to actually draw to the window, I just need to know what processes are doing some form of 3D rendering for the time being.</p>\n\n<p>(Edit:)\nIn case you are not familiar with it, FRAPS is a program that can be used to draw a \"Frame-per-second\" counter on a 3D application. FRAPS finds all running 3D applications by itself without needing you to specify the process name. </p>\n\n<p>Example of \"Frame Per second\" counter drawn to external game:\n<img src=\"http://i.stack.imgur.com/eZFNq.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["vb.net","winapi","windows-7","windows-screensaver"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":11730359,"title":"Using SPI_SETSCREENSAVESECURE doesn't enable password protection for the Windows screensaver","body":"<p>When I run the following line of code, my screensaver's password protection isn't enabled. I've also checked the registry key that used to control password protection and it doesn't get toggled either.</p>\n\n<pre><code>    If SystemParametersInfo(SPI_SETSCREENSAVESECURE, 1, nullVar, SPIF_SENDWININICHANGE) = 0 Then\n        Throw New WindowsDotHException(ErrorToString(Err.LastDllError()) &amp; \" (Error number \" &amp; Err.LastDllError &amp; \")\")\n    End If\n</code></pre>\n\n<p>Context:</p>\n\n<p>WindosDotHException is my way of handling error codes from SystemParametersInfo.</p>\n\n<pre><code>    ' Signatures for unmanaged calls\n&lt;DllImport(\"user32.dll\", CharSet:=CharSet.Auto)&gt; _\nPrivate Shared Function SystemParametersInfo(uAction As Integer, uParam As Integer, ByRef lpvParam As Integer, flags As Integer) As Boolean\nEnd Function\n\n&lt;DllImport(\"user32.dll\", CharSet:=CharSet.Auto)&gt; _\nPrivate Shared Function SystemParametersInfo(uAction As Integer, uParam As Integer, ByRef lpvParam As Boolean, flags As Integer) As Boolean\nEnd Function\n\n&lt;DllImport(\"user32.dll\", CharSet:=CharSet.Auto)&gt; _\nPrivate Shared Function PostMessage(hWnd As IntPtr, wMsg As Integer, wParam As Integer, lParam As Integer) As Integer\nEnd Function\n\n&lt;DllImport(\"user32.dll\", CharSet:=CharSet.Auto)&gt; _\nPrivate Shared Function OpenDesktop(hDesktop As String, Flags As Integer, Inherit As Boolean, DesiredAccess As UInteger) As IntPtr\nEnd Function\n\n&lt;DllImport(\"user32.dll\", CharSet:=CharSet.Auto)&gt; _\nPrivate Shared Function CloseDesktop(hDesktop As IntPtr) As Boolean\nEnd Function\n\n&lt;DllImport(\"user32.dll\", CharSet:=CharSet.Auto)&gt; _\nPrivate Shared Function EnumDesktopWindows(hDesktop As IntPtr, callback As EnumDesktopWindowsProc, lParam As IntPtr) As Boolean\nEnd Function\n\n&lt;DllImport(\"user32.dll\", CharSet:=CharSet.Auto)&gt; _\nPrivate Shared Function IsWindowVisible(hWnd As IntPtr) As Boolean\nEnd Function\n\n&lt;DllImport(\"user32.dll\", CharSet:=CharSet.Auto)&gt; _\nPublic Shared Function GetForegroundWindow() As IntPtr\nEnd Function\n\n' Callbacks\nPrivate Delegate Function EnumDesktopWindowsProc(hDesktop As IntPtr, lParam As IntPtr) As Boolean\n\n' Constants\nPrivate Const SPI_GETSCREENSAVERACTIVE As Integer = 16\nPrivate Const SPI_SETSCREENSAVERACTIVE As Integer = 17\nPrivate Const SPI_GETSCREENSAVERTIMEOUT As Integer = 14\nPrivate Const SPI_SETSCREENSAVERTIMEOUT As Integer = 15\nPrivate Const SPI_GETSCREENSAVERRUNNING As Integer = 114\nPrivate Const SPIF_SENDWININICHANGE As Integer = 2\nPrivate Const SPI_SETSCREENSAVESECURE As Integer = 119\n\nPrivate Const DESKTOP_WRITEOBJECTS As UInteger = &amp;H80\nPrivate Const DESKTOP_READOBJECTS As UInteger = &amp;H1\nPrivate Const WM_CLOSE As Integer = 16\n</code></pre>\n\n<p>Operating system: Windows 7 32-bit edition</p>\n\n<p>Language: VB .Net</p>\n\n<p>Things I've tried:</p>\n\n<ul>\n<li>Rebooting the computer</li>\n<li>logging off and logging back on after running the code</li>\n</ul>\n\n<p>What can I do to enable password protection in Windows 7?</p>\n"},{"tags":["c++","windows","winapi","monitor","screen-brightness"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":193,"score":6,"question_id":11917617,"title":"Dim screen on Windows with C++","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/8690619/how-to-get-screen-resolution-in-c\">How to get screen resolution in C++?</a>  </p>\n</blockquote>\n\n\n\n<p>I've been looking into dimming a screen on a Windows platform from my program. I know that there's a SetMonitorBrightness API that allows this, but the issue for me is that it would be nice to be able to dim the screen on Windows XP as well (which that API does not support) and also dim screens on desktop computers.</p>\n\n<p>So I did some research and found <a href=\"http://www.whitsoftdev.com/powerdimmer/\" rel=\"nofollow\">this utility</a> that seems to dim my screen on a Windows XP desktop without a problem. I tried to contact the author to find out how they implemented the dimmer but I did not hear back from them.</p>\n\n<p>So I was curious to hear from developers on this site, how do you think they managed to dim the screen when the SetMonitorBrightness API is not supported?</p>\n\n<p>PS. I am a newbie developer myself trying to write an energy saving program for our small business. It is a nonprofit organization and we don't have funds to hire a Windows developer to do this for us. Most of our computers are Windows XP desktops, so as you can see I can't use SetMonitorBrightness API as it is widely documented on the web.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c++","windows","winapi","guid"],"answer_count":4,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":1823,"score":6,"question_id":1327157,"title":"What's the C++ version of Guid.NewGuid()?","body":"<p>I need to create a <code>GUID</code> in an unmanaged windows C++ project.  I'm used to C#, where I'd use <code>Guid.NewGuid()</code>.  What's the (unmanaged windows) C++ version?</p>\n"},{"tags":["c++","winapi","listview","mfc","items"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":108,"score":1,"question_id":11914971,"title":"c++ ListView - Cannot insert new items after using ListView_DeleteAllItems","body":"<p>I have a ListView control with 4 columns that is initialized in the WM_CREATE proc.</p>\n\n<pre><code>        hListView1 = CreateWindowEx(WS_EX_CLIENTEDGE, WC_LISTVIEW, NULL, WS_CHILD|WS_VSCROLL|WS_HSCROLL|WS_VISIBLE|LVS_REPORT|LVS_SHOWSELALWAYS, 230, 20, 300, 250, hwnd, (HMENU)ID_EDIT1, GetModuleHandle(NULL), NULL);\n        ListView_SetExtendedListViewStyle(hListView1, LVS_EX_FULLROWSELECT | LVS_EX_HEADERDRAGDROP);\n            lvCol.mask = LVCF_FMT | LVCF_WIDTH | LVCF_TEXT | LVCF_SUBITEM;\n        lvCol.fmt = LVCFMT_LEFT;\n\n        lvCol.iSubItem=0;\n        lvCol.cx=30;\n        lvCol.pszText=\"\";\n        ListView_InsertColumn(hListView1, 0, &amp;lvCol);\n\n        lvCol.iSubItem=1;\n        lvCol.cx=150;\n        lvCol.pszText=\"Name\";\n        ListView_InsertColumn(hListView1, 1, &amp;lvCol);\n\n        lvCol.iSubItem=2;\n        lvCol.cx=50;\n        lvCol.pszText=\"Size\";\n        ListView_InsertColumn(hListView1, 2, &amp;lvCol);\n\n        lvCol.iSubItem=3;\n        lvCol.cx=80;\n        lvCol.pszText=\"Modified\";\n        ListView_InsertColumn(hListView1, 3, &amp;lvCol);\n</code></pre>\n\n<p>Then i have a function that will insert the items (it works fine until i call deleteallitems)</p>\n\n<pre><code>...\nLVITEM lvItem;\nj = 0;\nwhile(FindNextFile(hFind,&amp;FindFileData)){\nlvItem.iItem = j;\n        lvItem.iImage = 1;\n        if(FindFileData.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY){\n            lvItem.iImage = 0;\n        }\n        ListView_InsertItem(hListView1, &amp;lvItem);\n        ListView_SetItemText(hListView1, j, 1, FindFileData.cFileName);\n        ListView_SetItemText(hListView1, j, 2, msg1);\n        ListView_SetItemText(hListView1, j, 3, msg2);\n        j++;\n}\n</code></pre>\n\n<p>But then whenever i call </p>\n\n<pre><code>ListView_DeleteAllItems(hListView1);\n</code></pre>\n\n<p>if after i call my function that insert items, my listview is cleared (the columns are still there) but no new items are insered.. \nI heard about indexes that are not cleared but i couldnt figured it out.</p>\n\n<p>Thanks in advance ;-)</p>\n\n<p>Solution : \nAdded </p>\n\n<pre><code>    lvItem.mask = LVIF_IMAGE | LVIF_STATE;\nlvItem.state = 0;\nlvItem.stateMask = 0;\nlvItem.iSubItem = 0;\n</code></pre>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":11916422,"title":"Remove check box in List View for specific items","body":"<p>I'm using the following code to remove the check box next to a specific item in my List View:</p>\n\n<pre><code>LVITEM lvI;\n\nlvI.iItem = i;\nlvI.mask = LVIF_STATE;\nlvI.stateMask = LVIS_STATEIMAGEMASK;\nlvI.state = 0;\n\nSendMessage(hListOutput, LVM_SETITEM, 0, (LPARAM) &amp;lvI);\n</code></pre>\n\n<p>It works, but if I click where the check box used to be it re-appears!</p>\n\n<p>How can I remove the check box on a specific item in my list view, and keep it removed?</p>\n"},{"tags":["c++","c","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":11916124,"title":"Select element which is extended popup menu (submenu)","body":"<p>Since couple weeks I'm trying to figure out how can I select (choose) item on popup menu which is extended to another popup submenu. For example:</p>\n\n<pre><code> HMENU hMenu,hSubMenu;\n hMenu = CreatePopupMenu();\n hSubMenu = CreatePopupMenu();\n AppendMenu(hMenu , MF_POPUP | MF_STRING | MF_ENABLED, (UINT_PTR) hSubMenu, name.c_str()); // this one i want to select and choose on callback\n AppendMenu(hMenu , MF_POPUP | MF_STRING, (UINT_PTR) count, name.c_str());\n</code></pre>\n\n<p>Than I'm trying to get Callback with: <code>WM_MENUSELECT</code> to catch the name of hover element. \nBut when I click on this hSubMenu element - menu don't want disappear, but is still active and extends submenu elements.</p>\n\n<p><code>WM_INITMENUPOPUP</code> will not help. </p>\n\n<p>I just want to close this popup menu when i get message back from <code>WM_MENUSELECT</code>.\n<code>WM_LBUTTONUP</code> doesn't work on popup menu...</p>\n\n<p>Could You give me some advice? I'm coding with pure winapi.</p>\n"},{"tags":["c++","string","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":11914982,"title":"C++/Win32 deprecated string functions: mbstowcs, wcstombs, safe or not safe?","body":"<p>The compiler (VC 2010) keeps complaining about me using them.</p>\n\n<p>In case not safe, please offer simplest replacement.</p>\n"},{"tags":["visual-studio-2010","winapi","dll","rundll32"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":11824055,"title":"Documentation for writting your own dll for Rundll32.exe?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3207365/how-to-use-rundll32-to-execute-dll-function\">How to use Rundll32 to execute DLL Function?</a>  </p>\n</blockquote>\n\n\n\n<p>Where can I find documentation (tutorials, books, etc.) to write my own dll's that can be run with rundll32.exe?</p>\n"},{"tags":["winapi","dllimport","dialogbox","user32"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":11885247,"title":"How do I call the DialogBox() function in the user32.dll?","body":"<p>I'm trying to call the WinAPI function <code>DialogBox()</code>. On the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms645452%28v=vs.85%29.aspx\" rel=\"nofollow\">Microsoft website</a> this function is specified to be in the user32.dll. However, when tried to import this function by declaring it as function to import from a dll, the linker told me it isn't there. Then I tried to find the function with the dependency walker in C:\\Windows\\System32\\user32.dll, but the function wasn't there. (I could see all the other fancy function literals there though.) What can be reasons for that and how can I solve the problem?</p>\n\n<p>I'm using the D programming language. The windows module from the standard library does not import the complete set of functions in the WinAPI. Therefore I sometimes have to import stuff by hand. </p>\n"},{"tags":["windows","winapi","full-text-search"],"answer_count":7,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":813,"score":2,"question_id":84339,"title":"How to implement in-process full text search engine","body":"<p>In one of our commercial applications (Win32, written in Delphi) we'd like to implement full text search. The application is storing user data in some kind of binary format that is not directly recognizable as a text.</p>\n\n<p>Ideally, I'd like to find either an in-process solution (DLL would be OK) or a local server that I could access via TCP (preferably). The API should allow me to submit a textual information to the server (along with the metadata representing the binary blob it came from) and, of course, it should allow me to do a full-text search with at least minimal support for logical operators and substring searching. Unicode support is required.</p>\n\n<p>I found extensive list of search engines on Stack Overflow (<a href=\"http://stackoverflow.com/questions/66922/what-are-some-search-servers-out-there\">What are some Search Servers out there?</a>) but I don't really understand which of those engines could satisfy my needs. I thought of asking The Collective for opinion before I spend a day or two testing each of them.</p>\n\n<p>Any suggestions?</p>\n"},{"tags":["c++","windows","winapi","dll"],"answer_count":6,"favorite_count":3,"up_vote_count":13,"down_vote_count":0,"view_count":4208,"score":13,"question_id":1128150,"title":"Win32 API to enumerate dll export functions?","body":"<p>I found similar questions but no answer to what I am looking for. So here goes:</p>\n\n<p>For a native Win32 dll, is there a Win32 API to enumerate its export function names?</p>\n"},{"tags":["c","windows","winapi","process"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":673,"score":0,"question_id":5321914,"title":"Fetching parent process Id from child process","body":"<p>OS:      windows\nLanguage: C/C++</p>\n\n<p>I create a child process using CreateProcess API. From the child process I need to fetch the parent's process id.</p>\n\n<p>If my process tree have a child and a grand child. I need to fetch the top most parent's process id from the grand child as well.</p>\n"},{"tags":["windows","winapi","vba","vb6"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":111,"score":3,"question_id":11911548,"title":"Simulate windowskey+L in visual basic?","body":"<p>I want to simulate WindowsKey + L (The short cut to lock the console) in visual basic and bind it to a function. So when this function is called it will lock the console.\nCan I do this?</p>\n"},{"tags":["java","winapi","jna"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":173,"score":3,"question_id":11901382,"title":"How to check if a file is readable?","body":"<p>I'm writing Java 6 application and I have to check if a file is readable. However, on Windows canRead() always returns true. So I see that probably, the only solution could be some native solution based on winapi and written in jna. But, there is another problem, because it's difficult to find a simple function in winapi which would return information about access to a file. I found GetNamedSecurityInfo or GetSecurityInfo but I'm not an advanced winapi programmer and they are too complicated for me in connection with jna. Any ideas how to deal with this problem? </p>\n"},{"tags":["c++","winapi","windows-services","wsh","jscript"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":97,"score":1,"question_id":11854333,"title":"Ways to communicate between JScript and Windows service","body":"<p>I have a Windows local service that may spawn off a process to execute a JScript script (in a .js file) via the Windows Script Host. The issue is that I need to notify my service of the results generated by the script in the .js file. A transfer or a simple 32-bit integer, or a string would suffice. What would be the way to do this?</p>\n\n<p>PS. The code must run on Windows XP SP3 or later OS.</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":99,"score":0,"question_id":11907457,"title":"Creating a child process","body":"<p>c++ on windows\nI have created a child process of cmd.exe but it gets stuck when i'm reading my pipes</p>\n\n<pre><code>HANDLE parent = GetStdHandle(STD_OUTPUT_HANDLE);\nchar buffer[BUFSIZE];\nDWORD read, written;\nBOOL b = true;\n\nfor(;;)\n{\n    b = ReadFile(g_hChildStd_OUT_Rd, buffer, BUFSIZE, &amp;read, NULL);\n    if(! b || read == 0) break;\n\n    b = WriteFile(parent, buffer, read, &amp;written, NULL);\n    if(! b) break;\n}\n</code></pre>\n\n<p>it prints the output from cmd.exe in my console but it hangs in this loop.\ni just need to figure out why it wont break the loop</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":130,"score":1,"question_id":11908262,"title":"Simulating input using the SendInput function","body":"<p>The following program didn't do anything, athough had been expected to simulate pressing \"a\" and \"b\" for each second. Why it doesn't work?   </p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;iostream&gt;\n\nusing namespace std;\n\nconst int INPUTS = 4;\n\nint main()\n{\n    INPUT inputArray[INPUTS];\n\n    INPUT input;\n\n    input.type = INPUT_KEYBOARD;\n\n    //Press 'a' key\n    input.ki.wVk = 0x41;\n    input.ki.wScan = MapVirtualKey(0x41,MAPVK_VK_TO_VSC);\n    inputArray[0] = input;\n\n    //Release 'a' key\n    input.ki.dwFlags = KEYEVENTF_KEYUP;\n    inputArray[1] = input;\n\n\n    //Press 'b' key\n    input.ki.dwFlags = 0;\n    input.ki.wVk = 0x42;\n    input.ki.wScan = MapVirtualKey(0x42,MAPVK_VK_TO_VSC);\n    inputArray[2] = input;\n\n    //Release 'b' key\n    input.ki.dwFlags = KEYEVENTF_KEYUP;\n    inputArray[3] = input;\n\n    Sleep(5000);\n\n    std::cout&lt;&lt;\"GO!!!\\n\";\n\n    for(int i=0; i&lt;100; i++)\n    {\n        SendInput(sizeof(inputArray),inputArray,sizeof(INPUT));\n        Sleep(1000); //Don't remove!\n    }       \n\n    std::cout&lt;&lt;GetLastError()&lt;&lt;std::endl;\n\n    system(\"Pause\");\n    return 0;\n}\n</code></pre>\n\n<p>The last error is </p>\n\n<blockquote>\n  <p>ERROR_NOACCESS</p>\n  \n  <p>998 (0x3E6)</p>\n  \n  <p>Invalid access to memory location.</p>\n</blockquote>\n\n<p>but I don't know what caused it.</p>\n"},{"tags":["c++","debugging","winapi","registry"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1263,"score":1,"question_id":1665588,"title":"Access is Denied for registry","body":"<p>I am playing with the registry programmatically for the first time, and it's not working that well (but at least I haven't destroyed my computer). Specifically, I keep getting back Error 5 (Access is Denied) from RegCreateKeyEx and RegSetValueEx. The thing that is strangest to me is that when <code>HKEY_CURRENT_USER\\Software\\dir1\\Sub Directory</code> already exists, RegCreateKeyEx fails with Error 5, but when it doesn't already exist, it creates it successfully; and then fails on the RegSetValueEx. </p>\n\n<p>Am I doing anything wrong in this code?</p>\n\n<pre><code>BOOL MyDialog::SaveLocationsToRegistry()\n{\n    HKEY   hkey;\n    DWORD  dwDisposition;\n    DWORD dwType, dwSize;\n    LONG result = RegCreateKeyEx(HKEY_CURRENT_USER, TEXT(\"Software\\\\dir1\\\\Sub Directory\"), \n                                 0, NULL, 0, 0, NULL, &amp;hkey, &amp;dwDisposition);\n    if(result == ERROR_SUCCESS)\n    {\n        LPCTSTR szLastFolder = \"C:\\\\Documents and Settings\\\\user\\\\My Documents\\\\Copy of item\\0\";\n        dwType = REG_SZ;\n        dwSize = strlen(szLastFolder)+1;\n        LONG setResult = RegSetValueEx(hkey, TEXT(\"LastFolder\"), 0, dwType, \n        (PBYTE)&amp;szLastFolder, dwSize);\n        RegCloseKey(hkey);\n        return setResult == ERROR_SUCCESS;\n    }\n    else\n    {\n        return false;\n    }\n}\n</code></pre>\n\n<p>Note: The absolute path is only there temporarily. Baby steps ;-)</p>\n"},{"tags":["c#","windows","winapi","keyboard-hook","setwindowshookex"],"answer_count":4,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":690,"score":3,"question_id":6728335,"title":"Is it possible to detect when a low-level keyboard hook has been automatically disconnected by Windows?","body":"<p>I am working on a program that uses keyboard hooks. However, when the PC that the program is running on is just slightly overloaded, it causes Windows to disconnect the hook from the program, causing it to no longer respond to keystrokes.</p>\n\n<p>Is there a way to prevent this, or even better, propose a different way of solving the exact same problem, by using a different architecture, maybe involving a pipeline?</p>\n"},{"tags":["c++","winapi","system","drives"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":201,"score":0,"question_id":11901990,"title":"C++\\Win32 Information about all drives: hard drives, USB drives, disc drives, diskette drives etc","body":"<p>I want to get information about all types of drives in the system: Hard Drives, USB Drives, Disk Drives, Diskette Drives.</p>\n\n<p>About each I want to know: size, free space, file system and whether it is real or emulated.</p>\n\n<p>Hard Drives: internal or external.</p>\n"},{"tags":["c#","windows","winapi","system-tray","idle-processing"],"answer_count":2,"favorite_count":3,"up_vote_count":12,"down_vote_count":0,"view_count":1859,"score":12,"question_id":1037595,"title":"C# - Detect time of last user interaction with the OS","body":"<p>I'm writing a small tray application that needs to detect the last time a user interacted with their machine to determine if they're idle.</p>\n\n<p>Is there any way to retrieve the time a user last moved their mouse, hit a key or interacted in any way with their machine?</p>\n\n<p>I figure Windows obviously tracks this to determine when to display a screen saver or power down, etc, so I'm assuming there's a Windows API for retrieving this myself?</p>\n"},{"tags":["windows","winapi","mingw"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":11901203,"title":"Mingw single exe - for the SetupDiCallClassInstaller","body":"<p>I used \"SetupDiCallClassInstaller\" API to uninstall my modems. And I found this particular API doesnt support windows 64 bit architecture. So I found a solution, by compiling the code in mingw-64 and it works fine. </p>\n\n<p>My question in this  scenario is does mingw provide a way to make a single exe which works in 64bit and 32bit windows? If it is not possible is there anyother alternative solution available to make this API work by using DLLs. </p>\n"},{"tags":["c++","winapi","crash","crash-reports","crash-dumps"],"answer_count":3,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":131,"score":1,"question_id":11479571,"title":"Collect crash .dmp and .hdmp files after a crash of C++ service and a user-mode app","body":"<p>I'm coding in C++/MFC using WinAPIs. My software consists of a local service and a user-mode app that provides user interface for a logged in Windows user. I'm looking for a way to collect .dmp and .hdmp files in case of crash in either of those modules. I know that <a href=\"http://msdn.microsoft.com/en-us/library/bb513641%28v=vs.85%29\" rel=\"nofollow\">WER</a> supposedly collects them and submits them to Microsoft. Is there a way to collect those files and keep them somewhere on the hard drive?</p>\n\n<p>PS. I need this to work under Windows XP SP3, Vista, 7, 8.</p>\n"},{"tags":["delphi","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":251,"score":0,"question_id":11897651,"title":"Best Delphi freeware compiler in user friendliness","body":"<p>I am working on a c++/win32 project and I have some Delphi code from some other (not mine) project that is relevant and I want to convert it to c++ and integrate into my project.</p>\n\n<p>Keep in mind I have no experience with Delphi.</p>\n\n<p>Whats a good and user friendly Delphi complier? command line or GUI don't mind, as long as its clear to use.</p>\n"}]}
{"total":13828,"page":17,"pagesize":100,"questions":[{"tags":["windows","winapi","file-association"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":416,"score":3,"question_id":367141,"title":"How to ask Windows to open an external file based on file association?","body":"<p>Using Win32-specific APIs, is there an easy way to start an external application to open a file simply by passing in the path/name of the file?</p>\n\n<p>For example, say I have a file called C:\\tmp\\image.jpg.  Is there a single API that I can call to tell Windows to open the application associated with .jpg files?  Without having to do a bunch of registry lookups?</p>\n\n<p>I thought I remembered doing this many years ago, but I cannot find it.</p>\n"},{"tags":["winapi","windows-mobile","filetime"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1109,"score":2,"question_id":354151,"title":"How to get file time by name in windows?","body":"<p>Windows has <a href=\"http://msdn.microsoft.com/en-us/library/ms724320(VS.85).aspx\" rel=\"nofollow\">GetFileTime</a> API which allows getting file time information by open file handle. What I wanted to know is, if it is possible to get this information by file name without opening the file explicitly. And if possible is it also applicable to Windows Mobile platform?</p>\n"},{"tags":["c#","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":11788932,"title":"How to check if a Part of a Foreign Window is overlayed","body":"<p>I am building a HUD for Pokerstars to show some related Statistics.</p>\n\n<p>The Overlay is a UserControl : Form and i hide it from statusbar and Alt+T by winapi.\nacutally it has a TopMost, to be always over the Pokertable, but this causes some Sideeffects:</p>\n\n<p>i attached a screnshot to show my problem</p>\n\n<ul>\n<li>1: Everything is OK</li>\n<li>2: just a part of the Pokertable is overlayed by my webbrowser, in this case the HUD shows up (OK!)</li>\n<li>3: The Browser overlayed the area of the Pokertable where the HUD is placed. In this case my HUD should not be TopMost;</li>\n</ul>\n\n<p>Data i have:</p>\n\n<ul>\n<li>IntPtr Handle (of PokerTable)</li>\n<li>Point Position (on the Screen)</li>\n<li>Point Size (from Window)</li>\n</ul>\n\n<p>Which WinAPI function can help ne? anyone knows some examples?\nim sure, that its possible, there are Porgrams (PokerTracker, HoldemManager) which solved this Challenge.</p>\n\n<p>The TopMost im using is to be always on top of the PokerTable. So if the user clicks on it, the HUD may not be overlayed.</p>\n\n<p><img src=\"http://i.imgur.com/L9yxZ.jpg\" alt=\"3 Cases\" title=\"case\"></p>\n\n<hr>\n\n<p>//edit</p>\n\n<p>i did it now with a Timer on 1ms intervalls, its working 60%, has some sideffects. better as nothing</p>\n\n<pre><code>   if (GetForegroundWindow() == TableHandle) {\n            this.TopMost = true;\n        } else {\n            this.TopMost = false;\n        }\n</code></pre>\n\n<hr>\n"},{"tags":["c","winapi","fonts"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":11822157,"title":"How to make EUDC to start effect without rebooting?","body":"<p>I want to Register some user defined character fonts programmatically. According to <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd317836%28v=vs.85%29.aspx\" rel=\"nofollow\">this article</a>, I set up EUDC registry keys and values in my program. But the font does not start to effect. I have to reboot to make the character display correctly. When working with Private Character Editor, the modification made upon characters will start to effect immediately, so there must be some way to notify system to update font without rebooting. Any one knows how to \nachieve this?</p>\n\n<p>By the way, I had tried broadcasting WM_FONTCHANGE message by the following code, but it seems not working...</p>\n\n<pre><code>SendMessage(HWND_BROADCAST, WM_FONTCHANGE, NULL, NULL);\n</code></pre>\n"},{"tags":["c++","winapi","windows-7","windows-shell"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":11500456,"title":"How to modify the PKEY_COPYRIGHT field using IPropertyStore Interface","body":"<p>While trying to modify this field, the IProertyStore::SetValue() returns with an AccessDenied error code. My interface is initialized with the ReadWrite flag.</p>\n\n<p>i've ALSO tried to modify this property while the file's handler remained open, but i received an HRESULT error code from the SHGetPropertyStoreFromParsingName() saying the file is already in use(well, this makes sense :O ?)</p>\n\n<p>just to mention, updating values such as PKEY_TITLE, PKEY_Comment, and so on ended succesfully.</p>\n\n<p>thanks!</p>\n"},{"tags":["c++","visual-studio","winapi","resource-file"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":11879194,"title":"Duplication of TEXTINCLUDE sections in .rc file","body":"<p>In my .rc file I found that I have the 3 TEXTINCLUDE sections repeated twice, with different content. When I open \"Resource Includes\", only the includes from the first 3 sections are shown. I've tweaked the .rc a long time ago, so it maybe is a leftover from that.</p>\n\n<p>Can I safely remove the second 3 sections?</p>\n\n<p>I've pasted this from my .rc file, you can see how the TEXTINCLUDE sections are repeated (i.e. \"3 TEXTINCLUDE\" is followed by \"1 TEXTINCLUDE\".</p>\n\n<pre><code>1 TEXTINCLUDE \nBEGIN\n    \"resource.h\\0\"\nEND\n\n2 TEXTINCLUDE \nBEGIN\n    \"#include \"\"afxres.h\"\"\\r\\n\"\n    \"#include \"\"res/Pngs.h\"\"\\r\\n\"\n    \"#include \"\"res/PngsNag.h\"\"\\0\"\nEND\n\n3 TEXTINCLUDE \nBEGIN\n    \"#include \"\"afxres.rc\"\"      // Standard components\\r\\n\"\n    \"#include \"\"res/MyProject.rc2\"\"\\r\\n\"\n    \"#include \"\"res/Pngs.rc2\"\"\\r\\n\"\n    \"#include \"\"res/PngsNag.rc2\"\"\\0\"\nEND\n\n1 TEXTINCLUDE \nBEGIN\n    \"resource.h\\0\"\nEND\n\n2 TEXTINCLUDE \nBEGIN\n    \"#include \"\"afxres.h\"\"\\r\\n\"\n    \"\\0\"\nEND\n\n3 TEXTINCLUDE \nBEGIN\n    \"#define _AFX_NO_SPLITTER_RESOURCES\\r\\n\"\n    \"#define _AFX_NO_OLE_RESOURCES\\r\\n\"\n    \"#define _AFX_NO_TRACKER_RESOURCES\\r\\n\"\n    \"#define _AFX_NO_PROPERTY_RESOURCES\\r\\n\"\n    \"\\r\\n\"\n    \"#if !defined(AFX_RESOURCE_DLL) || defined(AFX_TARG_ENU)\\r\\n\"\n    \"#ifdef _WIN32\\r\\n\"\n    \"LANGUAGE 9, 1\\r\\n\"\n    \"#pragma code_page(1252)\\r\\n\"\n    \"#endif //_WIN32\\r\\n\"\n    \"#include \"\"res\\\\MyProject.rc2\"\"  // non-Microsoft Visual C++ edited resources\\r\\n\"\n    \"#include \"\"afxres.rc\"\"         // Standard components\\r\\n\"\n    \"#endif\\r\\n\"\n    \"\\0\"\nEND\n</code></pre>\n"},{"tags":["debugging","winapi","windows-8","winrt"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":1,"view_count":283,"score":1,"question_id":11150695,"title":"How does a debugger work for metro apps?","body":"<p>So basically what my trivial research on debuggers lead me to was a debugger works by creating a wrapper around the original process and the process runs within the wrapper.(Not in the scenario where debugger is attached to an already running process). So how does it work for metro apps? Metro apps can only run inside the app container which is allocated to them when they are installed ( actually metro apps are not installed in the true sense) and the mapping between app container and metro app is recorded in a registry key. (All from my research,dont know how correct please correct me if I am wrong). So does the debugger also run within the same app container?</p>\n\n<p>EDIT: A short note on the driving force why I wanted to learn this. I am stuck with <a href=\"http://stackoverflow.com/questions/11135994/waiting-from-a-desktop-app-for-events-originating-from-a-metro-app-and-vice-vers\">this</a>. So I was thinking if I can achieve this IPC by making the desktop app as a debugger (Or automating the debugger, drats this is getting even more creepier) and simulating the communication between metro apps and desktop apps using DebugBreak(From inside the metro app) and Continue statements(From the pseudo debugger app)</p>\n"},{"tags":["c++","multithreading","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":140,"score":0,"question_id":11888938,"title":"Error while multithreading in C++","body":"<p>I am writing to write a program that will make use of multithreading. I tried to read about multithreading and was able to get a sample program working. However I have run into a glitch and I am not sure what is going wrong. I am posting the sample program and will highlight where I am experiencing trouble.</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;process.h&gt;\n#include &lt;iostream&gt;\n#include &lt;cassert&gt;\n#include &lt;ctime&gt;\n\n#import \"calc.dll\" \\\nauto_rename no_namespace no_smart_pointers \\\nraw_native_types named_guids\n\nusing namespace std;\n\nHANDLE  th_mutex;\n\nstruct  Arguments\n{\n    string  case_id;\n\n    string  file;\n};\n//____________________________________\n\nunsigned int __stdcall TestThread(void *args)\n{\n    int i   =   0,\n        j   =   0;\n\n    cout &lt;&lt; \"Inside thread\" &lt;&lt; endl;\n\n    for (i = 0; i &lt;= 10000; i++)\n    {\n        for (j = 0; j &lt;= 100000; j++)\n        {\n        }\n\n        if (i == 10000)\n            cout &lt;&lt; \"The value of i inside the thread = \" &lt;&lt; i &lt;&lt; endl;\n    }\n\n    return  EXIT_SUCCESS;\n}\n//____________________________________\n\nunsigned int __stdcall Thread(void *args)\n{\n    CoInitialize(0);\n    {\n        Arguments   *input;\n\n        input   =   (Arguments *) args;\n\n        time_t  current_time;\n        time(&amp;current_time);\n        cout &lt;&lt; ctime(&amp;current_time) &lt;&lt; endl;\n\n        IHeatExchangerNetwork   *hxNetwork  =   0;\n        IDispatchPtr        theUnit     =   0;\n        IHeatTransferUnit   *unit       =   0;\n\n        VARIANT vAppend;\n\n        _bstr_t filename,\n            output;\n\n        filename    =   input-&gt;file.c_str();\n        filename    +=  input-&gt;case_id.c_str();\n        filename    +=  \".dat\";\n\n        output      =   input-&gt;file.c_str();\n        output      +=  input-&gt;case_id.c_str();\n        output      +=  \".dbo\";\n\n        cout &lt;&lt; filename &lt;&lt; endl;\n        cout &lt;&lt; output &lt;&lt; endl;\n\n        HRESULT hr  =   CoCreateInstance(CLSID_HeatExchangerNetwork,\n                             0,\n                             CLSCTX_ALL,\n                             DIID_IHeatExchangerNetwork,\n                             reinterpret_cast&lt;void**&gt;(&amp;hxNetwork));\n\n        theUnit     =   hxNetwork-&gt;LoadHeatTransferUnit(filename, HxUnitTypeKey::HxUnitTypeCrossflow);\n\n        hr  =   theUnit-&gt;QueryInterface(DIID_IHeatTransferUnit, reinterpret_cast&lt;void**&gt;(&amp;unit));\n\n        hxNetwork-&gt;Run(0, 0);\n\n        vAppend.boolVal = false;\n        unit-&gt;WriteDBOFile(output, OutputData, vAppend);\n\n        time(&amp;current_time);\n        cout &lt;&lt; ctime(&amp;current_time) &lt;&lt; endl;\n    }\n\n    CoUninitialize();\n\n    return  EXIT_SUCCESS;\n}\n//____________________________________\n\nint main()\n{\n    DWORD   retval;\n\n    Arguments   args[2];\n\n    args[0].case_id =   \"1\";\n    args[0].file    =   \"C:\\\\Documents and Settings\\\\User\\\\My Documents\\\\Test Cases\\\\1\\\\\";\n\n    args[1].case_id =   \"2\";\n    args[1].file    =   \"C:\\\\Documents and Settings\\\\User\\\\My Documents\\\\Test Cases\\\\2\\\\\";\n\n    th_mutex    =   CreateMutex(NULL, FALSE, NULL);\n\n    if (th_mutex == NULL) \n    {\n        printf(\"CreateMutex error: %d\\n\", GetLastError());\n        return 1;\n    }\n\n//  ================================\n//  Basic testing of calling threads\n//  ================================\n    HANDLE  hnd1;\n\n    cout &lt;&lt; \"Before creating new thread\" &lt;&lt; endl;\n\n    hnd1    =   (HANDLE) _beginthreadex(NULL, 0, &amp;TestThread, NULL, 0, 0);\n\n    cout &lt;&lt; \"After creating thread\" &lt;&lt; endl;\n\n//  ====================================\n//  Calling Calc routine through threads\n//  ====================================\n    HANDLE  hnd2,\n        hnd3;\n\n    hnd2    =   (HANDLE) _beginthreadex(NULL,\n                                        0, \n                                        &amp;Thread,\n                                        (void *)&amp;args[0],\n                                        0,\n                                        0);\n    hnd3    =   (HANDLE) _beginthreadex(NULL,\n                                        0,\n                                        &amp;Thread,\n                                        (void *)&amp;args[1],\n                                        0,\n                                        0);\n\n    WaitForSingleObject(hnd1, INFINITE);\n    WaitForSingleObject(hnd2, INFINITE);\n    WaitForSingleObject(hnd3, INFINITE);\n\n    GetExitCodeThread(hnd1, &amp;retval); // Gets the return value from the function\n    CloseHandle(hnd1);\n    CloseHandle(hnd2);\n    CloseHandle(hnd3);\n\n    return EXIT_SUCCESS;\n}\n</code></pre>\n\n<p>The problem I am facing is when I execute the program I get the following output</p>\n\n<pre><code>Before creating new thread\nAfter creating threadInside thread\n\nThu Aug 09 10:56:58 2012\nThu Aug 09 10:56:58 2012\n\n\nC:\\Documents and Settings\\User\\My Documents\\Test Cases\\1\\1.datC:\\Documents and Settings\\User\n\\My Documents\\Test Cases\\2\\2.dat\n\nC:\\Documents and Settings\\kcomandur\\My Documents\\Test Cases\\1\\1.dboC:\\Documents and Settings\\User\n\\My Documents\\Test Cases\\2\\2.dbo\n\nThe value of i inside the thread = 10000\nThu Aug 09 10:57:08 2012\n</code></pre>\n\n<p>and then program crashes. I get the following error</p>\n\n<pre><code>Debug Error!\nProgram: ...MultiThreading.exe\nR6010\n-abort() has been called\n(Press Retry to debug the application)\n</code></pre>\n\n<p>When I do a retry, the break occurs in the generated .tli file in the following location starting with _com_dispatch_method</p>\n\n<pre><code>#pragma implementation_key(723)\ninline IDispatch * IHeatExchangerNetwork::LoadHeatTransferUnit ( BSTR filename, enum HxUnitTypeKey unitType ) {\n    IDispatch * _result = 0;\n    _com_dispatch_method(this, 0x20, DISPATCH_METHOD, VT_DISPATCH, (void*)&amp;_result, \n        L\"\\x0008\\x0003\", filename, unitType);\n    return _result;\n}\n</code></pre>\n\n<p>The filename variable has the value</p>\n\n<pre><code>C:\\Documents and Settings\\User\\My Documents\\Test Cases\\2\\2.dat\n</code></pre>\n\n<p>I tried using mutex and modified the Thread function</p>\n\n<pre><code>unsigned int __stdcall Thread(void *args)\n{\n    CoInitialize(0);\n    {\n        WaitForSingleObject(th_mutex, INFINITE);\n\n        // Same content as original Thread function. \n        // Not writing it again to minimize space\n\n        ReleaseMutex(th_mutex);\n    }\n\n    CoUninitialize();\n\n    return  EXIT_SUCCESS;\n}\n//____________________________________\n</code></pre>\n\n<p>This time the program crashes at the following location _com_dispatch_method in the .tli file</p>\n\n<pre><code>#pragma implementation_key(966)\ninline long IHeatTransferUnit::WriteDBOFile ( BSTR filename, short io, const VARIANT &amp; vAppend ) {\n    long _result = 0;\n    _com_dispatch_method(this, 0x32, DISPATCH_METHOD, VT_I4, (void*)&amp;_result, \n        L\"\\x0008\\x0002\\x080c\", filename, io, &amp;vAppend);\n    return _result;\n}\n</code></pre>\n\n<p>By using mutex the error is being generated by the thread which has the HANDLE hnd3. The variable filename has the value</p>\n\n<pre><code>C:\\Documents and Settings\\User\\My Documents\\Test Cases\\2\\2.dbo\n</code></pre>\n\n<p>Also by using mutex I was able to get past the previous error location.</p>\n\n<p>I am not sure if I really need a mutex as the following call</p>\n\n<pre><code>hxNetwork-&gt;Run(0, 0);\n</code></pre>\n\n<p>works on two different files that are no way related to each other. Also this is the most time consuming portion of the program and hence I wanted to run 2 cases simultaneously.</p>\n\n<p>By using mutex the way I did, it runs the first case and then the second case.</p>\n\n<p>Also the I have no control over the calc.dll. It is a third part software and I am not sure if supports multithreading or not.</p>\n\n<p>So I would like to know what I need to do to get both the runs going and also be able to output the 2 files</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["c++","multithreading","winapi","mutex"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":141,"score":1,"question_id":11889117,"title":"C++\\Win32 Confused about WaitForSingleObject function return value meaning","body":"<p>I have a mutex created with CreateMutex, and then I use WaitForSingleObject to wait on some thread until such time that the Mutex is released and take ownership of it (with no timeout).</p>\n\n<p>So, if the function returns WAIT_OBJECT_0, I can go on my marry way and execute the threads' code.</p>\n\n<p>However, in case the function returns WAIT_ABANDONED, can I still execute the code, expecting that any other thread calling WaitForSingleObject on my Mutex is going to get stuck until I release?</p>\n\n<hr>\n\n<p>In case the owning thread terminates without releasing the Mutex, I want the calling thread to take ownership and things to keep going as usual.</p>\n\n<hr>\n\n<p>EDIT: what is confusing to me is that MSDN says the state of the mutex in case (2) is unsignaled as opposing to state (1) where it is signaled. What does that mean for me?</p>\n"},{"tags":["winapi","networking","iphelper"],"answer_count":7,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":11530,"score":4,"question_id":36831,"title":"How do you parse an IP address string to a uint value in C#?","body":"<p>I'm writing C# code that uses the windows IP Helper API. One of the functions I'm trying to call is \"GetBestInterface\" that takes a 'uint' representation of an IP. What I need is to parse a textual representation of the IP to create the 'uint' representation.</p>\n\n<p>I've found some examples via Google, like <a href=\"http://www.justin-cook.com/wp/2006/11/28/convert-an-ip-address-to-ip-number-with-php-asp-c-and-vbnet/\" rel=\"nofollow\">this one or <a href=\"http://www.codeguru.com/csharp/.net/net_general/internet/article.php/c10651\" rel=\"nofollow\">this one</a>, but I'm pretty sure there should be a standard way to achieve this with .NET. Only problem is, I can't find this standard way. IPAddress.Parse seems to be in the right direction, but it doesn't supply any way of getting a 'uint' representation...</p>\n\n<p>There is also a way of doing this using IP Helper, using the ParseNetworkString</a>, but again, I'd rather use .NET - I believe the less I rely on pInvoke the better.</p>\n\n<p>So, anyone knows of a standard way to do this in .NET?</p>\n"},{"tags":["winapi","terminal-emulator"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":9685405,"title":"TinyTERM Plus - How to move the MainWindow using CScript and/or the TE Control Object","body":"<p>How can TinyTERM's MainWindow be programmically moved using TinyTERM's CScript and/or TinyTERM's TE Object?</p>\n\n<p>I see the CScript language has a MoveWindow function</p>\n\n<pre><code>Void MoveWindow( hWnd, iX, iY, iW, iH bRepaint )\nCalls Win32 MoveWindow function.\nMoveWindow( hFrame, x, y, w, h, 1 );\n</code></pre>\n\n<p>Does anyone know how to get the MainWindow's hWnd?</p>\n\n<p>I am using Version 4.42.</p>\n\n<p>TinyTERM Plus Programmers Reference Manual<br>\n<a href=\"http://www.centurysoftware.com/docs/TinyTERM_Plus_PRM.pdf\" rel=\"nofollow\">http://www.centurysoftware.com/docs/TinyTERM_Plus_PRM.pdf</a></p>\n\n<p>Support Page<br>\n<a href=\"http://www.centurysoftware.com/support/index.php\" rel=\"nofollow\">http://www.centurysoftware.com/support/index.php</a>  </p>\n\n<p>I want to Move the MainWindow because I using another program to launch TinyTERM Plus. Currently TinyTERM starts up in the middle of the screen. I would like to move it on top of the application that launched it. Since I am going to have 4 (or more) applications launching a session of TinyTERM it is going to be confusing to have all the TinyTERM session on top of each other. The user will have to manually move them around.</p>\n"},{"tags":["c++","winapi","optimization"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":5,"view_count":215,"score":-3,"question_id":11886036,"title":"C++/Win32 Smallest possible MessageBox(\"Hello\") app exe?","body":"<p>I am working on a project that is getting really large and I need to have the exe uploaded to someone every time a new build is out, and my connection is by phone modem.</p>\n\n<p>I want to compile the smallest possible exe for an application whose purpose is to run the code: MessageBox(0, \"Hello\", 0, MB_OK);</p>\n\n<p>I am using VS 2010.</p>\n\n<p>v0 - Benchmark</p>\n\n<pre><code>  7KB (release)\n  Used: \\O1\n</code></pre>\n\n<p>v1</p>\n\n<pre><code>  3KB (release)\n  Used: \\O1, Off buffer security check, Ignore default library linkage.\n</code></pre>\n"},{"tags":["windows","winapi","visual-c++","win32-process"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":619,"score":3,"question_id":8995003,"title":"Find all threads of a process given process id","body":"<p>I am trying to find if there is a better way to find all thread ids that belong to the current process. It looks like using CreateToolhelp32Snapshot with TH32CS_SNAPTHREAD and iterating over the threads to check if the thread's process id is equal to the current process id, is a solution but i want to avoid iterating all the running threads. I just want to iterate over the threads that belong to a given process. Please let me know if there is an API that is fast and simple. I need to do it in c++.</p>\n\n<p>Thanks,\nAbhinay.</p>\n"},{"tags":["visual-studio","winapi","visual-c++","browser","mfc"],"answer_count":5,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":868,"score":6,"question_id":733211,"title":"Getting Default browser","body":"<p>How can I determine which is the default browser in my system programatically. The code must be developed using vc++ \nIs there any API for this ?</p>\n\n<p>Where in the registry is the default browser value stored?</p>\n"},{"tags":["multithreading","winapi","resources","ftp","mutex"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":144,"score":0,"question_id":11883933,"title":"C++/Win32 Overlapping file read/write access: should I use Mutex or what?","body":"<p>I've two threads, one that writes to a file, and one that reads from the same file.\nI use CreateFile &amp; WriteFile, FlushFileBuffers in the writer thread, and the reader thread uses FtpPutFile.</p>\n\n<p>How do I implement a simple windows32 Mutex here? (I haven't used it for years)</p>\n\n<p>Or, is this possible with proper flags sent to CreateFile? (I tried but no luck)</p>\n"},{"tags":["python","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":11882314,"title":"win32api: Keyboard input/key hold into a PlayStation emulator","body":"<p>My goal is to send a key hold of the <strong>z</strong> key into my <strong>pSX PlayStation emulator</strong>. But first, I just want to figure out how to even send a simple instantaneous <strong>z</strong> key press.</p>\n\n<p>From what I've read online, the window must be focused and maximized in order to register the key press. So I've got the focusing part working.</p>\n\n<p>The problem I am having is that the <code>win32api</code> code I use doesn't seem to work.\nI've tried this:</p>\n\n<pre><code>import win32ui\nimport win32api as w32\n\nfocus_x = win32ui.FindWindow( None, \"pSX v1.13\" )\nfocus_x.SetForegroundWindow()\nfocus_x.SetFocus()\nw32.keybd_event(0x5A,0,0,0)\n</code></pre>\n\n<p>and what happens is the window is focused, but the keypress is not registered. I've read online that it might have to do with keyboard drivers, and that I might have to use <code>VkKeyScan</code>. I'm still not sure how to use that though, and I don't exactly understand the concept of a keyboard driver as it pertains to keyboard IO.</p>\n\n<p>Any help would be greatly appreciated.</p>\n"},{"tags":["c++","winapi","pointers","long-integer","win64"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":91,"score":2,"question_id":11449644,"title":"Storing double* in a long (C++)","body":"<p>So I have this existing bit of code that compiles perfectly in Visual Studio 2005, when the target platform is 32 bit. However, it does not work in 64 bit. I don't understand why; in fact I have never seen a pointer being cast to a long before. Is it even correct C++?</p>\n\n<pre><code>#define REAL double\ntypedef REAL* point; \npoint *ptary; //(so it's basically double** ptary?)\nlong arylen = (long) ptary[0]; \n</code></pre>\n\n<p>Thanks in advance. </p>\n"},{"tags":["c","winapi","file-io","ntfs"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1265,"score":2,"question_id":1073646,"title":"Getting the cluster size of a hard drive (through code)","body":"<p>I need to find the cluster size of the users hard drive, through C or C++. The hard drive uses NTFS (though I'd appreciate knowing how it's done on other file systems as well).</p>\n\n<p>I guess what I need is some combination of win32 API calls, but I don't know which.</p>\n\n<p>For instance, typing \"fsutil fsinfo ntfsinfo c:\" in the windows console gives you \"Bytes per cluster\", which is what I need. (Though for obvious reasons, I don't want to run that command and parse it's output.)</p>\n"},{"tags":["winapi","mapping","executable","portability","offset"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":110,"score":2,"question_id":11833899,"title":"What are possible reasons for not mapping Win32 Portable Executable images at offset 0?","body":"<p>I've been looking into Window's PE format lately and I have noticed that in most examples,\npeople tend to set the <code>ImageBase</code> offset value in the <code>optional header</code> to something unreasonably high like <code>0x400000</code>.</p>\n\n<p>What could make it unfavorable <strong>not</strong> to map an image at offset <code>0x0</code>?</p>\n"},{"tags":["c#","c++","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":99,"score":1,"question_id":9282514,"title":"get descriptor of window","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4944621/create-an-on-screen-keyboard\">Create an On-screen Keyboard</a>  </p>\n</blockquote>\n\n\n\n<p>I'm trying to write a virtual keyboard. Can you tell me how I can get the descriptor <code>hWnd</code> of the focused window? (It can be for Word, Excel, Skype, etc.) </p>\n\n<p>I'm using <code>findWindow()</code>, but for that I must know the name of the window.</p>\n\n<pre><code>IntPtr hWnd = FindWindow(\"Notepad\", null);\n\n        if (!hWnd.Equals(IntPtr.Zero))\n        {\n            MessageBox.Show(\"Tagil\");\n            IntPtr edithWnd = FindWindowEx(hWnd, IntPtr.Zero, \"Edit\", null);\n            if (!edithWnd.Equals(IntPtr.Zero))\n                SendMessage(hWnd, WM_SETTEXT, IntPtr.Zero, new StringBuilder(\"Hello World\"));\n        }\n</code></pre>\n"},{"tags":["c","windows","winapi","tcp","network-programming"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":225,"score":4,"question_id":11740673,"title":"Programatically Change \"Advanced TCP/IP Settings\" - un-check \"Use Default Gate Way on Remote Network\"","body":"<p><img src=\"http://i.stack.imgur.com/gn31O.png\" alt=\"enter image description here\"></p>\n\n<p>Description :</p>\n\n<p>I created a Dial-Up Connection Programatically to commnunicate with my device and the Laptop. And once the connection is established with the Dial-Up connection Created, My internet connection which is connected via LAN is not working and the status of my LAN connection ( used for internet connection remains ) connected.</p>\n\n<p>To over come this I need to un-check the \"Use Defualt Gate Way on Remote Network\", option by, <code>right click my dial-up connection -&gt; properties -&gt; Netwroking TAB -&gt; Select Internet Protocol (TCP/IP) -&gt; Properties -&gt; Advanced -&gt; I get Advanced TCP/IP settings -&gt; Unchek \"Use Default Gate Way on Remote Network\".</code></p>\n\n<p>I am using RAS functions to create a Phonebook for my dial-up connection. Is there any structures available to make this as an option. I didnd found any structure parameters to make this as an option. Please advice..</p>\n\n<p>How to to this programatically? Can I use any APIs.</p>\n"},{"tags":["c++","multithreading","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":11878950,"title":"C++/Win32 Best way for me to start a thread on Windows 2000+","body":"<p>I'm looking for the lightest (in terms of .exe size increase) way to start a thread on Win 2000 or later. Thread is to be run in the main processes address space.</p>\n\n<p>Hopefully I can do this with one include: #include windows.h alone.</p>\n"},{"tags":["winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":92,"score":1,"question_id":11865269,"title":"Win32, Resource file, loading into memory","body":"<p>This is my <code>test.rc</code> file:</p>\n\n<pre><code>shader.hlsl shaders \"HLSL\\\\shader.hlsl\"\n</code></pre>\n\n<p>I know it doesn't look like usual rc file but whe I use function like this.</p>\n\n<pre><code>D3DX11CompileFromResource(handle, L\"shader.hlsl\", NULL, NULL, NULL, \"VS\", \"vs_4_0\", 0, 0, NULL, &amp;s, &amp;err, &amp;hr);\n</code></pre>\n\n<p>It works perfectly, but I want to load this file into memory. Tell me please how to do it, because I'm lack of ideas now. I tried with something like that.</p>\n\n<pre><code>HRSRC hSrc = FindResource(GetModuleHandle(0), L\"shader.hlsl\", L\"shaders\");\n</code></pre>\n\n<p>but without success.</p>\n\n<h3>EDIT:</h3>\n\n<p><code>FindResource()</code> returns NULL!</p>\n"},{"tags":["c++","winapi","sockets","networking","network-programming"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":11877402,"title":"Socket Programming. issue with connect(...) api","body":"<p>In my network programming project (in visual C++), I am facing one problem with connect(...) api. The code segment for connect() is as below.</p>\n\n<pre><code>if (connect(sockfd[0], &amp;sock.addr, sizeof(sock.inaddr)) == SOCKET_ERROR){\n    wprintf(L\"connect function failed with error: %ld\\n\", WSAGetLastError());\n    closesocket(sockfd[0]);\n    WSACleanup();\n}\n</code></pre>\n\n<p>for above mentioned code i am getting follwoing compilation error, which doesn't make sense as connect should take 3 args.</p>\n\n<pre><code>error C2660: 'SampleClass::connect' : function does not take 3 arguments\n</code></pre>\n\n<p>Can anyone help me to figure out what i am missing here.</p>\n"},{"tags":["c++","windows","winapi","stack-corruption"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":103,"score":2,"question_id":11875619,"title":"Why is calling ReadConsole in a loop corrupting the stack?","body":"<p>I've disabled line input with the following code:</p>\n\n<pre><code>DWORD dwConsoleMode;\nGetConsoleMode(hStdIn, &amp;dwConsoleMode);\ndwConsoleMode ^= ENABLE_LINE_INPUT;\nSetConsoleMode(hStdIn, dwConsoleMode);\n</code></pre>\n\n<p>Then I am calling ReadConsole in a loop...in a loop:</p>\n\n<pre><code>wchar_t cBuf;\n\nwhile (1) {\n    /* Display Options */\n\n    do {\n        ReadConsole(hStdIn, &amp;cBuf, 1, &amp;dwNumRead, NULL);\n    } while (!iswdigit(cBuf));\n\n    putwchar(cBuf);\n\n    if (cBuf == L'0') break;\n}\n</code></pre>\n\n<p>If I run the program and press 0 right away, it exists cleanly.<br>\nBut if I press a bunch of keys, then press 0, when the program exists it crashes with:</p>\n\n<blockquote>\n  <p>Run-Time Check Failure #2 - Stack around the variable 'cBuf' was corrupted.</p>\n</blockquote>\n\n<p>Why is this causing the stack to become corrupt? The code is simple, so I can't figure out what is wrong.</p>\n\n<p>Little program that I can reproduce the problem with:</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n\nint wmain(int argc, wchar_t *argv[])\n{\n    DWORD dwNumRead;\n    wchar_t cBuf;\n\n    HANDLE hStdIn = GetStdHandle(STD_INPUT_HANDLE);\n\n    DWORD dwConsoleMode;\n    GetConsoleMode(hStdIn, &amp;dwConsoleMode);\n    dwConsoleMode ^= ENABLE_LINE_INPUT;\n    SetConsoleMode(hStdIn, dwConsoleMode);\n\n    while (true)\n    {\n        wprintf(L\"\\nEnter option: \");\n\n        do {\n            ReadConsoleW(hStdIn, &amp;cBuf, 1, &amp;dwNumRead, NULL);\n        } while (!iswdigit(cBuf));\n\n        putwchar(cBuf);\n\n        if (cBuf == L'0') break;\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>You have to kind of mash your keyboard after you run it, then press 0, and it crashes with the stack corruption.</p>\n\n<p>I also can't reproduce the problem every time, it takes a few tries.<br>\nI was running it under Visual Studio 2010, after creating a new empty console project and adding a file with that code.</p>\n"},{"tags":["java","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":11876612,"title":"Hook win32 createprocess api using java","body":"<p>I am trying to hook the Win32 <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms682425%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>CreateProcess</code></a> API using java so that all my programs will know about any process that is about to be created. Can someone help me get started?</p>\n"},{"tags":["winapi","dll","inno-setup"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":242,"score":0,"question_id":5619440,"title":"Get Disk Information using Kernel32 functions","body":"<p>Is there a function in kernel32.dll where i can use to:</p>\n\n<ol>\n<li>Get the number of disk partitions.</li>\n<li>Get the type of disk installed in the computer (HDD or SSD).</li>\n<li>Get the file system of the primary disk where the OS is installed.</li>\n<li>On which drive the disk partitions resides.</li>\n</ol>\n\n<p>Thanks in advance for the help!</p>\n"},{"tags":["windows","winapi","sendmessage"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":11833500,"title":"Preventing cross-process SendMessage Calls","body":"<p>Say I have a Windows GUI applications with a buttons on it. I am able to simulate a click on that button by using sendMessage winapi calls with <code>BM_CLICK</code> as the parameter to the call.</p>\n\n<p>Now, from a security perspective, I do not want this to happen. i.e. my target process should ignore sendMessage calls from another process. Is there a provision to do this at all ? A way to authenticate the sendMessage calls ?</p>\n\n<p>EDIT: In other words, how can I prevent applications such as Enabler, TurnitOn <a href=\"http://www.raymond.cc/blog/how-to-enable-and-access-disabled-grayed-out-buttons-windows-and-checkboxes/\" rel=\"nofollow\">http://www.raymond.cc/blog/how-to-enable-and-access-disabled-grayed-out-buttons-windows-and-checkboxes/</a> from accessing functionality that is not meant to be accessed by the user ?</p>\n"},{"tags":["c++","windows","winapi","monitor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":138,"score":0,"question_id":11874615,"title":"Trying to open display device handle to change brightness on Windows XP using C++","body":"<p>I am trying to write a C++/WinAPI code to change a monitor brightness. The code must be compatible with Windows XP so I can't use APIs like SetMonitorBrightness. So I thought to try out <a href=\"http://msdn.microsoft.com/en-us/library/aa372704.aspx\" rel=\"nofollow\">IOCTL_VIDEO_SET_DISPLAY_BRIGHTNESS</a> but I can't seem to even get a device handle.</p>\n\n<pre><code>HANDLE hDevice = ::CreateFile(_T(\"\\\\\\\\.\\\\LCD\"),\n    GENERIC_READ | GENERIC_WRITE,\n    FILE_SHARE_READ | FILE_SHARE_WRITE,\n    NULL,\n    OPEN_EXISTING,\n    0, NULL);\nif(hDevice != INVALID_HANDLE_VALUE)\n{\n    //Do work here\n\n    ::CloseHandle(hDevice);\n}\nelse\n{\n    nOSErr = ::GetLastError();\n    //Get code 2\n}\n</code></pre>\n\n<p>I tried various combinations of GENERIC_READ, GENERIC_WRITE and FILE_SHARE_READ, FILE_SHARE_WRITE flags but I always get error code 2 when CreateFile is called.</p>\n\n<p>So what am I doing wrong here?</p>\n"},{"tags":["python","winapi","cursor","mouse"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":125,"score":1,"question_id":10341000,"title":"Mouse click command does not work on certain GUIs","body":"<p>The script below works perfectly when I want to click, for example, the Start button on Windows, but when I try to click a button in a certain GUI program it does not have any effect.</p>\n\n<p>Is it possible that this program has disabled virtual mouse clicks?\nIf so, can I circumvent this somehow?</p>\n\n<pre><code>import win32api, win32con\nPo=win32api.GetCursorPos()\nwin32api.mouse_event(win32con.MOUSEEVENTF_LEFTDOWN,Po[0],Po[1],0,0)\nwin32api.mouse_event(win32con.MOUSEEVENTF_LEFTUP,Po[0],Po[1],0,0)\n</code></pre>\n"},{"tags":["windows","winapi","vc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":42,"score":0,"question_id":11859114,"title":"how could I call privileged(need administrator privilege) programs from normal privileged programs?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4893262/how-can-i-run-a-child-process-that-requires-elevation-and-wait\">How can I run a child process that requires elevation and wait?</a>  </p>\n</blockquote>\n\n\n\n<p>CreateProcess does not works, the UAC dialog does not even show up.</p>\n"},{"tags":["windows","winapi","3d","modal-dialog","windows-messages"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":11870103,"title":"Keep rendering a 3D window during modal dialogs/opening main menu?","body":"<p>(I use Ogre3D for the rendering but the question should be generic.)</p>\n\n<p>The problem: most 3D aplications use a cycle which iterates rendering a frame and checking for messages and processing them. However if a dialog is opened (MessageBox or similar), it blocks the execution of the thread and is running it's own message cycle, but it obviously does not call the 3D rendering function in it.</p>\n\n<p>What is the preferred, or \"best\" way of keeping rendering the 3D scene even when dialogs are open? The normal applications do not suffer from this problem, because their re-rendering is handled by WM_PAINT messages and similar, and since modal dialogs do have internal message loop, the window proc get's called when needed and everything looks fine. In my 3D project however, \"when needed\" is all the time, because the window has to be updated, even without WM_PAINT messages. </p>\n\n<p>The simple solution that comes to mind is to register a timer for the time when dialogs are open, and render 3D scene from the WindowProc, but is it really the best? Seems very dirty...</p>\n"},{"tags":["c++","winapi","listbox","ownerdraw"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":143,"score":0,"question_id":11871033,"title":"OwnerDrawn Window","body":"<p>i'm not being succefull on drawing my own listbox, heres the code:</p>\n\n<pre><code>LRESULT CALLBACK ListBoxProcedure(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)\n{\n        switch (msg)\n        {\n               case WM_DRAWITEM:\n                    LPDRAWITEMSTRUCT Item;\n                    Item = (LPDRAWITEMSTRUCT)lParam;\n\n                if (Item-&gt;itemState == ODS_SELECTED)\n                {\n                    FillRect(Item-&gt;hDC, &amp;Item-&gt;rcItem, CreateSolidBrush(0));\n                    SetTextColor(Item-&gt;hDC, 0x0000FF);\n                }\n                else\n                {\n                    SetBkColor(Item-&gt;hDC, 0);\n                    FillRect(Item-&gt;hDC, &amp;Item-&gt;rcItem, (HBRUSH)GetStockObject(BLACK_BRUSH));\n                    SetTextColor(Item-&gt;hDC, 0xFFFFFF);\n                }\n                LPSTR lpBuff;\n                SendMessageA(Item-&gt;hwndItem , LB_GETTEXT, Item-&gt;itemID, (LPARAM)lpBuff);\n                TextOutA(Item-&gt;hDC, Item-&gt;rcItem.left, Item-&gt;rcItem.top, (lpBuff), strlen(lpBuff)-1);\n                if (Item-&gt;itemState &amp; ODS_FOCUS)\n                {\n                   DrawFocusRect(Item-&gt;hDC, &amp;Item-&gt;rcItem);\n                }\n                return true;\n                break;\n           case WM_MEASUREITEM:\n                break;\n           default:\n                   DefWindowProcA(hwnd, msg, wParam, lParam);\n    }\n    return 0;\n}\n</code></pre>\n\n<p>I create the ListBox like this:</p>\n\n<pre><code>lbLogs = CreateWindowExA(0, \"LISTBOX\", \"\", WS_VISIBLE + WS_CHILD + WS_BORDER + LBS_HASSTRINGS + LBS_NOINTEGRALHEIGHT + WS_TABSTOP, 15, 115, 515, 180, hwnd, (HMENU)1005, hInstance, NULL);\n         //-----------------------------\n         SetWindowLong(lbLogs, GWL_WNDPROC, (LONG)&amp;ListBoxProcedure);\n</code></pre>\n\n<p>Could someone explain to me whats wrong in it?\nI'm trying to make a listbox that has black bg and red text and when an item gets selected it's text transforms to white.But the listbox just don't add nothing.</p>\n"},{"tags":["winapi","text","menu","gdi","font-size"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":92,"score":1,"question_id":11872274,"title":"Calculate size of text (text rectangle) rendered with GDI","body":"<p>I'm trying to create a menu and draw it with GDI.</p>\n\n<p>I have a MENU TITLE, unchangable.\nI have an array of items.</p>\n\n<p>If I want the title to be \"MAIN MENU\" how do I calculate the width and height of the Text? If I set SetBkColor() just before TextOut() to a different color than the HDC Background I see that it's rendered as a Rectangle - but how do I get the size of this rectangle and before writing out the Text on the screen?</p>\n\n<p>Also, I set CreateFont() and SelectObject(HDC, Font) beforehand so I can write \"bigger\" text for the Menu.</p>\n\n<p>Anyone with suggestions?</p>\n\n<p>Haven't found a working solution for this with native GDI and not using newer Graphics objects in .NET.</p>\n"},{"tags":["windows","winapi","menu","modal"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":11870200,"title":"Is opening main menu always a modal operation?","body":"<p>I don't know how, but it seems that when the main menu of a window is opened, the main message loop (PeekMessage/GetMessage, etc...) in my program stops. The behavior seems to be much like if a modal dialog was opened, because my WindowProc still gets called when messages arrive, so there must be some other message loop somewhere keeping that happening. </p>\n\n<p>I don't know how that happens yet (did not test yet), which function or message blocks the main message loop, I am guessing it happens somewhere in the DefWindowProc for some message which has to do with opening the menu.</p>\n\n<p>Is this the default behavior of main menu on Windows? What is really the point of this in that case? Can it be changed so that the main message loop will keep running, instead of some internal one?</p>\n"},{"tags":["python","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":150,"score":0,"question_id":11511497,"title":"Get the name of a window using Windows API","body":"<p>I am new to python and I am trying to write a script that exits out of a loop when a certain window closes.  I am having problems getting the code to work properly it won't even enter the loop.  I think this is because I am not properly getting the window name.  I was wondering if there are any good tutorials on the Win32Gui extension that would help me to understand how it works. </p>\n\n<p>Edit</p>\n\n<p>Here is what I have, it is doing what it is suppose to do, but I am sure there is an easier way of doing it.</p>\n\n<pre><code>def answerCalls(local, network):\nt = 0\ncount = 0\nwhile t == 0:\n    time.sleep(1)\n    if win32gui.GetWindowText(win32gui.GetForegroundWindow()) == \"Incoming Call\":\n        time.sleep(10)   \n        getApplicationPos(\"Incoming Call\")\n        clickOnElement(******.IncomingCall_AnswerButton())\n        time.sleep(10)\n        if win32gui.GetWindowText(win32gui.GetForegroundWindow()) == \"Video Call\":\n            count += 1\n            writeFile(\"Answering Calls\", count, local)\n            uploadToServer(local, network)  \n</code></pre>\n"},{"tags":["c#",".net","windows","winapi"],"answer_count":1,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":357,"score":6,"question_id":8600627,"title":"Prevent Windows workstation (desktop) from locking while running a WPF program","body":"<p><strong>Issue:</strong><br>\nI have a WPF <a href=\"http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/03c7c966-4b77-4f41-849f-a4a4c0974eb3/\">fullscreen</a> application, which acts as a dashboard. The computer is in domain and domain policies enforce the computer to be locked in 10 minutes after the last user activity. I want to prevent the workstation (or desktop) from locking automatically.<br>\nAn example of such behavior: Windows Media Player, which prevents this while a movie is running.</p>\n\n<p><strong>Known solutions (kinda workarounds):</strong>  </p>\n\n<ol>\n<li>It is possible to <a href=\"http://www.gettingclever.com/2008/06/prevent-your-desktop-from-locking.html\">send a Win32 Mouse Move event</a> every fixed interval of time (for example, every minute)</li>\n<li>It is possible to send a key to the program (for example \"Left Shift\" key up) every fixed interval of time (for example, every minute)</li>\n</ol>\n\n<p><strong>QUESTION:</strong><br>\n<strong><em>How can I prevent windows workstation from locking without using these workarounds?</em></strong></p>\n\n<p><strong>Disclaimer:</strong><br>\nI was pretty sure, there should be a similar question answered somewhere on StackOverflow, but i didn't find any. I would appreciate, if you could point me into the right direction.</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":11867048,"title":"Does \"Image File Execution Options\" intercept CreateProcess commands?","body":"<p>I want to know how the mechanism of debugger injection works. Why is \"Image File Execution Options\" so special? </p>\n\n<p>I have two guesses.</p>\n\n<ol>\n<li><p><strong>CreateProcess</strong> will call an internal function that checks against the list of registry keys. If it is found, then it manipulates the arguments and calls the debugger exe instead.</p></li>\n<li><p>There is <strong>some other service</strong> listening for CreateProcess calls and intercepts them. It kills the original call or message (if createprocess is a message or message-like), then it runs the new process as if the original caller called it.</p></li>\n</ol>\n\n<p>My desire is to verify and update components before an application starts. I like the IFEO \"feature\" but i need to run the original process after the verification step so I need a way to run  it without recursing into the updater. I hope that by learning more about the injection system I can get this system working.</p>\n"},{"tags":["c++","exception","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":409,"score":2,"question_id":3058527,"title":"Is it safe to catch EXCEPTION_GUARD_PAGE","body":"<p>Environment is VC++ 9 on various Win platforms (XP and later)</p>\n\n<p>I'm writing an unhandled exception handler.  I have a vague recollection from my kernel days that it was bad to catch an EXCEPTION_GUARD_PAGE, as this was generated to tell the OS to enlarge the stack.</p>\n\n<p>My question is twofold:</p>\n\n<ol>\n<li><p>Can such an exception occur in user space?</p></li>\n<li><p>If so, is it safe to catch it?</p></li>\n</ol>\n\n<p>I'm not especially interested in doing anything with it.  I just want to know if I need to put special code in to <em>not</em> catch it (as I'm catching everything at the moment).</p>\n\n<p><strong>_<em>Update:</em>_</strong>  </p>\n\n<p>I've recalled my source, it is Raymond Chen's blog (<a href=\"http://blogs.msdn.com/b/oldnewthing/archive/2006/09/27/773741.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/oldnewthing/archive/2006/09/27/773741.aspx</a>)</p>\n\n<p>My initial concern is that when catching all exceptions, if I catch a EXCEPTION_GUARD_PAGE, I might prevent the OS from seeing the exception and enlarging the stack.</p>\n\n<p>On further thought, I suspect that the EXCEPTION_GUARD_PAGE might be handled in the Kernel during the read/write operation that generated it and thus will never reach my user-space code.</p>\n\n<p>I guess I am looking for someone to confirm (or contradict) that.  </p>\n\n<p><strong>_<em>Second Update:</em>_</strong></p>\n\n<p>I haven't selected an answer yet as nobody has really answered the question.  I'll leave it open in the hope that somebody may yet offer the information that I seek.</p>\n\n<p><strong>_<em>Third Update</em>_</strong></p>\n\n<p>Still living in (faint) hope.</p>\n\n<p><strong>_<em>Fourth Update</em>_</strong></p>\n\n<p>Well, I never did get a usable answer.  I've long finished the module I was writing when I asked the question.  I think the question is, for practical purposes, dead.  I probably won't update again.</p>\n"},{"tags":["c++","winapi","windows-7"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":320,"score":4,"question_id":10457254,"title":"How to create a partition without Windows assigning a drive letter?","body":"<p>I am trying to initialize and partition an attached virtual hard disk through the Windows API. I have been successful using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa363216%28v=vs.85%29.aspx\" rel=\"nofollow\">DeviceIoControl()</a> to do so, however whenever I apply the desired drive layout Windows is automatically assigning a drive letter to the partition and popping up an annoying \"Would you like to format?\" dialog.</p>\n\n<p>My intent is to handle the formatting and mounting of this partition later in the program, but I'm not sure how to stop this behavior. I have tried setting <code>RecognizedPartition</code> to FALSE, but this seems to have no effect.</p>\n\n<p>Relevant code:</p>\n\n<pre><code>Layout.PartitionStyle = PARTITION_STYLE_MBR;\nLayout.PartitionCount = 4;\nLayout.Mbr.Signature = MY_DISK_MBR_SIGNATURE;\nLayout.PartitionEntry[0].PartitionStyle = PARTITION_STYLE_MBR;\nLayout.PartitionEntry[0].PartitionNumber = 1;\nLayout.PartitionEntry[0].StartingOffset.QuadPart = MY_DISK_OFFSET;\nLayout.PartitionEntry[0].PartitionLength.QuadPart =\n   (Geom.DiskSize.QuadPart - MY_DISK_OFFSET);\nLayout.PartitionEntry[0].Mbr.PartitionType = PARTITION_IFS;\nLayout.PartitionEntry[0].Mbr.BootIndicator = FALSE;\nLayout.PartitionEntry[0].Mbr.RecognizedPartition = FALSE;\nLayout.PartitionEntry[0].Mbr.HiddenSectors =\n   (MY_DISK_OFFSET / Geom.Geometry.BytesPerSector);\n\nfor (int i = 0; i &lt; 4; i++)\n{\n    Layout.PartitionEntry[i].RewritePartition = TRUE;\n}\n\nif (!DeviceIoControl(hDisk, IOCTL_DISK_SET_DRIVE_LAYOUT_EX,\n                     Layout, dwLayoutSz, NULL, 0, &amp;dwReturn, NULL))\n{\n    // Handle error\n}\nDeviceIoControl(hDisk, IOCTL_DISK_UPDATE_PROPERTIES,\n                NULL, 0, NULL, 0, &amp;dwReturn, NULL);\n</code></pre>\n\n<p>What can I do to prevent automatic drive letter assignment?</p>\n"},{"tags":["winapi","signal-processing","audio-streaming"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":77,"score":2,"question_id":11861475,"title":"Smooth play of live network audio samples","body":"<p><br/>\nI am writing a client/server app in that server send live audio data that capture audio samples that captured from some external device( mic. for example ) and send it to the client. Then client want to play those samples. My app will run on local network so I have no problem with bandwidth( My sound is 8k, 8bit stereo while my net card 1000Mb ). In client I buffer the data for a small time and then start playback. and as data arrive from server I send them to sound card. This seems to work fine but there is a problem:<br/>\nwhen my buffer in the client side finished, I will experience gaps in played sound.<br/>\nI consider this is because of the difference in sampling time of the server and the client, it means that 8K on server is not same as 8K on client.<br/>\nI can solve this with pausing client's playback and buffer again, but my boss doesn't accept it, since I have proper bandwidth and I should be able to play sound with no gap or pause.<br/>\nSo I decided to dynamically change playback speed in the client but I don't know how.<br/></p>\n\n<p>I am programming in Windows( native ) and I currently use waveOutXXX to play the sound. I can use any other native library( DirectX/DirectSound, Jack or ... ) but they should provide a smooth playback in the client.<br/></p>\n\n<p>I have programmed with waveOutXXX many times without any problem and I know it good but I can't solve my problem of dynamic resampling</p>\n"},{"tags":["windows","winapi","windows-shell","windows-explorer","columnheader"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":11776266,"title":"IShellView: ColumnHeaders not hidden if AutoView does not choose Details","body":"<p>I`m using an IShellView instance with the FVM_AUTO (-1) flag as view mode. That means the explorer should choose a viewstyle that fits the content of the displayed folder.\nThis works fine except the fact, that columnheaders are visible for viewstyle other than Details, e.g. Thumbnails.</p>\n\n<p>The IShellView object and view window is created like this:</p>\n\n<pre><code>ShellFolder1.CreateViewObject(this.Handle, \n                              ref IID_IShellView, \n                              out shellViewObject));\nIShellView shellView = shellViewObject as IShellView;\nFolderSetting folderSettings = new FolderSetting();\nfolderSettings.ViewMode = (int)View; // view is FVM_AUTO = -1\nfolderSetting.FolderFlags = FolderFlags.NoClientEdge\n                            | FolderFlags.ExtendedTiles\n                            | FolderFlags.AutoArrange\n                            // only columnheaders for view mode details\n                            | FolderFlags.NoHeaderInAllViews;\nshellView.CreateViewWindow(oldView, ref folderSettings, isb, \n                            ref rect, ref m_ShellViewHandle);\n</code></pre>\n\n<p>A list of available folder flags can be found here: <a href=\"http://msdn.microsoft.com/en-us/library/bb762508(VS.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/bb762508(VS.85).aspx</a></p>\n\n<p>Any suggestions how to tell the view that column headers should be displayed only for \"details\" in auto view mode? setting FolderFlags.NoColumnHeader does not change anything.</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","c++","windows","winapi","createfile"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":143,"score":0,"question_id":11855245,"title":"Unable to read same file in parallel","body":"<p>I am trying to read a logfile in two different applications at the same time. But <strong>CreateFile</strong> (<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa363858%28v=vs.85%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/aa363858%28v=vs.85%29.aspx</a>) with share-mode #FILE_SHARE_READ always fails on the second call with error-code 32: <strong>ERROR_SHARING_VIOLATION: - The process cannot access the file because it is being used by another process.</strong></p>\n\n<p>When the logfile is written in modes FILE_SHARE_WRITE or FILE_SHARE_READ | FILE_SHARE_WRITE the file can not be read by any of the two applications only when FILE_SHARE_READ is used for the writer-application and then it only works if the reader-applications use FILE_SHARE_WRITE or FILE_SHARE_READ | #FILE_SHARE_WRITE, not when using #FILE_SHARE_READ. Strange .... Any suggestions?</p>\n\n<p>Thank you very much.</p>\n\n<p>Amendment:</p>\n\n<pre><code>Writer-Application: CreateFile(file,GENERIC_WRITE,FILE_SHARE_READ,0,CREATE_ALWAYS,FILE_ATTRIBUTE_NORMAL,0)\nReader-Applications: CreateFile(file,GENERIC_READ,FILE_SHARE_READ | FILE_SHARE_WRITE,0,OPEN_EXISTING,FILE_ATTRIBUTE_NORMAL,0)\n</code></pre>\n\n<p>Amendment 2:</p>\n\n<p>When using the calls from the first Amendment the 1st Reader-Application can successfully get the filehandle, but the 2nd Reader-Application will fail with ERROR_SHARING_VIOLATION.</p>\n\n<p><strong>Amendment 3: One pointed me to the solution!</strong></p>\n\n<p><strong>The problem was that I used logical Or instead of bitwise Or for the share-mode:\nFILE_SHARE_READ Or FILE_SHARE_WRITE = 1 Or 2 = 1, but it should be FILE_SHARE_READ | FILE_SHARE_WRITE = 1 | 2 = 3. So could not work as the Writer-Application required FILE_SHARE_WRITE.</strong></p>\n"},{"tags":["c++","winapi","network-programming","windows-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":143,"score":0,"question_id":11855567,"title":"C++ example to disable a network adapter in Windows server 2008 r2","body":"<p>On Windows Server 2008 R2 we have multiple network adapters.  We have a legacy program that has to bind with a particular network adapter.   It does not always select the correct one.  I need to disable the incorrect network adapters, then start the program and then enable the network adapters again.\nI am having trouble disabling the adapters.  Could someone provide a C++ example?\nThe compiler is Embarcadero C++ XE2.</p>\n"},{"tags":["winapi","visual-c++","atl","wtl","message-map"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":127,"score":1,"question_id":11857611,"title":"How do ATL/WTL alternative message maps (ALT_MSG_MAPs) work? When do I use them?","body":"<p>I've <a href=\"http://msdn.microsoft.com/en-us/library/at19ychx.aspx\" rel=\"nofollow\">read</a> the <a href=\"http://msdn.microsoft.com/en-us/library/8d3ws24d.aspx\" rel=\"nofollow\">documentation</a>, which says:</p>\n\n<blockquote>\n  <p>ATL supports alternate message maps, declared with the <code>ALT_MSG_MAP</code> macro.<br>\n  Each alternate message map is identified by a unique number, which you pass to <code>ALT_MSG_MAP</code>.<br>\n  <em>Using alternate message maps, you can handle the messages of multiple windows in one map.</em><br>\n  Note that by default, <code>CWindowImpl</code> does not use alternate message maps.<br>\n  To add this support, override the <code>WindowProc</code> method in your <code>CWindowImpl</code>-derived class and call <code>ProcessWindowMessage</code> with the message map identifier.</p>\n</blockquote>\n\n<p>And when I look at WTL, I see message maps like:</p>\n\n<pre><code>BEGIN_MSG_MAP(CCommandBarCtrlImpl)\n    MESSAGE_HANDLER(WM_CREATE, OnCreate)\n    MESSAGE_HANDLER(WM_FORWARDMSG, OnForwardMsg)\n    ...\nALT_MSG_MAP(1)   // Parent window messages\n    MESSAGE_HANDLER(WM_INITMENUPOPUP, OnParentInitMenuPopup)\n    ...\nALT_MSG_MAP(2)   // MDI client window messages\n    // Use CMDICommandBarCtrl for MDI support\nALT_MSG_MAP(3)   // Message hook messages\n    MESSAGE_HANDLER(WM_MOUSEMOVE, OnHookMouseMove)\n    ...\nEND_MSG_MAP()\n</code></pre>\n\n<p>However, I don't understand:</p>\n\n<ul>\n<li><p>How they get called. (How does the code know about the existence of the alternate message maps?)</p></li>\n<li><p>How they differ from default message maps. They all look like they're handling the same kinds of messages for the same windows...</p></li>\n<li><p>Why they are useful. (Aren't they all for the same window anyway?)</p></li>\n</ul>\n\n<p>Does anyone have a better explanation for what alternate message maps do?<br>\n(A motivation for why they were invented would be very helpful.)</p>\n"},{"tags":["c","windows","winapi","unicode","unicode-string"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":74,"score":0,"question_id":11857517,"title":"Start with UNICODE supported WINAPI programming","body":"<p>I started developing an application in C using WINAPIs. I want my application to be UNICODE supported. </p>\n\n<blockquote>\n  <p>I am using mingw with gcc compiler. What should I do to make my app\n  UNICODE support.  It should work in all versions of windows starting\n  from xp.  And I wish my application to work in all languanges.</p>\n</blockquote>\n\n<p>Can you please provide me some guidelines on this and Do's and Dont's.</p>\n"},{"tags":["winapi","windows-7","windows-xp","gdi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":11861893,"title":"Different size of TrueType symbols in Win7 and XP","body":"<p>I've created new font with CreateFontIndirect() and GetTextMetrics() returnes different width of symbols. Example:</p>\n\n<p>Get DC:</p>\n\n<pre><code>HDC ReferenceDC = GetDC( NULL );\nSetMapMode( ReferenceDC, MM_HIMETRIC );\n\nm_nFontHeight_HM = font.lfHeight * INCH_IN_HIMETRIC / 72 / MILLIMETER_IN_HIMETRIC;\n</code></pre>\n\n<p>Variable font is saved font parameter:</p>\n\n<pre><code>LOGFONT lf = font;\nlf.lfHeight = -m_nFontHeight_HM;\n</code></pre>\n\n<p>Create and select font:</p>\n\n<pre><code>guards::tlGDIGuard&lt; HFONT &gt; fontGuard( ReferenceDC, CreateFontIndirect( &amp;lf ) );\n\nif ( !fontGuard.GetObject() )\n{\n    throw system_exception_ex( exceptions::EXCEPTION_TYPE_NT );\n}\n</code></pre>\n\n<p>Get Textmetric  :\n(already there are different for XP and Win 7)</p>\n\n<pre><code>TEXTMETRIC TextMetric;\n\nGetTextMetrics( ReferenceDC, &amp;TextMetric );\n\nm_nFontHeight_HM = -lf.lfHeight;\n\n\nOUTLINETEXTMETRIC TextMetrics;\n\nif ( !GetOutlineTextMetrics( ReferenceDC, sizeof( TextMetrics ), &amp;TextMetrics ) )\n{\n    throw system_exception_ex( exceptions::EXCEPTION_TYPE_NT );\n}\n\nconst unsigned int nFirstChar = TextMetrics.otmTextMetrics.tmFirstChar;\nconst unsigned int nLastChar = TextMetrics.otmTextMetrics.tmLastChar;\nconst unsigned int nCharsCount = nLastChar - nFirstChar + 1;\n</code></pre>\n\n<p>Get chars widths:</p>\n\n<pre><code>boost::scoped_array&lt; ABC &gt; pCharWidths( new ABC[ nCharsCount ] );\n\nif ( !GetCharABCWidths( ReferenceDC, nFirstChar, nLastChar, pCharWidths.get() ) )\n{\n    throw system_exception_ex( exceptions::EXCEPTION_TYPE_NT );\n}\n\nm_CharactersWidthsArray.resize( nLastChar + 1, 0 );\n\nlong WideCharCount = 0;\nm_nTabWhidth = 0;\n\nfor ( unsigned int nChar = nFirstChar; nChar &lt;= nLastChar; ++nChar )\n{\n    const int nCharWidth =   pCharWidths[ nChar - nFirstChar ].abcA + pCharWidths[ nChar - nFirstChar ].abcB + pCharWidths[ nChar - nFirstChar ].abcC;\n\n    m_CharactersWidthsArray[ nChar ] = nCharWidth;\n\n    if ( nCharWidth )\n    {\n        m_nTabWhidth += nCharWidth;\n        WideCharCount++;\n    }\n\n}\n</code></pre>\n"},{"tags":["winapi","dll"],"answer_count":6,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":3347,"score":3,"question_id":362560,"title":"How do I detect the DLLs required by an application?","body":"<p>In a nutshell: I want to do the same thing \"Dependency Walker\" does.</p>\n\n<p>Is there any Win32 API function which can enumerate the dependencies of a EXE and/or DLL file?</p>\n\n<p>And is there any safe way to detect dependencies on ActiveX classes? (I doubt it is possible, but who knows ...)</p>\n\n<p><strong>EDIT:</strong> I'm aware of available tools which provide the same core functionality (Dependency Walker, ProcessExplorer, AQTime, ...) but I want to create my own program which dumps a text file containing the required modules. </p>\n\n<p><strong>EDIT 2:</strong>  What is this \"DB API\" which is mentioned in some answers? Do you have any links or other information?</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":11843769,"title":"How to call EnumSystemLocales() in C++","body":"<p>How to call EnumSystemLocales() function in C++ within the same class? My callback function is :</p>\n\n<pre><code>BOOL CALLBACK CLanguage::EnumLocalesProc(LPWSTR lpLocaleString) {\n\n    RETAILMSG(TRUE, (L\"[GUI] LOCALE: %s!\\n\\r\", lpLocaleString));\n\n    return TRUE;\n\n}\n</code></pre>\n\n<p>Calling <code>EnumSystemLocales(&amp;CLanguage::EnumLocalesProc, LCID_INSTALLED)</code> does not work!</p>\n\n<p><strong>Edit:</strong>\nIt is Windows Embedded Compact 7. And the error is in syntax:</p>\n\n<blockquote>\n  <p>Error 2   error C2664: 'EnumSystemLocalesW' : cannot convert parameter 1\n  from 'BOOL (__cdecl CLanguage::* )(LPWSTR)' to 'LOCALE_ENUMPROCW'\n  {log=\"C:\\WINCE700\\osdesigns\\UVVIS2\\UVVIS2\\GUI\\bldsys.log(32)\"}    c:\\wince700\\osdesigns\\uvvis2\\uvvis2\\gui\\clanguage.cpp   24</p>\n</blockquote>\n"},{"tags":["ruby","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":234,"score":0,"question_id":3852254,"title":"How to send keystrokes to windows from a ruby app?","body":"<p>I´ve been trying to interact with another app on windows, which doesn´t have any data exchange protocol implemented. So i figured the best way to do this is by fetching data from an app and send it to the other one by sending keystrokes, simulating human interaction.</p>\n\n<p>But i am having such a hard time trying to implement this kind of behavior! Do you know how to do this using Ruby?</p>\n"},{"tags":["security","winapi","acl","ssdl"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":11848783,"title":"DACL for event preventing users from setting it","body":"<p>I would like to do the following: create an event registered with the global namespace and modify it's DACL so that:</p>\n\n<ul>\n<li>Regular users can read the event state (Using WaitForSingleObject with a 0 timeout value)</li>\n<li>Administrators can change the event status (<code>SetEvent</code> or <code>ResetEvent</code>)</li>\n</ul>\n\n<p>In addition, the event will, most of the time, be initially created by a non-admin user during application initialization</p>\n\n<p>The idea is to allow system administrators on a terminal service server to send a signal to all processes belonging to my application (there are many) that they should terminate as soon as possible and keep them locked. This must work across all user sessions but also provide some layer of security.</p>\n\n<p>I'm struggling to find the right DACLs for the event object during creation: I cannot seem to limit the ability to change the object state to administrators only.</p>\n\n<p>I'm using <code>ConvertStringSecurityDescriptorToSecurityDescriptor</code> to create a DACL from a SSDL string. Here is the closest I came to a working sample:</p>\n\n<pre><code>Format('D:(A;OICI;GA;;;BA)(A;OICI;0x%.8xF;;;WD)',[(SYNCHRONIZE)])\n</code></pre>\n\n<p>This should give <code>ALL_ACCESS</code> to members of the built-in <code>Administrators</code> group and <code>SYNCHRONIZE</code> to <code>EVERYONE</code>.</p>\n\n<p>Unfortunately, the resulting ACL doesn't work at all the way I want: if I check the resulting object state with ProcessExplorer, I see that Administrators have all the rights (as wanted) but EVERYONE still have the \"Modify state\" right set.</p>\n\n<p>In case this matters, I'm using Delphi 6. The resulting application must be compatible with windows 2003 server/XP and up.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["c++","windows","qt","winapi","usb"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":208,"score":1,"question_id":11844563,"title":"how to get vendor id and pid of usb device in qt on windows?","body":"<p>I'm using qt on Windows. My program need to know vendor id and product id of plugged usb flash drive.</p>\n\n<p>I was trying to implement example from <a href=\"http://stackoverflow.com/questions/2935184/how-to-get-vendor-id-and-product-id-of-a-plugged-usb-device-on-windows\">this topic</a>, but I'm getting segmentation fault on <a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff540277%28v=vs.85%29.aspx\" rel=\"nofollow\">WinUsb_Initialize function</a>.</p>\n\n<p>This is my code:</p>\n\n<pre><code>HANDLE hDevice = CreateFileA(\"\\\\\\\\.\\\\PhysicalDrive1\", GENERIC_WRITE | GENERIC_READ ,\n     FILE_SHARE_READ | FILE_SHARE_WRITE, 0, OPEN_EXISTING, FILE_FLAG_OVERLAPPED, 0);\n\nif(hDevice == INVALID_HANDLE_VALUE)\n{\n    qDebug() &lt;&lt; \"hDevice - INVALID_HANDLE_VALUE\";\n}\nelse\n{\n    qDebug() &lt;&lt; \"hDevice handle ok\";\n    PWINUSB_INTERFACE_HANDLE phWinUSBHandle;\n    BOOL result = false;\n    result = WinUsb_Initialize(hDevice, phWinUSBHandle); //seg\n}\n</code></pre>\n\n<p>I need phWinUSBHandle to use <a href=\"http://msdn.microsoft.com/en-us/library/windows/hardware/ff540257%28v=vs.85%29.aspx\" rel=\"nofollow\">WinUsb_GetDescriptor</a> function.</p>\n\n<p>I'll be very grateful for any help. Maybe someone knows some alternative way to get vendor id and product id in windows?</p>\n"},{"tags":["c++","windows","winapi","windows-7","memory-mapped-files"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":143,"score":0,"question_id":11858583,"title":"Access Denied Error - CreateFileMApping","body":"<p>Hi all<br>\nI am getting GetLastError 5 (access Denied) for CreateFileMapping Function. Can any one help me please . my code as below </p>\n\n<pre><code>typedef NTSTATUS(WINAPI *NtSetInformationFileNext)(HANDLE FileHandle, PIO_STATUS_BLOCK IoStatusBlock, PVOID FileInformation,\n                                                  ULONG Length, FILE_INFORMATION_CLASS FileInformationClass);\nNtSetInformationFileNext Real_NtSetInformationFileData = NULL;\nNtSetInformationFileNext Real_NtSetInformationFileVar ;\n\nNTSTATUS WINAPI NtSetInformationFileCallback(HANDLE FileHandle, PIO_STATUS_BLOCK IoStatusBlock, PVOID FileInformation,\n                                                  ULONG Length, FILE_INFORMATION_CLASS FileInformationClass)\n{\n\nif(FileInformationClass == 10)\n{\n\n    FILE_RENAME_INFORMATION *pInfo = (PFILE_RENAME_INFORMATION)FileInformation;\n\n            GetFileNameFromHandle(FileHandle);\n\n    MessageBoxW(NULL, pInfo-&gt;FileName, L\"Renamed To\", MB_OK);   \n}\n\nreturn Real_NtSetInformationFileData(FileHandle, IoStatusBlock, FileInformation, Length, FileInformationClass);\n}\n</code></pre>\n\n<p>In the above NtSetInformationFile CallBack Function i am calling GetFileNameFromHandle() function by passing FileHandle From NtSetInformationFile function , so inside GetFileNameFromHandle Function i am Calling CreateFileMapping by using the same Handle .</p>\n\n<p>please help me if anything wrong in the above Code.</p>\n"},{"tags":["winapi","seh","fs"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1447,"score":2,"question_id":4860225,"title":"FS register in Win32","body":"<p>I'm reading how SEH is implemented in Win32 and I came across this thing called the <strong>FS register</strong>. I couldn't find anything good on Google (most probably I may be searching for the wrong thing). So can anyone explain what it is?</p>\n"},{"tags":["c","winapi","com","wcf-client"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":34,"score":-2,"question_id":11408034,"title":"C# Application with Jazzy UI","body":"<p>I currently have a C Shell with a native browser (IE) Embedded Can i anyhow use WPF /WCF in this ?\n I am talking total Client Side not a launcher app ?</p>\n\n<p>Wanted something cool and Jazzy with respect to UI</p>\n"},{"tags":["delphi","winapi","progress-bar","tpanel"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":11840689,"title":"In Win API how to get position of progressbar of another application, if it realized by TPanel of Delphi?","body":"<p>need to get position of progress-bar of another application. MS Spy++ points that is TPanel. It can change colour and has numeral position state. How to get all of this in Win API? </p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":11854331,"title":"How to disable win32 'interface' macro?","body":"<p>I'm going absolutely nuts here. I'm doing some C++ development on Windows and I have a namespace named 'interface':</p>\n\n<pre><code>namespace gd {\nnamespace interface {\n\n}} // end namespace\n</code></pre>\n\n<p>However, there is a file named \"objbase.h\" that gets included no matter if I include \"Windows.h\" or \"Wtypes.h\", which contains a macro named 'interface'. This macro won't allow me to use the namespace name. Is there a feature in the Win32 API to disable the definition of the interface macro? If not, can someone think of a clever workaround to disabling it, without requiring too many mass changes in my code base?</p>\n"},{"tags":["c++","winapi","named-pipes"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":180,"score":0,"question_id":11853478,"title":"getting error code 998 Invalid access to memory location when trying to read from named pipe","body":"<p>I created a named pipe using WCF and C#, and a client to connect to it so that I know that it is working correctly.  Now I'm trying to create a c++ client.  So far I have been able to get the name of the pipe, connect to it, and write some data to it.  When I try to read from it I'm getting <code>error code 998 Invalid access to memory location</code>.  Here is the code I'm using:</p>\n\n<pre><code>HANDLE hPipe = CreateFile(pipeName.c_str(), GENERIC_WRITE | GENERIC_READ, 2, NULL, OPEN_EXISTING, NULL, NULL);\nBOOL bWrite = WriteFile(hPipe, &amp;message, size, &amp;bytesWritten, NULL);\nLPVOID buffer = 0;\nDWORD bytesRead;\nBOOL bRead = ReadFile(hPipe, buffer, 10, &amp;bytesRead, NULL);\n</code></pre>\n\n<p>I'm not sure what I'm doing wrong.</p>\n"},{"tags":["c","winapi","lua","ffi","luajit"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":103,"score":1,"question_id":11846910,"title":"Calling standard open dialog with LuaJIT gives access violation","body":"<p>Followed <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms646829%28v=vs.85%29.aspx#open_file\" rel=\"nofollow\">MSDN's GetOpenFileName example</a> using the FFI of LuaJIT. I've been trying to get this working for two days, not only the dialog doesn't opens but it crashes the entire thing.</p>\n\n<p>When debugged with OllyDdb it throws an ugly access violation somewhere in <em>comdlg32.dll</em>.</p>\n\n<p>Here's the proof of concept with just the essential code. If I specify that the struct size is zero it exits without problem, with <em>GetLastError()</em> throwing a <strong>87</strong> (ERROR_INVALID_PARAMETER)</p>\n\n<p>So I suppose that the problem is struct or FFI related.</p>\n\n<p>If somebody is able to shed some light over here... thankies.</p>\n\n<pre><code>ffi = require\"ffi\"\nbit = require\"bit\"\n\ncollectgarbage(\"stop\")\n\nffi.cdef[[\n  static const int OFN_FILEMUSTEXIST             = 0x1000;\n  static const int OFN_NOCHANGEDIR               = 8;\n  static const int OFN_PATHMUSTEXIST             = 0x800;\n\n  typedef bool BOOL;\n  typedef char CHAR;\n\n  typedef unsigned short WORD; \n  typedef unsigned long DWORD;\n\n  typedef void *PVOID;\n  typedef void *LPVOID;\n  typedef void *LPOFNHOOKPROC;\n\n  typedef unsigned long HANDLE;\n  typedef HANDLE HWND;\n  typedef HANDLE HINSTANCE;\n\n  typedef const char *LPCSTR;\n  typedef const char *LPCTSTR;\n\n  typedef char *LPSTR;\n  typedef char *LPTSTR;\n\n  typedef unsigned long LPARAM;\n\n  typedef struct {\n    DWORD         lStructSize;\n    HWND          hwndOwner;\n    HINSTANCE     hInstance;\n    LPCTSTR       lpstrFilter;\n    LPTSTR        lpstrCustomFilter;\n    DWORD         nMaxCustFilter;\n    DWORD         nFilterIndex;\n    LPTSTR        lpstrFile;\n    DWORD         nMaxFile;\n    LPTSTR        lpstrFileTitle;\n    DWORD         nMaxFileTitle;\n    LPCTSTR       lpstrInitialDir;\n    LPCTSTR       lpstrTitle;\n    DWORD         flags;\n    WORD          nFileOffset;\n    WORD          nFileExtension;\n    LPCTSTR       lpstrDefExt;\n    LPARAM        lCustData;\n    LPOFNHOOKPROC lpfnHook;\n    LPCTSTR       lpTemplateName;\n\n    LPVOID        pvReserved;\n    DWORD         dwReserved;\n    DWORD         flagsEx;\n\n  }OPENFILENAME;\n\n  BOOL GetSaveFileNameA( OPENFILENAME lpofn );\n  BOOL GetOpenFileNameA( OPENFILENAME lpofn );\n]]\ncom=ffi.load(\"comdlg32\")\n\nffi.cdef[[\n  DWORD GetLastError(void);\n]]\nkrnl=ffi.load(\"kernel32\")\n\nfunction OpenDialog()\n  Ofn=ffi.new(\"OPENFILENAME\")\n  ffi.fill(Ofn,ffi.sizeof(Ofn)) --zero fill the structure\n\n  local szFile        = ffi.new(\"char[260]\",\"\\0\")\n  local hwnd          = ffi.new(\"HWND\",0)\n\n  Ofn.lStructSize     = ffi.sizeof(Ofn)\n  Ofn.hwndOwner       = hwnd\n\n  Ofn.lpstrFile       = szFile\n  Ofn.nMaxFile        = ffi.sizeof(szFile)\n\n  Ofn.lpstrFilter     = \"All\\0*.*\\0Text\\0*.TXT\\0\"\n  Ofn.nFilterIndex    = 1\n\n  Ofn.lpstrFileTitle  = nil\n  Ofn.nMaxFileTitle   = 0\n\n  Ofn.lpstrInitialDir = nil\n  Ofn.flags           = bit.bor(com.OFN_PATHMUSTEXIST, com.OFN_FILEMUSTEXIST, com.OFN_NOCHANGEDIR)\n\n  print(\"displaying...\")\n\n  if com.GetOpenFileNameA(Ofn) then --luajit converts bool automatically\n    print(\"file-&gt;\",ffi.string(Ofn.lpstrFile, Ofn.nMaxFile))\n  end\n\n  print(\"lasterror-&gt;\",krnl.GetLastError())\nend\n\nOpenDialog()\n</code></pre>\n"},{"tags":["security","winapi","login","uac"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":673,"score":4,"question_id":9298083,"title":"Win32: bypassing UAC using user/password","body":"<p>I'm looking for a way to elevate the execution privileges of a thread or process without the UAC popup appearing. \nThe user who runs the process is an admin user and I have his username and password available.  </p>\n\n<p>I need to do that in order to do some administrative stuff like restarting a service and writing files to system directories. My application is run remotely and there is no interactive user to confirm the UAC dialog. Disabling UAC is not an option.</p>\n\n<p>I've tried juggling <code>LogonUser()</code>, <code>ImpersonateLoggedOnUser()</code>, <code>CreateProcessAsUser()</code> and <code>DuplicateTokenEx()</code> for the better part or two days but couldn't figure out the right combination and if at all this is even possible.</p>\n\n<hr>\n\n<p>Specifically what I've tried is this:</p>\n\n<pre><code>HANDLE token = 0;\nLogonUserA(user, NULL, pass, LOGON32_LOGON_NETWORK_CLEARTEXT, LOGON32_PROVIDER_DEFAULT, &amp;token);\nHANDLE impToken = 0;\nDuplicateToken(token, SecurityImpersonation, &amp;impToken);\nImpersonateLoggedOnUser(impToken);\nCreateFileA(\"C:\\\\windows\\\\blabla.dll\", GENERIC_WRITE, 0, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);\n</code></pre>\n\n<p>the last call fails with <code>GetLastError()</code>=1346, \"Either a required impersonation level was not provided, or the provided impersonation level is invalid.\" </p>\n\n<p>What am I doing wrong?<br>\nNote - this is running on Win2008 R2</p>\n"},{"tags":["c#","wpf","windows","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":11847955,"title":"Registry.GetValue(): Issue with return statement syntax","body":"<p>Can someone please tell me what this c# syntax exactly means:</p>\n\n<pre><code>return (int)MyPersistenceClass.GetValue(REG_ENTRY_HHHH, DEFAULT_REG_ENTRY_HHHH) == 1\n</code></pre>\n\n<p>Is it correct to say that if (int)GetValue() == 1 return the value. Where I am not sure is what do I return when (int)GetValue() != 1. Any help greatly appreciated.</p>\n"},{"tags":["winapi","networking","windows-xp","tcp"],"answer_count":9,"favorite_count":4,"up_vote_count":4,"down_vote_count":0,"view_count":17791,"score":4,"question_id":382998,"title":"\"Repair\" network connections programatically/from command line","body":"<p>Does anyone know exactly what Windows XP does when you click \"Repair\" on a network connection? I'd like to do the same programatically or from a command line.</p>\n\n<p>I did a Google search and found <a href=\"http://windowsitpro.com/article/articleid/41060/what-actions-occur-when-i-click-repair-on-a-network-connection-in-windows-xp-and-later.html\" rel=\"nofollow\">this article</a>, which has a good explanation, but I don't think it's complete. I can reliably reproduce a condition where I lose network connectivity and clicking the Repair button fixes the problem, but running the commands in that article does not.</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":223,"score":2,"question_id":11849857,"title":"Force display resolution in Windows / C++","body":"<p>I have one of those switch views set up to toggle one monitor between two machines and it seems to be stripping off some of the information from the monitor. The monitor's native resolution is 1920x1080@60hz but Windows refuses to let me set it to anything higher than 25hz interlaced, which looks absolutely terrible. I've tried all the drivers and settings suggested  by extensive google searching and still nothing. </p>\n\n<p>As a quick project I tried to see if I could force the monitor to a specific display setting using the <code>ChangeDisplaySettingsEx</code> winapi function but it looks like windows is still checking to make sure the mode is in the incorrect set of supported modes and returns <code>DISP_CHANGE_BADMODE</code>. </p>\n\n<p>Here's the full function:</p>\n\n<pre><code>WCHAR deviceName[64];\nDISPLAY_DEVICE dd;  \ndd.cb = sizeof(DISPLAY_DEVICE);\nint index=0;\nwhile (EnumDisplayDevices(NULL, index++, &amp;dd, 0))\n{\n    // first monitor is the problem one\n    if (index == 1) {\n        lstrcpy(deviceName, dd.DeviceName);\n    }\n}\n\nDEVMODE dmScreenSettings;\nZeroMemory(&amp;dmScreenSettings, sizeof(DEVMODE));\ndmScreenSettings.dmSize             = sizeof(DEVMODE);\ndmScreenSettings.dmPelsWidth        = 1920;\ndmScreenSettings.dmPelsHeight       = 1080;\ndmScreenSettings.dmBitsPerPel       = 32;\ndmScreenSettings.dmDisplayFrequency = 60;\ndmScreenSettings.dmFields           = DM_DISPLAYFREQUENCY | DM_BITSPERPEL | DM_PELSWIDTH | DM_PELSHEIGHT;\n\nLONG res = ChangeDisplaySettingsExW((LPCWSTR) &amp;deviceName, &amp;dmScreenSettings, NULL, CDS_RESET, NULL);\nif (res != DISP_CHANGE_SUCCESSFUL)\n{\n    if (res == DISP_CHANGE_BADMODE)\n        MessageBoxA(NULL, \"Bad mode\", \"Failed\", MB_ICONHAND);\n    else if (res == DISP_CHANGE_BADPARAM)\n        MessageBoxA(NULL, \"Bad Param\", \"Failed\", MB_ICONHAND);\n    else\n        MessageBoxA(NULL, \"Other error\", \"Failed\", MB_ICONHAND);\n}\n</code></pre>\n\n<p>I've seen <a href=\"http://stackoverflow.com/questions/6835076/how-can-i-force-any-display-resolution-timing-i-want\">How can I force any display resolution/timing I want?</a> and I'd rather not go down the path of using the ATI SDK (I have an ATI Radeon) if at all possible. Any suggestions? I think it would be pretty neat to solve this one with software.</p>\n"},{"tags":["c++","winapi","mfc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":472,"score":0,"question_id":3407253,"title":"How do I put a checkmark on a menu item that has submenu items. (Visual studio 2008 C++/MFC)","body":"<p>I have a menu that contains submenus.</p>\n\n<p>eg:</p>\n\n<ul>\n<li>Item1</li>\n<li>Item2</li>\n<li>Item3\n<ul>\n<li>item A</li>\n<li>Item B</li>\n</ul></li>\n</ul>\n\n<p>Item3 has items under it.</p>\n\n<p>At any given time 1, 2, or the items under 3 should be checked.  Since I don't have an ID for Item3 I have to use the <code>MF_BYPOSITION</code> indicator when I try to set a check on Item3 to indicate one of its children has a checkmark.  Item3 should have a checkmark if A or B are checked.  I am able to check items 1 and 2 and A and B - but can't figure out item3.</p>\n\n<p>I have not been able to successfully use either <code>::CheckMenuItem()</code> or <code>ModifyMenu()</code> to set the check mark.  </p>\n\n<p>Can someone point me to an example that does this successfully?  The docs seem to indicate it can be done, but I have been unable to do it.</p>\n\n<p>EDIT</p>\n\n<p>This is for a menu that is set as the menu for a dlg box.  The menu bar has three items - one of which drops down to what is shown above.  </p>\n\n<p>Note also, it is used as a popup for a right click, but I will take any suggestions to work in either case.</p>\n"},{"tags":["winapi","visual-c++","dll","dll-injection"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":11716204,"title":"How to unload an injected DLL from target process, from the DLL when done?","body":"<p>I have a DLL that injects itself using the CreateRemoteThread/LoadLibrary method.</p>\n\n<p>It is cumbersome to quit the target application and restart it (it has a loading time of 10-20 seconds) when debugging and developing the DLL, so I want to unload the DLL when I have checked that what my code does works, to recompile / re-inject it.</p>\n\n<p>I want to avoid creating a new DLL with a framework for loading and unloading said DLL.</p>\n\n<p>How is this possible?</p>\n"},{"tags":["c++","windows","winapi","dialog","embedded-resource"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":253,"score":0,"question_id":11843216,"title":"How to use DialogBoxParam?","body":"<p>I have a pre-made template resource dialog, and I want to use <code>DialogBoxParam</code> to display it, but I can't find any good examples over the internet. The dialog is a simple login dialog, so can someone explain how to build my <code>lpDialogFunc</code> and what to put in <code>dwInitParam</code>?</p>\n"},{"tags":["c++","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":128,"score":0,"question_id":11844050,"title":"C++ wParam and Lparam confusion","body":"<p>I know that wParam and lParam are (32 bit I belive) bits of information specific to the message being passed at the time, but is there any way to tell what each message puts into the two?</p>\n\n<p>I read somewhere that wParam is 16 bit and lParam is 32 bit, but it still doesn't really explain what I should expect to see, or at least which variable I should expect to see something in.  I've seen some examples of messages using lParam, and other examples of messages using wParam, and yet other examples of both being used.  </p>\n\n<p>For instance, I saw keydown uses wParam for receiving a specific key, but lParam is used in LButtondown, with the upper 16 being the y, and the lower 16 being the x.  The reason that one specifically should be in lParam makes sense (because it takes 32 bits), but how can I find out which one other messages send, and what is in them?</p>\n\n<p>(sorry, I think I may have repeated my question a couple times in that slight rant)</p>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":209,"score":0,"question_id":11831939,"title":"Strange value for available physical memory","body":"<p>I use a code library that contains a function to calculate the amount of memory avaliable.</p>\n\n<p>For hosted PC's (hosted by Windows 2008 R2 x64) I sometimes see the free amount calculated in a funny way.</p>\n\n<p>It gets reported as </p>\n\n<blockquote>\n  <p>physical memory   : 1400/1400 MB (free/total)</p>\n</blockquote>\n\n<p>Which cant really be true, since several applications are running. How can that happen?</p>\n\n<p>My interest here is whether this phenomenon points to a memory problem. Sometimes my application runs out of memory when hosted on a VM with limited memory like 1400 MB. So when I see a bug report with the available meory wrongly reported as 1400 MB could it be that it really is zero?</p>\n\n<p>Here is the code</p>\n\n<pre><code>function GetMemoryStatus : UnicodeString;\ntype\n  TMemoryStatusEx = record\n    dwLength                : dword;\n    dwMemoryLoad            : dword;\n    ullTotalPhys            : int64;\n    ullAvailPhys            : int64;\n    ullTotalPageFile        : int64;\n    ullAvailPageFile        : int64;\n    ullTotalVirtual         : int64;\n    ullAvailVirtual         : int64;\n    ullAvailExtendedVirtual : int64;\n  end;\nvar gmse : function (var mse: TMemoryStatusEx) : bool; stdcall;\n    ms   : TMemoryStatus;\n    mse  : TMemoryStatusEx;\nbegin\n  gmse := GetProcAddress(GetModuleHandle(kernel32), 'GlobalMemoryStatusEx');\n  if @gmse &lt;&gt; nil then begin\n    mse.dwLength := sizeOf(mse);\n    gmse(mse);\n  end else begin\n    ms.dwLength := sizeOf(ms);\n    GlobalMemoryStatus(ms);\n    mse.ullAvailPhys := ms.dwAvailPhys;\n    mse.ullTotalPhys := ms.dwTotalPhys;\n  end;\n  result := IntToStrExW((mse.ullAvailPhys + $80000) div $100000) + '/' +\n            IntToStrExW((mse.ullTotalPhys + $80000) div $100000) + ' MB (free/total)';\nend;\n</code></pre>\n\n<p>Thanks!\nJacob</p>\n"},{"tags":["c++","winapi","input","localization","locale"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":110,"score":0,"question_id":11842711,"title":"C++/Win32 Finding all keyboard input languages?","body":"<p>I want to find all the input languages for the keyboard, the ones that you switch between with LEFT ALT + SHIFT.</p>\n\n<p>I can get the default locale and the installed/supported locales with win API but I could not find anywhere anything about the input locales for the keyboard.</p>\n"},{"tags":["c++","winapi","gdi","toolbar"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":11842878,"title":"Reduce width of toolbar button","body":"<p>Is there a way to reduce the width of toolbar with <code>BTNS_DROPDOWN</code> style. I created a button with <code>BNTS_DROPDOWN</code> and <code>TBSTYLE_AUTOSIZE</code>. Whenever button is created it includes droparrow width . I want to reduce the width and draw custom image. Is is possible.?</p>\n"},{"tags":["winapi","serial-port"],"answer_count":4,"favorite_count":2,"up_vote_count":11,"down_vote_count":0,"view_count":6743,"score":11,"question_id":1388871,"title":"How do I get a list of available serial ports in Win32?","body":"<p>I have some legacy code that provides a list of the available COM ports on the PC by calling the <a href=\"http://msdn.microsoft.com/en-us/library/dd162687%28VS.85%29.aspx\"><code>EnumPorts()</code></a> function and then filtering for the port names that start with \"COM\".</p>\n\n<p>For testing purposes it would be very useful if I could use this code with something like <a href=\"http://com0com.sourceforge.net/\">com0com</a>, which provides pairs of virtual COM ports looped together as a null-modem.</p>\n\n<p>However the com0com ports are not found by the <code>EnumPorts()</code> function (even without filtering for \"COM\"). HyperTerminal and SysInternals PortMon can both see them, so I'm sure it is installed correctly.</p>\n\n<p><strong>So is there some other Win32 function that provides a definitive list of available serial ports?</strong></p>\n"},{"tags":["c#","winapi","keyboard","winmm"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":117,"score":1,"question_id":11831958,"title":"Multimedia control with a multimedia keyboard in C#","body":"<p>I have keyboards, as well as the keyboard built into my laptop, which have multimedia keys. One of the multimedia keys is of course pause/play and it's a function of the keyboard driver that can be assigned to other keys. When it's pushed, it will pause/play iTunes, Windows Media Player, etc. depending on what my \"last active\" media application is.</p>\n\n<p>My question is, in C# how can I duplicate this functionality to be able to pause/play the system sound. I've looked through the API and the only thing that looked close were the winmm.dll waveOutPause and midiOutPause functions</p>\n"},{"tags":["winapi","hook"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":11842605,"title":"Hooking ExtTextOutW not gives the text with proper information","body":"<p>I am creating an application that can get text from the selected rectangle on any window. So I am doing this by hooking the ExtTextOut(A/W), TextOut(A/W), DrawText(A/W) apis.\nI am able to retrieve the text from windows but in some special cases I am not able to get the text properly.\nWhen I tried to debug it I saw that the HDC parameter of ExtTextOutW can not been used to get the HWND, because when I try to call WindowFromDC(hdc), it returns NULL HWND.</p>\n\n<p>I tried to find out the reason then I found that this HDC is memoryDC so is there any way to get the HWND from that memory DC.</p>\n\n<p>So Please somebody help me to get the actual HWND from the HDC. </p>\n"},{"tags":["c#","winapi","ironpython"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":822,"score":3,"question_id":127912,"title":"How to use win32api from IronPython","body":"<p>Writing some test scripts in IronPython, I want to verify whether a window is displayed or not.  I have the pid of the main app's process, and want to get a list of window titles that are related to the pid.  </p>\n\n<p>I was trying to avoid using win32api calls, such as FindWindowEx, since (to my knowledge) you cannot access win32api directly from IronPython.  Is there a way to do this using built-in .net classes?  Most of the stuff I have come across recommends using win32api, such as below.</p>\n\n<p><a href=\"http://stackoverflow.com/questions/79111/net-c-getting-child-windows-when-you-only-have-a-process-handle-or-pid\">.NET (C#): Getting child windows when you only have a process handle or PID?</a></p>\n\n<p>UPDATE:  I found a work-around to what I was trying to do.  Answer below.   </p>\n"},{"tags":["c#","windows","winapi","window-handles","window-handling"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":899,"score":1,"question_id":3386845,"title":"Handling invalid window handle","body":"<p>The application retrieve window handles, using Enum* routines.</p>\n\n<p>It happens that in the while the application manage the handle (get class name, window statistics...) of an enumerated/created window, the handle is no more valid. The code managing window handles are protected using a try/catch block, but the window handle is stored and the successively used for managing the represented window.</p>\n\n<p>How to handle the window handle lifetime? It is possible to detect the handle invalidity?</p>\n\n<p>I'd like to avoid try/catch blocks every time the application uses the window handles.</p>\n"},{"tags":["c++","winapi","variables","scope"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":11839412,"title":"Getting value from edit field (C++ WINAPI)","body":"<p>I am writing my first simple program in C++/WINAPI, with a lot of check boxes and a few edit fields, which will set up some calculations on a button press.  All of my check boxes work/store info through individual cases, ie</p>\n\n<pre><code>switch (msg)\n{\n    ...\n    case WM_COMMAND:\n    {\n        switch (wParam)\n        {\n            case IDBC_BoxCheck1:\n            {...}\n            case IDBC_BoxCheck2:\n            {...}\n            ...\n        } ...\n</code></pre>\n\n<p>...but I assumed edit fields didn't work as a case statement like a button press, since the value has to be read at the end once it has been changed as many times as the user wants. I looked online and attempted to use the SendMessage(hwnd, ...) and GetWindowText(hwnd, ...) functions to send a WM_GETTEXT command to the edit field and store it to a lpstr string, but I ran into the same problem with both of them - the hwnd for the edit fields aren't declared in the scope where the WM_GETTEXT command is being sent from, and I'm not sure how to get it there. Here is an overview of the structure being used in my program, which comes from a mix of some tutorials I was working with:</p>\n\n<pre><code>LRESULT CALLBACK WndProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)\n{\n    switch (msg)\n    {\n        case WM_CREATE:\n        {\n            return OnCreate(hwnd, reinterpret_cast&lt;CREATESTRUCT*&gt;(lParam));\n            // OnCreate is a sub function that handles the creation of all the buttons/controls,\n            // since there are so many of them, with the format:\n            // HWND editControl1 = CreateControl(...); // CreateControl being another sub fnct\n                                                       // that creates edit field ctrls\n                                                       // editControl1 is the hwnd I'm trying\n                                                       // to read the value from\n            // HWND checkControl1 = CreateButton(...); // Creates button ctrls, including ck box\n            ...\n        }\n        ...\n        case WM_COMMAND:\n        {\n            switch (wParam)\n            {\n                case IDBC_BoxCheck1:    // These control IDs are defined at the top of the file\n                {\n                   LPSTR Check1;\n                   StoreInfo(Check1);   // Just a sub fnct to store info for later calculations\n                }\n                case IDBC_BoxCheck2:\n                {\n                    LPSTR Check2;\n                    StoreInfo(Check2);\n                } // etc... there are 20 or so check boxes/buttons\n                case IDBC_Calculate:    \n                {\n                    LPSTR edit1;\n                    GetWindowText(editControl1, edit1, 100); // or SendMessage(editControl1, ...)\n                    // This kicks out the error of editControl1 not being declared in this scope\n                    StoreInfo(edit1);\n                    // Calculation function goes here\n                } ...\n            } ....\n        }\n        default: DefWindowProc(hwnd, msg, wParam, lParam);\n    }\n}\n</code></pre>\n\n<p>IDBC_Calculate is the final button pressed before the calculations run. I figured the best place to read and store the values from the edit fields would be after this button is pressed, right before the calculation function is called, but tied to the same command.  This is where the hwnd editControl1 is undefined, but I don't know how to send the definition to this scope, or where else I should be reading and storing the edit field values. </p>\n\n<p>Any help or pointers on getting the values from these edit fields to my other functions would be appreciated!  I've seen many different ways to check button states in various tutorials/lessons, so I'd love to know if there's a better way to do what I've written above in general.</p>\n"},{"tags":["c++","winapi","visual-c++","atl","wtl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":11840301,"title":"How to make your own native-like (copyable) controls with ATL/WTL?","body":"<p>When you're using WTL, you can freely copy controls that represent <strong>built-in</strong> objects:</p>\n\n<pre><code>// Notice that CWindow is passed by _copy_, because it only wraps the HWND\nint OnNotifyFormat(CWindow wndFrom, int nCommand) { ... }\n</code></pre>\n\n<p>Now, if I want to make my <strong>own</strong> controls, it's easy enough to say:</p>\n\n<pre><code>template &lt;class T, class TBase = CWindow, class TWinTraits = CControlWinTraits&gt;\nstruct CMyControlImpl: public CWindowImpl&lt;T, TBase, TWinTraits&gt;\n{\n    std::vector&lt;int&gt; internal_info;\n\n    BEGIN_MSG_MAP_EX(...)\n        ...\n    END_MSG_MAP()\n};\n\nstruct CMyControl : public CMyControlImpl&lt;CMyControl&gt;\n{\n    DECLARE_WND_CLASS_EX(TEXT(\"MyControl\"), 0, COLOR_WINDOW)\n};\n</code></pre>\n\n<p>but now the problem is that I <strong>can't</strong> simply say:</p>\n\n<pre><code>void OnFooHappened(CMyControl control)\n{\n}\n</code></pre>\n\n<p>because <code>CMyControl</code> is more than just a handle -- it contains the data itself!</p>\n\n<p>What is the correct way to make a control class that is <strong>consistent</strong> with the built-in ATL/WTL classes, with respect to this copy behavior?</p>\n"},{"tags":["wpf","winapi","powerbuilder"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":11840405,"title":"hresult : 0x80004004(e_ABORT) displaying WPF in Win32 application (powerbuilder)","body":"<p>i'm trying to insert a wpf page in win32 window written in powerbuilder.\nIt works fine mostly but for just one client (always on windows XP)\nthe wpf component doesn't appear (just black screen) and i get the message :</p>\n\n<p>\"HResult exception : 0x80004004(E_ABORT)\"</p>\n\n<p>if a suppress all the xaml code to display an empty wpf page, i don't get the problem</p>\n\n<p>Any ideas ?</p>\n\n<p>Thanks</p>\n"},{"tags":["c++","winapi","unix","logging","timestamp"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":216,"score":4,"question_id":11822588,"title":"Efficiently computing date/time stamp for logging purposes on unix/win32","body":"<p>I'm in a situation where after having profiled and analyzed our system, come to the conclusion that the logging component of the system is one of the many bottle necks taking up about ~17% of total running time - a lot of things are logged.</p>\n\n<p>Of this, about 5% of the time the logger consumes is related to producing a date/time stamp in ascii in the following format: YYYYMMDD HHMMSS.fff - we roughly log about 700k lines per second. (roughly 700K x (localtime and gettimeofday) calls per second)</p>\n\n<p>I was wondering what techniques fellow SOers have for producing time-stamps efficiently.</p>\n\n<p>Cross platform solutions would be welcomed.</p>\n\n<p>Note1: we looked into Boost.datetime - it's great, but a bit too slow for our needs, std::chrono is a perfect solution, however we unfortunately  have to support pre c++11 compilers.</p>\n\n<p>Note2: We've implemented a simple optimisation that only computes the date part (yyyymmdd) one per 24hrs hence only having 1 gettimeofday call per line - didn't help much though. </p>\n"},{"tags":["windows","winapi","visual-c++","dialog"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":111,"score":1,"question_id":11812931,"title":"How to make a Win32 dialog appear at the default position (CW_USEDEFAULT)?","body":"<p>How do I make a Win32 <strong>dialog</strong>  appear at the default position/size?  </p>\n\n<p>(i.e. How do I simulate <code>CW_USEDEFAULT</code> for <code>CreateWindow</code> when the window is already created)?</p>\n"},{"tags":["c++","winapi","mfc","hook"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":86,"score":-1,"question_id":11833431,"title":"Hooking GetSysColor in user32.dll","body":"<p>I have a problem hooking the \"GetSysColor\" function of \"user32.dll\" in order to modify </p>\n\n<pre><code>COLOR_ACTIVECAPTION\nCOLOR_CAPTIONTEXT\nCOLOR_INACTIVECAPTION\nCOLOR_INACTIVECAPTIONTEXT\n</code></pre>\n\n<p>My windows hook class looks like this:</p>\n\n<pre><code>CHook(const TCHAR * module, const TCHAR * procname, const void * pNewProc)\n{        \n    HINSTANCE hMod = GetModuleHandle(module);\n    m_pProc = (BYTE*)GetProcAddress(hMod, procname);\n\n    if (m_pProc)\n    {\n        for (int i = 0; i &lt; 5; i++)\n        {\n            m_Storage[i] = m_pProc[i];\n        }\n\n        DWORD dwOldProtect;\n        VirtualProtect(m_pProc, 5, PAGE_EXECUTE_READWRITE, &amp; dwOldProtect);\n        m_pProc[0] = 0xE9;\n        *(unsigned*)(m_pProc + 1) = (unsigned)pNewProc - (unsigned)(m_pProc + 5);\n    }\n}\n\n~CHook()\n{\n    if (m_pProc &amp;&amp; (m_pProc[0] == 0xE9))\n    {\n        for (int i = 0; i &lt; 5; i++)\n        {\n            m_pProc[i] = m_Storage[i];\n        }\n    }\n}\n\nprivate:\n    BYTE* m_pProc;\n    BYTE  m_Storage[5];\n</code></pre>\n\n<p>I wrote a custom getsyscolor method</p>\n\n<pre><code>static COLORREF WINAPI GetCustomSysColor(int nIndex)\n{\n    return RGB(0xFF, 0x00, 0x00);\n}\n</code></pre>\n\n<p>to test, if every message gets routed through that function (everything should be red at the end then). I installed it via</p>\n\n<pre><code>CHook theHook(\"user32.dll\", \"GetSysColor\", GetCustomSysColor);\n</code></pre>\n\n<p>Unfortunately, not everything gets painted red, only a few things like icons etc. But the colors mentioned at the beginning are the former system settings - captions are still drawn blue with white text. I even debugged it and the colors for caption arrive in the GetCustomSysColors method.</p>\n\n<p>Maybe anybody knows if there is another winapi call going on for the caption or if I missed anything important. Thank you very much!</p>\n\n<p>Cheers,\nChris</p>\n"},{"tags":["winapi","code-coverage","windbg","vtune"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":251,"score":0,"question_id":3427864,"title":"How to measure Windows API code coverage of app level benchmarks","body":"<p>My job involves system-level performance testing with third party tools that I do not have sources for.  I'm also testing Windows, and can use debugging symbols but not Windows source code.  I'd like a quantitative way to describe the areas of the host OS my tests cover.  There are two big steps to this: identifying what DLLs and functions I want to look at, and then determining how to profile calls to those.</p>\n\n<p>Ideas for coverage:</p>\n\n<ul>\n<li>All functions from kernel.dll, ntdll.dll, user.dll, etc... The main built in modules.  This might be a huge amount of overkill and will probably identify lots of gaps that only have to do with deprecated functionality.</li>\n<li>Just the module names for any DLLs used by the target application.  Not as detailed, but also less likely to miss key functionality in the target app.</li>\n<li>App specific modules like d3d10.dll for DirectX 10 apps.</li>\n<li>Basic blocks.  I'm guessing this would be a PhD thesis amount of work.</li>\n</ul>\n\n<p>Profiling ideas:</p>\n\n<ul>\n<li>Run VTune call graph analysis on all of my tests.  This sort of works, but seems to provide a limited view of which builtin functions actually get called.</li>\n<li>Dynamically instrument the app with something like Pin or DynamoRIO.  Possible con: slow.</li>\n<li>Catch calls with WinDbg.  Not sure if this would be easier or quicker than Pin.</li>\n<li>Static analysis using a disassembly tool like IDA Pro.</li>\n</ul>\n\n<p>Is there any published work along these lines on Windows?  Have you ever used one of these tools for hooking or logging enough that you could recommend it?</p>\n"},{"tags":["c++","winapi","serial-port"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":400,"score":0,"question_id":8535017,"title":"Manual control of serial port pins (TxD and RxD)","body":"<p>I'm working on some idea connected with RS-232 interface manipulation. I can open this port, configure it, write or read data and do some other things with WinAPI. But I don't know how to control individual pins. Well I can take control of DTR and RTS lines via <code>EscapeCommFunction</code> function. But I need to manipulate with TxD and RxD lines (\"turn\" them \"on\" or \"off\", binary). Is this possible in Windows 7? </p>\n"},{"tags":["c++","windows","winapi","boost","directx"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":11834321,"title":"C++ boost prevents from showing main window","body":"<p>I got really weird problem here. I'm creating pretty simple 2d game engine in C++/DirectX and I wanted to use boost (particularly boost serialization). The problem is, when I put the simplest boost example into my code and build the project, the window (created in winapi) is not visible. There are no problems during compilation and the strangest part - boost serialization works well (saves simple string into the file). I tried different things, I even reinstalled boost but the problem still remains. The error seems to be within this line:</p>\n\n<pre><code>text_oarchive oa(ofs);\n</code></pre>\n\n<p>When I uncomment it the windows is visible. Anyone came across this kind of problem? I really need those boost libraries...</p>\n"},{"tags":["c#","winapi","window","focus"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":138,"score":0,"question_id":11833827,"title":"In C#, how to activate the previously focused window?","body":"<p>I work eg. in Firefox, and my C#.NET app brings its window to the front. That's ok, but when I use SendToBack() to hide the form, it doesn't activate Firefox's window, so altough Firefox is in the foreground, I have to click into the window to be able to scroll, etc. How can I activate the previously focused window in C#?</p>\n\n<p>i have tried these:</p>\n\n<pre><code>[DllImport(\"User32\")]\nprivate static extern int SetForegroundWindow(IntPtr hwnd);\n\n[DllImport(\"user32.dll\")]\nstatic extern bool AllowSetForegroundWindow(int dwProcessId);\n\n[DllImport(\"user32.dll\")]\nstatic extern IntPtr GetForegroundWindow();\n\n[...]\n\nAllowSetForegroundWindow(System.Diagnostics.Process.GetCurrentProcess().Id);\nSendToBack();\nSetForegroundWindow(GetForegroundWindow());\n</code></pre>\n\n<p>I hoped that after sending my window back, the previous one will be returned by GetForegroundWindow, but it doesn't work.</p>\n\n<p>Secondly, I've tried to override WndProc, and handle the WM_ACTIVATE message to get the previous window from lParam, but it doesn't work either if I use SetForegroundWindow() with this handle.</p>\n\n<pre><code>protected override void WndProc(ref Message msg) {\n        if (msg.Msg == 0x0006) {\n            prevWindow = msg.LParam;\n        }\n        base.WndProc(ref msg);\n}\n\n[...]\n\nSetForegroundWindow(prevWindow);\n</code></pre>\n"},{"tags":["winapi","mfc"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":179,"score":1,"question_id":11832252,"title":"Child window forwards messages to parent","body":"<p>I have a parent window (MFC dialog) with some controls on it (editbox, button, etc.), which looks like this: </p>\n\n<p><img src=\"http://i.stack.imgur.com/zfVTL.png\" alt=\"appearance of the initial dialog\"></p>\n\n<p>At runtime (<code>OnInitDialog</code>), I create another child window which covers and hides all the other controls in the dialog, using this code: </p>\n\n<pre><code>  RECT r;\n  GetClientRect(&amp;r);\n  m_layer.Create(NULL, NULL, WS_CHILD | WS_VISIBLE, r, this, 0);\n</code></pre>\n\n<p>The <code>m_layer</code> object is an instance of a class <code>CLaywerWnd</code> inherited from <code>CWnd</code>. In this class I override the following method:</p>\n\n<pre><code>BOOL CLayerWnd::OnEraseBkgnd(CDC* pDC)\n{\n  CBrush b(RGB(0, 100, 100));\n  RECT r;\n  GetClientRect(&amp;r);\n  pDC-&gt;FillRect(&amp;r, &amp;b);\n  return TRUE;\n}\n</code></pre>\n\n<p>Now my window looks like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/R75gB.png\" alt=\"parent with child window which covers controls\"></p>\n\n<p>The problem is that when I move the mouse cursor or click on this new child window the messages are forwarded to the parent window (I checked this using Spy++), and the other child controls are redrawn over the new child window, like bellow.</p>\n\n<p><img src=\"http://i.stack.imgur.com/gzVh9.png\" alt=\"children redrawn over\"></p>\n\n<p>I don't understand why this happens and I want to know how to avoid this behavior.</p>\n"},{"tags":["c","winapi","text","gdi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":143,"score":0,"question_id":11814563,"title":"SetBkMode(hdc, TRANSPARENT) doesn't work","body":"<p>When I use <code>SetBkMode(hdc, TRANSPARENT);</code> in the code below, I got the following effect when I resize the main window (and hence when the child receives the WM_PAINT message):</p>\n\n<p><img src=\"http://i.stack.imgur.com/0PFEy.png\" alt=\"enter image description here\"></p>\n\n<p>The problem is : When I resize the main window, The old area of \"Find:\" shoule be erased, I guess. But it just remains there.</p>\n\n<p>If I don't use <code>SetBkMode(hdc, TRANSPARENT);</code>, I don't have this problem. It looks like:</p>\n\n<p><img src=\"http://i.stack.imgur.com/p3U5m.png\" alt=\"enter image description here\"></p>\n\n<p>, i.e it has white background. Furthermore, if I use <code>SetBkMode(hdc, TRANSPARENT);</code>, it looks like the same as above, before I resize the main window. So I don't think <code>SetBkMode(hdc, TRANSPARENT);</code> works here.</p>\n\n<p>the <code>hwnd</code> is a static child with style <code>SS_BITMAP</code>.</p>\n\n<p>Do you know why this issue occurs?</p>\n\n<pre><code>switch (message) {\n    case WM_PAINT:\n        PAINTSTRUCT ps;\n        HDC hdc = BeginPaint(hwnd, &amp;ps);\n\n        SelectObject(hdc, gDefaultGuiFont);\n        SetBkMode(hdc, TRANSPARENT);\n\n        RECT rc;\n        GetClientRect(hwnd, &amp;rc);\n        DrawText(hdc, _TR(\"Find:\"), -1, &amp;rc, DT_SINGLELINE | DT_CENTER | DT_VCENTER);\n\n        EndPaint(hwnd, &amp;ps);\n\n        return 0;\n\n     .............\n}\n</code></pre>\n"},{"tags":["c","winapi","registry"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":94,"score":0,"question_id":11831859,"title":"Registry good practice (C)","body":"<p>If i want to read a variable string out of the registry with RegGetValue is it good practice to do it like this?<br/></p>\n\n<pre><code>DWORD dwByteCount=20,dwType;\nchar *value = (char *)malloc(dwByteCount);\nHKEY hKey;\nLONG lResult;\n\nwhile(TRUE){\n  lResult = RegGetValue(hKey,\n              \"somesubkey\",\n              \"somevalue\",\n              RRF_RT_REG_SZ,\n              &amp;dwType,\n              value,\n              &amp;dwBytesAllocated);\n  if(lResult == ERROR_SUCCESS){\n    break;\n  }\n  else if(lResult == ERROR_MORE_DATA){\n    free(value);\n    dwBytesAllocated+=20;\n    value = (char *)malloc(dwBytesAllocated);\n  }\n  else {\n    free(value);\n    return NULL;\n  }\n\n}\n</code></pre>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":11830633,"title":"How to i execute application in vc++ that reads data from the installation directory","body":"<p>How to execute an .exe from c++ console application. I have try the following methods none have worked.</p>\n\n<p>I want to run a application i have created a while back \"Radio.exe\". this application reads an xml file at startup, if I manually run this application it works fine, but if run it via console application \"Radio.exe\" cant find the xml file?</p>\n\n<pre><code>void execute( char* path)\n{\n    // cant find xml ?\n    ShellExecuteA( NULL, NULL, path, NULL, NULL, SW_SHOW );\n\n    // cant find xml ?\n    ShellExecute(NULL, NULL, path, NULL, NULL, SW_SHOWNORMAL);\n\n    // and also cant find xml ?\n    SHELLEXECUTEINFO rSEI ={0};\n    rSEI.cbSize=sizeof( rSEI );\n    rSEI.lpVerb= NULL;\n    rSEI.lpFile= \"C:\\\\Users\\\\me\\\\Documents\\\\Radio.exe\"; //  = path\n    rSEI.lpParameters= 0;\n    rSEI.nShow = SW_NORMAL;\n    rSEI.fMask = SEE_MASK_NOCLOSEPROCESS;\n    ShellExecuteEx( &amp;rSEI );\n}\n</code></pre>\n"},{"tags":["python","winapi","api"],"answer_count":7,"favorite_count":10,"up_vote_count":25,"down_vote_count":0,"view_count":18934,"score":25,"question_id":1025029,"title":"How to use win32 API's with python?","body":"<p>How can I use win32 API in Python?<br>\nWhat is the best and easiest way to do it?<br>\nCan you please provide some examples?</p>\n"},{"tags":["c++","winapi","c++builder"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":124,"score":-2,"question_id":11829971,"title":"C++ WinAPI waveOutGetVolume","body":"<p>My program needs to retrieve the volume information. I have been using various ways of <code>waveOutGetVolume()</code> but having no luck retireving a value between 0 and 100.</p>\n\n<p>I have tried using HIWORD and LOWORD values aswell. </p>\n\n<p>For example my volume is currently at 14%. My Program displays a completely random number. </p>\n\n<pre><code>DWORD volume;\nHWAVEOUT hwo;\nwaveOutGetVolume(hwo, &amp;volume);\n</code></pre>\n\n<p>Could someone tell me where I am going wrong?</p>\n\n<p>Thanks </p>\n"},{"tags":["c#","winapi","keyboard-hook","magnetic-cards","cardreader"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":144,"score":0,"question_id":11829582,"title":"SHIFT key is incorrectly detected in keyboard state when using Windows keyboard hook","body":"<p>I am working with magnetic card reader.</p>\n\n<p>When plugged into a USB port and opening Notepad, I get the following, correct result:</p>\n\n<pre><code>%B4290071074381429^NAZARKO/C M               ^1302101000002024976000000000002?;4290071074381429=13021010000020204976?\n</code></pre>\n\n<p>When I use a keyboard hook (written in C#) that calls Windows API functions, I get inconsistent results, for example:</p>\n\n<pre><code>%B42()071074381429^NAZARKO/C M               ^1302101000002024976000000000002?;4290071074381429=13021010000020204976?\n</code></pre>\n\n<p>As you can see, here the problem is that the first '90' becomes '()' as if SHIFT was pressed when the '9' and '0' keys were hit.</p>\n\n<p>The keyboard hook code is from here (Keyboard.cs):\n<a href=\"https://nappybar.googlecode.com/svn/Keyboard.cs\" rel=\"nofollow\">https://nappybar.googlecode.com/svn/Keyboard.cs</a>\nand it is set up the following way:</p>\n\n<pre><code>            _kbHook = new KeyboardHook();\n            _kbHook.KeyIntercepted += KeyboardHook_KeyIntercepted;\n            _kbHook.SetParameters(KeyboardHook.Parameters.AllowAltTab);\n            _kbHook.SetParameters(KeyboardHook.Parameters.PassAllKeysToNextApp);\n</code></pre>\n\n<p>As stated above, the results I am getting when using this with a card reader are inconsistent. It seems that the keyboard state from (GetKeyboardState) is not entirely correct.\nMainly, it sometimes says that SHIFT is pressed when it shouldn't be and the other way around.\n<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms646299(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/ms646299(v=vs.85).aspx</a></p>\n\n<p>Does anyone know why this is happening and why it is working correctly in Notepad? And more importantly, how I can fix/work around it? Thank you.</p>\n"},{"tags":["c++","winapi","networking","porting","windows-networking"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":181,"score":0,"question_id":11817260,"title":"To get IP Address from interface name in Windows","body":"<p>I like to know, winapi from which i can get ipaddress using interface name. The Linux version of which is as below.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;sys/ioctl.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;net/if.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;arpa/inet.h&gt;\nint main()\n{\n    int fd;\n    struct ifreq ifr;\n    char iface[] = \"eth0\";\n    fd = socket(AF_INET, SOCK_DGRAM, 0);\n    //Type of address to retrieve - IPv4 IP address\n    ifr.ifr_addr.sa_family = AF_INET;\n    //Copy the interface name in the ifreq structure\n    strncpy(ifr.ifr_name , iface , IFNAMSIZ-1);\n    ioctl(fd, SIOCGIFADDR, &amp;ifr);\n    close(fd);\n    //display result\n    printf(\"%s - %s\\n\" , iface , inet_ntoa(( (struct sockaddr_in *)&amp;ifr.ifr_addr )-&gt;sin_addr) );\n    return 0;\n}\n</code></pre>\n\n<p>I am looking similar functionality ( as code above) but <strong>for windows in C++</strong>. </p>\n"},{"tags":["wpf","winapi","windows-8"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":437,"score":1,"question_id":11825164,"title":"How to disable the Windows 8 Charms bar programmatically?","body":"<p>I need to create an application that will run full-screen on Windows 8 and which the user shouldn't be able to exit easily.</p>\n\n<p>Since the application will be running on computers or tablets with only tactile input, I was going to create a chromeless and top-most WPF application, which could only be closed if a keyboard is connected.</p>\n\n<p>The problem is that the app switching bar on the left and the charms bar on the right can still be opened without a keyboard and would allow users to exit the application. Can this be disabled from code? I can't seem to find a way.</p>\n\n<p>The easy solution would be to run on another OS, but the machines will be running Windows 8 and there's not much I can do about that.</p>\n"},{"tags":[".net","windows","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":9,"down_vote_count":0,"view_count":132,"score":9,"question_id":11812562,"title":"How to Lock Windows (like \"Windows + L\") from .NET?","body":"<p>You can lock a Windows PC by pressing <kbd>Windows</kbd> + <kbd>L</kbd>.  </p>\n\n<p>How can I lock a Windows PC using VB.NET or C#?  </p>\n\n<p>A short example would be helpful.</p>\n"},{"tags":["c++","c","winapi","treeview"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":153,"score":1,"question_id":11819535,"title":"How to set Tree View item as visible/invisible using Win32 api","body":"<p>I am working on a project implemented using WIN32 APIs, where I need some of the tree-view items at run time to be visible/invisible, based on some data entered by user. I have done some work, where I found that I can add/delete item in a tree-view control but can't find anywhere how to set item visible or invisible(I found some examples where it can be done through MFC).</p>\n\n<p>I am looking for the way to set them as visible/invisible is simply because when I add an item, it requires significant back-end calculations, that repeated addition or removal will result in performance issues. I only want to do that calculation only once per tree view item.</p>\n\n<p>One of the solution, I have thought, if setting tree-view item is not possible, is to simply have a linked list of tree-view items present, and add/delete only those items that are required to be visible/invisible.</p>\n\n<p>Please, tell me if it is possible to set tree-view item's state as visible/invisible, If yes, then how? And if no, what can be other alternate solutions?  </p>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":326,"score":0,"question_id":4259571,"title":"How to lock the screen in Windows?","body":"<p><br /><br />\nUsually I develop in Java but now I need to write an app that will block the whole computer's screen every X minutes for Y minutes. It needs to make a break (I want to have a similar app in Windows like in Linux).<br/><br/>\nSo I suggest I need to use C++ and User32.dll to achieve it? Am i right? (I don't want to develop an application in C#). Could anybody give me an idea which methods to use to lock the screen, I'm a newby in WinAPI developing.\n<br /><br />\nThank you!</p>\n"},{"tags":["c","winapi","gcc","file-io","monitor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":11808907,"title":"monitoring files and directories in C under windows","body":"<p>There is a way to monitor directories for changes like FileSystemWatcher but in C?</p>\n\n<p>NOTE: I (have to) use gcc.</p>\n"},{"tags":["c","winapi","tabs","flicker","double-buffering"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":147,"score":-1,"question_id":11823131,"title":"flicker on tab control - WIN32","body":"<p>I have a WIN32 application. Its main window is <code>hwndMain</code>, one of its child is <code>hwndView</code>. There is one tab control <code>hwndTab</code> on <code>hwndView</code>.</p>\n\n<p>When I resize <code>hwndMain</code>, <code>hwndView</code> is resized and so is <code>hwndTab</code>. It flicker a little, but not much.</p>\n\n<p>I have tried to use <code>WS_EX_COMPOSITED</code> style ( for <code>hwndView</code> or <code>hwndTab</code>), but it just gave me blank window. I tried to use <code>WS_EX_TRANSPARENT</code> and it solves flicker, but when the windows is resized to be larger, the childs are updated very slow, e.g I see black region for one second, then the region is updated.</p>\n\n<p>I have successfully sloved the flicker issue for <code>TreeView</code> by using <code>WS_CHIPCHILDREN</code> style. (See remark below). But using <code>WS_CHIPCHILDREN</code> stlye for <code>hwndView</code> doesn't fix the flicker issue for tab control.</p>\n\n<p>I have paid attention to <code>WM_ERASEBKGND</code> and <code>Not set hbrBackground</code> also.</p>\n\n<p>I want to use double buffer for tab control, but I can't find a tutorial for this purpose. All the tutorial I found is: In <code>WM_PAINT</code>, after creating <code>CompatibleDC</code> and <code>CompatibleBitmap</code>, draw what you want in <code>memdc</code> and.....; But I don't want to do any custom drawing in <code>WM_PAINT</code> for <code>hwndTab</code>. I just want to leave the tab control do this job, but shows the final result only.</p>\n\n<p>Could someone show me a small example how to double buffer a tab control (if you think this will fix the flicker issue of tab control), in the language <code>c</code> + <code>winapi</code>, since I don't have the knowledge of C#, Net,..etc.</p>\n\n<hr>\n\n<p>Remark: For my TreeView, it is a child of a window <code>hwndContainer</code>. It is created as:</p>\n\n<pre><code>win-&gt;hwndContainer = CreateWindowEx(\n    WS_CLIPCHILDREN,\n    _T(\"SUMATRA_PDF_TOCBOX\"), NULL,\n    WS_CHILD,\n    0, 0, gGlobalPrefs.sidebarDx, 0,\n    win-&gt;hwndPanel, NULL,\n    ghinst, NULL);\n</code></pre>\n\n<p>Using <code>WS_CLIPCHILDREN</code> fix the flicker, even if I don't use double buffer. But it is strange to put \n<code>WS_CLIPCHILDREN</code> in the first parameter position. If I put it after WS_CHILD, i.e</p>\n\n<pre><code>win-&gt;hwndContainer = CreateWindowEx(\n    NULL,\n    _T(\"SUMATRA_PDF_TOCBOX\"), NULL,\n    WS_CHILD | WS_CLIPCHILDREN,\n    0, 0, gGlobalPrefs.sidebarDx, 0,\n    win-&gt;hwndPanel, NULL,\n    ghinst, NULL);\n</code></pre>\n\n<p>,then the flicker still occurs.</p>\n\n<p>So I also tried to use the first way when I created <code>hwndView</code>, but it just gave blank white window.\nI am really confused with these stuff.</p>\n\n<p>Here is the blank window picture when I used <code>WS_EX_COMPOSITED</code> for <code>hwndView</code>.\nThere is no such problem when I used it for <code>hwndContainer</code>.</p>\n\n<p><code>hwndView</code> in fact has two child: a Tab Control <code>hwndTab</code> and a child which has its own double buffer and drawing. I am not sure if this cause the problem for using <code>WS_EX_COMPOSITED</code>.</p>\n\n<p><img src=\"http://i.stack.imgur.com/ZIDbJ.png\" alt=\"enter image description here\"></p>\n"},{"tags":["c#","winapi","shellexecute"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":200,"score":2,"question_id":11718855,"title":"detect selected program opened using openas_rundll in c#","body":"<p>I am opening a file using openfile dialog with the help of openas_rundll in c#.</p>\n\n<pre><code>Process.Start(\"rundll32.exe\", string.Format(\"shell32.dll,OpenAs_RunDLL \\\"{0}\\\"\", tempFilePath));\n</code></pre>\n\n<p>Now I want to detect which program is used to open the file. I want to trace the process.</p>\n\n<p>My goal is to delete the file when user close the program. Please tell me how can I achieve this. I need an urgent help.</p>\n"}]}
{"total":13828,"page":18,"pagesize":100,"questions":[{"tags":["winapi","createprocess"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":119,"score":0,"question_id":11822051,"title":"Win32 API like CreateProcess, but works on bat/cmd/etc. (i.e. uses PATHEXT)","body":"<p>If you use <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms682425%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>CreateProcess</code></a>, it only works on .exe's, <a href=\"https://github.com/joyent/node/issues/2318#issuecomment-7465665\" rel=\"nofollow\">apparently</a>. What's the best way to make this work with other executable file types?</p>\n\n<p>The best we have so far is to prepend <code>cmd /c</code> to such cases. Is that really the correct approach?</p>\n"},{"tags":["winapi","mfc","geometry","gdi","trigonometry"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":135,"score":0,"question_id":11790812,"title":"Rotate a line segment in Visual C++","body":"<p>Well I am trying to build a few small windows applications using MFC and trying to learn how things work, and while drawing a country's flag I got stuck. Following lines of code draw three rectangles and a circle right at the center of middle rectangle, what need to do next is draw spokes in to circle, i.e 8 diameters separated by an angle of 45 degrees.</p>\n\n<pre><code>void CMainWindow::OnPaint (){\nCPaintDC dc(this);\nfor (int i=0;i &lt;=100;i+=50) {\n    dc.SetBkMode(TRANSPARENT);\n    CRect rect;\n    CPen pen(PS_SOLID, 1, RGB(0,0,0));\n    CPen *oldPen = dc.SelectObject(&amp;pen);\n    if (i == 0){\n         CBrush brush(RGB(255,130,0));\n         CBrush *oldBrush = dc.SelectObject(&amp;brush);\n         dc.Rectangle(75,(i+50),275,(i+100));\n    }\n    else if(i == 50) {\n         CBrush brush(RGB(255,255,255));\n         CBrush *oldBrush = dc.SelectObject(&amp;brush);\n         dc.Rectangle(75,(i+50),275,(i+100));\n         CPen pen2(PS_SOLID, 1,RGB(0,0,255));\n         CPen *oldPen = dc.SelectObject(&amp;pen2);\n         dc.Ellipse(150,100,200,150);\n    }\n    else {\n         CBrush brush(RGB(34,139,34));\n         CBrush *oldBrush = dc.SelectObject(&amp;brush);\n         dc.Rectangle(75,(i+50),275,(i+100));\n    }\n}\n</code></pre>\n\n<p>I have no clue how to do that, I tried to find it in the MFC library but no luck!</p>\n"},{"tags":["wpf","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":176,"score":0,"question_id":11820742,"title":"Using SendKeys to send input text to external windows","body":"<p>I am trying to send text input to an external window from my WPF application, using WinApi and WinForms SendKeys. My sample WPF application installs a global keyboard hook, so that when you press the keys combination in your external application (e.g. Notepad) the application (1) gets the handle of the active window (2) builds the text to be sent (no keypresses to be emulated here, but just plain Unicode text), escaping it for use with SendKeys so that reserved characters like ^ if present are correctly escaped into {^} and the like, and (3) call SendKeys.SendWait to send the text to the active window (in my sample, Notepad). I would expect Notepad (as long as I keep the keyboard input focus into its textbox) to insert the received text as if I typed it directly, but nothing happens. I placed some traces in my application, which is difficult to debug given its nature, and from what I see I can tell the text is built correctly, and the target (active) window is correctly found (I use GetWindowText to read its caption, so that I can be sure that the IntPtr got from GetForegroundWindow is correct, and this is the case); yet, when SendKeys is called nothing happens in the target application. Could anyone suggest a solution?</p>\n\n<p>Here is my code snippet:</p>\n\n<pre>\n    string sText = new string((char) vmChar.Code, 1);\n    IntPtr hWnd = WinApi.GetForegroundWindow();\n    if (hWnd == IntPtr.Zero) return;\n#if DEBUG\n    StringBuilder sb = new StringBuilder(256);\n    if (WinApi.GetWindowText(hWnd, sb, 256) > 0)\n        Debug.WriteLine(\"Target caption: \" + sb);\n#endif\n    Debug.WriteLine(\"Target \" + hWnd + \" for [\" + sText + \"]\");         \n    sText = FormsKeysHelper.EscapeForSendKeys(sText);\n    System.Windows.Forms.SendKeys.SendWait(sText);\n</pre>\n\n<p>And here are my WinApi declarations:</p>\n\n<pre>\nstatic internal class WinApi\n{\n    [DllImport(\"user32.dll\")]\n    public static extern IntPtr GetForegroundWindow();\n\n    [DllImport(\"user32.dll\")]\n    public static extern int SetForegroundWindow(IntPtr hwnd);\n\n    [DllImport(\"user32.dll\")]\n    public static extern int GetWindowText(IntPtr hWnd, StringBuilder text, int count);\n}\n</pre>\n"},{"tags":["winapi","windows-7","error-handling","windows-xp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":124,"score":1,"question_id":11819169,"title":"CreateWindowEx, GetLastError, Windows 7, and XP oddities and odd behavior","body":"<p>The following code works on Window 7, but when I run it on Windows XP, it fails with an error message returned by windows: \"The system can not find the file specified\".</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;windowsx.h&gt;\n#include &lt;commctrl.h&gt;\n#include &lt;uxtheme.h&gt;\n#include &lt;string&gt;\n\nconst char g_szClassName[] = \"myWindowClass\";\nconst char title[] = \"Window Title\\0\";\n\nCOLORREF        WinColor;\nHFONT       defaultFont;\nNONCLIENTMETRICSA   Metrics;\nDWORD       dwVersion;\nDWORD       dwMajorVersion;\nDWORD       dwMinorVersion;\nHBRUSH      hBrushColor;\n\nbool LastError = false;\nbool W32Error (const char * Msgtext);\n\n// Step 4: the Window Procedure\nLRESULT CALLBACK WndProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)\n{\n    switch(msg)\n    {\n\n    case WM_NCCREATE:\n    {\n        Metrics.cbSize = sizeof(NONCLIENTMETRICS);\n        SystemParametersInfo (SPI_GETNONCLIENTMETRICS, sizeof(NONCLIENTMETRICS), &amp;Metrics, 0);\n        defaultFont = (HFONT) CreateFontIndirect (&amp; Metrics.lfMessageFont);\n        return TRUE;\n    }\n    break;\n\n    case WM_CTLCOLORSTATIC: {\n        dwVersion = GetVersion();\n        dwMajorVersion = (DWORD)(LOBYTE(LOWORD(dwVersion)));\n        dwMinorVersion = (DWORD)(HIBYTE(LOWORD(dwVersion)));\n        if ( (IsAppThemed()) &amp;&amp; (dwMajorVersion &lt; 6) ) {\n            WinColor = GetSysColor(COLOR_WINDOW);\n            SetBkColor((HDC)wParam, WinColor);\n            return (LRESULT)hBrushColor;\n        }\n    }\n    break;\n\n    case WM_CREATE: {\n        HWND hButton = CreateWindowEx(\n            0,\n            \"BUTTON\", \"Button\",\n                WS_TABSTOP      |\n                WS_VISIBLE      |\n                WS_CHILD        |\n                BS_NOTIFY       |\n                BS_PUSHBUTTON,\n            10, 10, 96, 32, hwnd,\n            (HMENU)50,\n            GetModuleHandle(NULL),\n            NULL);\n        if (W32Error (\"Button Creation Failed\\nReason:\")) exit (1);\n        return TRUE;\n    }\n    break;\n\n    case WM_CLOSE:\n        DestroyWindow(hwnd);\n        break;\n\n    case WM_DESTROY:\n        PostQuitMessage(0);\n        break;\n\n    default:\n        return DefWindowProc(hwnd, msg, wParam, lParam);\n    }\n    return 0;\n}\n\nint WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance,\n    LPSTR lpCmdLine, int nCmdShow)\n{\n    WNDCLASSEX wc;\n    HWND hwnd;\n    MSG Msg;\n\n    // Initialize common controls.\n    INITCOMMONCONTROLSEX icc;\n    icc.dwSize = sizeof(icc);\n    icc.dwICC = ICC_WIN95_CLASSES       |\n                ICC_COOL_CLASSES    |\n                ICC_INTERNET_CLASSES|\n                ICC_LINK_CLASS  |\n                ICC_STANDARD_CLASSES|\n                ICC_PROGRESS_CLASS  |\n                ICC_USEREX_CLASSES;\n    InitCommonControlsEx(&amp;icc);\n\n    //Step 1: Registering the Window Class\n    wc.cbSize        = sizeof(WNDCLASSEX);\n    wc.style         = CS_HREDRAW | CS_VREDRAW;\n    wc.lpfnWndProc   = WndProc;\n    wc.cbClsExtra    = 0;\n    wc.cbWndExtra    = 0;\n    wc.hInstance     = hInstance;\n    wc.hIcon         = LoadIcon(NULL, IDI_APPLICATION);\n    wc.hCursor       = LoadCursor(NULL, IDC_ARROW);\n    wc.hbrBackground = (HBRUSH)(COLOR_WINDOW+1);\n    wc.lpszMenuName  = NULL;\n    wc.lpszClassName = g_szClassName;\n    wc.hIconSm       = LoadIcon(NULL, IDI_APPLICATION);\n\n    // see if something is going on before the window registration takes place....\n    if (W32Error (\"Previous Check for Error?\\nReason:\")) exit (1);\n\n    if(!RegisterClassEx(&amp;wc))\n    {\n        MessageBox(NULL, \"Window Registration Failed!\", \"Error!\",\n            MB_ICONEXCLAMATION | MB_OK);\n        return 0;\n    }\n    if (W32Error (\"Window Registration Failed\\nReason:\")) exit (1);\n\n    // Step 2: Creating the Window\n    hwnd = CreateWindowEx(\n        WS_EX_CLIENTEDGE,\n        g_szClassName,\n        \"The title of my window\",\n        WS_OVERLAPPEDWINDOW,\n        CW_USEDEFAULT, CW_USEDEFAULT, 240, 120,\n        NULL, NULL, hInstance, NULL);\n    if (W32Error (\"Window Creation Failed\\nReason:\")) exit (1);\n\n    if(hwnd == NULL)\n    {\n        MessageBox(NULL, \"Window Creation Failed!\", \"Error!\",\n            MB_ICONEXCLAMATION | MB_OK);\n        return 0;\n    }\n\n    SendMessageA(hwnd, WM_SETFONT, WPARAM (defaultFont), TRUE);\n    SendMessageA(hwnd, WM_SETTEXT, WPARAM(NULL) , LPARAM (title));\n\n    ShowWindow(hwnd, nCmdShow);\n    UpdateWindow(hwnd);\n\n    // Step 3: The Message Loop\n    while(GetMessage(&amp;Msg, NULL, 0, 0) &gt; 0)\n    {\n        TranslateMessage(&amp;Msg);\n        DispatchMessage(&amp;Msg);\n    }\n    return Msg.wParam;\n}\n\n\nbool W32Error (const char * Msgtext)\n{\n    LPTSTR errorText = NULL;\n    DWORD   dwLastError = GetLastError();\n    if (!dwLastError) {\n        LastError = false;\n        return LastError;\n    }\n    // use system message tables to retrieve error text\n    // allocate buffer on local heap for error text\n    // Important! will fail otherwise, since we're not (and CANNOT) pass insertion parameters\n    FormatMessageA(\n        FORMAT_MESSAGE_FROM_SYSTEM     |\n        FORMAT_MESSAGE_ALLOCATE_BUFFER |\n        FORMAT_MESSAGE_IGNORE_INSERTS,\n        NULL,                           // unused with FORMAT_MESSAGE_FROM_SYSTEM\n        dwLastError,\n        MAKELANGID (LANG_NEUTRAL, SUBLANG_DEFAULT),\n        (LPTSTR)&amp;errorText,             // output\n        0,                              // minimum size for output buffer\n        0);                             // arguments - see note\n        if ( NULL != errorText ) {\n            std::string Message;\n            Message += Msgtext;\n            Message += \"\\n\";\n            Message += errorText;\n            MessageBoxA(NULL, (LPCSTR)Message.c_str(), \"An Internal Error Occurred\", MB_OK);\n            LocalFree(errorText);\n            errorText = NULL;\n            LastError = true;\n        } else {\n            LastError = false;\n        }\n        return LastError;\n}\n</code></pre>\n\n<p>As an additional, I have a <code>resource.rc</code> and <code>resource.h</code> file linked in with <code>winres</code> that complies in a <code>manifest.xml</code> that provides a controls version 6 specification.</p>\n\n<p>Ok, so here is the deal, This runs on Windows 7 without a hitch.  And it runs on XP, unless I put in the line  <code>if (W32Error (\"Window Registration Failed\\nReason:\")) exit (1);</code>\n(basically, it calls my error checking routine which includes <code>GetLastError()</code>)</p>\n\n<pre><code>   if(!RegisterClassEx(&amp;wc))\n    {\n        MessageBox(NULL, \"Window Registration Failed!\", \"Error!\",\n            MB_ICONEXCLAMATION | MB_OK);\n        return 0;\n    }\n    if (W32Error (\"Window Registration Failed\\nReason:\")) exit (1);\n</code></pre>\n\n<p>When I include that line, I get an error \"The system can not find the file specified.\"  The return value back from RegisterClassEx does not go into the <code>if</code> block, so RegisterClassEx returns Ok.</p>\n\n<p>This only happens on Windows XP, it works just fine on Windows 7.  If I don't include this line, it works as if nothing is wrong.</p>\n\n<p>The point of this sample is to get themes to work right on both XP and Windows 7.  (not an easy task.)</p>\n\n<p>Why is RegisterClassEx returning Ok, but generates an error for GetLastError on Windows XP and not on Windows 7?</p>\n\n<p>Also, what <strong>file</strong> is it looking for anyway?  I have seen other Google results say It has to do with a messed up message loop or window procedure, but that's not the case here.</p>\n"},{"tags":["java","winapi"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":158,"score":2,"question_id":10381140,"title":"How to query the high-resolution performance counter","body":"<p>Good morning,</p>\n\n<p>i need to obtain the value of the CPUs high-resolution performance counter in order to measure delay between various software applications. In my c(++|#) i use the </p>\n\n<p>BOOL WINAPI QueryPerformanceCounter(\n  __out  LARGE_INTEGER *lpPerformanceCount\n);</p>\n\n<p>WinApi call. What is the proper way to obtain the counter from java. I have search jna without success. I know this is a platform specific issue, but maybe there is a quicker way than writing my own jni wrapper?</p>\n\n<p>Best wishes,\n Armin </p>\n"},{"tags":["multithreading","winapi","visual-c++","opengl","glut"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":11813685,"title":"Repeating a Glut-based OpenGL program using Win32 console application","body":"<p>I am writing an opengl program for one of my university projects. I have no background in working with opengl and I have just returned to visual C++ after three years of sticking to MATLAB (I had to! don't blame me!) . However, in this project, I should create a multi-level game and surprisingly it seems that there is no tutorial or clue in the net for this type of game-programming. My game is occurring in a virtual rectangular room and if the player can get enough score, the game should be restated in a room with different shape and so on (we have to have 6 levels at least) </p>\n\n<p>Now, according to the fact that I used glut functions extensively in my code as well as my main function and I know that there is no way for breaking the loop of glutMainLoop();  I want to know how can I implement this multi-level structure ?</p>\n\n<p>Should I get rid of glut and replace it by freeglut or basic gl functions ? </p>\n\n<p>Should I use Multi-Threading as a solution and is it possible when I use Win32 Console app ?</p>\n"},{"tags":["vb.net","winapi","hook"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":928,"score":0,"question_id":3995522,"title":"hooking another program's calls to winapi functions in vb.net","body":"<p>I have been trying to build a game bot in vb.net.  One of the main problems is getting access to the text the game prints on the screen so I have been trying to hook the games calls to the windows api drawtext and textout functions.  I have been hunting for examples of how to set up a hook in vb.net for a long time without any luck.  I have found it impossible to translate examples in old school vb, C++, and C#.  For convenience's sake I would like to use the freely available deviare and/or easyhook libraries.  Can anyone help?</p>\n"},{"tags":["c","linux","winapi"],"answer_count":2,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":6886,"score":6,"question_id":933745,"title":"What is the Windows equivalent to the capabilities defined in sys/select.h and termios.h","body":"<p>I have an application in linux, which is compiled successfully.\nI want to run the same program in windows.</p>\n\n<p>But compilation produces the following errors related to header files.</p>\n\n<ol>\n<li>Cannot find sys/select.h</li>\n<li>Cannot find termios.h</li>\n</ol>\n\n<p>How can I fix this?</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":11816226,"title":"How do I access elements of an RCDATA resource?","body":"<p>I've been trying to store a few values in an RCDATA resource but I'm not sure how I am supposed to access them individually.</p>\n\n<pre><code>HGLOBAL hMem = LoadResource(hInstance,FindResource(hInstance,MAKEINTRESOURCE(IDR_RCDATA),RT_RCDATA));\nPVOID lpData = LockResource(hMem);\n</code></pre>\n\n<p>I \"think\" I have successfully obtained a pointer to my data but what I'm supposed to do now, I don't know.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/cc194809.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/cc194809.aspx</a> is the only information I could find except delphi examples, neither have helped me. My RCDATA is as follows.</p>\n\n<pre><code>IDR_RCDATA RCDATA \n{\n    10,\n    30\n}\n</code></pre>\n\n<p>Anyone know how to do this?</p>\n"},{"tags":["winapi","bitblt"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":11806721,"title":"Why BitBlt has different result on different place","body":"<p>I write a test sample for the BitBlt, in WinProc, the WM_PAINT does this: it will repeat draw the small block from window (0,0) to the client area.</p>\n\n<pre><code>      case WM_CREATE:{\n          cxSource = GetSystemMetrics (SM_CXSIZEFRAME) + GetSystemMetrics (SM_CXSIZE) ;\n          cySource = GetSystemMetrics (SM_CYSIZEFRAME) + GetSystemMetrics (SM_CYCAPTION) ;\n          return 0 ;\n\n      case WM_PAINT:\n          hdcClient = BeginPaint (hwnd, &amp;ps) ;\n          hdcWindow = GetWindowDC (hwnd) ;\n          RECT rcClient; \n          GetClientRect(hwnd, &amp;rcClient);\n          for (y = 0 ; y &lt; rcClient.bottom ; y += cySource)\n              for (x = 0 ; x &lt; rcClient.right ; x += cxSource)\n                  BitBlt (hdcClient, x, y, cxSource, cySource, hdcWindow, 0, 0, SRCCOPY) ;\n\n          ReleaseDC (hwnd, hdcWindow) ;\n          EndPaint (hwnd, &amp;ps) ;\n          return 0;\n</code></pre>\n\n<p>But if I write a function do the same thing and mark the above code, the result is one big picture, can anybody tell me why?</p>\n\n<p>This sample is from programming windows CH14 BitBlt project and I modify some. The project target is to use the small pattern from window(0,0,cxSource, cySource) to fill the client area, but if I write this in another function, the result is, only one big picture.\nThanks in advance.</p>\n"},{"tags":["c++","winapi","split","panel","childwindow"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":95,"score":2,"question_id":10821544,"title":"split a window without a split bar","body":"<p>In order to split a window into 2, for example, viewing 2 documents at the same time, we created 2 child windows and a split bar to resize the child windows.</p>\n\n<p>But I have seen many applications which have multiple panels without a split bar. In fact, there is a 'line' between the panels, but I found that they created an extra child window <code>hwndChild1Container</code> which contains the first child window <code>hwndChild1</code> and the size is a litte wider than <code>hwndChild1</code>, hence there is a <code>bar</code> as we see. </p>\n\n<p>My question is: In order to do the same thing, I don't know which window style I have to use for <code>hwndChild1Container</code>. I don't want <code>hwndChild1Container</code> has a board like the main window, but I need it being resizeable and when the mouse is over the right boarder, the cursor changes the shape like the case for main window. Is there a build-in window style for such child window, or I have to do this manually in the window procedure of <code>hwndChild1Container</code>?</p>\n"},{"tags":["windows","winapi","printing","driver","postscript"],"answer_count":7,"favorite_count":11,"up_vote_count":10,"down_vote_count":0,"view_count":12220,"score":10,"question_id":1019036,"title":"How to create a virtual printer in Windows?","body":"<p>I want to create a virtual printer driver for Windows. Where should I start? The WDK has some printing drivers examples, but nothing I can use. MSDN doesn't seem to be very helpful.</p>\n\n<p>There are a lot of virtual printers for Windows out there (mostly they generate PDFs), how do they do it?</p>\n\n<p>Any links to the documentation I seem to miss are appreciated.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c++","winapi","mingw","codeblocks","glew"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":365,"score":0,"question_id":11813767,"title":"cannot convert 'LPCWSTR {aka const wchar_t*}' to 'LPCSTR {aka const char*}","body":"<p>I have been trying to get Glew and opengl 3.2 working with code blocks(minGW) in a win32 context. i found a nice little tutorial <a href=\"http://www.swiftless.com/tutorials/opengl4/1-opengl-window.html\" rel=\"nofollow\">here</a></p>\n\n<p>As i had been trying to work out if compiling glew in codeblocks was actually possible i wanted to try the source out before doing the tutorial to see if it would work.</p>\n\n<p>after tweaking the code slightly I tried to compile and got several errors that i have never seen before. they are as follows</p>\n\n<pre><code>|In function 'bool createWindow(LPCWSTR, int, int)':|\n|73|error: cannot convert 'LPCWSTR {aka const wchar_t*}' to 'LPCSTR {aka const char*}' in assignment|\n|80|error: cannot convert 'LPCWSTR {aka const wchar_t*}' to 'LPCSTR {aka const char*}' for argument '2' to 'HWND__* CreateWindowExA(DWORD, LPCSTR, LPCSTR, DWORD, int, int, int, int, HWND, HMENU, HINSTANCE, LPVOID)'|\n|In function 'int WinMain(HINSTANCE, HINSTANCE, LPSTR, int)':|\n|105|warning: deprecated conversion from string constant to 'char*' [-Wwrite-strings]|\n|110|error: '_TRUNCATE' was not declared in this scope|\n|110|error: 'mbstowcs_s' was not declared in this scope|\n</code></pre>\n\n<p>My code is</p>\n\n<pre><code>include &lt;iostream&gt;\n#include &lt;Windows.h&gt;\n\n#ifndef GLEW_STATIC\n#define GLEW_STATIC\n#endif //GLEW_STATIC\n\n\n\n#include &lt;GL/glew.h&gt;\n#include &lt;GL/wglew.h&gt;\n\n//using namespace std;\n//\n//int main()\n//{\n//    cout &lt;&lt; \"Hello world!\" &lt;&lt; endl;\n//    return 0;\n//}\n\n\n#include \"opengl_3.h\"\n\nOpenGLContext openglContext; // Our OpenGL Context class\n\nbool running = true; // Whether or not the application is currently running\n\nHINSTANCE hInstance; // The HINSTANCE of this application\nLRESULT CALLBACK WndProc(HWND, UINT, WPARAM, LPARAM); // Standard window callback\n\n/**\n    WndProc is a standard method used in Win32 programming for handling Window messages. Here we\n    handle our window resizing and tell our OpenGLContext the new window size.\n*/\nLRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam) {\n    switch (message) {\n        case WM_SIZE: // If our window is resizing\n        {\n            openglContext.reshapeWindow(LOWORD(lParam), HIWORD(lParam)); // Send the new window size to our OpenGLContext\n            break;\n        }\n\n        case WM_DESTROY:\n        {\n            PostQuitMessage(0);\n            break;\n        }\n    }\n\n    return DefWindowProc(hWnd, message, wParam, lParam);\n}\n\n/**\n    createWindow is going to create our window using Windows API calls. It is then going to\n    create our OpenGL context on the window and then show our window, making it visible.\n*/\nbool createWindow(LPCWSTR title, int width, int height) {\n    WNDCLASS windowClass;\n    HWND hWnd;\n    DWORD dwExStyle = WS_EX_APPWINDOW | WS_EX_WINDOWEDGE;\n\n    hInstance = GetModuleHandle(NULL);\n\n    windowClass.style = CS_HREDRAW | CS_VREDRAW | CS_OWNDC;\n    windowClass.lpfnWndProc = (WNDPROC) WndProc;\n    windowClass.cbClsExtra = 0;\n    windowClass.cbWndExtra = 0;\n    windowClass.hInstance = hInstance;\n    windowClass.hIcon = LoadIcon(NULL, IDI_WINLOGO);\n    windowClass.hCursor = LoadCursor(NULL, IDC_ARROW);\n    windowClass.hbrBackground = NULL;\n    windowClass.lpszMenuName = NULL;\n    windowClass.lpszClassName = title;\n\n    if (!RegisterClass(&amp;windowClass)) {\n        return false;\n    }\n\n    hWnd = CreateWindowEx(dwExStyle, title, title, WS_OVERLAPPEDWINDOW,\n      CW_USEDEFAULT, 0, width, height, NULL, NULL, hInstance, NULL);\n\n    openglContext.create30Context(hWnd); // Create our OpenGL context on the given window we just created\n\n    ShowWindow(hWnd, SW_SHOW);\n    UpdateWindow(hWnd);\n\n    return true;\n}\n\n/**\n    WinMain is the main entry point for Windows based applications as opposed to 'main' for console\n    applications. Here we will make the calls to create our window, setup our scene and then\n    perform our 'infinite' loop which processes messages and renders.\n*/\nint WINAPI WinMain(HINSTANCE hInstance,\n                     HINSTANCE hPrevInstance,\n                     LPSTR    lpCmdLine,\n                     int       nCmdShow) {\n    MSG msg;\n\n    /**\n        The following 6 lines of code do conversion between char arrays and LPCWSTR variables\n        which are used in the Windows API.\n    */\n    char *orig = \"OpenGL 3 Project\"; // Our windows title\n    size_t origsize = strlen(orig) + 1;\n    const size_t newsize = 100;\n    size_t convertedChars = 0;\n    wchar_t wcstring[newsize];\n    mbstowcs_s(&amp;convertedChars, wcstring, origsize, orig, _TRUNCATE);\n\n    createWindow(wcstring, 500, 500); // Create our OpenGL window\n\n    openglContext.setupScene(); // Setup our OpenGL scene\n\n    /**\n        This is our main loop, it continues for as long as running is true\n    */\n    while (running)\n    {\n        if (PeekMessage(&amp;msg, NULL, 0, 0, PM_REMOVE)) { // If we have a message to process, process it\n            if (msg.message == WM_QUIT) {\n                running = false; // Set running to false if we have a message to quit\n            }\n            else {\n                TranslateMessage(&amp;msg);\n                DispatchMessage(&amp;msg);\n            }\n        }\n        else { // If we don't have a message to process\n            openglContext.renderScene(); // Render our scene (which also handles swapping of buffers)\n        }\n    }\n\n    return (int) msg.wParam;\n}\n</code></pre>\n\n<p>(Sorry about the wall of text)\nthere are also other files but all the errors seem to becoming from here. \nill post the rest if needed.</p>\n\n<p>I haven't really seen any errors similar to this so i did some googling and found out that the error was caused by the compiler not being set to multi byte(a setting in VS2010). i did some looking around and couldnt find any such settings in codeblocks. is this code only usable in VS or have I missed something? im worried it might be something to do with my linking due to me having a lot of issues with this in the past. any help would be appreciated.</p>\n"},{"tags":["javascript","api","winapi","skydrive"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":146,"score":0,"question_id":11813679,"title":"Callback URL in Skydrive API for Javacript","body":"<p>I am using Javascript to connect to Skydrive API. My first step was to give an oAuth permission to initiator. What i did was set call back uri to my own website. whenever i get connect to service it  opens my callback uri (after taking scopes &amp; permissions). and then i have my call back uri as </p>\n\n<p>mydomain.com#accessToken=dsfe23423v{710 chars}</p>\n\n<p>The thing is i am using pure client side JS/HTML/HTML%.. there was no way i am able to capture this access token and i have to manually hardcode it to use it further... Could you see what can be issue:</p>\n\n<p>Here is my code::</p>\n\n<pre><code>&lt;script src=\"http://js.live.net/v5.0/wl.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n&lt;script type=\"text/javascript\"&gt;\n    var APPLICATION_CLIENT_ID = '0000X00004003C03',\n            REDIRECT_URL = \"http://www.myweb.com\";\n\n    WL.Event.subscribe(\"auth.login\", onLogin);\n    WL.init({\n        client_id: APPLICATION_CLIENT_ID,\n        redirect_uri: REDIRECT_URL,\n        scope: 'wl.skydrive_update',\n        response_type: \"token\"\n    });\n    WL.ui({\n        name: \"signin\",\n        element: \"signInButton\",\n        brand: \"hotmail\",\n        type: \"connect\"\n    });\n    function greetUser(session) {\n        var strGreeting = \"\";\n        WL.api(\n                {\n                    path: \"me\",\n                    method: \"GET\"\n                },\n                function (response) {\n                    if (!response.error) {\n                        strGreeting = \"Hi, \" + response.first_name + \"!\"\n                        document.getElementById(\"greeting\").innerHTML = strGreeting;\n                    }\n                });\n    }\n\n    function onLogin() {\n        var session = WL.getSession();\n        if (session) {\n            greetUser(session);\n        }\n    }\n\n    var apiURL = \"https://apis.live.net/v5.0/me/\";\n    var tokenAuth = \"E ----- 3d\";\n</code></pre>\n\n<p>//token is hardcoded above and then further utilized....</p>\n\n<pre><code>    var tokenAuthParam = \"?access_token=\" + tokenAuth;\n\n&lt;/script&gt;\n</code></pre>\n\n<p></p>\n\n\n\n\n\n<p></p>\n\n<p>The problem is i have to hardcode access token which is not right. i should have somehow be able to get the access token from the callback uri.. i just wanted to know how can i get that. ( i am using complete client side coding) </p>\n"},{"tags":["winapi","hash","sha1","sha-1"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":11812915,"title":"using win32 API urlHash()","body":"<p>I am using function UrlHash() to generate a hash for different URLs.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb773783(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/bb773783(v=vs.85).aspx</a></p>\n\n<pre><code>HRESULT UrlHash(\n  __in   PCTSTR pszURL,\n  __out  BYTE *pbHash,\n  DWORD cbHash\n);\n</code></pre>\n\n<p>I wanted to know what should be optimum value of \"cbHash\" (which controls the output buffer size) so there is never a collision.\nIf this API internally uses SHA1 algorithm, it should give a 160 bit output ??</p>\n"},{"tags":["c++","c","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":168,"score":0,"question_id":10963200,"title":"GetLogicalDrives() for loop","body":"<p>I am new to the win32 api and need help trying to understand how the GetLogicalDrives() function works. I am trying to populate a cbs_dropdownlist with all the available drives that are not in use. here is what I have so far. I would appreciate any help.</p>\n\n<pre><code>void FillListBox(HWND hWndDropMenu)\n{\n DWORD drives = GetLogicalDrives();\n for (int i=0; i&lt;26; i++)\n {\n    SendMessage(hWndDropMenu, CB_ADDSTRING, 0, (LPARAM)drives);\n }\n}\n</code></pre>\n"},{"tags":["winapi","smb"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":484,"score":1,"question_id":4919266,"title":"Why network shares enumeration is so slow on Windows?","body":"<p>Retrieving a list of network shares via Windows API functions NetShareEnum or WNetEnumResource takes up to 60 (!!!) seconds to complete a reqest. Maybe someone knows why it's SO slow? Maybe it's possible to use some API / library (like SMB) to enum shares at sane speed?</p>\n"},{"tags":["winapi","setwindowshookex","wh-keyboard-ll"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":158,"score":0,"question_id":11808480,"title":"Win32 Global Key Hook / SetWindowsHook / GetAsyncKeyState sometimes not working","body":"<p>I have a question regarding hooks of Virtual Keys. I'd like to define global shortcuts for my application ( RegisterHotkey is not sufficient ). However, I tried two ways to implement the shortcuts:</p>\n\n<ol>\n<li><p>I registered a WH_KEYBOARD_LL hook. I put all the hooking code into a DLL and its working fine! \nBut: When special applications ( e.g. CCleaner ) have focus, the hook does not work any more! Nothing arrives at my application. I tried it with 32 and 64 Bit DLL. </p></li>\n<li><p>I tried to solve the problem by frequently calling GetAsyncKeyState instead of using the hook. Also this version works well, until special applications ( again CCleaner ) gets the focus. In this moment GetAsyncKeyState returns 0 for all keys, even when they are pressed. </p></li>\n</ol>\n\n<p>Does anyone have an idea how this problem can be fixed ? </p>\n\n<p>By the way, it seems that the applications who disable my hook are written in Delphi are something else. These \"Evil\" applications do furthermore not react on any input, meaning a ShowWindow call on the windows of these applications does have not effect. The same for SetWindowLong and so on. </p>\n\n<p>Thanks very much for your response! </p>\n"},{"tags":["winapi","dll","wmi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":11799628,"title":"WMI Query in CredentialProvider DLL","body":"<p>I wrote a C++ function that gets the PNPDeviceID of an USB-Drive by WMI Queries and tested it in a Win32-Console-Application. It worked perfectly, but when I put the code into the CredentialProvider-DLL, the <code>CoInitialize()</code> and <code>CoInitializeSecurity()</code> functions failed because the have been already called by the DLL-calling process (the Windows CredUI-Subsystem). So how can I make the WMI Queries work on that DLL? I need to reset the COM security settings what seems not to be possible to do by default.</p>\n\n<p>Here is the function code:</p>\n\n<pre><code>std::wstring GetHardwareID(char driveLetter)\n{\nstd::wstring returnString = L\"\";\nwchar_t volumeAccessPath[] = L\"\\\\\\\\.\\\\X:\";\nvolumeAccessPath[4] = driveLetter;\n\nHANDLE deviceHandle = CreateFileW(volumeAccessPath,\n    0,                // no access to the drive\n    FILE_SHARE_READ | // share mode\n    FILE_SHARE_WRITE,\n    NULL,             // default security attributes\n    OPEN_EXISTING,    // disposition\n    0,                // file attributes\n    NULL);      // do not copy file attributes\n\nDWORD bytes;\nSTORAGE_DEVICE_NUMBER  devd;\nSTORAGE_BUS_TYPE busType = BusTypeUnknown;\n\n\nif (DeviceIoControl(deviceHandle,\n    IOCTL_STORAGE_GET_DEVICE_NUMBER ,\n    NULL, 0,\n    &amp;devd, sizeof(devd),\n    &amp;bytes, NULL))\n{\n    HRESULT hRes = CoInitializeEx(NULL, COINIT_MULTITHREADED);\n\n    if((FAILED(hRes = CoInitializeSecurity(NULL, -1, NULL, NULL, RPC_C_AUTHN_LEVEL_CONNECT, RPC_C_IMP_LEVEL_IMPERSONATE, NULL, EOAC_NONE, 0))))\n    {\n               return returnString;\n            }\n\n    IWbemLocator* pLocator = NULL;\n    if(FAILED(hRes = CoCreateInstance(CLSID_WbemLocator, NULL, CLSCTX_ALL, IID_PPV_ARGS(&amp;pLocator))))\n    { return returnString;}\n\n    IWbemServices* pService = NULL;\n\n    if(FAILED(hRes = pLocator-&gt;ConnectServer(L\"root\\\\CIMV2\", NULL, NULL, NULL, WBEM_FLAG_CONNECT_USE_MAX_WAIT, NULL, NULL, &amp;pService)))\n    {\n        pLocator-&gt;Release();\n        dbg(convertInt(hRes).c_str());\n        return returnString;\n    }\n\n    IEnumWbemClassObject* pEnumerator = NULL;\n    if(FAILED(hRes = pService-&gt;ExecQuery(L\"WQL\", L\"SELECT * FROM Win32_DiskDrive \", WBEM_FLAG_FORWARD_ONLY, NULL, &amp;pEnumerator)))\n    {\n        pLocator-&gt;Release();\n        pService-&gt;Release();\ndbg(convertInt(hRes).c_str());\n        return returnString;\n    }\n\n    IWbemClassObject* clsObj = NULL;\n    int numElems;\n    while((hRes = pEnumerator-&gt;Next(WBEM_INFINITE, 1, &amp;clsObj, (ULONG*)&amp;numElems)) != WBEM_S_FALSE)\n    {\n        if(FAILED(hRes))\n            break;\n\n        VARIANT vRet;\n        VariantInit(&amp;vRet);\n        if(SUCCEEDED(clsObj-&gt;Get(L\"DeviceID\", 0, &amp;vRet, NULL, NULL)) &amp;&amp; vRet.vt == VT_BSTR)\n        {\n            bool found = false;\n            std::wstring ws(vRet.bstrVal);\n            if (ws[17] == '0' + devd.DeviceNumber)\n            found = true;\n            VariantClear(&amp;vRet);\n\n            if(SUCCEEDED(clsObj-&gt;Get(L\"PNPDeviceID\", 0, &amp;vRet, NULL, NULL)) &amp;&amp; vRet.vt == VT_BSTR  &amp;&amp; found)\n            {\n                std::wstring retStr(vRet.bstrVal);\n                VariantClear(&amp;vRet);\n                std::wstring k(L\"&amp;\");\n                int pos =retStr.rfind(k);\n                returnString = retStr.substr(0, pos);\n            }\n        }\n\n        clsObj-&gt;Release();\n    }\n\n    pEnumerator-&gt;Release();\n    pService-&gt;Release();\n    pLocator-&gt;Release();\n}\nreturn returnString;\n}\n</code></pre>\n\n<p>Thanks in advance</p>\n"},{"tags":["winapi","camera","directshow"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":11804978,"title":"uniquiely differentiate between multiple cameras [dshow, directx, win32api]","body":"<p>Is there a sure way to programmatically differentiate between multiple cameras?\nI enumerate CLSID_VideoInputDeviceCategory and then I GetDisplayName on each IMoniker. What I found out is that with <em>some</em> cameras plugging them into different USB socket will return you different unique ID, that is, same camera plugged in into different sockets is regarded by my program as multiple cameras attached at different time. Other cameras plugged into different usb sockets are identified with the same GetDisplayName. On top of that, I have two identical cameras (Microsoft LifeCam HD-3000) and when I plug in different hardware pieces into the same socket I can't tell the difference which hardware piece was inserted.</p>\n\n<p>So, is there a way to really tell the difference between multiple identical cameras if I plug them into the same usb port? And related reverse question: how can I id the same camera when I plug it in into different usb sockets?</p>\n"},{"tags":["c++","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":195,"score":1,"question_id":11785157,"title":"Replacing WinMain() with main() function in Win32 programs","body":"<p>I searched a little bit on StackOverflow and Google but couldn't get the idea. I want to start my application with this type of user programming:</p>\n\n<pre><code>int main()\n{\n  Window App(\"Test\", 640, 480);\n\n  while(App.IsOpen())\n  {\n    // Do the stuff\n  }\n}\n</code></pre>\n\n<p>But this isn't possible because I should pass the hInstance and hPrevInstance and other parameters to a WinMain function. Actually there is a Window class which I designed it to make the Window creation a little bit easier. I saw this implementation on SFML but I don't know how it did come to this.</p>\n\n<p>Right now I'm using the usual way:</p>\n\n<pre><code>int WINAPI WinMain(HINSTANCE hInst, HINSTANCE hPrevInst, LPSTR, int)\n{\n  Window App(hInst, hPrevInst, \"Test\", 640, 480);\n\n  while(App.IsOpen())\n  {\n    // Do the stuff\n  }\n}\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["python","winapi","keyboard"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":61,"score":-1,"question_id":11801258,"title":"How delete keyboard layout in Python?","body":"<p>If i add keyboard layout:</p>\n\n<pre><code>import win32api    \nwin32api.LoadKeyboardLayout(\"00000409\", 1)\n</code></pre>\n\n<p>How can i delete it? There are no win32api.UnloadKeyboardLayout...</p>\n\n<p>P.S. I have not english keyboard layout, but when i run some programms it automatically adds and i have english and japanese layout.Japanese layout contains english...so i need to write script for delete english layout.</p>\n\n<p>P.S.2 I solved the problem. Just use ctypes</p>\n\n<pre><code>import ctypes\nlib = ctypes.WinDLL('User32.dll')\nUnloadKeyboarLayout = lib['UnloadKeyboardLayout']\nUnloadKeyboarLayout(67699721) #for US English\n</code></pre>\n"},{"tags":["c++","winapi","visual-c++"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":103,"score":-1,"question_id":11801808,"title":"I'm starting to learn WINAPI and C++ but something wrong?","body":"<p>i have something going wrong with my WinMain i try to do. I'm totally noob at Windows C++ Programming, i try to learn. I follow a tutoriel to help me. But doesn't look to works!\nHere is my code..</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n\nLRESULT CALLBACK WindowProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam);\n\nint WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)\n{\n\n    HWND hWnd;\n    WNDCLASSEX wc;\n\n    ZeroMemory(&amp;wc, sizeof(WNDCLASSEX));\n\n    wc.cbSize = sizeof(WNDCLASSEX);\n    wc.style = CS_HREDRAW | CS_VREDRAW;\n    wc.lpfnWndProc = WindowProc;\n    wc.hInstance = hInstance;\n    wc.hCursor = LoadCursor(NULL, IDC_ARROW);\n    wc.hbrBackground = (HBRUSH)COLOR_WINDOW;\n    wc.lpszClassName = \"WindowClass1\";\n\n    RegisterClassEx(&amp;wc);\n\n    hWnd = CreateWindowEx(NULL, \"WindowClass1\", \"Our First Windowed app\", WS_OVERLAPPEDWINDOW, 300, 300, 500, 400, NULL, NULL, hInstance, NULL);\n\n    ShowWindow(hWnd, SW_SHOW);\n\n    MSG msg;\n\n    while(GetMessage(&amp;msg, NULL, 0, 0))\n    {\n        TranslateMessage(&amp;msg);\n\n        DispatchMessage(&amp;msg);\n    }\n\n    return msg.wParam;\n\n\n    //return 0;\n}\n\nLRESULT CALLBACK WindowProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam) \n{\n\n    switch(message)\n    {\n    case WM_DESTROY:\n        {\n            PostQuitMessage(0);\n            return 0;\n        } break;\n\n    }\n}\n</code></pre>\n\n<p>When i compile, i have no error, but when i run the app, i have only the app icon in my task bar and nothing more. In the task manager, i see 2 instances of the app. </p>\n\n<p>What and where i'm wrong?</p>\n\n<p>Thanks a lot for your help!</p>\n"},{"tags":["java","winapi","swing","jni","hwnd"],"answer_count":7,"favorite_count":5,"up_vote_count":16,"down_vote_count":0,"view_count":15933,"score":16,"question_id":386792,"title":"In Java Swing how do you get a Win32 window handle (hwnd) reference to a window?","body":"<p>In Java 1.4 you could use ((SunToolkit) Toolkit.getDefaultToolkit()).getNativeWindowHandleFromComponent() but that was removed.</p>\n\n<p>It looks like you have to use JNI to do this now. Do you have the JNI code and sample Java code to do this?</p>\n\n<p>I need this to call the Win32 GetWindowLong and SetWindowLong API calls, which can be done via the Jawin library.</p>\n\n<p>I would like something very precise so I can pass a reference to the JDialog or JFrame and get the window handle.</p>\n\n<p><a href=\"http://stackoverflow.com/questions/265602/swing-transparency-using-jni\">Swing transparency using JNI</a> may be related.</p>\n"},{"tags":["security","winapi","hash","credentials","kerberos"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":134,"score":3,"question_id":10130325,"title":"Validate a user's password using the hash?","body":"<p>i know it's possible to validate user's Windows (e.g. domain) credentials programatically using:</p>\n\n<ul>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa378184%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>LogonUser(username, password)</code></a></li>\n<li><a href=\"http://stackoverflow.com/a/327073/12597\">from .NET ValidateCredentials(username, password)</a></li>\n<li><a href=\"http://stackoverflow.com/questions/9788318/what-targetname-to-use-when-calling-initializesecuritycontext-negotiate\">or the SSPI API directly</a></li>\n</ul>\n\n<p>There has come a time when i want to persist those credentails. </p>\n\n<p>i'm using the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa380261%28v=vs.85%29.aspx\" rel=\"nofollow\">Data Protection API</a> (via the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa375187%28v=vs.85%29.aspx\" rel=\"nofollow\">CredUI API</a>) to encrypt the password. This means that the encrypted data can only be accessed by the user themselves. My program, running as the user, can then decrypt the protected data. </p>\n\n<p>But it also means that a <strong>malicious</strong> program running as the user can decrypt the protected data; stealing the user's encrypted credentials.</p>\n\n<p>i know that Windows itself does not store the user's <code>password</code>. What they store is the salted and hashed version of the password; and forms the <em>\"shared secret\"</em> between the user and Windows.</p>\n\n<p>Is there an API that lets me ask Windows if a user's password is valid, when i know the <em>salted hash</em> of the password?</p>\n"},{"tags":["c#","windows","winapi","gui","aero"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":185,"score":1,"question_id":8279186,"title":"DwmExtendFrameIntoClientArea and resizing window","body":"<p>I'm using <code>DwmExtendFrameIntoClientArea()</code> to have a nice look of my windows, but there is a 'glitch' while resizing window - when things are scaling, for small amount of time there is visible background, which's treated as black when I have property <code>Background=\"Transparent\"</code> set.</p>\n\n<p>How to get rid of this problem? Of course I could extend margins to cover much more than strictly needed amount of a window, but I feel it'd be too CPU-consuming.</p>\n"},{"tags":["c","windows","winapi","ras"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":11793571,"title":"What are the exit codes used by RASPHONE.exe?","body":"<p>Due to a major time constraint, need to stick with invoking rasphone.exe from my c program, rather than best approach of using RAS API's. From my code, when the rasphone pop's up a dialler window to the user, if the user click's on cancel button, i have to stop blocking another set of code. \nUltimately, i need to handle the rasphone returns to control my code flow based on the Success/Failure-Cancel. How to do this? Also, is there any other possibility for silent dialling without any popup?I hope no, as its discussed.</p>\n"},{"tags":["c++","windows","winapi","filesystems"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":11784403,"title":"Searching file in the whole system using extended functions","body":"<p>The following code yields the runtime error:</p>\n\n<blockquote>\n  <p>Unhandled exception at 0x773315de in Window File Search.exe: 0xC0000005: Access violation.</p>\n</blockquote>\n\n<p>I don't have any idea what has caused it. Could you point out my mistake?</p>\n\n<p>Here is the function that probably contain the culprit:</p>\n\n<pre><code>int fileSearcher::findFilesRecursivelly(const TCHAR* curDir,const TCHAR* fileName,bool caseSensitive,TCHAR* output)\n{\n    HANDLE hFoundFile;\n    WIN32_FIND_DATA foundFileData;\n\n    TCHAR nextDirBuffer[MAX_PATH]=TEXT(\"\");\n\n    SetCurrentDirectory(curDir);\n    //Fetch inside current directory\n    hFoundFile = FindFirstFileEx(fileName,FINDEX_INFO_LEVELS::FindExInfoBasic,&amp;foundFileData ,FINDEX_SEARCH_OPS::FindExSearchNameMatch ,NULL , FIND_FIRST_EX_LARGE_FETCH);\n\n    if(hFoundFile != INVALID_HANDLE_VALUE)\n    {       \n        do\n        {\n            nothingFound = false;\n\n            wcscat(output,curDir);\n            wcscat(output,TEXT(\"\\\\\"));\n            wcscat(output,foundFileData.cFileName);\n            wcscat(output,TEXT(\"\\n\"));\n        }   \n        while(FindNextFile(hFoundFile,&amp;foundFileData));\n    }\n\n    //Go to the subdirs\n    hFoundFile = FindFirstFileEx(TEXT(\"*\"),FINDEX_INFO_LEVELS::FindExInfoBasic,&amp;foundFileData ,FINDEX_SEARCH_OPS::FindExSearchLimitToDirectories ,NULL , FIND_FIRST_EX_LARGE_FETCH); //This line of code was on the call stack\n\n    if(hFoundFile != INVALID_HANDLE_VALUE)\n    {\n        do\n        {\n            wcscat(nextDirBuffer,curDir);\n            wcscat(nextDirBuffer,TEXT(\"\\\\\"));\n            wcscat(nextDirBuffer,foundFileData.cFileName);\n            findFilesRecursivelly(nextDirBuffer,fileName,caseSensitive,outputBuffer);\n        }\n        while(FindNextFile(hFoundFile,&amp;foundFileData));\n    } \n\n    return 0;\n\n}\n</code></pre>\n\n<p>Less important code:</p>\n\n<p>File Search.h</p>\n\n<pre><code>#ifndef UNICODE\n#define UNICODE\n#endif\n\n#include &lt;Windows.h&gt;\n\nnamespace fileSearch\n{\nclass fileSearcher\n{\npublic: \n    fileSearcher();\n\n    void getAllPaths(const TCHAR* fileName,bool caseSensitive,TCHAR* output);   \n    /*Returns all matching pathes at the current local system. Format:\n    [A-Z]:\\[FirstPath\\foo1...\\fileName]\n    [A-Z]:\\[SecondPath\\foo2...\\fileName]\n    [A-Z]:\\[ThirdPath\\foo3...\\fileName]\n    ...\n    [A-Z]:\\[FourthPath\\foo4...\\fileName]\n    Also an asterisk sign is supported, as in regular expressions.\n\n    This functions uses WinApi methods.\n    */\n\n    int findFilesRecursivelly(const TCHAR* curDir,const TCHAR* fileName,bool caseSensitive,TCHAR* output);\n    //Searches for the file in the current and in sub directories. NOT IN PARENT!!!!!!!!!!!!!!!!!!!!! Returns true if the file is found.\n\nprivate:\n    static const int MAX_NUMBER_OF_FILES = 100;\n    static const int MAX_OUTPUT_SIZE = 2000;\n\n    bool nothingFound;\n\n    TCHAR outputBuffer[MAX_OUTPUT_SIZE];\n};\n}\n</code></pre>\n\n<p>... and rest of FileSeach.cpp</p>\n\n<pre><code>#ifndef UNICODE\n#define UNICODE\n#endif\n\n#include \"File Search.h\"\n\nusing namespace fileSearch;\n\nfileSearcher::fileSearcher()\n{\n    nothingFound = true;\n}\n\nvoid fileSearcher::getAllPaths(const TCHAR* fileName,bool caseSensitive, TCHAR* output)\n{\n    TCHAR localDrives[50];\n    TCHAR currentDrive;\n    int voluminesChecked=0;\n\n    TCHAR searchedVolumine[5];\n\n\n    GetLogicalDriveStrings(sizeof(localDrives)/sizeof(TCHAR),localDrives);\n\n    //For all drives:\n    for(int i=0; i &lt; sizeof(localDrives)/sizeof(TCHAR); i++)\n    {       \n            if(localDrives[i] &gt;= 65 &amp;&amp; localDrives[i] &lt;= 90)\n            {   \n                currentDrive = localDrives[i];\n                voluminesChecked++;\n            }\n            else continue;\n\n\n\n    searchedVolumine[0] = currentDrive;\n    searchedVolumine[1] = L':';\n    searchedVolumine[2] = 0;\n\n\n\n    outputBuffer[0]=0;\n    findFilesRecursivelly(searchedVolumine,fileName,caseSensitive,outputBuffer);\n\n    (nothingFound) ? wcscpy(output,L\"File not found\") : wcscpy(output,outputBuffer);\n\n    }\n\n}\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>The value of curDir after some iterations is -      </p>\n\n<blockquote>\n<pre> +        curDir  0x003df234 \"C:\\.\\$Recycle.Bin\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\\.\"  const wchar_t *</pre>\n</blockquote>\n\n<p>but I don't know why.</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":11784785,"title":"Why SendInput windows API call fails when mouse hovers on some applications like Kaspersky Anti-virus tool?","body":"<p>My application is service-based which is installed into Virtual machine(VM) . This service(SYSTEM a/c) creates another process(SYSTEM a/c) which is used to handle mouse operations for multi-monitor support of VM guest.</p>\n\n<p>Installed Kaspersky Anti-virus tool into VM. Kaspersky service(SYSTEM a/c) creates process(to handle UI) with logged-on user and 'Medium' integrity level.</p>\n\n<p>When I do mouse hovers on kaspersky tool, no mouse operation(mouse move, mouse click) works. Initially thought it could be UIPI issue and checked integrity levels of both processes.</p>\n\n<p>Don't understand why SendInput Windows API fails even my application has higher integrity level than Kaspersky tool?</p>\n"},{"tags":["winapi","shell","powershell","scripting","automation"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":263,"score":2,"question_id":11480056,"title":"Feeding input to an interactive command line application","body":"<p>I'd like to feed inputs to a command line interface for Cisco AnyConnect <code>vpncli.exe</code> (v2.3) to automate its (re)connection.  It does not take username nor password as command line arguments, but reads those interactively from the user via the command line interface.</p>\n\n<p>Problem is that piping input to <code>vpncli.exe</code> doesn't seem to work for the password. It works for everything except the password. So doing things like this doesn't work:</p>\n\n<pre><code>vpncli.exe &lt; input.txt\ntype input.txt | vpncli.exe\n</code></pre>\n\n<p>The application just gets stuck at where it asks for the password.</p>\n\n<p><br>\nBelow is an example of normal (working) execution where the user enters the parameters:</p>\n\n<p><img src=\"http://i.stack.imgur.com/gIxKY.png\" alt=\"Example vpncli.exe run\"></p>\n\n<p>Notice how the password characters get transformed to <code>*</code>.</p>\n\n<p><br>\nUsing tools like AutoIt or AutoHotKey to send the inputs to a command prompt window works, but is clumsy and fragile (does not work if the tool can't get to the command prompt window for some reason).</p>\n\n<p><br>\nIs there any way to send inputs to such interactive CLI application using PowerShell?</p>\n\n<p>(Or using any other scripting language or some other means?)</p>\n"},{"tags":["silverlight","winapi","pinvoke","silverlight-5.0"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":114,"score":1,"question_id":11788625,"title":"pInvoke Win32 function for Marshal.PtrToStructure in Silverlight 5","body":"<p>I used </p>\n\n<pre><code>public static Object PtrToStructure(\nIntPtr ptr,\nType structureType\n)\n</code></pre>\n\n<p>in the form of     </p>\n\n<pre><code>private static object ReadStruct(byte[] buffer, Type t)\n{\n    GCHandle handle =\n        GCHandle.Alloc(buffer,\n        GCHandleType.Pinned);\n    Object temp =\n        Marshal.PtrToStructure(\n        handle.AddrOfPinnedObject(),\n        t);\n    handle.Free();\n    return temp;\n}\n</code></pre>\n\n<p>for marshaling data in .net 4.0.  Silverlight does not support this method. According to the following article, the .net method is simply a wrapper for a native win32 function. An example was given for Marshal.AllocHGlobal (Win32 LocalAlloc function from Kernel32.dll)</p>\n\n<p><a href=\"http://blogs.msdn.com/b/silverlight_sdk/archive/2011/09/27/pinvoke-in-silverlight5-and-net-framework.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/silverlight_sdk/archive/2011/09/27/pinvoke-in-silverlight5-and-net-framework.aspx</a></p>\n\n<p>These are new waters since SL5 just enabled pInvoke for trusted applications (in browser as well) What is the win32 function that PtrToStructure wraps and is there anything preventing using this in SL5?</p>\n"},{"tags":["windows","winapi","assembly","x86","nasm"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":181,"score":2,"question_id":11731816,"title":"Confusion with how Win32 API calls work in assembly","body":"<p>I don't know how to ask this better but why does this:</p>\n\n<pre><code>call ExitProcess\n</code></pre>\n\n<p>do the same as this?:</p>\n\n<pre><code>mov eax, ExitProcess\nmov eax, [eax]\ncall eax\n</code></pre>\n\n<p>I would think that these would be equivalent:</p>\n\n<pre><code>call ExitProcess\n</code></pre>\n\n<p><br /></p>\n\n<pre><code>mov eax, ExitProcess\ncall eax\n</code></pre>\n"},{"tags":["c++","windows","winapi","window","parent-child"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":11786987,"title":"C++ Window Parent and Child","body":"<p>So I created a parent window and then created a child window using CreateWindowEx. Now when I created the child window I gave it a style of WS_POPUP.</p>\n\n<p>MSDN says:<br/>\nWS_POPUP<br/>\n0x80000000L<br/>\nThe windows is a pop-up window. This style cannot be used with the WS_CHILD style.</p>\n\n<p>The window is a popup window, and is a child window of my other window. I guess I am confused with what the WS_CHILD style is for since I can still make my popup window a child of another window?</p>\n"},{"tags":["c++","winapi","visual-c++"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":151,"score":2,"question_id":10279372,"title":"Is it possible to call WriteFile and the application will wait for the callback forever?","body":"<p>I call the method <code>win32::WriteFile</code> and then I call</p>\n\n<pre><code>WaitForSingleObject( handle, INFINITE )\n</code></pre>\n\n<p>with the same handle that I used in the <code>WriteFile</code> call.</p>\n\n<p>Is it possible to have some scenario so that I will wait forever... and <code>WriteFile</code> won't finish his writing? I am going to write 512 kB and I'm assuming my hardware has no problem. </p>\n\n<p>I expect to get <code>FAIL</code> and not to wait forever.</p>\n"},{"tags":["c#",".net","windows","winapi","network-programming"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":124,"score":2,"question_id":11781181,"title":"GetHostAddresses different error codes","body":"<p>I wrote a small test program that used <code>Dns.GetHostAddresses</code> to resolve a host name. If I entered a hostname that didn't exist, it would throw a <code>SocketException</code> and the message would be <code>No such host is known</code>.<br>\nI liked this because the error message was small enough to put into my UI, and straight to the point.</p>\n\n<p>Now I literally copied and pasted the code into a somewhat larger project, but this time when I enter the exact same hostname I did in my test project, it throws a <code>SocketException</code> but the message is set to <code>The requested name is valid, but no data of the requested type was found</code></p>\n\n<p>Both the stack traces are the same in each program, but the first ones error is <code>WSAHOST_NOT_FOUND</code> where the second one is <code>WSANO_DATA</code>.</p>\n\n<p>I could just output my own error message, but I would like to know why it's throwing a different error each time? There are no differences in the code.</p>\n\n<p>Also, it seems that no matter how many times I run each program, they each keep outputting the same error message. It's not alternating or anything.</p>\n\n<p><strong>===========================================================================</strong></p>\n\n<p>Well I figured out what was causing the problem.<br>\nI added Pcap.Net as a reference and was including it in my project with <code>using PcapDotNet.Core;</code><br>\nAnyways, after I commented that out, <code>Dns.GetHostAddresses</code> was throwing the correct exception.</p>\n\n<p>If anyone could tell me why its behaving like that, and how to get around it, that would be great.</p>\n"},{"tags":["winapi","dump"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":11763820,"title":"MiniDumpReadDumpStream and multiple streams of the same type","body":"<p>I am using the following function to read a .dmp file which contains user-defined streams. Now my problem is that in my dumps, there exist multiple streams with equal stream types. </p>\n\n<pre><code>BOOL WINAPI MiniDumpReadDumpStream(\n  __in   PVOID BaseOfDump,\n  __in   ULONG StreamNumber,\n  __out  PMINIDUMP_DIRECTORY *Dir,\n  __out  PVOID *StreamPointer,\n  __out  ULONG *StreamSize\n);\n</code></pre>\n\n<p>As far as I see in my tests, the above function will only return to me the very first occurance of such stream, ignoring all others, because it retrieves the streams by their type, and not the index of occurance. \nIf I analyze my dump file with the dumpchk.exe utility, it correctly displays all other streams being present. Also I was able to read out the streams correctly with my own reader code which is quite ugly, so I do not really want to use it.</p>\n\n<p>So just for clarification. Is this an issue with the MiniDumpReadDumpStream function or is there a rule that forbits multiple streams with identical types? I could not locate such instructions in the documentation (msdn)... \nOr is there a way to make the function return the other streams?</p>\n\n<p>Looking forward to your answers...</p>\n\n<p>Best regards,\nFabian</p>\n"},{"tags":["c++","winapi","window","drag","window-position"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":565,"score":2,"question_id":2406168,"title":"Constraining window position to desktop working area","body":"<p>I want to allow a user to drag my Win32 window around only inside the working area of the desktop. In other words, they shouldn't be able to have any part of the window extend outside the monitor(s) nor should the window overlap the taskbar.</p>\n\n<p>I'd like to do it in a way that does cause any stuttering. Handling WM_MOVE messages and calling MoveWindow() to reposition the window if it goes off works, but I don't like the flickering effect that's caused by MoveWindow().</p>\n\n<p>I also tried handling WM_MOVING which prevents the need to call MoveWindow() by altering the destination rectangle before the move actually happens. This resolves the flickering problem, but another issue I run into is that the cursor some times gets aways from the window when a drag occurs allowing the user to drag the window around while the cursor is not even inside the window.</p>\n\n<p>How do I constrain my window without running into these issues?</p>\n"},{"tags":["winapi","tray"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":110,"score":1,"question_id":11779117,"title":"Click menu item in tray programmatically","body":"<p>I'm writing an application in which I need to click a menu item from another application's tray icon's menu. Here's a screenshot for a better understanding, because I'm bad at explaining stuff.\n<img src=\"http://i.stack.imgur.com/WFfxZ.png\" alt=\"Screenshot example\"><br>\nSo I need to click one of those menu items, for example \"Quit\".    </p>\n\n<p>I know that I should use WinApi in order to do that. However, as far as I know, the message <code>WM_NOTIFY</code> is responsible for notifying the top window about the menu item click. And as the MSDN site says, <code>For Windows 2000 and later systems, the WM_NOTIFY message cannot be sent between processes</code>. The PC I want to run my application is running Windows XP, so I can not send this message to the window. Is there any other way to click the menu item?    </p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c++","windows","multithreading","winapi","join"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":3,"view_count":68,"score":-2,"question_id":11779504,"title":"join equivalent in windows - c++","body":"<p>How do I wait for a thread to die in windows? this is how I want my code to look like:</p>\n\n<pre><code>main thread:\n\ncreating thread: thread1\nwaiting for thread1 to die\n//rest of the code\n</code></pre>\n\n<p>thanks</p>\n"},{"tags":["c#","c++","c","windows","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":660,"score":0,"question_id":3407779,"title":"Can someone decipher whether timeGetTime() or QueryPerformanceCounter/QueryPerformanceFrequency has lower overhead or/and accuracy?","body":"<p>The idea is that an existing project uses timeGetTime() (for windows targets) quite frequently. </p>\n\n<pre><code>milliseconds = timeGetTime();\n</code></pre>\n\n<p>Now, this could be replaced with   </p>\n\n<pre><code>double tmp = (double) lpPerformanceCount.QuadPart/ lpFrequency.QuadPart; \nmilliseconds = rint(tmp * 1000);\n</code></pre>\n\n<p>with lpPerformanceCount.QuadPart and lpFrequency.QuadPart being taken from the use of a single call to QueryPerformanceCounter() and QueryPerformanceFrequency().</p>\n\n<p>I know Windows' internals are kind of voodoo, but can someone decipher which of the two is more accurate or/and has more overheads?</p>\n\n<p>I suspect accuracy might be same but QueryPerformanceCounter might have less overheads. But I have no hard data to back it up.</p>\n\n<p>Of course I wouldn't be surprised if the opposite is true.</p>\n\n<p>If overheads are tiny in any way I would be more interested on whether there's any difference in accuracy.</p>\n"},{"tags":["c++","multithreading","winapi","thread-safety","wxwidgets"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":90,"score":-1,"question_id":10138582,"title":"Converting the code written in windows threads to wxwidgets threads","body":"<p>I have the code that makes use of multithreading however it is via using windows i want to convert the code in wxwdigets i have been trying for a long time but there is no success and ultimately i deleted what i did and wants to start from scratch </p>\n\n<pre><code>#include \"windows.h\"\n#include &lt;iostream&gt;\n#include &lt;stdio.h&gt;\n\n\nDWORD WINAPI ThreadFn(LPVOID vpParam);\n\nint main() {\n    using namespace std;\n\n    // Create the thread and pass in the function pointer and counter\n    unsigned int uiCounter = 0;\n    DWORD qThreadID;\n    HANDLE hThread = CreateThread(0, 0, ThreadFn, &amp;uiCounter, 0, &amp;qThreadID);\n\n    // Loop until the user enters 'q'\n    char cChar = ' ';\n    while (cChar != 'q') {\n        cout &lt;&lt; uiCounter &lt;&lt; endl;\n        cChar = (char)getchar();\n    }\n\n    // Close the handle to the thread\n    CloseHandle(hThread);\n\n    return 0;\n}\n\n\nDWORD WINAPI ThreadFn(LPVOID vpParam)\n{\n    unsigned int&amp; uirCounter = *((unsigned int*)vpParam);\n    // Increment up to the maximum value\n    while (uirCounter &lt; 0xFFFFFFFF) {\n        ++uirCounter;\n    }\n    return 0;\n}\n</code></pre>\n"},{"tags":["windows","winapi","mfc"],"answer_count":6,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":902,"score":2,"question_id":597959,"title":"sending the message Ctrl+Alt+Del from my application","body":"<p>I want to write a small utility in MFC which sends the <kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>Del</kbd> message to OS. Can any one help me how do I achieve this? I tried:</p>\n\n<pre><code>::PostMessage(HWND_BROADCAST, WM_HOTKEY, 0, MAKELONG( MOD_CONTROL | MOD_ALT, VK_DELETE)); But this is not working.\n</code></pre>\n\n<p>Thanks.</p>\n\n<p>I want to send <kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>Del</kbd> not to invoke <code>TaskMgr.exe</code>. Also, it is for my local OS (Windows XP Service pack 2). Basically I want to use this application to lock my machine and schedule some actions along with locking.</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":11756929,"title":"CaptureStackBackTrace with file information","body":"<p>I'm using <code>CaptureStackBackTrace</code> and <code>SymFromAddr</code> to identify the functions in the callstack.\nIs there a way to find the source file of each symbol with this (i can't find any documentation for this)? Or i have to use StackWalk ?</p>\n"},{"tags":["c++","winapi","window","height","width"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":86,"score":-1,"question_id":11713728,"title":"Win32 C++ - Check if the Window PositionX/PositionY and Width/Height changed","body":"<p>It is possible to check whenever the X/Y position of the window changed? Also, if it's possible to check if the Window Width/Height changed too.</p>\n"},{"tags":["windows","winapi","modem","ras"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":235,"score":0,"question_id":11724639,"title":"RASPHONE.exe behavior in XP and Windows 7","body":"<p>I called \"Rasphone.exe\" from my C code using \"ShellExecuteEx\" to create a dial-up connection. I found different behaviour on Windows XP and Windows 7.</p>\n\n<p>Behavior in Windows XP : \nThe RASDial connection gets created without any Pop-up Window.</p>\n\n<p>Behaviour in Windows 7 :\nA DialUp window Pops up asking number to be dialed. I didnt enter any number, and clicked \"Dial\" button. Connection gets connected. The below is the snap-shot window which I get in windows 7?</p>\n\n<p><img src=\"http://i.stack.imgur.com/6dDpw.png\" alt=\"enter image description here\"></p>\n\n<p>What is the reason for the difference in behaviour?</p>\n"},{"tags":["winapi","user-interface"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":11730871,"title":"Is it possible to use BackgroundWorker Thread for VC++ Win32 projects?","body":"<p>First I'll explain what exactly I want to do here. I have a dialog box in which I am showing a frame. Using menu from this dialog, I open another Dialog box which shows me macrogrid block information from the first dialog. So to show 2nd dialog box I am using function : DialogBox(hInst, MAKEINTRESOURCE(IDD_DIALOG1), NULL, DialogProc);\nBut this transfers the execution of the program to the new dialog box and I can't process further messages in the 1st dialog unless I close the new dialog box. </p>\n\n<p>Can someone please tell me a way to solve this problem??? Is it the same thing as modal vs modeless dialog-boxes??</p>\n\n<p>Someone suggested me to use BackgroundWorker thread for this purpose. But when I tried to research about it, I read at many places that it doesn't work with win32 programming. Instead in some forums I read about using PostMessage function for the same purpose. Can someone help me deciding what would be the best approach to handle this problem? I would really be grateful if someone could explain it in detail. </p>\n\n<p>Thanks a lot.</p>\n"},{"tags":["c#","winapi"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":10618,"score":4,"question_id":523405,"title":"How to send text to Notepad in C#/Win32?","body":"<p>I'm trying to use SendMessage to Notepad, so that I can insert written text without making Notepad the active window.</p>\n\n<p>I have done something like this in the past using <code>SendText</code>, but that required giving Notepad focus.</p>\n\n<p>Now, first I'm retrieving the Windows handle:</p>\n\n<pre><code>Process[] processes = Process.GetProcessesByName(\"notepad\");\nConsole.WriteLine(processes[0].MainWindowHandle.ToString());\n</code></pre>\n\n<p>I've confirmed it's the right handle for Notepad, the same shown within <code>Windows Task Manager</code>.</p>\n\n<pre><code>[DllImport(\"User32.dll\", EntryPoint = \"SendMessage\")]\npublic static extern int SendMessage(int hWnd, int Msg, int wParam, int lParam);\n</code></pre>\n\n<p>From here, I haven't been able to get SendMessage to work in all my experimentation.  Am I going in the wrong direction?</p>\n"},{"tags":["winapi","systemmenu"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":871,"score":1,"question_id":2602375,"title":"How to Disable the Move System Menu Item?","body":"<p>In Microsoft Windows, this works:</p>\n\n<pre><code> mnu := GetSystemMenu(h, false);\n EnableMenuItem(mnu, SC_CLOSE, MF_BYCOMMAND or MF_GRAYED);\n</code></pre>\n\n<p>But this does not work:</p>\n\n<pre><code> mnu := GetSystemMenu(h, false);\n EnableMenuItem(mnu, SC_MOVE, MF_BYCOMMAND or MF_GRAYED);\n</code></pre>\n\n<p>Hence I know how to disable the \"Close\" system menu item of a window, but not the \"Move\" item. How do I do that?</p>\n\n<p><strong>Update</strong></p>\n\n<p>Of course one alternative to using the very nice function EnableMenuItem, is to use SetMenuItemInfo:</p>\n\n<pre><code>  FillChar(info, sizeOf(info), 0);\n  with info do\n  begin\n    cbSize := sizeOf(info);\n    fMask := MIIM_STATE;\n    fState := MFS_GRAYED;\n  end;\n  SetMenuItemInfo(mnu, SC_MOVE, false, info);\n</code></pre>\n\n<p>But this again works perfectly for SC_CLOSE, but not at all for SC_MOVE!</p>\n\n<p><strong>Update 2</strong></p>\n\n<p>Even though the problem is resolved in the sense that a working code has been found that \"does the job\", so to speak, it would be interesting to hear hypotheses regarding the cause of the problem: Why does SC_CLOSE work but not SC_MOVE?</p>\n"},{"tags":["c","winapi","tabs","tabitem"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":11769131,"title":"notification code for mouse over a tab item","body":"<p>I have a tab control created by <code>CreateWindowEx(NULL, WC_TABCONTROL,...)</code>. I would like to have a notification when a mouse is over a tab item. The tab control has the style <code>TCS_TOOLTIPS</code> and when the mouse is over a tab item for an amount <code>TTDT_INITIAL</code> ms (whose default value is double click time), it will display a tooltip.</p>\n\n<p>But I also need a notification immediately when a mouse is over a tab item. But I don't want to modify the <code>TTDT_INITIAL</code> value. In fact, when a mouse is over a non-selected tab item, it will change the color to blue by default. But I can not find the notification (and its receiver) for this thing.</p>\n\n<p>So I would like to know if there is a way to <code>be notified immediately when a mouse is over a tab item</code> (winapi only).</p>\n"},{"tags":["windows","winapi","com"],"answer_count":5,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":3120,"score":7,"question_id":393509,"title":"Usage of CoTaskMemAlloc?","body":"<p>When is it appropriate to use CoTaskMemAlloc?  Can someone give an example?</p>\n"},{"tags":["windows","delphi","winapi","operating-system","delphi-xe2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":115,"score":0,"question_id":11756868,"title":"SHGetDriveMedia and synchronization","body":"<p>To recognize a media i use <code>SHGetDriveMedia</code>; \non the second parameter I pass <code>pdwMediaContent</code> for reference and the api \ninsert the type of content. \nHowever, the recognition is done asynchronously. How can I know when the api \nhas finished the recognition?</p>\n"},{"tags":["windows","winapi","shellexecuteex"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":134,"score":0,"question_id":2559201,"title":"What are the default access rights for a process started with ShellExecuteEx?","body":"<p>I need to perform certain operations on a process started with <code>ShellExecuteEx</code> - like waiting for it, duplicating handles, querying and setting information etc. Now I am wondering if I can do all these things on the <code>hProcess</code> member which is returned in the <code>SHELLEXECUTEINFO</code> structure I pass to <code>ShellExecuteEx</code>. Does anybody know this? </p>\n\n<p>Does the process that called <code>ShellExecuteEx</code> have rights like <code>PROCESS_DUP_HANDLE</code>, <code>SYNCHRONIZE</code>, <code>PROCESS_SET_INFORMATION</code>, <code>PROCESS_QUERY_INFORMATION</code> (and so on) by default, when using the returned <code>hProcess</code>?</p>\n"},{"tags":["c","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":11760736,"title":"Appending to cstring after assigning the first index","body":"<p>The output of this example is ... </p>\n\n<blockquote>\n  <p>HC:\\Projects\\cppexample.exeello world.</p>\n</blockquote>\n\n<p>Why the path to the current executable was pushed in the string?</p>\n\n<pre><code>#ifndef UNICODE\n#define UNICODE \n#endif\n\n\n    #include &lt;Windows.h&gt;\n\n    int main()\n    {\n        TCHAR string[255];\n        string[0]=TEXT('H');\n        wcscat(string,TEXT(\"ello world\"));\n\n        MessageBox(0,string,0,0);\n\n        system(\"Pause\");\n        return 0;\n    }\n</code></pre>\n"},{"tags":["perl","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":11759798,"title":"Perl Win32::Lanman - Is there a n equivalent?","body":"<p>I am upgrading an application on an old windows 2003 server, which used perl 5.6 and I found a script which disconnects users from terminals using Win32::Lanman::WTSEnumerateSessions and Win32::Lanman::WTSQuerySessionInformation. After searching the web I realized that this module wouldn't run properly on perl 5.14 which I wish to use. \nDo you know any equivalent module/s so I could refactor this sctipt? or alternatively a way to make it run under perl 5.14</p>\n\n<p>thanks in advanced,</p>\n\n<p>Roy</p>\n"},{"tags":["c++","c","windows","winapi","window"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":7187,"score":2,"question_id":615551,"title":"How to get width and height from CreateWindowEx() window? C++","body":"<p>I have made a window with CreateWindowEx() function, now how do i get the width and height from that window i created? This sounds very basic thing to do, but i just couldnt find any answer ;_; </p>\n\n<p>This is needed because the window height is created automatically depending on how the Windows wants to create it.</p>\n\n<p>Language C or C++ </p>\n"},{"tags":["c++","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2120,"score":2,"question_id":1043825,"title":"Process name change at runtime (C++)","body":"<p>Is it possible to change the name(the one that apears under 'processes' in Task Manager) of a process at runtime in win32? I want the program to be able to change it's own name, not other program's. Help would be appreciated, preferably in C++. And to dispel any thoughts of viruses, no this isn't a virus, yes I know what I'm doing, it's for my own use.</p>\n"},{"tags":["windows","winapi","64bit","32bit-64bit","setupapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":11757997,"title":"Equivalent API of SetupDiCallClassInstaller to uninstall my modem","body":"<p>I used <code>SetupDiCallClassInstaller</code> with <code>DIF_REMOVE</code> as parameter to uninstall my modem. But when I tested my application in \"Windows 7\" \"64-Bit\" machine I got error <code>0xE0000235</code>, But I couldnt found a solution to solve this.</p>\n\n<p>Some of the <a href=\"http://stackoverflow.com/questions/8684061/setupdicallclassinstaller-throws-error-in-wow64-when-compiled-for-32-bit-on-a-64\">SO links</a> which talks about this doesnt have a solution rather than creating a 64 bit exe, Which I dont want to.</p>\n\n<p>My question here is is there any other API which do the same ( I want to un-install my modem )?</p>\n"},{"tags":["c++","winapi","callback","messagebox","dialogbox"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":11753545,"title":"WinMain Callback processes message que prior to displaying a Modal dialogbox?","body":"<p>EDIT: Question is why the application jumps to the callback before MessageBox is called. ImmediatePositionX sends a serial packet, for which a response packet is generated. When the response packet is detected, a message is posted to the message que. In most cases, the message is not passed to the callback until a return is called. This function jumps over to the callback between ImmediatePositionX and Message Box, and I do not understand why. Apologies if i'm explaining myself poorly.</p>\n\n<p>I'm currently using the CSerialWnd class from here (http://www.codeproject.com/Articles/992/Serial-library-for-C) for processing serial messages in my program. The object is nested within a couple of classes, but posts a message to the WinMain Message Que every time an incomming serial event is detected.</p>\n\n<p>The class is currently being used to communicate with a stepper motor driver, which posts an ACK or NACK character every time it receives something. If the command is requesting some sort of data from the drive, the drive responds with the drive's id + the command + the data. In this case, ImmediatePositionX() requests the drive's position, then saves it as an int. GetPositionX() returns said int.</p>\n\n<p>Now, SavePosX() is currently relying on the fact that if I post a message to the serial port and then immediately create a message box, the WinMain callback processes the drive's response BEFORE actually displaying the message box. SavePosX uses this to poll the drive for its position, and then ask the user if they want to save this position to an INI file.</p>\n\n<p>I have a feeling the answer is painfully obvious, but I haven't managed to find it yet. Is this behavior I can rely on? Or have I botched something in order to cause this?</p>\n\n<pre><code>//Updates the value of newPos with the current position, then sets the INI variable at     varName to newPos\nint SavePosX(HWND hwnd, int * newPos, char varName[]){\nlong lLastError = ERROR_SUCCESS;\nint savePosFlag = 0;\n\nstd::string outBuffer = \"Overwrite the current definition for \";\noutBuffer += varName;\noutBuffer += \"?\";\n\nlLastError = driveController.StopX();\nlLastError = driveController.ImmediatePositionX();\n\n//for some reason, the Main Window Callback Function will process the serial buffer BEFORE posting the message box.\n//without this, this function would not work \n\nsavePosFlag = MessageBox(hwnd, outBuffer.c_str(), \"WARNING!\", MB_OKCANCEL | MB_ICONEXCLAMATION);\n\nif(lLastError != ERROR_SUCCESS){\n    MessageBox(NULL, \"Error writing to the port!\", NULL, MB_ICONEXCLAMATION | MB_OK);\n    return 1;\n}\n\nif(savePosFlag == IDOK){\n    *newPos = driveController.GetPositionX();\n    driveControllerParams.SetInt(absPos, varName, *newPos);\n}\n\nreturn 0;\n}\n</code></pre>\n\n<p>Call to SavePosX (within Case WM_COMMAND in Callback):</p>\n\n<pre><code>case IDB_FP_SAGNAC:\n                lLastError = driveController.GoToPositionX(absPosSAGNAC, accel, decel, velocity);\n                SetFocus(hwnd);\n                break;\n</code></pre>\n"},{"tags":["c#","winapi","resources"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":333,"score":1,"question_id":6111981,"title":"c# BeginUpdateResource","body":"<p>I would like to add a string resource to an executable file <em>programmatically</em>. Just for example purposes, let's say I am trying to add a string named \"String SO\" which holds the value of \"stringVal\"</p>\n\n<p><em>If this helps anyone - if I were to do this through VS.net I could just right click on my Project => Resources => Add New String Resource etc..</em></p>\n\n<p><strong>I am using the following Win32 API's:</strong></p>\n\n<pre><code>[DllImport(\"kernel32.dll\", SetLastError = true)]\npublic static extern IntPtr BeginUpdateResource(string pFileName,\n[MarshalAs(UnmanagedType.Bool)]bool bDeleteExistingResources);\n\n[DllImport(\"kernel32.dll\", SetLastError = true)]\npublic static extern bool UpdateResource(IntPtr hUpdate, uint lpType, uint lpName, ushort wLanguage, byte[] lpData, uint cbData);\n\n[DllImport(\"kernel32.dll\", SetLastError = true)]\npublic static extern bool EndUpdateResource(IntPtr hUpdate, bool fDiscard);\n</code></pre>\n\n<p>So, I have found a couple of pages online but none of them seem to help me in what I am trying to do. If any of you are able to find anything I would be very grateful.</p>\n\n<p>Otherwise, I would greatly appreciate any snippets that may help.\nThank you,\nEvan</p>\n"},{"tags":["c++","c","winapi","keyboard"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":4844,"score":4,"question_id":1021175,"title":"SendInput() Keyboard letters C/C++","body":"<p>I am trying to use <code>SendInput()</code> to send a sentence to another application (Notepad) and then send it hitting the <kbd>Enter</kbd> Key.</p>\n\n<p>Any code snippets? Or help</p>\n"},{"tags":["c","windows","winapi","gui"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":11630313,"title":"Adding to HIMageList failing, cannot figure out why","body":"<p>I'm confused because I cannot establish why my ImageList_Add call is failing. I know it must be something that I am doing wrong with the Image or maybe I'm calling it wrong but I have no idea how I can go about fixing it :S Any help you can offer would be appreciated! :)</p>\n\n<p>The code i'm using is below. I'm getting output on the console saying it couldn't add to the image list. From the docs,ImageList_Add will return an indice of where in the imagelist it managed to add the image so -1 is returned if it cant. </p>\n\n<p>Which is all well and good but I cannot find anywhere why/what causes the add to fail!</p>\n\n<p>The code may have memory leaks, though at the moment,ive spent almost a day trying to figure out various issues with this so I just want to get it to work!</p>\n\n<pre><code>    HIMAGELIST imageList = ImageList_Create(20,20,ILC_COLOR16,1,2 );\nif (imageList == NULL)\n{\n    printf(\"Error creating imagelist - dlg_create_dropdown_menu. Returning NULL\\n\");\n    return NULL;\n}\n\nHBITMAP currentImage = (HBITMAP) LoadImage(NULL,\"active_mdoe_icn.bmp\",IMAGE_BITMAP,0,0,LR_LOADFROMFILE);\nif (currentImage == NULL) \n{\n   if (GetLastError()== 2) \n   {\n       printf(\"File not found - dlg_create_dropdown_menu. Returning NULL.\\n\");\n       return NULL;\n   }\n    printf(\"Error loading image from file - dlg_create_dropdown_menu. Returning NULL.\\n\");\n    return NULL;\n}\nint imageIndex;\nif ( (imageIndex = ImageList_Add(imageList,currentImage,NULL)) == -1 )\n{\n    printf(\"Error adding to the image list - dlg_create_dropdown_menu. Returning NULL.\\n\");\n    return NULL;\n}\n</code></pre>\n\n<p>Thanks all, any help would be greatly received! :)</p>\n\n<p>Could this be a problem with the actual image being corrupt? I've read about that in a few places.. Might just be my luck if i'm not doing anything daft :)</p>\n"},{"tags":["c++","file","winapi","permissions","ownership"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":150,"score":0,"question_id":11755422,"title":"C++ How to retrieve a file permission and ownership via win32 api","body":"<p>I've been searching over the internet how to retrieve permissions and ownership of a file using win32 api, and yet I have no answer.</p>\n\n<p>I'm new with the win32 api , read some guides from the internet, tried to analyze some code\nassociating with this api and still I'm clueless.</p>\n\n<p>Could you guys help me out with some piece of advice or some directions , tips etc.</p>\n\n<p>I'm sorry that I can't be more specific than that by adding some code, I don't see any reason to import any code of my own since the only remaining function is the one retrieving this information and the rest is simple(User interface and etc).</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":541,"score":2,"question_id":6370045,"title":"Programatically disable Keyboard & Mouse","body":"<p>Is there a way to disable keyboard &amp; mouse?</p>\n\n<p>Ideally I'm looking for a solution whereby I could completely disable mouse and <em>almost</em> disable the keyboard - bar one key combination, for example <kbd>Ctrl</kbd>+<kbd>A</kbd>. So, once <kbd>Ctrl</kbd>+<kbd>A</kbd> is pressed - the PC will go to a mute stage (no mouse/keyboard) until <kbd>Ctrl</kbd>+<kbd>A</kbd> is pressed again.</p>\n"},{"tags":["c#","winapi","c#-4.0","ipc","event-wait-handle"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":11754571,"title":"How do I know that an EventWaitHandle has been closed?","body":"<p>I use <a href=\"http://msdn.microsoft.com/en-us/library/system.threading.eventwaithandle.aspx\" rel=\"nofollow\"><code>EventWaitHandle</code></a> to communicate between 2 processes.</p>\n\n<p>One of them uses elevated permissions and creates the EventWaitHandle with a global name using <a href=\"http://msdn.microsoft.com/en-us/library/41acw8ct.aspx\" rel=\"nofollow\"><code>public EventWaitHandle(bool initialState, EventResetMode mode, string name)</code></a> </p>\n\n<p>and other opens it using <a href=\"http://msdn.microsoft.com/en-us/library/530zssyk.aspx\" rel=\"nofollow\"><code>public static EventWaitHandle OpenExisting(string name, EventWaitHandleRights rights)</code></a></p>\n\n<p>The problem is to communicate to the process that opens are when the creator process has created and when it has destroyed the event. I continuously try to open till I succeed, but I do not see how I can close when the creator destroys the event.</p>\n"},{"tags":["windows","winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":11738666,"title":"Detect when user is activating a textfield on Windows","body":"<p>I'm trying to make a keyboard that will pop up when you need it, just like what iPhone web browser does. On Windows that should happen when user activates a textfield on any Window.</p>\n\n<p>After searching I'm planning to try EnumWindows and EnumChildWindows to enumerate all controls. If that works (I doubt) then how can I tell which one is active and if that controls accepts text input? Or is there a better way to achieve what I'm trying to do?</p>\n\n<p>Project uses C++ and Win32 API.</p>\n\n<p>EDIT: Based on rene's comment I can now get the active (child) window handle with SetWinEventHook function and EVENT_OBJECT_FOCUS. But I still can't figure out if it's a window where user can enter text. </p>\n\n<p>Calling GetGUIThreadInfo and comparing  returned hwndCaret handle to the window returned by SetWinEventHook callback works partially. It works with for example Notepad and Chrome address bar but not with for example MS Visual Studio child windows.</p>\n"},{"tags":["delphi","winapi","pdf","adobe","printers"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":144,"score":0,"question_id":11746635,"title":"PDevMode and DocumentProperties. Error when Migrating between Delphi 7+XE","body":"<p>I have the following function below that gathers the document properties of a PDF that I am printing.\nFor some reason, in Delphi 7 (running XP), this works great...however, when I try to recompile with Delphi XE using Windows 7, the function always seems to exit failing...<code>dwRet = IDOK</code>!</p>\n\n<p>I noticed that my <code>dwNeeded</code> object in Delphi 7 was <code>7332</code>, and in XE it is <code>4294967295</code>!!</p>\n\n<p>Any idea how I can quickly fix this?</p>\n\n<pre><code>Function TPrintPDF.GetPrinterDevMode ( pDevice: PChar ): PDevMode;\nVar\n  pDevModeVar : PDevMode;\n  pDevModeVar2 : PDevMode;\n  dwNeeded : DWord;\n  dwRet : DWord;\nBegin\n\n  { Start by opening the printer }\n  If (Not OpenPrinter (pDevice, PrinterHandle, Nil))\n    Then Result := Nil;\n\n  { Step 1: Allocate a buffer of the correct size }\n  dwNeeded := DocumentProperties (0,\n                         PrinterHandle, { Handle to our printer }\n                         pDevice, { Name of the printer }\n                         pDevModevar^, { Asking for size, so these are not used }\n                         pDevModeVar^,\n                         0); { Zero returns buffer size }\n\n  GetMem (pDevModeVar, dwNeeded);\n\n  { Step 2: Get the default DevMode for the printer }\n  dwRet := DocumentProperties (0,\n                 PrinterHandle,\n                 pDevice,\n                 pDevModeVar^, { The address of the buffer to fill }\n                 pDevModeVar2^, { Not using the input buffer }\n                 DM_OUT_BUFFER); { Have the output buffer filled }\n\n  { If failure, cleanup and return failure }\n  If (dwRet &lt;&gt; IDOK) Then Begin\n    FreeMem (pDevModeVar);\n    ClosePrinter (PrinterHandle);\n    Result := Nil;\n  End;\n\n  { Finished with the printer }\n  ClosePrinter (PrinterHandle);\n\n  { Return the DevMode structure }\n  Result := pDevModeVar;\n\nEnd; { GetPrinterDevMode Function }\n</code></pre>\n"},{"tags":["winapi","keyboard","mingw","wow64","syswow64"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":11747532,"title":"KbdLayerDescriptor pVkToWcharTable returns NULL on Win64","body":"<p>I am running out of ideas here.  I have a piece of code adapted from <a href=\"http://thetechnofreak.com/technofreak/keylogger-visual-c/\" rel=\"nofollow\">http://thetechnofreak.com/technofreak/keylogger-visual-c/</a> to convert keycodes to unicode chars.  It works fine in all situations except when you try to run the 32-bit version from 64-bit Windows.  For some reason pKbd->pVkToWcharTable keeps returning NULL.  I have tried __ptr64 as well as explicitly specifying SysWOW64 and System32 for the kbd dll path.  I have found several items across the internet referring to this exact or very similar problem but I cannot seem to get any of the solutions to work (See: <a href=\"http://stackoverflow.com/questions/10398072/kbdlayerdescriptor-returns-null-at-64bit-architecture\">KbdLayerDescriptor returns NULL at 64bit architecture</a>)  The following is my test code that was compiled with mingw-32 on Windows XP (gcc -std=c99 Wow64Test.c) and then executed on Windows 7 64-bit.  On Windows XP I am getting a valid pointer, however on Windows 7 I am getting NULL.</p>\n\n<p>***Update: So it looks like the problems I am having are due to mingw not implementing __ptr64 correctly as the sizeof operation gives 4 bytes instead of the 8 bytes given by visual studio.  So the real solution would be figuring out a way to make the size of KBD_LONG_POINTER dynamic or at least 64-bits but I am not sure if thats possible.  Any ideas? </p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n\n#define KBD_LONG_POINTER __ptr64\n//#define KBD_LONG_POINTER\n\ntypedef struct {\n    BYTE Vk;\n    BYTE ModBits;\n} VK_TO_BIT, *KBD_LONG_POINTER PVK_TO_BIT;\n\ntypedef struct {\n    PVK_TO_BIT pVkToBit;\n    WORD wMaxModBits;\n    BYTE ModNumber[];\n} MODIFIERS, *KBD_LONG_POINTER PMODIFIERS;\n\ntypedef struct _VK_TO_WCHARS1 {\n    BYTE VirtualKey;\n    BYTE Attributes;\n    WCHAR wch[1];\n} VK_TO_WCHARS1, *KBD_LONG_POINTER PVK_TO_WCHARS1;\n\ntypedef struct _VK_TO_WCHAR_TABLE {\n    PVK_TO_WCHARS1 pVkToWchars;\n    BYTE nModifications;\n    BYTE cbSize;\n} VK_TO_WCHAR_TABLE, *KBD_LONG_POINTER PVK_TO_WCHAR_TABLE;\n\ntypedef struct {\n    DWORD dwBoth;\n    WCHAR wchComposed;\n    USHORT uFlags;\n} DEADKEY, *KBD_LONG_POINTER PDEADKEY;\n\ntypedef struct {\n    BYTE vsc;\n    WCHAR *KBD_LONG_POINTER pwsz;\n} VSC_LPWSTR, *KBD_LONG_POINTER PVSC_LPWSTR;\n\ntypedef struct _VSC_VK {\n    BYTE Vsc;\n    USHORT Vk;\n} VSC_VK, *KBD_LONG_POINTER PVSC_VK;\n\ntypedef struct _LIGATURE1 {\n    BYTE VirtualKey;\n    WORD ModificationNumber;\n    WCHAR wch[1];\n} LIGATURE1, *KBD_LONG_POINTER PLIGATURE1;\n\ntypedef struct tagKbdLayer {\n    PMODIFIERS pCharModifiers;\n    PVK_TO_WCHAR_TABLE pVkToWcharTable;\n    PDEADKEY pDeadKey;\n    PVSC_LPWSTR pKeyNames;\n    PVSC_LPWSTR pKeyNamesExt;\n    WCHAR *KBD_LONG_POINTER *KBD_LONG_POINTER pKeyNamesDead;\n    USHORT *KBD_LONG_POINTER pusVSCtoVK;\n    BYTE bMaxVSCtoVK;\n    PVSC_VK pVSCtoVK_E0;\n    PVSC_VK pVSCtoVK_E1;\n    DWORD fLocaleFlags;\n    BYTE nLgMax;\n    BYTE cbLgEntry;\n    PLIGATURE1 pLigature;\n    DWORD dwType;\n    DWORD dwSubType;\n} KBDTABLES, *KBD_LONG_POINTER PKBDTABLES;\n\n\ntypedef PKBDTABLES(CALLBACK *KbdLayerDescriptor) (VOID);\n\nint main() {\n    PKBDTABLES pKbd;\n    HINSTANCE kbdLibrary = NULL;\n\n    //\"C:\\\\WINDOWS\\\\SysWOW64\\\\KBDUS.DLL\"\n    //\"C:\\\\WINDOWS\\\\System32\\\\KBDUS.DLL\"\n    kbdLibrary = LoadLibrary(\"C:\\\\WINDOWS\\\\SysWOW64\\\\KBDUS.DLL\");\n\n    KbdLayerDescriptor pKbdLayerDescriptor = (KbdLayerDescriptor) GetProcAddress(kbdLibrary, \"KbdLayerDescriptor\");\n\n    if(pKbdLayerDescriptor != NULL) {\n        pKbd = pKbdLayerDescriptor();\n\n        printf(\"Is Null? %d 0x%X\\n\", sizeof(pKbd-&gt;pVkToWcharTable), pKbd-&gt;pVkToWcharTable);\n    }\n\n    FreeLibrary(kbdLibrary);\n    kbdLibrary = NULL;\n}\n</code></pre>\n"},{"tags":["c++","windows","winapi","animation","cursor"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":206,"score":5,"question_id":11745851,"title":"Load an animated cursor at runtime from memory","body":"<p>I want to load an animated cursor stored in .ani format, which is described to be a RIFF archive/container, from memory without writing the memory to a temporary file. Thus far I am able to parse the .ani file structure and load the individual frames as a normal icon with the aid of <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms648061%28v=vs.85%29.aspx\">CreateIconFromResourceEx</a> <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms648074%28v=vs.85%29.aspx\">LookupIconIdFromDirectoryEx</a></p>\n\n<p>One of the problems that proofs difficult is the actual composition of these frames and the animation data (jiffy-rate etc) as there appears to be no entries in the Windows API to do so. Documentation or written knowledge over the subject seems to be limited to loading non-animated icons/cursors from memory.</p>\n\n<p>Similar questions such as <a href=\"http://stackoverflow.com/questions/3498898/load-an-embedded-animated-cursor-from-the-resource\">'Load an embedded animated Cursor from the Resource'</a> express the desire to load an animated cursor from an embeddable resource. However i am not able to reproduce a workable solution from that either. Partly because the resource compiler in visual studio 2008 &amp; 2010 doesn't support .ani (only ico and cur) files and therefor embedding it simply results in a 1:1 copy of the bytes as they were in the original file as opposed to .cur and .ico files which get decomposed into multiple resources. The subsequent call to CreateIconFromResource as shown in both answers does not work because the data it expects is the icon/cursor data of a single directive in a icon archive and not a RIFF-based file structure.</p>\n\n<p>To summarize I'm interested in any information regarding the structures of animated cursors (in memory) or otherwise relevant pointers that could assist me in pursuing my goal.</p>\n"},{"tags":["winapi","filesystemwatcher","file-system","readdirectorychangesw"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":11747726,"title":"ReadDirectoryChangesW File Moved Workaround","body":"<p><strong>Background</strong></p>\n\n<p>Windows API for monitoring file-system changes <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa365465%28v=vs.85%29.aspx\" rel=\"nofollow\">ReadDirectoryChangesW</a> cannot reliably report a file <em>move</em> operation. Instead it just notifies Deleted + Created.</p>\n\n<p><strong>Question</strong></p>\n\n<p>What workarounds can be implemented to achieve such a 'Move Event' effect on Windows?\nI'm sure I'm not the first one who's dealt with this.</p>\n\n<hr>\n\n<p>My own first thoughts were to save SHA1 sums of everything in the monitored directory (perhaps in a SQLite database) and compare the changed file with the SHA1s, so that if a delete+create happens and their sha1 sums match, we can safely assume it was a move operation. This feels a bit overkill though, I'm wondering if anyone else has already figured out some better workaround.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["ruby","winapi","rubygems","windows-7-x64"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":11531321,"title":"Windows7 x64 Ruby 1.8.7 fork gem 1.0.0 error","body":"<p>I'm trying to create a child process using the Fork gem (version 1.0.0).</p>\n\n<p>My basic code skeleton is:</p>\n\n<pre><code>child = Fork.new do |child|\n   ## something something something\n   ##        loop loop loop\n   ## something something something\nend\nchild.execute\nchild.wait\n</code></pre>\n\n<p>That follows the sample code I believe but it always returns a very counter-intuitive error:</p>\n\n<pre><code>C:/Ruby187/lib/ruby/gems/1.8/gems/fork-1.0.0/lib/fork.rb:237:in `fork': fork() f\nunction is unimplemented on this machine (NotImplementedError)\n    from C:/Ruby187/lib/ruby/gems/1.8/gems/fork-1.0.0/lib/fork.rb:237:in `ex\necute'\n</code></pre>\n\n<p>I do have the proper gems installed:</p>\n\n<pre><code>*** LOCAL GEMS ***\n\naddressable (2.2.8)\nchildprocess (0.3.3)\nffi (1.0.11)\nfork (1.0.0)\nlibwebsocket (0.1.4)\nmulti_json (1.3.6)\nmysql2 (0.3.11 x86-mingw32)\nnet-sftp (2.0.5)\nnet-ssh (2.5.2)\nnet-ssh-gateway (1.1.0)\nrdiscount (1.6.8)\nrubyzip (0.9.9)\nselenium-webdriver (2.24.0)\n</code></pre>\n\n<p>I attempted to use the classes' future/call method combo but that doesn't seem to work for me either. I installed and reinstalled several times to ensure this wasn't an environmental issue.</p>\n\n<p>I also tried to work with the win32-process gem but this requires an existing binary from what I can understand, to be called as a subprocess.  I really don't want to resort to cygwin but that might be the only way to address it.</p>\n\n<p>What has been your experience with this gem?</p>\n"},{"tags":["winapi","directshow","lync","color-space","pixelformat"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":11746247,"title":"Microsoft Lync colospaces for DirecShow","body":"<p>I'm developping a DirectShow filter which will act as an adapter between my ip camera and Microsoft Lync.</p>\n\n<p>I'm not sure what colorspaces formats are supported.</p>\n\n<p>Any clue on where I can find such information?</p>\n"},{"tags":["windows","winapi","msdn"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":96,"score":1,"question_id":11745888,"title":"\"TCHAR cFileName[MAX_PATH];\" - mistake in the MSDN library?","body":"<p><a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa365740%28v=vs.85%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/aa365740%28v=vs.85%29.aspx</a></p>\n\n<blockquote>\n  <p>cFileName <br>\n          The name of the file.</p>\n</blockquote>\n\n<p>The value of <code>MAX_PATH</code> is <s>the same as </s> almost the same as <code>_MAX_FNAME</code>, but using the first is misleading in this case. Anyway, if they meant the full path with name, should it be <code>cFileName[MAX_PATH+_MAX_FNAME];</code>? What was the purpose of using <code>MAX_PATH</code>?</p>\n"},{"tags":["winapi","canvas","device-context"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":82,"score":-2,"question_id":8640006,"title":"Painting data from device context","body":"<p>I've just got a fresh <a href=\"http://en.wikipedia.org/wiki/Graphics_Device_Interface#Technical_details\" rel=\"nofollow\">device context</a> (DC):</p>\n\n<pre><code>GetDC(someForeignHwnd)\n</code></pre>\n\n<p>Most normal people now want to paint on this. I don't. I want to display the context in my own program. Or duplicate, I wouldn't even mind the window I stole the context from beeing empty.</p>\n\n<p>In my case, I want it in a <code>TPanel</code> in <a href=\"http://en.wikipedia.org/wiki/Delphi_%28language%29\" rel=\"nofollow\">Delphi</a>, but anything else helping me understanding goes.</p>\n\n<p>Afterwards, I'll probably find the DC invalid by the time I get to display it.</p>\n\n<p>My main problem is: Showing the content of another window in my own. But that isn't important. First of all, I want to know how these DC are of any use. Can I do something like the following?</p>\n\n<pre><code>Canvas.Draw(0, 0, MyNewDC);\n</code></pre>\n\n<p>The answer can be in <a href=\"http://en.wikipedia.org/wiki/Java_%28programming_language%29\" rel=\"nofollow\">Java</a>, <a href=\"http://en.wikipedia.org/wiki/C_%28programming_language%29\" rel=\"nofollow\">C</a>, or <a href=\"http://en.wikipedia.org/wiki/Pascal_%28programming_language%29\" rel=\"nofollow\">Pascal</a>. Is it just not possible or just a stupid idea?</p>\n"},{"tags":["c++","winapi","bitmap","gdi+","gdi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":429,"score":1,"question_id":11705844,"title":"Win32 Create Bitmap from Device Context To File and/or BLOB","body":"<p>I would like to get the context of my window into a bitmap. I use the window to draw basic lines with touch. The problem that I'm having is my bitmap is black. Which it is probably due to the fact that I'm not grabbing the device context properly or doing something else wrong. </p>\n\n<p><strong>The functions CreateBitmapInfoStruct and CreateBMPFile are from the msdn example</strong> : <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd145119(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/dd145119(v=vs.85).aspx</a></p>\n\n<p><strong>Also note that g_hWnd is a global variable that has the handle of the window for which I want to save the picture.</strong> </p>\n\n<p>My end goal is to be able to save the bitmap into a mysql field (BLOB) that I have. Which was my original problem which I don't know how to go about it. Anyways, I started first by trying to create a BMP to file. </p>\n\n<p>I have search here and in other places. The best solution I found was recommended here following the msdn example: <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd145119(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/dd145119(v=vs.85).aspx</a>\nHowever, it is not working</p>\n\n<p>Any help for this specific problem and/or in writting to the bitmap into a blob into mysql table, it will be greatly appreciated. \nhere is my code:</p>\n\n<pre><code>HDC hDC = GetDC(g_hWnd); \n\nLPRECT rect = (LPRECT)malloc(sizeof(RECT)); \nGetWindowRect(g_hWnd,rect); \nint h = rect-&gt;right - rect-&gt;left;\nint w = rect-&gt;bottom - rect-&gt;top; \nLPRECT rect = (LPRECT)malloc(sizeof(RECT)); \nGetWindowRect(g_hWnd,rect); \nHBITMAP hBmp = CreateCompatibleBitmap(hDC,w,h); \nPBITMAPINFO pbmi;\npbmi = CreateBitmapInfoStruct(g_hWnd,hBmp); \n\nCreateBMPFile(g_hWnd, TEXT(\"c:\\\\TEMPO\\\\TestG2.bmp\"), pbmi, \nhBmp, hDC) ;\n\n\nReleaseDC(g_hWnd,hDC); \n\nDeleteObject(hBmp); \nDeleteObject(pbmi); \nif (rect != nullptr)\n    free(rect); \n</code></pre>\n\n<p>Thanks\nF.</p>\n\n<p>EDIT: </p>\n\n<p>The actual answer for capturing the screen (getDC) is to modify the sample here in MSDN\n<a href=\"http://msdn.microsoft.com/en-us/library/dd183402(v=vs.85\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/dd183402(v=vs.85</a>)</p>\n\n<p>I have modified the sample here (remove the stretch) Note that still uses the goto, which I will remove.<br>\nA note about the GOTO... WHile I don't use it, I don't find it to be a problem either. I think too much has been made about the GOTO statement... like if in assembly, we wouldn't do goto (JUMPS) </p>\n\n<p>here is the code: \n    void saveBitmap()\n    {\n       HDC hdcScreen;\n       HDC hdcWindow;\n       HDC hdcMemDC = NULL;\n       HBITMAP hbmScreen = NULL;\n       BITMAP bmpScreen;</p>\n\n<pre><code>  // Retrieve the handle to a display device context for the client \n  // area of the window. \n  hdcScreen = GetDC(NULL);\n  hdcWindow = GetDC(g_hWnd);\n\n  // Create a compatible DC which is used in a BitBlt from the window DC\n  hdcMemDC = CreateCompatibleDC(hdcWindow); \n   if(!hdcMemDC)\n   {\n   goto done;\n   }\n   RECT rcClient;\n   GetClientRect(g_hWnd, &amp;rcClient);\n   hbmScreen = CreateCompatibleBitmap(hdcWindow, rcClient.right-rcClient.left, rcClient.bottom-rcClient.top);\n   if(!hbmScreen)\n   {\n  goto done;\n   }\n\n   SelectObject(hdcMemDC,hbmScreen);\n\n   if(!BitBlt(hdcMemDC, \n            0,0, \n            rcClient.right-rcClient.left, rcClient.bottom-rcClient.top, \n            hdcWindow, \n            0,0,\n            SRCCOPY))\n  {\n goto done;\n  }\nGetObject(hbmScreen,sizeof(BITMAP),&amp;bmpScreen);\n\n  BITMAPFILEHEADER   bmfHeader;    \n  BITMAPINFOHEADER   bi;\n\n  bi.biSize = sizeof(BITMAPINFOHEADER);    \n  bi.biWidth = bmpScreen.bmWidth;    \n  bi.biHeight = bmpScreen.bmHeight;  \n  bi.biPlanes = 1;    \n  bi.biBitCount = 32;    \n  bi.biCompression = BI_RGB;    \n  bi.biSizeImage = 0;  \n  bi.biXPelsPerMeter = 0;    \n  bi.biYPelsPerMeter = 0;    \n  bi.biClrUsed = 0;    \n  bi.biClrImportant = 0;\n\n  DWORD dwBmpSize = ((bmpScreen.bmWidth * bi.biBitCount + 31) / 32) * 4 * bmpScreen.bmHeight;\n\n  // Starting with 32-bit Windows, GlobalAlloc and LocalAlloc are implemented as wrapper functions that \n  // call HeapAlloc using a handle to the process's default heap. Therefore, GlobalAlloc and LocalAlloc \n  // have greater overhead than HeapAlloc.\n  HANDLE hDIB = GlobalAlloc(GHND,dwBmpSize); \n  char *lpbitmap = (char *)GlobalLock(hDIB);    \n\n  // Gets the \"bits\" from the bitmap and copies them into a buffer \n  // which is pointed to by lpbitmap.\n  GetDIBits(hdcWindow, hbmScreen, 0,\n      (UINT)bmpScreen.bmHeight,\n      lpbitmap,\n     (BITMAPINFO *)&amp;bi, DIB_RGB_COLORS);\n\n  // A file is created, this is where we will save the screen capture.\n  HANDLE hFile = CreateFile(L\"c:\\\\tempo\\\\captureqwsx.bmp\",\n    GENERIC_WRITE,\n    0,\n    NULL,\n    CREATE_ALWAYS,\n    FILE_ATTRIBUTE_NORMAL, NULL);   \n\n// Add the size of the headers to the size of the bitmap to get the total file size\n   DWORD dwSizeofDIB = dwBmpSize + sizeof(BITMAPFILEHEADER) + sizeof(BITMAPINFOHEADER);\n\n//Offset to where the actual bitmap bits start.\n  bmfHeader.bfOffBits = (DWORD)sizeof(BITMAPFILEHEADER) + (DWORD)sizeof(BITMAPINFOHEADER); \n\n//Size of the file\n  bmfHeader.bfSize = dwSizeofDIB; \n\n//bfType must always be BM for Bitmaps\n  bmfHeader.bfType = 0x4D42; //BM   \n\n  DWORD dwBytesWritten = 0;\n  WriteFile(hFile, (LPSTR)&amp;bmfHeader, sizeof(BITMAPFILEHEADER), &amp;dwBytesWritten, NULL);\n  WriteFile(hFile, (LPSTR)&amp;bi, sizeof(BITMAPINFOHEADER), &amp;dwBytesWritten, NULL);\n  WriteFile(hFile, (LPSTR)lpbitmap, dwBmpSize, &amp;dwBytesWritten, NULL);\n\n  //Unlock and Free the DIB from the heap\n  GlobalUnlock(hDIB);    \n  GlobalFree(hDIB);\n\n  //Close the handle for the file that was created\n  CloseHandle(hFile);\n\n  //Clean up\ndone:\n  DeleteObject(hbmScreen);\n  DeleteObject(hdcMemDC);\n  ReleaseDC(NULL,hdcScreen);\n  ReleaseDC(g_hWnd,hdcWindow);\n\n}   \n</code></pre>\n"},{"tags":["c","windows","winapi","msdn","getdibits"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":11743060,"title":"GetDIBits() returns NULL","body":"<p>I am trying to capture the screen shots of a window using its handle, I do it recursively to store it as a video. I use <code>GetDIBits()</code> to get the bits from the bitmap obtained using <code>SelectObject()</code> &amp; <code>BitBlt()</code>. I am successful storing the video for 9987 frames, then <code>GetDIBits()</code> fails consistently after that (returns NULL). I have made sure to release all the memory, objects and DCs used. I am not sure what else am missing, kindly help me fix the issue.</p>\n"},{"tags":["c++","windows","image","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":217,"score":4,"question_id":11659962,"title":"What native API is recomended by Microsoft to render 2D graphics?","body":"<p>According to <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/hh309470%28v=vs.85%29.aspx\" rel=\"nofollow\">MSDN's listing</a>, GDI and GDI+ are both legacy. So when writing an application using the Windows API, what should you use to render 2d graphics?</p>\n\n<p>Direct2D, WIC, DirectComposition (this is new to me), GDI+, GDI?</p>\n\n<p>Note: not 2d games - just 2d images.</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":145,"score":3,"question_id":11737109,"title":"How can I delete a folder or file with path too long in recycle bin?","body":"<p>I have the program that deletes and copies some folders or files with long path (when lenght > MAX_PATH) In this program I use the prefix <code>\\\\?\\</code> that gives me the possibility delete folders or files with long path but only in simple function <code>Delete()</code>. I need to delete files in Recycle Bin and for this I need use the <code>SHFileOperation</code> function that gives me possibility delete files in the recycle bin, but this function does not support the prefix <code>\\\\?\\</code> . Can anybody help me with this issue? </p>\n\n<p>Is there some alternative for SHFileOperation. \nHow can I bypass this problem? </p>\n\n<p>Some links:</p>\n\n<ul>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/aa365247.aspx\" rel=\"nofollow\">Prefix</a> <code>\\\\?\\</code></li>\n<li>Some about <a href=\"http://blogs.msdn.com/b/bclteam/archive/2007/02/13/long-paths-in-net-part-1-of-3-kim-hamilton.aspx\" rel=\"nofollow\">Long Path</a></li>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/bb762164%28VS.85%29.aspx\" rel=\"nofollow\">SHFileOperation</a></li>\n</ul>\n"},{"tags":["c#","winapi","operating-system","usb"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":301,"score":2,"question_id":10534983,"title":"Remove USB using devcon.exe","body":"<p>Is it possible to remove a USB mass storage device by name using devon.exe? The following code is used to remove all devices:</p>\n\n<pre><code>Devcon remove usbstor\\*\n</code></pre>\n\n<p>but now I want to remove a particular device. For example, if 5 USBs are plugged in, <code>A</code>, <code>B</code>, <code>C</code>, <code>D</code>, <code>E</code> and <code>F</code>, I now want to remove only <code>B</code>. I know that instance id is used for this purpose but is it possible to remove using the device name? For example, like</p>\n\n<pre><code>Devcon remove usbstor\\B\n</code></pre>\n\n<p>I tried this but it doesn't work.</p>\n"},{"tags":["winapi","webdav","createfile","error-code"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":131,"score":0,"question_id":11688589,"title":"WinAPI CreateFileA error code 0xdf","body":"<p>I have a mapped Webdav Drive and i can't open file for reading using </p>\n\n<pre><code>CreateFileA(file_path, FILE_READ_DATA, FILE_SHARE_READ, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);\n</code></pre>\n\n<p>i am still getting error code 0xdf </p>\n\n<blockquote>\n  <p>ERROR_FILE_TOO_LARGE 223 (0xDF) The file size exceeds the limit\n  allowed and cannot be saved.</p>\n</blockquote>\n\n<p>but on diskdrive (NTFS) i can read it, but on mapped drive represents as (FAT) a i can just write file </p>\n\n<pre><code>CreateFileA(dest_file_path, FILE_WRITE_DATA, FILE_SHARE_READ, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);\n</code></pre>\n\n<p>it works</p>\n\n<p>but not reading not, when the file size exceed for example 70 MB</p>\n\n<p>my webdav is running on apache.</p>\n\n<p>can anyone help me?</p>\n"},{"tags":["windows","winapi","sdk","modem","ras"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":139,"score":0,"question_id":11738156,"title":"Dial-Up connection issues with PhoneBook/ .pbk file","body":"<p>Think that I have already created the Dial-up connection entries for each 3g USB modem (Vodafone , Verizon and my embedded Device).\nSo,the corresponding entries are well placed in pbk file.I am connecting Vodafone 3G USB device physically and when i dial from \"Netork Settings\",the dial-up connection is working fine and no changes in the pbk file.Same behavior for Verizon and my embedded device , only when the corresponding 3G USB device is connected with the laptop.</p>\n\n<p>Now, i am dialling and trying to establish the dial-up connection for the Vodafone without the 3G USB modem connected. At this time, the pbk is getting updated automatically. Verizon and My embedded device PBK parameters are changed like vodafone parameters as its a first entry in pbk file.</p>\n\n<p><a href=\"http://pastebin.com/8xJTmmt1\" rel=\"nofollow\">PBK After Creating a Dial-Up connection with my device</a></p>\n\n<p><a href=\"http://pastebin.com/zm00bRZ8\" rel=\"nofollow\">PBK After Automatically getting modified</a></p>\n\n<p>How does pbk file gets updated when i dial a Dial-Up connection without the associated device/modem?</p>\n"},{"tags":["winapi","folder","shader","direct3d","resource-files"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":11732906,"title":"Getting the project directory in Win32 for shader loading","body":"<p>I'm at the point now where I'm ready to dive into shaders, though I've been using a module based system as my means for learning how to do graphics programming (which I've written). </p>\n\n<p>Since I'm working with D3D, I'd like to just make a shaders directory in my project root, store shaders there, and access them quickly.</p>\n\n<p>There are obviously multiple ways to do this, but I don't have a very clear idea of obtaining my project's root directory. Is there a predefined macro for this - or a function of some sort for accessing a project's root folder?</p>\n"},{"tags":["c++","c","delphi","winapi","menuitem"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":209,"score":1,"question_id":11719322,"title":"Delphi XE - unable to delete an item from system menu","body":"<p>I have the following code, which is adding items to the system menu. My problem is that DeleteMenu(SysMenu, cLANGMENU, MF_BYCOMMAND) is not deleting the pop-up menu added to system menu. What I can not understand is why is working for the items (Scan components) added, but not for the 'Program Language'</p>\n\n<pre><code>procedure TForm1.Button1Click(Sender: TObject);\nconst aBaseItem : string = 'Programm-Sprache';\n      cSepSYSTEM_MENU = wm_user + 100;\n      cScanCompSystemMenu = wm_user + 101;\n      cLANGMENU = wm_user + 102;\n      SC_ITEM = $FF00;\nvar\n  MenuItemInfo: TMenuItemInfo;\n  PopupMenu: HMENU;\n  Result: Boolean;\n  SysMenu: HMenu;\n  iPos, NumItems : Integer;\n  wTemp1, wtemp2 : string;\n  Buffer: array[0..79] of Char;\nbegin\n  {Create the popup menu}\n  PopupMenu := CreatePopupMenu;\n  {Insert an item into it}\n  for iPos := 5 downto 0 do\n  begin\n    FillChar(MenuItemInfo, SizeOf(MenuItemInfo), iPos);\n      with MenuItemInfo do\n      begin\n        cbSize := SizeOf(MenuItemInfo);\n        fMask := MIIM_TYPE or MIIM_ID;\n        fType := MFT_STRING;\n        wID := SC_ITEM + iPos;\n        dwTypeData := PChar(inttostr(iPos));\n        cch := Length(dwTypeData) * 2 + 2; //4; {'Item' is 4 chars}\n      end;\n    Result := InsertMenuItem(PopupMenu, 0, True, MenuItemInfo);\n    Assert(Result, 'InsertMenuItem failed');\n  end;\n\n  SysMenu := GetSystemMenu(Handle, False);\n  //why this isn't working???\n  if not DeleteMenu(SysMenu, cLANGMENU, MF_BYCOMMAND) then\n   begin\n     ShowMessage('System Error Message: '+ SysErrorMessage(GetLastError)) ;\n     //error message is - operation completed succesfully\n   end;\n\n  {Insert the popup into the system menu}\n  FillChar(MenuItemInfo, SizeOf(MenuItemInfo), 0);\n  with MenuItemInfo do\n  begin\n    cbSize := SizeOf(MenuItemInfo);\n    fMask := MIIM_SUBMENU or MIIM_TYPE or MIIM_ID;\n    fType := MFT_STRING;\n    hSubMenu := PopupMenu;\n    wId := cLANGMENU;\n    dwTypeData :=  PChar('Test');//Before editing the question it was Program Language\n    cch := Length(dwTypeData) * 2 + 2; //7; {'SubMenu' is 7 chars}\n  end;\n\n  Assert(SysMenu &lt;&gt; 0);\n  Result := InsertMenuItem(SysMenu, GetMenuItemCount(SysMenu), True, MenuItemInfo);\n  Assert(Result, 'InsertMenuItem failed');\n\n\n      SysMenu := GetSystemMenu(Handle, False);\n  //delete menu if exists - this is working\n  DeleteMenu(SysMenu,cSepSYSTEM_MENU,MF_SEPARATOR);\n  DeleteMenu(SysMenu,cScanCompSystemMenu,MFT_STRING);\n  //add new ones\n  InsertMenu(SysMenu, Word(-1), MF_SEPARATOR, cSepSYSTEM_MENU, '');\n  FillChar(MenuItemInfo, SizeOf(TMenuItemInfo), #0);\n  with MenuItemInfo do\n   begin\n   cbSize := SizeOf(TMenuItemInfo);\n    fMask := MIIM_TYPE or MIIM_ID or MIIM_STATE;\n    fType := MFT_STRING;\n    wId := cScanCompSystemMenu;\n    dwTypeData := PChar('Scan components');\n    cch := Length('Scan components');\n   end;\n  Result := InsertMenuItem(SysMenu, GetMenuItemCount(SysMenu), True, MenuItemInfo);\n  Assert(Result, 'InsertMenuItem failed');\nend;\n</code></pre>\n\n<p>LE: This code is run several times, so I need to delete the items added each time.\nLE2: Even this code is wrote in Delphi(Object Pascal), it calls WinApi functions from Windows. Maybe someone who has worked intensive with this and is a C/C++ programmer could help.</p>\n"},{"tags":["winapi","assembly","x86"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":11699481,"title":"Pasue Console Application At End","body":"<p>I want to know how it is possible to pause a console application at end and by pressing enter, it ends in assembely. here is a peice of code which shows \"hello world\" on screen, but it will close immediatly. So how to pause program at end?</p>\n\n<pre><code>.386\n.model flat,stdcall\noption casemap:none\n\ninclude windows.inc\ninclude kernel32.inc\n\n.data\nsConsoleTitle  db \"Console Application\",0\nsWriteText  db \"Hello World\",0\n.code\n\nMain PROC\n    LOCAL hStdout :DWORD\n    invoke SetConsoleTitleA, offset sConsoleTitle\n\n    invoke GetStdHandle, STD_OUTPUT_HANDLE\n    mov hStdout,EAX\n\n    invoke WriteConsoleA, hStdout, offset sWriteText, 16d, 0, 0\n    invoke ExitProcess, 0\n\nMain ENDP\nend Main\n</code></pre>\n"},{"tags":["winapi","sdk","modem","ras"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":11737148,"title":"How To Set \"ShowDialingProgress\" in RAS Phonebook?","body":"<p>Is there a way to set the parameter <code>ShowDialingProgress=1</code> in my RAS phonebook at the time of creating a new entry in phonebook? This is my <a href=\"http://pastebin.com/5fXrCGvB\" rel=\"nofollow\">SAMPLE RAS PHONEBOOK</a> for your reference.</p>\n\n<p>Thanks...</p>\n"},{"tags":["c++","visual-studio","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":916,"score":5,"question_id":3109543,"title":"What to do to make application Large Address Aware?","body":"<p>I am currently in process of making our application Large Address Aware. As experience has shown, there are some unexpected gotchas when doing so. I create this post to make a complete list of steps which need to be taken.</p>\n\n<p>The development considerations listed in the <a href=\"http://www.amd.com/us-en/assets/content_type/DownloadableAssets/Expand_Memory_of_32-bit_App_-_Microsoft_4GT-_6204.pdf\" rel=\"nofollow\">AMD Large Address Aware guide</a> provide a good starting point, but are by no means complete:</p>\n\n<blockquote>\n  <p>The following considerations will help to make sure that the code can handle addresses larger than 2GB:</p>\n  \n  <ul>\n  <li>Avoid the use of signed pointer arithmetic (I.e. compares and adds)</li>\n  <li>Pointers use all 32-bits. Don’t use Bit31 for something else.</li>\n  <li>Some dll’s will be loaded just under the 2GB boundary. In this case, no consecutive memory can be allocated with VirtualAlloc().</li>\n  <li>Whenever possible, use GlobalMemoryStatusEx() (preferred) or GlobalMemoryStatus() to retrieve memory sizes.</li>\n  </ul>\n</blockquote>\n\n<p>Therefore, the question is: <strong>What is the complete list of things which need to be done when making C++ Win32 native application Large Address Aware?</strong></p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":97,"score":2,"question_id":11555045,"title":"How to obtain display devices information regardless of session?","body":"<p>I using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd162609%28v=vs.85%29.aspx\" rel=\"nofollow\">EnumDisplayDevices</a> that give me obtain information about the display devices in the current session.</p>\n\n<p>But i need information about the display devices regardless of session. Because i create some windows service application (System process).</p>\n\n<p>Does anybody know some alternative for this code:</p>\n\n<pre><code>vncDesktop::GetNrMonitors()\n{\n    if(OSversion()==3 || OSversion()==5) return 1;\n    int i;\n    int j=0;\n\n    helper::DynamicFn&lt;pEnumDisplayDevices&gt; pd(\"USER32\",\"EnumDisplayDevicesA\"); // it's EnumDisplayDevices function\n\n    if (pd.isValid())\n    {\n        DISPLAY_DEVICE dd;\n        ZeroMemory(&amp;dd, sizeof(dd));\n        dd.cb = sizeof(dd);\n        for (i=0; (*pd)(NULL, i, &amp;dd, 0); i++)\n            {\n                if (dd.StateFlags &amp; DISPLAY_DEVICE_ATTACHED_TO_DESKTOP)\n                    if (!(dd.StateFlags &amp; DISPLAY_DEVICE_MIRRORING_DRIVER))j++;\n            }\n    }\n    return j;\n}\n</code></pre>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c#",".net","winforms","winapi","listbox"],"answer_count":5,"favorite_count":4,"up_vote_count":7,"down_vote_count":0,"view_count":12660,"score":7,"question_id":192584,"title":"How can I set different Tooltip text for each item in a listbox?","body":"<p>I have a listbox that is databound to a Collection of objects.  The listbox is configured to display an identifier property of each object.  I would like to show a tooltip with information specific to the item within the listbox that is being hovered over rather than one tooltip for the listbox as a whole.</p>\n\n<p>I am working within WinForms and thanks to some helpful blog posts put together a pretty nice solution, which I wanted to share.</p>\n\n<p>I'd be interested in seeing if there's any other elegant solutions to this problem, or how this may be done in WPF.</p>\n"},{"tags":["windows","winapi","windows-vista"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2520,"score":3,"question_id":122367,"title":"Simulate Control-Alt-Delete key sequence in Vista and XP","body":"<p>Can I simulate in C#/C++ code Control-Alt-Delete sequence in Vista? \nWhen UAC enabled/disabled?\nHow it is done in XP?</p>\n\n<p>Can you provide a code sample that works in Vista?</p>\n"},{"tags":["winapi","visual-c++","mfc","gdi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":164,"score":0,"question_id":11734553,"title":"How are GDI objects selected and destroyed by SelectObject function","body":"<p>As I am new to Visual C++, this might be a very basic question related to selecting a GDI object.</p>\n\n<p>The following code snippet draws a light grey circle with no border.</p>\n\n<pre><code>cPen pen(PS_NULL, 0, (RGB(0,0,0)));\ndc.SelectObject(&amp; pen);\nCBrush brush (RGB (192,192,192));\ndc.SelectObject (&amp;brush);\ndc.Ellipse(0,0, 100,100);\n</code></pre>\n\n<p>All I understand from the code snippet is first an Object of Pen is created, and its a NULL Pen which would make the border disappear, the brush then creates a Circle of grey color, but how does <code>dc</code> use pen if it is already using brush? this is a bit confusing. </p>\n\n<p>How does using <code>dc.SelectObject()</code> twice help? If the solid brush object is used to create a circle with grey color, how does creating pen object help, if it is anyway destroyed as brush object is created? how exactly does this thing work?</p>\n"},{"tags":["winapi","directshow","rdp"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":98,"score":1,"question_id":11733883,"title":"Screenshot from an inactive to an RDP session","body":"<p>I need to do a screen capture using DirectShow from the RDP session, but the problem is that the seizure does not occur if the disconnect from the session. Is there any way to make a drawing of the session to continue even after you disconnect rdp session?</p>\n"},{"tags":["winapi","windows-8","winrt","face-detection"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":151,"score":0,"question_id":11732803,"title":"there is a face detection API for WinRT?","body":"<p>I see statements on the web about Windows 8 supporting face detection. Is this face detection or face recognition or both? (I don't care so much about recognition.) Is it in an API available inside a WinRT application and/or .Net? Where's the documentation for this API? (MSDN and Google both give me links to Windows Phone 7 stuff.)</p>\n"},{"tags":["c++","winapi"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":307,"score":1,"question_id":2638236,"title":"Could someone explain this interesting behaviour with Sleep(1)?","body":"<p>I was testing how long a various win32 API calls will wait for when asked to wait for 1ms. I tried:  </p>\n\n<p>::Sleep(1)<br>\n::WaitForSingleObject(handle, 1)<br>\n::GetQueuedCompletionStatus(handle, &amp;bytes, &amp;key, &amp;overlapped, 1)  </p>\n\n<p>I was detecting the elapsed time using QueryPerformanceCounter and QueryPerformanceFrequency. The elapsed time was about 15ms most of the time, which is expected and documented all over the Internet. However for short period of time the waits were taking about 2ms!!! It happen consistently for few minutes but now it is back to 15ms. I did not use timeBeginPeriod() and timeEndPeriod calls! Then I tried the same app on another machine and waits are constantly taking about 2ms! Both machines have Windows XP SP2 and hardware should be identical. Is there something that explains why wait times vary by so much? TIA</p>\n"},{"tags":["c++","winapi","executable"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":852,"score":2,"question_id":3355379,"title":"How do I find out if a .exe is running in c++?","body":"<p>How can you find out if an executable is running on Windows given the process name, e.g. program.exe?</p>\n"},{"tags":["c","winapi","windows-ce","msvcrt","crt"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":2511,"score":5,"question_id":3989545,"title":"How do I get the file HANDLE from the fopen FILE structure?","body":"<p>The <code><a href=\"http://msdn.microsoft.com/en-us/library/yeby3zcb.aspx\">fopen</a></code> function returns a pointer to a <code>FILE</code> structure, which should be considered an opaque value, without dealing with its content or meaning.</p>\n\n<p>On Windows, the C runtime is a wrapper of the Windows API, and the <code>fopen</code> function relies on the <code><a href=\"http://msdn.microsoft.com/en-us/library/aa363858%28VS.85%29.aspx\">CreateFile</a></code> function. The <code>CreateFile</code> function return a <code>HANDLE</code>, which is used by other Windows API.</p>\n\n<p>Now, I need to use Windows API deep inside of a library that uses <code>fopen</code> and <code>FILE*</code>. So: is there a way to get the <code>HANDLE</code> from the <code>FILE</code> structure? As this is compiler specific, I mean on the MSVC runtime library.</p>\n\n<p>I understand that this would be an ugly, non-portable hack, and that could broke if Microsoft changes the internal format of <code>FILE</code>... but I'm developing on a closed system (i.e. on a Windows CE embedded system) and refactoring the library would be difficult and time consuming.</p>\n"},{"tags":["c#","file","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":112,"score":3,"question_id":11706785,"title":"Lock file from being changed by no one except me?","body":"<p>I need to lock my password dictionary file, i want to lock file from being deleted and changed. </p>\n\n<p>How should i do it? In <code>C# WinApi</code> or any thing else?</p>\n"},{"tags":["c#","winforms","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":11728327,"title":"Send command to a process","body":"<p>I have this program that several users on the same computer is using (windows 2008 server environment with remote desktop clients).</p>\n\n<p>When the program is ended normally, it deletes a special file in its working directory.\nI need to be able to send all instances of this program a command to cleanly shut down (so that it deletes the file at exit).</p>\n\n<p>What would be the best way to do this, and how?\nI assume getting the pids for each instance is a start, but then what?\nAnyone have any good ideas?</p>\n\n<p>Edit: Forgot to mention, it's a WinForm (not a command line) program.</p>\n\n<p>Edit2: My comment was too long, so I guess it's best to just edit the question instead...</p>\n\n<p>The file it's deleting is actually a file containing it's pid.\nThe reason for having this file is to make sure that the user doesn't attempt to start the program twice with the same arguments (login information).</p>\n\n<p>The main program (control center) that is actually starting the client program is keeping track of the pidfile in the users directory.\nIf it discovers the file it reads the pid and tries to see if the pid exists.\nIf not, it actually does delete the file and is letting the user start the client window.</p>\n\n<p>I guess by using that procedure, I simply could make it look for all pids asociated with my application and simply kill them, ut I'd prefere to be able to send a shutdown command, as that would also notify the user in an IM that the program is shutting down for whatever the reason given. (Client initiated, remote server initiated, or, as in this case \"Local server initiated\").</p>\n"},{"tags":["windows","winapi","registry","detours"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":496,"score":2,"question_id":4895617,"title":"Detours alternative for Registry interception","body":"<p>I'm looking for a way to intercept and redirect reads to a certain registry keys. Naturally, Detours can do it. But I need it for a commercial application and MS $10K license fee is a bit too steep. Are there any alternatives ?</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":202,"score":0,"question_id":11724231,"title":"Win32 : set default font and text color for rich edit","body":"<p>It should be an easy question but I was unable to find an answer on google:\nHow to set a default font and color to a richedit using plain c++ and win32 ?</p>\n"},{"tags":["winapi","device-driver","windows-7-x64","administrator","printers"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":11729044,"title":"addmonitor win32 call fails with lasterror 5","body":"<p>I have created a very small win32 console application (AddPrintMonitor.exe) that does nothing more than makes a call to AddMonitor.  Here is a small snippet:</p>\n\n<pre><code>MONITOR_INFO_2 m_MonitorInfo2;\nm_MonitorInfo2.pName = lpMonitorName;\nTCHAR env[12] = TEXT(\"Windows x64\");\nm_MonitorInfo2.pEnvironment = env;\nm_MonitorInfo2.pDLLName     = lpDllName;\n\n\nif ( !AddMonitor(NULL, 2, (LPBYTE) &amp;m_MonitorInfo2) )\n{\n    DWORD error = GetLastError();\n    std::cout &lt;&lt; \"Last error = \" &lt;&lt; error &lt;&lt; \"\\n\";\n    return PRINTER_ERR_API;\n}\n</code></pre>\n\n<p>When I run this as a member of the Administrators group is fails.  GetLastError() returns 5.  When I run it as \"The Administrator\" it succeeds with no issues.  I am running on Windows 7 x64.  I am trying to install the redmonnt.dll and I do have the 64 bit version of that dll.  This task is part of a larger install for a PostScript driver.  I've only isolated out the AddMonitor portion to eliminate other external issues.</p>\n\n<p>Error 5 is an access violation or security issue.  My first question is why can't a member of the administrators group carry out this function call?  What's the difference between the actual administrator and a member of the administrators group given this context?</p>\n\n<p>Other details to note.  I am using InstallShield 12 (old) for my Printer installation (addmonitor is only part).  I am adding a monitor, port, driver and printer all through win32 function calls.   Prior to running my AddPrinterMonitor.exe I made sure that the redmonnt.dll does exist in the system32 directory.  Actually, whether the dll is present there or not makes no difference for the error I see.  I did see posts about setting SeLoadDriverPrivilege.  This is a dead end for me as I checked and the administrators group can Load/Unload device drivers.</p>\n\n<p>Also, I am using win32 calls to get this done.  This worked (I mean all of it worked) without any problems on Win2K, WinXP and Windows Server 2003.  With the newer OS's like Windows 7 there are several difficulties.  Is there a better way that I've overlooked?  I been very frustrated trying to get this to work, so I've begun to question the approach for Vista and higher.</p>\n\n<p>More initialization code:</p>\n\n<pre><code>#define MONITOR_NAME            \"My Redirected Port\"\n#define MONITOR_FILE            \"redmonnt.dll\"\n</code></pre>\n\n<p>MONITOR_NAME is passed to lpMonitorName and MONITOR_FILE is passed to lpDllName</p>\n\n<p>thanks</p>\n"},{"tags":["c#","wpf","windows","winapi","magnification"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":109,"score":1,"question_id":11725412,"title":"How can I create Magnifier Component in WPF By using Magnification API","body":"<p>I want to create a WPF component that host a Magnifier so i started with <a href=\"http://msdn.microsoft.com/en-us/library/ms742522.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms742522.aspx</a> </p>\n\n<p>here's some code <a href=\"http://pastebin.com/tRFYJ1be\" rel=\"nofollow\">http://pastebin.com/tRFYJ1be</a> </p>\n\n<p>And now i have error message: Failed BuildWindowCore when returning the child window handle hosted.</p>\n\n<p>How can i resolve this problem. if there's better solution i'm Here :) </p>\n\n<p>Thank You </p>\n"}]}
{"total":13828,"page":19,"pagesize":100,"questions":[{"tags":["windows","winapi","sdk","ras"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":196,"score":0,"question_id":11469514,"title":"Difference between RASPHONE.exe and RASDIAL.exe","body":"<p>I try to make a dial-up connection programatically. I tried with RASdial.exe and RASPhone.exe, Both does the same except RasDial.exe display the errors in console where as RasPhone.exe gives in user Interface. </p>\n\n<p>Can Someone explain me the difference between Rasdial and Rasphone and also which is right one to make a dial-up connection. And I want the error messages in User Interface and not in console.</p>\n\n<p>Please explain me in detail. </p>\n"},{"tags":["c++","cocoa","winapi","cursor","nscursor"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":11724050,"title":"Custom NSCursor disappearing after mouse movement","body":"<p>I'm building a cross-platform game in C++ and I've got an issue with the custom cursors. The problem I am having is that the default OS cursor replaces my custom cursors whenever I move the mouse. When the cursor is changed it comes up with the correct cursor until I move the mouse, at which point it changes. One thing I've noticed is that this happens quickly, but not always within one frame. I implement the custom cursors by first initialising an array of cursors like so:</p>\n\n<pre><code>m_defaultCursor = LoadCursor(NULL, IDC_ARROW);\n\nBWchar* cursors[CURSOR_COUNT] = \n{\n  \"standard\",\n  \"busy\",\n  \"menu_standard\"\n};        \n\nBWchar path[64];        \nfor (NEint i = 0; i &lt; CURSOR_COUNT; ++i)\n{\n  strSprintf(path, sizeof(path), \"path/to/cursors/%s.cursor\", cursors[i]);\n  m_cursors[i] = LoadCursorFromFile(path);\n  if (!m_cursors[i])\n  {                \n    printf(\"Could not load mouse cursor from %s. Using the system default one.\\n\", path);            \n  }\n}\n\nprintf(\"Cursors created\\n\");\n</code></pre>\n\n<p>The LoadCursor and LoadCursorFromFile functions are Windows functions, but I've implemented them on Mac and they work (i.e. they do load the correct cursors, and I can see them on the screen before I move the mouse). The game switches between these cursors by calling a C++ wrapper for the NSCursor class, which maintains a CursorReference (just a void pointer type) to determine which cursor to switch to. The Objective-C method for switching between cursors is as follows:</p>\n\n<pre><code>void SetCocoaCursor(CursorReference cursor)\n{\n  NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];\n  [(NSCursor *)cursor set];\n  [pool release];\n}\n</code></pre>\n\n<p>However, this method only seems to get called when I want to change the cursor: it doesn't get called at the times when the cursor changes back to the system cursor. Something must be going on behind the scenes, but I can't find any point in time where the result of [NSCursor currentCursor] is anything but what I expect. Does anyone know of a bug that tends to cause this on Mac?</p>\n\n<p>Sorry if I haven't provided everything pertinent - it's a big game and I've got no idea where this is going wrong. If anyone needs more info then I'll try and put it up.</p>\n"},{"tags":["c#",".net","winforms","winapi"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":118,"score":2,"question_id":11235189,"title":"SendMessage disappears into the ether","body":"<p>I'm attempting to pass messages between two applications - one of them is a plugin, and the other is a standalone configuration utility. When my plugin detects an event, I want to send a message to my utility and prompt the user to reconfigure.</p>\n\n<p>The code I'm using is as follows:</p>\n\n<pre><code>[DllImport(\"user32.dll\", CharSet = CharSet.Auto, SetLastError = true)]\nprivate static extern IntPtr SendMessage(IntPtr hwnd, uint Msg, IntPtr wParam, IntPtr lParam);\nprivate const int MESSAGE_UNAUTH = 0x401;\n\n[... misc logic here, function def, etc]\n\nProcess[] processes = Process.GetProcessesByName(\"MyConfigurationApplication\");\n\nif (processes.Length &gt; 0)\n{\n    foreach (Process p in processes)\n    {\n        SendMessage(p.MainWindowHandle, MESSAGE_UNAUTH, IntPtr.Zero, IntPtr.Zero);\n    }\n}\n</code></pre>\n\n<p>And then in my receiving process, I have the following code (I also defined MESSAGE_UNAUTH in this class):</p>\n\n<pre><code>protected override void WndProc(ref Message message)\n{\n    if (message.Msg == MESSAGE_UNAUTH)\n    {\n        MessageBox.Show(\"Message received\");\n    }\n    base.WndProc(ref message);\n}\n</code></pre>\n\n<p>Things I have already verified with the debugger:</p>\n\n<ol>\n<li>The message is getting sent. All the code in the Sender, including the SendMessage call, is executing.</li>\n<li>The message is not getting received (obviously).</li>\n<li>The WndProc() function is not getting called at all when the message is sent. It is, however, getting called a whole bunch of times when the configuration utility is launched (I'm assuming this is Windows' behavior).</li>\n</ol>\n\n<p>I've gone through enough online tutorials to need eyedrops, and as far as I know, everything here is syntax-correct and \"proper,\" but for some reason, between when I send the message and when the receiver's WndProc() should be called, black magic is happening.</p>\n\n<p>Any ideas would be greatly appreciated.</p>\n\n<hr>\n\n<p>Update: Using Marshal.GetLastWin32Error(), I am getting an error #1400, which appears to correspond to an invalid window handle. However, I don't see why that would be the case, since the process was found and we entered the for each loop successfully. The one caveat I can think of is that my configuration utility is presented as a taskbar icon, and doesn't necessarily have a visible window at all times - would this prevent p.MainWindowHandle from being valid? If so, how can I work around this to pass a message to the process instead of the window?</p>\n\n<hr>\n\n<p>Update: Process.MainWindowHandle is 0, so it looks like that is indeed the problem - when the form in my configuration utility is not visible, no valid window handler is returned, even though my utility icon is visible in the notification bar. Is there any way I can send a message to the process, or even to the taskbar icon?</p>\n"},{"tags":["c#","windows","winapi","com","scheduled-tasks"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":541,"score":1,"question_id":8592146,"title":"Changing run time of already scheduled tasks in windows task scheduler","body":"<p>I have problem with modifying tasks which already exists on machine. I'm trying to do this with generated interop interfaces from C# (Interop.TaskScheduler.dll generated from system32/taskschd.dll). </p>\n\n<p>To start with, <strong>I can't use other libraries like <a href=\"http://taskscheduler.codeplex.com/\" rel=\"nofollow\">http://taskscheduler.codeplex.com/</a></strong>.\nAlready tested and it works with library mentioned before. Now when I try do same with generated interfaces nothing changes. Basically what I'm doing:</p>\n\n<pre><code>string STR_DateTimeFormat = \"yyyy-MM-dd HH:mm:ss\";\nstring taskName = \"taskName\", \n       user = \"user\", \n       pass = \"pass\";\n\nDateTime nextRun = new DateTime.Now.AddDays(7);\n\nTaskSchedulerClass ts = new TaskSchedulerClass();\nts.Connect(null, null, null, null);\nIRegisteredTask task = ts.GetFolder(\"\\\\\").GetTask(String.Format(\"\\\\{0}\",taskName));\n\nforeach (ITrigger t in task.Definition.Triggers)\n    t.StartBoundary = nextRun.ToString(STR_DateTimeFormat.Replace(\" \", \"T\"));\n\nts.GetFolder(\"\\\\\").RegisterTaskDefinition(task.Path, \n                            task.Definition, \n                            (int)_TASK_CREATION.TASK_UPDATE, \n                            user, \n                            pass, \n                            _TASK_LOGON_TYPE.TASK_LOGON_PASSWORD, \n                            null);\n</code></pre>\n\n<p>For first look it should be working, but for some reason when I try to assign new datetime for run in line:</p>\n\n<pre><code>t.StartBoundary = nextRun.ToString(STR_DateTimeFormat.Replace(\" \", \"T\"));\n</code></pre>\n\n<p>It doesn't work. Actually in that foreach it's changed but when I tried to debug and created another foreach which prints value of StartBoundary it shows old value. Am I doing something incorrect? Is there any chance to get it working? :-) Thank you.</p>\n"},{"tags":["c#","winapi","enums"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":116,"score":3,"question_id":11722683,"title":"Exclamation mark in Keys enum","body":"<p>there is <code>Keys</code> enumeration in <code>.NET</code> <code>(System.Windows.Forms.Keys)</code>, but I can't find <code>Exclamation</code> mark(!) and colon(:), what about it? Or is there a way to automaticly transform letters to <code>Keys</code> enum, without <code>Enum.TryParse</code>? Thanks for help, FanAs.</p>\n"},{"tags":["c++","winapi","visual-c++","serial-port"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":410,"score":1,"question_id":11719093,"title":"Opening a virtual COM port with CSerial (C++)","body":"<p>I am using <a href=\"http://www.codeproject.com/Articles/992/Serial-library-for-C\" rel=\"nofollow\">Ramon de Klein's CSerial library</a> in order to open and manage a serial port from my C++ code.</p>\n\n<p>My hardware implements a serial tu USB converter with an FTDI chip, so I am able to connect the serial port to a USB plug in my CPU. Once FTDI drivers are installed, a virtual COM port is shown at 'Device Manager' (Windows).</p>\n\n<p>If I try to open it, it works.</p>\n\n<p>But now I have installed a USB to ethernet server like <a href=\"http://www.visionsystems.de/produkte/413.html\" rel=\"nofollow\">this one</a>. So I install its drivers and software, and after connecting some usb device to it, is is detected and also added as a virtual serial port to 'Device Manager' window.</p>\n\n<p>But when I try to open the port, it doesn't work. <strong>It does work if I open the port with an HyperTerminal-like application, just as if it was a normal serial port, but not in my code.</strong></p>\n\n<p>CSerial library works as if it were creating a new file, and given LastErrorCode is 2: \"File not found\". This is the Open method from the CSerial library:</p>\n\n<pre><code>LONG CSerial::Open (LPCTSTR lpszDevice, DWORD dwInQueue, DWORD dwOutQueue, bool fOverlapped)\n{\n    // Reset error state\n    m_lLastError = ERROR_SUCCESS;\n\n    // Check if the port isn't already opened\n    if (m_hFile)\n    {\n        m_lLastError = ERROR_ALREADY_INITIALIZED;\n        _RPTF0(_CRT_WARN,\"CSerial::Open - Port already opened\\n\");\n        return m_lLastError;\n    }\n\n    // Open the device\n    m_hFile = ::CreateFile(lpszDevice,\n                           GENERIC_READ|GENERIC_WRITE,\n                           0,\n                           0,\n                           OPEN_EXISTING,\n                           fOverlapped?FILE_FLAG_OVERLAPPED:0,\n                           0);\n    if (m_hFile == INVALID_HANDLE_VALUE)\n    {\n        // Reset file handle\n        m_hFile = 0;\n\n        // Display error\n        m_lLastError = ::GetLastError();\n        _RPTF0(_CRT_WARN, \"CSerial::Open - Unable to open port\\n\");\n        return m_lLastError;\n    }\n\n#ifndef SERIAL_NO_OVERLAPPED\n    // We cannot have an event handle yet\n    _ASSERTE(m_hevtOverlapped == 0);\n\n    // Create the event handle for internal overlapped operations (manual reset)\n    if (fOverlapped)\n    {\n        m_hevtOverlapped = ::CreateEvent(0,true,false,0);\n        if (m_hevtOverlapped == 0)\n        {\n            // Obtain the error information\n            m_lLastError = ::GetLastError();\n            _RPTF0(_CRT_WARN,\"CSerial::Open - Unable to create event\\n\");\n\n            // Close the port\n            ::CloseHandle(m_hFile);\n            m_hFile = 0;\n\n            // Return the error\n            return m_lLastError;\n        }\n    }\n#else\n\n    // Overlapped flag shouldn't be specified\n    _ASSERTE(!fOverlapped);\n\n#endif\n\n    // Setup the COM-port\n    if (dwInQueue || dwOutQueue)\n    {\n        // Make sure the queue-sizes are reasonable sized. Win9X systems crash\n        // if the input queue-size is zero. Both queues need to be at least\n        // 16 bytes large.\n        _ASSERTE(dwInQueue &gt;= 16);\n        _ASSERTE(dwOutQueue &gt;= 16);\n\n        if (!::SetupComm(m_hFile,dwInQueue,dwOutQueue))\n        {\n            // Display a warning\n            long lLastError = ::GetLastError();\n            _RPTF0(_CRT_WARN,\"CSerial::Open - Unable to setup the COM-port\\n\");\n\n            // Close the port\n            Close();\n\n            // Save last error from SetupComm\n            m_lLastError = lLastError;\n            return m_lLastError;    \n        }\n    }\n\n    // Setup the default communication mask\n    SetMask();\n\n    // Non-blocking reads is default\n    SetupReadTimeouts(EReadTimeoutNonblocking);\n\n    // Setup the device for default settings\n    COMMCONFIG commConfig = {0};\n    DWORD dwSize = sizeof(commConfig);\n    commConfig.dwSize = dwSize;\n    if (::GetDefaultCommConfig(lpszDevice,&amp;commConfig,&amp;dwSize))\n    {\n        // Set the default communication configuration\n        if (!::SetCommConfig(m_hFile,&amp;commConfig,dwSize))\n        {\n            // Display a warning\n            _RPTF0(_CRT_WARN,\"CSerial::Open - Unable to set default communication configuration.\\n\");\n        }\n    }\n    else\n    {\n        // Display a warning\n        _RPTF0(_CRT_WARN,\"CSerial::Open - Unable to obtain default communication configuration.\\n\");\n    }\n\n    // Return successful\n    return m_lLastError;\n}\n</code></pre>\n\n<p>I don't understand why it doesn't work in the same way as plugging the USB directly to the computer: I always thought that it should work if the COM is listed in 'Device Manager', independently from where it is really connected.</p>\n\n<p>On balance, the way data is comming from was:</p>\n\n<p><strong>RS232--->converted to USB--->USB CPU connector--->virtualized as RS232 in a COM port</strong></p>\n\n<p>And now is:</p>\n\n<p><strong>RS232--->converted to USB--->converted to ethernet by the \"netUSB server\"--->Ethernet/WiFi at the CPU--->virtualized as a USB device--->virtualized as RS232 in a COM port</strong></p>\n\n<p>Any help?</p>\n"},{"tags":["c++","winapi","win32gui"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":184,"score":0,"question_id":11688811,"title":"Win32 custom control with child controls","body":"<p>I've created a custom container control (owner drawn and more) which contains child controls.\nUnfortunately, these child controls are never updated (they do not receive WM_PAINT) </p>\n\n<p>Do you have any idea where can be the issue?\ncreation of window</p>\n\n<pre><code>    hwnd = CreateWindowEx(\n             WS_EX_CONTROLPARENT  , \n             _T(\"PopupControl\"),\n             _T(\"Popup Control\"),\n              WS_OVERLAPPED | WS_CLIPCHILDREN|WS_CLIPSIBLINGS,\n             100,100,420,220  ,\n             NULL,\n             NULL, GetModuleHandle(0), NULL\n           );\n</code></pre>\n\n<p>creation of child control</p>\n\n<pre><code>CreateWindowEx(0, L\"button\", TEXT(\"Type here\"),\nWS_CHILD | WS_VISIBLE | BS_PUSHBUTTON, \n200,15,100,20, \nhwnd, NULL, GetModuleHandle(0), NULL);\n</code></pre>\n\n<p>Thanks and regards,</p>\n"},{"tags":["c++","c","winapi","visual-c++","boost"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":11718915,"title":"Alternative api of strerror_r for windows OS","body":"<p>I see <a href=\"http://www.mkssoftware.com/docs/man3/strerror.3.asp\" rel=\"nofollow\">strerror_r</a>(...) api is no longer supported in visual C++ 2008, probably because of issue with thread safty. I want to use similar functionality in my program. \nIs there any other winapi which does the same thing as strerror_r(..)?</p>\n"},{"tags":["c++","c","winapi","visual-c++","icons"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":148,"score":1,"question_id":11285642,"title":"How do I draw an HICON?","body":"<p>I want to display an icon in the system tray.</p>\n\n<p>It seems like it should be so simple, but I can't figure out how to create an <code>HICON</code> and draw to it! All the \"compatible bitmaps\", \"compatible DCs\", etc. stuff are really confusing me.</p>\n\n<p>How do I draw an icon?</p>\n"},{"tags":["winapi","windows-vista"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1384,"score":2,"question_id":693858,"title":"How can I get the process filename under Vista?","body":"<p>I have an application that aids people with disabilities. In order to work, it tracks the what window is currently in the foreground. Normally, I use this function to get process executable. </p>\n\n<pre><code>bool GetWindowProcessExe2(HWND hwnd, wxString&amp; process_exe)  \n                       //LPTSTR buf, DWORD size)\n{\nDWORD result = 0;\nDWORD pid = 0;\nGetWindowThreadProcessId(hwnd, &amp;pid);\nif (HANDLE process =\n    OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid))\n{\n  char buff[512];\n  LPTSTR pbuff = buff;\n  result = GetModuleFileNameEx(process, 0, pbuff, 512);\n  if(result == 0)\n  {\n    //failed.\n    wxLogError(\"GetModuleFileNameEx failed with error code %d\", GetLastError());\n  }\n  CloseHandle(process);\n  process_exe = fromCString(pbuff);\n}\n\nreturn result &gt; 0 ? true : false;\n</code></pre>\n\n<p>}</p>\n\n<p>Unfortunately, if the foreground window is the Vista file manager window (the window that opens when you click Start->Computer), <code>GetModuleFileNameEx()</code> fails with error code 299 which says I don't have privileges for this action. My code works for any regular application but not for the windows built in window (the file explorer). I need to know when this window is forefront. Is there another way to do it? I tried reading the window title but that just returns the current directory being shown. Any ideas?</p>\n"},{"tags":["visual-studio","winapi","visual-c++","dll"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":95,"score":3,"question_id":11716350,"title":"Effects of switching between /SUBSYSTEM:CONSOLE to /SUBSYSTEM:WINDOWS in a DLL","body":"<p>I couldn't find anything useful on the MSDN for this case. Using <a href=\"http://www.dependencywalker.com/\" rel=\"nofollow\">Dependency Walker</a>, in the module list, I see a mixed usage of Console and GUI.</p>\n\n<p>Does this have an impact when compiling a DLL?</p>\n"},{"tags":["c++","c","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":270,"score":1,"question_id":6770177,"title":"Building my own LPARAM variable","body":"<p>I want to create my own LPARAM to pass to the win32 function GetKeyNameText(), (the first parameter takes a LPARAM var).</p>\n\n<p>This may seem like doing things the hard way, but its a work around for not having specific amounts of information &amp; also working at the bit level is REALLY confusing to me which is why I want to familiarise myself with this.</p>\n\n<p>So what I want to put in my LPARAM var is:\n- set the 16-23 bits to the keyboard Scan code: I've got the scan code I just dont know how I would combine it into a 32bit variable?\n- set the 24th bit to the extended-key flag (I have no idea how to get this yet alone how to combine it into a 32 bit variable)\n- set the 25th bit to the dont care bit to I do care - so would I set this bit to 1?</p>\n\n<p>So I understand the way binary &amp; bits work...I think, its amazing I understand higher lvl concepts like polymorphism but not lower lvl computer hardware stuff :P</p>\n\n<p>So I have a 32 bit(or byte?) variable, does that mean I have 32 0's &amp; 1's: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\nOR\nI have a variable like this XXXXXX, eg 100011(which is 35), where the last number is 2^0(so 1), then 2^1(2), then 2^2(4), .... then finally 2^5(32).</p>\n\n<p>So to create my LPARAM would I do this:</p>\n\n<pre><code>DWORD scanCode = 0x??;  // a DWORD is a 32bit var, but the scan code is only 7 bits long?\nbit   extFlag       = 1;        // now is there a bit variable? How can I find out the extended-key flag also?\nbit   careBit       = 1;       \n\n//Now to combine it all would I do this? \nDWORD myLParam = scanCode &amp; extFlag &amp; careBit;\n// OR\nLPARAM myLParam = scanCode &amp; extFlag &amp; careBit;\n</code></pre>\n"},{"tags":["c++","winapi","windows-7","drag-and-drop","taskbar"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":11715056,"title":"How to get a file path of a folder Shift-dragged onto a pinned icon in Windows 7 using C++/WinAPI","body":"<p>Say, if I pin my app on a taskbar in Windows 7 and then shift-drag a file into its icon (the mouse changes into \"Open with\" prompt) and then if I release the file, it is opened with my app -- the file path is provided in the command line for the app.</p>\n\n<p>What I can't seem to figure out is how to get it to work if I Shift-drag a folder? In this case my app is not called although the mouse shows \"Open with\" as well.</p>\n\n<p>PS. I'm coding using C++/MFC and WinAPIs.</p>\n"},{"tags":["windows","winapi","registry","windows-installer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":222,"score":0,"question_id":11696021,"title":"never ending \"you must restart your computer to apply these changes\" after install","body":"<p>I am working on a driver installer that after installing always leaves a message \"you must restart your computer to apply these changes\" with the options of \"restart now\" and \"restart later\".  I am thinking that this is caused by a registry value that doesn't get cleared but I don't know what value or what key would be causing this.  No matter how many time the computer is restarted the warning does not go away.  If any one out there can point me to right place in the registry it would be greatly appreciated. </p>\n"},{"tags":["c++","c","security","winapi"],"answer_count":1,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":635,"score":6,"question_id":10460693,"title":"Cannot implement password filter","body":"<p>I try to implement password filter, so I write a simple password filter.\nI followed the document in the MSDN, and make sure that the functions are declared correctly.\nI compile in VS 2010.</p>\n\n<hr>\n\n<h1>.def file:</h1>\n\n<pre class=\"lang-none prettyprint-override\"><code>LIBRARY myFilt\nEXPORTS\n   InitializeChangeNotify\n   PasswordFilter\n   PasswordChangeNotify\n</code></pre>\n\n<h1>.cpp file:</h1>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;ntsecapi.h&gt;\n\nvoid writeToLog(const char* szString)\n{\n    FILE* pFile = fopen(\"c:\\\\work\\\\logFile.txt\", \"a+\");\n    if (NULL == pFile)\n    {\n        return;\n    }\n    fprintf(pFile, \"%s\\r\\n\", szString);\n    fclose(pFile);\n    return;\n}\n\n// Default DllMain implementation\nBOOL APIENTRY DllMain( HANDLE hModule, \n                       DWORD  ul_reason_for_call, \n                       LPVOID lpReserved\n                     )\n{\n    OutputDebugString(L\"DllMain\");\n    switch (ul_reason_for_call)\n    {\n        case DLL_PROCESS_ATTACH:\n        case DLL_THREAD_ATTACH:\n        case DLL_THREAD_DETACH:\n        case DLL_PROCESS_DETACH:\n            break;\n    }\n    return TRUE;\n}\nBOOLEAN __stdcall InitializeChangeNotify(void)\n{\n    OutputDebugString(L\"InitializeChangeNotify\");\n    writeToLog(\"InitializeChangeNotify()\");\n    return TRUE;\n}\n\nBOOLEAN __stdcall PasswordFilter(\n  PUNICODE_STRING AccountName,\n  PUNICODE_STRING FullName,\n  PUNICODE_STRING Password,\n  BOOLEAN SetOperation\n)\n{\n    OutputDebugString(L\"PasswordFilter\");\n    return TRUE;\n}\n\nNTSTATUS __stdcall PasswordChangeNotify(\n  PUNICODE_STRING UserName,\n  ULONG RelativeId,\n  PUNICODE_STRING NewPassword\n)\n{\n    OutputDebugString(L\"PasswordChangeNotify\");\n    writeToLog(\"PasswordChangeNotify()\");\n    return 0;\n}\n</code></pre>\n\n<hr>\n\n<p>I put myFilt.dll in <code>%windir%\\system32</code>, add \"myFilt\" to \"Notification Packages\" in the registry, restart the computer, change the password, and nothing happens.</p>\n\n<p>I opened depends.exe and saw that the functions are correctly:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>InitializeChangeNotify\nPasswordChangeNotify\nPasswordFilter\n</code></pre>\n\n<p>Where is the mistake??</p>\n\n<p>Thanks.</p>\n"},{"tags":["c","winapi","tabs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":11711587,"title":"How to get TCITEM structure of a tab item?","body":"<p>I have created a tab control and some tab items on it. At some point, I have to reset the tab item text. Of course, I can always use the following to do this:</p>\n\n<pre><code>TCITEM tie;\ntie.mask = TCIF_TEXT | TCIF_IMAGE;\ntie.iImage = -1;\ntie.pszText = _T(\"Start Page\");\nSendMessage(panel-&gt;hwndTab, TCM_SETITEM, tabIndex, (LPARAM)&amp;tie);\n</code></pre>\n\n<p>But I wonder if we can get the TCITEM structure of a tab item, and we just reset the psztext member of this TCITEM? Can we get the TCITEM structure of a tab item by sending <code>TCM_GETITEM</code> message?</p>\n"},{"tags":["c++","windows","winapi","sleep"],"answer_count":15,"favorite_count":8,"up_vote_count":23,"down_vote_count":2,"view_count":23700,"score":21,"question_id":85122,"title":"Sleep Less Than One Millisecond","body":"<p>On windows you have a problem you typically never encounter on Unix. That is how to get a thread to sleep for less than one millisecond. On Unix you typically have a number of choices (sleep, usleep and nanosleep) to fit your needs. On windows however there is only <em>Sleep</em> with millisecond granularity. You can however use the select system call to create a microsecond sleep. On Unix this is pretty straight forward:</p>\n\n<pre><code>int usleep(long usec)\n{\n    struct timeval tv;\n    tv.tv_sec = usec/1000000L;\n    tv.tv_usec = usec%1000000L;\n    return select(0, 0, 0, 0, &amp;tv);\n}\n</code></pre>\n\n<p><hr /></p>\n\n<p>On windows however, the use of select forces you to include the winsock library which has to be initialized like this in your application:</p>\n\n<pre><code>WORD wVersionRequested = MAKEWORD(1,0);\nWSADATA wsaData;\nWSAStartup(wVersionRequested, &amp;wsaData);\n</code></pre>\n\n<p>And then the select won't allow you to be called without any socket so you have to do a little more to create a microsleep method:</p>\n\n<pre><code>int usleep(long usec)\n{\n    struct timeval tv;\n    fd_set dummy;\n    SOCKET s = socket(PF_INET, SOCK_STREAM, IPPROTO_TCP);\n    FD_ZERO(&amp;dummy);\n    FD_SET(s, &amp;dummy);\n    tv.tv_sec = usec/1000000L;\n    tv.tv_usec = usec%1000000L;\n    return select(0, 0, 0, &amp;dummy, &amp;tv);\n}\n</code></pre>\n\n<p>All these created usleep methods return zero when successful and non-zero for errors.</p>\n"},{"tags":["winapi","design","wrapper"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":274,"score":0,"question_id":4880800,"title":"Design problem in wrapping Windows's Window API","body":"<p>I'm writing an object-oriented window API wrapper for Windows in D, and I'm having a (non-language-specific) design problem.</p>\n\n<p>Windows requires that all windows be previously registered with <code>RegisterClass</code>; extending an existing class requires replacing the window procedure. Furthermore, there seem to be two kinds of window handles: <code>HWND</code>s that need to be disposed (via <code>DestroyWindow</code>), and <code>HWND</code>s that don't (e.g. from other applications).</p>\n\n<p>I have created a <code>Window</code> class, and so long as I'm just wrapping the <code>ShowWindow</code>, <code>UpdateWindow</code>, <code>FindWindow</code>, and other such methods, everything is fine and dandy. But as soon as I try to add a constructor with a <code>className</code> parameter to my class that calls <code>CreateWindow</code>, I run across a problem:</p>\n\n<ol>\n<li>The given <code>className</code> must already have been registered by <code>RegisterClass</code>.</li>\n<li>In order to register a new window class, I would need to make my subclasses of <code>Window</code> to somehow call <code>RegisterClass</code> before trying to create a new Window, either directly or indirectly.</li>\n<li>In order for my design (and inheritance) to make sense, i would need to make sure that, for any given subclass of <code>Window</code>, all instances are actually instances of the same window class; namely, that all <code>className</code>s from a particular subclass are identical. (This is because the window procedures for all instances of a particular window class need to be the same.)</li>\n</ol>\n\n<p>The problem is, there's no way to have an <code>abstract static</code> method (in order for Window to be able to ask the subclasses for their class info, and to register them once), and so I am forced to say something like <code>CreateWindow(this.className, ...)</code> in order to create a new window, which easily becomes problematic if my subclasses don't respect this rule, and give me a different class name per instance of the window.</p>\n\n<p>Furthermore, I need a one-to-one mapping between the <code>WNDCLASS.lpfnWndProc</code> field and my Window subclass's (overridden) <code>WndProc</code> method. This doesn't exactly work, though, if I'm forced to get the method pointer on a per-instance basis, since it breaks the entire OOP design and messes everything up.</p>\n\n<p>While it's possible for me to <em>enforce</em> this consistency at run-time, it's a bit ugly, and so it's not a great solution.</p>\n\n<p>So, long story short, does anyone have any idea of an elegant solution to the problem of creating an <code>abstract static</code> method? I'm thinking of some design patterns like Factory and whatnot, but I'm not sure if they fit here... if someone thinks they might , I would really appreciate a little explanation on how it would fit into the design.</p>\n\n<p>Thank you!</p>\n"},{"tags":["c","winapi","textbox","win32gui"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":118,"score":0,"question_id":11706769,"title":"How to add text to existing text in static control in win32","body":"<p>I am making a program in win32 c using visual studio rc and I can't figure out how to do this seemingly simple task. I have a static text control, an edit control, and a button. When the user clicks the button, I wan't the program to take the text in the edit control and add it to whatever is in the static text box. After much headache and various attempts, I still cannot get this to work. I can retrieve the text from the edit control fine, but any attempt to add it to the static control crashes. Well actually just to clarify, I can set the text fine; it's just adding to the existing text that crashes the program. Could someone please post some code that would allow me to do this using GetWindowText() and SetWindowText(), (or something else if it preferable). Here is what I have:</p>\n\n<pre><code>SendMessage(hwndEditControl, WM_GETTEXT,255,(LPARAM)editbuffer);\nGetWindowText(hwndTextControl, (LPWSTR)allText, GetWindowTextLength(hwndTextControl));\n//function to add data, please create on\nSetWindowText(hwndTextControl, (LPCWSTR)allText);}\n//where\nstatic TCHAR*       editbuffer = new TCHAR; //feel free to change these declarations\nstatic TCHAR*       allText    = new TCHAR;\n</code></pre>\n\n<p>Any help much appreciated! Thanks!</p>\n"},{"tags":["c++","winapi","directx-9"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":11707898,"title":"Parsing a Text File To Extract a String","body":"<p>I'm parsing a txt file in which I've placed Templates (GUID's) to help identify chunks of data...I'm having trouble parsing STRING variables in the file. While parsing I am using a DataPtr object which iterates by the size of the data type...The problem is that I am not able to calculate the size of a string correctly in order to(after reading the string) move on to the next data type. Here is an example file to be parsed:</p>\n\n<pre><code>xof 0303txt 0032\n\ntemplate Effect {\n  &lt;C7D92586-6C57-42d3-8F03-0BDF87EC1848&gt;\n  STRING filename;\n}\n\ntemplate Light {\n  &lt;ADA248C7-97E3-4a42-A4C1-74EE8536FF37&gt;\n  DWORD type;\n  array float position[3];\n  array float direction[3];\n  array float ambient[4];\n  array float diffuse[4];\n  array float specular[4];\n  float power;\n}\n\ntemplate Object {\n  &lt;B6494248-7D84-42d3-A4AA-0747E22E08D3&gt;\n  DWORD type;  \n  array float position[3];\n  array float orientation[4];\n  STRING name;\n  STRING filename;\n}\n\nEffect {\n    \".//Data/Scene/TrainingRoom/Effects/effect.fx\";\n}\n\nLight {\n    1;\n    -3.0; 1.0; -3.0;\n    3.0; -1.0; 3.0;\n    1.0; 1.0; 1.0; 1.0;\n    1.0; 0.0; 0.0; 0.0;\n    1.0; 1.0; 1.0; 1.0;\n    0.1;\n}\n\nObject {\n    1;\n    0.0; 0.0; 0.0;\n    0.0; 0.0; 0.0; 1.0;\n    \".//Data/Scene/TrainingRoom/TrainingRoom.x\";\n}\n</code></pre>\n\n<p>Here is an example of code which is currently working(w/o string tag):</p>\n\n<pre><code>if(CompareDataObjectType(pDataObj, TID_D3DRMLightCustom))\n    {\n        D3DXVECTOR3 *vecPtr = NULL;\n        D3DXVECTOR4 *colorPtr = NULL;\n        DWORD *DataPtr = (DWORD*)GetObjectData(pDataObj); // Data Pointer points at 1st data location\n        m_light.type = *DataPtr++;  \n        vecPtr = (D3DXVECTOR3*)DataPtr;\n        m_light.position = *vecPtr;\n        DataPtr+=3; \n        vecPtr = (D3DXVECTOR3*)DataPtr;\n        m_light.direction = *vecPtr;\n        DataPtr+=3;\n        colorPtr = (D3DXVECTOR4*)DataPtr;\n        m_light.ambient = *colorPtr;\n        DataPtr+=4;\n        colorPtr = (D3DXVECTOR4*)DataPtr;\n        m_light.diffuse = *colorPtr;\n        DataPtr+=4;\n        colorPtr = (D3DXVECTOR4*)DataPtr;\n        m_light.specular = *colorPtr;\n        DataPtr+=4;\n        float *fPtr = (float*)DataPtr;\n        m_light.power = *fPtr;\n        return true;\n    }\n</code></pre>\n\n<p>This is all okay...The following returns incorrect results:</p>\n\n<pre><code>if(CompareDataObjectType(pDataObj, TID_D3DRMObject))\n    {\n        D3DXVECTOR3 *vecPtr = NULL;\n        D3DXQUATERNION *quatPtr = NULL;\n        DWORD *DataPtr = (DWORD*)GetObjectData(pDataObj);       \n        m_object.type = *DataPtr++; \n        vecPtr = (D3DXVECTOR3*)DataPtr;\n        m_object.position = *vecPtr;\n        DataPtr+=3;     \n        quatPtr = (D3DXQUATERNION*)DataPtr;\n        m_object.orientation = *quatPtr;\n        DataPtr+=4;\n        m_object.name = (LPCSTR)DataPtr;\n        size_t length = strlen(m_object.name);\n        DataPtr+=length;\n        m_object.filename = (LPCSTR)DataPtr; // filename only contains a portion of the correct string...\n        return true;\n    }\n</code></pre>\n"},{"tags":["c++","windows","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":185,"score":2,"question_id":11706269,"title":"Why does GetSystemMetrics() return these values?","body":"<p>I am having some issues creating a client area of a set size. AdjustWindowRect() won't work properly so I decided to try manually calculating the width and height of the window.</p>\n\n<p>That didn't work either and I wondered why so I checked up the values I used to take in account the borders etc.</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;Windows.h&gt;\n\nint main(void)\n{\n    std::cout &lt;&lt; \"GetSystemMetrics(SM_CYEDGE) = \" &lt;&lt; GetSystemMetrics(SM_CYEDGE) &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"GetSystemMetrics(SM_CXEDGE) = \" &lt;&lt; GetSystemMetrics(SM_CXEDGE) &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"GetSystemMetrics(SM_CYBORDER) = \" &lt;&lt; GetSystemMetrics(SM_CYBORDER) &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"GetSystemMetrics(SM_CXBORDER) = \" &lt;&lt; GetSystemMetrics(SM_CXBORDER) &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"GetSystemMetrics(SM_CYCAPTION) = \" &lt;&lt; GetSystemMetrics(SM_CYCAPTION);\n\n    std::cin.get();\n}\n</code></pre>\n\n<p>This gives me:</p>\n\n<pre><code>GetSystemMetrics(SM_CYEDGE) = 2\nGetSystemMetrics(SM_CXEDGE) = 2\nGetSystemMetrics(SM_CYBORDER) = 1\nGetSystemMetrics(SM_CXBORDER) = 1\nGetSystemMetrics(SM_CYCAPTION) = 22\n</code></pre>\n\n<p>I am PRETTY sure that the borders of my window aren't that thin. What am I doing wrong?</p>\n\n<p><strong>EDIT 1:</strong> </p>\n\n<p>Initially my window used the WS_OVERLAPPED style. Since the AdjustWindowRect does not allow that style to be used alongside it I constructed the same type of window I wanted with: (WS_BORDER | WS_CAPTION | WS_SYSMENU). This is the same style I use during the call to AdjustWindowRect and AdjustWindowRectEx(this one with NULL as extended style since I do not use any). This gives me the correct width but the height is missing a few pixels.</p>\n\n<pre><code>RECT rect = { 0, 0, 800, 600};\n\nAdjustWindowRectEx( &amp;rect, (WS_BORDER | WS_CAPTION | WS_SYSMENU), FALSE, NULL);\n\nCreateWindowEx( ..., rect.right - rect.left, rect.bottom - rect.top, ...);\n</code></pre>\n\n<p>This gives me 800 pixels wide client-area but only 582 pixels in height.</p>\n\n<p><strong>EDIT 2:</strong></p>\n\n<p>CURIOUS, I used GetClientRect(); and it gave me that the width is 800 and the height IS 600. How come it doesn't display properly?</p>\n"},{"tags":["c++","winapi","windows-7"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":11705993,"title":"\"CWinApp::UpdatePrinterSelection\" is inaccessible","body":"<p><a href=\"http://support.microsoft.com/kb/166130\" rel=\"nofollow\">http://support.microsoft.com/kb/166130</a> outlines a way to change override some print settings in Windows 7.  It says the following:</p>\n\n<p>\"The DEVMODE data structure contains information about the device initialization and environment of a printer. Changing the Print Setup Dialog settings involves modifying this structure. The hDevMode structure that you need to modify is a CWinApp member variable. The function that initializes this variable is CWinApp::UpdatePrinterSelection. To set the initial page orientation to DMORIENT_LANDSCAPE, you'll need to override this function, clone the base class code and make a modification similar to the following:\"</p>\n\n<pre><code>   extern void AFXAPI AfxGlobalFree(HGLOBAL hGlobal); // 4.1 or later\n\n   void CMyApp::UpdatePrinterSelection(BOOL bForceDefaults)\n   {\n      if (!bForceDefaults &amp;&amp; m_hDevNames != NULL)\n      {\n         CWinApp::UpdatePrinterSelection(bForceDefaults);\n      }\n      else\n      {\n         // First time or Forced -- Get defaults\n         CPrintDialog pd(TRUE);\n         pd.GetDefaults();\n\n         if (m_hDevMode != NULL)\n            ::GlobalFree(m_hDevMode);\n            // AfxGlobalFree for 4.1 or later\n         if (m_hDevNames != NULL)\n            ::GlobalFree(m_hDevNames);\n            // AfxGlobalFree for 4.1 or later\n\n         m_hDevMode = pd.m_pd.hDevMode;\n         m_hDevNames = pd.m_pd.hDevNames;\n\n         // new code to set DMORIENT_LANDSCAPE\n         LPDEVMODE lp = (LPDEVMODE) ::GlobalLock(m_hDevMode);\n         ASSERT(lp);\n         lp-&gt;dmOrientation = DMORIENT_LANDSCAPE;\n         ::GlobalUnlock(m_hDevMode);\n      }\n   }\n</code></pre>\n\n<p>\"Unfortunately, this is not a virtual function, so you'll need to override all the functions in its call tree in the three cases below:\"</p>\n\n<pre><code>   (CMyApp::UpdatePrinterSelection)\n   CWinApp::GetPrinterDeviceDefaults\n     Non-virtual, copy from MFC src\n   CView::DoPreparePrinting (non-virtual)\n     Non-virtual, copy from MFC src, change CWinApp* to CMyApp* in code,\n     include \"docobj.h\"\n   CView::OnPreparePrinting\n     Virtual, must override anyway\n   CView::OnFilePrint\n     Use ClassWizard\n\n   (CMyApp::UpdatePrinterSelection)\n   CWinApp::DoPrintDialog\n     Non-virtual, copy from MFC src, include \"cderr.h\"\n   CView::DoPreparePrinting\n     Non-virtual, see above\n\n   (CMyApp::UpdatePrinterSelection)\n   CWinApp::DoPrintDialog\n     Non-virtual, see above\n   CWinApp::OnFilePrintSetup\n     Use ClassWizard\n</code></pre>\n\n<p>Well, when I try to use the above code in my DLL, the consecutive statements in the second block,</p>\n\n<pre><code> (CMyOwnDLL::UpdatePrinterSelection)\n CWinApp::GetPrinterDeviceDefaults\n</code></pre>\n\n<p>throw squiggly red lines underneath both \"UpdatePrinterSelection\" and \"CWinApp.\"  The first line of Debug says:     </p>\n\n<pre><code>\"IntelliSense: function \"CWinApp::UpdatePrinterSelection\" (declared at line 5553 of \"C:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\VC\\atlmfc\\include\\afxwin.h\") is inaccessible\"\n</code></pre>\n\n<p>I don't know what this means or how to fix it.  Thank you for any help.</p>\n"},{"tags":["c#",".net","c++","winforms","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":583,"score":1,"question_id":7001385,"title":"How to change background color of DateTimePicker control under Windows Vista / 7","body":"<p>My question is the same as the one at <a href=\"http://stackoverflow.com/questions/198532/changing-the-background-color-of-a-datetimepicker-in-net\">Changing the background color of a DateTimePicker in .NET</a>.  Unfortunately, the solution there doesn't work in Windows Vista/7 when visual styles are enabled.  It does work fine if I disable visual styles, but that isn't an acceptable solution for my application.</p>\n\n<p>How do I change the background color of a .NET WinForms DateTimePicker under Windows Vista / 7 when visual styles are enabled?</p>\n\n<p>Any answers written from a C++ / Windows API perspective are welcome as well; I am experienced enough to translate a solution from one platform to another.  I just ask it from a C# / WinForms perspective as there are a lot of developers who use it.</p>\n\n<p><strong>Edit:</strong> Also I should add that suggestions to owner-draw the entire control are at the very bottom of my possible list of solutions as it sounds like a ton of work. Existing efforts I've seen seem very incomplete.</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":11702882,"title":"Where should I start to learn dynamic linked library development?","body":"<p>I am trying to teach myself Excel addin development using C++ by reading \"Financial Applications Using Excel Add-in Development in C++.\" but I find it hard to understand. I am thinking I might not have enough prerequisite knowledge to learn these things. So I am writing this thread in the hope of getting some advice where to start.</p>\n\n<p>Here is an overview of my background in C++:<br>\nI am pretty comfortable with writing C/C++ consoles application using variables, loops, vectors, structures and classes. I have also taken a data structure and algorithm course in C++. But I don't really have much objected oriented and WIN32 programming experience. Maybe this is causing the troubles.</p>\n\n<p>My goal is to be able to understand the book \"Financial Applications Using Excel Add-in Development in C++\" and create my own excel addins to solve real world problem.\nCan anyone give me some guidance where to start to catch up these knowledge?</p>\n"},{"tags":["winapi","windows-shell"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":266,"score":1,"question_id":1045333,"title":"Why can't I find the #define for CSIDL_PROFILES?","body":"<p>I am trying to use <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb762181%28v=vs.85%29.aspx\" rel=\"nofollow\">ShGetFolderPath</a> to determine the path of the user profiles folder. The documentation states that CSIDL_PROFILES defines this folder:</p>\n\n<blockquote>\n  <p>CSIDL_PROFILES (0x003e)</p>\n</blockquote>\n\n<p>Version 6.0. The file system directory containing user profile folders. A typical path is C:\\Documents and Settings.</p>\n\n<p>I am using Visual Studio 2005 SP1, and I cannot locate the definition of the constant CSIDL_PROFILES in the Platform SDK include files? Do I need a new version of the Platform SDK?</p>\n\n<p>So I did some more experimenting by using the ID 0x3e in place of the symbol. However, it looks like 0x3e is not a valid argument to the shell functions that accept CSIDL_* arguments (an invalid argument error is returned).</p>\n\n<p>So I guess CSIDL_PROFILES is not a valid argument and the at least some of the MSDN pages on the subject are incorrect when they mention this symbol. I have to say in all my years of working with the Win32/MSDN documentation I can't remember a similar situation.</p>\n"},{"tags":["c","winapi","function","memory","pointers"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":93,"score":1,"question_id":11699768,"title":"pointer and which is pointed by the pointer","body":"<p>Update : Sorry, just a big mistake. It is meaningless to write <code>int *a = 3;</code> But please just think the analogy to the case like <code>TCHAR *a = TEXT(\"text\")</code>; (I edited my question, so some answers and comments are strange, since they are for my original question which is not suitable)</p>\n\n<p>In main function, suppose I have a pointer <code>TCHAR *a = TEXT(\"text\");</code> Then it excutes the following code:</p>\n\n<pre><code>int i;\nfor (i = 0; i &lt; 1000; i++) {\n        a = test(i);\n}\n</code></pre>\n\n<p>with the function <code>TCHAR* test(int par)</code> defined by:</p>\n\n<pre><code>TCHAR* test(int par)\n{\n    TCHAR *b = TEXT(\"aaa\");\n    return b;\n}\n</code></pre>\n\n<p>My question is, after executing the above code, but before the program ends, in the memory:</p>\n\n<pre><code>    1. the pointer `a` remains?\n    2. The 1000 pointers `b` are deleted each time the function test(...) exits ?\n    3. But there are still 1000 memory blocks there?\n</code></pre>\n\n<hr>\n\n<p>In fact, my question is motivated from the following code, which shows a tooltip when mouse is over a tab item in a tab control with the style TCS_TOOLTIPS:</p>\n\n<pre><code>case WM_NOTIFY\n    if (lpnmhdr-&gt;code == TTN_GETDISPINFO) {\n    LPNMTTDISPINFO lpnmtdi;\n    lpnmtdi = (LPNMTTDISPINFO)lParam;\n\n    int tabIndex = (int) wParam; // wParam is the index of the tab item.\n\n            lpnmtdi-&gt;lpszText = SetTabToolTipText(panel-&gt;gWin.At(tabIndex));\n            break;\n    }\n</code></pre>\n\n<p>I am thinking if the memory usage increases each time it calls </p>\n\n<p><code>SetTabToolTipText(panel-&gt;gWin.At(tabIndex))</code>, which manipulates with <code>TCHAR</code> and <code>TCHAR*</code> and return a value of type <code>LPTSTR</code>.</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1005,"score":2,"question_id":100304,"title":"Why does a call to BeginPaint() always generate a WM_NCPAINT message?","body":"<p>I'm facing a problem on the Win32 API. I have a program that, when it handles <code>WM_PAINT</code> messages, it calls <code>BeginPaint</code> to clip the region and validate the update region, but the <code>BeginPaint</code> function is always generating a <code>WM_NCPAINT</code> message with the same update region, even if the touched part that needs repainting is only inside the client region. </p>\n\n<p>Do anyone has any clue why this is happening? It's on child windows with the <code>WS_CHILD</code> style.</p>\n"},{"tags":["c++","windows","winapi","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":180,"score":0,"question_id":11693967,"title":"Not able to load Bitmap from resource","body":"<p>I'm having trouble to load a bitmap from resource. I have a project that I want to maintain.\nThe images are being loaded from files, but I want to load them from resource.</p>\n\n<p>So, the code below is working:</p>\n\n<pre><code>WCHAR path[MAX_PATH] = TEXT(\"C:\\\\nananana...\");\npBitmapClose = Bitmap::FromFile(path);\n</code></pre>\n\n<p>But, when I try to use from resource, it is not working. I have tried several parameters as bellow:</p>\n\n<pre><code>pBitmapClose = Bitmap::FromResource(g_hInstance, MAKEINTRESOURCE(IDB_BTN_CLOSE));\n</code></pre>\n\n<p>or</p>\n\n<pre><code>pBitmapClose = Bitmap::FromResource((HINSTANCE) GetModuleHandle(NULL), MAKEINTRESOURCE(IDB_BTN_CLOSE)); \n</code></pre>\n\n<p>Can anyone PLEASE help me?</p>\n"},{"tags":["c++","winapi","x86","x64","inject"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":211,"score":1,"question_id":11694664,"title":"inject x86 code into x64 process","body":"<p>I am working on an x86 dll injector and i want to inject x86 code into a x64 process thread and execute it. First I was failing with calling <em>CreateRemoteThread</em> on x64 process which led to error code 5. Then I've found <a href=\"https://dev.metasploit.com/redmine/projects/framework/repository/revisions/master/entry/external/source/meterpreter/source/common/arch/win/i386/base_inject.c\" rel=\"nofollow\">this trick</a> and I was able to create remote thread with it. But when I try to <em>ResumeThread</em> and execute that x86 code inside x64 process, whole process crash.</p>\n\n<p>Injecting x86 to x86 works well, problem is only with x86 to x64.</p>\n\n<p>So, my question is -- is it somehow possible to emulate and run x86 code copied inside x64 process? I know one way to do this would be to have two versions of the same code and choose one depending on the architecture of the remote process, but I don't find this as the best way to do this.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c++","c","winapi","buffer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":123,"score":0,"question_id":11695704,"title":"Using SetWindowText with the combination of two buffers","body":"<p>Alright so I have an edit control and a static text control. When the user clicks a button, I want the program to take the text from the edit control and add it to the text in the static text control and then set that new value as the text in the static control. So I have a function that appends the buffers to one another but my program doesn't seem to be working. This is what I have:</p>\n\n<pre><code>//when button message is recieved:\nSendMessage(hwndEditControl, WM_GETTEXT,255,(LPARAM)editbuffer);\nGetWindowText(hwndTextControl, (LPWSTR)allText, GetWindowTextLength(hwndTextControl));\nallText = appendStrings((char*)editbuffer, (char*)allText);\nSetWindowText(hwndTextControl, (LPCWSTR)allText);}\n\n // where appendStrings is defined as:\n\nchar* appendStrings (char* buffer1, char* buffer2)\n{\n    std::string string1(buffer1), string2(buffer2);\n    std::string string3 = string1 + string2; \n    return (char*)string3.c_str();\n}\n//and\nstatic char*        editbuffer = new char;\nstatic char*        allText    = new char; //these are defined as so\n</code></pre>\n\n<p>So anyway, when I push the button, I'm pretty sure that the appendStrings function is working because I think it takes what is in the editbox and adds it to the Text box. The reason I say \"i think\" though is because the string in the text box is always just jibberish. Its sometimes random symbols or just these \"l's\" (or what look like \"L\"s). I think it's a problem with my pointers but I'm not sure. I'm new to this so if there is an easier way, please tell me.</p>\n"},{"tags":["visual-studio-2008","winapi","visual-c++","windows-xp","windows-shell"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":371,"score":0,"question_id":9475285,"title":"how to refresh icon after change file association in XP?","body":"<p>I have tried to change file association of .htm file in XP, and here is how I did it:</p>\n\n<ol>\n<li>Change the associated registry key values. </li>\n<li>Call <code>SHChangeNotify(SHCNE_ASSOCCHANGED, SHCNF_IDLIST, 0, 0)</code> to refresh the icon.</li>\n</ol>\n\n<p>After doing these, I double clicking the .htm file, and it is opened by the browser I expected. But the icon on the desktop is not changed into the new one(e.g. from IE to Chrome).\nHowever, if I restart explorer.exe, the icon changed to the correct one.</p>\n\n<p>Can anyone please tell me how to refresh the icon on desktop after changing the file association ?</p>\n\n<p>Any replies from you will be appreciated, thanks. </p>\n"},{"tags":["winapi","video","directshow"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":127,"score":0,"question_id":11639822,"title":"AVI Decompressor suddenly stopped decoding video with DirectShow Graphedit","body":"<p>I have an issue with one of the applications utilizing an AVI Decompressor Filter. The error returns that there is no suitable decompresser that could be found... however it has worked everyday for the past several months. I thought about re-registering quartz.dll however no luck. </p>\n\n<p>I then cracked open Graphedit and found that I could load the filter into the graph but not connect anymore. </p>\n\n<p>Has anybody come across this scenario before? Any help would be greatly appreciated.</p>\n\n<p>Cheers.</p>\n\n<p><strong>EDIT</strong>\nIf the issue is in the registry, than would a simple system restore do the trick to put the registry back to the way it was. It is too late now to figure out the bug as it happened at a clients end and we had decided to recover windows to get them back up and going. But redundancy checks can be put into place such as automated restore points build into the application to rectify the issue if it ever occurs again. Does anybody think this would work?</p>\n"},{"tags":["windows","winapi","scroll","editcontrol"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":97,"score":1,"question_id":11692093,"title":"Programmatically scrolling a Windows edit control","body":"<p>Is there any way to programmatically scroll a single-line edit control in Windows?</p>\n\n<p>For example, if the text in an edit control is too large to display at once, then the default behavior when the edit control gets the focus is to select all text and show the end of the text.  I'd like to instead show the beginning of the text (while still leaving all text selected).</p>\n"},{"tags":["winapi","regions"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":11693113,"title":"WinApi: How to resize the window region on MouseMove event correctly?","body":"<p>My application is screenshot maker. User needs to select screen area to make a screenshot. I use Win32 API with PureBasic, but it doesn't matter, all is similar with C++. \nWhen user runs application, the semitransparent borderless form is shown on full screen to hook mouse over all other windows. On mouse down event selection is started and I apply XORed region to the form to cut a hole in it with size of current selection.</p>\n\n<p>I create and apply a new region on every <strong>mousemove</strong> event:</p>\n\n<pre><code>rgn1 = CreateRectRgn_(0,0,DWidth,DHeight) ; full size of desktop\nrgn2 = CreateRectRgn_(sx, sy, ex, ey) ; current selection points\nCombineRgn_(rgn1, rgn1, rgn2, #RGN_XOR)\nSetWindowRgn_(WindowID(0), rgn1, #True); apply region\n</code></pre>\n\n<p>It works well on my computer with Windows XP, but works buggy on other computer with Vista. I think it is wrong when I create the new region object on every mouse move. Maybe I need to create it once and then to resize? Can anybody explain how to do this right? Examples on C++ are ok.</p>\n"},{"tags":["windows","winapi","click","mouse"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":189,"score":1,"question_id":11689662,"title":"Simulate a Click without clicking","body":"<p>is it possible to simulate <code>Click</code> on a process without actually clicking on it? </p>\n\n<p>e.g. I wanna <code>Click</code> on a running Calculator with mouse stand still. is this possible?  </p>\n"},{"tags":["c#","windows","winapi","wmi"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":117,"score":3,"question_id":11689428,"title":"WMI deviceID version win API device ID","body":"<p>I was wondering how to convert a deviceID from WMI (e.g. select * from WIN32_PnPEntity where service='monitor') to a win API device ID (e.g calling EnumDisplayDevices). </p>\n\n<p>WMI gives a device id such as \"DISPLAY\\DELA008\\5&amp;2F6B978F&amp;0&amp;UID16777488\" whereas EnumDisplayDevices gives me a device id such as \"MONITOR\\DELA008{4d36e96e-e325-11ce-bfc1-08002be10318}\\0001\". How can I use the deviceID from WMI to call a win API function?</p>\n"},{"tags":["winapi","character-encoding"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":3524,"score":4,"question_id":909913,"title":"How can I programmatically determine the current default codepage of Windows?","body":"<p>I have to convert the encoding of a string output of a VB6 application to a specific encoding.</p>\n\n<p>The problem is, I don't know the encoding of the string, because of that:</p>\n\n<blockquote>\n  <p>According to the VB6 documentation when accessing certain API functions the internal Unicode strings are converted to ANSI strings using the <em>default codepage</em> of Windows.</p>\n</blockquote>\n\n<p>Because of that, the encoding of the string output can be different on different systems, but I have to know it to perform the conversion. </p>\n\n<p>How can I read the default codepage using the Win32 API or - if there's no other way - by reading the registry?</p>\n"},{"tags":["c++","winapi","resources"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":11687378,"title":"Defining control Id for windows resource compiler","body":"<p>Suppose I have a dialog box in windows defined by a rc file. I want to wrap the dialog interface into a C++ class</p>\n\n<pre><code>class MyDialog\n    {\n//...\n    };\n</code></pre>\n\n<p>also, the control id:s should be defined as integer constants belonging to that class</p>\n\n<pre><code>class MyDialog\n    {\n    private:\n        static const int MY_BUTTON=100;\n    };\n</code></pre>\n\n<p>The resource compiler would not understand MyDialog::MY_BUTTON but #define MyDialog_MY_BUTTON 100 (since the preprocessor is used)</p>\n\n<p>Is there a good way to use resource files without having all macors visible when not RC_INVOKED?</p>\n"},{"tags":["winapi","visual-c++","speech"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":11684789,"title":"isprecogrammar LoadDictionary not working in 64 bit","body":"<p>I have a problem using MS Speech SDK for 64bit. I am using MS Speech v11.0 64 bit SDK for one of my projects, when trying an API LoadDictionary of isprecogrammar class I found that the API is returning E_NOTIMPL. The 32 bit version works well. </p>\n\n<p>Please help me to solve the issue.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c++","winapi","console","window"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":11684185,"title":"how to create window in an application that started as console one?","body":"<p>I know the way window is created when the app is windowed one from the start, that is you call</p>\n\n<pre><code>LRESULT CALLBACK WindowProc(HWND hwnd, UINT msg, WPARAM wparam, LPARAM lparam);\nint WinMain(HINSTANCE hInst,HINSTANCE,LPSTR,int nCmdShow);\n</code></pre>\n\n<p>But what to do if I want to get user an option to display a console application output when it ends. That is display its data in more readable form in ad-hoc created window instead of text-only mode that console permits.</p>\n\n<p>In console app I have a function that watches for user key press, and when my program ends it shows message: <code>press D to display result in a window instead of console</code>, and in code:</p>\n\n<pre><code>if (virtual_key == 0x44) {\n  HWND myWindow = myCreateWindFunc(/* data */);\n}\n</code></pre>\n\n<p>That is I need to pack all the code for creating window into one function an then just call function on it with the data to fill it's controlls.</p>\n"},{"tags":["c++","gui","winapi"],"answer_count":14,"favorite_count":9,"up_vote_count":10,"down_vote_count":1,"view_count":13108,"score":9,"question_id":212559,"title":"C++ win32 GUI programming, the shortest path?","body":"<p>Do you know of a good means of learning C++ win32 (not .Net/MFC/ATL/Wx/Qt..) GUI programming ?\nA book, a tutorial, an existing project, preferably a hands-on approach with realistic example..\nI'm not a beginner, so I don't mind \"advanced\" starting points..</p>\n\n<p>With thanks.</p>\n"},{"tags":["c","windows","winapi","harddrive"],"answer_count":9,"favorite_count":8,"up_vote_count":17,"down_vote_count":0,"view_count":25623,"score":17,"question_id":327718,"title":"How to list physical disks?","body":"<p>How to list physical disks in windows?\nIn order to obtain a list of \"\\.\\PhysicalDrive0\" available.</p>\n"},{"tags":["windows","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":11682773,"title":"Win 32 program to verify a issuer whether it has issued from trusted root CA or not?","body":"<p>Win 32 program to verify a issuer whether it has issued from trusted root CA or not? Right now Iam using WinVerifyTrust API, Instead of that any other APIs are there?? Pls Help me out</p>\n"},{"tags":["winapi","explorer","autohotkey"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":142,"score":1,"question_id":11642112,"title":"Can't run explorer.exe properly","body":"<p>I play some older games that require ending the process <code>explorer.exe</code>. This is fine, except I want a way to start <code>explorer.exe</code> back up when I am done playing. I thought to use this:</p>\n\n<pre><code>^#e::\n    Run, explorer.exe\n    Return\n</code></pre>\n\n<p>The weird thing is that when I run this, it opens one window in the \"Libraries\". However, when I open the task manager and <code>Start new process --&gt; explorer.exe</code>, then everything comes back (desktop, taskbar, all of it).</p>\n\n<p>Why does autohotkey's <code>run, explorer.exe</code> not do the same thing? How can I make it start explorer.exe so I get everything back, like I did with the task manager?</p>\n\n<p>UPDATE: The solution is to put <code>%windir%\\explorer.exe</code>. This is my final code, and it works properly. </p>\n\n<pre><code>#e::\n    Run, %windir%\\explorer.exe\n    Return\n</code></pre>\n"},{"tags":["winapi","windows-7"],"answer_count":4,"favorite_count":1,"up_vote_count":7,"down_vote_count":1,"view_count":933,"score":6,"question_id":11439317,"title":"Disable Ctrl+Alt+Del on Windows 7","body":"<p>I know this question has been asked a few times and in a few different ways.  However, across all the questions and answers, no one has been able to answer completely given my situation...</p>\n\n<p>I work on medical devices and they run Windows.  The application runs as the shell, users shouldn't be able to get behind the application, and ideally they wouldn't be able to do anything that indicates that the system is running Windows.  Access to the full keyboard is necessary so disabling, damaging or remapping keys is not a solution.  Given that, we need to disable SAS/CAD/Ctrl+Alt+Delete in specific; some others too, but those are easy with hooks.</p>\n\n<p>Up until recently we've been using Windows XP Embedded and could replace GINA, but we're about to switch to Windows 7 (technically Windows Embedded Standard 7; but in our case they're essentially the same) and GINA is no longer an option.  There must be a way to do this.</p>\n\n<p>Since I've seen comments about this on other questions: I do believe this belongs on Stack Overflow.  Replacing GINA is a programming question and there's no reason to assume this won't be too.  While I'm open to a non-programming solution, I doubt MS would make this kind of change available in the registry, etc.</p>\n"},{"tags":["c#","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":235,"score":0,"question_id":11637208,"title":"simulating mouse click on the warcraft3 button using win api","body":"<p>I wonder if it possible to get handle of any button of the warcraft 3 game? Tried to get it via spy++ and Control Viewer but there only main WC3 window is availible.<br>\nSo any ideas or suggestions?  </p>\n\n<p>I'm trying to simulate click on the button. I think it is possible to do this using coordinates of the button, but i'm not sure if it possible to calculate such a coordinates for all the screen resolutions. If I mistaken somewhere - please, correct me!</p>\n\n<p>Thanks everybody in advance!</p>\n\n<p><em><strong>ADDITION</em></strong></p>\n\n<p>WIN API  </p>\n\n<pre><code>int x = 700;\nint y = 70;\nint lParam = ((x &lt;&lt; 16) | (y &amp; 0xffff));\nint parentWindow = FindWindow(\"Warcraft III\", \"Warcraft III\");\nSendMessage(parentWindow, WM_LBUTTONDOWN, IntPtr.Zero, new IntPtr(lParam));\nSendMessage(parentWindow, WM_LBUTTONUP, IntPtr.Zero, new IntPtr(lParam));  \n</code></pre>\n\n<p>Such a code will press any button which is stayed active after I left Warcraft 3 window.</p>\n\n<p>DIRECT INPUT</p>\n\n<pre><code>public void testMouse()\n        {\n            INPUT input_down = new INPUT();\n            input_down.mi.dx = 700;\n            input_down.mi.dy = 70;\n            input_down.mi.mouseData = 0;\n            input_down.mi.dwFlags = (int)MOUSEEVENTF.LEFTDOWN;\n\n            INPUT input_up = input_down;\n            input_up.mi.dwFlags = (int)MOUSEEVENTF.LEFTUP;\n\n            INPUT[] input = { input_down, input_up };\n            SendInput(2, input, Marshal.SizeOf(input_down));\n        }\n</code></pre>\n\n<p>such a code do nothing at all.</p>\n\n<p>Any help is greatly appreciated...</p>\n"},{"tags":["winapi","dll","printing","driver","inf"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":11674908,"title":"UpdateNow not set? (Language monitor problems)","body":"<p>I'm trying to figure out how to set up a printer language monitor without using WIN32 API's AddMonitor() (i.e. by editing the Registry or using an INF file), but I keep running into problems, and I'm not seeing any good examples of INF files for this purpose.</p>\n\n<p>For testing purposes, I edited ntprint.inf to point PJL_LANGUAGE_MONITOR to my DLL instead of pjlmon.dll, and changed the appropriate Registry keys to also do the same. Every time I try to reload the print spooler I can see that it seems to successfully load my language monitor, based on debug output, but when I print I keep getting debug messages that say \"UpdateNow not set\" with a PID of whatever editor I'm using.</p>\n\n<p>My question is, do you think this \"UpdateNow not set\" message is related to the problem, or is it just some inconsequential symptom?</p>\n"},{"tags":["c#","winapi","winamp"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":150,"score":0,"question_id":11651051,"title":"send mouse click to winamp","body":"<p>I'm trying to learn mouse/keyboard emulation using win api.<br>\nI found out that it is possible to emulate button click using sendmessage() function.</p>\n\n<p>Well, I get coordinates of \"play\" button (it is (60;100)) and trying to push this button using the following code:</p>\n\n<pre><code>            int x = 60;\n            int y = 100;\n            int lParam = ((x &lt;&lt; 16) | (y &amp; 0xffff));\n\n            int parentWindow = FindWindow(\"BaseWindow_RootWnd\", \"Main Window\");//get main winamp window\n            MessageBox.Show(parentWindow.ToString());//failed if 0\n\n            SendMessage(parentWindow, WM_LBUTTONDOWN, IntPtr.Zero, new IntPtr(lParam));//send left mouse button down\n            SendMessage(parentWindow, WM_LBUTTONUP, IntPtr.Zero, new IntPtr(lParam));//send left mouse button up\n</code></pre>\n\n<p>But this code has no effect on the winamp.  </p>\n\n<p>Can anybody point me on the mistakes i made? Any help is greatly appreciated!  </p>\n\n<p>p.s. It's not applicable for me to move mouse to the winamp play button, than do a click, than move it back.<br>\nAlso for winamp it is impossible to get button's handle. With button handle SendMessage() works fairly well, but with coordinates it doesn't at all.</p>\n\n<p><em><strong>ADDITION #1</em></strong>  </p>\n\n<p>Well, the code above activates winamp window and shows it, if it was minimized. But play button stil don't want to be pushed ;(  </p>\n\n<p><em><strong>ADDITION #2</em></strong>  </p>\n\n<p>Here are messages I get after I execute the code above.</p>\n\n<p><img src=\"http://i.stack.imgur.com/KXG2x.jpg\" alt=\"Messages in spy++\"></p>\n"},{"tags":["windows","winapi","mfc"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":11672606,"title":"MFC: Is it possible to modify the dialog style at run time? Pin","body":"<p>I have createed a dialog template resource, in the dialog editor I set the WS_POPUP property.</p>\n\n<p>It's fine to generate the modal dialog with the template resource.</p>\n\n<p>Here is my problem: I want to change it's style from WS_POPUP to WS_CHILD since I want to generate the dialog in the property page(CPropertySheet).</p>\n\n<p>I have tried many ways. Change the dialog in OnInitDialog,OnCreate,PreCreateWindow,PreSubclassWindow with ModifyStyle or SetWindowLong \ndoesn't work.</p>\n\n<p>Now I wonder whether it's possible to generate the dialog with the same resource and modify the style.</p>\n\n<p>Besides, the method list in <a href=\"http://www.codeproject.com/Articles/13133/Modifying-a-modal-dialog-s-style-and-position-at-r\" rel=\"nofollow\">http://www.codeproject.com/Articles/13133/Modifying-a-modal-dialog-s-style-and-position-at-r</a> doesn't work either.</p>\n\n<p>Any help will be appreciate!</p>\n"},{"tags":["python","winapi","memory","windows-7","64bit"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":108,"score":1,"question_id":11669335,"title":"How to get PrivateUsage memory value from python on win7x64","body":"<p>I use the following code which works well on WinXPx32, but returns 0 on Win7x64.\nI know the psutil library will also return it, but I need something that can run without extra dependencies, ctypes and win32api is fine. I've also tried Kernel32.K32GetProcessMemoryInfo with the same result.</p>\n\n<pre><code>import ctypes\n\npsapi = ctypes.windll.psapi\nKernel32 = ctypes.windll.Kernel32\n\nclass PROCESS_MEMORY_COUNTERS_EX(ctypes.Structure):\n    _fields_ = [(\"cb\", ctypes.c_ulong),\n                (\"PageFaultCount\", ctypes.c_ulong),\n                (\"PeakWorkingSetSize\", ctypes.c_size_t),\n                (\"WorkingSetSize\", ctypes.c_size_t),\n                (\"QuotaPeakPagedPoolUsage\", ctypes.c_size_t),\n                (\"QuotaPagedPoolUsage\", ctypes.c_size_t),\n                (\"QuotaPeakNonPagedPoolUsage\", ctypes.c_size_t),\n                (\"QuotaNonPagedPoolUsage\", ctypes.c_size_t),\n                (\"PagefileUsage\", ctypes.c_size_t),\n                (\"PeakPagefileUsage\", ctypes.c_size_t),\n                (\"PrivateUsage\", ctypes.c_size_t),\n                ]\n\ndef GetProcessPrivateUsage():\n    mem_struct = PROCESS_MEMORY_COUNTERS_EX()\n    p_handle = Kernel32.GetCurrentProcess()\n    b = psapi.GetProcessMemoryInfo(p_handle, ctypes.byref(mem_struct), ctypes.sizeof(mem_struct))\n    print(b)\n    return mem_struct.PrivateUsage\n\nprint(GetProcessPrivateUsage())\n</code></pre>\n"},{"tags":["c++","file","winapi","message"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":89,"score":-1,"question_id":11670836,"title":"open a file in c++ from desktop using winapi","body":"<p>I've made a program that can edit and open .BMP files, but you can only open these files from within the program.</p>\n\n<p>if i open the file with the program by clicking on the file and selecting my own program, it just opens my program and does nothing.</p>\n\n<p>how do I open a file in this way, or which message do I have to process.</p>\n"},{"tags":["c#",".net","winapi","window","wndproc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":82,"score":-1,"question_id":11670009,"title":"How to do \"something\" when a window that is on background sends a specific message","body":"<p>im trying to do something on an app, that I know its name etc...(so I'm alredy casting findwindow and stuff) \nFor ex. I want to notify user when that window tries to gain focus.</p>\n\n<p>I have mess around with wndproc yet I seem to not get it at all.\nfor ex. here is a code I found on stackoverflow and failed even executing it</p>\n\n<pre><code>    public IntPtr WndProc(int hwnd, int msg, IntPtr wParam, IntPtr lParam)\n    {\n\n        if (msg == WM_NCACTIVATE)\n        {\n            SystemSounds.Beep.Play();\n            SystemSounds.Beep.Play();\n            SystemSounds.Beep.Play();\n            SystemSounds.Beep.Play();\n            SystemSounds.Beep.Play();\n        }\n\n        return IntPtr.Zero;\n    }\n</code></pre>\n\n<p>now the thing I dont understand is, there is int msg that I think stands for message. arent wndproc is the one that supposed to get it ? what is the point of giving it to wndproc ? </p>\n\n<p>Second, executing this function. What do I do, check for message every 100 ms or are there event-type thing for it ?</p>\n\n<p>Im really confused here and I'd appreciate little help here.</p>\n"},{"tags":["winapi","mfc","menu","menuitem","multicolumn"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":75,"score":2,"question_id":11669681,"title":"How can I create a menu in MFC that has a line with 2 items?","body":"<p>I did some experiments with <code>MF_MENUBARBREAK</code>, but with this I can only achieve two columns at the top-most level of the menu.</p>\n\n<p>What I want is a menu like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/zNJ9H.png\" alt=\"\"></p>\n\n<p>It is not the full menu that I want to have two columns, but have two menu (Left and Right) items in the first line. Every other entry will ocupy its own entire line. Is that possible?</p>\n"},{"tags":["winapi","visual-c++","media","directshow","ms-media-foundation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":11668064,"title":"Getting the error \"The owner SID on a per-user subscription doesn't exist \" when the MediaFoundation API ProcessMessage() returns back to the caller.","body":"<p>I am using VC++, VS2008. \nI get the error \"The owner SID on a per-user subscription doesn't exist \".</p>\n\n<blockquote>\n  <p>ProcessMessage() (IMFTransform) returns with a success status &amp; if I\n  see the call stack, the ProcessMessage() goes inside some Microsoft\n  DLLs (like evr.dll etc...) and finally returns the error msg \"The\n  owner SID on a per-user subscription doesn't exist \".</p>\n</blockquote>\n\n<p>Can anyone kindly let me know why do we get this error? And if possible how to fix it. \nAny pointers are also appreciated.  Thank u very much. </p>\n"},{"tags":["delphi","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":111,"score":3,"question_id":11554328,"title":"What causes \"Bad Process ID\"?","body":"<p>Three of about seven .exe's in a collection of Delphi apps are failing on just one customer's 64-bit Win7 machine.</p>\n\n<p>The message is:</p>\n\n<blockquote>\n  <p>Exception Exception in module ProgName.exe at 002f2baf<br>\n  Bad Process ID</p>\n</blockquote>\n\n<p>The address is the same in two apps, and 002bd3f in the third.</p>\n\n<p>This is a standalone app, running  Paradox/BDE, which in spite of its age and our need to migrate, continues run our app on many, many machines in the field.</p>\n\n<p>We don't do any threading.</p>\n\n<p>Googling the message \"Bad Process ID\" has turned up nothing that looks relevant.</p>\n\n<p>Any suggestions on what this message is about?</p>\n"},{"tags":["c++","winapi","dialog","move"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":136,"score":0,"question_id":11667264,"title":"Move buttons on a Dialog Box while it resizes","body":"<p>I have created a Dialog Box in a c++ windows application (using ATL lib) and I have set on it three buttons. The button lie as usual at the bottom of the Dialog Box. I want by the resize of the Dialog Box, the button to retain their position at the bottom of it. In other words, they should keep a constant (low) distance from the bottom margin and the on side (right or left) of the Dialog Box. To bring this into effect, I try to move the buttons accordingly while the Dialog Box size is changed. I use the following code (as example only with the OK button), but the only result is the button to disappear during the resize. How should I modify the code in order for the button to retain its distance from the bottom and the right side of the Dialog Box?</p>\n\n<pre><code>LRESULT RenameFolderDlg::OnSize(UINT uMsg, WPARAM wParam, LPARAM lParam, BOOL&amp; bHandled)\n{\nRECT r;\nGetWindowRect(&amp;r);\n\nCWindow okB(GetDlgItem(IDOK));\nRECT okR;\nokB.GetWindowRect(&amp;okR);\n\nokB.MoveWindow( r.right - 80 , r.bottom - 40, okR.right - okR.left, okR.bottom -     okR.top, 1);\n\nreturn 0;\n}\n</code></pre>\n"},{"tags":["c++","winapi","windows-7","64bit","semaphore"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":110,"score":1,"question_id":11668578,"title":"Why does OpenSemaphore always return zero in 64-bit Windows 7 when CreateSemaphore works?","body":"<p>I ported my appliction from Windows 7 32-bit to Windows 7 64-bit. I find that the API function <code>OpenSemaphore</code> is always returning zero. This call works well in 32-bit Windows, but not in 64-bit Windows. </p>\n\n<p>When I call <code>GetLastError()</code>, it returns 2. </p>\n\n<p>Also I replaced my <code>OpenSemaphore</code> with the <code>CreateSemaphore</code> function and my application works fine, but I am still confused about why the <code>OpenSemaphore</code> function is failing in 64-bit code.</p>\n\n<p>Can anyone who knows something about this issue please clarify?</p>\n"},{"tags":["c#",".net","winapi","selenium","guid"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":523,"score":5,"question_id":11526260,"title":"Get Window handle (IntPtr) from Selenium webdriver's current window GUID","body":"<p>I'm trying to capture a screenshot of whole browser screen (e.g. with any toolbars, panels and so on) not only an entire page, so I'm got this code:</p>\n\n<pre><code>using (FirefoxDriver driver = new FirefoxDriver())\n{ \n    driver.Navigate().GoToUrl(url);                \n\n    ScreenCapture sc = new ScreenCapture();\n\n    // How can I find natural IntPtr handle of window here, using GUID-like identifier returning by driver.currentWindowHandle?\n    Image img = sc.CaptureWindow(...);\n    MemoryStream ms = new MemoryStream();\n    img.Save(ms, ImageFormat.Jpeg);\n    return new FileStreamResult(ms, \"image/jpeg\");\n}\n</code></pre>\n"},{"tags":["winapi","event-log"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":11655871,"title":"How to map Windows Event Log Event level to a string","body":"<p>Windows event logs are different at below Vista (XP and below) and Vista and up, see here <a href=\"http://msdn.microsoft.com/en-us/library/aa363652.aspx\" rel=\"nofollow\">Windows Event Logs</a> . On Vista and up, on the event viewer, we could see a column called Level. If we filter the event, it would show us all the possible levels:</p>\n\n<pre><code>Critical\nWarning\nVerbose\nError\nInformation\n</code></pre>\n\n<p>The value of Information has value 4 based on my testing. However if we look at the <a href=\"http://msdn.microsoft.com/en-us/library/aa384796%28v=vs.85%29\" rel=\"nofollow\">schema for Level</a>, actually the range of its values are not restricted.  So here are two of my questions:</p>\n\n<ul>\n<li>how do I know what value each of above string would have? Is there a page at MSDN for this? I could not find it</li>\n<li>Is there any restriction for the Level or not? Or is it up to the Event provider itself?</li>\n</ul>\n"},{"tags":["c++","visual-studio","winapi","mfc","cdialog"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":176,"score":0,"question_id":11247498,"title":"MFC CDialog not showing","body":"<p>here is my problem :\nIn my Solution, I have 2 projects, one is a lib in which I created a ressource file (mylib.rc) and a dialog template in it. Then I made a class which inherits  CDialog and uses this template. But when I instantiate it and call DoModal(), nothing appends...</p>\n\n<p>here the code of my class, is something wrong with it ?</p>\n\n<h2>MyDialog.h</h2>\n\n<pre><code>/*MyDialog.h*/\n#pragma once\n#include \"../../../resource.h\"\n\nclass MyDialog : public CDialog\n{\n    enum {IDD=IDD_DLGTEMPLATE};\npublic:\n    MyDialog(CWnd* pParent = NULL);  \n    virtual ~MyDialog();\n\nprotected:\n    virtual BOOL OnInitDialog();\n\n    DECLARE_MESSAGE_MAP()\nprivate:\n    afx_msg void OnBnClickedOk();\n    afx_msg void OnBnClickedCancel();\n};\n</code></pre>\n\n<h2>MyDialog.cpp</h2>\n\n<pre><code>/*MyDialog.cpp*/\n#include \"stdafx.h\"\n#include \"MyDialog.h\"\n\nMyDialog::MyDialog(CWnd* pParent /*=NULL*/) : CDialog(IDD_DLGTEMPLATE, pParent) {}\nMyDialog::~MyDialog() {}\n\nBOOL MyDialog::OnInitDialog() { return TRUE; }\n\nBEGIN_MESSAGE_MAP(MyDialog, CDialog)\n    ON_BN_CLICKED(IDOK, &amp;MyDialog::OnBnClickedOk)\n    ON_BN_CLICKED(IDCANCEL, &amp;MyDialog::OnBnClickedCancel)\nEND_MESSAGE_MAP()\n\nvoid MyDialog::OnBnClickedOk() { OnOK(); }\nvoid MyDialog::OnBnClickedCancel() { OnCancel(); }\n</code></pre>\n"},{"tags":["winapi","visual-c++","filesystems"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":11641339,"title":"SetFilePointer - Setting the pointer to 0 causes a pseudo app hang","body":"<p>My current code is:</p>\n\n<pre><code>    unsigned long glink(unsigned long loclptr){\n    unsigned long ret;\n    SetFilePointer(file, loclptr, 0, FILE_BEGIN);\n    ReadFile(file, (char*)&amp;ret, sizeof(unsigned long), &amp;cache, 0);\n    return ret;\n}\n</code></pre>\n\n<p>When <code>loclptr = 0</code>, it causes an app hang. Does anyone know any alternative ways to set the <code>filepointer</code> to <code>0</code>?</p>\n\n<p>I've used <code>SetFilePointer(file, -SetFilePointer(file, 0, 0, FILE_CURRENT), 0, FILE_END);</code> but I'm not wanting to rely upon that... thanks in advance, iDomo - NOMNOMNOM</p>\n"},{"tags":["c++","visual-studio-2010","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":123,"score":7,"question_id":11656564,"title":"Win32 how big custom resource can be?","body":"<p>Trying to create something similar to SFX (self extract installer), I was including the setup files in one exe using custom resource in visual c++.  When the size of the setup files reached over ~900 MB, the linker cannot generate an exe with the resources embedded.  Strange thing is that the linker does generate an exe without any warnings.  The exe generated is an statically linked MFC App (main app of the exectuable).  However, non of the resource is included.  I have watched the exe size during the linking from a console.  It was showing 900 MB for awhile befored dropped to the 2MB exe in the end.  If I removed some of the files (say total size will be 500MB), the exe is generated all OK with all the resources embedded.  Is there a pratical size limit for the custom resource?  Note that the final size of the executable is about 1GB which is way less that 2GB win32 app can address.  So I am wondering is this a vc++ 2010 bug or feature?  BTW, I also used /expectedoutputsize trick.  But it does not help except the linking is much faster with a bigger expected output size.</p>\n"},{"tags":["c++","winapi","utf-8","character-encoding"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":354,"score":4,"question_id":11646368,"title":"How to set file encoding format to UTF8 in C++","body":"<p>A requirement for my software is that the encoding of a file which contains exported data shall be UTF8. But when I write the data to the file the encoding is always ANSI. (I use Notepad++ to check this.)</p>\n\n<p>What I'm currently doing is trying to convert the file manually by reading it, converting it to UTF8 and writing the text to a new file.</p>\n\n<p><code>line</code> is a <code>std::string</code><br>\n<code>inputFile</code> is an <code>std::ifstream</code><br>\n<code>pOutputFile</code> is a <code>FILE*</code>  </p>\n\n<pre><code>// ...\n\nif( inputFile.is_open() )\n{\n    while( inputFile.good() )\n    {\n        getline(inputFile,line);\n\n        //1\n        DWORD dwCount = MultiByteToWideChar( CP_ACP, 0, line.c_str(), -1, NULL, 0 );\n        wchar_t *pwcharText;\n        pwcharText = new wchar_t[ dwCount];\n\n        //2\n        MultiByteToWideChar( CP_ACP, 0, line.c_str(), -1, pwcharText, dwCount );\n\n        //3\n        dwCount = WideCharToMultiByte( CP_UTF8, 0, pwcharText, -1, NULL, 0, NULL, NULL );\n        char *pText;\n        pText = new char[ dwCount ];\n\n        //4\n        WideCharToMultiByte( CP_UTF8, 0, pwcharText, -1, pText, dwCount, NULL, NULL );\n\n        fprintf(pOutputFile,pText);\n        fprintf(pOutputFile,\"\\n\");\n\n        delete[] pwcharText;\n        delete[] pText;\n    }\n}\n\n// ...\n</code></pre>\n\n<p>Unfortunately the encoding is still ANSI. I searched a while for a solution but I always encounter the solution via MultiByteToWideChar and WideCharToMultiByte. However, this doesn't seem to work. What am I missing here?</p>\n\n<p>I also looked here on SO for a solution but most UTF8 questions deal with C# and php stuff.</p>\n"},{"tags":["c++","c","windows","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":175,"score":1,"question_id":10207368,"title":"Group Box look and feel","body":"<p>I am using Visual Studio 2008 Professional Edition. I have designed the following dialog in the dialog editor-:\n <img src=\"http://i.stack.imgur.com/dufb8.jpg\" alt=\"Dialog that I designed\"></p>\n\n<p>Please pay close attention to the group box in the dialog called 'Tasks'. It looks fine over here but when I display it as a modeless dialog box from my application the look and feel of that GroupBox suddenly changes to -:\n<img src=\"http://i.stack.imgur.com/Bdak5.jpg\" alt=\"Dialog box when displayed from application\"></p>\n\n<p>Suddenly the original blue caption and rounded edges specified in the dialog editor are gone and are replaced with a black foreground and square edges. <strong>I want to know why this is suddenly happening and I want it to be displayed with the look and feel specified in the dialog editor.</strong></p>\n\n<p>The following code is present in my resource file(Timer.rc) for the dialog-:</p>\n\n<pre><code>IDD_FORMVIEW DIALOGEX 0, 0, 204, 118\nSTYLE DS_ABSALIGN | DS_SETFONT | DS_SETFOREGROUND | DS_CENTER | WS_MINIMIZEBOX | WS_VISIBLE | WS_CAPTION | WS_SYSMENU\nEXSTYLE WS_EX_APPWINDOW | WS_EX_NOACTIVATE\nCAPTION \"SR-Timer(Work in Progress)\"\nFONT 10, \"Verdana\", 400, 0, 0x0\nBEGIN\n    CONTROL         \"Shutdown\",IDC_RADIO1,\"Button\",BS_AUTORADIOBUTTON,73,37,48,10\n    CONTROL         \"Restart\",IDC_RADIO2,\"Button\",BS_AUTORADIOBUTTON,73,54,39,10\n    CONTROL         \"Stand By\",IDC_RADIO3,\"Button\",BS_AUTORADIOBUTTON,73,70,44,10\n    CONTROL         \"Hibernate\",IDC_RADIO4,\"Button\",BS_AUTORADIOBUTTON,73,87,47,10\n    GROUPBOX        \"Tasks\",IDC_STATIC,59,28,90,78\nEND\n</code></pre>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":706,"score":4,"question_id":8991192,"title":"Check filesize without opening file in c++?","body":"<p>I'm trying to get the filesize of a large file (12gb+) and I don't want to open the file to do so as I assume this would eat a lot of resources. Is there any good API to do so with? I'm in a Windows environment. </p>\n"},{"tags":["c++","winapi","unicode","internationalization"],"answer_count":3,"favorite_count":5,"up_vote_count":29,"down_vote_count":1,"view_count":1305,"score":28,"question_id":11107608,"title":"What's \"wrong\" with C++ wchar_t and wstrings? What are some alternatives to wide characters?","body":"<p>I have seen a lot of people in the C++ community(particularly ##c++ on freenode) resent the use of <code>wstrings</code> and <code>wchar_t</code>, and their use in the windows api. What is exactly \"wrong\" with <code>wchar_t</code> and <code>wstring</code>, and if I want to support internationalization, what are some alternatives to wide characters?</p>\n"},{"tags":["c","winapi","folder","tchar"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":11653089,"title":"Using SHGetSpecialFolderPath+SubFolder with SHFileOperation","body":"<p>I want to delete the folder <code>C:\\Users\\username\\AppData\\Roaming\\appname</code> when the users uninstall the application <code>appname</code>. </p>\n\n<p>First, I use the following code to get the path <code>C:\\Users\\username\\AppData\\Roaming</code>:</p>\n\n<pre><code>TCHAR dir[MAX_PATH];\ndir[0] = '\\0';\nBOOL ok = SHGetSpecialFolderPath(NULL, dir, CSIDL_APPDATA, TRUE);\n</code></pre>\n\n<p>appname is defined as <code>_T(\"appname\")</code></p>\n\n<p>The first question is: <code>How to append \"appname\" to \"dir\"?</code></p>\n\n<p>Suppose the above is done. Then I need to use <code>SHFileOperation</code> to delete the non-empty folder <code>C:\\Users\\username\\AppData\\Roaming\\appname</code>. So I need a double null-terminated string in a <code>SHFILEOPSTRUCT</code> structure. So</p>\n\n<p><code>How to get a double null-terminated string from the result of the first step? Just append _T(\"\\0\\0\") to it?</code></p>\n\n<p>Update: I can use <code>TCHAR *dir2 = lstrcat(dir, appname);</code> to get the path. But when I tried to use <code>TCHAR *dir3 = lstrcat(dir2, _T(\"\\0\\0\"));</code>, the folder is not deleted. Any number of <code>\\0</code> won't work.</p>\n\n<hr>\n\n<p>p.s:</p>\n\n<p>If I do the following directly, I got it to work. The problem is that I want to it to be user-independent.</p>\n\n<pre><code>TCHAR path[] = _T(\"C:\\\\Users\\\\username\\\\AppData\\\\Roaming\\\\appname\");\nmemcpy(path + sizeof(path) / sizeof(TCHAR) - 1, _T(\"\\0\\0\\0\"), 3);\n</code></pre>\n"},{"tags":["c++","c","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":111,"score":-1,"question_id":11639641,"title":"PRINTDLG structure used on an hWnd that isn't the same process","body":"<p>The following compiles without errors or warnings but doesn't snag the IEFrame window, or at least I know it fails to change that window's print orientation to landscape:</p>\n\n<pre><code>PRINTDLGEX pd;\npd.lStructSize = (DWORD)sizeof(PRINTDLG);    \nBOOL GetPrinterDeviceDefaults(struct tagPDA* pd);\n\nBOOL bRet=AfxGetApp()-&gt;GetPrinterDeviceDefaults(&amp;pd); \npd.hwndOwner = FindWindow(\"IEFrame\", NULL);\nLPDEVMODE pDevMode = (LPDEVMODE)::GlobalLock(&amp;pd.hDevMode);\npDevMode-&gt;dmOrientation = DMORIENT_LANDSCAPE;\n::GlobalUnlock(&amp;pd.hDevMode);\n</code></pre>\n\n<p>I have evidence the code may have acquired the hWnd of the IEFrame window because the results of <code>MessageBox(0,(LPCSTR)pd.hwndOwner,\"[header]\",MB_OK);</code> displays some text gobbledygook in the msg. instead of nothing.</p>\n\n<p>Thanks for any help.</p>\n"},{"tags":["c++","multithreading","winapi","return-value","critical-section"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":98,"score":4,"question_id":11653062,"title":"Critical Sections and return values in C++","body":"<p>In attempting to create a thread-safe container class from scratch, I've run into the problem of returning values from access methods. For example in Windows:</p>\n\n<pre><code>myNode getSomeData( )\n{\n  EnterCriticalSection(&amp; myCritSec);\n  myNode retobj;\n  // fill retobj with data from structure\n  LeaveCriticalSection(&amp; myCritSec);\n  return retobj;\n}\n</code></pre>\n\n<p>Now I suppose that this type of method is not at all thread-safe because after the code releases the critical section another thread is able to come along and immediately overwrite <code>retobj</code> before the first thread returns. So what is an elegant way to return <code>retobj</code> to the caller in a thread-safe manner?</p>\n"},{"tags":["qt","winapi","gtk","tooltip"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":11650263,"title":"How to implement a hover-over cursor tooltip dictionary?","body":"<p>I'm planning to write a program that will act like Stardict's scan feature, where the program runs in the background, and when the user selects a piece of text from anywhere on the screen, a tooltip pops up with a dictionary entry for that text. I'm targetting the Windows platform. I've had minimal experience with Win32 API, and I'm currently learning Qt. Could anyone just list some options I have, and possible functions to implement this? I just want to know how to get a tooltip-like thing to pop up. The dictionary stuff, I'll figure out myself.</p>\n\n<p>I'll take any answer that targets the windows platform, but here are the recommended implementation environments:</p>\n\n<ul>\n<li>Java</li>\n<li>.NET</li>\n<li>Qt / C++</li>\n<li>Gtk+</li>\n</ul>\n"},{"tags":["c++","winapi","hook","dll-injection","setwindowshookex"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":370,"score":1,"question_id":11592446,"title":"How to Modify Import Address Table for Run time Loaded DLL","body":"<p>I want to hook functions that are called from a loaded DLL on Run time, i used the class CAPIHook from the book \"Windows Via C/C++\" (the DLL Injecting done by Install System Wide hook and The hooking by Modify IAT) but this code work only if the DLL name/symbols exist in the IAT in the executable file. (i.e. for Implicit DLL Linking)</p>\n\n<p>this is DLL code:</p>\n\n<pre><code>   CAPIHook::CAPIHook(PSTR pszCalleeModName, PSTR pszFuncName, PROC pfnHook) {\n\n   // Note: the function can be hooked only if the exporting module \n   //       is already loaded. A solution could be to store the function\n   //       name as a member; then, in the hooked LoadLibrary* handlers, parse\n   //       the list of CAPIHook instances, check if pszCalleeModName\n   //       is the name of the loaded module to hook its export table and \n   //       re-hook the import tables of all loaded modules.\n\n   m_pNext  = sm_pHead;    // The next node was at the head\n   sm_pHead = this;        // This node is now at the head\n\n   // Save information about this hooked function\n   m_pszCalleeModName   = pszCalleeModName;\n   m_pszFuncName        = pszFuncName;\n   m_pfnHook            = pfnHook;\n   m_pfnOrig            =  GetProcAddressRaw(GetModuleHandleA(pszCalleeModName), m_pszFuncName);\n\n   // If function does not exit,... bye bye\n   // This happens when the module is not already loaded\n   if (m_pfnOrig == NULL)\n   {\n      wchar_t szPathname[MAX_PATH];\n      GetModuleFileNameW(NULL, szPathname, _countof(szPathname));\n      wchar_t sz[1024];\n      StringCchPrintfW(sz, _countof(sz), \n         TEXT(\"[%4u - %s] impossible to find %S\\r\\n\"), \n         GetCurrentProcessId(), szPathname, pszFuncName);\n      OutputDebugString(sz);\n      return;\n   }\n\n   // Hook this function in all currently loaded modules\n   ReplaceIATEntryInAllMods(m_pszCalleeModName, m_pfnOrig, m_pfnHook);\n}\n</code></pre>\n\n<p>this is the hook functions:</p>\n\n<pre><code>HMODULE WINAPI CAPIHook::LoadLibraryA(PCSTR pszModulePath) {\n\n   HMODULE hmod = ::LoadLibraryA(pszModulePath);\n   FixupNewlyLoadedModule(hmod, 0);\n   return(hmod);\n}\n\nHMODULE WINAPI CAPIHook::LoadLibraryW(PCWSTR pszModulePath) {\n\n   HMODULE hmod = ::LoadLibraryW(pszModulePath);\n   FixupNewlyLoadedModule(hmod, 0);\n   return(hmod);\n}\n\nHMODULE WINAPI CAPIHook::LoadLibraryExA(PCSTR pszModulePath, \n   HANDLE hFile, DWORD dwFlags) {\n\n   HMODULE hmod = ::LoadLibraryExA(pszModulePath, hFile, dwFlags);\n   FixupNewlyLoadedModule(hmod, dwFlags);\n   return(hmod);\n}\n\nHMODULE WINAPI CAPIHook::LoadLibraryExW(PCWSTR pszModulePath, \n   HANDLE hFile, DWORD dwFlags) {\n\n   HMODULE hmod = ::LoadLibraryExW(pszModulePath, hFile, dwFlags);\n   FixupNewlyLoadedModule(hmod, dwFlags);\n   return(hmod);\n}\n</code></pre>\n\n<p>the method for replacing IAT:</p>\n\n<pre><code>void CAPIHook::ReplaceIATEntryInOneMod(PCSTR pszCalleeModName, \n   PROC pfnCurrent, PROC pfnNew, HMODULE hmodCaller) {\n\n   // Get the address of the module's import section\n   ULONG ulSize;\n\n   // An exception was triggered by Explorer (when browsing the content of \n   // a folder) into imagehlp.dll. It looks like one module was unloaded...\n   // Maybe some threading problem: the list of modules from Toolhelp might \n   // not be accurate if FreeLibrary is called during the enumeration.\n   PIMAGE_IMPORT_DESCRIPTOR pImportDesc = NULL;\n   __try {\n      pImportDesc = (PIMAGE_IMPORT_DESCRIPTOR) ImageDirectoryEntryToData(\n         hmodCaller, TRUE, IMAGE_DIRECTORY_ENTRY_IMPORT, &amp;ulSize);\n   } \n   __except (InvalidReadExceptionFilter(GetExceptionInformation())) {\n      // Nothing to do in here, thread continues to run normally\n      // with NULL for pImportDesc \n   }\n\n   if (pImportDesc == NULL)\n      return;  // This module has no import section or is no longer loaded\n\n\n   // Find the import descriptor containing references to callee's functions\n   for (; pImportDesc-&gt;Name; pImportDesc++) {\n      PSTR pszModName = (PSTR) ((PBYTE) hmodCaller + pImportDesc-&gt;Name);\n      if (lstrcmpiA(pszModName, pszCalleeModName) == 0) {\n\n         // Get caller's import address table (IAT) for the callee's functions\n         PIMAGE_THUNK_DATA pThunk = (PIMAGE_THUNK_DATA) \n            ((PBYTE) hmodCaller + pImportDesc-&gt;FirstThunk);\n\n         // Replace current function address with new function address\n         for (; pThunk-&gt;u1.Function; pThunk++) {\n\n            // Get the address of the function address\n            PROC* ppfn = (PROC*) &amp;pThunk-&gt;u1.Function;\n\n            // Is this the function we're looking for?\n            BOOL bFound = (*ppfn == pfnCurrent);\n            if (bFound) {\n               if (!WriteProcessMemory(GetCurrentProcess(), ppfn, &amp;pfnNew, \n                    sizeof(pfnNew), NULL) &amp;&amp; (ERROR_NOACCESS == GetLastError())) {\n                  DWORD dwOldProtect;\n                  if (VirtualProtect(ppfn, sizeof(pfnNew), PAGE_WRITECOPY, \n                     &amp;dwOldProtect)) {\n\n                     WriteProcessMemory(GetCurrentProcess(), ppfn, &amp;pfnNew, \n                        sizeof(pfnNew), NULL);\n                     VirtualProtect(ppfn, sizeof(pfnNew), dwOldProtect, \n                        &amp;dwOldProtect);\n                  }\n               }\n               return;  // We did it, get out\n            }\n         }\n      }  // Each import section is parsed until the right entry is found and patched\n   }\n}\n</code></pre>\n\n<p>the author added comments to add this functionality, but I am not sure how to do it</p>\n\n<blockquote>\n  <p>Note: the function can be hooked only if the exporting module \n            is already loaded. A solution could be to store the function\n            name as a member; then, in the hooked LoadLibrary* handlers, parse\n            the list of CAPIHook instances, check if pszCalleeModName\n            is the name of the loaded module to hook its export table and \n            re-hook the import tables of all loaded modules.</p>\n</blockquote>\n\n<p>he also write this on the book, but again i don't know what to do </p>\n\n<blockquote>\n  <p>A possible solution is to use the hooked LoadLibrary* functions to\n  detect when a module is exporting an unpatched hooked function and\n  then execute two actions:</p>\n  \n  <p>Hook again the import table of the module already loaded because it is\n  now possible to call GetProcAddress and get a pointer to the original\n  implementation of the function to hook. Notice that the name of the\n  function needs to be stored as a class member and set in the\n  constructor.</p>\n  \n  <p>Directly update this hooked function in the Export Address Table of\n  the exporting module as shown by the implementation of the\n  ReplaceEATEntryInOneMod function. That way, all new modules calling\n  the hooked function will call our handler</p>\n</blockquote>\n\n<p>i try to modify the IAT after loading the DLL, but my hooking function is not called</p>\n\n<pre><code>HMODULE WINAPI CAPIHook::LoadLibraryW(PCWSTR pszModulePath) {\n\n   HMODULE hmod = ::LoadLibraryW(pszModulePath);\n\n   if (StrCmpIW(pszModulePath, myDLLUnicodeName.c_str()) == 0 ) {\n        PROC proc =  GetProcAddressRaw(GetModuleHandleA(myDLLName.c_str()), myFunctionName.c_str());\n\n        if ( proc != NULL ) {\n            for (CAPIHook* p = sm_pHead; p != NULL; p = p-&gt;m_pNext) {\n                 if (StrCmpIA(p-&gt;m_pszCalleeModName, myDLLName.c_str()) == 0) {\n                    MessageBox(NULL, L\"This is the New Dynamic DLL\", L\"Test!\", 0);\n                    ReplaceIATEntryInAllMods(p-&gt;m_pszCalleeModName, proc , p-&gt;m_pfnHook);  \n                 }\n            }\n        }\n    }\n\n   FixupNewlyLoadedModule(hmod, 0);\n   return(hmod);\n}\n</code></pre>\n\n<p>so, how to modify this code to handle dynamic loading case ?</p>\n"},{"tags":["c++","winapi","hardware","enumerate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":11641550,"title":"Visual Studio errors and getting a device GUID and path name?","body":"<p>Evening everyone I wondered if some could answer me 2 quick questions.</p>\n\n<p>I made an app to communicate with arm device which works fine, however when I move PC etc, I need to reconfigure the device path. Its a long one like below.</p>\n\n<p>Path: <code>\\\\?\\usb#vid_045e&amp;pid_0040#6&amp;ff454f2&amp;0&amp;3#{a5dcbf10-6530-11d2-901f-00c04fb951ed}</code></p>\n\n<p>I done some reading up and discovered it's two features <code>SetupDiGetClassDevs</code> and <code>SetupDiGetDeviceInstanceId</code> I need. My question is am I looking in the right place i.e will these 2 functions return the path like above. Also what is the techinical name for this path?</p>\n\n<p>I found what I think is a nice example (always learn better from example) on Microsoft's website cut and paste below but this throws up error <code>C2440: '=' : cannot convert from 'HLOCAL' to 'LPTSTR'</code> \nwhich is a new one on me a pointer error?</p>\n\n<p>This is the code </p>\n\n<pre><code>   #include &lt;stdio.h&gt;\n   #include &lt;windows.h&gt;\n   #include &lt;setupapi.h&gt;\n   #include &lt;devguid.h&gt;\n   #include &lt;regstr.h&gt;\n\n   int main( int argc, char *argv[ ], char *envp[ ] )\n   {\n       HDEVINFO hDevInfo;\n       SP_DEVINFO_DATA DeviceInfoData;\n       DWORD i;\n\n       // Create a HDEVINFO with all present devices.\n       hDevInfo = SetupDiGetClassDevs(NULL,\n           0, // Enumerator\n           0,\n           DIGCF_PRESENT | DIGCF_ALLCLASSES );\n\n       if (hDevInfo == INVALID_HANDLE_VALUE)\n       {\n           // Insert error handling here.\n           return 1;\n       }\n\n       // Enumerate through all devices in Set.\n\n       DeviceInfoData.cbSize = sizeof(SP_DEVINFO_DATA);\n       for (i=0;SetupDiEnumDeviceInfo(hDevInfo,i,\n           &amp;DeviceInfoData);i++)\n       {\n           DWORD DataT;\n           LPTSTR buffer = NULL;\n           DWORD buffersize = 0;\n\n           //\n           // Call function with null to begin with, \n           // then use the returned buffer size (doubled)\n           // to Alloc the buffer. Keep calling until\n           // success or an unknown failure.\n           //\n           //  Double the returned buffersize to correct\n           //  for underlying legacy CM functions that \n           //  return an incorrect buffersize value on \n           //  DBCS/MBCS systems.\n           // \n           while (!SetupDiGetDeviceRegistryProperty(\n               hDevInfo,\n               &amp;DeviceInfoData,\n               SPDRP_DEVICEDESC,\n               &amp;DataT,\n               (PBYTE)buffer,\n               buffersize,\n               &amp;buffersize))\n           {\n               if (GetLastError() == \n                   ERROR_INSUFFICIENT_BUFFER)\n               {\n                   // Change the buffer size.\n                   if (buffer) LocalFree(buffer);\n                   // Double the size to avoid problems on \n                   // W2k MBCS systems per KB 888609. \n                   buffer = LocalAlloc(LPTR,buffersize * 2); // ERROR LINE\n               }\n               else\n               {\n                   // Insert error handling here.\n                   break;\n               }\n           }\n\n           printf(\"Result:[%s]\\n\",buffer);\n\n           if (buffer) LocalFree(buffer);\n       }\n\n\n       if ( GetLastError()!=NO_ERROR &amp;&amp;\n            GetLastError()!=ERROR_NO_MORE_ITEMS )\n       {\n           // Insert error handling here.\n           return 1;\n       }\n\n       //  Cleanup\n       SetupDiDestroyDeviceInfoList(hDevInfo);\n\n       return 0;\n   }\n</code></pre>\n\n<p>Hope its an easy one thank you.</p>\n"},{"tags":["c++","winapi","windows-shell","dataprovider","shell-extensions"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":80,"score":2,"question_id":8568438,"title":"Adding properties to virtual files","body":"<p>I'm developing a explorer data provider based on this <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd940360.aspx\" rel=\"nofollow\">sample</a>. I already added drag &amp; drop support. Now I want that the files and folders can be ordered by filetyp, size or whatever. The problem seems that the virtual files have only the name property like you can see on the screenshot.</p>\n\n<p><img src=\"http://i.stack.imgur.com/hDvdT.png\" alt=\"Screenshot of shell extension\"></p>\n\n<p>How can I add more properties or columns to order the content?</p>\n"},{"tags":["c++","c","winapi","event-log"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":11638590,"title":"How to retrieve all the event logs at the Windows XP?","body":"<p>As we know, windows event logs are different at below Vista (XP and below) and Vista and up, see here <a href=\"http://msdn.microsoft.com/en-us/library/aa363652.aspx\" rel=\"nofollow\">Windows Event Logs</a> . On Vista, I am able to understand the API about how to retrieve all event logs.</p>\n\n<p>On the windows XP, I am able to run this <a href=\"http://msdn.microsoft.com/en-us/library/bb427356%28v=vs.85%29\" rel=\"nofollow\">sample code</a>. Two things we need to fill in there are:</p>\n\n<pre><code>#define PROVIDER_NAME           L\"MyEventProvider\"\n#define RESOURCE_DLL            L\"&lt;path&gt;\\\\Provider.dll\"\n</code></pre>\n\n<p>However the question would be there where to get the provider name and its resource dll.</p>\n\n<p>One way I could think of is to iterate through all the sub key under registry key: HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Eventlog\\Application\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Eventlog\\System\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Eventlog\\Security</p>\n\n<p>From those subkeys, we could get the provider name and its EventMessageFile (although I found out that some subkey doesn't have the EventMessageFile, rather it hasParameterMessageFile). </p>\n\n<p>Is this the only way to do this? Or is there any other better approach?</p>\n"},{"tags":["c++","winapi","dll-injection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":157,"score":0,"question_id":11613739,"title":"CreateInstance() with detour DLL Injection","body":"<p>I need to update a piece of code to use dll injection. Originally this code creates an instance of IE, assigns a website to it and closes it after a given amount of time (this is a scientific application in which we have to open a number of websites)</p>\n\n<p>All I need to do is: inject a DLL in this instance of IE.\nI already have the DLL, and it works fine when I use: withdll.exe /d:[DLL] [IE] in the prompt.</p>\n\n<p>How do I go about it? WinAPI is far from being one of my strong points. I hope all I have to do is change the CreateInstance method.\nSome code:</p>\n\n<pre><code>[...]\nhr = internet_explorer_factory-&gt;CreateInstance(NULL, IID_IWebBrowser2,(void**)&amp;pInternetExplorer;\nif (SECEEDED(hr))\n{\nHWND hwmdIE;\nDWORD dProcessId;\npInternetExplorer-&gt;get_HWND((SHANDLE_PTR*)&amp;hwndIR);\nGetWindowThreadProcessId(hwndIE, &amp;dProcesssId);\n[...]\n</code></pre>\n\n<p>Thanks!!</p>\n\n<p>EDIT\nThanks for the tips guys, but see I don't know much about WinAPI... is there an easy way of me creating a process using this CreateInstance that would run a command from the prompt? just so I can do my:\nwithdll.exe /d:[DLL] [IE] \nOr something similar idea.</p>\n\n<p>EDIT2\nHummm maybe it would be easier if I could somehow change the registry so CreateInstance runs: \nwithdll.exe /d:[DLL] iexplore.exe instead of just iexplore.exe \nDoes anybody know what key to change???</p>\n"},{"tags":["c++","winapi","gdi","alphablending"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":207,"score":1,"question_id":11645532,"title":"Alphablend function","body":"<p>Is it possible to make certain part of image transparent using alphablend function?</p>\n\n<p>Can I create an image which contains certain area with RGB(0,0,255) and when I draw that image only that area should be tranparent.Is it possible with AlphaBlend function. Is yes, then How?</p>\n\n<p>I was reading about alphablend , but it still not clear to me. I guess we need to specify alphachannel while creating the image. If alphachannel is not there for a particular pixel then that pixel cannot be made transparent?</p>\n"},{"tags":["python","winapi","google-chrome"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":131,"score":1,"question_id":11645123,"title":"How do I get the URL of the active Google Chrome tab in Windows?","body":"<p>How can my Python script get the URL of the currently active Google Chrome tab in Windows? This has to be done without interrupting the user, so sending key strokes to copy/paste is not an option.</p>\n"},{"tags":["c++","winapi","service","atl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":11628391,"title":"How can I add Failure Actions within service exe?","body":"<p>How can I program <em>Failure Actions</em> in a <em>Windows Service (using ATL)</em>, so after I register the service with a call <code>myservice.exe /service</code>, Failure Actions are set already?</p>\n"},{"tags":["c#","asp.net","winapi"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1551,"score":0,"question_id":1313066,"title":"WSAGetLastError","body":"<p>I am getting this error as </p>\n\n<p>WSAGetLastError() returned 10061, Connection refused </p>\n\n<p>can anyone please advise me the reason and where to look for the cause of this error?</p>\n"},{"tags":["c++","winapi","size","control"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":11643397,"title":"Get the \"padding\" around a control","body":"<p>I use win32 to generate my interface.</p>\n\n<p>I'm looking to get the padding that windows naturally puts around controls. For example, in a tabcontrol the height of the tabcontrol includes the height of the border at the top and the height of the tab headers at the top. Same goes for buttons.</p>\n\n<p>I'd like to know how I can find the exact height of these extra paddings before I create the actual control, as I need to add them to the height and width so that the client area of the control is the right size after creation to host content which has a static exact size.</p>\n"},{"tags":["c++","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":11639634,"title":"Measure the current network traffic in Windows","body":"<p>I have been looking for a solution all evening now and i cannot find anything. My problem is that I am writing a program which collects statistics from windows servers. The only thing i cannot find is how to get the current network usage on the system. Like the usage you can see in the Task manager. I found some functions on MSDN but some of them are only available on windows systems which have at least windows vista and some functions, or better the structures for those functions have problems with 10GBit network interfaces. Anyone knows any solid solution for this?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["delphi","winapi","fpc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":233,"score":0,"question_id":11635701,"title":"Check if memory is readable or why do it not catches the exception?","body":"<p>I have this code that gets called from an injected DLL from a foreign process. It sould read some memory ranges but I sometimes get a segmentation fault at this line <code>DataBuffer := TCharPointer(Address + CharOffset)^;</code>. So is there any way to check if the memory is readable?</p>\n\n<pre><code>function GetCurrentData(Address: Pointer): PChar;\nvar\n  DataBuffer: Char;\n  CharArray: Array of Char;\n  CharOffset: Integer;\n  ReadBytes: longword;\nbegin\n  CharOffset := 0;\n  SetLength(CharArray, 0);\n  repeat\n    DataBuffer := TCharPointer(Address + CharOffset)^;\n    CharOffset := CharOffset + 1;\n    SetLength(CharArray, CharOffset);\n    CharArray[CharOffset - 1] := DataBuffer;\n  until (Ord(DataBuffer) = 0);\n  Result := PChar(@CharArray[0]);\nend;\n</code></pre>\n\n<p>i also tryed to catch the exception but for some reason this is not working. The host programm still crashes.</p>\n\n<pre><code>unit UnitEventBridgeExports;\n\n{$mode objfpc}{$H+}\n\ninterface\n\nuses\n  Classes, SysUtils, Windows, ShellAPI, JwaTlHelp32, SimpleIPC;\n\ntype\n  TCharPointer = ^Char;\n\nconst\n  WOWEXE = 'TestProgramm.exe';\n\nvar\n  IPCClient: TSimpleIPCClient;\n  PID: DWord;\n  Process: THandle;\n\nprocedure EventCalled;\nprocedure InitializeWoWEventBridge; stdcall;\n\nimplementation\n\n\nfunction GetProcessIDByName(Exename: String): DWord;\nvar\n  hProcSnap: THandle;\n  pe32: TProcessEntry32;\nbegin\n  Result := 0;\n  hProcSnap := CreateToolHelp32SnapShot(TH32CS_SNAPPROCESS, 0);\n  if hProcSnap &lt;&gt; INVALID_HANDLE_VALUE then\n  begin\n    pe32.dwSize := SizeOf(ProcessEntry32);\n    if Process32First(hProcSnap, pe32) = True then\n    begin\n      while Process32Next(hProcSnap, pe32) = True do\n      begin\n        if pos(Exename, pe32.szExeFile) &lt;&gt; 0 then\n          Result := pe32.th32ProcessID;\n      end;\n    end;\n    CloseHandle(hProcSnap);\n  end;\nend;\n\n\nprocedure InitializeEventBridge; stdcall;\nbegin\n  IPCClient := TSimpleIPCClient.Create(nil);\n  IPCClient.ServerID := 'EventBridgeServer';\n  IPCClient.Active := True;\n  IPCClient.SendStringMessage('init');\n  PID := GetProcessIDByName(EXE);\n  Process := OpenProcess(PROCESS_ALL_ACCESS, False, PID);\nend;\n\n\nfunction GetCurrentData(Address: Pointer): PChar;\nvar\n  DataBuffer: Char;\n  CharArray: Array of Char;\n  CharOffset: Integer;\n  ReadBytes: longword;\n  CharPointer: TCharPointer;\n  BreakLoop: Boolean;\nbegin\n  CharOffset := 0;\n  SetLength(CharArray, 0);\n  BreakLoop := False;\n  repeat\n    try\n      CharPointer := TCharPointer(Address + CharOffset);\n      DataBuffer := CharPointer^;\n      CharOffset := CharOffset + 1;\n      SetLength(CharArray, CharOffset);\n      CharArray[CharOffset - 1] := DataBuffer;\n    except\n      BreakLoop := True;\n    end;\n  until (Ord(DataBuffer) = 0) or BreakLoop;\n  Result := PChar(@CharArray[0]);\nend;\n\n\nprocedure EventCalled;\nvar\n  TmpAddress: Pointer;\n  StringData: PChar;\nbegin\n  {$ASMMODE intel}\n  asm\n    mov [TmpAddress], edi\n  end;\n  StringData := GetCurrentData(TmpAddress);\n  IPCClient.SendStringMessage('update:' + StringData);\n  //IPCClient.SendStringMessage('update');\nend;\n\nend.\n</code></pre>\n"},{"tags":["winapi","toolbar"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":11634039,"title":"How to adjust/remove toolbar bounding rectangle","body":"<p>I have create my toolbar from the application, only 4 buttons and each button has the size of 80 by 64 pixels. The whole bitmap is 320 by 64.</p>\n\n<pre><code>const int numButtons     = 4;\nconst SIZE bitmapSize={80,64};\nHIMAGELIST hImageList = ImageList_Create(bitmapSize.cx, bitmapSize.cy, ILC_COLOR16 | ILC_MASK,numButtons, 0);\n\n\nHBITMAP hBitmap = LoadBitmap(hInst, MAKEINTRESOURCE(IDB_HOME));\nint iImageList = ImageList_AddMasked(hImageList, hBitmap, 0);\nSendMessage(hWndToolbar, TB_SETIMAGELIST, 0, (LPARAM)hImageList);\n\nTBBUTTON tbButtons[numButtons] = \n{\n    { 0, WM_BBBB1, TBSTATE_ENABLED, TBSTYLE_BUTTON, {0}, 0, 0},\n    { 1, WM_BBBB2, TBSTATE_ENABLED, TBSTYLE_BUTTON, {0}, 0, 0},\n    { 2, WM_BBBB3, TBSTATE_ENABLED, TBSTYLE_BUTTON, {0}, 0, 0},\n    { 3, WM_BBBB4, TBSTATE_ENABLED, TBSTYLE_BUTTON, {0}, 0, 0}\n};\n\n// Add buttons.\nSendMessage(hWndToolbar, TB_BUTTONSTRUCTSIZE, (WPARAM)sizeof(TBBUTTON), 0);\nSendMessage(hWndToolbar, TB_ADDBUTTONS,(WPARAM)numButtons,(LPARAM)&amp;tbButtons);\nSendMessage(hWndToolbar, TB_AUTOSIZE, 0, 0); \n\nRECT _tbRect;\nSendMessage(hWndToolbar, TB_GETITEMRECT, 0, (LPARAM)&amp;_tbRect);//0,0,87,70\n</code></pre>\n\n<p>It says the button has 87 in width and 70 in height, if my bitmap has its own bounding size and I don't want the control to add the bounding rectangle for toolbar, how can I do?</p>\n\n<p>Thank you in advance!</p>\n"},{"tags":["windows","winapi","serial-port","ras"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":179,"score":0,"question_id":11624690,"title":"Monitor RAS Dial Connection from My application using APIs","body":"<p>I created a DialUp connection using the RASDIAL or RASPHONE exe. I want my application to monitor the established connection and if the connection gets disconnected my application should exit. How to manage this programatically? Please suggest me..</p>\n"},{"tags":["winapi","windows-7"],"answer_count":6,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":3721,"score":3,"question_id":1968137,"title":"Windows 7 - Taskbar - Pin or Unpin Program Links","body":"<p>As in title, is there any Win32 API to do that?</p>\n"},{"tags":["c++","winapi","panel","splitter"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":11618735,"title":"content (or background) remains when draggin the splitter bar to resize two panels","body":"<p>I have a main window with 3 child: <code>hwndTocBox</code> (left panel), <code>hwndSplitter</code> and <code>hwndCanvas</code> (right panel).\n<code>hwndTocBox</code> has a child <code>hwndTreeView</code>, which is a TreeView control. When I drag <code>hwndSplitter</code> to the right (i.e want to make <code>hwndTocBox</code> and hence <code>hwndTreeView</code> bigger), the content (and background?) of <code>hwndCanvas</code> and <code>hwndSplitter</code> will remain for a while. (When I drag the splitter to the left, there is no problem at all.)</p>\n\n<p>When <code>hwndSplitter</code> is draged, it uses <code>DeferWindowPos()</code> to resize and move <code>hwndTocBox</code>, <code>hwndSplitter</code> and <code>hwndCanvas</code>. When <code>hwndTocBox</code> is resized, in <code>WM_SIZE</code> case of its windows procedure, it resizes <code>hwndTreeView</code> (still using <code>DeferWindowPos()</code>, since it resizes not only <code>hwndTreeView</code> but also others).</p>\n\n<p>I have tried to use <code>CLIPCHILDREN</code> and <code>WS_CLIPSIBLINGS</code> in several places, but it doesn't solve the problem.</p>\n\n<p>Why the contents remain there for a while and erased later?</p>\n\n<p>Could you indicate me how to solve this issue, please.</p>\n\n<p><img src=\"http://i.stack.imgur.com/B3Mnj.png\" alt=\"enter image description here\"></p>\n"},{"tags":["winapi","window"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":11628297,"title":"how to draw text on a memory buffer","body":"<p>I want to draw some text on a memory buffer, but don't know how to. please help, many thanks!\n Code:</p>\n\n<pre><code> widht = 640;\n height = 480;\n pBuf = malloc( width * 3 * height );\n\n memset( pBuf, 0, width * 3 * height );\n\n //DrawText is the function that needs to be implemented, and I don't know how to do it.\n DrawText( \"this is the text that i want to draw on the buffer\", pBuf, width, height, 3 );\n\n //now there is text on the memory buffer pointed to by pBuf.\n</code></pre>\n"},{"tags":["winapi","linux-kernel"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":74,"score":2,"question_id":11627682,"title":"Programmatically get the enviroment variables of another process?","body":"<p>I want to get the enviroment variables of process A  from process B?\nThere is no relationship with A and B.\nNot the System enviroment variables , but the enviroment variables that have been passed to the process!</p>\n\n<p>In linux,  or windows</p>\n"},{"tags":["windows","winapi","wmi","hardware","unique"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":208,"score":0,"question_id":9598073,"title":"Windows WMI -- find a unique identifier for each hardware component?","body":"<p>I'm currently writing an application that retrieves hardware information about a computer.</p>\n\n<p>I need some sort of unique identifier for each hardware component, such as an UID or S/N. I can see this \"DeviceID\" member in almost every component (inherited from <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa387884%28v=vs.85%29.aspx\" rel=\"nofollow\">CIM_LogicalDevice</a>), and it says:</p>\n\n<blockquote>\n  <p>\"Address or other identifying information to uniquely name the logical device.\"</p>\n</blockquote>\n\n<p>Sounds good! Does this mean that it's unique for just that specific computer; or is it unique for \"all computers in the world\" (which is what I need).</p>\n\n<p>Thanks!</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":11623085,"title":"Pressing Alt hangs the application","body":"<p>I'm programming a Windows application that doesn't have a menu. Every time I press Alt, it receives the WM_ENTERMENULOOP event and hangs until I press a key.<br>\nI've tried other applications without menu (like the MS .chm file viewer) and they exhibit the same behavior.<br>\nThere is no difference between forwarding the event to DefWindowProc or processing it.</p>\n\n<p>Is there a way to stop Windows from entering the menu loop if there is no menu? Alternatively, is there a way to exit it manually as soon as the event is received?</p>\n"},{"tags":["c++","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":614,"score":1,"question_id":9341345,"title":"How to compute LPWSTR size when using GetDlgItemText()  function","body":"<p>My request is small\nI am using <strong><code>GetDlgItem()</code></strong> to get text from a text field , but I have a problem in the fourth parameter (i.e. size of buffer) .</p>\n\n<pre><code>LPWSTR txtbuff;\nGetDlgItemText(hwnd, IDC_EDIT1, txtbuff, 50); // the fourth parameter (50)\nMessageBox(NULL,txtbuff,L\"Error message\",MB_OK)\n</code></pre>\n\n<p>How can I compute size of <strong><code>txtbuff</code></strong></p>\n"},{"tags":["python","file","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":119,"score":0,"question_id":11621671,"title":"win32file.createFile \"The System cannot find the specified path\"","body":"<p>I'm using <code>win32file.CreateFile()</code> to open up \"file\" that I see in process explorer.\nThe file in question is (as seen in proc explorer's handles and dlls view) : \"\\Device\\ccSet_{}\"</p>\n\n<p>Q1. Can anyone shed light on what is <code>\\Device\\&lt;file name&gt;</code> . I believe these are obviously not files stored on the hard-disks somewhere. Unless I am wrong, what are they ?</p>\n\n<p>Q2. When I try to use the path AS IS, in <code>win32file.CreateFile()</code> , it gives me an error \"The system cannot find the specified path or file\". Where am I going wrong.</p>\n\n<p>Q3. Given an address of the above file object (again from proc explorer), can I read the file without specifying the path ?</p>\n\n<p>the single line of code I am using is :</p>\n\n<pre><code>&gt;&gt;&gt; win32file.CreateFile(\"Device\\&lt;filename&gt;\",w\nin32con.GENERIC_READ|win32con.GENERIC_WRITE,win32con.FILE_SHARE_READ|win32con.FI\nLE_SHARE_WRITE,None,win32con.OPEN_EXISTING,0,0)\n</code></pre>\n"},{"tags":["python","winapi","path","environment-variables","bioinformatics"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":294,"score":1,"question_id":11620811,"title":"How to fix this ImportError: No module named win32api? (win32api path variable)","body":"<p>I'm new to programming and computer world. I'm trying to study biomolecular simulations with MMTK. </p>\n\n<p>I run it in Windows 7 and I have already installed this software:</p>\n\n<ul>\n<li>python-2.5.4</li>\n<li>numpy-1.6.2-win32-superpack-python2.5</li>\n<li>netCDF4-0.8.2.win32-py2.5  </li>\n<li>ScientificPython-2.9.0.win32-py2.5    </li>\n<li>MMTK-2.6.0.win32-py2.5</li>\n</ul>\n\n<p>When I run this <a href=\"http://structure.usc.edu/mmtk/Examples/MolecularDynamics/protein.py\" rel=\"nofollow\">protein.py</a> mmtk sample, all seems to be OK. It show the numbers of 1000 process steps. </p>\n\n<p>But when I run a script with <code>view</code> method, like this:</p>\n\n<pre><code>from MMTK import *\nmolecule = Molecule('water')\nmolecule.view()\n</code></pre>\n\n<p>Then I get this error:</p>\n\n<pre><code>Traceback (most recent call last):\nFile \"C:\\Users\\BIOCHEM\\Desktop\\mmtk\\mmtk_water.py\", line 4, in &lt;module&gt;\nmolecule.view()\nFile \"C:\\Python25\\Lib\\site-packages\\MMTK\\Collections.py\", line 495, in view\nVisualization.viewConfiguration(self, configuration, format)\nFile \"C:\\Python25\\Lib\\site-packages\\MMTK\\Visualization.py\", line 263, in viewConfiguration\nfunction(*args, **kwargs)\nFile \"C:\\Python25\\Lib\\site-packages\\MMTK\\Visualization.py\", line 236, in genericViewConfiguration\nimport win32api\nImportError: No module named win32api\n</code></pre>\n\n<p>After searching for some answers on the internet (mainly this one: <a href=\"http://www.varioustopics.com/python/142947-importerror-no-module-named-win32api.html\" rel=\"nofollow\">http://www.varioustopics.com/python/142947-importerror-no-module-named-win32api.html</a>), I came to the conclusion that this is a problem in the <strong>path environment variables</strong>. Unfortunately, the answer to this question doesn't present details. And I need a <strong>detailed</strong> answer.\nThis issue of the environment variables seems so simple to me as the mystery of life's emergence on Earth. I know how to change it, but I don't know <strong>what</strong> to change or <strong>when</strong> change it. Reading the Wikipedia articles on the subject didn't help me too much.\nSo what I'd like to know is: how exactly to modify the system variable in <strong>this</strong> case? I must add a new variable or just one more path to an existing variable? What is the path to win32api (it should not be C:\\Windows\\System32)?</p>\n\n<p>This is my current variable value:</p>\n\n<p>Variable's name:\n    Path</p>\n\n<p>Variables's value:</p>\n\n<pre><code>C:\\Program Files (x86)\\PC Connectivity Solution\\;C:\\Program Files\\Common Files\\Microsoft Shared\\Windows Live;C:\\Program Files (x86)\\Common Files\\Microsoft Shared\\Windows Live;%SystemRoot%\\system32;%SystemRoot%;%SystemRoot%\\System32\\Wbem;%SYSTEMROOT%\\System32\\WindowsPowerShell\\v1.0\\;C:\\Program Files (x86)\\Windows Live\\Shared;%PYTHON_HOME%;%PYTHON_HOME%\\Scripts;C:\\Program Files (x86);C:\\Python27\\; C:\\Python27\\Scripts;C:\\Python25\\DLLs\n</code></pre>\n\n<p>I also have this Python variable: <code>PYTHON_HOME</code> with this variable's value: <code>C:\\Python27</code></p>\n\n<p>This question may seem trivial to an experienced programmer. But the answer to it can be very useful to others. There is a large number of biologists, biochemists and pharmacists interested in using computational methods to their problems. These professionals do not always have a computer scientist in the vicinity (especially if they are in an underdeveloped country).</p>\n\n<p>Overcoming this initial frustrating phase of bugs and installation problems can be crucial in the scientific career of many people. And the answer to this question will help them.</p>\n\n<p>Thanks in advance. If this forum is not appropriate for questions of this level, please give me a feedback.</p>\n"},{"tags":["c","winapi","software-tools"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":11620854,"title":"Software to track what files and folders an application accesses or creates?","body":"<p>Is there a software for windows that can use the winapi or something to detect folder access or file accesses by that application?</p>\n\n<p>Thanks</p>\n"},{"tags":["c++","winapi","visual-c++","mouseevent"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":135,"score":0,"question_id":11602911,"title":"What does capturing the mouse mean in reference to the GetCapture() function?","body":"<p>I'm reading about the GetCapture() function , which is part of the mfc.\nI'm still unclear as to what it does, as well as what it means to capture the mouse , as it says here:</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/dxa5eaaa(v=vs.80).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/dxa5eaaa(v=vs.80).aspx</a></p>\n\n<p>in my book it's used in this way:</p>\n\n<pre><code> void CSketcherView::OnLButtonUp(UINY nFlags, CPoint point)\n {\n   if(this == GetCapture())\n       ReleaseCapture();                    // Stop capturing mouse messages\n\n   // ... add information to document\n}\n</code></pre>\n\n<p>So what does GetCapture() return? and what does \"capturing\" the mouse mean?</p>\n"},{"tags":["c#","winapi","mono"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":149,"score":1,"question_id":11602781,"title":"Windows kernel32 functions in Mono on Linux","body":"<p>I got this awesomely simple ini class that I downloaded from somewhere a while ago, but now that I'm using mono I'm running into the issue that it's importing stuff from kernel32</p>\n\n<pre><code>[DllImport(\"kernel32\")]\nprivate static extern long WritePrivateProfileString(string section,\n    string key, string val, string filePath);\n[DllImport(\"kernel32\")]\nprivate static extern int GetPrivateProfileString(string section,\n            string key, string def, StringBuilder retVal,\n    int size, string filePath);\n</code></pre>\n\n<p>Which on mono (in linux) gives the error <code>DLLNotFoundException: kernel32</code></p>\n\n<p>Is there any way to get this to work with mono? Maybe embed the whole thing into the assembly at compile time (if that even makes sense at all, I wouldn't know). Or will I <em>have</em> to create/find an ini class that doesn't use WinAPI? (Nini springs to mind).</p>\n\n<p>I'd really like it if WinAPI stuff could work with Mono, any thoughts?</p>\n"},{"tags":["c#",".net","windows","winapi","ras"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":154,"score":0,"question_id":11397832,"title":"rasdial errors in gui","body":"<p>I'm using Rasdial.exe to create a new dial-up connection, Its displays the errors in console mode. Is there a way to make the errors appear on GUI? \nHow does windows displays the error codes as user interface? </p>\n\n<p>Update:</p>\n\n<p>I used \"Rasphone.exe\" which does what I expected. i.e It shows the error messages in user interface and not in command prompt. But is this the correct way to use \"RASPhone.exe\" instead of \"RASDial.exe\"?</p>\n"},{"tags":["c","winapi","gui"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":136,"score":3,"question_id":11612696,"title":"How to change the GUI of the application?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/9216917/how-to-skin-an-win32-application\">How to Skin an Win32 Application</a>  </p>\n</blockquote>\n\n\n\n<p>I'm trying to learn to design a application, but I'm stuck.</p>\n\n<p>For a example, how would I code/get this kind GUI ( Background image, navigation, the engineering icon in the up left corner, styled minimize and quit icons ... etc ) in C/Win32API as represented on that picture?</p>\n\n<p><img src=\"http://i.stack.imgur.com/Y4dcR.png\" alt=\"BF3 C# GUI\">\nThanks.</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":11608060,"title":"How to list all file mapping handles in Win32(64)?","body":"<p>How to list all the file mappings that were created/opened using CreateFileMapping()/OpenFileMapping?</p>\n"},{"tags":["c++","winapi","console","wchar-t"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":11604553,"title":"wcslen quits silently when string returned by the ReadConsoleOutputCharacterW has some particular length","body":"<p>compiler : <a href=\"http://sourceforge.net/projects/mingwbuilds/files/\" rel=\"nofollow\">http://sourceforge.net/projects/mingwbuilds/files/</a></p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string.h&gt;\n#include &lt;windows.h&gt;\nusing namespace std;\n\n  const wchar_t* readConsole(int chars_to_read) {\n    wchar_t* wcharFromConsole = new wchar_t[chars_to_read+1];\n    COORD pos = {0,0};\n    DWORD dwChars;\n    if (!ReadConsoleOutputCharacterW(\n      GetStdHandle(STD_OUTPUT_HANDLE),\n      wcharFromConsole,  // Buffer where store symbols\n      chars_to_read,     // number of chars to read\n      pos,    // Read from row=8, column=6\n      &amp;dwChars // How many symbols stored\n    ))\n    {\n      printf(\"ReadConsoleOutputCharacterW failed %d\\n\", GetLastError());\n      abort();\n    }\n    wcharFromConsole [dwChars] = L'\\0'; // Terminate, so string functions can be used\n    wstring ws = wcharFromConsole;\n    return ws.c_str();\n  }\n\nint main() {\n  for (int i = 1; i&lt;=0x3000; i++) {\n    printf(\"wcslen: %X \\n\",wcslen(readConsole(i)));\n  }\n  system(\"pause\");\n}\n</code></pre>\n\n<p>This loop ends at <code>0x1FF1</code> and pause is not called. Removing wstring seems to do away with this problem. But I need it here for functions like trimming white-space etc.. it is not much relevant here, but why invoking wstring causes that issue anyway ? There is no error message the program simply quits.</p>\n\n<p>Updated code, now loop quits at <code>0x2BBF</code></p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string.h&gt;\n#include &lt;windows.h&gt;\nusing namespace std;\n\n  const wchar_t* readConsole(int chars_to_read) {\n    wchar_t* wcharFromConsole = new wchar_t[chars_to_read+1];\n    COORD pos = {0,0};\n    DWORD dwChars;\n    if (!ReadConsoleOutputCharacterW(\n      GetStdHandle(STD_OUTPUT_HANDLE),\n      wcharFromConsole,  // Buffer where store symbols\n      chars_to_read,     // number of chars to read\n      pos,    // Read from row=8, column=6\n      &amp;dwChars // How many symbols stored\n    ))\n    {\n      printf(\"ReadConsoleOutputCharacterW failed %d\\n\", GetLastError());\n      abort();\n    }\n    wcharFromConsole [dwChars] = L'\\0'; // Terminate, so string functions can be used\n    wstring ws = wcharFromConsole;\n    delete [] wcharFromConsole;\n    const wchar_t* wc = ws.c_str();\n    return wc;\n  }\n\nint main() {\n  for (int i = 1; i&lt;=0x3000; i++) {\n    printf(\"wcslen: %X \\n\",wcslen(readConsole(i)));\n  }\n  system(\"pause\");\n}\n</code></pre>\n"}]}
{"total":13828,"page":20,"pagesize":100,"questions":[{"tags":["c#","windows","winapi","user32"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":11604698,"title":"Scroll Height of a child window using Windows API?","body":"<p>Does anyone know how to get the height of a scrollable child window using Windows API? I've found GetWindowRect but that appears to only return the RECT of the \"visible\" area but I want the RECT of the entire \"scrollable\" child window. This window is a 3rd party window so I would need to use, I'm assuming, the User32 WinAPI functions.</p>\n\n<p>Thanks! </p>\n"},{"tags":["winapi","visual-c++","filesystems"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":30,"score":0,"question_id":11603670,"title":"Set EOF with WINAPI?","body":"<p>I'm working on a project with WINAPI, where I open and edit files, and sometimes a remove data, so I'm wondering if I can set the end-of-file, so when I close the handle it doesn't save the data past the EOF. Is this possible, if so, how?</p>\n"},{"tags":["c#","java","c++","winapi","keyboard"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":2,"view_count":196,"score":2,"question_id":11594693,"title":"Keyboard events: Is the order guaranteed?","body":"<p>For pressing a single key, there are multiple events that can be handled.</p>\n\n<p>There is: <code>KeyDown</code>, <code>KeyPressed</code>, <code>KeyUp</code>.</p>\n\n<p>Is it guaranteed that an application will receive those events in that order?</p>\n\n<p>What I mean is: is the order of a single key pressing event, not a series of different keys pressed.</p>\n\n<p><strong>Context:</strong></p>\n\n<p>After I had some problems with keypress-events in a legacy C++ application\nI inspected the events with <code>spy++</code>. There I saw that the order seems sometimes\nnot to be right and the <code>keypressed</code> is not fired for every <code>keydown</code>or <code>keyup</code>.</p>\n\n<p>But, I was sure that the events should be fired in exactly that order, but\ncould not find anything on the internet. So I came up with this question here.</p>\n\n<p>Please note that this is not a multiple languages problem, but I am interested whether this is true for C++, Java and C#.  </p>\n"},{"tags":["c","winapi","gui","example"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":11603049,"title":"winprog.org first example strange behavior?","body":"<p>I am talking about winprog.org's tutorial on windows GUI because many users on StackO recommended it.</p>\n\n<p>I basically tried this example:</p>\n\n<pre><code>#include \"stdafx.h\"\n#include \"winapiTest1.h\"\n\n\nint WINAPI _tWinMain(HINSTANCE hInstance,\n        HINSTANCE hPrevInstance,\n        LPTSTR    lpCmdLine,\n        int       nCmdShow)\n{\n    MessageBox(NULL, (LPCWSTR) \"Goodbye, cruel world!\", (LPCWSTR) \"Note\", MB_OK);\n    return 0;\n}\n</code></pre>\n\n<p>But when I run it, it shows the message box but every string in it (even the title) is represented in <strong>Chinese characters</strong>.</p>\n\n<p>What seems to be the problem?</p>\n"},{"tags":["winapi","gui","desktop-application","dynamic-languages"],"answer_count":8,"favorite_count":6,"up_vote_count":12,"down_vote_count":0,"view_count":1805,"score":12,"question_id":142695,"title":"High-level languages for out-of-the-box GUI desktop application programming","body":"<p>After I discontinued programming in C++ while entering into web authoring I was spoilt by PHP's high level constructs like hash tables or its dynamic, weak typing. I remembered the angst of C/C++ pointers and the maze of low-level Win32 API handles and message loops and that prevented me from utilizing environments like Code::Blocks for desktop applications. I am also not very fond of bulky, statically-typed C#/.NET environment. Any other ideas?</p>\n"},{"tags":["winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":11603013,"title":"Read a chunk of a file using WINAPI's ReadFile or something similar?","body":"<p>Well, I'm working on a project, in which I'm handling potentially big files, that I can't load into ram all at once, so I'm going to treat them like a CHS hard drive, and grab the data one 0x800 byte chunk at a time.</p>\n\n<p>My problem is, I cannot find any functions in the WINAPI that allow me to read the data from a file I've opened with CreateFile, starting at an offset.</p>\n\n<p>And yes, it must be a WINAPI function, and no, I do not want to map the whole file into memory.</p>\n\n<p>Thanks much, Bradley.</p>\n"},{"tags":["winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":10714528,"title":"Setting a single thread to real-time priority under windows","body":"<p>is it possible to set the priority of a single thread to real-time priority although the process does not run under real-time priority?</p>\n"},{"tags":["c#","winapi","handle","spy++"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3393,"score":0,"question_id":5673099,"title":"C# get child handles using FindWindowEx by name and ordinal number","body":"<p>According to <a href=\"http://msdn.microsoft.com/en-us/library/ms633500(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms633500(v=vs.85).aspx</a> I define FindWindowEx function.</p>\n\n<pre><code>using System.Runtime.InteropServices;\n\n[DllImport(\"user32.dll\", CharSet=CharSet.Unicode)]\nstatic extern IntPtr FindWindowEx(IntPtr parentHandle, IntPtr childAfter, string lclassName, string windowTitle); \n</code></pre>\n\n<p>Now I am able to find <strong>first</strong> handle of \"Button\" control (get name from Spy++) setting childAfter as <strong>IntPtr.Zero</strong>.</p>\n\n<pre><code>IntPtr hWndParent = new IntPtr(2032496);  // providing parent window handle\nIntPtr hWndButton = FindWindowEx(hWndParent, IntPtr.Zero, \"Button\", string.Empty);\n</code></pre>\n\n<p>How to get <strong>second</strong>, <strong>third</strong> or any handle of \"Button\" control inside that parent window? The fact is, button titles may vary, so I cannot find them directly by name defining fourth parameter.</p>\n"},{"tags":["windows","winapi","gui"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":11600728,"title":"Invisible border for resizing in win32api","body":"<p>I'm trying to make a window without a visible border.\nThe creation of the window is not a problem at all, but because it doesen't have a border it's not resizeable.\nIt seems that other Applications that are also shipped without borders like VS 2012 create  thin invisible borders arround their windows.\nTo achive this invisible border i could use a global mousehook to detect mouse movement outside my window and change the Cursor with the SetSystemCursor function when the mouse hits the invisible border. I would also have to trap the mouse click message inside the invisible border so that a underlying window won't be activated, but I don't know if that is possible.\nAll in all it doesen't seem to be a good solution(if the application crashes and the cursor is inside the invisible border, the cursor will keep the resizing shape), maybe someone has a better idea.</p>\n"},{"tags":["wpf","winapi","wpf-controls"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":11466253,"title":"WPF-win32 Interoperation","body":"<p>I have a win32 project which is very complex and i successfully referenced that in my wpf.<br>\nNow my Question i have created a dialogue in wpf which select a file,but the function which process this file written in win32 part of my project.  is it possible to access a particular function written in win32 part in wpf?  </p>\n"},{"tags":["winapi","gui","control"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":151,"score":2,"question_id":11599723,"title":"What is the correct way to autosize a Static control?","body":"<p>I want to adjust a Static control's size to it's content size, so I need to calculate the size of its text content first. I found a way to use <code>GetTextExtentPoint32</code> to calculate the size, but I need to set the DC's font to the same as the control's font first. Is there a better way to do this? I've set the Static control's font once, I think maybe I don't need to set the DC's font the second time.</p>\n\n<p>What is the best way to calculate the size of a Static control's text content? And Is there a better way to autosize the Static control?</p>\n"},{"tags":["c++","winapi","tabcontrol","win32gui"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":11599477,"title":"Include data with win32 TabItem","body":"<p>I am using Win32 for my GUI.</p>\n\n<p>I have TabControl and TabItem classes. The TabItem class simply holds a TCITEM struct and the TabControl->AddTab method takes a TabItem as an argument and accesses that struct.</p>\n\n<pre><code>class TabItem {\npublic:\n    TabItem(LPWSTR lpszText);\n    ~TabItem();\npublic:\n    TCITEM* GetItem();\nprivate: (... there is more data here, related to the actual page contents)\n    TCITEM* m_pItem;\n};\n\nclass TabControl {\npublic:\n    TabControl(HWND hWnd, INT iX, INT iY, DWORD dwWidth, DWORD dwHeight);\n    ~TabControl();\npublic:\n    VOID AddTab(TabItem* tiTab);\n    VOID RemoveTab(INT nIndex);\n    VOID ClearTabs();\n    VOID SetSelectedItem(INT nIndex);\n    INT GetSelectedItem();\n    INT GetFocusedItem();\n    VOID SetPadding(INT iPaddingX, INT iPaddingY);\nprivate:\n    HWND m_hWnd;\n};\n</code></pre>\n\n<p>To add a tab page:</p>\n\n<pre><code>TCITEM* TabItem::GetItem()\n{\n    return this-&gt;m_pItem;\n}\n</code></pre>\n\n<p>...</p>\n\n<pre><code>TabCtrl_InsertItem(this-&gt;m_hWnd, TabCtrl_GetItemCount(this-&gt;m_hWnd), tiTab-&gt;GetItem());\n</code></pre>\n\n<p>After the tabs have been added they can be re-arranged, moved left/right etc. The problem I have is that I need to get a handle of a TabItem class based on a tab index (ie: one returned by TabCtrl_GetSelected), as the TabItem class holds additional info on the actual contents of the tab page. I'm unsure how to do this.</p>\n"},{"tags":["c++","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":239,"score":3,"question_id":11598507,"title":"Char to int conversion?","body":"<p>I am trying to grab the rgb values from 3 editboxes so that I can change the color of a window during run time. The following code is not giving me the numeric values that I need.</p>\n\n<pre><code>        const int bufferSize = 1024;\n        char fade1Buffer[bufferSize] = \"\";\n        char fade2Buffer[bufferSize] = \"\";\n        char fade3Buffer[bufferSize] = \"\";\n\n        HWND Editbox1 = GetDlgItem(hWnd,IDC_MAINFADE1_EDIT); \n        SendMessage(Editbox1, WM_GETTEXT, (WPARAM)bufferSize, (LPARAM)fade1Buffer);\n        HWND Editbox2 = GetDlgItem(hWnd,IDC_MAINFADE2_EDIT);\n        SendMessage(Editbox2, WM_GETTEXT, (WPARAM)bufferSize, (LPARAM)fade2Buffer); \n        HWND Editbox3 = GetDlgItem(hWnd,IDC_MAINFADE3_EDIT);\n        SendMessage(Editbox3, WM_GETTEXT, (WPARAM)bufferSize, (LPARAM)fade3Buffer);\n\n        //fill our main window background\n        FadeVert(hWnd, RGB(fade1Buffer, fade2Buffer,fade3Buffer), RGB(255, 255, 255), (int) Client_Rect.top, \n            (int) Client_Rect.left, (int) Client_Rect.right, (int) Client_Rect.bottom);\n</code></pre>\n"},{"tags":["c#","winapi","sendmessage","syslistview32","quicklaunch"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":100,"score":0,"question_id":11469282,"title":"c# read syslistview32 items tooltips via winapi","body":"<p>i want to write an application, which reads under windows xp the quick launch items in the order like they are located in the taskbar,\nand sets hotkeys for each of these item.\nwindows + 1 should start the first application\nwindows + 2 the second, etc.\n(like in windows 7)</p>\n\n<p>all of these items are found i a folder, but if i read the items of this folder, i dont get the right order of these items.</p>\n\n<p>i found two solutions the get the right order - first:</p>\n\n<p>in the registry an entry is found, where its saved how they are located, but not in plain text. i dont know how to read this, and cant reverse engine it.</p>\n\n<p>the second:\nread via winapi the items tooltip from the taskbar, so i can (if there are not items with the same name) search via the name in the quick launch folder.\nthe quick launch bar is just a listview (syslistview32).\nvia sendmessage i got it work to count the items, and start one (faking a click on this item), but how the hell can i read the tooltip?\ni have googled a lot, tried everything, but i didnt get it run.</p>\n\n<p>i hope you have any snippets for me, to solve this problem.</p>\n\n<p>cheers</p>\n"},{"tags":["vb.net","winapi","system-calls"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":204,"score":3,"question_id":11567076,"title":"Get Sleep/Hibernate and Resume/Wakeup events in Visual Basic.NET","body":"<p>I have VB.NET app that communicates with some external server (maintains login sessions via Intranet), and I want to listen for Sleep/Hibernate events such that when it happens, I want to logout an existing session system before computer goes to sleep, while my app will remain running in the background but won't do anything.</p>\n\n<p>And vice versa, when computer is resumed from Hibernate or Woke up from sleep, I want to immediately login to the server.</p>\n\n<p>How can I grab those events and execute my code? I believe this relates to Win32 API which I'm supposed to use in VB.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c","menu","winapi","windows-messages"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":361,"score":1,"question_id":4433542,"title":"What's wrong with my character set (Win32 API)","body":"<p>I'm currently learning Win32 using <strong><a href=\"http://www.winprog.org/tutorial/\" rel=\"nofollow\">this tutorial</a></strong>, and I have a hard time with my displayed characters.</p>\n\n<p>Take for instance this piece of code which adds a menu to my window upon creation:</p>\n\n<pre><code>    case WM_CREATE: {\n            HMENU hMenu, hSubMenu;\n            HICON hIcon, hIconSm;\n\n            hMenu = CreateMenu();\n            hSubMenu = CreatePopupMenu();\n\n            AppendMenu(hSubMenu, MF_STRING, ID_FILE_EXIT, \"Exit\");\n            AppendMenu(hMenu, MF_STRING | MF_POPUP, (UINT)hSubMenu, \"File\");\n\n            hSubMenu = CreatePopupMenu();\n            AppendMenu(hSubMenu, MF_STRING, ID_STUFF_GO, \"&amp;GO\");\n            AppendMenu(hMenu, MF_STRING | MF_POPUP, (UINT)hSubMenu, \"&amp;Stuff\");\n\n            SetMenu(hwnd, hMenu);\n\n            hIcon = LoadImage(NULL, \"Stuff.ico\", IMAGE_ICON, 32, 32, LR_LOADFROMFILE);\n\n            if (hIcon)\n                SendMessage(hwnd, WM_SETICON, ICON_BIG, (LPARAM)hIcon);\n            else\n                MessageBox(hwnd, \"Could not load large icon!\", \"Load Error\", MB_OK | MB_ICONERROR);\n\n            hIconSm = LoadImage(NULL, \"Stuff.ico\", IMAGE_ICON, 16, 16, LR_LOADFROMFILE);\n\n            if(hIconSm)\n                SendMessage(hwnd, WM_SETICON, ICON_SMALL, (LPARAM)hIconSm);\n            else\n                MessageBox(hwnd, \"Could not load small icon!\", \"Load Error\", MB_OK | MB_ICONERROR);\n        }\n        break;\n</code></pre>\n\n<p>That is inside of a <code>switch</code> block within my <code>WndProc</code> function that handles the Windows Messages received from the Message Loop.</p>\n\n<p>Each string that is to be displayed:</p>\n\n<pre><code>\"Exit\"\n\"File\"\n\"&amp;GO\"\n\"&amp;Stuff\"\n</code></pre>\n\n<p>Is unreadable at runtime as they are displayed as little squares, just like the codepage was not the right one or something like that. When I run the tutorial, all the strings are correctly displayed. I tend to stick exactly to what the tutorial says to help me get the thing right, and its pedagogy is good. Anyway!...</p>\n\n<p>I'm using:</p>\n\n<ol>\n<li>Microsoft Visual Studio 2008 Team System;</li>\n<li>Microsoft Windows Server 2003 using RDP;</li>\n<li>Local OS is Windows Vista Ultimate.</li>\n</ol>\n\n<p>Anyone has a clue about it?</p>\n"},{"tags":["winapi","list","usb","device"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":155,"score":0,"question_id":11596843,"title":"WINAPI USB DEVICE LIST C LIBUSB not any good","body":"<p>I hope someone can help me with this issue. I made an application to read some data from a smartphone and display in an application. It worked fine at my house, so I took it to my friend's house to show him and it didn't work. So after the panic, I realized that the address had changed slightly due to being connected to a new PC not a problem there must be a simple solution on winapi. </p>\n\n<pre><code>\\\\?\\usb#vid_045e&amp;pid_0040#6&amp;ff454f2&amp;0&amp;3#{a5dcbf10-6530-11d2-901f-00c04fb951ed}\\\n</code></pre>\n\n<p>I have only found code for C++ and my app is in C so it's no use. I also found libusb on google, however this doesn't return the full paths like in my example above. </p>\n\n<p>Is there a simple fix like search by GUID? Hope you can help.</p>\n\n<p>BR</p>\n\n<p>This was the LIBUSB I used </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;windows.h&gt;\n#include &lt;libusb.h&gt;\n\nstatic void print_devs(libusb_device **devs)\n{\n    libusb_device *dev;\n    int i = 0;\n\n    while ((dev = devs[i++]) != NULL) {\n        struct libusb_device_descriptor desc;\n        int r = libusb_get_device_descriptor(dev, &amp;desc);\n        if (r &lt; 0) {\n            fprintf(stderr, \"failed to get device descriptor\");\n            return;\n        }\n\n        printf(\"%04x:%04x (bus %d, device %d)\\n\",\n            desc.idVendor, desc.idProduct,\n            libusb_get_bus_number(dev), libusb_get_device_address(dev));\n    }\n}\n\nint main(void)\n{\n    libusb_device **devs;\n    int r;\n    ssize_t cnt;\n\n    r = libusb_init(NULL);\n    if (r &lt; 0)\n        return r;\n\n    cnt = libusb_get_device_list(NULL, &amp;devs);\n    if (cnt &lt; 0)\n        return (int) cnt;\n\n    print_devs(devs);\n    libusb_free_device_list(devs, 1);\n\n    libusb_exit(NULL);\n    system(\"pause\");\n    return 0;\n}\n</code></pre>\n\n<p>This just returns for example</p>\n\n<p>1033:0194 (bus 1, device 255)</p>\n"},{"tags":["c++","winapi","mouse"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":11597310,"title":"Win32: C++ check for mouse release inside edit box","body":"<p>I am making an application, and I want to know if there is a way to check when the left mouse button is released inside of an edit control. I have searched all over and not found any way to do this other than the WM_LBUTTONUP message. Well, I tried that, and it only runs when the left mouse button is released over the main app. If I click on a button or an edit control it does not send the message. Is there any way to do this? I can check if the mouse is released in the edit control fine, but I don't know how to check when it is released in the first place. Thanks in advance for any help.</p>\n"},{"tags":["winapi","proxy","winhttp","pac"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":148,"score":1,"question_id":11448333,"title":"obtaining proxy from PAC proxy requiring authentication","body":"<p>I am attempting to use <code>WinHttpGetProxyForUrl</code> where the PAC file specified by <code>WINHTTP_AUTOPROXY_OPTIONS.lpszAutoConfigUrl</code> requires HTTP basic authentication to access.</p>\n\n<p>Is there some way to cause the regular authentication dialog to popup or to supply username and password to use for the proxy?</p>\n"},{"tags":["c","winapi","wndproc"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":187,"score":1,"question_id":11596424,"title":"WM_MOUSEMOVE message handling","body":"<p>I have the following <code>WndProc</code>:</p>\n\n<pre><code>LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM w, LPARAM l)\n{\n    switch (message)\n    {\n    case WM_DESTROY:\n        PostQuitMessage(0);\n        return 0;\n    case WM_MOUSEMOVE:\n            return 0;\n    default:\n        return DefWindowProc(hWnd, message, w, l);\n    }\n}\n</code></pre>\n\n<p>I want to prevent the the mouse from moving, so that I am attempting to discard moving message. The problem is that mouse is still moving. I have tried also <code>WM_NCHITTEST</code> and <code>WM_MOUSEHOVER</code>.</p>\n"},{"tags":["c++","winapi","gdi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":11596594,"title":"EnumDisplaySettings maximum mode number","body":"<p>How do you determine the maximum number of display modes returnable by EnumDisplaySettings without incrementing the second parameter until the function fails.</p>\n"},{"tags":["c#","winapi","dropbox","ntfs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":11596540,"title":"Uniquely identify file on Windows","body":"<p>I need to uniquely identify a file on Windows so I can always have a reference for that file even if it's moved or renamed. I did some research and found the question <a href=\"http://stackoverflow.com/questions/1866454/unique-file-identifier-in-windows\">Unique file identifier in windows</a> with a way that uses the method GetFileInformationByHandle with C++, but apparently that only works for NTFS partitions, but not for the FAT ones.</p>\n\n<p>I need to program a behavior like the one on DropBox: if you close it on your computer, rename a file and open it again it detects that change and syncs correctly. I wonder whats the technique and maybe how DropBox does if you guys know.</p>\n\n<p>FileSystemWatcher for example would work, but If the program using it is closed, no changes can be detected.</p>\n\n<p>I will be using C#.</p>\n\n<p>Thanks,</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":105,"score":1,"question_id":11596219,"title":"'INPUT' was not declared in this scope","body":"<p>I am trying to compile a program I wrote a few years ago that simulates mouse clicks and key strokes. I've reduced it to this minimal example:</p>\n\n<pre><code>#include \"Windows.h\"\n\nint main(){\n    INPUT foo;\n    return 0;\n}\n</code></pre>\n\n<p>It gives me this error:</p>\n\n<pre><code>C:\\projects\\clicker&gt;g++ minimaltest.cpp\nminimaltest.cpp: In function 'int main()':\nminimaltest.cpp:4:2: error: 'INPUT' was not declared in this scope\nminimaltest.cpp:4:8: error: expected ';' before 'foo'\n</code></pre>\n\n<p>MSDN's page on <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms646270%28v=vs.85%29.aspx\" rel=\"nofollow\">INPUT</a> says it's defined in Windows.h, so I don't know why it doesn't recognize the type.</p>\n\n<p>Another stackoverflow user had a similar problem <a href=\"http://stackoverflow.com/questions/3268252/strange-compiler-errors-with-codeblocks\">here</a>, but their solution, adding <code>#define _WIN32_WINNT 0x0500</code>, didn't fix the errors.</p>\n\n<p>I was able to build the program years ago on windows XP. Could it be that INPUT doesn't work on Windows 7 the way it did on XP? Or maybe I forgot to supply a flag to the compiler?</p>\n"},{"tags":["c++","winapi","gui"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":98,"score":-1,"question_id":11595357,"title":"\"complete\" reference for GUI design using winapi","body":"<p>Although we have lots of source on internet, but sometimes it just doesn't work as we want. Is there any good book which focus on GUI design using winapi? In fact, I need to have a main window with several child windows.</p>\n"},{"tags":["c++","winapi","console"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":80,"score":0,"question_id":11594751,"title":"function called multiple times causes program to exit with enigmatic error","body":"<p>I isolated the problem to this code:</p>\n\n<pre><code>#include &lt;windows.h&gt;\nusing namespace std;\n\nconst wchar_t* readLine(int posX, int posY, int len) {\n  wchar_t* wcharFromConsole = new wchar_t[len];\n  COORD pos = {posX,posY};\n  DWORD dwChars;\n  ReadConsoleOutputCharacterW(GetStdHandle(STD_OUTPUT_HANDLE),\n    wcharFromConsole,  // Buffer where store symbols\n    len,     // Read len chars\n    pos,    // Read from row=8, column=6\n    &amp;dwChars);  // How many symbols stored\n  wcharFromConsole [dwChars] = L'\\0'; // Terminate, so string functions can be used\n  return wcharFromConsole;\n}\n\nint main() {\n  for (int i = 0; i &lt;= 63; i++) {\n    readLine(0,0,80);\n  }\n  system(\"pause\");\n}\n</code></pre>\n\n<p>The thing is if the loop is running less than 63 times it works, if length of chars loaded from console is less than 80 it also works... I have no Idea what is happening here. Are there any resources I must explicitly close... but why, if a function closes it should close also all of its resources. But what is happening here I have no idea, the compiled program (without any error) exits before silently <code>system()</code> function. There were other error codes as I removed portions of code from my project, sometimes it was that program requested termination in a unusual way, at other times program hanged and stopped accept keyboard input.</p>\n\n<p>--\nedit:</p>\n\n<p>I've updated the code according to suggestions:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;windows.h&gt;\n\nusing namespace std;\n\nconst wchar_t* readLine(int posX, int posY, int len) {\n  wchar_t* wcharFromConsole = new wchar_t[len];\n  COORD pos = {posX,posY};\n  DWORD dwChars = 0;\n  if(!ReadConsoleOutputCharacterW(GetStdHandle(STD_OUTPUT_HANDLE),\n    wcharFromConsole,  // Buffer where store symbols\n    len,     // Read len chars\n    pos,    // Read from row=8, column=6\n    &amp;dwChars))  // How many symbols stored\n  {\n    cout &lt;&lt; \"ReadConsoleOutputCharacterW failed, code\" &lt;&lt; GetLastError() &lt;&lt; endl;\n  }\n  wcharFromConsole [dwChars] = L'\\0'; // Terminate, so string functions can be used\n  return wcharFromConsole;\n}\n\nint main() {\n  for (int i = 0; i &lt;= 100; i++) {\n    cout &lt;&lt; \"loop count: \" &lt;&lt; i &lt;&lt; endl;\n    readLine(0,0,80);\n  }\n  system(\"pause\");\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>loop count: 0\nloop count: 1\nloop count: 2\nloop count: 3\n// [...]\nloop count: 63\nloop count: 64\n\nThis application has requested the Runtime to terminate it in an unusual way.\nPlease contact the application's support team for more information.\n</code></pre>\n\n<p>(The first snipped didn't produce any error at all.)</p>\n"},{"tags":[".net","vb.net","winapi","messagebox"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":220,"score":0,"question_id":11594262,"title":"VB.NET - MessageBox, is this a function?","body":"<p>I've been researching this, but i wanted some input from the community in regards to the MessageBox <code>class</code> provided in VB.NET.</p>\n\n<p>From my point of view and current understanding, i see <code>MessageBox</code> as a <code>Class</code>, mainly because in VS2010 shows it as a class. I see that we have methods within this class and properties. How come many websites, tutorials, books call this a Function?? Even MSDN calls it the <code>MessageBox</code> function. Is it simply because this is part of the WINAPI?</p>\n\n<p>Another question that arises now that i look at the MessageBox class in VB.NET a bit closer, how come we don't have to create an object of type Messagebox prior to using it. It appears that we can just call the Messagebox class and bring up the \"Show\"method...</p>\n\n<p>I'm still in the beginner stages of fully understanding the OOP Concept and i wouldn't mind technical explanations in regards to this particular topic. </p>\n\n<p>I was reading over the MSDN page for the MessageBox Function which is what originally triggered me to asked this question.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms645505(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/ms645505(v=vs.85).aspx</a></p>\n\n<p><strong>In Conclusion, my question:</strong>\n<em>Why is \"MessageBox\" considered a function in VB.NET when VS2010 intellisense shows it as a Class?</em></p>\n"},{"tags":["c++","winapi","pixels"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":11592544,"title":"Fast pixel drawing on the screen","body":"<p>I need to fill a window with pixels, very fast of course.\nThis is for an 'old school' project with software 3D graphics (proof of concept).</p>\n\n<p>The requirements are:</p>\n\n<ul>\n<li><p>Pointer to the screen buffer to write colors and a method to display it</p></li>\n<li><p>No OpenGL, Direct3D or SDL</p></li>\n<li><p>Pure WinAPI</p></li>\n</ul>\n\n<p><strong>Question: How do I draw pixels on a window with WinAPI?</strong></p>\n"},{"tags":["c++","winapi","hook","message-loop"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":10795373,"title":"role of message loop in this program  ? and few more questions","body":"<p>The following code works fine. It gives out the message when the user presses a key. But there are certain things i am not aware of. What is the role of <a href=\"https://en.wikipedia.org/wiki/Message_loop_in_Microsoft_Windows\" rel=\"nofollow\">Message Loop here </a> ? I read that calling <code>SetWindowsHookEx(...)</code> registers a function with the windows and windows calls the appropriate function automatically when a event of registered type happens. No doubt that i don't see the output if don't give the message loop it's space.</p>\n\n<pre><code>#include&lt;iostream&gt;\n#include &lt;windows.h&gt;\nusing namespace std;\n\nHINSTANCE hinst = NULL;\nstatic HHOOK handleKeyboardHook = NULL;\nstatic LRESULT CALLBACK LowLevelKeyboardProc(int nCode, WPARAM wParam, LPARAM lParam);\n\nvoid setWinHook() {\n  handleKeyboardHook = SetWindowsHookEx(WH_KEYBOARD_LL, LowLevelKeyboardProc,NULL, 0);\nif(handleKeyboardHook == NULL) {\n    cout &lt;&lt; \"is NULL\";\n} else {\n    cout &lt;&lt; \"is not NULL\";\n}\n  cout&lt;&lt;(\"Inside fucntion setWinHook !\");\n}\n\nstatic LRESULT CALLBACK LowLevelKeyboardProc(int nCode, WPARAM wParam, LPARAM lParam) {\n cout &lt;&lt; (\"You pressed a key !\\n\");\n  return CallNextHookEx(handleKeyboardHook, nCode, wParam, lParam);\n}\n\nint WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)\n{\n handleKeyboardHook = SetWindowsHookEx(WH_KEYBOARD_LL, LowLevelKeyboardProc, hInstance, 0);\n MSG msg;\n while(GetMessage(&amp;msg, NULL, 0, 0))\n {\n   TranslateMessage(&amp;msg);\n   DispatchMessage(&amp;msg);\n }\n return msg.wParam;\n}\n</code></pre>\n\n<p><em><strong>EDIT</strong></em></p>\n\n<p>Does exiting the program <em>(closing the console window)</em> unregister the hook ?</p>\n\n<p><em><strong>EDIT 2</strong></em></p>\n\n<p>what role does <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms644934%28v=vs.85%29.aspx\" rel=\"nofollow\">Dispatch Message</a> play here ? According to doc it dispatches a message to window procedure,but here even if i exclude that,it doesn't effect the output.</p>\n"},{"tags":["c++","c","winapi","win32gui"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":11589340,"title":"C++ Win32 application continuously crashes when working with static text control. Can't figure out why","body":"<pre><code>SendMessage(hEditControl, WM_GETTEXT,255,(LPARAM)editbuffer);\n GetWindowText(hTextControl, (LPWSTR)allText,GetWindowTextLength(hTextControl));\n\n//allText = appendStrings((char*)TEXT(\"whatever\"), (char*)TEXT(\"whatever\"));\nSetWindowText(hTextControl, (LPCWSTR)allText);\n\n//where editbuffer and allText are defined as:\n\n    static WCHAR*       editbuffer;\n    static WCHAR*       allText;\n</code></pre>\n\n<p>where hEditControl is the handle to an edit control and hTextControl is a handle to a static text control. I want to take the data from the edit control and append it to the static control text. But my program crashes at the getwindowtext function and I can't figure out why. Even without the appendstring function, it still crashes. By the way, this code is in my message processing function for the main window.</p>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":11587721,"title":"Retrieve window position of maximized minimized window","body":"<p>Consider this situation:</p>\n\n<ul>\n<li>on a multi-monitor system,</li>\n<li>an application was maximized, then minimized,</li>\n<li>in my application I have the HWND of the main window of above application</li>\n</ul>\n\n<p>Now, how can I determine which monitor the window will show on when restored from minimized state? GetWindowRect and GetWindowInfo results in negative values, and apparently the same for all monitors. GetWindowPlacement gives good values in rcNormalPosition, but these are the coordinates the application returns to when un-maximized, which could be partly or wholly on another monitor.</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":90,"score":-2,"question_id":11580731,"title":"Window Creation Issue","body":"<p>Can anybody tell me what is wrong with my window creation? This function is being called from within the main function, and it all compiles and runs fine. However, the window which is rendered is not a window at all, but just a big white square.\nHere is my window creation function:</p>\n\n<pre><code>/**\n *  handles everything for initialising a window\n *\n *  @param  hInst               unique handle of window instance\n *  @param  hPrevInst           legacy parameter for copying memory from other instance into this one\n *  @param  cmdLine             commands application is started with\n *  @param  cmdShow             specifies how program should be displayed (maximised, minimized, or hidden)\n */\nint Window::Init (HINSTANCE hInst, HINSTANCE hPrevInst, PSTR cmdLine, int cmdShow)\n{\n    //  name of application\n    static TCHAR    appName[]       = TEXT (\"App\");\n\n    //  contains window class information\n    WNDCLASSEX      wndC;\n\n    //  window handle\n    HWND            hWnd;\n\n    //  define the windows class information\n    wndC.cbSize                 = sizeof (WNDCLASSEX);          //  specifies the size of the structure (in bytes)\n    wndC.style                  = CS_HREDRAW | CS_VREDRAW;      //  employs window class style to redraw if any resizing occurs\n    wndC.lpfnWndProc            = WndProc;                      //  pointer to the window procedure function\n    wndC.cbClsExtra             = 0;                            //  number of extra bytres to allocate for window class\n    wndC.cbWndExtra             = 0;                            //  number of extra bytes to allocate per window instance\n    wndC.hInstance              = hInst;                        //  handle to instnace conatining window procedure for this class\n    wndC.hIcon                  = NULL;                         //  handle to large 32x32 (shown when alt + tab)\n    wndC.hCursor                = LoadCursor (NULL, IDC_ARROW); //  handle to class cursor resource\n    wndC.hbrBackground          = (HBRUSH) (COLOR_WINDOW + 1);  //  handle to class background brush (for painting background)\n    wndC.lpszMenuName           = NULL;                         //  pointer to string with name of class menu (no default menu)\n    wndC.lpszClassName          = appName;                      //  specifies windows class name\n    wndC.hIconSm                = NULL;                         //  handle to small 16x16 icon (top left corner of window)\n\n    //  registers window class with system, will terminate is parameter is invalid\n    if (!RegisterClassEx (&amp;wndC))   return 0;\n\n    //  rect used for defining window\n    RECT            wndRc;\n\n    //  calculate size of window based on entire client window size\n    wndRc.left                  = 0;\n    wndRc.top                   = 0;\n    wndRc.right                 = 800;\n    wndRc.bottom                = 600;\n\n    long            tStyle      = 0;\n\n    //  style chosen based on whether this window is fullscreen\n    if (mFullScreen)\n        tStyle                  = WS_POPUP;\n    else\n    {\n        tStyle                  = WS_OVERLAPPEDWINDOW;\n        //  calculates required size of window rectangle, based on desired client-rectangle size\n        AdjustWindowRect (&amp;wndRc, tStyle, FALSE); \n    }\n\n    //  now class is registered, we create a window with it\n    hWnd                        = CreateWindowEx (0, appName, appName, WS_POPUP, CW_USEDEFAULT, CW_USEDEFAULT, \n                                    wndRc.right - wndRc.left, wndRc.bottom - wndRc.top, NULL, NULL, hInst, NULL);\n    //  check we have a valid handle\n    if (hWnd == NULL)               return 0;\n\n    //  show window and update it (cmdShow allows user to specify whether they want window to start maximised, minimised, etc.)\n    ShowWindow (hWnd, cmdShow);\n    UpdateWindow (hWnd);\n\n    //  if we fail to create the direct x device send an error message and terminate\n    if (DirectDraw::GetInstance()-&gt;CreateDevice (hWnd, 800, 600, mFullScreen) != 1)\n    {\n        MessageBox (hWnd, \"Failed to create surfaces\", \"Error\", MB_OK);\n        return 0;\n    }\n\n    //  adds rectangle to the specified window's update region (portion of window to be redrawn)\n    InvalidateRect (hWnd, NULL, TRUE);\n\n    return 1;\n}\n</code></pre>\n"},{"tags":["winapi","opengl","2d","nvidia"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":165,"score":-4,"question_id":10865850,"title":"somewhat hidden 2d acceleration on modern cards","body":"<p>As far as It is talked modern cards mainly support 3d graphisc \nhardware acceleration (on top of it ogl and dx interfaces are build)</p>\n\n<p>Some say almost that it is the only real way to use graphics \non modern cards and it is really no way to do classicakl 2d\ngraphics on modern cards</p>\n\n<p>The last must be false I think, because say for eample windows\ndesktop is an example of some (out of 3d) 2d mode, I do not think \nit is really an orthogonal projection 2d textyred quad - but this mode \nis 'out of' open gl and direct x </p>\n\n<p>I had read somewhere some small info that this somewhat mysterious 2d \nmode is even in some extend hardware accelerated (but somewhat poorly and \nit varies on nvidia and ati)</p>\n\n<p>My question is how to get much more info about this mysteruious\n2d mode and acceleration? In what extent there exist such one? \nHow to use it?</p>\n\n<p>(I would like to find out about and use such 2d hardware acceleration \nto maximal extent in writing 2d graphics on windows especialy through \nsome 'open' interface  ) </p>\n\n<p>(maybe last direct2d has something to do with it, but I have read some \ncritics about direct2d (and to be honest I do not like directx, \nI am closer to be open gl guy and I  want to do extremmaly fast \naccelerated 2d on PC/win)</p>\n\n<ol>\n<li>is there some <em>2d</em> mode on modern cards or even windows desktop is a quad texture in 3d?</li>\n<li>if so how to use <em>2d</em> mode (and even 2d acceleration) on modern cards, especialy in cooperation with open gl (without directx and so)?</li>\n</ol>\n"},{"tags":["windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":82,"score":2,"question_id":11586819,"title":"How to detect when new hardware is connected in Windows?","body":"<p>Is there a mechanism in Windows that allows applications to detect when new hardware is connected to the system? In particular I would like to detect:</p>\n\n<ul>\n<li>any serial ports being connected/disconnected</li>\n<li>my custom USB-to-I2C board which uses WinUSB</li>\n</ul>\n"},{"tags":["delphi","winapi","serial-port"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":203,"score":2,"question_id":11579216,"title":"Getting friendly name of serial port from Windows Message in Delphi","body":"<p>I am having a problem acquiring the friendly name (dbcp_name) from DEV_BROADCAST_PORT using delphi.</p>\n\n<p>I have tried using the microsoft help documentation which says it is a pointer to a null terminated string, but on that page there is a comment which indicates it is a variable-length structure, and dbcp_name is an array that contains the actual characters of the port name.</p>\n\n<p>I have tried to extract this but I currently have not found a way as when I get it to return anything it is complete gibberish.</p>\n\n<p>The code I have used follows:</p>\n\n<pre><code>PDevBroadcastPort = ^DEV_BROADCAST_PORT;\n\nDEV_BROADCAST_PORT = packed record\n    dbcp_size : DWORD ;\n    dbcp_devicetype : DWORD;\n    dbcp_reserved : DWORD ;\n    dbcp_name : array[0..0] of ansichar; //TCHAR dbcp_name[1]; not valid\nend;\n</code></pre>\n\n<p>I have tried different values for the length of the array, I had read somewhere that this was the correct declaration but I am not entirely sure. Also the commented out line is what the microsoft document gives for the line in C++</p>\n\n<p>To extract the information I have tried this:</p>\n\n<pre><code>var\n  PData: PDevBroadcastPort;\n\n  FName: string;\n\n  ...\n\n  PData := PDevBroadcastPort(Msg.lParam);\n\n  ShowMessage('Length '+Inttostr(length(PData^.dbcp_name)));\n\n  FName := '';\n\n  i:=0;\n\n  while((PData^.dbcp_name[i]) &lt;&gt; #0) and (i &lt; 100) do\n      begin\n          FName := FName + (PData.dbcp_name[i]);\n\n          i := i +1;\n\n          ShowMessage(FName); \n      end;\n</code></pre>\n\n<p>I have tried setting the while loop to terminate at the length of the data structure but if I dont set it then it becomes huge.</p>\n\n<p>Any help is appreciated and if I have left out any code which is needed for this question please let me know and I shall acquire it as soon as I can.</p>\n\n<p>Thanks</p>\n"},{"tags":["c++","winapi","uac","shellexecute","createprocess"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":519,"score":1,"question_id":11586139,"title":"How to run application which requires admin rights from one that doesn't have them","body":"<p>I've been stuck on this for a few hours until I've finally managed to do it. There are already links which pointed me the right direction:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/8915744/is-it-possible-for-the-executable-to-ask-for-administrator-rights-windows-7\">Is it possible for the executable to ask for Administrator rights? (Windows 7)</a></p>\n\n<p><a href=\"http://stackoverflow.com/questions/5853529/createprocess-error-740-the-requested-operation-requires-elevation\">CreateProcess error=740, The requested operation requires elevation</a></p>\n\n<p>But I've thought that simple overview of the problem could help someone :).</p>\n"},{"tags":["c++","winapi","pointers","printing"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":126,"score":0,"question_id":11571507,"title":"Print to Win32 screen","body":"<p>I want to print to a win32 screen using TextOut function when i send a WM_PAINT message, i am an ASM coder and ive been fighting a lot to understand typecast on C++.</p>\n\n<p>In theory i need a global buffer that store mine strings and display the lines one by one when i get a WM_PAINT message, problem is i read that is no good to use global variables. So is there another approach to print to screen without using a global buffer for store mine strings?.</p>\n\n<p>Also here is mine another problem:</p>\n\n<pre><code>PrintLines *PaintArray[MAX_PRINT_LINES];\nint CurrentLine;\n\n    void Print(HWND hWnd, int rgb, const char* string, ...)\n    {\n        MSG msg;\n        char buff[MAX_LINE_CHARS];\n        if (CurrentLine &gt;= MAX_PRINT_LINES)\n        {\n            CurrentLine = 0;\n            memset (*PaintArray, NULL, sizeof PaintArray);\n            InvalidateRect(hWnd, NULL, TRUE);\n        }\n        va_list argList;\n        va_start(argList, string);\n        PaintArray[CurrentLine]-&gt;stringlen = vsprintf(buff, string, argList);\n        va_end (argList);\n        PaintArray[CurrentLine]-&gt;rgb = rgb;\n        CurrentLine+=1;\n        msg.hwnd = hWnd;\n        msg.message = WM_PAINT;\n        DispatchMessage(&amp;msg);\n    }\n</code></pre>\n\n<p>When i debug the call to vsprintf i see:</p>\n\n<pre><code>00412AD3   8B15 98B34100    MOV EDX,DWORD PTR DS:[CurrentLine]\n00412AD9   8B0495 20B34100  MOV EAX,DWORD PTR DS:[EDX*4+PaintArray]\n00412AE0   50               PUSH EAX\n00412AE1   FF15 6CC44100    CALL DWORD PTR DS:[&lt;&amp;MSVCR110D.vsprintf&gt;&gt;; MSVCR110.vsprintf\n</code></pre>\n\n<p>The <strong>EDX*4+Offset PainArray</strong> tells me its an array that point to the actual class array i want (wich is good), but when debugging its initialized to 0. How can i initialize it?</p>\n\n<p>Also how i can make compiler do this:</p>\n\n<pre><code>MOV Edx, CurrentLine\nImul Edx, Edx, SizeOf PrintLines\nAdd Edx, Offset PaintArray\n</code></pre>\n\n<p>thanks !</p>\n"},{"tags":["windows","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":11584042,"title":"Inverse of AdjustWindowRectEx()?","body":"<p>The WinAPI function AdjustWindowRectEx() gives me the window rectangle based on a client rectangle and window style, without actually having a window handle:\n<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms632667(v=vs.85).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/ms632667(v=vs.85).aspx</a></p>\n\n<p>Is there a function that can give me the client rectangle based on the window rectangle and style without a window handle?</p>\n\n<p>My goal is to get the size of the restored client rectangle when minimized. I already know how to get the restored window rectangle:\n<a href=\"http://stackoverflow.com/questions/4396109/getting-the-size-of-a-minimized-window\">Getting the size of a minimized window</a></p>\n"},{"tags":["winapi","bluetooth","windbg","device-driver"],"answer_count":1,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":227,"score":5,"question_id":9336492,"title":"Instrument a Windows 7 Bluetooth stack","body":"<p>I'm working with various (mostly Bluetooth) development boards (ConnectBlue, Ubertooth, USRPs etc.) in order to research about Bluetooth communication behaviour at PHY level. In order to get some more insights I'm looking for a way to debug the Bluetooth stack on a Windows 7 Desktop computer. My use-case is relatively simple: I have custom baseband implementations, which establish connections with the Windows computer. I'd like to see everything the Bluetooth hardware/driver does.</p>\n\n<p>I'm not sure how to approach this: I'd like to see when the Bluetooth Chip/Windows driver receives a Signal, and how it (the message) gets interpreted/formatted/passed through the various APIs concerned. Mostly this relates to kernel debugging. \nIs there a way to display the state of the attached hardware in Windows in WinDBG? Maybe to perform (Kernel) API logging on the Bluetooth kernel service? </p>\n\n<p>I hope somebody more familiar with device driver debugging and Windows Kernel services can give me some pointers here.</p>\n"},{"tags":["winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":11583193,"title":"Windows analog of _NET_WM_USER_TIME","body":"<p>Is there an analog of <code>_NET_WM_USER_TIME</code> property in Win32 or other way to get list of windows sorted by last used time?</p>\n"},{"tags":["c++","winapi","bitblt"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":11555840,"title":"Why does BitBlt hang?","body":"<p>I am writing C++ code to automatically take screenshots of my favorite game.  Part of my code looks like this:</p>\n\n<pre><code>SelectObject(hCDC, shot);\nBitBlt(hCDC, 0, 0, WIDTH, HEIGHT, hDDC, 0, 0, SRCCOPY);\nSelectObject(hCDC, oldBitmap);\nBitmap shotBitmap(shot, NULL);\n</code></pre>\n\n<p>I had previously initialized the relevant variables, like this:</p>\n\n<pre><code>HDC hDDC = GetDC(handle);\nHDC hCDC = CreateCompatibleDC(hDDC);\nHBITMAP shot = CreateCompatibleBitmap(hDDC, WIDTH, HEIGHT);\nHBITMAP oldBitmap = (HBITMAP) SelectObject(hCDC, shot);\n</code></pre>\n\n<p>For no apparent reason, the code hangs at the BitBlt function until something (but I don't know what) updates.  The millisecond I click a button in the game, or click on a window outside the game, BitBlt finishes and the rest of the code executes flawlessly.  Mysteriously, I've only run into this problem recently; it never happened before.  Even more mysteriously, it only happens on my laptop, not on my friend's.  What could be happening?</p>\n"},{"tags":["windows","api","winapi","operating-system"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":1,"view_count":126,"score":4,"question_id":11573741,"title":"Would it be possible for Microsoft to phase out the Win32 API in future versions?","body":"<p>I like to use Win32, even in the age of .Net, MFC and touch. My co-worker said to me that it might not be possible to use the Win32 API in future versions of Windows (After Windows 9 ), because Microsoft might \"depreciate\" it. </p>\n\n<p>However, this seems impossible to me, because windows itself uses so much of that API. If they got rid of the low level Win32 C library, the operating system would itself stop working, and they would have to recode a great portion of the Operating System (Not to mention all the code that would be broken). </p>\n\n<p>Anyway, I don't know much about this stuff, does anyone have any technical understanding on if this is impossible or not? </p>\n\n<p>Also, note that I'm <strong><em>not</em></strong> asking if windows <em>will</em> depreciate/phase out/whatever the low level API in the future, I know that's speculative. My specific question regards how <strong>feasible</strong> it would be for Microsoft to do this, assuming they wanted to. </p>\n"},{"tags":["java","c++","winapi","jni","exe"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":161,"score":1,"question_id":4776794,"title":"Modify exe resource using Java?","body":"<p>I need to modify the string table of a win32 exe using Java.  I'm wondering if a library that does this exists, free or otherwise.</p>\n\n<p>If there is no existing lib, how should I go about doing this?  Should I use JNI to call the win32 api functions (BeginUpdateResource, etc)?</p>\n\n<p>thanks!</p>\n"},{"tags":["c#",".net","c++","winapi","exe"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":353,"score":1,"question_id":4560423,"title":"String Table Resource in Native Executable","body":"<p>Using C#, can I modify the string table resource of a native windows executable?</p>\n"},{"tags":["c++","c","windows","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":223,"score":0,"question_id":7395570,"title":"Replace Version Info Resource","body":"<p><br>\nI'm Loading a certain Exe in My Program and I'm trying to replace It's Version Info Resource.<br>\nI'm Using UpdateResource() but for some reason It isn't replacing the original resource as it is supposed to do.<br></p>\n\n<pre><code>UpdateResource(hHandle,RT_VERSION,\"1\",MAKELANGID(LANG_ENGLISH,SUBLANG_ENGLISH_US),pRsrcMemory,rsrcSize)\n</code></pre>\n\n<p>When The Exe is opened in a resource editor , I see two version Info resources with the same ID 1 , But the Version Info Displayed in Windows Explorer is the Original Info.(Probably because it comes first in the .rsrc section of the exe but i'm not sure)<br></p>\n\n<p>Any Help is appreciated.</p>\n"},{"tags":["c#","c++","c","winapi","resources"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":306,"score":2,"question_id":7049295,"title":"Win32 resource editor library?","body":"<p>Is there any free library out there that can provide editing capabilites for resources in Win32 PE files?</p>\n\n<p>It needs to be able to do the following:</p>\n\n<ul>\n<li><p>Provide a <em>reasonably simple</em> API for altering <strong>dialog</strong> resources (<em>including</em> the \"extended\" dialog version, <a href=\"http://msdn.microsoft.com/en-us/library/ms645398%28v=vs.85%29.aspx\" rel=\"nofollow\">which is poorly documented</a>).<br>\nEditing dialogs with <code>UpdateResource</code> by hand is a major pain in the rear, since most of the structures' fields are variable-length, and encoding/decoding them is very error-prone and time consuming to code.</p></li>\n<li><p>Handle <strong>both</strong> 32-bit and 64-bit PE files</p></li>\n<li><p>Have support for widely used resource types (string tables, bitmaps, etc.)</p></li>\n<li><p>Be able to handle <em>any</em> kind of valid resource (even if it's not widely used), even if that means just providing a simple copy to/from binary.</p></li>\n<li><p>I don't care about .res files, and I really don't need .rc functionality. I just need PE editing.</p></li>\n</ul>\n\n<p>C, C++, and C# are all fine, although I prefer C# since it's easier to code with. My main concern is dialog editing for 32-bit and 64-bit PE files, so that's the most important factor.</p>\n"},{"tags":["winapi","keyboard"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":10398072,"title":"KbdLayerDescriptor returns NULL at 64bit architecture","body":"<p>im writing a complex program that analyses users writing, and i have problem when running this application on 64bit OS.\nHere is the code you can run to re-interprate the problem.\n<a href=\"http://thetechnofreak.com/technofreak/keylogger-visual-c/\" rel=\"nofollow\">http://thetechnofreak.com/technofreak/keylogger-visual-c/</a>\nbut of course, you need to have 64bit OS, since the program runs correctly on 32bit OS.</p>\n\n<p>after this call</p>\n\n<pre><code>pKbd = pKbdLayerDescriptor();\n</code></pre>\n\n<p>this pointer equals NULL</p>\n\n<pre><code>pKbd-&gt;pVkToWcharTable\n</code></pre>\n\n<p>I have tried to google the solution first, and i found this\n<a href=\"http://www.codeproject.com/Questions/211107/RegQueryValueEx-programcrash-on-64-Bit\" rel=\"nofollow\">http://www.codeproject.com/Questions/211107/RegQueryValueEx-programcrash-on-64-Bit</a>\nits the exact same problem as i have, but there seem not to be a solution.\nSo do you have any ideas what can be wrong ?</p>\n\n<p>There is this piece of code in the program and it seems that it takes care of the size differences between pointers on 32 and 64bit architecture</p>\n\n<pre><code>#if defined(BUILD_WOW6432)\n#define KBD_LONG_POINTER __ptr64\n#else\n#define KBD_LONG_POINTER\n#endif\n</code></pre>\n\n<p>But clearly, its not helping.</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":657,"score":0,"question_id":2635609,"title":"Error while Trying to Hook \"TerminateProcess\" Function. Target Process crashes. Can anyone help me?","body":"<p>Debugging with visual studio 2005 The following Error Displayed :Unhandled exception at 0x00000000 in procexp.exe: 0xC0000005: Access violation reading location 0x00000000.</p>\n\n<p>And Thread Information:     </p>\n\n<blockquote>\n  <p>2704    Win32 Thread    00000000    Normal  0</p>\n</blockquote>\n\n<pre>\nextern \"C\" VDLL2_API BOOL WINAPI MyTerminateProcess(HANDLE hProcess,UINT uExitCode)\n{\n     SetLastError(5);\n     return FALSE;\n}\n</pre>\n\n<pre>\nFARPROC HookFunction(char *UserDll,FARPROC pfn,FARPROC HookFunc) \n\n{\n    DWORD dwSizeofExportTable=0;\n    DWORD dwRelativeVirtualAddress=0;\n    HMODULE hm=GetModuleHandle(NULL);\n    FARPROC pfnOriginalAddressToReturn;\n    PIMAGE_DOS_HEADER pim=(PIMAGE_DOS_HEADER)hm;\n    PIMAGE_NT_HEADERS pimnt=(PIMAGE_NT_HEADERS)((DWORD)pim + \n(DWORD)pim->e_lfanew); \n    PIMAGE_DATA_DIRECTORY \npimdata=(PIMAGE_DATA_DIRECTORY)&(pimnt->OptionalHeader.DataDirectory);\n\n    PIMAGE_OPTIONAL_HEADER pot=&(pimnt->OptionalHeader);\n    PIMAGE_DATA_DIRECTORY \npim2=(PIMAGE_DATA_DIRECTORY)((DWORD)pot+(DWORD)104);\n    dwSizeofExportTable=pim2->Size;\n    dwRelativeVirtualAddress=pim2->VirtualAddress;\n    char *ascstr;\n    PIMAGE_IMPORT_DESCRIPTOR \npimexp=(PIMAGE_IMPORT_DESCRIPTOR)(pim2->VirtualAddress + (DWORD)pim);\n    while(pimexp->Name)\n    {\n        ascstr=(char *)((DWORD)pim + (DWORD)pimexp->Name);\n        if(strcmpi(ascstr,UserDll) == 0)\n        {\n            break;\n        }\n        pimexp++;\n    }\n    PIMAGE_THUNK_DATA \npname=(PIMAGE_THUNK_DATA)((DWORD)pim+(DWORD)pimexp->FirstThunk);\n    LPDWORD lpdw=&(pname->u1.Function);\n    DWORD dwError=0;\n    DWORD OldProtect=0;\n    while(pname->u1.Function)\n    {\n        if((DWORD)pname->u1.Function == (DWORD)pfn)\n        {\n            lpdw=&(pname->u1.Function);\n\nVirtualProtect((LPVOID)lpdw,sizeof(DWORD),PAGE_READWRITE,&OldProtect);\n\n\n            pname->u1.Function=(DWORD)HookFunc;\n\nVirtualProtect((LPVOID)lpdw,sizeof(DWORD),PAGE_READONLY,&OldProtect);\n\n            return pfn;\n        }\n        pname++;\n\n    }\n    return (FARPROC)0;\n}\n</pre>  \n\n<pre>\nFARPROC CallHook(void) \n{\n        HMODULE hm=GetModuleHandle(TEXT(\"Kernel32.dll\"));\n    FARPROC fp=GetProcAddress(hm,\"TerminateProcess\");\n    HMODULE hm2=GetModuleHandle(TEXT(\"vdll2.dll\"));\n    FARPROC fpHook=GetProcAddress(hm2,\"MyTerminateProcess\");\n\n    dwAddOfTerminateProcess=HookFunction(\"Kernel32.dll\",fp,fpHook);\n    if(dwAddOfTerminateProcess == 0)\n    {\n        MessageBox(NULL,TEXT(\"Unable TO Hook Function.\"),TEXT(\"Parth\"),MB_OK);\n    }\n    else\n    {\n        MessageBox(NULL,TEXT(\"Success Hooked.\"),TEXT(\"Parth\"),MB_OK);\n    }\n    return 0;\n}\n</pre>\n\n<p>Thanks in advance for any help.</p>\n\n<pre>\n004118AC  mov         esi,esp       \n004118AE  push        0         \n004118B0  mov         eax,dword ptr [hProc]     \n004118B3  push        eax        \n004118B4  call        dword  ptr[__imp__TerminateProcess@8(4181E4h)]   \n004118BA  cmp         esi,esp  // esi is zero.why ?   \n</pre>\n"},{"tags":["c++","windows","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":93,"score":2,"question_id":11577521,"title":"win32 - Second call to EM_SETTEXTEX won't properly show the appended text. Why?","body":"<p>I'm trying to append text to a rich edit control by appending the original string and resending the EM_SETTEXTEX message.</p>\n\n<pre><code>char outputText[4096] = \"{\\\\rtf1\\\\ansi\\\\ansicpg0\\\\deff0{\\\\colortbl;\\\\red0\\\\green0\\\\blue0;\\\\red255\\\\green0\\\\blue0;\\\\red50\\\\green205\\\\blue50;\\\\red255\\\\green140\\\\blue0;}TEST\";\n\nSETTEXTEX s;s.flags = ST_DEFAULT;s.codepage = CP_ACP;\nSendMessage(hOutputWndText,EM_SETTEXTMODE,(WPARAM)TM_RICHTEXT,NULL);\nSendMessage(hOutputWndText,EM_SETTEXTEX,(WPARAM)&amp;s,(LPARAM)outputText);\n</code></pre>\n\n<p>I know I do not have a closing bracket on the string but it shows what I want.</p>\n\n<pre><code>TEST\n</code></pre>\n\n<p>Now I append the string and \"re-set\" the text inside the rich edit control. Notice, I add a closing bracket just incase.</p>\n\n<pre><code>strcat_s(outputText,\"NEWSTUFF}\");\nSendMessage(hOutputWndText,EM_SETTEXTEX,(WPARAM)&amp;s,(LPARAM)outputText);\n</code></pre>\n\n<p>And the output this time.</p>\n\n<pre><code>NEWSTUFF}\n</code></pre>\n\n<p>What gives? I printed the variable outputText to the console and I get the complete string.</p>\n\n<pre><code>{\\rtf1\\ansi\\ansicpg0\\deff0{\\colortbl;\\red0\\green0\\blue0;\\red255\\green0\\blue0;\\red50\\green205\\blue50;\\red255\\green140\\blue0;}TESTNEWSTUFF}\n</code></pre>\n"},{"tags":["c++","winapi","windows-shell"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":99,"score":2,"question_id":11561401,"title":"Subclassing SHBrowseForFolder and handling WM_NOTIFY","body":"<p>I'm trying to fix SHBrowseForFolder dialog, as it doesn't react on folder renaming (<code>BFFM_SELCHANGED</code> isn't being sent and there is no way to determine is the path now correct or not). I googled a solution, which said like I have to subclass dlg's wndproc and catch <code>TVN_ENDLABELEDIT</code> to send <code>BFFM_SELCHANGED</code> myself.</p>\n\n<p>Here is how I set new wndproc when I get <code>BFFM_INITIALIZED</code>:</p>\n\n<pre><code>for (HWND hChild = GetWindow(hWnd, GW_CHILD); hChild != 0; hChild = GetWindow(hChild, GW_HWNDNEXT)) {\n    szClassName[256];\n    GetClassName(hChild, szClassName, sizeof(szClassName));\n    if (!stricmp(szClassName, \"SHBROWSEFORFOLDER SHELLNAMESPACE CONTROL\")) {\n        oldWndProc = reinterpret_cast&lt;WNDPROC&gt;(SetWindowLongPtr(hChild, GWLP_WNDPROC, reinterpret_cast&lt;LONG_PTR&gt;(_SubclassWndProc)));\n        break;\n    }\n}\n</code></pre>\n\n<p>Here is _SubclassWndProc:</p>\n\n<pre><code>static LRESULT _SubclassWndProc(HWND hWnd, UINT uMsg, WPARAM lParam, LPARAM lpData) {\n  switch (uMsg) {\n     case WM_NOTIFY:\n        switch (((LPNMHDR)lParam)-&gt;code) {\n           case TVN_ENDLABELEDIT:\n              break;\n        }\n        break;\n  }\n  return CallWindowProc(oldWndProc, hWnd, uMsg, lParam, lpData);\n}\n</code></pre>\n\n<p>It works only if I comment <code>WM_NOTIFY</code> block. Even an access to <code>lParam</code> breaks dialog (it contains corrupted treee with empty labels). If I call oldWndProc before switch, then it works, but in <code>WM_NOTIFY</code> case <code>lParam</code> obviously doesn't contain a pointer to <code>NMHDR</code>, it contains a small integer value like 1,2,100 etc.</p>\n\n<p><strong>Edit:</strong> The question can be shortened to \"Why does WM_NOTIFY come without a pointer to NMHDR?\"</p>\n"},{"tags":["c++","winapi","console"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":11568837,"title":"is there a way to simulate calls that are send to console from right-click mouse menu?","body":"<p>When right clicking on windows console a small menu shows up with commands select, select all, find etc.</p>\n\n<p>My question is there a way to do it from the program itself, for example at the end put command to select all text in console, just as user would do it with his mouse ?</p>\n"},{"tags":["c++","winapi","onpaint","editbox"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":11573816,"title":"Editbox with background color not showing text","body":"<p>I have created edit box using Win32 C++. I have subclassed it and overridden OnPaint menthod  in which I am filling it with some background color.</p>\n\n<p>Now if I enter some text I am not able to see any text but I can see cursor moving.</p>\n\n<p>If I dont put any background color I can see text in edit box.</p>\n\n<p>Any idea why I am not getting text with background color?</p>\n"},{"tags":[".net","winapi"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":105,"score":1,"question_id":9998717,"title":"What's the relation between WinAPI and .NET?","body":"<p>I'm a C# developer, and I'm trying to grasp what's the role of WinAPI on Windows development. My perception is that it is the sole exposition of the kernel itself, and that, before .NET, it was also the \"Windows development\" itself (not counting non-Microsoft technologies), but I'm not sure of none of these statements. Also, I am unsure of what is the relation of WinAPI and the .NET framework. So I got a few questions:</p>\n\n<ul>\n<li>Is the entire .NET runtime built on top of WinAPI? If so, is WinAPI really the lowest-level interface for developing on Windows?</li>\n<li>What is the role of each on Windows development (in any area, like web, business, software products, etc) nowadays?</li>\n<li>Are there more WinAPI (C/C++) developers than .NET developers nowadays?</li>\n<li>Where do WinRT enters?</li>\n</ul>\n"},{"tags":["delphi","winapi","visual-c++","msdn"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":884,"score":1,"question_id":3686201,"title":"How do you read the user's display (first and last) name on all versions of Windows reliably?","body":"<p>I have found that on Windows 7 64 bit, on a machine with a domain name, GetUserNameEx( 3, .... ) which should get the extended name format DisplayName (==3), into a buffer, works fine.</p>\n\n<p>However, it does not work on Windows 7 32 bit, vm that is on a workgroup, rather than on a domain, it returns ERROR_NONE_MAPPED.</p>\n\n<p>How do you read the person's friendly name \"Fred Smith\", for example, in a way that works on Windows? GetUserNameEx is manifestly broken. Actually, not broken, I'm told, just not intended to work for users who are not on a domain. Why not, I wonder, since the local SAM information exists? And there appears to be no other direct API to do this.</p>\n\n<p>If Windows gives you  ERROR_NONE_MAPPED, you are out of luck, and probably not on a domain.  So this is not exactly a friendly area of the API.</p>\n\n<p>[It is possible, it looks like, to call NetUserGetInfo, to read the local SAM info, when not on a domain, but you need to know the user name and password first, and then it will maybe look up the friendly name.]</p>\n\n<p><a href=\"http://stackoverflow.com/questions/3438634/how-to-get-logged-in-users-full-name-in-windows\">RElated Question: does not mention the problem here</a></p>\n"},{"tags":["winforms","multithreading","winapi","animatewindow"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":11147086,"title":"How can I use the AnimateWindow function on a separate thread?","body":"<p>How can I animate two windows at the same time? I tried:</p>\n\n<pre><code>[DllImport(\"user32.dll\", CharSet = CharSet.Auto)]\nstatic extern bool AnimateWindow(IntPtr hwnd, int time, int flags);\n...\n\nAnimateWindow(panel1.Handle, speed, AW_SLIDE | AW_HOR_Top);\nAnimateWindow(panel2.Handle, speed, AW_SLIDE | AW_HOR_Top);\n</code></pre>\n\n<p>But panel2 will not animate until panel1 finished its animation.</p>\n\n<p>I must use the threading .. but i can't even if i used invoke .. also it runs the 2nd animation after the 1st</p>\n\n<p>so how can i do it ?</p>\n"},{"tags":["c++","winapi","winrt","semaphore"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":238,"score":1,"question_id":11570336,"title":"Windows Metro mode (C++): Waiting on semaphore (WaitForSingleObjectEx): failed with Access Denied [partially solved]","body":"<p>May be this is stupid question for you .. but it doesn't work for me! (New to WinRT .. may be windows too!) Just trying to create semaphore and trying to acquire that's it .. nothing fancy. But it fails with WAIT_FAILED: 5 (Access denied)</p>\n\n<pre><code>void MainPage::simple_Sema_test1()\n{\n\n    HANDLE p_sema;\n    DWORD ret, err;\n    p_sema = CreateSemaphoreEx(NULL, 1, MAX_LIMIT, L\"sema1\", 0, SEMAPHORE_MODIFY_STATE);\n    if(p_sema == NULL)\n        print_on_textbox(\"CreateSemaphoreEx Failed!\\n\");\n    ret = WaitForSingleObjectEx(p_sema, 1000, TRUE);\n    switch(ret){\n    case WAIT_ABANDONED:\n        print_on_textbox(\"WAIT_ABANDONED\\n\");\n    case WAIT_IO_COMPLETION:\n        print_on_textbox(\"WAIT_IO_COMPLETION\\n\");\n    case WAIT_OBJECT_0:\n        print_on_textbox(\"WAIT_OBJECT_0\\n\");\n    case WAIT_TIMEOUT:\n        print_on_textbox(\"WAIT_TIMEOUT\\n\");\n    case WAIT_FAILED:\n        print_on_textbox(\"WAIT_FAILED: \" + (GetLastError()).ToString());\n}\n</code></pre>\n\n<blockquote>\n  <blockquote>\n    <blockquote>\n      <p>Edit &lt;&lt;&lt;  (Partially solved)\n      Create Semaphore with SEMAPHORE_ALL_ACCESS</p>\n    </blockquote>\n  </blockquote>\n</blockquote>\n\n<p>i.e.    </p>\n\n<pre><code>*sema = CreateSemaphoreEx(NULL, initial, MAX_LIMIT, L\"sema1\", 0, SEMAPHORE_ALL_ACCESS);\n</code></pre>\n\n<p>If anyone knows why it didn't work with modify access then please explain!</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":11570395,"title":"What is the correct input format for windows CopyFile?","body":"<p>I am trying to use the windows CopyFile function to copy one file and rename it as another in a different folder. However it always returns that there's a problem with the path even though the path I am giving it is correct and both file and folder exist. What am I doing wrong? </p>\n\n<p>Using \"C:\\Dummy.png\" as the source and \"C:\\Dest\" as the destination.  </p>\n\n<pre><code>void CreateDummyItemsAssetsPNG()\n{\n    string  DummyAsset;  \n    string  dummyDestination; \n\n    cout&lt;&lt;\"Please Provide dummy file asset that is a .png: \"; \n    cin&gt;&gt;DummyAsset; \n\n    cout&lt;&lt;\"Please Provide a Destination: \"; \n    cin&gt;&gt;dummyDestination; \n\n    vector&lt;string&gt;::iterator itor; \n    string fullDest; \n\n    for(itor = listOfItems.begin(); itor&lt;listOfItems.end(); ++itor)\n    {\n        fullDest.clear(); \n        fullDest = dummyDestination + \"\\\\\"+ (*itor)+\".png\"; \n        cout&lt;&lt;\"Copy: \"&lt;&lt;DummyAsset&lt;&lt;\" TO: \"&lt;&lt;fullDest&lt;&lt;endl; \n        if(!CopyFile(LPCTSTR(DummyAsset.c_str()),LPCTSTR(dummyDestination.c_str()),false) )\n        {\n            printf(\"Could not copy file.\\n\"); \n            cout&lt;&lt;GetLastError()&lt;&lt;endl; \n        }\n    }\n}\n</code></pre>\n\n<p>Thanks! </p>\n"},{"tags":["winapi","fonts"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":136,"score":1,"question_id":11569159,"title":"AddFontResource() vs AddFontResourceEx()","body":"<p>As can be seen <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd183326%28v=vs.85%29.aspx\" rel=\"nofollow\">here</a>, the function <code>AddFontResource()</code>requires that the app should send a <code>WM_FONTCHANGE</code> message to all top level windows in the system, but the <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/dd183327%28v=vs.85%29.aspx\" rel=\"nofollow\">AddFontResourceEx()</a> function doesn't require this. Why the difference ? </p>\n"},{"tags":["winapi","deadlock","getmodulefilename","loaderlock"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":137,"score":1,"question_id":11164897,"title":"What might getmodulefilename block on?","body":"<p>We have a multithreaded application.  One of the worker threads calls GetModuleFilename for logging purposes and we've seen a deadlock where the worker threads held a lock before calling GetModuleFilename which blocks forever.</p>\n\n<p>We can and have removed the GetModuleFilename call from inside this lock, but are still very much interested in exactly how the deadlock occurs.</p>\n\n<p>Doing some reading online:\n<a href=\"http://blogs.msdn.com/b/oldnewthing/archive/2004/01/28/63880.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/oldnewthing/archive/2004/01/28/63880.aspx</a></p>\n\n<p>it seems that GetModuleFilename will acquire the loaderlock, that seemed like a pretty good candidate for a deadlock.</p>\n\n<p>But generally threads inside the loaderlock would not be executing any of our own code, except in dllmain as per the link above.</p>\n\n<p>a dll_thread_attach or detach might be called in the loaderlock and on another workerthread which is getting created or destroyed, but i don't see any way this would try to acquire the lock we're using.</p>\n\n<p>It is also possible that the main thread tries to acquire the lock which the GetModuleFilename thread is holding, and a 3rd thread is holding the loaderlock and doing a sendmessage or something like that blocking on the main thread?  Here also i've not found any circumstances under which this would happen.</p>\n\n<p>one of the other threads which i'm suspicious of is one which uses a com object.  the thread calls coinitialize at the beginning so that should be in single threaded apartment.  any possibilities of interaction with loaderlock here?</p>\n\n<p>Anyways we've not been able to identify the exact way in which this deadlock occurs.  So i'm hoping for some ideas, or some more information about the loaderlock in terms of other cases is it being acquired, and if there are any other scenarios where code would be executed within the loaderlock which has the potential to block.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":131,"score":0,"question_id":11569533,"title":"Get the (resource) ID from hWnd","body":"<p>In ResourceHacker, when you open an executable (windows), you can see identifiers associated with dialogs. Does anyone have an idea from where they come? I mean, how can I do the same in my C++ program to get the ID from a HWND?</p>\n\n<p>BTW, GetWindowLong(hwnd, GWL_ID) returns 0.</p>\n\n<p>Thanks</p>\n"},{"tags":["c++","winapi","openprocess"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":182,"score":0,"question_id":11552170,"title":"OpenProcess iexplore.exe on other user accounts fails with Access Denied","body":"<p>I'm working on enumerating instances of iexplore.exe across all users. I'm able to get a list of the matching processes on the machine, but to identify the user, I need to use OpenProcess. This works on my own instances, but even with Run as Administrator and EnableDebugPriv, I'm still getting the access denied message. Am I missing something? Is iexplore.exe somehow protected?</p>\n\n<p>Here's what I'm using for the debug priv:</p>\n\n<pre><code>void EnableDebugPriv()\n{\n    HANDLE hToken;\n    LUID luid;\n    TOKEN_PRIVILEGES tkp;\n\n    OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &amp;hToken);\n\n    if (!::LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &amp;luid))\n    {\n        wprintf(_T(\"ERROR %u\\n\"),GetLastError());\n        CloseHandle(hToken); \n        return;\n    }\n\n    tkp.PrivilegeCount = 1;\n    tkp.Privileges[0].Luid = luid;\n    tkp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;\n\n    if (!::AdjustTokenPrivileges(hToken, false, &amp;tkp, sizeof(tkp), NULL, NULL))\n    {\n        wprintf(_T(\"ERROR %u\\n\"),GetLastError());\n        CloseHandle(hToken); \n        return;\n    }\n\n    CloseHandle(hToken);\n    wprintf(_T(\"Should have worked\"));\n}\n</code></pre>\n\n<p>No errors occur when I run this. The ACCESS DENIED error occurs when I run</p>\n\n<pre><code>hProcess = OpenProcess( PROCESS_QUERY_INFORMATION|PROCESS_VM_READ|PROCESS_TERMINATE , FALSE, pe32.th32ProcessID );\n</code></pre>\n\n<p>For processes that don't belong to me. The \"other\" users are Standard and Guest accounts created on this machine in a normal way from Control Panel. Any ideas would be much appreciated. I'm stuck! Ultimately I want to offer the user the ability to shut down the app, but even with just PROCESS_QUERY_LIMITED_INFORMATION it fails. I still need to check if this is the problem with other applications besides IE.</p>\n\n<p><strong>Update</strong> I ultimately got this to work. The error was in OpenProcessToken instead. And I needed a different privilege than I asked for.</p>\n"},{"tags":["winapi","visual-c++","file-read","windows-error-reporting"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":658,"score":2,"question_id":9128693,"title":"With respect to ReadFile() WinAPI, GetLastError is throwing the error 183. What Does \"ERROR_ALREADY_EXISTS\" mean in this context?","body":"<p>I am calling ReadFile() WinAPI to copy the file contents to a char array, inside my VC++ code. Have placed GetLastError() immediately after ReadFile().  </p>\n\n<pre><code>for( read some n no: of files)\n{\nFileRead(fp,destCharArray,ByesToRead,NoOfBytesRead,NULL);\nint ret = GetLastError();\n}\n</code></pre>\n\n<hr>\n\n<p>GetLastError() is returning 183 only when 1st file is read. For all\n other file reads its returning 183. But eventhough 183 is returned the\n contents of file are copied to charArray. And the problem is that the\n file read does not happen for some 28th file (here too return status\nis 183).  Irrespective of successful or unsuccessful file read, 183 is\n returned!</p>\n\n<p>According to <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms681382%28v=vs.85%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/ms681382(v=vs.85).aspx</a></p>\n\n<p>error code 183 means \"<strong>ERROR_ALREADY_EXISTS</strong>\".</p>\n\n<p>What does the above error status signify in ReadFile() context.? </p>\n\n<p>Can anyone kindly help me in figuring out why?</p>\n"},{"tags":["c++","c","windows","file","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":179,"score":4,"question_id":11566930,"title":"Can I allow multiple programs to read from the same file at the same time?","body":"<p>I have an application that reads a set of data files and performs some model computations.  The program does not need to modify the data files themselves, so I'm currently  opening them with the read-only flag as shown below:</p>\n\n<pre><code>FILE* file;\nif(_wfopen_s(&amp;file, fname.c_str(), L\"r\") == 0)\n...\n</code></pre>\n\n<p>I would like to have several instances of my program running at the same time, using the same set of data, but performing different computations on the data.  None of my programs need to modify the data files.  As the data files are very large, I can't make separate copies of the data to use with each program.</p>\n\n<p>I assumed that because I'm opening the files with read-only permissions, two programs could be reading from the same file at the same time.  Instead, I get various errors along the lines of \"the file could not be open because it is being used by another process\".</p>\n\n<p>As my development environment is Windows 7, <a href=\"http://stackoverflow.com/a/823525/538247\">this question suggests it might be a matter of enabling read sharing</a>.  However, all of the answers in that thread rely on <a href=\"http://msdn.microsoft.com/en-us/library/aa363858%28v=vs.85%29.aspx\" rel=\"nofollow\">CreateFile</a>, whereas I'm dealing with legacy code that was written with stdio.h.</p>\n\n<p>Is there a way I can have several programs concurrently read from a file using the fopen class of functions?</p>\n"},{"tags":["c","winapi","gcc","casting"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":11566752,"title":"How do I remove the bad cast HINSTANCE to int?","body":"<p>I'm compiling a program on gcc by using <code>-Wbad-function-cast</code> flag. The gcc show the following warning: </p>\n\n<p><code>cast does not match function type</code></p>\n\n<p>this is line of warning:  <code>int ret = (int)</code><a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb776419%28v=vs.85%29.aspx\" rel=\"nofollow\"><code>FindExecutable(file, NULL, result)</code></a></p>\n\n<p>The question is: it's possible remove it? maybe casting to another windows data type, but that I handling it as an integer. Any help is very appreciated. Thanks in advance.</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":211,"score":1,"question_id":11564594,"title":"C++ Executing DOS Commands","body":"<p>Serious Problem im having here. Need to execute normal DOS Commands (in windows) without the CMD window displaying in C++. Therefore i can not use <code>system(cmd);</code> (As the window will display)</p>\n\n<p>I have tried <code>winExec(cmd, SW_HIDE)</code> this does not work either. <code>CreateProccess</code> is another one I tried however this is for running programs or batch files.</p>\n\n<p>I have resulted in trying <code>ShellExecute()</code></p>\n\n<pre><code>ShellExecute( NULL, \"open\",\n    \"cmd.exe\",\n    \"ipconfig &gt; myfile.txt\",\n    \"c:\\projects\\b\",\n    SW_SHOWNORMAL\n);\n</code></pre>\n\n<p>Can anyone see anything wrong with the above code? I have used <code>SW_SHOWNORMAL</code> until I know this works.</p>\n\n<p>I really need some help with this. Nothing has come to light and I have been trying for quite a while. Any advice anyone could give would be great :)</p>\n"},{"tags":["c++","windows","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":11535954,"title":"Check if a directory-tree can be deleted without actually starting to delete it","body":"<p>In my program I need to be able to delete the directory with the old output. But some files inside it might be locked. In this case, I want to warn the user that he needs to close the applications that lock them before the program can proceed, with a Retry/Cancel dialog, and if the user clicks Cancel, I want the directory to stay intact.</p>\n\n<p>So, can anyone tell me of a way to check if an entire directory tree can be deleted (no locked files in any subdirectories), without modifying its contents - something like a dry-run.</p>\n"},{"tags":["python","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":11530302,"title":"Finding Handle of a control inside a window","body":"<p>Given the handle to a parent window, How can I get the handle of a button inside this window?</p>\n\n<p>I'm using <code>win32api.sendMessage( )</code> to pass values to a window. I want to use <code>BM_CLICK</code> to click on the button in question. </p>\n\n<pre><code>import win32api\nimport win32gui\nimport win32con\n\n#get handle of the window I want\n\nhwnd=win32gui.FindWindow(0,\"SOME TITLE\")\n\n#btnHnd= (NEED CODE HERE TO GET THE HANDLE OF THE BUTTON INSIDE hwnd)\n\nwin32api.SendMessage(btnHnd, win32con.BM_CLICK, 0, 0)\n</code></pre>\n"},{"tags":["c++","winapi","win64"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":11556380,"title":"Does sprintf_s have specific usage requirements for win64 vs. win32?","body":"<p>The following code snippet is an extraction and simplification of a running SW I am reverse engineering (I tried to emphasize the problem without bothering you with all the small details).</p>\n\n<p>Building the following code on a win64 machine causes crash during operation:</p>\n\n<pre><code>#include \"stdafx.h\"\n#include &lt;stdio.h&gt;\n#include &lt;string&gt;\n#include &lt;stdlib.h&gt;\n\nusing namespace std;\n\nstruct vaArgLookAlikePtrs \n{\n    char* pPtr[1000];\n};\n\nint _tmain(int argc, _TCHAR* argv[])\n{\n    typedef std::basic_string&lt;char&gt; BasicString;\n    static char buffer[132000];\n    BasicString sFormatStr = \"Var0=%s\\nVar1=%.4f\\nVar2=%d\\n\";\n    struct vaArgLookAlikePtrs oData;\n\n    void* pVoidPtr;\n    int j=0;\n\n    oData.pPtr[j] = \"val0\";\n    j++;\n\n    double dVar1 = 1.265;\n    pVoidPtr = (void*)(&amp;(oData.pPtr[j]));\n    double* pDoublePtr = (double*)pVoidPtr;\n    *pDoublePtr = dVar1;\n    j++;// increment the buffer counter twice because doubles require 64 bits for     storage (This is how it works on the 32 bit machine)\n    j++;\n\n    int nVar2 = 2;\n    pVoidPtr = &amp;(oData.pPtr[j]);\n    int* pIntPtr = (int*)pVoidPtr;\n    *pIntPtr = nVar2;\n\n    sprintf_s(buffer,sFormatStr.c_str(),oData);  // &lt;-----\n\n    cout &lt;&lt; buffer &lt;&lt; \"\\n\";\n    return 0;\n}\n</code></pre>\n\n<p>I have few questions:</p>\n\n<ol>\n<li>Why should i increment the index (<code>J++</code>) twice on win32 platform? - how does win32 platform knows to \"jump\" over a char* point twice for a double?</li>\n<li>how come sprintf_s knows to pick the right fields from oData (a composition container) on win32? but on win64 it crashes?</li>\n</ol>\n\n<p>I assume this is somehow with pointer sizes difference between 32 bit and 64 bit, but I'm seeking your help to explain the behavior.</p>\n"},{"tags":["c++","winapi","gdi","bitblt"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":120,"score":-1,"question_id":11520419,"title":"BitBlt copies only part of data in certain conditions","body":"<p>This is a strange problem, I've read documentation for BitBlt function and it works without any problems for most of cases, but starts to fail (only part or even none is copied) if I try to copy data from source rectangle with offset much bigger than the size of destination... strange?? Here are few samples:</p>\n\n<p>This is code that I use, and the result is dependant on the parameters I pass.\nThe bitmap has a width of <code>m_iTileAreaWidth + 2 * m_iTileAreaMargin</code> and a height of <code>m_iTileAreaHeight + 2 * m_iTileAreaMargin</code></p>\n\n<pre><code>BOOL bBltOk = ::BitBlt(_hdcDest, 0, 0, m_iTileAreaWidth, m_iTileAreaHeight,\n                       hdcSource, m_iTileAreaMargin, m_iTileAreaMargin, SRCCOPY);\n</code></pre>\n\n<p>If <code>m_iTileAreaMargin</code> is <strong>600</strong> and <code>m_iTileAreaWidth</code> and <code>m_iTileAreaHeight</code> are both <strong>200</strong> then <strong>130px</strong> of source area is copied</p>\n\n<p>If <code>m_iTileAreaMargin</code> is <strong>500</strong> and <code>m_iTileAreaWidth</code> and <code>m_iTileAreaHeight</code> are both <strong>200</strong> then <strong>full</strong> source are is copied</p>\n\n<p>If <code>m_iTileAreaMargin</code> is <strong>800</strong> and <code>m_iTileAreaWidth</code> and <code>m_iTileAreaHeight</code> are both <strong>200</strong> then <strong>none</strong> source area is copied</p>\n\n<p>Well, I'm sure that whole area is generated - when I use this code:</p>\n\n<pre><code>bBltOk = ::BitBlt(_hdcDest, 0, 0, rcScreen.Widht(), rcScreen.Height(),\n                  _hdcSource, 0, 0,SRCCOPY);\n</code></pre>\n\n<p>Then I see whole area generated</p>\n\n<p>Does anyone have any idea why I have such problems with such simple function?</p>\n"},{"tags":["winapi","fonts","gdi"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":331,"score":7,"question_id":2496160,"title":"What does the '@' mean when prefixed to Windows font face name?","body":"<p>With <code>EnumFontFamiliesEx</code>, I get two instances of some fonts, the second of which has '@' prefixed to the face name in the <code>LOGFONT</code>.  For example, I get \"MS PMincho\" and \"@MS PMincho\".  Yet for other fonts, I just get a single instance, like \"Arial\".  What does the at-sign mean in this context?</p>\n"},{"tags":["winapi","packet","osc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":11560763,"title":"OSC packet implementation in win 32","body":"<p>Need help regarding OSC packet implementation in win 32 in Visual Studio 2008</p>\n"},{"tags":["winapi","c#-4.0","remote-desktop"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":95,"score":1,"question_id":11561513,"title":"Win32 BlockInput doesn't unlock when remoting from xp to xp","body":"<p>I have a script that invokes the Win32 BlockInput function in C# as follows:</p>\n\n<pre><code>public partial class NativeMethods\n    {\n\n        /// Return Type: BOOL-&gt;int\n        ///fBlockIt: BOOL-&gt;int\n        [System.Runtime.InteropServices.DllImportAttribute(\"user32.dll\", EntryPoint =     \"BlockInput\")]\n        [return: System.Runtime.InteropServices.MarshalAsAttribute(System.Runtime.InteropServices.UnmanagedType.Bool)]\n        public static extern bool BlockInput([System.Runtime.InteropServices.MarshalAsAttribute(System.Runtime.InteropServices.UnmanagedType.Bool)] bool fBlockIt);\n\n    }\n\n    public static void toggleMouseAndKeyboard(bool flag)\n    {\n        try\n        {\n            NativeMethods.BlockInput(flag);\n        }\n        catch(Exception ex)\n        {\n            throw new Exception(ex.Message);\n        }\n    }\n</code></pre>\n\n<p>This works fine and dandy whenever I run the script locally, whether Windows 7 or Windows XP. I can also unlock the machine by pressing CTRL + ALT + DEL.</p>\n\n<p>This also will work when I remote from a Windows 7 machine to Windows XP, or Windows 7 to Windows 7. If I highlight the remote desktop window, and press CTRL + ALT + DEL, it will unlock the remote desktop session.</p>\n\n<p>It will even work when I remote from a Windows 7 machine to an XP machine first, and then remote from the XP remote session, to another XP session. I can unlock the second XP session just fine.</p>\n\n<p>However, when I remote from an XP machine to another XP machine, the remote desktop session will NOT unlock after running this script. CTRL + ALT + DEL doesn't work. We have to do a hard restart to get back into the machine, or log someone else in to boot the locked session off.</p>\n\n<p>It seems whenever the local machine that you start remoting on is XP, it will not unlock any remote desktop sessions.\nDoes anyone know of a way to fix this?</p>\n"},{"tags":["winapi","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":82,"score":4,"question_id":11495545,"title":"What's the difference between wParam WM_NOTIFY and idFrom in NMHDR?","body":"<p><a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb775583.aspx\" rel=\"nofollow\">The documentation for <code>WM_NOTIFY</code> says</a>:</p>\n\n<blockquote>\n  <ul>\n  <li><code>wParam</code>:<br>\n  The identifier of the common control sending the message. This identifier is not guaranteed to be unique. An application should use the <code>hwndFrom</code> or <code>idFrom</code> member of the <code>NMHDR</code> structure (passed as the <code>lParam</code> parameter) to identify the control.</li>\n  </ul>\n</blockquote>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/bb775514.aspx\" rel=\"nofollow\">And the documentation for <code>NMHDR</code> says</a>:</p>\n\n<blockquote>\n  <ul>\n  <li><code>idFrom</code><br>\n  An identifier of the control sending the message.</li>\n  </ul>\n</blockquote>\n\n<p>What exactly is the difference between these two?</p>\n"},{"tags":["c++","winapi","writefile"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":11558966,"title":"Write to a txt file using windows API","body":"<p>I am trying to write some lines to a a txt file through an ATL application. Below is the fragment of code I use:</p>\n\n<pre><code>HANDLE hFile = CreateFile(ofn.lpstrFile, \n            GENERIC_READ | GENERIC_WRITE,\n            0,\n            NULL, \n            CREATE_ALWAYS,\n            FILE_ATTRIBUTE_NORMAL,\n            NULL);\n\n        DWORD dwBytesWritten = 0;\n\n        std::list&lt;CString&gt; helpList;\n        std::list&lt;CString&gt;::iterator it;\n        helpList.push_back(L\"First Line\\r\\n\");\n        helpList.push_back(L\"Second Line\");\n\n        for(it=helpList.begin(); it!=helpList.end(); ++it)\n            WriteFile( hFile, (*it).GetString(), (*it).GetLength(), &amp;dwBytesWritten, NULL );\n\n        CloseHandle(hFile); \n</code></pre>\n\n<p>Notwithstanding everything is working right, nothing is finally written to the file. What should I change in the code?  </p>\n"},{"tags":[".net","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":11549751,"title":"Start a program from USB on Windows Login","body":"<p>I need some help i have looked at a lot of forums but cant quite find what I'm looking for i want to check if a USB has been inserted when I'm at the windows Login screen, I would like to make the program disable the windows Login on start up and when the USB has been inserted it would send an ID and if that ID is correct it would Enable the windows Login.</p>\n\n<p>First off i would like to know if it is possible although i would like to think that in programming everything is possible..... :D , and if so any resources help or tutorials would be much appreciated.</p>\n\n<p>As for languages i was thinking C++ or C, or maybe Assembly (I'm not that proficient in Assembly though) or could this be achieved using C# perl, phyton, or JAVA ??</p>\n"},{"tags":["c++","winapi","opengl","sdl"],"answer_count":2,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":454,"score":7,"question_id":7106586,"title":"Keep window active while being dragged (SDL on Win32)","body":"<p>At first my code set up the SDL environment, and proceeded to update the OpenGL context, without performing any SDL_Event processing whatsoever. This causes the window, as long as it was open, to appear to Windows to be unresponsive. The window flickers a bit. The titlebar would get \"(Not Responding)\" appended to it, and upon clicking inside the window it becomes grayed out, as Windows does this by default on non responsive windows. However in this state (even as and after it becomes grayed out), the OpenGL display continues to update and animate, and here's the kicker, it even does so <em>while the window is being dragged</em>. Clearly in this case the application isn't handling events from windows correctly, causing windows to think that it is in a hanged state. But there is clear evidence that the opengl continues to render. </p>\n\n<p>Now I make one single modification to the code, which is these three lines placed in an appropriate spot inside the loop (which also does the OpenGL draw): </p>\n\n<pre><code>SDL_Event event;\nif (SDL_PollEvent(&amp;event) &amp;&amp; event.type == SDL_QUIT)\n    break;\n</code></pre>\n\n<p>All this is doing is flushing the message queue using SDL. </p>\n\n<p>Now the behavior is that Windows no longer thinks it is \"Not Responding\" and it does not get grayed out. No flicker. Everything seems to run swimmingly. But once I click and drag the title bar to drag the window, rendering gets blocked. I haven't debugged it to be sure, but I suspect that SDL_PollEvent blocks for the duration of the window drag. </p>\n\n<p>Is there a way around this? This is interesting because part of the behavior exhibited by <em>failing to handle events</em> is proof that what I want is possible in theory.</p>\n\n<p>Update: I found this thread: <a href=\"http://www.gamedev.net/topic/488074-win32-message-pump-and-opengl---rendering-pauses-while-draggingresizing/\">http://www.gamedev.net/topic/488074-win32-message-pump-and-opengl---rendering-pauses-while-draggingresizing/</a></p>\n\n<p>The verdict seems to be that it comes down to certain choices that Microsoft made for us... It basically gets stuck in <code>DefWindowProc()</code> till the mouse is released. It would get very messy to hack a fix for this and I might be able to do a work around by rendering in another thread. But I don't even want to begin to think about juggling an OpenGL context from multiple threads, if that's even something that's possible.</p>\n"},{"tags":["sql","winapi","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":11522211,"title":"Testing MS ODBC SQLReturn values","body":"<p>Can these values (returned from calls like <code>SQLGetConnectAttr</code>) be tested for success/failure using standard WinAPI <code>FAILED</code>/<code>SUCCEEDED</code> macros to avoid checking individual values? If not are there special SQL variants of those macros?</p>\n"},{"tags":["osx","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":11555708,"title":"Equivalent of WM_MOVE","body":"<p>What's is the equivalent of window's WM_MOVE in Mac OS ? I have to capture a mouse event when one moves window using left click. In windows we can capture this event using WM_MOVE but i could not find similar event in Mac OS</p>\n"},{"tags":["c","winapi","memory-management"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":105,"score":0,"question_id":11554091,"title":"Why does this function always crash when free memory?","body":"<pre><code>int gb2Utf8(const char* source, int sourceLen, void *target, int targetLen)\n{\n    int result = 0;\n    int bufLen = strlen(source) * 2;\n    wchar_t *buffer = (wchar_t *)malloc(bufLen);\n    if (!buffer)\n    {\n        result = 1;\n        goto RETURN;\n    }\n\n    //GB18030 code page: 54936\n    int m2wResult = MultiByteToWideChar(54936, MB_ERR_INVALID_CHARS, source, -1, buffer, bufLen);\n    if (!m2wResult)\n    {\n        result = 2;\n        goto RETURN;\n    }\n\n    int w2mResult = WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, buffer, -1, (char *)target, targetLen, NULL, NULL);\n    if (!w2mResult)\n    {\n        result = 3;\n        goto RETURN;\n    }\n\n    RETURN:\n    free(buffer);\n    return result;\n}\n</code></pre>\n\n<p>When program runs to <code>free(buffer)</code>, it will crash, but I don't know why.<br/>\nIf modify <code>bufLen</code> to a constant value, or remove <code>MultiByteToWideChar</code> function, it won't crash, I also don't know why.\nThis is the call stack when crash:</p>\n\n<blockquote>\n  <p>msvcr100d.dll!_free_dbg_nolock(void * pUserData, int nBlockUse)  Line 1376 + 0x3b bytes   C++<br/>\n  msvcr100d.dll!_free_dbg(void * pUserData, int nBlockUse)  Line 1265 + 0xd bytes   C++<br/>\n  msvcr100d.dll!free(void * pUserData)  Line 49 + 0xb bytes C++<br/>\n  New.exe!gb2Utf8(const char * source, int sourceLen, void * target, int targetLen)  Line 156 + 0xc bytes   C++<br/>\n  New.exe!wWinMain(HINSTANCE__ * hInstance, HINSTANCE__ * hPrevInstance, wchar_t * lpCmdLine, int nCmdShow)  Line 29 + 0x11 bytes   C++<br/>\n  New.exe!__tmainCRTStartup()  Line 547 + 0x2c bytes    C<br/>\n  New.exe!wWinMainCRTStartup()  Line 371    C<br/>\n  kernel32.dll!7509339a()   <br/>\n  [Frames below may be incorrect and/or missing, no symbols loaded for kernel32.dll]    <br/>\n  ntdll.dll!77979ef2()  <br/>\n  ntdll.dll!77979ec5()  <br/></p>\n</blockquote>\n"},{"tags":["winapi","windows-vista","relative-path","absolute-path"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1390,"score":1,"question_id":351479,"title":"Getting absolute path from relative in Vista seems to fail using Win32/Shell PathCombine()","body":"<p>Not sure if this is intended behavior or a bug or a wrong function that I'm using, but the problem is that PathCombine() returns a wrong path on a Vista box.</p>\n\n<p>The relative path is (as exported by the WMP to a playlist):</p>\n\n<p><code>..\\..\\..\\Public\\Music\\Sample Music\\Amanda.wma</code></p>\n\n<p>The path it's relative to is:</p>\n\n<p><code>C:\\Users\\userX\\Music\\Playlists\\playlist.wpl</code></p>\n\n<p>and PathCombine() returns:</p>\n\n<p><code>C:\\Users\\userX\\Public\\Music\\Sample Music\\Amanda.wma</code></p>\n\n<p>however, the file is actually located here (judging by the Explorer and the fact that I can't open it from the code):</p>\n\n<p><code>C:\\Users\\Public\\Music\\Sample Music\\Amanda.wma</code></p>\n\n<p>Is this a known issue? Is there some other function I should be using?</p>\n"},{"tags":["winapi","visual-c++","wmi","device-driver"],"answer_count":1,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":223,"score":6,"question_id":11509676,"title":"Is there a way to programmatically find chipset's north bridge, south bridge names and other hardware info on windows?","body":"<p>Is there a way to programmatically find system chipset's north bridge, south bridge names and other hardware info on windows ? I don't think WMI provides this information. I'm trying to find out how tools like <a href=\"http://www.hwinfo.com/\">hwinfo</a> and <a href=\"http://www.cpuid-pro.com/products-system-information-kit.php\">cpuinfo</a> find this information.</p>\n"},{"tags":["c++","winapi","visual-c++","wmi","wmi-service"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":76,"score":-2,"question_id":11542029,"title":"How do i set up WMI in c++?","body":"<p>I am trying to get the process of the running service by using WMI. But i am confused as to how use WMI. </p>\n\n<p>i think that using this method will work \n<a href=\"http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicecontroller.servicename%28v=vs.71%29\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicecontroller.servicename%28v=vs.71%29</a></p>\n\n<p>But i a dont know how to set up WMI in order to use this</p>\n\n<p>I know i need to do this but am not sure where to go from there</p>\n\n<pre><code> HRESULT hres(CoInitializeEx(NULL, COINIT_MULTITHREADED));\n     // Set general COM security levels\nhres = CoInitializeSecurity(\n    NULL,\n    -1,                             // COM authentication\n    NULL,                           // Authentication services\n    NULL,                           // Reserved\n    RPC_C_AUTHN_LEVEL_DEFAULT,      // Default authentication\n    RPC_C_IMP_LEVEL_IMPERSONATE,    // Default Impersonation\n    NULL,                           // Authentication Info\n    EOAC_NONE,                      // Additional capabiliteis\n    NULL                            // Reserved\n    );\n</code></pre>\n"},{"tags":["winapi","mfc","combobox","scroll"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":11535534,"title":"winapi CustomComboBox almost from scratch on windows ce, vertical scroll bar","body":"<p>Hello, I am almost done making my own combobox on Windows CE using Winapi in C++.\nIt is not a common combobox because of it features drawing on items.\nNormal combo boxes only provide the ability to put text inside of items.\nMy combobox provides drawing additionally.\nI know I could use <code>CBS_OWNERDRAWVARIABLE</code> to create an owner draw combobox, but it is not supported on Windows CE!\nFortunately, I have solved it by getting handles to particular windows inside combobox and changin them to window procedures. But the problem is that it does not generate a vertical scroll bar.\nNormally, a vertical scroll bar is generated thanks to functions like <code>OnDrawItem</code> or <code>OnMeasureItem</code>.\nIf you could tell me how to add vertical scroll bar or just give me some hints on how to do it I would be very grateful.</p>\n\n<p>The code of my class <code>ccustomcombobox</code> can be found here:</p>\n\n<p>.cpp file\n<a href=\"http://wklejto.pl/129222\" rel=\"nofollow\">http://wklejto.pl/129222</a></p>\n\n<p>.h file\n<a href=\"http://www.wklejto.pl/129223\" rel=\"nofollow\">http://www.wklejto.pl/129223</a></p>\n\n<p>Thanks for the advice.</p>\n"},{"tags":["winapi","api","hook"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":843,"score":3,"question_id":228585,"title":"Hooking into Windows File Copy","body":"<p>I want to write my own file copy program that will run when the user chooses'Paste' (Ctrl+V) in Windows Explorer. Some programs like CopyHandler and SuperCopier are doing this. But I don't know how.</p>\n\n<p>Please help.</p>\n"},{"tags":["python","winapi"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":11550022,"title":"Finding handles of Run Time menu items","body":"<p>I've been working with <code>win32api/win32gui</code> in python for a couple of days now primarily to control other processes' UI controls from my python process. spy++ has been helping me so far.</p>\n\n<p>However, I want to find the handle of a menu element of a window. The problem here is that, the <strong>menu pops up on run time</strong> by an <code>onClick()</code> event of a button. </p>\n\n<ol>\n<li>I cant navigate to spy++ without closing the menu, which makes spy++ useless in this situation. </li>\n<li>Is there a way I can programatically (using python) listen for new window handles being created ?</li>\n</ol>\n"},{"tags":["c++","security","winapi","filesystems"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":213,"score":1,"question_id":11247980,"title":"How to detect if a file exists w/o getting derailed by permissions issues?","body":"<p>There are at least three techniques for detecting if a file exists:</p>\n\n<ol>\n<li>Query the file attributes </li>\n<li>Use FindFile() with a specific filename instead of a search pattern</li>\n<li>Open the file in read mode and look at any resulting error</li>\n</ol>\n\n<p>All of the above seem to suffer from false negatives.  That is, I am told that the file doesn't exist when it actually does due to either glitches in how file-io over a network works, or due to file permissions issues.</p>\n\n<p>I have a customer who can see that a file exists in explorer, delete that file, but is given \"access denied\" if they try to view that file.</p>\n\n<p>I have been unsuccessful at replicating this exact behavior.  But what I can create is a situation where the file exists, but due to restricting permissions on it, I cannot see the file in that folder under my user credentials.  That is, GetFileAttributes(), FindFile(), and fopen() return failure, i.e. file not found for that file (but if I look in that same folder under a different account - say a network admin, I can see that the file most certainly exists).</p>\n\n<p>As to how my end user (or anyone) would end up in such situations is opaque to me.  I have no concrete ideas - maybe power failure while the file was previously opened, maybe some sort of network glitch causing the file handle to remain locked to a dead process on a foreign PC, ...?  I'm just making stuff up because I have no idea what might cause such situations to arise.</p>\n\n<p>However, what I really don't have is the ability to query Windows and know for a fact \"does file X exist, or not\"</p>\n\n<p>Does anyone know of a technique that will honestly answer that question regardless of the user's permissions (assuming that they're allowed to query the contents of the folder itself - I'm not asking for an unauthorized access scenario - just a \"normal\" user X can't edit file Y, but still wants to know if file Y exists or not.</p>\n\n<hr>\n\n<p>Hokay - this is getting bizarre.</p>\n\n<p>Using any of the file detection techniques works so long as I ask twice.  The first time always tells me \"does not exist\".  Second+ tells me \"yup, it's there, but you can't open it.\"</p>\n\n<p>The file in question is on a shared folder on a Windows Server 2008 NTFS drive.  It is shared for everyone full control.  I have manually added an \"Everyone Deny Read\" ACL to the file, in order to simulate my customers problem.  So I have denied read, but no other access, and only to the file, not to the share, or the folder in which this file lives.</p>\n\n<p>(I used Explorer to make this modification, not my own software or a command line utility).</p>\n\n<p>I can see that the file exists from the local admin account on that server.  I cannot see that it even exists from my local workstation, logged in as a standard user under Windows 7, UAC enabled, non-elevated explorer / application.</p>\n\n<hr>\n\n<p>It would appear that if a file's read-access is explicitly denied, that the file is not visible any longer (except to account for which that deny doesn't apply, or to the local admin which has some back-door way to see the file despite that deny ACL).</p>\n\n<p>I have tried FindFirstFile, GetAttributes, CreateFile, _taccess_s, and PathFileExists.  In every case, the first attempt to access the file indicates \"file not found\", but the second attempt in a row results in no-error (file found).</p>\n\n<p>I cannot begin to explain these results.  I think at this point I need to run all of my tests locally, to remove network file sharing from the mix.  These results just don't make a whole heckuva lot of sense (to me).</p>\n\n<hr>\n\n<p>fltmc output for the folder, from local admin account on the server:</p>\n\n<pre><code>Filter Name                     Num Instances    Altitude    Frame\n------------------------------  -------------  ------------  -----\naksdf                                   8       145900         0\nluafv                                   1       135000         0\n</code></pre>\n"},{"tags":["c++","windows","winapi","callstack"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":11549128,"title":"How StackWalk64 behaves with inline functions?","body":"<p>I am trying to capture the call-stack using the dbghelp.dll functions. I am using StackWalk64 to capture the addresses of the functions in the call-stack.The behavior of StackWalk64 with inline functions looks undeterministic for me. Sometimes, it skips the inline functions. Some other times I can get an address back for them but stackwalk64 fails for the next function in the call stack. In both cases I get incomplete call-stacks.</p>\n\n<p>Anyone has more insights into that and on how to handle inline functions in call-stacks.</p>\n\n<p>Thanks</p>\n"},{"tags":["delphi","winapi","area","region"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":134,"score":4,"question_id":11543412,"title":"How to calculate an area of a Windows region (HRGN) in pixels?","body":"<p>What is the fastest way of getting the area of any arbitrary Windows region?</p>\n\n<p>I know I can enumerate all points of bounding rectangle and call the <code>PtInRegion()</code> function but it seems not very fast. Maybe you know some faster way?</p>\n"},{"tags":["c++","windows","winapi","screenshot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":257,"score":0,"question_id":11066923,"title":"Why is GetClientRect including the window border and title bar?","body":"<p>m writing some code that will take a screenshot of another application, given its' window handle, in C++. The method I am using is to use <code>BitBlt</code>. My application is successfully taking the screenshot and I have a function that will save that image data out to a bmp file.</p>\n\n<p>The screenshot contains the window's chrome though. That is, the border and the title bar. Based on my understanding, <code>GetClientRect</code> is supposed to exclude the window's border and title bar. I understand that <code>GetWindowRect</code> returns the coordinates within the user's desktop, and <code>GetClientRect</code> returns the coordinates relative to the application itself.</p>\n\n<p>I notice in my screenshots that the title bar and left border are visible, but the right border and bottom of the application are cut off. So, I'm thinking that if I want to exclude the title and borders then I need to be doing some sort of combination of <code>GetWindowRect</code> and <code>GetClientRect</code>, and using information about the window itself to offset the <code>GetClientRect</code> dimensions by whatever the height of the window's title bar is, for example.</p>\n\n<p>Does this sound accurate, or is my code below doing something wrong? Thanks.</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include \"ScreenshotManager.h\"\n\nnamespace Managers {\n\n    ScreenshotManager::ScreenshotManager(HWND gameHandle) {\n\n        // get a device context for the window\n        m_gameContext = GetWindowDC(gameHandle);\n\n        // create a compatible device context for bitblt\n        m_bitmapContext = CreateCompatibleDC(m_gameContext);\n\n        // get window client area dimensions\n        GetClientRect(gameHandle, &amp;m_gameClientArea);\n\n    }\n\n    bool ScreenshotManager::TakeScreenshot() {\n\n        // create a compatible bitmap for the game screenshots\n        m_bitmap = CreateCompatibleBitmap(m_gameContext, m_gameClientArea.right, m_gameClientArea.bottom);\n\n        // select the bitmap into the compatible device context\n        SelectObject(m_bitmapContext, m_bitmap);\n\n        // perform bit block transfer\n        if (BitBlt(m_bitmapContext, 0, 0, m_gameClientArea.right, m_gameClientArea.bottom, m_gameContext, 0, 0, SRCCOPY) == false)\n            return false;\n\n        // get information about the taken screenshot\n        GetObject(m_bitmap, sizeof(BITMAP), &amp;m_bitmapInformation);\n\n        return true;\n\n    }\n\n    void ScreenshotManager::SaveScreenshot(LPCWSTR outputPath) {\n\n        BITMAPFILEHEADER   bmfHeader;    \n        BITMAPINFOHEADER   bi;\n\n        bi.biSize = sizeof(BITMAPINFOHEADER);\n        bi.biWidth = m_bitmapInformation.bmWidth;\n        bi.biHeight = m_bitmapInformation.bmHeight;\n        bi.biPlanes = 1;    \n        bi.biBitCount = 32;    \n        bi.biCompression = BI_RGB;    \n        bi.biSizeImage = 0;  \n        bi.biXPelsPerMeter = 0;    \n        bi.biYPelsPerMeter = 0;    \n        bi.biClrUsed = 0;    \n        bi.biClrImportant = 0;\n\n        DWORD dwBmpSize = ((m_bitmapInformation.bmWidth * bi.biBitCount + 31) / 32) * 4 * m_bitmapInformation.bmHeight;\n\n        // Starting with 32-bit Windows, GlobalAlloc and LocalAlloc are implemented as wrapper functions that \n        // call HeapAlloc using a handle to the process's default heap. Therefore, GlobalAlloc and LocalAlloc \n        // have greater overhead than HeapAlloc.\n        HANDLE hDIB = GlobalAlloc(GHND,dwBmpSize);\n        char *lpbitmap = (char *)GlobalLock(hDIB);\n\n        // Gets the \"bits\" from the bitmap and copies them into a buffer which is pointed to by lpbitmap.\n        GetDIBits(m_gameContext, m_bitmap, 0, (UINT)m_bitmapInformation.bmHeight, lpbitmap, (BITMAPINFO *)&amp;bi, DIB_RGB_COLORS);\n\n        // A file is created, this is where we will save the screen capture.\n        HANDLE hFile = CreateFile(outputPath, GENERIC_WRITE, 0, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);   \n\n        // Add the size of the headers to the size of the bitmap to get the total file size\n        DWORD dwSizeofDIB = dwBmpSize + sizeof(BITMAPFILEHEADER) + sizeof(BITMAPINFOHEADER);\n\n        //Offset to where the actual bitmap bits start.\n        bmfHeader.bfOffBits = (DWORD)sizeof(BITMAPFILEHEADER) + (DWORD)sizeof(BITMAPINFOHEADER); \n\n        //Size of the file\n        bmfHeader.bfSize = dwSizeofDIB; \n\n        //bfType must always be BM for Bitmaps\n        bmfHeader.bfType = 0x4D42; //BM   \n\n        DWORD dwBytesWritten = 0;\n        WriteFile(hFile, (LPSTR)&amp;bmfHeader, sizeof(BITMAPFILEHEADER), &amp;dwBytesWritten, NULL);\n        WriteFile(hFile, (LPSTR)&amp;bi, sizeof(BITMAPINFOHEADER), &amp;dwBytesWritten, NULL);\n        WriteFile(hFile, (LPSTR)lpbitmap, dwBmpSize, &amp;dwBytesWritten, NULL);\n\n        //Unlock and Free the DIB from the heap\n        GlobalUnlock(hDIB);    \n        GlobalFree(hDIB);\n\n        //Close the handle for the file that was created\n        CloseHandle(hFile);\n\n    }\n\n}\n</code></pre>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":188,"score":0,"question_id":11533061,"title":"Convert a date in a string to FILETIME","body":"<p>I have an imput .txt file, which contains a date. The date is in the form DDMONYY, as in 08JUN98 or 16NOV05. I need to compare this date to the creation date of the file, and see which is sooner. </p>\n\n<p>FILETIME seems like the appropriate form, especially since there is a CompareFileTime function. However, I have a problem converting the date into file time.</p>\n\n<p>I can extract the date from the file and convert it into numbers (days 1-31, month 1-12, year 1900-20whatever) so I don't need help with that, but feel free to comment on it anyway.</p>\n\n<p>The real problem is that I can't figure out how to get these values into a FILETIME format. Right now I have them as three different strings(or int's if that helps more) one for day, month and year. If you could help me make the jump from string to FILETIME that would be great.</p>\n\n<p>Or, if there is a completely better way that I missed during my research, please feel free to suggest it. </p>\n\n<p>If you want, I can post what I have, but I don't think it'll help since it's only getting to the string/int's.</p>\n\n<hr>\n\n<p>if it makes it any clearer, the values I have in my variables at this point, for May 3rd, 2002, would be something along the lines of</p>\n\n<pre><code>string day = \"03\";\nstring month =\"5\";\nstring year = \"2002;\nint dayint = 3;\nint monthint = 5;\nint yearint = 2002;\n</code></pre>\n\n<p>And I need a way to convert this to a FILETIME</p>\n\n<p>Thanks a bunch.</p>\n\n<hr>\n\n<p>EDIT:</p>\n\n<p>I'm not sure how I would fill a <code>SYSTEMTIME</code> structure, or even how to do it for a different time system. So I guess that is more my question.</p>\n\n<p>I should have also mentioned that I only need accuracy of days. Hours and anything smaller aren't really of concern to me.</p>\n\n<hr>\n\n<p>EDIT2:</p>\n\n<p>I must not have tried giving the <code>SYSTEMTIME</code> int values, because that seems to work. However, I am running into issues when I try to convert that systemtime to a filetime. It states \"Error: no suitable converstion from \"SYSTEMTIME\" to \"const SYSTEMTIME *\" exists\". I'm not sure how to fix this, since if I define the systime variable as <code>const SYSTEMTIME</code> I can't assign values to it.</p>\n\n<p>here's the relevant code, if it helps</p>\n\n<pre><code>SYSTEMTIME systime;\nLPFILETIME ftime1;\nLPFILETIME ftime2;\nint dayint=6;\nint monthint=12;\nint yearint=1989;\n\nsystime.wDay = dayint;\nsystime.wMonth = monthint;\n//and so on for year, hour, etc. \nSystemTimeToFileTime(systime,ftime1);     //This is where the aforementioned error occurs\nGetFileTime(filename, NULL, NULL, ftime2);   //I'm also not sure about this line... feel free to critique it. I'm only interested in the last written time so I put NULL for the other times... When I check the values for this (in SYSTEMTIME) it only returns 52428, so I don't think this line is working correctly...\nCompareFileTime(ftime1,ftime2);\n</code></pre>\n\n<p>Of course, the values for day, month, year aren't hardcoded in the actual code.</p>\n\n<hr>\n\n<p>EDIT3:</p>\n\n<p>I have a bad handle....</p>\n\n<p>I'm going to try to fix that....\nThanks for your help Ben Voigt\nIf I can't get it, I guess I'll be back</p>\n"},{"tags":["c#","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":11543162,"title":"WM_SETTEXT fills in controls but data is not valid","body":"<p>I have written a program in c# that controls another program.  The \"other program\" is a standard Windows application written in Microfocus COBOL.  Thus I can use SendMessage to enter data into the edit controls and combo boxes in the COBOL application.  Code that does this is below:</p>\n\n<pre><code>public unsafe void setData(string strData)\n{\n    IntPtr iMem = ClsMemory.StringToHLocalA(strData);\n    if (ctlType == eType.Edit)\n    {\n        SendMessageA(iHandle, (uint)WindowsMessages.WM_SETTEXT, UIntPtr.Zero, iMem);//???        SetWindowTextA(iHandle, iMem);\n    }\n    else if (ctlType == eType.ComboBox)\n    {\n        SendMessageA(iHandle, (uint)WindowsMessages.CB_SELECTSTRING, UIntPtr.Zero, iMem);\n    }\n    ClsMemory.FreeHLocal(iMem);\n}\n</code></pre>\n\n<p>The problem is that the data shows up in the controls.  Everything appears to be correct.  The screen in the COBOL program looks exactly as if it would look if I had entered the data from the keyboard.  However, when the controlling program pushes the COBOL program's Submit button, the COBOL program complains that none of the data is valid. That is, if I have entered a birth date of 06/01/1982, that isn't a valid date. When I hand-enter 06/01/1982, it is.  I have tried ASCII and Unicode variants. I have made sure that the unsafe string has a zero terminator.  </p>\n\n<p>What is also mysterious is that the commented-out SetWindowText function does not work at all. Nothing shows up in the controls. The operating system is Windows XP Pro with the latest patches. The programming environment is Visual Studio 2010.  </p>\n\n<p>Any help will be greatly appreciated.</p>\n"},{"tags":["c++","winapi","directx","clang"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":136,"score":1,"question_id":11509715,"title":"Clang - removing \"conversion function converting <A> to base class <B> will never be used\" warnings for certain files","body":"<p>Clang kind of chokes on DirectX's include files, and spits a handful of warnings, like these when analyzing the headers:</p>\n\n<pre><code>C:/Program Files (x86)/Microsoft DirectX SDK (June 2010)/Include\\D3D11.h:1133,5 - Warning - conversion function converting 'CD3D11_RECT' to its base class 'tagRECT' will never be used\nC:/Program Files (x86)/Microsoft DirectX SDK (June 2010)/Include\\D3D11.h:1179,5 - Warning - conversion function converting 'CD3D11_BOX' to its base class 'D3D11_BOX' will never be used\nC:/Program Files (x86)/Microsoft DirectX SDK (June 2010)/Include\\D3D11.h:1441,5 - Warning - conversion function converting 'CD3D11_DEPTH_STENCIL_DESC' to its base class 'D3D11_DEPTH_STENCIL_DESC' will never be used\nC:/Program Files (x86)/Microsoft DirectX SDK (June 2010)/Include\\D3D11.h:1661,5 - Warning - conversion function converting 'CD3D11_BLEND_DESC' to its base class 'D3D11_BLEND_DESC' will never be used\nC:/Program Files (x86)/Microsoft DirectX SDK (June 2010)/Include\\D3D11.h:1857,5 - Warning - conversion function converting 'CD3D11_RASTERIZER_DESC' to its base class 'D3D11_RASTERIZER_DESC' will never be used\nC:/Program Files (x86)/Microsoft DirectX SDK (June 2010)/Include\\D3D11.h:2200,5 - Warning - conversion function converting 'CD3D11_BUFFER_DESC' to its base class 'D3D11_BUFFER_DESC' will never be used\nC:/Program Files (x86)/Microsoft DirectX SDK (June 2010)/Include\\D3D11.h:2400,5 - Warning - conversion function converting 'CD3D11_TEXTURE1D_DESC' to its base class 'D3D11_TEXTURE1D_DESC' will never be used\nC:/Program Files (x86)/Microsoft DirectX SDK (June 2010)/Include\\D3D11.h:2608,5 - Warning - conversion function converting 'CD3D11_TEXTURE2D_DESC' to its base class 'D3D11_TEXTURE2D_DESC' will never be used\nC:/Program Files (x86)/Microsoft DirectX SDK (June 2010)/Include\\D3D11.h:2811,5 - Warning - conversion function converting 'CD3D11_TEXTURE3D_DESC' to its base class 'D3D11_TEXTURE3D_DESC' will never be used\nC:/Program Files (x86)/Microsoft DirectX SDK (June 2010)/Include\\D3D11.h:3419,5 - Warning - conversion function converting 'CD3D11_SHADER_RESOURCE_VIEW_DESC' to its base class 'D3D11_SHADER_RESOURCE_VIEW_DESC' will never be used\n</code></pre>\n\n<p>Of course, this makes it quite annoying to step through all of this to find the Errors and Warnings interesting me. Is there a flag which would make it not output these messages, or at least a way to not analyze the DirectX header files ?</p>\n\n<p>I'm currently compiling with </p>\n\n<pre><code>-Wall -Wno-unknown-pragmas -Wno-microsoft -Wno-return-type-c-linkage -Wno-conversions -IC:/Program Files (x86)/Microsoft DirectX SDK (June 2010)/Include -IC:/Program Files (x86)/Microsoft Visual Studio 10.0/VC/include\n</code></pre>\n"},{"tags":["windows","winapi"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":494,"score":2,"question_id":2726975,"title":"How can I generate an RFC1123 Date string, from C code (Win32)","body":"<p><a href=\"http://tools.ietf.org/html/rfc1123\" rel=\"nofollow\">RFC1123</a> defines a number of things, among them, the format of Dates to be used in internet protocols.  HTTP (<a href=\"http://tools.ietf.org/html/rfc2616\" rel=\"nofollow\">RFC2616</a>) specifies that date formats must be generated in conformance with RFC1123. </p>\n\n<p>It looks like this: </p>\n\n<pre><code>Date: Wed, 28 Apr 2010 02:31:05 GMT\n</code></pre>\n\n<p>How can I generate an RFC1123 time string from C code, running on Windows? \nI don't have the use of C# and DateTime.ToString().  </p>\n\n<p>I know I could write the code myself, to emit timezones and day abbreviations, but I'm hoping this already exists in the Windows API. </p>\n\n<p>Thanks.</p>\n"},{"tags":["windows","winapi","disassembling","portable-executable"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":379,"score":1,"question_id":3420831,"title":"How to map a file offset in an EXE to its PE section","body":"<p>I've opened up a program I wrote with ImageHlp.dll to play around with it a little, and I noticed that there seem to be large gaps in the file.  As I understand it, for each PE section, the section header gives its offset in the file as <code>PhysicalAddress</code>, and its size as <code>SizeOfRawData</code>, and thus everything from <code>PhysicalAddress</code> to <code>PhysicalAddress + SizeOfRawData</code> ought to be that section. But there are large swaths of the EXE file that aren't covered by these ranges, so I must be missing something.</p>\n\n<p>I know I can use ImageRVAToSection and give it an RVA address to find out which section that RVA is located in.  Is there any way to do something similar with file offsets?  How can I find out which PE section byte $ED178 or whatever belongs to?</p>\n"},{"tags":["c#","winapi","compact-framework","fonts","windows-ce"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1248,"score":3,"question_id":3104949,"title":"How to programatically install a font","body":"<p>I would like to install a specific font on my program load and use that font in rendering text of the program. How can I programmatically install a font from .NET CF on WinCE 6.</p>\n"},{"tags":["winapi","reverse-engineering","handle","ida"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":11525950,"title":"Find what file a short lived HANDLE is associated with","body":"<p>I am playing around with the demo of IDA and I am trying to do some reverse engineering of a program to figure out the structure of one of its files that it uses. My final goal is to be able to read that file directly from my own program.</p>\n\n<p>Using <a href=\"http://technet.microsoft.com/en-us/sysinternals/bb896645\" rel=\"nofollow\">Process Monitor</a> I was able to find the subroutine that calls <code>kernel32_ReadFile</code>. What I would like to know is how do I find out what the <code>hFile</code> variable is pointing to before it makes the call to <code>ReadFile</code></p>\n\n<p>I have been exploring around the menus while in debug mode and I have not found anywhere inside IDA where I can look up information about what file is associated with a file handle.</p>\n\n<p>How do I map a handle to a real file?</p>\n"},{"tags":[".net","winapi","console","pipe"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":126,"score":0,"question_id":11523595,"title":"AttachConsole() shows data on pipe but the > operator doesn't correctly redirect on file","body":"<p>I made a WinForm application running on the .Net Framework 4.0. It writes on the parent console using the Console.WriteLine() method after calling -once at startup- the win32 api AttachConsole(-1).</p>\n\n<p>It works flawlessly as long as I just need to show the output on screen. Unfortunately when I use a batch with a pipe redirection operator like this:</p>\n\n<p>application.exe > output.txt</p>\n\n<p>it just creates an empty file. Maybe there's some problem related to the actual pipe being addressed when I use AttachConsole? Why the dos prompt can't catch the data and put it on the file? Does anyone know about any problems related to such a scenario?</p>\n"},{"tags":["c#","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":133,"score":0,"question_id":11525218,"title":"SetCursorPos() not working on 32bit","body":"<p>Importing the function:</p>\n\n<pre><code>[DllImport(\"user32.dll\", SetLastError = true)]\nstatic internal extern Boolean SetCursorPos(int X, int Y);\n</code></pre>\n\n<p>Using the function:</p>\n\n<pre><code>private static object mouselock = new object();\npublic static void MoveMouseAbsolute(Point p)\n{\n    lock (mouselock)\n        NativeMethods.SetCursorPos(p.X, p.Y);\n}\n</code></pre>\n\n<p>I set a breakpoint at <code>NativeMethods.SetCursorPos</code> and it receives the coordinates just fine, it just doesn't move the mouse pointer at all.</p>\n\n<p>Works fine on the two 64-bit machines I tried it on though, is there something I'm missing here?</p>\n\n<p>Fully functional example:</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.ComponentModel;\nusing System.Data;\nusing System.Drawing;\nusing System.Linq;\nusing System.Runtime.InteropServices;\nusing System.Text;\nusing System.Threading;\nusing System.Threading.Tasks;\nusing System.Windows.Forms;\n\nnamespace mousemove\n{\n    public partial class Form1 : Form\n    {\n        [DllImport(\"user32.dll\", SetLastError = true)]\n        static internal extern Boolean SetCursorPos(int X, int Y);\n\n        private static object mouselock = new object();\n        public static void MoveMouseAbsolute(Point p)\n        {\n            lock (mouselock)\n                SetCursorPos(p.X, p.Y);\n        }\n\n        public Form1()\n        {\n            InitializeComponent();\n\n            Point startingposition = Cursor.Position;\n\n            for (int x = 0; x &lt; 10; x++)\n            {\n                startingposition.X += 1;\n                MoveMouseAbsolute(startingposition);\n                Thread.Sleep(100);\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>On Windows 7 64-bit, executing that code will move the mouse to the right 10 times. On 32 bit; nothing.</p>\n"},{"tags":["c#","windows","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":11524234,"title":"check if winform is hidden behind a game running in exclusive full screen mode","body":"<p>I have a layered window/form which I try to always set on top of any other window in the desktop using SetWinPos WinAPI method, I can get over almost any window, only problem is if I have a full screen game on my desktop and then I call SetWinPos to put my form on top of the game, its actually being recognized as the \"top window\" based on the return value of GetTopWindow WinAPI method, I can even see mouse cursor changed when I hover in some parts of the game screen ( I supposed since the form is actually the \"top window\") but then I don't really see my form since game is in exclusive full screen mode...</p>\n\n<p>Is there any way to check if my form is hidden behind a game (or perhaps any app which is running in exclusive full screen) or check if a game is actually running in exclusive full screen mode?</p>\n"},{"tags":["c++","winapi"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":11515638,"title":"Splitting shared memory?","body":"<p>A block of shared memory is allocated using <code>CreateFileMapping()</code> and the handle to it is given. Some data were written using <code>MapViewOfFile()</code> -- call it 'source'</p>\n\n<p>Now I wish to split the shared memory into many small blocks and to get the handles to them.<br>\nIs there a way to do that while not calling <code>CreateFileMapping()</code> again and copying from 'source'?</p>\n\n<p><code>OpenFileMapping()</code> and <code>MapViewOfFile()</code> with appropriate offsets will work but the problem is, in that case the process that calls <code>OpenFileMapping()</code> get to have access to data written in 'source' by other processes and they might be corrupted by using a wrong offset.</p>\n\n<p>Long story short, I'm looking for something like <code>OpenFileMapping(String name, UINT **offset**, ...)</code></p>\n\n<hr>\n\n<p>The last sentence was misleading.</p>\n\n<p>What I'm really trying to do is something like this:</p>\n\n<pre><code>&lt;Host process&gt;\nHANDLE hShm = CreateFileMapping(INVALID_HANDLE_VALUE, ..., \"shm\");\nvoid* pShm = MapViewOfFile(hShm);\nUINT numShms = *(UINT*)pShm;   // first 4 bytes stores number of shared memory blocks\nHANDLE *hShmSplit = new HANDLE[numShms];    \nfor(size_t i=0; i&lt;numShms; i++) {\n   TCHAR shmName[32];\n   wsprintf(shmName, \"shm%d\", i);\n   // suppose offset is set\n   pShm+=offset;\n   hShmSplit[i] = *CreateFileMappingFromExistingMapping*(pShm, shmName);\n}\nCloseHandle(hShm);   // no longer used\n\n&lt;Client process&gt;\nTCHAR* shmName=\"shm1\";\nHANDLE hShm = OpenFileMapping(shmName);\nLPVOID p = MapViewOfFile(hShm);\n// use shared memory \n// Now the client process has access to shm1 but not to shm2, shm3, or other shm_x's.\n</code></pre>\n"},{"tags":["windows","winapi","visual-c++","mfc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":11520937,"title":"Display name of node in a tree control on clicking it(MFC/VC++)","body":"<p>I want to display the name of any node in a tree view struture when clicked on it.Is there any idea??</p>\n"}]}
