{"count":54374,"tag":"sql-server","questions":[{"tags":["php","sql-server","pdo"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13281344,"title":"Is it possible to use PDO with the mssql packages on CentOS the same way that Ubuntu allows with php5-sybase?","body":"<p>I'm needing to connect to an MSSQL server with PHP, and I can do this fine with PDO methods in Ubuntu having php5-sybase installed. I haven't attempted this on CentOS yet, but my production environment will be PHP5 on CentOS and I want to know if there will be any extra issues I need to be aware of.</p>\n"},{"tags":["sql-server","vb.net","visual-studio-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13281334,"title":"How frequently should I update datatable from VB.Net to SQL Server","body":"<p>I've got a VB 2008 process that is scraping a website and continuously creating new records which will eventually be inserted into a remote SQL Server. I'm wondering what's the most efficient way to be updating my database.</p>\n\n<p>Here are the options I know of available:</p>\n\n<ul>\n<li>Call an INSERT each time a new record is created. (Using the command object or a parameterized query or a table adapter or some other way.)</li>\n<li>Add the new row to a datatable and update the datatable back to the server (using a table adapter) when I'm done creating all the records (this could be in the hundreds of thousands though).</li>\n<li>Add the new row to a datatable and update the datatable back to the server (using a table adapter) every few hundred or so records.</li>\n</ul>\n\n<p>Which of these is the proper/recommended approach to do this? Or is there another way I'm unfamiliar with?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","insert","table-variable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13281201,"title":"SELECT statement that executes instantly, takes forever to insert into table variable","body":"<p>I have the following SQL code below. It is taking forever to complete but if I run just the <code>SELECT DISTINCT ID, ParentID FROM Y WHERE ID IN (3,4)</code>, it completes instantly.</p>\n\n<pre><code>DECLARE @table TABLE\n(\n  ID int,\n  ParentID int\n)\n\nINSERT INTO @table \nSELECT DISTINCT ID, ParentID FROM Y WHERE ID IN (3,4)\n\nSELECT * FROM @table\n</code></pre>\n\n<p>What is going on, this makes no sense.</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13278058,"title":"SQL Server LIKE on datepart doesnt work for the time element","body":"<p>I am trying to return rows in my table that have a certain date but also a certain hour.</p>\n\n<p>At the moment I can handle the date part of the query just fine by using:</p>\n\n\n\n<pre class=\"lang-sql prettyprint-override\"><code>CONVERT(VARCHAR(25), col1, 126) LIKE '2012-11-05%' \n</code></pre>\n\n<p>That works perfectly and returns all rows where col1 has a value of the 5th November. However when I also want to add the hour to the end like this:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CONVERT(VARCHAR(25), col1, 126) LIKE '2012-11-05 15%' \n</code></pre>\n\n<p>That query returns no rows, even though there are rows with the hour set to 15.</p>\n\n<p>It looks like the time element of the query needs some kind of different syntax? I just wondered if anyone can confirm this?</p>\n"},{"tags":["sql-server","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13273356,"title":"How to process XML files and update a table using SSIS package?","body":"<p>I have two XML files <code>accepted.XML</code> and <code>rejected.XML</code> which have similar structure. One of the nodes of these files is <strong>CLIENT_CLAIM_NUM</strong>. </p>\n\n<p>If the <code>CLIENT_CLAIM_NUM</code> is from accepted.xml, I need to update an SQL Server table with corresponding status as accepted. Same is the case with rejected.xml. My accepted.XML has the following structure:</p>\n\n<h3>Accepted.xml file layout:</h3>\n\n<pre><code> &lt;CLAIM&gt; \n      &lt;CLIENT_CLAIM_NUM&gt;1&lt;/CLIENT_CLAIM_NUM&gt; \n      &lt;Vendor_ASSIGNED_CLAIM_NUM&gt;434772&lt;/Vendor_ASSIGNED_CLAIM_NUM&gt; \n      &lt;LASTNAME&gt;#########&lt;/LASTNAME&gt; \n      &lt;Date&gt;2012-01-06T00:00:00&lt;/Date&gt;\n &lt;/CLAIM&gt;\n</code></pre>\n\n<p>Also how can I send the count of claim numbers in each file by mail?</p>\n\n<p>I used a Data flow task and an XML source to parse the XML. It gives the nodes as columns but how can I store it in a variable or update table with those columns. I cannot use a staging table as I wanted all this in a single package </p>\n"},{"tags":["sql","sql-server","sql-server-2008","hierarchical-data"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13280265,"title":"Flattening a SQL hierarchical data structure in SQL without cursors","body":"<p>Let's say I have the following table</p>\n\n<pre><code>SectionID ParentIDSection DatumID\n   1           NULL         1\n   2            1           2\n   3            1           3\n   4            2           4\n</code></pre>\n\n<p>Now, let's  pretend I want to select all DatumIDs under SectionID = 1, even if it is part of its descendants children so that I would get</p>\n\n<pre><code>SectionID DatumID\n  1         1\n  1         2\n  1         3\n  1         4\n</code></pre>\n\n<p>Is it possible to this without explicitly iterating over the first table recursively with a cursor?</p>\n"},{"tags":["sql-server","sqlclr"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12038033,"title":"Can I develop an SQL/CLR function that can accept arguments of any type like MAX()?","body":"<p>For example, can I develop MAX() function using C# by myself? Thanks!</p>\n"},{"tags":["sql","sql-server","performance","query","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13280548,"title":"Performance issue in retrieving multiple output of the same column with different values from a single table","body":"<p>is there anyway to get the following results from query without joining the same table three times (or) without reading the same \"wordlocation\" table three times (or more if there are more words)? If there are three or more words, it takes about over a minute for the results to be returned.</p>\n\n<p>Currently \"wordlocation\" table has three rows being (\"bookid\",\"wordid\",\"location\") and it currently has 917802 rows.</p>\n\n<p>What I am trying to do is </p>\n\n<ol>\n<li>retrieve the \"bookid\" that contains all the words specified in the query by \"wordid\".</li>\n<li>sum word count of all words (from the query) from each book</li>\n<li>minimum values of each word location, e.g. (min(w0.location), min (w1.location)</li>\n</ol>\n\n<p>I have tried commenting out count(w0.wordid) and min(location) calculations to see whether they are affecting the performance but this is not the case. Joining the same table multiple time was the case.</p>\n\n<p><img src=\"http://i.stack.imgur.com/SYLB7.jpg\" alt=\"enter image description here\"></p>\n\n<p>(this is the same code as the above image)   </p>\n\n<pre><code>select \n    w0.bookid, \n    count(w0.wordid) as wcount, \n    abs(min(w0.location) + min(w1.location) + min(w2.location)) as wordlocation, \n    (abs(min(w0.location) - min(w1.location)) + abs(min(w1.location) - min(w2.location))) as distance \n    from \n    wordlocation as w0 \n    inner join \n    wordlocation as w1 on w0.bookid = w1.bookid \n    join \n    wordlocation as w2 on w1.bookid = w2.bookid \n    where \n    w0.wordid =3 \n    and \n    w1.wordid =52 \n    and \n    w2.wordid =42\n    group by w0.bookid \n    order by wcount desc;\n</code></pre>\n\n<p>This is the result that I am looking for, and which I got from running the above query, but it takes too long if I specify more than 3 words, e.g. (w0 = 3, w1 = 52 , w2 = 42, w3 = 71)</p>\n\n<p><img src=\"http://i.stack.imgur.com/08dD5.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","oracle","database-link","heterogeneous-services"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4,"score":2,"question_id":13280777,"title":"Unable to create objects with db link; ORA - 0251: another session or branch in same transaction failed or finalized","body":"<p>I have a Heterogeneous Link between Oracle 11.2.0.3 and SQL Server 2008. When I attempt to create views, or procedures that reference the Heterogeneous Services views for system tables, I get 4 errors listed below:</p>\n\n<p>ORA-00604: error occured at recursive SQL level 1</p>\n\n<p>ORA-02051: another session or branch in same transaction failed or finalized</p>\n\n<p>ORA-06512: at \"SYS.HS$_DDTF_SQLTABLES\", line 58</p>\n\n<p>ORA-06512: at line 1</p>\n\n<p>As an example, these errors are created when I try to execute the following code:</p>\n\n<pre><code>CREATE VIEW ALLMYTABLES AS\nSELECT * FROM ALL_TABLES@DBLINKNAME;\n</code></pre>\n\n<p>I am however able to create views on any normal table:</p>\n\n<pre><code>CREATE VIEW RANDOMTABLE AS\nSELECT * FROM RANDOMTABLE@DBLINKNAME;\n</code></pre>\n\n<p>I have done some research to issues similar to this one, but have not found any references to this specific issue. I believe it may have something to do with the conflict between the concurrent operations of creating the view and the select * statement call to the SQL server database. Or perhaps that the records are not entirely fetched when the view is created.</p>\n\n<p>I do not know the specifics of the HS link configuration and properties.</p>\n"},{"tags":["php","sql-server","sql-server-2008","doctrine2","freetds"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5,"score":0,"question_id":13280717,"title":"SELECT problems with Doctrine and MS SQL 2008","body":"<p>We have written an application using Doctrine2, which works great when used with a MySQL or Postgres database.</p>\n\n<p>We now connected the application with a SQL Server 2008 database using <a href=\"http://de3.php.net/manual/en/ref.pdo-dblib.php\" rel=\"nofollow\">PDO Driver DBLib</a> which uses the <code>FreeTDS</code> implementation for the Tabular DataStream protocol, which is shared by SQL Server and Sybase.</p>\n\n<p>The initial schema creation, transactions and <code>INSERT</code>s into the tables work fine .. after some tweaking of the Doctrine <code>SQLServerPlatform</code> and our MSSQL Driver package. </p>\n\n<p>But when selecting data, we face the following error:</p>\n\n<pre><code>General error: 20019 Attempt to initiate a new Adaptive Server operation with results pending\n</code></pre>\n\n<p>After plenty of googling I found <a href=\"http://www.freetds.org/faq.html#pending\" rel=\"nofollow\">this detail in the FAQ of FreeTDS</a>:</p>\n\n<blockquote>\n  <p>If you are accustomed to programming with other database servers, you may be surprised when you first encounter this aspect of the TDS protocol.  [...]<br><br>The server requires the client either to read all the results from a query, or to indicate that no further rows are desired i.e., to issue a cancellation. Until one of those two things happens, the server will not accept new queries on that connection. It will complain about \"pending results\".</p>\n</blockquote>\n\n<p>So the cause for the error message is that for some reason, Doctrine (DBAL->PDO->FreeTDS) did not read all the result rows from the connection buffer, and the server / library doesn't allow the application to issue a new <code>exec()</code>/<code>execute()</code> until all rows are read.</p>\n\n<ul>\n<li>Is my understanding right that <code>$doctrinequery-&gt;getResults()</code> fetches all results before it returns?</li>\n<li>Is my understanding right that <code>$entity-&gt;getLinkedEntity()</code> (i.e. <code>$user-&gt;getGroupNames()</code>) fetches all results before it returns?</li>\n<li>How would you tackle down where exactly the problem is? <br>The stacktraces are not helping me and the codebase is already grown.</li>\n<li>Did anybody else already have this problem and can share some insights?</li>\n<li>Is there an alternative we can use to connect Doctrine to MSSQL which does not suffer this problem?</li>\n</ul>\n"},{"tags":["sql-server","sql-server-2005","view","sql-management-studio","rownumber"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13280520,"title":"ROW_NUMBER() in a View in SQL Server 2005","body":"<p>I have tried the following query in Microsoft SQL Server Management Studio!</p>\n\n<pre><code>select ROW_NUMBER() OVER(ORDER BY ret_id, dep_id DESC) AS 'Row Number' from Round_Trip_View\n</code></pre>\n\n<p>and it works!</p>\n\n<p>I have tried the same to create a view, and it crashed! \nAny idea?</p>\n\n<p>I am looking to assign a kind of id for each row in my view and I appreciate any alternative ideas! :)</p>\n"},{"tags":["sql-server","azure","named-instance"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":13279378,"title":"Cannot connect to a 2008 sql server named instance hosted in a azure virtual machine","body":"<p>When I try to connect to a named instance in a SQL SERVER hosted in a azure VM I get this message: </p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occurred while\n  establishing a connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: SQL\n  Network Interfaces, error: 26 - Error Locating Server/Instance\n  Specified) (Microsoft SQL Server, Error: -1)</p>\n</blockquote>\n\n<p>The problem is the sql browser is not working properly, when I start the sql browser service it closes after a few seconds and the event log says <code>There are no instances of SQL Server or SQL Server Analysis Services.</code></p>\n\n<p>But I do have a named instance, I can connect locally to this instance.</p>\n\n<p>I've re-installed sql browser and the instance but ii does not work.</p>\n\n<p>The host is a azure virtual machine windows server 2008 datacenter.</p>\n\n<p>Please help.</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server","oracle","sharepoint2010"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3,"score":0,"question_id":13280032,"title":"Setting an external content type in SharePoint Designer 2010 - linked Oracle server","body":"<p>Okay, so I have an MS SQL server that's linked to an Oracle DB. I can use \"OPENQUERY\" to successfully query against it.</p>\n\n<p>What I'm trying to do now is create an external content type in SharePoint Designer 2010 that points to the MS SQL server but uses the Oracle DB. Here's what I tried:</p>\n\n<p>Connection Properties\nDatabase Server: [MS SQL server]\nDatabase Name: [Oracle DB name]\nConnect with Impersonated Custom Identity\nSecure Store Application ID: [MS SQL login]</p>\n\n<p>If anyone else has had success with this or can offer suggestions, I'd love to hear them and would be very appreciative :)</p>\n"},{"tags":["sql-server","visual-studio","visual-studio-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":13040563,"title":"How to export database schema in Visual Studio 2012?","body":"<p>I am having a hard time figuring out how to export a database creation script in VS 2012. Is this possible?</p>\n"},{"tags":["sql-server","sql-server-2008","case"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13278148,"title":"case statement to select multiple rows at once","body":"<p>I am looking to pull the same columns from two different tables, based on a conditional argument.</p>\n\n<p>So i have stumbled upon the CASE statement which I have not used much before. I have found this will work for me in this mannor, but I would like it if I could do one CASE statement and then select the columns i need, rather then doing it per column.</p>\n\n<p>Here is an example of what I have and working, just seems a little redundant.</p>\n\n<pre><code>SELECT TOP(10)\n    u1.userid as userid,\n    version = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN 3\n        ELSE 4\n    END,\n    nameOrg = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN CONVERT(NVARCHAR, u1.title)\n        ELSE CONVERT(NVARCHAR, u2.title)\n    END,\n    nameContact = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN CONVERT(NVARCHAR, u1.contact)\n        ELSE CONVERT(NVARCHAR, u2.contact)\n    END,\n    pltName = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN p1.name\n        ELSE p2.name\n    END\nFROM\n    usr1 u1\nLEFT OUTER JOIN\n    usr2 u2\n    ON u1.userid = u2.userid\nLEFT OUTER JOIN\n    plt2 p2\n    ON u2.pltid = p2.pltid\nLEFT OUTER JOIN\n    plt1 p1\n    ON u1.pltid = p1.pltid\n</code></pre>\n\n<p>Any advise?</p>\n\n<ul>\n<li>Edit mov 7, 5:22: added join to plt table and pltName case, to add to required functionality.</li>\n</ul>\n"},{"tags":[".net","sql-server","wpf","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":10,"score":3,"question_id":13278889,"title":"How to add data to SQL Server Express database using Entity Framework","body":"<p>I'm writing simple program for my university. I created an Entity Framework model, draw diagrams, created database from model, applied SQL file on my database and now I'm trying to add some items to the DB. </p>\n\n<p>I'm doing it this way:</p>\n\n<pre><code>using (NewsletterEntities context = new NewsletterEntities())\n{\n   Sender newSender = new Sender();\n   newSender.Login = Login.Text;\n   newSender.Password = Password.Text;\n   newSender.Port = 23;\n   newSender.SMTP = SMTP.Text;\n   newSender.Email = Email.Text;\n   newSender.SenderID = 0;\n\n   context.Senders.AddObject(newSender);\n   context.SaveChanges();\n}\n</code></pre>\n\n<p>When I try to execute it it pops up with inner exception: </p>\n\n<blockquote>\n  <p>Cannot insert explicit value for identity column in table 'Senders' when IDENTITY_INSERT is set to OFF.</p>\n</blockquote>\n\n<p>I was trying to look for the error, but I don't know much about entity framework and couldn't find anything specific.</p>\n\n<p>Can anyone help?</p>\n"},{"tags":["sql-server","constraints","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":21,"score":2,"question_id":13278514,"title":"How can I represent rows and columns in an application in MSSQL?","body":"<p>I have an application that displays tabular information and allows the user to enter and edit it. I have been working on the database design for this and have come across the following problem.</p>\n\n<p>I want to avoid creating an MSSQL table for each table in the application, so I've been trying to represent all of the tables together, in two tables.</p>\n\n<p>I have defined a <code>MyAppTable</code> table which has <code>Id INTEGER</code> primary key and a <code>Name CHARACTER VARYING(255)</code> columns.</p>\n\n<p>From there, I have defined a <code>MyAppColumn</code> table which foreign keys against the <code>MyAppTable.Id</code> column and also has a <code>Position INTEGER</code> column to indicate its position in the rendered table.</p>\n\n<p>Finally, I have defined a <code>MyAppRow</code> table which foreign keys against the <code>MyAppColumn.Id</code> column and has a <code>Data BINARY(32)</code> column. It's a table of small files, so this data type is fitting.</p>\n\n<p>The actual problem is that I cannot guarantee that the <code>MyAppColumn.Position</code> column will be unique for each <code>MyAppTable</code>.</p>\n\n<p>An example of a normal situation:</p>\n\n<ul>\n<li><code>MyAppTable</code> with <code>Id</code> 0</li>\n<li><code>MyAppColumn</code> with <code>Id</code> 0, <code>TableId</code> 0, <code>Position</code> 0</li>\n<li><code>MyAppColumn</code> with <code>Id</code> 1, <code>TableId</code> 0, <code>Position</code> 1</li>\n<li><code>MyAppRow</code> with <code>ColumnId</code> 0, <code>Data</code> [something]</li>\n<li><code>MyAppRow</code> with <code>ColumnId</code> 1, <code>Data</code> [something]</li>\n<li><code>MyAppTable</code> with <code>Id</code> 1</li>\n<li><code>MyAppColumn</code> with <code>Id</code> 2, <code>TableId</code> 1, <code>Position</code> 0</li>\n<li><code>MyAppRow</code> with <code>ColumnId</code> 2, <code>Data</code> [something]</li>\n</ul>\n\n<p>An example of a situation I want to make impossible in the database:</p>\n\n<ul>\n<li><code>MyAppTable</code> with <code>Id</code> 0</li>\n<li><code>MyAppColumn</code> with <code>Id</code> 0, <code>TableId</code> 0, <code>Position</code> 0</li>\n<li><code>MyAppColumn</code> with <code>Id</code> 1, <code>TableId</code> 0, <code>Position</code> 0</li>\n</ul>\n\n<p>As you can see, I want some way of constraining a pair of columns. The two columns <code>TableId</code> and <code>Position</code> should be <code>UNIQUE</code> but if that were done independently, it would mean two tables could never have columns both at a <code>Position</code> of 0.</p>\n\n<p>How can I accomplish this in Microsoft SQL Server 2012?</p>\n"},{"tags":["sql-server","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":18,"score":-1,"question_id":13278641,"title":"What is a wrapper for a stored procedure in sql server?","body":"<p>What is the definition of a wrapper for a stored procedure in sql server?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13277646,"title":"SQL Grouping by predefined date range","body":"<p>I have the following: </p>\n\n<p><a href=\"http://sqlfiddle.com/#!2/fca3d/1\" rel=\"nofollow\">http://sqlfiddle.com/#!2/fca3d/1</a></p>\n\n<p>I'm trying to now add one row for each week in the year, and filter the contacts accordingly.  The new table will look like: </p>\n\n<pre><code>        Status 1    Status 2    Status 3\nWeek 1      3          4           2\nWeek 2      1          5           3\nWeek 3      2          2           4\n</code></pre>\n\n<p>I think that DATEADD needs to be used, however I'm at a loss in terms of how to begin changing my query.  Any help would be much appreciated!  </p>\n"},{"tags":["sql-server","visual-studio-2010","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":13,"score":-1,"question_id":13277044,"title":"Entity Framework database not showing","body":"<p>When I select 'add a new item' and then select 'ADO.NET Entity Data Model' and select 'Generate from database' in Visual Studio only some databases show up but other databases I have added don't? </p>\n"},{"tags":["sql-server","sharepoint2010","sharepoint-designer","sql-server-2008-express"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1424,"score":1,"question_id":7890125,"title":"Connect Sharepoint 2010 (external content type) to MSSQL Linked Server","body":"<p>I can't seem to connect to my linked server database from within the external content type definition screen in Microsoft Sharepoint 2010.</p>\n\n<p>When I access my Linked Server from with SQL Server Management Studio, it works fine:</p>\n\n<pre><code>SELECT * FROM MyLinkedServer.MyCatalog.MyDatabase.MyTable\n</code></pre>\n\n<p>returns all the records just fine.</p>\n\n<p>But in Sharepoint I choose \"External Content Type\", i create one; On the next screen I click \"External system, click here to detect external datasources ..\" (or something similiar).</p>\n\n<pre><code>- Add connect/datasource  \n  * Datasourcetype: SQL server  \n  * Databaseserver: MySQLServerIP\\InstanceName (ex. 192.168.1.2\\SQLEXPRESS)  \n  * Databasename: MyLinkedServer.MyCatalog.MyDatabase (ex. AS400.COMPANY1.ERPSYS)  \n  * Name (optional): &lt;Empty&gt;  \n  * Select 'Connect using the user-id (first option)'  \n- OK.  \n</code></pre>\n\n<p>ERROR:</p>\n\n<blockquote>\n  <p>Cannot connect to the LobSystem (external system) Cannot open database\n  \"AS400.COMPANY1.ERPSYS requested by the login. The login failed. Login\n  failed for user 'MYDOMAIN\\me'.</p>\n</blockquote>\n\n<p>I use the same user for SQL Management studio and Sharepoint. I should have permission to access the Linked Server. I've set the specific credentials for the Linked Server for MYDOMAIN\\me.</p>\n\n<p>I can connect directly to a SQL database (which is not on a linked server) though..</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":33,"score":1,"question_id":13277588,"title":"SQL INNER JOINS in SP converting date and/or time from character string getting error message","body":"<p>I have searched about 20 results apertaining to the error message \"Conversion failed when converting date and/or time from character string.\" and none seem to address my issue.</p>\n\n<p>A little history, last Friday the queries were working just fine and the data returned was proper. On the following Monday, the queries no longer worked and gave this error message, \"Conversion failed when converting date and/or time from character string.\"  So, after a few hours of battling it was able to run a function with the offending code in it and the query ran perfect again. Until this morning. I came into the office and ran the query and received the error \"Conversion failed when converting date and/or time from character string.\"  So now I am pulling my hair out.</p>\n\n<p>I started by verifying each record being returned is, in fact, a valid date using the isDate function. All the dates are valid dates in string format. I am simply doing a check to see whether or not the record is older than 1 year. </p>\n\n<p>I do have several INNER JOINS and have been wondering if they are affecting the output.</p>\n\n<pre><code>SELECT \ngc2p.partnumber, gc2p.orderby, gc2p.campaigncode, gp2a.assetfilename\nFROM [StepMirror].[dbo].[stepview_nwppck_ngn_getclassification2productrefs] gc2p\n,[StepMirror].[dbo].[stepview_nwppck_ngn_getpimweblegalattrlist1] gpwa\n,[StepMirror].[dbo].[stepview_nwppck_ngn_getclassification2assetrefs] gc2a \n,[StepMirror].[dbo].[stepview_nwppck_ngn_getproduct2assetrefs] gp2a \nWHERE gc2p.partnumber=gpwa.PARTNUMBER and\ngc2p.id=gc2a.id and\ngp2a.PRODUCTNAME=gpwa.PARTNUMBER and\nATTRIBUTENAME='New Date' AND \nATTRIBUTEVALUE &gt; dateadd(month,-12,getdate()) AND \ngc2p.id = '5665976' and \ngc2a.assettype='Primary Image' AND \ngp2a.ASSETTYPE = 'Primary Image'\norder by gc2p.orderby\n</code></pre>\n\n<p>If anyone could give me a helping hand that would be wonderful.</p>\n\n<p>Edit: The query runs fine when I remove 'ATTRIBUTEVALUE > dateadd(month,-12,getdate())'. I forgot to mention the exact part of the query throwing the error.</p>\n\n<p>Edit: Updated Query - <strong>Now Working Query</strong> for those seeking a similar answer.</p>\n\n<pre><code>SELECT TOP 18 gc2p.partnumber, gpwa.ATTRIBUTECNAME,gp2a.ASSETFILENAME, gpwa.ATTRIBUTEVALUE\nFROM [StepMirror].[dbo].[stepview_nwppck_ngn_getclassification2productrefs] gc2p\nINNER JOIN [StepMirror].[dbo].[stepview_nwppck_ngn_getpimweblegalattrlist1] gpwa ON gc2p.partnumber=gpwa.PARTNUMBER and gpwa.ORDERBY='96'\nINNER JOIN [StepMirror].[dbo].[stepview_nwppck_ngn_getclassification2assetrefs] gc2a ON gc2p.id=gc2a.id\nINNER JOIN [StepMirror].[dbo].[stepview_nwppck_ngn_getproduct2assetrefs] gp2a ON gc2p.partnumber=gp2a.PRODUCTNAME\nWHERE gc2p.id = 5665976 AND gp2a.assettype='Primary Image' AND gc2a.assettype='Primary Image' \nAND(CASE WHEN ISDATE(ATTRIBUTEVALUE)  = 0 then NULL ELSE ATTRIBUTEVALUE END) &gt; dateadd(month,-12,getdate())\norder by gc2p.orderby\n</code></pre>\n"},{"tags":["sql-server","locking","partitioning"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13053531,"title":"SQL Server - Force shared lock on partition","body":"<p>I am using partition switching to rebuild indexes on a staging table without dropping them on the partitioned table as in <a href=\"http://msdn.microsoft.com/en-us/library/ms191160%28v=sql.105%29.aspx\" rel=\"nofollow\">microsoft's article</a>.</p>\n\n<p>I have what boils down to </p>\n\n<pre><code>BEGIN TRAN\nALTER INDEX IX_Working ON dbo.WorkingTable DISABLE\n\nINSERT INTO dbo.WorkingTable ( Id, PartitionColumn, Values...)\nSELECT Id, PartitionColumn, Values...\nFROM PartitionedTable WITH (HOLDLOCK)\nWHERE PartitionColumn &lt;= @rightboundary\nAND PartitionColumn &gt; @leftboundary\n\nINSERT INTO WorkingTable ( Id, PartitionColumn, Values...)\nSELECT Id, PartitionColumn, Values...\nFROM Imports\n\nALTER INDEX IX_Working ON WorkingTable REBUILD -- SLOW BIT\n\nALTER TABLE PartitionedTable SWITCH PARTITION @partition TO SwapTable\nALTER TABLE WorkingTable SWITCH TO PartitionedTable PARTITION @partition\n\nTRUNCATE TABLE SwapTable\nCOMMIT\n</code></pre>\n\n<p>Now during this operation I need to block any updates to the partition being reindexed but still allow them on other partitions. The PartionedTable has lock escalation set to auto. I am trying to do this with the HOLDLOCK but I'm still able to do INSERT INTO PartionedTable (Id, @somevalueInTheRange, Values...) from another connection during the slow bit.</p>\n\n<p>How can I block this while still allowing selects?</p>\n"},{"tags":["sql","sql-server","percentile"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13278051,"title":"SQL Percercentile Calculation","body":"<p>I have the following query, which even without a ton of data (~3k rows) is still a bit slow to execute, and the logic is a bit over my head - was hoping to get some help optimizing the query or even an alternate methodology:</p>\n\n<pre><code>Select companypartnumber, (PartTotal + IsNull(Cum_Lower_Ranks, 0) ) / Sum(PartTotal) over() * 100 as Cum_PC_Of_Total\nFROM PartSalesRankings PSRMain\nLeft join \n    (\n        Select PSRTop.Item_Rank, Sum(PSRBelow.PartTotal) as Cum_Lower_Ranks\n          from partSalesRankings PSRTop\n          Left join PartSalesRankings PSRBelow on PSRBelow.Item_Rank &lt; PSRTop.Item_Rank\n         Group by PSRTop.Item_Rank \n    ) as PSRLowerCums on PSRLowerCums.Item_Rank = PSRMain.Item_Rank\n</code></pre>\n\n<p>The PartSalesRankings table simply consists of CompanyPartNumber(bigint) which is a part number designation, PartTotal(decimal 38,5) which is the total sales, and Item_Rank(bigint) which is the rank of the item based on total sales.</p>\n\n<p>I'm trying to end up with my parts into categories based on their percentile - so an \"A\" item would be top 5%, a \"B\" item would be the next 15%, and \"C\" items would be the lower 80th percentile.  The view I created works fine, it just takes almost three seconds to execute, which for my purposes is quite slow.  I narrowed the bottle neck to the above query - any help would be greatly appreciated.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":13,"score":0,"question_id":13277056,"title":"How to check SQL Server Performance Tuning for Stored Procedures","body":"<p>I'm creating a stored procedures for an application that will generate some business logic in <a href=\"/questions/tagged/sql-server\" class=\"post-tag\" title=\"show questions tagged 'sql-server'\" rel=\"tag\">sql-server</a>.  How can I check performance of stored procedures like speed,accuracy etc. \nAny ideas or direction will be much appreciated</p>\n"},{"tags":["sql-server","northwind"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13277670,"title":"Select Company Names with more than X Orders","body":"<p>The Order table has the list of orders as well as a Customer ID for every order. And different orders can have the same customer ID , meaning a company has put in multiple orders (Given that Customer ID is the ID for the company).</p>\n\n<p>Company Name comes from the Customer Table and my goal is to select company names with more than X number of orders.</p>\n\n<p>Now, my first step is to join these two tables to compare, and then I can also Select company name, but I am confused as to how to select only the companies with more than X orders.</p>\n\n<p>So far I have this, which writes out a company name X amount of times for X amount of orders they have issued. </p>\n\n<pre><code>SELECT CompanyName\n    FROM Orders, Customers\n        WHERE Orders.CustomerID = Customers.CustomerID;\n</code></pre>\n\n<p>How do I only get the company names greater than X Orders? I tried with \nWHERE COUNT(CompanyName)>3 , but that just gave errors. I don't think I learned any other\nway how to quantitize Selects from columns.</p>\n"},{"tags":["sql","sql-server","query","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":35,"score":3,"question_id":13276318,"title":"Returning not found values in query","body":"<p>I'm working on a project, and I have a list of several thousand records that I need check.  I need to provide the list of the ones NOT found, and provide the query I use to locate them so my superiors can check their work.</p>\n\n<p>I'll admit I'm relatively new to SQL. I don't have access to create temporary tables, which is one way I had thought of to do this.</p>\n\n<p>A basic idea of what I'm doing:</p>\n\n<pre><code>select t.column1, t.column2\nfrom table1 t\nwhere t.column1 in ('value1','value2','value3')\n</code></pre>\n\n<p>If value1 and value3 are in the database, but value2 is not, I need to display value2 and not the others.</p>\n\n<p>I have tried <code>ISNULL</code>, embedding the query, and trying to select <code>NOT</code> values from the query.  </p>\n\n<p>I have searched for returning records not found in a query on Google and on this site, and still found nothing.</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":13277674,"title":"convert string to date in sql server","body":"<p>How do I convert <code>YYYY-MM-DD</code> (<code>2012-08-17</code>) to a date in SQL Server?</p>\n\n<p>I don't see this format listed on the help page: <a href=\"http://msdn.microsoft.com/en-us/library/ms187928.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms187928.aspx</a></p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13277549,"title":"SQL server exclude anything but a number","body":"<p>is their a way to exclude results pulled in a query that start with anything but a number. Exclude anytXing starting in a letter.</p>\n\n<p>I tried</p>\n\n<pre><code> Where a.value like '0%'\n       And a.value  like '1%'\n       And a.value like '2%' \n         .......3-9\n</code></pre>\n"},{"tags":["sql-server","function"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13276798,"title":"function separate string","body":"<p>I have this question for you.I am working a function which has the whole address in one field.I am trying to separate it.I have started working on the one below and I am having difficulty when I try to work on the zip ,I want to test if there is a zip first at the end and if so I am trying to separate it from the state.Could you please have alook at it?Thanks alot guys as usual I appreciate you support..</p>\n\n<pre><code>      declare @var1 varchar(100)='1234 S.Almeda way,Seattle,WA9810'--just an example\n        ,@u int\n        ,@r int\n        ,@var2 varchar(100)\n        ,@var3 varchar(100)\n        ,@Zip varchar(25)\n        ,@var4 varchar(100)=null\n             set @u = charindex(',', @var1)\n             set @var2=rtrim(ltrim(substring(@var1, @u+1, 999)))\n             set @r=CHARINDEX(',',@var2)\n             set @var3=rtrim(ltrim(substring(@var2, @r+1, 999)))\n\n             --set @var4=RIGHT(@var3,5)--not enough\n             if (len(@var3)&gt;=5 and ISNUMERIC(@var3)=1 )\n             set  @var4=RIGHT(@var3,5)\n             set rtrim(substring(@var3,1,len(@var3)-5))\n             else set @var4=''\n</code></pre>\n"},{"tags":["sql-server","tsql","inner-join"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":27,"score":2,"question_id":13277252,"title":"Effectively COUNTing and SUMing on a large inner join","body":"<p>Please consider the following case (simplified for the sake of the question):</p>\n\n<p>I have the following tables in the SQL Server 2012 database:</p>\n\n<pre><code>Parent_Table\n\nId  | Parent table fields\n----+--------------------\n1   | ...\n2   | ...\n3   | ...\n...\n\nChild_Table\n\nId  | ParentId | Child table fields\n----+----------+-------------------\n1   | 2        | ...\n2   | 1        | ...\n3   | 1        | ...\n4   | 3        | ...\n5   | 2        | ...\n...\n\nBig_Table\n\nId      | ChildId  | Value  | Status  | Other fields\n--------+----------+--------|---------------------\n1       | 12       | 672    | Closed  |\n2       | 23       | 133    | Closed  |\n3       | 7        | 2611   | Open    |\n4       | 14       | 84     | Closed  |\n...\n1295769 | 23       | 458    | Closed  |\n1295770 | 18       | 1046   | Open    |\n1295771 | 7        | 8      | Open    |\n</code></pre>\n\n<p>The Child and Parent tables are relatively small (roughly 100 Parent entries and 5 Child entries per parent) and their entries are inserted or deleted only a few times a day.</p>\n\n<p>The \"Big Table\", on the other hand, is growing fast (100 entries per second, for the sake of discussion), and the status of rows becomes Closed after a while (think of client sessions, which is the actually the case here).</p>\n\n<p>I need to periodically (every few seconds) provide the number of Big_Table rows and the sum of the Big_Table.Value column <strong>for a specified Parent.Id</strong> - a different one every time.</p>\n\n<p>I suspect that the straightforward implementation (using inner joins etc.) might be extremely inefficient, and better solution may include additional tables, a table of counters of some sort or I should just implement this in my service code (?!) and take care of persistence somehow.</p>\n\n<p>What would be the \"right\" (efficiency-wise) way of implementing the above?  A solution which handles additional levels of parents/children would be the best one. </p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13276778,"title":"Changing the name of a SQL database missing tables","body":"<p>when changing the name of a SQL server 2005 database moving mdf and ldf files.</p>\n\n<p>First i run a script in my program's install:</p>\n\n<pre><code>Alter Database [[DBNAME]] MODIFY NAME = [[RENAMEDBNAME]] \n\nAlter Database [[RENAMEDBNAME]] MODIFY FILE ( NAME =  [[DBNAME]], NEWNAME = [[RENAMEDBNAME]] )\n\nAlter Database [[RENAMEDBNAME]] MODIFY FILE ( NAME =  [[DBNAME]_log], NEWNAME = [[RENAMEDBNAME]_log] )\n\nAlter Database [[RENAMEDBNAME]] MODIFY FILE ( NAME =[[RENAMEDBNAME]]  , FILENAME  ='[DBPATH][RENAMEDBNAME].mdf'  )\n\nAlter Database [[RENAMEDBNAME]] MODIFY FILE ( NAME =[[RENAMEDBNAME]_log]  , FILENAME  ='[DBPATH][RENAMEDBNAME]_log.ldf'  )\n</code></pre>\n\n<p>ALTER DATABASE  [[RENAMEDBNAME]] SET OFFLINE GO</p>\n\n<p>then I move the files in code.</p>\n\n<p>then in the next script I use</p>\n\n<pre><code>ALTER DATABASE  [[RENAMEDBNAME]] SET ONLINE GO\n</code></pre>\n\n<p>The tables are missing from the database - Any ideas?\nShould I use backup and restore?</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","sql-server","sqlcommand"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13276173,"title":"SQL command returns invalid object name database.table","body":"<p>I run this code:</p>\n\n<pre><code>                    SqlConnection polaczenie;\n                    polaczenie = new SqlConnection(dane_polaczenia);\n                    SqlCommand cmd = new SqlCommand();\n                    cmd.Connection = polaczenie;\n                    polaczenie.Open();\n                    cmd.CommandText = @\"SELECT * FROM test.test\";\n                    cmd.ExecuteNonQuery();\n</code></pre>\n\n<p>After executing I got exception <code>Invalid object name 'test.test'.</code> </p>\n\n<p>Database and table values are correct.</p>\n\n<p>How to specify <code>database.table</code> in <code>CommandText</code> correctly?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008-r2"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13274628,"title":"SQL Server - Count characters between two characters","body":"<p>How would one count the number of letters (alphabetically a to z or z to a) between two characters?</p>\n\n<p>For example:</p>\n\n<pre><code>WITH    ExampleData\n          AS ( SELECT   'a' AS StartChar, 'e' AS EndChar\n               UNION ALL\n               SELECT   'm', 'r'\n               UNION ALL\n               SELECT   'f', 'a'\n             )\n    SELECT  StartChar ,\n            EndChar\n    FROM    ExampleData\n</code></pre>\n\n<p>Would need to produce:</p>\n\n<pre><code>StartChar   EndChar    Diff\na           e          4\nm           r          5\nf           a          -5\n</code></pre>\n\n<p>I see how this could easily be done using udf's and a while loop but I was wondering if there was a faster way?</p>\n"},{"tags":["sql","sql-server","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13268760,"title":"Alter stored procedure or function added extra blank line gap","body":"<p>In SQL Server 2012 when I write code for stored procedure and for any function. After that when I want to alter it added extra blank line gap, that's why it seem very unacceptable lenghty..</p>\n\n<pre><code>CREATE proc sp_delete_Rte_article_admin_Latest   \n(    \n@id int    \n)    \nas    \nbegin    \nif exists (select * from tblRte where Id=@id )    \nbegin    \n    declare @IvanID bigint  \n\n    set @IvanID=(select [IvanArtId] from tblRte where Id=@id )  \n    insert into tblRteOnDelete([IvanArtId],[StoryType],[ChannelType],[Filename],\n                [Headline],[PublishDate],[Title],[DocScope],[KeyWord],[Byline],[City],\n                [State],[StoryDate],[BodyContents],[DownloadedDate],DeleteDate)\n    select [IvanArtId],[StoryType],[ChannelType],[Filename],[Headline],[PublishDate],\n           [Title],[DocScope],[KeyWord],[Byline],[City],[State],[StoryDate],\n           [BodyContents],[DownloadedDate],GETDATE()\n      from tblIvanhoeXmlFeeds\n     where Id=@id   \n\n    delete from tblRte where Id=@id   \n    delete from tblUpdatedRteTopics where IvanArtId=@IvanID  \n    delete from tblCheckAllowRte where ArticleID=@IvanID  \n    delete from tblAddRteeApprove where ArticleID=@IvanID  \n\n    return 1    \nend    \nelse    \nbegin    \n    return 0    \nend    \nend\n</code></pre>\n\n<p>What should do for moving this for all time..any setting ?</p>\n"},{"tags":["sql-server","windows","oracle","iis","rdf"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13273227,"title":"Semantic Web - Store app data directly in RDF or store in SQL and export/import later","body":"<p>I have a standard IIS web application which stores its data in a standard SQL Server or Oracle DB.\nI'm now interested in storing the data in <a href=\"http://www.rdfabout.com/quickintro.xpd\" rel=\"nofollow\">RDF</a> format, to go full <strong>Semantic Web</strong>.</p>\n\n<p>Is it recommended to store data directly in RDF format? CRUDQ operations will be done on the data. Performance wise is this a good move?</p>\n\n<p><strong>If not</strong> (like I'm assuming), I guess I'd maintain standard SQL DBs and export/import data to/from RDF? How can I do this? Are there good converters out there?</p>\n"},{"tags":["sql-server"],"answer_count":14,"favorite_count":2,"up_vote_count":18,"down_vote_count":0,"view_count":59542,"score":18,"question_id":546746,"title":"SQL Server 2008 Windows Auth Login Error: The login is from an untrusted domain","body":"<p>When attempting to connect to a SQL Server 2008 Instance using Management Studio, I get the following error:</p>\n\n<blockquote>\n  <p>Login failed. The login is from an\n  untrusted domain and cannot be used\n  with Windows authentication.\n  (Microsoft SQL Server, Error: 18452)</p>\n</blockquote>\n\n<p>I can login using SQL Authentication without problem.  I've been getting this error all of a sudden.  I have Mixed Mode Authentication turned on.  </p>\n\n<p>Does anyone have any experience with this?</p>\n\n<p>Additional Info:\n64-bit version of SQL\nEnterprise Edition\nOn Windows 2003 Server</p>\n\n<p><strong>EDIT: The issue was caused by a down Active Directory Server, which of course could not authenticate the Windows account. Thank you for your assistance.</strong>   </p>\n"},{"tags":["sql-server","tsql","database-performance"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13274083,"title":"COLLATE clause cannot be used on expressions containing a COLLATE clause","body":"<p>I have two tables: tab1 and tab2. Every table has only one VARCHAR(MAX) column.</p>\n\n<p>I need to obtain only those pairs of values, which are equals, but differs in only case.</p>\n\n<p>Example input:</p>\n\n<pre><code>tab1.t1     tab2.t2\n-----------------------\nfff     fff\nFFF     fff\nFff     fff\nFFF     FFA\nFfA     FFF\nFFF     aaa\nbbb     aaa\n\nRelated output:\n\nt1      t2\n-----------------------\nfff     FFF\nFFF     fff\nFff     fff\nFff     FFF\nFfA     FFA\n</code></pre>\n\n<p>Tables tab1 and tab2 are big enough in real our real database (~ 800-1000 rows). And there are about 500-600 columns for which I need to produce this operation.</p>\n\n<p>So I need to write a fast solution.\nI write an alghoritm:</p>\n\n<ol>\n<li>remove all duplicates using case sensitive collation from tab1</li>\n<li>remove all duplicates using case sensitive collation from tab2</li>\n<li>join result sets from previous steps using case insensitive collation</li>\n<li>filter out (WHERE clause) rows which values are not equals using case sensitive collation</li>\n<li>remove duplicate rows using case sensitive collation</li>\n</ol>\n\n<p>I tried so:</p>\n\n<pre><code>SELECT DISTINCT tt.t1 COLLATE Cyrillic_General_CS_AS, tt.t2 COLLATE Cyrillic_General_CS_AS\nFROM (\n    SELECT tt1.t1, tt2.t2\n    FROM \n    (\n        SELECT tab1.t1 COLLATE Cyrillic_General_CS_AS\n                       AS t1\n        FROM (VALUES('fff'),('FFF'),('Fff'),('FFF'),('FfA'),('FFF'),('bbb')) AS tab1(t1)\n        GROUP BY tab1.t1 COLLATE Cyrillic_General_CS_AS\n    ) tt1 INNER JOIN\n    (\n        SELECT tab2.t2 COLLATE Cyrillic_General_CS_AS\n                       AS t2\n        FROM (VALUES('fff'),('fff'),('fff'),('FFA'),('FFF'),('aaa'),('aaa')) AS tab2(t2)\n        GROUP BY tab2.t2 COLLATE Cyrillic_General_CS_AS\n    ) tt2\n    ON tt1.t1 = tt2.t2 COLLATE Cyrillic_General_CI_AS\n) AS tt\nWHERE tt.t1 &lt;&gt; tt.t2 COLLATE Cyrillic_General_CS_AS\n</code></pre>\n\n<p>but it an error occur:</p>\n\n<blockquote>\n  <p>\"COLLATE clause cannot be used on expressions containing a COLLATE clause.\"</p>\n</blockquote>\n\n<p>Please suggest me how to avoid this problem without using user defined functions, temp tables, or removing group by clause (i tried them - they hardly slow down execution).</p>\n"},{"tags":["sql-server","firefox","google-chrome","vfp"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13275818,"title":"Create a VFP Chrome or FireFox Object","body":"<p>We have a VFP application and need to open a specific site in Chrome or Firefox.  The site is optimized for either of those browsers.</p>\n\n<p>We know how to <code>Createobject</code> for <code>InternetExplorer.Application</code> to open a browser inside our application.  This allows us to interract with the browser.  However, it works only with <code>IE</code>.  </p>\n\n<p>Does anyone know how to accomplish the same purpose using either <code>Chrome</code> or <code>Firefox</code>?  </p>\n\n<p>We have done this to open the default browser (which is <code>Chrome</code> or <code>Firefox</code>).</p>\n\n<pre><code>oShell = Createobject(\"wscript.shell\")\noShell.Run(lcUrl)\n</code></pre>\n\n<p>The issue with this approach is that it just opens the browser and we cannot interact with it (e.g. pass values and read items on the page).</p>\n\n<p>At a minimum, if we can open <code>Chrome</code> or <code>Firefox</code> and pass POST parameters without using a <code>querystring</code> that would be an acceptable start.</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13275758,"title":"Cannot connect with sqmcmd although MS SQL Server Management Studio can","body":"<p>I have a case where I need to connect to a remote database. Using MS SQL Server Management Studio I can connect without any problems. But I have trouble doing the same with sqlcmd.</p>\n\n<p>Can someone tell me what the Mgmt Studio does differently?</p>\n\n<p>Right now, I'm doing this:</p>\n\n<pre><code>sqlcmd /S server_name -E\n</code></pre>\n\n<p>I'm using SQL Server 2008 R2.</p>\n\n<p>Thanks,\nChristian</p>\n"},{"tags":["sql","sql-server","database","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":21,"score":2,"question_id":13274950,"title":"list all tables that don't exist but are used in a view sql server","body":"<p>I can't seem to get all the table names that a view is trying to use.</p>\n\n<p>Currently, I am using <code>INFORMATION_SCHEMA.VIEW_COLUMN_USAGE</code> to find which tables are used. But, it only finds tables that currently exist. I want to find out if that view is trying to use tables that don't exist.</p>\n\n<p><code>View_Column_Usage</code> will only find columns that are used in the view. You can check to see if those columns are in any of the current tables columns to find which columns aren't used, but you can't find which tables aren't used.</p>\n\n<p>Does anyone know a table I can use to find which tables are used in a view, but do not exist?</p>\n"},{"tags":["c#",".net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":12964757,"title":"Pass sysname in datatable TVP","body":"<p>I have a stored procedure using the type below as a param</p>\n\n<pre><code>    CREATE TYPE [dbo].[columnOrderTableType] AS TABLE\n     ([id]                     [int]        IDENTITY(1,1) NOT NULL\n     ,[columnName]             [sysname]                  NOT NULL\n</code></pre>\n\n<p>I need to pass a datatable from my api as TVP to this sproc</p>\n\n<p>When I use string as value for the columnName I get an error saying that type doesnt match the types reqd for columnOrderTableType</p>\n\n<p>How do I pass a sysname in datatable?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13267949,"title":"Update field in Source table with Identity after insert target with merge statement","body":"<p>I have a table Items which should have a corresponding record in the table LanguageText. The ID (Identity) of LanguageText is registered in the Items.LanguageTextId field in my Items table.</p>\n\n<p>What I want to accomplish is a merge between LanguageText and Items for all records with null in Items.LanguageTextId and insert the itemname / text of these Item records in LanguageText plus update the LanguageTextId with the ID value from the newly inserted LanguageText record (SCOPE_IDENTITY()?)</p>\n\n<p>The insert works fine:</p>\n\n<pre><code>MERGE [dbo].[LanguageText] AS target\nUSING (SELECT [Items].* from [dbo].Items ) AS source \nON (TARGET.Id = SOURCE.LanguageTextId) \nWHEN NOT MATCHED By Target THEN \n    INSERT   \n       ([Text])\n VALUES\n       (source.[ItemName]);\n</code></pre>\n\n<p>end</p>\n\n<p>But I don't know how to update my items.Languagetextid, can I do something with:\nOUTPUT $action, INSERTED.ID ?\nOr is there a better way to have this done??</p>\n\n<p>Thanks in advance,</p>\n\n<p>Mike</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13275613,"title":"ASP.NET multiple dropdownlists options from SQL Server","body":"<p>I want to make 2 dropdownlist. First dropdownlist(Second dropdownlist won't show up until first one is selected) will have 3 choice to choose which table want to view. After select one of those, the second dropdownlist show up with list of values from specific column. After select one of those, then GridView table will show up to show display only from second selected dropdownlist. For example, first dropdownlist will have Cluster, Server, and Database. I select Database then second dropdownlist show up with list of Database name. I pick Database77 and then GridView table show up with results only from Database77.</p>\n\n<p>Is there any good example you can provide or a link from website?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","version-control"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":38,"score":2,"question_id":13274498,"title":"Add version control to existing SQL Server database","body":"<p>I am part of a development team currently working with a database that does not have any kind of source control. We work with SQL Server 2008 R2 and have always managed the DB directly with SSMS. It now has ~340 tables and ~1600 stored procedures, plus a few triggers and views, so it is not a small DB.</p>\n\n<p>My goal is to have the DB under version control, so I have been reading articles, like <a href=\"http://bitly.com/9cJmGR\" rel=\"nofollow\">Scott Allen's series</a> and many old SO related questions. But I am still unable to decide on how to proceed.</p>\n\n<p>What I'm thinking of is to script the database schema in one file, then procedures, triggers and views in one file each. Then keep everything versioned under Mercurial. But of course, every member of the team can access SSMS and directly change the schema and procedures, with the possibility that any of us can forget to replicate those changes in the versioned files.</p>\n\n<p>What better options are there? And, did I forget any element worth having source control of? My biggest concern is that most of the literature I found explains how to do version control when creating a new database, but not when it is already old and relatively big.</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13273371,"title":"storing images in database or on hard drive","body":"<p>I'm working on an ASP.NET web app, this web site is hosted on a VDS (virtual dedicated server) which has a big hard drive (30 GB). Users can upload pictures and currently images are stored in database image columns (SQL server 2008). Is it better to store images as files on hard drive instead of saving them in database? what are pros and cons of each method? I think there would be about 100 pictures each day so I suppose database will grow quickly and finally I'll have a really big MDF file!</p>\n"},{"tags":["sql-server","vb.net","impersonation","runas"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16,"score":1,"question_id":13273300,"title":"Impersonate remote user in vb.net to access MS SQL Server","body":"<p>I'm trying to impersonate a domain user over vpn. I am able to run management studio from the command prompt using the RUNAS command. However, I can't do the same with my vb application (.net 4.5, winforms, using VS 2012 Express) in either debug mode or published app. Here is what I tried:</p>\n\n<ul>\n<li>runas command of my application (from the location of the shortcut in Start Menu Programs, as well as the executable); in these cases, after I input the password in the command prompt, I get 'unknown user or bad password' error.</li>\n<li>I've tried the impersonate user within the code as indicated on several websites such as [http://williamfaulkner.co.uk/2009/04/vbnet-run-as-administrator-impersonate-a-user-2008/][1], which seems like a variation of that listed on MSDN that uses calls advapi.dll (I'm not really sure how it works). In this case, I also get 'unknown user or bad password' error when the code tries to query the SQL server.</li>\n</ul>\n\n<p>Does anyone have any explanation for these errors and/or how I might solve this. I'm assuming that if I can impersonate and run ssms, I should be able to do it within my vb app.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server","tsql","binary","hex","like-operator"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13262433,"title":"Binary column SELECT with LIKE","body":"<p>I'm trying to find specific lines of data from a <code>BINARY</code> column.</p>\n\n<p>Example data in the <code>BINARY(2000)</code> column:</p>\n\n<pre><code>0x0600700701000C006B6173616E74696E676B6F000000000003000A0078009C0000000000E612101E000000000000000000006B031813361E00000000000000000000D4014B13141C0000000000000000000053017C13261E00000000000000000000A102E113361E000000000000000000009E02FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF2201073200000000000000000000D604D11C101C000000000000000000008C01FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0170000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000220047003700280016000F0001000B0003003F000000480200001D0000003101000000000000562B00003710000000000000134B000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB517010000000000000000000000000012060200000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF191404000000000000000000000000009A13051D00000000000000000000A0029A13051D00000000000000000000A002BC3B0700000000000000000000000000FE050817000000000000000000000000FE05091E00000000000000000000000012060200000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF191404000000000000000000000000009A13051D00000000000000000000A0029A13051D00000000000000000000A002FB050F0D000000000000000000000100FB05101E000000000000000000000100FB05111E000000000000000000000100FE13121D00000000000000000000B402FE13121D00000000000000000000B402E213141E00000000000000000000BC02E213141E00000000000000000000BC023613161D00000000000000000000FE003613161D00000000000000000000FE00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB05191E000000000000000000000100FE13121D00000000000000000000B402FE13121D00000000000000000000B402E213141E00000000000000000000BC02E213141E00000000000000000000BC023613161D00000000000000000000FE003613161D00000000000000000000FE000413201E00000000000000000000CC000413201E00000000000000000000CC002E01222C000000000000000000008F052E01222C000000000000000000008F05FB05241E000000000000000000000100FB05251E000000000000000000000100FB05261E000000000000000000000100FB05271E0000000000000000000001000413201E00000000000000000000CC000413201E00000000000000000000CC002E01222C000000000000000000008F052E01222C000000000000000000008F05FB052C1E000000000000000000000100FC052D1E000000000000000000000000A9262E2E000000000000000000000000A9262E2E000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF2E01222C000000000000000000008F052E01222C000000000000000000008F05FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA9262E2E000000000000000000000000A9262E2E000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070000005E000000000000000000000000000000000000000500000000000000FFFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n</code></pre>\n\n<p>This data has 1 result of <code>2201</code> somewhere in it. (try searching the data for 2201 and you will get 1.)</p>\n\n<p>Now I'm trying to use this query: (it should give me 512 rows of results)</p>\n\n<pre><code>SELECT * \nFROM table\nWHERE binaryfield LIKE '%2201%'\nORDER BY key\n</code></pre>\n\n<p>But no luck in getting results.</p>\n\n<p>Notes: 2201 actually is 290. I'm trying to look for the decimal value 290 which is 2201 in hex in the data that is in endian.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>Tried this query (searching for: 15584)</p>\n\n<pre><code>SELECT *\nFROM CHAR_DATA1\nWHERE CHAR_DATA LIKE '%'+CAST(0xE03C AS nvarchar(MAX))+'%'\nORDER BY CHAR_KEY;\n</code></pre>\n\n<p>Now its returning almost all rows. Even manually checked the rows for E03C but none was found, but when running the query it gets returned. very odd. ideas?</p>\n"},{"tags":["sql-server","entity-framework-5","localdb"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13275054,"title":"EF5: Cannot attach the file {0}' as database '{1}'","body":"<p>I'm encountering the exact issue as described <a href=\"http://odetocode.com/Blogs/scott/archive/2012/08/14/a-troubleshooting-guide-for-entity-framework-connections-amp-migrations.aspx\" rel=\"nofollow\">here</a> (read section \"Cannot Attach to Deleted MDF File\"), but the solution to the problem is not told there...</p>\n\n<p>I did delete the DB file and now I get that nasty error message when running the application expecting it to use it's initializer.\nAny way to fix this?</p>\n"},{"tags":["c#","java","sql-server","jdbc","odbc"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13274852,"title":"What Java and/or C# frameworks are avaiable to implement SQL server accessible via ODBC/JDBC?","body":"<p>I need to figure out how to create server which behaves like SQL server in respect of accepting connections via ODBC, JDBC, etc, but implemented by me on C# (and/or Java) I.e. I don't want to create tables, call stored procs etc.\nFor the sake of example I just want to have query implemented:</p>\n\n<p>select * from HardcodedTableOfMyFavoriteColors</p>\n\n<p>Any other queries should just fail. The query should return just few colors (hardcoded in server code).</p>\n\n<p>If somebody interested why I need such thing the answer is below.</p>\n\n<p>My actual purpose is to be able to create C# (or Java) server accessible via JDBC/ODBC/etc way from legacy app with strictly defined set of queries. I hope framework will be able to parse query to XML to make my life a bit easier. However response data will be generated by my code and could be something depending on other systems, time etc. On client side response should look like usual SQL server response processed via the same JDBC/ODBC etc API calls.\nBy doing such substitution I hope to reimplement bloated stored procedure logic in C# (or Java) without need to change clients.</p>\n\n<p>Unfortunately I have to have implementation of such SQL-mimic server on both Linux and Windows because I forced to deal with home-grown Java library on Linux and C# on Windows to access custom COM objects.</p>\n\n<p>Anyone?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13274296,"title":"Auto Increment feature of SQL Server","body":"<p>I have created a table named as ABC. It has three columns which are as follows:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/3sx3t.png\" alt=\"enter image description here\">              </p>\n\n<p>The column <code>number_pk</code> <code>(int)</code> is the <strong>primary key</strong> of my table in which I have made the <code>auto increment</code> feature on for that column.</p>\n\n<p>Now I have deleted two rows from that table say <code>Number_pk= 5</code> and <code>Number_pk =6</code>.</p>\n\n<p>The table which I get now is like this:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/bTpbm.png\" alt=\"enter image description here\"></p>\n\n<p>Now if I again enter two new rows in this table with the same value I get the two new <code>Number_pk starting from 7 and 8</code> i.e,</p>\n\n<p><img src=\"http://i.stack.imgur.com/Y3fLv.png\" alt=\"enter image description here\"></p>\n\n<p>My question is that what is the logic behind this since I have deleted the two rows from the table. I know that a simple answer is because I have set the auto increment on for the primary key of my table. But I want to know is there any way that I can insert the two new entries starting from the last Number_pk without changing the design of my table?</p>\n\n<p>And how the <strong><em>SQL Server manage this record since I have deleted the rows from the database??</em></strong></p>\n"},{"tags":["sql-server","visual-studio-2012","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13274573,"title":"Entity Framework 5 SaveChanges does not save data to all related tables","body":"<p>I am updating an Entity Framerwork 4.1 / MVC 3 to Entity Framework 5.0 / MVC 4 using Visual Studio 2012. The database is SQL Server 2005. Below is an image of the database tables and their relationships. Each table has a primary key. The primary keys in the auxillary tables are Identity. Tables are related by FormId. </p>\n\n<p><img src=\"http://i.stack.imgur.com/kX9QH.png\" alt=\"Database Tables\"></p>\n\n<p>When I <strong>Update from Database</strong>, EF imports the tables and their relationships.</p>\n\n<p>Using EF 4.1 I was able to write the following code that successfully saved (inserted) in all four tables with one SaveChanges() call. I created a new GUID programmatically and added nsForm to the other three tables. When SaveChanges() was executed, EF 4 saved NSForm first and applied the FormId to the other three tables automatically as it saved each of them.</p>\n\n<pre><code>        DateTime currentDateTime = DateTime.Now;\n        Guid formGuid = System.Guid.NewGuid();\n        bool success = false;\n\n            using (var context = new NSAFormsEntities())\n            {\n                NSAFormsEDM.NSForm nsForm = new NSAFormsEDM.NSForm();\n                SpeakerphoneForm speakerphoneForm = new SpeakerphoneForm();\n                NSAFormsEDM.Requestor requestor = new NSAFormsEDM.Requestor();\n                NSAFormsEDM.Authorizer authorizer = new NSAFormsEDM.Authorizer();\n\n                nsForm.FormGuid = formGuid;\n                nsForm.Form = \"Speakerphone\";\n                nsForm.CreateDate = currentDateTime;\n                nsForm.ModifiedBy = currentUser;\n\n                #region Speakerphone\n                speakerphoneForm.FormGuid = formGuid;\n                speakerphoneForm.ServiceDate = speakerphoneVM.ServiceDate;\n                speakerphoneForm.LocationId = speakerphoneVM.LocationId;\n                speakerphoneForm.CreateDate = currentDateTime;\n                speakerphoneForm.CreatedBy = currentUser;\n                speakerphoneForm.NSForm = nsForm;\n                #endregion\n\n                #region Requestor\n                requestor.FormGuid = formGuid;\n                requestor.NetworkId = currentUser;\n                requestor.CreateDate = currentDateTime;\n                requestor.CreatedBy = currentUser;\n                requestor.NSForm = nsForm;\n                #endregion\n\n                #region Authorizer\n                authorizer.FormGuid = formGuid;\n                authorizer.NetworkId = authorizerVM.NetworkId;\n                authorizer.CreateDate = currentDateTime;\n                authorizer.CreatedBy = currentUser;\n                authorizer.NSForm = nsForm;\n                #endregion\n\n                context.NSForms.Add(nsForm);\n                context.SaveChanges();\n                success = true;\n            }\n</code></pre>\n\n<p>Now, using EF 5.0 only data in NSForm is inserted. Apparantly, EF 5 no longer propogates the FormId key, as expressed in the table relationships, to the three auxillary tables</p>\n\n<p>Questions: How should code using EF 5 be written in order to insert data into all of the tables with one SaveChanges() call?</p>\n\n<p>Thanks,</p>\n\n<p>Arnold</p>\n"},{"tags":["sql","sql-server","query","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13274256,"title":"Swapping rows and columns in a \"Group by\" query","body":"<p>I currently have the following: </p>\n\n<pre><code>SELECT status,count(status) AS count\n  FROM [DB].[dbo].[contact]\n  GROUP BY status\n</code></pre>\n\n<p>Which gives me the following: </p>\n\n<pre><code>Status 1   |   12\nStatus 2   |   23\nStatus 3   |   63\n</code></pre>\n\n<p>I'm trying to get the table to look like this: </p>\n\n<pre><code>Status 1   Status 2   Status 3  \n   12        23         63\n</code></pre>\n\n<p>Eventually the table will look like this: </p>\n\n<pre><code>                 Status 1   Status 2   Status 3  \nDate Range 1        12        23         63\nDate Range 2        23        2           3       \n</code></pre>\n\n<p>I'm just not sure what to do now.  What kind of SQL commands / syntax should I study to get this done?  This is my first time looking at SQL so any pointers would be awesome.  </p>\n"},{"tags":["sql","sql-server","vbscript","connection-string","adodb"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":13089112,"title":"Unable to use vbscript to connect to sql server on diffrenet domain","body":"<p>I'm using vbscript to try to connect to a sql server on another domain. The server is part of a cluster and is SQL Server Data Center Edition (64bit). I can ping the server from my machine. I'm using the IP address to connect which works fine on SSMS.\nThe vbscript code I'm using is:</p>\n\n<pre><code>Set cn = CreateObject(\"ADODB.Connection\")\ncn.Open \"DRIVER={SQL Server};Server=123.456.345.567\\instance;Database=MyDB;User\nID=domain\\myuserid;Password=mypass;\"\nstrCommandText = \"Select * from mytable\"\ncn.Execute strCommandText\n</code></pre>\n\n<p>When I run this, I get the following error: \nMicrosoft OLE DB Provider for\nODBC Drivers: [Microsoft][ODBC SQL Server Driver][SQL Server]Login failed for user 'domain\\myuserid'.</p>\n\n<p>I can't join my test machine to the domain and I can't use sql authentication as it's disabled on the sql server.</p>\n\n<p>What do I need to do to get this to work?</p>\n"},{"tags":["c#","sql-server","crystal-reports"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13274399,"title":"CrystalDecisions.CrystalReports.Engine.ReportDocument' threw an exception","body":"<p>Once my crystal report sap 2010 was corrupted and re installed my crystal report software but nothing changed after that i followed the instruction on this link </p>\n\n<pre><code>http://social.msdn.microsoft.com/Forums/en-US/vscrystalreports/thread     /c0a40e76-7bd9-4113-85a7-190873318c07/\n</code></pre>\n\n<p>and after installing crystal report software i re installed my software and the things start working again. Now i am facing same error again </p>\n\n<pre><code>CrystalDecisions.CrystalReports.Engine.ReportDocument' threw an exception\n</code></pre>\n\n<p>But the above is not a permenant solution, Please Help.</p>\n"},{"tags":["c#","sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":43,"score":0,"question_id":13273333,"title":"Compare two Tables SQLSE","body":"<p>I want to know if that possible to compare two columns in two different tables in one database using C# with SQLSE.  if the two table has the same data in order, i can say the two tables are match; otherwise, there is no match.</p>\n\n<p>// More info </p>\n\n<p>I want to compare two column has repeated value the two column vlaues come from actual combination of visits for two patients and i want to check do they visit the hospital on the same date and rational insted to go for every 5 combination and compare the match i want to compare the whole table</p>\n"},{"tags":["php","sql-server","stored-procedures","parameters"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":8,"score":1,"question_id":13274261,"title":"php sqlsrv_query stored procedure with naming parameters","body":"<p>Im using php 5.4 with sqlsrv extension and I'm trying to call this sample stored procedure (NorthWind database):</p>\n\n<pre><code>create  PROCEDURE [dbo].[GetCategories] \n@CategoryID int = null\nAS\nSELECT * from dbo.Categories where CategoryID= IsNull(@CategoryID,CategoryID)\n</code></pre>\n\n<p>And I'm using this sqlsrv_query syntax:</p>\n\n<pre><code>$sql = \"{ call dbo.GetCategories (?)}\";\n$catID=2;\n$params = array($catID);\n$stmt = sqlsrv_query( $conn, $sql,$params);\n</code></pre>\n\n<p>I want to specify parameter name and value in $params, just like this:</p>\n\n<pre><code>$sql = \"dbo.GetCategories\";\n$catID=2;\n$params = array(\"@CategoryID\"=&gt;$catID);\n$stmt = sqlsrv_query( $conn, $sql,$params);\n</code></pre>\n\n<p>It return this error: String keys are not allowed in parameters arrays.</p>\n\n<p>How can i solve this problem?\nThanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13273885,"title":"How do I fetch only records created in the past year from a table within SSIS package?","body":"<p>I have a column <strong>CT_DT</strong> in a  table. I have to process only transactions created within the past <code>365 days</code>.</p>\n\n<p>For example, suppose the current date is <strong>Nov 7, 2012</strong>, I have to process only those transaction that were created since <strong>Nov 7, 2011</strong>. I am using conditional filter within the SSIS package.</p>\n"},{"tags":["sql-server","sqlite","auto-increment"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":11,"score":2,"question_id":13273403,"title":"Is there a set identity_insert on equivalent for SQLite?","body":"<p>In TSQL there is </p>\n\n<pre><code>SET IDENTITY_INSERT ON;\n</code></pre>\n\n<p>is there a functional equivalent in SQLite?</p>\n"},{"tags":["sql","sql-server","sql-server-2008-r2","common-table-expression"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":13271764,"title":"Split rows in table using CTE","body":"<p>I have the following rows from a table in SQL Server 2008 R2</p>\n\n<pre><code>+-------------------------------------------+\n|  ID          EntryType dt         price   |\n+-------------------------------------------+\n| 14          4         2012-11-07 0.025000 |\n| 16          5         2012-11-07 0.026000 |\n| 18          6         2012-11-07 0.026000 |\n| 20          7         2012-11-07 0.026000 |\n+-------------------------------------------+\n</code></pre>\n\n<p>What I would like to do is spread the rows based on the EntryType (the EntryType doesn't change)</p>\n\n<pre><code>For EntryType = 4 (1 row)\nFor EntryType = 5 (2 row)\nFor EntryType = 6 (3 row)\nFor EntryType = 7 (9 row)\n</code></pre>\n\n<p>and the dt field will be incremented (in a Month interval), so the output looks like this:</p>\n\n<pre><code>+-----------+-----------+-------+\n| EntryType |    dt     | Price |\n+-----------+-----------+-------+\n|         4 | 11/7/2012 | 0.024 |\n|         5 | 12/7/2012 | 0.025 |\n|         5 | 1/7/2013  | 0.025 |\n|         6 | 2/7/2013  | 0.026 |\n|         6 | 3/7/2013  | 0.026 |\n|         6 | 4/7/2013  | 0.026 |\n|         7 | 5/7/2013  | 0.027 |\n|         7 | 6/7/2013  | 0.027 |\n|         7 | 7/7/2013  | 0.027 |\n|         7 | 8/7/2013  | 0.027 |\n|         7 | 9/7/2013  | 0.027 |\n|         7 | 10/7/2013 | 0.027 |\n|         7 | 11/7/2013 | 0.027 |\n|         7 | 12/7/2013 | 0.027 |\n|         7 | 1/7/2014  | 0.027 |\n+-----------+-----------+-------+\n</code></pre>\n\n<p>Is it possible to do that with CTE and SQL?</p>\n"},{"tags":["sql-server","sql-server-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13273317,"title":"How do I generate insert statements with Sql server 2012?","body":"<p>I have sql server 2012 express and just installed the latest version of ssms tools from <a href=\"http://www.ssmstoolspack.com/Download\" rel=\"nofollow\">http://www.ssmstoolspack.com/Download</a></p>\n\n<p>With sql server 2008 express and ssms tools I was able to right click on a table and see an ssms tools option that allowed me to generate insert statements for a table but now I don't see it? Anyone know how I can generate the insert statements for a table?</p>\n"},{"tags":["sql-server","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2807,"score":1,"question_id":1180568,"title":"How to resolve the error loading SSIS packages using 32-bit dtexec on a x64 machine?","body":"<p>I have Integration Services packages that need to work with Excel files (shudder) and also need to execute on x64. I have a handle on the whole SSIS x64 vs. 32-bit issue, so I am scheduling these problem-child packages using MS suggested technique of using SQL Agent job step type <code>Operating System</code> / <code>CMDExec</code>, with a command line string that explicitly calls the 32-bit dtexec. So far so good.</p>\n\n<p>Here's the issue: the packages still fail to load, and complain about failing to load not the Excel bits, but instead my handy Log Provider that logs to SQL Server. This is the error message, edited for object names:</p>\n\n<blockquote>\n  <p>Started:  2:33:01 PM<br>\n  Error: 2009-07-24 14:33:06.51<br>\n  Code: 0xC0010018<br>\n  Source:<br>\n  Description: </p>\n  \n  <p>Error loading value \"&lt;DTS:ConnectionManager xmlns:DTS=\"www.microsoft.com/SqlServer/Dts\"&gt;&lt;DTS:Property DTS:Name=\"DelayValidation\"&gt;0&lt;/DTS:Property&gt;&lt;DTS:Property DTS:Name=\"ObjectName\"&gt;My_LogCon&lt;/DTS:Property&gt;&lt;DTS:Property DTS:Name=\"DTSID\"&gt;{86320FE6-AEFD-4A58-9277-84685B9B9\" from node \"DTS:ConnectionManager\".<br>\n  End Error  Could not load package \"c:\\folder\\mypkg.dtsx\" because of error 0xC0010014.<br>\n  Description: The package failed to load due to error 0xC0010014 \"One or more error occurred. There should be more specific errors preceding this one that explains the details of the errors. This message is used as a return value from functions that encounter errors.\". This occurs when CPackage::LoadFromXML fails.  ...  Process Exit Code 5.  The step failed.</p>\n</blockquote>\n\n<p>The packages run perfectly in 32-bit Visual Studio/debug. Anyone seen this type of thing?</p>\n"},{"tags":["c#",".net","sql-server","stream"],"answer_count":4,"favorite_count":38,"up_vote_count":123,"down_vote_count":0,"view_count":106685,"score":123,"question_id":411592,"title":"How do I save a stream to a file?","body":"<p>I have a <code>StreamReader</code> object that I initialized with a stream, now I want to save this stream to disk (the stream may be a <code>.gif</code> or <code>.jpg</code> or <code>.pdf</code>).</p>\n\n<p>Existing Code:</p>\n\n<pre><code>StreamReader sr = new StreamReader(myOtherObject.InputStream);\n</code></pre>\n\n<ol>\n<li>I need to save this to disk (I have the filename).</li>\n<li>In the future I may want to store this to SQL Server.</li>\n</ol>\n\n<p>I have the encoding type also, which I will need if I store it to SQL Server, correct?</p>\n"},{"tags":["mysql","sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13273045,"title":"Converting mySQL select to SQL select","body":"<p>I have this mySQL select statement that works just as I need it to;</p>\n\n<pre><code>SELECT `requires`, `level` FROM `fp` WHERE `model` = '\".$model.\"' GROUP BY `level` ORDER BY `menu_order`\n</code></pre>\n\n<p>In the table both <em>requires</em> and <em>level</em> are char fields. When sorted by *menu_order* the first row of each value of <em>level</em> will always be the value of <em>requires</em> that I want to retrieve.</p>\n\n<p>For the SQL version I use;</p>\n\n<pre><code>SELECT requires, level FROM fp WHERE model = '\" &amp; model &amp; \"' GROUP BY level ORDER BY menu_order\n</code></pre>\n\n<p>Now when I try to run this same query on SQL I get;</p>\n\n<p>requires'_is_invalid_in_the_select_list_because_it_is_not_contained_in_either_an_aggregate_function_or_the_GROUP_BY_clause</p>\n\n<p>I found many examples of this error but all seem to be way more complicated than what I'm trying to do. Maybe I've been using mySQL for so long that my brain is stuck in that way of thinking.</p>\n\n<p>How should that select statement be written in SQL?</p>\n"},{"tags":["c#","sql-server","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2107,"score":1,"question_id":6824188,"title":"SqlDataSourceEnumerator.Instance.GetDataSources() does not locate local SQL server 2008 instance","body":"<p>I use the following code to list all the remote and local SQL Server instances:</p>\n\n<pre><code>public static void LocateSqlInstances()\n  {\n     using( DataTable sqlSources = SqlDataSourceEnumerator.Instance.GetDataSources())\n     {\n        foreach(DataRow source in sqlSources.Rows )\n        {\n           string instanceName = source[\"InstanceName\"].ToString();\n\n           if (!string.IsNullOrEmpty(instanceName))\n           {\n              Console.WriteLine(\" Server Name:{0}\", source[\"ServerName\"]);\n              Console.WriteLine(\"   Instance Name:{0}\", source[\"InstanceName\"]);\n              Console.WriteLine(\"   Version:{0}\", source[\"Version\"]);\n              Console.WriteLine();\n           }\n        }\n        Console.ReadKey();\n     }\n  }\n</code></pre>\n\n<p>running the code on my local machine. The code can find and list a SQL server express instance (version 9.0.5000) installed but failed to list the other SQL server instance (version 10.0.1600).</p>\n\n<p>I've done a lot of research on the Internet and made sure that 1-the Sql Broswer is runing and 2 - the UDP port 1434 is open.</p>\n\n<p>Anybody knows why? Thanks.</p>\n"},{"tags":["sql-server","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13257186,"title":"Error Creating Stored Procedure in SQLServer","body":"<p>This is my stored procedure I am trying to create:</p>\n\n<pre><code>CREATE PROCEDURE [cih_owner].[UpdateDisplayOrder]\n    @CbpTableName varchar (21), \n    @CbpObjId int,\n    @CbpId int,\n    @DisplayOrder int\nAS\nBEGIN\n    IF (@CbpTableName = \"CbpActivity\")\n    BEGIN\n        UPDATE [cih_owner].[CbpActivity] SET DisplayOrder = @DisplayOrder WHERE Id = @CbpObjId AND CbpId = @CbpId\n        ;\n    END\nEND\nGO\n</code></pre>\n\n<p>However, in line that reads:\n<code>(@CbpTableName = \"CbpActivity\")</code>\nI get squigglies under \n<code>\"CbpActivity\"</code>\nwith the error\n<code>Invalid column name 'CbpActivity'</code></p>\n\n<p>All I am trying to do is compare a string that I sent to the stored procedure. </p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server","ado.net","visual-foxpro","vfp"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":11312142,"title":"using ADO.NET to select from multiple VFP tables","body":"<p>I need to select from 2 VFP free tables on some different network locations.</p>\n\n<p>I've managed to get both tables into a dataset as two DataTables and add a Relation for them.</p>\n\n<p>Now I need to join them and the result to insert into a SQL server database.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13210454,"title":"sql cte if statement","body":"<p>This might be a bad idea but just wondering?</p>\n\n<pre><code>;with Products\nAS\n(\n/* can you have an if statement in here? */\nselect * from products\n\n/* or */\n\nselect * from products \nwhere condition\n\n)\n</code></pre>\n\n<p>what i'm thinking is what if sometimes you have a search string or not. How do you make that a consideration in cte?</p>\n\n<p>Or maybe it would be a better idea to have 2 cte in one procedure?</p>\n"},{"tags":[".net","sql-server","linq-to-sql","stored-procedures","executequery"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":360,"score":4,"question_id":3284747,"title":"Is it possible to return multiple result sets using ExecuteQuery in Linq to Sql?","body":"<p>I know that you can return multiple results from a stored procedure and through the method generated by the designer.</p>\n\n<p>However, I'm trying to do the same using ExecuteQuery but it doesn't seem like it's possible.\nHas anyone tried or know whether this is possible?</p>\n\n<p>Basically I'm trying to run an ad-hoc stored procedure.  By ad-hoc, I mean a stored procedure that wasn't available during design-time.</p>\n"},{"tags":["sql-server","sql-server-2008","reporting-services","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13270332,"title":"Report Builder/SSRS and RDLs - HTML <img> support?","body":"<p>I'm completely new to SSRS so apologies if this is a silly question. I have an RDL with a HTML placeholder however if I pass an <code>&lt;img&gt;</code> tag in the dataset this does not render.</p>\n\n<p>I see on <a href=\"http://technet.microsoft.com/en-us/library/ff519562.aspx\" rel=\"nofollow\">this Technet</a> article that there is a list of supported tags, which unfortunately doesn't include <code>&lt;img&gt;</code>. I've been able to add an image with an external source based on an expression which uses a dataset field so it seems a little strange that you can't use images in HTML placeholders. Is there a workaround for this at all?</p>\n"},{"tags":["asp.net","sql-server","nopcommerce"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13251067,"title":"'SysUtcDateTime' error during nopCommerce install - ASP.NET","body":"<p>Having bought a copy of the shop made in nopCommerce (files and database) we are trying to implement it on our server. After copy, such mistake appears:</p>\n\n<blockquote>\n  <p><strong>SysUtcDateTime' is not a recognized built-in function name.</strong></p>\n  \n  <p>Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </p>\n  \n  <p>Exception Details: System.Data.SqlClient.SqlException: 'SysUtcDateTime' is not a recognized built-in function name.</p>\n  \n  <p><strong>Source Error:</strong> </p>\n  \n  <p>An unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.</p>\n</blockquote>\n\n<p>I found out <a href=\"http://www.nopcommerce.com/boards/t/6441/sql2005-sysutcdatetime-is-not-a-recognized-built-in-function-name.aspx#82244\" rel=\"nofollow\">here</a> that it might be connected with the wrong version of SQL server in Nop.BusinessLogic. So, after simple edit in Notepad++ I changed '2008' to '2005', but no effects : (</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13271685,"title":"SQL Login notification","body":"<p>I want to be notified of SQL Server logins that has a particular value for the <code>Application Name</code> property of the connection string. Can someone help me to get these type of notifications by email or by any other recommended method?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13255746,"title":"Can Execute Procedure But Job That Runs Procedure Errors?","body":"<p>I have a procedure that pulls data from my database and uses MSDB.DBO.sp_send_dbmail to send out e-mails.  The procedure itself runs without a hitch when I use 'EXEC myprocedure'.  But when I set up a job for the procedure, the job fails with the following error </p>\n\n<blockquote>\n  <p>'Error formating query, probably invalid parameters [SQLState\n  42000](Error 22050).  The step failed'</p>\n</blockquote>\n\n<p>There is one step in the job with the TSQL statement 'EXEC myprocedure', using the database that my procedure is stored on.  Does anyone know what could be causing this error?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I've narrowed the problem down. It's something with the Exchange server I use. I was using a domain address (ie. mail.mycompany.com) as the 'Server name' under Database Mail's account configuration wizard. I was unable to send e-mails to listservs and external users using this domain address. I talked to our Exchange guy and he recommended using the actual IP address of one of the mail servers (ie. 10.123.53.53). That fixed the problem with listservs and external users, but now I am unable to send e-mails when I run my procedure using a job (the procedure itself executes properly when I manually run it). Does anyone know what criteria on our Exchange server I will need to change to fix this? </p>\n"},{"tags":["sql-server","sql-agent-job"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":17,"score":-2,"question_id":13272088,"title":"How to stop a SQL Server 2005 job at a set time or elapsed time","body":"<p>I thought I'd share this since I had to come up with the answers mostly myself.  I hope this saves someone some time!</p>\n\n<p>There's no automatic mechanism to stop a SQL Server Agent job after a set period of time.  If you're executing a stored procedure, particularly one that uses looping, you can use this approach to build it in.</p>\n\n<p>Here's my proof-of-concept code you can use to reassure yourself and tinker with:</p>\n\n<pre><code>    DECLARE @beginTime datetime\n    DECLARE @endTime datetime\n\n    SET @beginTime = GETDATE()\n    SELECT @beginTime\n\n    SET @endTime = DATEADD(s, 10, @beginTime)\n    SELECT @endTime\n\n    WAITFOR DELAY '00:00:05'\n\n    IF GETDATE() &gt; @endTime\n    Begin\n        PRINT 'EXITING Block 1'\n        RETURN\n    End\n    ELSE\n    Begin\n        PRINT 'Continuing Block 1'\n    End\n\n    WAITFOR DELAY '00:00:06'\n\n    IF GETDATE() &gt; @endTime\n    Begin\n        PRINT 'EXITING Block 2'\n        RETURN\n    End\n    ELSE\n    Begin\n\n\nPRINT 'Continuing Block 2'\nEnd\n</code></pre>\n\n<p>Your results will come out as this, showing that after 5 seconds the comparison of @endTime to the current time (GETDATE), the full 10 seconds set with the DATEADD function have not yet elapsed yet (Block 1 continues) but after another 6 seconds the elapsed time has passed and the script exits with the return statement (Block 2 exits).</p>\n\n<pre><code>(1 row(s) affected)\n\n(1 row(s) affected)\nContinuing Block 1\nEXITING Block 2\n</code></pre>\n\n<p>And I adapted this to my real-world usage inside a WHILE block that purges rows from a table:</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[usp_PurgeX12BillingData] \nAS\nBEGIN\n    DECLARE @pDate datetime\n    DECLARE @minID int\n    DECLARE @maxID int\n\n    DECLARE @beginTime datetime\n    DECLARE @endTime datetime\n\n    SET @beginTime = GETDATE()\n    SET @endTime = DATEADD(hh, 5, @beginTime)\n\n    PRINT 'Set to run from ' + CONVERT(varchar(10), @beginTime, 108) + ' to ' + CONVERT(varchar(10), @endTime, 108)\n\n    SET @pDate = CONVERT(varchar(10), dateadd(mm, -72, getdate()), 101) \n\n    PRINT 'Purging data older than: ' + CONVERT(varchar(10), @pDate, 101)\n\n    SELECT @maxID = count(*) FROM bil_x12 WITH (NOLOCK)\n    WHERE transmission_date &lt; @pDate\n\n    PRINT 'Number of rows: ' + cast(@maxID AS nvarchar(32))\n\n    SELECT IDENTITY(INT,1,1) AS row_id, transmission_id --, transmission_date \n        INTO #oldX12billingRows \n    FROM BIL_X12\n    WHERE transmission_date &lt; @pDate\n\n    SET @minID = 0\n\n    PRINT 'Deleting from BIL_X12: Min PK = ' + cast(@minID AS nvarchar(32)) + ', Max PK = ' + cast(@maxID as nvarchar(32)) + \n            ', Total Rows = ' + cast((@maxID - @minID) AS nvarchar(32))\n\n    WHILE @minID &lt; @maxID\n    Begin\n        IF GETDATE() &gt; @endTime\n        Begin           \n            RETURN\n        End\n\n      SET @minID = @minID + 2000\n      IF @minID &gt; @maxID\n      Begin\n        SET @minID = @maxID\n      End\n      PRINT 'deleting pks less than ' + cast(@minID AS nvarchar(32))\n      Begin Transaction temptran1234\n        DELETE FROM BIL_X12 WHERE transmission_id IN (SELECT transmission_id FROM #oldX12billingRows WHERE row_id &lt;= @minID)\n      Commit Transaction temptran1234\n      WAITFOR DELAY '00:00:05'\n    End\n\n    DROP TABLE #oldX12billingRows\nEND\n</code></pre>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":77,"score":2,"question_id":13271400,"title":"Allowing * in SQL query","body":"<p>I have a stored procedure and I want to allow * in it so that if user:</p>\n\n<ul>\n<li>types t* then taller, tea returns</li>\n<li>types * or <em>.</em> then all results are returned</li>\n<li>types t then all results which have t are returned like ptv, tall, sit</li>\n</ul>\n\n<p>my stored procedure is this:</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[SearchEntityDataNew]\n    @SearchText varchar(100) = '*'\n\nAS\nBEGIN\n    SELECT 'Entity' as pagetype,EntityID,EntityData,EntityDataID \n    FROM EntityData \n    WHERE  EntityData LIKE '%' + @SearchText+ '%'\n    OR @SearchText = '*'\n\n    union all\n\n    SELECT 'Property' as pagetype,PropertyID,PropertyValue,EntityDataID  \n    FROM EntityDataProperty \n    WHERE  PropertyValue LIKE '%' + @SearchText+ '%'\n    OR @SearchText = '*'\nEND\n</code></pre>\n"},{"tags":["sql","sql-server","group-by"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13260441,"title":"SQL query group by nearby timestamp","body":"<p>I have a table with a timestamp column. I would like to be able to group by an identifier column (e.g. cusip), sum over another column (e.g. quantity), but only for rows that are within 30 seconds of each other, i.e. <strong>not</strong> in fixed 30 second bucket intervals. Given the data:</p>\n\n<pre>\n       cusip| quantity|    timestamp\n============|=========|=============\nBE0000310194|      100| 16:20:49.000\nBE0000314238|       50| 16:38:38.110\nBE0000314238|       50| 16:46:21.323\nBE0000314238|       50| 16:46:35.323\n</pre>\n\n<p>I would like to write a query that returns:</p>\n\n<pre>\n       cusip| quantity\n============|=========\nBE0000310194|      100\nBE0000314238|       50\nBE0000314238|      100\n</pre>\n\n<p>Edit:\nIn addition, it would greatly simplify things if I could also get the MIN(timestamp) out of the query.</p>\n"},{"tags":["sql-server","database","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":19,"score":-1,"question_id":13262025,"title":"Creating a trigger in SQL Server Management Studio 2012","body":"<p>Given the following question based on the database below.\na)  Create a trigger that will automatically update the quantity on hand each time that a product is sold as listed as a row in the LINE table. In other words, a line row is inserted as part of an invoice. Each line is linked to a product. Decrement the quantity on hand (P_QOH) by the number ordered.</p>\n\n<p><a href=\"http://i.stack.imgur.com/wWX17.png\" rel=\"nofollow\">http://i.stack.imgur.com/wWX17.png</a></p>\n"},{"tags":["sql-server","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13270467,"title":"How to connect to SQL Server 2000 database from Visual Studio 2012","body":"<p>I have a SQL Server 2000 database that I need to access from Visual Studio 2012. Needless to say the data provider for SQL Server requires SQL Server 2005 or above, and the data provider for OLE, which claims to support SQL Server 2000 or above, says \"SQL Server Native Client 11.0 does not support connections to SQL Server 2000 or earlier versions.\"</p>\n\n<p>Is there some kind of plug-in I can install that will let me access SQL Server 2000?</p>\n\n<p>Eventually my app will live ON the server itself. Is it going to need something special to access this older database?</p>\n"},{"tags":["php","sql-server","iis","windows-server-2003","php-extension"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":12,"score":2,"question_id":13271075,"title":"sqlsrv hangs in windows with php 5.4","body":"<p>I know this was asked alot of times but all the answers are outdated.</p>\n\n<p>As of PHP 5.3, as we all know mssql is <strong>not</strong> supported, so went on installing Microsoft's <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=20098\" rel=\"nofollow\">sqlsrv</a>\ndriver for this, as it seems to be the only option out there (I'm open to suggestions!).</p>\n\n<p>Now I'm using PHP 5.4 on a Windows server 2003, SQL Server 2005 with IIS as webserver.</p>\n\n<p>I've followed about a million guides and i've installed everything accordingly, but the driver just wont load, <code>sqlsrv</code> won't show on <code>phpinfo()</code> or it hangs.</p>\n\n<p>This is what i've done in php.ini :</p>\n\n<pre><code> extension=php_sqlsrv_54_nts.dll\n</code></pre>\n\n<p>And the <code>extension_dir</code> is set to <code>C:\\PHP\\ext</code>, though phpinfo() shows its loading a php.ini file from progrem files, so i'm editing 2 php.ini files every time as i'm not sure which one is active.\nFor the same reason i've put the dll files in both locations.</p>\n\n<p>There is no information for this problem!\nall the solutions are for people who have used the wrong versions, etc.</p>\n\n<p>I've tried applying every single dll and all with the same result, including Threaded and non-threaded.</p>\n\n<p>What can i do?</p>\n"},{"tags":["sql-server","intellisense","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13270186,"title":"SQL Server 2008 R2 intellisense doesn't work","body":"<p>The SQL Server 2008 R2 Management Studio intellisense stopped working a month ago though it is enabled. I read that this issue may be caused by the .NET framework 4.0 SP1 and tried some of the suggestions but nothing worked:</p>\n\n<ul>\n<li>I have installed the cumulative update package: <code>SQLServer2008R2_RTM_CU7_2507770_10_50_1777_x64</code></li>\n<li>I re-registered the <code>TextMgrP.dll</code></li>\n</ul>\n\n<p>Any other suggestions what can be done?</p>\n\n<p>The SSMS version is: Microsoft SQL Server Management Studio 10.50.1617.0</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13270462,"title":"Case when in variable declaration","body":"<p><img src=\"http://i.stack.imgur.com/jvpqC.jpg\" alt=\"enter image description here\"></p>\n\n<p>I'm looking for another column that will give the overall total counts from each gender next to the <code>eduCounts</code> column.  The rest of the query works fine.  Finding the distinct gender counts in this case has to be done by <code>select count(distinct patid) from...</code></p>\n\n<p>first try:</p>\n\n<pre><code>declare @sexcounts int\nset @sexcounts = case when members.sex 'm' then (select COUNT(distinct patid) from members where sex='m')\n                 when members.sex 'f' then (select COUNT(distinct patid) from members where sex='f')\n\nselect sex, edutext, COUNT(*) as eduCounts from \n(\nselect distinct m.patid, m.sex, e.eduText\n    from members as m\n    inner join claims as c on c.patid=m.PATID\n    inner join icdClm as ic on ic.clmid=c.clmid\n    inner join tblICD as t on t.ICD=ic.icd\n    inner join EducationTable as e on e.eduID=m.education\n    inner join IncomeTable as i on i.incomeID=m.income\n    where ISNUMERIC(ic.icd)=1 and SUBSTRING(ic.icd,1,3)='707'\n)t\ngroup by sex, eduText\norder by sex\n</code></pre>\n\n<p>second try:</p>\n\n<pre><code>declare @sexcounts int\nset @sexcounts = (select COUNT(distinct patid),case when sex 'm' then (select COUNT(distinct PATID) from members where sex='m') else (select COUNT(distinct patid) from members where sex='f') \n                    from members)\n\n    select sex, edutext, COUNT(*) as eduCounts from \n    (\n    select distinct m.patid, m.sex, e.eduText\n        from members as m\n        inner join claims as c on c.patid=m.PATID\n        inner join icdClm as ic on ic.clmid=c.clmid\n        inner join tblICD as t on t.ICD=ic.icd\n        inner join EducationTable as e on e.eduID=m.education\n        inner join IncomeTable as i on i.incomeID=m.income\n        where ISNUMERIC(ic.icd)=1 and SUBSTRING(ic.icd,1,3)='707'\n    )t\n    group by sex, eduText\n    order by sex\n</code></pre>\n\n<p>I know I could make a derived table and join on the sex column, but I'd like to know how to do it with a variable if at all possible.</p>\n"},{"tags":["sql-server","sql-server-2005","security"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1316,"score":2,"question_id":5166641,"title":"SQL Server Foreign Keys across database boundaries - techniques for enforcement","body":"<p>I have two separate SQL Server 2005 databases (on the same server) </p>\n\n<ul>\n<li>security database  </li>\n<li><p>main application database</p></li>\n<li><p>The security database has a  <strong>user table</strong> with everything needed to authenticate.  - </p></li>\n<li>The application database has a <strong>person table</strong> with extended user details. There is a 1-1 mapping between the security database user table and the application database person table.</li>\n</ul>\n\n<p>I want to enforce a mapping between the user and the person table. I'm assuming that foreign keys can't be mapped across databases thus I am wondering what to do to enforce the integrity of the relationship.</p>\n"},{"tags":["sql-server","sql-azure"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13267947,"title":"Non Clustered index being ignored","body":"<p>I have <code>archived_events</code> table with the following indexes.</p>\n\n<pre><code>    CREATE NONCLUSTERED INDEX [IX_archived_events_5] ON [dbo].[archived_events]\n    (\n        [account_id] ASC\n    )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)\n    GO\n\nALTER TABLE [dbo].[archived_events] ADD  CONSTRAINT [PK_archived_events] PRIMARY KEY CLUSTERED \n(\n    [event_type] DESC,\n    [id] DESC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)\nGO\n</code></pre>\n\n<p>The problem is that when I execute the following query, I see in the execution plan that it does Clusterd Index Scan on [PK_archived_events]</p>\n\n<pre><code>SELECT *                                  \nFROM   archived_events ae WITH(nolock) \nWHERE     ( 30 = ae.[account_id] ) \n</code></pre>\n\n<p>What is the reason that the non clustered index is being ignored?</p>\n\n<p><em>Also a note that this is SQL Azure, not sure if it matters.</em></p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13267862,"title":"Where I can check user-define table type in SQL Server 2008 in SSMS? and how can I insert new column into it?","body":"<p>I need to add some more columns into my current <code>user-define table type in SQL Server 2008</code></p>\n\n<p>But I didn't see any table type in particular database under <code>Tables</code> .</p>\n\n<p>Where exactly I need to check and how can I modify the design of existing <code>user-define table type in SQL Server 2008</code></p>\n\n<p>I'm using <code>SQL SERVER 2008</code> and <code>SSMS</code></p>\n\n<p>Where I can find that table in <code>SSMS</code> , </p>\n\n<p>so that I can go and modify table type.</p>\n\n<p>thanks</p>\n\n<p>for previous question answer </p>\n\n<p>Please can any one help to sql <code>alter type table</code> syntax <code>add column</code> ?\nhow can I insert any new column ... as ALTER is not working.. it is disable </p>\n"},{"tags":["sql","sql-server","query","datepart"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13270325,"title":"Using DATEPART for AM works correctly but does not work for PM query","body":"<p>I'm using a query to pull a report for our 3rd shift folks.  </p>\n\n<p>The issue I just noticed when the report was mailed with 0 results is that I have it set right now to run from 6pm to 5:59am the next morning.  Since I have the date field = the <code>GETDATE</code>, it doesn't see the results from the night prior(1800-2359).  I was thinking of having this just pull from like -12 hours, but the button can be pressed at anytime to look at results.  </p>\n\n<p>So if they pushed it before the end of the shift, it would show some of 1st shifts entries.  I want it to only run from 1800-0559 the next morning, no matter if the button is pressed before midnight or after midnight.  I hope this makes sense.  I'm not even sure if the between recognizes to go to 00 after it's hit 2359.  I have this built into a VB.net application, and they can press the button anytime they want to get results.  This is for management to track what is being done as the employees are required to enter data real time when issues are taking place.  </p>\n\n<p>Thanks for any help.  Hope I made enough sense!  :D</p>\n\n<pre><code>SELECT \n   Assignment, Datemodified, General, \n   IncNumber, NextSteps, PDCRStatus, \n   RootCause, Status, Summary, \n   Timings, UserID \nFROM \n   Turnover \nWHERE DATEPART(HOUR, datemodified) between 18 and 05 \nAND CONVERT(NVARCHAR(50),datemodified,103) = CONVERT(NVARCHAR(50),GETDATE(),103);\n</code></pre>\n"},{"tags":["asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":32,"score":-1,"question_id":13266959,"title":"Login to authenticated users","body":"<p>I have a 2 textbox for username and password and a button. I want to allow authenticated users to login and redirect to another page and display welcome authenticated username.Or else display the message Invalid username.How to perform this using session and connect to database.How to configure with database. Please help me.</p>\n\n<pre><code>My code is\n</code></pre>\n\n<p></p>\n\n<pre><code>        &lt;div id=\"loginbox\"&gt;\n            &lt;div align=\"center\" style=\"width: 100%;\"&gt;\n\n\n            &lt;/div&gt;--%&gt;\n            &lt;br /&gt;\n\n                        &lt;label for=\"username\"&gt;Username:&lt;/label&gt; &lt;input type=\"text\"   \nid=\"username\" /&gt;&lt;/li&gt;\n   &lt;label for=\"password\"&gt;Password:&lt;/label&gt; &lt;input type=\"password\" id=\"password\" /&gt;\n\n&lt;input type=\"button\" runat=\"server\" value=\"Login\"&gt;\n\n\n&lt;/form&gt;\n\nMy .cs code\n\nprotected void btnLogin_onclick(object sender, EventArgs e)\n{\n    string connect = \"Data Source=ST0022;Initial Catalog=QuickMove_Globe;Persist   \nSecurity Info=True;User ID=sa;Password=good\";\n    string query = \"Select Count(*) From Common.Users Where UserID = ? And Password =   \n?\";\n    int result = 0;\n    SqlConnection con= new SqlConnection(connect);\n        SqlCommand cmd = new SqlCommand(query, con);\n\n            cmd.Parameters.AddWithValue(\"UserID\",username.Value);\n            cmd.Parameters.AddWithValue(\"Password\", password.Value);\n            con.Open();\n            Session[\"User\"] = username.Value;\n            result = (int)cmd.ExecuteScalar();\n\n    if (result &gt; 0)\n    {\n        Response.Redirect(\"TestPortalPage.aspx\");\n    }\n    else\n    {\n        lbluser.Text = \"Invalid credentials\";\n    }\n\n\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":32,"score":0,"question_id":13269545,"title":"SQL View creation error","body":"<p>I am trying to copy a view from one database to another and get the error :</p>\n\n<blockquote>\n  <p>Msg 4121, Level 16, State 1, Procedure vwPAProjects_Summary_New_2 \n  Line 2<br>\n  <em>Cannot find either column \"dbo\" or the user-defined function or\n  aggregate \"dbo.GetContractName\", or the name is ambiguous</em></p>\n</blockquote>\n\n<p>The view I am copying over is:</p>\n\n<pre><code>USE [GRAUD]\nGO\n/****** Object:  View [dbo].[vwPAProjects_Summary_New_2]    Script Date: 11/07/2012 11:57:30 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE VIEW [dbo].[vwPAProjects_Summary_New_2] AS \nselect\n dbo.GetContractName(PAPROJNUMBER) 'CONTRACT',\nPACONTNUMBER,\nisnull(dbo.GetEmployeeName(PABusMgrID),dbo.GetContractPartner(PACONTNUMBER)) 'Project Manager ID',\ncase PASTAT\nwhen 1 then 'Open'\nelse 'Closed'\nend 'Status',\ncase PAProjectType\nwhen 3 then 'Fixed Price'\nelse 'Time and Materials'\nend 'Project Type',\nPAProject_Fee_Amount 'Project Fee Amount',\nPAFTotalCost 'Forecast Total Cost',\n(PAProject_Fee_Amount - PAFTotalCost) 'Forcast Profit',\ncase\n    when PAProject_Fee_Amount = 0 then '0.00%'\n    else cast(cast(((PAProject_Fee_Amount - PAFTotalCost)/PAProject_Fee_Amount)*100 as decimal(19,2)) as varchar(21)) + '%'\nend 'Forcast %',\nPAPostedBillingsN 'Actual Billings',\nPAPostedTotalCostN 'Actual Total Cost',\n(PAPostedBillingsN - PAPostedTotalCostN) 'Current Actual Profit',\ncase\n    when PAPostedBillingsN = 0 then '0.00%'\n    else cast(cast(((PAPostedBillingsN - PAPostedTotalCostN)/PAPostedBillingsN)*100 as decimal(19,2)) as varchar(21)) + '%'\nend 'Current %'\n\nfrom PA01201\nwhere PASTAT = 1\n</code></pre>\n\n<p>Can anybody advise on how I can get this to copy over?  It has worked on other databases after I have copied it over but I cannot see any differences that would stop it this time?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13269787,"title":"SQL Server backup failing. Error: 3041, Severity: 16, State: 1","body":"<p>First of all, I'm very new at stackoverflow, so please bear with me.</p>\n\n<p>I'm running a SQL Server 9.0.4060.</p>\n\n<p>My problem is: my SQL Server backup keeps failing on a lot of the databases.</p>\n\n<p>The Maintenance plan runs to different backup jobs:</p>\n\n<p>DIFF backup everyday at 20:30 and FULL backup every Sunday at 20:30.</p>\n\n<p>I get these two errors foreach database that fails to complete the backup:</p>\n\n<pre><code>Date        06-11-2012 20:31:06\nLog     SQL Server (Current - 07-11-2012 11:43:00)\nSource      Backup\nMessage\nBACKUP failed to complete the command BACKUP DATABASE (dbname) WITH DIFFERENTIAL. Check the backup application log for detailed messages.\n\nDate        06-11-2012 20:31:06\nLog     SQL Server (Current - 07-11-2012 11:43:00)\nSource      Backup\nMessage\nError: 3041, Severity: 16, State: 1.\n</code></pre>\n\n<p>If you guys need any other information, just say the word.</p>\n"},{"tags":["sql-server","delete","foreign-keys","constraints"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13269900,"title":"ON DELETE NO ACTION constraint in SQL Server database","body":"<p>What I want to do is when I delete a row from the parent table to keep the data in the child table. </p>\n\n<p>Meaning that if I have a table department, which is the parent table with two columns - <code>depNo</code> and <code>depName</code>, and a child table with three columns - <code>emNo</code>, <code>emName</code> and <code>depNo (FK)</code>.</p>\n\n<p>I want to be able to delete the row in the parent table, but to keep the one in the child table (in my case it is connected with licenses and is a good idea to keep track of it, even if the user  is already deleted).</p>\n\n<p>I guess <code>ON DELETE NO ACTION</code> won't work, because it will give me an error if I try to delete the row in the parent table. </p>\n\n<p><code>CASCADE</code> and <code>SET NULL</code> are not good in this case. </p>\n\n<p><code>SET Default</code> - it won't work because I can't make a default value - it could be different (and its 100% sure it will be).</p>\n\n<p>Any ideas how to make it ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13269586,"title":"SQL adding additional columns to a query","body":"<p>I'm trying to create a query that allows me to see all of the customers orders and to add an additional column using sql to view the total amount that the customer owes.</p>\n\n<p>the following code retrieves the correct data:</p>\n\n<pre><code>SELECT\n    cu.FName + '  ' + cu.SName as 'Name', \n    cu.Address1 + ', ' + cu.Address2 + ', ' + cu.Address3 as 'Dispatch Address', \n    cu.PostCode, \n    co.DateOrdered, co.DateDispatched, \n    ma.MaterialName, \n    it.Quantity, \n    ma.Price as 'Total' \nFROM\n    Customers cu \nLEFT JOIN \n    CustomerOrder co ON co.CustomerID = cu.CustomerID \nLEFT JOIN\n    ItemOrder it ON it.OrderID = co.OrderID \nLEFT JOIN \n    Materials ma ON ma.MaterialID = it.MaterialID \n</code></pre>\n\n<p>I now need to add additional code to the above to add a column to show the total amount the customer owes, but I'm stuck, can anybody help?</p>\n\n<pre><code>Date Order   |    Dispatch Date | Item  | QTY  |   Price | TOTAL AMOUNT FOR BOTH ROWS\n2012-10-30   |    2012-11-25    | Bath  | 1    |   49.99 |  \n2012-10-30   |    2012-11-25    | Sink  | 1    |   55.99 |\n</code></pre>\n"},{"tags":["sql-server","hadoop"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13251994,"title":"Access SQL Server in Hadoop","body":"<p>What I want to do:\n  The program is designed to load regional sales data from SQL Server 2008 and run simple statistics computation on MapReduce to get total sales in each regions. The erro I got says the program can't find the sqljdbc4.jar file, however,  the file did had copied into the location specified in code.</p>\n\n<ol>\n<li><p>So the code likes: </p>\n\n<pre><code>//fileName: MRExp.java\npublic class MRExp {\n    public static void main(String[] args) throws IOException {\n        JobConf conf = new JobConf(MRExp.class);\n        DistributedCache.addFileToClassPath(new Path(\"/userX/sqljdbc4.jar\"), conf);\n\n        conf.setMapperClass(MRMapper.class);\n        conf.setReducerClass(MRReducer.class);\n\n        conf.setMapOutputKeyClass(Text.class);\n        conf.setMapOutputValueClass(LongWritable.class);\n\n        conf.setOutputKeyClass(LongWritable.class);\n        conf.setOutputValueClass(Text.class);\n\n        conf.setInputFormat(DBInputFormat.class);\n        FileOutputFormat.setOutputPath(conf, new Path(args[0]));\n\n        DBConfiguration\n                .configureDB(\n                        conf,\n                        \"com.microsoft.sqlserver.jdbc.SQLServerDriver\",\n                        \"jdbc:sqlserver://MyDbServerAddr:1433;databaseName=ThisDb;integratedSecurity=true;\",\n                        \"db_userName\", \"db_Pws\");\n\n        DBInputFormat\n                .setInput(conf, InfoUnit.class,\n                        \"SELECT R_NAME,L_ORDERKEY from dbo.United10MB ;\"/* inputQuery */\n                        , \"SELECT COUNT(L_ORDERKEY) from dbo.United10MB\"/* inputCountQuery */);\n\n        try {\n            JobClient.runJob(conf);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>\n\n<p>//followed by the definition of MRMapper and MRReducer and InfoUnit. InfoUnit implements Writable, DBWritable. </p></li>\n<li><p>Files Location:</p>\n\n<p>[root@test MRExp]# pwd<br>\n/root/MRExp<br>\n[root@test MRExp]# ls<br>\nclasses  hadoop-0.20.2-core.jar  MRExp.java  sqljdbc4.jar</p></li>\n<li><p>Then, for compiling MRExp.java:</p>\n\n<p>[root@test MRExp]#  javac -classpath hadoop-0.20.2-core.jar -d classes/ MRExp.java<br>\n[root@test MRExp]#  jar -cvf MRExp.jar -C classes/ .  </p></li>\n</ol>\n\n<p>but also copying sqljdbc4.jar to HDFS:</p>\n\n<pre><code>[root@test MRExp]#  hadoop dfs -copyFromLocal sqljdbc4.jar /userX  \n</code></pre>\n\n<p>so we get:</p>\n\n<pre><code>[root@test MRExp]# ls  \nclasses  hadoop-0.20.2-core.jar  MRExp.jar  MRExp.java  sqljdbc4.jar  \n</code></pre>\n\n<ol>\n<li><p>After the above, fire the MapR Process:</p>\n\n<p>[root@test MRExp]#  hadoop jar MRExp.jar mrexp.MRExp /userX/output  </p></li>\n</ol>\n\n<p>But the program says: </p>\n\n<pre><code>17:02:50 WARN mapreduce.JobSubmitter: Use GenericOptionsParser for parsing the arguments. Applications should implement Tool for the same.\n12/10/28 17:02:50 INFO mapreduce.JobSubmitter: Cleaning up the staging area /tmp/hadoop-yarn/staging/root/.staging/job_1350984913454_0009\njava.lang.RuntimeException: java.lang.RuntimeException: java.lang.ClassNotFoundException: com.microsoft.sqlserver.jdbc.SQLServerDriver\n        at org.apache.hadoop.mapreduce.lib.db.DBInputFormat.setConf(DBInputFormat.java:165)\n        at org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:70)\n        at org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:130)\n        at org.apache.hadoop.mapred.JobConf.getInputFormat(JobConf.java:607)\n        at org.apache.hadoop.mapreduce.JobSubmitter.writeOldSplits(JobSubmitter.java:476)\n        at org.apache.hadoop.mapreduce.JobSubmitter.writeSplits(JobSubmitter.java:468)\n        at org.apache.hadoop.mapreduce.JobSubmitter.submitJobInternal(JobSubmitter.java:359)\n        at org.apache.hadoop.mapreduce.Job$11.run(Job.java:1226)\n        at org.apache.hadoop.mapreduce.Job$11.run(Job.java:1223)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:396)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1232)\n        at org.apache.hadoop.mapreduce.Job.submit(Job.java:1223)\n        at org.apache.hadoop.mapred.JobClient$1.run(JobClient.java:609)\n        at org.apache.hadoop.mapred.JobClient$1.run(JobClient.java:604)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:396)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1232)\n        at org.apache.hadoop.mapred.JobClient.submitJob(JobClient.java:604)\n        at org.apache.hadoop.mapred.JobClient.runJob(JobClient.java:880)\n        at mrexp.MRExp.main(MRExp.java:70)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.hadoop.util.RunJar.main(RunJar.java:208)\nCaused by: java.lang.RuntimeException: java.lang.ClassNotFoundException: com.microsoft.sqlserver.jdbc.SQLServerDriver\n        at org.apache.hadoop.mapreduce.lib.db.DBInputFormat.getConnection(DBInputFormat.java:191)\n        at org.apache.hadoop.mapreduce.lib.db.DBInputFormat.setConf(DBInputFormat.java:159)\n        ... 25 more\nCaused by: java.lang.ClassNotFoundException: com.microsoft.sqlserver.jdbc.SQLServerDriver\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:202)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:190)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:306)\n        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:247)\n        at java.lang.Class.forName0(Native Method)\n        at java.lang.Class.forName(Class.java:169)\n        at org.apache.hadoop.mapreduce.lib.db.DBConfiguration.getConnection(DBConfiguration.java:148)\n        at org.apache.hadoop.mapreduce.lib.db.DBInputFormat.getConnection(DBInputFormat.java:185)\n        ... 26 more\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":34,"score":0,"question_id":13269638,"title":"Group By and place some records in one group","body":"<p>please consider data:</p>\n\n<pre><code> Id          Group            Value\n -----------------------------------\n 1            1                10\n 2            1                12\n 3            1                10\n 4            2                90\n 5            2                10\n 6            3                30\n 7            4                12\n 8            4                11\n 9            5                10\n 10           5                11\n</code></pre>\n\n<p>I want to do <code>Group By</code> on this data as <code>1,2,3</code> place in one group and <code>4,5</code> place in another group. How I can do this with <code>SQL Server</code>?</p>\n\n<p>thanks</p>\n\n<hr>\n\n<p><strong>Edit 1)</strong></p>\n\n<p>I want this result:</p>\n\n<pre><code>Groups                              Count\n-----------------------------------------\nGroup for 1,2,3                       6\nGroup for 4,5                         4\n</code></pre>\n"},{"tags":["java","sql-server","jdbc","ioerror"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13267764,"title":"I/O Error: SSO Failed: Native SSPI library not loaded","body":"<p>Trying to run the following bit of code:</p>\n\n<pre><code>import java.sql.DriverManager;\npublic class Connect {\npublic static void main(String[] args){\n    try{\n        String databaseDriver = \"net.sourceforge.jtds.jdbc.Driver\";\n        Class.forName(databaseDriver);\n    }\n    catch (Exception e) {\n        e.printStackTrace();\n    }\n\n    try{\n        String url = \"jdbc:jtds:sqlserver://BHX:1433/Forecast;instance=SQLEPXRESS\";\n        java.sql.Connection con = DriverManager.getConnection(url);\n        System.out.println(\"Connection\");\n    }\n    catch (Exception e){\n        e.printStackTrace();\n    }\n  }\n}\n</code></pre>\n\n<p>My SQLServer is running on port 1433 on machine BHX.</p>\n\n<p>The error message I'm getting is as follows:</p>\n\n<pre><code>java.sql.SQLException: I/O Error: SSO Failed: Native SSPI library not loaded. Check the     java.library.path system property.\nat net.sourceforge.jtds.jdbc.TdsCore.login(TdsCore.java:615)\nat net.sourceforge.jtds.jdbc.ConnectionJDBC2.&lt;init&gt;(ConnectionJDBC2.java:352)\nat net.sourceforge.jtds.jdbc.ConnectionJDBC3.&lt;init&gt;(ConnectionJDBC3.java:50)\nat net.sourceforge.jtds.jdbc.Driver.connect(Driver.java:185)\nat java.sql.DriverManager.getConnection(Unknown Source)\nat java.sql.DriverManager.getConnection(Unknown Source)\nat Connect.main(Connect.java:14)\nCaused by: java.io.IOException: SSO Failed: Native SSPI library not loaded. Check the java.library.path system property.\nat net.sourceforge.jtds.jdbc.TdsCore.sendMSLoginPkt(TdsCore.java:1893)\nat net.sourceforge.jtds.jdbc.TdsCore.login(TdsCore.java:588)\n... 6 more\n</code></pre>\n\n<p>I've read up on why this usually occurs and found a similar question <a href=\"http://stackoverflow.com/questions/4219968/java-sql-sqlexception-i-o-error-sso-failed-native-sspi-library\">here</a>, but this doesn't seem to work. When running the code I've inlcuded the following argument to locate the SSO file:</p>\n\n<pre><code>-Djava.library.path=/Tester/jdbc/x64/SSO\n</code></pre>\n\n<p>And this is the structure of my files</p>\n\n<pre><code>**Tester**\n   *src*\n     default package \n         Connect.java\n   *JRE System Library*\n   *jdbc*\n     conf\n     html\n     IA64\n     x64\n       SSO\n        ntlmauth.dll\n     x86\n</code></pre>\n\n<p>Can you spot anything wrong?\nThanks.</p>\n"},{"tags":["sql-server","sql-server-2008","code-reuse"],"answer_count":3,"favorite_count":3,"up_vote_count":17,"down_vote_count":0,"view_count":9712,"score":17,"question_id":3795263,"title":"Errors: \"INSERT EXEC statement cannot be nested.\" and \"Cannot use the ROLLBACK statement within an INSERT-EXEC statement.\" How to solve this?","body":"<p>I have three stored procedures <code>Sp1</code>, <code>Sp2</code> and <code>Sp3</code>.</p>\n\n<p>The first one (<code>Sp1</code>) will execute the second one (<code>Sp2</code>) and save returned data into <code>@tempTB1</code> and the second one will execute the third one (<code>Sp3</code>) and save data into <code>@tempTB2</code>.</p>\n\n<p>If I execute the <code>Sp2</code> it will work and it will return me all my data from the <code>Sp3</code>, but the problem is in the <code>Sp1</code>, when I execute it it will display this error:</p>\n\n<blockquote>\n  <p>INSERT EXEC statement cannot be nested</p>\n</blockquote>\n\n<p>I tried to change the place of <code>execute Sp2</code> and it display me another error:</p>\n\n<blockquote>\n  <p>Cannot use the ROLLBACK statement\n  within an INSERT-EXEC statement.</p>\n</blockquote>\n"},{"tags":["asp.net","sql","sql-server","sql-server-2005","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":478,"score":0,"question_id":6120957,"title":"SQL Query Problem in Inline Query in Asp.net","body":"<p>My sql table structure is this</p>\n\n<pre><code>ID  DataName\n1   Lipsum lorem \n3   lipsum's lorem\n</code></pre>\n\n<p>My inline query in asp.net is that</p>\n\n<pre><code>select * from table where DataName like 'lipsum's lorem'\n</code></pre>\n\n<p>It gives the following errors:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Line 1\nIncorrect syntax near 's'.\nMsg 105, Level 15, State 1, Line 1\nUnclosed quotation mark after the character string ''.\n</code></pre>\n\n<p>I don't want to create a stored procedure to prevent this, I want a solution to this using inline queries.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":5,"favorite_count":1,"up_vote_count":10,"down_vote_count":0,"view_count":11635,"score":10,"question_id":1383494,"title":"Alter user defined type in Sql Server","body":"<p>I created few user defined types in DB as below</p>\n\n<pre><code>CREATE TYPE [dbo].[StringID] FROM [nvarchar](20) NOT NULL\n</code></pre>\n\n<p>and assigned to various tables. My tables in db are in various schemas (not only dbo)</p>\n\n<p>But I realized I need bigger field, and I need to alter, e.g increase from nvarchar to nvarchar, but there is no ALTER TYPE statement</p>\n\n<p>I need a script that temp table/ cursor whatever and save there all tables and fields where my type is used. Then change existing fields to base type - e.g. from CustID [StringID] to CustID [nvarchar(20)].\nDrop the user type and recreate it with new type - e.g. nvarchar(50)\nand finally set back fields to user type</p>\n\n<p>I do not have rules define on types, so don't have to drop rules and re-add them</p>\n\n<p>I'm not very familiar with T-Sql, so any help is appreciated.</p>\n"},{"tags":["sql-server","entity-framework","stored-procedures"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13265914,"title":"How do I build my EF models so they are based on a stored procedure select","body":"<p>I am completely new to EF and a bit lost, to be honest.\nI have an existing database, and everything is going through stored procedures. Even the selects are stored procedures. \nMy model needs to use this, but I have no idea how to begin.\nI assume I can really use the auto-generate, if the objects are to be based on the stored procedures output, instead of the tables.</p>\n\n<p>I have tried googling, but to be honest, I don't think I know what to look for.</p>\n\n<p>If I create an empty entity framework model, and build all the objects myself, can I somehow get the data by executing a stored procedure instead of mapping directly to a table?</p>\n\n<p>And how do I do this? \nAny articles I need to read? My searching seems to always end up with fancy auto-generation articles, that seems to not apply in my case.</p>\n\n<p>I know this is kind of a broad question, but I am somewhat lost here. Any help is much appreciated.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>So, I have learnt that I can create a complex type, based on the stored select. But, I don't really see a way, to map update/insert/delete procedures onto this. I don't really understand how to link the entity type and the complex type together, if that is even possible or the way to do it.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":3086,"score":4,"question_id":528529,"title":"Self-referencing constraint in MS SQL","body":"<p>Is it true that MS SQL restrict self-referencing constraints with ON DELETE CASCADE option? \nI have a table with parent-child relation, PARENT_ID column is foreign key for ID. Creating it with ON DELETE CASCADE option causes error </p>\n\n<blockquote>\n  <p>\"Introducing FOREIGN KEY constraint\n  may cause cycles or multiple cascade\n  paths. Specify ON DELETE NO ACTION or\n  ON UPDATE NO ACTION, or modify other\n  FOREIGN KEY constraints.\"</p>\n</blockquote>\n\n<p>I can't believe that I have to delete this hierarchy in recursive mode. Is there any issue except triggers?</p>\n"},{"tags":["sql-server","sql-server-2008","csv","bulkinsert"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4036,"score":1,"question_id":3756560,"title":"How to Bulk Insert csv with double quotes around all values?","body":"<p>I am trying to insert a .csv file into SQL Server 2008 R2.</p>\n\n<p>The .csv is 300+MB from <a href=\"http://ipinfodb.com/ip_database.php\" rel=\"nofollow\">http://ipinfodb.com/ip_database.php</a> Complete\n(City), 4.0M records.</p>\n\n<p>Here're the top 5 lines, with 1st line = column headers:</p>\n\n<pre><code>\"ip_start\";\"country_code\";\"country_name\";\"region_code\";\"region_name\";\"city\";\"zipcode\";\"latitude\";\"longitude\";\"metrocode\"\n\"0\";\"RD\";\"Reserved\";;;;;\"0\";\"0\";\n\"16777216\";\"AU\";\"Australia\";;;;;\"-27\";\"133\";\n\"17367040\";\"MY\";\"Malaysia\";;;;;\"2.5\";\"112.5\";\n\"17435136\";\"AU\";\"Australia\";;;;;\"-27\";\"133\";\n</code></pre>\n\n<p>I tried Import and Export Data, and BULK INSERT, but haven't been able to import them correctly yet.</p>\n\n<p>Shall I resort to use bcp? can it handle stripping the <code>\"\"</code>? how?</p>\n\n<p>Thank you very much.</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13268241,"title":"Random Function behavior in SELECT query in MS SQL server","body":"<p>I have a written a random function[dbo.UDF_Q_RandomNumber()] that generates a floating type random number between 0 and 1. </p>\n\n<pre><code>DECLARE @upper=10    \nDECLARE @lower=1    \nSELECT  ROUND(CAST((@lower+(@upper-@lower)*dbo.UDF_Q_RandomNumber())AS INT),0) \n</code></pre>\n\n<p>The above code generates a random number between 1 and 10.</p>\n\n<p>Now i made a temporary table #tempTable with 10 rows in it with coulumns 'Id' and 'Number'</p>\n\n<pre><code>Id  Number\n1   1\n2   2\n3   3\n4   4\n5   5\n6   6\n7   7\n8   8\n9   9\n10  10 \n</code></pre>\n\n<p>SQL Query:</p>\n\n<pre><code>CREATE TABLE #tempTable(Id INT,Number INT)\nINSERT INTO #tempTable VALUES (1,1)\nINSERT INTO #tempTable VALUES (2,2)\nINSERT INTO #tempTable VALUES (3,3)\nINSERT INTO #tempTable VALUES (4,4)\nINSERT INTO #tempTable VALUES (5,5)\nINSERT INTO #tempTable VALUES (6,6)\nINSERT INTO #tempTable VALUES (7,7)\nINSERT INTO #tempTable VALUES (8,8)\nINSERT INTO #tempTable VALUES (9,9)\nINSERT INTO #tempTable VALUES (10,10)\nDECLARE @maxCount INT;\nSELECT @maxCount=  COUNT(1) FROM #tempTable\nSELECT * FROM #tempTable\nSELECT Number FROM #tempTable WHERE Id= ROUND(CAST((1+(@maxCount-1)*dbo.UDF_Q_RandomNumber())AS INT),0)\nDROP TABLE #tempTable\n</code></pre>\n\n<p>Here the query </p>\n\n<pre><code>**SELECT Number FROM #tempTable WHERE Id= ROUND(CAST((1+(@maxCount-1)*dbo.UDF_Q_RandomNumber())AS INT),0)**\n</code></pre>\n\n<p>sometimes gives 2 rows and sometimes null which should not come as Id selected is between 1 and 10 (the rows in temptable) and  every Id has value too.\nPlease help .</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":188,"score":0,"question_id":8731229,"title":"SQL Server string getting truncated","body":"<p>I have a column (<code>col1</code>) with <code>nvarchar(max)</code>.</p>\n\n<p>I am trying to do </p>\n\n<pre><code>DECLARE @my_string NVARCHAR(max)\nset @my_string = N'test'\n\nUPDATE dbo.tab1 \nSET col1 = @my_string + ISNULL(col1, N'')\n</code></pre>\n\n<p>no  luck , I have no idea why it is happening. @marc_s</p>\n\n<p>The string value in <code>col1</code> getting truncated after 250 characters. This happening in both SQL Server 2005 and 2008.</p>\n"},{"tags":["c#","sql-server","entity-framework","extended-properties"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":13268446,"title":"Get Extended Property in edmx modeling Db","body":"<p>I have a database modelling by Entity Framework. I need to read the extended properties of each table through the object context associated to my Db. How can i do?</p>\n\n<p>Thank's in advance</p>\n"},{"tags":["sql-server","views"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":615,"score":4,"question_id":6460421,"title":"SQL Server 2008 - sp_refreshview bombing out on some views","body":"<p>I've inherited a fairly substantial project, which makes extensive use of SQL Server (2005 and 2008) views.</p>\n\n<p>One step in the build process is the call the <code>sp_refreshviews</code> system stored procedure, to make sure, no changes on any tables have broken our views. This works fine .... except for about three or four (out of 200+) views....</p>\n\n<p>With those, it just bombs out - gives odd error messages like </p>\n\n<blockquote>\n  <p>Msg 15165, Level 16, State 1,\n  Procedure\n  sp_refreshsqlmodule_internal, Line 55<br>\n  Could not find object\n  'vYourViewNameHere' or you do not\n  have permission.</p>\n</blockquote>\n\n<p>which is dead wrong - that view <strong>does</strong> exist, and I definitely <strong>can</strong> select from it.</p>\n\n<p>I cannot seem to find any good concise information about <strong>why</strong> this happens, what triggers it... any ideas? Is there anything I could do to detect such problematic views? Can I change their definitino so that they'd be refreshable again? </p>\n\n<p><strong>Update:</strong> I logged a bug report on Microsoft Connect for this - if you agree this seems odd and needs to be fixed, please vote for it!</p>\n\n<p><a href=\"https://connect.microsoft.com/SQLServer/feedback/details/676728/sp-refreshview-crashes-with-misleading-error-on-views-with-schemabinding\" rel=\"nofollow\">https://connect.microsoft.com/SQLServer/feedback/details/676728/sp-refreshview-crashes-with-misleading-error-on-views-with-schemabinding</a></p>\n"},{"tags":["sql","sql-server","sql-server-2008","merge","case"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13268170,"title":"Merge Statement: Don't update blank field","body":"<p>I'm performing a MERGE statement from a temp table <code>t</code> into the main table <code>ts</code>, matching on an ID field. It contains the following:</p>\n\n<pre><code>WHEN MATCHED THEN UPDATE\n   SET ts.username = t.username, ts.password = t.password, ts.title = t.title, ts.firstname = t.firstname, ts.surname = t.surname, ts.email = t.email\n</code></pre>\n\n<p>If the username and password is blank in the temp table <code>t</code>, I don't want to update the main table <code>ts</code>. How can I do this?</p>\n\n<p>EDIT: Seems like a <code>CASE</code> statement or using <code>COALESCE(NULLIF(t.username, ''), ts.username)</code> will work. Which is best?</p>\n"},{"tags":["sql-server","asp-classic"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13268231,"title":"creating a simple sql server search box in asp","body":"<p>i managed to find an example piece of code on the web which i have tweaked for my own use... however i can't get it to work and im pretty sure the original doesnt work either...</p>\n\n<p>i have a simple form on one page:</p>\n\n<pre><code>&lt;!-- #include file=\"Header.asp\" --&gt;\n&lt;!-- #include file=\"database.asp\"--&gt;\n&lt;form id=\"form1\" name=\"form1\" method=\"get\" action=\"searchresultTEST2.asp\"&gt;\n&lt;label&gt;Enter Keywords:\n&lt;input type=\"text\" name=\"searchTerm\"&gt;\n&lt;/label&gt;\n&lt;p&gt;\n&lt;input type=\"submit\" name=\"Submit\" value=\"Submit\"&gt;\n&lt;/p&gt;\n&lt;/form&gt;\n&lt;!-- #include file=\"footer.asp\" --&gt;\n</code></pre>\n\n<p>the database.asp file contains the connection to the database which is used across the all of the pages. (this works :)!)</p>\n\n<p>i then have this as a seperate search results page:</p>\n\n<pre><code>&lt;!-- #include file=\"Header.asp\" --&gt;\n&lt;!--#include file=\"database.asp\"--&gt;\n&lt;%\n'collect the form input\nsearchInput = Request.QueryString(\"searchTerm\")\n\n'check for a match\nSet myRecordSet = Connect.Execute (\"SELECT * FROM dbo.interiors WHERE Job_Num LIKE '%\" &amp; searchInput &amp; \"%'\")\n\n'display the results\nif myRecordSet.EOF then\nresponse.write(\"You searched for: \" &amp; searchInput &amp; \"&lt;br&gt;\")\nresponse.write(\"A match was not found.&lt;br&gt;Sorry try again.\")\nelse\nresponse.write(\"You searched for: \" &amp; searchInput &amp; \"&lt;br&gt;\")\nresponse.write(\"The record was found!&lt;br&gt;The match is: \" &amp; myRecordSet(\"myColumn\"))\nend if\n%&gt;\n&lt;br&gt;&lt;br&gt;\n&lt;a href=\"searchTEST2.asp\"&gt;Try Again&lt;/a&gt;\n</code></pre>\n\n\n\n<p>I receive the error: </p>\n\n<p>Microsoft VBScript runtime error '800a01a8'</p>\n\n<p>Object required: ''</p>\n\n<p>/Interiors/searchresultTEST2.asp, line 12 </p>\n\n<p>i know the SQL checks out okay so im not quite sure whats wrong with it, any help would be appreciated, thanks guys! :D</p>\n"},{"tags":["sql","sql-server","vb.net","sql-server-2008"],"answer_count":6,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":3365,"score":1,"question_id":1513438,"title":"How do I return a value to a sqldatareader if value is null?","body":"<p>I am currently using a sql data reader (in vb.net) to extract an article object via a stored proc from a SQL Server 2008 database. Part of this object includes the two properties shown below:</p>\n\n<pre><code>theArticle.Truthfulness = ((myReader.GetInt32(myReader.GetOrdinal(\"Truthfulness\"))))\ntheArticle.Relevance = ((myReader.GetInt32(myReader.GetOrdinal(\"Relevance\"))))\n</code></pre>\n\n<p>My problem is that the Truthfulness and Relevance may return a null value and this is causing the function to fall over.</p>\n\n<p>I think I understand why. I am asking for an integer value (getin32) and because null is returned it fails.</p>\n\n<p>How do I accommodate the null value from the database so it does not fall over?</p>\n"},{"tags":["sql-server","database","text","website","oracle11g"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13268124,"title":"Copying text from website to database","body":"<p>I plan to create a database, which gets filled and expanded regularly based on newsticker entries from the web.\nFor example the rows of the \"Latest Vessel Casualties\" box at <a href=\"http://www.lloydslistintelligence.com/llint/index.htm\" rel=\"nofollow\">http://www.lloydslistintelligence.com/llint/index.htm</a> should be added to a local database every day at a certain time.</p>\n\n<p>How would you approach this? Are there features provided by Oracle's database, or SQL Server? If not, how could you generally copy text from a certain website to a local text file?</p>\n"},{"tags":["sql","sql-server","computed-columns"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":13267855,"title":"MS SQL format calculated column","body":"<p>I have a computed column which is calculated this way:</p>\n\n<pre><code>(dateadd(month,[amorted_months],[real_date_start]))\n</code></pre>\n\n<p>The above stays in the Formula property of the column. This formula displays for example </p>\n\n<p>'2013-02-28 10:22:15.583'</p>\n\n<p>Now I want to format the column and to display only the date , not the time. When I use the FORMAT function like this:</p>\n\n<pre><code>(FORMAT(dateadd(month,[amorted_months],[real_date_start]), 'YYYY-MM-DD'))\n</code></pre>\n\n<p>It says that there's an error in validation the formula. I'm not good at SQL syntax and I suppose this is really stupid. Thanks for the help!</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":13267127,"title":"SQL Server: Can I save binary data in an nvarchar column?","body":"<p>I know you can convert <code>binary data</code> to <code>nvarchar</code> and save in an <code>nvarchar</code> column, and then convert it back to <code>binary</code> when retrieving it. Will this work correctly all the time to give you your original <code>binary</code> data? Or could something get messed up in the translation? </p>\n\n<p>I am asking because we have a <code>nvarchar</code> column that saves passwords in plain text. I would like this to change to saving the PWs in encrypted text. If I use the function <code>EncryptByPassPhrase</code>, it return <code>varbinary</code>. I am wondering if I can just convert the output from <code>EncryptByPassPhrase</code> to <code>nvarchar</code> and save in the same Password column. This would be easier than creating a new column of type <code>varbinary</code> to save the encrypted PW.</p>\n\n<p>So I am proposing that I convert the current passwords like this:</p>\n\n<pre><code>UPDATE Users \nSET Password = CONVERT(nvarchar(200), EncryptByPassPhrase('whatever', Password))\n</code></pre>\n\n<p>Then I would decrypt and retrieve the PW like:</p>\n\n<pre><code>SELECT CONVERT(nvarchar(200), DecryptByPassPhrase('whatever', Password)) AS PW \nFROM Users\n</code></pre>\n\n<p>Will this always work correctly?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server","tsql","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13267349,"title":"T-SQL stored procedure - how to make parameter that accepts either integer or text","body":"<p>I have created a stored procedure that accepts 3 parameters.</p>\n\n<pre><code>@row int\n,@column VARCHAR(17)\n,@value int\n</code></pre>\n\n<p>I want the <code>@value</code> parameter to accept either text or integer because it updates different columns depending on <code>@column</code> parameter.</p>\n\n<p>Please advise</p>\n"},{"tags":["sql","sql-server"],"answer_count":6,"favorite_count":7,"up_vote_count":53,"down_vote_count":0,"view_count":101597,"score":53,"question_id":31057,"title":"How to insert a line break in a SQL Server VARCHAR/NVARCHAR string","body":"<p>I didn't see any similar questions asked on this topic, and I had to research this for something I'm working on right now. Thought I would post the answer for it in case anyone else had the same question.</p>\n"},{"tags":["sql","sql-server"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13266534,"title":"Extract hostname from a URL","body":"<p>I have to trim the website name upto \".com\" or\"co.in\" in sql</p>\n\n<p>example: lets assume i have  site address as\"http://stackoverflow.com/questions/ask?title=trim\".\nI need to get the result as \"stackoverflow.com\".</p>\n\n<p>some scenario it may be like \"www.google.co.in\" then i need it to be \"google.co.in\"</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13266772,"title":"How can I select the latest event for a given user in Microsoft SQL Server 2008?","body":"<p>I have a database in Microsoft SQL Server 2008</p>\n\n<p>I have a table <code>[eventlog].[dbo].[USER_OPERATION]</code> with columns <code>[userID], [event_description], [event_date], [event_type], [eventID]</code></p>\n\n<p><code>eventID</code> is unique for, well, every given event that can happen.</p>\n\n<p>A given <code>UserID</code> is, of course, not unique for events (every user may have a lot of events associated with him) but is associated with a single individual user</p>\n\n<p>What I want is to create a query that would give me a list which only has the <em>latest</em> event for every user (that is to say, every <code>UserID</code>) and its associated info (the <code>event_type</code>, <code>eventID</code> and <code>event_description</code> of a given specific event).</p>\n\n<p>To illustrate:</p>\n\n<p>When performing</p>\n\n<pre><code>SELECT * \nFROM [eventlog].[dbo].[USER_OPERATION] \nORDER BY userID ASC\n</code></pre>\n\n<p>I get something along the lines of </p>\n\n<pre><code>|====================================================================================|\n|  eventID  |  userID  |        event_description        |  event_date  | event_type |\n|           |          |                                 |              |            |\n|   123     |    2     |  USER 2 broke something         |  03.11.11    |   CRASH    |\n|   391     |    2     |  USER 2 filed a complaint       |  30.04.10    |  COMPLAINT |\n|   392     |    2     |  USER 2 has bought beer         |  31.10.09    |  PURCHASE  |\n|   32      |    3     |  USER 3 broke something         |  22.10.11    |   CRASH    |\n|   568     |    4     |  USER 4 has requested support   |  05.12.11    |  SUPP_REQ  |\n|   691     |    4     |  USER 4 has bought beer         |  01.12.10    |  PURCHASE  |\n|   81      |    4     |  USER 4 updated personal data   |  17.07.11    |  PDAT_UPD  |\n|   141     |    5     |  USER 5 has bought beer         |  16.08.11    |  PURCHASE  |\n|   142     |    5     |  USER 5 broke something         |  16.08.11    |   CRASH    |\n|   269     |    6     |  USER 6 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|   845     |    7     |  USER 7 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|           |          |                                 |              |            |\n|====================================================================================|\n</code></pre>\n\n<p>As you can see, some users have multiple events with different dates associated with them.</p>\n\n<p>What I want is a query that will show me a list of users and what was the most recent date users had an event on (the output would, essentially, be a table which lists each users once, and shows the most recent event associated with each user, and associated event_description, event_date and event_type info). </p>\n\n<p>Let's call such a query result \"Recent Event Table\".</p>\n\n<p><b>Do note the \"unusual condition\" of User 5 (UserID 5) who broke something and bought beer at the same date. </p>\n\n<p>In such cases, I don't care WHICH of the two same-day events would go into the \"Recent Event Table\"</b>, it can be picked by random or whatever (though I would still would need the associated event_description and event_type info).</p>\n\n<p><b>Ideally</b>, the result would look like this (for same set of users as above):</p>\n\n<pre><code>|====================================================================================|\n|  eventID  |  userID  |        event_description        |  event_date  | event_type |\n|           |          |                                 |              |            |\n|   123     |    2     |  USER 2 broke something         |  03.11.11    |   CRASH    |\n|   32      |    3     |  USER 3 broke something         |  22.10.11    |   CRASH    |\n|   568     |    4     |  USER 4 has requested support   |  05.12.11    |  SUPP_REQ  |\n|   141     |    5     |  USER 5 has bought beer         |  16.08.11    |  PURCHASE  |\n|   269     |    6     |  USER 6 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|   845     |    7     |  USER 7 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|           |          |                                 |              |            |\n|====================================================================================|\n</code></pre>\n\n<p>If there is no way to just <i>\"pick any one of the two randomly or per some rule\"</i> for such \"date-dupes\" as User 5, having two entries in the \"Recent Event Table\" would be acceptable for such special cases, since they are very rare and I can handle them manually.</p>\n\n<p>In such (a little bit less fortunate) case the \"Recent Event Table\" would look like </p>\n\n<pre><code>|====================================================================================|\n|  eventID  |  userID  |        event_description        |  event_date  | event_type |\n|           |          |                                 |              |            |\n|   123     |    2     |  USER 2 broke something         |  03.11.11    |   CRASH    |\n|   32      |    3     |  USER 3 broke something         |  22.10.11    |   CRASH    |\n|   568     |    4     |  USER 4 has requested support   |  05.12.11    |  SUPP_REQ  |\n|   141     |    5     |  USER 5 has bought beer         |  16.08.11    |  PURCHASE  |\n|   142     |    5     |  USER 5 broke something         |  16.08.11    |   CRASH    |\n|   269     |    6     |  USER 6 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|   845     |    7     |  USER 7 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|           |          |                                 |              |            |\n|====================================================================================|\n</code></pre>\n\n<p>Which is also acceptable (but would need a bit additional pruning later).</p>\n\n<p>So, to summarize my question, is it possible to construct such a Microsoft SQL query that would give me a Recent Event Table along the lines of what was described above ?</p>\n\n<p>Thank you very much for your help in advance </p>\n"},{"tags":["sql-server","postgresql","stored-procedures"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13266469,"title":"SQL Server stored procedure like PostgreSQL stored procedure","body":"<p>I want to create a stored procedure in SQL Server that is like PostgreSQL stored procedure.</p>\n\n<p>SQL Server:</p>\n\n<p><strong>table1_test</strong></p>\n\n<pre><code>field1    field2\naaaa      bbbb\n</code></pre>\n\n<p><strong>table2_test</strong></p>\n\n<pre><code>field1    field2\ncccc      dddd\n\ncreate procedure test_proce as\n  select * from table1_test\n  select * from table2_test\n</code></pre>\n\n<p>SQL Server results:</p>\n\n<pre><code>field1    field2\naaaa      bbbb\n---------------------------------\nfield1    field2\ncccc      dddd\n</code></pre>\n\n<p>PostgreSQL:</p>\n\n<p><strong>table1_test</strong></p>\n\n<pre><code>field1    field2\naaaa      bbbb\n</code></pre>\n\n<p><strong>table2_test</strong></p>\n\n<pre><code>field1    field2\ncccc      dddd\n\ncreate function test_proc() returns void as $$\nBEGIN\nselect * from \"table1_test\";\nselect * from \"table2_test\";\nEND;\n$$Language plpgsql;\n</code></pre>\n\n<p>PostgreSQL results:</p>\n\n<pre><code>Success function.\n</code></pre>\n\n<p>I want show postgresql in multi-table result.</p>\n\n<p>that's impossible ?</p>\n"},{"tags":["c#",".net","sql-server","subtract"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13266422,"title":"Mssql Subtract certain percent","body":"<p>Im trying to subtract a certain percent of my price, into a AS columm.</p>\n\n<pre><code>SELECT TOP 2 *, price - (price * (discount/100)) AS discountedPrice FROM products WHERE discount != 0\n</code></pre>\n\n<p>But this seems not to work. What have i done wrong?</p>\n\n<p>I want it like this, let's say price is 500 and discount is 20. Then it'll have to subtract those 20 as percent of the 500.</p>\n\n<p>So 500 - 20%, just in Mssql format.</p>\n"},{"tags":["c#","sql-server","ado.net"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13265981,"title":"Execute SQL Server Stored Procedure with SqlHelper.ExecuteDataSet() and Get Return Value","body":"<p>I have an <code>SQL Server Stored Procedure</code>. This procedure have an output parameter.\nOn my <code>C#.NET</code> Appliaction, I execute this procedure via <code>SqlHelper.ExecuteDataSet()</code> and it returns a query result <code>DataSet</code>.\nHow can I get the output parameter from the stored procedure procedure while using <code>SqlHelper.ExecuteDataSet()</code>.\nSome article said that I need to use <code>SqlHelper.ExecuteNonQuery()</code> but I need the <code>DataSet</code> too.</p>\n\n<p>This is my code:</p>\n\n<pre><code>        public DataSet GetDataPerTable(string spName, string a, string b, out int c)\n        {\n            try\n            {\n                c = 0;\n\n                SqlParameter[] spParameter = new SqlParameter[3];\n\n                spParameter[0] = new SqlParameter(\"@a\", SqlDbType.Char, 4);\n                spParameter[0].Direction = ParameterDirection.Input;\n                spParameter[0].Value = a;\n\n                spParameter[1] = new SqlParameter(\"@b\", SqlDbType.Char, 1);\n                spParameter[1].Direction = ParameterDirection.Input;\n                spParameter[1].Value = b;\n\n                spParameter[2] = new SqlParameter(\"@c\", SqlDbType.Int);\n                spParameter[2].Direction = ParameterDirection.ReturnValue;                \n                c = Convert.ToInt32(spParameter[2].Value);\n\n                return SqlHelper.ExecuteDataset(Configuration.MyConnectionString, CommandType.StoredProcedure, spName, spParameter);\n            }\n            catch (Exception ex)\n            {\n\n                throw ex;\n            }\n        }\n</code></pre>\n\n<p>My <code>c</code> variable always return 0. Any Idea? Thanks in advance :)</p>\n\n<p>My Procedure is about like this:</p>\n\n<pre><code>CREATE PROCEDURE [dbo].SPR_MyProcedure (@a Char(4), @bChar(1), @c Int Output)  \nSELECT * \nFROM MyTable\nSet @c = 1\n</code></pre>\n"},{"tags":["sql-server","tsql","udf"],"answer_count":4,"favorite_count":2,"up_vote_count":1,"down_vote_count":1,"view_count":382,"score":0,"question_id":4035024,"title":"How to create a UDF or View in another database that references the correct sys.objects table in the caller?","body":"<p>Using SQL Server 2008, I'd like to create a UDF that gives me the create date of an object.  This is the code:</p>\n\n<pre><code>create function dbo.GetObjCreateDate(@objName sysname) returns datetime as\nbegin\n    declare @result datetime\n    select @result = create_date from sys.objects where name = @objname\n    return @result\nend\ngo\n</code></pre>\n\n<p>I'd like to put this UDF in the master database or some other shared database so that it is accessible from anywhere, except that if I do that then the <code>sys.objects</code> reference pulls from the <code>master</code> database instead of the database that I'm initiating my query from.  I know you can do this as the <code>information_schema</code> views sit in <code>master</code> and just wrap calls to local instances of sys.objects, so I'm hoping there's a simple way to do that with my UDF as well.</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":393,"score":1,"question_id":5563141,"title":"Convert text to date format","body":"<p>How do I convert a text format e.g. </p>\n\n<blockquote>\n  <p>Thursday, 1 January 2009</p>\n</blockquote>\n\n<p>to a date in <code>sql</code>?</p>\n\n<p>Thank you </p>\n"},{"tags":["c#","sql-server","microsoft","sync"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":11,"score":1,"question_id":13265884,"title":"Microsoft Sync Framework for File (Client) and SQL Server Database (Server) synchronization","body":"<p>I'm trying to implement the syncing solution using Microsoft Sync Framework. The server will be SQL server database contains the documents in FileStream and client will be the File system (Windows OS). \nI have seen file synchronization provider with the Azure Blob Storage/Custom provider. But have not seen this. Do anybody have any idea on this.\nMy application scenario is :The database server contains the File/Documents in the form of byte array by the FileStream mechanism from SQL server.\nAnd the Sync activity will syncronize the documents from SQL server to any given file system.\nPlease help me out.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","clr"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":13265648,"title":"conflict and otherness between data produced by a single clr stored procedure in two server","body":"<p>I have a very special problem !\nI have a clr stored procedure that is called by a windows application . there is not any problem when i do it in local instance of sqlserver . the problem occurs when using a remote server for doing this job . in this situation clr can't do it good . my output data is wrong and there are many differences in two servers' data . i want to know why these conflicts happen by a single clr sp ? \nmore info : i have a \"transactionscope\" in clr . \nthanks for your help !</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":17470,"score":5,"question_id":5136013,"title":"How to change column datatype in SQL Server database without losing data","body":"<p>I have SQL Server database and I just realized that I can change the type from one of the columns from <code>int</code> to <code>bool</code>. How can I do that without losing the data that is already entered into that table? </p>\n\n<p>PS. I am using SQL Server Server 2008.</p>\n"},{"tags":["sql","sql-server","sql-update"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13265369,"title":"SQL Update Select The multi-part identifier \"OLD_SP.Num\" could not be bound","body":"<pre><code>Declare @modCode varchar(3)\nSET @modCOde = 'SOR';\n\nUPDATE  Doc_SalesOrder\nSET     OLD_SP.Num = NEW_SP.NewNum\nFROM    Doc_SalesOrder as OLD_SP\nINNER JOIN\n(\n     Select\n       Id,\n       dbo.ApplyModuleCode(@modCode,Num) as NewNum \n     From Doc_SalesOrder\n     Where Num not LIKE '%'+@modCOde+'%'\n)NEW_SP ON OLD_SP.Id = NEW_SP.Id\n</code></pre>\n\n<p>When I  run the query the error is:</p>\n\n<blockquote>\n  <p>The multi-part identifier \"OLD_SP.Num\" could not be bound.</p>\n</blockquote>\n\n<p>Why?</p>\n"},{"tags":["sql-server","query","search","casting","binary"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13264305,"title":"SQL Server : Like Syntax and Add operator Error","body":"<p>I am using this syntax and it should work well if only it doesn't get an error.</p>\n\n<pre><code>SELECT\n   e.user_key,\n   e.char_key,\n   CONVERT(VARCHAR,substring(e.char_data, 9, 16)) AS name,\n   p.CHAR_DATA\nFROM \n   CHAR_DATA0 AS e\nINNER JOIN  \n   CHAR_DATA1 AS p ON e.CHAR_KEY = p.CHAR_KEY\nWHERE \n   p.CHAR_DATA LIKE '%'+CAST(cast(reverse(CONVERT(BINARY, 9998)) as BINARY(2)) AS BINARY(2))+'%'\nORDER BY \n   char_key\n</code></pre>\n\n<p>I need help. How to change this code for it to work?</p>\n\n<p><code>CHAR_DATA</code> column is of type <code>BINARY(2000)</code></p>\n\n<p>I have data like so: (got it using select)</p>\n\n<pre><code> 0x04005C03020F2789080100000F278908010000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFBA3B8C08000000BB3B8C080000000F2789080100000F278908010000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFBC3B8C08000000BD3B8C080000000F2789080100000F278908010000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFBE3B8C08000000BF3B8C080000000F2789080100000F278908010000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFC03B8C08000000C13B8C08000000B5388B08020000B5388B08020000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFBA3B8C08000000BB3B8C08000000B5388B08020000B5388B08020000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFBC3B8C08000000BD3B8C080000000E2789080100000E278908010000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFBE3B8C08000000BF3B8C080000000E2789080100000E278908010000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFC03B8C08000000C13BFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF0F27FFFF0100000F27FFFF0100000E2789080000000E278908000000FFFFFFFFFFFFFF7E107F08000000EC168408000000B0177D080000000F27FFFF0100000F27FFFF0100000E2789080000000E27890800000052167C081E000052167C081E0000E2167D08000000271F2005000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF0E2787080100000E27870801000052167C081E000052167C081E0000FFFFFFFFFFFFFF13127F08000000C813FFFF1E0000C813FFFF1E00000E2787080100000E27870801000028127A08000000BF3B2D05000000FFFFFFFFFFFFFF13127F08000000C813FFFF1E0000C813FFFF1E0000FFFFFFFFFFFFFFFFFFFFFFFFFFFF28127A08000000FFFFFFFFFFFFFF1B1A80081A00001B1A80081A0000E915FFFF1B0000E915FFFF1B000023067A0800000024147B0800000020120D05000000084792080100001B1A80081A00001B1A80081A0000E915FFFF1B0000E915FFFF1B000025067A0800000024147B0800000020120D05000000E21610050000000000009D000000FFFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n</code></pre>\n\n<p>I need to search somewhere in those lines if it contains the entry I'm trying to find.</p>\n\n<p>What I'm trying to find is always 2 bytes. So I'm looking for 0x0E27 in the syntax above.</p>\n\n<p>This is a working syntax but its not what I want to do:</p>\n\n<pre><code>SELECT \n   CONVERT(INT,cast(reverse(substring(char_data, 37, 2)) as BINARY(2))) AS helm \nFROM CHAR_DATA0 \nWHERE CHAR_KEY = 5\n</code></pre>\n\n<p>Another this is if I use nvarchar(MAX) it gives results that doesn't even contain the data I'm trying to find.</p>\n"},{"tags":["c#","sql-server","linq","linq-to-sql","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":52,"score":-2,"question_id":13262409,"title":"Why not get the desired output from stored procedure","body":"<p>To fulfill one of my requirements I need to pass a SQL query as a parameter to a stored procedure.</p>\n\n<p>My stored procedure syntax is:</p>\n\n<pre><code>create PROCEDURE spSelect \n    @Query VARCHAR(500)\nAS \n    EXEC( @Query)  \n    return  \n</code></pre>\n\n<p>To execute that stored procedure, I use this C# code:</p>\n\n<pre><code>DataContex db=new DataContex();\n    String sSQL = \" SELECT OrderID,ShipName FROM dbo.Orders\";\n    var result = db.spSelect(sSQL);\n</code></pre>\n\n<p>After execution, the <code>result</code> is <code>0</code>.</p>\n\n<p>Need help to understand what happen, why not I get desired output</p>\n\n<p>If have any query please ask, thanks in advance</p>\n"},{"tags":[".net","sql-server","web-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":16,"score":-1,"question_id":13262277,"title":"How to update central SQL Server database from several local SQL Server databases?","body":"<p>I currently have a central SQL server database that will maintain all records from the growing number of local client SQL server databases. This central server will be used to generate reports etc.</p>\n\n<p>The clients are running a local installation of a .NET web application where they can register and watch videos etc (all stored locally on the client). The web application stores registrations and viewing data in the local SQL server database.</p>\n\n<p>It is not feasible for me to have a full web application which all of these clients can access as we are streaming HD video content to the clients who are concerned about bandwidth. I wish this were possible as it would make my life 10x easier.</p>\n\n<p>I was thinking a windows service which will run on the clients and somehow connect to the central server database and insert all new registrations every hour or so. Or the local web application could insert directly into the central server database. My boss would prefer the local database setup though, which gives us a reliable backup as we can remotely access these databases and manually pull data if we need.</p>\n\n<p>Is this possible? I've read of web services which I think may satisfy my needs.</p>\n\n<p>Thanks for any help.</p>\n"},{"tags":["sql","sql-server","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13264779,"title":"How to display a null row between 2 tables","body":"<p>Using a view in SQL Server 2000</p>\n\n<p>Table1:</p>\n\n<pre><code>id  z1      z2      z3      z4   type\n--------------------------------------\n01A 300     400     300     400  01\n2B  300     400     300     500  02\n3C  700     600     400     300  01\n04A 500     400     800     900  01\n05B 400     300     400     300  02\n06  150     200     200     150  03\n....\n</code></pre>\n\n<p>Table2:</p>\n\n<pre><code>type  value1         value2\n------------------------------------    \n01    0      300\n01    301    500          \n02    0      200\n02    201    400\n03\n.....\n</code></pre>\n\n<p>I want to select the table1 rows based on table2 range:</p>\n\n<p>Combination for table1- <code>max(Z1, Z2) and max(Z3, Z4)</code></p>\n\n<p>If Max(z1,z2)  range is less than or equal to table2 max(value2) where table1.type = table2.type\nIf Max(z1, z2)  range is less than or equal to table2 max(value2) where table1.type = table2.type</p>\n\n<p>If z1, Z2 range less than or equal to table2 then i want to display the z1, z2 rows otherwise null\nIf z3, z4 range less than or equal to table2 then i want to display the z3, z4 rows otherwise null</p>\n\n<p>Expected output</p>\n\n<p>Table1:</p>\n\n<pre><code> id  z1      z2      z3      z4   type\n    --------------------------------------\n\n01A 300     400     300     400  01 ' `Both (z1, z2), (z3, z4) rows are matching with table2 for type 01`\n2B  300     400     null     null  02 ' (z1, z2) are matching, (z3, z4) rows are not matching with table2 for type 02\n3C  null    null     400     300  01 ' (z1, z2) rows are not matching, (z3, z4) rows are matching with table2 for type 01\n04A 500     400     null     null  01 ' (z1, z2) rows are matching, (z3, z4) rows are not matching with table2 for type 01\n05B 400     300     400     300  02 ' Both (z1, z2), (z3, z4) rows are matching with table2 for type 02\n\n....\n</code></pre>\n\n<p>Currently I'm using a view, I don't want to change to stored procedure because most of the report are using this view.</p>\n\n<p>How to do it in sql..?</p>\n"},{"tags":["sql-server","database","oracle","migration"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":17,"score":0,"question_id":13265099,"title":"Migration of SQL Server database to Oracle","body":"<p>I searched many converters and migration tools over internet but couldn't find the one I really need.</p>\n\n<p>Though there are some but they are on trial, I want free one, mysql provides migration facility but it doesn't convert 100%</p>\n"},{"tags":["sql-server","sql-server-2008","datetime","truncate"],"answer_count":13,"favorite_count":30,"up_vote_count":61,"down_vote_count":0,"view_count":81809,"score":61,"question_id":923295,"title":"How can I truncate a datetime in SQL Server?","body":"<p>What's the best way to truncate a datetime value (as to remove hours minutes and seconds) in SQL Server 2008?</p>\n\n<p>For example:</p>\n\n<pre><code>declare @SomeDate datetime = '2009-05-28 16:30:22'\nselect trunc_date(@SomeDate)\n\n-----------------------\n2009-05-28 00:00:00.000\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13265039,"title":"SQL passing a value in Like Command","body":"<p>I want it to be like this and its ok..</p>\n\n<pre><code>Declare @modCode varchar(3)\nSET @modCOde = 'SOR';\n\nSelect dbo.ApplyModuleCode(@modCode, Num) \nFrom Doc_SalesOrder \nWhere Num not LIKE @modCOde\n</code></pre>\n\n<p>but I want to use it like this.</p>\n\n<pre><code>Declare @modCode varchar(3)\nSET @modCOde = 'SOR';\n\nSelect dbo.ApplyModuleCode(@modCode, Num) \nFrom Doc_SalesOrder \nWhere Num not LIKE %@modCOde%\n</code></pre>\n\n<p>How can I achieve what I want?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13264519,"title":"Getting weekly data from sql","body":"<p>I have a table which has a date column ands values according to dates.Normally if i want to select the data between two dates we use the <code>BETWEEN</code> syntax but it brings each day between those 2 values i have given.Is it possible to change it so it brings the dates with sopme interval i have given? For example if do a simple </p>\n\n<pre><code>SELECT * FROM METABLE WHERE DATE BETWEEN '2012-06-11' AND '2012-07-11'\n</code></pre>\n\n<p>It should bring me the dates as:</p>\n\n<pre><code>2012-06-11 myValue Stuff \n2012-06-12 myValue Stuff \n.\n.\n.\n2012-07-11 myValue Stuff.\n</code></pre>\n\n<p>IS it possible to change it to,</p>\n\n<pre><code>2012-06-11 myValue Stuff \n2012-06-18 myValue Stuff \n2012-06-25 myValue Stuff \n.\n.\n.\nUntil my end date.\n</code></pre>\n\n<p>So this gives me my weekly values.\nHow can i achieve that?</p>\n"},{"tags":["sql","sql-server","database","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13258850,"title":"table name of column from view","body":"<p>I have a view which returns 30 columns. The view is created by inner join of three tables. I wish to find out which column was taken from which table using a query rather than going through the view line by line.\nIs there a way to do that in sql server 2008?\nthanks in advance </p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13263497,"title":"SQL compare strings having version as value","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6855588/split-a-string-and-return-greatest-in-mssql\">Split a string and return greatest in mssql</a>  </p>\n</blockquote>\n\n\n\n<p>I need to compare strings which have version value, for example:\nstring1 = 2.3.4\nstring2 = 2.5.6\nNow in the above case i need to check which string version is greater?</p>\n"},{"tags":["sql-server","sql-server-2008","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13256597,"title":"Trigger to Only Allow a Single Null Value Per Item ID","body":"<p>I am working on a database for equipment management, where users can sign in and out equipment. I have a table called TBL_Usage which keeps track of this. When an item is signed out, a new record is created in this table with the sign out date, and when it is signed back in, a sign in date is entered in the same record.</p>\n\n<p>For the purposes of this question, the table looks like this:\nTBL_Usage(Date_Out, Date_In, Equipment_ID)</p>\n\n<p>Now an item can't be signed out twice at the same time, therefore for each Equipment_ID, there can only be a maximum of one record where Date_In is null. I want to create a trigger/constraint to deal with this and am not quite sure how to set it up.</p>\n"},{"tags":["sql-server","sql-server-2008-r2","sql-management-studio"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":27,"score":2,"question_id":13262034,"title":"SQL Server 2008 trace query and output (record rows) of query execution","body":"<p>I want to programmatically trace and save all queries and outputs (record rows) of queries execution in SQL Server 2008 R2.</p>\n\n<p>I've easily implemented a query grace program based on <code>TraceServer</code> class of SMO (Server Management Object) in Visual C#. </p>\n\n<p>However, I couldn't trace outputs (record rows) of queries execution which are like outputs in the results window in SSMS (SQL Server Management Studio).</p>\n\n<p>How can I trace and save them?</p>\n"},{"tags":["sql-server","stored-procedures","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13263598,"title":"Wild Cards in a stored procedure","body":"<p>I have a SQL Server database that contains a table <code>address(a_id:int, street:nvarchar(50), apt:nvarchar(50), city:nvarchar(50), state:nvarchar(50), zip:int)</code></p>\n\n<p>I have a stored procedure that returns the <code>a_id</code> for a specific address.</p>\n\n<pre><code>SELECT\n    address_id\nFROM\n     address a\nWHERE\n    street like '%'+ @street +'%'\n    and apt like '%'+ @apt +'%'\n    and zip = @zip\n</code></pre>\n\n<p>For example if I put in <code>1060 West Addison Street Chicago IL 60613</code> I would want to get the same <code>a_id</code> as <code>1060 W Addison Street Chicago IL 60613</code> or <code>1060 W. Addison Street Chicago IL 60613</code></p>\n\n<p>As you can see, I tried putting wild cards around the <code>street</code> and <code>apt</code> columns to account for differences in abbreviations and periods, but it does not work.</p>\n\n<p>Currently only the first example returns an <code>a_id</code>, as this is what matches whats in the db exactly</p>\n"},{"tags":["php","sql","sql-server","query"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13263569,"title":"Getting only the same result to appear in SQL","body":"<p>This is my code, later I will be putting it into php, but for the time being I am using it in a provided Query tester. We are doing the first degree of kevin bacon instead of the 6th.</p>\n\n<p><strong>My query is as follow:</strong> </p>\n\n<pre><code>SELECT name,year\nFROM actors\nJOIN roles ON roles.actor_id = actors.id\nJOIN movies ON movies.id=roles.movie_id\nWHERE actors.first_name= 'kevin' AND actors.last_name='bacon' OR actors.first_name= 'sean' AND actors.last_name='penn'\nORDER BY movies.name;\n</code></pre>\n\n<p><strong>it results in</strong> </p>\n\n<pre><code>Animal House 1978\nApollo 13 1995 \nFew Good Men, A 1992 \nFootloose 1984 \nHollow Man 2000 \nJFK 1991 \nMystic River 2003 \nMystic River 2003 \nPlanes, Trains &amp; Automobiles 1987 \nStir of Echoes 1999 \n</code></pre>\n\n<p><strong>How do I get it to show only Mystic River?</strong></p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13177874,"title":"combine multiple rows int one row with many to many","body":"<p>Using SQL Server I have the following tables/ data</p>\n\n<p><strong>CUS_VISIT</strong></p>\n\n<pre><code>Cus_ID    Cus_Vis_ID\n1           01\n1           02\n2           01\n</code></pre>\n\n<p>and</p>\n\n<p><strong>CUS_EVENT</strong></p>\n\n<pre><code>Cus_Event_ID    Cus_ID    Cus_Vis_ID\n001               1            01\n002               1            01\n</code></pre>\n\n<p>and</p>\n\n<p><strong>CUS_XREF</strong></p>\n\n<pre><code>Cus_ID    Cus_Event_ID    Cus_Prt_ID    Cus_Seq_No\n1            001               1           1\n1            001               2           1\n</code></pre>\n\n<p>and</p>\n\n<p><strong>CUS_PRT</strong></p>\n\n<pre><code>Cus_ID    Cus_Prt_ID    Prt_Cd\n1            1            1A\n1            2            2A\n</code></pre>\n\n<p>I have tried numerous queries but didn't include them as i thought it would confuse things... most of them have used the xml path functionality but to no avail (i haven't been trying pivot since there is a massive list of codes).</p>\n\n<p>I am trying to get the following</p>\n\n<pre><code>SQL RESULTS\n\nCus_ID     Prt_Cd     Cus_Vis_ID\n1           1A,2A        1\n</code></pre>\n\n<p>what I end up with is</p>\n\n<pre><code>SQL RESULTS\n\nCus_ID     Prt_Cd     Cus_Vis_ID\n1           1A           1\n1           2A           1\n</code></pre>\n\n<p>The tables are linked by ...</p>\n\n<pre><code>CUS_VISIT.Cus_ID    = CUS_EVENT.Cus_ID \nCUS_VISIT.Cus_Vis_ID  = CUS_EVENT.Cus_Vis_ID\nCUS_VISIT.Cus_ID = CUS_XREF.Cus_ID\nCUS_EVENT.Cus_Event_ID = CUS_XREF.Cus_Event_ID    \nCUS_XREF.Cus_Prt_ID = CUS_PRT.Cus_Prt_ID \nCUS_XREF.Cus_ID = CUS_PRT.Cus_ID \n</code></pre>\n\n<p>I can almost get what I am after if I drop the <code>CUS_XREF.Cus_Prt_ID = CUS_PRT.Cus_Prt_ID</code> \njoin but then I get all of the part codes (<code>Prt_Cd</code>) for the customer not just the ones for that visit. </p>\n\n<p>If it would help to see my unsuccessful queries or if I have left anything out sorry just let me know. Thanks for any help.</p>\n\n<p>--</p>\n\n<p>here is my subquery</p>\n\n<pre><code>stuff((\n                  select ',' + B.prt_cd\n                    from CUS_PRT B \n                    WHERE B.prt_cd = XREF.prt_cd  -- this is killing me\n                    and XREF.cus_id=B.cus_id and \n                    -- some extra criteria i need but didn't think involved in my issue\n                    B.prt_typ='1'  \n                    and B.valid_entry='Y' and B.cur_entry_ind='Y'\n                    for xml path('')),1,1,'')\n</code></pre>\n\n<p>here is my latest attempt. I added a new post because I didn't realize an edit would move it to the top of the list again... I think i need another subquery somewhere but not sure where and how to tie it to the other two queries.</p>\n\n<pre><code>select distinct CUS_EVENT.cus_id, CUS_EVENT.cus_visit_id,\n    (Select CUS_PRT.prt_cd + ',' AS [text()]\n    From CUS_PRT, CUS_XREF\n    where \n    CUS_EVENT.cus_id=XREF.cus_id\n    and CUS_EVENT.cus_event_id = XREF.cus_event_id \n    and CUS_XREF.cus_id=CUS_PRT.cus_id \n    and CUS_XREF.cus_prt_id = CUS_PRT.cus_prt_id \n    and CUS_XREF.prt_seq_no ='1'\n    order by CUS_PRT.prt_cd\n    for XML PATH('')) [Codes]\nfrom CUS_EVENT\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":27,"score":-1,"question_id":13261497,"title":"incorrect syntax near in creating stored procedure on a remote db","body":"<p>I am trying to recreate a stored procedure on a database which is hosted on a remote server.\nWhen creating the same SP locally I don't get any errors but when I am trying to create the SP on the remote server I am getting this errors:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Procedure MySP, Line 26\nIncorrect syntax near 'MERGE'.\nMsg 102, Level 15, State 1, Procedure MySP, Line 27\nIncorrect syntax near 'S'.\n</code></pre>\n\n<p>Those errors are repeating in multiple SP and I didn't get them when I created the SP's on my local server.\nAny idea what can that be?\nHere is a sample SP:</p>\n\n<pre><code>USE [MyDatabase]\nGO\n/****** Object:  StoredProcedure [dbo].[InsertContractorInfo]    Script Date: 11/07/2012 01:08:31 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n-- =============================================\n-- Author:      &lt;Author,,Name&gt;\n-- Create date: &lt;Create Date,,&gt;\n-- Description: &lt;Description,,&gt;\n-- =============================================\n--exec [dbo].[InsertContractorInfo] \nCREATE PROCEDURE [dbo].[InsertContractorInfo]\n(@CompanyName nvarchar(50), \n @LicenseNumber nvarchar(50),\n @MailingAddress1 nvarchar(200),\n @MailingAddress2 nvarchar(200),\n @Phone nvarchar(10),\n @Fax nvarchar(10),\n @Mobile nvarchar(10),\n @Email nvarchar(200),\n @PercentCommercial int,\n @PercentResidental int,\n @TotalEmployees int,\n @AnnualSales decimal(18,2),\n @InsuranceCompanyContact nvarchar(100)=null,\n @InsuranceCompanyContactEmail nvarchar(100)=null,\n @InsuranceCompanyContactPhone nvarchar(100)=null,\n @ContractorID uniqueidentifier)\nAS\nBEGIN\nMERGE dbo.Contractor con\nUSING(SELECT 1 S) S\nON con.Oid = @ContractorID\nWHEN MATCHED THEN UPDATE \n   SET       \n      [CompanyName] = @CompanyName      \n      ,[LicenseNumber] = @LicenseNumber\n      ,[MailingAddress1] = @MailingAddress1\n      ,[MailingAddress2] = @MailingAddress2\n      ,[Phone] = @Phone\n      ,[Fax] = @Fax\n      ,[EMail] =@Email\n      ,[Mobile] =@Mobile      \n      ,[PercentCommercial] = @PercentCommercial\n      ,[PercentResidental] = @PercentResidental\n      ,[TotalEmployees] = @TotalEmployees\n      ,[ApproximateAnnualSales] = @AnnualSales      \n      ,[InsuranceCompanyContact] = @InsuranceCompanyContact\n      ,[InsuranceCompanyContactPhone] = @InsuranceCompanyContactPhone\n      ,[InsuranceCompanyContactEmail] = @InsuranceCompanyContactEmail      \nWHEN NOT MATCHED THEN\nINSERT \n           ([Oid]       \n           ,[CompanyName]           \n           ,[LicenseNumber]\n           ,[MailingAddress1]\n           ,[MailingAddress2]\n           ,[Phone]\n           ,[Fax]\n           ,[EMail]\n           ,[Mobile]                      \n           ,[PercentCommercial]\n           ,[PercentResidental]\n           ,[TotalEmployees]\n           ,[ApproximateAnnualSales]                      \n           ,[InsuranceCompanyContact]\n           ,[InsuranceCompanyContactPhone]\n           ,[InsuranceCompanyContactEmail])\n     VALUES\n           (@ContractorId           \n           ,@CompanyName           \n           ,@LicenseNumber\n           ,@MailingAddress1\n           ,@MailingAddress2\n           ,@Phone\n           ,@Fax\n           ,@EMail\n           ,@Mobile\n           ,@PercentCommercial\n           ,@PercentResidental\n           ,@TotalEmployees\n           ,@AnnualSales                     \n           ,@InsuranceCompanyContact\n           ,@InsuranceCompanyContactPhone\n           ,@InsuranceCompanyContactEmail\n           );\nEND\nGO\n</code></pre>\n\n<p>Thanks, Laziale</p>\n"},{"tags":["c#","sql-server","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13259655,"title":"Data integrity in Entity Framework","body":"<p>Are there any consensus as to what is considered the best method in always maintaining data integrity in Entity Framework. i.e. when adding or deleting entities, how do I make sure the loaded model is the most recent, and that nothing has changed on the db behind my back?</p>\n\n<p>A rough method that seem to work for me in the majority of cases, is to reload the context between sessions, i.e. not to have a persistent model, and reload/refresh in case of an error. This seems to work in cases of low data clashes, however is very costly when lots of changes happen in different services. Is there a flag to query if the data/row on disk have changed or event to make this refresh automatic, i.e. update any subscribers of certain tables/rows?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":7,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":5382,"score":9,"question_id":2384786,"title":"Delete SQL Server 2005 records without logging","body":"<p>How to delete records from SQL Server 2005 tables without logging them into transaction logs. </p>\n\n<p>I do not wish to log because once deleted, those records will never be needed again. </p>\n\n<p>Currently the various deletes take too much of time. Are there any other options to improve performance of delete statements? I can not use truncate since there is a where clause needed.</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13244767,"title":"unable to read a particular cell from excel using reader","body":"<p>I am importing excel into sql server db the excel sheet has three columns :   </p>\n\n<blockquote>\n  <p>id(number only)|data|passport  </p>\n</blockquote>\n\n<p>before importing it i want to check for certain things such as:<br>\n\n<li>the passport should begin a letter and rest of the characters must be numbers </li>\n<li>id must be numeric only </li></p>\n\n<p>I am able to check for passport but i am not able to check id even though i am using same code i used for checking passport. </p>\n\n<pre><code>             using (DbDataReader dr = command.ExecuteReader())\n        {\n            // SQL Server Connection String\n            string sqlConnectionString = \"Data Source=DITSEC3;Initial Catalog=test;Integrated Security=True\";\n\n            con.Open();\n            DataTable dt7 = new DataTable();\n            dt7.Load(dr);\n            DataRow[] ExcelRows = new DataRow[dt7.Rows.Count];\n            DataColumn[] ExcelColumn = new DataColumn[dt7.Columns.Count];\n\n            //=================================================\n            for (int i1 = 0; i1 &lt; dt7.Rows.Count; i1++)\n            {\n\n                if (dt7.Rows[i1][\"passport\"] == null)\n                {\n                    dt7.Rows[i1][\"passport\"] = 0;\n\n                }\n                if (dt7.Rows[i1][\"id\"] == null)\n                {\n                    dt7.Rows[i1][\"id\"] = 0;\n                }\n\n                string a = Convert.ToString(dt7.Rows[i1][\"passport\"]);\n                string b = dt7.Rows[i1][\"id\"].ToString();\n\n                if (!string.IsNullOrEmpty(b))\n                {\n                    int idlen = b.Length;\n\n                    for (int j = 0; j &lt; idlen; j++)\n                    {\n                        if (Char.IsDigit(b[j]))\n                        {\n                            //action\n                        }\n                        if(!Char.IsDigit(b[j]))\n                        {\n                            flag = flag + 1;\n                            int errline = i1 + 2;\n                            Label12.Text = \"Error at line: \" + errline.ToString();\n                            //Label12.Visible = true;\n                        }\n                    }\n                    if (!String.IsNullOrEmpty(a))\n                    {\n                        int len = a.Length;\n\n                        for (int j = 1; j &lt; len; j++)\n                        {\n                            if (Char.IsLetter(a[0]) &amp;&amp; Char.IsDigit(a[j]) &amp;&amp; !Char.IsSymbol(a[j]))\n                            {\n                                //action\n                            }\n                            else\n                            {\n                                flag = flag + 1;\n                                int errline = i1 + 2;\n                                Label12.Text = \"Error at line: \" + errline.ToString();\n                                //Label12.Visible = true;\n                            }\n\n\n                    }\n                }\n\n\n\n\n                 }\n</code></pre>\n\n<p>For some strange reason when i use breakpoint i can see the values of id as long as id is numeric in excel the moment flow comes to cell which has id as 25h547 the value if b turn \"\" any reason for this? i can give you entire code if you require. </p>\n"},{"tags":["sql-server","tsql","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13243430,"title":"How to solve this variable pass into batch_date?","body":"<p>I want to pass in @batch date into batch_date...But it shows error...The error is </p>\n\n<blockquote>\n  <p>Column 'dbo.tnx_tid_InvCheck_Details.Batch_Date' is invalid in the\n  select list because it is not contained in either an aggregate\n  function or the GROUP BY clause.</p>\n</blockquote>\n\n<p>The <code>InvCheck_Details</code> table has <code>batch_date</code> for each and every <code>part_no</code>. I want to group the part_no so that I can count(tid) and sum(tid_bal) by part_no. What should i do in order to run this script? TQ...</p>\n\n<pre><code>DECLARE @batch_date datetime\nSET @batch_date = '2012-10-13 00:00:00.000'\n\n\n\nCREATE TABLE #inv_check\n(batch_date datetime,part_no varchar(25),Number_of_tid int,Updated_DT int, Tot_Tid_Bal int)\n\nINSERT INTO #inv_check\nSELECT batch_date,part_no,COUNT(tid)as Number_of_tid,0,sum(Tid_Bal)\nFROM dbo.tnx_tid_InvCheck_Details\nwhere batch_date = @batch_date\nGroup by part_no\norder by part_no\n\nUPDATE #inv_check \nSET Updated_DT = isnull(d.Updated_DT,0) \n--select i.part_no,i.Number_of_tid, isnull(d.Updated_DT,0)\nFROM #inv_check i\nLEFT OUTER JOIN \n    (SELECT part_no, COUNT(LastUpdate_DT)as Updated_DT,\n    sum(tid_bal) as Tid_bal_sum\n    FROM dbo.tnx_tid_InvCheck_Details\n    Where NOT LastUpdate_DT IS NULL\n    Group by part_no) d on i.part_no=d.part_no  \n\n\n\n    DECLARE @sql int\n    DECLARE @sql1 int\n\n\nSELECT @sql1 = count(part_no) \nFROM #inv_check\n\nSELECT @sql = count(part_no)\nFROM #inv_check\nWHERE number_of_tid= Updated_DT\n\nSELECT @sql AS Parts_Counted,@sql1 AS Full_Parts\n\nDrop table #inv_check\n</code></pre>\n"},{"tags":["c#","sql-server","vs2010-express"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":121,"score":0,"question_id":13213644,"title":"Windows Form Application and SQL Server","body":"<p><strong>UPDATE 2</strong></p>\n\n<p>I fixed the error by adding <code>System.Configuration</code> to the reference file.   I had already added it to my class with <code>using System.Configuration;</code><br>\nI found the answer here: <a href=\"http://stackoverflow.com/questions/1274852/the-name-configurationmanager-does-not-exist-in-the-current-context/1836938#comment18074599_1836938\">The name 'ConfigurationManager' does not exist in the current context</a></p>\n\n<p>Any further issues will be addressed in a new question.</p>\n\n<p><strong>Original(ish) Post</strong></p>\n\n<p>I have Microsoft SQL Server Management Studio. In the studio I created a database called <code>Logbook</code> that exists locally on my computer.   </p>\n\n<p>I have also created a user interface using a Windows forms application in VS C# Express. I would like to connect it to my logbook database in order to update, select, delete, and insert entries into the database through the UI.</p>\n\n<p>However, I cannot figure out how connect the two. I have played around with the \"Add new data source\" wizard to no avail. I also cannot find anything helpful in the MSDN or other tutorials online.   </p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I created a new database and project to work with until I figure out how to properly do this so I don't accidently break anything in my project.<br>\nThe Schema is:</p>\n\n<pre><code>Student(sid: int, fname: char(10), lname: char(10), age:int, major:char(10))\nCourse(cid:int, desc:char(50), dept:char(10))\nEnrolled(sid:int, cid:int, quarter:char(10), grade:char(10))\n</code></pre>\n\n<p>Here is the connection string generated by the \"Add Data Source\" wizard</p>\n\n<pre><code>&lt;add name=\"boathouseLogConnectionString\"\n        connectionString=\"Data Source=.\\SQLEXPRESS;AttachDbFilename=&amp;quot;C:\\Program Files\\Microsoft SQL Server\\MSSQL11.SQLEXPRESS\\MSSQL\\DATA\\boathouseLog.mdf&amp;quot;;Integrated Security=True;Connect Timeout=30;User Instance=True\"\n        providerName=\"System.Data.SqlClient\" /&gt;\n</code></pre>\n\n<p>I have successfully gotten my database into the project.  However, when I try running a stored procedure I get this error <code>Argument Exception was unhandled.  Format of the initialization string does not conform to specification starting at index 0.</code></p>\n\n<p>The error occurs on line 2.  </p>\n\n<pre><code>        DataTable dt = new DataTable();\n        SqlConnection sqlConn = new SqlConnection(selectedConnectionString);\n        SqlCommand myCommand = new SqlCommand(\"proc_getMember\", sqlConn);\n        myCommand.CommandType = CommandType.StoredProcedure;\n        SqlDataAdapter da = new SqlDataAdapter(myCommand); \n</code></pre>\n\n<p>the <code>selectedConnectionString</code> variable is set to <code>boathouseLogConnectionString</code></p>\n"},{"tags":["sql-server","tsql"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":544,"score":3,"question_id":1070741,"title":"MS SQL Stored Procedure Problem","body":"<p>I have a stored procedure that works fine on my local SQL Server (2005 or 2008 cant recall off hand) but fails when I try to create the procedure on the Production server (SQL 2000). \nAny help would be appreciated. TIA. </p>\n\n<p>The stored procedure declaration is this:</p>\n\n<pre><code>/****** Object:  StoredProcedure [dbo].[AssignPCSCheckNumbers]    Script Date: 06/29/2009 13:12:24 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE PROCEDURE [dbo].[AssignPCSCheckNumbers]          \n(          \n    @MonthEnd    DATETIME,          \n    @Seed        INT,          \n    @ManifestKey UNIQUEIDENTIFIER,          \n    @Threshold   DECIMAL(9,2)          \n)          \n\nAS          \n\nSET NOCOUNT ON          \n\nBEGIN          \n\n\n--Create a temporary table variable to store our data          \nDECLARE @MyTemp TABLE \n( \n     ProducerNumber VARCHAR(20), \n     LastCheckDate DATETIME, \n     Due DECIMAL(9,2) DEFAULT 0,\n     Returned DECIMAL(9,2) DEFAULT 0          \n)\n\n--Fill the table with a listing of producers from our PCSItems table and their ACH Status\nINSERT INTO @MyTemp ( ProducerNumber ) \nSELECT      PCSItems.ProducerNumber \nFROM        PCSItems\nLEFT JOIN   Producer\nON          PCSItems.ProducerNumber = Producer.prodNum\nWHERE       ISNULL(Producer.PayCommissionByACH,0) = 0\n\n--UPDATE the table with the last time a check was printed for each\n--of these producers\nUPDATE      @MyTemp\nSET         LastCheckDate = (\nSELECT      ISNULL(MAX(EntryDate),'1/1/1901') \nFROM        CommissionLedger WITH (NOLOCK)\nWHERE       CommissionLedger.TransactionType = 1\nAND         CommissionLedger.ProducerNumber = [@MyTemp].ProducerNumber\n)\n\n\n--update the table with the amount of comission owed to each producer          \nUPDATE      @MyTemp           \nSET         Due = (\nSELECT      IsNull(SUM(CommPaid),0)          \nFROM        ProducerComm WITH (NOLOCK)          \nWHERE       ProducerComm.CommApplies = [@MyTemp].ProducerNumber\nAND         ProducerComm.EntryDate &gt;= LastCheckDate\nAND         ProducerComm.EntryDate &lt;= @MonthEnd\n)          \n\n--update the table with the amount of commission returned by each producer                             \nUPDATE      @MyTemp          \nSET         Returned = (\nSELECT      ISNULL(SUM(Amount), 0)\nFROM        CommissionLedger WITH (NOLOCK)          \nWHERE       CommissionLedger.ProducerNumber = [@MyTemp].ProducerNumber          \nAND         CommissionLedger.EntryDate  &gt;= [@MyTemp].LastCheckDate          \nAND         CommissionLedger.EntryDate  &lt;= @MonthEnd\n)\n\n--create a table to assist with our operations          \nDECLARE @MyFinal TABLE \n(\n    ID INT IDENTITY(1,1),           \n    ProducerNumber VARCHAR(10)          \n)\n\n--just insert the producers that are owed an amount over a user specified           \n--threshold          \nINSERT INTO @MyFinal ( ProducerNumber )           \nSELECT      ProducerNumber          \nFROM        @MyTemp          \nWHERE       (Due + Returned) &gt; @Threshold           \n\n--update our items with the check numbers finally =)          \nUPDATE      PCSItems           \nSET         CheckNumber = (SELECT  (([@MyFinal].ID - 1) + @Seed)      \n                           FROM    @MyFinal          \n                           WHERE   [@MyFinal].ProducerNumber = PCSItems.ProducerNumber)          \n\nSET NOCOUNT OFF          \n\nEND\nGO\n</code></pre>\n\n<p>And the error the server responds with is this:</p>\n\n<pre><code>Msg 107, Level 16, State 2, Procedure AssignPCSCheckNumbers, Line 35\nThe column prefix '@MyTemp' does not match with a table name or alias name used in the query.\nMsg 107, Level 16, State 2, Procedure AssignPCSCheckNumbers, Line 45\nThe column prefix '@MyTemp' does not match with a table name or alias name used in the query.\nMsg 107, Level 16, State 2, Procedure AssignPCSCheckNumbers, Line 55\nThe column prefix '@MyTemp' does not match with a table name or alias name used in the query.\nMsg 107, Level 16, State 2, Procedure AssignPCSCheckNumbers, Line 55\nThe column prefix '@MyTemp' does not match with a table name or alias name used in the query.\nMsg 107, Level 16, State 2, Procedure AssignPCSCheckNumbers, Line 79\nThe column prefix '@MyFinal' does not match with a table name or alias name used in the query.\nMsg 107, Level 16, State 2, Procedure AssignPCSCheckNumbers, Line 79\nThe column prefix '@MyFinal' does not match with a table name or alias name used in the query.\n</code></pre>\n"},{"tags":["sql-server","common-table-expression","table-variable"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13186684,"title":"Common Table Expressions slow when using a table variable","body":"<p>I have been experimenting with the following (simplified) CTE. When using a table variable () the query runs for minutes before I cancel it. Any of the other commented out methods return in less than a second. </p>\n\n<p>If I replace the whole WHERE clause with an INNER JOIN it is fast as well. </p>\n\n<p>Any ideas why using a table variable would run so slowly?</p>\n\n<p>FWIW: The database contains 2.5 million records and the inner query returns 2 records. </p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE TABLE #rootTempTable (RootID int PRIMARY KEY)\nINSERT INTO #rootTempTable VALUES (1360);\n\nDECLARE @rootTableVar TABLE (RootID int PRIMARY KEY);\nINSERT INTO @rootTableVar VALUES (1360);\n\nWITH My_CTE AS \n(\n      SELECT ROW_NUMBER() OVER(ORDER BY d.DocumentID) rownum, d.DocumentID, d.Title\n      FROM [Document] d\n      WHERE d.LocationID IN \n        (\n              SELECT LocationID \n              FROM Location \n                    JOIN @rootTableVar rtv ON Location.RootID = rtv.RootID -- VERY SLOW!\n                    --JOIN #rootTempTable tt ON Location.RootID = tt.RootID -- Fast\n                    --JOIN (SELECT 1360 as RootID) AS rt ON Location.RootID = rt.RootID -- Fast\n                    --WHERE RootID = 1360 -- Fast\n        )           \n) \nSELECT * FROM My_CTE WHERE (rownum &gt; 0) AND (rownum &lt;= 100) ORDER BY rownum\n</code></pre>\n\n<p>This is from when using the table variable. The query took over 17 minutes to run:\n<img src=\"http://i.stack.imgur.com/ZJXzP.png\" alt=\"enter image description here\"></p>\n\n<p><strong>Execution plans in XML format</strong></p>\n\n<p>Temp table: <a href=\"https://docs.google.com/open?id=0B66I-fxlyEtEZEthV3ZaWlNLWXM\" rel=\"nofollow\">https://docs.google.com/open?id=0B66I-fxlyEtEZEthV3ZaWlNLWXM</a></p>\n\n<p>Table variable: <a href=\"https://docs.google.com/open?id=0B66I-fxlyEtEbUFZa3RJejFCTkk\" rel=\"nofollow\">https://docs.google.com/open?id=0B66I-fxlyEtEbUFZa3RJejFCTkk</a></p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures","dynamic-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13259850,"title":"Dynamic SQL and stored procedure optimization","body":"<p>I've read that using Dynamic SQL in a stored procedure can hurt performance of your stored procedures. I guess the theory is that the store procedure won't store an execution plan for SQL executed via EXEC or sp_executesql.</p>\n\n<p>I want to know if this is true. If it is true, do I have the same problem with multiple nested IF blocks, each one with a different \"version\" of my SQL statement?</p>\n"},{"tags":["c#","sql-server","tsql","clr","jit"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":3,"view_count":68,"score":-2,"question_id":13260889,"title":"Why does T-SQL run so slowly?","body":"<p>At work, we've got a program with MS SQL Server database backend.  There are a handful of places where we use CLR UDFs, not to provide new functionality, but for performance reasons.  They are doing things that we could do just as well in T-SQL, but an order of magnitude or two faster.  And that just makes me wonder.</p>\n\n<p>Why is it that expressing the exact same concept in one language that runs off a parser built by Microsoft (C#) executes so much more quickly than expressing it in another language that runs off a parser built by Microsoft (T-SQL)?  If anything, I would expect the CLR UDFs to be <em>slower</em>, because the native SQL data being worked on has to be marshaled into the CLR functions and back, which ought to introduce some overhead.</p>\n\n<p>Is there any particular reason why MS SQL Server queries are (apparently) not JITed and executed as quickly as possible?  And I could understand the overhead of JIT compilation possibly being an issue for external queries, but we see the same thing even in stored procedures, where compilation would definitely make sense.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":1523,"score":2,"question_id":2561130,"title":"Merge overlapping date intervals","body":"<p>Is there a better way of merging overlapping date intervals?<br>\nThe solution I came up with is so simple that now I wonder if someone else has a better idea of how this could be done.</p>\n\n<pre><code>/***** DATA EXAMPLE *****/\nDECLARE @T TABLE (d1 DATETIME, d2 DATETIME)\nINSERT INTO @T (d1, d2)\n        SELECT '2010-01-01','2010-03-31' UNION SELECT '2010-04-01','2010-05-31' \n  UNION SELECT '2010-06-15','2010-06-25' UNION SELECT '2010-06-26','2010-07-10' \n  UNION SELECT '2010-08-01','2010-08-05' UNION SELECT '2010-08-01','2010-08-09' \n  UNION SELECT '2010-08-02','2010-08-07' UNION SELECT '2010-08-08','2010-08-08' \n  UNION SELECT '2010-08-09','2010-08-12' UNION SELECT '2010-07-04','2010-08-16' \n  UNION SELECT '2010-11-01','2010-12-31' UNION SELECT '2010-03-01','2010-06-13' \n\n/***** INTERVAL ANALYSIS *****/\nWHILE (1=1)  BEGIN\n  UPDATE t1 SET t1.d2 = t2.d2\n  FROM @T AS t1 INNER JOIN @T AS t2 ON \n            DATEADD(day, 1, t1.d2) BETWEEN t2.d1 AND t2.d2 \n  IF @@ROWCOUNT = 0 BREAK\nEND\n\n/***** RESULT *****/\nSELECT StartDate = MIN(d1) , EndDate = d2\nFROM @T\nGROUP BY d2\nORDER BY StartDate, EndDate\n\n/***** OUTPUT *****/\n/*****\nStartDate   EndDate\n2010-01-01  2010-06-13 \n2010-06-15  2010-08-16 \n2010-11-01  2010-12-31 \n*****/\n</code></pre>\n"},{"tags":["sql-server","reporting-services","parameters","ssrs-2008","ssrs-reports"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":3391,"score":4,"question_id":5252588,"title":"SSRS 2008: error message saying my parameter doesn't exist but it clearly does?","body":"<p>I have a report that has about 10 parameters and about 10 datasets and one datasource.  I typed alot but I really need help so I figured I would try and provide as much info about the problem as I could right from the start.      </p>\n\n<p>Let's simplify it all and pretend these are the relevant names of everything and that the report gets basic employee information:</p>\n\n<ul>\n<li>Parameters\n<ul>\n<li>facilityID: text in the format of a guid or uniqueidentifier, this is hidden and passed in so that the end user of the report can only view info for their own facility;  Single valued parameter, not blank not null, hidden, text</li>\n<li>startDate: start date range, let's say I want my report to include data starting Jan 1 this year; Single valued parameter, not blank not null, visible, datetime</li>\n<li>endDate:  end of the date range, let's say it's today/now; Single valued parameter, not blank not null, visible, datetime</li>\n<li><strong>viewOption</strong>:  three hard-coded values (label, value) (\"Current Employees\",1) and (\"Past Employees\",2) and (\"Employees that moved facilities\",3); Multi-valued Parameter (so select all is an option), not blank, not null, visible, text</li>\n<li>personID: based on the dataset getListOfNames where the label is the employee name and the value is their personID (guid/uniqueidentifier); Single select, not null, not blank, text and visible<br></li>\n</ul></li>\n<li>My Data Sets \n<ul>\n<li>getListOfNames:  this gets a list of people that were at the company in the provided date range at the given facility and where their employee status is in the viewOption parameter value (so it can be just one number or up to three).  This is a stored procedure but I have set up it to handle the multi-valued parameter by passing it join(parameter, \"~\") and then separating it out in the stored proc.  This works on 5 other reports.  </li>\n<li>getReportInfoOnSelectedPerson: main body query; after the user selects the employee they want data on, this takes that personID and the date range and fills the main table. </li>\n</ul></li>\n</ul>\n\n<p>The problem:<br>\nSSRS says viewOption doesn't exist.  But I see it, right there, in the Parameters folder on the left hand side.  I see it when I go to enter an expression under Parameters.  There is no squiggly red line under Parameters!viewOption.value.  But, when I try and put it as a value for a parameter used by the getListOfNames dataset, it errors.  If I put it in the getReportInfoOnSelectedPerson dataset and use it in the exact same way, SSRS is okay with that.  Wtf?  So... I have checked the rdl and everything is fine (where the actual parameter is declared, where it is used in the dataset reference, everything).  It's just this one dataset.  And I have a similar report that uses the same data set, same basic parameters and that report is fine.  I try setting the value of the dataset parameter to 1 or something and that is fine but when I try and set it to Parameter!viewOption.value it errors..... Now, above I said i normally pass the stored proc a Join on the paramater with a tilde ~ but I am trying to keep it simple and either get it to just work in general (either by passing it the first value of the multivalue viewOption parameter or turning that parameter into a single select and just passing the .value) but the join doesnt work either.  All of those things work for the other dataset, which is also a stored proc.  </p>\n\n<p><strong>This is my error:<br>\nAn error has occurred during report processing. (rsProcessingAborted)  The Value expression for the query parameter @viewOption contains an error: The expression referenced a non-existing parameter in the report parameters collection. (rsRuntimeErrorInExpression)</strong></p>\n\n<p>Which is clearly saying my parameter doesn't exist but I can SEE it... everywhere.  And  if I assign one of the other datasets' parameter values to the viewOption parameter it works without an error.  I've checked the rdl.</p>\n\n<p>I've had this problem before and it was fixed by deleting both the parameter and dataset and creating them again (for safety I renamed both of them).  That didn't work this time.</p>\n\n<p>I am so frustrated.  Please help....   </p>\n\n<p>Code? </p>\n\n<pre><code>      &lt;DataSet Name=\"getListOfNames\"&gt;\n      &lt;Fields&gt;\n          &lt;Field Name=\"personID\"&gt;\n              &lt;DataField&gt;PersonId&lt;/DataField&gt;\n              &lt;rd:TypeName&gt;System.Guid&lt;/rd:TypeName&gt;\n          &lt;/Field&gt;\n          &lt;Field Name=\"name\"&gt;\n              &lt;DataField&gt;name&lt;/DataField&gt;\n              &lt;rd:TypeName&gt;System.String&lt;/rd:TypeName&gt;\n          &lt;/Field&gt;\n      &lt;/Fields&gt;\n      &lt;Query&gt;\n          &lt;DataSourceName&gt;myDataSource&lt;/DataSourceName&gt;\n          &lt;CommandType&gt;StoredProcedure&lt;/CommandType&gt;\n          &lt;CommandText&gt;getListOfNames&lt;/CommandText&gt;\n          &lt;QueryParameters&gt;\n              &lt;QueryParameter Name=\"@fac\"&gt;\n                  &lt;Value&gt;=join(Parameters!fac.Value,\"~\")&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n              &lt;QueryParameter Name=\"@bldg\"&gt;\n                  &lt;Value&gt;=join(Parameters!bldg.Value,\"~\")&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n              &lt;QueryParameter Name=\"@unit\"&gt;\n                  &lt;Value&gt;=join(Parameters!unit.Value,\"~\")&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n              &lt;QueryParameter Name=\"@station\"&gt;\n                  &lt;Value&gt;=join(Parameters!station.Value,\"~\")&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n              &lt;QueryParameter Name=\"@startDate\"&gt;\n                  &lt;Value&gt;=Parameters!startDate.Value&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n              &lt;QueryParameter Name=\"@endDate\"&gt;\n                  &lt;Value&gt;=Parameters!endDate.Value&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n              &lt;QueryParameter Name=\"@viewOption\"&gt;\n                  &lt;Value&gt;=Join(Parameters!viewOption.Value, \"~\")&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n          &lt;/QueryParameters&gt;\n          &lt;rd:UseGenericDesigner&gt;true&lt;/rd:UseGenericDesigner&gt;\n      &lt;/Query&gt;\n  &lt;/DataSet&gt;\n\n\n\n&lt;ReportParameter Name=\"viewOption\"&gt;\n  &lt;DataType&gt;String&lt;/DataType&gt;\n  &lt;DefaultValue&gt;\n    &lt;Values&gt;\n      &lt;Value&gt;1&lt;/Value&gt;\n    &lt;/Values&gt;\n  &lt;/DefaultValue&gt;\n  &lt;Prompt&gt;View&lt;/Prompt&gt;\n  &lt;ValidValues&gt;\n    &lt;DataSetReference&gt;\n      &lt;DataSetName&gt;viewOptionQuery&lt;/DataSetName&gt;\n      &lt;ValueField&gt;value&lt;/ValueField&gt;\n      &lt;LabelField&gt;label&lt;/LabelField&gt;\n    &lt;/DataSetReference&gt;\n  &lt;/ValidValues&gt;\n  &lt;MultiValue&gt;true&lt;/MultiValue&gt;\n&lt;/ReportParameter&gt;\n\n\n\n&lt;DataSet Name=\"viewOptionQuery\"&gt;\n  &lt;Fields&gt;\n    &lt;Field Name=\"label\"&gt;\n      &lt;DataField&gt;label&lt;/DataField&gt;\n      &lt;rd:TypeName&gt;System.String&lt;/rd:TypeName&gt;\n    &lt;/Field&gt;\n    &lt;Field Name=\"value\"&gt;\n      &lt;DataField&gt;value&lt;/DataField&gt;\n      &lt;rd:TypeName&gt;System.Int32&lt;/rd:TypeName&gt;\n    &lt;/Field&gt;\n  &lt;/Fields&gt;\n  &lt;Query&gt;\n    &lt;DataSourceName&gt;flamingo&lt;/DataSourceName&gt;\n    &lt;CommandText&gt;select 'Other Facility' as label, 3 as value union select 'Past' as label, 2 as value union select 'Current' as label, 1 as value order by value&lt;/CommandText&gt;\n    &lt;rd:UseGenericDesigner&gt;true&lt;/rd:UseGenericDesigner&gt;\n  &lt;/Query&gt;\n&lt;/DataSet&gt;\n</code></pre>\n\n<p>This is how it is set up and getListOfNames is why the error is throw, if I change</p>\n\n<pre><code>              &lt;QueryParameter Name=\"@viewOption\"&gt;\n                  &lt;Value&gt;=Join(Parameters!viewOption.Value, \"~\")&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n</code></pre>\n\n<p>to</p>\n\n<pre><code>              &lt;QueryParameter Name=\"@viewOption\"&gt;\n                  &lt;Value&gt;=\"1~2\"&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n</code></pre>\n\n<p>then it works.... or the value can be just 1 or 1~2~3</p>\n\n<p>However... when I try and put join(Parameters!viewOption.value,\"~\") as the value for another dataset's query parameter it works and there is no error.  </p>\n\n<pre><code>  &lt;DataSet Name=\"getReportInfoOnSelectedPerson\"&gt;\n  &lt;Fields&gt;\n    &lt;Field Name=\"name\"&gt;\n      &lt;DataField&gt;name&lt;/DataField&gt;\n      &lt;rd:TypeName&gt;System.String&lt;/rd:TypeName&gt;\n    &lt;/Field&gt; \n    &lt;Field Name=\"Building\"&gt;\n      &lt;DataField&gt;Building&lt;/DataField&gt;\n      &lt;rd:TypeName&gt;System.String&lt;/rd:TypeName&gt;\n    &lt;/Field&gt;\n    &lt;Field Name=\"Unit\"&gt;\n      &lt;DataField&gt;Unit&lt;/DataField&gt;\n      &lt;rd:TypeName&gt;System.String&lt;/rd:TypeName&gt;\n    &lt;/Field&gt;\n    &lt;Field Name=\"desc\"&gt;\n      &lt;DataField&gt;desc&lt;/DataField&gt;\n      &lt;rd:TypeName&gt;System.String&lt;/rd:TypeName&gt;\n    &lt;/Field&gt; \n  &lt;/Fields&gt;\n  &lt;Query&gt;\n    &lt;DataSourceName&gt;myDataSource&lt;/DataSourceName&gt;\n    &lt;CommandType&gt;StoredProcedure&lt;/CommandType&gt;\n    &lt;CommandText&gt;Reports_BasicInfo&lt;/CommandText&gt;\n    &lt;QueryParameters&gt;\n      &lt;QueryParameter Name=\"@personID\"&gt;\n        &lt;Value&gt;=Parameters!personID.Value&lt;/Value&gt;\n      &lt;/QueryParameter&gt;\n      &lt;QueryParameter Name=\"@numberINeedToAggregateData\"&gt;\n        &lt;Value&gt;=Join(Parameters!viewOption.Value,\"~\")&lt;/Value&gt;\n        &lt;rd:UserDefined&gt;true&lt;/rd:UserDefined&gt;\n      &lt;/QueryParameter&gt;\n    &lt;/QueryParameters&gt;\n    &lt;rd:UseGenericDesigner&gt;true&lt;/rd:UseGenericDesigner&gt;\n  &lt;/Query&gt;\n&lt;/DataSet&gt;\n</code></pre>\n\n<p>And I already said this, but the stored proc/dataset that throws the error uses a parameter with the same set up in about 5 other reports (I have tried copying and pasting the relevant code sections from working reports but I still get the error).  So, what's wrong with this one?</p>\n"},{"tags":["sql-server","asp.net-mvc","linq","entity-framework","sql-server-2008-r2"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":175,"score":1,"question_id":12928463,"title":"Sometimes get Timeout expired exception with Linq to EF and after a restart of server, it works fine","body":"<p>I have hosted my website at rackspace cloud server.</p>\n\n<p>Sometimes I get the below exception while fetching records from database. The strange thing is that everything works fine for a few days after a restart and also I get this exception in only a few places and not everywhere.</p>\n\n<pre><code>Exception: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.\n\nException Details: System.Data.SqlClient.SqlException: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.\n\nStack Trace:\n\n\n[SqlException (0x80131904): Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.]\n   System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection) +404\n   System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning() +412\n   System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj) +1363\n   System.Data.SqlClient.SqlDataReader.ConsumeMetaData() +59\n   System.Data.SqlClient.SqlDataReader.get_MetaData() +118\n   System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString) +6387937\n   System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async) +6389506\n   System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result) +538\n   System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method) +28\n   System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method) +256\n   System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior) +19\n   System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand entityCommand, CommandBehavior behavior) +553\n\n[EntityCommandExecutionException: An error occurred while executing the command definition. See the inner exception for details.]\n   DataAccessLayer.dbCustomer.CompanyCustomerByLocationId(String sortExpression, Boolean asc, String nameSearchString, Int32 startRowIndex, Int32 maximumRows, Int32&amp; TotalRecord, Int64 companyId) in D:\\Dotnet Projects\\FutureZoom\\FutureZoom\\DataAccessLayer\\dbCustomer.cs:508\n   BusinessLogic.Customer.CompanyCustomerByLocationId(String sortExpression, Boolean asc, String nameSearchString, Int32 startRowIndex, Int32 maximumRows, Int64 CompanyId) in D:\\Dotnet Projects\\FutureZoom\\FutureZoom\\BusinessLogic\\Customer.cs:431\n   FutureZoom.Areas.Admin.Controllers.CompanyController.CustomerPaging(Int32 StartIndex, Int32 PageSize, String SortExp, Boolean Asc, String SearchExp, String Where) in D:\\Dotnet Projects\\FutureZoom\\FutureZoom\\FutureZoom\\Areas\\Admin\\Controllers\\CompanyController.cs:552\n   lambda_method(Closure , ControllerBase , Object[] ) +362\n   System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext controllerContext, IDictionary`2 parameters) +248\n   System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext controllerContext, ActionDescriptor actionDescriptor, IDictionary`2 parameters) +39\n   System.Web.Mvc.&lt;&gt;c__DisplayClass15.&lt;InvokeActionMethodWithFilters&gt;b__12() +125\n   System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodFilter(IActionFilter filter, ActionExecutingContext preContext, Func`1 continuation) +640\n   System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodWithFilters(ControllerContext controllerContext, IList`1 filters, ActionDescriptor actionDescriptor, IDictionary`2 parameters) +312\n   System.Web.Mvc.ControllerActionInvoker.InvokeAction(ControllerContext controllerContext, String actionName) +691\n   System.Web.Mvc.Controller.ExecuteCore() +162\n   System.Web.Mvc.ControllerBase.Execute(RequestContext requestContext) +305\n   System.Web.Mvc.&lt;&gt;c__DisplayClassb.&lt;BeginProcessRequest&gt;b__5() +62\n   System.Web.Mvc.Async.&lt;&gt;c__DisplayClass1.&lt;MakeVoidDelegate&gt;b__0() +20\n   System.Web.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +469\n   System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously) +375\n</code></pre>\n\n<p>My Linq query is mentioned below</p>\n\n<pre><code>query = context.Customers.Include(\"Company\").Include(\"Company.EmailCampaignerStatus\")\n                                           .OrderBy(m =&gt; m.EmailCampaignerStatus.FirstOrDefault().CreatedOn)                                           \n                                           .Where(m =&gt; m.FirstName.StartsWith(name) || m.LastName.StartsWith(name) || m.Email.StartsWith(name) || (m.FirstName + \" \" + m.LastName).StartsWith(name))\n                                           .Where(m =&gt; m.CompanyId == companyId)\n                                           .Where(m =&gt; m.CompanyLocationId == locationId)\n                                           .Skip(startRowIndex == 0 ? startRowIndex : startRowIndex - 1)\n                                           .Take(maximumRows)\n                                           .ToList();\n</code></pre>\n\n<p>Execution time for this query is not even 1 second on my local machine and also the same at server side after a restart but the execution time increases day by day and it fails to execute after few days (sometime fails and sometimes gives result).</p>\n\n<p>I observed that it took 31.05sec and fails and it take 51.09 sec and fails. Sometimes it takes more than 2 mins and gives result.</p>\n\n<p>I talked with rackspace people but they were unable to trace the actual cause for the same.</p>\n\n<p>Edit 1: I have seen below queries in SQL Profiler against my paging query</p>\n\n<pre><code>SELECT \n[Project3].[Id1] AS [Id], \n[Project3].[C1] AS [C1], \n[Project3].[Id] AS [Id1], \n[Project3].[CompanyId] AS [CompanyId], \n[Project3].[CompanyLocationId] AS [CompanyLocationId], \n[Project3].[FirstName] AS [FirstName], \n[Project3].[LastName] AS [LastName], \n[Project3].[Email] AS [Email], \n[Project3].[Address1] AS [Address1], \n[Project3].[Address2] AS [Address2], \n[Project3].[City] AS [City], \n[Project3].[State] AS [State], \n[Project3].[Country] AS [Country], \n[Project3].[Zip] AS [Zip], \n[Project3].[Phone] AS [Phone], \n[Project3].[SaleDate] AS [SaleDate], \n[Project3].[Notes] AS [Notes], \n[Project3].[Cost] AS [Cost], \n[Project3].[CreatedOn] AS [CreatedOn], \n[Project3].[ModifiedOn] AS [ModifiedOn], \n[Project3].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], \n[Project3].[Id2] AS [Id2], \n[Project3].[SubscriptionTypeId] AS [SubscriptionTypeId], \n[Project3].[PlanFeeAmount] AS [PlanFeeAmount], \n[Project3].[LoginId] AS [LoginId], \n[Project3].[IndustryTypeId] AS [IndustryTypeId], \n[Project3].[CompanyName] AS [CompanyName], \n[Project3].[NumberOfLocations] AS [NumberOfLocations], \n[Project3].[LogoImageName] AS [LogoImageName], \n[Project3].[WebsiteUrl] AS [WebsiteUrl], \n[Project3].[blsActive] AS [blsActive], \n[Project3].[Pending] AS [Pending], \n[Project3].[ExpiryDate] AS [ExpiryDate], \n[Project3].[C2] AS [C2], \n[Project3].[Id3] AS [Id3], \n[Project3].[UploadTicketId] AS [UploadTicketId], \n[Project3].[UploadStatus] AS [UploadStatus], \n[Project3].[CompanyId1] AS [CompanyId1], \n[Project3].[CompanyLocationId1] AS [CompanyLocationId1], \n[Project3].[CustomerId] AS [CustomerId], \n[Project3].[CreatedOn2] AS [CreatedOn1]\nFROM ( SELECT \n    [Limit2].[Id] AS [Id], \n    [Limit2].[CompanyId] AS [CompanyId], \n    [Limit2].[CompanyLocationId] AS [CompanyLocationId], \n    [Limit2].[FirstName] AS [FirstName], \n    [Limit2].[LastName] AS [LastName], \n    [Limit2].[Email] AS [Email], \n    [Limit2].[Address1] AS [Address1], \n    [Limit2].[Address2] AS [Address2], \n    [Limit2].[City] AS [City], \n    [Limit2].[State] AS [State], \n    [Limit2].[Country] AS [Country], \n    [Limit2].[Zip] AS [Zip], \n    [Limit2].[Phone] AS [Phone], \n    [Limit2].[SaleDate] AS [SaleDate], \n    [Limit2].[Notes] AS [Notes], \n    [Limit2].[Cost] AS [Cost], \n    [Limit2].[CreatedOn] AS [CreatedOn], \n    [Limit2].[ModifiedOn] AS [ModifiedOn], \n    [Limit2].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], \n    [Limit2].[Id1] AS [Id1], \n    [Limit2].[CreatedOn1] AS [CreatedOn1], \n    [Limit2].[Id2] AS [Id2], \n    [Limit2].[SubscriptionTypeId] AS [SubscriptionTypeId], \n    [Limit2].[PlanFeeAmount] AS [PlanFeeAmount], \n    [Limit2].[LoginId] AS [LoginId], \n    [Limit2].[IndustryTypeId] AS [IndustryTypeId], \n    [Limit2].[CompanyName] AS [CompanyName], \n    [Limit2].[NumberOfLocations] AS [NumberOfLocations], \n    [Limit2].[WebsiteUrl] AS [WebsiteUrl], \n    [Limit2].[blsActive] AS [blsActive], \n    [Limit2].[Pending] AS [Pending], \n    [Limit2].[ExpiryDate] AS [ExpiryDate], \n    [Limit2].[LogoImageName] AS [LogoImageName], \n    [Limit2].[C1] AS [C1], \n    [Extent4].[Id] AS [Id3], \n    [Extent4].[UploadTicketId] AS [UploadTicketId], \n    [Extent4].[UploadStatus] AS [UploadStatus], \n    [Extent4].[CompanyId] AS [CompanyId1], \n    [Extent4].[CompanyLocationId] AS [CompanyLocationId1], \n    [Extent4].[CustomerId] AS [CustomerId], \n    [Extent4].[CreatedOn] AS [CreatedOn2], \n    CASE WHEN ([Extent4].[Id] IS NULL) THEN CAST(NULL AS int) ELSE 1 END AS [C2]\n    FROM   (SELECT TOP (20) [Project2].[Id] AS [Id], [Project2].[CompanyId] AS [CompanyId], [Project2].[CompanyLocationId] AS [CompanyLocationId], [Project2].[FirstName] AS [FirstName], [Project2].[LastName] AS [LastName], [Project2].[Email] AS [Email], [Project2].[Address1] AS [Address1], [Project2].[Address2] AS [Address2], [Project2].[City] AS [City], [Project2].[State] AS [State], [Project2].[Country] AS [Country], [Project2].[Zip] AS [Zip], [Project2].[Phone] AS [Phone], [Project2].[SaleDate] AS [SaleDate], [Project2].[Notes] AS [Notes], [Project2].[Cost] AS [Cost], [Project2].[CreatedOn] AS [CreatedOn], [Project2].[ModifiedOn] AS [ModifiedOn], [Project2].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], [Project2].[Id1] AS [Id1], [Project2].[CreatedOn1] AS [CreatedOn1], [Project2].[Id2] AS [Id2], [Project2].[SubscriptionTypeId] AS [SubscriptionTypeId], [Project2].[PlanFeeAmount] AS [PlanFeeAmount], [Project2].[LoginId] AS [LoginId], [Project2].[IndustryTypeId] AS [IndustryTypeId], [Project2].[CompanyName] AS [CompanyName], [Project2].[NumberOfLocations] AS [NumberOfLocations], [Project2].[WebsiteUrl] AS [WebsiteUrl], [Project2].[blsActive] AS [blsActive], [Project2].[Pending] AS [Pending], [Project2].[ExpiryDate] AS [ExpiryDate], [Project2].[LogoImageName] AS [LogoImageName], [Project2].[C1] AS [C1]\n        FROM ( SELECT [Project2].[Id] AS [Id], [Project2].[CompanyId] AS [CompanyId], [Project2].[CompanyLocationId] AS [CompanyLocationId], [Project2].[FirstName] AS [FirstName], [Project2].[LastName] AS [LastName], [Project2].[Email] AS [Email], [Project2].[Address1] AS [Address1], [Project2].[Address2] AS [Address2], [Project2].[City] AS [City], [Project2].[State] AS [State], [Project2].[Country] AS [Country], [Project2].[Zip] AS [Zip], [Project2].[Phone] AS [Phone], [Project2].[SaleDate] AS [SaleDate], [Project2].[Notes] AS [Notes], [Project2].[Cost] AS [Cost], [Project2].[CreatedOn] AS [CreatedOn], [Project2].[ModifiedOn] AS [ModifiedOn], [Project2].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], [Project2].[Id1] AS [Id1], [Project2].[CreatedOn1] AS [CreatedOn1], [Project2].[Id2] AS [Id2], [Project2].[SubscriptionTypeId] AS [SubscriptionTypeId], [Project2].[PlanFeeAmount] AS [PlanFeeAmount], [Project2].[LoginId] AS [LoginId], [Project2].[IndustryTypeId] AS [IndustryTypeId], [Project2].[CompanyName] AS [CompanyName], [Project2].[NumberOfLocations] AS [NumberOfLocations], [Project2].[WebsiteUrl] AS [WebsiteUrl], [Project2].[blsActive] AS [blsActive], [Project2].[Pending] AS [Pending], [Project2].[ExpiryDate] AS [ExpiryDate], [Project2].[LogoImageName] AS [LogoImageName], [Project2].[C1] AS [C1], row_number() OVER (ORDER BY [Project2].[CreatedOn1] ASC) AS [row_number]\n            FROM ( SELECT \n                [Filter1].[Id] AS [Id], \n                [Filter1].[CompanyId] AS [CompanyId], \n                [Filter1].[CompanyLocationId] AS [CompanyLocationId], \n                [Filter1].[FirstName] AS [FirstName], \n                [Filter1].[LastName] AS [LastName], \n                [Filter1].[Email] AS [Email], \n                [Filter1].[Address1] AS [Address1], \n                [Filter1].[Address2] AS [Address2], \n                [Filter1].[City] AS [City], \n                [Filter1].[State] AS [State], \n                [Filter1].[Country] AS [Country], \n                [Filter1].[Zip] AS [Zip], \n                [Filter1].[Phone] AS [Phone], \n                [Filter1].[SaleDate] AS [SaleDate], \n                [Filter1].[Notes] AS [Notes], \n                [Filter1].[Cost] AS [Cost], \n                [Filter1].[CreatedOn] AS [CreatedOn], \n                [Filter1].[ModifiedOn] AS [ModifiedOn], \n                [Filter1].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], \n                [Limit1].[Id] AS [Id1], \n                [Limit1].[CreatedOn] AS [CreatedOn1], \n                [Extent3].[Id] AS [Id2], \n                [Extent3].[SubscriptionTypeId] AS [SubscriptionTypeId], \n                [Extent3].[PlanFeeAmount] AS [PlanFeeAmount], \n                [Extent3].[LoginId] AS [LoginId], \n                [Extent3].[IndustryTypeId] AS [IndustryTypeId], \n                [Extent3].[CompanyName] AS [CompanyName], \n                [Extent3].[NumberOfLocations] AS [NumberOfLocations], \n                [Extent3].[WebsiteUrl] AS [WebsiteUrl], \n                [Extent3].[blsActive] AS [blsActive], \n                [Extent3].[Pending] AS [Pending], \n                [Extent3].[ExpiryDate] AS [ExpiryDate], \n                [Extent3].[LogoImageName] AS [LogoImageName], \n                1 AS [C1]\n                FROM    (SELECT [Extent1].[Id] AS [Id], [Extent1].[CompanyId] AS [CompanyId], [Extent1].[CompanyLocationId] AS [CompanyLocationId], [Extent1].[FirstName] AS [FirstName], [Extent1].[LastName] AS [LastName], [Extent1].[Email] AS [Email], [Extent1].[Address1] AS [Address1], [Extent1].[Address2] AS [Address2], [Extent1].[City] AS [City], [Extent1].[State] AS [State], [Extent1].[Country] AS [Country], [Extent1].[Zip] AS [Zip], [Extent1].[Phone] AS [Phone], [Extent1].[SaleDate] AS [SaleDate], [Extent1].[Notes] AS [Notes], [Extent1].[Cost] AS [Cost], [Extent1].[CreatedOn] AS [CreatedOn], [Extent1].[ModifiedOn] AS [ModifiedOn], [Extent1].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId]\n                    FROM [dbo].[Customer] AS [Extent1]\n                    WHERE (([Extent1].[FirstName] LIKE @p__linq__0 ESCAPE N'~') OR ([Extent1].[LastName] LIKE @p__linq__1 ESCAPE N'~') OR ([Extent1].[Email] LIKE @p__linq__2 ESCAPE N'~') OR ([Extent1].[FirstName] + N' ' + [Extent1].[LastName] LIKE @p__linq__3 ESCAPE N'~')) AND ([Extent1].[CompanyId] = @p__linq__4) AND ([Extent1].[CompanyLocationId] = @p__linq__5) ) AS [Filter1]\n                OUTER APPLY  (SELECT TOP (1) \n                    [Extent2].[Id] AS [Id], \n                    [Extent2].[CreatedOn] AS [CreatedOn]\n                    FROM [dbo].[EmailCampaignerStatus] AS [Extent2]\n                    WHERE [Filter1].[Id] = [Extent2].[CustomerId] ) AS [Limit1]\n                LEFT OUTER JOIN [dbo].[Company] AS [Extent3] ON [Filter1].[CompanyId] = [Extent3].[Id]\n            )  AS [Project2]\n        )  AS [Project2]\n        WHERE [Project2].[row_number] &gt; 0\n        ORDER BY [Project2].[CreatedOn1] ASC ) AS [Limit2]\n    LEFT OUTER JOIN [dbo].[EmailCampaignerStatus] AS [Extent4] ON [Limit2].[CompanyId] = [Extent4].[CompanyId]\n)  AS [Project3]\nORDER BY [Project3].[CreatedOn1] ASC, [Project3].[Id1] ASC, [Project3].[Id] ASC, [Project3].[Id2] ASC, [Project3].[C2] ASC\n\nSELECT \n[GroupBy1].[A1] AS [C1]\nFROM ( SELECT \n    COUNT(1) AS [A1]\n    FROM [dbo].[Customer] AS [Extent1]\n    WHERE (([Extent1].[FirstName] LIKE @p__linq__0 ESCAPE N'~') OR ([Extent1].[LastName] LIKE @p__linq__1 ESCAPE N'~') OR ([Extent1].[Email] LIKE @p__linq__2 ESCAPE N'~') OR ([Extent1].[FirstName] + N' ' + [Extent1].[LastName] LIKE @p__linq__3 ESCAPE N'~')) AND ([Extent1].[CompanyId] = @p__linq__4) AND ([Extent1].[CompanyLocationId] = @p__linq__5)\n)  AS [GroupBy1]\n\n\nSELECT \nCASE WHEN ( EXISTS (SELECT \n    1 AS [C1]\n    FROM [dbo].[CompanyReviewSites] AS [Extent1]\n    WHERE [Extent1].[CompanyLocationId] = @p__linq__0\n)) THEN cast(1 as bit) WHEN ( NOT EXISTS (SELECT \n    1 AS [C1]\n    FROM [dbo].[CompanyReviewSites] AS [Extent2]\n    WHERE [Extent2].[CompanyLocationId] = @p__linq__0\n)) THEN cast(0 as bit) END AS [C1]\nFROM  ( SELECT 1 AS X ) AS [SingleRowTable1]\n\nSELECT \n1 AS [C1], \n[Extent1].[Id] AS [Id], \n[Extent1].[RiviewSiteId] AS [RiviewSiteId], \n[Extent1].[URL] AS [URL], \n[Extent1].[CompanyId] AS [CompanyId], \n[Extent1].[CompanyLocationId] AS [CompanyLocationId], \n[Extent2].[Id] AS [Id1], \n[Extent2].[ReviewSiteName] AS [ReviewSiteName], \n[Extent2].[ImageName] AS [ImageName]\nFROM  [dbo].[CompanyReviewSites] AS [Extent1]\nINNER JOIN [dbo].[ReviewSites] AS [Extent2] ON [Extent1].[RiviewSiteId] = [Extent2].[Id]\nWHERE [Extent1].[CompanyLocationId] = @p__linq__0\n</code></pre>\n"},{"tags":["sql-server","database","data-warehouse"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13259594,"title":"retrieve data from multiple tables and store them in one table confronted the duplicates","body":"<p>I'm working on some critical data retrieving report tasks and find some difficulties to\nproceed. Basically, it's belonging to medical area and the whole data is distributed in\nseveral tables and I can't change the architecture of database tables design. In order to\nfinish my report, I need the following steps:</p>\n\n<pre><code>1- divide the whole report to several parts, for each parts retrieve data by using\nseveral joins. (like for part A can be retrieved by this:\nselect a1.field1, a2.field2 from a1 left join a2 on a1.fieldA= a2.fieldA ) then I can\ngot all the data from part A.\n\n2- the same things happened for part B\nselect b1.field1, b2.field2 from b1 left join b2 on b1.fieldB= b2.fieldB, then I also\nget all the data from part B.\n\n3- same case for part C, part D.....and so on.\n</code></pre>\n\n<p>The reason I divide them is that for each part I need to have more than 8 joins (medical data is always complex) so I can't finish all of them within a single join (with more than 50 joins which is impossible to finish...)</p>\n\n<p>After that, I run my Spring Batch program to insert all the data from part A and data from part b, part c.. into one table as my final report table. The problem is not every part will have same number of rows which means part A may return 10 rows while part b may return 20 rows. Since the time condition for each part is the same (1 day) and can't be changed so just wondering how can I store all these different part of data into one table with minimum overhead. I don't want to have to many duplicates, thanks for the great help.</p>\n\n<p>Lei</p>\n"},{"tags":["sql-server","asp.net-mvc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13259641,"title":"Should I add a field like MarkedAsDeleted to my table?","body":"<p>I'm building an ASP.NET MVC application with SQL Server. I would like to know what will be a good practice for record deletion operations. I mean, when an item is deleted via web application, I would like to mark it as deleted, and then from an admin console, I will purge them if needed.</p>\n\n<p>Is this a good practice? Should I use or avoid?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","geospatial","spatial"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13259215,"title":"STintersects() to find the Intersection point","body":"<p>I have two geometry which I am using to check if they intersect and if they do I need the intersection point.</p>\n\n<p>Currently I can get only Boolean output where if it intersects = 1 and if it does not intersect it will give =0 . Is there any way I can find the intersection of two shapes in geometry?</p>\n\n<p>Cheers,</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13258759,"title":"Update a DateTimes's Time, but not the date","body":"<pre><code>MyTable:\n id     int\n Date1  DateTime\n Date2  DateTime\n</code></pre>\n\n<p>How can I set the time of Date2 to be the same as Date1 without affecting the date of Date2?</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":53,"score":0,"question_id":13255829,"title":"Dynamic WHERE condition based on variable","body":"<p>I have the follow line in SQL Server</p>\n\n<pre><code>((@data_inicial IS NULL OR @data_inicial = '') \nOR \ntbSO.dt_criacao &gt;= CAST(@data_inicial AS DATE))\n</code></pre>\n\n<p>I need to use the field tbSO.dt_criacao depending one parameter that I receive @cod_status.</p>\n\n<p>If @cod_status = 1 I have to use tbSO.dt_criacao <br/>\nIf @cod_status = 2 I have to use tbSO.dt_abertura <br/>\nIf @cod_status = 3 I have to use tbSO.dt_fechamento</p>\n\n<p>Can you help me in this issue?</p>\n\n<p>Best Regards</p>\n\n<p>Milton Camara</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13254027,"title":"Apply compression on multiple tables at once in SQL Server?","body":"<p>I am using MS SQL Server 2008, I am trying to do a <code>SELECT INTO</code> from one database to another, however I need the new tables to be compressed with row compression after they are built. </p>\n\n<p>I used a trigger before to set compression on all tables by default but that didnt work out so well because the trigger changes the schema and doesnt allow the data to be inserted. </p>\n\n<h2>Here is what i tried:</h2>\n\n<p>CREATE DATABASE dev_hold_test\nCOLLATE Latin1_General_100_CS_AS_WS;        --Sets collation on database\nGO</p>\n\n<p>USE dev_hold_test\nGO   </p>\n\n<p>--  Trigger to apply compression on tables after they are created.<br>\n-- START TRIGGER\nCREATE TRIGGER CompressTables<br>\nON DATABASE<br>\nAFTER CREATE_TABLE<br>\nAS<br>\nBEGIN<br>\n    DECLARE @TableSchema sysname, @TableName sysname<br>\n    SELECT  @TableSchema = EVENTDATA().value('(/EVENT_INSTANCE/SchemaName)[1]','sysname'),<br>\n            @TableName = EVENTDATA().value('(/EVENT_INSTANCE/ObjectName)[1]', 'sysname')   </p>\n\n<pre><code>DECLARE @SQL NVARCHAR(2000)   \n\nSET     @SQL =  'ALTER TABLE ' + QUOTENAME(@TableSchema) + '.' +    \n                QUOTENAME(@TableName) + ' REBUILD WITH (DATA_COMPRESSION=ROW)'  -- ROW | PAGE\n\nEXEC    (@SQL)   \n</code></pre>\n\n<p>END<br>\nGO</p>\n\n<p>---This SELECT is a test will expand to pull more data to create more tables-----</p>\n\n<p>SELECT testdbase_1.dbo.books.author, testdbase_1.dbo.books.text, testdbase_1.dbo.subjects.subject_name, testdbase_1.dbo.subjects.subject_title\nINTO dev_hold_test.dbo.BooksandSubs2\nFROM testdbase_1.dbo.books, testdbase_1.dbo.subjects</p>\n\n<hr>\n\n<p>If i create a table using CREATE it works fine, but when i use a SELECT INTO - it creates the table but does not populate it and gives an error saying the schema has been changed.\nSo i am doing away with the Trigger. I just need to \n1. Create the dbase\n2. Pull the data from the existing tables -which at this point will create new tables\n3. Check all tables to see which is compressed or Not\n4. apply compression on the tables that are not</p>\n\n<p>What other method could i use to set the compression on all the tables at once? #newbie</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13258297,"title":"A script to test existence of primary keys","body":"<p>Trying to figure out a SQL script to test the existence of primary keys in cerain tables.  If the table has no primary key, then the script should output the table name.</p>\n\n<pre><code>Tables to test:\nTableA\nTableB\nTableC\n</code></pre>\n\n<p>After running the script (and lets say TableA and TableC have PKs, but not TableB), then the output would be below:</p>\n\n<pre><code>NoKeys\nTableB\n</code></pre>\n"},{"tags":["java","sql-server","jdbc","fitnesse"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":23,"score":2,"question_id":13258469,"title":"SQLServerException while trying to use Fitnesse and DbFit and SQL Server","body":"<p>I am new to both (Java) FitNesse and SQL Server, I want to have a basic SQL test working with DbFit,</p>\n\n<p>I have the following in root:</p>\n\n<pre><code>!path c:\\fitnesse\\lib\\dbfit.jar\n!path c:\\fitnesse\\lib\\fitlibrary.jar\n!path c:\\fitnesse\\lib\\sqljdbc4.jar\n|Import|\n|dbfit.SqlServerTest|\n</code></pre>\n\n<p>I have the following in my HelloWorldTest,</p>\n\n<pre><code>!contents -R2 -g -p -f -h\n\n!|dbfit.SqlServerTest|\n\n|Connect|LOCALSQLEXPRESS|sa|Password|somePassword:|\n\n|eg.Division|\n|numerator|denominator|quotient?|\n|10       |2          |5        |\n|12.6     |3          |4.2      |\n|100      |4          |33       |  \n</code></pre>\n\n<p>I am getting the following error when I run the test: </p>\n\n<blockquote>\n  <p>com.microsoft.sqlserver.jdbc.SQLServerException: The TCP/IP connection\n  to the host LOCALSQLEXPRESS, port 1433 has failed. Error: \"null.\n  Verify the connection properties. Make sure that an instance of SQL\n  Server is running on the host and accepting TCP/IP connections at the\n  port. Make sure that TCP connections to the port are not blocked by a\n  firewall.\".</p>\n</blockquote>\n\n<p>I have double checked my SQLExpress username and password and the SqlServer instance is at localhost.I doubt this is a firewall issue. (My understaning of firewall is quite weak admittedly.)</p>\n\n<p>netstat -abn does show me that the port is listening.</p>\n\n<p>This is my first post at StackOverflow, please excuse any silliness. Can anyone shed any light? </p>\n"},{"tags":["sql","sql-server","query","tsql","sql-server-2000"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13257860,"title":"When I run simple select query, is it possible not to show number of rows affected at the end?","body":"<p>I try to use OSQL in order to save query results in text file and later bulk insert those text file to a table. OSQL part is ok, however, in bulk insert, number of rows affected at the end of query results causes error. Here is an example;</p>\n\n<pre><code>select item_number, description, price from item\n\n3536114   Fruit mix     $3.99\n\n3536229   DO 20 liquid  $9.99\n\n3536251   Peppermint    $7.99\n\n(3 rows affected) ------&gt; I do not need this line.\n</code></pre>\n"},{"tags":["sql-server","database"],"answer_count":12,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":700,"score":3,"question_id":1006977,"title":"Altering a SQL Server table without impact","body":"<p>I have a table with some 30 columns, already used in the application extensively. i.e Select, Insert and Update operations for this table written in many different ways(in whatever ways the developers thought they were comfortable) in number of stored procedures and UDFs. I'm now handed with a task to extend the functionality for which the table serves and I'm in need to add additional detail to the table(generally can be assumed as an additional column to the table). Adding additional column to the table is a massive and inefficient task I don't want to do considering the impact it will cause elsewhere.</p>\n\n<p>Another way i can think of now is creating a new table with foreign key to the main table and maintaining the records in the new table. I'm skeptical of this way too. What is the effective way to handle this sort of modifications in the schema of the table?</p>\n\n<p>Using SQL Server 2000 in case it's needed.</p>\n\n<p>Edit:</p>\n\n<p>Unfortuantely, column should not accept NULL values. Missed this crucial info indeed</p>\n\n<p>Impacts i think which can occur due to already implemented poor practices are,</p>\n\n<blockquote>\n  <p>1) \"SELECT *\" and binding to some\n  datagrid directly to front end. (very\n  very low probable)</p>\n  \n  <p>2) using Column numbers to fetch from\n  dataset or datatable instead of column\n  names in front end when using \"SELECT\n  *\"</p>\n  \n  <p>3) \"Insert into\" with values given\n  sequentially instead of with column\n  names.</p>\n</blockquote>\n\n<p>By some way, if i can make the column to accept \"NULL\" values(by tweaking requirements a bit) any impact due to the above points?</p>\n\n<p>I'm doubtful of analysisng existing code because number of SPs and functions using this table can run into hundreds.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":8,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":1591,"score":5,"question_id":9740256,"title":"How to compare if two strings contain the same words in T-SQL for SQL Server 2008?","body":"<p>When I compare two strings in SQL Server, there are couple of simple ways with <code>=</code> or <code>LIKE</code>.</p>\n\n<p>I want to redefine equality as:  </p>\n\n<p><em>If two strings contain the same words - no matter in what order - they are equal, otherwise they are not.</em></p>\n\n<p>For example:  </p>\n\n<ul>\n<li><code>'my word'</code> and <code>'word my'</code> are equal</li>\n<li><code>'my word'</code> and <code>'aaamy word'</code> are not</li>\n</ul>\n\n<p>What's the best simple solution for this problem?</p>\n"},{"tags":["php","sql","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":35,"score":-2,"question_id":13257659,"title":"sqlsrv returns empty query","body":"<p>I got a weird problem, on a other webserver (and other mssql server) there wasn't a problem.\nBut now I can connect to the server, I can connect to the database.</p>\n\n<p>And I can execute a query (at least I can use the syntax and it doesn't show an error) but it has no results. Also a <code>sqlsrv_fetch_array</code> returns <code>false</code>..</p>\n\n<p>And I don't have that much mssql knowledge, so I just have a very basic installation.</p>\n\n<p>What did I do wrong or what information do you need?</p>\n\n<p>PS. I'm using windows sql server 2008 R2.</p>\n\n<p>Thank you in advance!</p>\n"},{"tags":["sql-server","linq","spaces"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":334,"score":1,"question_id":1879422,"title":"LINQ puts unwanted trailing spaces on strings","body":"<p>I have a very annoying problem with LINQ and MS SQL Server.</p>\n\n<p>Im currently making some software in WPF C# and use LINQ to generate classes from the data in the database.</p>\n\n<p>However, when i update a nvarchar or varchar field in the DB from my program, LINQ adds trailing spaces to the string!</p>\n\n<p>I have a field in a table defined like this:</p>\n\n<pre><code>ProductName = NVARCHAR(10)\n</code></pre>\n\n<p>So if i do this:</p>\n\n<pre><code>Product.Name = \"Bike\";\nProduct.Name = Product.Name.Trim();\nrepository.Add(Product);   // Runs an .InsertOnSubmit\nrepository.Save();         // Runs a .SubmitChanges\n</code></pre>\n\n<p>then the resulting data in the DB is \"Bike[SPACE][SPACE][SPACE][SPACE][SPACE][SPACE]\" where [SPACE] is just a space (can't write multiple spaces in this text here).</p>\n\n<p>Why does it do this, and how do i make it stop adding those annoying trailing spaces?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","reporting-services"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2252,"score":1,"question_id":150695,"title":"Where are all the places Sql Reporting Server Logs Errors?","body":"<p>It seems like Sql Reporting Services Server logs information in several places including web server logs and logging tables in the database. Where are all the locations SSRS logs to, and what type of errors are logged in each place?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":36,"score":2,"question_id":13256685,"title":"Optimization of query with counts of distinct column based on value of other column","body":"<p>There must be a better way to write this, but I'm just not sure what that is. Basically I'm trying to count the distinct values from one column where a condition is met in a separate column. I found this <a href=\"http://stackoverflow.com/questions/11853065/trying-to-count-distinct-values-of-a-field-based-on-value-of-a-different-field\">link</a>, but am not sure how to apply it here.</p>\n\n<p>Here is the query, I am using SQL Server 2008R2</p>\n\n<pre><code>SELECT lot,\n    (SELECT COUNT(DISTINCT d.pid) FROM invdet d WHERE upk = 0 and d.lot = [invdet].lot) as noUpk,\n    (SELECT COUNT(DISTINCT d.pid) FROM invdet d WHERE upk = 1 and d.lot = [invdet].lot) as isUpk\nFROM invdet\nWHERE ([status] in ('PQ','P2','FA','F2','BH','RL','SC','LD','PS'))\nGROUP BY lot\nHAVING COUNT(CASE WHEN invdet.upk = 1 THEN 1 ELSE null END) &gt; 0\n</code></pre>\n"},{"tags":["c#","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":13257037,"title":"C# function call never reaches first line of executable code, only on a particular pc","body":"<p>I have a piece of code that creates a new SQL-Server Express Database, and then runs a predefined table generation/population script.  Its a pretty straight forward and simple task, and the code works wonderfully under normal operations.  On one of our testing machines, this creation function stalls after creating the DB,  but before populating it.\nIt simply hangs with no error message, no deadlock (ui still responsive), and no CPU usage.  </p>\n\n<p>Further investigation and debugging determines that the line immediately before the LoadDatabaseTables() function call is executed, but the first line inside LoadDatabaseTables() is never reached. How exactly can a function be called, but then have the program fail to execute even the first line of the function?  </p>\n\n<p>The code in question is written in C#:</p>\n\n<pre><code>    ...snip...\n    bool success=false;\n    try\n    {\n        //...code that creates db, working as intended...\n    }\n    catch(Exception e)\n    {\n        //...error handling...\n    }\n    finally\n    {\n        //Params is a locally defined struct, containing int, bool, and string members\n        if(CreateScript(Params))  //generates appropriate script successfully, returns true\n        {\n            System.Windows.MessageBox.Show(\"About to enter load script\");\n            if(LoadDatabaseTables(Params))\n            {\n               success=true;\n            }\n        }\n    }\n    return success;\n}\n\nprivate bool LoadDatabaseTables(DatabaseParams Params)\n{\n    System.Windows.MessageBox.Show(\"Entered the load script\");\n    bool success = false;\n    Server server = null;\n    try\n    {\n        //...sql calls...\n        success = true;\n    }\n    catch (Exception ex)\n    {\n        //...exception handling...\n    }\n    return success;\n}\n...snip...\n</code></pre>\n\n<p>The first message \"About to enter load script\" is reached but the \"Entered the load script\" is not displayed, and the rest of the function does not execute, no exceptions are raised, nothing is returned.</p>\n\n<p>Unfortunately, this machine does not have the necessary tools/licenses to run full debugging, and the problem only occurs on this one machine.  The message boxes obviously are not included in the regular version of the code, and a just being used to attempt to diagnose the problem.  The code executes normally on other systems with and without these message boxes.</p>\n\n<p>Has anyone come across this kind of error before?  Any help would be most appreciated!</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":13256877,"title":"SQL Server Customize Templates beyond Grid","body":"<p>How can I add custom sql commands to the default templates(used for <code>Script Table as...</code>)?</p>\n\n<p>Instead of:</p>\n\n<pre><code>UPDATE DB.dbo.table SET col1 = 'test'\n</code></pre>\n\n<p>I would like to have:</p>\n\n<pre><code>BEGIN TRANSACTION\n    UPDATE DB.dbo.table SET col1 = 'test'\nROLLBACK TRANSACTION\n</code></pre>\n\n<p>Or any custom code really. </p>\n\n<p>I did look at the <a href=\"http://stackoverflow.com/questions/1681645/change-default-template-in-sql-server-management-studio\">Change default template in SQL Server Management Studio</a> question, but it didn't allow for custom sql. It allowed you to set predefined properties.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":13256813,"title":"SELECT SUM() FROM (SELECT (SELECT ())","body":"<p>I have a correct working T-SQL-script in this form</p>\n\n<pre><code>SELECT  columnA\n        AS\n        'numbers'\nFROM    tableA\nWHERE   clause\n</code></pre>\n\n<p>This script gives me as one column, called numbers, of integers. I want to sum these.</p>\n\n<p>Calling the above lines 'script' I tried the following setup</p>\n\n<pre><code>SELECT  SUM(numbers)\nFROM    (\n            script\n        )\n</code></pre>\n\n<p>Reading <a href=\"http://stackoverflow.com/questions/10439122/select-count-from-select\">select count(*) from select</a> I supposed this to work, however, it does not. I keep getting \"Incorrect syntax near.\"</p>\n\n<p>I do not know if it is important but that is here named columnA is itself maked by a SELECT statement.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13256336,"title":"fill empty column with sequence","body":"<p>Is there any way to fill an empty column with a ascending sequence of numbers starting from 1, without using identity?</p>\n\n<p>I tried the following cursor but it is filling the same value (450) for all rows in the column:</p>\n\n<pre><code>declare cur3 cursor for\nselect new_id from sheet1$\ndeclare @no int\ndeclare @no1 int\nset @no1 = 1\nopen cur3\nfetch next from cur3 into @no\nwhile(@@FETCH_STATUS = 0)\nbegin\nupdate sheet1$ set new_id = @no1\nset @no1 = @no1 + 1\nfetch next from cur3 into @no\nend\nclose cur3\ndeallocate cur3\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":33,"score":-1,"question_id":13254417,"title":"trying to create a trigger that check age from an insert and place into another table if less than 18","body":"<p>Develop a trigger that will be placed on the marketing list table that will insert a record into the child table if the person's age is less than 18 once an insert is attempted.</p>\n\n<p>SEE the code below: </p>\n\n<pre><code>Create Trigger on_insert_marketing_list\nOn marketing_list for insert\nAs\nBEGIN\n        Declare @Name varchar (100)\n        Declare @Dob date\n        Declare @Gender char(1)\n        Declare @Parish VARCHAR(50)\n        Declare @Mobile varchar(50)\n        Declare @Provider varchar(50)\n        Declare @age int\n\n        Select @age = datediff(year,@dob,getdate())from inserted\n\n        If (@age) &lt; 18      \n        BEGIN\n        Insert Into Childlist values(@Name,@Dob,@Gender,@Parish,@Mobile,@Provider)\n        END\n\nEnd\n\ninsert into marketing_list (Name, Dob, Gender,  Parish,  Mobile, Mobile_Provider) values\n('Kendrick Lamar', '3/4/2005','M','Kingston', '18764532345','LIME')\n</code></pre>\n"},{"tags":["c#","sql-server","type-conversion"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13177330,"title":"how to convert string datatype to SQL's varbinary equivalent datatype?","body":"<p>Sorry for asking stupid question as I am newbie to C#.</p>\n\n<p>Currently doing a task in c# using OLEDB. The scenario is, I want to insert in one table which has information like username, pasword, etc. The Database is SQL Server. The column Pasword has a datatype varbinary(100). </p>\n\n<p>I want to convet from string datatype to SQL's varbinary equivalent datatype. I tried a little bit, but didn't succeed.</p>\n\n<p>Initially I just tried with <code>reader.GetString(5)</code>. But exception I got is : </p>\n\n<pre><code>\"Specified cast is not valid.\"\n</code></pre>\n\n<p><strong>* I forgot to mentioned below things *</strong></p>\n\n<p>Reader I used is OleDbDataReader.</p>\n\n<pre><code>oleParameter[7] = new OleDbParameter(\"@Password\", OleDbType.VarBinary, 100);\noleParameter[7].Value = reader1.GetBytes(5);\n</code></pre>\n\n<p>(Here I am reading from one table and inserting into another table.)</p>\n\n<p>Please help me.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13254583,"title":"Removing LOB column from table. Lob used page count not equals to 0","body":"<p>I altered a table that was used to contains a Lob column (VarBinary(MAX)).</p>\n\n<p>When I run </p>\n\n<pre><code>select * from sys.dm_db_partition_stats\nwhere [object_id] = object_id('MyTable')\n</code></pre>\n\n<p>the lob_used_page_count is 1014969. I thought it would be 0. Am I wrong or is there something I need to do?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":13207075,"title":"Format a number with commas but without decimals in SQL Server 2008 R2?","body":"<p>I am using the following to create a comma formatted number in T-SQL. How can I get rid of the decimal point and the digits after decimal. So if I get 1,112.00 after formatting, how would I get only 1,112?</p>\n\n<pre><code>SELECT CONVERT(varchar, CAST(1112 AS money), 1)\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":21,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":3880,"score":10,"question_id":101423,"title":"How do you continue to improve your SQL skills?","body":"<p>How do SQL developers go about keeping up on current techniques and trends in the SQL world?  Are there any blogs, books, articles, techniques, etc that are being used to keep up to date and in the know?</p>\n\n<p>There are a lot of opportunities out their for OO, procedural, and functional programmers to take part in a variety of open source projects, but it seems to me that the FOSS avenue is a bit more closed for SQL developers.</p>\n\n<p>Thoughts?</p>\n"},{"tags":["sql-server","linq"],"answer_count":6,"favorite_count":8,"up_vote_count":16,"down_vote_count":0,"view_count":10479,"score":16,"question_id":1722741,"title":"Defining a one-to-one relationship in SQL Server","body":"<p>I need to define a one-to-one relationship, and can't seem to find the proper way of doing it in SQL Server.</p>\n\n<p>Why a one-to-one relationship you ask? </p>\n\n<p>I am using WCF as a DAL (Linq) and I have a table containing a BLOB column. The BLOB hardly ever changes and it would be a waste of bandwidth to transfer it across every time a query is made.</p>\n\n<p>I had a look at <a href=\"http://sqlserver-tips.blogspot.com/2006/10/implementing-one-to-one-relationship.html\" rel=\"nofollow\">this solution</a>, and though it seems like a great idea, I can just see Linq having a little hissy fit when trying to implement this approach.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["mysql","sql-server","sql-server-2008","sql-server-2008-r2","mysql-workbench"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":289,"score":0,"question_id":11619177,"title":"SQL Server 2008 R2 to MySQL Migration","body":"<p>Is there a GUI tool out there that will allow me to migrate entire SQL Server 2008 R2 databases to MySQL?  I have MySQL Workbench installed, but it looks like there isn't a feature in it like SSIS to copy and paste entire databases from SQL Server.  I downloaded the MySQL Migration Toolkit, but it is no longer supported and I get a Java error when running it.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":6,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":593,"score":1,"question_id":6068619,"title":"Merging date intervals in SQL Server","body":"<p>I have the following data:</p>\n\n<pre><code>StartDate   |  EndDate\n-------------------------\n1982.03.02  |  1982.09.30 \n1982.10.01  |  1985.01.17 \n1985.06.26  |  1985.07.26 \n1985.07.30  |  1991.12.31 \n1992.01.01  |  1995.12.31 \n1996.01.01  |  2004.05.31 \n2004.06.05  |  2006.01.31 \n2006.02.01  |  2011.05.20              \n</code></pre>\n\n<p>I need to merge any intervals that are adjacent (both start and the end date are included in the intervals, so an interval ending on 2003.05.06 is adjacent with an interval starting on 2003.05.07), so in this case, the resulting set should be:</p>\n\n<pre><code>StartDate   |  EndDate\n-------------------------\n1982.03.02  |  1985.01.17 \n1985.06.26  |  1985.07.26 \n1985.07.30  |  2004.05.31 \n2004.06.05  |  2011.05.20              \n</code></pre>\n\n<p>For me, the obvious way to do this is to iterate the set with a cursor, and construct a result set row-by-row. However, this functionality will be within code that could potentially be called thousands of times in a day, on a server under heavy load, so I'd prefer not having any performance issues. Any data set is small (20 rows tops), and the data range is large, so any solution that generates all the dates in a range is unfeasible.</p>\n\n<p>Is there a better way I'm not seeing?</p>\n\n<hr>\n\n<p>Initialization code (from Damien's answer):</p>\n\n<pre><code>CREATE TABLE Periods (\n    StartDate datetime NOT NULL CONSTRAINT PK_Periods PRIMARY KEY CLUSTERED,\n    EndDate datetime NOT NULL\n)\n\nINSERT INTO Periods(StartDate,EndDate)\nSELECT '19820302', '19820930'\nUNION ALL SELECT '19821001', '19850117'\nUNION ALL SELECT '19850626', '19850726'\nUNION ALL SELECT '19850730', '19911231'\nUNION ALL SELECT '19920101', '19951231'\nUNION ALL SELECT '19960101', '20040531'\nUNION ALL SELECT '20040605', '20060131'\nUNION ALL SELECT '20060201', '20110520'\n</code></pre>\n"},{"tags":["sql-server","azure","load-balancing","failover","windows-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13254577,"title":"Azure VM availability, mirroring","body":"<p>Apologies for the noob question, I've never dealt with failover before.</p>\n\n<p>Currently we have a single hardware server running Windows Server, SQL Server, ASP.NET and a single (very large) web application.  We are considering migrating this to an Azure VM.</p>\n\n<p>I see in the SLA that Microsoft will only guarantee 99.95% availability if I am running <strong>more than one instance</strong> of an Azure VM, to allow for failure and reboots etc.</p>\n\n<p>Does this mean I therefore would have two servers to manage and maintain?  For example, two versions of SQL with a database on each, and two sets of ASP.NET application files?  If correct, this puts the price up dramatically.</p>\n\n<p>I assume there is no way to 'mirror' one server across to the other to reduce this workload?</p>\n\n<p>Also, our hardware server has 25,000 uploaded files on it.  Would we need to put these on a VHD then 'link' them to whichever live server was running, or does Azure do this automatically?  Or do they have to be mirrored from the live server to the failover server?</p>\n\n<p>Any pointers would be appreciated.  I've already read all the Azure documentation but it hasn't really made things much clearer...</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":33,"score":0,"question_id":13237477,"title":"How do I retrieve decimals when rounding an average in SQL","body":"<p>Here is my SQL statement</p>\n\n<pre><code>SELECT ROUND(AVG(column_name), 100) \nFROM [database].[dbo].[table]\n</code></pre>\n\n<p>The answer I retrieve is <code>3</code> with a possible range of numbers between <code>1 - 5</code> in 908 rows.</p>\n\n<p>I need it to say <code>3.0</code> or <code>3.09</code>. Is this possible?</p>\n"},{"tags":["php","sql-server","pdo"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":13208569,"title":"PDO_MSSQL and SQL Server 7","body":"<p>I have problem with establish connection with sql server 7 on different server using PDO/PHP. All works perfect on win 2003 32 bit/apache/php5.2.5 but I receive server not found when service is on win 2008R2 64bit/apache/php5.2.5. User/password are correct, firewall configured.</p>\n\n<p>I check, that PHP don't use 1433 port but try connect with 445 and 139 ports.</p>\n\n<p>Any idea?</p>\n\n<p>Stefan</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":52,"score":0,"question_id":13254504,"title":"Aggregation for join ON clause","body":"<p>I have a table <code>item_table</code> like this:</p>\n\n<pre><code>item   age\n--------------    \n1      1 \n1      6 \n2      2    \n</code></pre>\n\n<p>I have the other table <code>price_table</code> like this:</p>\n\n<pre><code>item    pricetype    price\n--------------------------    \n1       O             5\n1       P             6\n1       V             7\n2       O             8\n2       P             9\n2       V             10\n</code></pre>\n\n<p>So, I want to inner join above two tables.</p>\n\n<pre><code>select *\nfrom item_table i\ninner join price_table p\non ...\n</code></pre>\n\n<p>There are some conditions about the <code>on</code>:</p>\n\n<ol>\n<li>if <strong>the average of age</strong> of an item is bigger than <code>3</code>, then I do: <code>inner join price_table on pricetype = 'O' or pricetype = 'P'</code></li>\n<li>If not, then I do: <code>inner join price_table on pricetype = 'O' or pricetype = 'P' or pricetype = 'V'</code></li>\n</ol>\n\n<p>So there are conditions for <code>on</code> conditions.</p>\n\n<p>I then write the query like this:</p>\n\n<pre><code>select i.item, i.type, p.pricetype, p.price\nfrom item_table i\ninner join price_table p on i.item = p.item \n    and (avg(i.age) &gt;= 3 and p.pricetype in ('O', 'P'))\n        or (avg(i.age) &lt; 3 and p.pricetype in ('O', 'P', 'V'))\n</code></pre>\n\n<p>The error is given: <code>An aggregate cannot appear in an ON clause unless it is in a subquery contained in a HAVING clause or select list, and the column being aggregated is an outer reference.</code></p>\n\n<p>I can't move the <code>avg</code> to <code>Having</code> because other conditions are depending on the <code>avg</code>.</p>\n\n<p><strong>How can I write the select query?</strong></p>\n"},{"tags":["sql-server","datetime","function"],"answer_count":3,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":14328,"score":8,"question_id":3825893,"title":"SQL Server function to return minimum date (January 1, 1753)","body":"<p>I am looking for a SQL Server function to return the minimum value for datetime, namely January 1, 1753. I'd rather not hardcode that date value into my script.</p>\n\n<p>Does anything like that exist? (For comparison, in C#, I could just do <code>DateTime.MinValue)</code>\nOr would I have to write this myself?</p>\n\n<p>I am using Microsoft SQL Server 2008 Express.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":11110775,"title":"How to generate table name by datetime?","body":"<p>I realize this is syntactically bad but I figure it somewhat explains what I'm trying to do. Essentially, I have a batch job that is going to run each morning on a small table and as a part of the spec I need to create a backup prior to each load that can be accessed by a report.</p>\n\n<p>What I have so far is:</p>\n\n<pre><code>select  *\ninto    report_temp.MSK_Traffic_Backup_ + getdate()\nfrom    property.door_traffic\n</code></pre>\n\n<p>How can I make this function or should I consider doing this a better way?</p>\n"},{"tags":["sql-server","nhibernate","orm","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13253459,"title":"Relationships fixup in EntityFramework vs NHibernate","body":"<p>I have been experimenting with Entity Framework 4.4, NHibernate 3.3.1.4000  and SQL Server and I have noticed a difference when it comes to fixing up the relationships when you commit your changes, and I was wondering what is the best practice or if I'm doing something wrong.</p>\n\n<p>Here's what I tested.  I have a classic Parent linked to n Children.  I have 2 parents in the database with 20 children each.  I load both parents, and I take the first child of the first parent and assign that child the second parent.  I then commit the changes.</p>\n\n<p>In EF, after I have saved,  I can see that the count for the Children collection of both parents has been altered, so it fixed up the relationships.</p>\n\n<p>However, when I do the same thing in NHibernate, the counts remain the same.</p>\n\n<p>Here's my code setup to reproduce the issue.</p>\n\n<p><strong>POCOs:</strong></p>\n\n<pre><code>public class Parent\n{\n    public virtual int ParentId { get; set; }\n\n    public virtual string Name { get; set; }\n\n    public virtual IList&lt;Child&gt; Children { get; set; }\n\n    public Parent()\n    {\n        Children = new List&lt;Child&gt;();\n    }\n}\n\npublic class Child\n{\n    public virtual int ChildId { get; set; }\n\n    public virtual int ParentId { get; set; }\n\n    public virtual string Name { get; set; }\n\n    public virtual Parent Parent { get; set; }\n}\n</code></pre>\n\n<p><strong>NHibernate Parent mapping:</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\" ?&gt;\n&lt;hibernate-mapping xmlns=\"urn:nhibernate-mapping-2.2\"\n                   assembly=\"ConsoleApplication1\"\n                   namespace=\"ConsoleApplication1\"&gt;\n  &lt;class name=\"Parent\" table=\"Parents\"&gt;\n    &lt;id name=\"ParentId\" column=\"ParentId\" /&gt;\n    &lt;property name=\"Name\" column=\"Name\" /&gt;\n    &lt;bag name=\"Children\" cascade=\"all\"&gt;\n      &lt;key column=\"ParentId\"/&gt;\n      &lt;one-to-many class=\"Child\"/&gt;\n    &lt;/bag&gt;\n  &lt;/class&gt;\n&lt;/hibernate-mapping&gt;    \n</code></pre>\n\n<p><strong>NHibernate Child mapping:</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\" ?&gt;\n&lt;hibernate-mapping xmlns=\"urn:nhibernate-mapping-2.2\"\n                   assembly=\"ConsoleApplication1\"\n                   namespace=\"ConsoleApplication1\"&gt;\n  &lt;class name=\"Child\" table=\"Children\"&gt;\n    &lt;id name=\"ChildId\" column=\"ChildId\" /&gt;\n    &lt;property name=\"Name\" column=\"Name\" /&gt;\n    &lt;many-to-one name=\"Parent\" class=\"Parent\" column=\"ParentId\" not-null=\"true\" /&gt;\n  &lt;/class&gt;\n&lt;/hibernate-mapping&gt;    \n</code></pre>\n\n<p><strong>EF DbContext:</strong></p>\n\n<pre><code>public class Entities : DbContext\n{\n    public DbSet&lt;Parent&gt; Parents { get; set; }\n\n    public DbSet&lt;Child&gt; Children { get; set; }\n}\n</code></pre>\n\n<p><strong>App.config:</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;section name=\"hibernate-configuration\" type=\"NHibernate.Cfg.ConfigurationSectionHandler,NHibernate\" /&gt;\n  &lt;/configSections&gt;\n  &lt;hibernate-configuration xmlns=\"urn:nhibernate-configuration-2.2\"&gt;\n    &lt;session-factory&gt;\n      &lt;property name=\"connection.provider\"&gt;\n        NHibernate.Connection.DriverConnectionProvider\n      &lt;/property&gt;\n      &lt;property name=\"dialect\"&gt;\n        NHibernate.Dialect.MsSql2005Dialect\n      &lt;/property&gt;\n      &lt;property name=\"connection.driver_class\"&gt;\n        NHibernate.Driver.SqlClientDriver\n      &lt;/property&gt;\n      &lt;property name=\"connection.connection_string\"&gt;\n        Data Source=localhost;Initial Catalog=MaintainRelationshipsNH;Integrated Security=True;\n      &lt;/property&gt;\n    &lt;/session-factory&gt;\n  &lt;/hibernate-configuration&gt;\n  &lt;connectionStrings&gt;\n    &lt;add\n      name=\"Entities\"\n      providerName=\"System.Data.SqlClient\"\n      connectionString=\"Server=localhost;Database=MaintainRelationshipsNH;Trusted_Connection=true;\"/&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p><strong>Script to create the tables and data:</strong></p>\n\n<pre><code>create table Parents (\n   ParentId INT not null,\n   Name NVARCHAR(255) null,\n   primary key (ParentId)\n)\n\ncreate table Children (\n   ChildId INT not null,\n   Name NVARCHAR(255) null,\n   ParentId INT not null,\n   primary key (ChildId)\n)\n\nalter table Children\n    add constraint FK_Children_Parents\n    foreign key (ParentId)\n    references Parents\n\ndeclare @idChild int        \ninsert into Parents (ParentId, Name) values (0, 'John');\nset @idChild = 0\nwhile @idChild &lt; 20\nbegin\n   insert into Children (ChildId, Name, ParentId) values (@idChild, 'Child ' + convert(nvarchar(2), @idChild), 0);\n   set @idChild = @idChild + 1\nend\ninsert into Parents (ParentId, Name) values (1, 'Julie');\nwhile @idChild &lt; 40\nbegin\n   insert into Children (ChildId, Name, ParentId) values (@idChild, 'Child ' + convert(nvarchar(2), @idChild), 1);\n   set @idChild = @idChild + 1\nend\n</code></pre>\n\n<p><strong>NHibernate test code:</strong></p>\n\n<pre><code>System.Diagnostics.Debug.WriteLine(\"Test NHibernate:\");\n\nConfiguration configuration = new Configuration();\nconfiguration.Configure();\nconfiguration.AddAssembly(typeof(Parent).Assembly);\n\nISessionFactory sessionFactory = configuration.BuildSessionFactory();\n\nParent parent0, parent1;\nusing (ISession session = sessionFactory.OpenSession())\n{\n    using (ITransaction transaction = session.BeginTransaction())\n    {\n        parent0 = session.Load&lt;Parent&gt;(0);\n        parent1 = session.Load&lt;Parent&gt;(1);\n        System.Diagnostics.Debug.WriteLine(\"Before modifications and commit\");\n        System.Diagnostics.Debug.WriteLine(\"Parent0 number of children: \" + parent0.Children.Count);\n        System.Diagnostics.Debug.WriteLine(\"Parent1 number of children: \" + parent1.Children.Count);\n\n        parent0.Children[0].Parent = parent1;\n\n        transaction.Commit();\n    }\n}\nSystem.Diagnostics.Debug.WriteLine(\"After modifications and commit\");\nSystem.Diagnostics.Debug.WriteLine(\"Parent0 number of children: \" + parent0.Children.Count);\nSystem.Diagnostics.Debug.WriteLine(\"Parent1 number of children: \" + parent1.Children.Count);\n</code></pre>\n\n<p><strong>Entity framework test code:</strong></p>\n\n<pre><code>System.Diagnostics.Debug.WriteLine(\"Test Entity Framework:\");\n\nParent parent0, parent1;\nusing (Entities entities = new Entities())\n{\n    parent0 = entities.Parents.Find(0);\n    parent1 = entities.Parents.Find(1);\n    System.Diagnostics.Debug.WriteLine(\"Before modifications and commit\");\n    System.Diagnostics.Debug.WriteLine(\"Parent0 number of children: \" + parent0.Children.Count);\n    System.Diagnostics.Debug.WriteLine(\"Parent1 number of children: \" + parent1.Children.Count);\n    parent0.Children[0].Parent = parent1;\n\n    entities.SaveChanges();\n}\nSystem.Diagnostics.Debug.WriteLine(\"After modifications and commit\");\nSystem.Diagnostics.Debug.WriteLine(\"Parent0 number of children: \" + parent0.Children.Count);\nSystem.Diagnostics.Debug.WriteLine(\"Parent1 number of children: \" + parent1.Children.Count);\n</code></pre>\n\n<p>So basically with this test I can see the counts changing with EF but not with NHibernate.  Am I doing something wrong with NH or do I have to manually manage every part of the relationships affected by my changes ?  Thanks!</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":13253275,"title":"IF ELSE for the conditions of join?","body":"<p>I am using SQL Server.</p>\n\n<p>I have a table <code>item_table</code> like this:</p>\n\n<pre><code>item   age\n--------------    \n1      1 \n1      6 \n2      2    \n</code></pre>\n\n<p>I have the other table <code>price_table</code> like this:</p>\n\n<pre><code>item    pricetype    price\n--------------------------    \n1       O             5\n1       P             6\n1       V             7\n2       O             8\n2       P             9\n2       V             10\n</code></pre>\n\n<p>So, I want to inner join above two tables.</p>\n\n<pre><code>select *\nfrom item_table i\ninner join price_table p\non ...\n</code></pre>\n\n<p>There are some conditions about the <code>on</code>:</p>\n\n<ol>\n<li>if <strong>the average of age</strong> of an item is bigger than <code>3</code>, then I do: <code>inner join price_table on pricetype = 'O' or pricetype = 'P'</code></li>\n<li>If not, then I do: <code>inner join price_table on pricetype = 'O' or pricetype = 'P' or pricetype = 'V'</code></li>\n</ol>\n\n<p>So there are conditions for <code>on</code> conditions.</p>\n\n<p><strong>How can I write the select query?</strong></p>\n\n<p><strong>Edit:</strong>\nI changed the condition to be <strong>average of age</strong>, instead of <code>type</code></p>\n"},{"tags":["sql","sql-server","performance"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":13253522,"title":"Fast SQL Server search on 40M text records","body":"<p>I have a SQL Server 2005 database with a table containing 40 million records. Each record contains a column that stores a comma separated list of keywords. Each keyword is a combination of letters and numbers. The keywords are up to 7 characters long and on average there are 15 keywords per record. The keywords are not unique across rows.</p>\n\n<p>I want to search on full or part of the keyword.</p>\n\n<p>I've created Full text index which shows 328,245,708 unique key count. The search efficiency is fine for queries of 4 or more characters (around <strong>100ms</strong> on the test machine), but too slow for queries that have 3 or less characters (up to <strong>3s</strong> on the test machine).</p>\n\n<p>I've been trying both <code>CONTAINSTABLE</code> and <code>CONTAINS</code> queries of a sort <code>'[query]*'</code> with similar result.</p>\n\n<p>I believe the performance of the short queries is slower, because short words repeat across different records more frequently.</p>\n\n<p>Sorting the results is not crucial, and I've been trying to return <code>TOP X</code> results sorted on Rank from <code>CONTAINSTABLE</code>. This doesn't provide the desired performance.</p>\n\n<p>How can I make this search faster for short queries?</p>\n"},{"tags":["sql-server","bcp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13253417,"title":"SQL Server bcp parameter, native, character, Unicode native, Unicode character, when to use each?","body":"<p>I'm reading <a href=\"http://msdn.microsoft.com/en-us/library/ms191516.aspx\" rel=\"nofollow\">this page</a> that describing the bcp utility. It states that:</p>\n\n<blockquote>\n  <p>This section contains the following examples that show how to use bcp\n  commands to create a non-XML format file:</p>\n\n<pre><code>A. Creating a non-XML format file for native data\n\nB. Creating a non-XML format file for character data\n\nC. Creating a non-XML format file for Unicode native data\n\nD. Creating a non-XML format file for Unicode character data\n</code></pre>\n  \n  <p>The examples use the HumanResources.Department table in the\n  AdventureWorks2012 sample database. The HumanResources.Department\n  table contains four columns: DepartmentID, Name, GroupName, and\n  ModifiedDate.</p>\n</blockquote>\n\n<p>I'm not clear what does these types mean? When to use each?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","query","sql-server-2005"],"answer_count":9,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":71,"score":-1,"question_id":13253445,"title":"Select Part of Column","body":"<p>I was wondering if anyone could help with a query to select part of a column.</p>\n\n<p>The column 'criteriadata' contains data that would look like this:</p>\n\n<blockquote>\n  <p><strong>CriteriaData</strong></p>\n  \n  <p>14 27 15 C</p>\n  \n  <p>14 30 15 DD</p>\n  \n  <p>14 38 15 Pass</p>\n  \n  <p>14 33 15 Pass</p>\n</blockquote>\n\n<p>How can I select just the data that appears after the number 15.</p>\n\n<p>Many thanks.</p>\n"},{"tags":["c#","sql-server","visual-studio","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13253976,"title":"SQL Server Express looking for database in wrong folder","body":"<p>Here is the general problem I'm having:</p>\n\n<p>At work, we have a Visual Studio project that has a SQL project with Entity Framekwork (in addition to a lot of other projects that are class libraries). We are using the same base code for all our projects and just copying it in to a new folder, and adding a new web project and deleting the old web project. We create the database during development automatically if they don't exist already using a DbContext Initializer (it's the <code>DropCreateDatabaseAlways</code> one). Often, whenever this happens and we try to connect to the database, we get the following error:</p>\n\n<p><code>Database 'C:\\\\www\\\\[old project]\\\\app\\\\Web\\\\App_Data\\\\[new project database name from connection string].mdf' already exists. Choose a different database name.\\r\\nCannot attach the file 'C:\\\\www\\\\[new project]\\\\app\\\\Web\\\\App_Data\\\\[new project database name from connection string].mdf' as database '[new project database name]'.\"}</code></p>\n\n<p>It's basically looking in the old folder for the new database, but not actually creating the database like it's supposed to.</p>\n\n<p>Basically it's looking for the database in a different directory than the current project, even though the connection string specifies to attach from the <code>|DataDirectory|</code>. Cleaning the solution, changing the connection string, changing the app.config file, restarting the machine, etc. doesn't help at all. If I rename the folder on the project, it'll work though. </p>\n\n<p>I'm honestly totally flummoxed as to what's going on. I'm fairly competent in and around VS 2010 and SQL Server, so I feel like I should be able to figure out what's going on. It might be something simple that I'm missing, but any help would be appreciated.</p>\n"},{"tags":["asp.net","sql-server","api","soap","sitecore"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13253215,"title":"Need to pull fields from an issue in Sitecore","body":"<p>I'm working with SiteCore and I need to pull some data out of the software via either that API or the SQL database using a PHP script.  The reason I say both are possible is because even if the database changes later on, that doesn't matter to me.</p>\n\n<p>Anyway...</p>\n\n<p>I'm trying to pull any data fields that I can get from a particular issue.  This is my SOAP code so far, and it connects to the service and such, but the return isn't what I need...</p>\n\n<pre><code>try\n{\n    $client = new SoapClient('http://localhost:8083/sitecore/shell/webservice/service.asmx?WSDL');\n\n    $credentials = array('Password' =&gt; 'mypassword','Username' =&gt; 'sitecore\\myusername');\n\n    $Current_Issue = array(\n    'id' =&gt; '{043B69BA-3175-4184-812F-C925CE80324E}',\n    //'language' =&gt; 'en',\n    //'version' =&gt; '1',\n    //'allFields' =&gt; 'true',\n    'databaseName' =&gt; 'web',\n    'credentials' =&gt; $credentials\n    );\n\n    $response = $client-&gt;GetItemMasters($Current_Issue);\n    print_r($response);\n\n}\ncatch(SoapFault $e)\n{\necho $e-&gt;getMessage();\n}\ncatch(Exception $e)\n{\necho $e-&gt;getMessage();\n}\n</code></pre>\n\n<p>This is my output:</p>\n\n<pre><code>stdClass Object\n(\n    [GetItemMastersResult] =&gt; stdClass Object\n        (\n            [any] =&gt; &lt;sitecore xmlns=\"\"/&gt;\n        )\n\n)\n</code></pre>\n\n<p>ANY help is appreciated.  If anybody knows an example SQL query that I can use, that would be just as useful as an alternative method.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13252987,"title":"Inner Join two table-Valued Parameters doesn't work","body":"<p>I am trying to 'inner join' two table values parameters but when i execute the query it takes for ever and i have to stop debug in ms sql server management studio 2008.</p>\n\n<p>The query:</p>\n\n<pre><code>    @allClients [dbo].[ImportedClients] READONLY,\n    @NewClients [dbo].[ImportedClients] READONLY\n\n--Update Clients table in db with new clients\n\n    UPDATE [dbo].[Clients]\n        SET \n\n            Email = ISNULL(ct.Email, x.Email), \n            FirstName = ISNULL(ct.FirstName, x.FirstName), \n            LastName = ISNULL(ct.LastName, x.LastName), \n            Telephone = ISNULL(ct.Telephone, x.Telephone), \n            Cellphone = ISNULL(ct.Cellphone, x.Cellphone), \n\n\n\n        FROM @NewClients ct\n        inner join @allClients x \n        ON (x.Email = ct.Email)     \n\n        WHERE ct.Status &gt; -1 \n</code></pre>\n\n<p>What i am trying to do is: Update all the clients information for rows that exist in both @NewClients and @allClients so i used inner join. \nIs it possible to JOIN two  table-Valued Parameters?\nThis query doesn't (query doesn't complete without an error) work even with a few rows.</p>\n\n<p>any suggestions?</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":34,"score":3,"question_id":13253233,"title":"Easiest way to remove the first instance of two different words in a stored procedure","body":"<p>I've got a column that has some <code>&lt;p&gt;</code> tags like:</p>\n\n<pre><code>&lt;p&gt;test  test 2&lt;/p&gt;    &lt;p&gt;this is a test 2&lt;/p&gt;    &lt;p&gt;this is a test 3&lt;/p&gt;\n</code></pre>\n\n<p>What is the best way to always remove the first <code>&lt;p&gt;</code> with corresponding <code>&lt;/p&gt;</code>.</p>\n\n<p>So that the result becomes:</p>\n\n<pre><code>test test 2 &lt;p&gt; this is a test 2 &lt;/p&gt; &lt;p&gt; this is a test 3&lt;/p&gt;\n</code></pre>\n\n<p>It should work for any case even <code>&lt;p&gt;1&lt;/p&gt;</code> it should result in just <code>1</code>.</p>\n\n<p>I tried using <code>CHARINDEX</code> and <code>SUBSTRING</code> but I end up with a lot of hardcoded #'s :(.</p>\n"},{"tags":["sql-server","stored-procedures"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":5,"view_count":23,"score":-5,"question_id":13252456,"title":"To write a stored procedure to check if data types of columns in 2 tables are same","body":"<p>I have written a sp which checks if the number of rows and columns in two tables.Once that is done I have to check if data types are the same.How do I make sure that the data types are also the same.</p>\n\n<p>This is what I have so far:</p>\n\n<pre><code>CREATE PROCEDURE [sys].[sp_ADC_CheckExcelConfig]\n( \n @TableName1 varchar(100),\n @TableName2 varchar(100),\n @ReturnVal int output\n )\n\n\nAS\n\n declare @R1 int,@R2 int,@C1 int,@C2 int\n\n select @R1= COUNT(*) from @TableName1\n select @R2= COUNT(*) from @TableName2\n\n\n select @C1=COUNT(*) from information_schema.columns where table_name = @TableName1\n select @C2=COUNT(*) from information_schema.columns where table_name = @TableName1\n\n  if((@R1=@R2) and(@C1=@C2))\n   set @ReturnVal=1\n  else\n   set @ReturnVal=0\n\n\n\n return @ReturnVal\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13253259,"title":"SQL Server Replace Command with WIldcard","body":"<p>I am in need of some help. Thanks to fellow user davids, I was able to get certain things working within SQL Server and am in need of some more help. Here is what I am trying to do:</p>\n\n<pre><code>UPDATE Table1 SET keyfield=(REPLACE(REPLACE(Column1,'http://*/folder/',''),'.avi',''))\nUPDATE Table2 SET keyfield=(REPLACE(REPLACE(Column2,'http://server2/folder/',''),'.mpg',''))\n</code></pre>\n\n<p>Can anyone help me out or point me in the right direction to get the wildcard to work? This particular column, the * is an IP Address and it will change all the time. Granted I will know the IP's ahead of time and can probably do it one by one, but I would prefer to have it automatically replace. Thanks in advance!</p>\n"},{"tags":["sql-server","sql-server-2008","truncate","transaction-log"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13252899,"title":"Is there a congruent command to truncate for re-filling a table?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6266450/minimally-logged-insert-into\">Minimally Logged Insert Into</a>  </p>\n</blockquote>\n\n\n\n<p>I have a staging table that I'm going to truncate because a truncate isn't logged. Is there a flag that I can apply to the insert statement (or an alternate statement) so that refilling it will also not be logged in MS SQL Server?</p>\n"},{"tags":["sql","sql-server","ssms"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13252501,"title":"SQL Server Management Studio print in color","body":"<p>I am using SQL Server Management Studio 2012. I am trying to print a stored procedure in the color-coded syntax that it loves showing me, but cannot find an option to enable this. Any ideas?</p>\n\n<p>I know on VS2010 that we (finally) got color output for text, via an add-in on MS's site, but I cannot seem to locate anything for SQL Server Management Studio via Google. Why am I printing this thing out? Because it's 15 pages long, and I am trying to clean it up.  </p>\n"},{"tags":["sql","sql-server"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13252567,"title":"sql - How to selectively select by combining multiple conditions?","body":"<p>I am not sure how to describe my question (maybe title is not proper). </p>\n\n<h2>Here it is:</h2>\n\n<p>I have a table like this:</p>\n\n<pre><code>item   type stockdate    saledate\n\n1      1    2012-11-06   2012-11-05\n\n2      2    2012-11-06   2012-11-07\n\n3      2    2012-11-06   2012-11-05\n</code></pre>\n\n<p>So, I want to select from the above table.</p>\n\n<p>There are two conditions:</p>\n\n<ol>\n<li>if the <code>type</code> of an item is <code>1</code>, then I anyway show this item</li>\n<li>If the <code>type</code> of an item is <code>2</code>, but its <code>saledate &gt;= stockdate</code>, then I show; otherwise, I don't show</li>\n</ol>\n\n<p>So from the above table, I want to <code>show only item 1 and 2</code>, because item 1 has <code>type of 1</code>, item 2 has <code>type of 2</code> but its <code>saledate &gt;= stockdate</code>, item 3 cannot be shown because its <code>saledate&lt;stockdate</code>.</p>\n\n<p><strong>How can I write the select query?</strong></p>\n\n<p>I am using MS SQL Server.</p>\n"},{"tags":["sql-server"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":3100,"score":4,"question_id":3829271,"title":"How can I clone an SQL Server database on the same server in SQL Server 2008 Express?","body":"<p>I have an MS SQL Server 2008 Express system which contains a database that I would like to 'copy and rename' (for testing purposes) but I am unaware of a simple way to achieve this.</p>\n\n<p>I notice that in the R2 version of SQL Server there is a copy database wizard, but sadly I can't upgrade.</p>\n\n<p>Thanks in advance</p>\n\n<p>UPDATE\nThe database in question is around a gig.\nI attempted to restore a backup of the database I want to copy into a new database, but with no luck.</p>\n"},{"tags":["sql-server","plugins","database-management"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":142,"score":1,"question_id":2872837,"title":"Is there a way to create subdatabases as a kind of subfolders in sql server?","body":"<p>I am creating an application where there is main DB and where other data is stored in secondary databases. The secondary databases follow a \"plugin\" approach. I use SQL Server.</p>\n\n<p>A simple installation of the application will just have the mainDB, while as an option one can activate more \"plug-ins\" and for every plug-in there will be a new database.</p>\n\n<p>Now why I made this choice is because I have to work with an exisiting legacy system and this is the smartest thing I could figure to implement the plugin system.</p>\n\n<p>MainDB and Plugins DB have exactly the same schema (basically Plugins DB have some \"special content\", some important data that one can use as a kind of template - think to a letter template for example - in the application). Plugin DBs are so used in readonly mode, they are \"repository of content\". The \"smart\" thing is that the main application can also be used by \"plugin writers\", they just write a DB inserting content, and by making a backup of the database they creaetd a potential plugin (this is why all DBs has the same schema).</p>\n\n<p>Those plugins DB are downloaded from internet as there is a content upgrade available, every time the full PlugIn DB is destroyed and a new one with the same name is creaetd. This is for simplicity and even because the size of this DBs is generally small.</p>\n\n<p>Now this works, anyway I would prefer to organize the DBs in a kind of Tree structure, so that I can force the PlugIn DBs to be \"sub-DBs\" of the main application DB.</p>\n\n<p>As a workaround I am thinking of using naming rules, like:</p>\n\n<p>ApplicationDB (for the main application DB)</p>\n\n<p>ApplicationDB_PlugIn_N (for the N-th plugin DB)</p>\n\n<p>When I search for plugin 1 I try to connect to ApplicationDB_PlugIn_1, if I don't find the DB i raise an error. This situation can happen for example if som DBA renamed ApplicationDB_Plugin_1.</p>\n\n<p>So since those Plugin DBs are really dependant on ApplicationDB only I was trying to \"do the subfolder trick\".</p>\n\n<p>Can anyone suggest a way to do this? Can you comment on this self-made plugin approach I decribed above?</p>\n\n<p><strong>ADDED INFO (AFTER STARTING THE BOUNTY):</strong></p>\n\n<p>In the MainDB I plan to store the connection info to all the plugin DBs. Basically it is the database name, since I deigned the sytem in a way that even if I use multiple sql server logins to access the MainDB, behind the scenes a single user (typically \"sa\" or another user with admin privileges).</p>\n\n<p>So basically if I need to query multiple databases I will use the database name to distinguish between plugins, I don't need to explicitly create fileds called PluginID in the database tables.</p>\n\n<p>So somehow it works like this, in the main DB I store the plugin DB names. So I know the name of the plugins, so if I want to query all the GUNS from all plugins i will do something like this:</p>\n\n<pre><code>select * from ApplicationDB_Plugin_1.dbo.weapons where weapon_type = 'gun'\nunion\nselect * from ApplicationDB_Plugin_2.dbo.weapons where weapon_type = 'gun'\nunion\nselect * from ApplicationDB_Plugin_3.dbo.weapons where weapon_type = 'gun'\n</code></pre>\n\n<p>so the \"trick\" is using the dbname to distinguish between plugins. Now this work, but it seems a little \"dirty\" to me. My question is \"IS THERE A BETTER APPROACH YOU CAN ENVISION?\"</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2000","sql-update"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2457,"score":1,"question_id":3867164,"title":"SQL update query syntax with inner join","body":"<p>Can anyone find my error in this query?  I'm using SQL Server 2000 and I want to update all entries in the CostEntry table to the corresponding value in the ActiveCostDetails table.  The where clause DOES work with a select statement.</p>\n\n<pre><code>    UPDATE CostEntry CE \nINNER JOIN ActiveCostDetails As AD ON CostEntry.lUniqueID = ActiveCostDetails.UniqueID\n       SET CostEntry.sJobNumber = ActiveCostDetails.JobNumber\n     WHERE CostEntry.SEmployeeCode = '002'\n       AND SubString(CostCentre, 1, 1) = sDepartmentCode\n       AND substring(CostCentre, 3, 1) = sCategoryCode\n       AND substring(CostCentre, 5, 2) = sOperationCode\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13238590,"title":"How to suppress the headings output of a SQL query that returns no row","body":"<p>What I am trying to do is this. Set up a SQL job that will query the database every hour looking for bad integers (-1s or zeros). Then put the output into an email and send the results to the dev team. I'm searching 80+ tables. If a particular table has no errors, IE no -1s, 0s or NULLs, and therefore returns no rows, I want to suppress the headings as well. I don't want to email a form full of headings if there are no problems. I know that I could do an \"IF EXISTS\" \"ROWCOUNT >0\" but that requires running each query twice. Once to see if it returns rows, and if true, again to get the results. Does anyone know of a better way to do this?</p>\n"},{"tags":["sql-server","query","tsql","time"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":48,"score":-1,"question_id":13246987,"title":"TSQL query to sum time periods per range","body":"<p>I need to create a query to sum day's hours and night's hours from a range intersec.\nFor example with this range:</p>\n\n<pre><code>8AM-8PM -&gt; day\n8PM-8AM -&gt; night\n</code></pre>\n\n<p>and one or more start-end time period:</p>\n\n<pre><code>7.30AM 10.00PM\n</code></pre>\n\n<p>I would like to get this values:</p>\n\n<pre><code>12 day's hours\n2.5 night's hours\n</code></pre>\n\n<p>I don't know which is the bast way to accomplish this function.</p>\n"},{"tags":["sql-server","signalr"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13245856,"title":"How to use SignalR in a webfarm, using Sql server as the backplane","body":"<p>Based on this topic <a href=\"http://stackoverflow.com/questions/12810002/signalr-sqlserver-listening\">signalr-sqlserver-listening</a>, SignalR can be used in a webfarm, using Sql server as the backplane to communicate messages to all webnodes.</p>\n\n<p>I wonder if there is any documentation/example on this.</p>\n"},{"tags":["c#","sql","sql-server","database"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13251809,"title":"how to re-order IDs after deleting a row in database","body":"<p>Im using C# to make program that has a sql database, in the database I have a table named <code>Workers</code>, it has an auto increament and Primary key <code>ID_column</code>, when I delete a record the IDs will have a gap between each other.</p>\n\n<p>what should I do re-order the IDs after deleting a record??</p>\n\n<p>UPDATE</p>\n\n<p>what i am going to do is to display the record on the screen after finding it,\nso I tried to do that using the <code>ID</code> but it make some exception because of these gaps !!</p>\n\n<p>UPDATE 2</p>\n\n<p>this is the code I tried to use</p>\n\n<pre><code>private void btnFind_Click(object sender, EventArgs e)\n    {\n        string searchFor = \"\";\n        string searchOn = \"\";\n        string searchString = \"\";\n        int results = 0;\n\n        if (searchTextBox.Text.Trim() == \"\")\n            MessageBox.Show(\"Nothing to search for\");\n\n        if (cb1.Text == \"Last Name\")\n        {\n            searchFor = searchTextBox.Text.Trim();\n            searchOn = \"last_Name=\";\n            searchString = searchOn + \"'\" + searchFor + \"'\";\n        }\n\n        if (cb1.Text == \"Job Title\")\n        {\n            searchFor = searchTextBox.Text.Trim();\n            searchOn = \"job_Title=\";\n            searchString = searchOn + \"'\" + searchFor + \"'\";\n        }\n\n        DataRow[] returnedRows;\n\n        returnedRows = ds1.Tables[\"Workers\"].Select(searchString);\n\n        results = returnedRows.Length;\n\n        if (results &gt; 0)\n        {\n            DataRow dr1;\n\n            dr1 = returnedRows[0];\n            inc = (int)dr1[\"Worker_ID\"]-1;\n\n            NavigateRecords();\n\n        }\n        else\n        {\n            MessageBox.Show(\"No such Record\");\n        }\n\n    }\n</code></pre>\n\n<p><code>inc</code> is the currently displayed record and <code>NavigateRecords()</code> is do display the recored with the giving number <code>inc</code></p>\n\n<pre><code>void NavigateRecords()\n    {\n        DataRow dRow = ds1.Tables[\"Workers\"].Rows[inc];\n\n        textBox1.Text =  dRow.ItemArray.GetValue(1).ToString();\n        textBox2.Text =  dRow.ItemArray.GetValue(2).ToString();\n        textBox3.Text =  dRow.ItemArray.GetValue(3).ToString();\n    }\n</code></pre>\n"},{"tags":["sql-server","entity-framework-4","compact-database"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2214,"score":2,"question_id":6947325,"title":"Connection string for using Sql Server Compact with Entity Framework?","body":"<p>I'm done trying to Google for this. I have installed sql ce 4.0, and have EF 4.1, but I can't get a proper connection string. Nothing on connectionstrings.com applies to me. I just want to create a SqlCeEngine object, but no matter what I try I get some exception. Most recently it's been \"Unknown connection option in connection string\" with either \"metadata\", \"app\", \"provider\", or \"provider connection string\" after it. I know EF requires metadata in the connection string. And I can't imagine how anything could do without \"provider connection string\".</p>\n\n<p>So far I have this:</p>\n\n<pre><code>&lt;add name=\"DBContext\" connectionString=\"provider connection string=&amp;quot;Data Source=MyDbFile.sdf;Persist Security Info=False;&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>At one point I had it with metadata:</p>\n\n<pre><code>&lt;add name=\"DBContext\" connectionString=\"metadata=res://*/Data.DBContext.csdl|res://*/Data.DBContext.ssdl|res://*/Data.DBContext.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=MyDbFile.sdf;Persist Security Info=False;&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>Does it need metadata or not? What goes in the \"app\" part of the connection string? What should the provider be, System.Data.SqlClient, or some CE version? (which I still can't find when I try to add references. My add references window still only contains System.Data.SqlServerCe version 3.5.1.0.) Or nothing? And what should go in the providerName attribute? Is System.Data.EntityClient correct? It's like there are 10 different variables here and every combination gives me a new equally mysterious error, none of which turns up anything useful on Google. I'm at my wits' end. Is this even possible?</p>\n"},{"tags":[".net","sql-server","architecture","polling"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13251365,"title":"Can I poll a database every 3 seconds","body":"<p>I am building a system to asynchronously send mails after processing data (could take up to 10 sec the processing).</p>\n\n<p>My initial idea was to have a windows service poll the database with data processing requests every 3 seconds for the first record to be processed. When done, poll and get the new first record to be processed. </p>\n\n<p>When there are no records left wait 3 seconds and poll again to check for records.</p>\n\n<p>I'm not sure if this is a good idea. The use of a timer is not a great way to program in my opinion. Also the performance and the use of the database even when not needed is a concern.</p>\n\n<p>What is the best practice in this case?</p>\n\n<p>Technologies used: .net 3.5, SQL Server, servers are in farm.</p>\n"},{"tags":["sql-server","ssis","etl"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":135,"score":1,"question_id":12510152,"title":"Deploying ssis 2012 with visual studio 2010","body":"<p>I've created a new SSIS package in Visual Studio 2010 and started deploying the package to a SQL 2012 database on a remote server.</p>\n\n<p>I can connect to the DB and see the SSISDB folder but when i deploy the package I get the following error:</p>\n\n<p>\"The path for 'ISServerExec.exe' cannot be found. The operation will now exit.\"</p>\n"},{"tags":["sql-server","xml","vb.net","web-services","ado.net"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13251520,"title":"Getting image from SQL Server, using ADO .NET / VB .NET","body":"<p>I created an Android application that use Web Services (writtend in VB .NET) for obtaining data in form of String and Integer. (the data is retrieved from sql server)\nNow I want to modify these services in order to download some images from sql server.</p>\n\n<p>A tipical service I used, has the following structure</p>\n\n<pre><code>POST /OmniaCare.asmx HTTP/1.1\nHost: localhost\nContent-Type: text/xml; charset=utf-8\nContent-Length: length\nSOAPAction: \"http://tempuri.org/GetProviders\"\n\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"     xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"     xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;\n  &lt;soap:Body&gt;\n&lt;GetProviders xmlns=\"http://tempuri.org/\"&gt;\n  &lt;Username&gt;string&lt;/Username&gt;\n  &lt;Password&gt;string&lt;/Password&gt;\n  &lt;Date&gt;int&lt;/Date&gt;\n&lt;/GetProviders&gt;\n  &lt;/soap:Body&gt;\n  &lt;/soap:Envelope&gt;\n   HTTP/1.1 200 OK\n   Content-Type: text/xml; charset=utf-8\n   Content-Length: length\n\n &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n &lt;soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"    xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;\n &lt;soap:Body&gt;\n   &lt;GetProvidersResponse xmlns=\"http://tempuri.org/\"&gt;\n     &lt;GetProvidersResult&gt;\n       &lt;Providers&gt;\n         &lt;Provider&gt;\n           &lt;cf&gt;string&lt;/cf&gt;\n           &lt;username&gt;string&lt;/username&gt;\n           &lt;description&gt;string&lt;/description&gt;\n           &lt;active&gt;int&lt;/active&gt;\n        &lt;/Provider&gt;\n      &lt;Providers&gt;\n         &lt;Provider&gt;\n           &lt;cf&gt;string&lt;/cf&gt;\n           &lt;username&gt;string&lt;/username&gt;\n           &lt;description&gt;string&lt;/description&gt;\n           &lt;active&gt;int&lt;/active&gt;\n        &lt;/Provider&gt;\n    &lt;/Providers&gt;\n    &lt;Message&gt;string&lt;/Message&gt;\n    &lt;Code&gt;int&lt;/Code&gt;\n  &lt;/GetProvidersResult&gt;\n    &lt;/GetProvidersResponse&gt;\n   &lt;/soap:Body&gt;\n  &lt;/soap:Envelope&gt;\n</code></pre>\n\n<p>In VB .NET I use this code for getting data and return information to the WS caller.</p>\n\n<pre><code>    Using conn As SqlConnection = New SqlConnection(Utilities.ConnectionString)\n            sqlcmd = New SqlClient.SqlCommand()\n            sqlcmd.Connection = conn\n            sqlcmd.CommandType = CommandType.StoredProcedure\n            sqlcmd.CommandText = \"SPGetProviders\" \n            sqlcmd.Parameters.Add(New SqlClient.SqlParameter(\"@param1\", codice_fiscale))\n            sqlcmd.Parameters.Add(New SqlClient.SqlParameter(\"@param2\", mydate))\n            sqlcmd.Parameters.Add(New SqlClient.SqlParameter(\"@mode\", 1))\n\n            da = New SqlClient.SqlDataAdapter()\n            da.SelectCommand = sqlcmd\n            table = New DataTable()\n            da.Fill(table)\n     End Using\n\n    For Each row In table.Rows\n            Provider = New ProviderC()\n            Provider.cf = Utilities.DBNullToVoidString(row.Item(\"cf\"))\n            Provider.username = Utilities.DBNullToVoidString(row.Item(\"user\"))\n            Provider.descrizione = Utilities.DBNullToVoidString(row.Item(\"description\"))\n            Provider.active= Convert.ToInt32(Utilities.DBNullToNothing(row.Item(\"active\")))\n\n    ListOfProvider.Add(Provider)\n\n\n   Next\n\n        Reserch.Providers= ListOfProvider.ToArray()\n        Reserch.Code= 0\n        Reserch.Message= \"ok\"\n\n   Return Reserch\n</code></pre>\n\n<p>where Reserch is an object containing the three parameters that should be returned from WS.</p>\n\n<p>All this code works pretty good. But now I want add a new output parameter in the WS that is an Image. From my SQL server I can obtain a URL where the image is located. \nThen, I can get this image using the obtained URL and how can I pass this image in the output parameter of WS? </p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":40,"score":3,"question_id":13250851,"title":"how to detect a faulty sequence column with sql?","body":"<p>I have this table</p>\n\n<pre><code>ID  |  Seq  \n------------\n A      1      \n A      2      \n A      3      \n B      1      \n B      2     \n B      3     \n B      3     &lt;--duplicate seq where ID=B\n C      1     \n C      2\n C      4     &lt;--missing seq id number 3\n D      1\n D      2\n .      .\n .      .\n</code></pre>\n\n<p>Is there a way to detect if/when there is an error in the logic of the Seq column, specifically if there are jumps and/or duplicates. </p>\n"},{"tags":["sql","sql-server","sql-server-2008","guid","entropy"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":23,"score":-1,"question_id":13251251,"title":"SQL Server 2008 GUID generation","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3242287/how-are-guids-generated-in-sql-server\">how are GUIDs generated in SQL Server?</a>  </p>\n</blockquote>\n\n\n\n<p>I wonder how SQL Server 2008 GUIDs are generated? Entropy bits</p>\n"},{"tags":["java","sql-server","jdbc"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13231606,"title":"jdbc:jtds Connection to SQL server","body":"<p>I am trying to create a connection between some Java and a SQL Server using a JDBC driver. I have created a Connection class which should form the connection to a server which is on my computer with example IP address 'BHX'</p>\n\n<p>Here is the Connection class</p>\n\n<pre><code>public class Connection {\n\npublic static void main(String[] args) throws Exception {\n\n    try {\n        String databaseDriver = \"net.sourceforge.jtds.jdbc.Driver\";\n        Class.forName(databaseDriver);\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n    try {               \n        String url = \"jdbc:jtds:sqlserver://BHX:1433/Forecast;instance=SQLEXPRESS\";\n        java.sql.Connection con =  DriverManager.getConnection(url);\n        System.out.println(\"Connection created\");\n        con.close();\n    } catch (Exception e1) {\n        e1.printStackTrace();\n    }\n}\n}\n</code></pre>\n\n<p>I'm wondering whether there is anything wrong with the url String, as when I run this code I get the following error:</p>\n\n<pre><code>java.sql.SQLException: Network error IOException: Connection refused: connect\nat net.sourceforge.jtds.jdbc.ConnectionJDBC2.&lt;init&gt;(ConnectionJDBC2.java:417)\nat net.sourceforge.jtds.jdbc.ConnectionJDBC3.&lt;init&gt;(ConnectionJDBC3.java:50)\nat net.sourceforge.jtds.jdbc.Driver.connect(Driver.java:185)\nat java.sql.DriverManager.getConnection(Unknown Source)\nat java.sql.DriverManager.getConnection(Unknown Source)\nat Connection.main(Connection.java:56)\nCaused by: java.net.ConnectException: Connection refused: connect\nat java.net.PlainSocketImpl.socketConnect(Native Method)\nat java.net.PlainSocketImpl.doConnect(Unknown Source)\nat java.net.PlainSocketImpl.connectToAddress(Unknown Source)\nat java.net.PlainSocketImpl.connect(Unknown Source)\nat java.net.SocksSocketImpl.connect(Unknown Source)\nat java.net.Socket.connect(Unknown Source)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nat java.lang.reflect.Method.invoke(Unknown Source)\nat net.sourceforge.jtds.jdbc.SharedSocket.createSocketForJDBC3(SharedSocket.java:311)\nat net.sourceforge.jtds.jdbc.SharedSocket.&lt;init&gt;(SharedSocket.java:261)\nat net.sourceforge.jtds.jdbc.ConnectionJDBC2.&lt;init&gt;(ConnectionJDBC2.java:318)\n... 5 more\n</code></pre>\n\n<p>I have seen similar questions <a href=\"http://stackoverflow.com/questions/1862283/help-me-create-a-jtds-connection-string\">(like this here)</a> but its looks as though I have followed all the possible solutions. I have checked that the TCP/IP are enabled in the configuration manager and also that the port number is 1433. </p>\n\n<p>I've tried running this with Firewalls disabled and still get the same error.</p>\n\n<p>telnet BHX 1433 and I am getting the following message '...Could not open connection to the host, on port 1433: Connect failed' </p>\n"},{"tags":["sql","sql-server","sql-server-2008","join","duplicate-removal"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":13250247,"title":"Join Tables SQL Server with duplicates","body":"<p>I have a table </p>\n\n<pre><code>col1\n\n1\n2\n</code></pre>\n\n<p>and other table </p>\n\n<pre><code>col1    col2    col3\n\n1          1    data value one                                    \n1          2    data value one                                    \n2          3    data value two   \n</code></pre>\n\n<p>and I want to join both tables to obtain the following result</p>\n\n<pre><code>col1  col2  col3\n\n1       1    data value one\n2       3    data value two\n</code></pre>\n\n<p>The second table have duplicates but I need to join only one (randomly). I've tried with Inner Join, Left Join, Right Join and always returns all rows. Actually I use <code>SQL Server 2008</code>.</p>\n"},{"tags":["sql","sql-server","xml","query"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13249503,"title":"SQL XML query from column","body":"<p>How to select file names from this kind of XML in a SQL Server column?</p>\n\n<ol>\n<li><p>file name is in attribute <code>VALUE</code> only if high level tag is object with name <code>File</code>\nlike this</p>\n\n<pre><code>&lt;Object NAME=\"File\"&gt;\n    &lt;Parameter ID=\"1\" NAME=\"Name\" VALUE=\"\\\\mysvr\\fiels\\readme1.txt\" /&gt;\n&lt;/Object&gt;\n</code></pre></li>\n<li><p>This sub-hierarchy can be placed on any level of xml (see example below)</p></li>\n<li><p>XML column can contain 0-N file names, I need list like this:</p>\n\n<pre><code>id, filename\n--- ------------------------\n 1  \\\\mysvr\\fiels\\readme1.txt\n 1  \\\\mysvr\\fiels\\readme2.txt\n 2  \\\\mysvr\\fiels\\readme3.txt\n 2  \\\\mysvr\\fiels\\readme4.txt\n</code></pre></li>\n</ol>\n\n<p>Example of XML contents:</p>\n\n<pre><code>declare @t1 table\n(   id int,\n   x XML\n)\n\ninsert into @t1 (id, x)\nselect 1,N'&lt;root name=\"name\" id=\"12\"&gt;\n&lt;class1&gt;\n  &lt;Object NAME=\"File\"&gt;\n              &lt;Parameter ID=\"1\" NAME=\"Name\" VALUE=\"\\\\mysvr\\fiels\\readme1.txt\" /&gt;\n   &lt;/Object&gt;\n&lt;/class1&gt;\n&lt;class1&gt;\n&lt;subclass1&gt;\n&lt;Object NAME=\"File\"&gt;\n              &lt;Parameter ID=\"10\" NAME=\"Name\" VALUE=\"\\\\mysvr\\fiels\\readme2.txt\" /&gt;\n&lt;/Object&gt;\n&lt;Object NAME=\"bitmap\"&gt;\n              &lt;Parameter ID=\"11\" NAME=\"my1\" VALUE=\"bmp\" /&gt;\n&lt;/Object&gt;\n&lt;/subclass1&gt;\n&lt;/class1&gt;\n&lt;/root&gt;'\nunion \nselect 2,N'&lt;root name=\"name\" id=\"12\"&gt;\n&lt;class1&gt;\n  &lt;Object NAME=\"File\"&gt;\n              &lt;Parameter ID=\"13\" NAME=\"Name\" VALUE=\"\\\\mysvr\\fiels\\readme3.txt\" /&gt;\n  &lt;/Object&gt;\n  &lt;Object NAME=\"Font\"&gt;\n              &lt;Parameter ID=\"22\" NAME=\"Tahoma\" VALUE=\"11\" /&gt;\n  &lt;/Object&gt;\n&lt;/class1&gt;\n&lt;class1&gt;\n&lt;subclass1&gt;\n  &lt;Object NAME=\"File\"&gt;\n              &lt;Parameter ID=\"14\" NAME=\"Name\" VALUE=\"\\\\mysvr\\fiels\\readme4.txt\" /&gt;\n  &lt;/Object&gt;\n&lt;/subclass1&gt;\n&lt;/class1&gt;\n&lt;/root&gt;'\n</code></pre>\n"},{"tags":["sql","sql-server","oracle","common-table-expression"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":45,"score":4,"question_id":13153819,"title":"how to select only row with max sequence without using a subquery?","body":"<p>I'm trying to select only the row with the highest seq for each ID</p>\n\n<pre><code>ID  |  Seq   |  Age\n-------------------\n A      1       20   \n A      2       30\n B      1       25\n B      2       32\n B      3       44\n B      4       48\n C      1       11\n</code></pre>\n\n<p>This appears to work</p>\n\n<pre><code>SELECT ID, Age\nFROM Persons a\nWHERE Seq = (SELECT MAX(Seq) FROM Persons b WHERE a.ID = b.ID)\n</code></pre>\n\n<p>But is this the best way, the only way? I don't like using subqueries if I don't have to and I recall you can use something but I forget what it is. Any idea?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":23,"score":2,"question_id":13248659,"title":"Round the third decimal place up into the second decimal place (e.g. $0.033 becomes $0.04)","body":"<p>When we increased the price with 10%, some products (the ones that have 3 decimal points), got an unwanted price change. For example, an item that had a price of <code>0.03</code> changed to <code>0.033</code>. </p>\n\n<p>Our client doesn't want a three decimal point in the pricing. </p>\n\n<p>We want to round the third decimal place up into the second decimal place (e.g. <code>$0.033</code> becomes <code>$0.04</code>).</p>\n\n<p>If my value is <code>0.033</code>, I want result to be <code>0.04</code>.</p>\n\n<p>Please help me</p>\n\n<p>Regards</p>\n\n<p>Amit Vyas</p>\n"},{"tags":["sql","sql-server","xml"],"answer_count":2,"favorite_count":4,"up_vote_count":8,"down_vote_count":0,"view_count":16648,"score":8,"question_id":869405,"title":"SQL Server: How to get hold of XML attributes in a query?","body":"<p>I'm currently trying to get all of the attributes from some XML with an SQL query.</p>\n\n<p>I've been attempting the following to retrieve it, but I must be missing something rather fundamental.</p>\n\n<pre><code>DECLARE @T varchar(max) \nSET @T = \n'&lt;root&gt;\n    &lt;Field FieldRowId=\"1000\"&gt;\n\t&lt;Items&gt;\n\t\t&lt;Item Name=\"CODE\"/&gt;\n\t\t&lt;Item Name=\"DATE\"/&gt;\n\t&lt;/Items&gt;\n    \t&lt;Attributes&gt;\n\t\t&lt;Attribute ID =\"1\"/&gt;\n    \t&lt;/Attributes&gt;\n    &lt;/Field&gt;\n    &lt;Field FieldRowId=\"2000\"&gt;\n\t&lt;Items&gt;\n                &lt;Item Name=\"CODE\"/&gt;\n                &lt;Item Name=\"DATE\"/&gt;\n\t&lt;/Items&gt;\n\t&lt;Attributes&gt;\n\t\t&lt;Attribute ID =\"2\"/&gt;\n\t&lt;/Attributes&gt;\n    &lt;/Field&gt;\n&lt;/root&gt;'\n\nDECLARE @X xml\n\nSET @X = CAST(@T as xml)\nSELECT Y.ID.value('@FieldRowId', 'int') as FieldID, \n   Y.ID.value('/Items/@Name', 'varchar(max)') as \"Name\",\n   Y.ID.value('/Attributes/@ID', 'int') as AttributeID\nFROM @X.nodes('/root/Field') as Y(ID)\n</code></pre>\n"},{"tags":["c#","sql","sql-server","linq","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":88,"score":3,"question_id":13249220,"title":"Using text SQL with LINQ","body":"<p>I'm currently having issues with using LINQ to SQL for my project. This is because most of the lengthy SQL queries (or <em>views</em>, rather) are hard-coded into C#, and what we've been doing all along is to use <code>context.Database.SqlQuery&lt;ClassName&gt;(sql, sqlParams)</code>.</p>\n\n<p>It's been generally very effective, but right now we need something more dynamic. We need to plug in stuff like <code>.Where(x =&gt; x.Name.Contains(\"Anonymous\")).Take(20)</code> or something else along the lines. However, plugging in directly to the previously mentioned line of code would result in the following:</p>\n\n<p><code>context.Database.SqlQuery&lt;ClassName&gt;(sql, sqlParams).Where(x =&gt; x.Name.Contains(\"Anonymous\")).Take(20);</code></p>\n\n<p>While it actually works and pulls the top 20 records where the name contains \"Anonymous\", the performance is pretty bad. What it does behind the scenes is to take all the records from that table and then finally filtering them after having loaded them to memory.</p>\n\n<p>I would then like to ask, is there any way to translate the text SQL to LINQ, or translate the LINQ to SQL, such that I can execute both my text SQL and LINQ in one single statement. If you don't actually have a solution, I'd gladly appreciate suggestions too...!</p>\n\n<p><strong>EDIT:</strong> I've considered using Expression Trees, but I'm not sure how they can actually fit into the picture. Also, I've considered using database views. But there are so many views (quite a number per table) it would definitely be a hassle to port everything over to MS SQL and then rewriting all the querying logic.</p>\n"},{"tags":["sql-server","delphi","firemonkey","livebindings","delphi-xe3"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":218,"score":0,"question_id":12305384,"title":"Delphi XE 3 LiveBindings AutoInc SQL Server","body":"<p>I have a Delphi XE3 Firemonkey app with LiveBindings to a SQL Server. I can connect and see all the data on a grid. I have a field (\"id\") which is an \"identity field\" on SQL (more commonly known as an AutoInc).</p>\n\n<p>When I try to add a record I get \"Field 'id' must have a value.\"</p>\n\n<p>In the past, the fix for this has been to turn off the required field boolean. (With DBISAM, for example, you make the field in the database itself not required and the DB engine fills it in when it gets there, but you can't make an identity field not required in MSSQL.) </p>\n\n<p>I've turned off the requirement for the TField itself, but that has no effect.</p>\n"},{"tags":["sql-server","sum","cross-apply"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13247275,"title":"cross apply in sql with sum","body":"<p>I have the following query:  </p>\n\n<pre><code>insert into [MyDB].[dbo].[Reports_ActivityStat] (ActivityID,TaskID,LS_HowOthersAnswered,LS_ImproveMyChances)\n(\nSELECT\nActivityID=tasks.ActivityID,\nTaskID=tasks.ID,\nCAST(\n        CASE \n            WHEN CHARINDEX('stats',item.value('(UsedLifeSavers)[1]', 'NVARCHAR(MAX)'))&gt;0\n                THEN 1 \n            ELSE 0 \n        END AS bit) as LS_HowOthersAnswered,\nCAST(\n        CASE \n            WHEN CHARINDEX('FiftyFifty',item.value('(UsedLifeSavers)[1]', 'NVARCHAR(MAX)'))&gt;0\n                THEN 1 \n            ELSE 0 \n        END AS bit) as LS_ImproveMyChances\n\nFROM  [MyDB].[dbo].[Tasks] as tasks CROSS APPLY [Progress].nodes ('//Progress/Steps/ProgressStep') Progress(item)\n)  \n</code></pre>\n\n<p>which acts on the following <code>Tasks</code> table:  </p>\n\n<pre><code> ID  |   ActivityID    |      Progress  \n  1  |        1        |  [example below..]  \n  2  |        1        |  [example below..]\n</code></pre>\n\n<p>Where <code>Progress</code> is an xml of the sort:  </p>\n\n<pre><code>&lt;Progress xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n  &lt;Steps&gt;\n    &lt;ProgressStep&gt;\n      &lt;FinishedOn&gt;2012-10-30T13:07:52.6374861+02:00&lt;/FinishedOn&gt;\n      &lt;Score&gt;0&lt;/Score&gt;\n      &lt;StartedOn&gt;2012-10-30T13:07:45.8234861+02:00&lt;/StartedOn&gt;\n      &lt;Status&gt;Finished&lt;/Status&gt;\n      &lt;StepIndex&gt;0&lt;/StepIndex&gt;\n      &lt;StepType&gt;Summary&lt;/StepType&gt;\n      &lt;UsedLifeSavers xmlns:a=\"http://schemas.datacontract.org/2004/07/MindLab.Logic.Study\" /&gt;\n    &lt;/ProgressStep&gt;\n    &lt;ProgressStep&gt;\n      &lt;FinishedOn i:nil=\"true\" /&gt;\n      &lt;PartNumber&gt;1&lt;/PartNumber&gt;\n      &lt;Score&gt;0&lt;/Score&gt;\n      &lt;StartedOn&gt;2012-10-30T13:07:52.6374861+02:00&lt;/StartedOn&gt;\n      &lt;Status&gt;NotFinished&lt;/Status&gt;\n      &lt;StepIndex&gt;1&lt;/StepIndex&gt;\n      &lt;StepType&gt;Information&lt;/StepType&gt;\n      &lt;SubmittedAnswersCount&gt;0&lt;/SubmittedAnswersCount&gt;\n      &lt;UsedLifeSavers xmlns:a=\"http://schemas.datacontract.org/2004/07/MindLab.Logic.Study\"&gt;\n        &lt;a:LifeSavers&gt;Stats&lt;/a:LifeSavers&gt;\n        &lt;a:LifeSavers&gt;FiftyFifty&lt;/a:LifeSavers&gt;\n      &lt;/UsedLifeSavers&gt;\n    &lt;/ProgressStep&gt;  \n  &lt;/Steps&gt;\n&lt;/Progress&gt;  \n</code></pre>\n\n<p>(usually there are many more than 2 steps..)  </p>\n\n<p>My query yields (not actual data, just sample):  </p>\n\n<pre><code> ID  |   ActivityID    |   TaskID   |    LS_HowOthersAnswered   |   LS_ImproveMyChances\n  1  |        1        |      1     |             0             |             0\n  2  |        1        |      1     |             1             |             0  \n  3  |        1        |      1     |             0             |             0    \n</code></pre>\n\n<p>This is almost what I need but not quite.<br>\nI need for every unique TaskID the <code>SUM</code> of all <code>LS_HowOthersAnswered</code> and <code>LS_ImproveMyChances</code>.<br>\nI was trying to group by, but couldn't make it because it's just too different from regular inner join in that matter..</p>\n"},{"tags":["c#","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13249306,"title":"How to find SQL Server instance name and server name from the code behind using c#?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6824188/sqldatasourceenumerator-instance-getdatasources-does-not-locate-local-sql-serv\">SqlDataSourceEnumerator.Instance.GetDataSources() does not locate local SQL server 2008 instance</a>  </p>\n</blockquote>\n\n\n\n<p>I am using code below to get all instance names and server names in my local machine, but it seems it is returning only one instance; how to get all list of instance name and server name in my local machine?</p>\n\n<pre><code>string myServer = Environment.MachineName;\n\nDataTable servers = SqlDataSourceEnumerator.Instance.GetDataSources();\n\nfor (int i = 0; i &lt; servers.Rows.Count; i++)\n{\n        if (myServer == servers.Rows[i][\"ServerName\"].ToString()) \n        {\n            if ((servers.Rows[i][\"InstanceName\"] as string) != null)\n            {\n                CmbServerName.Visibility = Visibility.Visible;\n                CmbServerName.Items.Add(servers.Rows[i][\"ServerName\"] + \"\\\\\" + servers.Rows[i][\"InstanceName\"]);\n\n            }\n            else\n            {\n                CmbServerName.Visibility = Visibility.Visible;\n                CmbServerName.Items.Add(servers.Rows[i][\"ServerName\"]);\n\n            }\n        }\n}\n</code></pre>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server","query","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13248976,"title":"How to insert, update, delete when import data from table to table?","body":"<p>I have a query that I need to run more than once a day. This query is importing data from a database to another. </p>\n\n<p>The target table structure is:  </p>\n\n<pre><code>Id   Date        Department  Location  PersonId  Starttime       EndTime       State\n1    2012-01-01      2           5       200     12:00:00.000    15:00:00.000   2\n</code></pre>\n\n<p>An application can also insert data to the target table. The records that are inserted by the application may not be updated also when this record exists in the source(temp table) table with another state.</p>\n\n<p>To make this possible I have an solution created. I will create an new column in the target table with a second state so that I can check.</p>\n\n<pre><code>Id   Date        Department  Location  PersonId  Starttime       EndTime       State   StateSource\n1    2012-01-01      2           5       200     12:00:00.000    15:00:00.000   2       2\n</code></pre>\n\n<p>Some Requirements:</p>\n\n<p>If a record is added by the application than StateSource will be NULL. Means that this record may not be deleted, updated or inserted again from the source table.</p>\n\n<p>If a Record is updated by the application than the value State and StateSource will be different. In this case I do not update this record.</p>\n\n<p>I will update if the state from the sourcetable and targettable are not same and the values from target table State = StateSource.</p>\n\n<p>I will INSERT a record when this is not exists in the target table. When records already exists do not insert (no matter if this is added by the application or my query on the first run).</p>\n\n<p>I will delete the records from the target when they are no more exists in my sourcetable and State=StateSource.</p>\n\n<p>I already have the following queries. I have decided to make 3 statements.</p>\n\n<pre><code>--Delete Statement first\nDelete from t\nfrom TargetTable t LEFT JOIN SourceTable s ON t.Id=s.Id \nand t.Date=s.Date \nand t.departments=s.Department\nand t.PersonId=s.PersonId\nand t.State=t.StateSource\n\n--Just delete if a date is no more exists from the source table and this records is NOT\n--changed by the application (t.State=t.StateSource)\n\n\n--Update statement second\nUpdate t\nset t.State = s.State\nFrom Targettable t INNER JOIN SourceTable s ON t.Id=s.Id \nand t.Date=s.Date \nand t.departments=s.Department\nand t.PersonId=s.PersonId\n\nThe problem here is:\n--when I have State 2 already in the targettable and in my sourcetable i have\n--another state then the state in the targettable changes. This would not be the case.\n\n\n--Insert Statement thirth\n\ninsert into TargetTable (Id, Date, Department, Location, PersonId, Starttime, EndTime,State, StateSource)\nselect Id, Date, Department, Location, PersonId, Starttime, EndTime,State, StateSource\nfrom SourceTable s \nWHERE Date not in (select Date \n                   from TargetTable t \n                   where t.id=s.id \n                   and t.PersonId=s.PersonId\n                   and t.date=s.date\n                   and t.department=s.department)     \n\n--I have no idea about how the insert should be because the application also can\n--insert records. When a record exists then no insert. What to do with the State?\n</code></pre>\n\n<p>Remember that the states that are changed by the application are leading.</p>\n\n<p>Can anyone help me with the desired result? </p>\n"},{"tags":["sql-server","sqlite","phonegap","synchronisation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":11,"score":-1,"question_id":13249450,"title":"microsoft sync framework and phonegap","body":"<p>In need of sync data from my mobile app to my SQL Server,? any piece of code or advise will help Basically , This is what I need:</p>\n\n<p>Download database records from SQL database server (using microsoft sync framework) into the database phone SQLite (Using PhoneGap) .??</p>\n"},{"tags":["sql-server","query-execution-plans"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13248927,"title":"Can I control the way SQL Server handles its execution plan?","body":"<p><strong>Situation:</strong></p>\n\n<p>I often have (no comments on database, it is history :)) columns where values are separated.</p>\n\n<p>So let's say we have a column <code>params</code> which contains for example <code>1,2,3,4,5</code>.</p>\n\n<p>If I need the values table based I split them with a <code>dbo.fn_Split()</code> function (several version can be found on the net - but out of scope here). So I get my virtual table.</p>\n\n<p>Today I ran into a situation where I have a column where I have this content <code>110&amp;mode=tree</code>.</p>\n\n<p>As I needed the <code>ID</code> only I said to myself... like usual, split and get the first value only:</p>\n\n<pre><code>SELECT TOP 1 [value] FROM dbo._fnSplit('110&amp;mode=tree','&amp;')\n</code></pre>\n\n<p>As I needed the value as int I added a CAST() around it.</p>\n\n<pre><code>CAST((SELECT TOP 1 [value] FROM dbo._fnSplit('110&amp;mode=tree','&amp;')) AS int)\n</code></pre>\n\n<p>Now after execution I got:</p>\n\n<blockquote>\n  <p><em>mode=tree cannot be converted to a type int</em></p>\n</blockquote>\n\n<p>Huch? I get only the first value which is an <code>Id</code> (I double checked the results) but it still try to convert the 2nd value as well. So it seems that SQL Server handles it differently in execution.</p>\n\n<p><strong>Question:</strong></p>\n\n<p>So is it generally possible to control how the execution plans handle this behaviour?</p>\n\n<p><strong>Sidenote:</strong></p>\n\n<p>I solved it for now doing this:</p>\n\n<pre><code>[...] WHERE id = CAST((CASE WHEN k.param LIKE '%&amp;%' THEN LEFT(k.swindowparam,PATINDEX('%&amp;%',k.param)-1) ELSE k.swindowparam END) AS int))\n</code></pre>\n\n<p>Check if string contains &amp; and if so so a LEFT with length found out by <code>PATINDEX</code>.</p>\n"},{"tags":["sql-server","delphi","ado","delphi-xe"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":159,"score":2,"question_id":11562865,"title":"Why does TClientDataSet get the wrong type for WideText fields?","body":"<p>I'm working with a service with Delphi XE and I receive a ClientDataset from a client. When I check the type of a field that is ftWideText, the system detects that the field is ftBlob. To understand the reason, I have saved the ClientDataset to a file and I get XML with an error with the definition of this field. I get:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;FIELD attrname=\"TEXTTEST\" fieldtype=\"bin.hex\" SUBTYPE=\"\" SUBTYPE=\"WideText\" /&gt;\n</code></pre>\n\n<p>The attribute SUBTYPE appears twice when the correct is:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;FIELD attrname=\"TEXTTEST\" fieldtype=\"bin.hex\" SUBTYPE=\"WideText\" /&gt;\n</code></pre>\n\n<p>This problem only appears over a server; the others work OK. I don't know where the problem is, if it's Delphi, ADO, SQL Server.</p>\n\n<p>If I change the Web service to another computer using the same database, all works OK. I think that it is an ADO problem with the components installed on the computer.</p>\n\n<p><strong>Update:</strong> I have the same problem with Windows 2003 Server computers. Two computers with MDAC 2.8 SP2 (ODBC components version 3.526) and both fails. I installed Microsoft SQLServer 2008 R2 to one of the computers and the problem is fixed. I need to know what is installed or reinstalled with SqlServer2008 to fix the problem. Apparently is related with ADO but now I have two machines with the same version of ADO and only one fails.</p>\n"},{"tags":["sql-server","sql-server-2005","tsql","truncate","foreign-keys"],"answer_count":13,"favorite_count":14,"up_vote_count":60,"down_vote_count":0,"view_count":77606,"score":60,"question_id":253849,"title":"Cannot truncate table because it is being referenced by a FOREIGN KEY constraint?","body":"<p>Using MSSQL2005, Can I truncate a table with a foreign key constraint if I first truncate the child table(the table with the primary key of the FK relationship)?</p>\n\n<p>I know I can use a DELETE without a where clause and then RESEED the identity OR</p>\n\n<p>Remove the FK, truncate and recreate but I thought as long as you truncate the child table you'll be OK however I'm getting a </p>\n\n<p>\"Cannot truncate table 'TableName' because it is being referenced by a FOREIGN KEY constraint.\"</p>\n\n<p>error.</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13249054,"title":"Database calculations are wrong","body":"<p>Here is what I'm setting:</p>\n\n<pre><code>result = price / (case when tax = 0 then @tax1h / 100 else @tax2 / 100 end + 1)\n</code></pre>\n\n<p>These are the values:</p>\n\n<pre><code>price = 17.5\ntax = 1\ntax2 = 6\n</code></pre>\n\n<p>17.5 / (6 / 100 + 1) = 16.5</p>\n\n<p>And this returns 17.5 Why is this happening and how to solve it?</p>\n"},{"tags":["sql-server","hbase","sqoop"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13248669,"title":"Sqoop free form query split by alias","body":"<p>I want to import data from MsSQL to HBase running a free form query which has an alias on the key I want to split by. For example my query is;</p>\n\n<pre><code>SELECT       convert(varchar,Table1.Field1) + '_' + Table2.field1 AS 'xyz' \nFROM         Table1\nINNER JOIN   Table2 \nON           Table1.field3 = Table2.field4\nWHERE        $CONDITIONS\n</code></pre>\n\n<p>And I want to split work units by this aliased field. So, in my sqoop query I have <code>--split-by 'xyz'</code> option. But, this doesn't work. I get;</p>\n\n<pre><code>Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: \nAmbiguous column name 'xyz'.\n</code></pre>\n\n<p>So, how can I make sqoop work with this aliased select field?</p>\n"},{"tags":["sql-server","tsql","join"],"answer_count":9,"favorite_count":11,"up_vote_count":21,"down_vote_count":0,"view_count":28187,"score":21,"question_id":111341,"title":"Combine multiple results in a subquery into a single comma-separated value","body":"<p>I've got two tables:</p>\n\n<pre><code>TableA\n------\nID, Name\n\nTableB\n------\nID, SomeColumn, TableA_ID (FK for TableA)\n</code></pre>\n\n<p>The relationship is one row of <code>TableA</code> - many of <code>TableB</code>.</p>\n\n<p>Now, I want to see a result like this:</p>\n\n<pre><code>ID     Name      SomeColumn\n\n1.     ABC       X, Y, Z (these are three different rows)\n2.     MNO       R, S\n</code></pre>\n\n<p>This won't work (multiple results in a subquery):</p>\n\n<pre><code>SELECT ID, Name, (SELECT SomeColumn FROM TableB WHERE F_ID=TableA.ID) FROM TableA\n</code></pre>\n\n<p>This is a trivial problem if I do the processing on the client side. But this will mean I will have to run X queries on every page, where X is the number of results of <code>TableA</code>. </p>\n\n<p>Note that I can't simply do a GROUP BY or something similar, as it will return multiple results for rows of <code>TableA</code>. </p>\n\n<p>I'm not sure if a UDF, utilizing COALESCE or something similar might work?</p>\n"},{"tags":["sql-server","g-wan"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":37,"score":0,"question_id":13237756,"title":"How to connect G-WAN to SQL Server?","body":"<p>I have a web server running G-WAN and CentOS. I'm trying to figure out the best way to make a connection to a Microsoft SQL Sever database. The most I need to do at this point is a simple insert from a G-WAN handler, nothing fancy.</p>\n\n<p>Anyone have any experience with this?</p>\n\n<p>My language preference is C#, Though C++ or C is fine too.</p>\n"},{"tags":["asp.net","sql-server","nosql","document-database","sisodb"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":10804547,"title":"does sisoDB use sql server database to store data","body":"<p>I'm looking for a NoSQL database to use with asp.net , and I came to <a href=\"http://www.sisodb.com/\" rel=\"nofollow\">sisoDB</a> . but as I understood it uses Sql server to save data and so it can use sql server features like security and ... . </p>\n\n<p>is it correct ? and what are pros and cons of this approach ? </p>\n"},{"tags":["c#","sql-server","database","backup","restore"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1437,"score":0,"question_id":5984553,"title":"c# express back up/restore database","body":"<p>I am completely lost here and I am running out of time. Let me explain my situation:</p>\n\n<p>I have created a software in C# express 2010 and SQL Server Express 2008 R2.</p>\n\n<p>Now in the settings section of my software, the user is supposed to be able to make manual back ups/restores of the database.</p>\n\n<p>Also he is supposed to be able to schedule back ups of the database, which will run at time that he will set.</p>\n\n<p>I do not have a clue on how to get both of these working and I am hoping that someone here may point me in the correct direction.</p>\n\n<ul>\n<li>I need to be able to create a\nbackup/restore of the database from\nthe click of a button</li>\n<li>I need to be able to schedule backup\nprocesses</li>\n</ul>\n\n<p>Please keep in mind that when the user will install the software on his computer, he will not have sql server installed (I am saying this because I am under the impression that SMO requires sql server to be pre installed on the client machine).</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server","ruby-on-rails-3","freetds"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":2612,"score":4,"question_id":6973371,"title":"FreeTDS problem connecting to SQL Server on Mac (Unexpected EOF from the server)","body":"<p>I have setup FreeTDS to connect to SQL Server database.  When I try to open TSQL in terminal on Mac (lion) I get this error:</p>\n\n<pre><code>locale is \"en_US.UTF-8\"\nlocale charset is \"UTF-8\"\nusing default charset \"UTF-8\"\nError 20017 (severity 9):\n    Unexpected EOF from the server\n    OS error 36, \"Operation now in progress\"\nError 20002 (severity 9):\n    Adaptive Server connection failed\nThere was a problem connecting to the server\n</code></pre>\n\n<p>Does anybody have a clue what could be causing this?</p>\n"},{"tags":["c#","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13178330,"title":"Populate DataGridView from another thread row by row using sqldatareader","body":"<p>I'm trying to execute some SQL queries that takes long time and returns a lot of rows, and that's why i use SqlDataReader for returning the rows.</p>\n\n<p>I execute the query in a separate thread, so the UI would be usable while the rows are returned.</p>\n\n<p>I also have a datatable, which i'm filling with the SqlDataReader, and the DataTable is bound to a BindingSource, and the BindingSource is bound to the DataGridView.</p>\n\n<p>The problem is that the DataGridView seems to be unable to bind the columns of the DataTable to the Columns in the DataGridView, and all cells in the grid shows blank. Even with AutoGenerateColumns=true, the data is not shown!</p>\n\n<p>The below is an example code quite similar to my problem:</p>\n\n<pre><code>public partial class Form2 : Form\n{\n    BindingSource binding;\n    DataTable dt = new DataTable();\n    DataGridView dgv;\n\n    public Form2()\n    {\n        InitializeComponent();\n\n        binding = new BindingSource();\n        binding.DataSource = dt;\n\n        dgv = new DataGridView();\n        dgv.Columns.Add(\"Column1\", \"Column1\");\n        dgv.Columns[0].DataPropertyName = \"Column1\";\n        dgv.AutoGenerateColumns = false;\n        dgv.DataSource = binding;\n        dgv.Click += new EventHandler(dgv_Click);\n        this.Controls.Add(dgv);\n\n        dostuff();  // ON FIRST TRY 5 ROWS SHOWN\n    }\n\n    void dgv_Click(object sender, EventArgs e)\n    {\n        dostuff();  // ON SECOND RUN EVERYTHING IS CLEARED!\n    }\n\n    void dostuff()\n    {            \n        dgv.DataSource = null;\n        dt.Rows.Clear();\n        dt.Columns.Clear();\n        dgv.DataSource = binding;\n\n        BackgroundWorker bgw = new BackgroundWorker();\n        bgw.DoWork += new DoWorkEventHandler(bgw_DoWork);\n        bgw.RunWorkerAsync();\n\n    }\n\n    void bgw_DoWork(object sender, DoWorkEventArgs e)\n    {\n        dt.Rows.Clear();\n        dt.Columns.Clear();\n\n        dt.Columns.Add(\"Column1\");\n\n        for (int i = 0; i &lt; 5; i++)\n        {\n            DataRow r = dt.NewRow();\n            r[0] = i;\n            dt.Rows.Add(r);\n        }\n    }\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13246561,"title":"select data vice versa","body":"<p>I have two table in my database.</p>\n\n<pre><code>1) User Table\n\nid  username    password    logo    email\n1   admin        admin      NULL    1   \n2   support     support     NULL    NULL    \n3   test        test        NULL    NULL    \n\n\n2) Link Account Table\n\nID  AccountID   LinkAccountID\n1       1           2\n</code></pre>\n\n<p>Now if i select username with accountid 1 then it will return me Admin and Support\n    same way if i select username with accountid 2 then also it will return admin and support\n    and if i select username with accountid 3 then it will return only test</p>\n\n<p>something like vice versa if in link account table account id is 1 or linkaccountid is 1 that will return both id</p>\n\n<p>Thanks in advance</p>\n\n<p>Regards</p>\n\n<p>Amit Vyas</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13246511,"title":"Improving SQL Server query performance","body":"<p>I have a written a query in which I create a string and take distinct values from the table based on conditions.</p>\n\n<p>The table has some 5000 rows. This query takes almost 20 second to execute.</p>\n\n<p>I believe that the string comparisons have made the query so slow. But I wonder what are my alternatives. </p>\n\n<p><strong>Query:</strong></p>\n\n<pre><code>select distinct\n   Convert(nvarchar, p1.trafficSerial) +' ('+  p1.sourceTraffic + ' - ' + p1.sinkTraffic + ' )' as traffic\nfrom \n   portList as p1\ninner join \n   portList as p2 ON p1.pmId = p2.sinkId\n                  AND P1.trafficSerial IS NOT NULL \n                  AND (p1.trafficSerial = p2.trafficSerial) \n                  AND (P1.sourceTraffic = P2.sourceTraffic) \n                  AND (P1.sinkTraffic = P2.sinkTraffic)\nwhere \n   p1.siteCodeID = @SiteId\n</code></pre>\n"},{"tags":["sql-server","copy"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13247575,"title":"copy data from one DB to another DB with approximate same structure","body":"<p>I use EntityFramework to generate my database.\nNow I had an application in production from some time,and I need to change the database by adding some more columns to the tables and to change a 1-* relationship to 0..1-*.</p>\n\n<p>How can  do this easily? If I recreate the database from the edmx file, all data will be lost.\nwhat is the best way to address this issue?</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":13245663,"title":"SQL Server format decimal places with commas","body":"<p>How can I convert the decimal values to have some commas?</p>\n\n<p><a href=\"http://stackoverflow.com/questions/4269529/sql-server-2005-currency-format-with-commas-and-period\">this</a> Helps me. But my problem the decimal places are set to 2 only..I want the decimal to be 2, 3, or 4..example</p>\n\n<pre><code>1,234.123   or    1,234.12345\n</code></pre>\n\n<p>I tried</p>\n\n<pre><code>convert(varchar, convert(decimal(18, 4), 1234.1234567), 1) \n</code></pre>\n\n<p>Output : 1234.1234</p>\n\n<p>There is no comma. But if I use money the decimal are 2 only</p>\n\n<blockquote>\n  <p>convert(varchar, convert(money, 1234.1234567), 1) </p>\n  \n  <p>Output : 1,234.12</p>\n</blockquote>\n"},{"tags":["c#","sql","sql-server","sqldatareader"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13247241,"title":"DataReader problems getting data from 2 classes","body":"<p>I am very inexperienced with SQL, and have only had one lesson. I am trying to figure out how to get information from 2 classes using a DataReader. </p>\n\n<p>My Customer class:</p>\n\n<pre><code>public class Customer\n{\n    private CreditCard _creditCard;\n    private List&lt;Subscription&gt; _subscriptions;\n    private int _customerId;\n    private string _name;\n    private string _address;\n    private int _zipCode;\n    private string _city;\n    private string _email;\n    private string _password;\n\n\n    public Customer(int id, string name, string email, string password)\n    {\n        this._customerId = id;\n        this._name = name;\n        this._email = email;\n        this._password = password;\n        this._subscriptions = new List&lt;Subscription&gt;();\n    }\n\n    public Customer(int id, string name)\n    {\n        this._customerId = id;\n        this._name = name;\n        _subscriptions = new List&lt;Subscription&gt;();\n    }\n\n    public override string ToString()\n    {\n        return _customerId + \" \" + _name;\n    }\n\n    public int CustomerId\n    {\n        get { return _customerId; }\n        set { _customerId = value; }\n    }\n\n    public string Name\n    {\n        get { return _name; }\n        set { _name = value; }\n    }\n\n    public string Address\n    {\n        get { return _address; }\n        set { _address = value; }\n    }\n\n    public int ZipCode\n    {\n        get { return _zipCode; }\n        set { _zipCode = value; }\n    }\n\n    public string City\n    {\n        get { return _city; }\n        set { _city = value; }\n    }\n\n    public string Email\n    {\n        get { return _email; }\n        set { _email = value; }\n    }\n\n    public string Password\n    {\n        get { return _password; }\n        set { _password = value; }\n    }\n\n\n\n    public List&lt;Subscription&gt; Subscriptions\n    {\n        get { return _subscriptions; }\n    }\n\n    public void AddSubscription(Subscription s)\n    {\n        _subscriptions.Add(s);\n    }\n\n    public Subscription FindSubscription(int sId)\n    {\n        bool found = false;\n        int i = 0;\n        while (!found &amp;&amp; i &lt; _subscriptions.Count)\n        {\n            if (_subscriptions[i].SubscriptionId == sId)\n                found = true;\n            else\n                i++;\n        }\n        if (found)\n            return _subscriptions[i];\n        else\n            return new Subscription();\n    }\n\n}\n</code></pre>\n\n<p>My Subscription Class:</p>\n\n<pre><code>public class Subscription\n{\n    private SubscriptionType _subscriptionType;\n    private CarModel _carModel;\n    private List&lt;Booking&gt; _bookings;\n    private int _subscriptionId;\n\n    public Subscription(int subscriptionId, SubscriptionType subscriptionType, CarModel carModel)\n    {\n        this._subscriptionId = subscriptionId;\n        this._subscriptionType = subscriptionType;\n        this._carModel = carModel;\n        _bookings = new List&lt;Booking&gt;();\n    }\n\n    public Subscription()\n    { }\n\n    public int SubscriptionId\n    {\n        get { return _subscriptionId; }\n        set { _subscriptionId = value; }\n    }\n\n    public SubscriptionType SubscriptionType\n    {\n        get { return _subscriptionType; }\n    }\n\n    public CarModel CarModel\n    {\n        get { return _carModel; }\n    }\n\n    public override string ToString()\n    {\n        return this.SubscriptionId + \"\\t \" + this.SubscriptionType + \"\\t \" + this.CarModel;\n    }\n}\n</code></pre>\n\n<p>My Database class:</p>\n\n<pre><code>public class DBCustomer\n{\n    private static SqlCommand dbCmd = null;\n\n    public static List&lt;Customer&gt; GetCustomers()\n    {\n        List&lt;Customer&gt; returnList = new List&lt;Customer&gt;();\n        string sql = \"select * from Customer\";\n        dbCmd = AccessDBSQLClient.GetDbCommand(sql);\n\n        IDataReader dbReader;\n        dbReader = dbCmd.ExecuteReader();\n\n        Customer c;\n\n        while (dbReader.Read())\n        {\n            c = new Customer(Convert.ToInt32(dbReader[\"cId\"].ToString()), dbReader[\"cName\"].ToString());\n            returnList.Add(c);\n        }\n        AccessDBSQLClient.Close();\n        return returnList;\n\n    }\n\n    public static List&lt;Customer&gt; GetCustomersByEmail(string email)\n    {\n        List&lt;Customer&gt; returnList = new List&lt;Customer&gt;();\n        string sql = \"select * from Customer where cEmail = '\" + email+\"'\";\n        dbCmd = AccessDBSQLClient.GetDbCommand(sql);\n\n        IDataReader dbReader;\n        dbReader = dbCmd.ExecuteReader();\n\n        Customer c;\n\n        while (dbReader.Read())\n        {\n            c = new Customer(Convert.ToInt32(dbReader[\"cId\"].ToString()), dbReader[\"cName\"].ToString());\n            returnList.Add(c);\n        }\n        AccessDBSQLClient.Close();\n        return returnList;\n\n    }\n\n    public static List&lt;Subscription&gt; GetCustomerSubscriptions(int cId)\n    {\n        List&lt;Subscription&gt; returnList = new List&lt;Subscription&gt;();\n        string sql = \"select S.sId, ST.stName,CM.cmDescription \"\n                   + \"from Customer C, Subscription S, SubscriptionType ST, CarModel CM \"\n                   + \"where C.cId = S.cId \"\n                   + \"and S.stId = ST.stId \"\n                   + \"and S.cmId = CM.cmId \"\n                   + \"and C.cId = \" + cId;\n        dbCmd = AccessDBSQLClient.GetDbCommand(sql);\n\n        IDataReader dbReader;\n        dbReader = dbCmd.ExecuteReader();\n\n        Subscription s;\n\n        while (dbReader.Read())\n        {\n            //s = new Subscription();\n            s = new Subscription((int)(dbReader[\"sId\"]).ToString(),\n                    dbReader[\"stName\"],\n                    dbReader[\"cmDescription\"]);\n            returnList.Add(s);\n        }\n        AccessDBSQLClient.Close();\n        return returnList;\n\n    }\n</code></pre>\n\n<p>Obviously the GetCustomers and GetCustomersByEmail methods are working, but I have no idea how to make the GetCustomerSubscriptions method, as it has to return data fra 2 classes, and I cant just build a Customer to add to the resultset. </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13245044,"title":"corelated query","body":"<p>I have a table where I have some records as follows <br/></p>\n\n<pre><code>Model            Make            Color\n==================================================\nMaruti 800       2008            Black\nMaruti 800       2009            White\nMaruti Esteem    2000            Yelow\nMaruti Esteem    2010            Red\n</code></pre>\n\n<p>Now I want the Model, Make and Color which has maximum make in the list.<br/>\nI have tried writing query like this<br/></p>\n\n<pre><code>SELECT \n     Model,\n     MAX(Model),\n     Color\nfrom \n     tableName\nGROUP BY \n     Model,\n     Color\n</code></pre>\n\n<p>But the result are not coming which I would like<br/>\nIt should be like</p>\n\n<pre><code>Model            Make            Color\n===================================================\nMaruti 800       2009            White    \nMaruti Esteem    2010            Red\n</code></pre>\n\n<p>But the result is the whole table.</p>\n\n<p>I need only those record which has max Make Model Wise.<br/>\nI have also tried inner Query (co-related query) But in that also it is asking for group by.</p>\n"},{"tags":["c#","sql-server","asp.net-mvc-3","visual-web-developer","dataprovider"],"answer_count":7,"favorite_count":4,"up_vote_count":26,"down_vote_count":0,"view_count":24350,"score":26,"question_id":6508516,"title":"ASP.NET MVC 3 - Unable to find the requested .Net Framework Data Provider","body":"<p><em><strong>Background-info:</em></strong>  </p>\n\n<p>I'm using Microsoft Visual Web Developer 2010 Express.<br>\nInfo about my (lack of) experience: the problem occured within the first tutorial that I'm trying to work through.   </p>\n\n<p>Some additional-info:</p>\n\n<ul>\n<li>I'm comfortable with C#, Postgres, Rails (so MVC &amp; Web-apps are not new to me)</li>\n<li>I have <strong>no</strong> experience with ASP.NET or SQL Server  </li>\n</ul>\n\n<p><em><strong>Problem Description:</em></strong></p>\n\n<p>I'm trying to following exactly the steps from the <a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-mvc3-part1-cs\" rel=\"nofollow\">\"Intro to ASP.NET MVC 3\"</a>-tutorial and I'm running into a problem at <a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-mvc3-part5-cs\" rel=\"nofollow\">the first step from part 5 - Adding the MoviesController: </a></p>\n\n<p>When I'm trying to add the \"MoviesController\" with the exact settings that are shown in the tutorial and click 'Add' I get the following error:</p>\n\n<blockquote>\n  <p>\"Unable to retrieve metadata for\n  MvcMovie.Models.Movie. <strong>Unable to\n  find the requested .Net Framework Data\n  Provider.</strong> It may not be installed.\"</p>\n</blockquote>\n\n<p>Google gave a ton of results when searching for the phrase \"Unable to find the requested .Net Framework Data Provider\", but nothing has solved the problem so far.  </p>\n\n<p><em><strong>What I've tried:</em></strong></p>\n\n<p>I think SQL-Server was not installed so I installed it from the Visual-Studio Express ISO- got an error then I've run a repair from the ISO and it claimed that all 15 points including SQL Server Express repair &amp;.NET 4 Framework went through successfully.</p>\n\n<p>I've run the The_.NET_Framework_Setup_Verification_Tool which succeeded for everything.\n<a href=\"http://blogs.msdn.com/b/astebner/archive/2008/10/13/8999004.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/astebner/archive/2008/10/13/8999004.aspx</a></p>\n\n<p>After the mentioned (re-)installing &amp; repairing I recreated the Project and followed every step as described in the tutorial and got the same error. </p>\n\n<p>I found that I should look for DbProviderFactories in machine.config,</p>\n\n<p>The root-Web.config of the Project has the following entries</p>\n\n<pre><code>  &lt;connectionStrings&gt;\n    &lt;add name=\"MovieDBContext\"\n     connectionString=\"Data Source=|DataDirectory|Movies.sdf\"\n     providerName=\"System.Data.SqlServerCe.4.0\"/&gt;\n</code></pre>\n\n<p>My machine config-file has only one DbProviderFactories entry:</p>\n\n<pre><code>&lt;DbProviderFactories&gt;\n&lt;add name=\"Microsoft SQL Server Compact Data Provider\" invariant=\"System.Data.SqlServerCe.3.5\" description=\".NET Framework Data Provider for Microsoft SQL Server Compact\" type=\"System.Data.SqlServerCe.SqlCeProviderFactory, System.Data.SqlServerCe, Version=3.5.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91\"/&gt;&lt;/DbProviderFactories&gt;\n</code></pre>\n\n<p>then I found the following quote</p>\n\n<blockquote>\n  <p>\"we have changed the way\n  DbProviderFactories.GetFactoryClasses()\n  determines the framework providers in\n  VS2010. They are no longer listed in\n  the machine.config file. \"</p>\n</blockquote>\n\n<p>from <a href=\"http://social.msdn.microsoft.com/Forums/en-ZA/adodotnetdataproviders/thread/d79129c4-ae05-4c45-8997-bd90f5765a3a\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-ZA/adodotnetdataproviders/thread/d79129c4-ae05-4c45-8997-bd90f5765a3a</a></p>\n\n<p><em><strong>Question:</em></strong>  </p>\n\n<p><strong>So perhaps this is the wrong direction and since I have no clue what to try next, what steps should I take to investigate &amp; solve this problem?</strong><br>\nBtw. I have postgres installed, so if using postgres instead of SQL-server would be an easy solution let me know. For my own projects I would want to use a different DB anyway (probably postgres), but for now I would just want to be able to get successfully through the first and seemingly simple tutorial I've tried.</p>\n"},{"tags":["asp.net","sql-server","casting"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":29,"score":-3,"question_id":13246524,"title":"SQL Server cast varbinary to char display problems","body":"<p>I am using ASP.net to render data from a SQL server database in web page. The problem is when I cast data from <code>varbinary(50)</code> to <code>varchar(50)</code> using the below query </p>\n\n<pre><code>SELECT CAST([Customer] as varchar(50) ) as Customer From Inspection\n</code></pre>\n\n<p>i get some strange symbols   concatenated to my text </p>\n"},{"tags":["asp.net","sql-server","reporting"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13246395,"title":"How to deploy web app with reporting service asp.net with sql server 2008","body":"<p>I am new to SQL Server reporting services. I want to develop a web application which will be reporting application, primarily used to display financial reports. I want to use microsoft reporting services for that, because the same reports need to be shared by more than one application. I have the following doubts :</p>\n\n<ol>\n<li>How to deploy the application with the rdl files, can you suggest any hosting providers which provide database server with reporting service ?</li>\n<li>Will there be any extra cost for using reporting services ? and if so can anyone give me some idea about the cost of deploying the application ?</li>\n<li>which option of reporting has more advantages (rdl or rdlc) ?</li>\n</ol>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":290,"score":0,"question_id":9829134,"title":"Store special character in database table sql server","body":"<p>I want to store values which contains special character like ', \" etc in database table filed which have datatype varchar. Like I want to store 'Sale'sStore' value in table.</p>\n\n<p>How can I store it. Currently I was not able to store it. </p>\n"},{"tags":["sql","sql-server","performance","nested-sets","hierarchyid"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":114,"score":4,"question_id":12568201,"title":"SQL Server Nested set vs Hierarchyid performance","body":"<p>I have a hierarchical data. The most common queries will be \"get parent branch for node\" and \"get subtree of node\". Updates and inserts are not likely to occur often. I am choosing between nested sets and hierarchyid. As far as I am concerned, search on nested set should be pretty fast on indexed columns, however, I have no clue about internal implementation of hierarchyid. What should I use in order to achieve highest performance possible?</p>\n"},{"tags":["c#","jquery","asp.net","sql-server","linq"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":7,"view_count":38,"score":-7,"question_id":13246476,"title":"How to generate Dynamic Checkboxes & data tables in Jquery mobile using LINQ?","body":"<p>my task is </p>\n\n<p>1) when our page loads, automatically should generate a check box list using data in SQL server tabled data.<br>\n 2) user will select some options from those checkbox list and clicks on submit button.</p>\n\n<p>3) then we have to display a table dynamically which gives details of those selected    names/options.</p>\n\n<p>for example we have student table.. on page load we will display the checkboxes of student names from table column. when we select some of those students names and click on ''get marks'' button second page should display a \"DATA TABLE\"  with name &amp; marks columns..</p>\n\n<p>this is all concept should work using</p>\n\n<p>1) c#</p>\n\n<p>2) LINQ</p>\n\n<p>3) Jquery Mobile</p>\n\n<p>4) Data Tables</p>\n\n<p>5) SQL Server (inbuilded in VS)</p>\n\n<p>6) Visual Studio 2012</p>\n\n<p>even i dnt knw what is .net.. and what are the operations to be done.. iam started learning just now.. but iam very confused..\nbut i want to just create a jquery mobile application..\nplease help me.. (if possible please provide me code because even i am not able to follow examples now.)</p>\n\n<p>ThnQ for helping me.</p>\n"},{"tags":["sql","sql-server","query","sql-server-2000"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":70,"score":4,"question_id":13244832,"title":"SQL Server 2000 Query of total value and value from max date","body":"<p>I have this RoomTable with value</p>\n\n<pre><code>SID   Room   Date        APhase   BPhase   ACount  BCount\n1     One    10/28/2012  4        5         3       6\n2     One    10/29/2012  2        3        -1      -1\n3     One    10/30/2012  4        5         7      -1\n4     Two    10/28/2012  8        3         2       3\n5     Two    10/30/2012  3        5         4       6\n6     Three  10/29/2012  5        8         2      -1\n7     Three  10/30/2012  5        6        -1       4\n8     Four   10/29/2012  6        2        -1      -1\n9     Four   10/30/2012  5        8        -1      -1\n</code></pre>\n\n<p>What I want is to return the following:</p>\n\n<ol>\n<li>Total sum of APhase and BPhase of each Room.</li>\n<li>Value of ACount and BCount from max date of each Room</li>\n<li>If ACount value is -1 then use the previous date. Same as BCount.</li>\n<li>If ACount value is -1 and the previous date is -1 and so on. Then use 0. Same as BCount.</li>\n</ol>\n\n<p>I can get the query of number 1 with this query</p>\n\n<pre><code>SELECT Room, sum(APhase) as TotalAPhase, sum(BPhase) as TotalBPhase \nFROM RoomTable \nWHERE Date between '10/28/2012' and '10/30/2012'\ngroup by Room\norder by Room\n</code></pre>\n\n<p>But I'm confused on how to include the number 2-4 query.</p>\n\n<p>This is the output I want</p>\n\n<pre><code>Room  TotalAPhase  TotalBPhase  ACount   BCount\nOne   10           13           7        6\nTwo   11           8            4        6\nThree 10           13           2        4\nFour  11           10           0        0\n</code></pre>\n\n<p>Any ideas will be much appreciated. Thanks. </p>\n"},{"tags":["sql-server","sql-server-2008","tsql","transactions","rollback"],"answer_count":0,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":13246038,"title":"which is better approach for roll back transaction in sql server?","body":"<p>I came to know we can go for roll back transaction using \"<strong>set xact_abort on</strong>\"\ni want to know which is the better way for roll back transaction: use \"set xact_abort on\" or simple the following code</p>\n\n<pre><code>begin try\nbegin tran\n-- statements \ncommit tran\nend try\nbegin catch\nrollback tran\nend catch\n</code></pre>\n\n<p>Please help me to choose which is better approach while inserting number of records one time.</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13246115,"title":"Database management tool","body":"<p>I hope this is a suitable place to ask this question.</p>\n\n<p>I am working on a project that has a SQL Server back end, 30 or so tables, with many inter-dependencies.</p>\n\n<p>I want to focus my time on working on the user interface but seem to be spending a ridiculous amount of time writing management pages for my supporting tables and data entry and management.</p>\n\n<p>The database has (or will shortly) have all table relationships correctly defined, so I what I am searching for is a tool I can just point at my database and get a full data entry management system, for example I want to be able to</p>\n\n<ul>\n<li>click on Table A and see all the rows</li>\n<li>When editing a row, if a column has a lookup table - give me a dropdown list so I can chose from that list</li>\n<li>if the entry is not on that list let me \"ajax-ly\" create a new entry in that lookup table</li>\n<li>give me searching and sorting tools.</li>\n</ul>\n\n<p>am I looking for Nirvana here?  I have looked at using .NET MVC and a bunch of default controllers.  This works somewhat but there would be a lot of work to get me to where I want to be.</p>\n\n<p>Thanks in advance for your help,\nPatrick.</p>\n"},{"tags":["sql","sql-server","logic"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":33,"score":-1,"question_id":13245652,"title":"Can any body explain the logic mentioned in the description?","body":"<p>The best way to get the month name when you have the month number is </p>\n\n<p>Select DateName( month , DateAdd( month , @MonthNumber , 0 ) - 1 )</p>\n"},{"tags":["sql","sql-server","query","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":13241518,"title":"sql query including month columns?","body":"<p>I was wondering if I could get some ideas or direction on a sql query that would output column months. Here is my current query..</p>\n\n<pre><code>select A.assetid, A.Acquisition_Cost, B.modepreciaterate from FA00100 A\ninner join FA00200 B on A.assetindex = B.assetindex\nwhere MoDepreciateRate != '0'\n</code></pre>\n\n<p>I would like to add more columns that look as such:</p>\n\n<pre><code>select assetid, acquisition_cost, perdeprrate, Dec_2012, Jan_2013, Feb_2013....\n\nwhere Dec_2012 = (acquisition_cost - MoDepreciateRate*(# of months))\nand Jan_2013 = (acquisition_cost - MoDepreciateRate*(# of months))\n</code></pre>\n\n<p>where # of months can be changed.</p>\n\n<p>Any help would be really appreciated. Thank you!</p>\n\n<p>Here is an example of what I would like the output to be with '# of months' = 4</p>\n\n<pre><code>assetid SHRTNAME    Acquisition_Cost    perdeprrate Dec_2012    Jan_2013    Feb_2013    Mar_2013\nCS-013  GEH INTEG   17490.14            485.83      17004.31    16518.48    16032.65    15546.82\nCS-014  WEB BRD     14560               404.4507    14155.5493  13751.0986  13346.6479  12942.1972\n</code></pre>\n"},{"tags":["sql-server","oracle"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13245322,"title":"[Generic Connectivity Using ODBC][Microsoft][ODBC SQL Server Driver]COUNT field incorrect or syntax error (SQL State: 07001; SQL Code: 0)","body":"<blockquote>\n  <p><em>ERROR at line 1:<br>\n  ORA-28500: connection from ORACLE to a non-Oracle\n  system returned this message:<br>\n  [Generic Connectivity Using\n  ODBC][Microsoft][ODBC SQL Server Driver]<br>\n  COUNT field incorrect or syntax error<br>\n  (SQL State: 07001; SQL Code: 0) ORA-06512: at line 9</em></p>\n</blockquote>\n\n<p>Anyone know this error.. pls help us. </p>\n\n<p>thanks in advance.  </p>\n"},{"tags":["sql","sql-server","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":56,"score":-1,"question_id":13243047,"title":"Converting row to columns in SQL Server","body":"<p>I have a query that returns the following result set:</p>\n\n<pre><code>patName  SName   DISC    SCHEDULE   \nJM       AA      HA      2 per  Week\nJM       MAC     MSW     1 per  Month\nJM       ANG     RN      1 per  Week\nJM       JON     RN      1 per  Week\nJM       LRH     RN      1 per  Week\n</code></pre>\n\n<p>Is there any way I could display the result as follows using <code>PIVOT</code></p>\n\n<pre><code>PATNAME    HA           MSW             RN \n  JM    AA 2/Week   MAC 1/Month    ANG 1/week \n                                   JON 1/Week \n                                   LRH 1/Week\n</code></pre>\n\n<p>Edit, my query is as follows:</p>\n\n<pre><code>SELECT PatientName, [RN], [HA], [LVN], [MSW], [SC] \n  FROM \n  ( \n   SELECT DISTINCT (tblPatient.FirstName +' '+ tblPatient.LastName) As PatientName,\n   (tblStaff.StaffFirstName+' '+tblStaff.StaffLastName) As StaffName, \n    (tblStaffDiscipline.Discipline)As Discipline, \n    CAST(tblFrequencyOfVisit.NoOfVisit As Varchar)+' per '\n     + REPLACE (tblFrequencyOfVisit.Period,'/','') AS Visits new_value,\n   row_number() over(partition by PatientName, Discipline order by Discipline) rowNum\n   FROM tblPatient INNER JOIN\n   tblFrequencyOfVisit \n   ON tblPatient.PatientId = tblFrequencyOfVisit.PatientId \n   INNER JOIN tblStaffAssignment \n   ON tblPatient.PatientId = tblStaffAssignment.PatientId \n   AND tblFrequencyOfVisit.PatientId = tblStaffAssignment.PatientId \n   INNER JOIN tblStaffDiscipline \n   ON tblFrequencyOfVisit.DisciplineId = tblStaffDiscipline.DisciplineId \n   INNER JOIN tblStaff \n   ON tblStaffAssignment.StaffId = tblStaff.StaffId \n   AND tblStaffDiscipline.Discipline = tblStaff.StaffDisciplane \n )src  \n pivot\n (\n  max(new_value)\n  for Discipline in ([RN], [HA], [LVN], [MSW], [SC])\n) piv\n\n  WHERE\n  tblpatient.PatientId = '138' \n  AND NOT tblPatient.SOC IS NULL \n  AND tblPatient.EOC IS NULL \n  AND tblPatient.Hospiceid = '1' \n  AND tblFrequencyofVisit.FromDate = \n   (Select MAX(FROMDATE) \n   From tblfrequencyofVisit \n   Where tblFrequencyOfVisit.PatientId = tblPatient.PatientId \n   AND tblFrequencyofVisit.Disciplineid = tblStaffDiscipline.Disciplineid )\n</code></pre>\n"},{"tags":["sql-server","stored-procedures","tracking"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":119,"score":1,"question_id":9811881,"title":"SQL Server last called stored procedures with parameters","body":"<p>I am using ASP.NET environment.</p>\n\n<p>Is it possible to track last N number of stored procedures called with parameters info?</p>\n\n<p>I see in this article \"Recently executed stored procedures\";</p>\n\n<p><a href=\"http://sqlfool.com/2009/08/find-recently-executed-stored-procedures/\" rel=\"nofollow\">http://sqlfool.com/2009/08/find-recently-executed-stored-procedures/</a></p>\n\n<p>But I need input parameters also.</p>\n\n<p>If not what can be the best way to track it?</p>\n\n<p>For example, adding an insert statement to a information table for every single procedure beginning?</p>\n\n<p>Or is there any better solution for this?</p>\n"},{"tags":["c#","sql-server","parallel-extensions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":13123359,"title":"Invalid attempt to call Read when reader is closed","body":"<p>I have several portions of code in different classes that use this or very similar code to pull back some data from an SQL Server database. Most of them work, but I'm running into a problem on a few and really don't understand why. The code above will execute for 60-64 times, retrieving rows but then it blows up with a invalid read error. ive traced down the records for anything hinkey, but it appears to just hit anywhere between those records and stops. There are no calls out from this class to any other class functions, essentially, this is the onyl thing running.</p>\n\n<p>My connection string has a time out of 600 seconds and I have mars set as well. another note; this is being called from a Parallel.ForEach with the parallelism set to 2.</p>\n\n<p>As i said, I use this structure of code in multiple places through out the program, most of it working great, what worries me is not just the error, but the inconsistancy of its occurance.</p>\n\n<p>when I get rid of the Parallel.ForEach and just run it as foreach, it works. I need those threads though, or this takes far too long. And I'm also curious where the reader is closing.</p>\n\n<p><strong>Exception</strong>: System.InvalidOperationException--Invalid attempt to call Read when reader is closed. </p>\n\n<p><strong>Called Code:</strong></p>\n\n<pre><code> public string GetUnderwritingType(string id)\n    {\n        UnderwritingType uwt = new UnderwritingType();\n        GetRequiredPercent(id, ref uwt);\n        GetParticipation(id, ref uwt);\n        return CalculateUnderwritingType(ref uwt);\n    }\n    private void GetRequiredPercent(string id, ref UnderwritingType uwt)\n    {\n        DataCommon common = new DataCommon(Settings.Default.ReqPercentSP, id);\n        try\n        {\n      /******* Error on this reader statement ********/      \nusing (SqlDataReader reader = common.Command.ExecuteReader(CommandBehavior.CloseConnection))               {\n                /* no data */\n                if (reader.HasRows == false) return;\n                while (reader.Read())\n                {\n                    uwt.RequiredPercent.Add(Double.Parse(reader[REQ_PERCENT_FIELD].ToString()));\n                    uwt.MinimumCount.Add(Int32.Parse(reader[MIN_COUNT_FIELD].ToString()));\n                    uwt.UWType.Add(Int32.Parse(reader[UW_LEVEL_FIELD].ToString()));\n                }\n            }\n        }\n        catch (InvalidOperationException)\n        {\n            if (common.Connection.State == ConnectionState.Open) common.Connection.Close();\n            throw;\n        }\n        catch (SqlException)\n        {\n            if (common.Connection.State == ConnectionState.Open) common.Connection.Close();\n            throw;\n        }\n    }  \n</code></pre>\n\n<p><strong>Code that sets up connection:</strong></p>\n\n<pre><code>   public class DataCommon\n    {\n        private readonly SqlCommand _command;\n        private SqlConnection _connection;\n\n        public DataCommon(string storedProcedure, string id)\n        {\n            SetConnection();\n            _command = new SqlCommand(storedProcedure, Connection);\n            if (_command != null) _command.CommandType = CommandType.StoredProcedure;\n            _command.Parameters.Add(\"@Id\", SqlDbType.NVarChar).Value = id;\n        }\n        /// &lt;summary&gt;\n        ///   Gets the database connection.\n        /// &lt;/summary&gt;\n        public SqlConnection Connection\n        {\n            get { return _connection; }\n        }\n        /// &lt;summary&gt;\n        ///   Gets the database command object.\n        /// &lt;/summary&gt;\n        public SqlCommand Command\n        {\n            get { return _command; }\n        }\n        /// &lt;summary&gt;\n        ///   Sets the database connection.\n        /// &lt;/summary&gt;\n        private void SetConnection()\n        {\n            _connection = new SqlConnection {ConnectionString = Settings.Default.TestConnection};\n            _connection.Open();\n            if (_connection.State != ConnectionState.Open)\n                throw new DataException(Settings.Default.ConnectionErrorMessage);\n        }\n    }\n</code></pre>\n\n<p><strong>Connection string:</strong> Data Source=xxxxx;Initial Catalog=yyyyy;Trusted_Connection=True;MultipleActiveResultSets=True;Connection Timeout=600;</p>\n\n<p><strong>Stack Trace:</strong>\n.Data.SqlClient.SqlDataReader.ReadInternal(Boolean setTimeout)\n   at System.Data.SqlClient.SqlDataReader.Read()\n   at GroupDataAccess.EligibilityClassData.GetEligibilityClass(String id) in C:\\Subversion\\branches\\Fimmas\\FimmasToInfoHub\\GroupHubFeed\\GroupData\\EligibilityClassData.cs:line 95\n   at GroupLogic.GroupExtract.BuildEligibilityClass(String id, Group&amp; group) in C:\\Subversion\\branches\\Fimmas\\FimmasToInfoHub\\GroupHubFeed\\GroupLogic\\GroupExtract.cs:line 188\n   at GroupLogic.GroupExtract.&lt;>c_<em>DisplayClass2.b</em>_1() in C:\\Subversion\\branches\\Fimmas\\FimmasToInfoHub\\GroupHubFeed\\GroupLogic\\GroupExtract.cs:line 113\n   at System.Threading.Tasks.Task.InnerInvoke()\n   at System.Threading.Tasks.Task.Execute()</p>\n\n<p><strong>Initial Call to go through loop</strong> (when converted to normal foreach, everythings fine):</p>\n\n<pre><code>ParallelOptions options = new ParallelOptions();\noptions.MaxDegreeOfParallelism = 2;\nParallel.ForEach(ids, options, id =&gt; BuildGroup(id));\n</code></pre>\n\n<p><strong>calls</strong> </p>\n\n<pre><code>private void BuildGroup(string id)\n{\n   Group[] group = { new Group() };\n    Task eligibilityBlock = Task.Factory.StartNew(() =&gt;\n                                            BuildEligibilityClass(id, ref @group[0]));\n            Task.WaitAny(eligibilityBlock);\n             GroupList.Add(@group[0]);\n}\n</code></pre>\n\n<p><strong>Which calls</strong></p>\n\n<pre><code>    private static void BuildEligibilityClass(string id, ref Group group)\n    {\n        EligibilityClassData eligClassData = new EligibilityClassData();\n        group.EligibilityClassList = eligClassData.GetEligibilityClass(id);\n\n    }\n</code></pre>\n\n<p>which hits into one of those reads.</p>\n"},{"tags":["sql-server","database","oracle","triggers","sybase-ase"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":273,"score":0,"question_id":9639254,"title":"Is it better to have single trigger for Insert/Update/Delete, or multiple?","body":"<p>I have a requirement to mirror insert/update/delete operations from one table to another.\nFor example insert on tableA has to be copied into tableB, update to tableA applied to tableB, and delete from tableA be applied to tableB.\nIt's as simple as that, except tableB has 1 additional column for a constant value, so very simple triggers are needed.</p>\n\n<p>I'm not sure if it is better to write 3 separate triggers, or have one trigger that does all of the operations.</p>\n\n<p>This is for 3 databases: Sybase ASE, MSSQL and Oracle, and I'd like to keep it the solution similar (so either 3 for all databases or 1 for all of them).</p>\n\n<p>Is it just a matter of preference, to have 3 triggers vs. 1, or are there actual benefits to either solution?</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13237818,"title":"Permission Denied Accessing SQL Server Master Database from Windows Service","body":"<p>I have a Windows Service (running as Local System) and it needs to create/drop a database in the local SQL Server Express 2012. Doing so yields an error message:</p>\n\n<blockquote>\n  <p>\"CREATE DATABASE permission denied in database 'master'.\"</p>\n</blockquote>\n\n<p>I can connect to the instance as a local administrator and create/drop databases. Doesn't Local System have sysadmin permission on the local SQL Server? If not, how do I grant it permission?</p>\n"},{"tags":["sql-server","xsd","xml-schema"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13191263,"title":"create xml schema collection maximum value of fractionDigits restriction","body":"<p>I'm trying to load third party XSD Scheme to my SQL Server 2008 throught \"create xml schema collection\" statement</p>\n\n<p>There is a complex type based on \"xs:decimal\" with restrictions: </p>\n\n<pre><code>        &lt;xs:totalDigits value=\"31\"/&gt;\n        &lt;xs:fractionDigits value=\"14\"/&gt;\n</code></pre>\n\n<p>inside the XSD.</p>\n\n<p>And SQL Server returns error</p>\n\n<pre><code>Msg 6960, Level 16, State 2, Line 2\nComponent 'NAME' is outside of allowed range. Maximum for 'fractionDigits' is 10 and maximum number of digits for non fractional part is 28\n</code></pre>\n\n<p>But I still able to create a variable with type \"numeric(31,14)\"</p>\n\n<p>I didn't find any restrictions neither on w3c documentations nor in MSDN. Can you please guide me to some documentation on this restrictions. May be I can fix it with some Service Pack or Setting.</p>\n\n<p>SQL Server version: Microsoft SQL Server 2008 (SP3) - 10.0.5500.0 (X64)   Sep 21 2011 22:45:45   Copyright (c) 1988-2008 Microsoft Corporation  Enterprise Edition (64-bit) on Windows NT 6.1  (Build 7601: Service Pack 1) </p>\n\n<hr>\n\n<p>I found an answer on the MSDN (<a href=\"http://msdn.microsoft.com/en-us/library/ms190665%28v=sql.100%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms190665(v=sql.100).aspx</a>)</p>\n\n<blockquote>\n  <p>SQL Server does not support variable precision decimals. The\n  xs:decimal type represents arbitrary precision decimal numbers.\n  Minimally conforming XML processors must support decimal numbers with\n  a minimum of totalDigits=18. SQL Server supports totalDigits=38, but\n  limits the fractional digits to 10. All xs:decimal instanced values\n  are represented internally by the server by using the SQL type numeric\n  (38, 10).</p>\n</blockquote>\n\n<p>They map xs:decimal not to <em>numeric</em> type, but <em>decimal</em></p>\n"},{"tags":["sql-server","sql-server-2005","common-table-expression","parents"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":4006,"score":4,"question_id":665617,"title":"How to create an SQL Server 2005 CTE to return parent-child records, for children with multiple parents","body":"<p>I'm experimenting with CTE's in SQL Server but have reached a dead end with getting the following scenario to work. I have a hierarchy table similar to this:</p>\n\n<pre><code>Node(ID:439)\n  Node(ID:123)\n    Node(ID:900)        \n  Node(ID:56)\n    Node(ID:900)\n</code></pre>\n\n<p>Expected results:</p>\n\n<pre><code>NodeID ParentNodeID\n439    0\n123    439\n900    123\n56     439\n900    56\n</code></pre>\n\n<p>So basically we have a parent-child hierarchy table, with one subtle difference. Each child could potentially have more then one parent. I have researched many blog articles, and StackOverflow posts, about creating CTE's that return parent-child records, but they don't return all of the parents for the children, just the first one that it finds.</p>\n\n<p>Here's an example CTE that I tried:</p>\n\n<pre><code>WITH Heirarchy(NodeID, ParentNodeID)\nAS\n(\n    SELECT \n        T1.NodeID,\n          T1.ParentNodeID\n    FROM\n        ParentChildTable T1\n    WHERE\n        T1.NodeID = 439\n\n    UNION ALL\n    SELECT \n        T1.NodeID,\n        T1.ParentNodeID\n    FROM\n        Heirarchy T1\n        INNER JOIN Heirarchy TH ON TH.NodeID = T1.ParentNodeID\n)\n</code></pre>\n\n<p>(Note: The names of the tables and columns in the above CTE have been changed from the orginal for privacy purposes.)</p>\n\n<p>The above CTE works fine, it finds all the parent-child records starting from ID:439, but it only finds one parent for item ID:900, even though it has two parents.</p>\n\n<p>Could someone let me know if this is possible using CTE's, or is there another SQL way to do this?</p>\n\n<p>Cheers.\nJas.</p>\n"},{"tags":["sql-server","entity-framework-4.1","ef-code-first"],"answer_count":5,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":946,"score":2,"question_id":8452438,"title":"EF ExecuteStoredCommand with ReturnValue parameter","body":"<p>I'm creating a new application which needs to interface with legacy code :(.</p>\n\n<p>The stored procedure I'm attempting to call uses RETURN for its result. My attempts to execute and consume the return value result in the exception:</p>\n\n<blockquote>\n  <p>InvalidOperationException: When executing a command, parameters must be exclusively database parameters or values.</p>\n</blockquote>\n\n<p>Changing the stored proc to return the value another way isn't desired, since it either requires updating the legacy app or maintaining a nearly duplicate stored proc.</p>\n\n<p>The legacy stored proc synopsis:</p>\n\n<pre><code>DECLARE @MyID INT\nINSERT INTO MyTable ...\nSELECT @MyID = IDENTITY()\nRETURN @MyID\n</code></pre>\n\n<p>My Entity Framework / DbContext work, which yields the above InvalidOperationException.</p>\n\n<pre><code> SqlParameter parm = new SqlParameter() {\n    ParameterName = \"@MyID\",\n    Direction = System.Data.ParameterDirection.ReturnValue\n };\n\n DbContext.Database.ExecuteSqlCommand(\"EXEC dbo.MyProc\", parm);\n</code></pre>\n\n<p>Looking for any and all solutions which don't require the stored proc to be modified.</p>\n"},{"tags":["sql","sql-server","database","query","sql-server-2008-r2"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":78,"score":0,"question_id":11666009,"title":"SQL server query to get this output","body":"<p>I have a query which i am unable to get the output.\nBelow is the query to be executed</p>\n\n<p>Q: 2.   Write a query to find the city Name, Id and Count that has got maximum number of vehicles associated.</p>\n\n<p>Now, Given is the one table on which the query should be executed.</p>\n\n<pre><code>Vehicle_Detail_ID   City_ID\n56                    242\n57                    242\n58                    242\n59                    243\n60                    241\n61                    242\n62                    245\n</code></pre>\n\n<p>Another table which has the city name</p>\n\n<pre><code>City_ID City_Name\n242          Bangalore\n243          ChamarajNager\n241          Bellary\n245          Chitradurga\n</code></pre>\n\n<p>EXPECTED OUTPUT: </p>\n\n<pre><code>City_ID No_Vehicles\n242          4\n</code></pre>\n\n<p>Please tell me how to write the query which fetches me the right output.</p>\n\n<p>Given below is the query which gives the city Id and its vehicle count.\nTRIED: </p>\n\n<pre><code>SELECT c.city_id, COUNT(c.City_ID) AS NO_vehicles\n  FROM city c, vehicle_details v \n WHERE c.City_ID = v.City_ID\n GROUP BY c.City_ID\n</code></pre>\n\n<p>ACTUAL OUTPUT </p>\n\n<pre><code>City_ID No_Vehicles\n242             4\n243             1\n241             1\n245             1\n</code></pre>\n\n<p>Please help me to get max of these as shown in EXPECTED OUTPUT.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":3,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":1038,"score":5,"question_id":3650690,"title":"SQL SERVER Foreign Keys and Indexes","body":"<p>Is it a good practice to create an index to every foreing key  in my database?</p>\n"},{"tags":[".net","sql-server","sqlbulkcopy"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":954,"score":1,"question_id":4431273,"title":"SqlBulkCopy with different collations","body":"<p>I need to migrate data from one DB to another. I choosed to use SqlBulkCopy, but have a problem with it, because source database has different collation than destination, so, I've got an exception:</p>\n\n<pre><code>System.InvalidOperationException: The locale id '1049' of the source column 'Id' and the locale id '1033' of the destination column 'Id' do not match.\n   at System.Data.SqlClient.SqlBulkCopy.AnalyzeTargetAndCreateUpdateBulkCommand(BulkCopySimpleResultSet internalResults)\n   at System.Data.SqlClient.SqlBulkCopy.WriteToServerInternal()\n   at System.Data.SqlClient.SqlBulkCopy.WriteRowSourceToServer(Int32 columnCount)\n   at System.Data.SqlClient.SqlBulkCopy.WriteToServer(IDataReader reader)\n   at MigrateToNormalized.DirectMapCommand.Migrate(SqlConnection source, SqlConnection destination, SqlTransaction transaction) in D:\\Projects\\APS\\DTE\\MigrateTo\nNormalized\\MigrateToNormalized\\MigrateToNormalized\\DirectMapCommand.cs:line 53\n   at MigrateToNormalized.Program.Main(String[] args) in D:\\Projects\\APS\\DTE\\MigrateToNormalized\\MigrateToNormalized\\MigrateToNormalized\\Program.cs:line 32\n</code></pre>\n\n<p>Can anyone tell me, how to resolve this issue without direct usage of COLLATE statements in SQL query? Is there some easy way to change collation for all columns in source database?</p>\n"},{"tags":["sql-server","azure","sql-azure"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13241417,"title":"How to query the Sql azure federation tables","body":"<p>I have been through many federation tutorials, but all of them are dealing with how to get data into the federations and somehow missing the part that explains how to query the data after it's there.</p>\n\n<p>I found in the documentation that you cannot join between federation tables.  I wonder, how exactly do I query the tables? Will my current SPs continue to work with the new federation DBs? Is there any advanced tutorial on how to query the data?</p>\n"},{"tags":["sql-server","microsoft","amazon-rds","sql-management-studio"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":30,"score":2,"question_id":13242170,"title":"Where to get Microsoft SQL Management Studio when using Amazon RDS SQL servers?","body":"<p>My company is interested in using Amazon's RDS service for our Microsoft SQL Server Web Edition. However, we are a bit confused on how to actually connect to the database to initialize it.</p>\n\n<p>In the Amazon <a href=\"http://docs.amazonwebservices.com/AmazonRDS/latest/UserGuide/USER_ConnectToMicrosoftSQLServerInstance.html\" rel=\"nofollow\">Getting Started Documentation</a> it simply says \"2. Run Microsoft SQL Server Management Studio\". Where would I obtain this management studio if the reason I am using Amazon RDS is to avoid buying a SQL Server license in the first place? Are there other programs that can do the same?</p>\n\n<p>The connection settings from there seems very straight forward, but we're left looking for the actual software to connect.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13242261,"title":"sql server query on condition","body":"<p>There is a table:</p>\n\n<pre><code>ID   Name   Rank\n1    X       Professor\n2    X       Principal\n3    X       Term Prof\n4    X       assistant\n</code></pre>\n\n<p>What I want is want to write the stored procedure to select the last professor rank or assistant rank depending on the input. Here is the format of the stored proc:</p>\n\n<pre><code>create procedure proc_name(@includeassistant varchar(3))\n\nend\n</code></pre>\n\n<p>if includeassistant is \"yes\" then assistant then the last row must be displayed if include assistant is no then Term prof row must be given.\n</p>\n"},{"tags":["sql","sql-server","xml","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13242295,"title":"Add elements and attributes to XML column based on criteria?","body":"<p>With the following, I'd like to add <code>../attrdomv/udom/'some text'</code> within each <code>attr</code> node, of which there are many. However, based on the value of <code>attrlab</code>, 'some text' will be different for each element. I hope that makes sense. I initially considered reconstructing the entire xml column, but <code>'many nodes and elements'</code> contains attributes that are specific to a row, and not easy to reproduce prorgammatically. <code>../attrdomv/udom/'some text'</code> will be the same across each row. Here is a snippet of an existing column:</p>\n\n<pre><code>&lt;metadata xml:lang=\"en\"&gt;\n&lt;many nodes and elements&gt;\n  &lt;eainfo&gt;\n    &lt;detailed Name=\"fire.DBO.labels\"&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;OBJECTID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;OBJECTID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;OID&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdef Sync=\"TRUE\"&gt;Internal feature number.&lt;/attrdef&gt;\n        &lt;attrdefs Sync=\"TRUE\"&gt;Esri&lt;/attrdefs&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Sequential unique whole numbers that are automatically generated.&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;FeatureID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;FeatureID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;ZOrder&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;ZOrder&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;SymbolID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;SymbolID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n      &lt;/attr&gt;\n    &lt;/detailed&gt;\n  &lt;/eainfo&gt;\n&lt;/metadata&gt;\n</code></pre>\n\n<p>...and here is my desired result:</p>\n\n<pre><code>&lt;metadata xml:lang=\"en\"&gt;\n&lt;many nodes and elements&gt;\n  &lt;eainfo&gt;\n    &lt;detailed Name=\"fire.DBO.labels\"&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;OBJECTID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;OBJECTID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;OID&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdef Sync=\"TRUE\"&gt;Internal feature number.&lt;/attrdef&gt;\n        &lt;attrdefs Sync=\"TRUE\"&gt;Esri&lt;/attrdefs&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Sequential unique whole numbers that are automatically generated.&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;FeatureID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;FeatureID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Sequential unique GUID's that are automatically generated.&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;ZOrder&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;ZOrder&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Order of the Z&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;SymbolID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;SymbolID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Symbol Identifier GUID &lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n    &lt;/detailed&gt;\n  &lt;/eainfo&gt;\n&lt;/metadata&gt;\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13242004,"title":"How do I display different values as different columns in SQL?","body":"<p>I have a table with columns <code>UserID, SiteID, SiteViews</code> and another with <code>UserID, First, Last</code></p>\n\n<p>And I need to display the data as <code>First + Last, Site1Views, Site2Views</code></p>\n\n<p>There are only 2 site IDs and I need to have the sum of the SiteViews per User.</p>\n\n<p>Currently I have:</p>\n\n<pre><code>select s.UserFirstName + ' ' + s.UserLastName as 'Name', \nj1.SiteViews as 'Site1Name',\nj2.SiteViews as 'Site2Name' \nfrom (Users s INNER JOIN Usage j on s.UserID = j.UserID)\n</code></pre>\n\n<p>I don't know how to do this. Any help would be appreciated.</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":6,"score":1,"question_id":13241942,"title":"What is spt_columns_odbc_view and why is it not accessible?","body":"<p>I did <code>sp_helptext 'sys.sp_columns'</code> and saw that the the underlying table is <code>sys.spt_columns_odbc_view</code>, but I could not execute queries as I get <code>Invalid object name 'sys.spt_columns_odbc_view'</code>. </p>\n\n<p>Is this system table not queryable or am I lacking rights? Not much documentation is provided in msdn. </p>\n"},{"tags":["jquery","sql-server","ajax","mobile","asp-classic"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":123,"score":0,"question_id":12458855,"title":"JQuery Mobile and SQL Server for Hybrid Application","body":"<p>I'm interested to know if anyone has done any work in JQuery Mobile with classic ASP. It seems that PHP is a widely used server-side language with JQM but I can't seem to find anything with good ol' CLASP (I know it's old tech, but it's similarities to PHP are quite interesting). I have a long history with classic asp and would like to use that as opposed to learning PHP (if I avoid it).</p>\n\n<p>Here are the details ...</p>\n\n<p>I have an existing SQL database (on my server) with customer information that I want to simply list in JQM. It would be a three page app:\nPage1 - Logon (user authentication)\nPage2 - customer listing based on the customers associated (in the database) with the user's credentials\nPage3 - customer details - details of the selected customer from Page2</p>\n\n<p>When the user submits the logon form, the app goes to the server and gets credentials. Those credentials are then used on Page2 to list the customers that have the user's ID as the account manager. The user then clicks a customer, and the customerID is passed to the customer details page which is used to pull specific customer data from the database.</p>\n\n<p>The main difficulties I am having are -\n. the connection the SQL server database. How does javascript connect to the server-side and retrieve data? AJAX, JSON, web service?\n. how do I pass data from page to page? Credentials from the logon form, customer ID to the customer details page.</p>\n\n<p>My preference would be to use ASP, with AJAX/JSON calls to populate the server-side data but I don't know where to start. Any assistance would be much appreciated. I would be happy to give some advertising space on my blog to anyone who can give a well-detailed explanation.</p>\n\n<p>Thanks\nSteven\nw: <a href=\"http://www.stevenwoolston.com\" rel=\"nofollow\">http://www.stevenwoolston.com</a></p>\n"},{"tags":["sql","sql-server","stored-procedures","return-value"],"answer_count":5,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":7151,"score":7,"question_id":1035789,"title":"Return value from a stored proc on error","body":"<p>I have an sp in SQL Server that when errors returns -4</p>\n\n<p>What does -4 mean? Is there a table somewhere explaining what the possible return values are?</p>\n\n<hr>\n\n<p>There must be some standard</p>\n\n<p>For example</p>\n\n<pre><code>declare @RetVal int  \nEXEC @RetVal = stpTest  \nselect @RetVal\n</code></pre>\n\n<p>where stpTest is \"SELECT 1/0\" returns -6. </p>\n\n<p>-6 must mean something!</p>\n\n<hr>\n\n<p>The sp that returned -4 only has UPDATE and SELECT INTO statements in it.</p>\n\n<p>At no point does it do 'SELECT -4' so how can I \"find out what -4 means in that particular stored procedure\"?</p>\n\n<p>Also, if there is no standard then why does a divide by zero error always return -6?</p>\n\n<hr>\n\n<p>If you have an sp that does not return anything i.e. it doesn't have any select statements in it and you do:    </p>\n\n<pre><code>declare @RetVal int  \nEXEC @RetVal = yourSPName  \n</code></pre>\n\n<p>Then @RetVal will have a value of 0. </p>\n\n<p>If there is an error then @RetVal will be a value other then zero, for example if the only thing your sp does is \"SELECT 1/0\" then @RetVal will be -6.</p>\n\n<p>Try it and see</p>\n\n<p>My question is what do these return values mean? They must have some logical meaning! </p>\n"},{"tags":["sql","sql-server","sql-server-2008","table-valued-parameters"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13240720,"title":"Doing an existance check using a subquery with 'LIKE' on a table valued parameter","body":"<p>I am doing an import from excel into the database. I am passing a table valued parameter with a bunch of values, one of them being a foreign key. The catch is that in the database the key value is an <code>nvarchar</code> that always will have 2 or 3 zeroes in front of it, however the people that send the excel files did not properly format the column and those leading zeroes are cut off.</p>\n\n<p>The first thing I need to do in the procedure is to check that all these values exist in a parent table using <code>LIKE</code> (since the leading zeroes are missing). If any of the values don't exist in the parent table then the transaction does not proceed.</p>\n\n<p>I need some help with the MS SQL syntax for this.</p>\n"},{"tags":["c++","sql-server","database","odbc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13238821,"title":"trying to connect to MSSQL through a C++ ODBC connection but cant find the right demo","body":"<p>I am programming on my macbook pro and need to connect to my company's MSSQL server for programming a commercial product.</p>\n\n<p>How do you actually connect to it?  I was looking on the MSDN website, and i didnt quite get it.</p>\n\n<p>for the purposes of my demo, i was just going to create a new project within XCODE and just create a console application which will output the data.  Once that it set up, ill implement different things with the connection.</p>\n\n<p><strong>Edit:  Added some code:</strong></p>\n\n<pre><code>#include &lt;iostream&gt;\n//#include &lt;windows.h&gt;\n#include &lt;sqlext.h&gt;\n#include &lt;sqltypes.h&gt;\n#include &lt;sql.h&gt;\n\nusing namespace std;\n\nint main(int argc, const char * argv[])\n{\nSQLHENV hEnv;\nSQLHDBC hDbc;\nstring connection = \"AAA\";\nstring db = \"DB\";\nstring user = \"user\";\nstring pass = \"password\";\nstring data = \"DRIVER={SQL Server Native Client 11.0};SERVER=\"+connection+\";DATABASE=\"+db+\";UID=\"+user+\";PWD=\"+pass+\";\";\n//SQLCHAR* pwszConnStr = (SQLCHAR*)(\"Driver={SQL Server Native Client 11.0};Server=\"+connection+\";Database=\"+db+\";Uid=\"+user+\";Pwd=\"+pass+\";\");\nSQLCHAR* pwszConnStr = (SQLCHAR*)data.c_str();\n//cout  &lt;&lt; data &lt;&lt; endl;\ncout  &lt;&lt; pwszConnStr &lt;&lt; endl;\n//error seems to occur in 1 of the 3 SQL statements below.\nSQLAllocHandle(SQL_HANDLE_ENV, SQL_NULL_HANDLE, &amp;hEnv);\nSQLSetEnvAttr(hEnv, SQL_ATTR_ODBC_VERSION, (SQLPOINTER)SQL_OV_ODBC3, 0);\nSQLAllocHandle(SQL_HANDLE_DBC, hEnv, &amp;hDbc);\n\nRETCODE rc = SQLDriverConnect(hDbc, NULL, pwszConnStr, SQL_NTS, NULL, 0, NULL, SQL_DRIVER_PROMPT);\n\nif(rc == SQL_SUCCESS){\n    cout &lt;&lt; \"Connected to the Database\" &lt;&lt; endl;\n}else{\n    cout &lt;&lt; \"No Connection Established\" &lt;&lt; endl;\n}\n\n\nreturn 0;\n}\n</code></pre>\n\n<p>It fails to compile, and i am thinking it is related to me commenting out the windows.h file.  The issue is that windows.h is not found on my macbook pro and figure it is when developing in VStudios.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":48,"score":0,"question_id":13240298,"title":"Remove numbers from string sql server","body":"<p>I have a large database in which I want to do a part string search. The user will enter characters: <code>JoeBloggs.</code></p>\n\n<p>For arguments sake if I had a name <code>Joe 23 Blo Ggs 4</code> in the database. I want to remove everything in the name other than A-Z. </p>\n\n<p>I have the <code>REPLACE(Name, ' ','')</code> function to remove spaces and the <code>UPPER()</code> function to capitalize the name.</p>\n\n<p>Is there a more efficient fast way maybe by terms of regex to replace anything other than A-Z. I cannot change the values in the database.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["ruby-on-rails","sql-server","osx","unixodbc","iodbc"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":233,"score":1,"question_id":9925843,"title":"unixodbc and freetds setup on OSX and Rails 2.3.x","body":"<p>I'm trying to set up unixodbc on OSX (10.7.3), but it looks like iODBC is on the way. </p>\n\n<p>My config/database.yml:</p>\n\n<pre><code>development:\n  adapter: sqlserver\n  encoding: UTF8\n  mode: odbc\n  username: user\n  password: passwd\n  dsn: MY_DSN\n</code></pre>\n\n<p>ruby-obdc is installed and in the Gemfile:</p>\n\n<pre><code>gem 'ruby-odbc', :require =&gt; 'odbc_utf8'\n</code></pre>\n\n<p>/usr/local/etc/freetds.conf:</p>\n\n<pre><code>[MY_SERVER]\nhost = host.bla.com\nport = 1433\ntds version = 8.0\nclient charset = UTF-8\n</code></pre>\n\n<p>/usr/local/etc/odbc.ini</p>\n\n<pre><code>[MY_DSN]\nDriver=/usr/local/lib/libtdsodbc.so\nDescription=Sql Server Local\nServername=MY_SERVER\nPort=1433\nDatabase=my_database\n</code></pre>\n\n<p>When I run <code>script/console</code> and try to access any model:</p>\n\n<blockquote>\n  <blockquote>\n    <p>Product\n       ODBC::Error: IM002 (0) [iODBC][Driver Manager]Data source name not found and no default driver specified. Driver could not be loaded</p>\n  </blockquote>\n</blockquote>\n\n<p>It seems iODBC is being used to connect to the database, when I want to use unixodbc. How can I make my rails app use unixodbc instead of iODBC?</p>\n"},{"tags":["php","sql-server","odbc","connect","freetds"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":12252005,"title":"Cannot connect to MSSQL 2008 db from php using odbc and freetds","body":"<p>I have been searching everywhere for solutions, but am getting more and more confused. </p>\n\n<p>I am trying to connect to a SQL Server 2008 db from php using FreeTDS. The server is a MediaTemple DV 4.0 and it is running CentOS 5.7.  I have a version of FreeTDS (v0.91) installed that I think I might have compiled several months back. When I run tsql -C it says my freetds.conf is in /usr/local/etc and a TDS version 5.0.  I need it to be TDS version 7.0, but when I change that conf file, it does not change. And I can't find the conf file it is using. (problem 1)</p>\n\n<p>I can connect to my db using tsql -H -p -U and run a query.  However in my php file, I get IM002 error which I believe is a connection error to the db.  I use odbc_connect for that. (problem 2, the biggest problem) </p>\n\n<p>I don't even know where to start, as I have been installing, uninstalling for about the last 2 months...</p>\n\n<p>I would welcome any suggestion on how to resolve the issue. As a side note, it used to work before I upgraded my DV at MediaTemple. </p>\n\n<p>Thanks!\nShawn</p>\n\n<p>Here is my tsql -C</p>\n\n<p>Compile-time settings (established with the \"configure\" script)\n                            Version: freetds v0.91\n             freetds.conf directory: /usr/local/etc\n     MS db-lib source compatibility: no\n        Sybase binary compatibility: no\n                      Thread safety: yes\n                      iconv library: yes\n                        TDS version: 5.0\n                              iODBC: no\n                           unixodbc: yes\n              SSPI \"trusted\" logins: no\n                           Kerberos: no</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13238927,"title":"why sql server not showing in odbc list?","body":"<p>i have sql server 2008 r2 installed in my server on network and i want to make odbc connection to this server from other device on network, but the problem that the sql server not show in the odbc list  .\nnote : the pc is pinging the server and the port 1433 is opened on the server.</p>\n"},{"tags":["sql-server","view","group-by","multiple-tables"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13239820,"title":"MS Version of This MySQL View with GROUP BY?","body":"<p>I was shown the ease that one can make a view from multiple tables, GROUPing BY an id of one of the tables in xception's awesome answer here: <a href=\"http://stackoverflow.com/questions/12761706/create-view-where-selectid-viewrowid\">CREATE VIEW WHERE SELECTid = VIEWrowID</a></p>\n\n<p>Is there any way to do that in MS?  Everywhere, I've read says \"no\", but no page gives an alternative.</p>\n\n<p>I don't need the counts or anything, just multiple columns from multiple tables GROUPed BY(?) a single column on one table.</p>\n\n<p>Thanks a lot in advance!</p>\n\n<p><strong>EXAMPLE</strong> </p>\n\n<p>Thank-you for responding.</p>\n\n<p>For the view's SELECT:</p>\n\n<pre><code>SELECT dbo.table1.column1 AS table1column1,\n       dbo.table1.column2 AS table1column2,\n       dbo.table2.column1 AS table2column1,\n       dbo.table2.column2 AS table2column2\nFROM table1, table2\nWHERE table2.column1 = table1.column1\nGROUP BY table1.column1\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server","c#-2.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":7,"view_count":86,"score":-7,"question_id":13239201,"title":"trying to save data in sql database","body":"<p>I am trying to save a response to a sql database. The response is in xml and it's of an unpredictable size: it may be 100000 or more characters.</p>\n\n<p>When I am getting response and trying to save to the database, it is not saving the full response.</p>\n\n<p>www.telcodata.us/query/queryareacodexml.html?npa=201</p>\n\n<p>This code is using asp.net and c#:</p>\n\n<pre><code>str = string.Empty;\nstr = \"npa=\" + Convert.ToString(i);\npUrl = string.Format(\"http://www.telcodata.us/query/queryareacodexml.html\");\n\nWebRequest webRequest = WebRequest.Create(pUrl);\n\nwebRequest.ContentType = \"application/x-www-form-urlencoded\";\nwebRequest.Method = \"POST\";\nbyte[] bytes = Encoding.ASCII.GetBytes(str);\nStream os = null;\ntry {\n    webRequest.ContentLength = bytes.Length;   \n    os = webRequest.GetRequestStream();\n    os.Write(bytes, 0, bytes.Length);        \n} catch (WebException ex) {\n    //\n} finally {\n    if (os != null) {\n        os.Close();\n    }\n}\n\ntry {\n    WebResponse webResponse = webRequest.GetResponse();\n    if (webResponse == null)\n    { Response.Write(\"&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;Nothing output&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;\"); }\n\n    StreamReader sr = new StreamReader(webResponse.GetResponseStream());\n\n    SqlConnection conn = new SqlConnection(            System.Configuration.ConfigurationManager.ConnectionStrings[\"DB_CONNSTRING\"].ConnectionString);\n    SqlCommand cmd = new SqlCommand(\"usp_insertPhoneDataFetch\",conn);\n    cmd.CommandType = CommandType.StoredProcedure;                    \n    cmd.Parameters.AddWithValue(\"@areaCode\",i);\n    cmd.Parameters.AddWithValue(\"@dataFetch\",sr.ReadToEnd());\n    conn.Open();\n    cmd.ExecuteNonQuery();\n    conn.Close();                   \n\n} catch (WebException ex) {\n    //\n}\n</code></pre>\n\n<p>--</p>\n\n<pre><code>CREATE TABLE [dbo].[tbl_phonedatafetch](    [tid] [int] IDENTITY(1,1)\nNOT NULL,   [areaCode] [int] NULL,  [data] [text] NULL,\n[dateSubmitted] [datetime] NOT NULL ) ON [PRIMARY] TEXTIMAGE_ON\n[PRIMARY]\n\nGO\n\nALTER TABLE [dbo].[tbl_phonedatafetch] ADD  CONSTRAINT\n[DF_tbl_phonedatafetch_dateSubmitted]  DEFAULT (getdate()) FOR\n[dateSubmitted] GO\n\n\nALTER PROCEDURE [dbo].[usp_insertPhoneDataFetch]     \n@areaCode as int,\n@dataFetch as nvarchar(Max)  \nAS\nBEGIN\ninsert into tbl_phonedatafetch&gt; (areaCode,data) values (@areaCode,@dataFetch)    \nEND\n</code></pre>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":49,"score":3,"question_id":13238866,"title":"Stored procedure containing inner join with count not working","body":"<p>Let's say i've got a databasetable looking a bit like this, containing information about some assignments.</p>\n\n<pre><code>Id   | ProfessionId      | Title       | Deadline     | DateCreated | ClosingDate\n1    |  5                | Something   | 01-12-2012   | 05-11-2012  | 12-11-2012\n2    |  6                | Something   | 01-12-2012   | 05-11-2012  | 12-11-2012\n3    |  7                | Something   | 01-12-2012   | 05-11-2012  | 12-11-2012\n4    |  7                | Something   | 01-12-2012   | 05-11-2012  | 12-11-2012\n</code></pre>\n\n<p>I want to generate an overview foreach profession (assignments belong to a certain profession) and count the number of assignment in each profession. The overview coming from the database should look like this;</p>\n\n<pre><code>Id | Name           | FriendlyUrl     | Ordinal   | NumberOfAssignments\n5  | Profession 1   | profession-1    | 1         | 1\n6  | Profession 2   | profession-2    | 1         | 1\n7  | Profession 3   | profession-3    | 1         | 2\n8  | Profession 4   | profession-4    | 1         | 0\n</code></pre>\n\n<p>I've currently got a stored procedure returning the overview above, except that the amount of assignments isn't correct. Assignments with a closingdate in the past (we then assume the assignment is closed) shouldn't be taken into the the total number of assignment.</p>\n\n<p>The current stored procedure is like this:</p>\n\n<pre><code>BEGIN\n    SELECT  p.Id, \n            p.Naam, \n            p.FriendlyUrl, \n            p.Ordinal, \n            COUNT(a.ProfessionId) AS NumberOfAssignments\n    FROM ME_Profession AS p \n    LEFT OUTER JOIN ME_Assignment AS a ON a.ProfessionId = p.Id\n    INNER JOIN ME_Client AS c ON a.ClientId = c.Id\n    INNER JOIN aspnet_Membership AS m ON m.UserId = c.UserId\n    WHERE m.IsApproved = 1 \n    GROUP BY p.Id, p.Naam, p.FriendlyUrl, p.Ordinal\nEND\n</code></pre>\n\n<p>I've already came up with and modified procedure like the one below, but it doesn't work. It feels like i'm either thinking too difficult or missing something obvious. What could go wrong?</p>\n\n<pre><code>SELECT        p.Id, p.Naam, p.FriendlyUrl, p.Ordinal, pc.NumberOfAssignments\nFROM            ME_Profession AS p \nINNER JOIN ME_Assignment AS a ON a.ProfessionId = p.Id \nINNER JOIN ME_Client AS c ON a.ClientId = c.Id\nINNER JOIN aspnet_Membership AS m ON m.UserId = c.UserId\nINNER JOIN (SELECT a2.ProfessionId, COUNT(*) AS NumberOfAssignments FROM ME_Assignment AS a2 GROUP BY a2.ProfessionId WHERE a2.Closingdate &gt; GETDATE()) pc ON p.ProfessionId = pc.ProfessionId\nWHERE        m.IsApproved = 1 AND a.Closingdate &gt; GETDATE()\nGROUP BY p.Id, p.Naam, p.FriendlyUrl, p.Ordinal\n</code></pre>\n\n<p><strong>UPDATE 1:</strong> Added where condition for date</p>\n"},{"tags":["sql-server","query","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13234761,"title":"Multiple rows in one","body":"<p>I know there are similar questions like mine but unfortunately I haven't found the corresponding solution to my problem.</p>\n\n<p>First off here's a simplified overview of my tables:</p>\n\n<ul>\n<li><p><code>Partner</code> table: <code>PartnerID, Name</code></p></li>\n<li><p><code>Address</code> table: <code>PartnerID, Street, Postcode, City, ValidFrom</code></p></li>\n<li><p><code>Contact</code> table: <code>PartnerID, TypID, TelNr, Email, ValidFrom</code></p></li>\n</ul>\n\n<p>A partner can have one or more addresses as well as contact info. With the contact info a partner could have let's say 2 tel numbers, 1 mobile number and 1 email. In the table it would look like this:</p>\n\n<pre><code>PartnerID   TypID   TelNr                   Email               ValidFrom\n1           1       0041 / 044 - 2002020                        01.01.2010\n1           1       0041 / 044 - 2003030                        01.01.2011\n1           2       0041 / 079 - 7003030                        01.04.2011\n1           3                               myemail@hotmail.com 01.06.2011\n</code></pre>\n\n<p>What I need in the end is, combining all tables for each partner, is like this:</p>\n\n<pre><code>PartnerID   Name    Street              Postcode        City            TelNr                               Email\n1           SomeGuy MostActualStreet    MostActualPC    MostActualCity  MostActual Nr (either type 1 or 2)  MostActual Email\n</code></pre>\n\n<p>Any help?</p>\n"},{"tags":["sql","sql-server","query","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13239312,"title":"Return 4 separate counts for single column in SSRS DataSet","body":"<p>I want to provide 5 counts to SSRS from a conditional count on a column.  For instance, suppose the column held the color of a product -- green ,blue, red and yellow.  What I would like to do is return the count of each in a single query.</p>\n\n<p>Although I can accomplish getting this done using a case statement:</p>\n\n<pre><code>Select\n      COUNT(*) 'Count',\n      case\n            When Color = 'BL' then 'Blue\n            When Color = 'RD' then 'Red\n            When Color = 'YL' then 'Yellow\n            When Color = 'GR' then 'Green\n            Else 'All Others'\n      End as Payment\nFrom COLORS(NoLock)\nGroup by\n      case\n            When Color = 'BL' then 'Blue\n            When Color = 'RD' then 'Red\n            When Color = 'YL' then 'Yellow\n            When Color = 'GRthen Green\n            Else 'All Others'\n      End\n</code></pre>\n\n<p>When I use the dataset is SSRS, all I get is the a single count.  I don't want to create 4 dataset queries as I'm actually selection the records by the parameters start and end date and I would end up having 5 sets of date parameters. </p>\n"},{"tags":["sql-server","sql-server-2008","user-permissions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2505,"score":0,"question_id":5362206,"title":"SQL Server 2008 user permissions","body":"<p>I am using SQL Server 2008 with SQL authentication... I wanna know permissions given to a particular users.... it should list all the permissions given to a particular user for a particular databases... plz reply fast...</p>\n"},{"tags":["c#","sql-server","installation","components","smo"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":13166278,"title":"How to reliably determine which components of SQL Server 2008 are installed, using C#?","body":"<p>I want to achieve the following programatically using C#.</p>\n\n<p>Query components installed in SQL Server 2008\ne.g</p>\n\n<ol>\n<li>Upgrade Tools</li>\n<li>Debug Symbols</li>\n<li>Replication Support</li>\n<li>Books Online</li>\n<li>Development Tools</li>\n</ol>\n\n<p>I have tried using SMO API for SQL Server tried to query Information Collection as well Configuration collection but could not find the any of the above three points.</p>\n\n<p>I need to be able to programmatically determine which SQL Server 2008 components are installed and which are not installed, just like SQL Server Installation setup which first checks to see which components are installed.</p>\n\n<p>One way is to query SQL Server Installation Log File, but it is not helpful if SQL Server is completely no there or if someone has deleted that log file. </p>\n\n<p>I need to reliably determine the installed SQL Server components</p>\n\n<p>Please help.</p>\n\n<p>Thanks</p>\n\n<p>Steve</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13238109,"title":"SQL Job Scheduler UI in silverlight","body":"<p>I use this query to get the values of a job and display it in a silverlight control. The UI is exactly like the SQL Job Scheduler UI. But I having hard time deciphering the numeric values in sysschedules to UI Elements.</p>\n\n<p>Especially the week, each value is multiplied by itself and 2. For eg, Sunday=1, Monday=2, Tuesday=4, Wed=8, Thu=16, Fri=32, Sat=64.\nIn sysschedules it's stored in combination of the values. For eg, if Fri and Sat are checked the freq_interval=96 (64+32), if all the days are checked it's value would be 127.</p>\n\n<p>My question is, is there a formula or something to know what days are selected using the numeric value.</p>\n\n<pre><code> SELECT   \n  schedule_id  \n  ,schedule_uid  \n  ,originating_server_id  \n  ,name  \n  ,owner_sid  \n  ,enabled  \n  ,freq_type  \n  ,freq_interval  \n  ,freq_subday_type  \n  ,freq_subday_interval  \n  ,freq_relative_interval  \n  ,freq_recurrence_factor  \n  ,dbo.FormatDate(active_start_date) as active_start_date  \n  ,dbo.FormatDate(active_end_date) as active_end_date  \n  ,dbo.FormatTime(active_start_time) as active_start_time  \n  ,dbo.FormatTime(active_end_time) as active_end_time  \n  ,date_created  \n  ,date_modified  \n  ,version_number  \n FROM msdb.dbo.sysschedules WHERE schedule_id=@scheduleId  \n</code></pre>\n"},{"tags":["sql","sql-server","database","database-design","database-schema"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":25,"score":-2,"question_id":13238584,"title":"good ebooks/resources for designing a database for Reporting & analysis purposes","body":"<p>I am working on designing a seperate database in Sql Server for analysis and reporting purposes.</p>\n\n<p>I searched online and found the below link to be somewhat useful:\n<a href=\"http://stackoverflow.com/questions/3331637/when-to-build-a-separate-reporting-database\">When to build a separate reporting database?</a></p>\n\n<p>I also denormalized some of the tables where I felt are necessary.</p>\n\n<p>I would like to know if someone could point me out to any resources ebooks/tutorials/blogs that would exclusively focus on designing of databases for analysis and reporting purposes.</p>\n\n<p>We currently have around 1TB of data within the database and the data is expected to grow\ntremendously within the coming months.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":13238668,"title":"Select into a view","body":"<p>I have a simple CTE <code>x</code> and I wish to select its contents into a view.  Can you select into a view using the same type of syntax that you can for a table? i.e.</p>\n\n<pre><code>SELECT * \nINTO newTable\nFROM OldTable\n</code></pre>\n\n<p>Can new views be created dynamically like this?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13238568,"title":"Filling Missing Values in Column","body":"<pre><code>Item  ID\nNULL  1\nNULL  2\n3     3\nNULL  4\nNULL  5\n</code></pre>\n\n<p>Im trying to get the output as</p>\n\n<pre><code>Item  ID\n1     1\n2     2\n3     3\n4     4\n5     5\n</code></pre>\n\n<p>using cursors i updated the bottom 2 nulls as 4 and 5 \nand using flags i have counted the NULLs above 3 but i cant access the top 2 positions ?\nis the approach correct ? </p>\n"},{"tags":["sql-server","network-protocols"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13238219,"title":"SQL Server Express cannot connect error: 28 - Server doesn't support requested protocol","body":"<p>I cannot connect to my local SQL Server Express (2012, but the version shouldn't matter) from my server (Windows 2008 R2) to use a tool on it (APEX SQL Data Diff if you are wondering). I can browse the network servers fine, and select my local instance from the dropdown of available servers, but when I go to search tables on the server, it times out with this error message (same is true of SSMS).</p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: SQL\n  Network Interfaces, error: 28 - Server doesn't support strong text\n  requested protocol) (Microsoft SQL Server, Error: -1)</em></p>\n</blockquote>\n\n<p>I have enabled the firewall - that's not it.</p>\n\n<p>I have allowed remote connections - that's not it.</p>\n\n<p>SQL Server Browser service is on and passed through the firewall - that's not it.</p>\n\n<p>I can connect fine with the same tools <strong><em>TO</em></strong> the server, but <strong><em>FROM</em></strong> the server it fails.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql-server","asp.net-mvc","linq"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13238522,"title":"SQL/Linq coding for a search feature in MVC app - best practice","body":"<p>I have a section of an ASP MVC app I building that displays an info sheet regarding a person, then there is a button which will allow the user to search the database, to see if this person is already in the database before saving the record.  If the record exists, then the feature needs to overwrite certain fields in the DB, kind of a 'search and merge/update'.  </p>\n\n<p>I am pretty sure this will go beyond my LINQ skills, so I am thinking of doing a stored proc, but I wanted to poll the masses to see what the accepted best practice is for something like this.</p>\n\n<p>Thank you for reading, and for your opinion.</p>\n"},{"tags":["sql-server","entity-relationship","sql-scripts"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13238452,"title":"Sql Server docs from create script","body":"<p>I have the create script of a rather big database (for Microsoft Sql Server) for which I'd like to have the entity-relationship model. What tools can I use to obtain this model (without having to read the script and draw it by hand...).</p>\n\n<p>If there are tools that can run natively in Mac OSX that would be great.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":13234067,"title":"How to write IN clause query to replace null for no value parameter","body":"<p>I am writing a query in which where clause have IN clause and there are large number of values in this IN clause , I want to fetch the result such that if there is no value exist in table for value given in IN clause then a raw containing 0 or null should return for that value. for example..</p>\n\n<pre>\nselect age,sex,date_joining from emp where name IN ('amit','john','paul','dilip')\n</pre>\n\n<p>Now assume for this query ,data for john and paul does not exist in database then result should be like below..</p>\n\n<pre>\n21    male   21-AUG-2011\nnull  null   null\nnull  null   null\n25    male   9-aug-2010\n</pre>\n\n<p>we can also have 0 instead of null if null is not possible</p>\n\n<p>Thanks...</p>\n"},{"tags":["sql-server","caching"],"answer_count":4,"favorite_count":11,"up_vote_count":32,"down_vote_count":0,"view_count":28399,"score":32,"question_id":1873025,"title":"How can I clear the SQL Server query cache?","body":"<p>I've got a simple query running against SQL Server 2005</p>\n\n<pre><code>select * from Table where Col = 'someval'\n</code></pre>\n\n<p>The first time I execute the query can take > 15 secs. Subsequent executes are back in &lt; 1 sec.</p>\n\n<p>How can I get SQL Server 2005 not to use any cached results? I've tried runnning</p>\n\n<pre><code>DBCC DROPCLEANBUFFERS\nDBCC FREEPROCCACHE\n</code></pre>\n\n<p>but this seems to have no effect on the query speed (still &lt; 1 sec).</p>\n"},{"tags":["sql-server"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1890,"score":4,"question_id":837615,"title":"Why does sql server generate stored procedures using sp_executesql statement with string?","body":"<p>When I generate sql schema creation scripts manually I usually just call 'Create Procedure...', however I notice that when you generate the script using the Tasks/Generate Scripts option it uses 'spexecutesql @statement = ..' e.g.</p>\n\n<pre><code>    EXEC dbo.sp_executesql @statement = N'-- =============================================\n    -- Author:  \tMe\n    -- Create date: 20/03/2009\n    -- Description: Does stuff\n    -- =============================================\n    CREATE PROCEDURE [dbo].[MyProc]\n        -- Add the parameters for the stored procedure here\n        @StartDate datetime\n    AS\n    BEGIN\n        -- SET NOCOUNT ON added to prevent extra result sets from\n        -- interfering with SELECT statements.\n        SET NOCOUNT ON;\n    ...\nEND\n'\n</code></pre>\n\n<p>Why is this? Is it something about retaining comments?\nThanks</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13237015,"title":"scope_identity returns null","body":"<p>I am writing a SP in SQL server</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[spAddUserBadge]\nAS\nBEGIN\nINSERT INTO dbo.SE_UserBadge\n(    \n[UID],\nBadgeID,\nBadgeAssignmentOrRenewalDate,\nBadgeExpiryDate ,\nAmountPaid, \nRemarks ,\nAssignedBy          \n)\nVALUES\n(\n17,1, 12-12-2012, 12-12-2013, 0.00, '', ''\n)\nSELECT SCOPE_IDENTITY() AS id    \nEND\nGO\n</code></pre>\n\n<p>SCOPE_IDENTITY is coming as NULL. where I am wrong?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":451,"score":0,"question_id":10834610,"title":"Date of inserting a row into table ","body":"<p>Is it possible to find date+time when a row was inserted into a table in SQL Server 2005?</p>\n\n<p>Does SQL Server log insert commands?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13237853,"title":"SQL Server Procedure Bad Cache Planning","body":"<p>I have some SQL code that uses PetaPoco that executes using sp_executesql. The query has 3 parameters: 2 dates and one string (as varchar(5)).</p>\n\n<p>The query takes 3 minutes to run - from the app or SSMS. If I run the same code in SSMS without sp_executesql (or parameters) it runs in 10 seconds and if I add the OPTION (OPTIMIZE FOR UNKNOWN) hint to the original code (using the sp) it runs in 3 seconds. I have cleared the cache using </p>\n\n<pre><code>  CHECKPOINT;\n  GO\n  DBCC DROPCLEANBUFFERS;\n  GO\n  DBCC FREEPROCCACHE;\n  GO\n</code></pre>\n\n<p>And I still can't get it to run as expected. It seems that adding the option to every query is a hack. Am I missing something?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":34,"score":-2,"question_id":13237623,"title":"Copy data into another table","body":"<p>How to copy (append) data from one table into another table with same schema in SQL Server?</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>I mean to say there is query </p>\n\n<pre><code>select * \ninto table1 \nfrom table2 \nwhere 1=1 \n</code></pre>\n\n<p>which creates <code>table2</code> with the same structure as <code>table1</code>. </p>\n\n<p>So is there any short query like this to only copy entire data only into an already existing table?</p>\n"},{"tags":["sql-server","tsql","ado.net","triggers"],"answer_count":9,"favorite_count":4,"up_vote_count":2,"down_vote_count":0,"view_count":3972,"score":2,"question_id":1798156,"title":"How to keep an audit/history of changes to the table","body":"<p>I've been asked to create a simple DataGrid-style application to edit a single table of a database, and that's easy enough. But part of the request is to create an audit trail of changes made, who made them, and the date/time.</p>\n\n<p>How might you solve this kind of thing?</p>\n\n<p>(I'll be using C# in VS2008, ADO.NET connected to SQL Server 2005, WPF and Xceed's DataGrid, if it makes any difference.)</p>\n"},{"tags":["sql","sql-server","xml"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13237407,"title":"SQL Server XML query: how to select values?","body":"<p>How to select file names from xml like this, i.e.\nI need only names:</p>\n\n<pre><code>c:\\temp\\f1.txt\nc:\\temp\\f2.txt\n</code></pre>\n\n<p>XML like this:</p>\n\n<pre><code>&lt;root name=\"name\" id=\"12\"&gt;\n&lt;class1&gt;\n     &lt;file name=\"c:\\temp\\f1.txt\"&gt;\n&lt;/class1&gt;\n&lt;class1&gt;\n   &lt;subclass1&gt;\n        &lt;file name=\"c:\\temp\\f2.txt\"&gt;\n    &lt;/subclass1&gt;\n&lt;/class1&gt;\n&lt;/root&gt;\n</code></pre>\n"},{"tags":["sql-server","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13233388,"title":"process the new files only","body":"<p>I have a source from which the files are to be processed. Multiple files are coming to that loacation at any time randomly (Package should run every 2 hours). I have to process only the new files, i can not delete, move the already processed files from that location. I can only copy the files to Archive location. How can I achieve this ?</p>\n"},{"tags":["c#",".net","sql-server","smo"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":46,"score":0,"question_id":13233982,"title":"Get Sql server's data using smo","body":"<p>I'm using Sql Server Smo to create the scheme of database by C# application. However, I need a bit more, I also need to get data from each table as a <strong>script</strong> like below:</p>\n\n<pre><code>--........................................\nINSERT INTO Table123 (...) VALUES (....)\nINSERT INTO Table456 (...) VALUES (....)\n--........................................\n</code></pre>\n\n<p>How can I do that and is it possible? Notice please that I need to create exactly a script using smo and not *.bak of a database, etc.</p>\n"},{"tags":["sql-server","sql-server-express"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13236110,"title":"Windows could not start the SQL Server Express on local computer","body":"<p>I have an exam on SQL tomorrow and I have no idea what to do, I need help as quick as possible. here's the error I get:</p>\n\n<p><code>i49.tinypic.com/rsd5sj.png</code></p>\n\n<p><img src=\"http://i.stack.imgur.com/emA7h.png\" alt=\"enter image description here\"></p>\n\n<p>thanks!</p>\n"},{"tags":["asp.net",".net","sql","sql-server","vb.net"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13235490,"title":"Archive checked records in grid view (Change 0 to 1 in database)","body":"<p>I have a grid view which pulls through data dictated by a stored procedure.</p>\n\n<p><img src=\"http://i.stack.imgur.com/S89rn.png\" alt=\"screen shot 1\"></p>\n\n<p>The stored procedure is called GetEverything.\nThe statement is made up of information from 2 tables, one with person detail, and one with vessel detail. The stored procedure select statement contains the following Where clause:</p>\n\n<pre><code>WHERE Vessel.ArchiveStatus = 0\n</code></pre>\n\n<p>By default, every new record that is created using the front end application is given a '0' for ArchiveStatus in the db.</p>\n\n<p>So, the gridview will only show me the records where the ArchiveStatus is 0, which by default is evertything.</p>\n\n<p>The 2 boxes, Check All and Uncheck All are working fully.</p>\n\n<p>What I need now is when a REF or REF(s) are selected and the button 'Archive Records' is clicked, for the 0 in the database to be updated to a 1 for that VesselREF.</p>\n\n<p>Can anoyone advise how to do this and give me some example code to put in the Default.aspx.vb file/ Event Handler for the archive records button.</p>\n\n<p>With this is place, the grid view will only display the non-archived records, and I can create a seperate grid view with its own SQL to bring through the archived records.</p>\n\n<pre><code>GridView.aspx\n\n    &lt;asp:GridView ID=\"GridView1\" runat=\"server\" AutoGenerateColumns=\"False\" \n        DataKeyNames=\"REF,VesselREF\" DataSourceID=\"SqlDataSource1\" Height=\"132px\" \n        style=\"text-align: center; font-family: Calibri; font-size: medium\" \n        Width=\"508px\" BackColor=\"#C4FFC4\"&gt;\n        &lt;AlternatingRowStyle BackColor=\"White\" /&gt;\n        &lt;Columns&gt;\n            &lt;asp:TemplateField HeaderText=\"REF\" InsertVisible=\"False\" SortExpression=\"REF\"&gt;\n\n                &lt;ItemTemplate&gt;\n                    &lt;a href=\"Details.aspx?REF=&lt;%# Eval(\"REF\")%&gt;\"&gt;&lt;%# Eval(\"REF\")%&gt;&lt;/a&gt;\n                    &lt;asp:CheckBox ID=\"RecordSelector\" runat=\"server\" /&gt;\n                &lt;/ItemTemplate&gt;\n            &lt;/asp:TemplateField&gt;\n            &lt;asp:BoundField DataField=\"Title\" HeaderText=\"Title\" SortExpression=\"Title\" /&gt;\n            &lt;asp:BoundField DataField=\"FirstName\" HeaderText=\"FirstName\" \n                SortExpression=\"FirstName\" /&gt;\n            &lt;asp:BoundField DataField=\"Surname\" HeaderText=\"Surname\" \n                SortExpression=\"Surname\" /&gt;\n            &lt;asp:BoundField DataField=\"VesselName\" HeaderText=\"VesselName\" \n                SortExpression=\"VesselName\" /&gt;\n            &lt;asp:BoundField DataField=\"VesselREF\" HeaderText=\"VesselREF\" \n                InsertVisible=\"False\" ReadOnly=\"True\" SortExpression=\"VesselREF\" /&gt;\n\n        &lt;/Columns&gt;\n    &lt;/asp:GridView&gt;\n</code></pre>\n"},{"tags":["sql","sql-server","date","time"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":2181,"score":6,"question_id":7105093,"title":"Difference between datetime and timestamp in sqlserver?","body":"<p>What is the difference between <code>Timestamp</code> and <code>Datetime</code> SQL Server?</p>\n\n<p>I thought Both formats are capable of storing date + time. Then, Where the difference is lying between them?</p>\n\n<p>But <code>Timestamp</code> is not capable of storing date, time information.</p>\n\n<p>Still Whats the difference?</p>\n"},{"tags":["sql-server","query","tsql","insert"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13235720,"title":"SQL Server append query","body":"<p>I have the following (not working) query:  </p>\n\n<pre><code>insert into [MyDB].[dbo].[Reports_StepsStat]  \n    (ActivityID,TaskID,StepIndex,StepStatus,TimeSpanInSeconds,Score)\nVALUES (\n  SELECT\n    tasks.ActivityID as ActivityID,\n    tasks.ID as TaskID,\n    [StepIndex]=item.value('(StepIndex)[1]', 'NVARCHAR(MAX)'),\n    [StepStatus]=item.value('(Status)[1]', 'NVARCHAR(MAX)'),\n    [TimeSpanInSeconds] = DATEDIFF(MINUTE, item.value('(StartedOn)[1]',    'datetime'),item.value('(FinishedOn)[1]', 'datetime')),\n    tasks.Score as Score\n  FROM \n    [MyDB].[dbo].[Tasks] as tasks \n  CROSS APPLY \n    [Progress].nodes ('//Progress/Steps/ProgressStep') Progress(item)\n)  \n</code></pre>\n\n<p>The inner select query (<code>SELECT task.ActivityID..</code>) works perfectly and produces the expected table.  </p>\n\n<p>The outer <code>insert into</code> part is supposed to append the result of the inner part to a table by the name of <code>Reports_StepsStat</code>. This does not work.  </p>\n\n<p>I have tried and succeeded doing that with <code>SELECT INTO</code>, but apparently <code>SELECT INTO</code> can only be used to create a new table, and not to append to an existing table, which is what I need.  </p>\n\n<p>The errors I get are:  </p>\n\n<blockquote>\n  <p><em>Msg 156, Level 15, State 1, Line 6</em><br>\n  <em>Incorrect syntax near the keyword 'SELECT'.</em><br>\n  <em>Msg 102, Level 15, State 1, Line 14</em><br>\n  <em>Incorrect syntax near ')'.</em></p>\n</blockquote>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":66,"score":0,"question_id":13235616,"title":"Converting INT to Time","body":"<p>I have a column in sql that is an INT and I have to convert it to time.</p>\n\n<p>I've tried </p>\n\n<pre><code>         CONVERT (VARCHAR, columnA / 600000)\n   + ':'\n   + RIGHT ('00' + CONVERT (VARCHAR, c_columnA % 60), 2)\n</code></pre>\n\n<p>but that's not the result.  Any idea's how the data might be being casted?</p>\n\n<p>Here a sample of the data:</p>\n\n<pre>\nINT |TIME\n4680001|13:00\n4680001|13:00\n4596001|12:45\n3846001|10:41\n4320001|12:00\n</pre>\n"},{"tags":["sql-server","sql-server-2005","named-instance"],"answer_count":7,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":16059,"score":10,"question_id":35026,"title":"SQL Server, convert a named instance to default instance?","body":"<p>I need to convert a named instance of SQL server 2005, to a default instance.</p>\n\n<p>Is there a way to do this without a reinstall?</p>\n\n<hr>\n\n<p>The problem is, 2 out of 6 of the developers, installed with a named instance. So its becoming a pain changing connection strings for the other 4 of us. I am looking for the path of least resistance to getting these 2 back on to our teams standard setup.  </p>\n\n<p>Each has expressed that this is going to be, too much trouble and that it will take away from their development time. I assumed that it would take some time to resolve, in the best interest of all involved, I tried combing through configuration apps installed and didn't see anything, so I figured someone with more knowledge of the inner workings would be here.</p>\n"},{"tags":["sql-server","versioning","database-versioning"],"answer_count":4,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":2105,"score":10,"question_id":451863,"title":"How do I version a SQL Server Database?","body":"<p>I need to put versions onto a SQL Server 2005 database and have these accessible from a .NET Application.  What I was thinking is using an Extended Properties on the Database with a name of 'version' and of course the value would be the version of the database.  I can then use SQL to get at this.  My question is does this sound like a good plan or is there a better way for adding versions to a SQL Server database?</p>\n\n<p>Lets assume I am unable to use a table for holding the Metadata.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":10,"down_vote_count":0,"view_count":133,"score":10,"question_id":13235382,"title":"Double IN Statements in SQL","body":"<p>Just curious about the IN statement in SQL.\nI know I can search multiple columns with one value by doing</p>\n\n<pre><code>'val1' IN (col1,col2)\n</code></pre>\n\n<p>And can search a column for multiple values</p>\n\n<pre><code>col1 IN ('val1','val2')   \n</code></pre>\n\n<p>But is there a way to do both of these simultaneously, without restorting to an repeating AND / OR in the SQl? I am looking to do this in the most scalable way, so independent of how many vals / cols i need to search in.\nSo essentially:</p>\n\n<pre><code>('val1','val2') IN (col1,col2)\n</code></pre>\n\n<p>but valid.</p>\n"},{"tags":["sql-server","ssas","mdx"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":13235169,"title":"Time hierarchy in SSAS (dyslexia)","body":"<p>Time dimension have hierarchies:</p>\n\n<ul>\n<li>Year  month  date </li>\n<li>Year  week  date</li>\n<li>Year - month</li>\n</ul>\n\n<p>I query them so:</p>\n\n<pre><code>LASTPERIODS( -12, StrToMember(\"[Time].[Year -  Week -  Date].[Week].&amp;[\" + Format(now(), \"yyyy-MM-\" + \"01T00:00:00\") + \"]\")) \n</code></pre>\n\n<p>returns null</p>\n\n<pre><code>LASTPERIODS( -12, StrToMember(\"[Time].[Year - Month].[Month].&amp;[\" + Format(now(), \"yyyy-MM-\" + \"01T00:00:00\") + \"]\"))\n</code></pre>\n\n<p>returns future 12 months</p>\n\n<p>If i query like this: </p>\n\n<pre><code>select non empty([Time].[Year -  Week -  Date].[Week].members) on 0\n</code></pre>\n\n<p>it will give me the week members..</p>\n\n<p>Am I missing some parameter?</p>\n"},{"tags":["sql-server","reliability","indexed-view"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13235391,"title":"Reliability of Indexed views","body":"<p>I just found out that a report I quickly threw together years ago has been the sole means of collecting millions of dollars, and there isn't anything being done to check if it is correct.  </p>\n\n<p>For performance reasons, the report makes heavy use of indexed views.  This concerns me, since while I have used indexed views a lot, I tend not to use them for anything this critical.  </p>\n\n<p>Is it possible that the indexed views can fail to update or otherwise return information different from the data in the tables?  How real of a risk is this?  Is there a good SQL script I can run periodically to check for errors?</p>\n"},{"tags":["c#","sql-server","entity-framework","database-connection"],"answer_count":9,"favorite_count":14,"up_vote_count":41,"down_vote_count":0,"view_count":47304,"score":41,"question_id":2475008,"title":"The underlying provider failed on Open","body":"<p>I was using .mdf for connect to DB and entityClient. Now I want to change the connection string so that there will be no .mdf</p>\n\n<p>Is this <code>connectionString</code> correct</p>\n\n<pre><code>&lt;connectionStrings&gt;\n&lt;!--&lt;add name=\"conString\" connectionString=\"metadata=res://*/conString.csdl|res://*/conString.ssdl|res://*/conString.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=.\\SQL2008;AttachDbFilename=|DataDirectory|\\NData.mdf;Integrated Security=True;Connect Timeout=30;User Instance=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;--&gt;\n&lt;add name=\"conString\" connectionString=\"metadata=res://*/conString.csdl|res://*/conString.ssdl|res://*/conString.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=.\\SQL2008;Initial Catalog=NData;Integrated Security=True;Connect Timeout=30;User Instance=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p></p>\n\n<p>because I always get error <code>The underlying provider failed on Open</code>?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":43,"score":3,"question_id":13235048,"title":"Multiple Rows in INSERTED table","body":"<p>On a table in MS SQL Server I need to run a CLR Stored Procedure on new rows if those rows meet certain criteria.  I thought that would be more or less straightforward:</p>\n\n<pre><code>if ((SELECT Cabinet FROM INSERTED) = 1 OR (SELECT Cabinet FROM INSERTED) = 3) AND (SELECT Result_02 FROM INSERTED) = 'N'\nBEGIN\n    DECLARE @id int\n    SET @id = (SELECT ID FROM INSERTED)\n    exec PrintLabel\n        @id,\n        N'LP 2844 LGE'\nEND;\n</code></pre>\n\n<p>However, this recently started throwing errors about a subquery returning multiple rows. I learned that INSERT triggers run once for each statement, not necessarily on individual rows. So, that IF statement can be working on multiple rows, and thus the error.</p>\n\n<p>My question is: how can I iterate over each new row if the rows are added in a batch (in this case via a MERGE statement). </p>\n"},{"tags":["c#",".net","sql-server","sql-server-2008-r2","clr"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":13066021,"title":"What .Net assemblies are integrated into the SQL Server 2008 R2 CLR as standard?","body":"<p>I have an existing assembly that has been used within SQL Server for some time. Today I added some experimental code that references <code>System.Data.Linq</code>. Creating the assembly within <strong>SQL 2008 R2</strong> resulted in this error:</p>\n\n<blockquote>\n  <p><em>Assembly 'system.data.linq, version=3.5.0.0, culture=neutral, publickeytoken=b77a5c561934e089.' was not found in the SQL catalog.</em></p>\n</blockquote>\n\n<p>This is not entirely unexpected, but I was wondering how to determine what the full set of standard '<strong>core</strong>' assembles is within 2008 R2. Presumably <code>System.Data.Linq</code> isn't one of them - but I would like to confirm this and also confirm what assemblies are provided as standard.</p>\n"},{"tags":["sql","sql-server","ssas","sql-server-2012","xmla"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13148511,"title":"Add attribute to cube and reprocess without original database","body":"<p>Every year we keep a historical copy of one of our cubes. This year someone decided they wanted to pay us money to add an attribute to the cube which did not previously exists. Fine, I like money,  but the issue is we don't have a backup of the database that we built this cube off of. </p>\n\n<p>So a question arises in my head, do we need that original database to add a new attribute to this cube? Is it possible for us to add a new attribute to the cube and only process this attribute without having the cube orignal datasource? </p>\n\n<p>Not having a great understanding of what is happening under the hood when I add an attribute to a SSAS cube and process, I can't say if this is or isn't possible. I could imagine that possibly, the cube has a snapshot in memory of the datasource that it can work off of. I can also imagine that this would be ridiculously inefficient so there is a chance this is no way in heck possible</p>\n\n<p>EDIT: It at least would seem feasible to add a calculated member that makes use of existing data in the cube.</p>\n\n<p>I also should mention that I tried to add an attribute to such a cube and received an error:</p>\n\n<blockquote>\n  <p>\"Dimension [Partner] cannot be saved  File system error failed to copy\n  file C:\\\\MYSQLSERVER\\OLAP\\DATA\\2013_Cube.db\\\\.dim\\.dstore  to C:\\\\MYSQLSERVER\\OLAP\\DATA\\2013_Cube.db\\\\.dim\\.dstore  file exists\"</p>\n</blockquote>\n\n<p>Sorry I faked those filepaths a little. </p>\n"},{"tags":["sql-server","service-broker"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13213166,"title":"Service Broker: How can I detect the script is executed on the wanted machine?","body":"<p><strong>Summary:</strong> My SQL scripts are generated from templates. They contain the IP address and the database name. How the script can check it was launched on the correct machine?</p>\n\n<p>My deployment/unistall SQL scripts that create or clean-up the Service Broker objects should be launched on the correct machine. The scripts use the <code>USE [databasename]</code> and they also use the IP address both in strings and in the object names. </p>\n\n<p>Is it possible at all to check (at the beginning of the script launched from SQL Server Management Studio) whether the script is to be launched on the wanted machine, otherwise print the message if it is not the case, and exit?</p>\n\n<p>I tried to check whether the database name is on the server...</p>\n\n<pre><code>IF NOT EXISTS (SELECT name FROM sys.databases WHERE name = '{database}')\nBEGIN\n    PRINT 'Executed on the machine where the database ''{database}'\n    PRINT 'does not exist. The script is going to be terminated.'\n    RETURN\nEND\n</code></pre>\n\n<p>... but there is <code>USE [{database}]</code> command used later in the script. This way the script does not compile and the red message appears before the script is launched.</p>\n\n<p>A side question (related, but not totally): Can the IP address of the SQL Server be determined by the script?</p>\n\n<p><strong>Update:</strong></p>\n\n<p>Thanks all for the hints related to IP address and the server/service names... Anyway, I need more to find, if it is possible to check in advance, whether the script compilation fails or not on the <code>USE [{database}]</code> command. The reason is that the command is physically present in the script. I would like to cry aloud: <em>Don't launch this script on the machine!</em> instead of the compilation error. I will accept also the answer: <em>It is not possible...</em> if it is not possible at all.</p>\n\n<p>Thanks,\n   Petr</p>\n"},{"tags":["c++","sql-server","extended-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":8,"score":1,"question_id":13234817,"title":"Can srv_paramsetoutput() be used to set nvarchar(max) or varchar(max)?","body":"<p>I'm writing an extended stored procedure for SQL Server in C++.</p>\n\n<p>The user can provide OUT parameters which I can set using srv_paramsetoutput(). However, this seems to always fail when I try to set TEXT, VARCHAR(max) or NVARCHAR(max). Note that VARCHAR(max) is referred to internally as SRVBIGVARCHAR.</p>\n\n<p>Is there a common mistake I could be making or are these datatypes inaccessible to xprocs when used as output parameters?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13202697,"title":"Updating a set of data from the output of a Table Valued Function","body":"<p>I am trying to write up a query that are merging duplicate client records in to a single record. Right now I am just building a mapping table to know what I should map with what.</p>\n\n<p>Here are the two functions I wrote to aid me in this</p>\n\n<pre><code>CREATE FUNCTION FindDuplicateClients ()\nRETURNS TABLE AS RETURN \n(\n    select distinct CLIENT_GUID \n    from CLIENTS c\n    inner join\n    (\n        select FIRST_NAME, LAST_NAME, HOME_PHONE\n        from CLIENTS\n        group by FIRST_NAME, LAST_NAME, HOME_PHONE\n        having COUNT(*) &gt; 1\n    ) t on c.FIRST_NAME = t.FIRST_NAME and c.LAST_NAME = t.LAST_NAME and c.HOME_PHONE = t.HOME_PHONE)\ngo\n\n--Find other clients that map to this client\nCREATE FUNCTION FindDuplicateClientsByClient (@Client uniqueidentifier)\nRETURNS TABLE AS RETURN \n(\n    select distinct CLIENT_GUID \n    from CLIENTS c\n    inner join\n    (\n        select x.FIRST_NAME, x.LAST_NAME, x.HOME_PHONE\n        from CLIENTS x\n        inner join \n        (\n            select FIRST_NAME, LAST_NAME, HOME_PHONE\n            from CLIENTS\n            where CLIENT_GUID = @Client\n        ) y on x.FIRST_NAME = y.FIRST_NAME and x.LAST_NAME = y.LAST_NAME and x.HOME_PHONE = y.HOME_PHONE\n        group by x.FIRST_NAME, x.LAST_NAME, x.HOME_PHONE\n        having COUNT(*) &gt; 1\n    ) t on c.FIRST_NAME = t.FIRST_NAME and c.LAST_NAME = t.LAST_NAME and c.HOME_PHONE = t.HOME_PHONE\n    where CLIENT_GUID &lt;&gt; @Client)\ngo\n</code></pre>\n\n<p>The first function successfully returns all <code>CLIENT_GUID</code>'s that have more than 1 record, the second you pass in a GUID and it returns all other guids that share the \"Common Information\" (first name, last name, and home phone in this case)</p>\n\n<p>The problem is filling out my mapping table. I have some rules I need to follow to give priority to some of the duplicates. For example anyone who has had transactions needs to not have their <code>CLIENT_GUID</code> changed, but they are able to have other GUIDs merged in to them (if the other GUIDs had no transactions)</p>\n\n<pre><code>--Create Mapping table\nselect CLIENT_GUID, CAST(null as uniqueidentifier) as NEW_CLIENT_GUID\ninto #mapping\nfrom FindDuplicateClients()\n\n--Do not map people who have transactions\nupdate #mapping\nset NEW_CLIENT_GUID = CLIENT_GUID\nwhere CLIENT_GUID in (select CLIENT_GUID from trnHistory)\n</code></pre>\n\n<p>Now here is where I am running in to trouble. I don't know how to get the list of people who had <code>NEW_CLIENT_GUID</code> set in the previous query, run <code>FindDuplicateClientsByClient</code> against that GUID, and set <code>NEW_CLIENT_GUID</code> of any result to the <code>NEW_CLIENT_GUID</code> that was fed in to the function without using a cursor.</p>\n\n<p>Here is the method I came up with using a cursor</p>\n\n<pre><code>declare cur cursor LOCAL FAST_FORWARD for select NEW_CLIENT_GUID from #mapping where NEW_CLIENT_GUID is not null\ndeclare @NEW_CLIENT_GUID uniqueidentifier\n\nopen cur\nfetch next from cur into @NEW_CLIENT_GUID\nwhile @@fetch_status = 0\nbegin\n    update #mapping\n    set NEW_CLIENT_GUID = @NEW_CLIENT_GUID\n    where CLIENT_GUID in (select CLIENT_GUID from FindDuplicateClientsByClient(@NEW_CLIENT_GUID)) --Find duplicates to this record\n        and NEW_CLIENT_GUID is null --Do not reassign values that are already set (ie: duplicates that have transactions)\n\n    fetch next from cur into @NEW_CLIENT_GUID\nend \n\nclose cur\ndeallocate cur\n</code></pre>\n\n<p>To me, iterating over each result in <code>#mapping</code> that has a value set does not seem correct to me. What would be the correct way to do this? I am using SQL Server 2008 R2 but I would prefer if it was compatible with SQL Server 2005 too.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13234465,"title":"Multiple variables assignment using SET and SELECT","body":"<p>I use the following t-sql code for assign to variable a value obtained from select statement</p>\n\n<pre><code> DECLARE @cfMitt nvarchar(16)\n\n SET @cfMitt = (SELECT CfMittente\n    FROM Messaggi\n    WHERE IDMessaggio = @IDMessaggio)\n</code></pre>\n\n<p>If I want use multiple assignement I try with the following  code, but something is wrong:</p>\n\n<pre><code>DECLARE @cfMitt nvarchar(16)\nDECLARE @cfDest nvarchar(16)\n\nSET @cfMitt, @cfDest= (SELECT CfMittente, CfDestinatario\nFROM Messaggi\nWHERE IDMessaggio = @IDMessaggio)\n</code></pre>\n\n<p>Where is the error?</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":118,"score":0,"question_id":8182250,"title":"Allow Search for Invalid Date stored as string - Is it recommended or not","body":"<p>I have two tables for an Entity - say Valid_Doc and Invalid_Doc. If document is valid, then all the data gets saved in Valid_Doc table.In case any of the attribute of document is invalid , it gets saved in Invalid_Doc.Due_Date is on of the column of both the tables. In Invalid_Doc , we are saving <strong>Invalid dates as string</strong>.</p>\n\n<p>Suppose if user searches for documents through a SEARCH screen with following date </p>\n\n<p><strong>Due_Date - is after - 07/07/11</strong>,\nShall we show all the documents from both the tables.As Due_Date in Invalid_Doc  table is string, there is no way we can compare the entered search date with the dates available in database in <strong>Invalid_Doc</strong> table.</p>\n\n<p>Can someone please guide me whether to use DATEDIFF - i.e. need to convert the String date in DB to <strong>Date(millisecs)</strong> first and then do the comparison with the entered data.Doing this , there may be unpredictable results. So , shall we allow the user to search for Invalid doc through Date or NOT.</p>\n\n<pre><code>Select * FROM   invalid_doc iil WITH (nolock) WHERE\nCAST(Datediff(s, '19700101 05:00:00:000', iil.due_date) AS NUMERIC) * \n   1000 \n   BETWEEN '1120501800000' AND '1120501800000'\n</code></pre>\n\n<p>Where '1120501800000' and '1120501800000' are Date converted in milliseconds.</p>\n\n<p>Please suggest.</p>\n"},{"tags":["sql-server","getdate","datepart"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":13234184,"title":"Need To Pull Data With Specific Date Range From Current Day In Sql Express 2008","body":"<p>On my table I have a \"Datemodified\" column.  I was to be able to pull results based on that Column.  I want to be able to pull anything from 6am to 6pm.  This query needs to be able to be used everyday, so the ways I've seen, use a specific date and I can't get any of the queries I've looked for to work for my specific case.</p>\n\n<p>Here is what I've gotten to work so far, it pulls the right hour time frame, but I need it to run only for the current day.  Thanks all!</p>\n\n<pre><code>SELECT \n  Assignment\n  , Datemodified\n  , General\n  , IncNumber\n  , NextSteps\n  , PDCRStatus\n  , RootCause\n  , Status\n  , Summary\n  , Timings\n  , UserID \nFROM \n  Turnover \nWHERE \n  DATEPART(HOUR, datemodified) between 06 and 18 \n  --AND datemodified = GETDATE()\n</code></pre>\n"},{"tags":["sql","sql-server","select","parameters","where-clause"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13233676,"title":"How to improve performance of SQL query with parameters?","body":"<p>I'm using SQL Server 2005. </p>\n\n<p>I have a problems with executing SQL statements like this</p>\n\n<pre><code>DECLARE @Param1 BIT\nSET @Param1 = 1\n\nSELECT \n    t1.Col1,\n    t1.Col2\nFROM\n    Table1 t1\nWHERE\n    @Param1=0 OR\n    (t1.Col2 in \n        (SELECT  t2.Col4\n            FROM \n                Table2 t2\n            WHERE \n                t2.Col1 = t1.Col1 AND \n                t2.Col2 = 'AAA' AND \n                t2.t3 &lt;&gt; 0)\n    )\n</code></pre>\n\n<p>This query executes very long time.</p>\n\n<p>But if I replace <code>@Param1</code> with <code>1</code>, than query execution time is ~2 seconds. </p>\n\n<p>Any information how to resolve the problem would be greatly appreciated.</p>\n"},{"tags":["sql-server","xml","sql-server-2012","bulk-import"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13233868,"title":"bulk import of xml data in to sql server","body":"<p>I have a set of xml files that I want to parse the data of and import in to a sql server 2012 database. The provided xml files will be validated against a schema.</p>\n\n<p>I am looking as to what is the best method of doing this is. I have found this: <a href=\"http://msdn.microsoft.com/en-us/library/ms171878.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms171878.aspx</a> </p>\n\n<p>I am wondering if this is the best way or if there are others? </p>\n"},{"tags":["sql-server","reporting-services","reportingservices-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":19,"score":-1,"question_id":13230062,"title":"SSRS 2005 ( Export to CSV)","body":"<p>SSRS 2005</p>\n\n<ol>\n<li><p>When I am exporting the report to CSV, I want the quotes on the first (User Name) field values in CSV</p>\n\n<p>Exam:- in report the first (User Name) filed values are \n    Raj, Kapoor\n    Salman, Khan</p>\n\n<p>When export to CSV I want the values like \"Raj, Kapoor\" and \"Salman, Khan\" Currently the values are coming like (Raj, Kapoor and Salman, Khan) in CSV so when I convert the CSV to excel its not behaving correctly it added the new columns.</p></li>\n<li><p>if I add the column before, at first place with serial number, then the data is coming properly for user name column like (\"Raj,  Kapoor\" and \"Salman, Khan\") in CSV.</p></li>\n</ol>\n"},{"tags":["sql","sql-server","foreign-keys","sql-update","revert"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13233742,"title":"How to revert update query in sql server?","body":"<p>I am using SQL Server for my database. now there is table which has following columns.</p>\n\n<pre><code>PK_ID   FK_ID   Name   Description\n1        5       ABC      ABCDE\n2        7       EFG      EFT\n3        8       XUZ      Xyz\n4        11      TEF      TEF\n</code></pre>\n\n<p>Now by mistake i update some Fk_ID field with null value. Now I want to get back my all fk_id which is updated by null value. So is there any way to revert back fk_id's which has value previously?</p>\n\n<p>Can any one help me out to find out solution for the same?</p>\n"},{"tags":["c#","sql-server","asp.net-mvc","entity-framework","complex-data-types"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":69,"score":4,"question_id":13212338,"title":"Calling stored procedure in EF with Complex Data Type","body":"<p>I am new to working with <code>Entity Framework</code> in a sample <code>ASP.NET/MVC 3.0 VS2010</code> project. I have imported two stored procedures as Function Imports and, in doing so, created a complex data type for each.</p>\n\n<p>I am trying to run the following c# code:</p>\n\n<pre><code>public ComplexDataType RunStoredProc()\n{\n    var context = new DbEntities();\n    int param1 = 370;\n    int param2 = -1;\n    string param3 = \"Current\";\n\n    ComplexDataType result = new ComplexDataType;\n    result = context.StoredProc(param1, param2, param3);\n    return result;\n}\n</code></pre>\n\n<p>And I'm getting the error:</p>\n\n<pre><code>Cannot implicitly convert data type \n    System.Data.Objects.ObjectResult(ComplexDataType) to 'ComplexDataType'\n</code></pre>\n\n<p>What am I doing wrong? How do I properly store the results of the stored proc in a complex data type?</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13231825,"title":"SET datatype set in SQL Server","body":"<p>While creating a table I have to use the datatype <code>SET</code>, but it looks like there is no datatype <code>SET</code> in SQL Server. I was looking on the Microsoft's website and those are the datatypes that it supports: <a href=\"http://msdn.microsoft.com/en-us/library/ms187752.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms187752.aspx</a></p>\n\n<p>Which one should I use to replace the <code>SET</code>?</p>\n\n<p>I have used <code>SET</code> in MySQL database like this:</p>\n\n<pre><code>CREATE TABLE IF NOT EXISTS `configurations` (\n`index` int(11) NOT NULL AUTO_INCREMENT,\n`user_id` int(11) NOT NULL,\n`configDuration` int(5) NOT NULL,\n`configDurationPerspective` set('list_this_day','list_remaining') NOT NULL,\nPRIMARY KEY (`index`)\n) ENGINE=InnoDB  DEFAULT CHARSET=latin1;\n</code></pre>\n\n<p>And then when I insert data into the table it looks like this:</p>\n\n<pre><code>INSERT INTO 'configurations' (index, user_id, configDuration, configDurationPerspective) VALUES (1, 1, 2, 'list_this_day');\n</code></pre>\n\n<p>Never mind the quotes. Something messed up while pasting the code.</p>\n\n<p>Now I want to do the same thing, but in SQL Server.</p>\n"},{"tags":["sql","sql-server"],"answer_count":8,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":5227,"score":7,"question_id":331157,"title":"Does SQL Server CheckSum calculate a CRC? If not how can I get MS SQL to calculate a CRC on an arbitrary varchar column?","body":"<p>Does SQL Server CheckSum calculate a CRC? If not how can I get SQL Server to calculate a CRC on an arbitrary varchar column?</p>\n"},{"tags":["sql","sql-server","variables"],"answer_count":1,"favorite_count":1,"up_vote_count":6,"down_vote_count":1,"view_count":58,"score":5,"question_id":13233129,"title":"Declared variable behaving differently to hard coded string","body":"<p>I am trying to set a like parameter into a variable and allow that variable to accept wild cards (mssql 2005). If I use my parameter set to '%' it only returns a partial subset but if I hard code the query to use '%' it returns the full set. Why might the variable behave differently to the string?</p>\n\n<pre><code>DECLARE @wareno char(4); \nSET @wareno = '%';\nselect @wareno as a, * from waredesc where wareno like @wareno;\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>DECLARE @wareno char(4); \nSET @wareno = '%';\nselect @wareno as a, * from waredesc where wareno like '%';\n</code></pre>\n\n<p>The full scenario is switching based on a flag but is reproducible under the code above</p>\n\n<pre><code>DECLARE @wareno char(4); \nDECLARE @delprods bit;\n\n/**\nSET THESE PARAMETERS\n**/\nSET @wareno = '1'; \nSET @delprods = 'true'; /** if true all the warehouses should also be emptied for safety - products are held at a company level!**/\n\nIF @delprods = 1\nBEGIN\n    SET @wareno = '%';\nEND\nselect @wareno as a, * from waredesc where wareno like @wareno;\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":13231884,"title":"How can I speed up this SQL query","body":"<p>I have a piece of code in an ASP.NET application that builds a SQL query from a list of parameters. The number of parameters can vary, so various criteria can be added to this query.  The database is Microsoft SQL Server 2008.</p>\n\n<p>All the AND and OR's are generated programmatically.</p>\n\n<p>The query took more than 3 seconds to execute, but after some profiling and indexes it runs less than a second. Still I think the query itself can be optimized. I've looked at execution plans, but that doesn't mean much to me - not being a SQL guru.</p>\n\n<p>I wonder if the query can be done in a more intelligent fashion - I haven't been able to figure it out. Here's an example of the query:</p>\n\n<pre><code> SELECT [id], [WorkTitle], [CreateDate], [UpdateDate], [Writer], [ValidFrom], \n\n[ValidTo], [Text] \n FROM dbo.Texts T  \n WHERE Category_id = 3 AND '2012-11-06' BETWEEN ValidFrom AND ValidTo  \n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 1 AND CL.Value = '95068')       \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 1))  \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 2 AND CL.Value = 'C')       \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 2))  \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 3 AND CL.Value = 'HEL')       \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 3))  \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 4 AND CL.Value = 'CC')      \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 4))  \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 5 AND CL.Value = NULL)     \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 5))  \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 7 AND CL.Value = '321')      \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 7))  \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 9 AND CL.Value = 'DK7778')    \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 9))  \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 10 AND CL.Value = 'TFS')   \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 10)) \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 11 AND CL.Value = 'TMP')   \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 11)) \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 13 AND CL.Value = 'OY-VKB')   \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 13)) \n</code></pre>\n\n<p>Any tips and tricks are appreciated.</p>\n\n<p>Cheers\nJens</p>\n"},{"tags":["c#",".net","sql-server","smo"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13229602,"title":"Using Smo in C# - skip constraint generating instructions at the beginning","body":"<p>I have to create a full copy of a remote db. I have only one useful and easy way to do it: by generating scripts. I am aware about other ways (create backup, for instance) but I can't use them for some reason.</p>\n\n<p>Since one table might be depend on another (has a foreign key, etc...) and because of this it's pretty difficult to figure out the valid order of creating tables, I decide to generate these \"dependable\" script instructions at the very end. </p>\n\n<p>Well, I know how to generate that \"dependable\" script instructions within (close to) table creation. But what should I do to skip them first only to generate them at the end?</p>\n\n<p>For instance:</p>\n\n<pre><code>--How I do NOT want\n--.........................\nCREATE TABLE Table1(....)\nALTER TABLE Table1 ADD CONSTRAINT ...\n\nCREATE TABLE Table2(....)\nALTER TABLE Table2 ADD CONSTRAINT ...\n\n\n\n--How I would like\n--.........................\nCREATE TABLE Table1(....)\nCREATE TABLE Table2(....)\n--.........................\nCREATE TABLE TableN(....)\n--.........................\n--the end of a script\nALTER TABLE Table1 ADD CONSTRAINT .....\n</code></pre>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13232583,"title":"Scripting for SQL Server 2005","body":"<p>This script works only in 2008 version:</p>\n\n<pre><code>declare @tab table(\nid_emp int,\nFIL_ROT_WID xml\n)\n\ninsert into @tab\nselect 0, '&lt;xml&gt;&lt;/xml&gt;'\n\ndeclare @xml_rot_widget xml\nset @xml_rot_widget = '&lt;ati id=\"1123\" val=\"new()\" /&gt;'\n\nupdate @tab\nset FIL_ROT_WID.modify('insert sql:variable(\"@xml_rot_widget\")\n                    as last\n                    into (/xml)[1]')\nwhere id_emp = 0\n\nselect * from @tab\n</code></pre>\n\n<p>In 2005 I receive the follow error:</p>\n\n<pre><code>XQuery: SQL type 'xml' is not supported in XQuery.\n</code></pre>\n\n<p>So, my question is:\nHow can I write code on 2008 (SQL Server Management Studio) that I will be sure that will works fine on 2005?</p>\n\n<p>Ps.: ** Tools > Options > SQL Server Object Explorer > Scripting > Script for server version** does not work.</p>\n\n<p>Tks</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13230441,"title":"Save multiple rows in one table in one connection IN sqlserver","body":"<p>Scenario: Just consider i have a table having 3 column Id, QuestionId and optedAnswer. I have a form which consists n no of question and some options for answer. On save button i want to save data in database(in my table). </p>\n\n<p>Problem: I want to save all the answers in one connection.</p>\n\n<p>Step taken by me: I made a string having  structure questionId:optedAnswwer | questionId : optedAnswer | and so on....\n I wrote a procedure. started a loop. split the data based on ':' and '|' and saved data in one connection. But it is a rigorous  task. Is there any way to save the data directly without using loop and split.</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":10,"score":0,"question_id":13229998,"title":"Trigger database update after control update on subform 1","body":"<p>I have a Cashbook table with these columns: </p>\n\n<p><code>Date</code>, <code>Ref</code>, <code>Acc_Code</code>, <code>Acc_Name</code>, <code>Details</code>, <code>Debit</code>, <code>Credit</code></p>\n\n<p>And an AccountPayable table with these columns: </p>\n\n<p><code>Date</code>, <code>Ref</code>, <code>Acc_Code</code>, <code>Acc_Name</code>, <code>Details</code>, <code>Debit,Credit</code></p>\n\n<p>And as any data entered into the AccountPayable table goes insert the same data into the Cashbook table, but when data is being modified in the AccountPayable, how can the modification reflect in the cashbook using SQL after update trigger to update the cashbook?</p>\n"},{"tags":["sql","sql-server","reporting-services","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":209,"score":2,"question_id":8527249,"title":"Multiple Versions of SQL Reporting Services ReportViewer","body":"<p>I have a simple ASP.NET application that use the SSRS ReportViewer control.  </p>\n\n<p>I was wondering if it is possible to support multiple versions of this control within the application?  </p>\n\n<p>My application is used by users who use a mixed bag of reporting services and the SQL Reporting Services ReportViewer 2010 (version 10.0) is not compatible with SSRS 2005, but the SQL Reporting Services ReportViewer version 9.0 is.  </p>\n\n<p>I would like them to be able to choose which version of reporting services they have and then the application choose the correct control.  </p>\n\n<p>Will having multiple versions of this referenced within the application cause conflicts?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","query-optimization"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":79,"score":-1,"question_id":13227560,"title":"SQL Server 2005 query optimization","body":"<p>My application need to get data from a SQL Server database. My problem is that there is 3 tables that has to be joined into a view. This takes a lot of time (about 30 sec to generate the view) So I was wondering if there is a way to optimize this SQL query?</p>\n\n<p>SQL query: </p>\n\n<pre><code>SELECT TOP (100) PERCENT Request1.RequestID,\n                         TrackIT.dbo.Sending.Barcode,\n                         TrackIT.dbo.Address_View.AdrID,\n                         TrackIT.dbo.Address_View.Name,\n                         TrackIT.dbo.Address_View.Street,\n                         TrackIT.dbo.Address_View.HouseNo,\n                         TrackIT.dbo.Address_View.Postal,\n                         TrackIT.dbo.Address_View.City,\n                         TrackIT.dbo.Address_View.Country,\n                         Request1.Latitude,\n                         Request1.Longitude,\n                         Request1.ReceivedDate\nFROM   (SELECT DISTINCT RequestID,\n                        Ltrim([Content]) AS Barcode,\n                        Latitude,\n                        Longitude,\n                        ReceivedDate\n        FROM   RequestWithLocation\n        WHERE  ( Site LIKE '%Z' )\n               AND ( [Content] &lt;&gt; '' )\n               AND ( AddressID = '0' )\n               AND ReceivedDate &gt; Dateadd(day, -7, Getdate())) AS Request1\n       INNER JOIN TrackIT.dbo.Sending\n         ON Request1.Barcode = TrackIT.dbo.Sending.Barcode\n       INNER JOIN TrackIT.dbo.Address_View\n         ON TrackIT.dbo.Sending.DeliveryAdrID = TrackIT.dbo.Address_View.AdrID\nORDER  BY AdrID \n</code></pre>\n\n<p>Can anyone help ?</p>\n"},{"tags":["javascript","sql","sql-server","asp-classic"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13176438,"title":"Adding form data to a database ASP and SQL Server","body":"<p>I have been googling the net for hours and i still can't get my head around this!</p>\n\n<p>to start with, i have this code which is the form i have created.</p>\n\n<pre><code>&lt;!-- #include file=\"Header.asp\" --&gt;\n&lt;!-- #include file=\"Tauthenticate.asp\" --&gt;\n&lt;!--#include file=\"database.asp\"--&gt;\n\n&lt;SCRIPT LANGUAGE=\"JavaScript\"&gt;\n\nfunction confirmSubmit()\n{\nvar agree=confirm(\"Confirm?\");\nif (agree)\nreturn true ;\nelse\nreturn false ;\n}\n&lt;/script&gt;\n\n\n    &lt;table border=\"0\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" id=\"table17\"&gt;\n        &lt;tr&gt;\n            &lt;td background=\"../images/bar1.jpg\"&gt;&lt;font size=\"2\"&gt;&amp;nbsp;&lt;b&gt;Add \n            Skill&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;/table&gt;\n            &lt;table border=\"0\" width=\"100%\" id=\"table18\" cellspacing=\"0\" cellpadding=\"0\"&gt;\n                &lt;form method=\"POST\" action=\"SaveNewSkill.asp\"&gt;\n                &lt;tr&gt;\n\n                &lt;/tr&gt;\n\n                &lt;td width=\"108\"&gt;&lt;font face=\"Verdana\" size=\"2\" &gt;Employee &lt;/font&gt; &lt;/td&gt;\n    &lt;td&gt;\n\n\n        &lt;p&gt;&lt;font face=\"Verdana\"&gt;&lt;select size=\"1\" name=\"D1\"&gt;\n        &lt;%\n            sql=\"select User_ID, First_Name, Surname from Company Where Status not like 'left%' and (Company.Office='Manchester' or Company.Office='Romania') order by Surname\"\n            set users=conn.execute(sql)\n            do while not users.eof \n                %&gt;\n                    &lt;option value=\"&lt;%=users(\"User_ID\")%&gt;\"&gt;&lt;%=users(\"First_Name\") &amp; \" \" &amp; users(\"Surname\")%&gt;&lt;/option&gt;\n                &lt;%\n                users.movenext\n                loop\n                set users=nothing\n                %&gt;\n        &lt;/select&gt;&lt;/font&gt;&lt;/p&gt;\n\n    &lt;/td&gt;\n\n\n                &lt;tr&gt;\n                    &lt;td width=\"142\"&gt;&lt;b&gt;&lt;font size=\"2\" face=\"Verdana\"&gt;Skill&lt;/font&gt;&lt;/b&gt;&lt;/td&gt;&lt;td&gt;\n                    &lt;select size=\"1\" name=\"D3\"&gt;\n                    &lt;option value=\"AutoCad 2D\"&gt;AutoCAD 2D&lt;/option&gt;\n                    &lt;option value=\"3D Modeling\"&gt;3D Modeling&lt;/option&gt;\n                    &lt;option value=\"Sketchup\"&gt;Sketchup&lt;/option&gt;\n                    &lt;/select&gt;&lt;/td&gt;\n\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;td width=\"142\"&gt;&lt;b&gt;&lt;font size=\"2\" face=\"Verdana\"&gt;Current Skill Level&lt;/font&gt;&lt;/b&gt;&lt;/td&gt;&lt;td&gt;\n                    &lt;select size=\"1\" name=\"D4\"&gt;\n                    &lt;option value=\"1\"&gt;1&lt;/option&gt;\n                    &lt;option value=\"2\"&gt;2&lt;/option&gt;\n                    &lt;option value=\"3\"&gt;3&lt;/option&gt;\n                    &lt;option value=\"4\"&gt;4&lt;/option&gt;\n                    &lt;option value=\"5\"&gt;5&lt;/option&gt;\n                    &lt;/select&gt;&lt;/td&gt;\n\n                &lt;/tr&gt;\n\n                    &lt;tr&gt;\n                    &lt;td width=\"142\"&gt;&lt;b&gt;&lt;font size=\"2\" face=\"Verdana\"&gt;Required Skill Level&lt;/font&gt;&lt;/b&gt;&lt;/td&gt;&lt;td&gt;\n                    &lt;select size=\"1\" name=\"D4\"&gt;\n                    &lt;option value=\"1\"&gt;1&lt;/option&gt;\n                    &lt;option value=\"2\"&gt;2&lt;/option&gt;\n                    &lt;option value=\"3\"&gt;3&lt;/option&gt;\n                    &lt;option value=\"4\"&gt;4&lt;/option&gt;\n                    &lt;option value=\"5\"&gt;5&lt;/option&gt;\n                    &lt;/select&gt;&lt;/td&gt;\n\n                &lt;/tr&gt;\n\n                &lt;/form&gt;\n                &lt;/table&gt;\n    &lt;form&gt;&lt;p&gt;&lt;font size=\"2\"&gt;&lt;input type=\"submit\" value=\"Save\" name=\"B1\" onclick=\"return confirmSubmit()\"&gt;&lt;/font&gt;&lt;/form&gt;\n    &lt;td width=\"75\"&gt;\n            &lt;!-- #include file=\"footer.asp\" --&gt;\n</code></pre>\n\n<p>the files that are included are for the header, connection to the database and authentication to view the page in the first place (which all works).</p>\n\n<p>the form queries the database for our list of users then allows the user to select a skill from a list and define their current level of expertise.</p>\n\n<p>i have then created this \"save skill\" asp page.</p>\n\n<pre><code>&lt;!--#include file=\"database.asp\"--&gt;\n&lt;!--#include File=\"TUauthenticate.asp\"--&gt;\n\n\n&lt;%\n\n\nUser_ID=request.querystring(\"User_ID\")\nsql=\"select * from company where User_ID=\" &amp; User_ID\nset rs=conn.execute(sql)\nSession(\"User_ID\")=User_ID\n\n\nSkill=request.form(\"D3\")\nCurrent_Level=Request.form(\"D4\")\nUser_ID=request.form(\"D1\")\nRequired_Level=request.form(\"D5\")\n\nif request.form(\"B1\")&lt;&gt;\"\" then\nif skill = \"AutoCAD 2D\" then\nsqlq=\"insert into skills (User_ID, AutoCad_2D, AutoCad_2DR) Values (\" &amp; User_ID &amp; \",'\" &amp;    Current_Level &amp; \"','\" &amp; Required_Level &amp; \"')\"\nresponse.write(sqlq)\nset rs=conn.execute(sqlq)\nend if\nend if\n\n%&gt;\n</code></pre>\n\n<p>i have put this together using various pieces of working code but it will not save to the database... i understand its not very neat but i will sort that once i know whats wrong with it.</p>\n\n<p>i know i've included a little bit of javascript but i'd prefare if answers were in asp code (as im currently trying to study asp) </p>\n\n<p>Thanks in advance guys! :D</p>\n"},{"tags":["sql","sql-server","stored-procedures","openquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13230430,"title":"Insert Into a Table Across Linked Server From SP Using Openquery","body":"<p>I want to send data across from one server to another, I wish to improve my performance and wondered if OpenQuery is a good route to go down?</p>\n\n<p>I tried to do something like this;</p>\n\n<pre><code>INSERT INTO OPENQUERY (SERVERNAME, '(SELECT Num1, Num2, Num3 FROM [DBName].[dbo].TableName)')\n(Num1, Num2, Num3)\nSELECT Num1, Num2, Num3\n FROM #Temp\n</code></pre>\n\n<p>However this returns the error</p>\n\n<pre><code>The provider indicates that conflicts occurred with other properties or requirements.\n</code></pre>\n\n<p>I don't understand this as the query does run fine and produce the required results without OpenQuery...</p>\n\n<p>Could any of you advise me on this please?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":93,"score":6,"question_id":13229946,"title":"Difference between Tables and Temp Tables","body":"<p>why this code work without problem :</p>\n\n<pre><code>drop table t1 \nselect * into t1 from  master..spt_values\ndrop table t1 \nselect * into t1 from  master..spt_values\n</code></pre>\n\n<p>Output </p>\n\n<pre><code>Msg 3701, Level 11, State 5, Line 1\nCannot drop the table 't1', because it does not exist or you do not have permission.\n\n(2508 row(s) affected)\n\n(2508 row(s) affected)\n</code></pre>\n\n<p>but this code does not :</p>\n\n<pre><code>drop table #t1 \nselect * into #t1 from  master..spt_values\ndrop table #t1 \nselect * into #t1 from  master..spt_values\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>Msg 2714, Level 16, State 1, Line 4\nThere is already an object named '#t1' in the database.\n</code></pre>\n\n<p>what is the difference between Tables and Temp Tables in this code ?</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":13228706,"title":"Update data from database on click of button","body":"<p>I have a kendo dropdown and on selected id value i want to update data of particular row from database on button click event.but my dat is not updating and the old values are shown again and again.Please suggest me how to do it.\nMy code is</p>\n\n<pre><code>&lt;script src=\"Js/jquery1.7.1.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n&lt;script src=\"CSS/kendo.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;script type=\"text/javascript\"&gt;\n  $(document).ready(function(){\n    $(\"#multi\").kendoDropDownList();\n    $(\"#editor\").kendoEditor();\n });\n&lt;/script&gt;\n&lt;form id=\"form1\" runat=\"server\"&gt;\n&lt;div&gt;\n   Select Template: &lt;select id=\"multi\" runat=\"server\"&gt;&lt;/select&gt;\n&lt;/div&gt;\n&lt;br /&gt;\n&lt;div&gt;\n  Template Name: &lt;input type=\"text\" id=\"txtName\" name=\"Name\" runat=\"server\" /&gt;\n&lt;/div&gt;\n&lt;div&gt;\nDescription:&lt;textarea name=\"comments\" id=\"txtComment\" cols=\"25\" rows=\"5\"   \nrunat=\"server\"&gt;&lt;/textarea&gt;\n&lt;br /&gt;\n&lt;/div&gt;\n&lt;div&gt;\nActive: &lt;input type=\"checkbox\" id=\"chkActive\" name=\"vehicle\" runat=\"server\" /&gt;\n&lt;/div&gt;\n&lt;div id=\"example\" class=\"k-content\"&gt;\n&lt;textarea id=\"editor\" rows=\"10\" cols=\"30\" style=\"width:740px;height:440px\"   \nrunat=\"server\"&gt;&lt;/textarea&gt;\n&lt;/div&gt;\n&lt;div&gt;\n\n&lt;button type=\"button\" id=\"btnUpdate\" runat=\"server\"   onserverclick=\"    \nbtnUpdate_onclick\" &gt;Save&lt;/button&gt;\n\n&lt;/div&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n</code></pre>\n\n<p>My .cs code is</p>\n\n<pre><code> protected void Page_Load(object sender, EventArgs e)\n{\n\n\n    Bind();\n}\n\nprivate void Bind()\n{\n    SqlConnection con = new SqlConnection(\"Data Source=ST0022;Initial \nCatalog=QuickMove_Globe;User ID=sa;Password=good\");\n    SqlDataAdapter da = new SqlDataAdapter();\n    DataSet ds = new DataSet();\n    da.SelectCommand = new SqlCommand(\"Select * from Templates\", con);\n    con.Open();\n    da.SelectCommand.ExecuteNonQuery();\n    da.Fill(ds);\n    con.Close();\n    multi.DataTextField = \"ID\";\n    multi.DataValueField = \"Name\";\n    multi.DataValueField = \"Description\";\n\n    multi.DataSource = ds.Tables[0];\n    multi.DataBind();\n}\n\nprotected void btnUpdate_onclick(object sender, EventArgs e)\n{\n\n\n\n    SqlConnection con = new SqlConnection(@\"Data Source=ST0022;Initial \nCatalog=QuickMove_Globe;Persist Security Info=True;User ID=sa;Password=good\");\n    SqlCommand cmd= new SqlCommand(\"Update_Temp\", con);\n\n    cmd.CommandType = CommandType.StoredProcedure;\n    //passing parameters\n    cmd.Parameters.AddWithValue(\"@ID\", Convert.ToInt32(multi.SelectedIndex));\n    cmd.Parameters.AddWithValue(\"@Name\",Convert.ToString(txtName.Value));\n    cmd.Parameters.AddWithValue(\"@Description\", Convert.ToString(txtComment.Value));\n    cmd.Parameters.AddWithValue(\"@Content\", Convert.ToString(editor.Value));\n    cmd.Parameters.AddWithValue(\"@Active\", (chkActive.Value).ToString());\n\n    SqlDataAdapter da = new SqlDataAdapter();\n\n    da.UpdateCommand=cmd;\n    con.Open();\n\n\n\n\n\n\n    cmd.ExecuteNonQuery();\n    con.Close();\n\n}\n</code></pre>\n"},{"tags":[".net","sql-server","logging","microsoft","sqlclr"],"answer_count":5,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":1393,"score":8,"question_id":7034969,"title":"SQL Server stops loading assembly","body":"<p>We have developed an assembly for the SQL Server 2008 R2.</p>\n\n<p>The assembly has been working for a week.  The managed stored proc inside the assembly was working fine for the whole week and then it stops working.  We have been seeing this problem couple times.  The way to make it work again is to restart the SQL Server.</p>\n\n<pre><code>Msg 10314, Level 16, State 11, Line 4\nAn error occurred in the Microsoft .NET Framework while trying to load assembly id 65536. The server may be running out of resources, or the assembly may not be trusted with PERMISSION_SET = EXTERNAL_ACCESS or UNSAFE. Run the query again, or check documentation to see how to solve the assembly trust issues. For more information about this error: \n  System.IO.FileLoadException: Could not load file or assembly 'myAssembly, Version=2.0.0.490, Culture=neutral, PublicKeyToken=5963130873dd3a75' or one of its dependencies. Exception from HRESULT: 0x80FC0E21 System.IO.FileLoadException:\n  at System.Reflection.Assembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, Assembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection)\n  at System.Reflection.Assembly.InternalLoad(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)\n  at System.Reflection.Assembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)\n  at System.Reflection.Assembly.Load(String assemblyString)\n</code></pre>\n\n<p>I have found different articles on the web.  </p>\n\n<p><a href=\"http://support.microsoft.com/kb/918040\">This KB</a> suggested that I might have restored the database from another SQL Server, which I swear I didn't.  </p>\n\n<p><a href=\"http://www.sqlskills.com/BLOGS/BOBB/category/SQLCLR.aspx\">This blog</a> said I might run into this if I installed .NET 3.5 on SQL Server 2005 but mine was SQL Server 2008 R2 and I did not install anything when this problem occurs.</p>\n\n<p>The main point is that it can keep going for a period of time.  It just stops working randomly.  Then, if we restart the SQL Server, it will start working again.  I have thought of my server was really running out of memory but now, I just see the problem again.  SQL Server is using 300MB RAM only and my server has 16GB RAM.  This sounds impossible that it's because I am running out of memory.</p>\n\n<p>Now, I want to collect more information on this problem.  Any log that I can turn on and look at?  Any suggestion that help troubleshooting this problem is welcome.</p>\n\n<p>I have run some SQL queries.</p>\n\n<pre><code>SELECT * from sys.dm_clr_properties\n=============================================\ndirectory   C:\\Windows\\Microsoft.NET\\Framework64\\v2.0.50727\\\nversion v2.0.50727\nstate   CLR is initialized\n</code></pre>\n\n<p>.</p>\n\n<pre><code>SELECT * from sys.dm_clr_appdomains\n======================================================\n0x0000000087160240  3   mydatabase.dbo[runtime].2   2011-08-12 08:44:08.940 10  1   E_APPDOMAIN_SHARED  1   1\n</code></pre>\n\n<p>.</p>\n\n<pre><code>SELECT * from sys.dm_clr_tasks\n======================================================\n0x000000008185A080  0x00000000818562C8  0x0000000000000000  E_TASK_ATTACHED_TO_CLR  E_ABORT_NONE    E_TYPE_ADUNLOAD 0   0\n0x00000000818CE080  0x00000000818CA2C8  0x0000000000000000  E_TASK_ATTACHED_TO_CLR  E_ABORT_NONE    E_TYPE_FINALIZER    0   0\n0x0000000081AD4C30  0x000000000400D048  0x0000000000000000  E_TASK_ATTACHED_TO_CLR  E_ABORT_NONE    E_TYPE_USER 0   0\n</code></pre>\n\n<p>.</p>\n\n<pre><code>SELECT * from sys.dm_clr_loaded_assemblies\n&lt;returns nothing&gt;\n</code></pre>\n\n<p><strong>* UPDATE *</strong></p>\n\n<p>On my SQL Server, I have created four databases.  Each of them with the same assembly attached to it.  Now, SQL Server refused to load the assembly and gave me the above error.</p>\n\n<p><code>SELECT * from sys.dm_clr_appdomains</code> shows me at that point there was only one appdomain loaded and <code>SELECT * from sys.dm_clr_loaded_assemblies</code> showed me there were no assemblies loaded at all.</p>\n\n<p>Then, I ran the same stored proc on the other three databases.  It worked and successfully loaded up the assemblies and successfully ran the stored proc.  After executing the stored proc.  <code>SELECT * from sys.dm_clr_appdomains</code> now shows me there are only four appdomain loaded and <code>SELECT * from sys.dm_clr_loaded_assemblies</code> showed me there are now three assemblies loaded.</p>\n\n<p>This makes sense.  Now, I hope if I run the stored proc again in the original database, it should get the assembly loaded as it were.  Guess what.  No, it doesn't.  It still gives me the same error.  It looks like this database is completely stuck.  The only way to fix it is to reboot the SQL Server.  I am hoping there is a flag/lock somewhere in the system table holding up this.  I cannot find it.  Any idea is welcome.</p>\n\n<p>Now, my SQL Server is in the state that requiring me to reboot to make it work again.  </p>\n\n<p><strong>* UPDATE (8/31/2011) *</strong></p>\n\n<p>It sounds like it's related to the database owner of the database.  This is kind of complicated.  We have two sites and two AD forests.  The SQL Server machine is joined to forest A but the database owner is from forest B.  The connection between forest A and forest B is not that stable since they are in two different sites physically connected by WAN.</p>\n\n<p>Once I change the database owner to a SQL Login (Non-Windows account), my stored proc is up running for couple weeks so far with no interruption.</p>\n\n<p>I will accept the answer if anybody can explain it.</p>\n"},{"tags":["c#","sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13229461,"title":"C# change date between different formats","body":"<p>I want to know if there's a way to change the date format depending on the users local date format setting. The date I will store in the DB it's <code>YYYY-MM-DD</code> but the users have different formats, like <code>DD-MM-YYYY</code> or <code>DD.MM.YYYY</code>. What is a clean, elegant way to ensure that my application always retrives the date in local date format, and SQL server always receives the date in <code>YYYY-MM-DD</code> to be stored.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":13697,"score":6,"question_id":1586560,"title":"How do I escape a single quote in sqlserver?","body":"<p>I'm trying to insert some text data into a table in SQLServer 9.\nThe text includes a single quote.\nHow do I escape that?\nI tried using two single quotes, but it threw me some errors.\neg. insert into my_table values('hi, my name''s tim.');</p>\n"},{"tags":["c#",".net","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1568,"score":1,"question_id":5899358,"title":"Addslashes / escape single quote in .NET","body":"<p>I'm maintaining a piece of code that concatenates SQL queries like:</p>\n\n<pre><code>string sql = \"SELECT* FROM table WHERE column = '\" + value + \"'\";\n</code></pre>\n\n<p>Now it turned out that if <strong>value</strong> contains <strong>'</strong> characted it will break SQL Server text statement. I searched a bit for method similar to PHP addslashes, but without success. There's <strong>Regex.Escape</strong> but it didn't do the trick. Is there any other way to address that issue except calling <strong>Replace</strong> method on string?:</p>\n\n<pre><code>string sql = \"SELECT* FROM table WHERE column = '\" + value.Replace(\"'\", \"''\") + \"'\";\n</code></pre>\n\n<p>Thanks,\nPawe</p>\n"},{"tags":["sql-server","quotes"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":466,"score":0,"question_id":4386400,"title":"Single quotes problem in SQL Server 2008","body":"<p>How this below insert query can be modified or escape single quote in SQL Server:</p>\n\n<pre><code>INSERT INTO &lt;tblname&gt; (title,desc)\nVALUES\n('Hen's Body','It's just best combination')\n</code></pre>\n\n<p>This query not run in SQL Server. I need similer solution to MySQL (like using backslash)as it is</p>\n\n<pre><code>INSERT INTO &lt;tblname&gt; (title,desc)\nVALUES('Hen\\'s Body','It\\'s just best combination')\n</code></pre>\n\n<p>Regards</p>\n"},{"tags":["c#","sql-server","fluent-nhibernate","collation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13229374,"title":"Fluent Nhibernate, adding collation as part of convention","body":"<p>Is it possible to control the collation generated by Nhibernate for all the columns of type nvarchar? Depending on the culture where the software is installed, it might be nice to control it from the installer which would read this option from configuration file.</p>\n\n<p>I've found just ways of adding collation to concrete query results</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13229241,"title":"How to create procedure with the same WHERE column","body":"<p>How can I create one procedure and the <code>WHERE</code> column is the same?</p>\n\n<p>The <code>WHERE</code> column is <code>QuotationNo</code></p>\n\n<p>This is the procedure signature:</p>\n\n<pre><code>create procedure (QUO1 int, QUO2 int, QUO3 int, QUO4 int)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Quote     price     quantity\n---------------------------------\n1234       2000        1000\n5678       2500        4000\n9012        3000        4500 \n3456        1000        1000\n</code></pre>\n\n<p>Thanks,</p>\n\n<p>Captain16</p>\n"},{"tags":["c#","sql-server","sql-server-2008-r2","database-connection","connection-string"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":210,"score":2,"question_id":11289696,"title":"Specifying Port With SqlConnectionStringBuilder?","body":"<p>I've ran into a snag. I have a need to specify the port number for my local installation of SQL Server 2008 R2. So far I've tried using the SqlConnectionStringBuilder with the data source set as <code>.\\TESTSERVER, 1433</code>, which by all the documentation should connect me to the server TESTSERVER on port 1433 (the default). </p>\n\n<p>The connection string looks like:</p>\n\n<p><code>{Data Source=\".\\TESTSERVER, 1433\";Initial Catalog=AdventureWorks;User ID=testuser;Password=MYPASSWORDHERE}</code></p>\n\n<p>However I get an error that looks like:</p>\n\n<blockquote>\n  <p>A network related or instance-specific error has occurred while establishing a connection SQL server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL server is configured to allow remote connections. (Provider: TCP provider, error:0 - no connection could be made because the target machine actively refused it. </p>\n</blockquote>\n\n<p>Upon verifying the connection string using <code>SqlConnectionStringBuilder.ToString()</code> it comes out almost how <a href=\"http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.connectionstring.aspx\" rel=\"nofollow\">MSDN</a> suggests. For some reason it wraps double quotes ONLY around the data source and nothing else. However this may just be the debugger removing the outside quotes since it's stored in a <code>string</code> datatype. I also verified that SQL server is accessible without specifying the port and it is. Finally, I verified that the server is allowed to accept remote connections. Considering this instance of SQL Server is installed locally, using the default port, and on my development computer I couldn't imagine why I would be getting an error like this.</p>\n\n<p>Is this because the SqlConnectionStringBuilder is overriding my port with it's own port? Do I need to for some reason open up ports on my firewall? Knowing it's a fully local installation it shouldn't be encountering firewall problems. I'd rather not have to manually build the connection string. Not that it's difficult, it just adds a layer of complexity to my code I'd rather not have unless needed.</p>\n\n<p>Any help would be appreciated. Thanks!</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>After a long hard digging through the SqlConnectionStringBuilder syntax it appears that it handles invalid parameters by passing then to the connection string surrounded in quotes. I'd imagine this is because it breaks the connectionstring. My question still remains: <strong>is there a way to pass port via SqlConnectionStringBuilder or will I have to build it myself?</strong></p>\n"},{"tags":["sql-server","winforms","connection-string"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":344,"score":1,"question_id":7006098,"title":"ConnectionString for connecting to SQL Server Database?","body":"<p>I have an application (WinForms) which using SQL Server as its database.</p>\n\n<p>Now I am using <code>app.config</code> file to access <code>ConnectionString</code>.</p>\n\n<p>Have a look at my <code>app.config</code> file</p>\n\n<pre><code>&lt;configuration&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"dbConnectionString\" \n         connectionString=\"Data Source=abc-79f1f531c9f;Initial Catalog=ItemStockInParth;Integrated Security=True;Pooling=False\"\n         providerName=\"System.Data.SqlClient\"/&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>You can see that <code>Data Source=abc-79f1f531c9f</code>.</p>\n\n<p>Here ==> <code>abc-79f1f531c9f</code> is server name which is running on my (Developer's) PC.</p>\n\n<p>Now when application is being installed at client's site, the server name should be changed to the server name which is running on the client machine or server name which will client machine use.</p>\n\n<p>Then what should be the best criteria for handling this situation?</p>\n\n<p>Means I have to create one new form which asking user to enter their <code>Server Name</code> and as per that I creating our ConnectionString?</p>\n\n<p>Or dynamically getting the <code>servername</code>?</p>\n\n<p>Or just hard-code the <code>Server Name</code> of client machine (or server name which will client machine use) inside our <code>App.config</code> file?</p>\n\n<p>please help..... </p>\n"},{"tags":["javascript","sql-server","database","connection"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9793,"score":0,"question_id":5622242,"title":"Using Javascript to connect SQL Server database","body":"<p>I need to use Javascript to read some data from SQl Server 2008 Database.\nSo I wrote this:(html page code)</p>\n\n<pre><code>&lt;!DOCTYPE html \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"&gt;\n&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\"/&gt;\n&lt;title&gt;Database Connect&lt;/title&gt;\n&lt;script type=\"text/javascript\"&gt;\nfunction loadDB(){\nvar connection = new ActiveXObject(\"ADODB.Connection\");\n\nvar connectionstring=\"Data Source=-;Initial Catalog=C:\\Program Files\\Microsoft SQL Server\\MSSQL10.MSSQLSERVER\\MSSQL\\DATA\\SIGMA_Database.mdf;User ID=;Password=\"\";Provider=SQLOLEDB\";\n\nconnection.open(connectionstring);\nvar rs = new ActiveXObject(\"ADODB.Recordset\");\n\nrs.Open(\"SELECT Username FROM Users\", connection);\nrs.MoveFirst();\nwhile(!rs.eof)\n{\n   document.write(rs.fields(1));\n   rs.MoveNext();\n}\n\nrs.close();\nconnection.close();\n\n}\n&lt;/script&gt;\n&lt;/head&gt;\n&lt;body onload=\"loadDB()\"&gt;\n&lt;div id=\"main\"&gt;&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>However, nothing happens!\nWhat is wrong with it?There're some cyrillic alphabet symbols in connection string, can it be a source of problem?Or another thing is going wrong?</p>\n"},{"tags":["sql-server","sql-server-ce","replication","merge-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13223063,"title":"SQL replication to SQL Compact 3.5 via FTP?","body":"<p>I'm trying replicate a SQL Server database to a device with SQL Compact 3.5 on it and I can get replication working fine via IIS. However, the publication has an option to use FTP to publish the replication data, but I don't seem to be able to configure SQL Compact to connect to the FTP site. There's nothing online that says I can't do that, but I also can't find a walk-through showing that I can.</p>\n\n<p>Does anybody know if I can connect a SQL Compact database to a publisher via FTP rather than IIS Web?</p>\n"},{"tags":["c#","sql-server","database","sql-server-2008","database-administration"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13227146,"title":"Want an idea in writing a code section","body":"<p>Scenario :\nI am creating a admin tool in C# which will restore a full sql server backup in a server and apply the transaction logs. After db come up. I have run a few scripts shown below. </p>\n\n<pre><code>use master\nEXEC sp_addlogin '&lt;destsid&gt;', '&lt;sidadmpass&gt;','&lt;dbname&gt;'\nuse &lt;dbname&gt;\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nEXEC sp_change_users_login 'Update_One','&lt;destsid&gt;','&lt;destsid&gt;'\nuse master\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse msdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC     sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse model\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse tempdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse master\ngrant all on xp_cmdshell to &lt;destsid&gt;\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'serveradmin'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'dbcreator'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'bulkadmin'\nuse &lt;dbname&gt;\nif object_id('sp_change_sapuser') is not null\n    drop procedure sp_change_sapuser \ncreate procedure sp_change_sapuser @oldid sysname, @newid sysname\nas begin\ndeclare @oldid_uid  smallint\ndeclare @newid_uid  smallint    \ndeclare @object     sysname\ndeclare @object_full    nvarchar(999)\nset @oldid_uid = user_id(@oldid)\nset @newid_uid = user_id(@newid)\nif @oldid_uid is not null and @newid_uid is not null\nbegin\ndeclare object_cursor cursor local for \nselect name from sysobjects where((xtype='U' and name &lt;&gt; 'dtproperties') or (xtype='V' and name not in ('syssegments','sysconstraints')) or (xtype='P' and name not like 'dt_%') or (xtype='D' and name not like 'DF__dtpropert%') or (xtype in ('FN','TF','IF'))) and @oldid_uid = uid\nopen object_cursor\nfetch next from object_cursor into @object\nwhile @@fetch_status=0\nbegin\nset @object_full = user_name(@oldid_uid) + '.' + @object\nexec sp_changeobjectowner @object_full, @newid\nfetch next from object_cursor into @object\nend\nend\nelse\nif @oldid_uid is null\nbegin\nprint '*** old database user does not exist ***'\nend\nif @newid_uid is null\nbegin\nprint '*** new database user does not exist ***'\nend\nend\nexec sp_change_sapuser '&lt;sourcesid&gt;', '&lt;destsid&gt;'\nuse master\nEXEC sp_grantlogin   'AMR\\&lt;destsid&gt;adm'\nEXEC sp_grantlogin   'AMR\\SAPService&lt;dbname&gt;'\nEXEC sp_defaultdb    'AMR\\&lt;destsid&gt;adm','&lt;dbname&gt;'\nEXEC sp_defaultdb    'AMR\\SAPService&lt;dbname&gt;','&lt;dbname&gt;'\nEXEC sp_addsrvrolemember 'AMR\\&lt;destsid&gt;adm',     'sysadmin'\nEXEC sp_addsrvrolemember 'AMR\\SAPService&lt;dbname&gt;', 'sysadmin'\nEXEC xp_sqlagent_proxy_account 'SET', '&lt;servername&gt;', 'SAPMssXPUser',N'&lt;sidadmpass&gt;'\nuse master\nEXEC sp_addlogin '&lt;destsid&gt;', '&lt;sidadmpass&gt;', &lt;dbname&gt;\nuse &lt;dbname&gt;\nEXEC sp_change_users_login 'Update_One','&lt;destsid&gt;','&lt;destsid&gt;'\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse master\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse msdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse model\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse tempdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse master\ngrant all on xp_cmdshell to &lt;destsid&gt;\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'serveradmin'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'dbcreator'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'bulkadmin'\n--EXEC xp_sqlagent_proxy_account 'SET', '&lt;servername&gt;', 'SAPMssXPUser', N'&lt;sidadmpass&gt;'\nEXEC sp_grantlogin   '&lt;destsid&gt;adm'\nEXEC sp_grantlogin   'SAPService&lt;dbname&gt;'\nEXEC sp_defaultdb    '&lt;destsid&gt;adm','&lt;dbname&gt;'\nEXEC sp_defaultdb    'SAPService&lt;dbname&gt;','&lt;dbname&gt;'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;adm',     'sysadmin'\nEXEC sp_addsrvrolemember 'SAPService&lt;dbname&gt;', 'sysadmin'\n</code></pre>\n\n<p>Note : values given  will be replaced with actual values.</p>\n\n<p>While running these scripts few may throw exceptions. But i want to continue even though some scripts throws error. And also i have removed GO(batch terminator) because i cannot add separate dll into server. Please suggest some idea to get this problem solved. </p>\n\n<p>Details :\nProgramming lang : C#\nDb - Sql Server 2005,08</p>\n"},{"tags":["sql","sql-server","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13226351,"title":"How to retrieve the column value based on formula","body":"<p>Using a view in SQL Server 2000</p>\n\n<p><code>Table1</code>:</p>\n\n<pre><code>id  z1      z2      z3      z4   type\n--------------------------------------\n01A 300     400     300     400  01\n2B  300     400     300     400  02\n3C  500     300     400     300  01\n04A 500     400     500     400  01\n05B 400     300     400     300  02\n06  150     200     200     150  03\n....\n</code></pre>\n\n<p><code>Table2</code>:</p>\n\n<pre><code>type  Formula1           Formula2\n------------------------------------    \n01    ((Z1+Z2)/1000)*2   null\n02    null               ((Z3+Z4)/1000)*2\n03    ((Z1+Z2)/1000)*2   ((Z3+Z4)/1000)*2\n</code></pre>\n\n<p>I want to select the <code>table1</code> rows based on <code>table2</code> formula:</p>\n\n<ul>\n<li>in table2 type - 01 (z1 and z2 found) then i want to consider table1 z1 z2 columns</li>\n<li>in table2 type - 02 (z3 and z4 found) then i want to consider table1 z3 z4 columns</li>\n<li>in table2 type - 03 (z1, z2, z3 and z4 found) then i want to consider table1 z1, z2, z3 z4 columns</li>\n</ul>\n\n<p>Expected output</p>\n\n<p><code>Table1</code>:</p>\n\n<pre><code>id   z1     z2     z3     z4    type\n-------------------------------------    \n01A  300    400    null   null  01\n2B   null   null   300    400   02\n3C   500    300    null   null  01\n04A  500    400    null   null  01\n05B  null   null   400    300   02\n06   150    200    200    150   03\n</code></pre>\n\n<p>Currently I'm using a view, I don't want to change to stored procedure because most of the report are using this view.  </p>\n\n<p>How to do it in sql..?</p>\n"},{"tags":["sql","sql-server","sql-server-2000"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":13209331,"title":"How to split the row value","body":"<p>table1</p>\n\n<pre><code>value\n\n100 x 200 x 300 x 400  `I want to split this row bcoz more than 2 values`\n100 x 200\n1300 x 1400\n200 x 300 x 1200 x 2200  `I want to split this row bcoz more than 2 values`\n....\n</code></pre>\n\n<p>Value column is not fixed length, it may also contain <code>10 x 200 x 3000 x 5</code></p>\n\n<p>I want to take the first 2 values then the next 2 values will go to the next row after <code>x</code></p>\n\n<p>I want to split the rows like this:</p>\n\n<p>Expected Output</p>\n\n<pre><code>100 x 200 \n300 x 400\n100 x 200\n1300 x 1400\n200 x 300 \n1200 x 2200\n....\n</code></pre>\n\n<p><strong>Hint:</strong></p>\n\n<p>We can split the value for each x then we can join 2 values </p>\n\n<p>for example <code>20 x 10 x 5 x 1</code></p>\n\n<p>Split like this <code>20, 10 5, 1</code> then join <code>20 x 10, 5 x 1</code> </p>\n\n<p>The above method will work out, if it work out means then can i get some query for splitting and joining the rows..</p>\n\n<p>How can I do this in SQL?</p>\n\n<p>Need SQL Query Help</p>\n"},{"tags":["c#","sql-server","ado.net","views","sqlconnection"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13216564,"title":"Use SqlConnection.GetSchema to get Tables Only (No Views)","body":"<p>When I use </p>\n\n<pre><code>SqlConnection.GetSchema(\"Tables\");\n</code></pre>\n\n<p>it returns all the tables AND views for the target database.</p>\n\n<p>Is there any way to just return tables? All the research I have done indicates I am doing this correctly yet it always returns the views like they are tables. I have dug down into the DataTable in debug and I can't even find a difference. The data types are reported the same... As far as I can tell, it can't differentiate between a view and a table. (It does make sense in a way since a view for all intents and purposes IS a table.)</p>\n\n<p>I am using the Northwind database for testing.</p>\n\n<p>I am writing the application in C#.</p>\n\n<p>Here is the code that I am running to get the schema info. Pretty simple.</p>\n\n<pre><code>SQLCon.Open();\nDataTable tables = SQLCon.GetSchema(\"Tables\");\nSQLCon.Close();\n</code></pre>\n\n<p>I would very much like to use the getschema method and not have to query the database in another fashion... if at all possible.</p>\n"},{"tags":["sql-server","paging"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":38,"score":0,"question_id":13226758,"title":"How to use ROW_NUMBER() for paging data in procedure","body":"<p>i'm starter in sql server, i write this Query</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[SPSelectReport3] (@StringWhereParameter nvarchar(4000)=null)\nAS\nBEGIN\n\n    SET NOCOUNT ON;\n\n--  Begin Of Transaction\nbegin tran\n\ndeclare @Query nvarchar(max)\nset @Query='\n((SELECT Id,[Mesc]\n      ,[Line]\n      ,[Unit]\n      ,[Discription]\n      ,[InvQty]\n      ,[LastDateNil]\n      ,[ST_CODE]\n      ,[PlanCode]\n      ,[Min]\n      ,[Max]\n      ,[PbsNo]\n      ,[PbsDate]\n      ,[PbsQty]\n      ,[PbsQtyRec]\n      ,[DateDelay]\n      ,[PartNo]\n      ,[TranQty]\n      ,[TypeRequest]\n      ,[HeaderId]\n  FROM [MyMaterialDB].[dbo].[Report3]\n  WHERE headerid IN(SELECT HeaderId FROM [MyMaterialDB].[dbo].[Report3] WHERE line=''H'''+ @StringWhereParameter+'))\n  UNION\n  (\n    (SELECT Id,[Mesc]\n      ,[Line]\n      ,[Unit]\n      ,[Discription]\n      ,[InvQty]\n      ,[LastDateNil]\n      ,[ST_CODE]\n      ,[PlanCode]\n      ,[Min]\n      ,[Max]\n      ,[PbsNo]\n      ,[PbsDate]\n      ,[PbsQty]\n      ,[PbsQtyRec]\n      ,[DateDelay]\n      ,[PartNo]\n      ,[TranQty]\n      ,[TypeRequest]\n      ,[HeaderId]\n  FROM [MyMaterialDB].[dbo].[Report3]\n  WHERE mesc IN(SELECT mesc FROM [MyMaterialDB].[dbo].[Report3] WHERE line=''I''' +@StringWhereParameter+'))\n  UNION\n  (SELECT Id,[Mesc]\n      ,[Line]\n      ,[Unit]\n      ,[Discription]\n      ,[InvQty]\n      ,[LastDateNil]\n      ,[ST_CODE]\n      ,[PlanCode]\n      ,[Min]\n      ,[Max]\n      ,[PbsNo]\n      ,[PbsDate]\n      ,[PbsQty]\n      ,[PbsQtyRec]\n      ,[DateDelay]\n      ,[PartNo]\n      ,[TranQty]\n      ,[TypeRequest]\n      ,[HeaderId]\n  FROM [MyMaterialDB].[dbo].[Report3]\n  WHERE mesc IN(SELECT HeaderId FROM [MyMaterialDB].[dbo].[Report3] WHERE line=''I'''+@StringWhereParameter+')\n  )))\n  Order by Mesc,Line,unit'\n\n\n  exec(@Query)\n\n\n if @@error = 0    \n Commit Tran    \n Else   \n rollback tran\nEnd\n</code></pre>\n\n<p>i write this string Query and Get Where parametrs and concat Query and where after that run Query. i want paging result data but i dont know how to do paging.<br> please help me. thanks all.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":13227030,"title":"Finding first matched string in a column in SQL Server","body":"<p>I have a table as follows:</p>\n\n<pre><code>TABLE1\n\nNo  Description\n1   Hello Hai Hello\n2   Good Bad Good\n3   Hello Good Hai\n4   Hai Hello Bad\n5   Hello Hello Hello\n</code></pre>\n\n<p>Now if I run the following query:</p>\n\n<pre><code>Select * \nfrom TABLE1 \nwhere Description like '%Hai%' \n   OR  Description like '%Hello%' \n   OR Description like '%Good%'\n</code></pre>\n\n<p>I want the result as follows ( By adding one extra column \"FIRST MATCHED WORD\"):</p>\n\n<pre><code>No  Description     First Matched Word\n1   Hello Hai Hello     Hai\n2   Good Bad Good       Good\n3   Hello Good Hai      Hai\n4   Hai Hello Bad       Hai\n5   Hello Hello Hello   Hello\n</code></pre>\n\n<p>Hear my intention is to find out the first matched word depends on our query. Kindly help me.</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":30,"score":-3,"question_id":13227338,"title":"need solve using ASP.net for following scenario","body":"<p>having problem for making arithmetic operation using Bengali font in asp.net?</p>\n"},{"tags":["sql","sql-server"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":13226399,"title":"How can I write a query that returns \"between\" to return alphabetic data, not just numeric?","body":"<p>I have a <code>Daily_account</code> table:</p>\n\n<pre><code>customer_id    account_id            current_balance\n\n1                 D1                       200\n2                 d2                       300\n3                 d10                      400\n4                 d100                     500\n5                 d101                     600\n</code></pre>\n\n<p>Now I have a query: </p>\n\n<pre><code>select customer_id,account_id,current_balance\nfrom daily_account\nwhere account_id between 'D1' and'D100'\n</code></pre>\n\n<p>It is giving me output of account no of D1,D10,D100, but I want to get output of every no.\nHow to get output of every account which comes between D1 and d100?  </p>\n"},{"tags":["asp.net","sql-server","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":13223599,"title":"Insert multiple rows into SQL Server based on start and end dates","body":"<p>I need to insert several rows into a SQL Server database based on <code>Start Date</code> and <code>End Date</code> textboxes. </p>\n\n<p>E.G. <code>tbStartDate.Text = \"25/12/2012\"</code> and <code>tbEndDate.Text = \"29/12/2012\"</code> therefore I need to insert individual rows for the following dates:</p>\n\n<pre><code>25/12/2012\n26/12/2012\n27/12/2012\n28/12/2012\n29/12/2012\n</code></pre>\n\n<p>Please can you help me with the necessary T-SQL to achieve this?</p>\n"},{"tags":["sql-server","performance","stored-procedures","database-connection",".net-4.5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13224186,"title":"1 stored procedure returning 2 recordsets or 2 database calls","body":"<p>I am writing an ASP.NET 4.5 application that communicates with a SQL Server database. My repository layer communicates with the SQL Server via stored procedures.</p>\n\n<p>I want to query 2 related tables. The first query returns 1 row. The second query returns multiple rows related to the first query. Its not possible to return both in the one query. </p>\n\n<p>At the moment both queries are in the one stored procedure. I user multiple ado.net readers to parse the record set in to an object. </p>\n\n<p>Is the following more performant? </p>\n\n<p>Have two separate stored procedures. Each returning the above record sets in 2 separate calls. I then use the await keyword to indicate that the second call can asynchronously wait on the first i.e. using the new features in .net 4.5. This will keep the database connection open for a shorter period of time but means 2 database connections as oppose to 1.</p>\n"},{"tags":[".net","sql","sql-server","sql-server-2005"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":3450,"score":0,"question_id":4941489,"title":"Query vs Stored procedure; difference between two approaches","body":"<p>I am developing a web page for search. I have two options to build this page</p>\n\n<ol>\n<li><p>To build the query on page according to parameter enter by the user and send it to server.</p></li>\n<li><p>To send parameters to stored procedure and build query there and get it executed.</p></li>\n</ol>\n\n<p>I want to know that which approach I should adopt and why. </p>\n\n<p>I want to know the advantages or disadvantages of both approaches. </p>\n"},{"tags":["sql-server","ssis","oracle10g"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13180867,"title":"SSIS Oracle Query Returns No rows","body":"<p>I ran the query in SQL Developer (Oracle's tool), copied it over to SSIS, clicked Preview and it returns nothing. It works fine in Oracle. Any ideas? It does take about 120 seconds to run in Oracle.</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13225326,"title":"SQL Server Column Mapping","body":"<p>I have three scenarios that i'd like to handle, with some remapping i'm doing. </p>\n\n<p>Scenario #1\nI have Table A</p>\n\n<blockquote>\n  <p>Column A, Column B<br>   1, NULL  <br> 2, NULL  <br> 3, NULL  <br> 4,\n  NULL  <br> 5, NULL  <br> 6, NULL  <br></p>\n</blockquote>\n\n<p>How Can I Update Column B such that I begin with the next value of Column A  </p>\n\n<blockquote>\n  <p>Column A, Column B  <br> 1, 7  <br> 2, 8  <br> 3, 9  <br> 4, 10  <br>\n  5, 11  <br> 6, 12  <br></p>\n</blockquote>\n\n<p>Scenario #2\nI have Table A  </p>\n\n<blockquote>\n  <p>Column A, Column B  <br> 1, NULL  <br> 1, NULL  <br> 2, NULL  <br> 2,\n  NULL  <br> 3, NULL  <br> 3, NULL  <br> 3, NULL  <br></p>\n</blockquote>\n\n<p>How Can I Update Column B such that I begin with the next value of Column A but insuring I only update the values as a group like so  </p>\n\n<blockquote>\n  <p>Column A, Column B  <br> 1, 4  <br> 1, 4  <br> 2, 5  <br> 2, 5  <br>\n  3, 6  <br> 3, 6  <br> 3, 6  <br></p>\n</blockquote>\n\n<p>Scenario #3\nI have Table A that contains gaps in Column A  </p>\n\n<blockquote>\n  <p>Column A, Column B  <br> 1, NULL  <br> 1, NULL  <br> 4, NULL  <br> 4,\n  NULL  <br> 6, NULL  <br> 6, NULL  <br> 6, NULL  <br></p>\n</blockquote>\n\n<p>How Can I Update Column B such that I begin with the next value of Column A but insuring I only update the values as a group like so  </p>\n\n<blockquote>\n  <p>Column A, Column B  <br> 1, 7  <br> 1, 7  <br> 4, 8  <br> 4, 8  <br>\n  6, 9  <br> 6, 9  <br> 6, 9  <br></p>\n</blockquote>\n\n<p>Can I possibly handle all three of these scenario's in one statement? If so, how?\nAny help is much appreciated!  </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13224886,"title":"Why does a left join return differently to a NOT IN?","body":"<p>The following query is behaving somewhat strangely:</p>\n\n<pre><code>SELECT #batches.OutTo, PO_Number, CONVERT(varbinary, #batches.OutTo) , convert     (varbinary, PO_Number), \n    CASE WHEN convert(varbinary, #batches.OutTo) NOT IN (SELECT convert(varbinary,    PO_Number) FROM #pos) \n         THEN 'NOT IN' ELSE 'IN' END\nFROM #batches LEFT JOIN #pos ON \n    convert(varbinary, #batches.OutTo) = CONVERT(varbinary, PO_Number)\nWHERE #batches.OutTo IS NOT NULL\nGROUP BY #batches.OutTo, #pos.PO_Number\n\n\nOutTo       PO_Number   (No column name)    (No column name)    (No column name)\n311117      NULL        0x333131313137      NULL                    IN\n311130      311130      0x333131313330      0x333131313330          IN\n311259      NULL        0x333131323539      NULL                    IN\nL001934     L001934     0x4C303031393334    0x4C303031393334        IN\nL001988     NULL        0x4C303031393838    NULL                    IN\nL002002     NULL        0x4C303032303032    NULL                    IN\n</code></pre>\n\n<p>As you can see, the left join behaves correctly, but the NOT IN does not, returning IN for values that should be NOT IN. Why is this? Is it a bug, or a feature of SQL I don't know about?</p>\n"},{"tags":["sql-server","error-handling","ssas"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13007737,"title":"Error Log records in SSAS","body":"<p>We are processing cubes every day in job activity monitor, But on weekends w are receving email notification like \"cube processing hase been failed\". Is there any way to maintain error logs (like in ssis) on cubes?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1391,"score":3,"question_id":6134016,"title":"How to escape back slash in SQL server","body":"<pre><code>DECLARE @Query nvarchar(max)\nSET @Query ='DECLARE @Test nvarchar(max)\nSELECT @Test = ''\\a'\\b'\\c''\nSELECT @Test\nPRINT @Query\nexec sp_executesql @Query\n</code></pre>\n\n<p>I am trying to get an output as \\a\\b\\c. The above error is probably because I am not able to escape the \\ character.</p>\n"},{"tags":["sql-server","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":10897473,"title":"Complex SQL Server Database Query","body":"<p>Previously I had only one table (I have more, ofc, but these are the ones I'm struggling with), which was the <code>UNIVERSITY</code> table.</p>\n\n<p>I now want to create two more tables : <code>STATE</code> and <code>CITY</code>.</p>\n\n<h3>Table Attributes</h3>\n\n<pre><code>UNIVERSITY: ID, NAME, SHORTNAME, FK_STATE, FK_CITY\n\nSTATE: ID, NAME, SHORTNAME\n\nCITY : ID, NAME\n</code></pre>\n\n<h3>Problem</h3>\n\n<p>I am parsing a excel sheet for the universities (including the city and state in which this university resides). Once I have all this information in memory, the hardest part comes.</p>\n\n<p>How do I:</p>\n\n<blockquote>\n  <p>Insert all Universities in the database,including its state and city, but querying the STATE and CITY databases for their IDs, to set the FK's of the university correctly.</p>\n</blockquote>\n\n<p>Example:<br>\nOnce I add a University named 'PUC-RIO', it is presented in 'RIO DE JANEIRO', (city) 'RIO DE JANEIRO' (state aswell). Adding the university itself is not a problem, but, how can I update its foreign key to the 'RIO DE JANEIRO' Key on state and city tables?</p>\n"},{"tags":["sql-server","variables","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13221637,"title":"Multiple variables in SQL Server stored procedure","body":"<p>I'm stuck on assigned variable values in this stored procedure.</p>\n\n<pre><code>@EntityID int,\n@Title1 varchar(10) OUTPUT,\n@Title2 varchar(10) OUTPUT\nAS\n  Declare @T1 varchar(10)\n  Declare @T2 varchar(10)\nBEGIN\n\n    SELECT     \n       dbo.Entity.EntityID, dbo.Types.TypeName AS Title1, Types_1.TypeName AS Title2\n    FROM         \n       dbo.Entity \n    LEFT OUTER JOIN\n       dbo.Types AS Types_1 ON dbo.Entity.Title2 = Types_1.TypeID \n                            AND dbo.Entity.Title2 = Types_1.TypeID \n    LEFT OUTER JOIN\n       dbo.Types ON dbo.Entity.Title1 = dbo.Types.TypeID\n    WHERE     \n       (dbo.Entity.EntityID = @EntityID)\nEND\n</code></pre>\n\n<p>I'm trying to return the values of <code>Title1</code> and <code>Title2</code>. The query works, and returns values, but I need to use them elsewhere.</p>\n\n<p>Thanks for your help.</p>\n\n<p>Steve</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":268,"score":0,"question_id":6736797,"title":"C#: Unknown constructor 'Parameter(String, TypeCode, Int)' of 'System.Web.UI.WebControls.Parameter'","body":"<p>In my code behind I have the code below to execute an insert command.  Two of the parameter values are to be set when the user clicks a particular button.  I broke it out this way because I'd like to reuse the <code>SqlDataSource</code>.</p>\n\n<p>My problem is with this line <code>(@\"Amount\", TypeCode.Int16, amount)</code>.  The specific error is <code>C#: Unknown constructor Parameter(String, TypeCode, Int) of System.Web.UI.WebControls.Parameter</code>.  Can someone point out what I did wrong? Or, please tell me what steps I can take to debug this.  I'm stuck.</p>\n\n<pre><code>    protected void InsertFees_Inserting(object sender, SqlDataSourceCommandEventArgs e)\n{\n    e.Command.Parameters[\"@UserID\"].Value = Convert.ToInt16(RadGrid1.SelectedValues[\"UserID\"].ToString());\n    e.Command.Parameters[\"@Type\"].Value = \"D\";\n    e.Command.Parameters[\"@Date\"].Value = DateTime.Now;\n    e.Command.Parameters[\"@Amount\"].Value = \"\";\n    e.Command.Parameters[\"@Description\"].Value = \"\";\n}\n\nprotected void RadButton2_Click(object sender, EventArgs e)\n{\n\n    try\n    {\n        int amount = Convert.ToInt16(RadNumericTextBox1.Text);\n        InsertFees.InsertParameters.Add(new Parameter(\"@Amount\", TypeCode.Int16, amount));\n        InsertFees.InsertParameters.Add(new Parameter(\"@Description\", TypeCode.String, RadTextBox2.Text));\n        InsertFees.Insert();\n        Label2.Text = \"Insert Successful\";\n    }\n\n    catch(Exception ex)\n    {\n        Panel1.Visible = true;\n        Label3.Text = ex.ToString();\n    }\n}\n</code></pre>\n"},{"tags":["sql","sql-server","query","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13223565,"title":"How can I split one record into two and set null values?","body":"<p>I have records with the following:</p>\n\n<pre><code>Id    Date          MondayMorning  MondayEvening  TuesdayMorning TuesdayEvening and so on\n1   2012-01-01          2               3               2              2\n2   2012-01-02          2               2               2              2\n</code></pre>\n\n<p>I want split record 1 in two records because the states of mondaymorning and mondayevening are not the same. If the state is the same then do nothing.  </p>\n\n<p>The result that I expect:</p>\n\n<pre><code>Id    Date          MondayMorning  MondayEvening  TuesdayMorning  TuesdayEvening\n1   2012-01-01          2               NULL          2                 2\n1   2012-01-01          NULL            3             NULL              NULL\n2   2012-01-02          2               2             2                 2\n</code></pre>\n\n<p>Please remember that also the other days can vary.</p>\n\n<p>I already have a query but, neem some changes. See the query on\n<a href=\"http://sqlfiddle.com/#!3/d41d8/5712\" rel=\"nofollow\">SQL Fiddle</a>.\nThe output you can see here is the case where it goes wrong. For TuesdayEvening and MondayEvening I am expecting 2.</p>\n\n<p>The information on SQL Fiddle is:</p>\n\n<pre><code>Declare @t Table(Id int identity,[Date] Datetime,MondayMorning Int,MondayEvening Int,TuesdayMorning Int,TuesdayEvening Int)\nInsert Into @t Select '2012-01-01',0,2,0,2\n\nSELECT id\n    ,date\n    ,MondayMorning\n    ,(CASE WHEN MondayEvening &lt;&gt; MondayMorning THEN NULL ELSE MondayEvening END) AS MondayEvening\n    ,TuesdayMorning\n    ,(CASE WHEN TuesdayEvening &lt;&gt; TuesdayMorning THEN NULL ELSE TuesdayEvening END) AS TuesdayEvening\nFROM @t \n\nUNION ALL \n\nSELECT id\n    ,date\n    ,NULL AS MondayMorning\n    ,(CASE WHEN MondayEvening = MondayMorning THEN NULL ELSE MondayEvening END) AS MondayEvening\n    ,NULL AS TuesdayMorning\n    ,(CASE WHEN TuesdayEvening = TuesdayMorning THEN NULL ELSE TuesdayEvening END) AS TuesdayEvening\nFROM @t\nWHERE --MondayMorning &lt;&gt; MondayEvening\n--OR TuesdayMorning &lt;&gt; TuesdayEvening\nMondayMorning &lt;&gt; MondayEvening\nAND (MondayMorning != 0 and MondayEvening != 0)\nOR TuesdayMorning &lt;&gt; TuesdayEvening\nAND (TuesdayEvening != 0 and TuesdayMorning != 0)\n</code></pre>\n"},{"tags":["sql-server","visual-studio","visual-studio-2012","sql-server-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":43,"score":0,"question_id":13222445,"title":"Error when trying to connect to SQL Server 2012 from Visual Studio 2012","body":"<p>The tools used:\nVisual Studio 2012, MS SQL Server 2012, and VB.NET MVC 4</p>\n\n<p>Here is a showcase of how I attempt to establish a connection to the server and create a database.</p>\n\n<p>In this example MS SQL Server Compact 4.0 is used:</p>\n\n<h2>Step 1</h2>\n\n<p>Do <code>add the server</code>. </p>\n\n<p>The <code>Windows username</code> is used.</p>\n\n<p><img src=\"http://i.stack.imgur.com/RjvFr.png\" alt=\"Connecting to the MS SQL Server 2012\"></p>\n\n<h2>Step 2</h2>\n\n<p>Do add the <code>database connection</code>.</p>\n\n<p>Also, do <code>test the connection</code>.</p>\n\n<p><img src=\"http://i.stack.imgur.com/N7Adf.png\" alt=\"Connecting to the MS SQL Server 2012\"></p>\n\n<h2>Step 3</h2>\n\n<p>Do <code>create a table</code>.</p>\n\n<p><img src=\"http://i.stack.imgur.com/EELhq.png\" alt=\"Connecting to the MS SQL Server 2012\"></p>\n\n<hr />\n\n<h2>As a Notice, This Question Has Been Rewritten</h2>\n\n<p>I have managed the connection to the MS SQL Sever Compact 4.0, successfully. Yet, I am still getting the following error message with the other possible choices: e.g. MS SQL Server 2012, and MS Access Database File.</p>\n\n<p><img src=\"http://i.stack.imgur.com/Af2yu.png\" alt=\"Error Message - MS SQL Server 2012\"></p>\n"},{"tags":["sql-server","data-structures","ssas","cube"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13122878,"title":"What is the data structure for sql server analysis service's cube data storage?","body":"<p>I want to know that what is the used data structure for storing cubes and what is the mechanism for reading data from that.</p>\n"},{"tags":["sql","sql-server","join","left-join","outer-join"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13221154,"title":"How can I get join not duplicate?","body":"<p>I get join 2 tables but use 3 table. I need not duplicate values. But I try join have duplicate.</p>\n\n<p>Table <code>peopleAll</code>:</p>\n\n<pre><code>pNo    pName\n-------------\n00001  Sang\n00002  Janta\n00003  Els\n00004  Est\n00005  Sam\n00006  John\n00007  Misan\n00008  Wila\n00009  light\n00010  Smith\n00011  Ritpo\n</code></pre>\n\n<p>Table <code>fTime</code>:</p>\n\n<pre><code>cNo    cDate                     cIn                        cOut\n-----------------------------------------------------------------------------------\n00001  2012-10-22 00:00:00.000   2012-10-22 07:59:00.000    2012-10-22 20:34:00.000\n00002  2012-10-22 00:00:00.000   2012-10-22 12:50:00.000    2012-10-22 19:50:00.000\n00003  2012-10-22 00:00:00.000   2012-10-22 12:01:00.000    2012-10-22 20:30:00.000\n00004  2012-10-22 00:00:00.000   2012-10-22 07:55:00.000    2012-10-22 20:30:00.000\n00005  2012-10-22 00:00:00.000   2012-10-22 07:27:00.000    2012-10-22 20:31:00.000\n00010  2012-10-22 00:00:00.000   2012-10-22 07:12:00.000    2012-10-22 20:22:00.000\n</code></pre>\n\n<p>Table <code>Leave</code>:</p>\n\n<pre><code>lNo    lDate                     lStart                     lStop\n-----------------------------------------------------------------------------------\n00002  2012-10-22 00:00:00.000   2012-10-22 08:00:00.000    2012-10-22 12:00:00.000\n00003  2012-10-22 00:00:00.000   2012-10-22 08:00:00.000    2012-10-22 12:00:00.000\n00011  2012-10-22 00:00:00.000   NULL                       NULL\n</code></pre>\n\n<p>This SQL code:</p>\n\n<pre><code>SELECT lr.lNo, lr.lDate, lr.lStart, lr.lStop \nFROM Leave lr \nWhere lr.cStart = '2012-10-22'\n\nUNION ALL\n\nSELECT pa.pNo, ISNULL(tf.cDate, Convert(nvarchar(10),'2012-10-22',114)),tf.cIn, tf.cOut\nFROM fTime tf FULL OUTER join peopleAll pa On tf.cNo = pa.pNo AND \ntf.cDate = Convert(nvarchar(10),'2012-10-22',114)\n</code></pre>\n\n<p>returns this output:</p>\n\n<pre><code>lNo    lDate                     lStart                     lStop\n-----------------------------------------------------------------------------------\n00001  2012-10-22 00:00:00.000   2012-10-22 07:59:00.000    2012-10-22 20:34:00.000\n00002  2012-10-22 00:00:00.000   2012-10-22 08:00:00.000    2012-10-22 12:00:00.000\n00002  2012-10-22 00:00:00.000   2012-10-22 12:50:00.000    2012-10-22 19:50:00.000\n00003  2012-10-22 00:00:00.000   2012-10-22 08:00:00.000    2012-10-22 12:00:00.000\n00003  2012-10-22 00:00:00.000   2012-10-22 12:01:00.000    2012-10-22 20:30:00.000\n00004  2012-10-22 00:00:00.000   2012-10-22 07:55:00.000    2012-10-22 20:30:00.000\n00005  2012-10-22 00:00:00.000   2012-10-22 07:27:00.000    2012-10-22 20:31:00.000\n00006  2012-10-22 00:00:00.000   NULL                       NULL\n00007  2012-10-22 00:00:00.000   NULL                       NULL\n00008  2012-10-22 00:00:00.000   NULL                       NULL\n00009  2012-10-22 00:00:00.000   NULL                       NULL\n00010  2012-10-22 00:00:00.000   2012-10-22 07:12:00.000    2012-10-22 20:22:00.000\n00011  2012-10-22 00:00:00.000   NULL                       NULL\n</code></pre>\n\n<p>I try to change <code>FULL OUTER JOIN</code> then <code>LEFT OUTER JOIN</code> and I get output:</p>\n\n<pre><code>lNo    lDate                     lStart                     lStop\n-----------------------------------------------------------------------------------\n00002  2012-10-22 00:00:00.000   2012-10-22 08:00:00.000    2012-10-22 12:00:00.000\n00002  2012-10-22 00:00:00.000   2012-10-22 12:50:00.000    2012-10-22 19:50:00.000\n00003  2012-10-22 00:00:00.000   2012-10-22 08:00:00.000    2012-10-22 12:00:00.000\n00003  2012-10-22 00:00:00.000   2012-10-22 12:01:00.000    2012-10-22 20:30:00.000\n00004  2012-10-22 00:00:00.000   2012-10-22 07:55:00.000    2012-10-22 20:30:00.000\n00007  2012-10-22 00:00:00.000   NULL                       NULL\n00008  2012-10-22 00:00:00.000   NULL                       NULL\n00010  2012-10-22 00:00:00.000   2012-10-22 07:12:00.000    2012-10-22 20:22:00.000\n00011  2012-10-22 00:00:00.000   NULL                       NULL\n</code></pre>\n\n<p>LEFT OUTER join have miss some field??</p>\n\n<p>I need this output:</p>\n\n<pre><code>lNo    lDate                     lStart                     lStop\n-----------------------------------------------------------------------------------\n00001  2012-10-22 00:00:00.000   2012-10-22 07:59:00.000    2012-10-22 20:34:00.000\n00002  2012-10-22 00:00:00.000   2012-10-22 12:50:00.000    2012-10-22 19:50:00.000 \n00003  2012-10-22 00:00:00.000   2012-10-22 12:01:00.000    2012-10-22 20:30:00.000\n00004  2012-10-22 00:00:00.000   2012-10-22 07:55:00.000    2012-10-22 20:30:00.000\n00005  2012-10-22 00:00:00.000   2012-10-22 07:27:00.000    2012-10-22 20:31:00.000\n00006  2012-10-22 00:00:00.000   NULL                       NULL\n00007  2012-10-22 00:00:00.000   NULL                       NULL\n00008  2012-10-22 00:00:00.000   NULL                       NULL\n00009  2012-10-22 00:00:00.000   NULL                       NULL\n00010  2012-10-22 00:00:00.000   2012-10-22 07:12:00.000    2012-10-22 20:22:00.000\n00011  2012-10-22 00:00:00.000   NULL                       NULL\n\n(00002,00003 from fTime)\n</code></pre>\n\n<p>Please help me. Thanks you for you time. :)</p>\n"},{"tags":["sql-server","sql-server-2008-r2","relationships","table-relationships"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":75,"score":4,"question_id":13167633,"title":"Create a One-to-Optional-One constraint in SQL Server","body":"<p>i have a <em>\"main table\"</em>, call it <code>Customers</code>:</p>\n\n<pre><code> CREATE TABLE Customers (\n     CustomerID int PRIMARY KEY NOT NULL,\n     FirstName nvarchar(50),\n     LastName nvarchar(50)\n )\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/42mi6.png\" alt=\"enter image description here\"></p>\n\n<p>And i have a <em>\"satellite table\"</em>, call it <code>Customer_IllegallyObtainedInformation</code>:</p>\n\n<pre><code>CREATE TABLE Customer_IllegallyObtainedInformation (\n    CustomerID int PRIMARY KEY NOT NULL,\n    CellPhonePin int,\n    SexualOrientation varchar(20),\n    EmailPassword varchar(50)\n)\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/Qx0Iv.png\" alt=\"enter image description here\"></p>\n\n<p>Now, what i <strong>want</strong> is a foreign key constraint from the <code>Illegal</code> table back to the main <code>Customers</code> table:</p>\n\n<p><img src=\"http://i.stack.imgur.com/MJgwD.png\" alt=\"enter image description here\"></p>\n\n<p>In other words:</p>\n\n<ul>\n<li>there <strong>can</strong> be a <code>Customer</code> <strong>without</strong> an <em><code>Illegal</code></em> entry</li>\n<li>but there can <strong>never</strong> be an <em><code>Illegal</code></em> entry without a <code>Customer</code></li>\n</ul>\n\n<p>My instinct was to, in the SQL Server database diagram, drag</p>\n\n<ul>\n<li><strong>FROM</strong> the <code>Illegal</code> table <strong>TO</strong> the <code>Customers</code> table</li>\n</ul>\n\n<p>Indicating to SQL Server that <code>Customers_IllegallyObtainedInformation</code> is the \"child\" in the relationship. Instead what happens in that SQL Server makes it a one-to-one relationship:</p>\n\n<p><img src=\"http://i.stack.imgur.com/QIqfU.png\" alt=\"enter image description here\"></p>\n\n<p>Meaning that if you try to insert a <code>Customer</code>, it will fail because there is no existing <code>Illegal</code> information. </p>\n\n<p>How can i create a <em>\"Parent-Child\"</em>, or <em>\"One-to-Optional-One\"</em> relationship in SQL Server?</p>\n\n<hr>\n\n<p><strong>Note:</strong> Don't confuse the example with the question. i could create an sacrificial primary surrogate key in the <code>Illegal</code> table:</p>\n\n<p><img src=\"http://i.stack.imgur.com/16t1b.png\" alt=\"enter image description here\"></p>\n\n<p>But that wasn't my question.</p>\n"},{"tags":["sql","sql-server","query","insert","character"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13218271,"title":"SQL statement using special charter","body":"<p>Can anyone please help me in correcting below statement:</p>\n\n<pre><code>SET @cmd='BULK INSERT ' + @Database + '.dbo.' + @tmp + ' from ' + @Out + @tmp + '.csv \nWITH (FIELDTERMINATOR = , , ROWTERMINATOR = \\n)' \n</code></pre>\n\n<p>Output of the above query is: </p>\n\n<blockquote>\n  <p>BULK INSERT MP2.dbo.GLCODE from C:\\SABA\\GLCODE.csv WITH\n  (FIELDTERMINATOR = , , ROWTERMINATOR = \\n)</p>\n</blockquote>\n\n<p>I want to print this in below manner:</p>\n\n<blockquote>\n  <p>BULK INSERT MP2.dbo.GLCODE from C:\\SABA\\GLCODE.csv WITH\n  (FIELDTERMINATOR =',', ROWTERMINATOR = '\\n')</p>\n</blockquote>\n"},{"tags":["sql","sql-server","tsql","adventureworks"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":64,"score":3,"question_id":13220573,"title":"Adventure Works Explanation","body":"<p>I've been looking at Microsoft's Adventure Works 2012 database. I'd be very interested if there's any information explaining why the tables were created as they are. Some sort of schema overview I guess.</p>\n\n<p>For example: </p>\n\n<p>Why they chose to create a <code>BusinessEntity</code> table as a sort of base class for Person, Employee, etc.</p>\n\n<p>Most of the data is normalized so why they chose to put the <code>CountryRegionCode</code> field into the <code>StateProvince</code> table instead of an ID to a separate table.</p>\n\n<p>Anyway I'm very interested in learning more about the decisions that went into the databases design. Anyone know a resource that goes into this sort of thing?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13221588,"title":"SQL retrieve info from multiple tables","body":"<p>i have a question about sql and i need to know if i can retrieve results using only sql.</p>\n\n<p>I need to find the distance in km of the route with the id=1 that starts from station 1 and arrive at station 4. So route 1 will pass from 4 stations (the number could be more or less). I need to find the distance that a train will cover crossing all the 4 stations. Which are: 5+10+15=30</p>\n\n<p>is it possible to get the answer using only SQL?</p>\n\n<p>below are the tables (i hope you understand the structure):</p>\n\n<p>you can see an image of the table <a href=\"http://studio9.com.cy/testing/sql.gif\" rel=\"nofollow\">here</a></p>\n\n<pre><code>route - station\n-----------------------\n1     - 1    \n1     - 2    \n1     - 3    \n1     - 4\n\n\nstation1 - station2 - distance (km)\n------------------------------------\n1        - 2        -   5\n2        - 3        -   10\n3        - 4        -   15\n</code></pre>\n"},{"tags":["sql-server","sharepoint","sharepoint2010","powerpivot"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":11107210,"title":"Sharing Powerpivot reports","body":"<p>I have generated a report in Powerpivot for excel and want to share it with other members of my team. I do not want all of them to download and install Powerpivot add-on.</p>\n\n<p>I found out that the report can be shared over SharePoint 2010. For this I need to get the Powerpivot add-on for SharePoint installed as part of SQL Server. Am I right or Is there any way I can get Powerpivot to work with SharePoint? Buying SQL server just for Powerpivot add-on is not worth it because we will not be using SQL server.\nIs there any other way in which I can share the report?</p>\n"},{"tags":["sql-server","visual-c#-express-2010"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13215172,"title":"Database Connection Error \"file in use\"","body":"<p>I am using Visual Studio 2010 C# Express and SQL Server Management Studio with SQL Server 2012\nI am getting an error when I try to connect a database to my Windows forms project. </p>\n\n<pre><code>\"This file is in use.  Enter a new name or\nclose the file that is open in another program\"\n</code></pre>\n\n<p>I poked around online to try to find a solution but none worked.   So i decided to create a brand new database and a brand new project.  But I still get the error!</p>\n\n<p>here are the steps I use:   </p>\n\n<ul>\n<li>First I connected to my locally hosted server  </li>\n<li>then i right-clicked on <code>Databases</code> and selected <code>New Database</code> and named it <code>school</code>  </li>\n<li>then i right clicked the <code>tables</code> folder on my new database and selected <code>new table</code>  </li>\n<li>I added thes tables <code>student, course, enrolled</code> </li>\n<li>finally i threw some bogus entries into it</li>\n</ul>\n\n<p>Now I jump over to VS   </p>\n\n<ul>\n<li>I select <code>New Project</code> then <code>Windows Forms Application</code> and name it <code>Registrar</code>  </li>\n<li>then i click <code>add new data source</code>   </li>\n<li>select <code>database</code> in the <code>Choose a data source type</code> window  </li>\n<li>then i select <code>Dataset</code> in the <code>Choose a Database Model</code> window  </li>\n<li>then I click <code>New Connection</code>  I change the DataSource to <code>Microsoft SQL Server Database   File</code> browse to the DATA folder inside my 'SQLEXPRESS' folder and when i click the 'school.mdf' file i get the above error.</li>\n</ul>\n\n<p>any help would be greatly appreciated.</p>\n"},{"tags":["mysql","sql-server","database","dedicated-server","development-machine"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":13221704,"title":"MySQL configuration type?","body":"<p>I am installing MySQL and when it reaches the configuration step it is asking me to select from on of the following server configuration types:</p>\n\n<ul>\n<li>Development Machine</li>\n<li>Server Machine</li>\n<li>Dedicated Machine</li>\n</ul>\n\n<p>I am new to mysql, the reason I am installing this is because I am making an application which will store data on a database using MySQL. Now, can someone explain what does these server configurable type mean and which one should I be selecting? </p>\n"},{"tags":["sql","sql-server","join","pagination"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13220743,"title":"Implement paging (skip / take) functionality with this query","body":"<p>I have been trying to understand a little bit about how to implement custom paging in SQL, for instance reading <a href=\"http://stackoverflow.com/questions/548475/efficient-way-to-implement-paging\">articles like this one</a>.</p>\n\n<p>I have the following query, which works perfectly. But I would like to implement paging with this one.</p>\n\n<pre><code>SELECT TOP x PostId FROM ( SELECT PostId, MAX (Datemade) as LastDate\n from dbForumEntry \n group by PostId ) SubQueryAlias\n order by LastDate desc\n</code></pre>\n\n<p><strong>What is it I want</strong></p>\n\n<p>I have forum posts, with related entries. I want to get the posts with the latest added entries, so I can select the recently debated posts.</p>\n\n<p>Now, I want to be able to get the \"top 10 to 20 recently active posts\", instead of \"top 10\".</p>\n\n<p><strong>What have I tried</strong></p>\n\n<p>I have tried to implement the ROW functions as the one in the article, but really with no luck. </p>\n\n<p>Any ideas how to implement it?</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13210881,"title":"Getting the Id of a row updated in Sql Server for a table with trigger","body":"<p>There is good answer here: <a href=\"http://stackoverflow.com/a/1610530/630169\">http://stackoverflow.com/a/1610530/630169</a> \nHowever if updated table have a trigger that does not work as SQL Server produces error: The target table 'my_table' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause. What to do if table has trigger?</p>\n"},{"tags":["sql-server","tsql","select"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13218684,"title":"T-SQL replace value on select","body":"<p>I have a column (<code>SERVICE_ID</code>) in my table where I can have only 3 values: 0, 1 and 2. </p>\n\n<p>On a <code>SELECT</code>, I'd like to change those values into English words for display:</p>\n\n<pre><code>select client, SERVICE_ID\nfrom customers\n</code></pre>\n\n<p>Currently displays:</p>\n\n<pre><code>| John     | 1\n| Mike     | 0\n| Jordan   | 1\n| Oren     | 2\n</code></pre>\n\n<p>I'd like to change the query to get:</p>\n\n<pre><code>| John     | QA\n| Mike     | development\n| Jordan   | QA\n| Oren     | management\n</code></pre>\n\n<p>There is any way to do this using only the select?</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2008","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":62,"score":0,"question_id":13216924,"title":"How can i update another tables after adding record to a table in sql server 2008","body":"<p>I have two same tables created in SQL Server 2008.</p>\n\n<p>What I need is:</p>\n\n<p><strong>Add the newest data inserted in <code>table1</code> into <code>table2</code>.</strong></p>\n\n<p>Is that possible? </p>\n\n<p>Something like services or triggers or stored procedures?</p>\n\n<p>I think that I have to use triggers, but I don't know how.</p>\n\n<p>I have these two tables:</p>\n\n<pre><code>table1  ( field1,field2,field3 )\ntable2  ( field1,field2,field3 )\n</code></pre>\n\n<p>when i insert into table1 i need table2 to be updated as the procedure below:    </p>\n\n<pre><code>&gt; IF NotExist(field1=value) in table2 THEN INSERT Into table2 ELSE UPDATE table2\n&gt; with new field1 value.\n</code></pre>\n"},{"tags":["sql-server","visual-studio-2010"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":87,"score":3,"question_id":13117683,"title":"I can't create a database diagram in VS2010 for SQL Server Express","body":"<p>For some reason, when I click <code>Add Diagram</code> in Server Explorer I am left with an empty tab for designing diagrams. However, there is no dialog box which usually asks what tables to add. The dropdown menu at the top called <code>Diagrams</code> also has all the buttons inactive. </p>\n\n<p>What could be the reason? </p>\n\n<p>I have my SQL Server Express running (checked in SQL Server Configuration Manager). Version - 10.1.</p>\n"},{"tags":["sql","sql-server","join","distinct"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":13219582,"title":"SQL Query - Combine DISTINCT and TOP?","body":"<p>I have the following query I want to fire:</p>\n\n<pre><code>SELECT DISTINCT TOP(5) fp.PostId FROM dbForumPosts fp\nLEFT JOIN dbForumEntry fe ON fp.PostId = fe.PostId\nOrder by fe.Datemade DESC\n</code></pre>\n\n<p>However, when I fire it, I get the error:</p>\n\n<pre><code>Msg 145, Level 15, State 1, Line 1\nORDER BY items must appear in the select list if SELECT DISTINCT is specified.\n</code></pre>\n\n<p>I tried to change the query, so it used GROUP BY instead, but then I have the following problem:</p>\n\n<pre><code>Msg 8127, Level 16, State 1, Line 4\nColumn \"dbForumEntry.Datemade\" is invalid in the ORDER BY clause because it is not contained in either an aggregate function or the GROUP BY clause.\n</code></pre>\n\n<p><strong>WHAT DO I WANT:</strong></p>\n\n<p>Think of this as a forum. There are posts (dbForumPosts) and entries (dbForumEntry). There are 0-many entries pr post.</p>\n\n<p>What I want is to the get posts with the most recent activity (posts with the latest updated entries in).</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":13218892,"title":"SQL Server: +(unary) operator on non-numeric Strings","body":"<p>I am surprised! This statement below is valid in <code>SQL SERVER</code>:</p>\n\n<pre><code>SELECT  +'ABCDEF'\n</code></pre>\n\n<p>Has <code>SQL Server</code> defined <code>+</code> as a <code>Unary</code> operator for string types?</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13218482,"title":"Check for SQL Server existence before connection","body":"<p>We need to check for the existence of a SQL server across all domains prior to attempting to connect to the server. We can loop through the list of servers on the local domain use SQLDataSourceEnumerator, but that takes a few seconds to load up and it only gets the local domain. We are using SQL Server 2005 and 2008 servers as well as .Net 2010. We don't want to attempt to connect and wait for the 30 second or more timeout that appears to be standard if the server doesn't exist. </p>\n\n<p>Any suggestions would be helpful.</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13218851,"title":"SQL : Update ID; According to Date","body":"<p>I have Table below.</p>\n\n<p><img src=\"http://i.stack.imgur.com/GpVhy.jpg\" alt=\"enter image description here\"></p>\n\n<p>I like to <em>Update</em> <code>ID</code> according to date and then by User. </p>\n\n<h3>For Example</h3>\n\n<p><img src=\"http://i.stack.imgur.com/oyzfU.jpg\" alt=\"enter image description here\"></p>\n\n<h3>Thanks</h3>\n"},{"tags":["sql-server","ddl","ssms"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":2825,"score":6,"question_id":2431901,"title":"Forcing Management Studio to use ALTER TABLE instead of DROP/CREATE","body":"<p>I'm wondering if is there a way to force MSSQL Management Studio to produce a script like this:</p>\n\n<pre><code>ALTER TABLE Mytable\nADD MyCol bit NOT NULL\nCONSTRAINT MyColDefault\nDEFAULT 0 WITH VALUES\n\n\nALTER TABLE [dbo].Mytable\nALTER COLUMN MyCol2 int NULL\n\nGO \n</code></pre>\n\n<p>when I alter a very simple property of a column on a table.\nIf I do this in the designer and ask for the produced script, the script doesn't do such simple tasks, but instead copies all the data in a tmp table, drops the original table, renames the tmp table with the original table name. And, of course, drops and recreates every constraint and relationships.</p>\n\n<p>Is there any option I can change to change this behaviour? Or, this may be possible, is there some danger I don't see in using the simple ALTER TABLE above?</p>\n\n<p>thanks.</p>\n"},{"tags":["sql-server","cursor","structure"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":51,"score":-4,"question_id":13218625,"title":"cursor in sql server","body":"<pre><code>create table sales (\n    unitcode int ,\n    categorycode smallint ,\n    ddate varchar(10) ,\n    price float\n)\nand\ncreate table timetable (\n    year varchar(4) ,\n    month varchar(11) ,\n    ddate varchar(10)\n)\n</code></pre>\n\n<p>I have 2 tables and 3 years (2000,2001,2002) , I want to write a query with CURSOR to find this question:\nin eech month of eech year which 2 products have max price?</p>\n"},{"tags":["sql-server","asp.net-mvc","webmatrix","simplemembership"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13215644,"title":"Control the tables generated by SimpleMembershipProvider?","body":"<p>I found <code>SimpleMembershipProvider</code> to be pretty neat and productive.</p>\n\n<p>I was wondering if there is a way to control the generate table/column names/datatypes.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","full-text-search"],"answer_count":4,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":9906,"score":10,"question_id":6003240,"title":"Cannot use a CONTAINS or FREETEXT predicate on table or indexed view because it is not full-text indexed","body":"<p>I am getting following error in my SQL server 2008 R2 database:</p>\n\n<blockquote>\n  <p>Cannot use a <code>CONTAINS</code> or <code>FREETEXT</code> predicate on table or indexed view 'tblArmy' because it is not full-text indexed.</p>\n</blockquote>\n"},{"tags":["c#","sql-server","linq-to-sql","datacontext"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":69,"score":0,"question_id":13210066,"title":"no response from server","body":"<p>I'm using LINQ to SQL  (data context) of Microsoft. I also created stored procedure using SQL server 2008. When I call the stored procedure from within the c# code : </p>\n\n<pre><code>_context.Get_Data(params...)\n</code></pre>\n\n<p>always after 19 calls to the SQL server it get stuck, and an exception is thrown:</p>\n\n<blockquote>\n  <p>\"No response from server...\".</p>\n</blockquote>\n\n<p>I tried to execute the stored procedure from the SQL code and it works fine. I also added </p>\n\n<pre><code>with(no lock)\n</code></pre>\n\n<p>and nothing has happened.</p>\n\n<p>Do you have any suggestion for me?</p>\n\n<p>Stack Trace:</p>\n\n<blockquote>\n  <p>at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action1 wrapCloseInAction) at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action1 wrapCloseInAction) at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose) at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean&amp; dataReady) at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData() at System.Data.SqlClient.SqlDataReader.get_MetaData()</p>\n</blockquote>\n"},{"tags":["sql-server","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13216265,"title":"Usage of sequence in SQL Server 2012","body":"<p>I have <code>SQL Server 2012</code> and I want to know what's the usage of sequence. I Look for a sample to explain usage of sequence.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I know create and use Sequence in database. I want to know what is practical scenario for use of Sequence.</p>\n"},{"tags":["mysql","sql-server","oracle","postgresql","liquibase"],"answer_count":1,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":141,"score":7,"question_id":11955313,"title":"How to create ordered index with liquibase?","body":"<p>I am wondering if there is a generic way to create an \"ordered index\" with liquibase.</p>\n\n<p>Something that will produce these kind of SQL statement: </p>\n\n<pre><code>CREATE INDEX idx_name ON my_table (m_column DESC)\n</code></pre>\n\n<p>I need that for oracle, postgresql, mysql, and sql server.</p>\n\n<p>If not, I'll have to do it manually with the <code>SQL</code> tag for each RDBM.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","sql-server-express","ssms","sql-server-2008-express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3364,"score":0,"question_id":3172965,"title":"Can't connect to local computer via SQL Server 2008 Express Management Studio","body":"<p>HI, folks,  </p>\n\n<p>Previously, I had a SQL Server 2008 installed, but then I deleted it, and installed SQL Server 2008 Express Management Studio. And now I can't connect to local computer. I get error :</p>\n\n<blockquote>\n  <p>A network-related or instance-specific\n  error occured while establishing a\n  connection to SQL server. The server\n  was not found or was not\n  accesible.Verify that the instance\n  name is correct and that SQl Server is\n  configured to allow remote\n  connections.(provide: Named Pipes\n  Provider, error:40 - Could not open a\n  connection to SQL Server) (Microsoft\n  SQL Server, Error: 2).</p>\n</blockquote>\n\n<p>But I can create DB via VS2010. </p>\n"},{"tags":["sql-server","sql-server-2008","oracle10g","data-migration"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1968,"score":0,"question_id":3482067,"title":"How to migrate database from Oracle to SQL Server?","body":"<p>I have a database on <strong>Oracle 9i</strong>. Now I want to work on <strong>SQL Server 2008</strong>. I want  to migrate the Oracle database to SQL Server, but how do I do that? Give me some syntax? Thanks for the help.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13192145,"title":"SQL return both table rows separately","body":"<p>I have two tables and want to return both table's rows. Both tables do not have any relation.</p>\n\n<p><code>Table 1</code> has columns <code>userid, name</code>, and other columns... and <code>Table 2</code> has only two columns <code>id, name</code>.</p>\n\n<p>I want both table results in one query result set.</p>\n\n<p>Table results:</p>\n\n<pre><code>userid name and other columns from Table 1.\nid     name and NULL, NULL should show as Table 2 do not have extra columns.\n</code></pre>\n"},{"tags":["c#","sql-server","sqldatatypes"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13216267,"title":"Issue with datatype nchar in SQL Server database","body":"<p>I am using SQL Server 2008, Visual Web Developer 2012 and .net 4.0. I created a table in SQL Server and added some columns to it. I gave some columns the datatype <code>nchar(10)</code>. </p>\n\n<p>Now my problem is that when I insert string of less than 10 characters as a value of the column type <code>nchar(10)</code> and when I fetched the value it inserts blank spaces to complete the 10 character string. </p>\n\n<p>Means if I insert <code>\"a\"</code> into column of type <code>nchar(10)</code>, \nthen when I fetch the value again I get back: <code>\"a         \"</code></p>\n\n<p>How can I resolve this issue ?</p>\n"},{"tags":["sql-server","sharing","mdf"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":3075,"score":0,"question_id":9093458,"title":"Can't connect to my own MDF file. Cannot open user default database. Login failed.Login failed for user... and other errors","body":"<p><strong>SQLSEXPRESS service IS running!!</strong></p>\n\n<p>I have I program I wrote some time ago and it works. It was written in MS Visual Studio with local MDF file. </p>\n\n<p>How is it possible to edit this file from Microsoft SQL Server Management Studio? I don't see this file in the list of globally connected databases.</p>\n\n<p>If I try to attach this file with Visual Studio Wizard, I get message that such database already exists, but when I set arbitrary logical name, I get sharing violation.</p>\n\n<p>How to reach MDF file?</p>\n\n<p><strong>EDIT 1</strong></p>\n\n<p>Now I found that my program also stopped to work.</p>\n\n<p>The summary of results of different attempts to reach MDF file:</p>\n\n<ol>\n<li>Program itself System.Data.SqlClient.SqlException (0x80131904): Cannot open user default database. Login failed. Login failed for user <code>&lt;username&gt;</code>. (windows user)</li>\n<li>Visual Studio, Data source = Microsoft SQL Server, Logical Name = \"\" <strong><em>Error message</em></strong>: An attempt to attach an auto-named database for file\n<code>&lt;filename&gt;</code> failed. A database with the same name exists, or\nspecified file cannot be opened, or it is located on UNC share.</li>\n<li>Visual Studio, Data source = Microsoft SQL Server, Logical Name = SOMENAME <strong><em>Error message</em></strong> Unable to open the physical file <code>&lt;filename&gt;</code>. Operating system error 32: \"32(The process cannot access the file because it is being used by another process )\".\nCannot attach the file <code>&lt;filename&gt;</code> as database SOMENAME.</li>\n<li>Visual Studio, Data source = Microsoft SQL Server Database File, Windows Authentication <strong><em>Error message</em></strong>: Cannot open user default database. Login failed. Login failed for user <code>&lt;username&gt;</code>.</li>\n<li>Visual Studio, Data source = Microsoft SQL Server Database File, SQL Server Authentication <strong><em>Error message</em></strong>: Failed to generate a user instance of SQL Server. Only an integrated connection can generate a user instance. The connection will be closed.</li>\n<li>Microsoft SQL Server Management Studio, Attach Database <strong><em>Error message</em></strong>: Unable to open the physical file <code>&lt;filename&gt;</code>. Operating system error 32: \"32(The process cannot access the file because it is being used by another process)\". (Microsoft SQL Server, Error: 5120)</li>\n</ol>\n"},{"tags":["sql-server","nhibernate","spatial","geography"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16,"score":1,"question_id":13214033,"title":"combining sql server spatial and NHibernate with CreateSqlQuery","body":"<p>I have not mapped geography table in sql server 2008, and I want to query it with a polygon instance in c# using nhibernate.\n<br>In the beggining I was trying to use sql server spatial directly but encountered this problem:\n<a href=\"http://stackoverflow.com/questions/238050/using-sql-server-2008-geography-types-with-nhibernates-createsqlquery\">Using SQL Server 2008 Geography types with nHibernate&#39;s CreateSQLQuery</a>\n<p>My second try was this:</p>\n\n<pre><code>session.CreateSQLQuery(\"select [shape] from [table] where (:codeShape).STIntersects([shape]) = 1\").SetParameter(\"codeShape\", codeShape, NHibernateUtil.Custom(typeof(MsSql2008GeographyType)));\n</code></pre>\n\n<p>however this try also raise an exception:\n<br></p>\n\n<pre><code>Could not execute query [select [shape] from [table] where (?).STIntersects([shape]) = 1\")] Name:codeShape - Value:POLYGON((30 40, ...))\n</code></pre>\n\n<p><p>and the inner exception is:<br></p>\n\n<pre><code>The specified input does not represent a valid geography instance.\n</code></pre>\n\n<p>That's despite codeShape.IsValid returns true.</p>\n\n<p>When I run this query directly in sql server I get the expected result.</p>\n\n<p>any ideas or solutions?</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","sql","sql-server","port","sqlclient"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":13214174,"title":"Is the port automatically gathered from SQL Server?","body":"<p>I've noticed that if I don't supply a port when I build a connection string I can still connect to SQL Server via a named instance that looks like [SERVER][INSTANCE_NAME].</p>\n\n<p>Is sqlclient automatically gathering the port number for me? Do I have to concern myself with port number even if the instance is the default instance?</p>\n\n<p>I'm sorry if this question seems novice. Google just hasn't turned anything up for me.</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql-server","stored-procedures","jdbc"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":5557,"score":2,"question_id":858631,"title":"What can cause the SQL Server JDBC error 'The value is not set for the parameter number 0' for an output parameter access?","body":"<p>I have some Java code that accesses SQL Server 2005 which looks something like this:</p>\n\n<pre><code>CallableStatement cstmt = ...;\n... // Set input parameters\ncstmt.registerOutParameter(11, Types.INTEGER);\ncstmt.execute();\nint out = cstmt.getInt(11);\n</code></pre>\n\n<p>And the following exception is thrown from the last line:</p>\n\n<pre><code>com.microsoft.sqlserver.jdbc.SQLServerException: The value is not set \n     for the parameter number 0.\n   at com.microsoft.sqlserver.jdbc.SQLServerException.\n     makeFromDriverError(Unknown Source)\n   at com.microsoft.sqlserver.jdbc.SQLServerCallableStatement.\n     skipOutParameters(Unknown Source)\n   at com.microsoft.sqlserver.jdbc.SQLServerCallableStatement.\n     getOutParameter(Unknown Source)\n   at com.microsoft.sqlserver.jdbc.SQLServerCallableStatement.\n     getterGetParam(Unknown Source)\n   at com.microsoft.sqlserver.jdbc.SQLServerCallableStatement.\n     getInt(Unknown Source)\n   at org.jboss.resource.adapter.jdbc.WrappedCallableStatement.\n     getInt(WrappedCallableStatement.java:192)\n</code></pre>\n\n<p>The stored procedure being called looks something like this:</p>\n\n<pre><code>CREATE PROCEDURE dbo.stored_proc ( -- 10 input parameters\n                                 , @out_param INT OUTPUT) AS\n\n-- Variable declarations \n\nSET @out_param = 0\n\n-- Do processing...\n\nSET @out_param = 1\n</code></pre>\n\n<p><strong>Since the output parameter is set to zero on entry to the stored procedure, under what circumstances could the value not be set? Or am I misinterpreting the error message?</strong></p>\n\n<p>This error is reproducible with:</p>\n\n<ul>\n<li>SQL Server JDBC Driver 1.2</li>\n<li>SQL Server 2005 (64-bit) service pack 2</li>\n<li>SQL Server 2005 (64-bit) service pack 3</li>\n</ul>\n\n<p><strong>Update:</strong> It seems to be occuring as a result of the <code>-- Do processing...</code> part of the stored procedure. Removing this eliminates the error. There's too much code to reproduce here, what I'd like is some pointers to possible causes to narrow down likely candidates.</p>\n\n<p><strong>Update:</strong> Injecting errors (e.g. divide by zero) into the <code>-- Do processing...</code> part of the stored procedure <em>does not</em> cause this exception to be thrown (instead, as expected, the <code>execute()</code> call fails with an appropriate error message).</p>\n\n<p><strong>Update:</strong> Decompiling the com.microsoft.sqlserver.jdbc.SQLServerCallableStatement class suggests that 'parameter number 0' is the stored procedure <em>return value</em>.</p>\n\n<p><strong>Update:</strong> I have been unable to reproduce this by calling the stored procedure directly through Management Studio.</p>\n\n<p><strong>Update:</strong> The ultimate cause of this error seems to be a <strong>deadlock in the stored procedure</strong>. Usually, however, deadlocks cause the <code>execute()</code> call to fail with a <code>SQLException</code> wrapping SQL Server error code 1205...</p>\n"},{"tags":["sql-server","visual-studio-2010","mdf"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2486,"score":2,"question_id":3662437,"title":"sql server mdf file database attachment","body":"<p>hello all i'm having a bear of a time getting visual studio 2010 (ultimate i think) to properly attach to my database.  it was moved from original spot to #MYAPP#/#MYAPP#.Web/App_Data/#MDF_FILE#.mdf.  I have three instances of sql server running on this machine.  i have tried to replace the old mdf file with my new one and cannot get the connectionstring right for it.  </p>\n\n<p>what i'm really wanting to do is to just open some DB instance, run a DB create script.  Then I can have a DB that was generated via my edmx (generate database from model) in silverlight business application (c#)</p>\n\n<p>right now, when i go to server explorer in VS, choose add new connection, choose MS SQL Server Database FIle (SqlClient), choose my file location (app_data directory), use windows authentication, and hit the Test Connection button I get the following error:</p>\n\n<p>Unable to open the physical file \"\".  Operating system error 5:  \"5(Access Denied.)\".  An attempt to attach to an auto-named database for file\"\" failed.  A database with the same name exists, or specified file cannot be opened, or it is located on UNC share.</p>\n\n<p>The mdf file was created on the same machine by connecting to (local) on the sql server management studio, getting a new query, pasting in the SQL from the generated ddl file, adding a CREATE DATABASE [NcrCarDatabase]; GO before the pasted SQL, and executing the query.  I then disconnected from the DB in management studio, closed management studio, navigated to the DATA directory for that instance, and copying the mdf and ldf files to my application's app_data folder.  I am then trying to connect to the same file inside visual studio.  </p>\n\n<p>I hope that gives more clarity to my problems :).</p>\n\n<p>Connection string is:</p>\n\n<blockquote>\n  <p>Data\n  Source=.\\SQLEXPRESS;AttachDbFilename=C:\\SourceCode\\NcrCarDatabase\\NcrCarDatabase.Web\\App_Data\\NcrCarDatabase.mdf;Integrated\n  Security=True;Connect Timeout=30;User\n  Instance=True</p>\n</blockquote>\n"},{"tags":["sql","sql-server","stored-procedures"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":287,"score":2,"question_id":7421074,"title":"Is it possible to create a stored procedure with two insert statements where id/primary_key from the first insert statement will be used in second?","body":"<p>I see that there is a very similiar question already answered that discusses this same issue, but i just cannot seem to understand it. Below is a copy of my code that is in a stored procedure.  I need to somehow, have the second insert statement insert the CompanyID generated from the first, into this second Statement.  I appreciate any help i can get.</p>\n\n<p>Thank You!!</p>\n\n<pre><code>@comp_name nvarchar (50),\n@City nvarchar (50),\n@State nvarchar (10),\n@Address ntext,\n@Zip_Code nvarchar (50),\n@Country nvarchar (50),\n@cust_name nvarchar (50),\n@CompanyID int\nAS\nINSERT INTO Company_Listing\n(comp_name, City, State, Address, Zip_Code, Country)\nVALUES (@comp_name, @City, @State, @Address, @Zip_Code, @Country)\n\nINSERT INTO Customer_Listing\n(cust_name, City, State, Address, Zip_Code, Country, CompanyID)\nVALUES (@comp_name,@City,@State,@Address,@Zip_Code,@Country,@CompanyID)\n</code></pre>\n"},{"tags":["c#","sql-server",".net-2.0","sqlclient"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13198979,"title":"Workaround for missing .TypeName of SqlParameter in plain .NET 2","body":"<p>In plain .NET2 Framework (no service packs) there is no property</p>\n\n<pre><code>System.Data.SqlClient.SqlParameter.TypeName\n</code></pre>\n\n<p>My app is built on a machine with .NET2 SP1 installed. It is executed in hundreds of other machines and some of them do not have .NET2 SP1, and probably they won't install them so they get this exception:</p>\n\n<pre><code>Method not found: 'Void System.Data.SqlClient.SqlParameter.set_TypeName(System.String)'\n</code></pre>\n\n<p>From the c# code I execute SQL scripts (NO stored procedure calls, just sql scripts) that use DataTable objects as inputs, and this means you have to define the table-valued parameter's name from c# code (When executing stored procedures, this name is defined on the procedure's declaration, and you don't have to define it again). Apparently, I can't do this when .NET2 SP1 is not installed.</p>\n\n<p>My question is:</p>\n\n<p><strong>Is there a way to define the Table-valued parameter's name from C# code using plain .NET2 framework (No SP1 installed)??\nHow can I execute simple sql scripts that use table-valued inputs from c# code, without having the SP1 of .NET2?</strong></p>\n"},{"tags":["c#","sql-server","sql-server-2008-r2","smo"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":54,"score":0,"question_id":13144631,"title":"Using SMO in C# to backup SQL Server database","body":"<p>I'm developing a simple utility which is going to create a <code>*.bak</code> file from a SQL Server database. </p>\n\n<p>If database has a quite small size, less than 50 Mb, then there is no problem, it's working well. But potentially I'm going to work with big databases of 2-3Gb data size. </p>\n\n<p>Since it's impossible (I guess) to keep such a big data in the memory to create <code>*.bak</code> file, would my utility still work in this case? </p>\n"},{"tags":["sql-server","tsql","case"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13213055,"title":"Altering a CASE statement to handle NULL values?","body":"<p>I'm in need of help modifying an existing case statement that has to be changed to accommodate the possibility of a null value.</p>\n\n<p>Currently, the statement is as follows:</p>\n\n<pre><code>CASE WHEN \n  DATEDIFF(dd, table.OpenDate, GetDate()) - table.Days_as_Integer) &gt; 0 THEN \n   DATEDIFF(dd, table.OpenDate, GetDate()) - table.Days_as_Integer \n  ELSE NULL END \nAS Days_Past_Due\n</code></pre>\n\n<p>I just want to change the existing CASE statement to be able to handle a null table.OpenDate field, returning a NULL as Days_Past_Due. Is there an easy way to do this?</p>\n\n<p>Thanks!!!</p>\n"},{"tags":["sql","sql-server","tsql","pivot","pivot-without-aggregate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13212883,"title":"How can I PIVOT this data?","body":"<p>First, sorry for the middling title.  Didn't have a ton of success on that front.</p>\n\n<p>So - I have a table of data that has one row for each volunteer shift a person is scheduled for.  Many people, being generous with their time, have signed up for multiple shifts.  What I would like is to PIVOT this data s.t. I end up with one row per <em>person</em>, with sets of columns for each shift.  I've spent about 90 minutes on this so far, but can't figure out how to PIVOT without an aggregation function applied.</p>\n\n<p>What I mean by this is that each person is scheduled for at least one shift, so each person's row would have their unique ID, their name, their phone number, and their region.  Then there would be a set of columns for Shift1 - role/status/start time/end time/etc. - which everyone would have filled out since everyone has signed up for at least one shift.  Then, the Shift2 set of columns would be populated for people who have signed up for 2+ shifts, Shift3 for people who signed up for 3+ shifts, etc.</p>\n\n<p>My current table schema:</p>\n\n<pre><code>CREATE TABLE [dbo].[confirmexport](\n    [PersonID] [int] NULL,\n    [EventType] [varchar](14) NULL,\n    [Shift] [varchar](10) NULL,\n    [StartDate] [datetime] NULL,\n    [StartTime] [datetime] NULL,\n    [EndDate] [datetime] NULL,\n    [EndTime] [datetime] NULL,\n    [Location] [varchar](39) NULL,\n    [Role] [varchar](16) NULL,\n    [Status] [varchar](9) NULL,\n    [FirstName] [varchar](20) NULL,\n    [LastName] [varchar](22) NULL,\n    [Phone] [bigint] NULL,\n    [Region] [varchar](9) NULL\n) ON [PRIMARY]\n</code></pre>\n\n<p>All columns but <code>PersonID</code>, <code>FirstName</code>, <code>LastName</code>, <code>Phone</code>, and <code>Region</code> are shift-specific.</p>\n\n<p>In an ideal world, I'd end up with a table that looked something like so:</p>\n\n<pre><code>CREATE TABLE [dbo].[confirmexportpivoted](\n    [PersonID] [int] NULL,\n    [Phone] [bigint] NULL,\n    [FirstName] [varchar](20) NULL,\n    [LastName] [varchar](22) NULL,\n    [Region] [varchar](9) NULL,\n    [EventType1] [varchar](14) NULL,\n    [Shift1] [varchar](10) NULL,\n    [StartDate1] [datetime] NULL,\n    [StartTime1] [datetime] NULL,\n    [EndDate1] [datetime] NULL,\n    [EndTime1] [datetime] NULL,\n    [Location1] [varchar](39) NULL,\n    [Role1] [varchar](16) NULL,\n    [Status1] [varchar](9) NULL,\n    [EventType2] [varchar](14) NULL,\n    [Shift2] [varchar](10) NULL,\n    [StartDate2] [datetime] NULL,\n    [StartTime2] [datetime] NULL,\n    [EndDate2] [datetime] NULL,\n    [EndTime2] [datetime] NULL,\n    [Location2] [varchar](39) NULL,\n    [Role2] [varchar](16) NULL,\n    [Status2] [varchar](9) NULL\n) ON [PRIMARY]\n</code></pre>\n\n<p>Except with as many sets of columns as necessary for my data.  OR - if that's a deal-breaker, I can definitely make do with 3.  Any suggestions?</p>\n\n<p>Thanks in advance - I am super-confused and would appreciate any and all help.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13213277,"title":"Noob Concern: T-SQL sub-queries","body":"<p>I've got a table <code>bbc</code> with the following columns:</p>\n\n<ul>\n<li><code>name</code> (refers to a name of a country within a particular region of the world)  </li>\n<li><code>region</code> (continent of the world)  </li>\n<li><code>population</code> (population of the country in the name name field)  </li>\n</ul>\n\n<p>The question I'm trying to answer:  </p>\n\n<p><em>Find each country that belongs to a region where all populations are less than 250000000.  Show name, region and population.</em></p>\n\n<p>I was thinking the answer might be something like:  </p>\n\n<pre><code>SELECT name, region, population \nFROM bbc \nGROUP by region \nHAVING MAX(population) &lt; 250000000 \n</code></pre>\n\n<p>I get the feeling I am way off course with this answer... any help would be appreciated!  </p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":21,"score":2,"question_id":13137455,"title":"Amazon MWS - Testing / Sandbox / Production","body":"<p>I am currently developing an application which uses the Amazon MWS. To integrate the API's with my application, I need to carry out testing. Amazon advised that as they do not have a sandbox account that this testing needed to be completed on the production site. Have since been advised that my seller account has been closed due to poor performance (for not despatching the products to myself :-)) and that I will not be able to create another account. Does anyone know of a way around this? </p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":311,"score":3,"question_id":3872173,"title":"Compare when value could be both NULL or text","body":"<p>Now I know you can't directly compare NULL to anything (as null is unknown) so how would I achieve the following:</p>\n\n<pre><code>select  *\n    from    Material as m\n    where   MtrlCode = 826 and\n            Exposlimit &lt;&gt; 'compareMe'\n</code></pre>\n\n<p>Where Exposlimit MAY be NULL or it may not be.\n'compareMe' may also be NULL.</p>\n\n<p>Therefore how do I compare the two?  Both sides could be either text or NULL.</p>\n"},{"tags":["php","sql-server","database"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":557,"score":0,"question_id":2407670,"title":"Store image data type using PHP","body":"<p>I have an SQL Server database with following table.</p>\n\nTable PROMO, column:\n\n<ul>\n<li>code , varchar(10)</li>\n<li>name , varchar(10)</li>\n<li>image_data, image</li>\n<li>desc , text</li>\n</ul>\n\n<p>How do I insert an image file as a binary into SQL&nbsp;Server using PHP <a href=\"http://en.wikipedia.org/wiki/PHP#History\" rel=\"nofollow\">PDO</a>? The image will be stored in column <strong>image_data</strong>.</p>\n\n<p>What type of variable should I pass to the PDO parameter?</p>\n\n<pre><code>$stmt = $conn-&gt;prepare($query, array(\n    ':code'        =&gt; $code,\n    ':name'        =&gt; $name,\n    ':image_data'  =&gt; $imageData,\n    ':desc'        =&gt; $desc\n));\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13211268,"title":"returning total records in cte","body":"<p>With help from <a href=\"http://pratchev.blogspot.com/2008/11/paging-with-ranking-functions.html?m=1\" rel=\"nofollow\">article here</a> and recent answers from SO experts I have arrived with the following which will help me efficiently page through a set of records.</p>\n\n<p>I think my last couple of questions are </p>\n\n<ol>\n<li>See how I include the <code>Total Number of Records</code> in the payload at the end\nof SQL CTE called 'Total'. Is that how you would do this? </li>\n<li>Any other suggestions? Potential areas for being more concise or improvements? <code>Return Total Number of Pages</code></li>\n</ol>\n\n<hr>\n\n<pre><code>DECLARE @page_size INT = 5;\nDECLARE @page_nbr INT = 4;\nDECLARE @search NVARCHAR(MAX) = '';\nDECLARE @sort_order INT = 2;\n\nWITH AllProducts\nAS\n(\nSELECT *, \nCASE @sort_order\n    WHEN 1 THEN ROW_NUMBER() OVER ( ORDER BY ProductID )\n    WHEN 2 THEN ROW_NUMBER() OVER ( ORDER BY ProductName )\nEND AS 'Seq'    \nFROM Products\n),\nFiltered\nAS\n(\nSELECT * FROM AllProducts\nWHERE ProductName like '%'+@search+'%'\nOR\n@search is null\n)\nSELECT (select COUNT(*) from Filtered) as 'Total', * FROM Filtered\nWHERE seq &gt; (@page_nbr - 1) * @page_size\n  AND seq &lt;= @page_nbr * @page_size\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3813,"score":3,"question_id":3702576,"title":"SQL if no rows are returned do this","body":"<p>I have a select statement and I want to say if this select statement does not return any rows then put a '' in every cell. How do I do this?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3794,"score":3,"question_id":1344401,"title":"How can I drop all indexes in a SQL database with one command?","body":"<p>So, how can I drop all indexes in a SQL database with one command?   I have this command that will get me all the 20 or so drop statements, but how can I run all of those drop statements from this \"result set\"?</p>\n\n<pre><code>select * from vw_drop_idnex;\n</code></pre>\n\n<p>Another variation that gives me the same list is:</p>\n\n<pre><code>SELECT  'DROP INDEX ' + ix.Name + ' ON ' + OBJECT_NAME(ID)  AS QUERYLIST\nFROM  sysindexes ix\nWHERE   ix.Name IS NOT null and ix.Name like '%pre_%'\n</code></pre>\n\n<p>I tried to do \"exec(select cmd from vw_drop_idnex)\" and it didn't work.  I am looking for something that works like a for loop and runs the queries one by one.</p>\n\n<h2>-----------------------</h2>\n\n<p>With Rob Farleys help, final draft of the script is:</p>\n\n<pre><code>declare @ltr nvarchar(1024);\nSELECT @ltr = ( select 'alter table '+o.name+' drop constraint '+i.name+';'\n  from sys.indexes i join sys.objects o on  i.object_id=o.object_id\n  where o.type&lt;&gt;'S' and is_primary_key=1\n  FOR xml path('') );\nexec sp_executesql @ltr;\n\ndeclare @qry nvarchar(1024);\nselect @qry = (select 'drop index '+o.name+'.'+i.name+';'\n  from sys.indexes i join sys.objects o on  i.object_id=o.object_id\n  where o.type&lt;&gt;'S' and is_primary_key&lt;&gt;1 and index_id&gt;0\nfor xml path(''));\nexec sp_executesql @qry\n</code></pre>\n"},{"tags":["sql-server","hibernate","sql-server-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13211170,"title":"Hibernate configuration for MS SQL Server 2012 Standard","body":"<p>i am new to hibernate and need to configure it for MS SQL-server 2012 standard.\ni found this deprecated article <a href=\"http://stackoverflow.com/questions/3585544/how-to-configure-hibernate-config-file-for-sql-server\">how to configure hibernate config file for sql server</a> but i need a new one. where i can find the driver for the new database (if there is any)!\nthanks for answers</p>\n"},{"tags":["sql-server","replication","sql-server-2012","amazon-rds"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12788206,"title":"How to replicate(or similar) SQL Server on RDS?","body":"<p>Apparently Amazon RDS does not support replication for SQL Server (using 2012, but 2012 and 2008 both unsupported).</p>\n\n<p>What solutions are available for SQL Server in a case like this if I want a backup running in case amazon goes down?(as they have in the past a few times)</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13210915,"title":"dynamic order by conversion error","body":"<p>I'm trying to do a dynamic order by on pubs database and getting the following error\nwhen I try to use <code>@sort_order = 2</code></p>\n\n<p>Msg 245, Level 16, State 1, Line 6\nConversion failed when converting the nvarchar value 'Pavlova' to data type int.</p>\n\n<p><a href=\"http://www.sqlteam.com/article/dynamic-order-by\" rel=\"nofollow\">This is the article</a></p>\n\n<pre><code>SELECT * FROM Paging\nWHERE seq &gt; (@page_nbr - 1) * @page_size\n  AND seq &lt;= @page_nbr * @page_size\nORDER BY CASE\n    WHEN @sort_order = 1 THEN ProductID\n    WHEN @sort_order = 2 THEN ProductName\n    ELSE CategoryID\nEND\n</code></pre>\n"},{"tags":["sql-server","replication","merge-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13209014,"title":"How to get Merge Push Subscription status?","body":"<p>I have Merge replication setup with Push subscriptions.\nI read the following article: <a href=\"http://www.sqlrepl.com/sql-server/implementing-a-replication-agent-progess-bar/\" rel=\"nofollow\">Implementing a replication agent progress bar</a>\nIt is working fine if I initiate the agent from the subscriber, but the Status event of the MergeSynchronizationAgent Class is showing only status updates for the sessions that the client has initiated!\nIn short: I am looking for the same behavior that the default replication windows shows.</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13210014,"title":"performing a loop operation in SQL server query","body":"<p>I' writing a search function in C# SQL Server, my users can select multiple job groups and this function should check all of the selected group ids in my job table, how can I perform a loop operation in SQL Server? this is my table general schema:</p>\n\n<pre><code>id int, jobname varchar, jobgroup int.....\n</code></pre>\n\n<p>I use following query to select my jobs (based on jobgroup):</p>\n\n<pre><code>select * from tblJobs where jobgroup='\"+userGroups+\"'\n</code></pre>\n\n<p>this can be true only when userGroups contains one value, but my users can select several group ids, for instance my userGroups can be something like this: 5,7,10,20 (userGroups can contain much more values)</p>\n\n<p>how should I perform a loop operation in my query so that I can have all matching jobs?\nshould I concatenate returned values of several queries each selecting one group ID? I think there are better ways</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":49,"score":4,"question_id":13210783,"title":"MS SQL SERVER 2008 R2 Refuses connections after some time","body":"<p>First of all i would like to tell you that the program i'm working with is already compiled and i can't look at the source code.</p>\n\n<p>So, here's my problem:</p>\n\n<p>The applications successfully opens about 31 connections to a specific database.\nWhen it attempts to open connection 32, all connections start to close, including the previous 31 connections.</p>\n\n<p>To be honest, i don't know why this applications needs that many connections open to the same 2-3 tables, but after all connections are closed the application closes too.</p>\n\n<blockquote>\n  <p>17:41:38 004db680 DRIVER={SQL\n  Server};SERVER=192.168.1.8:1433;UID=user;PWD=password;DATABASE=database</p>\n\n<pre><code>17:41:38 004db680 08001 0000000e [Microsoft][ODBC SQL Server Driver][DBNETLIB]Invalid connection. 0x00000000 17:41:38 004db680\n</code></pre>\n  \n  <p>01000 0000000e [Microsoft][ODBC SQL Server\n  Driver][DBNETLIB]ConnectionOpen (ParseConnectParams()). 0x00000000</p>\n</blockquote>\n\n<p>That's the log output from that application.</p>\n\n<p>Some additional info:</p>\n\n<ul>\n<li>Same problem with SYN Attack protections disabled</li>\n<li>Database maximum connections are 30k+</li>\n</ul>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":13162663,"title":"Application vs SQL server 2008 accounts issue","body":"<p>Good day all,</p>\n\n<p>I am studing the following case:</p>\n\n<p><strong>Scenario:</strong> An application connects to the production database(SQL server 2008) using  a generic \"SA\" user instead of the domain user. This is making traces\\logs\\organization harder, because everything is flagged as done by SA user!</p>\n\n<p>NOTE: In the application the domain user/password is used, the generic account is only regarding to the database.</p>\n\n<p><strong>Questions:</strong> What would be the best pratice in this case? every user should have an account to log in the database? (sql using windows authentication) there are +- 500 users is that an issue regarding to database performance? or a generic account is indicated?</p>\n\n<p>Many thanks!</p>\n"},{"tags":["sql","sql-server","performance","sql-server-2008","query"],"answer_count":4,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":35148,"score":7,"question_id":4193705,"title":"SQL Server SELECT LAST N Rows","body":"<p>This is a known question but the best solution I've found is something like:</p>\n\n<pre><code>SELECT TOP N *\nFROM MyTable\nORDER BY Id DESC\n</code></pre>\n\n<p>I've a table with lots of rows. It is not a posibility to use that query because it takes lot of time. So how can I do to select last N rows without using ORDER BY?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Sorry duplicated question of <a href=\"http://stackoverflow.com/questions/311054/how-do-i-select-last-5-rows-in-a-table-without-sorting\">this one</a></p>\n"},{"tags":["sql-server","smo","server-restart"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":404,"score":7,"question_id":3592309,"title":"Restart SQL Server instance using SMO","body":"<p>My C# application uses SMO to do various things with SQL Server instance chosen by a user. Particularly, it changes authentication mode:</p>\n\n<pre><code>ServerConnection conn = new ServerConnection(connection);\nServer server = new Server(conn);\n\nserver.Settings.LoginMode = ServerLoginMode.Mixed;\n</code></pre>\n\n<p>After changing login more instance should be restarted. However, I cannot find any way in SMO to restart selected instance.</p>\n\n<p>I've tried to google this, but only found a bunch of samples enumerating running services and comparing their names with SQL server service name. I did not like this way as it is error prone and relies on the way Microsoft currently names SQL server instances.</p>\n\n<p>Is there any way to restart chosen instance in SMO?</p>\n"},{"tags":["sql-server","windows","sql-server-2008","cluster-computing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13209412,"title":"SQL Server 2008 cluster cannot add possible owner to SQL Server/SQL Server Agent Resources","body":"<p>Setting up SQL Server 2008 failover cluster on Windows Server 2008 R2</p>\n\n<p>Created cluster (added 2 nodes <code>Node1</code>, <code>Node2</code>). Installed SQL Server 2008 on <code>Node 1</code>. It installed successfully and service came up. I am able to connect through management tool using virtual IP.</p>\n\n<p>Now when I want to add <code>Node 2</code>, instance name is not displayed during installation.</p>\n\n<p>When I further analyzed, I could see possible owners for both resources SQL Server, SQL Server Agent are just Node 1. Whereas other resources have both Node 1 and Node 2.</p>\n\n<p>I tried the thing below.</p>\n\n<pre><code>C:\\Users\\administrator.GENNEYS&gt;cluster.exe res \"SQL Server\" /addowner:GEN-C7-181\n\nAdding 'GEN-C7-181' to possible owners of 'SQL Server'...\n</code></pre>\n\n<blockquote>\n  <p><em>System error 5079 has occurred (0x000013d7). The specified node does\n  not support a resource of this type. This may be due to version\n  inconsistencies or due to the absence of the resource DLL on this\n  node.</em></p>\n</blockquote>\n\n<p>How should I add another Node to possible owners of SQL Server?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13208958,"title":"Sql get name and parent in while loop","body":"<p>I have a table called tblmodules which has 3 columns: moduleid,name,parent_id. The column parent_id takes values of other modules. ex:</p>\n\n<pre><code>Moduleid      Name       Parentid\n--------     -----       --------\n1           grandparent    Null\n2            parent         1\n3           child           2\n</code></pre>\n\n<p>I want a stored procedure that takes the parent's Id and Name of a child giving a level. So i develop the following. </p>\n\n<pre><code>        @moduleid bigint,\n    @level int\n\nAS\nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;\n\n    declare @parentid bigint\n    declare @name nvarchar(100)\n    set @parentid = (select parentid from tblModules where ModuleId = @moduleid)\n\n\n    declare @counter int\n    set @counter = 1\n\n    while @counter &lt; @level\n    begin\n\n        set @parentid = (select parentid from tblModules where ModuleId = @parentid)\n        set @name = (select Name from tblModules where ModuleId = @parentid)\n\n        set @counter = @counter + 1\n    end\n\n    select @parentid AS ID\n    select @name as Name\n\nend\n</code></pre>\n\n<p>The procedure works fine and gets the correct Id of the parent, but the name remains the same as the child. For ex i am executing it giving the values @moduleid: 3 and @level:2.\nI am getting result ID: 1 which is correct but Name: child instead of Grandparent. Any help?</p>\n"},{"tags":["sql-server","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13209260,"title":"SQL Server 2008 vs 2012","body":"<p>Locally, when I open SQL Server Management Studio 2012 I connect to my databases by server name of <code>{MyPCName}</code>.</p>\n\n<p>Now and then, always changing after a machine shutdown, this fails. If I change the server name to <code>{MyPCName}/SQLExpress</code>. </p>\n\n<p>It looks as though I have two versions of SQL Server installed. 2010, and 2011.</p>\n\n<p>Looking at the program logs, yesterday for example, when I could logon using <code>{MyPCName}</code> the SQL Server logs seem to have been updating the logs in the folder <code>MSSQL11.MSSQLSERVER</code>. Today the logs seem to be updating the logs in the folder <code>MSSQL10.SQLEXPRESS</code>.</p>\n\n<p>Looking in my installed programs list I appear to have SQL Server 2008 and 2012 installed.</p>\n\n<p>Is there a way to, either, be able to select which you connect to / remove version 2010?</p>\n\n<p>These are all Express versions by the way in case it makes any difference. ;-)</p>\n"},{"tags":["sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13209121,"title":"match if column is part of a value in Where clause","body":"<p>I have a question:</p>\n\n<p>I am trying to match a value (url) against a value in dbtable, column UrlPart.</p>\n\n<p>Let's say a column UrlPart in a row has the value 'id=12345'.</p>\n\n<p>Now I have a query:</p>\n\n<pre><code>select * from products\nwhere UrlPart [is part of] \n'http://www.domain.com/category/?id=12345&amp;referrer=www.google.com&amp;etcetera' \n</code></pre>\n\n<p>I would like to see the match [id=12345 [is part of] 'http://www.domain.com/category/?id=12345&amp; as true, so it will return the product row.</p>\n\n<p>Of course [Is part of] doesn't exist, but what I want to know if it is possible to match the value in the column against the expression of the url which will change for each request.\nLike a normal where statement but then reveresed.</p>\n\n<p>Is something like this possible with <code>SQL 2008 Express Edition</code> ?</p>\n\n<p>[UPDATE]</p>\n\n<p>I have tested the like '%' + UrlPart '%' and the CharIndex and according to MS SQL's exectution plan, they are identical. Seems that SQL does the same thing underwater, so both options are good.</p>\n\n<p>I would think that CharIndex might be a bit more raw then like (like might be converted) so I go for that one now.</p>\n\n<p>Thank you all.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13208411,"title":"Adding Column While Selecting Table in SQl","body":"<p>My First Table is ProjectCustomFields</p>\n\n<pre><code>CustomFieldId   ProjectId   CustomFieldName CustomFieldRequired CustomFieldDataType\n69  1   User Name   1   0\n72  1   City    1   0\n74  1   Email   0   0\n82  1   Salary  1   2\n</code></pre>\n\n<p>My Second Table is ProjectCustomFieldValues</p>\n\n<pre><code>CustomFieldValueId  ProjectId   CustomFieldId   CustomFieldValue    RecordId\n35  1   69  kaliya  1\n36  1   72  Bangalore   1\n37  1   74  mm@gmail.com    1\n41  1   69  Yohesh  2\n42  1   72  Delhi   2\n43  1   74      2\n50  1   69  sss 3\n51  1   72  Delhi   3\n52  1   74  sss@icsportal.in    3\n57  1   69  Sunil   4\n58  1   72  Mumbai  4\n59  1   74  sunil@icsportal.in  4\n60  1   82  20000   4\n</code></pre>\n\n<p>I tried Below Query </p>\n\n<pre><code>Select M.CustomFieldName\n,      N.CustomFieldValue\n,      N.RecordId \nFrom\n(\n    Select G.CustomFieldName\n    ,      H.RecordId \n    From\n    (\n        Select CustomFieldName \n        From ProjectCustomFields \n        Where ProjectId = 1\n    ) G \n    Cross Join\n    (\n        Select Distinct RecordId \n        From ProjectCustomFieldValues\n    ) H\n) M\nLeft Join \n(\n    Select CustFiled.CustomFieldName\n    ,      CustValue.CustomFieldValue\n    ,      CustValue.RecordId \n    From ProjectCustomFieldValues CustValue \n    Left Join ProjectCustomFields CustFiled  \n        On CustValue.CustomFieldId = CustFiled.CustomFieldId \n    Where CustValue.AuctionId = 1\n) N \n    On M.CustomFieldName = N.CustomFieldName \n    And M.RecordId       = N.RecordId\n</code></pre>\n\n<p>But I got the result below</p>\n\n<pre><code>#CustomFieldName#   CustomFieldValue    RecordId\nUser Name   kaliya  1\nCity    Bangalore   1\nEmail   mm@gmail.com    1\nSalary  NULL    **NULL**\nUser Name   Yohesh  2\nCity    Delhi   2\nEmail       2\nSalary  NULL    **NULL**\nUser Name   sss 3\nCity    Delhi   3\nEmail   sss@icsportal.in    3\nSalary  NULL    **NULL**\nUser Name   NULL    **NULL**\nCity    NULL    **NULL**\nEmail   NULL    **NULL**\nSalary  NULL    **NULL**\nUser Name   Sunil   4\nCity    Mumbai  4\nEmail   sunil@icsportal.in  4\nSalary  20000   4\n</code></pre>\n\n<p>But Expected Result is</p>\n\n<pre><code>CustomFieldName CustomFieldValue    RecordId\nUser Name   kaliya  1\nCity    Bangalore   1\nEmail   mm@gmail.com    1\nSalary  NULL    **1**\nUser Name   Yohesh  2\nCity    Delhi   2\nEmail       2\nSalary  NULL    **2**\nUser Name   sss 3\nCity    Delhi   3\nEmail   sss@icsportal.in    3\nSalary  NULL    **3**\nUser Name   Sunil   4\nCity    Mumbai  4\nEmail   sunil@icsportal.in  4\nSalary  20000   4\n</code></pre>\n\n<p>Please guide me some one,I tried so much but i got null value in recordId,So I need same recordId above one..</p>\n"},{"tags":["sql-server","sql-server-2008","visual-studio-2012","constraints","database-project"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13162538,"title":"Include default constraint names in generation of update script","body":"<p>I'm using a <strong>SQL Server Database Project</strong> with Visual Studio 2012 and have the following problem when comparing and generating an update script:</p>\n\n<p>In Visual Studio, I add a column with a default constraint, for example:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>[NewColumn] NVARCHAR(50) CONSTRAINT [DF_ExistingTable_NewColumn] NOT NULL DEFAULT N''\n</code></pre>\n\n<p>Unfortunately, the name of the default constraint does not appear when:</p>\n\n<ul>\n<li>Comparing (<em>Schema Compare</em>) my project with the actual database</li>\n<li>Generating an update script (from within the <em>Schema Compare</em>)</li>\n</ul>\n\n<p>The created update script contains the following script (no constraint name):</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>ALTER TABLE [dbo].[ExistingTable]\n    ADD [NewColumn] NVARCHAR (50) DEFAULT N'' NOT NULL;\n</code></pre>\n\n<p>This seems like a major oversight, so I'm wondering where to find the magic switch to include the names of default constraints in all database operations.</p>\n"},{"tags":["asp.net","sql-server","kendo-ui"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":47,"score":-3,"question_id":13207050,"title":"Dynamically bind data from database","body":"<p>I have a textbox, dropdownlist,textarea,checkbox and kendoui editor. I want to dynamically bind data from database. And on click of save button save data to database, update button to update data, clear to clear the fields. But i dont know how to perform operation from database.Please give me worked out examples.Please help me i want it urgently</p>\n\n<pre><code>My code is\n\n&lt;title&gt;Untitled Page&lt;/title&gt;\n\n&lt;link href=\"CSS/kendo.common.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n&lt;link href=\"CSS/kendo.dataviz.min.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n&lt;link href=\"CSS/kendo.mobile.all.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n\n\n&lt;link href=\"CSS/kendo.default.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n\n\n\n&lt;script src=\"Js/jquery1.7.1.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n\n&lt;script src=\"CSS/kendo.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;script type=\"text/javascript\"&gt;\n$(document).ready(function(){\n$(\"#multi\").kendoDropDownList();\n\n $(\"#editor\").kendoEditor();\n });\nfunction btnClear_onclick() {\n\n}\n\nfunction btnUpdate_onclick() {\n\n}\n\nfunction btnSave_onclick() {\n\n}\n\n&lt;/script&gt;\n&lt;form id=\"form1\" runat=\"server\"&gt;\n&lt;div&gt;\n   Select Template: &lt;select id=\"multi\"  runat=\"server\" &gt;\n &lt;/select&gt;\n&lt;/div&gt;\n&lt;br /&gt;\n&lt;div&gt;\nTemplate Name: &lt;input type=\"text\"  name=\"Name\" runat=\"server\" /&gt;\n&lt;/div&gt;\n&lt;div&gt;\nDescription:&lt;textarea name=\"comments\" cols=\"25\" rows=\"5\" runat=\"server\"&gt;\n\n&lt;/textarea&gt;\n&lt;br /&gt;\n\n&lt;/div&gt;\n&lt;div&gt;\nActive: &lt;input type=\"checkbox\" name=\"vehicle\" runat=\"server\" /&gt;\n&lt;/div&gt;\n&lt;div id=\"example\" class=\"k-content\"&gt;\n&lt;textarea id=\"editor\" rows=\"10\" cols=\"30\" style=\"width:740px;height:440px\"   \nrunat=\"server\"&gt;&lt;/textarea&gt;\n&lt;/div&gt;\n\n&lt;div&gt;\n&lt;button type=\"button\"  id=\"btnSave\" onclick=\"return btnSave_onclick()\"&gt;Save&lt;/button&gt;\n&lt;button type=\"button\" id=\"btnUpdate\" onclick=\"return \nbtnUpdate_onclick()\"&gt;Update&lt;/button&gt;\n&lt;button type=\"button\" id=\"btnClear\" onclick=\"return btnClear_onclick()\"&gt;Clear&lt;/button&gt;\n&lt;/div&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n\n\nMy database table is Templates\nID  int Unchecked\nName    varchar(100)    Checked\nDescription varchar(MAX)    Checked\n</code></pre>\n\n<p>[Content]    nvarchar(MAX)   Checked\n    Active  bit Checked\n        Unchecked</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5757,"score":0,"question_id":5435090,"title":"SQL Server was not found or was not accessible","body":"<p>What is the problem below?</p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)</p>\n  \n  <p>Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </p>\n  \n  <p>Exception Details: System.Data.SqlClient.SqlException: A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)</p>\n</blockquote>\n\n<p>How can this be solved?</p>\n"},{"tags":["sql","sql-server","syntax"],"answer_count":6,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":16356,"score":2,"question_id":1267427,"title":"SQL: Insert all records from one table to another table without specific the columns","body":"<p>I want to insert all the record from the back up table foo_bk into foo table without specific the columns.</p>\n\n<p>if i try this query</p>\n\n<pre><code>INSERT INTO foo \nSELECT *\nFROM foo_bk\n</code></pre>\n\n<p>i'll get error \"Insert Error: Column name or number of supplied values does not match table definition.\"</p>\n\n<p>Is it possible to do bulk insert from one table to another without supply the column name?\nI've google it but can't seem to find an answer. all the answer require specific the columns.</p>\n"},{"tags":["php","sql-server","time","microtime"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13207956,"title":"Get Server time and insert into Mysql table via a Form","body":"<p>I have a form that posts the Date, Title, Message and Image into an SQL table. It all works fine, except the form, it has a field that I have to manually enter the date and time.</p>\n\n<p>What I want to know is how can I get the PHP to get the date &amp; time (GMT time) of when the form button is pressed and post it into the \"time\" section of my sql table instead of me doing it manually, I'm using this as a ultra lightweight CMS blog.</p>\n\n<p>This is my insert.php</p>\n\n<p><code>mysql_query(\"INSERT INTO Blog\n(Date, Title, Message, Image) \nVALUES('$_POST[Date]', '$_POST[Title]' , '$_POST[Message]' , '$_POST[Image]' ) \")\nor die(mysql_error()); </p>\n\n<p>echo \"1 record added\";</code></p>\n\n<p>This is my form\n<code></p>\n\n<pre><code>&lt;form action=\"insert.php\" method=\"post\"&gt;\n&lt;span class=\"label\"&gt;Date:       &lt;/span&gt;     &lt;input type=\"text\" class=\"dateField\" name=\"Date\" /&gt;\n&lt;span class=\"label\"&gt;Title:      &lt;/span&gt;     &lt;input type=\"text\" class=\"titleField\" name=\"Title\" /&gt;\n&lt;span class=\"label\"&gt;Message:    &lt;/span&gt;     &lt;textarea  name=\"Message\" class=\"messageField\" maxlength=\"1000\" cols=\"0\" rows=\"0\"&gt;&lt;/textarea&gt;\n&lt;span class=\"label\"&gt;Image URL:      &lt;/span&gt;     &lt;input type=\"text\" class=\"ImageField\"  name=\"Image\" /&gt;\n&lt;input type=\"submit\" class=\"submitBtn\"/&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p></code></p>\n\n<p>I want the server to add the Time/Date instead of me typing it in manually. Is this easily done?</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2005","gridview"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13207520,"title":"Pagination through Sql query","body":"<p>I am developing an application in which am using grid view. I want to use pagination for that grid view by using sql query.</p>\n\n<p>I want to display records with the help of <code>pagesize</code> and <code>pageindex</code>. </p>\n\n<p>How can I do this with sql query?</p>\n"},{"tags":["asp.net","sql-server","kendo-ui"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":47,"score":-1,"question_id":13207670,"title":"Updating and saving data to database on button click","body":"<p>I have a textbox, dropdownlist,textarea,checkbox and kendoui editor. I want to dynamically bind data from database. And on click of save button save data to database, update button to update data, clear to clear the fields. But i dont know how to perform operation from database.Please give me worked out examples.Please help me i want it urgently</p>\n\n<pre><code>My code is\n\n\n&lt;title&gt;Untitled Page&lt;/title&gt;\n\n&lt;link href=\"CSS/kendo.common.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n&lt;link href=\"CSS/kendo.dataviz.min.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n  &lt;link href=\"CSS/kendo.mobile.all.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n\n\n&lt;link href=\"CSS/kendo.default.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n\n\n\n&lt;script src=\"Js/jquery1.7.1.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n\n&lt;script src=\"CSS/kendo.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;script type=\"text/javascript\"&gt;\n$(document).ready(function(){\n$(\"#multi\").kendoDropDownList();\n\n$(\"#editor\").kendoEditor();\n });\nfunction btnClear_onclick() {\n\n}\n\nfunction btnUpdate_onclick() {\n\n}\n\nfunction btnSave_onclick() {\n\n}\n\n&lt;/script&gt;\n&lt;form id=\"form1\" runat=\"server\"&gt;\n&lt;div&gt;\nSelect Template: &lt;select id=\"multi\"  runat=\"server\" &gt;\n&lt;/select&gt;\n&lt;/div&gt;\n&lt;br /&gt;\n&lt;div&gt;\nTemplate Name: &lt;input type=\"text\"  name=\"Name\" runat=\"server\" /&gt;\n&lt;/div&gt;\n&lt;div&gt;\nDescription:&lt;textarea name=\"comments\" cols=\"25\" rows=\"5\" runat=\"server\"&gt;\n\n&lt;/textarea&gt;\n&lt;br /&gt;\n\n&lt;/div&gt;\n&lt;div&gt;\nActive: &lt;input type=\"checkbox\" name=\"vehicle\" runat=\"server\" /&gt;\n&lt;/div&gt;\n&lt;div id=\"example\" class=\"k-content\"&gt;\n&lt;textarea id=\"editor\" rows=\"10\" cols=\"30\" style=\"width:740px;height:440px\"   \nrunat=\"server\"&gt;&lt;/textarea&gt;\n&lt;/div&gt;\n\n&lt;div&gt;\n&lt;button type=\"button\"  id=\"btnSave\" onclick=\"return btnSave_onclick()\"&gt;Save&lt;/button&gt;\n&lt;button type=\"button\" id=\"btnUpdate\" onclick=\"return \n btnUpdate_onclick()\"&gt;Update&lt;/button&gt;\n&lt;button type=\"button\" id=\"btnClear\" onclick=\"return btnClear_onclick()\"&gt;Clear&lt;/button&gt;\n&lt;/div&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n\n\n My database table is Templates\n ID  int Unchecked\n Name    varchar(100)    Checked\n  Description varchar(MAX)    Checked\n [Content] nvarchar(MAX) Checked \n Active bit Checked Unchecked\n</code></pre>\n"},{"tags":["sql-server","vb.net","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13207479,"title":"Auto Suggestion textbox","body":"<p>I want to have a auto suggestion textbox which will show the name of employee after typing a specific letter. The name is present in the employee table in three columns i.e firstname, middlename, lastname.</p>\n\n<p>I have tried a code for this but it can show only one column of the table i.e the firstname.\nHow to concatenate all the three columns so that they are suggested in the textbox.</p>\n\n<p>My code:</p>\n\n<pre><code>Dim strSql As String = \"select P_Firstname, P_MiddleName, P_LastName from Patient_Registration\"\n        Dim dtb As New DataTable\n        Using cnn As New SqlConnection(conn)\n            cnn.Open()\n            Using dad As New SqlDataAdapter(strSql, cnn)\n                dad.Fill(dtb)\n            End Using\n            cnn.Close()\n        End Using\n        txtsearch.AutoCompleteMode = AutoCompleteMode.SuggestAppend\n        txtsearch.AutoCompleteSource = AutoCompleteSource.CustomSource\n        If dtb.Rows.Count &gt; 0 Then\n            Dim i As Integer = 0\n            For i = 0 To (dtb.Rows.Count - 1)\n                txtsearch.AutoCompleteCustomSource.Add(dtb.Rows(i)(\"P_FirstName\"))\n            Next\n        End If\n</code></pre>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":9,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3605,"score":1,"question_id":1647736,"title":"T-SQL - GROUP BY with LIKE - is this possible?","body":"<p>Is there a way to include a LIKE expression in a GROUP BY query?  For example:  </p>\n\n<pre><code>  SELECT Count(*) \n    from tblWhatever\nGROUP BY column_x [LIKE %Fall-2009%]\n</code></pre>\n\n<p>column_x:</p>\n\n<pre><code>--------\nBIOL-Fall_2009\nHIST Fall_2009\nBIOL Spring_2009\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>------\nFall_2009   2\nSpring_2009 1\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":53,"score":-1,"question_id":13207283,"title":"How to insert values into selected columns from c# coding?","body":"<p>I have a table in SQL Server which has many columns. Now I want to add values only in selected columns, but when I do this it raised the exception like this:</p>\n\n<blockquote>\n  <p>There are fewer columns in the INSERT statement than values specified\n  in the VALUES clause. The number of values in the VALUES clause must\n  match the number of columns specified in the INSERT statement.)</p>\n</blockquote>\n\n<p>How to handle this?</p>\n\n<p>This is my code:</p>\n\n<pre><code>SqlConnection con = getDbConnection();\nSqlCommand cmd = new SqlCommand(\"insert into pi_project_info(control#,pro_name,cust_name,cust_order,order_dt,req_dt,notes) values ('\" + tb_control.Text + \"','\" + tb_project.Text + \"','\" + ddl_customer_name.Text + \"','\" + tb_order_no.Text + \"','\" + dp_order.Text + \"','\" + dp_order.Text + \"','\" + dp_req_del.Text + \"','\" + tb_notes.Text + \"' )\", con);\n\n cmd.ExecuteNonQuery();\n MessageBox.Show(\"Saved successfully\");\n</code></pre>\n"},{"tags":["c#","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":42,"score":0,"question_id":13206784,"title":"Issue: SqlException was unhandled","body":"<p>I'm trying to execute my login form using a SQL Server database.. but I'm getting an error saying</p>\n\n<blockquote>\n  <p><em>Incorrect syntax near '</em>' </p>\n</blockquote>\n\n<p>The line where I am getting the error  is:</p>\n\n<pre><code>objda.Fill(objds, \"adm\");\n</code></pre>\n\n<p>and my code is:</p>\n\n<pre><code>public partial class Form1 : Form\n{\n    int total;\n    SqlConnection objc;\n    string c = \"data source=.; initial catalog=student; integrated security=SSPI\";\n    SqlDataAdapter objda;\n    DataSet objds;\n    SqlCommand objcmd;\n\n    public Form1()\n    {\n        InitializeComponent();\n    }\n\n    private void Form1_Load(object sender, EventArgs e)\n    {\n    }\n\n    private void button1_Click(object sender, EventArgs e)\n    {\n        if (objc != null)\n        {\n            objc.Open();\n        }\n        objcmd = new SqlCommand(\"select * form adm where Name= ' \" + textBox1.Text + \"',pass = ' \" + textBox2.Text + \"'\", objc);\n        if (objc != null)\n        {\n            objc.Close();\n        }\n        objc = new SqlConnection(c);\n        objcmd = new SqlCommand(\"search * from adm\", objc);\n        objda = new SqlDataAdapter(objcmd.CommandText, objc);\n        objds = new DataSet();\n        objda.Fill(objds, \"adm\");\n\n        total = Convert.ToInt32(objds.Tables[\"adm\"].Rows.Count);\n        if (total &gt; 0)\n        {\n            MessageBox.Show(\"welcome\");\n            Class1.login = textBox1.Text;\n            Form2 f2 = new Form2();\n            this.Hide();\n            f2.Show();\n        }\n        else\n        {\n        }\n</code></pre>\n\n<p>What should I do?</p>\n\n<p>Where is the problem?</p>\n"},{"tags":["c#","mysql","sql-server","ado.net"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":9546,"score":2,"question_id":1631054,"title":"Using SqlDataAdapter to insert a row","body":"<p>I want to insert a row into the Database using SqlDataAdapter. I've 2 tables (Custormers &amp; Orders) in CustomerOrders database and has more than thousand records. I want to create a GUI (TextBoxes) for adding new customer &amp; orders into the Database to their respective tables. </p>\n\n<ul>\n<li>How should I do it?</li>\n</ul>\n\n<p>I guess the method that is usually followed is </p>\n\n<pre><code>dataAdapter = new SqlDataAdapter (sqlQuery, conn);\ndataSet = new DataSet();\nda.Fill(dataSet);\n</code></pre>\n\n<p>Now take the values from textboxes (or use DataBinding) to add a new row into the dataSet and call</p>\n\n<pre><code>  da.Update(dataSet);\n</code></pre>\n\n<p>But the Question is Why should I fetch all other records into dataSet using da.Fill(dataSet ) in the first place? I just want to add a single new record.</p>\n\n<p>For this purpose what I'm doing is, Creating the schema of the Database in the DataSet. like this:</p>\n\n<pre><code>  DataSet customerOrders = new DataSet(\"CustomerOrders\");\n\n  DataTable customers = customerOrders.Tables.Add(\"Customers\");\n  DataTable orders = customerOrders.Tables.Add(\"Orders\");\n\n  customers.Columns.Add(\"CustomerID\", Type.GetType(\"System.Int32\"));\n  customers.Columns.Add(\"FirstName\", Type.GetType(\"System.String\"));\n  customers.Columns.Add(\"LastName\", Type.GetType(\"System.String\"));\n  customers.Columns.Add(\"Phone\", Type.GetType(\"System.String\"));\n  customers.Columns.Add(\"Email\", Type.GetType(\"System.String\"));\n\n  orders.Columns.Add(\"CustomerID\", Type.GetType(\"System.Int32\"));\n  orders.Columns.Add(\"OrderID\", Type.GetType(\"System.Int32\"));\n  orders.Columns.Add(\"OrderAmount\", Type.GetType(\"System.Double\"));\n  orders.Columns.Add(\"OrderDate\", Type.GetType(\"System.DateTime\"));\n\n  customerOrders.Relations.Add(\"Cust_Order_Rel\", customerOrders.Tables[\"Customers\"].Columns[\"CustomerID\"], customerOrders.Tables[\"Orders\"].Columns[\"CustomerID\"]);\n</code></pre>\n\n<p>I used DataBinding to bind these columns to respective text boxes.\nNow I'm confused! What should I do next? How to use Insert command? Because I didn't give any dataAdapter.SelectCommand so dataAdapter.Update() wont work I guess. Please suggest a correct approach.</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13204803,"title":"SQL Server : view column datatype does not change when underlying table datatype is changed?","body":"<p>If I have a table <code>MyTable</code> like this:</p>\n\n<pre><code>Value1 decimal\n</code></pre>\n\n<p>Then I have a view <code>MyView</code>:</p>\n\n<pre><code>Select SUM(Value1) as SumValue1 from MyTable\n</code></pre>\n\n<p>When I look at the view's column data type in SSMS under the view's columns section it is a decimal.</p>\n\n<p>Now if I modify the table to: </p>\n\n<pre><code>Value1 real\n</code></pre>\n\n<p>If I refresh the view's column section in SSMS the data type is still a decimal. Now if I open the view and resave it, the datatype becomes a float.</p>\n\n<p>Is this how it is supposed to be? It seems that the view doesn't change until I resave it.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","error-handling"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13205827,"title":"Msg 203, Level 16, State 2, is not a valid identifier","body":"<p>I'm getting the following error:</p>\n\n<blockquote>\n  <p><em>Msg 203, Level 16, State 2, Procedure getQuestion, Line 18</em><br>\n  The name 'select top(1) * from tlb_Question inner join tlb_options on tlb_options.qID=tlb_Question.id and tlb_Question.qNumber=1 and tlb_Question.id not in (0,1)' is not a valid identifier</p>\n</blockquote>\n\n<p>from the following stored procedure:</p>\n\n<pre><code>ALTER proc getQuestion\n    @qNo bigint,\n    @total bigint,\n    @next nvarchar(max)\nas\nbegin \n    declare @hisa bigint\n    set @hisa=@total/3\n\n    if(@qNo&lt;=@total/3)\n    begin\n    declare @query nvarchar(max)\n    set @query=('select top(1) * from tlb_Question \n        inner join tlb_options on tlb_options.qID=tlb_Question.id and tlb_Question.qNumber=1 and tlb_Question.id not in ('+cast(@next as varchar)+')')\n    print @query\n    execute @query\n    end\nend\n</code></pre>\n"},{"tags":["c#","sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":13206302,"title":"The DELETE statement conflicted with the REFERENCE constraint","body":"<p>In my project I am filling two database tables with two DataSets. The method which I am using to fill those database tables is shown  below:</p>\n\n<pre><code>SqlCommand sqlCommand = new SqlCommand();            \nSqlCommand command;\nusing (SqlConnection conn = new SqlConnection(strConn))\n{\n    using (SqlCommand cmd = new SqlCommand(strQuery, conn))\n    {\n        using (SqlCommand cmdReset = new SqlCommand(\"DBCC CHECKIDENT('Doctor', RESEED, 0)\", conn))\n        {\n            using (SqlCommand cmdUnCheck = new SqlCommand(\"alter table [dbo].[Doctor] nocheck constraint all\",conn))\n            {\n                using (SqlCommand cmdCheck = new SqlCommand(\"alter table [dbo].[Doctor] with check check constraint all\",conn))\n                {\n                    SqlDataAdapter da = new SqlDataAdapter(cmd);\n                    conn.Open();\n                    SqlTransaction sqlTransaction = conn.BeginTransaction();\n                    cmd.Transaction = sqlTransaction;\n                    cmdReset.Transaction = sqlTransaction;\n                    cmdUnCheck.Transaction = sqlTransaction;\n                    cmdCheck.Transaction = sqlTransaction;\n                    try\n                    {\n                        cmdUnCheck.ExecuteNonQuery();\n           /*ERROR*/    cmd.ExecuteNonQuery();\n                        cmdReset.ExecuteNonQuery();//deleting database table data\n                        foreach (DataRow dr in ds.Tables[0].Rows) //Inserting new data into the Database table\n                        {\n                            command = new SqlCommand(query.createDoctorRow(\"Doctor\",\n                            dr[1].ToString(), dr[2].ToString(), Convert.ToInt64(dr[3]), Convert.ToInt32(dr[4])), conn, sqlTransaction);\n                            command.ExecuteNonQuery();\n                        }\n                        cmdCheck.ExecuteNonQuery();\n                        sqlTransaction.Commit();\n                        conn.Close();\n                    }\n                    catch (Exception e)\n                    {\n                        sqlTransaction.Rollback();\n                        throw;\n                    }\n                }\n            }\n        }\n    }                \n}\n</code></pre>\n\n<p>The above code was working fine till the second Database table was empty but when I inserted some data in it and then run the code, VS is showing error --> </p>\n\n<blockquote>\n  <p>The DELETE statement conflicted with the REFERENCE constraint \"FK_Dr_ID\". The conflict occurred in database \"Hospital\", table \"dbo.Patient\", column 'Doctor_ID'.\n  The statement has been terminated.</p>\n</blockquote>\n\n<p>This seems clear that the foreign key is restricting the query to take place but as I am a beginner and dont know what to do I am asking your help..</p>\n\n<p>In the above code I made changes referring to this <a href=\"http://stackoverflow.com/a/1566552/1577396\">SO answer</a> but no joy, the error still exists at the same point.</p>\n\n<p><em>Optional</em>: Is there anyway to reduce the <code>using</code> statements in my code?</p>\n"},{"tags":["c#","asp.net","sql-server","json","session"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13206439,"title":"How to transfer big Json object to another page","body":"<p>i have a search page that let the user choose a lot of criteria to search with and a lot of them are client side (created on fly) so i decided to save them in a Json object so i can catch all client data easily .</p>\n\n<p>now i want to use these data to form a sql query so i can search with and display results in another page through a gird how to transfer it to another page with session or there is another suggestions to achieve that.</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":26,"score":3,"question_id":13206134,"title":"Combine multiple SQL queries in 1","body":"<p>I kinda got stuck at trying to combine a few queries.\nWhat I got is the table holding sort of statistics and reference to another table.</p>\n\n<p>to get statistics report I'm running (short version):</p>\n\n<pre><code>SELECT COUNT(id) \nfrom [Actions] \nwhere date between '2012-01-01 00:00:00' AND '2012-01-01 23:59:59' \n  AND [Action]='request'\n</code></pre>\n\n<p>The question is if I want to get every-day statistics during the specified time period, how should this query look like? I understand if I change start and end dates, I'll get statistics for the whole specified period and not grouped by day. What am I missing?</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":13091850,"title":"How to sort data before joining","body":"<p>Trying to do a diff of 2 tables with same data layout and have mismatch records on sameline</p>\n\n<pre><code>Table1                   Table2\n------                   ------\n\nCUSTOMER PART            CUSTOMER  PART\n\nCUSTID1  PART1           CUSTID1  PART1\nCUSTID1  PART2           CUSTID1  PART2\nCUSTID1  PART3           CUSTID1  PART3\nCUSTUD1  PART4\n\n\nSELECT T1.CUSTID, T1.PART, T2.CUSTID, T2.PART FROM TABLE1 AS T1\nLEFT JOIN TABLE2 AS T2 ON T1.CUSTID = T2.CUSTID\nWHERE  T1.PART &lt;&gt;  T2.PaRT\nORDER BY T1.CUSTID \n</code></pre>\n\n<p>Sometimes the output look like below - it shows a mismatch when there isn't one.\nCAn I order the tables before the join to get the data to line up ?</p>\n\n<p>Thanks</p>\n\n<pre><code>CUSTID1  PART1           CUSTID1  PART3\nCUSTID1  PART2           CUSTID1  PART1\nCUSTID1  PART3           CUSTID1  PART2\nCUSTUD1  PART4           NULL     NULL\n</code></pre>\n"},{"tags":["php","sql-server","pdo","doctrine","doctrine2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13205800,"title":"PDO_SQLSRV returns all results as strings","body":"<p>For SQL Server integer data types it seems PDO_SQLSRV returns strings whereas SQLSRV returns integers. My already written app does explicit checking (===) in several places so that means PDO_SQLSRV not a drop in replacement for SQLSRV. Normally I wouldn't be considering PDO - however Doctrine seems to use PDO and I couldn't find a Microsoft SQLSRV driver for it (enlighten me, please!)</p>\n\n<p>Here is the sample code with the responses:</p>\n\n<p><strong>PDO</strong></p>\n\n<pre><code>$sql = \"SELECT Top 1 * FROM Users\";\n$stmt = $conn-&gt;query($sql);\n$things = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);\nvar_dump($things);\n</code></pre>\n\n<p>Data: </p>\n\n<pre><code>'ID' =&gt; string '344' (length=3)\n'UserName' =&gt; string 'admin                 ' (length=30)\n</code></pre>\n\n<p><strong>SQLSRV</strong></p>\n\n<pre><code>$sql = \"SELECT Top 1 * FROM Users\";\n$things = sqlsrv_query($conn, $sql);\n\n$thingsArray = [];\nwhile( $row = sqlsrv_fetch_array($things, SQLSRV_FETCH_ASSOC))\n{\n    $thingsArray[] = $row;\n}\n\nvar_dump($thingsArray);\n</code></pre>\n\n<p>Data:</p>\n\n<pre><code>'ID' =&gt; int 344\n'UserName' =&gt; string 'admin                 ' (length=30)\n</code></pre>\n\n<p>So - right now I think I have two choices: carefully release this and make sure that I'm typecasting integers or loosening my comparisons, or write/find a Doctrine SQLSRV library.</p>\n\n<p>Does anyone know of a setting for PDO_SQLSRV that will return integers as integers? I've checked the docs, but can't seem to find anything.</p>\n\n<p>Also SQLSRV returns dates as native PHP DateTime objects. Kinda cool, but not important.</p>\n"},{"tags":["sql-server","triggers","hierarchy","sqldatatypes"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":162,"score":0,"question_id":8683264,"title":"Sql Server hierarchyid after insert in a trigger","body":"<p>I'm developing a message center in a information system, and today user Eric suggested use hierarchyid datatype to track the message reply, because the objective is to show as a Outlook or Gmail conversation.</p>\n\n<p>To simplify, I've in my database table Messages:</p>\n\n<pre><code>`MessageId int PK\nReplyToId int FK null\nSubject varchar\nBody varchar\nHierarchy hierarchyid`\n</code></pre>\n\n<p>When a new message is inserted, I've a trigger to do the update.</p>\n\n<p>I've inserted a new message, and the hierarchy is null, because is the first message, and isn't a reply.</p>\n\n<p>If a try to insert a reply to that message, the hierarchyid still null... :(</p>\n\n<p>My trigger:</p>\n\n<pre><code>ALTER TRIGGER [dbo].[trg_UpdateHierarchy] \n   ON  [dbo].[Messages]\n   AFTER INSERT\nAS \nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;\n\n    -- Insert statements for trigger here\n\n    DECLARE @replyId int\n    SELECT @replyId = inserted.ReplyId\n    FROM inserted\n    IF(@replyId IS NULL)\n    BEGIN\n        RETURN\n    END\n\n    DECLARE @parent hierarchyid\n    SELECT @parent = Hierarchy\n    FROM   [Messages]\n    WHERE  [Messages].MessageId = @replyId\n\n\n    DECLARE @currentHierarchy hierarchyid = @parent.GetDescendant(null, null).ToString()\n    DECLARE @messageId int\n    SELECT @messageId = inserted.MessageId\n        FROM inserted\n    UPDATE [Messages]\n        SET Hierarchy = @currentHierarchy\n        WHERE [Messages].MessageId = @messageId\nEND\nGO \n</code></pre>\n\n<p>What I'm doing wrong?</p>\n\n<p>Another point, I've read about the index, but depth-first don't fit because have many with null value, because the first message from a conversation has null value, and bread-first is the best index type to has a better performance? Or I can discard this index?</p>\n\n<p>Thanks in advance!</p>\n\n<p>EDIT:</p>\n\n<p>I've updated the trigger, but don't do the <code>hierarchyid</code> in right way.</p>\n\n<p>Now the trigger is:\n`ALTER TRIGGER [dbo].[trg_UpdateHierarchy] \n   ON  [dbo].[Messages]\n   AFTER INSERT\nAS \nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;</p>\n\n<pre><code>-- Insert statements for trigger here\nDECLARE @messageId int\nDECLARE @ParentId int\nSELECT  @messageId = inserted.MessageId,\n        @ParentId = inserted.ParentId\n    FROM inserted\n\nIF(@ParentId IS NULL)\n    BEGIN\n        UPDATE [Messages]\n            SET Hierarchy = hierarchyid::GetRoot()\n            WHERE [Messages].MessageId = @messageId\n        RETURN\n    END\nELSE\n    BEGIN\n        DECLARE @parent hierarchyid\n        SELECT @parent = Hierarchy\n            FROM   [Messages]\n            WHERE  [Messages].MessageId = @ParentId\n\n        DECLARE @lastHierarchy hierarchyid\n        SELECT @lastHierarchy = MAX(Hierarchy) \n            FROM [Messages] \n            WHERE Hierarchy.GetAncestor(1) = @parent\n\n        UPDATE [Messages]\n            SET Hierarchy = @parent.GetDescendant(@lastHierarchy, NULL)\n            WHERE [Messages].MessageId = @messageId\n    END\n</code></pre>\n\n<p>END`  </p>\n\n<p>If I insert messages like <code>id = 2</code> has <code>parentId = 1</code>, and <code>id = 3</code> has <code>parentId = 2</code> have this hierarchy:<br>\n<code>id = 1, hierarchy = \\<br>\nid = 2, hierarchy = \\1\\<br>\nid = 3, hierarchy = \\1\\1\\</code>  </p>\n\n<p>The first and second record has the right hierarchy, but next one no... :(</p>\n\n<p>Any clue?</p>\n"},{"tags":["sql-server","ssms"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13205186,"title":"I installed sql server 2008 r2 on vista 32, but can't find sql server management studio","body":"<p>I first installed visual studio 2010 express edition, and I think it installs sql server 2008 express. But then I went and downloaded sql server 2008 R2 32 bit. Now I'm trying to find sql server management studio and I downloaded the stand-alone one from the ms site and when I launched it, it said that it doesn't support this version of sql server. Then I found a link that someone posted that points to a version of sql server management studio for sql server 2008 r2, but the 32 bit version doesn't have a download button. <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=22985\" rel=\"nofollow\">http://www.microsoft.com/en-us/download/details.aspx?id=22985</a></p>\n\n<p>Why is this so complicated? I just want to run sql server 2008 r2 and manage it with management studio.</p>\n\n<p>Here is my installed packages:</p>\n\n<p><img src=\"http://i.stack.imgur.com/e8P0q.jpg\" alt=\"enter image description here\"></p>\n\n<p>And here is the services that are running (notice it says sqlexpress) But which one is it, the one that came with vs 2010 or the is it the one I downloaded and installed (i.e. sql server 2008 r2)?</p>\n\n<p><img src=\"http://i.stack.imgur.com/pZh65.jpg\" alt=\"enter image description here\"></p>\n\n<p>Any suggestions on what I should do next? Where can I find sql server management studio that will work with my installs?</p>\n"},{"tags":["sql-server","tsql","common-table-expression"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13203513,"title":"CTE Linking on Different ID Fields","body":"<p>I'm trying to create a SQL query that obtains data from 3 different tables.  My thought was to use a CTE to gather the information from 2 tables, and then do a right join to add in the data into the rest of my query.  I need to bring in disparate data from each field but am running into the infamous error <code>multi-part identifier could not be bound</code>  Here's what I've written so far:</p>\n\n<pre><code>with cte1 as\n(\nSELECT          \n[Physician ID] as InternalIdentifier, NPI, [Last Name] as LastName, [First Name]     \nas     \nFirstName,\nPhysician_T1HYCPP.Specialty, DOB, Degree, Department, [State License Number], [UPIN Number],    \n[Physician Status]\nFROM  Physician_T1HYCPP left outer JOIN PhysicianFile \non Physician_T1HYCPP.[Physician ID] = PhysicianFile.[TSI MD Number]\nwhere NPI &lt;&gt; ''\n),\ncteView\nAS\n(\nSelect [Doctor_Number], Address, City, State, Zip, Phone, Fax\nfrom V_PhysicianList\n)\nSelect \nInternalIdentifier, NPI, LastName, FirstName,\nSpecialty, DOB, Degree, Department, [State License Number], [UPIN Number],\n[Physician Status],     \n[Doctor_Number],\nAddress,City, State, Zip, Phone, Fax\nfrom cte1\nright outer join cteView on\nV_PhysicianList.[Doctor_Number] = PhysicianFile.[Doctor Number]\n</code></pre>\n\n<p>Here are the specific errors:</p>\n\n<pre><code>Msg 4104, Level 16, State 1, Line 1\nThe multi-part identifier \"V_PhysicianList.Doctor_Number\" could not be bound.\nMsg 4104, Level 16, State 1, Line 1\nThe multi-part identifier \"PhysicianFile.Doctor Number\" could not be bound.\n</code></pre>\n\n<p>The goal here is to bring in all the fields from the 2 tables in the first CTE and then \"merge\" in the fields from the second CTE so that address etc. get valued in the end result set.  How can I ensure that fields from both cte1 and cteView are merged properly?</p>\n"},{"tags":["sql","sql-server","database"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13203682,"title":"I am stuck on creating constraint on SQL Server","body":"<p>I am totally new to SQL Server management, I tried to add a constraint in a table.</p>\n\n<p>The situation is that I created a column with <strong>only 'Y'or 'N' allowed to be valued</strong>.</p>\n\n<p>So I tried to create a constraint in Management Studio by right clicking \"Constraints\" in the table.</p>\n\n<p>However, I really have no idea about the syntax of creating a constraint. Finally, I tried to input the code into \"Check Constraint Expression\" window by referring the template from the Internet. The SQL Server always tell me \"Error Validating constaint\".</p>\n\n<p>Can you guys just help me to write the first constraint for me? Because I really dont know how to start.</p>\n\n<p>My requirement is:</p>\n\n<pre><code>I have a table called \"Customer\"\nI created a column called \"AllowRefund\"\nThe column \"AllowRefund\" is only allowed to 'Y' or 'N'\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","views","system-views"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13203489,"title":"SQL Server INFORMATION_SCHEMA.VIEW_COLUMN_USAGE not updated on table update","body":"<p>I'm trying to learn more about SQL Server, and I came across something I don't understand.  I have a SQL Server 2008 database (the free version).  I have a view that I defined using a wildcard, like this:</p>\n\n<pre><code>Select * from ApplicantApplications\n</code></pre>\n\n<p>When I checked the system view \"INFORMATION_SCHEMA.VIEW_COLUMN_USAGE\", each of the columns from the view I defined were there.</p>\n\n<p>Later, I updated the ApplicantApplication table and added a field \"TestValue\"</p>\n\n<p>When I looked back at the system view \"INFORMATION_SCHEMA.VIEW_COLUMN_USAGE\", the new column that I added to the table was not there.  The view that I defined has the new column in it.</p>\n\n<p>Do I need to do something special to make that column appear in the system view?  I thought it would get updated automatically.</p>\n\n<p>Thanks!</p>\n"},{"tags":["c#","sql-server","ssis","maintenance"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":138,"score":0,"question_id":11911945,"title":"Convert an SSIS package to a .NET application?","body":"<p>I've been asked to take over ownership of an SSIS package that was written a while ago.  It certainly seems possible to go in and modify, edit, and upgrade this package, but it also seems extremely cumbersome for the amount of work the package does.  </p>\n\n<p>My task is roughly this:  Sift through the package, find any usage of some specific columns in specific tables, change them to match the latest database changeset, and write some additional logging data out to help the team diagnose any particular problems.</p>\n\n<p>This appears daunting to me because the SSIS package contains about 3 megabytes of text, SQL statements, and extremely simple (but lengthy) code pathways.  It's already taken me a while to double click on each SSIS object and skim through its settings to see if I can spot the columns I've been asked to maintain, and SSIS keeps throwing connection errors (rightly so, because my dev environment is blocked off from the production database).</p>\n\n<p>I'd really like to consider converting this SSIS package to a .NET application, however I haven't been able to locate any tools that could help me do so.</p>\n\n<p>Does anyone have suggestions for maintaining this SSIS package or converting it to a proper application?</p>\n"},{"tags":["sql","sql-server","naming-conventions"],"answer_count":36,"favorite_count":51,"up_vote_count":187,"down_vote_count":0,"view_count":38806,"score":187,"question_id":338156,"title":"Table Naming Dilemma: Singular vs. Plural Names","body":"<p>Convention has it that table names should be the singular of the entity that they store attributes of.  </p>\n\n<p>I dislike any T-SQL that requires square brackets around names, but I have renamed a <code>Users</code> table to the singular, forever sentencing those using the table to sometimes have to use brackets.  </p>\n\n<p>My gut feel is that it is more correct to stay with the singular, but my gut feel is also that brackets indicate undesirables like column names with spaces in them etc.</p>\n\n<p>Should I stay, or should I go?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13198812,"title":"SQL Merge with two stage match","body":"<p>I want to merge two tables using SQL Server on the following basis:</p>\n\n<p>IF the primary key (Operation) matches THEN\n    If Source Date Matches Target Date\n        Do nothing\n    Else\n        SET Target Revised_Date to Source Date\nElse\n    Insert Target Row from Source Row</p>\n\n<p>I have built an SQL merge below that does the first stage but can't see how to do the second stage.</p>\n\n<pre><code>MERGE \n    Completed_Operations AS target\nUSING \n    @Completed_Operation_Table AS source ON (target.Operation = source.Operation)\nWHEN MATCHED THEN \n    UPDATE \n    SET target.Revised_Completion_Date  = source.Completion_Date,\n            target.Revised_Pln_Hrs          = source.Pln_Hrs,\n            target.Revised_Pln_Hrs_Capped   = source.Pln_Hrs_Capped,\n            target.Revised_Act_Hrs          = source.Act_Hrs\nWHEN NOT MATCHED THEN   \n    INSERT (Operation, Orig_Completion_Date, Orig_Pln_Hrs, Orig_Act_Hrs, Revised_Completion_Date, Revised_Pln_Hrs, Revised_Act_Hrs)\n    VALUES (source.Operation, source.Completion_Date, source.Pln_Hrs, source.Act_Hrs, NULL, NULL, NULL);\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13201826,"title":"SP_SEND_DBMAIL @QUERY Inserts Line Breaks Into E-mail","body":"<p>I use the @query perimeter in sp_send_dbmail to send out an e-mail with a list of warnings (the warnings are returned by the @query perimeter).  The @query perimeter is listed as text in the e-mail.  All of the records returned from the @query perimeter and displayed in the e-mail has a line break between them.  ie. If I have 4 records, I would have 8 lines because of line breaks.</p>\n\n<p>How do I turn the line breaks off?  I read the the msdn article for sp_send_dbmail, but it didn't mention any attributes that could be changed that would affect the line breaks.</p>\n\n<p>Code:</p>\n\n<pre><code>    BEGIN\n    EXEC MSDB.DBO.sp_send_dbmail \n        @PROFILE_NAME = 'Alerts',\n        @RECIPIENTS = @MAIL,\n        @SUBJECT = @NEWSUBJECT,\n        @BODY = @NEWBODY,\n        @QUERY =\n            'SET NOCOUNT ON\n            DECLARE @HEXSTRING AS VARCHAR(100)\n            SET @HEXSTRING = (SELECT HEXADECIMAL_STRING FROM mydb.dbo.statusupdates\n                WHERE MACHINE_ID = ''1111'' AND DATEDIFF(MI, TIME_DATE_RECEIVED, GETDATE()) &lt;= 60)\n            SELECT [Warning_Description] FROM mydb.DBO.BINARYTOTABLE(mydb.DBO.HEXTOBINARY(@HEXSTRING)) AS ABB1\n            JOIN mydb.DBO.WarningMessages  ON mydb.DBO.WarningMessages.[Bit_Offset] = ABB1.BITPLACE\n            WHERE BITVALUE = 1 AND ALERT_LEVEL = ''WARNING''',\n        @QUERY_RESULT_HEADER = 0,\n        @ATTACH_QUERY_RESULT_AS_FILE = 0;\n    END\n</code></pre>\n"},{"tags":["sql-server","service-broker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13197781,"title":"Service Broker: Designing the communication between two SQL servers","body":"<p><strong>The goal:</strong> Reliable transport of continuously generated records to the central SQL.</p>\n\n<p><strong>Summary:</strong> The satellite needs to ask the central what are the latest data on its side, and then it is going to send continuously newer ones.</p>\n\n<p>The satellite SQL server may be (re)started sometimes (related to physicall production machine), the central SQL machine is likely to run longer, but there also can be some downtime. The lines are mostly reliable, but one never knows... I expect the connection problems be solved <em>naturally</em> by the SQL Server Service Broker. However, I need to solve the problem of the initial handshake and sending the data. I need to design the protocol and my SSB knowledge is still poor.</p>\n\n<p>I hope I understand the basics of communication using SSB that are nicely and briefly described as </p>\n\n<blockquote>\n  <p>You should start with each work item on its own conversation. The producer (initiator) begins a dialog and send the message describing the work item, then commits. The consumer (target) receives the message (or gets activated), inspects the payload to understand the work item details, executes the work, then ends the dialog and commit. The resulting EndDialog message gets sent back to the initiator service queue, and an activated procedure on the initiator queue responds to it by ending the dialog on the initiator side. </p>\n</blockquote>\n\n<p>... by Remus Rusanu (if interested see <a href=\"http://stackoverflow.com/a/1263999/1346705\">more details in his earlier answer</a>).</p>\n\n<p>I would like to send the records as XML messages like this (a multiline string here)</p>\n\n<pre><code>&lt;row a=\"1\" b=\"11\" c=\"111\" /&gt;\n&lt;row a=\"2\" b=\"22\" c=\"222\" /&gt;\n&lt;row a=\"3\" b=\"33\" c=\"333\" /&gt;\n&lt;row a=\"4\" b=\"44\" c=\"444\" /&gt;\n</code></pre>\n\n<p>and I have already learned <a href=\"http://stackoverflow.com/a/11579148/1346705\">how to write the <code>SELECT</code> to obtain the info from the XML message</a>.</p>\n\n<p><strong>The communication:</strong> Say the communication mechanism between the SQL servers was just activated...</p>\n\n<ol>\n<li><p>The satellite SQL obtained new data, and somehow it knows that there is no pending message between the satellite and the central. But it also does not know what data was already sent to the central. Therefore it has to ask the central what is its the last available data.</p></li>\n<li><p>If I understand the <code>END CONVERSATION</code> correctly, the command causes sending only a kind of empty message <code>N'http://schemas.microsoft.com/SQL/ServiceBroker/EndDialog'</code>. Because of this, the central should probably send my type <code>ReplyMessage</code> with the answer back before the <code>END CONVERSATION</code>.</p></li>\n<li><p>Meanwhile, the satellite should probably do nothing to behave asychronously (i.e. waits after sending the <code>RequestMessage</code>). Once the <code>ReplyMessage</code> arrives, it activates a satellite procedure that:</p>\n\n<ul>\n<li>receives the message and get the wanted information,</li>\n<li>receives the EndDialog message and ends the previous dialog at the satellite side, </li>\n<li>prepares the data to be sent to the central (the XML string form),</li>\n<li>opens the new dialog,</li>\n<li>sends the prepared data,</li>\n<li>and makes itself dormant until another <code>ReplyMessage</code> arrives.</li>\n</ul></li>\n<li><p>The central should behave similarly. Once the <code>RequestMessage</code> arrives, it activates the central procedure that:</p>\n\n<ul>\n<li>receives the request message, </li>\n<li>extracts the XML information and updates the central database,</li>\n<li>gets the info about the last available data for the satellite,</li>\n<li>forms and sends the <code>ReplyMessage</code>,</li>\n<li>ends the dialog at the central side.</li>\n</ul></li>\n</ol>\n\n<p>So far, is my view correct?</p>\n\n<p><strong>Now some details that I am not sure about:</strong> As I want to make it robust, working without a human touch, it should start on its own when the mechanism is installed. The communication should always be started by the satellite (the central may not know even if the satellite works or even exists).</p>\n\n<p>The satellite already uses a trigger fired by a raw data that is processed to build the records that are collected at the central. This way, the trigger could initiate somehow the first SSB request of the satellite to the central. But...</p>\n\n<ul>\n<li>How the trigger can check that there is no pending communication between the satellite and the central? As the satellite is always the initiator, the question can also be formulated as... How the trigger can check whether the satellite waits for some <code>ReplyMessage</code>? Or, how to know that there is some open dialog between the satellite and the central?\n<ul>\n<li>If there is no conversation, the trigger forms the data record (stored in a local table), and then it could start the communication proces (see the point 1 above).</li>\n<li>If there is any conversation, the trigger only forms the record that is to be sent later, and nothing else is done. Data will be sent when the <code>ReplyMessage</code> is obtained by the activated procedure (see the point 3 above).</li>\n</ul></li>\n<li>On <em>making the satellite dormant</em> (see the last bullet of the point 3 above) I mean that there should probably be no other message in the message queue (nothing to be processed in the loop) and the activated procedure is to be naturally finished. But I am not sure if I think correctly here. Can you comment on that?</li>\n<li>If nothing is broken, and if the data is produced fast enough, the satellite and the central have always something to exchange. This way, the trigger should never try to start the communication.</li>\n<li>When there is nothing else to be sent to the central by the activated satellite procedure (actually, it is not active), or when the system is restarted somehow (no dialog exists yet), the trigger starts the communication process. But how could I do it? Should the trigger simply send the <code>RequestMessage</code> to the central? (This way the <code>ReplyMessage</code> would activate the satellite procedure and the procedure would continue until there is anything to process.)</li>\n<li>Say, the <code>RequestMessage</code> means <em>here is some data, process them, and reply what is the last</em> (or what next should be send or what next action is recommended from the central -- depends on the bussiness logic, probably not important here). Is it OK to send <em>empty XML</em> in the <code>RequestMessage</code> in the sense <em>I do not know what else you need -- tell me</em>?</li>\n</ul>\n\n<p><strong>First update</strong> -- based on <a href=\"http://stackoverflow.com/a/13198768/1346705\">the Remus Rusanu's answer below</a>.</p>\n\n<p>I have to agree that this would be <em>chatty</em> protocol. Moreover, the records are created as temperature samples from the real environment and the frequency of sampling is rather low. This means that the complicated protocol could be usefull only in the special case of restarting everything or so.</p>\n\n<p>But when the conversation should be left open <em>forever</em>, the unique identifier for the dialog handle or should be stored persistently in some configuration table, or it could even be hardwired to the code. The trigger will send the records on the fly immediately, and the central will simply not send the <code>ReplyMessage</code>. Is it correct? Can that kind of coversation be effectively considered a monolog?</p>\n\n<p><strong>Second update</strong> to make this question reasonably short.</p>\n\n<p>See the continuation <a href=\"http://stackoverflow.com/q/13203389/1346705\">Service Broker: How should a trigger start infinitely opened dialog?</a></p>\n"},{"tags":["sql-server","service-broker"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13203389,"title":"Service Broker: How should a trigger start infinitely opened dialog?","body":"<p>The question is a continuation of the <a href=\"http://stackoverflow.com/q/13197781/1346705\">Service Broker: Designing the communication between two SQL servers</a> (to make the earlier reasonably short).</p>\n\n<p>The answer to the above question suggested the usage of a simpler scenario of sending the regularly generated data via <em>forever</em> opened dialog. A trigger, that is responsible for forming the data at the satellite SQL server and sending it do the central SQL server, will probably use the fixed unique identifier.</p>\n\n<p>Anyway, the conversation must be started at first. Say, the conversation handle is fixed. How can I detect the situation when the conversation was not open yet?</p>\n\n<p>If it is possible to detect the conversation was not started yet, I could combine the two approaches. The special request with empty-string message value could be send to the central, and the central would send back a reply only for that special request. The satellite activated procedure would then send the missing data to the central at once. </p>\n\n<p>Simply said, I have to solve the initial situation when quite a lot of data could be collected at the satellite machine. The satellite activated procedure could sent the data in chunks to give both sides a chance to do also something else than moving the data. Once the reply message from the central arrives in situation when there is nothing else to send, the activated procedure could set some persistent flag for the trigger to start sending the single records in a monolog way. Is it reasonable?</p>\n"},{"tags":["asp.net","mysql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13203198,"title":"web.config changing from SQL Server to MySQL connection","body":"<p>We just completed programming a a VB.NET Web Project connected to a SQL Server Database. The client is now requesting that we support an identical schema in MySQL as well.  I tried making a simple switch of the connection string via but it is still trying to connect to the provider value of (providerName=\"MySql.Data.MySqlClient\")</p>\n\n<p>This did not work.  Can someone tell me if we can do this via the web.config.  I don't want to have to change code to support the different connections.  We are also going to have to support Oracle databases in the future.</p>\n\n<p>Thanks in advance for you help.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13203108,"title":"Conditionally setting variable with case statment","body":"<p>I have the following query. I am trying to only add the values, if the value is not null so the whole variable doesnt end up as a null. Obviously this query below is erroring out, but I do not want to use an ISNULL check on the test column because it puts a comma at the end of the variable text. How would I do this without having the comma at the end of the variable text. Sometimes there will be nulls in the test column, and sometimes there will not be.</p>\n\n<pre><code>DECLARE @Test TABLE\n(\n    test varchar(20)\n)\n\nINSERT INTO @Test\nSELECT 'adfasdfasd'\nUNION ALL\nSELECT NULL\n\n\nDECLARE @DocID varchar(max)\n\nSELECT CASE WHEN test IS NOT NULL THEN @DocID = COALESCE(@DocID + ',' ,'')  + test END\nFROM @Test\n\nSELECT @DocID\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":18,"score":2,"question_id":13203223,"title":"custom query to show records with duplicate count with its duplicate occurance","body":"<p>Please refer below script</p>\n\n<pre><code>            declare @table1 table\n            (\n            col1 int\n            )  \n\n            insert into @table1 values(1)\n            insert into @table1 values(3)\n            insert into @table1 values(3)\n            insert into @table1 values(6)\n            insert into @table1 values(4)\n            insert into @table1 values(4)\n            insert into @table1 values(4) \n</code></pre>\n\n<p>The below query gives </p>\n\n<pre><code>            select col1 ,COUNT(col1) cntCol1 from @table1 group by col1\n</code></pre>\n\n<p>this output</p>\n\n<pre><code>            ----------------\n            col1   | cntCol1\n            -------| -------\n            | 1    | 1    | \n            | 3    | 2    | \n            | 4    | 3    | \n            | 6    | 1    | \n            ---------------\n</code></pre>\n\n<p>is it possible to get the below output</p>\n\n<pre><code>            ----------------\n            col1   | cntCol1\n            -------| -------\n            | 1    | 1    | \n            | 3    | 1    | \n            | 3    | 2    |  \n            | 4    | 1    |  \n            | 4    | 2    |  \n            | 4    | 3    | \n            | 6    | 1    | \n            ---------------\n</code></pre>\n\n<p>If so, could you please help me with the query.</p>\n\n<p>Thanks, \nEsen.</p>\n"},{"tags":["sql-server","ssas","mdx"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":27,"score":2,"question_id":13194942,"title":"MDX DRILLTHROUGH Fails but select can be successfully executed","body":"<p>I have the following MDX query which succesfully returns the measure when executed -</p>\n\n<pre><code>SELECT  \n{[Measures].[Closed Quote OE Retail]} ON COLUMNS \nFROM Sales\nWHERE\n(\n[Posting Date].[Date YQMD].[Month].&amp;[11]&amp;[2012]\n,[Work Provider].[Code].[LV]\n,EXCEPT([Item].[by Item Category by Product Group].[Item Category], [Item].[by Item Category by Product Group].[Item Category].&amp;[OEM])\n,EXCEPT([Lost Sale Reason Code].[Code].[Code], [Lost Sale Reason Code].[Code].[All Lost Sale Reason Code].UNKNOWNMEMBER)\n,EXCEPT([Lost Sale Reason Code].[by MI Type].[MI Type], { [Lost Sale Reason Code].[by MI Type].[MI Type].&amp;[Not Justified] })\n)\n</code></pre>\n\n<p>But if I add 'DRILLTHROUGH' to the start of the query the following error is returned -</p>\n\n<blockquote>\n  <blockquote>\n    <p>Drillthrough failed because the coordinate identified by the SELECT clause is out of range.</p>\n  </blockquote>\n</blockquote>\n\n<p>Can anyone help?</p>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16,"score":1,"question_id":13202383,"title":"Return list of mapped classes - Entity Framework","body":"<p>I have this class that is linked to a View in the SQL Server:</p>\n\n<pre><code>[Table(\"V_Clients\")]\npublic class Client\n{\n    [Key]\n    public int ClientId { get; set; }\n    public short BranchId { get; set; }\n    public string CorporateName { get; set; }\n    public string TIN { get; set; }\n    public string Address { get; set; }\n    public string Phone { get; set; }\n    public string Id { get; set; }//NroCi\n    public short CityId { get; set; }\n    public short ZoneId { get; set; }\n    public short SubZoneId { get; set; }\n    public short VendorId { get; set; }\n    public short PriceListId { get; set; }\n    public short CollectorId { get; set; }\n\n    [ForeignKey(\"BranchId\")]\n    public virtual Branch Branch { get; set; }\n\n    [ForeignKey(\"CityId\")]\n    public virtual City City { get; set; }\n\n    [ForeignKey(\"ZoneId\")]\n    public virtual Zone Zone { get; set; }\n\n    [ForeignKey(\"SubZoneId\")]\n    public virtual SubZone SubZone { get; set; }\n\n    [ForeignKey(\"VendorId\")]\n    public virtual Vendor Vendor { get; set; }\n\n    [ForeignKey(\"PriceListId\")]\n    public virtual PriceList PriceLists {get;set;}\n\n    [ForeignKey(\"CollectorId\")]\n    public virtual Collector Collector { get; set; }\n}\n</code></pre>\n\n<p>but when I try to make a list of it like this:</p>\n\n<pre><code>public ActionResult Index()\n    {\n        var clients = db.Clients.Include(c =&gt; c.Branch).Include(c =&gt; c.City).Include(c =&gt; c.Zone).Include(c =&gt; c.SubZone).Include(c =&gt; c.Vendor).Include(c =&gt; c.PriceLists).Include(c =&gt; c.Collector);\n        return View(clients.ToList());\n    }\n</code></pre>\n\n<p>nothing happens. Could it be because of the relationships?</p>\n\n<p>Note: All classes are linked to views and work fine with the others except my <code>Client</code> class.</p>\n"},{"tags":["sql-server","tsql","powershell-v2.0","cmdlet"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13202474,"title":"how to execute tsql scripts from cmdlet written in c#","body":"<p>I want to execute tsql scripts from custom cmdlet written in c#. Can you recommend me the best practice to do it?</p>\n\n<p>I have a few .sql scripts and in my cmdlet I need to iterate through them in specific order and execute each sql script. I also need to run all scripts in transaction if is it possible.</p>\n\n<p>And I need to execute scripts remotely. It means, that there may not be sql server installed on the machine from which is cmdlet executed.</p>\n\n<p>The target sql servers are 2008, 2008R2, 2012.</p>\n\n<p>I have read some approaches, but i'm still not sure what is the best one. </p>\n\n<p>thanks in advance</p>\n"},{"tags":["sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":31,"score":-1,"question_id":13202413,"title":"Handle bad dates during CAST","body":"<p>How can I gracefully handle bad date integers that are random thorughout my table?  For instance I see some 9999999999 in there at times so consequently this query bombs out. I want to just produce the 1900 date in those cases instead of just stopping like this:</p>\n\n<pre><code>Select convert(date,CAST(trandate as varchar(8))),\n       convert(date,CAST(duedate as varchar(8))), \n        ...\n\nFROM  SomeTable\n</code></pre>\n\n<p>a valid date looks like this in that table for those fields: 20100924 and those work fine when they hit this query.</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13200408,"title":"How to save (upload) files to database after inserting records","body":"<p>What I have seen in some sample use:</p>\n\n<pre><code>string strQuery = \"insert into tblFiles(Name, ContentType, Data)\" + \n                  \" values (@Name, @ContentType, @Data)\" \n</code></pre>\n\n<p>for saving files to the database.</p>\n\n<p>Now if I have an existing table that has some rows and also some different filled columns, and after adding new columns (<code>Name, ContentType, Data</code>) to this existing table, I like to upload or save files. </p>\n\n<p>What is the SQL statement I have to use to do this?   </p>\n"},{"tags":["sql","sql-server","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13197867,"title":"Find duplicate values over multiple databases","body":"<p>I'm trying to find a way to find duplicate email addresses in a table over multiple DB's.  I have 30 DB's, all with a \"Users\" table with identical fields (each DB is a different customer of ours).  I need to go through each DB, get the email address from this table, then search the current, and all other DB's for this email address.  If it exists, write out the record, if not, move on to the next user record and repeat.  Here's what I've got so far, but I'm stuck.  I think I have to create a cursor inside another cursor but don't know if it can be done dynamically:</p>\n\n<pre><code>DECLARE @DBName varchar(20)\nDECLARE @sSQL      varchar(2000)\n\nDECLARE LoopCursor CURSOR FOR\n    SELECT DBName\n    FROM Configuration\n\n    OPEN LoopCursor\n\n    FETCH NEXT FROM LoopCursor\n    INTO @DBName\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        SET @sSQL = '\n            Select EmailAddress\n            FROM ' + @DBName + '.dbo.Users'\n\n        --Not to sure what to do from here??\n\n        EXEC(@sSQL)\n\n        FETCH NEXT FROM LoopCursor\n        INTO @DBName\n    END\n\n    CLOSE LoopCursor\nDEALLOCATE LoopCursor\n\nSELECT 'DONE'\n</code></pre>\n\n<p>We are using SQL Server 2008 R2 btw.</p>\n"},{"tags":["sql","sql-server","int","guid","identifier"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":41,"score":-4,"question_id":13201183,"title":"ints or guids for table identifiers","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4557422/sql-primary-key-int-or-guid-or\">SQL primary key, INT or GUID or..?</a>  </p>\n</blockquote>\n\n\n\n<p>What is the best practise for using unique identifiers in sql server tables?</p>\n\n<p>I have seen articles regarding using guid's or int's with pros and cons for each. </p>\n\n<p>I am looking to go with the following principal, for external identifiers, guid's should be used but for internal identifiers, it best to go with int's. </p>\n\n<p>I am looking for feedback on this principal and guidelines as to the best approach.</p>\n"},{"tags":["sql-server","vb.net","dynamic","drop-down-menu","menu"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13199351,"title":"VB2010 reading menu items in tool strip sub menu","body":"<p>SQL Server/VB2010 newbie.  Fighting the learning curve on two fronts.</p>\n\n<p>I am creating a UI in VB2010 to a SQL Server database that will allow users to edit tables in the database. Since the tables in the database may change (new ones added, or obsolete ones deleted) as the project develops, the table names are dynamically added to the sub menu, as shown in the screen cap below:</p>\n\n<p><img src=\"http://i.stack.imgur.com/Fvbi9.png\" alt=\"Screen Cap\"></p>\n\n<p>Then I use the AddHandler function to run the click event sub. That works fine, but what I need to do is grab the actual text of the submenu item (\"VehicleList\", \"Maintenance\", etc.) to use in the SQL SELECT string to open the selected table in the database, like so:</p>\n\n<pre><code>\"SELECT * from [selected_menu_item] WHERE yada, yada\"\n</code></pre>\n\n<p>I've scoured the internet looking for this, but if it's there, I can't find it. Tried many ways, but I either get the top menu item (\"Table\") or the last item on the list, or sometimes just a blank line.</p>\n\n<p>Preferable would be to get the actual names, but even if there was an index value, I could use that to reference an array of the table names.</p>\n\n<p>Can anyone help?</p>\n\n<p>Thanks!</p>\n"},{"tags":["java","sql","sql-server","regex"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":78,"score":5,"question_id":13195935,"title":"Determine if an sql query modifies the database","body":"<p>I have a list of strings that contain valid <code>SQL</code> expressions.<br>\nI need to execute only those that do not modify the database.<br>\nWhat would be the best way to do this? Just doing something like:  </p>\n\n<pre><code>if(sqlQuery.contains(\"DELETE\")){  \n  //don't execute this\n}\n</code></pre>\n\n<p>seems like a bad hack  </p>\n\n<p><strong>Update:</strong><br>\nI'll make this more specific.<br>\nI already have a list of <code>SQL</code> queries that are allowed. I want to make sure only these are executed.<br>\nWhat would be the best way to match against these?</p>\n"},{"tags":["sql-server","node.js","unixodbc"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":160,"score":1,"question_id":11414302,"title":"Node-odbc unable to connect to mssql","body":"<p>I've spent the last day or two setting up unixODBC and freetds on ubuntu 12 - not a fun process in itself but it does now work using both sqsh and isql. I've installed node-odbc and I'm using the code snippet provided in the <a href=\"https://github.com/w1nk/node-odbc\" rel=\"nofollow\">github readme</a> to test the connection but I always get</p>\n\n<pre><code> S1000:1:0:[unixODBC][FreeTDS][SQL Server]Unable to connect to data source\n WARNING: ev_unref is deprecated, use uv_unref\n [Error: Error opening database]\n</code></pre>\n\n<p>Using isql I run <code>isql -v SERVER user pass</code> (using the correct creds..) and then <code>use DATABASE</code> once connected and it all works and I can run queries fine. My connection string in the js is </p>\n\n<pre><code> \"DRIVER={FreeTDS};SERVER=SERVER;UID=user;PWD=pass;DATABASE=DATABASE\"\n</code></pre>\n\n<p>Which exactly matches the credentials used for connecting with isql but in Node I get the aforementioned error. Any ideas on why this is happening? Is it possible that it's to do the location of my odbc.ini and odbcinst.ini files or something like that?</p>\n\n<p>Just for reference:</p>\n\n<p>/etc/odbc.ini:</p>\n\n<pre><code>[SERVER]\nDriver      = FreeTDS\nTrace       = No\nServer      = SERVER\nPort        = 1433\nDatabase    = DATABASE\nUsageCount  = 1\nTDS_Version = 7.0\n</code></pre>\n\n<p>/etc/odbcinst.ini:</p>\n\n<pre><code>[FreeTDS]\nDescription = FreeTDS\nDriver = /usr/lib/libtdsodbc.so\nSetup = /usr/lib/libtdsS.so\nFileUsage   = 1\nCPTimeout   = 5\nCPReuse     = 20\nThreading   = 1\n</code></pre>\n\n<p>Thanks in advance for any help!</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":116,"score":2,"question_id":11858827,"title":"MS SQL Server 2008 script generation creates invalid scripts when using constraints","body":"<p>On an MS SQL Server 2008 (10.50.2811.0) Developer Edition (64-bit), running under Windows 2008 Server 2008 R2 Standard the script generation from within SQL Server Management Studio creates scripts where the same constraint is dropped multiple times. </p>\n\n<p>A simple example includes two tables, tParent and tChild, where tChild's ParentID references tParent's ID. The script (Database context menu => Tasks => Generate Scripts...) being generated (for DROP AND CREATE) looks like this:</p>\n\n<pre><code>USE [TestDb]\nGO\n/****** Object: ForeignKey [FK_tChild_tParent] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] DROP CONSTRAINT [FK_tChild_tParent]\nGO\n/****** Object: Table [dbo].[tChild] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] DROP CONSTRAINT [FK_tChild_tParent]\nGO\nDROP TABLE [dbo].[tChild]\nGO\n/****** Object: Table [dbo].[tParent] Script Date: 08/08/2012 08:11:52 ******/\nDROP TABLE [dbo].[tParent]\nGO\n/****** Object: Table [dbo].[tParent] Script Date: 08/08/2012 08:11:52 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[tParent](\n[ID] [int] IDENTITY(1,1) NOT NULL,\n[Name] [varchar](50) NOT NULL,\n[Value] [int] NOT NULL,\nCONSTRAINT [PK_tParent] PRIMARY KEY CLUSTERED \n(\n[ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\n/****** Object: Table [dbo].[tChild] Script Date: 08/08/2012 08:11:51 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[tChild](\n[ID] [int] IDENTITY(1,1) NOT NULL,\n[ParentID] [int] NOT NULL,\n[Name] [varchar](50) NOT NULL,\n[Value] [int] NOT NULL,\nCONSTRAINT [PK_tChild] PRIMARY KEY CLUSTERED \n(\n[ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\n/****** Object: ForeignKey [FK_tChild_tParent] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] WITH CHECK ADD CONSTRAINT [FK_tChild_tParent] FOREIGN KEY([ParentID])\nREFERENCES [dbo].[tParent] ([ID])\nGO\nALTER TABLE [dbo].[tChild] CHECK CONSTRAINT [FK_tChild_tParent]\nGO\n</code></pre>\n\n<p>Why are there two identical lines that both try to drop the FK_tChild_tParent constraint? And why is the comment for both lines different?</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":51,"score":-3,"question_id":13200717,"title":"Change Record to Column in Sql","body":"<p>I have table like below</p>\n\n<pre><code>CustomFieldValueId  CustomFieldId   ProjectId   CustomFieldName CustomFieldValue\n35                  69              1           User Name       kaliya\n36                  72              1           City            Bangalore\n37                  74              1           Email           mm@gmail.com\n38                  69              1           User Name       mvkperumal\n39                  72              1           City            Chennai\n40                  74              1           Email           mvkperumal@gmail.com\n41                  69              1           User Name       Yohesh\n42                  72              1           City            Delhi\n43                  74              1           Email   \n</code></pre>\n\n<p>I need the output like below</p>\n\n<pre><code>User Name   City       Email\nkaliya      Bangalore  mm@gmail.com\nmvkperumal  Chennai    mverumal@gmail.com\nYohesh      Delhi   \n</code></pre>\n\n<p>I am taking the value based on CustomFieldValueId and grouping the ProjectId\nSo Please help on this..</p>\n"},{"tags":["sql-server","tsql","union"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13200720,"title":"UNION select sql statement returns duplicate results","body":"<p>My objective is to have one record with both HomeNumber &amp; OfficeNumber and I'm keeping the PersonID to reference the customer table. I'm thinking I shouldn't even be using a UNION but maybe a select query from two nested sub queries.</p>\n\n<p>The results returned look like this.</p>\n\n<pre><code>1A370535-9432-45B9-8F08-004F040EE196    ''          ''\n1A370535-9432-45B9-8F08-004F040EE196    6127319561  ''\nE8FA1667-416C-4639-ADDC-02143D651B4E    ''          6512096719\nE8FA1667-416C-4639-ADDC-02143D651B4E    6515786963  ''\n</code></pre>\n\n<p>Here my query:</p>\n\n<pre><code>    SELECT PhoneNumbers.PersonID, PhoneNumbers.HomeNum, PhoneNumbers.OfficeNum\n    FROM (\n      SELECT PhoneHub.PersonID, ISNULL(PhoneHub.PhoneNbr, '') AS HomeNum, '' AS OfficeNum\n      FROM \n        --PhoneType INNER JOIN \n        PhoneHub --ON PhoneType.ID = PhoneHub.TypeID \n      WHERE \n        (PhoneHub.FranID = @FranID) AND\n        (PhoneHub.TypeID = '28321161-668e-4a56-90be-67a146fa1353') -- Home# ID\n      UNION\n      SELECT PhoneHub.PersonID, '' AS HomeNum, ISNULL(PhoneHub.PhoneNbr, '') AS OffNum\n      FROM \n        --PhoneType AS PhoneType_2 INNER JOIN \n        PhoneHub --AS PhoneHub ON PhoneType_2.ID = PhoneHub.TypeID\n      WHERE \n        (PhoneHub.FranID = @FranID) AND\n        (PhoneHub.TypeID = '02a4125b-b968-4dc6-9734-7f75f45f7635') --Office# ID\n     ) AS PhoneNumbers  \n     ORDER BY PhoneNumbers.PersonID\n</code></pre>\n\n<p>Table Schema - PhoneHub</p>\n\n<pre><code>PK  ID          uniqueidentifier    \nFK  FranID      uniqueidentifier      Franchise.ID\nFK  PersonID    uniqueidentifier      Customer.ID   \nFK  TypeID      uniqueidentifier      PhoneType.ID\nPhoneNbr    nvarchar(20)    \nPhoneExt    nvarchar(10)    \nIsDefault   bit \n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2000"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13200024,"title":"SQL Server 2008 upgrade advisor tool","body":"<p>We upgraded to SQL Server 2008 from SQL Server 2000. But due to some legacy scripts/queries in our health care application, that run only in 2000, we had to run 2008 version on backwards compatibility mode. </p>\n\n<p>My question is what do I need to be aware of if I have to turn it on to full compatibility mode in terms of potential conflicts/issues etc. Is the Upgrade Advisor tool still useful in my case as we already upgraded but running in backwards compatibility mode. Is there value in running that tool? </p>\n\n<p>Any other information any one can share , will be useful. </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":30,"score":3,"question_id":13200609,"title":"How get around the arithmetic overflow error converting expression to data type int?","body":"<p>I have the following query:</p>\n\n<pre><code>-- CTE to remove outliers, e.g. remove the fastest and slowest results\n;WITH MinMaxCTE AS \n(\n  SELECT ServerName, CONVERT(VARCHAR(10), UpdatedOn, 101) AS [Date], Version, \n    MIN(JaguarStartupTime) AS MinStartTime, MAX(JaguarStartupTime) AS MaxStartTime\n  FROM dbo.MachineConfiguration (NOLOCK)\n  WHERE DomainLogin NOT IN (SELECT DomainLogin FROM dbo.SupportGroup)\n  GROUP BY ServerName, CONVERT(VARCHAR(10), UpdatedOn, 101), Version\n)\n\nSELECT  AVG(mc.JaguarStartupTime) AS AverageTime\n    , COUNT(*) AS NumEntries\n    , mc.Version\nFROM    #Eligible mc (NOLOCK)\nJOIN MinMaxCTE cte ON mc.ServerName = cte.ServerName \n  AND CONVERT(VARCHAR(10), mc.UpdatedOn, 101) = cte.[Date] \n  AND mc.Version = cte.Version \n  AND mc.JaguarStartupTime &lt;&gt; cte.MinStartTime \n  AND mc.JaguarStartupTime &lt;&gt; cte.MaxStartTime\nGROUP BY mc.Version\nORDER BY Version DESC, AVG(mc.JaguarStartupTime) ASC\n</code></pre>\n\n<p>The definition of the #Eligible temp table is </p>\n\n<pre><code>create table #Eligible (\n    Version nvarchar(50), JaguarStartupTime int, \n    ServerName nvarchar(50), UpdatedOn datetime )\n</code></pre>\n\n<p>No matter what condition or aggregation I comment out, I always get the following error: <code>Arithmetic overflow error converting expression to data type int</code>.</p>\n\n<p>Where can I go from here?  How do I debug this further?</p>\n\n<p>EDIT: Sample data</p>\n\n<pre><code>Version JaguarStartupTime    ServerName     UpdatedOn\n6.4.6.082      16040         NewOrleansLA   2012-08-08 12:34:12.330\n6.5.1.012      40390         BatonRougeLA   2012-08-08 18:33:17.440\n6.5.1.012      48379         HonoluluHI     2012-08-09 04:42:50.453\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","ssms"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2720,"score":4,"question_id":8917315,"title":"How to get Enterprise Manager installed in SQL Server 2008 Express?","body":"<p>I've installed Microsoft SQL Server 2008 Express twice now, and all the services work and I can create databases from Visual Studio 2010, but I don't have the <strong><em>Enterprise Manager</em></strong> (I learned it is now called <strong><em>Management Studio</em></strong>) available in the SQL Server 2008 program menu-- I do have other menu items like configuration manager, etc. but nothing for <em>Management Studio / Enterprise Manager</em>.</p>\n\n<p>Is there a checkbox I've missed during installation?<br>\nI ran a search for all exes in the SQL Server root folder and nothing jumped out as belonging to the Enterprise Manager, but I'm not 100% sure what the executable would be named.</p>\n\n<p>Primary question:<br>\n&nbsp; &nbsp; What is the procedure required to install the Management Studio client [for/with SQL 2008 Express] ?<br>\nSecondary question:<br>\n&nbsp; &nbsp; What is the name of this client's executable file ?</p>\n"},{"tags":["sql-server","backup","restore"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13200464,"title":"How to stop SQL server restore from overwriting database?","body":"<p>I have a ELMAH database that I want to script the restore of using the following:</p>\n\n<pre><code>RESTORE DATABASE [Elmah] \nFROM DISK = N'E:\\Elmah_backup_2012_11_02_030003_1700702.bak' \nWITH FILE = 1,  \nMOVE N'Elmah' TO N'C:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Elmah.mdf',  \nMOVE N'Elmah_log' TO N'C:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Elmah.ldf',  \nNOUNLOAD, STATS = 10\nGO\n</code></pre>\n\n<p>Even though I am not including <code>WITH REPLACE</code> each time I execute this statement it restores over the existing database.</p>\n\n<p>I will always drop all databases before this operation and I never want this code to accidentally restore a database over one in production.</p>\n\n<p>How do I change this code so that it will never overwrite an existing database?</p>\n\n<p>I am actually doing this through SMO objects but the principle and results are the same so I am hoping to keep this simplified to just the TSQL necessary in the hopes that I can generalize that information to what needs to be set on the appropriate SMO.Restore object.</p>\n"},{"tags":["c#","sql-server","webforms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13179514,"title":"CSV file parsing to a list, make list public to parse against SQL table","body":"<p>Parsed a csv file to a list in a webapp form. </p>\n\n<p>How do I make the list public so that I can call it and use it in other classes? I essentially need to parse through the data in the list against data in a SQL table.</p>\n\n<pre><code>public partial class _Default : System.Web.UI.Page\n{\n    protected void UploadBtn_Click(object sender, EventArgs e)\n    {\n\n        if (FileUpload.HasFile)\n        {\n\n            string filename = Path.GetFileName(FileUpload.FileName);\n\n            using (FileStream stream = new FileStream(ConfigurationManager.AppSettings[\"temp_dir\"].ToString().Trim() + filename, FileMode.Open, FileAccess.Read, FileShare.Read))\n            { \n                using (StreamReader read = new StreamReader(stream))\n                {\n                    List&lt;string[]&gt; members = new List&lt;string[]&gt;();\n                    int j = 0;\n\n                    while (!read.EndOfStream)\n                    {\n\n                        string line = read.ReadLine();\n                        string[] values = line.Split(',');\n\n                        if(j==0)\n                        {\n                            j++;\n                            continue;\n                        }\n\n                        long nbr = Convert.ToInt64(values[0]);\n                        int lnbr = Convert.ToInt32(values[1]);\n                        int value = Convert.ToInt32(values[2]);\n                        members.Add(values);\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13200062,"title":"SQL Server upgrade single instance","body":"<p>I have a server that is running SQL Server 2005 Express.</p>\n\n<p>It currently has 2 instances of SQL Server running.</p>\n\n<ul>\n<li>Instance 1 runs some old legacy software that is not supported by me.</li>\n<li>Instance 2 runs my software. </li>\n</ul>\n\n<p>Is it possible to upgrade instance 2 to SQL Server 2008 R2 Express independently of instance 1, i.e. keeping instance 1 on 2005 while instance 2 is upgraded?</p>\n"},{"tags":["sql","sql-server","pivot","pivot-without-aggregate"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":72,"score":2,"question_id":12516357,"title":"Transposing data into multiple columns","body":"<p>I have numbers of clients and each client has 67 records. </p>\n\n<p>The record contains Activities, Dates, IDs, flags and many other columns. </p>\n\n<p>I would like the Activities names to be the headings and Dates underneath to those Activity headings. </p>\n\n<p>I am trying to explain it more using the tables below. This is the current output:</p>\n\n<pre><code>Client  Activity    Date \n1       A           21/15\n1       B           5/5/2012\n1       C           51/3115\n1       D           54/6/84\n2       A           8/6/99\n2       B           1/1/2011\n2       C           8/4\n2       D           9/81/1\n3       A           6/51/8\n3       B           1/61/8\n3       C           1/31\n3       D           3/2/1\n</code></pre>\n\n<p>And I would like it to be:</p>\n\n<pre><code>Client      A       B         C         D\n1           21/15   5/5/2012  51/31/15  54/6/84\n2           8/6/99  1/1/2011  8/4       9/81/1\n3           6/51/8  1/61/8    1/31      3/2/1\n</code></pre>\n"},{"tags":["sql","sql-server","pivot","sql-server-2012","pivot-without-aggregate"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":114,"score":0,"question_id":12387548,"title":"Query to show customers and their contacts in columns side by side","body":"<p>I am trying to figure it out if it's possible to achieve something having this tables as example...</p>\n\n<pre><code>CustomersTable\n Id  | Name | Address\n  1  | John | Street A\n  2  | Paul | Street B\n  3  | Mary | Street C\n\nContactsTable\n Id  | CustomerId | ContactName | Contact\n  1  |     1      |  Contact A  |   123\n  2  |     1      |  Contact B  |   543\n  3  |     2      |  Contact 1  |   678\n  4  |     3      |  Contact A1 |   980\n  5  |     3      |  Contact B2 |   521\n</code></pre>\n\n<p>And get something like this...</p>\n\n<pre><code> Id  |  Name  |  Address   | ContactId_1 | ContactName_1 | Contact_1 | ContactId_2 | ContactName_2 | Contact_2\n  1  |  John  |  Street A  |      1      |   Contact A   |    123    |      2      |   Contact B   |    543\n  2  |  Paul  |  Street B  |      3      |   Contact 1   |    678    |     NULL    |     NULL      |    NULL\n  3  |  Mary  |  Street C  |      4      |   Contact A1  |    980    |      5      |   Contact B2  |    521\n</code></pre>\n\n<p>The idea is to get a table where the contacts are side by side of each customer where it belongs. And the contact columns contacts will depend of course on the number of contacts of each customer.</p>\n\n<p>This can be done? How?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server","sql-server-2008-r2","pivot","pivot-without-aggregate"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":12514192,"title":"SQL: Turn a row into a column (and include column names in a new column)","body":"<p>I'm busy writing a claims provider class to be used in a Security Token Service.</p>\n\n<p>User permissions are read from a SQL Server 2008 R2 database:</p>\n\n<pre><code>SELECT A, B, C, ..., X FROM Permissions WHERE UserId = @UserId\n</code></pre>\n\n<p>would give me a single row, for example: </p>\n\n<pre><code>A B C ... X\n1 0 1     1\n</code></pre>\n\n<p>it would be much easier to have this data in the form</p>\n\n<pre><code>Permission Value\nA          1\nB          0\nC          1\n...\nX          1\n</code></pre>\n\n<p>Since the actual table contains dozens of columns, I'd prefer to be able to do the transposition \"dynamically\" without really having to type up any column names by hand.</p>\n\n<p>It feels like the PIVOT/UNPIVOT functions and INFORMATION_SCHEMA.COLUMNS view are what I need, but I can't quite figure out what to do.</p>\n\n<p>Any ideas for a query that would do this?</p>\n\n<p>PS. I guess if push comes to shove, I'd just stick the result set in a DataTable and iterate over the columns in code to generate the user claims, but I'd like to find out if the above approach is possible first :)</p>\n"},{"tags":["sql","sql-server","pivot"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12505079,"title":"Write advanced SQL Select","body":"<p>Item table:</p>\n\n<pre><code>|   Item    |   Qnty    |   ProdSched   |\n|    a      |    1      |       1       |\n|    b      |    2      |       1       |\n|    c      |    3      |       1       |\n|    a      |    4      |       2       |\n|    b      |    5      |       2       |\n|    c      |    6      |       2       |\n</code></pre>\n\n<p>Is there a way I can output it like this using SQL <code>SELECT</code>?</p>\n\n<pre><code>|   Item    |   ProdSched(1)(Qnty)  |   ProdSched(2)(Qnty)  |\n|    a      |           1           |       4               |\n|    b      |           2           |       5               |\n|    c      |           3           |       6               |\n</code></pre>\n"},{"tags":["sql-server","linked-server","dbf"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13199864,"title":"Create a linked server with SQL Server 2012 x64","body":"<p>How can I create a linked server to a folder having fox pro dbf files?</p>\n\n<p>I can access the dbfs inside Visual Studio 2010, creating a connection with this properties</p>\n\n<p>Connection string</p>\n\n<pre><code>Dsn=Legacy;dbq=\\\\192.168.48.29\\dbf;defaultdir=\\\\192.168.48.29\\dbf;driverid=533;fil=dBase 5.0;maxbuffersize=2048;pagetimeout=5\n</code></pre>\n\n<p>Provider</p>\n\n<p>.NET Framework Data Provider for ODBC</p>\n\n<p>But I don't know how to use this information with sql server 2012 express x64</p>\n\n<p>I'm trying to use</p>\n\n<pre><code>EXEC master.dbo.sp_addlinkedserver @server = N'LEGACY', @srvproduct=N'Legacy', @provider=N'MSDASQL', @datasrc=N'Dsn=Legacy;dbq=\\\\192.168.48.29\\dbf;defaultdir=\\\\192.168.48.29\\dbf;driverid=533;fil=dBase 5.0;maxbuffersize=2048;pagetimeout=5', @provstr=N'.NET Framework Data Provider for ODBC'\n</code></pre>\n\n<p>in SQL Server Management Studio</p>\n\n<p>Error message about not finding the dsn ...</p>\n"},{"tags":["sql","sql-server","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":13199422,"title":"How can I return several text fields with the same ID number in one row in SQL server?","body":"<p>I have table:</p>\n\n<pre><code>    ID   Note\n1   1    aaa\n2   1    bbb\n3   1    ccc\n4   2    ddd\n5   2    eee\n6   2    fff\n</code></pre>\n\n<p>I need to return it as:</p>\n\n<pre><code>   ID   Note1   Note2   Note3\n1  1    aaa     bbb     ccc\n2  2    ddd     eee     fff\n</code></pre>\n\n<p>Thank you!</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":12,"down_vote_count":0,"view_count":1976,"score":12,"question_id":6376866,"title":"TSQL - How to use GO inside of a BEGIN .. END block?","body":"<p>I am generating a script for automatically migrating changes from multiple development databases to staging/production.  Basically, it takes a bunch of change-scripts, and merges them into a single script, wrapping each script in a <code>IF whatever BEGIN ... END</code> statement.</p>\n\n<p>However, some of the scripts require a <code>GO</code> statement so that, for instance, the SQL parser knows about a new column after it's created.</p>\n\n<pre><code>ALTER TABLE dbo.EMPLOYEE \nADD COLUMN EMP_IS_ADMIN BIT NOT NULL\nGO -- Necessary, or next line will generate \"Unknown column:  EMP_IS_ADMIN\"\nUPDATE dbo.EMPLOYEE SET EMP_IS_ADMIN = whatever\n</code></pre>\n\n<p>However, once I wrap that in an <code>IF</code> block:</p>\n\n<pre><code>IF whatever\nBEGIN\n    ALTER TABLE dbo.EMPLOYEE ADD COLUMN EMP_IS_ADMIN BIT NOT NULL\n    GO\n    UPDATE dbo.EMPLOYEE SET EMP_IS_ADMIN = whatever\nEND\n</code></pre>\n\n<p>It fails because I am sending a <code>BEGIN</code> with no matching <code>END</code>.  However, if I remove the <code>GO</code> it complains again about an unknown column.</p>\n\n<p><strong>Is there any way to create and update the same column within a single <code>IF</code> block?</strong></p>\n"},{"tags":["sql-server","tsql","index"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13199234,"title":"Indexing on a single value only in a column","body":"<p>I have a table in which I use reference counting for removing obsolete rows. In order to do this efficiently, I would like to create an index that only indexes the rows in the table, where the reference count is 0. Is this possible, or am I better off using a view, or something else?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13198571,"title":"Restore Backup Fails - File 'Db' cannot be restored to '{...}.mdf'. Use WITH MOVE to identify a valid location for the file","body":"<p>I am getting the following errors trying to do a restore using the restore command on a backup file I recieved from a customer.</p>\n\n<p>RESTORE DATABASE SFDB FROM DISK = N'C:\\Backup\\Backup.bak' </p>\n\n<p>Any thoughts on what I can do to correct this?  It's looking for the mdf, so can I assume that the backup file I have is an incremental backup and not the full backup and that's why it's looking for the mdf?  </p>\n\n<p>I am not sure if 1) they have given all the data (the entire db) or 2) I have the right data - and I can do the restore with the right T-SQL commands - I just don't know how.</p>\n\n<p>Help is appreciated.</p>\n\n<pre><code>Msg 5133, Level 16, State 1, Line 2\nDirectory lookup for the file \"D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db.mdf\" failed with the operating system error 21(failed to retrieve text for this error. Reason: 15105).\nMsg 3156, Level 16, State 3, Line 2\nFile 'Db' cannot be restored to 'D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db.mdf'. Use WITH MOVE to identify a valid location for the file.\nMsg 5133, Level 16, State 1, Line 2\nDirectory lookup for the file \"D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db_log.LDF\" failed with the operating system error 21(failed to retrieve text for this error. Reason: 15105).\nMsg 3156, Level 16, State 3, Line 2\nFile 'DbDev_log' cannot be restored to 'D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db_log.LDF'. Use WITH MOVE to identify a valid location for the file.\nMsg 3634, Level 16, State 1, Line 2\nThe operating system returned the error '21(failed to retrieve text for this error. Reason: 15105)' while attempting 'GetVolumeInformation' on 'D:\\'.\nMsg 3013, Level 16, State 1, Line 2\nRESTORE DATABASE is terminating abnormally.\n</code></pre>\n\n<p>RESTORE FileListOnly FROM DISK = N'C:\\Backup\\Backup.bak' shows me the following...</p>\n\n<pre><code>LogicalName PhysicalName    Type    FileGroupName   Size    MaxSize FileId  CreateLSN   DropLSN UniqueId    ReadOnlyLSN ReadWriteLSN    BackupSizeInBytes   SourceBlockSize FileGroupId LogGroupGUID    DifferentialBaseLSN DifferentialBaseGUID    IsReadOnly  IsPresent   TDEThumbprint\nDb  D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db.mdf  D   PRIMARY 29622272    35184372080640  1   0   0   02925462-83CC-4222-8966-53229FA25B1C    0   0   29032448    512 1   NULL    269000000146900238  735C7F0E-F63D-4AA1-AC48-505A084AC00B    0   1   NULL\nDb_log  D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db_log.LDF  L   NULL    40239104    2199023255552   2   0   0   71038B04-CBC9-4E4A-93AD-4E1268859CB2    0   0   0   512 0   NULL    0   00000000-0000-0000-0000-000000000000    0   1   NULL\nDbDev_filestream    D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db  S   PRIMARY_FILESTREAM  4691012 0   65537   18000000011800001   0   627C9AAA-97BD-4991-9C8C-90C400226A9F    0   0   4784128 512 2   NULL    269000000146900238  735C7F0E-F63D-4AA1-AC48-505A084AC00B    0   1   NULL\n</code></pre>\n"},{"tags":["sql-server","dbf","visual-foxpro"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":535,"score":1,"question_id":9466630,"title":"Run UPDATE and DELETE statements on VFP DBF files on SQL Server","body":"<p>We're migrating our legacy system based Visual FoxPro to Java, and we need to configure the SQL Server to CRUD the DBF files of the system, because we'll rewrite the system in parts. So the employees will use both interfaces in the same time and we need real-time updates in both systems.</p>\n\n<p>Right now, I'm able to INSERT and SELECT data on SQL Server but I can't UPDATE and DELETE.</p>\n\n<p>I've run the following command to create the linked server:</p>\n\n<pre><code>sp_addlinkedserver @server = 'DEN',\n@srvproduct = 'foxpro',\n@provider = 'VFPOLEDB.1',\n@datasrc = 'D:\\BaseTeste\\denny\\denny_db.dbc'\n</code></pre>\n\n<p>And run the following SQL to update a table:</p>\n\n<pre><code>UPDATE DEN...produtos SET familia=1 WHERE id=35\n</code></pre>\n\n<p>And I've received this error:</p>\n\n<blockquote>\n  <p>OLE DB provider \"VFPOLEDB\" for linked server \"DEN\" returned message \"Multiple-step OLE DB operation generated errors. Check each OLE DB status value, if available. No work was done.\".</p>\n  \n  <p>Msg 7333, Level 16, State 2, Line 1</p>\n  \n  <p>Cannot fetch a row using a bookmark from OLE DB provider \"VFPOLEDB\" for linked server \"DEN\".</p>\n</blockquote>\n\n<p>How to solve that?\nThanks.</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2377,"score":0,"question_id":3033959,"title":"user instance login flag is not supported on this version of sql server","body":"<p>I have created an Asp.net website using VS 2008 and SQL Express 2008 on one PC. with db files in |Data Directory|.<br>\nWhen i copied these website files to another PC ( having same VS 2008 and SQL Express 2008) its giving me error<br>\nuser instance login flag is not supported on this version of sql server</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13198805,"title":"Remove duplicate batches of data","body":"<p>Due to a bug in my application a table that was built to carry daily records of each delivery period, was populated many times.</p>\n\n<p>Lets say I have a delivery from 1st of June to 5 of June. My table should be populated with 5 records, one for each day. Now, I have havoc because I have many \"batches\" of the same content.</p>\n\n<p>The table layout is as:</p>\n\n<pre><code>dummy_id       -- identity column\ndelivery_id    -- id of the delivery\non_date        -- the day\ncharge         -- the daily cost\n</code></pre>\n\n<p>Is there an elegant way to keep only the first batch of records and delete the batches that were inserted by mistake for all the deliveries?</p>\n"},{"tags":["sql-server","sql-server-2008-r2","sql-update"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13198476,"title":"Cannot use UPDATE with OUTPUT clause when a trigger is on the table","body":"<p>i'm performing an <code>UPDATE</code> with <code>OUTPUT</code> query:</p>\n\n<pre><code>UPDATE BatchReports\nSET IsProcessed = 1\nOUTPUT inserted.BatchFileXml, inserted.ResponseFileXml, deleted.ProcessedDate\nWHERE BatchReports.BatchReportGUID = @someGuid\n</code></pre>\n\n<p>This well and fine; until a trigger is defined on the table. Then my <code>UPDATE</code> statement will get the error <a href=\"http://msdn.microsoft.com/en-us/library/aa937592%28v=sql.80%29.aspx\" rel=\"nofollow\">334</a>:</p>\n\n<blockquote>\n  <p>The target table 'BatchReports' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause</p>\n</blockquote>\n\n<p>Now this problem is explained in <a href=\"http://blogs.msdn.com/b/sqlprogrammability/archive/2008/07/11/update-with-output-clause-triggers-and-sqlmoreresults.aspx\" rel=\"nofollow\">a blog post by the SQL Server team</a>:</p>\n\n<blockquote>\n  <p>The error message is self-explanatory</p>\n</blockquote>\n\n<p>And they also give solutions:</p>\n\n<blockquote>\n  <p>The application was changed to utilize the INTO clause</p>\n</blockquote>\n\n<p>Except i cannot make heads or tails of the entirety of the blog post.</p>\n\n<p>So let me ask my question: What should i change my <code>UPDATE</code> to so that it works?</p>\n\n<h2>See also</h2>\n\n<ul>\n<li><a href=\"http://blogs.msdn.com/b/sqlprogrammability/archive/2008/07/11/update-with-output-clause-triggers-and-sqlmoreresults.aspx\" rel=\"nofollow\">UPDATE with OUTPUT clause  Triggers  and SQLMoreResults</a></li>\n<li><a href=\"http://stackoverflow.com/questions/6504173/why-is-the-target-table-of-a-merge-statement-not-allowed-to-have-enabled-rules\">Why is the target table of a MERGE statement not allowed to have enabled rules?</a></li>\n<li><a href=\"http://stackoverflow.com/questions/12537653/statement-contains-an-output-clause-without-into-clause-error\">Statement contains an OUTPUT clause without INTO clause error</a></li>\n</ul>\n"},{"tags":["sql-server","ssas","data-warehouse","olap-cube"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13114338,"title":"Unable to build SQL Server OLAP Cube when there is no rows corresponding to foreign key in a table","body":"<p>I am  new to SQL Server OLAP Cubes.  I am having the following issue  like  </p>\n\n<p>ex  I have  purchase order and invoice tables  which are used in data source view. These two tables are related  by purchase order ID  which have one to many relationship with invoices.</p>\n\n<p>I am getting the following error for the purcahse orders which i dont have invoices </p>\n\n<p>Errors in the OLAP storage engine: The attribute key cannot be found when processing: Table: purchase order </p>\n\n<p>Can anyone throw some light  on this to help me</p>\n"},{"tags":["sql-server","hibernate","hbm2ddl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13174286,"title":"Hibernate hbm2ddl does not create foreign keys on SQLServer 2008","body":"<p>I am trying to generate foreign keys via hibernate hbm2ddl with: </p>\n\n<pre><code>   hibernate.hbm2ddl.auto=update\n</code></pre>\n\n<p>And using the following mapping:</p>\n\n<pre><code>   @OneToOne\n   @ForeignKey(name=\"FK_address_nationality_id\")\n   private Nationality country;\n</code></pre>\n\n<p>It creates the table, with a country column but no foreign key is created.\nWhy might this be?</p>\n"},{"tags":["sql-server","tsql","inner-join"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13198223,"title":"The effect of a select with multiple tables in FROM is the same as INNER JOIN but what is the ON clause then?","body":"<p>I have a query like this:</p>\n\n<pre><code>SELECT\n    *\nFROM\n    table1,\n    table2\n</code></pre>\n\n<p>I know this is somewhat equivalent to:</p>\n\n<pre><code>SELECT\n    *\nFROM\n    table1\nINNER JOIN\n    table2\nON ???\n</code></pre>\n\n<p>However, what would be the resulting ON clause for the join?</p>\n\n<h2>Update</h2>\n\n<p>After some testing in SSMS here are my findings</p>\n\n<pre><code>SELECT * FROM table1,table2\n</code></pre>\n\n<p>gives the same execution plan and the same records as</p>\n\n<pre><code>SELECT * FROM table1 INNER JOIN table2 ON 1=1\n</code></pre>\n\n<p>and the same thing for</p>\n\n<pre><code>SELECT * FROM table1 CROSS JOIN table2\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13180231,"title":"Migrating DB from SQL 2005 Enterprise to SQL 2008 Standard","body":"<p>I'm attemtping to migrate a DB from SQL 2005 Enterprise to SQL 2008 Standard.  I've run into an issue because there is a Partition Function defined in the DB of the Enterprise edition.  I know Standard edtiions do not support Partition Functions. Upgrading the version of SQL im migrating to Enterprise isn't an option.</p>\n\n<p>I'm looking for a way to remove the partition function without causing any negative effects to the DB currently so I can migrate it to the 2008 Standard Edition.</p>\n\n<p>Any help would be greatly appreciated. Thanks!</p>\n\n<p>MOVED to dba.stackexchange.com. </p>\n"},{"tags":["sql-server","tsql","sql-server-2008","sqlcompare"],"answer_count":9,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1175,"score":3,"question_id":3012544,"title":"T-SQL - Is there a (free) way to compare data in two tables?","body":"<p>I have <code>table a</code> and <code>table b</code>. (SQL Server 2008)</p>\n\n<p>Both tables have the exact same schema.</p>\n\n<p>For the purposes of this question, consider <code>table a</code> = my local dev table, <code>table b</code> = the live table.</p>\n\n<p>I need to create a SQL script (containing <code>UPDATE/DELETE/INSERT</code> statements) that will update table b to be the same as table a. This script will then be deployed to the live database.</p>\n\n<p>Any free tools out there that can do this, or better yet a way I can do it myself?</p>\n\n<p>I'm thinking I probably need to do some type of a join on all the fields in the tables, then generate dynamic SQL based on that.</p>\n\n<p>Anyone have any ideas?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Okay, thought I'd clarify this question a little.</p>\n\n<p>The table I need to synchronize is a simple look-up table. The data is very simple and straightforward.</p>\n\n<p>Here's an idea of what <code>TABLE A</code> might look like:</p>\n\n<pre><code>IdFoo          Activity      IsFoo\n1              Foo           1\n2              Bar           0\n</code></pre>\n\n<p>Here's an idea of what <code>TABLE B</code> might look like:</p>\n\n<pre><code>IdFoo          Activity      IsFoo\n1              Foo           1\n2              Bar           1\n</code></pre>\n\n<p>Basically, all I want to do is update that <code>BIT</code> column (<code>IsFoo</code>) in <code>TABLE B</code> to match the corresponding value in <code>TABLE A</code> for the same IdFoo.</p>\n\n<p>Keep in mind:</p>\n\n<ul>\n<li><code>TABLE A</code> is on my local machine</li>\n<li><code>TABLE B</code> is on the live server</li>\n</ul>\n\n<p>Obviously I have a (reliable) backup of <code>TABLE B</code> on my local machine which i need to script against, then run the script on the live server.</p>\n\n<p>The table also has referential integrity (other columns I didn't show). Which means I can't just delete everything in <code>TABLE B</code> and do an insert from <code>TABLE A</code>.</p>\n\n<p>This script will be a once off. So no need to do things like linked server, replication, etc. Appreciate the answers though guys. =)</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Ok - so I've gone with Oleg's answer (VS2010 Data Compare). Quick, easy, and works a charm.</p>\n\n<p>Not to say the other answers are incorrect. I appreciate all the answers!</p>\n"},{"tags":["sql-server","reporting-services","ssrs-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13180160,"title":"SSRS 2005 Number formating int and double within one field","body":"<p>I am using <code>SSRS 2005</code>. The issue is I would like to place , in numbers so if number is 23455 it should be displayed as 23,455 I know how to do this I have two data types in this field int and double. What I did to accommodate it is changed the numbers to strings but if I extract them to Excel they show green triangle.</p>\n\n<p>To eliminate green triangle in Excel I used <code>CDEC()</code> function which converts the string to number by doing this I loose , in the numbers.</p>\n\n<p>I was wondering if it is even possible to place a comma within the field which has two different datatypes i.e. double and int.</p>\n"},{"tags":["sql-server","sql-server-ce"],"answer_count":5,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":21091,"score":7,"question_id":1953248,"title":"how to open sdf (sql server compact edition) file?","body":"<p>I have an SDF file and I would like to retrieve its schema and query it with some UI. How can I do this? I have no Visual Studio installed on the machine and I would like to install as little software as possible.</p>\n"},{"tags":["sql","sql-server","pivot","dynamic-sql","temp-table"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":13180175,"title":"Trying to put a dynamic SQL subquery result into SQL-Server 2008 temp table without pre define the temp table","body":"<p>Im trying to get my result into a temp table but cant get it to work.</p>\n\n<pre><code>DECLARE @query nvarchar(max)\nSET @query = N'SELECT * INTO ##TmpTbl FROM (SELECT * FROM Tbl1)'\nEXEC(@query)\n</code></pre>\n\n<p>What am i doing wrong?</p>\n\n<blockquote>\n  <p>NOTE: I can NOT pre define temp table/table variable because of the actual\n  question being run is a pivot question without pre defined columns in\n  its result.</p>\n</blockquote>\n"},{"tags":["sql","sql-server","alter-table","alter-column"],"answer_count":4,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":7543,"score":7,"question_id":3186760,"title":"SQL Server - Change a Nullable column to NOT NULL with Default Value","body":"<p>I came across an old table today with a datetime column called 'Created' which allows nulls.  Now, I'd want to change this so that it is NOT NULL, and also include a constraint to add in a default value (getdate()).</p>\n\n<p>So far I've got the following script, which works fine provided that i've cleaned up all the nulls beforehand:</p>\n\n<pre><code>ALTER TABLE dbo.MyTable ALTER COLUMN Created DATETIME NOT NULL \n</code></pre>\n\n<p>Is there any way to also specify the default value as well on the ALTER statement?</p>\n"},{"tags":["sql","sql-server","query","ide","formatting"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":194,"score":1,"question_id":11061642,"title":"SQL server 2012 SP_HELPTEXT extra lines issue","body":"<p>I am using SQL server 2012, &amp; always use <code>SP_HELPTEXT</code> to get my previously created Stored Procedures, In previous versions of SQL server there were no issues in this process but in 2012, My Stored Procedures come with extra lines, for example this is the procedure that I wrote</p>\n\n<pre><code>Create proc SP_Test\nas\nbegin\n Select * \n from table_ABC\nend\n</code></pre>\n\n<p>Now after using <code>SP_HELPTEXT</code> with this procedure (or any other procedure), I am getting this output</p>\n\n<pre><code>Create proc SP_Test\n\nas\n\nbegin\n\n Select * \n\n from table_ABC\n\nend\n</code></pre>\n\n<p>Do any one else also facing this problem or I am the only one on this planet to struggle with this issue ??\nDoes any body know how to solve this issue ??</p>\n\n<p>Configuration of my SQL server is as follows (copied from <strong>Help -> About</strong> )</p>\n\n<pre><code>Microsoft SQL Server Management Studio          11.0.2100.60\nMicrosoft Analysis Services Client Tools        11.0.2100.60\nMicrosoft Data Access Components (MDAC)         6.1.7601.17514\nMicrosoft MSXML                     3.0 6.0 \nMicrosoft Internet Explorer             9.0.8112.16421\nMicrosoft .NET Framework                4.0.30319.269\nOperating System                    6.1.7601\n</code></pre>\n\n<p>Thanx in advance.</p>\n"},{"tags":["asp.net","sql-server","enterprise-library","data-access-layer"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13179793,"title":"Is My Data Access Leaking Connections?","body":"<p>Folks</p>\n\n<p>I have an N-Tiered ASP.Net Web Forms application which uses Enterprise Library 5.0 for data persistence. Recently I have noticed my application has been spitting out the following error</p>\n\n<blockquote>\n  <p>Timeout expired. The timeout period elapsed prior to obtaining a\n  connection from the pool</p>\n</blockquote>\n\n<p>This would point to leaking connections or connections not being closed. Please can someone look at my Data Access class and let me know if they see any issues where connections are not being closed properly</p>\n\n<pre><code>Public Class DataAccess\n\n    Private db As Database = DatabaseFactory.CreateDatabase()\n\n    Public Function ExecuteNonQuery(ByVal params() As SqlParameter, ByVal strSproc As String) As Integer\n\n        Dim intReturnValue As Integer = 0\n        Dim i As Integer\n\n        Using cmd As DbCommand = db.GetStoredProcCommand(strSproc)\n\n            cmd.CommandTimeout = 120\n\n            For i = 0 To params.Length - 1\n                db.AddInParameter(cmd, params(i).ParameterName.ToString, params(i).DbType, params(i).Value)\n            Next\n\n            db.AddParameter(cmd, \"return_value\", DbType.Int32, ParameterDirection.ReturnValue, \"\", DataRowVersion.Default, 0)\n\n            db.ExecuteNonQuery(cmd)\n            intReturnValue = Int32.Parse(db.GetParameterValue(cmd, \"@return_value\"))\n\n        End Using\n\n        Return intReturnValue\n\n    End Function\n\n    Public Function ExecuteDataReader(ByVal params() As SqlParameter, ByVal SProc As String) As SqlDataReader\n\n        Dim i As Integer\n\n        Dim dr As SqlDataReader\n\n        Using cmd As DbCommand = db.GetStoredProcCommand(SProc)\n\n            cmd.CommandTimeout = 120\n\n            For i = 0 To params.Length - 1\n                db.AddInParameter(cmd, params(i).ParameterName.ToString, params(i).DbType, params(i).Value)\n            Next\n\n            dr = TryCast(DirectCast(db.ExecuteReader(cmd), RefCountingDataReader).InnerReader, SqlDataReader)\n\n        End Using\n\n        Return dr\n\n    End Function\n\n    Public Function ExecuteDataSet(ByVal Sproc As String, ByVal params() As SqlParameter) As DataSet\n        Dim db As Database = DatabaseFactory.CreateDatabase()\n        Dim ds As New DataSet\n        Dim i As Integer\n\n        Using cmd As DbCommand = db.GetStoredProcCommand(Sproc)\n            cmd.CommandTimeout = 120\n\n            For i = 0 To params.Length - 1\n                db.AddInParameter(cmd, params(i).ParameterName.ToString, params(i).DbType, params(i).Value)\n            Next\n\n            db.LoadDataSet(cmd, ds, \"table\")\n        End Using\n\n\n        Return ds\n    End Function\n</code></pre>\n\n<p>Could this error also mean that it is taking too long to possibly execute some queries? Some tables in my database have alot of data in them.</p>\n\n<p>Any feedback or help would be greatly appreciated with this folks as it is really affecting my application.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","raiserror"],"answer_count":1,"favorite_count":6,"up_vote_count":20,"down_vote_count":0,"view_count":7868,"score":20,"question_id":1122925,"title":"What do the different RAISERROR severity levels mean?","body":"<p>My best google result was <a href=\"http://www.xaprb.com/blog/2005/11/23/be-consistent-with-raiserror-severitites/\" rel=\"nofollow\">this</a>:</p>\n\n<ul>\n<li>below 11 are warnings, not errors</li>\n<li>11-16 are available for use</li>\n<li>above 16 are system errors</li>\n<li>there is no behavioral difference among 11-16</li>\n</ul>\n\n<p>But, from BOL, \"Severity levels from 0 through 18 can be specified by any user.\"</p>\n\n<p>In my particular stored procedure, I want the error returned to a .Net client application, so it looks like any severity level between 11-18 would do the trick.  Does anyone have any authoritative information about what each of the levels mean, and how they should be used?</p>\n"},{"tags":["asp.net","sql-server","iis-7.5","session-variables","session-state"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":140,"score":3,"question_id":13130239,"title":"Sharing SQL Server Session State across Web Applications","body":"<p>I'm setting up a very basic demo of SQL Server Session State, but am having some trouble getting it working. I'm trying to test this out locally running Windows 7 with IIS 7.5 and SQL Server 2008 R2. </p>\n\n<p><strong>Ultimately, I need a way to track the number of users logged into a system that is load-balanced between a few different web servers. So I need to update a session variable (stored in SQL) every time a user logs in or out. So the session ID could always be different. Is this possible?</strong></p>\n\n<p>Here's what I've done so far:</p>\n\n<ol>\n<li>Created two new sites in IIS (Site1 and Site2)</li>\n<li>Created two new Web Application projects in VS 2010 (Site1 and Site2)</li>\n<li>In both sites, on the Default.aspx page, I created a button that when clicked will save either \"Site1\" or \"Site2\" (depending on the site) into a session variable called \"LastSiteUsed\". There's another button, that when clicked, will read the value from the \"LastSiteUsed\" session variable and display it in a label.</li>\n<li>In SQL, I created a new Database called dbSessionTest. Then I followed the instructions on <a href=\"http://msdn.microsoft.com/en-us/library/ms178586.aspx\" rel=\"nofollow\">MSDN to install the Session State Database using the aspnet_regsql tool</a>.</li>\n<li>In both of my Web Application's Web.config file, I've added the following under <code>&lt;System.Web&gt;</code>: </li>\n</ol>\n\n<p><code>&lt;sessionState mode=\"SQLServer\" sqlConnectionString=\"server=.\\sqlexpress;database=dbSessionTest;uid=myUsername;pwd=myPassword\" cookieless=\"false\" timeout=\"20\" allowCustomSqlDatabase=\"true\"/&gt;</code></p>\n\n<p>Both sites function normally, but they don't seem to be <em>sharing</em> the session. For example, when I click my button to save my session variable from Site1, I'd expect to be able to read that value from Site2, but it doesn't work. Site2 will only return \"Site2\" and Site1 will only return \"Site1\". </p>\n\n<p>Does anyone have any ideas on what I could be doing wrong? Am I wrong in thinking that I should be able to read a value set by Site1 from Site2?</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>I can see that session data is getting stored in the <code>ASPStateTempSessions</code> table in SQL Management Studio, but each site can still only see the value which it wrote. Both sites are setting the session variable like this:</p>\n\n<pre><code>Session(\"LastSiteUsed\") = \"Site2\"\n</code></pre>\n\n<p>And both sites are retrieving the value like:</p>\n\n<pre><code>lblValue.Text = \"Value from Session: \" &amp; Session(\"LastSiteUsed\").ToString\n</code></pre>\n\n<p>Do I need to do this differently for accessing session variables stored in SQL Server?</p>\n\n<p><strong>UPDATE 2:</strong></p>\n\n<p>I've tried using the default database, ASPState, which is created by running this command:</p>\n\n<pre><code>aspnet_regsql.exe -S MyServerName -E -ssadd -sstype p\n</code></pre>\n\n<p>Then simplified each of my Web.config files like:</p>\n\n<pre><code>&lt;sessionState mode=\"SQLServer\" sqlConnectionString=\"Data Source=.\\sqlexpress;User ID=myUsername;Password=myPassword\" cookieless=\"false\" timeout=\"20\"/&gt;\n</code></pre>\n\n<p>But again, no luck. I want to be able to set a session variable from Site1 and then read the value from Site2, but it's not working. Again, I'm able to see entries showing up in the <code>ASPStateTempSessions</code> table so I know they're getting entered correctly. One thing I noticed is they have different session IDs? </p>\n\n<p>Is there something I need to be doing differently to ensure the same session ID is used between my sites when setting/reading the same session variable?</p>\n\n<p><strong>UPDATE 3:</strong></p>\n\n<p>I've followed the instructions from <strong><a href=\"http://www.stionasoftware.com/Blogs/post/2010/10/27/Sharing-NET-Session-across-multiple-applications.aspx\" rel=\"nofollow\">this article</a></strong> which modifies an SP and adds a column for grouping to the <code>ASPStateTempApplications</code> table. This <em>kind of</em> worked, but only if both of my sites were open in the same browser (using tabs). I need to be able to open Site1 in IE, save a value to my session variable, close the browser, open Site2 in Chrome, and read the value. From everything I've read with SQL Server Session State... this should be possible.</p>\n\n<p><strong>UPDATE 4 - SOLUTION:</strong></p>\n\n<p>I followed the answer on <strong><a href=\"http://stackoverflow.com/questions/2868316/sharing-sessions-across-applications-using-the-asp-net-session-state-service/3151315#3151315\">this article</a></strong> provided by @SilverNinja. I re-created the <code>ASPState</code> database via the command prompt (to undo my SP changes in Update #3) and then modified the <code>TempGetAppID</code> SP as per the answer from the link. I've also updated both of my Web.config files to match the answer from that article as well:</p>\n\n<pre><code>&lt;sessionState mode=\"SQLServer\"\n              sqlConnectionString=\"Data Source=.\\sqlexpress;User ID=myUsername;Password=myPassword;Application Name=CacheTest\"/&gt;\n</code></pre>\n\n<p>I've also included identical Machine Keys in both Web.config files:</p>\n\n<pre><code>&lt;machineKey validationKey=\"59C42C5AB0988049AB0555E3F2128061AE9B75E3A522F25B34A21A46B51F188A5C0C1C74F918DFB44C33406B6E874A54167DFA06AC3BE1C3FEE8506E710015DB\" decryptionKey=\"3C98C7E33D6BC8A8C4B7D966F42F2818D33AAB84A81C594AF8F4A533ADB23B97\" validation=\"SHA1\" decryption=\"AES\" /&gt;\n</code></pre>\n\n<p>Now I am able to (using IE) open up both of my sites, set a value from Site1, and read it from Site2 (and vice versa). When I check the table, only one SessionID exists (both sites are using the same session correctly). I was wrong in my thinking before that opening a new browser (for example, with Chrome), would use the same session - a new browser will start it's own session. On a load-balanced scenario though, this shouldn't cause any issues.</p>\n"},{"tags":["sql-server","vb.net","insert","sql-update"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13178360,"title":"SQL Server command in vb.net not working cause all in one sentence","body":"<p>This is propably a very easy question.</p>\n\n<p>But i cant fix it.\nI try an update if @ID = column id, else insert all.</p>\n\n<p>Only this one doesn't work if i put it all in one sentence</p>\n\n<pre><code>Cmd.CommandText = \"UPDATE Locatie SET (Longitude = @Longitude, Latitude = @Latitude, Timestamp = @Timestamp) WHERE ID=@ID IF @@ROWCOUNT=0 INSERT INTO Locatie VALUES (@ID, @Longitude, @Latitude, @Timestamp)\"\n</code></pre>\n"},{"tags":["sql-server","stored-procedures","insert","record","insert-update"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13178962,"title":"How to insert some record in Sql?","body":"<p>i'm want insert some record in sql server. i try query but insert all record and value duplicate.</p>\n\n<p><strong>i need don't duplicate value and insert some record.</strong></p>\n\n<p><strong>Table filesTA</strong></p>\n\n<pre><code>runNo   cDate           cIn         cOut    \n00001   2012-10-09 00:00:00.000 2012-10-09 07:21:00.000 2012-10-09 20:34:00.000 \n00005   2012-10-09 00:00:00.000 2012-10-09 07:36:00.000 2012-10-09 17:04:00.000 \n00006   2012-10-09 00:00:00.000 2012-10-09 07:55:00.000 2012-10-09 20:34:00.000 \n00007   2012-10-09 00:00:00.000 2012-10-09 07:50:00.000 2012-10-09 00:00:00.000 \n00008   2012-10-09 00:00:00.000 2012-10-09 07:56:00.000 2012-10-09 20:35:00.000 \n00009   2012-10-09 00:00:00.000 2012-10-09 07:57:00.000 2012-10-09 20:32:00.000 \n00010   2012-10-09 00:00:00.000 2012-10-09 07:58:00.000 2012-10-09 19:03:00.000\n</code></pre>\n\n<p><strong>this code Stored Procedure</strong></p>\n\n<pre><code>SELECT \n     em.empNo,\n     ISNULL(tf.cDate, '2012-10-09'),\n     tf.cIn,tf.cOut\nFROM \n     filesTA tf Full Outer join \n     Emp em On tf.runNo = em.empNo AND tf.cDate = '2012-10-09'\n</code></pre>\n\n<p><strong>result from code Stored Procedure (On Datagridview display)</strong></p>\n\n<pre><code>empNo   cDate           cIn         cOut\n00001   2012-10-09 00:00:00.000 2012-10-09 07:21:00.000 2012-10-09 20:34:00.000\n00002   2012-10-09 00:00:00.000 NULL                    NULL\n00003   2012-10-09 00:00:00.000 NULL                    NULL\n00004   2012-10-09 00:00:00.000 NULL                    NULL\n00005   2012-10-09 00:00:00.000 2012-10-09 07:36:00.000 2012-10-09 17:04:00.000\n00006   2012-10-09 00:00:00.000 2012-10-09 07:55:00.000 2012-10-09 20:34:00.000\n00007   2012-10-09 00:00:00.000 2012-10-09 07:50:00.000 2012-10-09 00:00:00.000\n00008   2012-10-09 00:00:00.000 2012-10-09 07:56:00.000 2012-10-09 20:35:00.000\n00009   2012-10-09 00:00:00.000 2012-10-09 07:57:00.000 2012-10-09 20:32:00.000\n00010   2012-10-09 00:00:00.000 2012-10-09 07:58:00.000 2012-10-09 19:03:00.000\n</code></pre>\n\n<p>result from code Stored Procedure. it's not insert to sql. But show display on datagridview.</p>\n\n<p>next Step. i need insert record '00002','00003','00003' <strong>or cIn and cOut = null</strong>\nbut i try insert that's all record and duplicate value.</p>\n\n<p><strong>this code new.</strong></p>\n\n<pre><code>    Insert INTO \n    filesTA (runNo,cDate,cIn,cOut)\n    VALUES \n   (SELECT \n        em.empNo,\n        ISNULL(tf.cDate, '2012-10-09'),\n        tf.cIn,tf.cOut\n    FROM \n        filesTA tf Full Outer join Emp em \n        On tf.runNo = em.empNo AND tf.cDate = '2012-10-09')\n</code></pre>\n\n<p>i need result from code Stored Procedure (On Datagridview display)</p>\n\n<p>Thanks you for your time. :)</p>\n"},{"tags":["sql-server","sql-server-2008-r2","mediawiki"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13177979,"title":"Is there any info about using MS SQL Server with MediaWiki?","body":"<p>I wonder if it possible to use mediawiki 1.18 with MS SQL server(particullary, MS SQL server 2008 r2), and, if possible, where to find some info about them working together. I know that mysql is much better solution, but our client insist on oracle DB or MS SQL. And i'd prefer MS SQL because i nether worked with oracle db and we still would have to buy it. Can somebody give me any help?<br/>\nCurrent version of my mediawiki is 1.18</p>\n"},{"tags":["sql-server","management-studio"],"answer_count":8,"favorite_count":2,"up_vote_count":12,"down_vote_count":0,"view_count":10798,"score":12,"question_id":651535,"title":"Management Studio default file save location","body":"<p>Open a new query window.  Write some SQL.  Save the script, the Save File As\ndialog box opens - but always to the same default location in the Profiles\ndirectory.  Is there any way to set my default file location?  ...Like I used\nto do with apps from the 1980s?</p>\n\n<p>Under Tools|Options a default location can be specified for query results.\nI need the same thing for new queries (the text editor).  Tried changing\nlocations in the Registry but SSMS just overwrote my changes.  Any\nsuggestions?</p>\n\n<p>(I saw this unanswered question at <a href=\"http://www.eggheadcafe.com/software/aspnet/30098335/management-studio-default.aspx\" rel=\"nofollow\">http://www.eggheadcafe.com/software/aspnet/30098335/management-studio-default.aspx</a>\n and I had same exact question so I just reposted it here)</p>\n"},{"tags":["c#","sql-server","design-patterns"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":13160219,"title":"What design pattern can be applied to build an object that requires data from two datareaders?","body":"<p>I'm a novice programmer interested in learning about \"Design Patterns\".  I've read a lot of information regarding design patterns from multiple sites but most utilize very basic applications of a particular pattern.</p>\n\n<p>My goal is to compose an object that has data from multiple tables. I'm using the repository pattern to extract the required data from one table in my db.  But I also need additional data from a second table. (Using Joins in my opinion would complicate this unnecessarily) This is where I'm not sure what to do next.  Would the Factory Patterns be best? Etc...</p>\n\n<p>For the most part at least some guidance as to how to do this would be helpful and not necessarily actual \"code\".</p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":54,"score":4,"question_id":13177765,"title":"Regarding get automatic columns in sql`","body":"<p>I have basically 50 fields in a table and I want to select this fields from table on a regular basis.</p>\n\n<p><strong>Problem is</strong>: I have to write all this 50 fields manually.</p>\n\n<p>Is there any shortcut in intellisence or any other tool where I can get all fields. automatically by pressing tool.</p>\n\n<p>Also guys if anyone knows here extra addons on sql..then please post it here.</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1045,"score":1,"question_id":9877920,"title":"SQL Server 2008 - date format issue while inserting","body":"<p>I am trying to insert date into a table but the date and format of inserted date is messed up. The datatype in the table is <code>Date</code>. My insert script is as below.</p>\n\n<pre><code>insert into Trans(ID, TDate, Description)\nvalues(1, CONVERT(datetime, 25-02-2012, 101), 'Opening')\n</code></pre>\n\n<p>I am trying to insert in <code>dd/MM/yyyy</code> format and I want it in the same format in my table. But in my table the date is <code>1894-07-22</code> !!</p>\n\n<p>I want the date to be inserted exactly as the format I wish and I want to see the inserted date as <code>25-02-2012</code> in the table.</p>\n\n<p>What is wrong here ? Can somebody help ?</p>\n"},{"tags":["sql-server","sql-server-2008","powershell","powershell-v2.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13152809,"title":"Invoke-SqlCmd QueryTimeout","body":"<p>Does anyone know how to set Invoke-SqlCmd QueryTimeout more than 65535? </p>\n\n<p>Microsoft said that they have fixed it in Denali but we are still using SQL 2008 R2 with latest service packs.</p>\n\n<p><a href=\"http://connect.microsoft.com/SQLServer/feedback/details/551799/invoke-sqlcmd-querytimeout-0-still-times-out\" rel=\"nofollow\">http://connect.microsoft.com/SQLServer/feedback/details/551799/invoke-sqlcmd-querytimeout-0-still-times-out</a></p>\n\n<p>Basically, we are trying to backup or restore the database using powershell. Some of our databases are very large so it takes more than 65535 to complete the job. </p>\n\n<p>Some suggested that we should use ADO.NET with timeout in powershell. But I wonder if we have any workaround for Invoke-SqlCmd...</p>\n"},{"tags":["sql","sql-server","pivot"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":13177591,"title":"Select matching rows as columns","body":"<p>I think it would be quickest to show by example, so here goes a simplified version of my problem. I am using SQL Server.</p>\n\n<p>This is the data model</p>\n\n<pre><code>SURVEY       QUESTION        ANSWER\n------       --------        -------\nsurveyId     questionId      answerId\n             questionText    surveyId\n                             questionId\n                             answerText\n</code></pre>\n\n<p>Here's some sample data</p>\n\n<pre><code>SURVEY          QUESTION\n ----------      ------------ --------------\n| surveyId |    | questionId | questionText |\n ----------      ------------ --------------\n| 1        |    | 1          | Name         |\n| 2        |    | 2          | E-Mail       |\n ----------     | 3          | Address      |\n                | 4          | Phone        |\n                 ------------ --------------\nANSWER\n -----------------------------------------------\n| answerId | surveyId | questionId | answerText |\n -----------------------------------------------\n| 1        | 1        | 1          | John       |\n| 2        | 1        | 2          | john@aa.bb |\n| 3        | 1        | 3          | New York   |\n| 4        | 1        | 4          | 1112223344 |\n| 5        | 2        | 1          | Pete       |\n| 6        | 2        | 2          | pete@cc.dd |\n| 7        | 2        | 3          | Boston     |\n| 8        | 2        | 4          | 5556667788 |\n -----------------------------------------------\n</code></pre>\n\n<p>Finally, here's what I'd like to select</p>\n\n<pre><code>RESULT\n ------------------------------\n| surveyId | name | email      |\n ------------------------------\n| 1        | John | john@aa.bb |\n| 2        | Pete | pete@dd.cc |\n ------------------------------\n</code></pre>\n\n<p>I'd like to be able to specify at run time which columns I need in my final table. Right now I can get this result by doing the following</p>\n\n<pre><code>SELECT rName.surveyId, rName.requestor, rEmail.email \nFROM (SELECT a.answerText AS name, a.surveyId\n      FROM answer a INNER JOIN question q ON a.questionId = q.questionId \n      WHERE a.surveyId = @surveyId AND q.questionText = 'Name') AS rName\nINNER JOIN \n     (SELECT a.answerText AS name, a.surveyId\n      FROM answer a INNER JOIN question q ON a.questionId = q.questionId \n      WHERE a.surveyId = @surveyId AND q.questionText = 'E-Mail') AS rEmail\nON rName.questionnaireId = rEmail.questionnaireId\n</code></pre>\n\n<p>As you can see, it's ugly, and contains duplicate code. Is there a way to do this cleaner? </p>\n"},{"tags":["sql","sql-server","query","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13177901,"title":"How to find if a date is from a Odd or Even week?","body":"<p>In my table I have for each day:</p>\n\n<pre><code>Id_______Startdate _______ EndDate __________MondayMorning _____MondayEvening ___TuMorning  ....  \n121 _____2012-01-01________2012-12-31 ________2 ___________________2______________2   \n122 _____2012-02-01________2012-08-05 ________1 ___________________2______________3   \n</code></pre>\n\n<p>I already generated a list of dates using the Startdate and EndDate. </p>\n\n<p>I want to know if this dates belongs to a odd week or a even week so that I can filter days from my output that have number 3 Or 1 (see second record).</p>\n\n<p>how can I filter the days that belongs to  odd weeks and even weeks that have number 1 and 3?</p>\n"},{"tags":["sql-server","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13177143,"title":"Is SSIS the way to achieve this functionality?","body":"<p>I have a manual process that needs to be automated. Below are the steps outlined. Is SSIS the correct way to achieve all the below mentioned steps? Especially the result to CSV, zip and email steps? Can this be done using inbuilt sql server scheduler?</p>\n\n<ol>\n<li><p>Connect to SQL Server: DARVIN,51401</p></li>\n<li><p>Open SQL Query:  o:\\Status Report.sql</p></li>\n<li><p>Chose database: AdventureWorks </p></li>\n<li><p>In the menu bar above choose Tools, then Options.</p></li>\n<li><p>When the pop-up appears, choose the tab named Results and choose Results output format of Comma Delimited (CSV).  Clikd the Apply then the OK button. </p></li>\n<li><p>Execute the query</p></li>\n<li><p>Instruct where to save the file, You can save these in O:\\Reports       File name format is: day^_^Report TSP MM-DD-YY </p></li>\n<li><p>Let the query run 15-25 minutes. </p></li>\n<li><p>When the query is complete, open the folder that you save the report in, right click on the report title and compress to a zip file. (right click, Send To Compressed (zipped) Folder) When this has been completed.</p></li>\n<li><p>Copy the saved file and put into: O:\\zippedFiles\\</p></li>\n<li><p>Email:  support@adventureworks.com to let them know that you \nhave placed a zip file at: O:\\zippedFiles\\</p></li>\n</ol>\n"},{"tags":["php","sql","sql-server","codeigniter"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13176624,"title":"SQL Comment in CodeIgniter Active Record?","body":"<p>I'm moving a project to CodeIgniter and want to take advantage of Active Record.  However, I haven't found a way to append a SQL comment to the queries.  In the existing code the query looks something like this:</p>\n\n<pre><code>UPDATE table\nSET column = 'value'\nWHERE  ID = passed value;\n-- Transacted by ' .$_SESSION['Name']\n</code></pre>\n\n<p>I've search Google and SO and not found the answer to how to add that last \"Transacted by\" comment without coding the whole thing directly and using <code>$this-&gt;db-&gt;query('.....')</code></p>\n"},{"tags":["sql","sql-server","query"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13176788,"title":"ms sql 2005 can't compare dates","body":"<p>I have a huge database in ms sql. I have a date stored into a field of type: <code>VARCHAR2</code>\nI have the code, but it can't compare dates. What I mean? There is an input with a launch date. What I need is to get the launchdate inputs where the launchdate is bigger than a date and smaller than another. The problem is that when I change the year from 2012 to 2013 there are no results. Also when I have dates with 0 (like 01.01.2012) it can't compire them.</p>\n\n<p>What I have so far is:</p>\n\n<pre><code>edited\n</code></pre>\n\n<p>Can someone help me to get the correct results?</p>\n\n<p><strong>EDIT1</strong></p>\n\n<p>The date is stored as string in this format: yyyy-mm-dd</p>\n"},{"tags":["c#","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13177096,"title":"how to convert dictionary into object and save via sql database","body":"<p>In c# language using dictionary to store and that dictionary converted to object at finally that object stored to SQL server.. </p>\n"},{"tags":["sql","sql-server","tsql","variables","select"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":69,"score":-2,"question_id":13165594,"title":"In SQL Server, is there a way to get a single value from an identity column and repeatedly use it in the same scope?","body":"<p>It's kind of hard to word the question in the title.  Let's say you have a table called Users, and let's say it has an identity / primary key column called \"Id\".  Let's say you want to, in the same transaction, get what you know will only be one instance of Id that falls within a fairly specific WHERE clause or something, then recycle it repeatedly in a very lengthy SELECT statement that's executed immediately afterwards.  Can this be done in SQL Server?  Basically what I'm trying to avoid is something like the following:</p>\n\n<pre><code>Dim id As Int32 = DBA.OneTimeQuery(\"SELECT Id FROM users &lt;where clause&gt;\").Rows(0)(0)\nReturn DBA.OneTimeQuery(\"SELECT &lt;a lot of different things, involving multiple sub\n    -selects that have to pull from the variable id&gt;\")\n'DBA.OneTimeQuery returns a DataTable\n</code></pre>\n\n<p>I know I can avoid using two different connections or whatever by recycling the first where clause, but it's pretty wasteful to have even the same connection and transaction keep re-finding the same exact piece of information.</p>\n\n<p>I want to avoid having Sql Server search for that single value from the Id column more than once, and I also want to be able to put it in the same Sql transaction and connection.  How can this be done?  Thanks!</p>\n"},{"tags":["sql-server","database","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13174627,"title":"Searching some text from SQL-Server DB","body":"<p>This Query can search any string value (table name, table data etc) from all the tables/views of any SQL-Server DB, when you will place any string at \"<strong>your text here</strong>\" it will search your given string from all the tables/views exist in that DB,    </p>\n\n<pre><code>DECLARE @SearchStr nvarchar(100) \n    SET @SearchStr = 'your text here'\n\nDECLARE @Results TABLE(ColumnName nvarchar(370), ColumnValue nvarchar(3630))\n\nSET NOCOUNT ON\n\nDECLARE @TableName nvarchar(256), @ColumnName nvarchar(128), @SearchStr2 nvarchar(110)\nSET  @TableName = ''\nSET @SearchStr2 = QUOTENAME('%' + @SearchStr + '%','''')\n\nWHILE @TableName IS NOT NULL\nBEGIN\n    SET @ColumnName = ''\n    SET @TableName = \n    (\n        SELECT MIN(QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME))\n        FROM    INFORMATION_SCHEMA.TABLES\n        WHERE       TABLE_TYPE = 'BASE TABLE'\n            AND QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME) &gt; @TableName\n            AND OBJECTPROPERTY(\n                    OBJECT_ID(\n                        QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME)\n                         ), 'IsMSShipped'\n                           ) = 0\n    )\n\n    WHILE (@TableName IS NOT NULL) AND (@ColumnName IS NOT NULL)\n    BEGIN\n        SET @ColumnName =\n        (\n            SELECT MIN(QUOTENAME(COLUMN_NAME))\n            FROM    INFORMATION_SCHEMA.COLUMNS\n            WHERE       TABLE_SCHEMA    = PARSENAME(@TableName, 2)\n                AND TABLE_NAME  = PARSENAME(@TableName, 1)\n                AND DATA_TYPE IN ('char', 'varchar', 'nchar', 'nvarchar')\n                AND QUOTENAME(COLUMN_NAME) &gt; @ColumnName\n        )\n\n        IF @ColumnName IS NOT NULL\n        BEGIN\n            INSERT INTO @Results\n            EXEC\n            (\n                'SELECT ''' + @TableName + '.' + @ColumnName + ''', LEFT(' + @ColumnName + ', 3630) \n                FROM ' + @TableName + ' (NOLOCK) ' +\n                ' WHERE ' + @ColumnName + ' LIKE ' + @SearchStr2\n            )\n        END\n    END \nEND\n\nSELECT ColumnName, ColumnValue FROM @Results\n</code></pre>\n\n<p><strong>But i like to search</strong> given string in the <code>procedures/functions/triggers</code> as well is there any query exist for SQL server 2005. As this query does not search in these areas.</p>\n"},{"tags":["sql","sql-server","like-operator"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":13175861,"title":"Same LIKE condition applied to many columns","body":"<p>I have an SQL query that joins few tables and I want to filter records using same LIKE condition for many columns of result set. \nFor example, I have columns t1.Name, t1.FullName, t1.Comment, t2.Name, t3.Description, etc in my query (t1, t2 and t3 are joined tables names) and I want to check whether t1.Name or t1.FullName or t1.Comment or t2.Name or t3.Description is LIKE '%sometext%'.\nI'm just interested what SQL will be faster?</p>\n\n<pre><code>WHERE t1.FullName LIKE '%sometext%' OR t1.Comment LIKE '%sometext%' OR\n      t2.Name LIKE '%sometext%' OR t3.Description  LIKE '%sometext%'\n</code></pre>\n\n<p>or </p>\n\n<pre><code>WHERE ISNULL(t1.Name,'') + '|' + ISNULL(t1.FullName,'') + '|' + ISNULL(t1.Comment,'') + '|' + ISNULL(t2.Name,'') + '|' + ISNULL(t3.Description,'') LIKE '%sometext%'\n</code></pre>\n\n<p>Or may be there is some even faster way?\nI'm using MS SQL Server 2008 R2.</p>\n\n<p><strong>UPD:</strong> I've edited my second query to handle situations when some fields are NULL and when concatenation may contain pattern but fields separately don't.</p>\n"},{"tags":["c#","asp.net",".net","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":13175784,"title":"Transfer data from Excel sheet into SQL Server database","body":"<p>I have an Excel sheet that contains some data. I want to store that data into a SQL Server  database from that aspx page.</p>\n\n<p>I am trying to store data but get error as below:</p>\n\n<blockquote>\n  <p><em>The Microsoft Office Access database engine cannot open or write to the file.\n  It is already opened exclusively by another user, or you need permission to view and write its data.</em></p>\n</blockquote>\n\n<p>This is my code:</p>\n\n<pre><code>string excelConnectionString = @\"provider=Microsoft.ACE.OLEDB.12.0;data source=\" + path + \";extended properties='Excel 12.0;HDR=YES;'\";\n\n//Create Connection to Excel work book\nOleDbConnection excelConnection =new OleDbConnection(excelConnectionString);\n//Create OleDbCommand to fetch data from Excel\nOleDbCommand cmd = new OleDbCommand(\"Select [ID],[Name],[Designation] from [Sheet1$]\",excelConnection);\nexcelConnection.Open();\nOleDbDataReader dReader;\ndReader = cmd.ExecuteReader();\nSqlBulkCopy sqlBulk = new SqlBulkCopy(strConnection);\n//Give your Destination table name\nsqlBulk.DestinationTableName = \"Excel_table\";\nsqlBulk.WriteToServer(dReader);\nexcelConnection.Close();\n</code></pre>\n\n<p>and thanks in advance ...</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":13175703,"title":"SQL : How to Delete Rows; when defending WHERE from another table with Multiply Returns","body":"<h2>Query</h2>\n\n<pre><code>    DELETE FROM TEMPSchedules \n           WHERE StudentID = ( Select StudentID \n                               From Students \n                               Where Ref = 'H1007')\n</code></pre>\n\n<h2>Error Message</h2>\n\n<blockquote>\n  <p>Subquery returned more than 1 value. This is not permitted when the\n  subquery follows =, !=, &lt;, &lt;= , >, >= or when the subquery is used as\n  an expression.</p>\n</blockquote>\n\n<h2>Problem</h2>\n\n<p>Now the problem is that each Ref Group has more than 1 Student attached to it. So how should I deal with this.\nThanks</p>\n"},{"tags":["sql","sql-server","recursion","performance"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1467,"score":1,"question_id":1224623,"title":"WITH Common Table Expression vs. CREATE VIEW performance","body":"<p>I have several queries that use a WITH clause, or Common Table Expression, with a UNION ALL statement to recur through a table with a tree like structure in SQL server as described <a href=\"http://www.webinade.com/web-development/creating-recursive-sql-calls-for-tables-with-parent-child-relationships\" rel=\"nofollow\">here</a>.  Would I see a difference in performance if I were to CREATE that same VIEW instead of including it with the WITH clause and having it generated every time I run the query?  Would it generally be considered good practice to actually CREATE the view since it is used in several queries?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":13173372,"title":"How to select one record at a time without using cursor?","body":"<p>I have two tables in SQL SERVER.</p>\n\n<p>DBO.VitalPatientDetails=></p>\n\n<p>| PatientDetailsId | PatientId | PatientName | UnitName | BedName | PatientDOB | LastAlarmReceivedAt |</p>\n\n<p>DBO.VitalAlarmDetails=></p>\n\n<p>| Id | PatientDetailsId (Refers VitalPatientDetails.PatientDetailsId) | VitalGenerationTime | FileName | </p>\n\n<p>I need to retrive all fields of DBO.VitalAlarmDetails grouped by PatientDetailsId ordered by VitalGenerationTime in ascending order.\nI have written cursor for this as below and it is returning multiple result sets. I need to get it in single set without using cursor. I just want to know whether I can do this without cursor.</p>\n\n<pre><code>DECLARE @PatientDetailsId BIGINT\nDECLARE @getAlarmDetails CURSOR\n\nSET @getAlarmDetails = CURSOR FOR SELECT PatientDetailsId FROM VitalPatientDetails\n\nOPEN @getAlarmDetails\n    FETCH NEXT FROM @getAlarmDetails INTO @PatientDetailsId\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        SELECT * FROM VitalAlarmDetails\n        WHERE PatientDetailsId = @PatientDetailsId\n        ORDER BY VitalGenerationTime ASC\n\n        FETCH NEXT FROM @getAlarmDetails INTO @PatientDetailsId\n    END\nCLOSE @getAlarmDetails\nDEALLOCATE @getAlarmDetails\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","command-line","installation"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3437,"score":1,"question_id":696846,"title":"sql server 2005 command line install error ADD_LOCAL property already installed","body":"<p>I have a silent installation of SQL Server 2005 that works great when installing SQL Server on a machine that does not have it already installed.  I use the following parameters when I perform the installation:</p>\n\n<pre><code>#define SQL_SILENT                    \"/passive /qb\"\n#define SQL_USERNAME                  \"username=MyUserName\"\n#define SQL_COMPANYNAME               \"companyname=MyCompanyName\"\n#define SQL_ADDLOCAL                  \"ADDLOCAL=SQL_Engine\"\n#define SQL_UPGRADE                   \"\"\n#define SQL_DISABLENETWORKPROTOCOLS   \"disablenetworkprotocols=0\"\n#define SQL_INSTANCENAME              \"instancename=MYSQLINSTANCE\"\n#define SQL_SQLAUTOSTART              \"SQLAUTOSTART=1\"\n#define SQL_SECURITYMODE              \"SECURITYMODE=SQL\"\n#define SQL_SAPWD                     \"SAPWD=StrongPassword\"\n#define SQL_SQLACCOUNT                \"SQLACCOUNT=\"\"\"\"\"\n#define SQL_SQLPASSWORD               \"SQLPASSWORD=\"\"\"\"\"\n</code></pre>\n\n<p>It installs the instance of SQL Server Express without a problem.  However, when I attempt to install SQL Server on a machine that already has another instance with components I get the following error:</p>\n\n<p>*\"A component that you have specified in the ADD_LOCAL property is already installed.  To upgrade the existing component, refer to the template.ini and set the UPGRADE property to the name of the component.\"*</p>\n\n<p>I have also tried using the UPGRADE method as per the error message </p>\n\n<pre><code>#define SQL_UPGRADE       \"UPGRADE=SQL_Engine INSTANCENAME=MYSQLINSTANCE\"\n</code></pre>\n\n<p>but get the following error:</p>\n\n<p><em>\"SQL Server Setup cannot perform the upgrade because the component is not installed on the computer.  To proceed, verify the component to be upgraded in currently installed, and that the component to be upgraded is specified in the ADDLOCAL property.\"</em></p>\n\n<p>Does anyone have any suggestions?</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server","sql-server-2008","sql-management-studio"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13175025,"title":"Closing Management Studio Query - Sleeping Process","body":"<p>When I close a query (after running it) in Management Studio SQL2008 R2, the processes remain as \"sleeping\", \"AWAITING COMMAND\". I have to manually kill them to get exclusive access. This is on my dev machine. Any idea why closing the window isn't closing the connection?</p>\n"},{"tags":["c#","sql-server","stored-procedures","guid","optional-parameters"],"answer_count":6,"favorite_count":1,"up_vote_count":9,"down_vote_count":0,"view_count":224,"score":9,"question_id":12585675,"title":"How to declare a nullable guid as an optional parameter for a C# CLR stored procedure with SQL Server","body":"<p>I'm writing a C# stored procedure which is deployed on SQL Server 2008 R2 (so .Net 3.5) and want to declare an optional parameter as a nullable guid.  Here's what I tried first:</p>\n\n<pre><code>[Microsoft.SqlServer.Server.SqlProcedure]\npublic static void spCalcPerc(\n     SqlGuid pID\n    , SqlGuid sID = DBNull.Value\n    )\n</code></pre>\n\n<p>This failed with the compile time error: </p>\n\n<blockquote>\n  <p><em>Default parameter value for 'sID' must be a compile-time constant</em></p>\n</blockquote>\n\n<p>which is because <code>DBNull.Value</code> is not a constant, which is a pain.</p>\n\n<p>So I tried changing the declaration to:</p>\n\n<pre><code>[Microsoft.SqlServer.Server.SqlProcedure]\npublic static void spCalcPerc(\n     SqlGuid pID\n    , Guid? sID = null\n    )\n</code></pre>\n\n<p>This compiles but now I get this deployment error: </p>\n\n<blockquote>\n  <p><em>Deploy error : Could not create a type for parameter System.Nullable</em></p>\n</blockquote>\n\n<p>Trying:</p>\n\n<pre><code>, SqlGuid sID = null\n</code></pre>\n\n<p>Gives this compile time error: </p>\n\n<blockquote>\n  <p><em>A value of type '&lt; null >' cannot be used as a default parameter because there are no standard conversions to type\n  'System.Data.SqlTypes.SqlGuid'</em></p>\n</blockquote>\n\n<p>So feeling rather stuck I resorted to this:</p>\n\n<pre><code>, SqlGuid sID = \"00000000-0000-0000-0000-000000000000\"\n</code></pre>\n\n<p>Which I didn't want to do as testing for that string in the code feels like a kludge.  However that doesn't work either as I get this compile error: </p>\n\n<blockquote>\n  <p><em>A value of type 'string' cannot be used as a default parameter because there are no standard conversions to type 'System.Guid'</em></p>\n</blockquote>\n\n<p>Gah, 4 different approaches and none of them work.  <em>sigh</em></p>\n\n<p>Would appreciate your thoughts or a push in the right direction please.  </p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":11938,"score":5,"question_id":5856073,"title":"for each in MS SQL SERVER?","body":"<p>I have two tables:</p>\n\n<p><code>Employees(EmployeeID, EmployeeName, EmployeeStatus, BasicSalary)</code> and </p>\n\n<p><code>EmployeePayroll (PayrollID, EmployeeID, VoucherNo, BasicSalary, SalaryMonth)</code></p>\n\n<p>I want to make a <code>for each</code> loop for every employee in the first table so that I can insert dummy data like <code>(0, EmployeeID,0 ,0 ,0)</code> into the second table.</p>\n\n<p>I tried to make it with a <code>for</code> loop but I could not make it, so is there a <code>for each</code> loop in MS SQL Server??</p>\n"},{"tags":["sql","sql-server","ssis","lookup","data-warehouse"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":88,"score":5,"question_id":13169613,"title":"SQL/SSIS DataWareHouse Fact table loading, best practices?","body":"<p>I am building my first datawarehouse in SQL 2008/SSIS and I am looking for some best practices around loading the fact tables.</p>\n\n<p>Currently in my DW I have about 20 Dimensions (Offices, Employees, Products, Customer, etc.) that are of Type 1 SCD. In my dw structure, there are a few things I have already applied:</p>\n\n<ul>\n<li>No Nulls (replaced with blank for text or 0 for numeric during staging)</li>\n<li>unknown key members populated in each dimension (SK ID 0)</li>\n<li>UPSERT for SCD Type 1 loading from stage to production table</li>\n<li>SELECT DISTINCT for my loading of dimensions</li>\n</ul>\n\n<p>In my Fact loading SSIS project, the current method I have for loading dimensions is having multiple lookups (20+) to each of the DIMs, then populating the FACT table with the data.</p>\n\n<p>For my lookups I set:</p>\n\n<ul>\n<li>Full Cache</li>\n<li>Ignore Failures for \"no matching entries\"</li>\n<li>Derived Transformation with \"ISNULL(surrogate_idkey) ? 0 : surrogate_idkey\" for each SK so that if lookups fail they will default to the SK ID 0 (unknown member).</li>\n<li>Some of my dimension lookups have more than one business key</li>\n</ul>\n\n<p>Is this the best approach? Pictures attached to help with my description above.</p>\n\n<p><img src=\"http://i.stack.imgur.com/6NHSQ.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/JWjyc.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/3QQ71.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","search","full-text-search"],"answer_count":5,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":1331,"score":6,"question_id":17056,"title":"SQL Server Full Text Searching","body":"<p>I'm currently working on an application where we have a SQL-Server database and I need to get a full text search working that allows us to search people's names.</p>\n\n<p>Currently the user can enter a into a name field that searches 3 different varchar cols. First, Last, Middle names</p>\n\n<p>So say I have 3 rows with the following info.</p>\n\n<p>1 - Phillip - J - Fry</p>\n\n<p>2 - Amy - NULL - Wong</p>\n\n<p>3 - Leo - NULL - Wong</p>\n\n<p>If the user enters a name such as 'Fry' it will return row 1. However if they enter Phillip Fry, or Fr, or Phil they get nothing.. and I don't understand why its doing this. If they search for Wong they get rows 2 and 3 if they search for Amy Wong they again get nothing.</p>\n\n<p>Currently the query is using CONTAINSTABLE but I have switched that with FREETEXTTABLE, CONTAINS, and FREETEXT without any noticeable differences in the results. The table methods are be preferred because they return the same results but with ranking.</p>\n\n<p>Here is the query.</p>\n\n<pre><code>....\n@Name nvarchar(100),\n....\n--\"\"s added to prevent crash if searching on more then one word.\nDECLARE @SearchString varchar(100)\nSET @SearchString = '\"'+@Name+'\"'\nSELECT Per.Lastname, Per.Firstname, Per.MiddleName\nFROM Person as Per\nINNER JOIN CONTAINSTABLE(Person, (LastName, Firstname, MiddleName), @SearchString) \nAS KEYTBL\nON Per.Person_ID = KEYTBL.[KEY]\nWHERE KEY_TBL.RANK &gt; 2\nORDER BY KEYTBL.RANK DESC;  \n....\n</code></pre>\n\n<p>Any Ideas...? Why this full text search is not working correctly ?</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":163,"score":0,"question_id":11077162,"title":"SQL Server stored procedure avoid cursor","body":"<p>I have the following SQL Server stored procedure :</p>\n\n<pre><code>BEGIN TRAN\nCREATE TABLE #TempTable (\n                            SampleOrderID int,\n                            SampleOrderNo varchar(512),\n                            ChallanNoAndChallanDate varchar(MAX)\n                        )\nCREATE NONCLUSTERED INDEX #IX_Temp2_1 ON #TempTable(SampleOrderID)\n\nDECLARE \n@SQL as varchar(MAX)\nSET @SQL='      SELECT  SampleOrderID,  SampleOrderNo FROM SampleOrder WHERE SampleOrderID IN (37808,37805,37767,37571,37745,37772,37843,37394,37909,37905,37903) '\nINSERT INTO #TempTable  (SampleOrderID, SampleOrderNo)\nEXEC (@SQL)\n\nDECLARE \n@SampleOrderID as int,\n@ChallanNoAndChallanDate as varchar(max)\n\nDECLARE Cur_AB1 CURSOR GLOBAL FORWARD_ONLY KEYSET FOR           \nSELECT  SampleOrderID FROM #TempTable\nOPEN Cur_AB1\nFETCH NEXT FROM Cur_AB1 INTO @SampleOrderID\nWHILE(@@Fetch_Status &lt;&gt; -1)\n    BEGIN--2\n        SET @ChallanNoAndChallanDate=''\n        SELECT @ChallanNoAndChallanDate= COALESCE(@ChallanNoAndChallanDate+ ',', '') + CONVERT(VARCHAR(12),ChallanDate,106)+':'+ChallanNo  FROM Challan WHERE OrderID =@SampleOrderID AND OrderType=2\n\n        UPDATE #TempTable SET ChallanNoAndChallanDate=@ChallanNoAndChallanDate WHERE SampleOrderID=@SampleOrderID   \n        FETCH NEXT FROM Cur_AB1 INTO @SampleOrderID\n    END--2\nCLOSE Cur_AB1\nDEALLOCATE Cur_AB1\n\nSELECT * FROM #TempTable\nDROP TABLE #TempTable\nCOMMIT TRAN \n</code></pre>\n\n<p>Output :</p>\n\n<pre><code>SamID       SamNo    ChallanNoAndDaet\n37394   37394   ,31 May 2012:151592\n37571   37571   ,31 May 2012:151580\n37745   37745   ,31 May 2012:151582\n37767   37767   ,30 May 2012:151507,31 May 2012:151576\n37772   37772   ,31 May 2012:151587\n37805   37805   ,31 May 2012:151574\n37808   37808   ,31 May 2012:151573\n37843   37843   ,31 May 2012:151588\n37903   37903   ,31 May 2012:151597\n37905   37905   ,31 May 2012:151596\n37909   37909   ,31 May 2012:151593\n</code></pre>\n\n<p>It works successfully for small volume of data but When i try to execute it on a Large volume (i.e. more then 500,000 record) my C# interface throws the time out exception.</p>\n\n<p>Can anyone help me edit my stored procedure to avoid the cursor? </p>\n\n<p>Thanks for response. </p>\n"},{"tags":["sql-server","entity-framework","entity-framework-4","nopcommerce"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":12057458,"title":"Is it possible to limit number of connections used by Entity Framework?","body":"<p>I've noticed that on a NopCommerce site we host (which uses Entity Framework) that if I run a crawler on the site (to check for broken links) it knocks the entire webserver offline for a few minutes and no other hosted sites respond. This seems to be because Entity Framework is opening 30-odd database connections and runs hundreds of queries per second (about 20-40 per page view).</p>\n\n<p>I cannot change how EF is used by NopCommerce (it would take weeks) or change the version of EF being used, so can I mitigate the effects it has on SQL Server by limiting how many concurrent connections it uses, to give other sites hosted on the same server a fairer chance at database access?</p>\n\n<p>What I'm ideally looking to do, is limit the number of concurrent DB connections to about 10, for a particular application.</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":76,"score":0,"question_id":13174129,"title":"sum function using subquery","body":"<p>I have three tables:</p>\n\n<p><strong>Customer</strong></p>\n\n<pre><code>customer_id   first_name\n1              kapil\n2              rajesh\n</code></pre>\n\n<p><strong>Account</strong></p>\n\n<pre><code>Customer_id     Account_id\n1                   S1\n2                   s2\n</code></pre>\n\n<p><strong>Receipt</strong></p>\n\n<pre><code>Recipt_id   customer_id   Account_id   Transaction_type   Amount\nR1            1              s1         Deposit           40000\nR2            2              s2         Deposit             300\nR3            1              s1         withdrawal         2000\n</code></pre>\n\n<p>now i am putting query as follow </p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>select   \n    c.customer_id,c.first_name,s.current_balance,s.account_id,\n    (select sum(amount) \n    from receipt as r ,\n        saving_account as s \n    where r.transaction_type='deposit'\n        and r.account_no = s.account_id\n    ) as debit,\n    (select sum(amount) \n    from receipt as r ,\n        saving_account as s\n    where r.transaction_type='withdrawl'\n        and r.account_no = s.account_id  \n    )as credit \nfrom customer as c \nleft outer join saving_account as s \ninner join receipt as r on r.customer_id = s.customer_id \non s.customer_id = c.customer_id \ngroup by c.customer_id\n</code></pre>\n\n<p>but it is giving me debit a single value for whole row and credit tooo\ni am not understanding why it is showing like that ....</p>\n\n<p>My desired result is:</p>\n\n<pre><code>customer_id customer_name account_id debit credit balance\n1           kapil         s1         40000   2000  200\n2           rajesh        s2         300     null  500\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13173615,"title":"Normalizing values in SQL query","body":"<p>I have an data table I wish to perform some numeric analysis on for that I need all the values to be in the same range. 0..1.</p>\n\n<p>I have a somewhat slow and longhanded way of accomplishing this but would like a more straigt forward performant solution to my problem</p>\n\n<p>What I need to do is:</p>\n\n<p>group by projectid\nwith in each project take the average of each of the values and divide by the largest average for the entire set.</p>\n\n<p>currently I have</p>\n\n<pre><code>select avg(foo * 1.0)/ (Select MAX(IL) FROM (select avg(foo * 1.0) as IL from table group by     \n                                             ProjectID) tbl)\nfrom table\n</code></pre>\n\n<p>so if the list is</p>\n\n<pre><code>projectid  | foo\n-----------------\n1          | 1\n1          | 2\n2          | 4\n2          | 2\n</code></pre>\n\n<p>the largest average is 3 and the result should therefor be</p>\n\n<p>0.5,1</p>\n\n<p>where the first is the average for projectId 1 divided by 3 and the second is the average for projectId 2 divided by 3</p>\n"},{"tags":["sql-server","sql-server-2008","unique-constraint"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":25,"score":2,"question_id":13173787,"title":"SQL Server : Unique constraint to verify that data does not exist in another table","body":"<p>Given that I have a table structure where I have a parent that can have \"Roles\" and that parent have children that can have the same \"Roles\", how can I create a constraint on the child table that verifies that the parent does not have the Role that is about to be inserted?</p>\n\n<p>Like this:</p>\n\n<pre><code>Parent\n |\n \\- ParentRoles\n |\n \\- Child\n    |\n    \\- ChildRoles\n</code></pre>\n\n<p>I want the union of the Child and Parent roles to be a list of unique roles (no duplicates).</p>\n\n<p>I have checked <a href=\"http://stackoverflow.com/questions/3200795/sql-server-check-constraint-on-a-column-where-values-come-from-another-table\">Constraint by UserFunction</a> (not recommended but would work) and tried creating a view with an unique index but ran into trouble because I have to use Union in the view and then I cannot index it.</p>\n\n<p>An answer on the <a href=\"http://stackoverflow.com/questions/3200795/sql-server-check-constraint-on-a-column-where-values-come-from-another-table\">Constraint by UserFunction</a> question suggests using Foreign Keys but I do not understand how I could make that work given my table structure.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":36,"score":4,"question_id":13173921,"title":"Why is T-SQL EXEC not returning decimals?","body":"<p>I have a simple query that I've turned into a stored proc:</p>\n\n<pre><code>create procedure GetAmount as\ndeclare @amnt decimal(25,2)\n\nselect @amnt=66666.67 \nset @amnt = @amnt/3.00\n\nprint @amnt\nreturn @amnt\n</code></pre>\n\n<p>If I print @amnt, it returns 22222.22</p>\n\n<p>But if I use EXEC and assign it to a variable:</p>\n\n<pre><code>declare @x numeric(25,2)\nexec @x=SP_GetAmount()\nprint @x\n</code></pre>\n\n<p>it returns 22222.00</p>\n\n<p>Anyone know why? </p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13169764,"title":"Trigger on Audit Table failing due to update conflict","body":"<p>I have a number of tables that get updated through my app which return a lot of data or are difficult to query for changes. To get around this problem, I have created a \"LastUpdated\" table with a single row and have a trigger on these complex tables which just sets GetDate() against the appropriate column in the LastUpdated table:</p>\n\n<pre><code>CREATE TRIGGER [dbo].[trg_ListItem_LastUpdated] ON [dbo].[tblListItem] \nFOR INSERT, UPDATE, DELETE \nAS\nUPDATE LastUpdated SET ListItems = GetDate()\nGO\n</code></pre>\n\n<p>This way, the clients only have to query this table for the last updated value and then can decided whether or not they need to refresh their data from the complex tables. The complex tables are using snapshot isolation to prevent dirty reads.</p>\n\n<p>In busy systems, around once a day we are getting errors writing or updating data in the complex tables due to update conflicts in \"LastUpdated\". Because this occurs in the statement executed by the trigger, the affected complex table fails to save data. The following error is logged:</p>\n\n<blockquote>\n  <p>Snapshot isolation transaction aborted due to update conflict. You\n  cannot use snapshot isolation to access table 'dbo.tblLastUpdated'\n  directly or indirectly in database 'devDB' to update, delete, or\n  insert the row that has been modified or deleted by another\n  transaction. Retry the transaction or change the isolation level for\n  the update/delete statement.</p>\n</blockquote>\n\n<p>What should I be doing here in the trigger to prevent this failure? Can I use some kind of query hints on the trigger to avoid this  - or can I just ignore errors in the trigger? Updating the data in LastUpdated is not critical, but saving the data correctly into the complex tables is.</p>\n\n<p>This is probably something very simple that I have overlooked or am not aware of. As always, thanks for any info.</p>\n"},{"tags":["sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":180,"score":1,"question_id":12213271,"title":"SQL query to find out third highest salary involving multiple tables","body":"<p>I have two tables..</p>\n\n<p>Persons:</p>\n\n<pre><code>empid(primary key)\nfirstname\nlastname\nemail\n</code></pre>\n\n<p>Details:</p>\n\n<pre><code>Did(primary key)\nsalary\ndesignation\nempid\n</code></pre>\n\n<p>Now I want to select <code>firstname</code>, <code>lastname</code>, <code>salary</code> of the employee with the 3rd highest salary. </p>\n\n<p>Also it would be great if you can suggest me a site where I can find SQL query exercises with solutions (I do not need an online interpreter, I have SQL Server 2008 to practice on ), I have completed w3schools (which was awesome) but I need exercises now, I tried sql.ex.ru but it was not that helpful. </p>\n"},{"tags":["sql","sql-server","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13173585,"title":"How to check if a field is updated when inserting from table to table?","body":"<p>I have the following data inserted from TableA to TableB. I'm inserting the data from TableA to TableB using a query that automatically runs every 4 hours. The query contains a insert, update and a delete.</p>\n\n<blockquote>\n  <p>Date_<strong><em>_</em>__<em>_</em>_</strong><em>Group  <strong></em>____</strong><em>State  <strong></em>___</strong><em>BeginTime  <strong></em>___</strong><em>EndTime<br>\n  2012-11-1 <strong></em>_</strong><em>A  <strong></em>__<em>_</em>__<em>_</em>__</strong><em>1     <strong></em>__<em>_</em>____</strong><em>08:00   <strong></em>__<em>_</em>___</strong>_16:00</p>\n</blockquote>\n\n<p>The application that uses TableB can also change the field State but I need to check if this is changed by the application. There is no any attribute how I can check this.</p>\n\n<p>I tried to create a new column 'FromTableA' (bit) into TableB to hold a state that means, this data coming from TableA. But when the application changes the state, the attribute FromTableA stays TRUE so I can't check this.</p>\n\n<p>Any ideas to solve the problem, using just a query? Changes in the application are not allowed.</p>\n"},{"tags":["sql-server","database","sqlite","synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":158,"score":0,"question_id":11619945,"title":"Microsoft Sync Framework Toolkit non MS synchronization","body":"<p>I am thinking about using the MS Sync Framework Toolkit to sync mobile database subsets of data to the cloud.  I will be using Android and iOS, and I only need to sync their individual local copies of the SQLite DB to the cloud.</p>\n\n<p>How well does MS Sync Framework handle filtering and data subsets, and how well does it run on non-windows based platforms, mainly Java/Android and iOS?  The mobile environments use SQLLite and the cloud is Microsoft based.  Thanks for the insight.</p>\n"},{"tags":["sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13173258,"title":"How do I build a query that crosses multiple tables?","body":"<p>Here are my tables:</p>\n\n<p><strong>CUSTOMER</strong></p>\n\n<pre><code>Cust_ID (PK)\nName\n</code></pre>\n\n<p><strong>ORDERS</strong></p>\n\n<pre><code>Order_ID (PK)\nCust_ID (FK)\n</code></pre>\n\n<p><strong>ORDER_LINE</strong></p>\n\n<pre><code>Order_ID (pk)\nPart_ID (FK)\n</code></pre>\n\n<p><strong>PART</strong></p>\n\n<pre><code>Part_ID (PK)\nPart_Description\n</code></pre>\n\n<p>Now I want to list the customer details, the part number and the description of the parts that each customer ordered.</p>\n\n<p>How do i do this?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":9,"favorite_count":2,"up_vote_count":6,"down_vote_count":1,"view_count":19020,"score":5,"question_id":358542,"title":"How to find fifth highest salary in a single query in SQL Server","body":"<p>How to find fifth highest salary in a single query in SQL Server</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13171931,"title":"family tree sql query","body":"<p>I am working on Family tree application in asp.net with sql server 2008.</p>\n\n<p>My main table is like this:-</p>\n\n<pre><code>ID int PK\nName Varchar(50)\nMotherID int\nFatherID int\n\nID  MotherID FatherID   Name\n\n1   NULL    NULL    My Grand Father\n\n2   NULL    NULL    My Grand Mother\n\n3   someid  someid  My Mother\n\n4   2   1   My Father\n\n5   3   4   Me\n\n6   someid  someid  My wife\n\n7   3   4   My Brother\n\n8   6   5   My son.\n</code></pre>\n\n<p>I am looking for output like this</p>\n\n<pre><code>ID  MotherID    FatherID    Name        Level\n\n1   someid  someid  grandfather 0\n\n\n2   someid  someid  Father      1\n\n3   someid  someid  Me      2\n\n\n4   someid  someid  Brother     2\n\n5   someid  someid  My Son      3\n</code></pre>\n\n<p>Thanks in advance.\nKashmir.</p>\n"},{"tags":["sql-server","switch-statement"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13172905,"title":"Getting a Error in Switch Statement in SQL","body":"<p>I am using SWITCH Statement in SP under Where Clause.Query Seems to be fine but i am unable to understand why it is giving me the error.\nQuery is:</p>\n\n<pre><code>Select * from Customer\nWHERE  (I.IsClose=@ISClose OR @ISClose is NULL)  \nAND    \n(C.FirstName like '%'+@ClientName+'%' or @ClientName is NULL )    \nAND \n CASE @abc\n         WHEN 2 THEN I.RecurringCharge=@Total or @Total is NULL\n         WHEN 3 THEN I.RecurringCharge like \n                               '%'+cast(@Total as varchar(50))+'%' \n                     or @Total is NULL \n     END\n</code></pre>\n\n<p>The code is incomplete but sufficient to understand the problem.I am getting Below Error Message when trying to compile it.</p>\n\n<pre><code>Incorrect syntax near '='.\n</code></pre>\n\n<p>The Error is on following line.</p>\n\n<pre><code>WHEN 2 THEN I.RecurringCharge=@Total or @Total is NULL\n</code></pre>\n\n<p>Please help me experts.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":179,"score":2,"question_id":11225491,"title":"Select one row from multiple row in sql depands on condition","body":"<p>I have a table in sql 2008 named tblEmployeeAttendance like \n<img src=\"http://i.stack.imgur.com/cw9SU.jpg\" alt=\"enter image description here\"></p>\n\n<p>Here is some dummy data for a employee's one days attendance like</p>\n\n<p><img src=\"http://i.stack.imgur.com/P6puo.jpg\" alt=\"enter image description here\"></p>\n\n<p>Here AI refers AttendanceIn,AO refers AttendanceOut,BO refers BreakIn and BI refers BreakOut.There can multiple row in a day for a employee.First row should be AI,last row should be AO and others rows will be BreakIn,BreakOut Sequentially(that means BreakIn-BreakOut-BreakIn.....).</p>\n\n<p>My expected output would be like this</p>\n\n<p><img src=\"http://i.stack.imgur.com/SfrKP.jpg\" alt=\"enter image description here\"></p>\n\n<p>I need a sql query that will return one row per date and return data that must contain AttendanceIn and AttendanceOut Time depands on strRemark(AI &amp; AO). Please help me.</p>\n"},{"tags":["c#","asp.net","sql","sql-server","ado.net"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13172423,"title":"How to compare excel value using asp.net SqlBulkCopy?","body":"<p>I am importing an Excel sheet into a SQL Server database. The Excel sheet contains 3 columns </p>\n\n<pre><code>id|data|passport\n</code></pre>\n\n<p>I am using <code>SqlBulkCopy</code> </p>\n\n<pre><code>SqlConnection con = new SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings[\"constr\"].ConnectionString);\n\n    string[] filePaths = null;\n    string strFileType = null;\n    string strFileName = null;\n    string strNewPath = null;\n    int fileSize;\n    int flag=0;\n\n    protected void Page_Load(object sender, EventArgs e)\n    {\n    }\n\n    protected void Button1_Click1(object sender, EventArgs e)\n    {\n        strFileType = System.IO.Path.GetExtension(FileUpload1.FileName).ToString().ToLower();\n        strFileName = FileUpload1.PostedFile.FileName.ToString();\n        FileUpload1.SaveAs(Server.MapPath(\"~/Import/\" + strFileName + strFileType));\n        strNewPath = Server.MapPath(\"~/Import/\" + strFileName + strFileType);\n        fileSize = FileUpload1.PostedFile.ContentLength / 1024;\n\n        //EXCEL DETAILS TABLE\n        con.Open();\n        //=========================================\n        DataTable dt8 = new DataTable();\n        SqlCommand cmd8 = new SqlCommand(\"insert into exceldetails (name,type,details,size)\" + \"values(@name,@type,@details,@size)\", con);\n        cmd8.Parameters.Add(\"@name\", SqlDbType.VarChar).Value = strFileName;\n        cmd8.Parameters.Add(\"@type\", SqlDbType.VarChar).Value = strFileType;\n        cmd8.Parameters.Add(\"@details\", SqlDbType.VarChar).Value = DateTime.Now;\n        cmd8.Parameters.Add(\"@size\", SqlDbType.Int).Value = fileSize;\n        cmd8.ExecuteNonQuery();\n        con.Close();\n        try\n        {\n            SqlDataAdapter da8 = new SqlDataAdapter(cmd8);\n            da8.Fill(dt8);\n        }\n        catch { }\n        //=========================================\n\n        //CHOOSING EXCEL CONNECTIONSTRING\n\n        string excelConnectionString = \"\";\n        switch (strFileType)\n        {\n            case \".xls\":\n\n                excelConnectionString = String.Format(@\"Provider=Microsoft.Jet.OLEDB.4.0;\" + \"Data Source=\" + strNewPath + \"; Extended Properties=Excel 8.0;\");\n                break;\n            case \".xlsx\":\n                {\n                    excelConnectionString = String.Format(@\"Provider=Microsoft.ACE.OLEDB.12.0;\" + \"Data Source=\" + strNewPath + \"; Extended Properties=Excel 12.0 Xml;\");\n\n                    break;\n                }\n        }\n\n        //===================================\n        //PRE EXCEL COUNT\n\n        // Create Connection to Excel Workbook\n        using (OleDbConnection connection = new OleDbConnection(excelConnectionString))\n        {\n            connection.Open();\n            OleDbCommand command = new OleDbCommand(\"Select ID,Data,passport FROM [Sheet1$]\", connection);\n            OleDbCommand command1 = new OleDbCommand(\"select count(*) from [Sheet1$]\", connection);\n\n            //Sql Server Table DataTable\n            DataTable dt4 = new DataTable();\n            SqlCommand cmd4 = new SqlCommand(\"select * from excelsheet\", con);\n            try\n            {\n                SqlDataAdapter da4 = new SqlDataAdapter(cmd4);\n                da4.Fill(dt4);//sql table datatable\n            }\n            catch { }\n\n            //===============================\n\n            //excelsheet datatable\n            DataTable oltlb = new DataTable();\n            OleDbCommand olcmd = new OleDbCommand(\"select * from [Sheet1$]\", connection);\n            try\n            {\n                OleDbDataAdapter olda = new OleDbDataAdapter(olcmd);\n                olda.Fill(oltlb); //excel table datatable\n            }\n            catch { }\n\n            //==============================\n\n\n            using (DbDataReader dr = command.ExecuteReader())\n            {\n                // SQL Server Connection String\n                string sqlConnectionString = \"Data Source=DITSEC3;Initial Catalog=test;Integrated Security=True\";\n\n                con.Open();\n                DataTable dt7 = new DataTable();\n                dt7.Load(dr);\n                DataRow[] ExcelRows = new DataRow[dt7.Rows.Count];\n                DataColumn[] ExcelColumn = new DataColumn[dt7.Columns.Count];\n\n                //=================================================\n                for (int i1 = 0; i1 &lt; ExcelRows.Length; i1++)\n                {\n                    string a = ExcelRows[i1][\"passport\"].ToString();\n                    char a1 = a[0];\n\n                    if (a1 &gt;= 'A' || a1 &lt;= 'Z')\n                    {\n                        Label12.Text = \"CAPITAL\";\n                        break;\n                    }\n                    else\n                    {\n                        Label12.Text = \"notgood\";\n\n\n                        flag = flag + 1;\n\n\n\n                    }\n\n                }\n                //=========================================================\n\n                if (flag == 0)\n                {\n                    using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n                    {\n                        bulkCopy.DestinationTableName = \"ExcelTable\";\n                        dt7.Rows.CopyTo(ExcelRows, 0);\n\n                        //==========================================================================================\n                        for (int i = 0; i &lt; ExcelRows.Length; i++)\n                        {\n                            if (ExcelRows[i][\"passport\"] == DBNull.Value)\n                            {\n                                ExcelRows[i][\"passport\"] = 0;\n                            }\n\n                        }\n                        bulkCopy.WriteToServer(ExcelRows);\n                        //==========================================================================================\n                        for (int i = 0; i &lt; ExcelRows.Length; i++)\n                        {\n                            if (ExcelRows[i][\"data\"] == DBNull.Value)\n                            {\n                                // Include any actions to perform if there is no date\n                                //ExcelRows[i][\"data\"] = Convert.ToDateTime(\"0\");\n                            }\n                            else\n                            {\n                                DateTime oldDate = Convert.ToDateTime(ExcelRows[i][\"data\"]).Date;\n                                DateTime newDate = Convert.ToDateTime(oldDate).Date;\n                                ExcelRows[i][\"data\"] = newDate.ToString(\"yyyy/MM/dd\");\n                            }\n\n                        }\n\n                        //==========================================================================================\n                    }\n                    //======\n\n                }\n                else\n                {\n                    Label13.Text = \"Wrong Format\";\n                }\n            }\n\n        }\n    }\n}\n</code></pre>\n\n<p>ERROR AT : </p>\n\n<pre><code>string a = ExcelRows[i1][\"passport\"].ToString();\n</code></pre>\n\n<p>ERROR: </p>\n\n<blockquote>\n  <p><em>Object reference not set to an instance of an object.</em></p>\n</blockquote>\n"},{"tags":["c#","asp.net","sql-server","excel"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13154009,"title":"How can i compare the values of excel cell values while using SqlBulkCopy?","body":"<p>I am importing Excelsheet into sql server database i need to check certain things before importing the sheet, such as  i have a column called passport which must have values starting with alphabet only and must have rest of the characters as numbers (only). </p>\n\n<pre><code>   DataTable dt7 = new DataTable();\n            dt7.Load(dr);\n            DataRow[] ExcelRows = new DataRow[dt7.Rows.Count];\n            // Bulk Copy to SQL Server\n\n            using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n            {\n                bulkCopy.DestinationTableName = \"ExcelTable\";\n                dt7.Rows.CopyTo(ExcelRows, 0);\n\n                for (int i = 0; i &lt; ExcelRows.Length; i++)\n                {\n                    if (ExcelRows[i][\"data\"] == DBNull.Value)\n                    {\n                        // Include any actions to perform if there is no date\n                        //ExcelRows[i][\"data\"] = Convert.ToString(0);\n                    }\n                    else\n                    {\n                        DateTime oldDate = Convert.ToDateTime(ExcelRows[i][\"data\"]).Date;\n                        DateTime newDate = Convert.ToDateTime(oldDate).Date;\n                        ExcelRows[i][\"data\"] = newDate.ToString(\"yyyy/MM/dd\");\n                    }\n\n\n\n                }\n                bulkCopy.WriteToServer(ExcelRows);\n</code></pre>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":100,"score":5,"question_id":13158944,"title":"\"Incorrect syntax\" error using OVER()","body":"<p>I have a sales budget for every trading day of the month.  So for day 1 the budget is 300, for day 2 the budget is 400, and then month to date budget is 700.  I get this error in my query:  <code>Incorrect syntax near 'ROWS'.</code></p>\n\n<pre><code>select \nTradingDate\n,Budget\n,sum(Budget) over (PARTITION BY TradingDate\norder by TradingDate asc\nROWS BETWEEN CURRENT ROW AND 1 FOLLOWING),1) AS BudgetMTD\nfrom #4\n</code></pre>\n"},{"tags":["sql","sql-server","vb.net"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":12767125,"title":"Fail to run sp_prepare over ADODB from Visual Basic","body":"<p>I can't get the handle value to pass to sp_execute. If I use the SQL code directly with Management Studio I succeed:</p>\n\n<pre><code>Declare @handle Integer\nexec sp_prepare @handle OUTPUT, N'@year int', N'SELECT * from Sales.CreditCard where ExpYear=@year';\n\nselect @handle\n\nexec sp_execute @handle, 2007\nexec sp_unprepare @handle\n</code></pre>\n\n<p>but when I try the following code on VB, \"param3.Value\" is \"nothing\" after the command is executed.</p>\n\n<pre><code>    ConnString = \"DRIVER={SQL Server};SERVER=192.168.100.41,1433;UID=sa;PWD=&lt;password&gt;;DATABASE=AdventureWorks\"\n    'create an instance of the ADO connection\n    Connection = CreateObject(\"ADODB.Connection\")\n\n    'Open the connection to the database\n    Connection.Open(ConnString)\n    Dim cmd As ADODB.Command\n    Dim param1 As ADODB.Parameter\n    Dim param2 As ADODB.Parameter\n    Dim param3 As ADODB.Parameter\n\n    cmd = CreateObject(\"ADODB.Command\")\n    cmd.ActiveConnection = Connection\n    cmd.CommandText = \"sp_prepare\"\n\n    param1 = cmd.CreateParameter(\"@handle\", 3, 2, 4, 0)\n    param2 = cmd.CreateParameter(\"@params\", 202, 1, 200, \"@year Integer\")\n    param3 = cmd.CreateParameter(\"stmt\", 202, 1, 200, \"SELECT TOP 4 [CreditCardID],[CardType],[CardNumber],[ModifiedDate]  FROM [AdventureWorks].[Sales].[CreditCard] where [ExpYear] in (@year)\")\n\n    cmd.Parameters.Append(param1)\n    cmd.Parameters.Append(param2)\n    cmd.Parameters.Append(param3)\n\n    cmd.Execute()\n\n    Debug.WriteLine(\"handle:\" &amp; param1.Value)\n</code></pre>\n\n<p>Do you know how to make it work on VB?\nThe reason I run this from VB is that I need the command to be run over RPC.</p>\n"},{"tags":["c#","sql-server","stored-procedures","sqlparameter"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":229,"score":4,"question_id":5873731,"title":"Is there a way to determine if a parameter in a stored proc has a default value (and thus not required) in code - .Net?","body":"<p>I am already pulling the parameters from the stored proc sent in like this:</p>\n\n<pre><code> foreach (SqlParameter param in cmd.Parameters)\n            {\n               if ((param.Direction == ParameterDirection.Input) || (param.Direction == ParameterDirection.InputOutput))\n                {\n                    jsonReturn += \"{\\\"paramName\\\":\\\"\" + param.ParameterName + \"\\\", \\\"paramType\\\":\\\"\" + param.SqlDbType.ToString() + \"\\\"},\";\n                }\n            }\n</code></pre>\n\n<p>I looked into the SqlParameter object and could not find a way to see if it could tell me whether the Parameter had a default value... (although my debugger is acting weird, so who knows).</p>\n\n<p>What I am doing is building a sort of Stored Proc helper for users..  I currently tell them all the parameters that belong to the Stored Proc they pick.... I WOULD REALLY like to be able to tell whether they are required.  </p>\n"},{"tags":["sql-server","stored-procedures","if-statement","where-clause"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":63,"score":4,"question_id":13171748,"title":"How to use If Statement in Where Clause in SQL?","body":"<p>I need to use if statement inside where clause in sql.</p>\n\n<pre><code>Select * from Customer\nWHERE  (I.IsClose=@ISClose OR @ISClose is NULL)  \nAND    \n(C.FirstName like '%'+@ClientName+'%' or @ClientName is NULL )    \nAND \n if (@Value=2)\n  begin\n  (I.RecurringCharge=@Total  or @Total is NULL )    \n  end\n else if(@Value=3)\nbegin\n(I.RecurringCharge like '%'+cast(@Total as varchar(50))+'%' or @Total is NULL )  \nend\n</code></pre>\n\n<p>Note:This is not the complete code.Everything is defined in SP.I Just written the code that was needed to understand the issue.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13171335,"title":"Computer Column with Current DateTime?","body":"<p>I am trying to create a SQL Server 2008R2 Table column with automatically calculated current datetime for every row I insert.</p>\n\n<p>I set Computed Column Specification value for this column equals to GetDate(). My table had some old data in it. After adding GetDate() function, the column get updated with current datetime. But my problem is, When i insert new row in this table, my datetime column never get updated with current date time and this column have same value for each row.</p>\n\n<p>Which function should I use to insert current datetime value for column when I insert a new record?</p>\n\n<p>Thanks,</p>\n"},{"tags":["sql-server","stored-procedures","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":195,"score":1,"question_id":11531352,"title":"How to rollback a transaction in a stored procedure?","body":"<p>Looking at the SQL Server Books Online, Microsoft seems to have an (incorrect) <a href=\"http://msdn.microsoft.com/en-us/library/ms189336%28v=sql.105%29.aspx\" rel=\"nofollow\">method of handling nested transactions in a stored procedure</a>:</p>\n\n<blockquote>\n  <h2>Nesting Transactions</h2>\n  \n  <p>Explicit transactions can be nested. This is primarily intended to support transactions in stored procedures that can be called either from a process already in a transaction or from processes that have no active transaction.</p>\n</blockquote>\n\n<p>The example goes on to show a stored procedure that starts its own transaction <em>(\"The procedure enforces its transaction regardless of the transaction mode of any process that executes it.\")</em>:</p>\n\n<pre><code>CREATE PROCEDURE TransProc @PriKey INT, @CharCol CHAR(3) AS\n   BEGIN TRANSACTION InProc\n      ...\n   COMMIT TRANSACTION InProc;\n</code></pre>\n\n<p>This procedure can then either be called without a transaction running:</p>\n\n<pre><code>EXECUTE TransProc 3,'bbb';\n</code></pre>\n\n<p>Or <strong>with</strong> an explicit transaction:</p>\n\n<pre><code>BEGIN TRANSACTION OutOfProc;\n\nEXEC TransProc 1, 'aaa';\n\nCOMMIT TRANSACTION OutOfProc\n</code></pre>\n\n<p>What they don't address is what happens when the stored produre:</p>\n\n<ul>\n<li>fails with an error, but leaves the transaction running</li>\n<li>fails with an error, but doesn't leave the transaction running</li>\n<li>encounters an error, but continues executing with the transaction open</li>\n<li>encounters an error, but continues executing with the transaction rolled back</li>\n</ul>\n\n<p>There is no:</p>\n\n<ul>\n<li><code>SET XACT_ABORT ON</code></li>\n<li>@@TRANCOUNT</li>\n</ul>\n\n<p>anywhere in the canonical example. </p>\n\n<p>If i didn't know any better, i would have thought that the line:</p>\n\n<blockquote>\n  <p>The following example shows the intended use of nested transactions. </p>\n</blockquote>\n\n<p>should actually read</p>\n\n<blockquote>\n  <p>The following example shows the how not to use nested transactions.</p>\n</blockquote>\n\n<p>Unless someone can make heads or tails of this BOL example?</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":13167018,"title":"getting data from one table to another in asp.net","body":"<p>I have two tables called registration and user.</p>\n\n<p>Registration table:</p>\n\n<pre><code>PID(primary key,autoincrement)\nemail\npassword\nname\netc\n</code></pre>\n\n<p>User:</p>\n\n<pre><code>UserID\nAddress\netc\n</code></pre>\n\n<p>If any person gets registered then data is stored in registration table.</p>\n\n<p>Now if I want to insert data in user table then how can I insert data for that particular person which has just registered himself?</p>\n\n<p>Ex: registration table</p>\n\n<pre><code>PID  email        name\n1    abc@ab.com   xyz\n</code></pre>\n\n<p>I want to insert data into user table which has <code>PID=1</code></p>\n\n<p>And after login (which is done with the help of email and password) only person can insert data in USER table.</p>\n\n<p>What is the query for this?</p>\n\n<p>Should I add some common columns in <code>User</code> table?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13170371,"title":"Easier way to compare a DATE field to the date value of GETDATE?","body":"<p>I have a field in a table <code>Event.EventDate</code> and it's of the data type <code>DATE</code> rather than <code>DATETIME</code> and then I have a view that has the following <code>WHERE</code> clause:</p>\n\n<pre><code>WHERE e.EventDate &gt;= CAST(CONVERT(VARCHAR(MAX), GETDATE(), 101) AS DATETIME)\n</code></pre>\n\n<p>As you can see, I'm just trying to get all events <code>&gt;=</code> today's <strong>date</strong>. The above code works, but it's ugly. I tried this ...</p>\n\n<pre><code>WHERE e.EventDate &gt;= CONVERT(VARCHAR(MAX), GETDATE(), 101)\n</code></pre>\n\n<p>... and this ...</p>\n\n<pre><code>WHERE e.EventDate &gt;= CONVERT(DATETIME, GETDATE(), 101)\n</code></pre>\n\n<p>... but those didn't work, they gave me every event <code>&gt;</code> today's <strong>date</strong>. However, even if the above worked, it's still ugly.</p>\n\n<p>Isn't there a better way?</p>\n"},{"tags":["c#","sql-server"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":13161280,"title":"Evaluate SQL where clause in c# without SQL Server","body":"<p>I have a large set of conditions (I don't know them ahead of time) that I need count against a relatively small SQL Server table (&lt; 10,000 rows). Each condition is in the form of a SQL where clause. Currently, I build a complete sql statement in the form of \"select count(*) from some_table where \" + Where_Clause; and I let SQL Server return the count to me. I do this in a loop to get all the counts I need for all the various conditions. </p>\n\n<p>I'm looking for ways to speed this up when I have dozens or hundreds of counts I need to run. I don't know the statements ahead of time. Some will select the whole table, some may not select any rows. I've tried the following solutions:</p>\n\n<ol>\n<li>Issuing the queries in parallel - saw minimal improvement even when not doing any locking </li>\n<li>Writing them as complex counts on case statements so I can run multiple where clauses in one statement</li>\n<li>Passing many queries together as UNIONs and getting the results back as one result set</li>\n</ol>\n\n<p>None of these options have had a fantastic improvement in runtime (sometimes it would run more slowly) and with the added complexity, I don't feel any of them are worth it. </p>\n\n<p>My question is: I can very quickly load the entire table into a DataTable object just by running one \"select *\" against it. If I had the whole table in memory, is there a way to run counts against it without going back and forth to SQL Server? I'm hoping to cut out the overhead of the: network, I/O, locking, etc.</p>\n\n<p>The most complex where clause would be something like:</p>\n\n<pre><code>a=1 or b in (2,3) or c&lt;4 or d like '%5' or substring(e,2,1)='z'\n</code></pre>\n\n<p>So it's not trivial and supporting as much as possible of T-SQL would be ideal, but I don't think DataTable's .Select() method supports this OR is it very fast. So given a table of data in memory, can I could rows using T-SQL syntax very fast (or in parallel)?</p>\n"},{"tags":["sql-server","osx","microsoft","navicat"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13170242,"title":"Microsoft SQL Server Client for Mac OS X","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3452/sql-client-for-mac-os-x-that-works-with-ms-sql-server\">SQL Client for Mac OS X that works with MS SQL Server</a>  </p>\n</blockquote>\n\n\n\n<p>I am looking for a SQL Server client that has comfortable GUI and works with Mac OS X.</p>\n\n<p>I have tried Navicat, but it crashes all too frequently and has a great problem connecting to SQL Server when the latter is under load.Note: we are using SQL Server 2012.</p>\n\n<p>Any Recommendations?</p>\n"},{"tags":["sql-server","networking","jdbc","tcp","wireshark"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13169982,"title":"How to capture & analyze network traffic for jdbc mssql \"connection recv failed\" error","body":"<p>One of our customers has intermittent database connection problems. The error logs periodically show messages like this:</p>\n\n<pre><code> A database error occurred. : Software caused connection abort: recv failed\n</code></pre>\n\n<p>at which point someone must restart the application. (Connection pooling doesn't recover from the error)</p>\n\n<p>This <a href=\"http://stackoverflow.com/questions/135919/java-net-socketexception-software-caused-connection-abort-recv-failed\">post</a> describes a problem; one of the answers points to wireshark. </p>\n\n<p><strong>Suspicions</strong></p>\n\n<p>I suspect the problem is either:</p>\n\n<ol>\n<li>someone wrote a database script that runs on the server that closes \nsleeping connections </li>\n<li>an error in their network</li>\n</ol>\n\n<p>As I can't find anyone owning up to #1, I need to hunt down #2.</p>\n\n<p><strong>My question</strong></p>\n\n<ul>\n<li>Once I have captured the data, what do I look for in the captured data to point to a root cause?</li>\n</ul>\n\n<p><strong>Example</strong></p>\n\n<p>For example, I assume based on past experience that the server logs will show everything \"runs fine\" until an error like this occurs:</p>\n\n<pre><code>2012-11-01 04:02:14 A database error occurred. : Software caused connection abort: recv failed\n</code></pre>\n\n<p>Then I'd like to look at the traffic the seconds/minutes before 04:02:14 for any \"smoking gun\".</p>\n\n<p><strong>Pointers?</strong></p>\n\n<p>Additionally, I ask for pointers on these items:</p>\n\n<ul>\n<li>setting up the traffic capture. (is capturing on the jdbc server's port 1433 enough?) </li>\n<li>port-mirroring tips. I assume I can ask their \"network guy\" to set up port mirroring to a windows box running wireshark and he can do it easily (\"Port mirroring\" copies all network traffic for a particular connection off to another port for later analysis)</li>\n<li>any wireshark 'scalability issues'--will the data overload wireshark ?</li>\n<li>filtering through the data for \"interesting events\"</li>\n<li>\"smoking guns\"--what to look for prior to that 'connection recv error'</li>\n</ul>\n\n<p><strong>Environment</strong></p>\n\n<ul>\n<li>MSSQL (2005 or later. It's on the customer site and I don't know the details) </li>\n<li>Jboss 4.2.2 </li>\n<li>Microsoft jdbc driver</li>\n<li>jdk 1.6 (not sure the exact version)</li>\n</ul>\n"},{"tags":["sql","sql-server","common-table-expression"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13164308,"title":"CTE and row_number() to fix join on unnormalized table","body":"<p>There's a table on which I can't perform any updates.  There are a dozen or so fields and of them, <code>bus_typ_cd</code> changes.  This lead to me getting double the expected results for a given patient who had two different <code>bus_typ_cd</code>s.  I'm unable to drop this column.  While I found a workaround solution, I was wondering if there is a more extensible/efficient way to do this.  Pic of the incorrect results:<img src=\"http://i.stack.imgur.com/mRbda.jpg\" alt=\"enter image description here\"></p>\n\n<p><strong>EDIT</strong>  what I thought was a fix actually wasn't.  If I use a <code>where</code> clause to restrict only a single <code>bus_typ_cd</code> I can't catch all of the expected results.  </p>\n\n<p>the working version:</p>\n\n<pre><code>   with cte as\n    (\n    select c.patid\n        ,c.CHARGE\n        ,c.pos\n        ,m.sex\n        ,e.eduText\n\n        from claims c\n        inner join icdClm as ic on ic.clmid=c.clmid\n        --instead of selecting the table, a derived table with distinct values was selected\n        inner join\n        (\n            select distinct m.patid, m.sex,m.education\n                from members as m \n        ) as m on m.PATID=c.patid\n        inner join EducationTable as e on e.eduID=m.education\n        where ic.icd like '707%'\n    ) \n</code></pre>\n\n<p>non working</p>\n\n<pre><code>    ;with cte as\n    (\n    select c.patid\n        ,c.CHARGE\n        ,c.pos\n        ,m.sex\n        --,e.eduText\n        ,ROW_NUMBER() over(partition by c.patid,bus_typ_cd order by c.patid)  as rn\n        ,m.BUS_TYP_CD\n        ,m.STATE_CD\n        from claims c\n        inner join icdClm as ic on ic.clmid=c.clmid\n        inner join members as m on m.PATID=c.patid\n        inner join EducationTable as e on e.eduID=m.education\n        where ic.icd like '707%'\n    ) \n\n\n    select  cte.*\n        from cte\n        inner join cte as cte2 on cte.patid=cte2.patid \n        and cte.POS=cte2.POS and cte.sex=cte2.sex \n        --tried to make the below line a logical unit of equal charge and one rn less than the other\n        and (cte.CHARGE=cte2.CHARGE and cte.rn &lt; cte2.rn) \n        and cte.BUS_TYP_CD=cte2.BUS_TYP_CD \n        and cte.STATE_CD=cte2.STATE_CD\n        where cte.patid =1161569271\n        order by cte.CHARGE\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","windowsdomainaccount"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":4580,"score":1,"question_id":4268100,"title":"How to find loginname, database username, or roles of sqlserver domain user who doesn't have their own login?","body":"<p>I have created a login and database user called \"MYDOMAIN\\Domain Users\". I need to find what roles a logged on domain user has but all the calls to get the current user return the domain username eg. \"MYDOMAIN\\username\" not the database username eg. \"MYDOMAIN\\Domain Users\".</p>\n\n<p>For example, this query returns \"MYDOMAIN\\username\"</p>\n\n<pre><code>select original_login(),suser_name(), suser_sname(), system_user, session_user,  current_user, user_name()\n</code></pre>\n\n<p>And this query returns 0</p>\n\n<pre><code>select USER_ID()\n</code></pre>\n\n<p>I want the username to query database_role_members is there any fuction that will return it or any other way I can get the current users roles?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","login"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":13168175,"title":"SQL Script to Create Auto-Expiring Login","body":"<p>How can I script the creation of a new SQL Login (whether by Windows\nAuthentication or with SQL password) and have it automatically expire after some\ntime, e.g. 8 hours, 24 hours</p>\n\n<p>I've tried searching here in stackoverflow but I haven't found a solution. If you guys know of one that exists here, please let me know too. Thank you.</p>\n\n<p>I am using SQL Server 2005 and 2008</p>\n"},{"tags":["sql-server","clrstoredprocedure","tsqlt"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":231,"score":1,"question_id":12389656,"title":"The database owner SID recorded in the master database differs from the database owner SID","body":"<p>When I try to install tSQLt onto an existing database i get the following error:</p>\n\n<blockquote>\n  <p>The database owner SID recorded in the master database differs from\n  the database owner SID recorded in database ''. You should correct\n  this situation by resetting the owner of database '' using the ALTER\n  AUTHORIZATION statement.</p>\n</blockquote>\n"},{"tags":["sql","sql-server","query"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":83,"score":2,"question_id":13166647,"title":"Trouble Joining 3 Tables","body":"<p>I am new to writing SQL queries and have been trying to pull information from 3 different tables and link it together.  </p>\n\n<p>Data resides in Microsoft SQL Server.  </p>\n\n<p>This is my current query (which is not working the way I intend it to):  </p>\n\n<pre><code>SELECT h.jhhold, h.jhjob, h.jhpart, h.jhrev, h.jhcust, h.jhextd, o.jadesc, h.jhpqty, o.jaoqty, o.jacqty, o.japo, o.javend \nFROM Jhead AS h\nLEFT JOIN jjops AS o ON h.jhjob = o.jajob \nLEFT JOIN hpodt AS p ON h.jhjob = p.hdjob \nWHERE h.jhpcmp = 0 AND o.jatype = 2 AND o.jacqty &lt; o.jaoqty AND japcmp = 0 \nORDER BY h.jhjob\n</code></pre>\n\n<p>To explain what I am trying to do.  I have a job header table <strong>Jhead</strong>, a job detail table <strong>jjops</strong> and a purchase order detail table <strong>hpodt</strong>.  I believe the job number is the primary key in the jhead table.</p>\n\n<p>Here is my problem:  As soon as I add the second left join I end up with a lot of extra lines of duplicated information. </p>\n\n<p>I have tried using the GROUP BY jhead.jhjob but get the following error: </p>\n\n<p>Column jhead.jhhold is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.</p>\n\n<p>So I researched the error with one of the solutions being to make my GROUP BY look like this:\nGROUP BY jhead.jhjob, jhead.jhhold, jhead.jhpart, jhead.jhrev, jhead.jhcust, jhead.jhextd</p>\n\n<p>But then as soon as I put in jhead.jhextd I get this error:\nThe text, ntext, and image data types cannot be compared or sorted, except when using IS NULL or LIKE operator.</p>\n\n<p>And have now hit a brick wall.  I did see that you can change the type to NVARCHAR.  I dont really want to be sorting by the description field because it is unique and may be very taxing on the server.  Is there a better way to do this?  </p>\n\n<p><strong>Edit With Sample Data:</strong>\nI removed extra fields to simplify the query and have filtered the results for 1 job number.</p>\n\n<p>With only 1 left join:\n<img src=\"http://i.imgur.com/Gd3J5.jpg\" alt=\"With only 1 Left Join\"></p>\n\n<p>With both left joins:\n<img src=\"http://i.imgur.com/Woaog.jpg\" alt=\"Second\"></p>\n\n<p>ERP software as you can see has multiple jobs under 1 PO# and I am only interested in displaying lines with a job number that matches.\n<img src=\"http://i.imgur.com/nZzXx.jpg\" alt=\"Third\"></p>\n\n<p><strong>QUERY UPDATED</strong> </p>\n\n<pre><code>SELECT h.jhhold, h.jhjob, h.jhrev, o.jadesc, h.jhpqty, o.jaoqty, o.jacqty, o.japo, o.javend, p.hdprcd, p.hdrecd\nFROM Jhead AS h\nLEFT JOIN jjops AS o ON h.jhjob = o.jajob \nLEFT JOIN hpodt AS p ON h.jhjob = p.hdjob \nWHERE h.jhpcmp = 0 AND o.jatype = 2 AND o.jacqty &lt; o.jaoqty AND japcmp = 0 AND p.hdjob = h.jhjob AND p.hdpo = o.japo\nORDER BY h.jhjob\n</code></pre>\n\n<p>This is getting close to what I want.  The problem is now that my jadesc field is duplicating the first result when it should actually be different for each line.</p>\n\n<p><img src=\"http://i.imgur.com/9o7du.jpg\" alt=\"4\"></p>\n\n<p>I filtered to just display one job.  Their should only be one column.</p>\n\n<p><strong>Getting extra lines but have all the data I need</strong>  </p>\n\n<pre><code>SELECT h.jhhold, h.jhjob, h.jhrev, o.jadesc, h.jhpqty, o.jaoqty, o.jacqty, o.japo, o.javend, p.hdprcd, p.hdrecd, p.hdseq \nFROM Jhead AS h \nLEFT JOIN jjops AS o ON h.jhjob = o.jajob \nLEFT JOIN hpodt AS p ON h.jhjob = p.hdjob \nWHERE (h.jhpcmp = 0 AND o.jatype = 2 AND o.jacqty &lt; o.jaoqty AND japcmp = 0 AND p.hdjob = h.jhjob AND p.hdpo = o.japo AND p.hdseq = o.jaseq AND o.jaopr != 'PT') \n  OR (h.jhpcmp = 0 AND o.jatype = 2 AND o.jacqty &lt; o.jaoqty AND japcmp = 0 AND o.japo = 0 AND o.jaopr != 'PT')\nORDER BY h.jhjob, o.jaseq\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":34,"score":4,"question_id":13168965,"title":"Group by query is not returning what I expected","body":"<p>I am attempting to find all records that have the same <code>groupCol</code> but more than one non 0 <code>infoCol</code>. Here is a complete example of what I am trying to do.</p>\n\n<pre><code>CREATE TABLE #t\n    (\n    groupCol varchar(14) NOT NULL,\n    infoCol int NOT NULL,\n    indexCol int NOT NULL IDENTITY (1, 1)\n    )\nGO\n\ninsert into #t (groupCol, infoCol) \nvalues ('NoRows',1),      ('NoRows',1),      ('NoRows',1),       --Not in output due to having only 1 disticnt infoCol\n       ('TwoResults',1),  ('TwoResults',1),  ('TwoResults',2),   --In the output with \"'TwoResults', 2\"\n       ('ThreeResults',1),('ThreeResults',2),('ThreeResults',3), --In the output with \"'ThreeResults', 3\"\n       ('ExcludedZero',1),('ExcludedZero',1),('ExcludedZero',0)  --Not in the output due to 0 being excluded for finding distinct infoCol's\n       ('TwoAndZero',1),  ('TwoAndZero',2),  ('TwoAndZero',0)    --In the output but returns 2 not 3.\n\nselect * from #t\n\nselect groupCol, count(groupCol) as distinctInfoCol \nfrom #t \nwhere infoCol &lt;&gt; 0\ngroup by groupCol, infoCol\nhaving count(groupCol) &gt; 1\n\ndrop table #t\n</code></pre>\n\n<p>However the result from my query is </p>\n\n<pre>\ngroupCol       distinctInfoCol\n-------------- ---------------\nExcludedZero   2\nNoRows         3\nTwoResults     2\n</pre>\n\n<p>When I expected my output to be</p>\n\n<pre>\ngroupCol       distinctInfoCol\n-------------- ---------------\nTwoResults     2\nThreeResults   3\nTwoAndZero     2\n</pre>\n\n<p>What am I doing wrong, and how do I correct this to get the results I need?</p>\n"},{"tags":["sql","sql-server","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13166882,"title":"Cannot get login to work for ODBC driver","body":"<p>I am trying to set up an ODBC driver to SQL Server 2000 and cannot what I am doing wrong. The error I get is <code>sqlstate 28000</code> and <code>error 18456 failed login</code>. </p>\n\n<p>Here are the steps I took: </p>\n\n<ul>\n<li>create a username under computer management</li>\n<li>then in enterprise manager I create login by going to <code>security-&gt;login new login</code> </li>\n<li>From there I browse to the user I created in computer management and windows nt is selected as well as grant access</li>\n<li>then went to database and rolls and gave it read and write permissions for a few databases. The default database is set to master. Everything seems to work just fine up to this point.</li>\n</ul>\n\n<p>Then I go to the ODBC manager and then SysDSN then add and I pick SQL Server. From here I name the DSN, pick the server that has both the windows username and the SQL Server on it and click next. </p>\n\n<p>Then I click SQL Server authentication and enter the username and password, and checked to make sure it was right at least 20 times, and then I get the <code>18456 error</code>.</p>\n\n<p>Am I missing a step, what happened?</p>\n\n<p>Any help is appreciated.</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13148011,"title":"Can I create a dummy INSTEAD OF UPDATE, INSERT trigger so I can use MERGE with INSTEAD OF DELETE?","body":"<p>I'm trying to utilize the SQL Server 2008R MERGE functionality to manage parent child relationship records in a join table.</p>\n\n<p>The join table represents many-to-many relationships, so it has two foreign keys for the same primary key. Accordingly, <code>ON DELETE CASCADE</code> cannot be used. In it's place I am using a trigger on <code>INSTEAD OF DELETE</code> and deleting the join records, thus removing the constraint so I can complete the originally intended delete operation.</p>\n\n<p>Unfortunately, when I try to use MERGE in this scenario I get the following error.</p>\n\n<pre><code>The target 'Content' of the MERGE statement has an INSTEAD OF trigger on some,\nbut not all, of the actions specified in the MERGE statement. In a MERGE statement,\nif any action has an enabled INSTEAD OF trigger on the target, then all actions\nmust have enabled INSTEAD OF triggers.\n</code></pre>\n\n<p>Here's the T-SQL for reproducing this problem. I have included commented out drop and select statements for convenience.</p>\n\n<pre><code>CREATE DATABASE [TestDatabase]\nGO\n\nUSE [TestDatabase]\nGO\n\nCREATE TABLE dbo.[Content] (\n    ContentID int NOT NULL IDENTITY (1, 1),\n    Title varchar(255)\n)\nALTER TABLE dbo.[Content]\n    ADD CONSTRAINT PK_Content\n    PRIMARY KEY CLUSTERED (ContentID)\n\nCREATE TABLE dbo.[Attachment] (\n    ParentContentID int NOT NULL,\n    ChildContentID int NOT NULL\n)\n\nALTER TABLE [dbo].[Attachment]\n    ADD CONSTRAINT [PK_Attachment]\n    PRIMARY KEY CLUSTERED (\n        [ParentContentID] ASC,\n        [ChildContentID] ASC\n    )\n\nALTER TABLE dbo.Attachment\n    ADD CONSTRAINT FK_Attachment_ParentContent\n    FOREIGN KEY (ParentContentID)\n    REFERENCES dbo.[Content] (ContentID)\n    ON UPDATE NO ACTION\n    ON DELETE NO ACTION \n\nALTER TABLE dbo.Attachment\n    ADD CONSTRAINT FK_Attachment_ChildContent\n    FOREIGN KEY (ChildContentID)\n    REFERENCES dbo.[Content] (ContentID)\n    ON UPDATE NO ACTION\n    ON DELETE NO ACTION\nGO\n\nCREATE TRIGGER trContentInsteadOfDelete\n    ON dbo.[Content]\n    INSTEAD OF DELETE\nAS\n\n    SET NOCOUNT ON;\n\n    DELETE FROM dbo.[Attachment]\n    WHERE [ParentContentID] IN (SELECT [ContentID] FROM deleted)\n    OR [ChildContentID] IN (SELECT [ContentID] FROM deleted)\n\n    DELETE FROM dbo.[Content]\n    WHERE [ContentID] IN (SELECT [ContentID] FROM deleted)\nGO\n\nINSERT INTO [Content] ([Title]) VALUES ('a'), ('a'), ('a'), ('b')\nGO\n\nINSERT INTO [Attachment] ([ParentContentID], [ChildContentID])\n    VALUES (1, 2), (1, 4), (3, 4)\nGO\n\nMERGE [Content] AS target\nUSING (VALUES (1, 'a'), (2, 'b'), (NULL, 'b')) AS source ([ContentID], [Title])\nON target.[ContentID] = source.[ContentID]\nWHEN MATCHED AND target.[Title] != source.[Title] THEN\n    UPDATE SET target.[Title] = source.[Title]\nWHEN NOT MATCHED BY TARGET THEN\n    INSERT ([Title]) VALUES (source.[Title])\nWHEN NOT MATCHED BY source THEN\n    DELETE;\n\n/*\nUSE master\nDROP DATABASE [TestDatabase]\n\nSELECT * FROM [Content]\nSELECT * FROM [Attachment]\n*/;\n</code></pre>\n\n<p><strike>Is there any alternative to adding triggers to <code>INSTEAD OF INSERT</code> and <code>INSTEAD OF UPDATE</code> without having to explicitly delete any constraining records in the Attachment table before deleting records from the Content table?</p>\n\n<p>I could temporarily disable the trigger, but then I'd have to explicitly delete the constraining records in the Attachment table.</p>\n\n<p>I'm concerned that adding additional triggers just to accommodate the MERGE statement defeats the purpose of using the MERGE statement.</strike></p>\n\n<p>Update: Is there a way to create a dummy INSTEAD OF INSERT, UPDATE trigger to enable me to continue to use the MERGE?</p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":13161401,"title":"calculating age from sysdate and birthdate using SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/57599/how-to-calculate-age-in-t-sql-with-years-months-and-days\">How to calculate age in T-SQL with years, months, and days</a>  </p>\n</blockquote>\n\n\n\n<p>I'm simply trying to calc age (in years) using a birthdate variable </p>\n\n<pre><code>1932-04-29 00:00:00.000\n</code></pre>\n\n<p>and SYSDATETIME( ) in SQL Server, where by</p>\n\n<pre><code>SELECT year(Sysdatetime() - Birthdate) as Age\n</code></pre>\n\n<p>produces (surprisingly) : 1980</p>\n\n<p>What did I miss? I expected to get 80!</p>\n"},{"tags":["sql-server","ssis","expression"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13167562,"title":"How do I capture the single row value from Execute SQL Task that uses an expression?","body":"<p>I have an Execute SQL Task using this expression:</p>\n\n<pre><code>@[User::SQLExportError] + (DT_WSTR,30)@[User::Id]\n</code></pre>\n\n<p>The expression evaluates correctly to:</p>\n\n<pre><code>  select count(*) as ErrorTableCount from [myschema].Error \n    where SPName in ('export/INSERT','export/DELETE') and Id = 1000\n</code></pre>\n\n<p>In this same sql task I want to capture the <strong><code>as ErrorTableCount</code></strong> into a single row result set with the ResultName called: <em>ErrorTableCount</em> Variable Name called: <code>User::ErrorTableCount</code></p>\n\n<p>I am getting the red circle/x cross telling me: </p>\n\n<pre><code>There were errors during task validation.\n</code></pre>\n\n<p>There seems to be some conflict between using an expression for the sql source and within that expression containing the the dubbed count name defined under the result set. Any advice/ideas?</p>\n"},{"tags":["sql-server","tsql","escaping","character","like-operator"],"answer_count":5,"favorite_count":0,"up_vote_count":10,"down_vote_count":0,"view_count":6054,"score":10,"question_id":439495,"title":"How can I escape square brackets in a LIKE clause?","body":"<p>I am trying to filter items with a stored procedure using like. The column is a varchar(15). The items I am trying to filter have square brackets in the name.</p>\n\n<p>For example:  <code>WC[R]S123456</code>.</p>\n\n<p>If I do a <code>LIKE 'WC[R]S123456'</code> it will not return anything.</p>\n\n<p>I found some information on using the <code>ESCAPE</code> keyword with <code>LIKE</code> but I do not understand how to use it to treat the square brackets as a regular string.</p>\n"},{"tags":["sql-server","asp.net-mvc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13167499,"title":"How safe is MVC 4 Default Database?","body":"<p>Im kinda new at MVC 4 and im trying to learn it. I wanted to ask how safe is mvc 4 defaul databases.</p>\n\n<p>When i configure the project and enable role authorization it creates an ASPNETDB.mdf. Can i trust it and its default database in a big project?</p>\n"},{"tags":["sql-server","configuration"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13166772,"title":"How to control which SQL Server instance localhost points to","body":"<p>I have 2 instances of SQL Server on my PC, one is SQL Server 2008 R2, the other SQL Server 2012.</p>\n\n<p>If I use <code>LOCALHOST</code> when connecting to SQL Server, it goes to the SQL Server 2008 R2 instance.</p>\n\n<p>I want it to point to the SQL Server 2012 instance.</p>\n\n<p>Does anyone know how I can achieve this?</p>\n"},{"tags":["sql","sql-server","index"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":1,"view_count":47,"score":3,"question_id":13166071,"title":"Index structure to maximize speed across any combination of index columns","body":"<p>I have a database with about five possible index columns, all of which are useful in different ways.  Let's call them System, Source, Heat, Time, and Row.  Using System and Row together will make a unique key, and if sorted by System-Row the database will also be sorted for any combination of the five index variables (in the order I listed them above).</p>\n\n<p>My problem is that I use all combinations of these columns: sometimes I want to JOIN each System-Row to the next System-(Row+1), sometimes I want to GROUP or WHERE by System-Source-Heat, sometimes I want to look at all entries of System-Source WHERE Time is in a specific window, etc.</p>\n\n<p>Basically, I want an index structure that functions similarly to every possible permutation of those five indexes (in the correct order, of course), without actually making every permutation (although I am willing to do so if necessary).  I'm doing statistics / analytics, not traditional database work, so the size of the index and speed of creating / updating it is not a concern; I only care about speeding my improvised queries as I tend to think them up, run them, wait 5-10 minutes, and then never use them again.  Thus my main concern is reducing the \"wait 5-10 minutes\" to something more like \"wait 1-2 minutes.\"</p>\n\n<p>My sorted data would look something like this:</p>\n\n<pre><code>Sys So H Ti R\n1   1  0 .1 1\n1   1  1 .2 2\n1   1  1 .3 3\n1   1  2 .3 4\n1   2  0 .5 5\n1   2  0 .6 6\n1   2  1 .8 7\n1   2  2 .8 8\n</code></pre>\n\n<p>EDIT: It may simplify things a bit that System virtually always needs to be included as the first column to make any of the other 4 columns in sorted order.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":13156038,"title":"Speed up dividing date intervals by minutes in Sql Server","body":"<p>I need to divide some date intervals by minutes. (For example, 2012-01-01 10:00 - 2012-01-01 10:00 interval should be divided into 2012-01-01 10:01, 2012-01-01 10:02, ... 2012-01-01 10:10).\nFor example, there is a table</p>\n\n<pre><code>CREATE TABLE [dbo].[Events](\n    [ID] [int] IDENTITY(1,1) NOT NULL,\n    [EventStart] [datetime] NOT NULL,\n    [EventEnd] [datetime] NOT NULL,\n    [Amount] [float] NOT NULL,\n CONSTRAINT [PK_Events] PRIMARY KEY CLUSTERED \n(\n    [ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\n\nGO\n</code></pre>\n\n<p>This table is filled like</p>\n\n<pre><code>DECLARE @i integer = 0;\nDECLARE @initial_date datetime = '2012-01-01';\n\nWHILE @i &lt; 50000\nBEGIN\n    INSERT INTO [Events] (EventStart, EventEnd, Amount) VALUES (DATEADD(MINUTE, 10*@i, @initial_date), DATEADD(MINUTE, 10*(@i + 1), @initial_date), @i);\n    SET @i = @i + 1;\nEND\n</code></pre>\n\n<p>As a result we have many 10 minutes intervals.</p>\n\n<p>To divide it by minutes I use the following recursive CTE:</p>\n\n<pre><code>DECLARE @start_date datetime = '2012-01-01';\nDECLARE @end_date datetime = '2013-01-02';\n\n\nWITH Date_Ranges (StatDate, Amount, IntervalStart, CurrentMinute) AS (\n  SELECT \n    DATEADD(MINUTE, 0,  ev.EventStart) AS StatDate, ev.Amount, ev.EventStart AS IntervalStart, 1 AS CurrentMinute\n  FROM [Events] ev\n  WHERE ev.EventStart BETWEEN @start_date AND @end_date\n  UNION ALL\n  SELECT \n    DATEADD(MINUTE, CurrentMinute, ev.EventStart), ev.Amount, ev.EventStart AS IntervalStart, CurrentMinute + 1\n  FROM [Events] ev\n  INNER JOIN Date_Ranges ranges ON (ranges.IntervalStart = ev.EventStart AND \n    ranges.StatDate &gt;= ev.EventStart AND \n    ranges.StatDate &lt; ev.EventEnd)\n    WHERE DATEADD(MINUTE, CurrentMinute, ev.EventStart) BETWEEN @start_date AND @end_date AND\n        ev.EventStart BETWEEN @start_date AND @end_date\n) \n\nSELECT *\nFROM Date_Ranges --ORDER BY StatDate\n</code></pre>\n\n<p>The main problem is too slow execution of this recursive CTE on a large data amount.</p>\n\n<p>So, how can I speed up this?</p>\n"},{"tags":["sql-server","regex","tsql"],"answer_count":4,"favorite_count":4,"up_vote_count":30,"down_vote_count":2,"view_count":20498,"score":28,"question_id":194652,"title":"SQL Server Regular expressions in T-SQL","body":"<p>Is there any regular expression library written in <em>T-SQL</em> (no CLR, no extended sp, pure t-sql) for SQL Server?</p>\n\n<p>(should work with shared hosting)</p>\n\n<p>Edit:</p>\n\n<ul>\n<li><p>thanks I know about PATINDEX, LIKE, xp_ sps and CLR solutions</p></li>\n<li><p>I also know it is not the best place for regex, the question is theoretical:)</p></li>\n<li><p>reduced functionality is also accepted</p></li>\n</ul>\n"},{"tags":["sql-server","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13165754,"title":"Detach SQL DB accessed in multiple processes","body":"<p>I have a set of programs (consider parent and child processes) that access the same SQL database.  It is attached and detached during the course of the program(s).  I am having trouble only when I try and detach it when both processes have accessed it.  The connections are all closed, but if I try to execute the sp_detach stored procedure, I get an error message that it is in use and cannot be detached.  Is there something about the multi-process access that I need to address?</p>\n"},{"tags":["c#","sql-server"],"answer_count":7,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":266,"score":1,"question_id":10660261,"title":"datetime value in database","body":"<p>I updated the datetime to the datebase. It's 5/2/2012. But when I want to show this value from that database into a textbox it will show me : 05/02/2012.</p>\n\n<p>Please help me to solve this problem. I want to show it's value into the textbox like the format has been updated : 5/2/2010</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["c#","asp.net","html","sql-server","connection-string"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13166704,"title":"updating database from host using asp.net error 26","body":"<p>So Basically i have a POS system with its own database and my website which is hosted on a shared 1and1.com hosting company server which also contains a database with a database design needed. \nMy aim is to only upload those products that are active- true.</p>\n\n<p>My solution to update the website database from the POS database is to have a special admin page on the website that a connection string of the POS database is entered. The admin.aspx.cs calls a stored procedure that gets all the specific data from the POS database and insert them into the website database.</p>\n\n<p>This all works perfectly when testing on a colleagues machine acting as the website+ db.\nBut when it comes to loading on the 1and1.com host it returns an error 26.</p>\n\n<p>SqlException was unhandled A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified)</p>\n\n<p>The connection string is the following\nServer=IP_ADDRESS_OF_POS\\SQLEXPRESS;Database=CentricDatabase;User ID=centric;Password=XXXXXXXXX</p>\n\n<p>Does anyone have an idea why this isn't working on the host? but works on a colleagues machine?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":66,"score":2,"question_id":13151650,"title":"SQL Converting an INSERT SELECT to UPDATE as well","body":"<p>I have some SQL written up to address my problem but it is not quite ready. I have been attempting different queries for days now without much luck. FYI I inherited this DB so it may be a bit more advanced than what I am used to. </p>\n\n<p>There is a many-to-many relationship between Formula and Color using the bridge table FormulaColor. FormulaColor has the columns (FormulaId, ColorId, Percentage).</p>\n\n<p>My Business problem, we are converting all the formulas that use color A with the colors B(1%), C(2.8%) and D(96.2%). So if a Formula currently uses the color A as 50% of the formula then I would add a row for that formula with the B color and a percentage of .5%, a row for C color with a percentage of 1.4% and a row for D color with a percentage of 48.1%.</p>\n\n<p>The problem though, is a given formula that contains color A, may also already contain one or more of colors B, C or D. In that case I need to update the percentage by simply adding what was calculated above.</p>\n\n<p>The actual sql that I have so far is as follows. *Note that this is just for handling 1 of the new colors (ColorId=2594)</p>\n\n<pre><code>INSERT INTO FormulaColor (FormulaId, ColorId, Percentage) \nSELECT FormulaId, 2594 as ColorId, round((.01*FormulaColor.Percentage),2) as Percentage\nFROM FormulaColor WHERE ColorId=2595;\nDELETE FROM FormulaColor WHERE ColorId = 2595;\n</code></pre>\n\n<p>I was thinking that using the upsert method that uses @@rowscount is what I need? If so, I can't figure out how to do the update to just add the calculated amount to the percentage.</p>\n\n<p>Any help or resources is appreciated!</p>\n"},{"tags":["sql","sql-server","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13165703,"title":"SQL update table data query","body":"<p>I want to run update query to update PercentAvailability column value 0 to 100 between specified date period in my case <code>2012-10-28 03:31:01 to 2012-10-28 08:31:01</code>. see following picture.</p>\n\n<p><img src=\"http://i.stack.imgur.com/HQdGV.png\" alt=\"enter image description here\"></p>\n\n<p>How do i run query to update above data between specified date?</p>\n\n<p>Note: I have many ApplicationID which has this issue so how could i run query against all ApplicationID, I believe we need to run JOIN syntax but it would be good if you give some short of hint. </p>\n"},{"tags":["sql-server","sql-server-2008","matlab"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4383,"score":1,"question_id":6593485,"title":"How to connect to Microsoft SQL Server 2008 (MSSQL) from Matlab?","body":"<p>This is probably a simple question:</p>\n\n<ul>\n<li>How do I connect to Microsoft SQL Server 2008 R2 from Matlab?</li>\n<li>How do I read a table into a matrix given some SQL query?</li>\n</ul>\n\n<p><strong>Update</strong></p>\n\n<p>I'd prefer a method that doesn't require use of manual setup using ODBC.</p>\n"},{"tags":["sql-server","tsql","function"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":41,"score":3,"question_id":13166048,"title":"Execute WITH statement inside a function","body":"<p>I have the following code:</p>\n\n<pre><code>WITH OrderedOrders AS\n(\n\nSELECT *,  ROW_NUMBER() OVER (ORDER BY item) AS RowNumber\n from  dbo.fnSplit('1:2:3:5', ':')  \n)\n\n select * from OrderedOrders where rownumber =2\n</code></pre>\n\n<p>I need to run this code inside a function, however I just can't make the syntax right. Here's how it is right now:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[FN_INDICE_SPLIT]\n    (@sInputList VARCHAR(8000),@sDelimiter VARCHAR(8000),@INDICE INT)\n\nRETURN TABLE \n\n\n;WITH OrderedOrders AS\n( \nSELECT *,  ROW_NUMBER() OVER (ORDER BY item) AS RowNumber\n from  dbo.fnSplit(@sDelimiter, @INDICE)  \n)\nselect ITEM from OrderedOrders where RowNumber=@INDICE\n</code></pre>\n\n<p>If I try to execute this, it gives me this error:</p>\n\n<pre><code>Msg 156, Level 15, State 1, Procedure FN_INDICE_SPLIT, Line 4\nIncorrect syntax near the keyword 'RETURN'.\n</code></pre>\n\n<p>I've tried to do this in many ways, but I keep getting syntax errors and I don't know what's wrong.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":279,"score":1,"question_id":9846148,"title":"Pivot Multiple Rows","body":"<p>I have a table similar to the following:</p>\n\n<pre><code>id    key    str_val    date_val      num_val\n1     A      a\n1     B      b\n1     C                 2012-01-01\n1     D                               1\n2     A      c\n2     E      d\n2     C                 2012-01-02\n2     D                                2\n</code></pre>\n\n<p>I need it to look like:</p>\n\n<pre><code>id    A      B      C             D       E\n1     a      b      2012-01-01    1\n2     c             2012-01-02    2       d\n</code></pre>\n\n<p>Basically, each key needs to become it's own column</p>\n\n<p>I tried and failed to use the PIVOT command usefully, and I'm currently trying to accomplish this with a case statement. i.e.</p>\n\n<pre><code>select\n    id,\n    case key\n        when 'A'\n        then str_val\n    end as A,\n    case key\n        when 'C'\n        then date_val\n    end as C\n    --etc.\nfrom test_table\n</code></pre>\n\n<p>However I can't figure out how to combine the table rows after this runs. I'm stuck with:</p>\n\n<pre><code>id    A      B      C             D       E\n1     a\n1            b\n1                   2012-01-01\n1                                 1\n</code></pre>\n\n<p>Any thoughts or input that could help me out? Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","string-to-datetime"],"answer_count":10,"favorite_count":4,"up_vote_count":16,"down_vote_count":0,"view_count":81288,"score":16,"question_id":207190,"title":"Sql Server string to date conversion","body":"<p>I want to convert a string like this:</p>\n\n<pre><code>'10/15/2008 10:06:32 PM'\n</code></pre>\n\n<p>into the equivalent DATETIME value in Sql Server.</p>\n\n<p>In Oracle, I would say this:</p>\n\n<pre><code>TO_DATE('10/15/2008 10:06:32 PM','MM/DD/YYYY HH:MI:SS AM')\n</code></pre>\n\n<p><a href=\"http://stackoverflow.com/questions/202243/custom-datetime-formatting-in-sql-server\">This question</a> implies that I must parse the string into one of the <a href=\"http://msdn.microsoft.com/en-us/library/aa226054(SQL.80).aspx\" rel=\"nofollow\">standard formats</a>, and then convert using one of those codes.  That seems ludicrous for such a mundane operation.  Is there an easier way?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","cdc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13162619,"title":"Unable to restart CDC after making table changes","body":"<p>I need to add a couple of columns to CDC for a table that is already being tracked. My approach is as follows:</p>\n\n<pre><code>EXEC sys.sp_cdc_drop_job 'capture'\n\nBEGIN TRANSACTION\n\nBEGIN TRY\n    -- Copy existing data of the tracked table into a temporary table\n    SELECT * INTO CDC.dbo_MyTable_Temp FROM CDC.dbo_MyTable_CT\n\n    -- Add the new column to the temp table. This allows us to just use INSERT..SELECT * later\n    ALTER TABLE CDC.dbo_MyTable_Temp ADD MyColumn INT NULL\n\n    -- Disable CDC for the source table temporarily. This will drop the CDC table\n    EXEC sys.sp_cdc_disable_table @source_schema = 'dbo', @source_name = 'MyTable', @capture_instance = 'dbo_MyTable'\n\n    -- Reenable CDC for the source table. This will recreate the table with the new columns\n    EXEC sys.sp_cdc_enable_table @source_schema = 'dbo', @source_name = 'MyTable', @capture_instance = 'dbo_MyTable', @supports_net_changes = 1, @role_name = NULL, @filegroup_name = 'CDCGROUP'\n\n    -- Insert the old values into the CDC table\n    INSERT INTO cdc.dbo_MyTable_CT SELECT * FROM cdc.dbo_MyTable_Temp\n\n    -- Correct the start_lsn in CDC.change_tables. Otherwise all of the CDC stored procedures will be confused\n    -- and although the old data will exist in the table the functions won't return it\n    UPDATE cdc.change_tables SET start_lsn = (SELECT MIN(__$start_lsn) FROM cdc.dbo_MyTable_Temp) WHERE capture_instance = 'dbo_MyTable'\n\n    -- Drop the temp table\n    DROP TABLE cdc.dbo_MyTable_Temp\n\n    COMMIT TRANSACTION\nEND TRY\nBEGIN CATCH\n    ROLLBACK TRANSACTION\n    RAISERROR('Error!', 16, 1)\nEND CATCH\n\nEXEC sys.sp_cdc_add_job 'capture'\n</code></pre>\n\n<p>However, when the job runs again after being re-added it generates an error that there is a violation of the primary key constraint on <code>CDC.lsn_time_mapping</code>.</p>\n\n<p>Any suggestions?</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server","query","insert","where-in"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13165550,"title":"where in sql server query update number list one field to another","body":"<p>I am using SQL Server, and in the query below, I have a concern.  I am not sure if the field on the left will update with the field on the right (coming from the same table) when I do a where in list.</p>\n\n<pre><code>update loc \nset locShortName = locName \nwhere locid in (3,4,11,13,14,15,16,18,19,20,21,24,32,41,45,68,69,77,82,85)\n\nupdate loc set locShortName = locName where locid = 3 (move to next record in the list)      \nupdate loc set locShortName = locName where locid = 4 (move to next record in the list)\nupdate loc set locShortName = locName where locid = 11(move to next record in the list)\n</code></pre>\n\n<p>and so on...</p>\n\n<p>I would think it would take the fist number in the list and address the field value setting, then move to the next in the list.</p>\n\n<p>Are my expectations correct?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":[".net","asp.net","sql-server","nhibernate","distinct"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":6932,"score":1,"question_id":558974,"title":"NHibernate - SELECT DISTINCT equivalent for a page filter - Northwind","body":"<p>Lets say you are working in SQL 2005 with a copy of Northwind database installed.\nYour working on an ASP.NET application with an Employees \"browse\" page.\nAt the top of the page you have a \"Title\" filter where you would like to display these 5 choices in a dropdown:</p>\n\n<blockquote>\n  <p>[ALL]<br />\n  Vice President, Sales<br />\n  Sales Representative<br />\n  Sales Manager<br />\n  Inside Sales Coordinator  </p>\n</blockquote>\n\n<p>In T-SQL you would use something like the statement below to get your list.</p>\n\n<pre><code>SELECT DISTINCT Title FROM Employees ORDER BY Title\n</code></pre>\n\n<p>What is the best way of doing this in NHibernate? Assume that the initial database design is somewhat out of your control (just like Northwind)... Meaning that you won't be creating a Titles or Positions table for normalization. </p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13165512,"title":"Cannot create new user in sql server 2000 with same name as deleted username","body":"<p>We had to delete an old username from all our databases, however now when we try to add it back we are getting Error 15023 user already exists. I have checked all the databases to make sure that it does not and I have run </p>\n\n<pre><code>EXEC sp_change_users_login 'Auto_Fix', 'my_example_username'\n</code></pre>\n\n<p>However this fixed 0 and I am still getting the same error. I also tried putting the domain in front of my_example_username when running auto_fix, but still no luck.</p>\n\n<p>I create the user in the enterprise manager by going to logins and adding a new user.</p>\n\n<p>I am running windows server 2000, iis 6 and sql server 2003.</p>\n"},{"tags":["c#","sql-server","ms-office","office-interop"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13163805,"title":"Can i create a Microsoft Excel file without using Microsoft Interop Assembly?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1369361/how-can-i-programatically-create-read-write-an-excel-without-having-office-ins\">How can I programatically create, read, write an excel without having office installed?</a>  </p>\n</blockquote>\n\n\n\n<p>Can i create a Microsoft Excel file without using Microsoft Office Interop Assembly? \nI need to export all the values in a sql server table to an Excel file. Total number of rows can vary between 50000 to 1200000 rows.\nI need to generate the Excel file from my C#.net code where i will read the values of the table. The only restriction i have is I cannot use Microsoft Office Interop Assembly.</p>\n\n<p>I can't use CSV, or use the HTML table trick, because some of the files will contain multiple tabs, where each tabs will contain data from different tables.</p>\n"},{"tags":["c#","asp.net","sql-server","crystal-reports"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4550,"score":0,"question_id":5145044,"title":"passing multiple Parameter to crystal report in asp.net","body":"<p>I'm working on Visual Studio 2008 and SQL Server 2008, language C#</p>\n\n<p>Multiple parameter passing in crystal report in asp.net.\nI have two parameter @accountnumber and @customerid at time.\nI can only pass one parameter to my.</p>\n\n<p>Code is below.</p>\n\n<p>CrystalReportViewer1.LogOnInfo[0].ConnectionInfo.ServerName = \"CJ-PC\";</p>\n\n<pre><code>   CrystalReportViewer1.LogOnInfo[0].ConnectionInfo.UserID = \"sa\";\n\n   CrystalReportViewer1.LogOnInfo[0].ConnectionInfo.Password = \"***\";\n\n   CrystalReportViewer1.LogOnInfo[0].ConnectionInfo.DatabaseName = \"Online\";\n   string accountnumber = \"acc001\";\n   string customerID = \"cus001\";\n   ParameterField paramField = new ParameterField();\n   ParameterFields paramFields = new ParameterFields();\n   ParameterDiscreteValue paramDiscreteValue = new ParameterDiscreteValue();\n\n   paramField.Name = \"@account_number\";\n   paramDiscreteValue.Value = accountnumber;\n   paramField.CurrentValues.Add(paramDiscreteValue);\n   paramFields.Add(paramField);\n\n\n\n   CrystalReportViewer1.ParameterFieldInfo = paramFields;\n\n\n   ParameterField paramField1 = new ParameterField();\n   ParameterFields paramFields1 = new ParameterFields();\n   ParameterDiscreteValue paramDiscreteValue1 = new ParameterDiscreteValue();\n\n   paramField1.Name = \"@account_number\";\n   paramDiscreteValue1.Value = accountnumber;\n   paramField1.CurrentValues.Add(paramDiscreteValue1);\n   paramFields1.Add(paramField1);\n\n\n       paramField1.Name = \"@customer_id\";\n   paramDiscreteValue1.Value = customerID;\n   paramField1.CurrentValues.Add(paramDiscreteValue1);\n   paramFields1.Add(paramField1);\n\n   CrystalReportViewer1.ParameterFieldInfo = paramFields1;\n</code></pre>\n\n<p>Help me out.</p>\n"},{"tags":["sql","sql-server","sum","divide"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13163395,"title":"SQL division giving wrong answer","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/11112462/what-is-wrong-with-this-sql-server-query-division-calculation\">What is wrong with this SQL Server query division calculation?</a>  </p>\n</blockquote>\n\n\n\n<p>I am dividing two values in SQL like </p>\n\n<pre><code>SELECT SUM(totalCalls), \n    SUM(EnteredBTN), \n    SUM(EnteredBTN) * 100 / SUM(totalCalls),\n    SUM(EnteredACC), \n    SUM(EnteredACC) / SUM(totalCalls), \n    SUM(SentToTrans),\n    SUM(SentToTrans) * 100 / SUM(totalCalls),\n    SUM(Complete_Information), \n    SUM(Complete_Information) * 100 / SUM(SentToTrans) \n</code></pre>\n\n<p>Now when I do <code>SUM(EnteredACC)/SUM(totalCalls)</code> i.e <strong>7/48</strong>, it should give me <strong>.14</strong> but it gives <strong>0</strong> instead.</p>\n\n<p>When I do <code>SUM(EnteredACC)*100/SUM(totalCalls)</code> it should give <strong>14.58</strong> (or <strong>15</strong> when rounded off) but it gives <strong>14</strong> as the result. Can anyone help please?</p>\n"},{"tags":["sql-server","tsql","comparison","null"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":1092,"score":6,"question_id":3110980,"title":"Efficient way to compare for a NULL or value for a column in SQL","body":"<p>What's the efficient way to check for a null or value for a column in SQL query. Consider a sql table <code>table</code> with integer column <code>column</code> which has an index. <code>@value</code> can be some integer or null ex: 16 or null. </p>\n\n<p>Query 1: Not sure, but it seems one should not rely on the short-circuit in SQL. However, below query always works correctly when <code>@value</code> is some integer or null. </p>\n\n<pre><code>select * from\ntable\nwhere (@value is null or column = @value)\n</code></pre>\n\n<p>The below query is an expanded version of the above query. It works correctly too. </p>\n\n<pre><code>select * from \ntable \nwhere ((@value is null) \n    or (@value is not null and column = @value))\n</code></pre>\n\n<p>Would the above 2 queries would take the advantage of the index?</p>\n\n<p>Query 2: The below query compares the column with non-null <code>@value</code> else compares the column <code>column</code> with itself which will always be true and returns everything. It works correctly too. Would this query take advantage of the index?</p>\n\n<pre><code>select * from\ntable\nwhere (column = isnull(@value, column))\n</code></pre>\n\n<p>What's the best way? </p>\n\n<p>Note: If the answer varies with databases, I'm interested in MS-SQL. </p>\n"},{"tags":["c#","sql-server","stored-procedures","sqlparameters"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":13162848,"title":"SqlCommand stored procedure without a named parameter","body":"<p>I've written a query parser that should create a SqlCommand and execute a stored procedure.  The query for the stored procedure can come in many forms, including this one:</p>\n\n<pre><code>exec dbo.sp_StoredProcedureName 1599800\n</code></pre>\n\n<p>In this case, I create the SqlParameter this way:</p>\n\n<pre><code>var param = new SqlParameter() { Value = paramValue };\n</code></pre>\n\n<p>I get an error stating that '@Parameter1' is not a parameter for procedure sp_StoredProcedureName.</p>\n\n<p>Is there a way I can do this without running it as a standard query?  I'd like to keep it consistent and build the SqlCommand as a StoredProcedure type if possible.   </p>\n\n<p>I was thinking maybe I could reflect the parameter names of the stored proc first,  but wondering if there's another approach.</p>\n"},{"tags":["sql-server","database","query","table","select"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":13159879,"title":"SQL Select Data","body":"<p>I have a table set up, it is a customers' repayment schedule for a product.</p>\n\n<p>My table consists of the following fields:</p>\n\n<blockquote>\n  <p>SaleID | PaymentDueDate | AmountDue</p>\n</blockquote>\n\n<p>What I need for each Sale is:</p>\n\n<blockquote>\n  <p>SaleID | FirstPaymentDate | FirstPaymentValue | RegularPaymentValue | FinalPaymentvalue</p>\n</blockquote>\n\n<p>Each repayment schedule has the following characteristics:</p>\n\n<p>First payment amount is defined by the customer.\nRegular and final payments are dictated by the balance remaining.</p>\n\n<p>e.g</p>\n\n<p>Sale = 200\nTerm = 14 Weeks (14 Payments)</p>\n\n<p>First Payment = 50 (x1)</p>\n\n<p>Regular Payment = 12 (x12)</p>\n\n<p>Final Payment = 6 (x1)</p>\n\n<p>Please can you advise how I can retrieve what I need.</p>\n\n<p>ADDITION:\nCode So Far:</p>\n\n<p>This is what I have achieved so far, but this only gets me the First Payment and First Payment Date for each Sale:</p>\n\n<pre><code>SELECT      \nFP.SaleID, FP.FirstPaymentDate, RS.AmountDue AS FirstPayment \nFROM    \n(       \nSELECT SaleID, MIN(PaymentDueDate)AS FirstPaymentDate       \nFROM RepaymentSchedule          \nGROUP BY SaleID     \n) AS FP \nLEFT OUTER JOIN\nRepaymentSchedule AS RS ON FP.SaleID = RS.SaleID AND FP.FirstPaymentDate =   RS.PaymentDueDate ORDER BY RS.SaleID\n</code></pre>\n\n<p>ADDITION:\nData Sample:\n280 over 14 Weeks</p>\n\n<pre><code>SaleID  PaymentDueDate            AmountDue\n41      2012-08-29 00:00:00.000   120.00\n41      2012-09-05 00:00:00.000   12.30\n41      2012-09-12 00:00:00.000   12.30\n41      2012-09-19 00:00:00.000   12.30\n41      2012-09-26 00:00:00.000   12.30\n41      2012-10-03 00:00:00.000   12.30\n41      2012-10-10 00:00:00.000   12.30\n41      2012-10-17 00:00:00.000   12.30\n41      2012-10-24 00:00:00.000   12.30\n41      2012-10-31 00:00:00.000   12.30\n41      2012-11-07 00:00:00.000   12.30\n41      2012-11-14 00:00:00.000   12.30\n41      2012-11-21 00:00:00.000   12.30\n41      2012-11-28 00:00:00.000   12.40\n</code></pre>\n\n<p>I guess the FinalPaymentValue is not too crucial.</p>\n\n<p>Really I just need to know how to work out what the regular payment is.</p>\n"},{"tags":["php","sql-server","linux","apache","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13161698,"title":"MSSQL Field alias (AS) has stopped working","body":"<p>We are trying to move a Linux machine with PHP 5.2.1 to a virtual machine with PHP 5.3.3. Using Apache web server.</p>\n\n<p>All the scripts that have:</p>\n\n<pre><code>Select real_column as alias_column from some_table\n</code></pre>\n\n<p>return null for alias_column. \nIf we remove the \"as alias_column\" everything works correctly.</p>\n\n<p>We are using the LibTDS ODBC driver, connecting to MS-SQL 2008.</p>\n\n<p>Any ideas?\nThanks</p>\n"},{"tags":["asp.net","sql-server","datatable","dataset","datasource"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":29,"score":-1,"question_id":13162817,"title":"insert data from a DataTable into a dropdown","body":"<p>i want to fill a <code>dropdown</code> by a <code>datatable</code><br>\nbcoz i'v already a method <code>GetCate()</code> in bal, which returns <code>datatable</code> and now want to dynamically fill the data into a <code>ddl</code> with some <code>datasource</code> and <code>databind</code> script, could it b possible ???  </p>\n\n<p>why does not possible to assign a datatable into a dropdownlist???</p>\n\n<pre><code>public void BindCateDDL()\n{\n\n    DataTable dt = new BALCate().GetCate();        \n    ddl_filter_category_id.DataSource = dt;\n    ddl_filter_category_id.DataBind();\n}\n</code></pre>\n\n<p><strong>is this a right way to do this ???</strong></p>\n"},{"tags":["sql","sql-server","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":13162397,"title":"SQL - Execute stored procedure for all values in a table","body":"<p>I have a SQL stored procedure <strong>'A'</strong> which validates certain bank account information for a given account and it accepts the account number as an argument <strong>'arg1'</strong></p>\n\n<p>I want to execute the procedure for all values present in <strong>Column X</strong> of another table <strong>XXX</strong> (all bank Accounts present in the Accounts table)</p>\n\n<p>I am not sure if something like this would work</p>\n\n<pre><code>exec A @arg1 = X from XXX\n</code></pre>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server","index"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13161795,"title":"Is it redundant to define an index on the first column of a multi column primary key?","body":"<p>Is it redundant to add a separate, single-column index on the first field of a multicolumn primary key? Does it depend on the relative quantitiy of unique values in that first column compared to the size of the table?</p>\n\n<p>My specific scenario is that I'm building several moderately sized tables (20k - 500k rows) with two- and three-column primary keys. The first column in these tables is an integer which corresponds to a certain business activity (I'll just call it an \"activity\" here) and the second column is either a product ID (a UPC actually) or a business location identifier:</p>\n\n<pre><code>-- Activity - upc table: entire table is a two-column primary key\nCREATE TABLE activity_upc (\n    activity_id int NOT NULL,\n    upc_id dec(18,0) NOT NULL,\n    CONSTRAINT PRIMARY KEY PK_activity_upc CLUSTERED ( activity_id, upc_id )\n) \n\n-- One of several transaction tables, unique by activity, location, and date\n-- (date in SQL server is a 3-byte integer)\nCREATE TABLE activity_stuff (\n    activity_id int NOT NULL,\n    location_id smallint NOT NULL,\n    transaction_date date NOT NULL,\n    [ other columns ],\n    CONSTRAINT PRIMARY KEY PK_activity_stuff CLUSTERED ( \n        activity_id, location_id, transaction_date )\n)\n</code></pre>\n\n<p>There are several hundred unique locaton IDs, several thousand unique activity IDs, and over a million unique UPCs. I have an index on the <code>location_id</code> because it is very frequent to query just by <code>location_id</code>. <strong>Would it help, or be silly and redundant, to add a separate index on activity_id, which is also used frequently as a single-column filter?</strong></p>\n"},{"tags":["sql","sql-server","database","email","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":41,"score":-5,"question_id":13161237,"title":"Need advice on triggers in SQL Server","body":"<p>I am not much into SQL Server triggers etc and I have a question which may be very basic/simple.</p>\n\n<p>Questions</p>\n\n<ol>\n<li><p>I have a table in the SQL Server database which I want to send out emails to me whenever any records gets added/modified/deleted from that table (including if anyone truncates the table). </p></li>\n<li><p>I would also like to receive an email whenever any table or database restore takes place. </p></li>\n</ol>\n\n<p>Please suggest how to complete the above. I know I have to write triggers etc but I need some advice/assistance here.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":3,"up_vote_count":2,"down_vote_count":0,"view_count":79,"score":2,"question_id":13159526,"title":"Split values over multiple rows","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/5493510/turning-a-comma-separated-string-into-individual-rows\">Turning a Comma Separated string into individual rows</a>  </p>\n</blockquote>\n\n\n\n<p>I have the following output from a stored procedure and was wondering the best way to split the values into multiple rows.</p>\n\n<pre><code>reference   name                            subjects       subjectstitle\nLL9X81MT    Making and Decorating Pottery   F06,F27,F38       NULL\n</code></pre>\n\n<p>I need to trim the subjects field at the comma's and duplicate the information over three rows so the data would be as follows.</p>\n\n<pre><code>reference   name                            subjects       subjectstitle\nLL9X81MT    Making and Decorating Pottery   F06       NULL\nLL9X81MT    Making and Decorating Pottery   F27       NULL\nLL9X81MT    Making and Decorating Pottery   F38       NULL\n</code></pre>\n\n<p>I'm using MS SQL Server 2008 to setup these SP's and just need some help on how to split the subjects field up.</p>\n\n<p>Thanks,</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":37,"score":2,"question_id":13161044,"title":"Checking if a given date fits between a range of dates","body":"<p>If I have 2 date columns in a table, <code>startDate</code> and <code>endDate</code>.  How do I return rows where a given date fits between those 2 dates?  For example:</p>\n\n<p>If the given date is <code>2012-10-25</code></p>\n\n<p>It should return the following rows</p>\n\n<pre><code>startDate   -   endDate\n2012-10-25  -   2012-10-25\n2011-09-10  -   2013-11-15\n2012-10-20  -   2012-10-25\n2012-10-23  -   2012-10-28\n2012-09-14  -   2012-10-28\n</code></pre>\n\n<p>from the following rows:</p>\n\n<pre><code>startDate   -   endDate\n2012-10-25  -   2012-10-25\n2011-09-10  -   2013-11-15\n2012-01-11  -   2012-10-11\n2012-10-20  -   2012-10-25\n2012-04-15  -   2012-04-16\n2012-05-20  -   2012-05-25\n2012-12-01  -   2012-12-10\n2012-10-23  -   2012-10-28\n2012-09-14  -   2012-10-28\n2012-11-13  -   2012-12-15\n</code></pre>\n\n<p>Is this possible with sql?</p>\n\n<p>I am using sql server 2008.</p>\n"},{"tags":["sql-server","networking","connection"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13160625,"title":"Connection to SQL Server 2008/2012 with dynamic ports","body":"<p>My problem is that I can't connect to any SQL Server instance installed on our server (it has both 2008 and 2012) using dynamic ports. Static ports works well. Also, if you mention dynamic port number in connection string, you can connect. But connection failed (regular error \"Network or instance-specific...\") with named instance without port number.</p>\n\n<p>I found the solution - run <code>sqlbrowser.exe -c</code> on the server. After that everything works until server restarts. How to solve or diagnose it?</p>\n\n<p>P.S. Firewall is OFF.</p>\n\n<p><strong>EDIT:</strong>\nAlso, when I'm closing this tool, it becomes inavaliable again. I'm not always connected to server with remote desktop. Now it works only when I connected and started this tool. Looks not OK for me.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sqlperformance"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":19,"score":2,"question_id":13161170,"title":"MSSQL Server 2008 Performance issue with very strange resolution","body":"<p>I'm a long time DBA (12 years in SQL). I'm running sql2008 enterprise in a win 2008 clustered environment. 128gb memory and 32cpu in each cluster node. Not wimpy.</p>\n\n<p>I've got the wierdest performance issue I've seen to date, and its baffling me why it would occur...looking for ideas.</p>\n\n<p>Occasionally, maybe 2-3 times per week, the performance of queries made by the application to the database will come to a crawl. SPs that normally execute in 500ms, suddenly are up arond 50 seconds. Forget about saving data...application .net code will time out before the data even makes the trip.</p>\n\n<p>First time this happened was about 4 weeks ago. I kicked off a profiler so I could see if there were excessive queries or something, and didnt see anything strange. So, I copied one of the batches from the profile and executed it in SSMS. From that moment, the performance was perfect again. Application was snappy and no issues.</p>\n\n<p>Next time it happened, I remembered that just running a batch in ssms seemed to \"fix\" the issue. So I took some benchmarks first and did it again. Same thing. Running ANY batch in SSMS relieves whatever is happening. I have reproduced this about 15-18 times over the past 4 weeks: The application comes to a crawl, and then I run any query in ssms, and all is well.</p>\n\n<p>This is obviously a problem. In order to find out what is running or going on, I have to run a batch--which makes the problem stop. SO the act of trying to observe the issue resolves it. GAH!</p>\n\n<p>Note: There are two clustered instances running on the same node. Only one of the two experiences this issue. And they are roughly the same size in terms of disk space and activity.</p>\n\n<p>Anyone ever seen this?</p>\n"},{"tags":["sql-server","tsql","stored-procedures"],"answer_count":5,"favorite_count":21,"up_vote_count":38,"down_vote_count":0,"view_count":29916,"score":38,"question_id":43249,"title":"T-SQL stored procedure that accepts multiple Id values","body":"<p>Is there a graceful way to handle passing a list of ids as a parameter to a stored procedure.  For instance, I want departments 1, 2, 5, 7, 20 returned by my stored procedure.  In the past, I have passed in a comma delimited list of ids, like the below code, but feel really dirty doing it.  SQL Server 2005 is my only applicable limitation I think.</p>\n\n<pre><code>create procedure getDepartments\n        @DepartmentIds varchar(max)\nas\n    \tdeclare @Sql varchar(max)\n\n    \tselect @Sql = 'select [Name] from Department where DepartmentId in (' + @DepartmentIds + ')'\n\n    \texec(@Sql)\n</code></pre>\n"},{"tags":["sql-server","running-total"],"answer_count":9,"favorite_count":9,"up_vote_count":28,"down_vote_count":0,"view_count":23352,"score":28,"question_id":860966,"title":"Calculate a Running Total in SqlServer","body":"<p>Imagine the following table (called TestTable):</p>\n\n<pre>\nid     somedate    somevalue\n--     --------    ---------\n45     01/Jan/09   3\n23     08/Jan/09   5\n12     02/Feb/09   0\n77     14/Feb/09   7\n39     20/Feb/09   34\n33     02/Mar/09   6\n</pre>\n\n<p>I would like a query that returns a running total in date order, like:</p>\n\n<pre>\nid     somedate    somevalue  runningtotal\n--     --------    ---------  ------------\n45     01/Jan/09   3          3\n23     08/Jan/09   5          8\n12     02/Feb/09   0          8\n77     14/Feb/09   7          15  \n39     20/Feb/09   34         49\n33     02/Mar/09   6          55\n</pre>\n\n<p>I know there are <a href=\"http://geekswithblogs.net/Rhames/archive/2008/10/28/calculating-running-totals-in-sql-server-2005---the-optimal.aspx\" rel=\"nofollow\">various ways of doing this</a> in SQL 2000/2005/2008.</p>\n\n<p>I am particularly interested in this sort of method that uses the aggregating-set-statement trick:</p>\n\n<pre><code>INSERT INTO @AnotherTbl(id, somedate, somevalue, runningtotal) \nSELECT id, somedate, somevalue, null\nFROM TestTable\nORDER BY somedate\n\nDECLARE @RunningTotal int\nSET @RunningTotal = 0\n\nUPDATE @AnotherTbl\nSET @RunningTotal = runningtotal = @RunningTotal + somevalue\nFROM @AnotherTbl\n</code></pre>\n\n<p>... this is very efficient but I have heard there are issues around this because you can't necessarily guarantee that the UPDATE statement will process the rows in the correct order. Maybe we can get some definitive answers about that issue.</p>\n\n<p>But maybe there are other ways that people can suggest?</p>\n\n<p>edit: Now with a <a href=\"http://sqlfiddle.com/#!3/c8880/4\" rel=\"nofollow\">SqlFiddle</a> with the setup and the 'update trick' example above</p>\n"},{"tags":["sql-server","tsql","triggers"],"answer_count":7,"favorite_count":10,"up_vote_count":26,"down_vote_count":0,"view_count":54059,"score":26,"question_id":741414,"title":"Insert Update trigger how to determine if insert or update","body":"<p>I need to write an Insert, Update Trigger on table A which will delete all rows from table B whose one column (say Desc) has values like the value inserted/updated in the table A's column (say Col1). How would I go around writing it so that I can handle both Update and Insert cases. How would I determine if the trigger is executed for an update or insert.</p>\n"},{"tags":["sql-server","phonegap","csv","gps","couchdb"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13160189,"title":"Post data from PhoneGap App to Server","body":"<p>I'm working on a PhoneGap app by following this guide here: \n<a href=\"http://mobile.tutsplus.com/tutorials/phonegap/build-an-exercise-tracking-app-geolocation-tracking/\" rel=\"nofollow\">http://mobile.tutsplus.com/tutorials/phonegap/build-an-exercise-tracking-app-geolocation-tracking/</a></p>\n\n<p>However, the change I am looking to make is to have the data saved to a server automatically every 24hr period to a server. So I've been looking for the best way to do this, the data will basically just be a csv file containing gps coordinates and some uid information. </p>\n\n<p>The best lead I've found I believe is the suggestion in the second answer to this question:\n<a href=\"http://stackoverflow.com/questions/8343086/how-to-save-data-on-a-remote-server-from-an-app-jqmphonegap\">how to save data on a remote server from an app (jqm+phonegap)?</a></p>\n\n<p>Is there are more effective and simpler way to do this? Since all I am looking to do is store data to a server in raw format.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","hierarchy"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13158857,"title":"How to query and parse adjacent list hierarchy using cte?","body":"<p>How can I query this parent-child hierarchy to produce a result set in which the levels are in their own columns? Sample data:</p>\n\n<pre><code>SET NOCOUNT ON;\nUSE Tempdb;\n\nIF OBJECT_ID('dbo.Employees', 'U') IS NOT NULL DROP TABLE dbo.Employees;\n\nCREATE TABLE dbo.Employees\n(\n  empid   INT         NOT NULL PRIMARY KEY,\n  mgrid   INT         NULL     REFERENCES dbo.Employees,\n  empname VARCHAR(25) NOT NULL,\n  salary  MONEY       NOT NULL,\n  CHECK (empid &lt;&gt; mgrid),\n  CHECK (empid &gt; 0)\n);\n\nCREATE UNIQUE INDEX idx_unc_mgrid_empid ON dbo.Employees(mgrid, empid);\n\nINSERT INTO dbo.Employees(empid, mgrid, empname, salary) VALUES\n  (1,  NULL, 'David'  , $10000.00),\n  (2,  1,    'Eitan'  ,  $7000.00),\n  (3,  1,    'Ina'    ,  $7500.00),\n  (4,  2,    'Seraph' ,  $5000.00),\n  (5,  2,    'Jiru'   ,  $5500.00),\n  (6,  2,    'Steve'  ,  $4500.00),\n  (7,  3,    'Aaron'  ,  $5000.00),\n  (8,  5,    'Lilach' ,  $3500.00),\n  (9,  7,    'Rita'   ,  $3000.00),\n  (10, 5,    'Sean'   ,  $3000.00),\n  (11, 7,    'Gabriel',  $3000.00),\n  (12, 9,    'Emilia' ,  $2000.00),\n  (13, 9,    'Michael',  $2000.00),\n  (14, 9,    'Didi'   ,  $1500.00);\n\nselect * from dbo.Employees\ngo     \n\n;WITH Tree (empid, mgrid, lv)\nAS (\n\nSELECT empid, mgrid, 1\nFROM Employees\nWHERE mgrid IS NULL \n\nUNION ALL\n\nSELECT E.empid, E.mgrid, lv + 1\nFROM Employees AS E\nJOIN Tree\nON E.mgrid= Tree.empid\n)\nSELECT empid, mgrid, lv\nFROM Tree\nORDER BY Lv, empid\n</code></pre>\n\n<p>The resulting table should have a structure like</p>\n\n<pre><code>+-------+-----+--------+--------+--------+--------+--------+\n| empid | lvl | level1 | level2 | level3 | level4 | level5 |\n+-------+-----+--------+--------+--------+--------+--------+\n|     1 |   1 |      1 | NULL   | NULL   | NULL   | NULL   |\n|     2 |   2 |      1 | 2      | NULL   | NULL   | NULL   |\n|     3 |   2 |      1 | 3      | NULL   | NULL   | NULL   |\n|     4 |   3 |      1 | 2      | 4      | NULL   | NULL   |\n|     5 |   3 |      1 | 2      | 5      | NULL   | NULL   |\n|     6 |   3 |      1 | 2      | 6      | NULL   | NULL   |\n|     7 |   3 |      1 | 3      | 7      | NULL   | NULL   |\n|     8 |   4 |      1 | 2      | 5      | 8      | NULL   |\n|     9 |   4 |      1 | 3      | 7      | 9      | NULL   |\n|    10 |   4 |      1 | 2      | 5      | 10     | NULL   |\n|    11 |   4 |      1 | 3      | 7      | 11     | NULL   |\n|    12 |   5 |      1 | 3      | 7      | 9      | 12     |\n|    13 |   5 |      1 | 3      | 7      | 9      | 13     |\n|    14 |   5 |      1 | 3      | 7      | 9      | 14     |\n+-------+-----+--------+--------+--------+--------+--------+\n</code></pre>\n"},{"tags":["sql","sql-server","join","aggregate","coalesce"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":13157109,"title":"SQL query to display aggregated data when result is zero","body":"<p>I have a table with fields like this:</p>\n\n<pre><code>Item\nCategory\nYear \nMonth\nValue\n</code></pre>\n\n<p>I want to aggregate the result from this table to display sum(value) for each category, year and month. So I have this query:</p>\n\n<pre><code>SELECT Category, Year, Month, SUM(Value) \nFROM Table\nGROUP BY Category, Year, Month;\n</code></pre>\n\n<p>This works fine, but for months in which the sum is zero, the month is not displayed. I want all months to be displayed with zero for the total value where applicable.</p>\n\n<p>Ive tried doing <code>COALESCE(SUM(Value),0)</code>, but this didnt work.</p>\n\n<p>Ive tried creating a separate table (Table2) with the year and month values and then joining this with the first table:</p>\n\n<pre><code>SELECT Category, Year, Month, SUM(Value) \nFROM Table\nRIGHT JOIN Table2\nON Table2.Year + Table2.Month = Table.Year + Table.Month\nGROUP BY Category, Year, Month;\n</code></pre>\n\n<p>This doesnt work either. What am I doing wrong?</p>\n\n<p>Edit:</p>\n\n<p>I have tried Dems's solution, using the following query:</p>\n\n<pre><code>SELECT\n  Category.name,\n  Dates.Year,\n  Dates.Month,\n  SUM(Data.Value) AS Value\nFROM\n  Category\nCROSS JOIN\n  Dates\nLEFT JOIN\n  Data\n    ON  data.CategoryID = Category.ID\n    AND data.Year       = Dates.Year\n    AND data.Month      = Dates.Month\nWHERE data.Year BETWEEN #### and ####\n  AND data.Month BETWEEN # AND #\n  AND data.Property IN (A1,B1) \n  AND data.Property2 IN (C1,D1)\nGROUP BY\n  Category.name,\n  Dates.Year,\n  Dates.Month\n</code></pre>\n\n<p>The only differences as far as can see are that I'm using a where clause on data, and have missed of the ORDER BY, which shouldn't make a difference. But I'm still having no joy.</p>\n"},{"tags":["sql-server","scripting","dynamic-sql"],"answer_count":10,"favorite_count":22,"up_vote_count":22,"down_vote_count":0,"view_count":24290,"score":22,"question_id":21547,"title":"In SQL Server, how do I generate a CREATE TABLE statement for a given table?","body":"<p>I've spent a good amount of time coming up with solution to this problem, so in the spirit of <a href=\"http://stackoverflow.com/questions/21245/questions-vs-conveying-information\" rel=\"nofollow\">this post</a>, I'm posting it here, since I think it might be useful to others. </p>\n\n<p>If anyone has a better script, or anything to add, please post it.</p>\n\n<p>Edit: Yes guys, I know how to do it in Management Studio - but I needed to be able to do it from within another application.</p>\n"},{"tags":["sql-server","reporting-services","ssrs-2008","ssrs-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":11745610,"title":"Show Hidden Datasets in ssrs 2008","body":"<p>I am trying to show all hidden datasets created in SSRS report. I don't see the option \"Show Hidden dataset\" when I right click the Datasets folder. I tried the microsoft link too. How to show all hidden datasets please.</p>\n\n<p><a href=\"http://technet.microsoft.com/en-us/library/cc627463(v=sql.100).aspx\" rel=\"nofollow\">http://technet.microsoft.com/en-us/library/cc627463(v=sql.100).aspx</a></p>\n"},{"tags":["sql-server","intellisense","ssms","sql-server-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":103,"score":6,"question_id":12660746,"title":"Intellisense for JOINs in SQL Server Management Studio","body":"<p>In SQL Server Management Studio (SSMS) is there an option to enable intellisense auto-completion for JOINs?</p>\n\n<p>For example, if I type: </p>\n\n<pre><code>SELECT * FROM Employee INNER JOIN _\n</code></pre>\n\n<p>at this point I would like intellisense to give me the tables related to Employee, and when I pick one to fill in the appropriate join condition, based on the foreign key relationships.</p>\n\n<p>LinqPad does this for LINQ queries, which is great. I would like the same in SSMS. I am using SqlServer 2012.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","query-optimization"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13158956,"title":"UDF performance suddenly degraded","body":"<p>SQL Server 2008 R2</p>\n\n<p>I know this is a common problem (eg: <a href=\"http://connect.microsoft.com/SQLServer/feedback/details/524983/user-defined-function-performance-is-unacceptable\" rel=\"nofollow\">http://connect.microsoft.com/SQLServer/feedback/details/524983/user-defined-function-performance-is-unacceptable</a>) - but ive only just learned of it.</p>\n\n<p>We have a live production database that has performed fine for months, specifically a stored procedure that contains a large CTE that selects into a table variable. Then, based on a parameter on the procedure - data is selected from the table variable in various ways (column sequence, order by clause etc).</p>\n\n<p>This temporary table only has a few hundred rows inserted into it from the CTE - the source data is huge, but the resulting rows are always low in number)</p>\n\n<p>The select satements used on the table variable use 2 very simple UDF's:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[format_timeV2] ( @Time INT )\nRETURNS VARCHAR(20)\nAS \n    BEGIN\n        DECLARE @Time_Varchar VARCHAR(20)\n        SET @Time_Varchar = CONVERT(VARCHAR, @Time / 3600) + 'h ' + CONVERT(VARCHAR, ROUND(( ( CONVERT(FLOAT, ( @Time % 3600 )) ) / 3600 ) * 60, 0)) + 'm'\n        RETURN @Time_Varchar\n    END\nGO\n</code></pre>\n\n<p>And</p>\n\n<pre><code>CREATE FUNCTION [dbo].[udf_WeekEndDate] ( @Date DATETIME )\nRETURNS DATETIME\nAS \n    BEGIN\n        RETURN DATEADD(DAY, 7, CONVERT(DATETIME, CONVERT(VARCHAR(10), DATEADD(day, -1 - ( DATEPART(dw, @Date) + @@DATEFIRST - 2 ) % 7, @Date), 103) + ' 23:59:59', 103))\n    END\nGO\n</code></pre>\n\n<p>These UDF's have been working fine for months, if not years, the stored procedure in question has ALWAYS ran in under 6 seconds - but as soon as the UDF's above are included on the SELECT statement of the table variable the procedure takes MINUTES!</p>\n\n<p>As soon as we comment out the usage of these functions it returns to executing in 3-6 seconds.</p>\n\n<p>These functions are only being used on the <code>SELECT</code> from <code>@TableVar</code> statement (few hundred rows) - so i dont see why the query optimiser if struggling here?!?!</p>\n\n<p>If we run the following - the UDF's and procedure start to work normally again:</p>\n\n<pre><code>DBCC FreeProcCache\nDBCC DropCleanbuffers\n</code></pre>\n\n<p>So i can only assume the query optimiser is doing something stupid in the background - but it's not clear on the execution plan as to what it is.</p>\n\n<p>I have tried recreating the proc with <code>RECOMPILE</code> - this didnt help, only <code>FreeProcCache</code> &amp; <code>DropCleanbuffers</code> helped.</p>\n\n<p>Any ideas what the root cause of this? we dont really want to go re-writing all the UDFs as table valued function (which i understand is a work around for this problem) as this is a live production database which has been working fine for years.</p>\n\n<p><strong>EDIT 1:</strong> Blam requested detail of the actual query that hangs:</p>\n\n<pre><code>    IF @ModeInt = 2 \n        SELECT  [DET_NUMBERA] ,\n                [Name] ,\n                [Branch] ,\n                COUNT(*) OVER ( PARTITION BY [DET_NUMBERA] ) AS RowsForThisEmployee ,\n                CONVERT(VARCHAR(10), dbo.udf_WeekEndDate([Date]), 103) AS [WeekEnding] ,\n                [Date] ,\n                [Start Time] ,\n                [End Time] ,\n                [Duration] ,\n                dbo.format_timeV2([Duration] * 60) AS [DurationF] ,\n                [EntryCount] ,\n                [EntryColour] ,\n                [DurationColour] ,\n                [DurationComment]\n        FROM    @CompletedData\n        WHERE   [EntryCount] = 0\n        ORDER BY [DET_NUMBERA] ,\n                [Date] ,\n                [Start Time]\n\n    IF @ModeInt = 3 \n        SELECT  [DET_NUMBERA] ,\n                [Name] ,\n                [Branch] ,\n                COUNT(*) OVER ( PARTITION BY [DET_NUMBERA] ) AS RowsForThisEmployee ,\n                CONVERT(VARCHAR(10), dbo.udf_WeekEndDate([Date]), 103) AS [WeekEnding] ,\n                [Date] ,\n                [Start Time] ,\n                [End Time] ,\n                [Duration] ,\n                dbo.format_timeV2([Duration] * 60) AS [DurationF] ,\n                [EntryCount] ,\n                [EntryColour] ,\n                [DurationColour] ,\n                [DurationComment]\n        FROM    @CompletedData\n        WHERE   [EntryCount] &gt; 1\n        ORDER BY [DET_NUMBERA] ,\n                [Date] ,\n                [Start Time]\n</code></pre>\n\n<p>The temp table doesnt have an index (didnt think it was needed as it only ever contains 100 - 200 rows:</p>\n\n<pre><code>    DECLARE @CompletedData TABLE\n        (\n          [DET_NUMBERA] VARCHAR(7) ,\n          [Name] VARCHAR(255) ,\n          [Branch] VARCHAR(3) ,\n          [Date] DATE ,\n          [Start Time] TIME(0) ,\n          [End Time] TIME(0) ,\n          [Duration] INT ,\n          [EntryCount] INT ,\n          [EntryColour] VARCHAR(15) ,\n          [DurationColour] VARCHAR(15) ,\n          [DurationComment] VARCHAR(65)\n        )\n</code></pre>\n\n<p>The CTE populates the table in 3 seconds, its only the above SELETS that make use of UDF's that hang, if i remove the UDF's from the SELECT it works instantly.</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13158834,"title":"Instead of trigger behavior with CDC Tables","body":"<p>We're having an insted of trigger on view ( for DML operations ) .\nwe are trying to monitor the Activity on the view with CDC Tables and we've defined the base table (the one the view is based on ) as a CDC table . </p>\n\n<p>When we run an update command on the view ( the instead of trigger is fired ) the output in the cdc tables is one row for delete and one row for update ( operation code 1 and then operation code 2 ) , we expected to find one row with the value bedore ( operation code 3 ) and one row with the value after ( operation code 4).</p>\n\n<p>Do you know if this the normal behavior when update occures when instead of trigger is fired behind the scene (delete old record and insert new record ) ? </p>\n\n<p>Thx for the help . </p>\n"},{"tags":["sql-server","partitioning","indexes"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13158425,"title":"Partitions and Indexes, in which cases should be used","body":"<p>I know some knowledges:</p>\n\n<ul>\n<li><p>Partitions used to achieve better performance (like described in <a href=\"http://blogs.msdn.com/b/manisblog/archive/2009/01/18/easy-table-partitions-with-sql-server-2008.aspx\" rel=\"nofollow\">this</a> article)</p></li>\n<li><p>And indexes used to increase performance in selection operations.</p></li>\n</ul>\n\n<p>And as result my question: in which cases i should use indexes and in which cases i should use partitioned tables. </p>\n\n<p>In other words what should be better in different operations(selections,deletions,updates) indexes or partitioning of table, and why.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":59,"score":0,"question_id":13157750,"title":"Meaning of ; in queries","body":"<p>What is the meaning of ; at the end of queries?</p>\n\n<p>For example; what is the difference between:</p>\n\n<pre><code>select 1\nselect 2\n</code></pre>\n\n<p>and </p>\n\n<pre><code>select 1;\nselect 2\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13155383,"title":"How to use Group By with dynamic SQL query in Sql Server","body":"<p>I have a procedure which gets certain information. I have added a field to it which gets number of accounts. For this I have used the \"Count\" aggregate function to it. Now since Count has been added to it, it should have a group by function too. I am tryin to add Group By to it but cant find the exact syntax to use Group By with Dynamic SQL. Below is the query that is used with the procedure:</p>\n\n<pre><code>DECLARE @SQL  nvarchar(max),@paramlist nvarchar(max) \nSELECT @SQL = 'SELECT awt.AcctID, MIN(CAST(awt.autoEnter AS SMALLINT)) AS AutoApproved                \nFROM dbo.AccountWorkflowTask awt JOIN dbo.WorkflowTask wt ON awt.WorkflowTaskID = wt.WorkflowTaskID                \nWHERE (wt.TaskID IN (9, 17) AND ReasonIDExit = 1)'\n\nSELECT @SQL=@SQL+')) '                                    \nSELECT @SQL=@SQL+'SELECT a.ApplID, acct.AcctID, acct.dtApplication, ai.FName, ai.MName, ai.LName, ai.SSN, a.Email, ao.CompanyName,'                \nSELECT @SQL=@SQL+'ao.DBAName, ao.TaxID, acct.AcctNum, acct.AcctAffinityNum, luA.AffinityNum, luA.AffinityName, t.TaskDesc, awt.dtEnter, \nCount(DMA.AcctNum) As NoOfAccounts   FROM   dbo.Applicant a JOIN dbo.APPLICANTACCOUNT aa ON a.ApplID = aa.ApplID'\n\nJOIN 'TO SOME TABLE'\n\nWHERE 'Some Condition'\n</code></pre>\n\n<p>Now I want to use to Group By clause in order to get the count for NoOfAccounts. I am not able to get the syntax for it. Any help will be appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2008-r2","sql-server-2008-express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13156336,"title":"How to connect to SQL Server 2008 R2 using SQL Server 2008 Express via stored procedures","body":"<p>I need to know how to connect access the data from SQL Server 2008 R2 database using SQL Server 2008 Express through stored procedure.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","tsql","select","views"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13053668,"title":"Top results from multiple elections in T-SQL","body":"<p>I have a table with votes from multiple sectors (think of each sector as a state or similar) on multiple candidates. Each sector has multiple candidates, each with a different vote count.</p>\n\n<p>Here is my table (simplified)</p>\n\n<pre><code>CREATE TABLE [Results]\n(\n    [SectorID] BIGINT,\n    [CanditateID] BIGINT, \n    [VoteCount] BIGINT,\n    [Newness] DATETIME\n)\n</code></pre>\n\n<p>I obviously keep sector and candidate meta data in another table, but I need to find the highest voted candidate for each sector, so I can join those tables into a view.</p>\n\n<p>The best candidate in each sector, is determined by <code>[VoteCount]</code>, and if there are two with the same number of votes, it is determined by <code>[Newness]</code>. There must remain exactly one line per sector, and I have to be able to use it in a view, joined together with the meta data.</p>\n\n<p>How do I obtain the highest voted candidate from each sector?</p>\n"},{"tags":["c#","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":49,"score":3,"question_id":13106351,"title":"Issue related to Searching Data in SQL Server","body":"<p>I have SQL datatable StudetnMaster having FirstName nvarchar(100) and contains Data Entry Gujarati Lanuage (Unicode Chracters )</p>\n\n<pre><code>   StudentId   FirstName\n     1           \n     2              \n</code></pre>\n\n<p>now i have following query for searching :</p>\n\n<pre><code>Select * from StudetnMaster where FirstName like N'\" + textBox1.Text.Trim() + \"%' \n</code></pre>\n\n<p>its working fine:</p>\n\n<p>but in stiored procedure i have to pass parameter for FirstName as Follows:</p>\n\n<pre><code>ALTER PROCEDURE dbo.StoredProcedure1\n        @FirstName nvarchar(100)\n\nAS\n\n    select * from StudentNew where FirstName like N@FirstName+'%' \n</code></pre>\n\n<p>but it throws an Error saying : Invalid Column Name N@FirstName</p>\n\n<p>how can i use <code>'N'</code>  in storedProcedure for parameter because without using <code>N'</code> Unicode Text is not searchable: </p>\n\n<p>For inline query as mentioned above i got resut: but for stored procedure i got error: so how can we use     <code>'N'</code>  in storedprocedure?</p>\n\n<p>is there any other solution for searching unicode characters in storedrocedure?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","index","primary-key"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13147504,"title":"Is there a way to create a unique constraint on a column larger than 900 bytes?","body":"<p>I'm fairly new to SQL Server, so if anything I say doesn't make sense, there's a good chance I'm just confused by something. Anyway...</p>\n\n<p>I have a simple mapping table. It has two columns, <code>Before</code> and <code>After</code>. All I want is a constraint that the <code>Before</code> column is unique. Originally it was set to be a primary key, but this created errors when the value was too large. I tried adding an <code>ID</code> column as a primary key and then adding <code>UNIQUE</code> to the <code>Before</code> column, but I have the same problem with the max length exceeding 900 bytes (I guess the constraint creates an index).</p>\n\n<p>The only option I can think of is too change the <code>id</code> column to a checksum column and make that the primary key, but I dislike this option. Is there a different way to do this? I just need two simple columns.</p>\n"},{"tags":["sql-server","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":38,"score":-1,"question_id":13157277,"title":"Query in SQL Server (machines that are now in specific project)","body":"<p>I have a table including 3 fields which are <code>Machine Name</code>, <code>Project Name</code>, <code>Date Time</code>\nwhere <code>Date Time</code> indicates the exact time when machine was assigned to a project.</p>\n\n<p>Now I want to find machines which are now in a specific project (in fact it may be that one machine in different times be allocated to different projects).</p>\n\n<p>I want lasted specific project be latest project that machine assigned to it.</p>\n"},{"tags":["sql","sql-server","query","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13156493,"title":"How to create a list of dates from a daterange without using a CTE","body":"<p>The following link explains how to turn a date range into a list of dates.\nI used this approach and it works fine but the query is not performing (I used Maxrecursion 0 to unlimit).</p>\n\n<p><a href=\"http://blog.justinstolle.com/sql-turn-a-date-range-into-a-list-of-dates/\" rel=\"nofollow\">http://blog.justinstolle.com/sql-turn-a-date-range-into-a-list-of-dates/</a></p>\n\n<p>Is there any other solution to get this done? (using subquery or declare table?)</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","database-backups"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13137815,"title":"SQL Server backup devices","body":"<p>I'm trying to find out how to detect if a backup device exists using T-SQL.</p>\n\n<p>This is how I create my backup device:</p>\n\n<blockquote>\n  <p>EXEC master.dbo.sp_addumpdevice @devtype = N'disk', @logicalname =\n  N'TestTest', @physicalname = N'C:\\Program Files\\Microsoft SQL\n  Server\\MSSQL10_50.PTC_SQLPROD\\MSSQL\\Backup\\TestTest.bak'</p>\n</blockquote>\n\n<p>but I can't find how to detect if it already exists first.</p>\n"},{"tags":["c#","sql-server","winforms","tsql","smo"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":69,"score":3,"question_id":13090319,"title":"Could not load file or assembly 'Microsoft.SqlServer.Smo, Version=10.0.0","body":"<ul>\n<li>OS : Microsoft Windows NT 5.2.3790 Service Pack 2 Version: 2.0.50727.42 </li>\n</ul>\n\n<p>Doing: creating Tables... </p>\n\n<blockquote>\n  <p>Rec: system.m.FileNotFoundexception: could not load file or assembly\n  'microsoft.sqlserver.smo, version=10.0.0.0, culture=neutral File name:\n  'microsoft.sqlserver.smo, version=10.0.0.0, culture=neutral,\n  PublicKeyToken=89845dcd8080cc91' at\n  claimsure.Forml.Runsqlscript(string connstring, streamReader sr) at\n  myapp.Forml.bw_Dowork(object sender, DoworkeventArgs e) 'MN: Assembly\n  binding logging is turned OFF. To enable assembly bind failure\n  logging, set the registry value\n  (NKLm\\software\\microsoft\\Fusion!enableLog] (DwoRD) to 1. Note: There\n  is some performance penalty associated with assembly bind failure\n  logging. To turn this feature off, remove the registry value\n  (NKLm\\software\\microsoft\\Fusion!enableLog).</p>\n</blockquote>\n\n<p>I get the above error when running my application on a Windows 2003 server with SQL Server 2005.</p>\n\n<p>I know there is a solution to download SQLServer2005_XMO from <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=24793\" rel=\"nofollow\">http://www.microsoft.com/en-us/download/details.aspx?id=24793</a></p>\n\n<p>I have done this, but after the install a server reboot is required, which is not feasible for the time being. </p>\n\n<p>I need to make use of the server object.</p>\n\n<pre><code> using Microsoft.SqlServer.Management.Smo;\n using Microsoft.SqlServer.Management.Common;  \n\n        using (SqlConnection connection = new SqlConnection(connString))\n        {\n            Server server = new Server(new ServerConnection(connection));\n            server.ConnectionContext.StatementTimeout = 2400;\n            server.ConnectionContext.ExecuteNonQuery(sqlString);\n\n        }\n</code></pre>\n\n<p>Is is possible to load the dll in the same directory as my app and reference it from within the code? </p>\n\n<p>Thanks.    </p>\n\n<p>edit: added full error</p>\n"},{"tags":["sql-server","error-handling","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":69,"score":0,"question_id":13053240,"title":"How to convert blank into null in ssis","body":"<p>I am extracting data from excel in <code>ssis</code>. One of the excel column contain <code>blank</code> values. so i need to replace <code>blank</code> value with null otherwise my package is going to fail. \nAny suggessions?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13156202,"title":"can we pass alias name in reference on join condition in sqlserver","body":"<p>i have following query but when i pass reference name of this alias column name it is showing invalid column name how can i do this</p>\n\n<pre><code>select OM.*,\n       convert(int,Replace(Ltrim(Replace(left(OM.mstrefc,6), '0', ' ')), ' ', '0')) as partycode,\n       OI.*,\n       Ac.AcctName,\n       Ac.acctaddr,\n       UN.UnitName\nfrom ordemst OM\n  join ordeitd OI\n    on OM.mstCode = OI.ItdCode\n  join Account Ac \n    on OM.partycode = Ac.acctcode\n  left join unitdet UN\n    on OI.ItdUnit = UN.unitcode and \n       OI.CompCode = UN.CompCode \nwhere OM.MstCode = 47 and \n      OM.MstType =79 and \n      OM.CompCode =117 and \n      AC.compcode =117 and \n      OI.Compcode=117\n</code></pre>\n"},{"tags":["sql-server","parsing","text-parsing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":29,"score":-2,"question_id":13155750,"title":"SQL Server key value pair convert varchar to numeric without exceptions","body":"<p>I'm looking for tips on putting together a user defined function to convert a varchar to numeric.  The trick is i'm after one that converts common text representations of strings to numeric.  Also, if it can't be parsed as a numeric, i'd like it to return NULL rather than throwing an error and stopping the query.</p>\n\n<p>Examples:</p>\n\n<ul>\n<li>varchar '10%' should parse as numeric 0.1 (No remove % sign and divide by 100)</li>\n<li>varchar '$1,00.1234' should parse as numeric 100.1234 (remove $ sign and ,)</li>\n<li>varchar '$1k' should parse as numeric 1000  (k converts to multiply by 1 thousand)</li>\n<li>varchar '$1M' should parse as numeric 1000000  (m converts to multiply by 1 Million)</li>\n<li>varchar '$1B' should parse as numeric 1000000000 (b converts to multiply by 1 Billion)</li>\n<li>varchar '100   ' should parse as numeric 1000  (LTrim &amp; RTrim)</li>\n<li>varchar 'Random Text' should parse as numeric NULL  (Null won't thrown an error)</li>\n</ul>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13155171,"title":"Run code when page ends","body":"<p>hey hope someone can help me with this problem...</p>\n\n<p>I have a page that loads when a student logs in, and at the top there's a label that's represents the last time he/she has logged in... This date is stored in an table</p>\n\n<p>I tried using code that will update the date to todays date in the global.asax under </p>\n\n<pre><code>void Application_End(object sender, EventArgs e)\n{\n\n}\n</code></pre>\n\n<p>But seems like I cant use SQL connections there</p>\n\n<p>How do I change the date stored in the table to the (todays.date) once the user closes the site by exiting?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13155310,"title":"Can FORCE SCAN improve performance of query","body":"<p>I think FORCE SEEK can improve the performance of SELECT query, but wondering if FORCE SCAN can also improve performance of query.</p>\n\n<p>Can someone explain with example?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13155104,"title":"Select persons which have overlap with other table","body":"<p>I didn't even know how to come up with a good title, so i hope i can describe my problem oin a right way :)</p>\n\n<p>So i have a person table, and it has a N:N relationship with keywords via the table PersonKeywords.</p>\n\n<p>Then i also have a Search table, and it also has a N:N relationship with keywords via the table SearchKeywords.</p>\n\n<p>Now the person can have a relationship with keyword A and B, and the search record can have a relationship with the keywords A and C.</p>\n\n<p>Now i want the person in my resultset, because it has at least one (in this 'A') of the keywords the search record has.</p>\n\n<p>I also want the person who has 'A', the one with 'C', the one with 'A' and 'C', but not the one with only B.</p>\n\n<p>So it's a match on two lists, but i don't know where to start to create such a statement...</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13155123,"title":"How skip id's from parent table on base of child table values","body":"<p>I have two tables</p>\n\n<pre><code>table1  \n\nides    name\n\n1001    AA\n1002    BB\n1003    CC\n\n\ntable2      \n\nides    posi    cwawr\n\n1001    2   xyz\n1001    4   lmn\n1001    6   abc\n1002    2   ijk\n1002    4   lmo\n1002    6   pqr\n1003    2   xyz\n1003    4   sfs\n</code></pre>\n\n<p>in both above table i want to select the all ides of table1 where the posi not equal to 2 and cwawr not equal to xyz. for example 1001 posi has 2 and cwawr has xyz so this id should be skip. same 1003 also have posi value 2 and cwawr has xyz so it also should be skip.</p>\n\n<p>so in result it should be </p>\n\n<pre><code>1002 \n</code></pre>\n\n<p>only.</p>\n\n<p>Thanks in advance,\nEshwer</p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13084693,"title":"Query to display rows having duplicate values in 2 columns","body":"<p>I have Table1:</p>\n\n<pre><code>id|name|city\n-------------\n1 | bat|nyc\n2 | cat|del\n2 | rat|bom\n3 | mat|xyz\n</code></pre>\n\n<p>Table2</p>\n\n<pre><code>id|name|city\n--------------\n1 |bat|dsada\n2 |cat|sadasd\n3 |rat|sdasdas\n2 |rat|asdas\n</code></pre>\n\n<p>I need a query to display rows where BOTH id and name are same among two tables in above example the query must return \ni need a query to display the rows </p>\n\n<pre><code>1|bat|nyc\n2|cat|del \n</code></pre>\n\n<p>from first table</p>\n"},{"tags":["sql-server","wcf"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13155014,"title":"WCF: The provider did not return a ProviderManifestToken string","body":"<p>I just got this error and I thought I'd share it so that someone else doesn't spend an hour trying to figure out what's gone wrong.  I have SQL Server 2008 Express and a WCF service that was working fine.  All of a sudden it stopped working.  This was the error message</p>\n\n<blockquote>\n  <p>The server encountered an error processing the request. The exception\n  message is 'The provider did not return a ProviderManifestToken\n  string.'. See server logs for more details. The exception stack trace\n  is:</p>\n  \n  <p>at\n  System.Data.Common.DbProviderServices.GetProviderManifestToken(DbConnection\n  connection) at\n  System.Data.Entity.ModelConfiguration.Utilities.DbConnectionExtensions.GetProviderInfo(DbConnection\n  connection, DbProviderManifest&amp; providerManifest) at\n  System.Data.Entity.DbModelBuilder.Build(DbConnection\n  providerConnection) at\n  System.Data.Entity.Internal.LazyInternalContext.CreateModel(LazyInternalContext\n  internalContext) at\n  System.Data.Entity.Internal.RetryLazy<code>2.GetValue(TInput input) at\n  System.Data.Entity.Internal.LazyInternalContext.InitializeContext() at\n  System.Data.Entity.Internal.InternalContext.Initialize() at\n  System.Data.Entity.Internal.LazyInternalContext.get_ObjectContext() at\n  System.Data.Entity.DbContext.System.Data.Entity.Infrastructure.IObjectContextAdapter.get_ObjectContext()\n  at lambda_method(Closure , Object ) at\n  System.Data.Services.Providers.DbContextHelper.GetObjectContext(Object\n  o) at System.Data.Services.Caching.MetadataCache</code>1.TryLookup(Type\n  serviceType, Object dataContextInstance) at\n  System.Data.Services.Providers.BaseServiceProvider.LoadMetadata() at\n  System.Data.Services.DataService<code>1.CreateMetadataAndQueryProviders(IDataServiceMetadataProvider&amp;\n  metadataProviderInstance, IDataServiceQueryProvider&amp;\n  queryProviderInstance, BaseServiceProvider&amp; builtInProvider, Object&amp;\n  dataSourceInstance) at\n  System.Data.Services.DataService</code>1.CreateProvider() at\n  System.Data.Services.DataService<code>1.EnsureProviderAndConfigForRequest()\n  at System.Data.Services.DataService</code>1.HandleRequest() at\n  System.Data.Services.DataService`1.ProcessRequestForMessage(Stream\n  messageBody) at SyncInvokeProcessRequestForMessage(Object , Object[] ,\n  Object[] ) at\n  System.ServiceModel.Dispatcher.SyncMethodInvoker.Invoke(Object\n  instance, Object[] inputs, Object[]&amp; outputs) at\n  System.ServiceModel.Dispatcher.DispatchOperationRuntime.InvokeBegin(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage5(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage41(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage4(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage31(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage3(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage2(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage11(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage1(MessageRpc&amp;\n  rpc) at System.ServiceModel.Dispatcher.MessageRpc.Process(Boolean\n  isOperationContextSet)</p>\n</blockquote>\n"},{"tags":["sql-server","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13141241,"title":"create a statistics table using datetime MSSQL Query","body":"<p>I have little table which gives me a very hard time:</p>\n\n<pre><code>Person    datetime1                   datetime2\nEric      2012-10-01 09:00:05.000     2012-10-01 22:00:00.000\nAnna      2012-10-02 06:00:05.000     2012-10-03 12:00:05.000\nRichard   2012-10-03 09:00:05.000     2012-10-04 02:00:05.000\nChuck     2012-10-01 12:00:05.000     2012-10-01 23:00:05.000\n</code></pre>\n\n<p>I am trying to write a query, which gives me statistics table. This table contains information about when a user logged in and out (daily granularity):</p>\n\n<pre><code>Date        logged_in  logged_off\n2012-10-01  2          2\n2012-10-02  1          0\n2012-10-03  1          1\n2012-10-04  0          1\n</code></pre>\n\n<p>According to my research, a pivot command could solve the problem?</p>\n\n<pre><code>select Person,\nSUM(case when datetime1 = '2012-10-01' then 1 else 0 end) as [loggeed_in],\nSUM(case when datetime2 = '2012-10-01'  then 1 else 0 end) as [logged_of]\nfrom table\ngroup by Person\n</code></pre>\n\n<p>This is not working... Do you have any ideas?</p>\n"},{"tags":["sql","sql-server","xml","xquery"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13136311,"title":"How To retrieve value of an element from same name multiple elements in XML through xQuery?","body":"<p>I have and xml field like this in sql server</p>\n\n<pre><code>&lt;propertyDetail&gt;\n  &lt;importID&gt;1735532&lt;/importID&gt;\n  &lt;pincode /&gt;\n  &lt;landmarks /&gt;\n  &lt;features&gt;\n    &lt;feature&gt;Society  Name: sec-87 srs peral  floor faridabad&lt;/feature&gt;\n    &lt;feature&gt;Transaction: Resale Property&lt;/feature&gt;\n    &lt;feature&gt;Possession: Dec,2011&lt;/feature&gt;\n    &lt;feature&gt;*Ownership: Freehold*&lt;/feature&gt;\n    &lt;feature&gt;Age of Property: Under Construction&lt;/feature&gt;\n  &lt;/features&gt;\n&lt;/propertyDetail&gt;\n</code></pre>\n\n<p>I want to retrieve the feature which has value \"<strong>Ownership: Freehold</strong>\" through xQuery and sequence of features may vary.</p>\n\n<p>Welcome any suggestion.</p>\n"},{"tags":["c#","sql-server","transactions","entity-framework-4.1","dbcontext"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":13154383,"title":"Why there is no BEGIN TRANSACTION statment in SQL Profiler","body":"<p>I have two POCO objects, Customer and CustomerAddress as follows. </p>\n\n<pre><code>public partial class Customer\n    {\n        public Customer()\n        {\n            this.CustomerAddresses = new HashSet&lt;CustomerAddress&gt;();\n            this.Orders = new HashSet&lt;Order&gt;();\n        }\n\n        public int ID { get; set; }\n        public string LastName { get; set; }\n        public string FirstName { get; set; }\n        public string MiddleName { get; set; }\n        public System.DateTime DateOfBirth { get; set; }\n        public byte Gender { get; set; }\n\n        public virtual ICollection&lt;CustomerAddress&gt; CustomerAddresses { get; set; }\n        public virtual ICollection&lt;Order&gt; Orders { get; set; }\n    }\n\npublic partial class CustomerAddress\n    {\n        public int ID { get; set; }\n        public int CustomerID { get; set; }\n        public byte AddressType { get; set; }\n        public string Street { get; set; }\n        public string City { get; set; }\n        public string State { get; set; }\n        public string Country { get; set; }\n\n        public virtual Customer Customer { get; set; }\n    }\n</code></pre>\n\n<p>I am creating a new Customer object as follows.</p>\n\n<pre><code>Customer cust = new Customer();\n            cust.ID = 9;\n            cust.LastName = \"Ross\";\n            cust.FirstName = \"Taylor\";\n            cust.DateOfBirth = DateTime.Now;\n            cust.Gender = 0;\n\n            CustomerAddress custAdd = new CustomerAddress();\n            custAdd.ID = 9;\n            custAdd.Customer = cust;\n            custAdd.AddressType = 0;\n            custAdd.Street = \"1 Main Street\";\n            custAdd.City = \"Princeton\";\n            custAdd.State = \"CA\";\n            custAdd.Country = \"USA\";\n\n            DbConnection MyContext = new DbConnection(); ;\n            MyContext.Customers.Add(cust);\n            MyContext.CustomerAddresses.Add(custAdd);\n            MyContext.SaveChanges();\n</code></pre>\n\n<p>I launch SQL Profiler.  When this data is been saved, there are two insert script run against database, one for Customer and other for CustomerAddress. But my confusion is that I don't see any BEGIN TRANSACTION and COMMIT statements in SQL Profiler. If for some reason insert script for CustomerAddress fail, I would like whole transaction to fail and I am not sure if I will get it without a BEGIN TRANSACTION. Is there something I am doing wrong here? </p>\n"},{"tags":["sql","sql-server","insert","temptables"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13153420,"title":"Create temp table from provided variable column names","body":"<p>I want to create a temporary table, in which the columns will be those which I provide as parameter, separated by a delimiter. </p>\n\n<p>For example, if the column names are: id, name, address..the respective table should contain the same amount and header names of the columns. Similarly, next time the column number and names could vary. </p>\n\n<p>Any help in this regard?</p>\n"},{"tags":["c#",".net","sql-server"],"answer_count":8,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4559,"score":0,"question_id":1559493,"title":"SqlConnection throws an exception","body":"<p>Dear professionals please help me with the following problem.\nIn my .NET C# application a have this code:</p>\n\n<pre><code>SqlConnection connection = new SqlConnection( SQLCONNECTION_STRING );\n</code></pre>\n\n<p>It works marvelous on my development machine but throws an exception on Windows 2003 server. The application runs through CGI and has Full trust level.\nI've tried several connections strings and I think the string doesn't cause the issue because even this code gets an exception:</p>\n\n<pre><code>SqlConnection connection = new SqlConnection();\n</code></pre>\n\n<p>Thanks.</p>\n\n<hr>\n\n<p>I found two weird facts:\n1) It works if I connect debugger to process and simple trace the code.\n2) It works if I run the application from command line (not through CGI as required).</p>\n\n<p>So I guess something wrong with CGI and SqlConnection interaction. Does someone know about that?</p>\n\n<p>Thanks everybody for responses.</p>\n"},{"tags":["sql-server","tsql","stored-procedures","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":135,"score":0,"question_id":13143386,"title":"How to automate the execution of a stored procedure with an SSIS package?","body":"<p>I have a stored procedure that gets executed through SQL SSIS using a Execute SQL Task.</p>\n\n<p>The task has the following:</p>\n\n<pre><code>USE [OPPY_DWUSD]\nGO\nDECLARE @return_value int\nEXEC    @return_value = [dbo].[generate_merge_scdbk]\n    @Schema = N'dim',\n    @Dimension = N'VARIETY',\n    @ETLSchema = N'stg',\n    @ETLTable = N'vw_VARIETY',\n    @Execute = 1\n\nSELECT  'Return Value' = @return_value\nGO\n</code></pre>\n\n<p>Right now the way I have this setup, I have multiple Execute SQL Tasks with the same code but different values, about 20 Execute SQL Tasks.</p>\n\n<p>Is there a more cleaner way to pull this off?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13148625,"title":"PROBLEMA SQL SERVER ROLLBACK trigger","body":"<p>good afternoon,\nI have a problem with the rollback ... Treger initially was using to call the procedure and the procedure is triggered rollback but it is ...\nNow I'm trying to do the rollback from trigger nor ...</p>\n\n<p>attached the code and the error</p>\n\n<p>Thanks for your help</p>\n\n<pre><code>USE [Desarrollo_Pruebas]\nGO\n/****** Object:  Trigger [dbo].[Prueba_tre]    Script Date: 10/30/2012 17:02:53 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER TRIGGER [dbo].[Prueba_tre] \n   ON  [dbo].[Cliente]\n    FOR INSERT\nAS \nBEGIN\n\n SET NOCOUNT ON;\n\nbegin try\n    BEGIN TRAN t1\n    SAVE TRAN t1\n    INSERT INTO Articulo (Articulo_Codigo, Articulo_Descripcion, Valor_unitario, Categoria_id, msg) VALUES (1040,'EURECA',15000,5,'')\n    COMMIT \n    --raiserror ('Test error',16,1)\nend try\n\nbegin catch\n    ROLLBACK TRAN t1\n    SELECT    ERROR_NUMBER() AS ERROR_NUMBER, ERROR_MESSAGE() AS ERROR_MESSAGE;\nend catch\n\n--SET NOCOUNT ON;\n--exec Prueba CLIENTE_ID;\n\nEND\n</code></pre>\n\n<p>Msg 3931, Level 16, State 1, Procedure Prueba_tre, Line 21\nThe current transaction cannot be committed and cannot be rolled back to a savepoint. Roll back the entire transaction.</p>\n\n<p>THE TABLE IS </p>\n\n<p>the idea is that when I insert into customers products with an insert update ..\nat the end of this transaction need to return from the console</p>\n\n<pre><code>CREATE TABLE Articulo\n(\n   Articulo_Codigo int not null primary key\n   , Articulo_Descripcion varchar (100)\n   , Valor_unitario int\n   , Categoria_Id int not null constraint fk_Categoria references Categoria (CATEGORIA_ID)\n)\n\nCREATE TABLE Cliente\n(\n   CLIENTE_ID int not null primary key\n   , CLIENTE_PRIMER_NOMBRE varchar(50)\n   , CLIENTE_SEGUNDO_NOMBRE varchar(50)\n   , CLIENTE_PRIMER_APELLI varchar(50)\n   , CLIENTE_SEGUNDO_APELLI varchar(50)\n   , CLIENTE_DIRECCION varchar(90)\n   , CLIENTE_TELEFONO int\n   , CLIENTE_CIUDAD varchar(50)\n)\n</code></pre>\n"},{"tags":["sql","sql-server","metadata"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4520,"score":0,"question_id":2903262,"title":"Sql Query to list all views in an SQL Server 2005 database","body":"<p>I need an sql query to enumerate all views (I only need the view names) of a specific database in SQL Server 2005. Thanks in advance!</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13153255,"title":"How to do mutual comparison after group by in a SQL query?","body":"<p>I have a table <code>Information</code> which is something like this:</p>\n\n<pre><code>ID    From     To        Product          Date  \n1         A         B          ProdA         2012-10-01  \n2         A         B          ProdA         2012-10-13  \n3         A         B          ProdB         2012-10-17  \n4         A         B          ProdC         2012-10-18  \n5         A         C          ProdB         2012-10-02  \n6         A         C          ProdC         2012-10-04  \n7         A         C          ProdD         2012-10-12  \n8         A         C          ProdE         2012-10-14  \n9         A         D          ProdA         2012-10-11  \n10       A         D          ProdA         2012-10-14  \n</code></pre>\n\n<p>Let's call the combination of From and To a relationship. So (A,B) and (A, C) are relationships.<br>\nWhat I need to do is to find those relationships sending/receiving <strong>different</strong> products within a week time period. So in the above example the query is supposed to return:</p>\n\n<pre><code>A    B\nA    C\n</code></pre>\n\n<p>since these rows match:</p>\n\n<pre><code>2         A         B          ProdA         2012-10-13  \n3         A         B          ProdB         2012-10-17  \n4         A         B          ProdC         2012-10-18  \n\n5         A         C          ProdB         2012-10-02  \n6         A         C          ProdC         2012-10-04  \n\n7         A         C          ProdD         2012-10-12  \n8         A         C          ProdE         2012-10-14  \n</code></pre>\n\n<p>I know I should start from <code>SELECT ID, From, To, Product, Date FROM Information GROUP BY From, To</code> but I have no idea what's next. Any help please?</p>\n"},{"tags":["c#","sql-server","ef-code-first","entity-framework-5","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13141710,"title":"How can I perform additional DB initialization when using EF (5) Code First Migrations","body":"<p>I'm moving my ef-code-first application to the code-first-migrations model, and switching my database initializer from <code>DropCreateDatabaseIfModelChanges</code> to <code>MigrateDatabaseToLatestVersion</code>.</p>\n\n<p>In my original initializer, I was creating some user-defined functions, etc. and making changes to the database configuration (e.g. <code>SET AUTO_CLOSE OFF</code>). All of that stuff was achieved by executing SQL directly against the DB, since it's not supported via EF.</p>\n\n<p>Now that I've moved over to the migrations model, I'm attempting to do much the same, by adding code to the <code>Up</code> method of the generated <code>DbMigration</code> class. This code uses the <code>Sql</code> method to inject SQL. </p>\n\n<p>However, I'm getting various errors as a result, such as:</p>\n\n<ul>\n<li><p>My SQL to create the user-defined functions cause an error saying that the <code>CREATE FUNCTION</code> statement must be at the start of a batch.</p></li>\n<li><p>My <code>ALTER DATABASE</code> statement causes an error saying that it cannot be used inside a user transaction. (I don't create a transaction, but presumably there is one already started).</p></li>\n</ul>\n\n<p>How can I overcome this? In the <code>DbMigration</code>-derived class, I don't seem to have access to a DbContext, so I can't get at the database directly.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13153648,"title":"MSSQL - Return Select","body":"<p>I would like to prepare procedure which will take 2 arguments (Int, string) If some row will exist in table I will get @dane = 1; and in the end I would like to select @dane but my procedure is not good. I can not use return @dane. </p>\n\n<pre><code>    USE [SS]\n    GO\n\n    SET ANSI_NULLS ON\n    GO\n    SET QUOTED_IDENTIFIER ON\n    GO\n\n    CREATE PROCEDURE [permission].[CheckSkill] \n(\n    @SkillId INT, -- Identyfikator uytkownika \n    @Description NVARCHAR(100) = NULL\n)\nAS\nBEGIN\n    SET NOCOUNT ON;\n    DECLARE @dana as int\n    SET @dana = 0\n\n    -- this is redundant:\n    --SET @Description = RTRIM(LTRIM(ISNULL(@Description,'')))\n\n    IF EXISTS (SELECT * FROM permission.UserXSkill Where permission.UserXSkill.SkillId = @SkillId)\n    BEGIN\n      SET @dana = 1;\n    END\n\n    SELECT @dana AS ID;\nEND\nGO\n</code></pre>\n\n<p>Topic [closed] Thanks for help.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13153235,"title":"Dynamic backup file name","body":"<p>I use <code>SQL Server 2008 R2</code> and want to use <code>Backup Devices</code> for create backup of my database in each day. How can I create dynamic file name in `Backup Devices'.</p>\n\n<p>In below code I Create a Backup Devices but want to have Current Date (YYYY-MM-DD) in my backup file.</p>\n\n<pre><code>EXEC master.dbo.sp_addumpdevice  @devtype = N'disk', @logicalname = N'My Database Backup Location', @physicalname = N'D:\\Backup\\Backup YYYY-MM-DD.bak'\n</code></pre>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","iis6","telnet","database-administration"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13153485,"title":"Telnet failed from App server to sql server DB server intermittently","body":"<p>recently I noticed one interesting issue in production server. We have 1 app server IIS asp .net framework and 1 sql server 2008 installed DB server.</p>\n\n<p>During peak time when I try to telnet my db server on 1433 its keep getting failed but sometimes its get connected. Both these servers are blade server and are in same chassis. No network firewall is in between all the two servers.</p>\n\n<p>Also in application logs its shows error like </p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occurred while\n  establishing a connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote ... Provider, error: 40 -\n  Could not open a connection to SQL Server)</p>\n</blockquote>\n\n<p>I checked number of connection on my db using command </p>\n\n<pre><code>SELECT  COUNT(dbid) as TotalConnections \nFROM sys.sysprocesses \nWHERE  \ndbid &gt; 0 \n</code></pre>\n\n<p>its approximately to 140-150 connections we have multiple databases (~100) on it.</p>\n\n<p>I will appreciate if any body can help me in troubleshooting this issue.</p>\n"},{"tags":["sql-server","stored-procedures","permissions"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1668,"score":3,"question_id":5109581,"title":"Granting execute permission on all stored procedures in a certain database","body":"<p>As the title suggests, I need to grant the execute permission on every stored procedure in a database. We've moved from test to production and have less control over the production database.. and all of the imported stored procedures got zero permissions right now. An interesting thing to know is if there is any way to make sure all of the imported stored procedures get execute permissions from the beginning?</p>\n\n<p>Thanks for any help.</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13152815,"title":"How to insert numbers in words for the numeric value using triggers in sql?","body":"<p>I need to get the amount in words automatically after I enter the amount in numeric.</p>\n\n<p>eg: If I enter 2500, It should be automatically insert in the next field as Two thousand five hundred. </p>\n\n<p>Is it possible in sql server pls guide with explanation. Thanks.</p>\n"},{"tags":["sql-server","pagination","paging"],"answer_count":9,"favorite_count":32,"up_vote_count":42,"down_vote_count":0,"view_count":19725,"score":42,"question_id":109232,"title":"What is the best way to paginate results in SQL Server","body":"<p>What is the best way (performance wise) to paginate results in SQL Server 2000, 2005, 2008 if you also want to get the total number of results (before paginating)?</p>\n"},{"tags":["sql","sql-server","performance","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":13140520,"title":"Simple SQL Server query across databases runs extremely slow R2","body":"<p>I have two databases on a local machine, connected to <code>localhost</code>.  They both have roughly two million rows a piece.  I was doing the following very simple join and it took over a minute to complete.  </p>\n\n<pre><code>select distinct x.patid\n    from [i 3 sci study].dbo.clm_extract as x\n    left join [i 3 study].dbo.claims as y on y.patid=x.patid\n    where y.patid is null\n</code></pre>\n\n<p>When I looked at the execution plan I saw that the join showplan operator had this to say\n<img src=\"http://i.stack.imgur.com/eQAu6.jpg\" alt=\"enter image description here\"></p>\n\n<p>Why is the actual number of rows so exorbitantly high compared to the actual number of rows in both tables?</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":13152887,"title":"Inserting a Row in a Table from Select Query","body":"<p>I'm using two Stored Procedures and two Table in My Sql Server.</p>\n\n<p>First Table Structure.</p>\n\n<p><img src=\"http://i.stack.imgur.com/kdhvO.jpg\" alt=\"enter image description here\"></p>\n\n<p>Second Table Structure.</p>\n\n<p><img src=\"http://i.stack.imgur.com/6C43X.jpg\" alt=\"enter image description here\"></p>\n\n<p>When a Customer books a Order then the Data will be Inserted in Table 1.</p>\n\n<p>I'm using a Select Query in another Page Which Selects the Details from the Second Table.</p>\n\n<p>If a row with a billno from first table is not Present in Second Table I want to Insert into the Second Table with some Default Values in the Select Query. How can I do this\n??</p>\n"},{"tags":["sql-server","asp.net-mvc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13146288,"title":"Month and Year Part from GetDate","body":"<p>I am using a gridview in my asp.net application in which i want to limit the dataset to requests that are submitted in the current month and year</p>\n\n<p>Iam new to application development and thinking in the below way</p>\n\n<p>to get the month and year part from the getdate() function and then compare it with the month and year of the receiveddate column in our table in the where condition</p>\n\n<p>My select statement would be like below</p>\n\n<p>select requestno,receiveddate,businessneed from customerrequests\nwhere receiveddate = getdate()</p>\n\n<p>in the above sql statement how do i acheive </p>\n"},{"tags":["asp.net","sql-server","iis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13152623,"title":"DB Connection ERROR after publishing the web application in IIS 6","body":"<p>After publishing web application in IIS 6 I am getting follwoing error</p>\n\n<pre><code>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server) \n</code></pre>\n\n<p>It runs fine in development server with same DB connection</p>\n\n<p>Please help me</p>\n"},{"tags":["c#","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":56,"score":5,"question_id":13047940,"title":"Issue Related to where clause in SQL Server","body":"<p>I have a table name Students having (studentId, StudentName,Address,PhoneNo)</p>\n\n<p>i have provided a filter for user to select only StudentId from Combobox to get the details of Students... and generate Report.</p>\n\n<p>I have written following Query to get student Detail :</p>\n\n<pre><code>(select * from Students where StudentId = stdId)\n</code></pre>\n\n<p>Here stdId is a Parameter that i pass from code</p>\n\n<p>It works fine if i select single studentId.... But in user selection Comobobox i have also provided <code>\"ALL\"</code>  if user Select <code>All</code> from combobox i want to display details of all student</p>\n\n<p>So what should I pass in <code>stdId</code> if user selects <code>All</code>  ?</p>\n\n<p>I used inline Query in C# (not using SQL Stored Procedure)</p>\n"},{"tags":["sql-server","performance"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":420,"score":0,"question_id":2042484,"title":"Ways to improve sql server query optimizer results","body":"<p>The question is quite simple: <b>What can I do to make sure that the SQL Server query optimizer has all the information it needs to choose the \"best\" query plan?</b></p>\n\n<p>The background of this question is that recently we've run into more and more cases where SQL Server chooses a bad query plan, i.e., cases, where adding query hints, join hints or explicitly using temporary tables instead of \"one big SQL\" drastically improved performance. I'm actually quite surprised that the query optimizer delivers such a lot of bad results, so I'm wondering whether we did something wrong. No indexes are missing (according to query analyzer and common sense), and statistics are updated frequently by a maintainance task.</p>\n\n<p>Let me emphasize that I am not talking about missing indexes here! I'm talking about the situation where there is a \"good\" and a \"bad\" query plan (given the current state of the DB), and SQL Server chooses a \"bad\" plan although the indexes present would allow it to use a \"good\" plan. I'm wondering whether there is some possibility to <em>improve</em> the results of the query optimizer without having to optimize all queries manually (with query hints or USE PLAN).</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13149601,"title":"How can I update by one UPDATE statement in SQL server for the following scenario?","body":"<p>How can I update by one UPDATE statement for the following scenario?\nI have 2 tables. The TableA contains the following fields:\nTestNumber, CO, CO2, N20, CH4\nand the value of TestNumber column is 1, 2, 3</p>\n\n<pre><code>TableA\n\nTestNumber      CO      CO2     N2O     CH4  \n 1                                                              \n 2                                                              \n 3  \n</code></pre>\n\n<p>The second table named TableB contains the following fields:\nTestNumber, TestIdentifier, TestValue\nand the values are the below:</p>\n\n<pre><code>TableB\n\nTestNumber      TestIdentifier  TestValue      \n 1                 CO           12.3   \n 1                 CO2          10     \n 2                 CO           9.8    \n 2                 N20          45     \n 3                 CO           12.5   \n 3                 CO2          13.0  \n</code></pre>\n\n<p>IM EXPECTING THE RESULT AS:</p>\n\n<pre><code>TestNumber      CO      CO2     N2O     CH4   \n 1              12.3    10                                             \n 2              9.8             45                                     \n 3              12.5    13.0        \n</code></pre>\n\n<p>I did it using a chunk of code like, declare table variable. Then store data from TableB to the table variable. Then SET rowCount =1 then looping and deleting one row and update the TableA which work perfect. I got my expected result. But I believe I can do direct UPDATE command without too many table variables declaration and looping. Im updating though but not directly.</p>\n\n<p>I want to learn how I can update directly without looping.</p>\n\n<p>Reply to: </p>\n"},{"tags":["c#","sql-server","petapoco"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13152185,"title":"PetaPoco transaction isolation level","body":"<p>I have a c# windows service which updates data in my database using <a href=\"http://www.toptensoftware.com/petapoco/\" rel=\"nofollow\">PetaPoco</a>, all wrapped into a transaction. However, I need the database to be available for queries while the transaction runs (web app, running queries through an ODBC connection), but if queried while the transaction is being committed, I get a \"Catastrophic failure\" error from my database. Currently testing against MS SQL Server, but also need this working against Oracle databases. </p>\n\n<p>Is there any way to set the transaction isolation level for PetaPoco transactions, and could this be the solution in this case? </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13137052,"title":"Error in running scheduled Job. Where to find error details","body":"<p>I want to delete row in SQL database when a column value matches with current date.\nI have created a scheduled job for deletion of data using SQL Server Management Studio. I have followed step as shown in <a href=\"http://www.youtube.com/watch?v=De_GOwnTDjo\" rel=\"nofollow\">Video</a> \nHere Type of script is T-SQL and command I have given is:</p>\n\n<pre><code>Delete from NewDB.dbo.Datetabel where Date=getDate();\nCOMMIT\n</code></pre>\n\n<p>I want to schedule this job on daily basis. But now for testing purpose I have given on hourly basis. But this job is failed.</p>\n\n<p>Where will I get the details of Error. I am working on sql2008 r2</p>\n\n<p>What should be reason for failure?\nEdited:\nNow job is getting success when code is  changed as:</p>\n\n<pre><code>BEGIN TRAN \nDelete from NewDB.dbo.Datetabel where Date=getDate();\nCOMMIT;\n</code></pre>\n\n<p>But Data is not deleted from the tabel.\nWhat may be issue now?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":13150356,"title":"How to display the first row, depending on a value","body":"<p>I am supposed to build a query that displays if a product passed quality test the first time. for example if product# 1234 fails the first test then don't display the value. I am running SQL Server 2005. I am thinking maybe using a <code>COALESCE</code> statement, or case when statement, any help would be appreciated. here is some sample data:</p>\n\n<pre><code>product#  test result   datetime\n1102494    Fail         20111129:07:57:50.203\n1102494    pass         20111130:16:48:28.140\n1102496    pass         20111129:11:09:32.140\n1102498    pass         20111129:08:21:10.218\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13151782,"title":"A network-related or instance-specific error occurred while establishing a connection to SQL Server","body":"<p>I have 2 applications, one is using Enterprise Library and second is using <code>asp:SqlDataSource</code> control to connect to the database. In the second application I am able to connect to the database. However in the first application where I am using Enterprise Library I am not able to connect to the database and I keep getting the following error</p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while establishing a   connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: Named\n  Pipes Provider, error: 40 - Could not open a connection to SQL Server)</em></p>\n</blockquote>\n\n<p>Also I am able to connect to the database using SQL Server 2008 client</p>\n\n<p>Connection string</p>\n\n<pre><code>&lt;add name=\"Connection String\" \n     connectionString=\"Data Source=inblrgescintra\\intranet;Initial Catalog=Intranet1.0;Persist Security Info=True;uid=***;pwd=*****;Integrated Security=False;\" \n     providerName=\"System.Data.SqlClient\"/&gt;\n</code></pre>\n\n<p>Please help me</p>\n"},{"tags":["c#","sql-server","webforms","controls","custom-controls"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13136511,"title":"How to control create from db information","body":"<p>My project have more than one pages. Suppose in one page user  need to add new control it may be any controls <strong>like: DDL/ TextBox /Button</strong> , User has this <strong>flexibility</strong> to  configure this control.My project has one <strong>configuration</strong> page ,there user create this custom control for specific page.In configuration page User defined bellow information</p>\n\n<pre><code>1)Control type.\n2)control datasource\n3)ControlDisplay properties\n4)Control  transaction stored tables and  columns(table and columns are  already created).\n5)In UI ,Store  custom control view position related information.\n6)Custom control action method(suppose user set textbox ,its show sum of two column of any \n</code></pre>\n\n<p>specific table ,user must define the action procedure)</p>\n\n<p>To serve  above information I use bellow tables but those tables stored information failed to fulfill my requirement</p>\n\n<p><img src=\"http://i.stack.imgur.com/wT1OG.png\" alt=\"enter image description here\"></p>\n\n<p>Please don't show me syntax like bellow,i know how to add dynamic controls in ui,I need to store control related information in db ,then base on those information need to create control.Help me to store  control related information's like action/method procedure, view position on ui,control view information ,control datasource etc,in a word control related all information </p>\n\n<pre><code>Button button1=new Button();\nbutton1.Text=\"dynamic button\";\nbutton1.Left=10; button1.Top=10;  //the button's location\nthis.Controls.Add(button1);\n</code></pre>\n\n<p>Need help to set custom control and control related information ,if anybody have better idea or any type of suggestion to solve this issue ,I will be thank full to him for his valuable information ,any type of information will be acceptable .If have any query please ask ,thanks in advanced.</p>\n"},{"tags":["sql-server","netbeans","database-connection"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2570,"score":1,"question_id":8230095,"title":"NetBeans 7 to MS Sql Server 2008R2 Connection","body":"<p>I'm looking for an easy way to connect my NetBeans application to an SQLServer 2008 R2 database...\nI tried with JDBC:ODBC but this doesn't work... I tried other ways but appears to be deprecated or too old for the jre 1.7...</p>\n\n<p>Does anybody have any suggestion? I'm googlig for hours but nobody talks about it, the only things i found are about SQL Server 2000 an other ancient systems!</p>\n\n<p>Thank you very much!</p>\n"},{"tags":["c#","sql-server","sql-server-2012","sqldatatypes","sqlclient"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13151280,"title":"Dealing with spatial datatypes in SQL Server 2012 tables","body":"<p>Some background:</p>\n\n<p>I'm running two different installations of SQL Server on two different VMs. I'm attempting to connect to them from my code (which was written for SQL Server 2008 R2). My current .NET framework version is 4.0. My Microsoft SQL Server 2008 R2 installation is running the AdventureWorks designed for it, and my SQL Server 2012 Express installation is running the newer AdventureWorks2012 database. I'm querying Person.Address.</p>\n\n<p>Currently I'm running into an exception saying \"DataType cannot be null\". I've deduced from looking at the returned schemas that the problem comes from SQL Server 2012 returning a </p>\n\n<p>Microsoft.SqlServer.Types.SqlGeography</p>\n\n<p>datatype. It seems that Type.GetType cannot convert this to something usable and throws an exception. I'm relieved that it's nothing that I've done, but I'm also puzzled because this code should work universally. Keep in mind this code runs flawlessly on SQL Server 2008 R2 (because it lacks the spatial datatype). </p>\n\n<p>I could think of 100 bad ways to handle this. However I wanted to come to you guys for suggestions on what to do. Will upgrading .NET to 4.5 remedy the situation? Do I have to change my code at all to accommodate the new datatype? Should I worry about the spatial datatypes if my application doesn't deal with them? How do I handle this, because obviously SqlClient and Type.GetType don't do a good job at it.</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13151274,"title":"How to achieve Customized replication function?","body":"<p>This is my issue. </p>\n\n<p>I have a server DB and a local SQL Express DB installed on few clients. For every 2 hours I need to pull records from server DB to local DB. But the catch is I want values from the server DB to start from a specific number and then till the end of the records that are available.</p>\n\n<p>Say for example:</p>\n\n<p>Server DB has following data.</p>\n\n<p>10\n20</p>\n\n<p>On the Local DB I have </p>\n\n<p>10\n20</p>\n\n<p>After 2 hours I the Server DB will have</p>\n\n<p>10\n20\n30\n40\n50</p>\n\n<p>My local DB after 2 hours should copy the value from 30 - 50.</p>\n\n<p>I have seen this link <a href=\"http://stackoverflow.com/questions/11075905/how-do-i-achieve-this-sort-of-replication\">How do I achieve this sort of replication?</a> but it I haven't yet given a full thought as my architecture is different to use Transactional replication at this point of time.</p>\n\n<p>At present I plan to get the data from Server DB to a DATASET and then dump it on to my local DB.</p>\n\n<p>Any suggestions on this is highly appreciated.</p>\n"},{"tags":["sql","sql-server","algorithm"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":13132270,"title":"How to select similar sets in SQL","body":"<p>I have the following tables:</p>\n\n<pre><code>Order\n----\nID (pk)\n\nOrderItem\n----\nOrderID (fk -&gt; Order.ID)\nItemID (fk -&gt; Item.ID)\nQuantity\n\nItem\n----\nID (pk)\n</code></pre>\n\n<p>How can I write a query that can select all <code>Orders</code> that are at least 85% similar to a specific <code>Order</code>?</p>\n\n<p>I considered using the <a href=\"http://en.wikipedia.org/wiki/Jaccard_index\" rel=\"nofollow\">Jaccard Index</a> statistic to calculate the similarity of two <code>Orders</code>. (By taking the intersection of each set of <code>OrderItems</code> divided by the union of each set of <code>OrderItems</code>)  </p>\n\n<p>However, I can't think of a way to do so without storing the computed Jaccard Index for each possible combination of two <code>Orders</code>.  <strong>Is there another way?</strong></p>\n\n<p>Also, is there a way to include the difference in <code>Quantity</code> of each matched <code>OrderItem</code> into account?</p>\n\n<p><strong>Additional Info:</strong></p>\n\n<hr>\n\n<p>Total <code>Orders</code>: ~79k<br>\nTotal <code>OrderItems</code>: ~1.76m<br>\nAvg. <code>OrderItems</code> per <code>Order</code>: 21.5<br>\nTotal <code>Items</code>: ~13k</p>\n"},{"tags":["sql","sql-server","iis","web-applications","iis7"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13149683,"title":"Connecting to SQL Database from IIS","body":"<p>This is my connection string, which the web service (hosted in IIS, running under ApplicationPoolIdentity) uses to connect to database</p>\n\n<pre><code>&lt;add name=\"AdventureWorksEntities\"connectionString=\"metadata=.\\AdventureWorks.csdl|.\\AdventureWorks.ssdl|.\\AdventureWorks.msl;\nprovider=System.Data.SqlClient;provider connection string='Data Source=TestMachine;Initial Catalog=AdventureWorks;\nIntegrated Security=True;Connection Timeout=60;multipleactiveresultsets=true'\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>When I try to access the site I am getting an exception: Login Failed for user MyDomain\\TestMachine$.</p>\n\n<p>Why is IIS trying to use TestMachine to connect and not my user account (e.g MyDomain\\TestUser) ?\nThe reason I believe could be because its hosted under ApplicationPoolIdentity which uses machine creds. </p>\n\n<p>How do I specify it to use the context of the user that made the request without having to run the application under custom identity (i.e I want it to continue running under ApplicationPoolIdentity)?</p>\n\n<p>If  I set <code>&lt;identity impersonate = true/&gt;'</code> in my web.config file then I am able to access the site locally from IIS server machine and access to database works but then accessing the site remotely fails. My Webservice is using Windows Authentication. Any thoughts on this ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":43,"score":0,"question_id":13149232,"title":"How do I extract a substring from a random position in a string using built-in functions?","body":"<p>I have a series of data stored in the following fashion:</p>\n\n<pre><code>Word of various kinds (ANT\\username1) and even more words\nThis is another row, the words are random (ANT\\username2)\nThankfully the username only ever shows once (ANT\\username1)\n</code></pre>\n\n<p>Above represents three seperate rows. </p>\n\n<p>The general flow of this data is:</p>\n\n<ul>\n<li>Parenthesis can appear anywhere in the text</li>\n<li>The username portion of each string (ANT\\usernamex) will only ever appear once</li>\n<li>The text preceeding and proceeding the username portion is always different lengths.</li>\n<li>The username text may not always be present</li>\n</ul>\n\n<p>As you probably already guessed what I need to do is take the username from each row and where it isn't present return null. Unfortunately I have no idea how to approach this - I've played around with left() and right() functions but don't really know how else to tackle this. Would appreciate if any answers that use a number of functions to accomplish the task have a quick blurb explaining the flow of logic (so I can then read the documentation for the functions to learn).</p>\n"},{"tags":["sql","sql-server","sql-server-2005","replication"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":56,"score":0,"question_id":13082881,"title":"sql table with identity in merge replication","body":"<p>I have a table in SQL Server 2005 and I have an IDENTITY(1,1) property set for an ID column.  Records are inserted in a table at a local server as well as a remote server.  I am using Merge Replication to match the data from local server and remote server.</p>\n\n<p>What happens if I insert the same ID at the local server and the remote server?</p>\n\n<p>Please suggest what am I doing wrong here.</p>\n"},{"tags":["sql-server","sql-server-2008","reporting-services","ssrs-2008","ssrs-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13148997,"title":"SQL Reporting Services Express Edition very slow even with no data","body":"<p>Am trying to figure out why our SSRS execution is so slow.  The home page takes about 10 seconds to load/refresh and reports take 12-15 seconds just to render to the 'Enter Parameter Settings' stage.  </p>\n\n<p>I have created a report with a single text box - no data connections - no data-set - so ZERO database access and yet it still consistently takes 12 seconds to render - A SINGLE TEXT BOX WITH NO DATABASE ACCESS!  Every single click in the report engine takes 12-15 seconds to respond to - which makes it quite painful to work with real data.</p>\n\n<p>The database and an IIS installation is also included on the same machine - but they are only accessed by a couple of users (nothing public) - so the machine isn't under a lot of load.  All other services on this box are responding quickly: The IIS installation is serving up web-service requests quickly and responsively - within a split-second.  And all database queries are running at a very speedy rate - consistent with the generous hardware on this box.</p>\n\n<p>It doesn't seem to be related to 'First Request' spooling up - this is happening on all requests.</p>\n\n<p>All the other answers relating to SSRS speed issues seem to be related to database query tuning and parameter handling - but this 'no-data' test report seems to be pointing to something wrong within the SSRS installation/execution itself.  </p>\n\n<p>Any help?</p>\n"},{"tags":["sql-server","authentication","iis-7.5"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13105747,"title":"Web site access to SQL Server inside and outside of a domain","body":"<p>This time I have a very strange problem. Already spent 3 nights on the problem and it keeps going. Not sure if Stack is the best place for this question, also can be actual on DBA or Serverfault. If it should be moved, please move.</p>\n\n<p>I am migrating all company applications to the new servers. Now we are getting Windows 2008 servers with SQL Server 2008 R2. </p>\n\n<p>There is a web application based on classic ASP (full of wtf's) that is using SQl Server as a storage. \nIn the new set-up ASP web-site is on Web-server, SQL Server 2008 is on another machine. All the servers are in the domain. \nI had a big trouble connecting that web-site to SQL Server. Got it done by using a domain user  as user to run the application pool. \nSo whenever I use that web-site within domain, I get everything working fine.</p>\n\n<p>The problem starts whenever I go to outside of the domain (from my home computer). The web-application is rejected the connection to the SQL Server. Application pool is not configured to use pass-through authentication, AppPool is using the same user as the web-site. </p>\n\n<p><img src=\"http://i.stack.imgur.com/seEKN.png\" alt=\"Application Pool configuration\"></p>\n\n<p><img src=\"http://i.stack.imgur.com/PE8aB.png\" alt=\"Process Monitor shows denied access to the named pipes when connecting from the outside of the domain\"></p>\n\n<p>I have used ProcMon (from sysinternals) to figure out what happens. And it shows that connection to the SQL Server (via named pipe) is just denied when request to the web-site comes from outside of the domain. </p>\n\n<p>I have used fiddler to compare the HTTP requests and both requests are the same, no domain authorisation or any information is passed to IIS from within of the domain. </p>\n\n<p><strong>The questions are: WHY this happens and how to make it stop??</strong></p>\n\n<p>Any ideas are appreciated. I'm stuck as never been before.</p>\n\n<p><strong>UPDATE</strong>: Figured it out today. Firewall was forcing to use Named Pipes connection instead of TCP. And Named Pipes are just not the same as usual TCP connection. </p>\n"},{"tags":["sql-server","sql-server-2008","tsql","pivot","pivot-without-aggregate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":63,"score":-1,"question_id":13142554,"title":"X number of Rows into X number of Columns","body":"<p>I need your help again for the following. Please note that I am using SQL SERVER 2008.\nI have a table (below) where we got Number of jobs done from the \"Pickup\" to the \"Dropoff\".\nThe requirements are (output format mentioned below).\n1) Get all the unique postcodes regardless of them being dropoffs or pickups. This will give us all the postcodes.\n2) Present the count of jobs done from PICKUP to the corresponding DROPOFF. For example, we pick passengers up from SE18 postcode twice and took them to SE18 once and SE19 once. It will be cleared from the REQUIRED OUTPUT table.</p>\n\n<pre><code>TABLE:\nJobID        Pickup       Dropoff\n====================================\n1            SE18         SE18\n2            SE18         SE19\n3            SE2          SE18\n4            SE28         SE2\n5            AL1          SE7\n6            BR1          SE10\n7            NW1          TW16\n8            AL1          SE18\n9            BR6          AL1\n10           E6           BR1\n.            .            .\n.            .            .\n.            .            .\n</code></pre>\n\n<p>The require output is as the following:</p>\n\n<pre><code>REQUIRED OUTPUT\n\n     SE18   SE2   SE28   AL1   BR1   NW1   BR6   E6   SE19  SE7  SE10  TW16 ..\n     =========================================================================\nSE18   1     -      -     -     -     -     -     -     1    0    0     0\nSE2    1     -      -     -     -     -     -     -     -    -    -     -         \nSE28   -     1      -     -     -     -     -     -     -    -    -     -          \nAL1    1     -      -     -     -     -     -     -     -    1    -     -       \nBR1    -     -      -     -     -     -     -     -     -    -    1     -        \nNW1    -     -      -     -     -     -     -     -     -    -    -     1      \nBR6    -     -      -     1     -     -     -     -     -    -    -     -       \nE6     -     -      -     -     1     -     -     -     -    -    -     -       \nSE19   -     -      -     -     -     -     -     -     -    -    -     -        \nSE7    -     -      -     -     -     -     -     -     -    -    -     -       \nSE10   -     -      -     -     -     -     -     -     -    -    -     -      \nTW16   -     -      -     -     -     -     -     -     -    -    -     -      \n.\n.\n.\n</code></pre>\n\n<p>Many thanks in advance.\nKind regards</p>\n"},{"tags":["sql-server","primary-key","index"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2019,"score":1,"question_id":3292067,"title":"Default Index on Primary Key","body":"<p>Does the SQL Server build an index on primary keys by default?\nIf yes what kind of index? If no what kind of index is appropriate for selections by primary key?</p>\n\n<p>I use SQL Server 2008 R2</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":8,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":7802,"score":2,"question_id":1227707,"title":"How to get last insert/update/delete datetime on Sql Server 2005?","body":"<p>not a duplicate of <a href=\"http://stackoverflow.com/questions/1227593/how-to-get-last-modification-datetime-on-sql-server-2005\">my previous question</a></p>\n\n<p>Is there any way to get the latest datetime when a table/database had an insert/update/delete on Sql Server 2005? Preferably without creating triggers..</p>\n\n<p>I know that when you need the last update per row, you need triggers. But I am not sure if they are needed when you just want to get the last update for the whole table.</p>\n"},{"tags":["sql","sql-server","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":13148106,"title":"SQL Server Instead of Update Trigger Using Update 'Where' Clause Values","body":"<p>I think I'm close on this one, I just can't seem to get it right.  I've also looked through a lot of questions and answers and either I can't find the answer or I don't understand the questions of others so, please forgive if this is a re-post.</p>\n\n<p>What I want to do seems pretty basic as far as the idea of an \"Instead Of\" trigger goes.  I'm working in SQL Server 2008.  I have a view that can't be updated directly so I need an Instead Of Update trigger to update one of the underlying tables.  The primary key of the table in questions will not be included as part of the Update statement so I have to select using a foreign key.  </p>\n\n<p>I'm trying to get the foreign key supplied in the Where clause of the Update statement but I must be using the wrong syntax.  I'm pretty sure that I must be able to get 'Where' values since they seem likely to be used as keys to underlying tables.  So, given the statement...</p>\n\n<pre><code>UPDATE table1 SET field1 = 'value1' WHERE key_field = 'key_value'\n</code></pre>\n\n<p>How do I access get the 'key_value' inside my trigger definition?  I've tried the following...</p>\n\n<pre><code>DECLARE @pk INT\nSELECT @pk = p_key\n  FROM dbo.ptable p, UPDATED u\n WHERE p.f_key = u.key_field\n</code></pre>\n\n<p>And this as well...</p>\n\n<pre><code>DECLARE @pk INT\n SELECT @pk = p_key\n   FROM dbo.ptable\n  WHERE f_key = (SELECT key_field\n                   FROM UPDATED)\n</code></pre>\n\n<p>But neither of these seem to work for me.  I'm pretty sure I'm getting the update value correctly using...</p>\n\n<pre><code>DECLARE @uValue VARCHAR\nSELECT @uValue = field1\n  FROM UPDATED\n</code></pre>\n\n<p>I want to be able to use the derived primary key for an insert or update like this...</p>\n\n<pre><code>INSERT INTO dbo.xtable (fieldx) VALUES (@uValue) WHERE p_key = @pk;\n</code></pre>\n\n<p>or</p>\n\n<pre><code>UPDATE dbo.xtable SET fieldx = @uValue WHERE p_key = @pk;\n</code></pre>\n\n<p>Hopefully, I'm making sense and I'm not too far off.  Thanks for your help.</p>\n"},{"tags":["sql","sql-server","aggregate-functions","median"],"answer_count":15,"favorite_count":13,"up_vote_count":37,"down_vote_count":0,"view_count":37245,"score":37,"question_id":1342898,"title":"Function to Calculate Median in Sql Server","body":"<p>According to <a href=\"http://msdn.microsoft.com/en-us/library/ms173454.aspx\" rel=\"nofollow\">MSDN</a>, Median is not available as an aggregate function in Transact-Sql. However, I would like to find out whether it is possible to create this functionality (using the <a href=\"http://msdn.microsoft.com/en-us/library/ms182741.aspx\" rel=\"nofollow\">Create Aggregate</a> function, user defined function, or some other method). </p>\n\n<p>What would be the best way (if possible) to do this - allow for the calculation of a median value (assuming a numeric data type) in an aggregate query?</p>\n"},{"tags":["sql-server","sql-server-2005","dbo"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":18,"score":2,"question_id":13147695,"title":"SQL Server dbo permissions for specified databases","body":"<p>Can I assign SQL Server dbo permissions to a user, so it applies only for specified databases on a server?  Currently using SQL Server 2005.</p>\n"},{"tags":[".net","sql-server","c#-4.0","windows-services","google-bigquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13133693,"title":"Inserting a record in BigQuery table via windows service","body":"<p>I've created a windows service that communicates with the Google BigQuery API perfectly using Service Account authorization. For testing purposes, I'm able to fetch data from a BigQuery table to check communication between my Windows service and the BigQuery API. But this service will basically fetch records from MSSQL server and then one by one will insert or append a record to the target table in BigQuery. I don't want to use CSV or JSON files as a data source. Is there any way of doing so?</p>\n"},{"tags":["sql","sql-server","identity"],"answer_count":8,"favorite_count":6,"up_vote_count":10,"down_vote_count":0,"view_count":3537,"score":10,"question_id":1920558,"title":"What is the difference between Scope_Identity(), Identity(), @@Identity, and Ident_Current?","body":"<p>I know Scope_Identity(), Identity(), @@Identity, and Ident_Current all get the value of the identity column, but i would love to know the difference.</p>\n\n<p>Part of the controversy i'm having is what do they mean by scope as applied to these functions above?</p>\n\n<p>I would also love a simple example of different scenarios of using them?</p>\n"},{"tags":["sql-server","sql-server-2008","deprecated"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":624,"score":3,"question_id":5076791,"title":"How to replace REVOKE ALL in SQL Server 2008 R2","body":"<p>How do I replace the <strong>ALL</strong> permission now that it has been revoked: </p>\n\n<pre><code>REVOKE ALL ON dbo.MyObject TO MyUser\n</code></pre>\n\n<p>I'm looping through all the objects in a database and revoking all permissions for a specific user. So if I had to be specific about which permission to revoke, it would be a real hassle because I would have to find out what object I have and then revoke every possible permission for that type of object. Instead of just REVOKE ALL.</p>\n"},{"tags":["java","php","javascript","css","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":70,"score":-5,"question_id":13147460,"title":"Best Java Based technologies for searching huge Intranet Log data in my Company","body":"<p>Our company has huge log data of our employees. we have built the application to search for this employee activity in vpn, e-mail and other activities to track any misuse of our network.</p>\n\n<p>Existing application is using PHP html css and java script. We are looking to develop the next gen version of this application and evaluating frameworks we are <strong>thinking of replacing php with java</strong>. We have very huge data because our system logs every event occurring on our net work. Right now we are using Microsoft SQL Server, Tomcat web server for our application.</p>\n\n<p>we want o build very powerful application which can search terabytes of log event data in seconds we need advanced servers and front end technologies.</p>\n\n<p>we want this next gen application to be better in performance, maintainability, extend-ability, ease of use and scalability.</p>\n\n<p>I would appreciate any good suggestion or recommendation of any new technologies for back-end and front-end development for the above requirement.</p>\n"},{"tags":["sql-server","powershell","scripting"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":13146121,"title":"SQL Server : find and update column in Table 1 with Information from Table 2","body":"<p>I am new to all of this and have just began scripting/programming in general. I have searched high and low and tried several things, but I have had no success. What I am trying to do</p>\n\n<ul>\n<li><code>Table1</code> has <code>Column1</code></li>\n<li><code>Table2</code> has <code>Column2</code></li>\n</ul>\n\n<p>Within these columns are file paths. <code>Column1</code> file path will be <code>\\\\\\server1\\folder\\video1.avi</code>,\n<code>Column2</code> file path will be <code>http://server2/folder/video1.mpg</code></p>\n\n<p>What I am trying to do is query <code>Table1</code> with <code>Table2</code> and match the name of the file, in this case <code>video1</code>. This file name will always be different, thus will need something so it finds part of the string by itself. Once the match is made I need <code>Table1</code> to update <code>Column1</code> so that it matches exactly what is in <code>Table2.Column2</code>. When the change has been made and the rest of my program has finished running, all the data in <code>Table2</code> will be deleted, but I still need <code>Table1.Column1</code> to be changed permanently and not revert back to the old file path.</p>\n\n<p>Thanks in advance for any help!</p>\n\n<p>EDIT:</p>\n\n<p>Here is the filename for our database:</p>\n\n<p>5149__20121030_120839.avi which will be converted to 5149__20121030_120839.mpg\nAt any given point in time the beginning of the filename will range from 5100 to 5999 the rest of it will change randomly. How I currently have things setup:</p>\n\n<p>I am grabbing file names and saving them to a csv file. From there I am uploading this csv file into <code>Table2.Column2</code>. It is at this point in time where I am stuck on querying part of the file path to find a match in <code>Table1.Column1</code>. One a match is found I am trying to update the whole string in <code>Table1.Column1</code> to match what I have in <code>Table2.Column2</code>. After it is all said and done with I will delete <code>Table2.Column2</code>, any files that were moved, and start over the next day.</p>\n\n<p>I have been searching all over and found a few things to try, but no luck as of yet. The closest I have come is this:</p>\n\n<p><code>UPDATE Table1\nSET Table1.Column1 = Table2.Column2\nFROM Table1\nFULL JOIN Table2 ON Table2.Column2 like '%' + Table1.Column1 + '%'</code></p>\n\n<p>Whenever I run this though, it takes <code>Table1.Column1</code> and sets everything to NULL instead of replacing what is in <code>Table2.Column2</code>. This was just a test in my lab to see if it would work, I had not even begun researching on how to match part of a string yet between two different tables.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13146304,"title":"How to Select Every Row Where Column Value is NOT Distinct","body":"<p>I need to run a select statement that returns all rows where the value of a column (i.e. EmailAddress) is not distinct.</p>\n\n<p>For example, if the table looks like below:</p>\n\n<pre><code>CustomerName     EmailAddress\nAaron            aaron@gmail.com\nChristy          aaron@gmail.com\nJason            jason@gmail.com\nEric             eric@gmail.com\nJohn             aaron@gmail.com\n</code></pre>\n\n<p>I need the query to return:</p>\n\n<pre><code>Aaron            aaron@gmail.com\nChristy          aaron@gmail.com\nJohn             aaron@gmail.com (peer edited from john@gmail.com)\n</code></pre>\n\n<p>I have read many posts and tried different queries to no avail.  The query that I believe should work is below.  Can someone suggest an alternative or tell me what may be wrong with my query?</p>\n\n<pre><code>select EmailAddress, CustomerName from Customers\ngroup by EmailAddress, CustomerName\nhaving COUNT(distinct(EmailAddress)) &gt; 1\n</code></pre>\n"},{"tags":["sql-server","dynamics-crm-2011"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12979617,"title":"CRM 2011 EmailHashBase","body":"<p>I have just upgraded to CRM 2011 from 4.0, and I'm seeing a lot of errors in the application log, I think owing to the email router. The error text is \"Query execution time of 30.0 seconds exceeded the threshold of 10 seconds\".  </p>\n\n<p>Here's the query it's executing:</p>\n\n<pre><code>WITH Candidates\n        (\n            ActivityId\n        ) AS\n        (SELECT  ActivityId\n        FROM     EmailHashBase WITH (NOLOCK)\n        WHERE    ActivityId IN\n                (SELECT  ActivityId\n                FROM     EmailHashBase WITH (NOLOCK)\n                WHERE    HashType = 0\n                    AND Hash IN (111682,1892164739,45,1824023892,54,3805,125879)\n                GROUP BY ActivityId\n                HAVING   COUNT(ActivityId) &gt;= 7\n                )\n            AND HashType = 1\n            AND Hash IN (969105075,1418975348,547970098,1044570065,-1578559672,1137188287,-1492206818,1365121987,1893861533,-1313312639,-1829169632,-1685403462,-518982188,1123523219,284291011,-981044541,1790111815,-808308608,-599769785,971845046)\n        GROUP BY ActivityId\n        HAVING   COUNT(ActivityId) &gt;= 2\n        )\nSELECT   TOP 1 a.ActivityId\nFROM     ActivityPointerBase AS a WITH (NOLOCK)\nWHERE    a.ActivityId IN\n            (SELECT ActivityId\n            FROM    Candidates AS c\n            WHERE(\n                    (SELECT COUNT(*)\n                            FROM    EmailHashBase AS h\n                            WHERE   h.ActivityId = c.ActivityId\n                                AND h.HashType   = 0\n                    )\n                    &lt;= 7\n                ) \n            )\nORDER BY a.ModifiedOn DESC\n</code></pre>\n\n<p>Running this query directly against the database takes up to a minute.  I've run it using \"Set Statistics IO ON\" and have following results:</p>\n\n<pre><code>Table 'Worktable'. Scan count 0, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'EmailHashBase'. Scan count 17696074, logical reads 53155625, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'ActivityPointerBase'. Scan count 1, logical reads 5060, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\n\nSQL Server Execution Times:\nCPU time = 36567 ms,  elapsed time = 36562 ms.\n</code></pre>\n\n<p>Obviously there's a problem with EmailHashBase.  I've added a non-clustered index on the Hash column and rebuilt the indexes, but I'm still getting a high scan and logical read count.</p>\n\n<p>I cannot change the query.  </p>\n\n<p>Any suggestions on what I can do to the table to fix this? </p>\n"},{"tags":["sql","sql-server","replication"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":536,"score":1,"question_id":3211340,"title":"Sql Server replication over wan","body":"<p>Im looking at developing a simple ecommerce platform and need to replicate product and customer data to the web host over the internet so the website can run disconnected.  The two options i can think of at present are using enterprise messaging and database replication.</p>\n\n<p>Im leaning towards database replication over enterprise messaging as enterprise messaging would require additional developer resource to write all the plumbing code.  Anyone have any success using sql server one way replication over unreliable wan links through the internet?  </p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13144458,"title":"improving performance of a view that is heavily dependent on dates","body":"<p><strong>This view is taking me HOURS to execute:</strong></p>\n\n<pre><code>USE [SalesDWH]\nGO\n\n/****** Object:  View [dbo].[FirstLastEstablished]    Script Date: 10/29/2012 15:12:47 ******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER view [dbo].[FirstLastEstablished] as\n\n\nwith cte_min as(\n\nselect \n      a.client_id\n      ,a.specimen_source\n      ,a.received_date\nfrom\n      millennium_dw_dev..F_ACCESSION_DAILY a\njoin\n            (select distinct\n                  f.client_id\n                  ,f.received_date\n                  ,f.accession_daily_key\n            from \n                  millennium_dw_dev..F_ACCESSION_DAILY f\n            join \n                  (select CLIENT_ID, MIN(received_date) MinRecDate\n                  from millennium_dw_dev..F_ACCESSION_DAILY\n                  group by CLIENT_ID) i\n            on f.CLIENT_ID=i.CLIENT_ID\n            and f.RECEIVED_DATE=i.MinRecDate) b\non    \n      a.ACCESSION_DAILY_KEY=b.ACCESSION_DAILY_KEY \n\n)\n\n,\ncte_max as \n(\n\nselect \n      a.client_id\n      ,a.specimen_source\n      ,a.received_date\nfrom\n      millennium_dw_dev..F_ACCESSION_DAILY a\njoin\n            (select distinct\n                  f.client_id\n                  ,f.received_date\n                  ,f.accession_daily_key\n            from \n                  millennium_dw_dev..F_ACCESSION_DAILY f\n            join \n                  (select CLIENT_ID, max(received_date) MaxRecDate\n                  from millennium_dw_dev..F_ACCESSION_DAILY\n                  group by CLIENT_ID) i\n            on f.CLIENT_ID=i.CLIENT_ID\n            and f.RECEIVED_DATE=i.MaxRecDate) b\non    \n      a.ACCESSION_DAILY_KEY=b.ACCESSION_DAILY_KEY \n\n)\n,\n\n\ncte_est as\n\n(\n\nselect distinct client_id, MLIS_DATE_ESTABLISHED\nfrom millennium_dw_dev..D_CLIENT\nwhere REC_ACTIVE_FLG=1\nand MLIS_DATE_ESTABLISHED is not null\n)\n\n,\n\nmainQuery as(\nselect distinct\n      f.client_id\n      ,cmin.specimen_source first_specimen_source\n      ,cmin.received_date first_received\n      ,cmax.specimen_source last_specimen_source\n      ,cmax.received_date last_received\n      ,cest.MLIS_DATE_ESTABLISHED MLIS_DATE_ESTABLISHED\nfrom millennium_dw_dev..F_ACCESSION_DAILY f\nleft join cte_max cmax\non cmax.CLIENT_ID=f.CLIENT_ID\nleft join cte_min cmin\non cmin.CLIENT_ID=f.CLIENT_ID\nleft join cte_est cest\non cest.CLIENT_ID=f.CLIENT_ID\n)\n,\nDateDifferences\nas\n\n(\nSELECT\nclient_id,\n   (DATEDIFF(dd, MLIS_DATE_ESTABLISHED,first_received) + 1)\n  -(DATEDIFF(wk, MLIS_DATE_ESTABLISHED,first_received) * 2)\n  -(CASE WHEN DATENAME(dw, first_received) = 'Sunday' THEN 1 ELSE 0 END)\n  -(CASE WHEN DATENAME(dw, MLIS_DATE_ESTABLISHED) = 'Saturday' THEN 1 ELSE 0 END)\n -(case when cast('01/01/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/26/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/04/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/01/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/27/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/25/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/01/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/25/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/03/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/07/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/26/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/25/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/01/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/31/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/05/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/06/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/25/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/24/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/03/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/30/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/04/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/05/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/24/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/26/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/02/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/28/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/04/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/03/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/22/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/25/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n\n\n   DifferenceExcludingWeekends\n  from\n  mainQuery\n)\n,\nTerritory \nas\n(\nselect distinct c.client_id,c.MLIS_TERRITORY,s.REGION_NAME\nfrom millennium_dw_dev..D_CLIENT c\nleft join millennium_dw_dev..D_SALES_HIERARCHY s\non s.TERRITORY_NAME=c.MLIS_TERRITORY\nwhere c.REC_ACTIVE_FLG=1\nand s.REC_ACTIVE_FLG=1\n\n)\n\nselect mainQuery.*,d.DifferenceExcludingWeekends,Territory.MLIS_TERRITORY,Territory.REGION_NAME\nfrom mainQuery\nleft join DateDifferences d\non mainQuery.CLIENT_ID=d.CLIENT_ID\nleft join Territory\non mainQuery.CLIENT_ID=Territory.CLIENT_ID\n\nGO\n</code></pre>\n\n<p>I did the sql server database tuning on this, and created all the recommended indexes. After 15min of executing the view again, I stopped it. </p>\n\n<p><strong>Are there obvious things that you could kindly point out to me about my query to optimize it more and improve execution time?</strong></p>\n"},{"tags":["sql-server","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13144591,"title":"Insert update delete trigger","body":"<p>Dear all Im having trouble with my trigger. </p>\n\n<p>Am I doing this at all right, right now it only works for Insert. I think Im pretty close tho please help me if you have the time.  Im trying to store all the inserts, updates and deletes into the table customers_changelog via trigger. There is something wrong with the code I cant delete or update customers I can only insert new ones. Please help my I have been spending plenty of hours on this and just cant get this to work! :)</p>\n\n<pre><code>create table customers (\ncustomerid int identity primary key,\nname varchar(100) not null,\naddress varchar(100)\n)\ngo\n\ncreate table customers_changelog (\ncustomerid int,\nname varchar(100) not null,\naddress varchar(100),\nchange_user varchar(32),\nchange_time datetime,\nchange_action char(1) default 'I',\ncheck (change_action = 'I' or change_action = 'D')\n)\ngo\n\n\nCREATE TRIGGER log_changes\nON customers\nAFTER INSERT, UPDATE, DELETE\nAS \nBEGIN\n    SET NOCOUNT ON;\n\n--\n-- Check if this is an INSERT, UPDATE or DELETE Action.\n-- \nDECLARE @customerid1 as int;\nDEClARE @name1 as varchar(32);\nDECLARE @address1 as varchar(100);\nDECLARE @change_action1 as char(1);\nDECLARE @change_time1 as datetime;\nDECLARE @change_user1 as varchar(32);\n\nselect  @customerid1 = c.customerid, @name1 = c.name, @address1 = c.address\nfrom customers c, inserted i\nwhere c.customerid = i.customerid \n\nSET @change_time1 = CURRENT_TIMESTAMP;\nSET @change_user1 = CURRENT_USER;\nINSERT INTO customers_changelog(customerid,name,address,change_action,change_time,change_user)\n    VALUES(@customerid1,@name1,@address1,'I',@change_time1,@change_user1)\nIF EXISTS(SELECT * FROM DELETED)\nBEGIN    \n            IF EXISTS(SELECT * FROM INSERTED) \n            INSERT INTO customers_changelog VALUES(@customerid1,@name1,@address1,'U',@change_time1,@change_user1)\n            ELSE \n            INSERT INTO customers_changelog VALUES(@customerid1,@name1,@address1,'D',@change_time1,@change_user1)\n\nEND\nELSE \n    IF NOT EXISTS(SELECT * FROM INSERTED) RETURN;\nEND\n</code></pre>\n"},{"tags":["sql-server","visual-studio-2008","reporting-services","reportviewer","rdlc"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":430,"score":1,"question_id":7194539,"title":"How do I repeat page header on every page except the first page of a report?","body":"<p>I have a client report (.rdlc) that I am editing in Visual Studio.  I need a way to display an empty page header on every page, except the first page of the report.</p>\n\n<p>The reason for this is because the client has paper with their logo that needs space at the top to display on subsequent pages.</p>\n"},{"tags":["sql-server","ssis"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":86,"score":2,"question_id":13142631,"title":"Why would the custom SSIS log provider not show up on the providers dropdown list?","body":"<p>I am trying to create a custom logging provider for SSIS, but when deploying the dll, it doesn't show up in the list of providers.</p>\n\n<p>The SSIS version is 11.0.2100.60. I tried .NET Framework 2.0 and 3.5. I installed in the GAC, and also copied to both folders below:</p>\n\n<pre><code>C:\\Program Files\\Microsoft SQL Server\\110\\DTS\\LogProviders\nC:\\Program Files (x86)\\Microsoft SQL Server\\110\\DTS\\LogProviders\n</code></pre>\n\n<p>After doing this, I opened Visual Studio [Shell], and created a simple SSIS package. When opening the <code>SSIS\\Logging...</code> menu, the new custom log provider is not there.</p>\n\n<p>The code that I am using now is the sample package provided by Microsoft (<em>HTMLLogProviderCS</em>) from Codeplex, and no luck.</p>\n\n<p>Any ideas where I could have missed something?</p>\n"},{"tags":["sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":57,"score":4,"question_id":13144970,"title":"Procedure to get dates in between","body":"<p>I have a SQL Server database that contains a <code>timesheet</code> table. This table is used to store roles for employees. Before I perform an insert I check to see of an employee has any preexisting roles in the selected days.</p>\n\n<p>Heres a stored procedure that returns the count of pre-existing roles </p>\n\n<pre><code>set @retVal=(select count(fk_RoleID) from dbo.TimesheetTable where \n(@startdate &gt;=  CAST((\nSTR( YEAR( StartDate ) ) + '/' +\nSTR( MONTH( StartDate ) ) + '/' +\nSTR( DAY( StartDate ) )\n)\nAS DATE\n))-- AND EndDate &lt;= '2012-08-30')\nand\n(@enddate  &lt;  CAST(\n(\nSTR( YEAR( EndDate ) ) + '/' +\nSTR( MONTH( EndDate ) ) + '/' +\nSTR( DAY( EndDate ) )\n)\nAS DATE\n))\nand fk_PersonnelID=@personnelID)\n\nreturn @retVal\n</code></pre>\n\n<p>The following are the records for one employee..</p>\n\n<pre><code>pk_ID  fk_PersonnelID  fk_RoleID  StartDate   EndDate     dateCreated\n62     1               26         2012-10-01  2012-10-02  2012-10-25 15:55:12.940\n81     1               20         2012-10-04  2012-10-06  2012-10-30 14:50:28.300\n</code></pre>\n\n<p>If I try to do an insert of where the start date is <code>2012-10-05</code> and end date is <code>2012-10-11</code>, the query fails to trap the <code>startdate</code> ..and the insert occurs</p>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["sql-server","delphi","stored-procedures","ado"],"answer_count":4,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":2252,"score":9,"question_id":254486,"title":"View output of 'print' statements using ADOConnection in Delphi","body":"<p>Some of my MS SQL stored procedures produce messages using the 'print' command.  In my Delphi 2007 application, which connects to MS SQL using TADOConnection, how can I view the output of those 'print' commands?</p>\n\n<p>Key requirements:\n1) I can't run the query more than once; it might be updating things.\n2) I need to see the 'print' results even if datasets are returned.</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":51,"score":-5,"question_id":13145051,"title":"t sql union vs join order (efficiency)","body":"<p>I have a relatively simple question.</p>\n\n<p>I have dataset A and dataset B, both identical in structure.</p>\n\n<p>The end result is going to be a union all of dataset A and dataset B, we'll call it dataset C.</p>\n\n<p>But before the final version, the end dataset needs to be filtered by joining on dataset X.</p>\n\n<p>The question is should I join dataset A on dataset X, join dataset B on dataset X, and THEN union ALL A and B, or should I UNION ALL A and B into C, then join C on X.</p>\n\n<p>What is faster, more memory efficient, etc?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server","inner-join"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":13145275,"title":"Where clause versus inner join statement checks, are they the same?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1018952/condition-within-join-or-where\">Condition within JOIN or WHERE</a>  </p>\n</blockquote>\n\n\n\n<p>Are the below 2 queries the same?</p>\n\n<pre><code>SELECT u.*\nFROM User u\n    INNER JOIN Sales s ON (u.userId = s.userId)\nWHERE\nu.active = 1 AND\ns.amount &gt; 0 AND\ns.status = 1 \n</code></pre>\n\n<p>versus:</p>\n\n<pre><code>SELECT u.*\nFROM User u\n    INNER JOIN Sales s ON \n        (u.userId = s.userId AND s.amount &gt; 0 and s.status=1)\nWHERE\nu.active = 1\n</code></pre>\n\n<p>Are these 2 queries the same in terms of result set always?\nPerformance considerations?</p>\n"},{"tags":["sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13141507,"title":"Check if user is member of dbo role in SQL Server","body":"<p>I need a T-SQL statement to check if a user is member of a database role in SQL Server. Specifically I need to know if the user is member of the dbo role, because then I don't have to grant additional authority to that user.</p>\n\n<p>If I try to add additional authority when the user is dbo it fails, and my script fails...</p>\n"},{"tags":["sql","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13144820,"title":"SQL Error: The parameterized query..expects the parameter","body":"<p>I was having issues converting a log file section to a SQL <code>DateTime</code> and found a better solution was to have my date field generated by the database instead of code (using <code>GETDATE()</code>). </p>\n\n<p>I removed the date field from my insert but now I get this error:</p>\n\n<blockquote>\n  <p>Error: The parameterized query '(@station int, @indoor_temp float, @outdoor_temp float, @dewpoint f' expects the parameter '@wind_direction_text', which was not supplied.</p>\n</blockquote>\n\n<p>That value it complains about is supplied, and what's stranger the insert still succeeds and the database record is inserted!</p>\n\n<p>I'd like to figure out why I'm getting these exceptions though!</p>\n\n<p>Here's my code:</p>\n\n<pre><code>var dataCommand = new SqlCommand();\ndataCommand.Connection = dataConnection;\n\ndataCommand.Parameters.AddWithValue(\"@station\", _stationId);\ndataCommand.Parameters.AddWithValue(\"@indoor_temp\", _indoorTemp);\ndataCommand.Parameters.AddWithValue(\"@outdoor_temp\", _outdoorTemp);\ndataCommand.Parameters.AddWithValue(\"@dewpoint\", _dewPoint);\ndataCommand.Parameters.AddWithValue(\"@rel_humidity_indoor\", _relHumidityIndoor);\ndataCommand.Parameters.AddWithValue(\"@rel_humidity_outdoor\", _relHumidityOutdoor);\ndataCommand.Parameters.AddWithValue(\"@wind_speed\", _windSpeed);\ndataCommand.Parameters.AddWithValue(\"@wind_direction_degrees\", _windDirectionDegrees);\ndataCommand.Parameters.AddWithValue(\"@wind_direction_text\", _windDirectionText);\ndataCommand.Parameters.AddWithValue(\"@wind_chill\", _windChill);\ndataCommand.Parameters.AddWithValue(\"@rain1h\", _rain1H);\ndataCommand.Parameters.AddWithValue(\"@rain24h\", _rain24H);\ndataCommand.Parameters.AddWithValue(\"@rain_total\", _totalRain);\ndataCommand.Parameters.AddWithValue(\"@relative_pressure\", _relativePressure);\ndataCommand.Parameters.AddWithValue(\"@tendency\", _tendency);\ndataCommand.Parameters.AddWithValue(\"@forecast\", _forecast);\n\ndataCommand.CommandType = CommandType.Text;\ndataCommand.CommandText =\n                         \"INSERT INTO\"\n                         + \" dbo.WeatherData(station_id, indoor_temp, outdoor_temp, dewpoint,\" +\n                            \"rel_humidity_indoor, rel_humidity_outdoor, wind_speed, wind_direction_degrees,\" +\n                            \"wind_direction_text, wind_chill, rain1h, rain24h, rain_total, relative_pressure,\" +\n                            \"tendency, forecast)\"\n                            + \"VALUES \" +\n                            \"(@station, @indoor_temp, @outdoor_temp, @dewpoint, @rel_humidity_indoor,\" +\n                            \"@rel_humidity_outdoor, @wind_speed, @wind_direction_degrees,\" +\n                            \"@wind_direction_text, @wind_chill, @rain1h, @rain24h, @rain_total,\" +\n                            \"@relative_pressure, @tendency, @forecast)\";\n\n// execute the insert command\ndataCommand.ExecuteNonQuery();\n</code></pre>\n\n<p>Thanks for your help!</p>\n"},{"tags":["sql","sql-server","database","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13142433,"title":"Tables for recursive hierarchial data in SQL","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1757260/simplest-way-to-do-a-recursive-self-join-in-sql-server\">Simplest way to do a recursive self-join in SQL Server?</a>  </p>\n</blockquote>\n\n\n\n<p>I have to create a table in SQL that will comprise of groups of items/products. Each new group made will be made under one of the <strong>pre-defined</strong> groups or the groups previously formed. I want to keep all this data in a SQL Table. So far, I have though of creating a table like this:</p>\n\n<ul>\n<li>Group ID</li>\n<li>Group Name</li>\n<li>Group Under (This will store the ID of the group under which this group is from</li>\n</ul>\n\n<p>But this can only refer to just the next level, how will I get to know who is the super-parent of this group.</p>\n\n<p>For example:</p>\n\n<ul>\n<li>I have groups <code>A, B, C</code>. </li>\n<li><code>A</code> has further subgroups <code>A1, A2, A3</code>. </li>\n<li><code>A1</code> has further subgroups, <code>A11, A12, A13</code>. </li>\n</ul>\n\n<p>I will I have the information about super-parent group i.e <code>A</code> from <code>A11</code> or <code>A22</code> or <code>A33</code>? </p>\n\n<p>Let me know if the problem is not clear..</p>\n"},{"tags":["sql","sql-server","sql-server-2000","parameter-sniffing"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13144556,"title":"How can I cure parameter sniffing on SQL Server 2000?","body":"<p>I am having an issue where an update query with about 70 parameters times-out on occasion. Based on some research, I believe this is due to packet sniffing. I saw that in newer versions of SQL Server, I can use the <code>Option(recompile)</code> clause, but that does not work in my case, since I am using server 2000.</p>\n\n<p>I am using <code>sqlhelper.executeNonQuery</code> and not a stored procedure.</p>\n"},{"tags":["sql-server","vb.net","sql-server-2008-r2","smo"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13143942,"title":"Programmatically determine max size of SQL Server Express database","body":"<p>Is there a way to determine the max size of a SQL Server Express database using SMO? </p>\n\n<p>Or will I have to add code to say </p>\n\n<pre><code>if express then\n  if sql2005 then \n    limit = 4gb \n  else \n    limit = 10gb\nelse\n  limit = unlimited\nend\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":24,"score":2,"question_id":13143883,"title":"Date Specific Criteria for Query","body":"<p>I have a query that is gathering data from the 20th of last month to the 19th of this month and it seems to be working.</p>\n\n<pre><code>(DateTime &gt;= 19+dateadd(mm,datediff(mm,0,getdate())-1,0)   \nAND  DateTime &lt;  18+dateadd(mm,datediff(mm,0,getdate()),0)) \n</code></pre>\n\n<p>I now need to somehow modify it to meet the following...</p>\n\n<p>Always show the current report no matter when it is run.</p>\n\n<p>Currently what happens is.....it works great if run anytime between the 20th of last month and the 19th of this month.....but as soon as it hits the 20th of this month through the 31th of this month....it keeps showing the last period....which technically i am asking it to do.</p>\n\n<p>What I need is.....When it becomes the 20th of this month....it starts a new report.</p>\n\n<p>As I said.....the problem period is between the 20th and the end of the month.  Once the new month starts....everything is fine.</p>\n\n<p>It somehow has to take into account when the report is being run.</p>\n\n<p>Thanks.</p>\n\n<p>Dave</p>\n"},{"tags":["c#","javascript",".net","sql-server","json"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13143936,"title":"The best way to pass rows of an SQL Database to Javascript?","body":"<p>So, recently I've been looking into the HTML5 Indexeddb feature which is controlled with Javascript, and how to incorporate this with an SQL Server database to share and copy information across so that a version of the database is available offline.</p>\n\n<p>The conundrum that I have is finding the best way to pass a set of objects from an SQL Server database through to the javascript of a browser, using C# to get the values from the database. </p>\n\n<p>Though there are many little \"hacks\" that can be done (e.g Putting data into labels and then having the Javascript just pick it up document.getElementById(\"DataHere\").value;) I was wondering if there were more efficient ways of passing the contents of a database across? </p>\n\n<p>At the moment I have a method that generates an array of strings (all in the JSON format, using the JSON.Net package) as an example of what would be returned from the database.</p>\n\n<pre><code>    public string[] GenerateEmployeeSample() {\n    List&lt;Employee&gt; listEmps = new List&lt;Employee&gt;();\n    string[] listJSON = new string[64];\n    string[] FirstNames = {\"Alonso\", \"Alfred\", \"Angus\", \"Alfresco\" };\n    string[] LastNames = {\"Johnson\",\"Williams\", \"Zelwegger\", \"Jones\" };\n    string[] Departments = {\"Finance\", \"Cleaning\", \"Pusher\", \"Stairs\" };\n    string emailEnd = \"@email.com\";\n\n    for (int i = 0; i &lt; 4; i++) {\n        for (int j = 0; j &lt; 4; j++) {\n            for (int k = 0; k &lt; 4; k++) {\n                Employee tempEmp = new Employee();\n                tempEmp.FirstName = FirstNames[i];\n                tempEmp.LastName = LastNames[j];\n                tempEmp.Department = Departments[k];\n                tempEmp.Email = FirstNames[i] + \".\" + LastNames[j] + emailEnd;\n                listEmps.Add(tempEmp);\n            }\n        }\n    }\n    int count = 0;\n    foreach(Employee emp in listEmps){\n        string tempString = JsonConvert.SerializeObject(emp);\n        listJSON[count] = tempString;\n        count++;\n    }\n\n    return listJSON;\n}\n</code></pre>\n\n<p>So now I have a set of data, how would I be able to pass this array through to Javascript?\nI apologise if this is a trivial question but Javascript is still rather new to me, and after reading through quite a few examples that either didn't do what I wanted or just outright didn't work I am at a bit of a loss.</p>\n\n<p>Thanks very much for reading!</p>\n"},{"tags":["sql-server","ms-access","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2673,"score":1,"question_id":5583256,"title":"ODBC Connection Failed #3151 MS Access --> SQL Server 2008","body":"<p>I have an MS Access application that links to a SQL Server 2008 db for all of its data.  For years, it has worked fine when the SQL Server was on Win2008 Standard 64-bit SP2 and SQL Server 2008 v10.0.4.  I recently moved the back-end SQL db to a newer server (Win2008 R2 Standard 64-bit and SQL v10.50.1600).  After the move, everything on the application worked just fine as expected, no issues.  However, we have a month-end process that generates relatively large reports (300-500 pages) which uncovered an issue that we don't normally see in our day-to-day processing.</p>\n\n<p>My report is based on a pass-through query.  The query runs almost instantaneously and produces 8000 rows.  I can preview the query and quickly navigate to the end of the RS to see the 8000'th row.  No problem.  If I pull up the report that's based on that query, I can see that there are 350 pages and I can navigate page-by-page through the report with no problem.  I can even type in a page number and jump to page 50, 100, 150, etc. with no problem. Note, there is no processing/code/logic happening on any fired events on the report - just displaying and formatting the data.  </p>\n\n<p>HERE IS WHERE THE PROBLEM OCCURS:  If I preview the report and try to jump to the last page from the first page, it'll sit and think for a while (38 seconds to be exact) and then throw <strong>Error #3151 ODBC Connection to [DNS Name] Failed.</strong>  </p>\n\n<p>If I simply update the connect string on the pass-through query to point it back to the \"older\" SQL Server and run the same thing, it works just fine.  I've tried adjusting the connect string to use IP address instead of DNS name, no luck.  This is a process that's worked for years with no problem so I know the client-side logic is sound.</p>\n\n<p>Any thoughts or suggestions?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":16,"score":-1,"question_id":13143930,"title":"Checking Specific Row's Value and Merge Values","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/194852/concatenate-many-rows-into-a-single-text-string\">Concatenate many rows into a single text string?</a><br>\n  <a href=\"http://stackoverflow.com/questions/10298805/mimic-group-concat-combined-with-group\">Mimic group_concat() combined with group</a>  </p>\n</blockquote>\n\n\n\n<p>this is the source table that I am currently working on:</p>\n\n<p><img src=\"http://i.stack.imgur.com/HSSbF.png\" alt=\"enter image description here\"></p>\n\n<p>And this is the desired output:</p>\n\n<p><img src=\"http://i.stack.imgur.com/xcnAB.png\" alt=\"enter image description here\"></p>\n\n<p>Can I achieve this by simple MSSQL query? Like just using <strong>GROUP BY or JOIN?</strong></p>\n"},{"tags":["sql-server","if-statement","where-clause"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":31,"score":-1,"question_id":13143832,"title":"If in where SQL Server","body":"<p>i have an stored procedure which recives 10 parameters type Date...\nbut i can show the information when the consult have null, because a have to show the flow of information of all the clients on this consult...sometimes the client have orders with creditnotes but in occasions only have an order but not have Credit notes.. \ni do this for the Where Clause :</p>\n\n<pre><code>        WHERE \n                (Customer.cd_CustomerID = ISNULL(@customer, Customer.cd_CustomerID))\n                AND (@orderID IS NULL OR Orders.cd_OrderID = @orderID)\n                AND (@Location IS NULL OR CustomerSL.cd_LocID = @Location)      \n                and (Convert(date,Orders.fh_Date,111) BETWEEN coalesce (@FechaPedido1,'1900-01-01') AND  coalesce (@FechaPedido2,'3000-12-31' ))\n                and (Convert(date,Receipt.fh_Date,111) BETWEEN coalesce (@FechaRemision1,'1900-01-01') AND  coalesce (@FechaRemision2,'3000-12-31' )) \n                and (Convert(date,Invoice.fh_Date,111) BETWEEN coalesce (@FechaFactura1,'1900-01-01') AND  coalesce (@FechaFactura2,'3000-12-31' )) \n                and (Convert(date,CreditNote.fh_Date,111) BETWEEN coalesce (@FechaNotaCredito1,'1900-01-01') AND  coalesce (@FechaNotaCredito2,'3000-12-31' ))\n                and (Convert(date,Dispersion.fc_CreatedDate,111) BETWEEN coalesce (@FechaDispersion1,'1900-01-01') AND  coalesce (@FechaDispersion2,'3000-12-31' ))\n</code></pre>\n\n<p>But on this case..only show the information which have all the flow for the client...the consult doesnt show me the flow of information who doesnt have An order without remissions or Dispersion o whatever is the case...  allready try with IF in Where.. but i have some problems with the sintaxis...</p>\n\n<blockquote>\n  <p>if (@fechapedido1 is  null)\n    begin\n  (Convert(date,Orders.fh_Date,111) BETWEEN  @FechaPedido1 and @FechaPedido2)<br>\n    end</p>\n</blockquote>\n\n<p>the sql server showme this message 'Incorrect syntax near the keyword 'Convert'.'\nbut...that line is correct.. :S Please Help Me :D\nthanks\n:D</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":175,"score":0,"question_id":9919278,"title":"SQL multiple replace","body":"<p>I want to read the company table and take out all possible suffixes from the name. Here's what I have so far:</p>\n\n<pre><code>declare @badStrings table (item varchar(50))\n\nINSERT INTO @badStrings(item)\nSELECT 'company' UNION ALL\nSELECT 'co.' UNION ALL\nSELECT 'incorporated' UNION ALL\nSELECT 'inc.' UNION ALL\nSELECT 'llc' UNION ALL\nSELECT 'llp' UNION ALL\nSELECT 'ltd'\n\nselect id, (companyname = Replace(name, item, '') FROM @badStrings)\nfrom companies\nwhere name != ''\n</code></pre>\n"},{"tags":["c#",".net","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13142114,"title":"Roles needed for executing Stored Procedure in SQL Server Authentication","body":"<p>I need to connect to SQL Server 2008 R2 database from a C# application. I need to use SQL Server authentication for the connection. </p>\n\n<p>What are the <strong>roles</strong> and schemas needed for the user so that the user will be able to create/execute stored procedures ? </p>\n\n<p>Note: The stored procedures will be in dbo schema.</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13143396,"title":"SQL Server 2008 unable to backup due to Failed to flush the commit table to disk in dbid 11 due to error 2601","body":"<p>I tried to backup the SQL Server 2008 database \nusing the following code: </p>\n\n<pre><code>BACKUP DATABASE [DataStore] TO  DISK ='E:\\SQLServerDatabase\\DataBasebackUpOct302012.bak'\n</code></pre>\n\n<p>and I get the following error:</p>\n\n<blockquote>\n  <p>Msg 2601, Level 14, State 1, Procedure sp_flush_commit_table, Line 15\n  Cannot insert duplicate key row in object 'sys.syscommittab' with\n  unique index 'si_xdes_id'.</p>\n  \n  <p>Msg 3013, Level 16, State 1, Line 1 BACKUP DATABASE is terminating\n  abnormally. The statement has been terminated.</p>\n  \n  <p>Msg 3999, Level 17, State 1, Line 1 Failed to flush the commit table\n  to disk in dbid 11 due to error 2601. Check the errorlog for more\n  information.</p>\n</blockquote>\n\n<p>Could somebody suggest a solution to this problem.\nThanks.</p>\n"},{"tags":["asp.net","sql-server","c#-4.0","iis6"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13143322,"title":"Message:The parameter is incorrect","body":"<p>I have a web site/app developed on my local machine.  A customer does an order.  Data they enter during the order is saved to a SQL Server DB duing each step in the order.</p>\n\n<p>If they naviagte away from the current order there is an option to resume orders - where the info is pulled back from the Table in the DB and displayed on screen.  Now this works 100% on my own Dev machine.</p>\n\n<p>Howvere I have deployed it to another server and it is not working as epxected - I can see the info gets stored to teh DB table ok.  However when I hit the page to resume - no data is returned.  I looked at SQL Profiler and it never hits the DB I am interested in (yet I can see from SQL Profiler that it hits the DB earlier (on logon to the site)</p>\n\n<p>I have they opened Dev Tools in chrome - on the network tab - on my own Dev machine - I can see the data in there (in a page called JSONService.aspx - which is how I get the data back)</p>\n\n<p>However in my other server environment I get the below:</p>\n\n<pre><code>ListOfErrors: [{CompletionCode:null, Message:The parameter is incorrect.\n }]\n0: {CompletionCode:null, Message:The parameter is incorrect.\n }\nCompletionCode: null\nMessage: \"The parameter is incorrect.\n\"\nObjects: null\nRequestStatus: \"Failure\"\n</code></pre>\n\n<p>I will be investigating this myself and if I get a resolution I will update my answer with it - does anyone possibly have any ideas of things I could try in the meantime - cannot think what I am missing at the minute?</p>\n"},{"tags":["sql-server","security","sql-server-2008","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2907,"score":3,"question_id":6212598,"title":"Server Role to execute SQL Server Agent Jobs in SQL SERVER 2008","body":"<p>The users from other departments ask me to grant them to execute Schedule Jobs / SSIS in SQL Server Agent.  At present, they cannot see SQL Server Agent tree in their ManagmentStudio.  I think, it's because they don't have the rights to execute them.</p>\n\n<p>So, I would like to know which server role should I give to them.  I only want to give them minimum privileges.  When I check the existing roles in my server, I could only see the following server roles</p>\n\n<ol>\n<li>bulkadmin</li>\n<li>dbcreator</li>\n<li>diskadmin</li>\n<li>processadmin</li>\n<li>public</li>\n<li>securityadmin</li>\n<li>serveradmin</li>\n<li>setupadmin</li>\n<li>sysadmin</li>\n</ol>\n\n<p>Please advise me.</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13142930,"title":"how to transpose in sql","body":"<p>Suppose I have</p>\n\n<pre><code>select *\nfrom A a\n     left outer join B b on b.ID in (1,2,3/*and possibly any numbers*/)\n</code></pre>\n\n<p>and so I get (<code>Ax - A's xth row, Bx - B's xth row</code>):</p>\n\n<pre><code>A1 B1\nA1 B2\nA1 B3\nA2 B1\n...\n</code></pre>\n\n<p>And what I want is this:</p>\n\n<pre><code>A1 B1 B2 B3\nA2 B1 B2 B3\n</code></pre>\n\n<p>So that there is dynamic number of columns. What is the best way of achieving this?</p>\n"},{"tags":["sql-server","visual-studio-2010","ssdt"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13142868,"title":"SQL Server Data Tools and Visual Studio Issue","body":"<p>I have just installed vs2010 sp1 ultimate, sqlserver 2012 and the latest version of sqlserver data tools.  I have opened up a solution from source control and receive a bunch of error like the following when trying the build the database project.</p>\n\n<p>SQL71566: Microsoft.Data.Tools.Schema.Sql.SchemaModel.SqlFilegroup cannot not be set on both the Microsoft.Data.Tools.Schema.Sql.SchemaModel.SqlTable and the clustered Microsoft.Data.Tools.Schema.Sql.SchemaModel.SqlPrimaryKeyConstraint.</p>\n\n<p>Running on Windows 7 professional, 64 bit</p>\n\n<p>This is working fine for other members of the team and they all seem to have the same setup as me.</p>\n\n<p>I have tried uninstalling and reinstalling vs2010 and ssdt</p>\n\n<p>Any ideas anyone?</p>\n"},{"tags":["c#","sql-server","search","architecture"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":13142415,"title":"What architecture to use for an extensive search","body":"<p>one of the things we're building right now is a search functionality to look for people.</p>\n\n<p>When starting simple, we've used Linq to entities to search, like this: <code>Entities.People.Where(z=&gt;z.Birthdate &lt; birthdate).ToList()</code></p>\n\n<p>Then, when new searchcriteria were added, the linq statement grew and grew, and now we have to refactor it because nobody understands it anymore.</p>\n\n<p>At this point, we must facilitate search for 8 related items, like 'did you work here', 'do you speak this language', 'from these 6 skills, which ones do you master' etc.</p>\n\n<p>All these items are 1:N or N:N relations in SqlServer, and we are searching for multiple items AND we want to know 'how much match' you have.</p>\n\n<p>For example: we look for people who speak french and or English and or German, and we want to get all people who have at least 1 match, and for those people, we want to know how many matches (ie 1 out of 3 or 2 out of 3) every person has.</p>\n\n<p>At this point the question is: what is a smart thing to do (approx 10.000 people in the database).</p>\n\n<p>Brainstorming has lead us to the following options:</p>\n\n<ol>\n<li>Do the quickest search in the database (so you retrieve limited\namount of records) and sort the rest in code </li>\n<li>Keep on building with Linq </li>\n<li>Perform the whole action in SqlServer</li>\n</ol>\n\n<p>Any tips to get us started?</p>\n"},{"tags":["sql-server","reporting-services","ssrs-2008","ssrs-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13135827,"title":"Passing Non-Null Parameter returns NULL records in SQL Server","body":"<p>I had recently posted a question about how to handle NULL values in SQL Server Reporting Services. The question is located at <a href=\"http://stackoverflow.com/questions/13087095/handle-null-values-in-sql-server-reporting-services\">Handle NULL values in SQL Server Reporting Services</a>.</p>\n\n<p>Applying <code>WHERE @MyParam=MyCol OR @MyParam IS NULL</code> faces a problem, which is if I select single NON-NULL value (from the dropdownlist and pass this as in SQL Server), this also brings the NULL value records. It should only bring the Non NULL value's records.</p>\n\n<p>What should be done to avoid NULL records, if NON-NULL records are selected?</p>\n"},{"tags":["sql-server","triggers","information-schema"],"answer_count":4,"favorite_count":4,"up_vote_count":12,"down_vote_count":0,"view_count":17433,"score":12,"question_id":636452,"title":"What is the best way to check whether a trigger exists in SQL Server?","body":"<p>I'm looking for the <strong>most portable</strong> method to check for existance of a trigger in MS SQL Server. It needs to work on at least SQL Server 2000, 2005 and preferably 2008.</p>\n\n<p>The information does not appear to be in INFORMATION_SCHEMA, but if it is in there somewhere, I would prefer to use it from there.</p>\n\n<p>I do know of this method:</p>\n\n<pre><code>if exists (\n    select * from dbo.sysobjects \n    where name = 'MyTrigger' \n    and OBJECTPROPERTY(id, 'IsTrigger') = 1\n) \nbegin\n\nend\n</code></pre>\n\n<p>But I'm not sure whether it works on all SQL Server versions.</p>\n\n<p>So my questions are: </p>\n\n<ul>\n<li>Is the above the \"best\" way? </li>\n<li>Are there any alternative methods?</li>\n<li>What are their pros and cons?</li>\n</ul>\n"},{"tags":["sql-server","transactional-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13135748,"title":"Strategy to check if Transactional Replication succeeded","body":"<p>We would like to use Transactional Replication to replicate data from one source database to recipient databases. If replication succeed it is necessary to notify some other systems in workflow. Is there any way to check, based on some attribute, if replication succeded? What for strategy would you choose to notify, for example cache, that some data are available? </p>\n\n<p><strong>Update:</strong>\nI think I wasn't clear enough. What we want to know is, if entity is already an all subscribers. For example: I insert a new  <em>Car</em> and some <em>Cars</em> details into two tables in master DB. I want to know if a new <em>Car</em> and his details are replicated to all subscribers to able to say: <em>\"Car is online\"</em></p>\n"},{"tags":["sql-server","sql-server-2008-r2","service-broker"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13141595,"title":"How many connections reads queue","body":"<p>Is there a way to get to know how many external tasks (console applications) is reading queue?</p>\n\n<p>I am using Service Broker external activator.</p>\n\n<p>What i want is something similar to information i get from <a href=\"http://msdn.microsoft.com/en-us/library/ms175029.aspx\" rel=\"nofollow\">sys.dm_broker_activated_tasks</a>, just for external queue readers.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","exists"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13141461,"title":"What can I do to speed up this SQL Query?","body":"<p>I've created this SQL query with the help of @Dems :-)</p>\n\n<p>Here is some detail, I tried to make a SQLFiddle but I kept getting errors with my variables... This works in Sql Server 2008...  My question is, how can I make my query faster? I know I'm doing a number of things wrong here (repeated nester queries), I'm hoping to get one of you SQL gurus to take a look and help me get this down from it's 30 minute execution time! :-S</p>\n\n<p>I'm not sure exactly how much information you need to be able to help me on this one, please fire away with any questions and I'll reply ASAP.  Sorry if the level of detail is lacking a little, I just don't know what you want/need to know!</p>\n\n<p>The basic idea behind the query is that in the game I want to find all players which haven't moved 5 units for a period of time, who have fired whilst stood still and did not fire for 60 minutes before they stopped moving.  The query works, but it's the <code>AND NOT EXISTS</code> clause which is slowing things down to a crawl, before I added that it took 16 seconds to run!  16 seconds is still a looong time, so any other improvements would be appreciated, but for now with this being my own POC game (just throwing bits and pieces together), 16 seconds is acceptable... </p>\n\n<pre><code>DECLARE @n INT , @DistanceLimit INT\nSELECT  @n = 2 , @DistanceLimit = 5;\n\nWITH    partitioned\n          AS ( SELECT   * ,\n                        CASE WHEN Distance &lt; @DistanceLimit THEN 1\n                             ELSE 0\n                        END AS PartitionID\n               FROM     EntityStateEvent\n               WHERE    ExerciseID = '8B50D860-6C4E-11E1-8E70-0025648E65EC'\n             ),\n        sequenced\n          AS ( SELECT   ROW_NUMBER() OVER ( PARTITION BY PlayerID ORDER BY EventTime ) AS MasterSeqID ,\n                        ROW_NUMBER() OVER ( PARTITION BY PlayerID, PartitionID ORDER BY EventTime ) AS PartIDSeqID ,\n                        *\n               FROM     partitioned\n             ),\n        filter\n          AS ( SELECT   MasterSeqID - PartIDSeqID AS GroupID ,\n                        MIN(MasterSeqID) AS GroupFirstMastSeqID ,\n                        MAX(MasterSeqID) AS GroupFinalMastSeqID ,\n                        PlayerID\n               FROM     sequenced\n               WHERE    PartitionID = 1\n               GROUP BY PlayerID ,\n                        MasterSeqID - PartIDSeqID\n               HAVING   COUNT(*) &gt;= @n\n             )\n    SELECT\nDISTINCT    ( sequenced.PlayerID ) ,\n            MIN(sequenced.EventTime) AS StartTime ,\n            MAX(sequenced.EventTime) AS EndTime ,\n            DATEDIFF(minute, MIN(sequenced.EventTime),\n                     MAX(sequenced.EventTime)) AS StaticTime ,\n            Player.Designation AS 'Player'\n    FROM    filter\n            INNER JOIN sequenced ON sequenced.PlayerID = filter.PlayerID\n                                    AND sequenced.MasterSeqID &gt;= filter.GroupFirstMastSeqID\n                                    AND sequenced.MasterSeqID &lt;= filter.GroupFinalMastSeqID\n            INNER JOIN Events ON Events.FiringPlayerID = sequenced.PlayerID \n            INNER JOIN Player ON Player.PlayerID = sequenced.PlayerID\n                                 AND Player.Force = 'FR'\n                                 AND NOT EXISTS ( SELECT    *\n                                                  FROM      Events\n                                                  WHERE     Events.FiringPlayerID = Player.PlayerID\n                                                  GROUP BY  Events.FiringTime\n                                                  HAVING    Events.FiringTime BETWEEN DATEADD(minute,\n                                                              -60,\n                                                              ( SELECT\n                                                              MIN(s.EventTime)\n                                                              FROM\n                                                              sequenced s\n                                                              WHERE\n                                                              s.PlayerID = filter.PlayerID\n                                                              AND s.MasterSeqID &gt;= filter.GroupFirstMastSeqID\n                                                              AND s.MasterSeqID &lt;= filter.GroupFinalMastSeqID\n                                                              ))\n                                                              AND\n                                                              ( SELECT\n                                                              MIN(s.EventTime)\n                                                              FROM\n                                                              sequenced s\n                                                              WHERE\n                                                              s.PlayerID = filter.PlayerID\n                                                              AND s.MasterSeqID &gt;= filter.GroupFirstMastSeqID\n                                                              AND s.MasterSeqID &lt;= filter.GroupFinalMastSeqID\n                                                              ) )\n            INNER JOIN Player HitPlayer ON HitPlayer.PlayerID = Events.HitPlayerID\n    WHERE   HitPlayer.[FORCE] = 'HO'\n    GROUP BY GroupID ,\n            sequenced.PlayerID ,\n            Events.FiringPlayerID ,\n            Events.FiringTime ,\n            Player.Designation\n    HAVING  DATEDIFF(minute, MIN(sequenced.EventTime),\n                     MAX(sequenced.EventTime)) &gt; 5\n            AND Events.FiringTime BETWEEN MIN(sequenced.EventTime)\n                                  AND     MAX(sequenced.EventTime)\n    ORDER BY StartTime\n</code></pre>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13141369,"title":"is it possible to set column value to a concatenation of string and iteration value?","body":"<p>Is it possible to set value of a varchar column to a concatenation of a string and the result set iteration.    </p>\n\n<p>for example:</p>\n\n<pre><code>update TB_USER set LOGIN_NAME = 'BOB'+index where LOGIN_NAME = 'BOB'\n</code></pre>\n\n<p>results in the following: </p>\n\n<blockquote>\n  <p>LOGIN_NAME</p>\n  \n  <p>BOB0</p>\n  \n  <p>BOB1</p>\n  \n  <p>BOB2</p>\n</blockquote>\n"},{"tags":["sql-server","vb.net","azure"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":13141205,"title":"Simple VB/SQL app and AZURE","body":"<p>I have a simple ms sql 2012 express database &amp; a simple VB Express 2010 application as its front end.</p>\n\n<p>Can I simply host my MS SQL database on Azure &amp; update the application to interrogate the hosted database? This would mean, the application would still be local, but the DB would be hosted. My offices are distributed &amp; if we could do this it would save quite a bit of hassle.</p>\n\n<p>Do I need to use a virtual machine, cloud services or straight hosting? Its difficult for me to understand the subtleties each service.</p>\n\n<p>I've had a look at the azure services information and the documentation is pitched a little high for me. I just wanted to know if this is relatively simple thing to do &amp; if anyone has has any pointers to How To's or Noob guides to azure.</p>\n"},{"tags":["sql","sql-server","count","aggregate-functions","select-case"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":92,"score":3,"question_id":13140545,"title":"How can you use a COUNT() in a comparison in a SELECT CASE clause in Sql Server?","body":"<p>Let's say you want do something along the following lines:</p>\n\n<pre><code>SELECT CASE \n    WHEN (SELECT COUNT(id) FROM table WHERE column2 = 4) &gt; 0\n    THEN 1 ELSE 0 END\n</code></pre>\n\n<p>Basically just return 1 when there's one or more rows in the table, 0 otherwise.  There has to be a grammatically correct way to do this.  What might it be?  Thanks!</p>\n"},{"tags":["c#","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":493,"score":0,"question_id":3226571,"title":"how i can generate programmatically \"insert into\" data script file from a database table?","body":"<p>is there an elegant object-orient based framework?</p>\n"},{"tags":["sql","sql-server","reporting-services"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13093910,"title":"SSRS Parameter doesn't display even though the query works","body":"<p>I have a query to fill a report parameter:</p>\n\n<pre><code>select distinct [Source No_] from _report_sales_master\nwhere [Industry] = @Industries\nand [posting date] &gt;= dateadd(year,datediff(year,'01/06/2000',@year)-1,'01/06/2000') \nand  [posting date] &lt; dateadd(year,datediff(year,'01/06/2000',@year),'01/06/2000')\norder by [Source No_]\n</code></pre>\n\n<p>The query results in a list that I use to fill a multi-value report parameter.</p>\n\n<p>When I run the query, it generates the right results.</p>\n\n<p>When I run the report, the \"Source No_\" parameter stays empty, no matter which @year or @industries i choose</p>\n\n<p>When I  remove the \"posting date\" clauses from the query, the parameter list populates and works properly. </p>\n\n<p>What am I missing?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13140149,"title":"Return Query Based on Tree Structure","body":"<p>I am looking to return a query that shows exactly like this:</p>\n\n<p>Root 1<br/>\n--> Child 2 <br/>\n----->Child 3 <br/>\nRoot 2 <br/>\n--> Child 4 <br/>\n---->Child 5 <br/></p>\n\n<p>So the query should return Root 1 as One row, ---> Child 2 as another row. Assume n Levels, and \"--->\" format is placed for each child. Level is higher then \"---->\" increases.</p>\n\n<p>My Table definition is <br/></p>\n\n<p><strong>[NodeId, ParentId, Name, Level]</strong></p>\n"},{"tags":["sql-server","database","design","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":49,"score":1,"question_id":13140360,"title":"Design Database - Best Practice","body":"<p>I need to implement an SQL server db, that will contain information about products as follow:</p>\n\n<p>There will be the following properties:</p>\n\n<pre><code>**ProductName\nProductTitle\nProductPrice\nCreatedDate\nCreatedBy**\n</code></pre>\n\n<p>(now it get's complicated)</p>\n\n<pre><code>**Property1 (MIN value, MAX value)\nProperty2 (MIN value, MAX value)\nProperty3 (MIN value, MAX value)\nProperty4 (MIN value, MAX value)\nProperty5 (MIN value, MAX value)\nProperty6 (MIN value, MAX value)\n...........\nProperty40 (MIN value, MAX value)**\n</code></pre>\n\n<p>All products will have the same structure, how can I implement the properties that will contain the values min and max? So, each product will have a min and max value for each of the Property from 1 - 40. The value in the min and max is decimal.</p>\n\n<p>Should I create one Products table where I have the basic details (name, title, price, date ..) and than for each property create one table Property1 for example with foreign key to Products table?</p>\n\n<p>Is there a better way? What do you recommend ?</p>\n"},{"tags":["sql-server","debugging"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13138774,"title":"Executing a SQL query during debugging in SQL Server Management Studio on locked table","body":"<p>Is it possible to somehow execute a query against a table during debugging of T-SQL statement? It's locked for another connections at the time, so using another windows doesn't help.</p>\n\n<p>I'm trying to debug an <code>INSTEAD OF UPDATE</code> trigger, something isn't working as expected and I'd like to evaluate another SQL expression to investigate. </p>\n\n<p>I think that I maybe could write a cursor that will loop the table and <code>print</code> the information I need, but I'd rather avoid that and use something simpler.</p>\n"},{"tags":["sql","sql-server","triggers","merge-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12931756,"title":"Trigger does not work because of deprecated datatype in replicated table","body":"<p>I have a table in my SQL Server 2005 database, which has a field with the datatype NTEXT. This table is replicated in a merge-replication with a lot of SQLCE-subscriptions.</p>\n\n<p>I have tried to add an <code>ON INSERT</code> trigger to this table to process the NTEXT-field. But I got this error:</p>\n\n<pre><code>Cannot use text, ntext, or image columns in the 'inserted' and 'deleted' tables.\n</code></pre>\n\n<p>On my researches I found several postings that NTEXT is deprecated and I should change to NVARCHAR(MAX). But I can't do this without recreating the snapshot, which is quite a problem for the people working with the devices (because of dataamount and time).</p>\n\n<p>Is there a workaround for the insert-trigger to handle the datatypes?</p>\n\n<p>This is where the error is thrown:</p>\n\n<pre><code>DECLARE c1 CURSOR FOR SELECT ControlValue FROM INSERTED\n</code></pre>\n"},{"tags":["sql-server","tsql","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13139725,"title":"SELECT query on large table","body":"<p>I need to review / refactor an existing stored procedure that targets a table (10+ millons of rows). The stored procedure signature can not be changed easily and it looks like below.</p>\n\n<p>The stored procedure takes two strings delimited by pipes and uses a SQL function (<code>SplitDelimitedVarChar</code>) to split the string into a temp table which is then used in the actual select. The number of strings in the <em>array</em> string ranges from 1 to thousands. </p>\n\n<p>The <code>DateValue</code> and <code>TimeValue</code> columns contains <code>int</code> representations of the timestamp in the row.</p>\n\n<p>My question is if any one has any ides if this is a good (best?) solution or if it could be done better. The main question is if it could be optimized for speed?</p>\n\n<p>Since the table is only accessed through this stored procedure the index is a non clustered with the <code>WHERE</code> columns and includes all the <code>SELECT</code> columns.</p>\n\n<p>Thanks for any suggestions or pointers.</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[spdata_Get_Ana]\n@beginTime INT,\n@endTime INT,\n@subscribers VARCHAR(MAX),\n@exchanges VARCHAR(MAX) = '1:',\n@beginDateValue int, \n@endDateValue int,\n@target int = 1\nAS  \nBEGIN\nSET NOCOUNT ON;\n\nCREATE TABLE #exch (Item Varchar(20) COLLATE database_default)\nINSERT INTO #exch\nSELECT Item FROM [SplitDelimitedVarChar] (@exchanges, '|') ORDER BY Item\nCREATE CLUSTERED INDEX idx ON #exch (Item)\n\nCREATE TABLE #subs (Item Varchar(20) COLLATE database_default)\nINSERT INTO #subs\nSELECT Item FROM [SplitDelimitedVarChar] (@subscribers, '|') ORDER BY Item\nCREATE CLUSTERED INDEX idx ON #subs (Item)\n\nSELECT \n   [Id]\n  ,'' AS 'Name'\n  ,[NameId]\n  ,[Level]\n  ,[Ne]\n  ,[CallId]\n  ,[Bg]\n  ,[DateTime]\n  ,[TimeStamp]\n  ,[LogOwnerSnb]\n  ,[TypeOfLog]\n  ,[AbsenceCode]\n  ,[AnswerTime]\n  ,[CallForwardingReason]\n  ,[CallForwardingToNumber]\n  ,[CallTransferTime]\n  ,[CallTransferReason]\n  ,[SeizedSubscriberType]\n  ,[SeizedSubscriberTime]\n  ,[SeizedSubscriberNumber]\n  ,[CalledSubscriberService]\n  ,[InSubscriberType]\n  ,[InSubscriberNumber]\n  ,[CallDirection]\n  ,[SubscriberService]\n  ,[ClearingCause]\n  ,[ClearingCauseTime]\n  ,[OnHookTime]\n  ,[OutAnswerSubType]\n  ,[OutAnswerTime]\n  ,[OutAnswerSubNum]\n  ,[RingingStartedTime]\n  ,[ReroutedToNumber]\n  ,[InitiatedService]\n  ,[B26]\nFROM [dbo].[data_centrex_Ana] AS A\nWHERE\n    (A.[DateValue] BETWEEN @beginDateValue AND @endDateValue)\nAND\n    EXISTS(SELECT [Item] FROM #exch WHERE [Item] = A.[Level])\nAND\n    (A.[TimeValue] BETWEEN @beginTime AND @endTime)\nAND\n(\n   (@target = 1 AND EXISTS(SELECT [Item] FROM #subs WHERE [Item] = A.[LogOwnerSnb]))\n   OR\n   (@target = 2 AND EXISTS(SELECT [Item] FROM #subs WHERE [Item] = A.[Bg]))\n)\nEND\n</code></pre>\n"},{"tags":[".net","sql-server","wcf","active-directory","identity-delegation"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":13108419,"title":"WCF Delegation, Service couldn't access SQL Server","body":"<p>I have the following infrastructure:</p>\n\n<ul>\n<li><p>Computer #1, Microsoft SQL Server 2008, started under System account. There is login <code>Master\\MyLogin</code> (with Windows Authintification), server roles = <code>sysadm</code>, database role = <code>db_owner</code>.</p></li>\n<li><p>Computer # 2, WCF service on IIS 7.0. Application and site run under account <code>Master\\IISLogin</code> (IISLogin@myDomain.ru)</p></li>\n</ul>\n\n<p>Configuration:</p>\n\n<pre><code>&lt;configuration&gt;\n  &lt;system.web&gt;\n    &lt;compilation debug=\"true\" /&gt;\n  &lt;/system.web&gt;\n  &lt;system.serviceModel&gt;\n    &lt;bindings&gt;\n      &lt;netTcpBinding&gt;\n        &lt;binding name=\"CommonWindowsBinding\" maxReceivedMessageSize=\"40000000\"&gt;\n          &lt;security mode=\"TransportWithMessageCredential\"&gt;\n            &lt;transport clientCredentialType=\"Windows\" /&gt;\n          &lt;/security&gt;\n        &lt;/binding&gt;\n      &lt;/netTcpBinding&gt;\n    &lt;/bindings&gt;\n    &lt;serviceHostingEnvironment multipleSiteBindingsEnabled=\"true\" /&gt;\n    &lt;services&gt;\n      &lt;service behaviorConfiguration=\"CommonBehavior\" name=\"MyNameSpace.AdminService\"&gt;\n        &lt;endpoint address=\"Windows\" binding=\"netTcpBinding\" bindingConfiguration=\"CommonWindowsBinding\" name=\"IAdminServiceWindows\" contract=\"MyNameSpace.IAdminService\"&gt;\n          &lt;identity&gt;\n            &lt;dns value=\"WCFServer\" /&gt;\n            &lt;userPrincipalName value=\"IISLogin@myDomain.ru\"/&gt;\n          &lt;/identity&gt;\n        &lt;/endpoint&gt;\n      &lt;/service&gt;\n    &lt;/services&gt;\n    &lt;behaviors&gt;\n  &lt;serviceBehaviors&gt;\n    &lt;behavior name=\"CommonBehavior\"&gt;\n      &lt;dataContractSerializer maxItemsInObjectGraph=\"10000000\" /&gt;\n      &lt;serviceMetadata httpGetEnabled=\"true\" policyVersion=\"Policy15\" /&gt;\n      &lt;serviceDebug includeExceptionDetailInFaults=\"true\" /&gt;\n      &lt;serviceCredentials&gt;\n        &lt;clientCertificate&gt;\n          &lt;authentication certificateValidationMode=\"PeerTrust\" /&gt;\n        &lt;/clientCertificate&gt;\n        &lt;serviceCertificate findValue=\"WCFServer\" storeLocation=\"LocalMachine\" storeName=\"My\" x509FindType=\"FindBySubjectName\" /&gt;\n        &lt;userNameAuthentication userNamePasswordValidationMode=\"Custom\" customUserNamePasswordValidatorType=\"MyClassFullName, MyDllFullName\" /&gt;\n      &lt;/serviceCredentials&gt;\n    &lt;/behavior&gt;\n  &lt;/serviceBehaviors&gt;\n&lt;/behaviors&gt;\n&lt;/system.serviceModel&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>Service has method</p>\n\n<pre><code>[OperationBehavior(Impersonation = ImpersonationOption.Allowed)]\npublic bool HasRole(string roleName)\n{\n     //work with database\n}\n</code></pre>\n\n<p>It uses EF 5.0 database first. Connection string</p>\n\n<pre><code>\"Data Source=Computer1; Initial Catalog=myDB; Integrated Security=True; Multipleactiveresultsets=True; Persist Security Info=True;\"\n</code></pre>\n\n<ul>\n<li><p>Computer # 3, the client. It has the following config</p>\n\n<pre><code>&lt;configuration&gt;\n&lt;system.serviceModel&gt;\n  &lt;bindings&gt;\n    &lt;netTcpBinding&gt;\n        &lt;binding name=\"CommonWindowsBinding\" closeTimeout=\"00:01:00\"\n            openTimeout=\"00:01:00\" receiveTimeout=\"00:10:00\" sendTimeout=\"00:01:00\"\n            transactionFlow=\"false\" transferMode=\"Buffered\" transactionProtocol=\"OleTransactions\"\n            hostNameComparisonMode=\"StrongWildcard\" listenBacklog=\"10\"\n            maxBufferPoolSize=\"524288\" maxBufferSize=\"65536\" maxConnections=\"10\"\n            maxReceivedMessageSize=\"40000000\"&gt;\n            &lt;readerQuotas maxDepth=\"32\" maxStringContentLength=\"8192\" maxArrayLength=\"16384\"\n                maxBytesPerRead=\"4096\" maxNameTableCharCount=\"16384\" /&gt;\n            &lt;reliableSession ordered=\"true\" inactivityTimeout=\"00:10:00\"\n                enabled=\"false\" /&gt;\n          &lt;security mode=\"TransportWithMessageCredential\"&gt;\n            &lt;transport clientCredentialType=\"Windows\" /&gt;\n          &lt;/security&gt;\n        &lt;/binding&gt;\n     &lt;/netTcpBinding&gt;\n&lt;/bindings&gt;\n&lt;client&gt;\n    &lt;endpoint  name=\"Megatec.MasterTourService.Contracts.IAdminServiceWindows\"\n        address=\"net.tcp://Computer2:5012/IISTest/AdminService.svc/Windows\"\n        behaviorConfiguration=\"CustomBehavior\"\n        binding=\"netTcpBinding\"\n        bindingConfiguration=\"CommonWindowsBinding\"\n        contract=\"Megatec.MasterTourService.Contracts.IAdminService\"&gt;\n       &lt;identity&gt;\n            &lt;dns value=\"WCFServer\" /&gt;\n       &lt;/identity&gt;\n    &lt;/endpoint&gt;        \n&lt;/client&gt;\n&lt;behaviors&gt;         \n  &lt;behavior name=\"CustomBehavior\"&gt;\n    &lt;dataContractSerializer maxItemsInObjectGraph=\"10000000\"/&gt;\n    &lt;clientCredentials&gt;\n      &lt;clientCertificate findValue=\"WCFClient\" x509FindType=\"FindBySubjectName\"\n          storeLocation=\"LocalMachine\" storeName=\"My\" /&gt;\n           &lt;serviceCertificate&gt;\n               &lt;defaultCertificate findValue=\"WCFServer\" storeLocation=\"LocalMachine\"\n                                   x509FindType=\"FindBySubjectName\" /&gt;\n               &lt;authentication certificateValidationMode=\"PeerTrust\" \n                               revocationMode=\"NoCheck\"\n                               trustedStoreLocation=\"LocalMachine\"/&gt;\n            &lt;/serviceCertificate&gt;\n          &lt;/clientCredentials&gt;\n        &lt;/behavior&gt;\n      &lt;/endpointBehaviors&gt;\n    &lt;/behaviors&gt;\n  &lt;/system.serviceModel&gt;\n&lt;/configuration&gt;\n</code></pre></li>\n</ul>\n\n<p>Channel has the following credentials</p>\n\n<pre><code>channelFactory.Credentials.Windows.AllowedImpersonationLevel =\n    System.Security.Principal.TokenImpersonationLevel.Delegation;\nchannelFactory.Credentials.Windows.ClientCredential =\n    System.Net.CredentialCache.DefaultNetworkCredentials;\n</code></pre>\n\n<p>It falls with db error </p>\n\n<blockquote>\n  <p><em>Login failed for user 'NT AUTHORITY\\Anonymous'</em></p>\n</blockquote>\n\n<p>So, there is some problem with WCF delegation. When I tried to use simple <code>username/password</code> authentication, it worked fine - so, certificates and so on are fine. </p>\n\n<p>I did Step 4 on <a href=\"http://msdn.microsoft.com/en-us/library/ff650896.aspx\" rel=\"nofollow\">this instruction</a>, but it doesn't work. </p>\n\n<p>Maybe something is wrong with my code or configs? How can I fix it?</p>\n\n<p><strong>UPDATE</strong>. </p>\n\n<ol>\n<li><p>Tried (no result)</p>\n\n<p>[OperationBehavior(Impersonation = ImpersonationOption.Allowed)] => [OperationBehavior(Impersonation = ImpersonationOption.Required)]</p></li>\n<li><p>Tried  (no result)</p>\n\n<p></p></li>\n<li><p>On the service side </p>\n\n<p>ServiceSecurityContext.Current.WindowsIdentity.ImpersonationLevel = Impersonation (not Delegation!)</p></li>\n<li><p>When I tried to change identity for IIS pool from ApplicationPoolIdentity to IISLogin@myDomain.ru, the client on the computer 3 crashed.</p></li>\n</ol>\n"},{"tags":["sql-server","sharepoint","iis"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":17,"score":2,"question_id":13139532,"title":"Sql server login name not working properly in .net roles","body":"<p>I created one new sql login for configuring the forms based authentication in sharepoint. I created login with name <strong>FBAUser</strong>, but If I add that user to .net roles of IIS manager, it is showing login failed.\n<img src=\"http://i.stack.imgur.com/QmECP.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/Aj56N.png\" alt=\"enter image description here\"></p>\n\n<p>Why this problem occurring. After creating the new login in sql server, if I try to login with that credentials login also not happening. I checked the properties of the server as <strong>\"Sql and windows authentication mode\"</strong> as below.\n<img src=\"http://i.stack.imgur.com/CJoH3.png\" alt=\"enter image description here\"></p>\n\n<p>Can any one provide me the solution for this one!!</p>\n"},{"tags":["sql-server","math","overflow"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13121154,"title":"Arithmetic overflow error converting nvarchar to data type numeric","body":"<p>I have a stored procedure which works fine in my local environment as well as the QA environment. </p>\n\n<p>However at the UAT environment at the client it gives the error </p>\n\n<blockquote>\n  <p><em>System.Data.SqlClient.SqlException:</em><br>\n   <em>Message number=\"8115\" severity=\"16\" state=\"8\">Arithmetic overflow error\n   converting nvarchar to data type numeric.</em></p>\n</blockquote>\n\n<p>It also works fine in one of the local instances installed in the client location. \nI found out the line of code which gives an error by commenting/umcommenting lines of code and zeroed it down to</p>\n\n<pre><code>(\n        @TotalHHInternalTo IS NULL\n        OR\n        (\n            IsNumeric(E.[Xml].value(\n                                    'declare default element namespace \"http://www.xyz/1.0\";\n                                    (/Event/Data/CustomData/DataXML/ProductData/ProductParty/ProductCategory[@code != ''Protection'']/Product/FundValue)[1]',\n                                    'nvarchar(50)'\n                                    ) ) = 1\n            AND\n            EXISTS\n            (\n                SELECT \n                    1\n                FROM E.[Xml].nodes(\n                    'declare default element namespace \"http://www.xyz/1.0\";\n                    /Event/Data/CustomData/DataXML/ProductData/ProductParty/ProductCategory[@code != ''Protection'']/Product') as P(E)\n                HAVING SUM(P.E.value(\n                                        'declare default element namespace \"http://www.xyz/1.0\";\n                                        (FundValue)[1]',\n                                        'decimal'\n                                        )) &lt;= @TotalHHInternalTo\n            )   \n        )\n     )\n</code></pre>\n\n<p>The variable <code>@TotalHHInternalTo</code> is a parameter of type decimal which is part of search criteria passed to the stored procedure as an xml. Under Product party I have 4 product category and I need to total up all Fund value except of type Protection. If the sum of these 3 types is less than  <code>@TotalHHInternalTo</code> I would like to display it in the search result.</p>\n\n<p>I added the <code>isNumeric</code> condition to check if the value picked up from the xml is a numeric value. </p>\n\n<p>However I still get an overflow error. </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13139140,"title":"SQL Server 2008 Calculation Bug","body":"<p>Here is the query i am running</p>\n\n<pre><code>Select (100/18)*18\n</code></pre>\n\n<p>The answer i get is 90. I have tried declaring each of the numbers as decimals also, and i get the value <code>100.0008</code>, but when i calculate with variables as floats the answer is correct at '100' so does anyone have any idea why SQL calculates like this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13138194,"title":"Dependency on master and child in SQL","body":"<p>I have a master table like this</p>\n\n<pre><code>Product    Status  Product id\nA          True     1\nB          True     2\nC          true     3\nD          True     4\nE          false    5\nF          True     6\n</code></pre>\n\n<p>Now I have other table which is giving me the dependency of the product</p>\n\n<pre><code>Product    DependencyId\nC             2\nC             5\nE             1\nB             4\nB             6\n</code></pre>\n\n<p>Now when I searching for C, I can see that two products are dependent upon C now these two product is dependent upon other products.</p>\n\n<p>And let say I am searching for E, then I there are only one dependency of the product.</p>\n\n<p>Now, I need to check for a product that if any dependency is false or not. If any of the dependency is false then I have to return some text/value.</p>\n\n<p><strong>Result</strong></p>\n\n<pre><code>When product is C then output will be E (because the grand children of C (i.e. E) has false)\n\nWhen product is B then output will be NULL (becuase none of the child of B or their sub childrens has false)\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13137246,"title":"Column in table is of a type that is invalid for use as a key column in an index","body":"<p>I have a table where I am storing employee details. I want to alter the table and set one of the column <code>emp_code</code> as primary key. Its datatype is <code>nvarchar(max)</code>, but I am not able to set it as primary key.</p>\n\n<p>I run the following query : </p>\n\n<pre><code>ALTER TABLE user_master\nADD PRIMARY KEY (emp_code)\n</code></pre>\n\n<p>but it gives me an error :</p>\n\n<blockquote>\n  <p><em>Msg 1919, Level 16, State 1, Line 1</em><br>\n  <em>Column <code>emp_code</code> in table <code>user_master</code> is of a type that is invalid for use as a key column in an index.</em><br>\n  <em>Msg 1750, Level 16, State 0, Line 1</em><br>\n  <em>Could not create constraint. See previous errors.</em></p>\n</blockquote>\n\n<p>How can I overcome this?</p>\n"},{"tags":["sql-server","sql-server-2008","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13132526,"title":"Selecting Change_Tracking_Current_Version() in SQL Server 2008 table trigger","body":"<p>I am using SQL Server 2008 and Change tracking is enabled on my Database.\nOn one of my tables in the database, I have created the following Trigger.</p>\n\n<pre><code>CREATE TRIGGER [dbo].[tr_student]\n   ON [dbo].[Student]\n   FOR UPDATE,DELETE\nAS \nBEGIN\n   SET NOCOUNT ON;\n   SELECT CHANGE_TRACKING_CURRENT_VERSION()\nEND\n</code></pre>\n\n<p>The purpose of this Trigger is - when I update or delete a record in table dbo.Student I should get the the Current change Tracking Version Id.</p>\n\n<p>But when I update/delete a record in the table, CHANGE_TRACKING_CURRENT_VERSION() is not giving the current version_id but the previous version_id. After the trigger is fired,if I execute \n    select CHANGE_TRACKING_CURRENT_VERSION()\nI am getting the correct current version id.</p>\n\n<p>So does the Change_Tracking_Current_Version() id change only after the trigger? Is there any method to get correct Change_Tracking_Current_Version() in the Trigger?</p>\n"},{"tags":["c#","asp.net","sql-server","session-variables"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13137997,"title":"Retrieve field from session","body":"<p>I have a form where company can register, in this registration a user code is generated randomly... The CompCode is saved with all the other information in a database table as the primary key...</p>\n\n<p>When a user is registered, they can log in... when they successfully log in, their compName is saved as a session variable</p>\n\n<pre><code>Session[\"CompName\"] = TextBox1.Text;\n</code></pre>\n\n<p>Now once logged in, they have the opportunity to post a job, this job details is saved in another table called job... but in order for the job details to be related to the company i need the CompID</p>\n\n<p>How do I retrieve the CompID using the session CompName</p>\n\n<pre><code> protected void Save_Click(object sender, EventArgs e)\n{\n    string answer = \"NO\";\n    string strcon = \"Data Source=.\\\\SQLEXPRESS;AttachDbFilename=|DataDirectory|\\\\VC_temps.mdf;Integrated Security=True;Connect Timeout=30;User Instance=True\";\n    SqlConnection con = new SqlConnection(strcon);\n\n    SqlCommand com = new SqlCommand(\"Store-Jobs\", con);\n    com.CommandType = CommandType.StoredProcedure;\n    com.Parameters.AddWithValue(\"Job\", TextBox1.Text);\n    com.Parameters.AddWithValue(\"JobType\", DropDownList1.Text);\n    com.Parameters.AddWithValue(\"StartDate\", Calendar1.SelectedDate);\n    com.Parameters.AddWithValue(\"Time\", TextBox2.Text);\n    com.Parameters.AddWithValue(\"JobID\", TextBox1.Text.Substring(3).ToUpper());\n    com.Parameters.AddWithValue(\"CompanyID\", ?);\n    com.Parameters.AddWithValue(\"PoistionFilled\", answer);\n    com.Parameters.AddWithValue(\"Description\", TextBox4.Text);\n\n    con.Open();\n    com.ExecuteNonQuery();\n    Labelinfo.Text = \"Post successful.\";\n}\n</code></pre>\n"},{"tags":["c#","sql","sql-server","ado.net"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13138615,"title":"SqlDataAdapter does not fill DataSet","body":"<p>I'm using VS2012 and SQL Server Express 2008.  I've boiled down my connection/query to try and find out why my <code>DataSet</code> is not being filled.  The connection is completed successfully, and no exceptions are thrown, but the adapter does not fill the <code>DataSet</code>. The database that this is pulling from is on the same PC and using <code>localhost\\SQLEXPRESS</code> does not change the result.  Thanks for any input!</p>\n\n<pre><code>SqlConnection questionConnection = new SqlConnection(ConfigurationManager.ConnectionStrings[\"DefaultConnection\"].ConnectionString);\nquestionConnection.Open();\nString sql = \"SELECT * FROM HRA.dbo.Questions\";\nSqlDataAdapter adapter = new SqlDataAdapter();\nDataSet ds = new DataSet();\nSqlCommand command = new SqlCommand(sql, questionConnection);\nadapter.SelectCommand = command;\nadapter.Fill(ds);\nadapter.Dispose();\ncommand.Dispose();\nquestionConnection.Close();\n</code></pre>\n\n<p>Connection String:</p>\n\n<pre><code>&lt;add name=\"DefaultConnection\" providerName=\"System.Data.SqlClient\" connectionString=\"Data Source=CODING-PC\\SQLEXPRESS;Initial Catalog=HRA;User ID=sa; Password= TEST\" /&gt;\n</code></pre>\n"},{"tags":["sql-server","accounting"],"answer_count":9,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":4883,"score":3,"question_id":1771995,"title":"Calculate fiscal year in SQL Server","body":"<p>How would you calculate the fiscal year from a date field in a view in SQL Server?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4703,"score":2,"question_id":4655981,"title":"SQL Server - use Exists clause in Where and Select","body":"<p>I have a view that's something like</p>\n\n<pre><code>CREATE VIEW OrdersView WITH SCHEMABINDING AS\nSELECT o.Id, o.OrderDate, o.LastName, o.TotalPrice, s.Status\nFROM dbo.Orders o INNER JOIN dbo.OrderStatus s on o.Id = s.OrderId\nWHERE NOT EXISTS (SELECT NULL from dbo.OrderStatus where OrderId = s.OrderId and StatusDate &gt; s.StatusDate\nAND EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderId = o.Id)\n</code></pre>\n\n<p>The intent is to fetch all orders that have at least one line item of type 1 along with their current status.</p>\n\n<p>We're in the process of adding a second type of line item, and I have modified the view such that it will include orders that have at least one line item of type 1 or type 2:</p>\n\n<pre><code>CREATE VIEW OrdersView WITH SCHEMABINDING AS\nSELECT o.Id, o.OrderDate, o.LastName, o.TotalPrice, s.Status\nFROM dbo.Orders o INNER JOIN dbo.OrderStatus s on o.Id = s.OrderId\nWHERE NOT EXISTS (SELECT NULL from dbo.OrderStatus where OrderId = s.OrderId and StatusDate &gt; s.StatusDate\nAND (EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderId = o.Id)\n  OR EXISTS (SELECT NULL FROM dbo.OrderLineItemType2 WHERE OrderId = o.Id))\n</code></pre>\n\n<p>Easy enough, but I've just had a requirement added to show whether an order contains line items of type 1 or type 2 (or both) in the grid where these results are displayed:</p>\n\n<pre>\nOrder ID | T1 | T2 | Last name | Price    | Status\n============================================================\n12345    | x  |    | Smith     | $100.00  | In Production\n12346    | x  | x  | Jones     | $147.23  | Part Dispatched\n12347    |    | x  | Atwood    | $12.50   | Dispatched\n</pre>\n\n<p>The only way I can think of is to do:</p>\n\n<pre><code>CREATE VIEW OrdersView WITH SCHEMABINDING AS\nSELECT o.Id, \n       CASE WHEN EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderID = o.Id) THEN 1 ELSE 0 END AS HasType1,\n       CASE WHEN EXISTS (SELECT NULL FROM dbo.OrderLineItemType2 WHERE OrderId = o.ID) THEN 1 ELSE 0 END AS HasType2,\n       o.OrderDate, o.LastName, o.TotalPrice, s.Status\nFROM dbo.Orders o INNER JOIN dbo.OrderStatus s on o.Id = s.OrderId\nWHERE NOT EXISTS (SELECT NULL from dbo.OrderStatus where OrderId = s.OrderId and StatusDate &gt; s.StatusDate\nAND (EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderId = o.Id)\n  OR EXISTS (SELECT NULL FROM dbo.OrderLineItemType2 WHERE OrderId = o.Id))\n</code></pre>\n\n<p>But this smells wrong with the duplication of the <code>EXISTS</code> clauses.  Is there a better qway to write it?  Can I make it perform better?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":503,"score":1,"question_id":10604275,"title":"Fiscal Year To-Date in Where Clause (T-SQL)","body":"<p>Company's Fiscal Year: July 1 - June 30</p>\n\n<p>I have a query where I am trying to capture aggregate # of units and $ revenue by product and cost center for the fiscal year-to-date.  It will run on the 1st of the month and look through the last day of the previous month.  Fiscal year does not appear in the report - it is criteria.</p>\n\n<pre><code>    Mix of pseudocode and SQL:\n    Where\n      If datepart(mm,getdate()) - 1 &lt; 7\n        THEN \n           transaction_post_date BETWEEN 7/1/ previous year AND dateadd(day,-(day(getdate()),getdate())          \n        Else \n           transaction_post_date BETWEEN 7/1/current year AND dateadd(day,-(day(getdate()),getdate())          \n</code></pre>\n\n<p>Am I on the write track?  How do I write the SQL for a specific date on a year that depends on SQL - 7/1/current year?  </p>\n\n<p>I am weak using variables and do not even know if I have access to create them on the SQL Server DB, which is rather locked down.  Definitely can't create a function.  (I'm a business analyst.)</p>\n\n<p>UPDATE, Fiscal year goes forward, so July 1, 2010, is Fiscal Year 2011.</p>\n\n<p>I think this works:</p>\n\n<pre><code>    Year(dateadd(month,6,htx.tx_post_date)) = Year(DateAdd(Month, 5, GetDate()))\n</code></pre>\n\n<p>Feeback?</p>\n\n<p>And now I've been asked to add Fiscal Year-To-Date fields for quantity and revenue to the following query which gave me totals for </p>\n\n<pre><code>    Select \n      inv.ITEM_CODE \n    , inventory.ITEM_NAME \n    , cc.COST_CENTER_CODE \n    , tx.REV_CODE_ID \n    , tx.PRICE \n    , tx.ITEM_SALE_ID\n    , sum(tx.quantity)\n    , sum(tx.amount)\n\n    from\n    transactions tx\n    inner join inventory inv on inv.item_id = tx.item_id\n    left outer join cost_center cc on cc.cost_center_id = tx.cost_center_id\n\n    where \n    DATEPART(mm, tx.tx_date) = DATEPART(mm,dateadd(m,-1,getdate()))\nand DATEPART(yyyy, tx.tx_date) = DATEPART(yyyy,dateadd(m,-1,getdate()))\n\n    group by \n      inv.ITEM_CODE \n    , inventory.ITEM_NAME \n    , cc.COST_CENTER_CODE \n    , tx.REV_CODE_ID \n    , tx.PRICE \n    , tx.ITEM_SALE_ID\n</code></pre>\n\n<p>I need to add the fiscal year-to-date quantity and and amount columns to this report.  Would a correlated subquery by the way to go?  Would the joins be tricky?  I've never used a subquery with an aggregation/grouping query.  </p>\n\n<p>Thanks for all the previous help.  </p>\n"},{"tags":["sql-server","query","sql-update","division","multiple-columns"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13137975,"title":"Divide by from selected columns","body":"<p>Sorry if the question was asked before i try search but not found. I'm still new on mssql so\nmaybe the answer are obvious just i cant find.</p>\n\n<p>My current query is:</p>\n\n<pre><code>SELECT gold_min, gold_max, gold_min_2, gold_max_2\nFROM m_rdb\n</code></pre>\n\n<p>I want to divide the values on current columns by 20 and then update, just not sure how to do.\nAny help are welcome. </p>\n"},{"tags":["sql","sql-server","datetime"],"answer_count":5,"favorite_count":7,"up_vote_count":20,"down_vote_count":0,"view_count":48484,"score":20,"question_id":1110998,"title":"Get Day of Week in SQL 2005/2008","body":"<p>Say I have a date 01/01/2009, I want to find out what day it was e.g. Monday, Tuesday, etc...</p>\n\n<p>Is there a built in function for this in Sql2005/2008? Or do I need to use an auxiliary table?</p>\n"},{"tags":["sql-server","sql-server-2005","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":521,"score":2,"question_id":3843256,"title":"Where does a Server trigger save in SQL Server?","body":"<p>A couple of days ago , I was practicing and I wrote some triggers like these :</p>\n\n<pre><code>create trigger trg_preventionDrop\non all server \nfor drop_database\nas\nprint 'Can not Drop Database'\nrollback tran\n\ngo \n\ncreate trigger trg_preventDeleteTable\non database\nfor drop_table\nas \nprint 'you can not delete any table'\nrollback tran\n</code></pre>\n\n<p>But the problem is I don't know where it has saved and How can I delete or edit those.</p>\n\n<p>Thank you </p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13137397,"title":"sql server select query","body":"<p>When I run a <code>SELECT</code> query in SQL Server Management Studio that has a <code>WHERE</code> clause and the database is located on the network, is the query 'run' on the Server or my Desktop PC, eg. will the entire table be brought back from the server and then filtered on my PC or will the filtering be done on the Server?</p>\n\n<p>Does this behaviour differ if I'm using MS Access to run the query against the (remote) database?</p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":115,"score":1,"question_id":13136204,"title":"Generate sequence number in SQL on every insert","body":"<p>I need to enter primary key in table as in below format </p>\n\n<pre><code>YYYY/MMM/NNNNNN\n</code></pre>\n\n<p>Where, <code>YYYY</code> is the current year, <code>MMM</code> is Month , and <code>NNNNNN</code> is a sequence no from <code>000001, 000002, 000003, .... 999999</code>.</p>\n\n<p>So my primary key will look like <code>2012/Oct/000001</code> or <code>2012/Oct/000010</code> ....</p>\n\n<p>How can I generate this type of code..</p>\n\n<p>I can get Year and Month from <code>Getdate()</code> function. But how can I manage sequence number on every insert. can you please give me logic for that?</p>\n"},{"tags":["sql-server","text","asp-classic","procedure","nvarchar"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13136395,"title":"What is the biggest data type to use as a local variable in a stored procedure?","body":"<p>I have the next issue:</p>\n\n<pre><code>--DECLARE @TEST NVARCHAR(MAX)\n--DECLARE @TEST2 NVARCHAR(MAX)\n\nDECLARE @TEST NTEXT\nDECLARE @TEST2 NTEXT\n</code></pre>\n\n<p>NVARCHAR(MAX) is to small for the amount of text in need to put when executing a stored procedure, also, TEXT, NTEXT and IMAGE data types are invalid for local variables, what can I do to sidestep this issue and store the oversized text like.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["php","sql-server","performance","apache","debugging"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":13135087,"title":"Apache Server and SQL Server 2008 Express Performance. Isolate, method or suggestions","body":"<p>I was wondering if some tips or guidance can be provided for the following issue. </p>\n\n<p>Environment type: Small office, approx 20 users.\nNetwork: All server, workstation belong to a single subnet\nInfrastructure: Virtualised webserver and virtualised database server.</p>\n\n<p>Currently I have a web server (Win7SP1 x64) running Apache 2.2.22 (Win32) and PHP 5.3.10. I have built some pages that connects to our database (SQL2k8 Express) and calls procedures, the procedures are basically just basic select statements with joins and conditions. Once the result set are returned, PHP loop through the result set, row by row and display the rows as it flow through. </p>\n\n<p>What happens is that from time to time, the result page can take a extremely long to load,where no results set are displayed but the web browser loading bar/icon flashes. Some times it will just give a blank screen at the end of the load, which typically means the query connection has timed-out or some times it will return the result set. For example, under normal behaviour, a page will take approx 1-3s to load, while at odd times, it may take up to 20-30s.</p>\n\n<p>I have noticed that if I run queries in SQLSVR Mgmt Studio, queries that may take ~5s to return a result set may take approx ~15s to load on my web server. </p>\n\n<p>I know poor PHP coding can cause slow downs but the odd performance behaviour has me bit baffled, as Im sure my coding isnt that bad.</p>\n\n<p>So if people could offer some tips in how I can go about diagnosting or isolating the problem, or advise areas that I could look at, it will be great. I know there are Apache logs, SQL SVR logs and performance indicators, but Im still fairly new to this area and am really lost in the approach /methodology I should take. </p>\n\n<p>Example, any specific mods I should enable in Apache etc. or the type of Apache server I should use, connection sockets in web server etc?</p>\n\n<p>Example of my PHP query/procedure calls</p>\n\n<pre><code>$queryStatement = \"exec myProc @para1='asd'\";\n$prepare = $dbConnect-&gt;prepare($queryStatement);\n$result = $prepare-&gt;execute();\nWHILE($result = $prepare-&gt;fetch(PDO::FETCH_ASSOC)){\nset_time_limit(180);\necho $result\n}\n</code></pre>\n\n<p>Cheers everyone :)</p>\n"},{"tags":["sql-server","security","bcp","xp-cmdshell","sql-server-administration"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13127013,"title":"What is the most secure way to allow users to execute BCP export command from SQL?","body":"<p>I am currently working in an environment where the ability to <strong>export</strong> a table <strong>programatically</strong> from within a hand-run SQL script would be of great help.  </p>\n\n<p>Performing the exports from script will be the first step towards running the entire process from within a stored procedure, therefore I have to be able to initiate the export from SQL.</p>\n\n<p>The organisation currently has the following configuration on most servers - </p>\n\n<ul>\n<li>SQL Server 2005 or 2008</li>\n<li>xp_cmdshell - <strong>disabled</strong></li>\n<li>CLR - <strong>enabled</strong></li>\n</ul>\n\n<p>Ultimately, I would like to be able to call a procedure passing the following parameters and have it perform the export.</p>\n\n<ul>\n<li>table name</li>\n<li>file path/name (on a network share)</li>\n<li>file format </li>\n</ul>\n\n<p>Currently BCP seems like a perfect option in terms of functionality but I am unable to invoke it via the command line due to xp_cmdshell being disabled.</p>\n\n<p>The organisation is quite small and happy work towards a secure solution and my impression so far is that they have a good level of control over their security.  They have made a blanket decision to disable xp_cmdshell but if I could present a safe way to allow use of it I think they would be pretty receptive. </p>\n\n<p>In my research I've come across both the <strong>'EXECUTE AS'</strong> functionality as well as signing procedures with <strong>certificates</strong>, but still cant work out if either approach can help me achieve what I want.</p>\n\n<p>Also, if you have another solution that allows me to achieve the same end-result I'm all ears!</p>\n"},{"tags":["sql","sql-server"],"answer_count":7,"favorite_count":2,"up_vote_count":11,"down_vote_count":0,"view_count":38526,"score":11,"question_id":177323,"title":"how to read the last row with SQL Server","body":"<p>What is the most efficient way to read the last row with SQL? The table is indexed on a unique key--the \"bottom\" key values represent the last row. </p>\n\n<p>Edit: This is for SQL Server.</p>\n\n<p>Thank you</p>\n\n<p>rp</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13134649,"title":"How can i join sys.columns of view to sys.columns of the table it is referencing in T-SQL?","body":"<p>I am trying to join records in <strong>sys.columns</strong> for a view, to the records in <strong>sys.columns</strong> for the table it is referencing, because i need the values of <strong>is_nullable</strong>, <strong>is_computed</strong> and <strong>default_object_id</strong> columns for the columns that are selected in the view.</p>\n\n<p>The <strong>sys.columns</strong> records for the view have \"incorrect\" values, which you can observe by running the example queries below:</p>\n\n<pre><code>CREATE TABLE TestTable (\n    FieldA int NOT NULL,\n    FieldB int DEFAULT (1),\n    FieldC as CONVERT(INT, FieldA + FieldB),\n    FieldD int NOT NULL\n)\nGO\n\nCREATE VIEW TestView WITH SCHEMABINDING AS\nSELECT  FieldA, FieldC as TestC, FieldB + FieldC as TestD\nFROM dbo.TestTable WHERE FieldD = 1\nGO\n\nSELECT  OBJECT_NAME(c.object_id) as ViewName, c.name as ColumnName,\n        c.is_nullable as Nullable, c.is_computed as Computed,\n   cast(CASE WHEN c.default_object_id &gt; 0 THEN 1 ELSE 0 END as bit) as HasDefault\nFROM sys.columns c\nWHERE object_id = OBJECT_ID('TestTable')\nGO\n\nSELECT  OBJECT_NAME(c.object_id) as ViewName, c.name as ColumnName,\n        c.is_nullable as Nullable, c.is_computed as Computed,\n   cast(CASE WHEN c.default_object_id &gt; 0 THEN 1 ELSE 0 END as bit) as HasDefault\nFROM sys.columns c\nWHERE object_id = OBJECT_ID('TestView')\nGO\n</code></pre>\n\n<p>I have tried using system views to join on dependencies, but they do not give us information about which column in the view refers to which column in the table:</p>\n\n<pre><code>-- dm_sql_referenced_entities gives us all columns referenced, but all records\n-- have referencing_minor_id 0, so we do not know which column refers to what\nSELECT * FROM sys.dm_sql_referenced_entities('dbo.TestView', 'OBJECT')\nGO\n\n-- sql_dependencies gives us all columns referenced, but all records has\n-- column_id 0 so we can not use this either of joining the columns\nSELECT * FROM sys.sql_dependencies WHERE object_id = OBJECT_ID('TestView')\nGO\n\n-- sql_expression_dependencies just tells us what table we are referencing \n-- if view is not created WITH SCHEMABINDING. If it is, it will return columns,\n-- but with referencing_minor_id 0 for all records, so not able use this either\nSELECT * FROM sys.sql_expression_dependencies\n    WHERE referencing_id = OBJECT_ID('TestView')\nGO\n</code></pre>\n\n<p>This unanswered post on social.msdn submitted by someone seems to be the same issue:\n<a href=\"http://social.msdn.microsoft.com/Forums/en-US/transactsql/thread/4ae5869f-bf64-4eef-a952-9ac40c932cd4\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/transactsql/thread/4ae5869f-bf64-4eef-a952-9ac40c932cd4</a></p>\n"},{"tags":["c#",".net","sql-server","synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13135714,"title":"Sync SQL Server Database using .net","body":"<p>I have a Central (Server) Database and there are multiple client Databases.</p>\n\n<p>I want to synchronize them with the Server Database. Also the clients can use the database offline.</p>\n\n<p>What will be the project approach or what architecture in .NET I should follow?</p>\n\n<p>Can Microsoft Sync framework be helpful?</p>\n\n<p>It should not affect the performance.</p>\n"},{"tags":["sql-server","excel","excel-vba","adodb"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":97,"score":1,"question_id":13129090,"title":"Excel Automation Error Importing DB into Worksheets","body":"<p>I have a workbook with 192 worksheets that correspond to the 192 tables in our mssql database. If I set up a given table in Data Connections Wizard, all of the data is properly dumped into the worksheet. However, when I run my code below, I get:</p>\n\n<p>Run-Time Error '214767259 (80004005)' Automation Error Unspecified Error</p>\n\n<p>About half of the tables populate just fine. I've noticed that I get the error once it reaches a field that has a large amount of data (rtf text). The fields that have that text aren't important to me, so if excel could leave those blank and continue on I would be happy. That large field is in a different column (sometimes multiple columns) depending on each table, so it'd be time consuming to have to go through all 192 tables to weed out an individual column to not import. </p>\n\n<p>Why am I getting this error when I run it in vba, but the data connection wizard has no problems?</p>\n\n<pre><code>Sub GetData()\n\nDim cnDump As ADODB.Connection\nSet cnDump = New ADODB.Connection\n\n' Provide the connection string.\nDim strConn As String\n\n'Use the SQL Server OLE DB Provider.\nstrConn = \"Provider=SQLOLEDB.1;Integrated Security=SSPI;Persist Security Info=True;Initial Catalog=XXXX;Data Source=XXXX\\XXXX;Use Procedure for Prepare=1;Auto Translate=True;Packet Size=4096;Workstation ID=XXXX;Use Encryption for Data=False;Tag with column collation when possible=False;\"\n\n'Now open the connection.\ncnDump.Open strConn\n\n\n' GET DATA\nDim ws As Worksheet\nDim tbl_name As String\n\nDim rsDump As ADODB.Recordset\nSet rsDump = New ADODB.Recordset\n\nFor Each ws In Worksheets\n\ntbl_name = ws.Name\nws.Rows.ClearContents\n\nWith rsDump\n\n    .ActiveConnection = cnDump\n    .Open \"SELECT * FROM \" &amp; tbl_name\n\n    For i = 1 To .Fields.Count\n     ws.Cells(1, i) = .Fields(i - 1).Name\n    Next i\n\n\n    ws.Range(\"A2\").CopyFromRecordset rsDump\n\nEnd With\n\n\nws.Rows(1).Font.Bold = True\n\n\nNext ws\n\ncnDump.Close\nSet rsDump = Nothing\nSet cnDump = Nothing\n\n\n\nEnd Sub\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":54,"score":-3,"question_id":13135107,"title":"SUM function in SQL","body":"<p>There are three tables,we have to select data from these table using one primary key and foreign key. But in the one table there is lot of data in the third table. We have to sum the data on the base of the primary key.</p>\n\n<p><img src=\"http://i.stack.imgur.com/SW9TB.png\" alt=\"Table1\">  <img src=\"http://i.stack.imgur.com/PqGVS.png\" alt=\"Table2\"> <img src=\"http://i.stack.imgur.com/m7V5a.png\" alt=\"table3\"></p>\n\n<pre><code>BAl = Balance, met = Method, amo = amount, cst_id, cut_id, cut_i = customer_id\n</code></pre>\n\n<p>Now we have to sum the on the basis of method and sum for 10 cust id in the same query. Can anyone help me on this?</p>\n"},{"tags":["sql-server","logging","elmah","nlog"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13134815,"title":"Separate database to store logs and exceptions","body":"<p>In an enterprise project I need to log high amount of data (original values of modified data and new values, user who modified data, etc)\nWe're using NLog to log such data and ELMAH to log exceptions.\nI'm not sure to use separate database for logging or use the main database which all data are stored.\nAdvantages of using separate database are:</p>\n\n<ul>\n<li>Logs and exceptions are not part of business, so they don't need to\nbe in main database. </li>\n<li>Load on main database will be reduced and performance will be better.</li>\n</ul>\n\n<p>Disadvantages are:</p>\n\n<ul>\n<li>If the log database stops, we will miss logs which are very important\nin this project. (although we can prevent saving if logging was not\nsuccessful)</li>\n<li>Handling transactions will be hard. (What if log saved, but the data\nare not)</li>\n</ul>\n\n<p>There are more advantages and disadvantages of course, but all in all, I need to know in enterprise projects which method is recommended? \nOr maybe it is varies from project to project based on some factors?</p>\n"},{"tags":["sql","sql-server","full-text-search"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13130551,"title":"Optimizing function that returns phrases present in given text","body":"<p>I need to implement a function that takes a text (some longer document) as a parameter and returns list of phrases that are present in it. Phrases are stored in a table <code>Phrases (id int primary key, phrase text)</code> and there can be as many as 10 millions of them.</p>\n\n<p>My question is: How can I take the advantages of SQL Server's full-text indexes to keep execution time at fairly low level. Searching for documents containing given phrases is obvious but what about this inverted situation?</p>\n"},{"tags":["c#","sql-server","search","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":68,"score":2,"question_id":13128493,"title":"SQL database search -> calling multiple stored procedures / functions","body":"<p><strong>Background</strong></p>\n\n<p>I am currently re-writing a search engine...which I originally wrote a couple years ago in a hurry :)</p>\n\n<p>Today, the search encompasses ~5 different internal business objects/tables: Users, Organizations, News Headlines, etc. So when the user types in <code>\"The Quick Brown Fox\"</code> into the search box, he/she will get results of each type of business object.</p>\n\n<p>Each business object has an associated stored procedure: <code>spSearchUsers</code>, <code>spSearchOrganizations</code>, etc.</p>\n\n<p><strong>The problem</strong></p>\n\n<p>Now, for each search, I am calling each stored procedure (via a BL -> Data Access Layer) multiple times for each business object type. For example, when the user searches for <code>\"The Quick Brown Fox\"</code>, I send down the entire string unaltered, but also split the string on each single space, and search each word individually.</p>\n\n<p>In this case, each stored procedure is called 5 times...a total of 25 separate database calls for a single search. I don't feel like this typical...but it still runs pretty quick. It takes roughly 4-5 seconds per search.</p>\n\n<p><strong>What I'd like to create</strong></p>\n\n<p>A single \"master\" stored procedure that takes the entire search string <code>\"The Quick Brown Fox\"</code> that in turn calls each individual business object stored procedure (<code>spSearchUsers</code>, <code>spSearchOrganizations</code>, etc), performs a little bit of logic, and returns 1 result set.</p>\n\n<p>So 1 search... 1 result.</p>\n\n<p>Can this be achieved using stored procedures, functions, and/or user-defined table types? </p>\n"},{"tags":["sql-server","ssas","security-roles"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13124481,"title":"(Null) Values in SSAS cube when selecting a role","body":"<p>I have the following problem:</p>\n\n<p>When I process a cube in SSAS and view the data as a normal user without restrictions all is well and the aggregated results show their normal values.</p>\n\n<p>When I choose inside Data Tools (MsSQL 2012) to view the data as a specific role then all the security constraints work normally (For example I view only the Specific country data and no other) but all the corresponding values are (null). </p>\n\n<p>I have tried Visual Totals = true and I have imposed those restrictions on both the dimension and the cube. The CALCULATE in calculation script is still there (everything works ok when I choose to use a normal user). </p>\n\n<p>This is happening on both the measures and the calculated values!!!</p>\n\n<p>Any ideas what could be happening?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":13132222,"title":"Why does Sql Sum of multiple columns containing nulls return incorrect result?","body":"<p>Table containing the following values:</p>\n\n<pre><code>Column1  Column2\n1        NULL\nNULL     4\n2        NULL\nNULL     5\n3        6\n</code></pre>\n\n<p>The following query:</p>\n\n<pre><code>SELECT \n    SUM([Column1] + [Column2] ) \nFROM [myTable]\n</code></pre>\n\n<p>returns a value of <code>9</code> when it should be returning <code>21</code>. Why? How does it arrive at the value?</p>\n\n<p>I know the SUM can be corrected by adding <code>ISNULL</code> like so:</p>\n\n<pre><code>SELECT \n    SUM(ISNULL([Column1], 0) + ISNULL([Column2], 0)) \nFROM [myTable]\n</code></pre>\n\n<p>but I would like to know the logic behind the value <code>9</code></p>\n"},{"tags":["asp.net","sql","sql-server","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13134602,"title":"Creating connection string of database created on different PC","body":"<p>I am trying to use the database send by my friend. He has created it using <em>Sql Server Management Studio</em>. While including the <em><code>.mdf</code></em> file, I am getting an  error message (I have mentioned the error at the end of the answer).\nI think it is because of the difference in the connection strings. I am new to .NET so I just changed the name in the connection string,</p>\n\n<p><strong>From,</strong></p>\n\n<pre><code> &lt;add name=\"ApplicationServices\" connectionString=\"Data Source=sheroz;Initial Catalog=FLEXIFORMDB;integrated security=SSPI\"/&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p><strong>To,</strong></p>\n\n<pre><code> &lt;add name=\"ApplicationServices\" connectionString=\"Data Source=Fahad-PC\\Fahad;Initial Catalog=FLEXIFORMDB;integrated security=SSPI\"/&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>Please help me out to make it work. Thanks in advance.</p>\n\n<h2>Error</h2>\n\n<pre><code>An exception occurred while executing a Transact-SQL statement or batch. (Microsoft.SqlServer.ConnectionInfo)\n\n------------------------------\nProgram Location:\n\n   at Microsoft.SqlServer.Management.Common.ServerConnection.ExecuteNonQuery(String sqlCommand, ExecutionTypes executionType)\n   at Microsoft.SqlServer.Management.Common.ServerConnection.ExecuteNonQuery(StringCollection sqlCommands, ExecutionTypes executionType)\n   at Microsoft.SqlServer.Management.Smo.ExecutionManager.ExecuteNonQuery(StringCollection queries)\n   at Microsoft.SqlServer.Management.Smo.Server.AttachDatabaseWorker(String name, StringCollection files, String owner, AttachOptions attachOptions)\n   at Microsoft.SqlServer.Management.Smo.Server.AttachDatabase(String name, StringCollection files)\n\n===================================\n\nUnable to open the physical file \"D:\\FlexiFormWF\\FlexiFormWF\\FlexiFormDB.mdf\". Operating system error 5: \"5(Access is denied.)\". (.Net SqlClient Data Provider)\n\n------------------------------\nFor help, click: http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=10.00.1600&amp;EvtSrc=MSSQLServer&amp;EvtID=5120&amp;LinkId=20476\n\n------------------------------\nServer Name: FAHAD-PC\\MSSQL\nError Number: 5120\n</code></pre>\n"},{"tags":["sql","sql-server","notin"],"answer_count":8,"favorite_count":6,"up_vote_count":19,"down_vote_count":0,"view_count":22499,"score":19,"question_id":173041,"title":"NOT IN vs NOT EXISTS","body":"<p>Which of these queries is the faster?</p>\n\n<p>NOT EXISTS:</p>\n\n<pre><code>SELECT ProductID, ProductName \nFROM Northwind..Products p\nWHERE NOT EXISTS (SELECT 1 FROM Northwind..[Order Details] od WHERE p.ProductId = od.ProductId)\n</code></pre>\n\n<p>Or NOT IN:</p>\n\n<pre><code>SELECT ProductID, ProductName \nFROM Northwind..Products p\nWHERE p.ProductID NOT IN (SELECT ProductID FROM Northwind..[Order Details])\n</code></pre>\n\n<p>The query execution plan says they both do the same thing.  If that is the case, which is the recommended form?</p>\n\n<p>This is based on the NorthWind database.</p>\n\n<p>[Edit]</p>\n\n<p>Just found this helpful article: \n<a href=\"http://weblogs.sqlteam.com/mladenp/archive/2007/05/18/60210.aspx\">http://weblogs.sqlteam.com/mladenp/archive/2007/05/18/60210.aspx</a></p>\n\n<p>I think I'll stick with NOT EXISTS.</p>\n"},{"tags":["sql","sql-server","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13132616,"title":"Retrieving unique names and based on that fetching the dates","body":"<p>I have two stored procedures like below:</p>\n\n<pre><code>Select distinct TempName from History_Table \n\nSelect TempName,RunDate from History_Table  where TempName=@tempname\n</code></pre>\n\n<p>How do I use a single stored procedure to get a result set of distinct <code>tempname</code>'s and their associated <code>RunDate</code>?</p>\n\n<pre><code>  TempName     RunDate                       RunBy\n\n1   test    2012-10-11 00:00:00.000 chandu\n2   testing 2012-12-15 00:00:00.000 kumar\n3   asdsad  2012-08-09 00:00:00.000 asdsad\n4   test    2012-12-12 00:00:00.000 asdasds\n15  test    2012-10-01 00:00:00.000 asdaddf\n15  test    2012-09-12 00:00:00.000 bghgh\n\nI have to display like\n\nTempName   RunDate                   RunBy\ntest       dates(in a dropdown)      lastrun name(i.e asdasds)\n</code></pre>\n"},{"tags":["c#","asp.net","sql","sql-server","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13133614,"title":"Fetching data using last Datetime","body":"<p>I have to show these details in a gridview as Tempname as unique and associated datetime in drodown and the last run by name in a label. Unable to upload the Table picture as i dont have enough reputation.</p>\n\n<pre>\n    private void GridLoading()\n    {\n        DataSet ds = new DataSet();\n        ds = Common.LoadingGrid();\n        GridView1.DataSource = ds;\n        GridView1.DataBind();\n    }\n\n    protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)\n    {\n        if (e.Row.RowType == DataControlRowType.DataRow)\n        {\n            DataSet ds = new DataSet();\n            Label lblName = e.Row.FindControl(\"Label1\") as Label;\n            ds = Common.RunByDate(lblName.Text);\n            DropDownList ddl = e.Row.FindControl(\"DropDownList1\") as DropDownList;\n\n            ddl.DataTextField = \"RunDate\";\n            ddl.DataValueField = \"RunDate\";\n            ddl.DataSource = ds;\n            ddl.DataBind();\n            var items = ddl.Items;\n          }           \n    }\n</pre>\n\n<p>But i am unable to get the Runby name in the label.How can i display it?Below are my stored procedures</p>\n\n<pre>\n    Select distinct TempName from SV_JobHistoryTable \n\n    SELECT TempName,RunDate\n    FROM SV_JobHistoryTable  where TempName=@tempname \n</pre>\n"},{"tags":["sql","sql-server","tsql","dynamic-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13132253,"title":"OpenQuery in SQL Server","body":"<p>I don't know how to config the <code>OpenQuery</code> function.</p>\n\n<p>I want to use <code>OpenQuery</code> to query database in test project. But I don't know how config the servername param </p>\n\n<pre><code>DECLARE @Sql varchar(max)\nDECLARE @SQLExcuteSentence varchar(max)\n\nSET @Sql = 'declare @UserID INT \nselect @UserID = 1\n\ndeclare @TotalGroupByFields nvarchar(2000)\nselect @TotalGroupByFields = ''Media''\n\ndeclare @CostDataFileds nvarchar(2000)\nselect @CostDataFileds = ''''\n\ndeclare @OtherDataFields nvarchar(max)\nselect @OtherDataFields = ''MonitoringSpotNumber,MonitoringTotalSeconds,BaseCost,ColourLoading,PositionLoading,WeekendLoading,Discount''\n\ndeclare @MasterFilterId nvarchar(max)\nselect @MasterFilterId =''DateRange=20060601-20121231''+char(13)+''IncludeGuests=0''\n\ndeclare @RatingTargetId nvarchar(2000)\nselect @RatingTargetId =''''\n\ndeclare @IsEnableFinancialCloseDate INT\nselect @IsEnableFinancialCloseDate = 0\n\ndeclare @MasterDisplayFormat nvarchar(2000)\nselect @MasterDisplayFormat = ''5''\n\nexec [dbo].[USP_MatrixReport] @UserID, @TotalGroupByFields, @CostDataFileds, @OtherDataFields,  @MasterFilterId, @RatingTargetId, @IsEnableFinancialCloseDate, @MasterDisplayFormat, 0'\n\nSET @SQLExcuteSentence = 'SELECT * FROM OPENQUERY(SQLConn,' + '''' + @Sql + '''' + ')'\nEXEC (@SQLExcuteSentence);\n</code></pre>\n\n<p>the SQLConn is what?? </p>\n"},{"tags":["sql-server","copy","bulkinsert","bulk","bcp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13133669,"title":"sql bulk insert using bcp between servers through script without using linked server","body":"<p>sql bulk insert using bcp between servers through script without using linked server </p>\n\n<p>Im trying to use below queries</p>\n\n<p>bcp AdventureWorks.dbo.BuildVersion out Currency.dat -U sa -P 123456 -c -[cespl-pc130]</p>\n\n<p>bcp AdventureWorks.dbo.BuildVersion in Currency.dat -U sa -P 123456 -c -[cespl-pc83]</p>\n\n<p>I am getting the below error</p>\n\n<p>Msg 102, Level 15, State 1, Line 1\nIncorrect syntax near '.'.</p>\n\n<p>Is it the right way to do.</p>\n\n<p>explain the possibilities to do the bulk data transfer between servers.</p>\n\n<p>thanks in advance</p>\n"},{"tags":["c#","asp.net","sql","sql-server","datetime"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":39,"score":-1,"question_id":13133816,"title":"Removing time which is automatically appended in database","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13119847/formatting-date-in-date-which-is-being-read-from-excel\">Formatting date in date which is being read from excel?</a>  </p>\n</blockquote>\n\n\n\n<p>I am importing excel sheet into sql server database the excel sheet has two columns:\nid|data(which is date in mm/dd/yyyy)\ni want this to get converted to yyyy/mm/dd before sending it to the database:</p>\n\n<pre><code>     DataTable dt7 = new DataTable();\n            dt7.Load(dr);\n            DataRow[] ExcelRows = new DataRow[dt7.Rows.Count];\n            // Bulk Copy to SQL Server\n            using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n            {\n                bulkCopy.DestinationTableName = \"ExcelTable\";\n                dt7.Rows.CopyTo(ExcelRows, 0);\n\n                for (int i = 0; i &lt; ExcelRows.Length; i++)\n                {\n                    if (ExcelRows[i][\"data\"] == DBNull.Value)\n                    {\n                        // Include any actions to perform if there is no date\n                    }\n                    else\n                    {\n                        DateTime oldDate = Convert.ToDateTime(ExcelRows[i][\"data\"]).Date;\n                        DateTime newDate = Convert.ToDateTime(oldDate).Date;\n                        ExcelRows[i][\"data\"] = newDate.ToString(\"yyyy/MM/dd\");\n                    }\n\n\n\n                }\n                bulkCopy.WriteToServer(ExcelRows);\n</code></pre>\n\n<p>There is no error as such but :\nExcel Sheet Value:  6/25/1999\nDatabase value:    6/25/1999 12:00:00 AM</p>\n\n<p>there are three things that need to be taken care of:\n1) the first row is always NULL in db for some unknown reason.\n2) the format is not changing from mm/dd/yyyy to yyyy/mm/dd\n3) the Time which is appended automatically needs to be taken care of.</p>\n"},{"tags":["c#","asp.net","sql","sql-server","date"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":112,"score":0,"question_id":13133159,"title":"Converting date from mm/dd/yyyy which is read from excel to yyyy/mm/dd before sending it to database","body":"<p>I am importing an Excel sheet into a SQL Server database. I am able to upload the data but there is a column in Excel which consists of dates in format <code>mm/dd/yyyy</code>. I want this to be converted to <code>yyyy/mm/dd</code> before sending it to database :</p>\n\n<pre><code>DataTable dt7 = new DataTable();\ndt7.Load(dr);\nDataRow[] ExcelRows = new DataRow[dt7.Rows.Count];\n\n// Bulk Copy to SQL Server\nusing (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n{\n  bulkCopy.DestinationTableName = \"ExcelTable\";\n  dt7.Rows.CopyTo(ExcelRows, 0);\n\n  for (int i = 0; i &lt; ExcelRows.Length; i++)\n  {\n    DateTime oldDate =Convert.ToDateTime(ExcelRows[i][\"data\"]).Date;\n    DateTime newDate = Convert.ToDateTime(oldDate).Date;\n    ExcelRows[i][\"data\"] = newDate.ToString(\"yyyy/MM/dd\");\n  }\n  bulkCopy.WriteToServer(ExcelRows);\n</code></pre>\n\n<blockquote>\n  <p>Error at: DateTime oldDate = Convert.ToDateTime(ExcelRows[i][\"data\"]).Date;<br>\n  Error: Object cannot be cast from DBNull to other types.</p>\n</blockquote>\n\n<p>It seems to me that it is reading wrong column or something since it says <code>cannot be cast from DBnull</code>. The Excel sheet has two columns:</p>\n\n<pre><code>id | data (which is date)\n</code></pre>\n\n<p>I have tried replacing <code>ExcelRows[i][\"data\"]</code> with <code>ExcelRows[i][1]</code> but I got the same error.</p>\n"},{"tags":["sql-server","oracle","sql-server-2008","sql-server-2005","oracle11g"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13133378,"title":"Data Migration From Oracle To SQL Server","body":"<p>I have Oracle database in that in one or more table I have blob data also, i.e. images are stored, now I would like to move that data to sql server database, what is the best way to do this ?</p>\n\n<p>I would like to test for one table migration which contains image data in the Oracle database and move into SQL Server table.</p>\n\n<p>How do I test for migrating data from one table from Oracle to SQL Server ?</p>\n\n<p>but first thing I would like to confirm is that whether Image data moving from Oracle DB to SQL Server DB is possible, is there anything has to be taken care while migrating ?</p>\n\n<p>Thanks in advance.</p>\n\n<p>With Best Regards</p>\n"},{"tags":["sql","sql-server","tsql","date"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2360,"score":1,"question_id":5611570,"title":"how i can retrieve rows by specific date in sql server?","body":"<p>I'm working in project for by PHP and SQL Server.</p>\n\n<p>The owner want from me  design page show only users who register in same day</p>\n\n<p>i.e., if today 11-3-2011 i want show only all users who register in 11-3-2011</p>\n\n<p>The table is:</p>\n\n<pre><code>id  username  date\n\n1   john      11\\3\\2011\n2   sara      11\\3\\2011\n3   john      5\\1\\2011\n4   kreem     1\\2\\2011\n</code></pre>\n\n<p>i make it by mysql </p>\n\n<pre><code>where DATE_ADD( items.created_date, INTERVAL 1 DAY ) &gt; NOW() \n</code></pre>\n\n<p>this cable of code show data which only insert in same day thats mean if today 10-4-2011 it will show only data which insert in 10-4-2011 if i today 15-4-2011 and im dose not insert any thing it will not show any thing, how i can build code like this in sql server? hope to be my question clear and understand </p>\n"},{"tags":["sql-server","performance","ado.net","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":13132903,"title":"SQL Server performance - schema vs multiple databases","body":"<p>This is purely from performance standpoint and only for SQL Server. I am using SQL Server 2012. I am migrating from a different database server (Ctree). The databases are from less than 100mbs to about 2-3GBs, five in total. There are a lot of tables - over 400 tables in all. </p>\n\n<p>Would it be better in terms of performance only to use a single database and multiple schema or multiple databases as is? The existing logic is that there are multiple databases and there are 7 different applications (C# - ADO.NET) that use these. </p>\n"},{"tags":["c#",".net","sql-server","backup","smo"],"answer_count":3,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":8040,"score":6,"question_id":1466651,"title":"How to restore a database from C#","body":"<p>I have a SQL 2008 DB. I am running a form that backs that DB up, then tries to update it. If the update fails the idea is to restore that backup. Here is the code I am using to restore the backup. </p>\n\n<pre><code>public void RestoreDatabase(String databaseName, String backUpFile, String serverName, String userName, String password)\n{\n    Restore sqlRestore = new Restore();\n    BackupDeviceItem deviceItem = new BackupDeviceItem(backUpFile, DeviceType.File);\n    sqlRestore.Devices.Add(deviceItem);\n    sqlRestore.Database = databaseName;\n    ServerConnection connection = new ServerConnection(serverName, userName, password);\n    Server sqlServer = new Server(connection);\n    sqlRestore.Action = RestoreActionType.Database;\n\n    string logFile = System.IO.Path.GetDirectoryName(backUpFile);\n    logFile = System.IO.Path.Combine(logFile, databaseName + \"_Log.ldf\");\n\n    string dataFile = System.IO.Path.GetDirectoryName(backUpFile);\n    dataFile = System.IO.Path.Combine(dataFile, databaseName + \".mdf\");\n\n    Database db = sqlServer.Databases[databaseName];\n    RelocateFile rf = new RelocateFile(databaseName, dataFile);\n    sqlRestore.RelocateFiles.Add(new RelocateFile(databaseName, dataFile));\n    sqlRestore.RelocateFiles.Add(new RelocateFile(databaseName + \"_log\", logFile));\n    sqlRestore.SqlRestore(sqlServer);\n    db = sqlServer.Databases[databaseName];\n    db.SetOnline();\n    sqlServer.Refresh();\n}\n</code></pre>\n\n<p>The issue seems to be that the file names I pick are different from the online DB. I basically want to replace the database on the server with the backup. I get an exception when I call SqlRestore.</p>\n\n<p>The main exception says </p>\n\n<blockquote>\n  <p>{\"Restore failed for Server\n  'localhost'. \"}</p>\n</blockquote>\n\n<p>Digging into the inner exceptions shows these errors </p>\n\n<blockquote>\n  <p>An exception occurred while executing\n  a Transact-SQL statement or batch.</p>\n</blockquote>\n\n<p>and then </p>\n\n<blockquote>\n  <p>Logical file 'DB' is not part of\n  database 'DB'. Use RESTORE\n  FILELISTONLY to list the logical file\n  names.\\r\\nRESTORE DATABASE is\n  terminating abnormally.</p>\n</blockquote>\n\n<p>I assume there is some way to tell this to just use replace the existing DB as is.</p>\n\n<p>I use this bit of code to get the file path of the DB to have a directory to dump the backup. Maybe this could be used to get the file names to recreate.</p>\n\n<pre><code>public string GetDBFilePath(String databaseName, String userName, String password, String serverName)\n{\n    ServerConnection connection = new ServerConnection(serverName, userName, password);\n    Server sqlServer = new Server(connection);\n    Database db = sqlServer.Databases[databaseName];\n    return sqlServer.Databases[databaseName].PrimaryFilePath;\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1871,"score":2,"question_id":4875513,"title":"error in Multiple Select statements in Insert statement","body":"<p>I am writing a query which has multiple select statements in an insert statement</p>\n\n<pre><code>    INSERT INTO dbo.Products \n    (ProductName, \n     SupplierID, \n     CategoryID, \n     UnitsInStock, \n     UnitsOnOrder, \n     ReorderLevel, \n     Discontinued)\nVALUES  \n    ('Twinkies' , \n     (SELECT SupplierID FROM dbo.Suppliers WHERE CompanyName = 'Lyngbysild'),\n     (SELECT CategoryID FROM dbo.Categories WHERE CategoryName = 'Confections'), \n     0, \n     0, \n     10, \n     0)\n</code></pre>\n\n<p>Actually it gives error</p>\n\n<pre><code>Msg 1046, Level 15, State 1, Line 4\nSubqueries are not allowed in this context. Only scalar expressions are allowed.\nMsg 102, Level 15, State 1, Line 4\nIncorrect syntax near ','.\n</code></pre>\n\n<p>Where these two select statements returns only one value.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12539681,"title":"Renaming all constraint names with user defined names","body":"<p>How do I query the database for all types of constraints such as Primary Key,Foreign Key, Unique Key, and Default Constraint, and rename its system generate name to a name in following format:</p>\n\n<ul>\n<li>PK_ColumnName1_ColumnName2</li>\n<li>FK_ColumnName1</li>\n<li>UK_ColumnName1_ColumnName2</li>\n<li>DF_ColumnName1</li>\n</ul>\n"},{"tags":["sql","sql-server","grouping","group-concat"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":30,"score":3,"question_id":13132571,"title":"Group Employee for each Department","body":"<p>I have a table <code>Details</code></p>\n\n<pre><code>DeptId        EmpID\n-------      ---------\n1             1\n1             5\n1             3\n2             8\n2             9\n</code></pre>\n\n<p>I want to group them like this:</p>\n\n<pre><code>DeptId      EmpIDs\n-------    -------\n 1          1,5,3\n 2          8,9\n</code></pre>\n\n<p>I want this in SQL Server. I know this can be done in MySQL using <code>Group_Concat</code> function. e.g. </p>\n\n<pre><code>SELECT DeptId, GROUP_CONCAT(EmpId SEPARATOR ',') EmpIDS\nFROM Details GROUP BY DeptId\n</code></pre>\n\n<p><a href=\"http://sqlfiddle.com/#!2/89baa/1\" rel=\"nofollow\">(SQL Fiddle here)</a></p>\n\n<p>But how to do this with SQL Server? I don't know any function.</p>\n"},{"tags":["sql-server","sql-server-2008","replication"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":125,"score":1,"question_id":5820706,"title":"Adding foreign key constrain fails on subcriber","body":"<p>I have a replicated database using SQL Server 2008. Here is what I am trying to do.</p>\n\n<ol>\n<li>Create a new table  (MyNewTable)</li>\n<li>Create a column in an existing Table (MyExistingTable)</li>\n<li>Create a FK constraint on this column (in #2) as it points to PK to new table from #1.</li>\n</ol>\n\n<p>However when data get replicated to subscriber, i get following error in replication monitor.</p>\n\n<blockquote>\n  <p>The schema script \"script for adding foreign key constraint\" could not be propagated to the subscriber. (Source: MSSQL_REPL, Error number: MSSQL_REPL-2147201001)\n  Get help: <a href=\"http://help/MSSQL_REPL-2147201001\" rel=\"nofollow\">http://help/MSSQL_REPL-2147201001</a>\n  Foreign key \"MyFKConstraint\" references invalid table \"MyNewTable\" (Source: MSSQLServer, Error number: 1767)</p>\n</blockquote>\n\n<p>This script runs fine on publisher though. Some people seem to suggest that adding foreign key constraint cannot be done in a replicated environment when its created between an existing table and a new table. This is kind of hard to buy for me although I am kind of new to SQL Server replication. Any thoughts?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":88,"score":3,"question_id":13048811,"title":"CTE parent-child showing siblings","body":"<p>I have a CTE-query that displays a tree using recursion. This works great when displaying the whole tree. But I want to pass in ID as a variable and include the siblings for each current node.</p>\n\n<p>Testcode:</p>\n\n<pre><code>DECLARE @TT TABLE \n(\nID int,\nName varchar(25),\nParentID int,\nSortIndex int\n)\n\nINSERT @TT \nSELECT 1, 'A', NULL, 1 UNION ALL\nSELECT 2, 'B_1', 3, 1 UNION ALL\nSELECT 3, 'B', 1, 2 UNION ALL\nSELECT 4, 'B_2', 3, 2 UNION ALL\nSELECT 5, 'C', 1, 3 UNION ALL\nSELECT 6, 'C_2', 5, 2  UNION ALL\nSELECT 7, 'A_1', 1, 1 UNION ALL\nSELECT 8, 'A_2', 1, 2 UNION ALL\nSELECT 9, 'C_1', 5, 1 \n\n\n;WITH CTETree\nAS\n(\n    SELECT *, CAST(NULL AS VARCHAR(25)) AS ParentName, 1 AS Lev,\n    CAST(ROW_NUMBER() OVER(ORDER BY SortIndex) AS VARBINARY(MAX)) AS SortPath\n    FROM @TT\n    WHERE ParentID IS NULL\n\n    UNION ALL\n\n    SELECT F.*, CTETree.Name AS ParentName, Lev + 1,\n    SortPath + CAST(ROW_NUMBER() OVER(ORDER BY F.SortIndex) AS BINARY(32))\n    FROM @TT AS F\n    INNER JOIN CTETree\n    ON F.ParentID = CTETree.ID \n)\n\nSELECT * FROM CTETree\n    ORDER BY SortPath\n\n/*\nDESIRED RESULT:\n\nWHEN ID = 3 PASSED IN:\n\n1   A   NULL    1   NULL    1\n3   B   1   2   A   2\n2   B_1 3   1   B   3\n4   B_2 3   2   B   3\n5   C   1   3   A   2\n\nWHEN ID = 1 PASSED IN:\n\n1   A   NULL    1   NULL    1\n3   B   1   2   A   2\n5   C   1   3   A   2\n\nWHEN ID = 9 PASSED IN:\n\n1   A   NULL    1   NULL    1\n3   B   1   2   A   2\n5   C   1   3   A   2\n9   C_1 5   1   C   3\n6   C_2 5   2   C   3\n\n*/\n</code></pre>\n\n<p>SQL-Fiddle: <a href=\"http://sqlfiddle.com/#!3/d41d8/5526\" rel=\"nofollow\">http://sqlfiddle.com/#!3/d41d8/5526</a></p>\n"},{"tags":["sql","sql-server","join"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":45,"score":0,"question_id":13131496,"title":"How to do join on multiple criteria, returning all combinations of both criteria","body":"<p>I am willing to bet that this is a really simple answer as I am a noob to SQL.</p>\n\n<p>table 1 has column 1 (criteria 1) column 2 (criteria 2) column 3 (metric 1)</p>\n\n<p>table 2 has column 1 (criteria 1) column 2 (criteria 2) column 3 (metric 2 specific to table2.criteria2)</p>\n\n<p>There can be anywhere from 1 - 5 values of criteria 2 for each criteria 1 on the table.</p>\n\n<p>when I use the join statement here (assuming I identify table 1 as One prior to this):</p>\n\n<pre><code>Select WeddingTable, TableSeat, TableSeatID, Name, Two.Meal\nFROM table1 as One\ninner join table2 as Two\non One.WeddingTable = Two.WeddingTable and One.TableSeat = Two.TableSeat\n</code></pre>\n\n<p>I only get one of the criteria 1/criteria 2 combinations even when I know for a fact that there are 3 or 4.  How do I get all combinations?</p>\n\n<p>Take the situation where there is a wedding where table 1 is basically a seating chart, and table 2 is the meal option that each table/seat has chosen. Table 1 has the convenient TableSeatID, but Table 2 does not have a comparable ID.</p>\n\n<p><strong>Sample Data:</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/I5IRy.jpg\" alt=\"enter image description here\"></p>\n\n<p>The results needs to show all 4 lines, being all 3 seats at WeddingTable 001 and the one seat at WeddingTable 002.</p>\n\n<p><strong>Desired Results:</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/c1dr2.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":57,"score":3,"question_id":13131045,"title":"\"IN\" keyword sql file path","body":"<p>While moving an app from access to sql server I have come across a keyword that is causing errors.  The keyword within the query is \"IN\".  INSERT INTO Table IN 'file path of sql server database'.  Does sql server allow you to insert data using the file path within the query? I have been researching this for a few days and have come up with nothing. </p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","reporting-services","reportbuilder3.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13117532,"title":"Report Builder 3.0 - Adding textboxes together","body":"<p>I'm currently creating a report in Report Builder 3.0. I have two textboxes containing SUMs. I want to add the values of these two textboxes together in a third textbox. How is this doable?</p>\n\n<p>I need to add that I'm not working in tables or tablix.</p>\n"},{"tags":["sql-server","visual-studio-2008","cube","olap-cube"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13131653,"title":"trying to explore olap cube for ms sql but have a product file for multiple branches that may have the same key across all branches any ideas?","body":"<p>i need to create a cube based on sales for multiple branches but im not sure how to approach the fact that each branch may use the same product code. in vs 2008 it wont process the cube because it sees that this code is duplicated in my master product file which also ha a branch id field to differentiate for standard queries</p>\n\n<p>anyone any idea how to go about setting up a cube in this scenario?</p>\n\n<p>tables (only some for illustration)</p>\n\n<p> transactions (all branches - has branch id and product id)\n products (master file - has branch id and product id)\n users (links to transactions)\n branch table (links to transactions)</p>\n\n<p>basically there are four dimensions to this cube users, products, branch and a time dimenension based on a field in transactions. </p>\n\n<p>The products field is the main issue though. DB design is restricted due to the application</p>\n\n<p>thanks for any help in advance!</p>\n"},{"tags":["sql","sql-server","tsql","stored-procedures","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":13131046,"title":"TSQL Insert the column default value from Case Statement","body":"<p>I'd like to use the column's default value in an stored procedure insert, so that I don't have to repeat the default value in multiple places (it could change... DRY principle).</p>\n\n<p>The T-SQL INSERT operation has a handy 'default' keyword that I can use as follows:</p>\n\n<pre><code>Declare @newA varchar(10)\nSet @newA = 'Foo2'\n\n-- I can use \"default\" like so...\nInsert into Table_1 (\n    A, \n    B) \nValues (\n    @newA, \n    default)\n</code></pre>\n\n<p>However, If I need to do something conditional,  I can't seem to get the case statement to return 'default'.</p>\n\n<pre><code>-- How do I use 'default' in a case statement? \nINSERT INTO Table_1 (\n    A,\n    B )\nVALUES (\n    @newA,\n    CASE WHEN (@newA &lt;&gt; 'Foo2') THEN 'bar' ELSE default END)\n-- &gt; yeilds \"Incorrect syntax near the keyword 'default'.\"\n</code></pre>\n\n<p>I <em>could</em> insert the default, and then update as needed like so:</p>\n\n<pre><code>INSERT INTO Table_1 (\n    A,\n    B )\nVALUES (\n    @newA,\n    default)\nUPDATE Table_1 \nSET B = CASE WHEN (A &lt;&gt; 'Foo2') THEN 'bar' ELSE B END\nWHERE ID = SCOPE_IDENTITY()\n</code></pre>\n\n<p>But I'd really like somebody to tell me \"There's a better way...\"</p>\n\n<p>Here's a table definition for this example if it helps...</p>\n\n<pre><code>CREATE TABLE dbo.Table_1 (\n    ID int NOT NULL IDENTITY (1, 1),\n    A varchar(10) NULL,\n    B varchar(10) NULL  )  \nGO\nALTER TABLE dbo.Table_1 ADD CONSTRAINT DF_Table_1_A DEFAULT 'A-Def' FOR A\nGO\nALTER TABLE dbo.Table_1 ADD CONSTRAINT DF_Table_1_B DEFAULT 'B-Def' FOR B\nGO\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008-r2","linked-server","advantage-database-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13131066,"title":"MS SQL: Is it possible to have a linked server link to another linked server?","body":"<p>Hello to all and thanks ahead of time for taking the time to look at my question!<br>\n<br>\nI'm trying to do a work-around to access a 32bit Advantage Database Server 8.1 database with 64bit MSSQL Server 2008R2.<br>\n<br>\n<strong>Setup:</strong><br>\n-Windows Server SBS2012<br>\n-MS SQL Server 2008R2 64bit<br>\n-MS SQL Server 2012 Express 32bit<br>\n-Sybase Advantage Database Server (ADS) 8.1 32bit (Can't change)<br>\n<br>\nWhat I've done so far is to install a 32bit SQL Express on the same machine.  I have setup a linked server to the Advantage database on that instance and successfully accessed data.  So, I know that much is working fine.</p>\n\n<p>Problem is, when I try to setup a linked server on the 64bit 2008R2 server, it errors out with the following...</p>\n\n<blockquote>\n  <p>OLE DB provider \"SQLNCLI10\" for linked server \"<em>[--MyLinkedServerName--]</em>\" returned message \"Login timeout expired\". <br>\n  OLE DB provider \"SQLNCLI10\" for linked server \"<em>[--MyLinkedServerName--]</em>\"\n  returned message \"A network-related or instance-specific error has\n  occurred while establishing a connection to SQL Server. Server is not\n  found or not accessible. Check if instance name is correct and if SQL\n  Server is configured to allow remote connections. For more information see SQL Server Books Online.\".<br>\n  Msg 65535, Level 16, State 1, Line 0<br>\n  SQL Server Network Interfaces: Error Locating Server/Instance Specified [xFFFFFFFF].<br></p>\n</blockquote>\n\n<p>Like I said, I can access the data using the 32bit SQL Express, so I know that much of it works.  I just can't seem to access it from within the 64bit 2008R2.  I know the login info is correct.</p>\n\n<p>So, Is it not possible to do?</p>\n"},{"tags":["asp.net","sql-server","charts","drilldown"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13051476,"title":"How to change a charts axis labels from month number (int) to month abbreviation?","body":"<p>I am doing a chart drill down using ASP and SQL Server 2012. After clicking on the quarter I will get the drill down to months. The months appear as numbers and I need them as month abbreviations. I think I have to do a conversion since the months are currently integers. </p>\n"},{"tags":["c#","sql-server","asp.net-mvc","caching","bottleneck"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":291,"score":0,"question_id":4986372,"title":"How can I cache private data in a webfarm for ASP MVC","body":"<p>I am making a member based web app in ASP MVC3 and I am trying to plan ahead, at first our user base will not be huge, but as with any software the potential for a sudden volume spike is always a possibility. </p>\n\n<p>Thinking ahead to this scenario, I know that the database is the bottleneck area on most web apps. We are using MSSQL 2008RS we will have dedicated servers with several client databases each client has there own database so if one server begins to bottle neck we can scale vertically or move some of the databases to a new server and begin filling it up.</p>\n\n<p>To access the databases we use primarily LINQ 2 SQL and are currently re-factoring some of our code to make use of the IQueryable mechanisms to do a lazy load of content. but each page contains quite a bit of content from various parts of the database. </p>\n\n<p>We also have a few large databases that are used for widgets in the program that rarely change but have millions of rows. the goal with those is to somehow sync them to the primary source and distribute them across several machines and then load balance those servers. </p>\n\n<p>With this layout should I even worry about caching, or will the built-in caching mechanisms in MSSQL be sufficient? </p>\n\n<p>If so where should I begin. I have looked briefly at app fabric but it looks as tho it is for Azure only?</p>\n\n<p>Resources:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/343899/how-to-cache-data-in-a-mvc-application\">How to cache data in a MVC application</a></p>\n\n<p><a href=\"http://stephenwalther.com/blog/archive/2008/08/28/asp-net-mvc-tip-39-use-the-velocity-distributed-cache.aspx\" rel=\"nofollow\">http://stephenwalther.com/blog/archive/2008/08/28/asp-net-mvc-tip-39-use-the-velocity-distributed-cache.aspx</a></p>\n\n<p><a href=\"http://stephenwalther.com/blog/archive/2008/08/29/asp-net-mvc-tip-40-don-t-cache-pages-that-require-authentication.aspx\" rel=\"nofollow\">http://stephenwalther.com/blog/archive/2008/08/29/asp-net-mvc-tip-40-don-t-cache-pages-that-require-authentication.aspx</a></p>\n"},{"tags":["sql-server","ssms"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13130509,"title":"SQL Server Management Studio (SSMS) 2012: Unusually high memory usage (leaking?)","body":"<p><img src=\"http://i.stack.imgur.com/0FmYC.png\" alt=\"Task Manager\"></p>\n\n<p>1.3GB memory usage. I'm running Windows 7 Ultimate 64-bit.\nI don't do much - just editing a stored proc (no query running in the background, nor any query result).</p>\n\n<p>I do notice though, it only happens occasionally - as if some kind of a garbage collection is kicking in then it'll return to its normal (around 100MB).</p>\n\n<p>Any ideas / workaround / updates ?</p>\n"},{"tags":["mysql","sql-server","regex","vb.net","parsing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13130205,"title":"Replace all varchar column declarations with a size greater than 8000","body":"<p>I have a sql dump file from MySQL that I use to create SQL Server (2005) tables out of.</p>\n\n<p>I need to change the column declarations that are greater than varchar(8000), the max for sql server 2005, to varchar(max).</p>\n\n<p>I am using a Visual Basic script to parse through the dump file and make these changes. It just looks at the whole file as a string. I only want to change if the number is greater than 8000, but I don't know how to do this. Is there a way to check what that number is inside of the declaration and change it? I've made a regular expression to find the number inside the declaration. But I don't know of a way to say:</p>\n\n<p>For all strings that match varchar(int>8000), change to varchar(max).</p>\n"},{"tags":["sql-server","windows-ce","sqlconnection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":475,"score":0,"question_id":9085251,"title":"Trouble connecting to SQL Server from Windows CE 6 device","body":"<p>I am writing code for a Windows CE 6 app that is supposed to open a connection to a SQL Server 2005 Express instance. </p>\n\n<p>When I debug the code on a development computer (Windows 7) to the SQL Server instance, the process is successful.</p>\n\n<p>The CE device can successfully ping the SQL Server instance. Running the application with the same connection string from a Windows CE 6.0 device, I get a error message:</p>\n\n<blockquote>\n  <p>Specified SQL server not found: ServerName\\SQLEXPRESS.</p>\n</blockquote>\n\n<p>How can this be solved?</p>\n\n<p>this is my connection String: <code>ConnectionString = \"Server='Servername\\\\SqlExpress';Database=databasename;Trusted_Connection=true;\";\n</code>\nand I am using SqlClient\nI think I should also mention that the device with windows ce 6.0 is connected wirelessly to the network and the laptop running windows 7 is wired. </p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":889,"score":5,"question_id":5735551,"title":"ORDER/SORT Column mixed number and number prefixed by char","body":"<p>I have a varchar column conteining a code, this code could by only numbers, or number prefixed by a char for example i have a column containing this data : </p>\n\n<pre><code>+------+\n| Code |\n+------+\n|  1   |\n|  C1  |\n|  2   |\n|  3   |\n|  C3  |\n|  F3  |\n|  F1  |\n|  F17 |\n|  C9  |\n|  C10 |\n|  C47 |\n| C100 |\n| C134 |\n| A234 |\n|C1245 |\n|   10 |\n|  100 |\n+------+\n</code></pre>\n\n<p>And so on ...</p>\n\n<p>I want to sort this column by this rules :</p>\n\n<ol>\n<li>Only numeric code</li>\n<li>Prefixed code with the letter part order alfanumerically and numeric part ordered as a number </li>\n</ol>\n\n<p>I want to achieve a resultset ordered like this :</p>\n\n<pre><code>+------+\n| Code |\n+------+\n|  1   |\n|  2   |\n|  3   |\n| 10   |\n| 100  |\n| A234 |\n|  C1  |\n|  C3  |\n|  C9  |\n|  C10 |\n|  C47 |\n| C100 |\n| C134 |\n|C1245 |\n|  F1  |\n|  F3  |\n|  F17 |\n+------+\n</code></pre>\n\n<p>How can i get a resultset ordered with this criteria ? \nI've tried with a query like this : </p>\n\n<pre><code>SELECT Code FROM Code_List ORDER BY case when Code like '%[a-z]%' then 99999999999999999999999999999999 else convert(decimal, Code) end\n</code></pre>\n\n<p>But i get a result that order first the number and then the prefixed number but the alpha prefixed number is ordered like char and not in the manner i want it...</p>\n\n<p>The only numeric record should be ordered following the rules of the numeric order and no the character order so if the only numeric record are : </p>\n\n<pre><code>+------+\n| Code |\n+------+\n|  1   |\n|  47  |\n|  2   |\n|  3   |\n|  6   |\n|  100 |\n|  112 |\n|  10  |\n</code></pre>\n\n<p>I want to get : </p>\n\n<pre><code>+------+\n| Code |\n+------+\n|  1   |\n|  2   |\n|  3   |\n|  6   |\n|  10  |\n|  47  |\n|  100 |\n|  112 |\n</code></pre>\n\n<p>The Database is Microsoft SQL Server.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13102493,"title":"tsql: Delete behavior","body":"<p>I want to delete an order that has a header, subheader and line item details, before writing out the same order with whatever the replacement subheader, line item details might now be. I'm getting a pk violation error when I try to write back the newer version with the changes. After analysis, I see that even though my DELETE statements appear to work, after issuing them (e.g. x rows affected) --the target table remains unchanged. So, that would explain the pk vio issue. What am I missing?</p>\n\n<p>Here's one of the statements:</p>\n\n<pre><code>       -- detail level (drop products)\n       DELETE dprods FROM [SQLsever].[WIP].[order].DropProducts as dprods\n        INNER JOIN #dropprods t on t.OrderId = dprods.OrderId\n          AND t.OrderDropId = dprods.OrderDropId\n          AND t.DropProdId = dprods.DropProdId;\n</code></pre>\n\n<p>after issuing the statement, I still have all 200+ rows in the target table AND I have the 200+ ids in the #dropprods temp table. Why?</p>\n\n<p><em><strong></em>**<em></strong>  EDITED TO BETTER DEFINE PROBLEM <strong></em>**<em>*</em>**<em>*</em>**<em>*</em>**<em>*</em>*</strong>\nThe DELETE statements were NOT the issue. The issue is tied to a set of nested/named transactions. The DELETE statements are under one, the INSERT statements under another. Here's what I have. It's obviously wrong. What I am trying to do is assure that I don't commit a DELETE before I know I'll have a good replacement INSERT.  Here's what I've done:\n<strong>*<em></strong> EDITED T-SQL WITH SAVE TRANSACTION FIX *</em>** \nThis TSQL will work now.</p>\n\n<pre><code>   -- CHANGED\n   BEGIN TRANSACTION\n   SAVE TRANSACTION process_orders\n    BEGIN TRY\n    -- detail level \n    DELETE lprods FROM [SQLServer].[WIP].[order].LiftProducts as lprods\n     INNER JOIN #liftprods t on t.OrderId = lprods.OrderId\n      AND t.OrderLiftId = lprods.OrderLiftId\n      AND t.LiftProdId = lprods.LiftProdId;\n           -- the rest of the deletes \n            --NOTE: No commit transaction here; saving it to the end\n     END TRY\n     BEGIN CATCH\n        SELECT \n          ERROR_NUMBER() AS ErrorNumber, \n          ERROR_SEVERITY() AS ErrorSeverity,\n          ERROR_MESSAGE() AS ErrorMessage;\n         IF @@TRANCOUNT &gt; 0\n           ROLLBACK TRANSACTION process_orders;\n       END CATCH\n\n       BEGIN TRANSACTION \n        -- CHANGED\n        SAVE TRANSACTION process_orders\n       BEGIN TRY     \n             -- CHANGED\n                COMMIT TRANSACTION process_orders;     \n       END TRY\n       BEGIN CATCH\n          SELECT \n            ERROR_NUMBER() AS ErrorNumber, \n            ERROR_SEVERITY() AS ErrorSeverity,\n            ERROR_MESSAGE() AS ErrorMessage;\n            IF @@TRANCOUNT &gt; 0\n              ROLLBACK TRANSACTION process_orders ;\n       END CATCH \n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":56,"score":3,"question_id":13128635,"title":"Using a left join and checking if the row existed along with another check in where clause","body":"<p>I have the following tables:</p>\n\n<pre><code>Users\nBanned\n\nSELECT u.*\nFROM Users\nWHERE u.isActive = 1\n    AND\n      u.status &lt;&gt; 'disabled'\n</code></pre>\n\n<p>I don't want to include any rows where the user may also be in the Banned table.</p>\n\n<p>What's the best way to do this?</p>\n\n<p>I could do this put a subquery in the where clause so it does something like:</p>\n\n<pre><code>u.status &lt;&gt; 'disabled' and not exist (SELECT 1 FORM Banned where userId = @userId)\n</code></pre>\n\n<p><strong>I think the best way would be to do a LEFT JOIN, how could I do that?</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2008","bulkinsert"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1356,"score":3,"question_id":10507162,"title":"Determine ROW that caused \"unexpected end of file\" error in BULK INSERT?","body":"<p>i am doing a bulk insert:</p>\n\n<pre><code>DECLARE @row_terminator CHAR;\nSET @row_terminator = CHAR(10); -- or char(10)\n\nDECLARE @stmt NVARCHAR(2000);\nSET @stmt = '\n  BULK INSERT accn_errors\n   FROM ''F:\\FullUnzipped\\accn_errors_201205080105.txt''\n   WITH \n      (\n        firstrow=2,\nFIELDTERMINATOR = ''|''  ,\nROWS_PER_BATCH=10000\n   ,ROWTERMINATOR='''+@row_terminator+'''\n   )'\nexec sp_executesql @stmt;\n</code></pre>\n\n<p>and am getting the following error:</p>\n\n<pre><code>Msg 4832, Level 16, State 1, Line 2\nBulk load: An unexpected end of file was encountered in the data file.\nMsg 7399, Level 16, State 1, Line 2\nThe OLE DB provider \"BULK\" for linked server \"(null)\" reported an error. The provider did not give any information about the error.\nMsg 7330, Level 16, State 2, Line 2\nCannot fetch a row from OLE DB provider \"BULK\" for linked server \"(null)\".\n</code></pre>\n\n<p>is there a way to know on which ROW this error occurred?</p>\n\n<p>i am able to import 10,000,000 rows without a problem and error occurs after that</p>\n"},{"tags":["sql","sql-server","stored-procedures","procedure"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13126643,"title":"fetch data from other server in create procedure","body":"<p>I have to create a procedure to fetch few values from database but I don't have access to write procedure on that server. So, I wanted to create that procedure on another server and fetch the values. I wanted to know if is it possible to create procedure to fetch values from any other server?.</p>\n"},{"tags":["sql-server","reporting-services","webforms","reportviewer"],"answer_count":0,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":159,"score":5,"question_id":12847671,"title":"Report Viewer Control (Web) Shows Blank Report","body":"<p>I have a web form containing a ReportViewer control, a DIV element so I can see that the page actually renders.  I see that my page properly loads, I see the report service being accessed in Fiddler, but there is never anything displayed.</p>\n\n<p>At present, I'm using a report with static text, no queries on it, in order to ensure that I isolate the issue.</p>\n\n<p>My page is as follows:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;%@ Page Language=\"C#\" AutoEventWireup=\"true\" CodeBehind=\"ReportViewer.aspx.cs\" Inherits=\"PeopleNet.Web.Views.Reports.ReportViewer\" %&gt;\n\n&lt;%@ Register Assembly=\"Microsoft.ReportViewer.WebForms, Version=11.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91\"\n    Namespace=\"Microsoft.Reporting.WebForms\" TagPrefix=\"rsweb\" %&gt;\n\n&lt;!DOCTYPE html&gt;\n&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n&lt;head runat=\"server\"&gt;\n    &lt;title&gt;&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;form id=\"form1\" runat=\"server\"&gt;\n        &lt;asp:ScriptManager ID=\"ScriptManager1\" runat=\"server\"&gt;\n            &lt;Scripts&gt;\n                &lt;asp:ScriptReference Path=\"~/scripts/jquery-1.7.2.js\" /&gt;\n                &lt;asp:ScriptReference Path=\"~/scripts/fixReportViewer.js\" /&gt;\n            &lt;/Scripts&gt;\n        &lt;/asp:ScriptManager&gt;\n\n        &lt;div&gt;\n            This is the report viewer page...\n        &lt;/div&gt;\n        &lt;rsweb:ReportViewer ID=\"ReportViewer1\" runat=\"server\"&gt;&lt;/rsweb:ReportViewer&gt;\n    &lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>The code to display the report is:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>protected void Page_Load(object sender, EventArgs e)\n{\n    this.ReportViewer1.ServerReport.ReportServerUrl = ConfigurationFacade.ReportServerUri;\n    this.ReportViewer1.ServerReport.ReportPath = { path to report name };\n    this.ReportViewer1.ServerReport.ReportServerCredentials = new ReportServerCredentials(); // custom class implementing IReportServerCredentials as described in various places around the web, including SO\n    this.ReportViewer1.ServerReport.Refresh();\n}\n</code></pre>\n\n<p>My web.config file is configured with the HttpHandlers as required:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;system.web&gt;\n    &lt;!-- abbreviated... --&gt;\n    &lt;httpHandlers&gt;\n        &lt;add path=\"Reserved.ReportViewerWebControl.axd\" verb=\"*\" type=\"Microsoft.Reporting.WebForms.HttpHandler, Microsoft.ReportViewer.WebForms, Version=11.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91\" validate=\"false\" /&gt;\n    &lt;/httpHandlers&gt;\n&lt;/system.web&gt;\n</code></pre>\n\n<p>And :</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;system.webServer&gt;\n    &lt;!-- abbreviated... --&gt;\n    &lt;handlers&gt;\n        &lt;add name=\"ReportViewerWebControlHandler\" preCondition=\"integratedMode\" verb=\"*\" path=\"Reserved.ReportViewerWebControl.axd\" type=\"Microsoft.Reporting.WebForms.HttpHandler, Microsoft.ReportViewer.WebForms, Version=11.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91\" /&gt;\n    &lt;/handlers&gt;\n&lt;/system.webServer&gt;\n</code></pre>\n\n<p>The server runs Windows 2008 and SQL Server 2008 R2.</p>\n\n<p>I am using the SQL Server 2012 version of the viewer, as we are in the process of updating our environments to 2012.</p>\n\n<p>I have repeatedly verified that the report is accessible from the ReportManager, with no issues whatsoever.</p>\n\n<p>I have been attempting to access this in IE9, having seen various issues stated with other browsers.</p>\n\n<p>I am presently (for testing only) passing my credentials as the report server credentials.  I am a Reporting Services Administrator, as well as a member of the server administrators group on the server.</p>\n\n<p>I have checked both the event log and the ReportServerService log, and have found nothing amiss.</p>\n\n<p><strong>UPDATE:</strong> Looks like when change the AsyncRendering to false, and ensure that I don't try to \"SetParameters\" with an empty collection, this gets mostly cleared up:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>this.ReportViewer1.AsyncRendering = false;\n</code></pre>\n\n<p>What am I missing in the configuration/code here?</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13128365,"title":"Update procedure","body":"<p>I'm working on a procedure in SQL server:</p>\n\n<p>I'm new on SQL server &amp; I get this error: </p>\n\n<blockquote>\n  <p>Must declare the scalar variable \"@Course_Name\"</p>\n</blockquote>\n\n<p>My procedure is:</p>\n\n<pre><code>USE [Hyaline management System]\nGO\n\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE PROCEDURE [dbo].[GetUpdateCourseID] \n@CourseID int\nAS\nBEGIN\n\nSET NOCOUNT ON;\nUpdate Course SET\n    Course_Name = @Course_Name,\n    Course_Duration = @Course_Duration\nwhere CourseID = @CourseID;\n\nEND\n</code></pre>\n\n<p>Can someone please point me where I'm going wrong? and the solution? </p>\n"},{"tags":["sql","sql-server","tsql","temporary-tables"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":37,"score":2,"question_id":13126578,"title":"SQL Server 2008 - #tmp table throws error when run within an exec command","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/688161/tsql-writing-into-a-temporary-table-from-dynamic-sql\">TSQL Writing into a Temporary Table from Dynamic SQL</a>  </p>\n</blockquote>\n\n\n\n<pre><code> ALTER PROCEDURE [dbo].[usp_ServicesStats1](@PERIOD VARCHAR(30) )\n\n AS\n BEGIN\n-- SET NOCOUNT ON added to prevent extra result SETs FROM\n-- interfering with SELECT statements.\nSET NOCOUNT ON;\n\n\n DELETE FROM servicesstats1;\n DECLARE @QUERY  NVARCHAR(MAX);\n\n DECLARE @mainTable VARCHAR(50)\n\n SET @mainTable = '[ServicesStats' + @PERIOD + ']';\n\n\n\n SET @QUERY = 'INSERT INTO servicesstats1(Department,StudentUsers) \n SELECT department,COUNT(*) FROM ' +  @mainTable + \n 'GROUP BY department';\n\n EXEC(@QUERY); -- runs okay!\n\n\n IF OBJECT_ID('tempdb..[##tmp5]') is not null \nBEGIN \n    drop table [##tmp5] \nEND\n\n SET @QUERY = ' SELECT studentid\n INTO [##tmp5]\n FROM ' + @mainTable + '\n GROUP BY studentid\n having COUNT(*)=1; select * from [##tmp5];';\n PRINT @QUERY;\n\n\n EXEC sp_executesql @QUERY;\n\n IF OBJECT_ID('tempdb..[#tmp3]') is not null \nBEGIN \n    drop table [#tmp3] \nEND\n\n SELECT S.department,COUNT(*) AS No INTO #TMP3 --  ONLY THIS SERVICE \n FROM servicesstats_0511_0412 s, #TMP5 T    -- this is not being replaced yet by the @mainTable\n WHERE S.STUDENTID = T.STUDENTID\n GROUP BY S.department\n</code></pre>\n\n<p>Error : </p>\n\n<blockquote>\n  <p><em>Invalid object name '#TMP5'.</em></p>\n</blockquote>\n\n<p>The problem is temporary table <code>#tmp5</code>, now if I were to run this it would work but it's not dynamic.</p>\n\n<pre><code>SELECT studentid\nINTO [#tmp5]\nFROM tableName\nGROUP BY studentid\nhaving COUNT(*)=1;\n</code></pre>\n\n<p>Basically I'm doing this because of the dynamic table name. But <code>#tmp</code> is throwing that error.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":57,"score":-1,"question_id":13127166,"title":"how to get median for every record?","body":"<p>There's no median function in sql server, so I'm using this wonderful suggestion:</p>\n\n<p><a href=\"http://stackoverflow.com/a/2026609/117700\">http://stackoverflow.com/a/2026609/117700</a></p>\n\n<p>this computes the median over an entire dataset, but I need the median per record.</p>\n\n<p>My dataset is:</p>\n\n<pre><code>+-----------+-------------+\n| client_id | TimesTested |\n+-----------+-------------+\n|    214220 |           1 |\n|    215425 |           1 |\n|    212839 |           4 |\n|    215249 |           1 |\n|    210498 |           3 |\n|    110655 |           1 |\n|    110655 |           1 |\n|    110655 |          12 |\n|    215425 |           4 |\n|    100196 |           1 |\n|    110032 |           1 |\n|    110032 |           1 |\n|    101944 |           3 |\n|    101232 |           2 |\n|    101232 |           1 |\n+-----------+-------------+\n</code></pre>\n\n<p>here's the query I am using:</p>\n\n<pre><code>select client_id,  \n    (\n    SELECT\n    (\n     (SELECT MAX(TimesTested ) FROM\n       (SELECT TOP 50 PERCENT t.TimesTested \n       FROM counted3 t \n       where t.timestested&gt;1 \n       and CLIENT_ID=t.CLIENT_ID \n       ORDER BY t.TimesTested ) AS BottomHalf)\n     +\n     (SELECT MIN(TimesTested ) FROM\n       (SELECT TOP 50 PERCENT t.TimesTested \n       FROM counted3 t \n       where t.timestested&gt;1 \n       and CLIENT_ID=t.CLIENT_ID \n       ORDER BY t.TimesTested DESC) AS TopHalf)\n    ) / 2 AS Median\n    ) TotalAvgTestFreq\nfrom counted3 \n\ngroup by client_id\n</code></pre>\n\n<p>but it is giving my funny data:</p>\n\n<pre><code>+-----------+------------------+\n| client_id | median???????????|\n+-----------+------------------+\n|    100007 |               84 |\n|    100008 |               84 |\n|    100011 |               84 |\n|    100014 |               84 |\n|    100026 |               84 |\n|    100027 |               84 |\n|    100028 |               84 |\n|    100029 |               84 |\n|    100042 |               84 |\n|    100043 |               84 |\n|    100071 |               84 |\n|    100072 |               84 |\n|    100074 |               84 |\n+-----------+------------------+\n</code></pre>\n\n<p><strong>i can i get the median for every client_id ?</strong></p>\n\n<p>I am currently trying to use this <strong>awesome</strong> query from Aaron's site:</p>\n\n<pre><code>select c3.client_id,(\n    SELECT AVG(1.0 * TimesTested ) median\n    FROM\n    (\n        SELECT o.TimesTested , \n        rn = ROW_NUMBER() OVER (ORDER BY o.TimesTested ), c.c\n        FROM counted3 AS o\n        CROSS JOIN (SELECT c = COUNT(*) FROM counted3) AS c\n        where count&gt;1\n    ) AS x\n    WHERE rn IN ((c + 1)/2, (c + 2)/2)\n    ) a\n    from counted3 c3\n    group by c3.client_id\n</code></pre>\n\n<p>unfortunately, as Richardthekiwi points out:</p>\n\n<blockquote>\n  <p>it's for a single median whereas this question is about a median\n  per-partition</p>\n</blockquote>\n\n<p>i would like to know how i can join it on <code>counted3</code> to get the median per partition?></p>\n"},{"tags":["sql-server","ssas"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":3106,"score":2,"question_id":1994004,"title":"SQL Server Analysis Services - Do I have it?","body":"<p>Hi I have access to SQL Server at work and I've heard some interesting things that can be done with SQL Server Analysis Services. How do I know whether analysis services is running? Is it installed by default on the server? Would it be installed locally on my machine? Forgive what probably seems like a pretty dumb question, but I couldn't find any concrete details on Microsoft's website. Thanks!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":13034169,"title":"how to aggregate values from a pivot?","body":"<p>my query returns a dataset that looks like this:</p>\n\n<pre><code>+-----------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+--------+---------+------------+---------+---------+------------+--------+\n| CLIENT_ID | count1 | TestFreq1 | stdv1 | count2 | TestFreq2 |  stdv2  | count3 | TestFreq3 |  stdv3  | count4 | TestFreq4 |  stdv4  | count5 | TestFreq5 |  stdv5  | count6 | TestFreq6 |  stdv6  | count7 | TestFreq7 |  stdv7  | count8 | TestFreq8 |  stdv8  | count9 | TestFreq9 |  stdv9  | count10 | TestFreq10 | stdv10 | count11 | TestFreq11 | stdv11  | count12 | TestFreq12 | stdv12 |\n+-----------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+--------+---------+------------+---------+---------+------------+--------+\n|    210893 |    136 |         0 |     0 |     81 |        41 | 79.2685 |     19 |        63 | 58.321  |     24 |        21 | 20.4896 |      5 |        25 | 8.228   |      6 |        24 | 24.0638 |      4 |        25 | 24.6103 | 2      | 25        | 2.12132 |      2 |        23 | 21.9203 | 1       | 33         | NULL   |       2 |         29 | 7.77817 | 1       | 38         | NULL   |\n|    123321 |     50 |         0 |     0 |      5 |        26 | 7.87401 |     14 |        45 | 51.8002 |      3 |        25 | 14.7422 |      2 |        22 | 17.6777 |      4 |        36 | 21.4942 |      3 |        36 | 22.2711 | NULL   | NULL      | NULL    |      4 |        35 | 9.30949 | NULL    | NULL       | NULL   |       1 |         31 | NULL    | NULL    | NULL       | NULL   |\n|    454322 |    232 |         0 |     0 |    173 |        10 | 33.8487 |     36 |        36 | 36.6602 |     32 |        15 | 17.485  |     10 |        38 | 22.4809 |     13 |        23 | 20.0477 |      7 |        18 | 11.4143 | 3      | 32        | 24.5425 |      6 |        25 | 16.8602 | 3       | 28         | 21.166 |       2 |         25 | 4.94975 | 1       | 34         | NULL   |\n+-----------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+--------+---------+------------+---------+---------+------------+--------+\n</code></pre>\n\n<p><strong>instead of forcing the data to go out to <code>count13, stdv13, testfreq13, ..14..14..14, 15.15.15</code> how can i aggregate all the values 12 and over in the same field?</strong></p>\n\n<p>here's my query, and thank you so much for your guidance:</p>\n\n<pre><code>;WITH counted AS (\n  SELECT\n    client_id,\n    COUNT(*) AS TimesTested,\n    (datediff(day,MIN(received_date),max(received_date)))\n  /COUNT(*) as TestFreq\n  FROM f_accession_daily\n  GROUP BY\n    client_id,\n    patient_id\n),\ncounted2 as (\n  SELECT\n    client_id,\n    TimesTested,\n    CAST(COUNT(*) AS varchar(30)) AS count,\n    CAST(AVG(testfreq) as varchar(30)) as TestFreq,\n    CAST(STDEV(TestFreq) as varchar(30)) Stdv\n  FROM counted\n  GROUP BY\n    client_id,\n    TimesTested\n    )\n    ,\nunpivoted AS (\n  SELECT\n    client_id,\n    ColumnName + CAST(TimesTested AS varchar(10)) AS ColumnName,\n    ColumnValue\n  FROM counted2\n  UNPIVOT (\n    ColumnValue FOR ColumnName IN (count, TestFreq,stdv)\n  ) u\n),\npivoted AS (\n  SELECT\n    client_id clientid,\n    count1, TestFreq1,stdv1,\n    count2, TestFreq2,stdv2,\n    count3, TestFreq3,stdv3,\n    count4, TestFreq4,stdv4,\n    count5, TestFreq5,stdv5,\n    count6, TestFreq6,stdv6,\n    count7, TestFreq7,stdv7,\n    count8, TestFreq8,stdv8,\n    count9, TestFreq9,stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n  FROM unpivoted\n  PIVOT (\n    MAX(ColumnValue) FOR ColumnName IN (\n      count1,TestFreq1,stdv1,\n      count2,TestFreq2,stdv2,\n      count3,TestFreq3,stdv3,\n      count4,TestFreq4,stdv4,\n      count5,TestFreq5,stdv5,\n      count6,TestFreq6,stdv6,\n      count7,TestFreq7,stdv7,\n    count8, TestFreq8,   stdv8,\n    count9, TestFreq9,   stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n    )\n  ) p\n)\nselect * from pivoted\n</code></pre>\n\n<p>just to clarify i want to return the same exact results, it's just that for the last column i want to aggregate all values that fall into the <code>12+ bucket</code>. all the fields are going to be the same except the last three, which are going to be:</p>\n\n<pre><code>+----------+-------------+---------+\n| count12+ | TestFreq12+ | stdv12+ |\n+----------+-------------+---------+\n| 353      | 32423       | NULL    |\n| NULL     | NULL        | NULL    |\n| 342      | 25324       | NULL    |\n+----------+-------------+---------+\n</code></pre>\n\n<p>please note the much greater numbers above compared to the rest because the <strong>12+</strong> have been aggregated.</p>\n\n<p>thank you so much for your guidance!</p>\n"},{"tags":["sql-server","datetime","type-conversion","sql-server-2012","data-type-conversion"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13124944,"title":"Converting NVARCHAR(255) to DATE","body":"<p>I'm trying to transfer some old SQL Server data using Excel into SQL Server. It seems that <code>Import/Export Data</code> application automatically sets most data columns to <code>NVARCHAR(255)</code>. Problem I have, is one of my columns is supposed to be a <code>DATE</code> type, but all data in it looks like this <code>18.08.2000 14:48:15</code>. </p>\n\n<p>So, when I try to use this query:</p>\n\n<pre><code>SELECT CONVERT(Date, DATE_TIME,  113)\nFROM someTable\n</code></pre>\n\n<p>I get this error:</p>\n\n<blockquote>\n  <p>Msg 9807, Level 16, State 0, Line 1<br>\n  The input character string does not follow style 113, either change the input character string or use a different style.</p>\n</blockquote>\n\n<p>None of the <code>[styles]</code> from <a href=\"http://msdn.microsoft.com/en-us/library/ms187928.aspx\" rel=\"nofollow\">CAST and CONVERT (Transact-SQL)</a> are working in my case.</p>\n\n<p>Any advise or help is greatly appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2012","localdb"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":13126726,"title":"How do I copy SQL Server 2012 database to localdb instance?","body":"<p>I'm looking to copy a SQL Server 2012 Standard database to my localdb instance. I've tried the wizard which complains that localdb isn't a <em>SQL Server 2005 or later express instance</em>. I also did a backup/restore but upon the restore in my localdb I get the following error...</p>\n\n<p>Running this...</p>\n\n<pre><code>RESTORE DATABASE CSODev\nFROM DISK = 'C:\\MyBckDir\\CSODev.bak'\nWITH MOVE 'CSOdev_Data' TO 'C:\\Users\\cblair\\CSOdev_Data.mdf',\nMOVE 'CSOdev_Log' TO 'C:\\Users\\cblair\\CSOdev_Log.ldf',\nREPLACE\n</code></pre>\n\n<p>Error message I get...</p>\n\n<blockquote>\n  <p>Processed 8752 pages for database 'CSODev', file 'CSOdev_Data' on file 1.<br>\n  Processed 5 pages for database 'CSODev', file 'CSOdev_Log' on file 1.  </p>\n  \n  <p><em>Msg 1853, Level 16, State 1, Line 1</em><br>\n  The logical database file 'CSOdev_Log' cannot be found. Specify the full path for the file.<br>\n  <em>Msg 3167, Level 16, State 1, Line 1</em><br>\n  RESTORE could not start database 'CSODev'.<br>\n  <em>Msg 3013, Level 16, State 1, Line 1</em><br>\n  RESTORE DATABASE is terminating abnormally.</p>\n</blockquote>\n\n<p>The database ends up in \"Recovery Pending\" mode.  It seems like it has issues with the log file.  I have tried 2 different backups in case one was just corrupted.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13122395,"title":"Removing quotes added to column names from Excel import SQL Server 2008","body":"<p>I've noticed that when I use SSMS to import an Excel spreadsheet into SQL Server quotation marks are added.  I've read somewhere that for whatever reason it's necessary for Excel to do this.  Once in SQL Server, these quotes around the column names are useless and I'd like to have a programmatic way to remove them.  The closest thing, which doesn't work, that I have tried to make is <code>EXEC sp_rename 'Table.[\"withquotes\"]', NewColumnName, 'replace(Table.[\"withquotes\",'\"','']</code>.  I'd like to loop through all of the column names in a table and use the <code>replace</code> function wherever a those column names contain quotation marks.  Is there a typical, idiomatic way to do this?</p>\n"},{"tags":["mysql","sql","sql-server","database","database-design"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13115691,"title":"how to design table for accessing the different places","body":"<p>The tables are for users to access different places</p>\n\n<p>The design as below:</p>\n\n<p>user table:</p>\n\n<pre><code>&lt;user&gt;\nuserid\nusername\nplace          (the row define access rights)\n</code></pre>\n\n<p>place table:</p>\n\n<pre><code>&lt;place&gt;\nplaceid\nplacename\nfloor\n</code></pre>\n\n<p>My thoughts:</p>\n\n<p>three places and placeid are 001,002,003\none user and  userid is 001 to aceess these three places</p>\n\n<pre><code>&lt;user&gt;\nuserid     username       place\n001        john           001,002,003\n\n\n&lt;place&gt;\nplaceid    placename   floor\n001        A           1 \n002        B           2 \n003        C           3\n004        D           4 \n</code></pre>\n\n<p>My question is,</p>\n\n<p>in \"user\" table, the attribute \"place\" contains many placeids, \nand separate by a comma, this design is fine or bad ?\nIt needs to separate the place values from \"user\" table ?</p>\n"},{"tags":["asp.net","sql","sql-server","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":193,"score":0,"question_id":3520597,"title":"get ssis package output from SP","body":"<p>I have a SP that runs a SSIS package.</p>\n\n<pre><code>xp_cmdshell 'dtexec /f \"F:\\SSIS Package\\test.dtsx\" /Rep E'\n</code></pre>\n\n<p>When I run the SP in VS I get an Output window where I can see if it was successful.\nIs there a way to get the output from this into my asp.net application ?</p>\n"},{"tags":["sql-server","parent-child"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13084959,"title":"one to one parent child relationship sql server","body":"<p>I have a table with fields <code>TransactionID</code>, <code>Amount</code> and <code>ParentTransactionID</code>\nThe transactions can be cancelled so a new entry posted with <code>amount</code> and <code>ParentTransactionID</code> as cancelled <code>TransactionID</code>.</p>\n\n<p>Lets say a transaction  </p>\n\n<blockquote>\n  <p>1 100 NULL</p>\n</blockquote>\n\n<p>I cancelled the above entry, it will like  </p>\n\n<blockquote>\n  <p>2 -100 1</p>\n</blockquote>\n\n<p>Again cancelled the above transaction, so it should like  </p>\n\n<blockquote>\n  <p>3 100 2</p>\n</blockquote>\n\n<p>When I fetch  I should get the record 3 as ID 1 and 2 got cancelled.\nresult should be  </p>\n\n<blockquote>\n  <p>3 100 2</p>\n</blockquote>\n\n<p>If I cancelled the 3rd entry no records should return.</p>\n\n<pre><code>SELECT * FROM Transaction t\nWHERE NOT EXISTS (SELECT TOP 1 NULL FROM Transaction pt\nWHERE (pt.ParentTransactionID = t.TransactionID OR t.ParentTransactionID = pt.TransactionID)\nAND ABS(t.Amount) = ABS(pt.Amount))\n</code></pre>\n\n<p>This works if only one level of cancel is made.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13125550,"title":"Drop tables that starts with specific characters","body":"<p>I have multiple table names like g_str_a , g_str_ab , g_str_abc . I would like to drop all those tables that start with g_str on SQL Server 2008.</p>\n\n<p>Will <code>DROP Tables like 'g_str'</code> help?</p>\n\n<p>Please help me with the script. </p>\n"},{"tags":["c++","sql-server","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13123161,"title":"connect to mssql on linux via odbc","body":"<p>I connected MSSQL (on windows) via odbc on linux redhat 64bit.<br>\nBelow is odbc and freetds configuration files.</p>\n\n<p><code>freetds.conf</code>:</p>\n\n<pre><code>[FreeTDS]  \nhost=172.21.32.20  \nport=1433  \ntds version=7.2  \nclient charset = GB2312   \n</code></pre>\n\n<p><code>odbcinst.ini</code>:</p>\n\n<pre><code>[TDS]  \nDescription = TDS  \nDriver = /usr/local/lib/libtdsodbc.so  \nTrace = Yes  \nTraceFile=/tmp/odbcinst.log  \nUsageCount = 1  \n</code></pre>\n\n<p><code>odbc.ini</code>:</p>\n\n<pre><code>[SQLSERVER]  \nDriver = TDS  \nDescription = sql server dsn  \nTrace = NO  \nServer = 172.21.32.20  \nDatabase = Live  \nPort = 1433  \nTDS_Version = 7.2  \nTraceFile=/tmp/sqlserver.log  \n</code></pre>\n\n<p>Snippets:</p>\n\n<pre><code>QString f3ErpDsn = QString::fromLocal8Bit(\"Driver={SQLSERVER};server=172.21.32.20;database=Live;uid=inp;pwd=inp;\");\nQSqlDatabase f3ErpDb= QSqlDatabase::addDatabase(\"QODBC\");\nf3ErpDb.setDatabaseName(f3ErpDsn);\n// f3ErpDb.setDatabaseName(\"SQLSERVER\");\nf3ErpDb.setUserName(\"inp\");\nf3ErpDb.setPassword(\"inp\");\nQString sqlCmdStr = \"select * from dbo.Table_Drilling_Data01 where status=1\";\nif ( ! f3ErpDb.open() )\n{\n        qDebug() &lt;&lt; f3ErpDb.lastError().text();\n        return 1;\n}\nQSqlTableModel model;\nmodel.setTable(\"dbo.Table_Drilling_Data01\");\nmodel.setFilter(\"status=3\");\nmodel.select();\nqDebug() &lt;&lt; model.lastError().text();\n</code></pre>\n\n<p>Error messages:</p>\n\n<ol>\n<li><p><code>f3ErpDb.setDatabaseName(f3ErpDsn);</code><br>\nIf <code>setDatabaseName</code> is <code>f3ErpDsn</code> error message is:</p>\n\n<blockquote>\n  <p>\"QODBC3: Unable to connect\", \"[unixODBC][Driver Manager]Data source name not found, and no default driver specified\")  </p>\n</blockquote>\n\n<p>I had defined SQLSERVER in odbc.ini. Why it can not find it?</p></li>\n<li><p>But if I changed <code>f3ErpDb.setDatabaseName(\"SQLSERVER\");</code>, error message is:</p>\n\n<blockquote>\n  <p>\"[FreeTDS][SQL Server]The incoming tabular data stream (TDS) remote procedure call (RPC) protocol stream is incorrect. Parameter 1 (\"\"): Data type 0x00 is unknown. QODBC3: Unable to execute statement\"   </p>\n</blockquote></li>\n</ol>\n\n<p>It makes me confounded, could anybody help me?</p>\n"},{"tags":["sql-server","index"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":13072505,"title":"Performance in SQL Server when there is PK and UQ index on the same column","body":"<p>In SQL Server 2005 I have encountered a table with unique ID column (with unique index on it) and primary key clustered index on it too (so there are explicitly 2 indexes on this column). Is this a major performance factor on insert/update/delete on this table? </p>\n\n<p>I'm trying to boost performance on a database created long ago and I wonder if removing such reduntant unique indexes could help. Does the database check/rebuild both of these indexes on every content modification? Or would the performance gain be too small to even bother with this?</p>\n\n<p>Here is a sample index usage output:</p>\n\n<pre><code>INDEX   UserSeeks    UserScans  UserLookups UserUpdates\n--------------------------------------------------------\n1_PK    45517046      42911     245353       0\n1_UQ    45517046      42911     245353       0\n1_Other 45517046      42911     245353       0   \n--------------------------------------------------------\n2_PK    21538111      5685      231030      1121\n2_UQ    21538111      5685      231030      1121\n3_other 21538111      5685      231030      1121\n</code></pre>\n\n<p>And here is the query I used to get that data:</p>\n\n<pre><code>SELECT OBJECT_NAME(I.OBJECT_ID) AS ObjectName,\n   I.NAME AS IndexName,\n   S.user_seeks AS UserSeeks,\n   S.user_scans AS UserScans,\n   S.user_lookups AS UserLookups,\n   S.user_updates AS UserUpdates\nFROM sys.indexes I \nJOIN sys.dm_db_index_usage_stats S\n  ON (S.OBJECT_ID = I.OBJECT_ID)\nWHERE(database_id = DB_ID())\n</code></pre>\n\n<p>And fixed join condition:</p>\n\n<pre><code>SELECT OBJECT_NAME(I.OBJECT_ID) AS ObjectName,\n   I.NAME AS IndexName,\n   S.user_seeks AS UserSeeks,\n   S.user_scans AS UserScans,\n   S.user_lookups AS UserLookups,\n   S.user_updates AS UserUpdates\nFROM sys.indexes I \nJOIN sys.dm_db_index_usage_stats S\n  ON (S.OBJECT_ID = I.OBJECT_ID)\n  AND(S.index_id = I.index_id)\nWHERE(database_id = DB_ID())\n</code></pre>\n"},{"tags":["sql-server","visual-studio"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":608,"score":1,"question_id":427697,"title":"Failed to remove package protection with error 0x80131940","body":"<p>I'm trying to open a password protected package in SQL Server BIDs and I keep getting the following error message each time I pu in the correct password: </p>\n\n<p><code>Failed to remove package protection with error 0x80131940 \"(null)\"</code></p>\n\n<p>This occurs in the <code>CPaqckage::LoadFromXML</code> method.</p>\n\n<p>Any Ideas?</p>\n"},{"tags":["sql-server","database","import","networking","bulk"],"answer_count":5,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":4830,"score":2,"question_id":440289,"title":"MS SQL Server - Bulk Insert Across a Network","body":"<p>I have an application that uses MS SQL Server for which I'll need to do a bulk insert from a file.  The sticking point is that the database and my application will be hosted on separate servers.  What is the best way to do a bulk insert across a network?  Two ideas I'd come up with so far:</p>\n\n<ol>\n<li><p>From the app server, share a directory that the db server can find, and do the import using a bulk insert statement from the remote file</p></li>\n<li><p>Run an FTP server from the db server - when the import is performed, simply ftp the file to the db server and do the import using a bulk insert from the local file (I am leaning towards this option).</p></li>\n</ol>\n\n<p>Can anyone else tell me if there is a better way to do this, or if not, which one makes the most sense, and why?</p>\n"},{"tags":["sql-server","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":303,"score":0,"question_id":5260500,"title":"Catch conditional parameters in SQL Server select trigger","body":"<p>I want to know that, when I write a select trigger (instead of select), how catch conditional parameters in this trigger? </p>\n\n<p>I am using SQL Server.</p>\n"},{"tags":["sql-server","excel","formatting","openrowset"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1202,"score":0,"question_id":9349946,"title":"SQL Server 2005 OPENROWSET insert into Excel - text to number formatting","body":"<p>So it's not a huge deal, but with Google not returning anything more recent (mostly 2007 or so) about it possibly being an Excel driver issue...I came here to ask the question as what I found as an \"answer\" was not acceptable without further research.</p>\n\n<p>My problem:</p>\n\n<p>Writing a dynamic OPENROWSET query clear and insert new data to send off a report to specific users - the base excel report contains some formulas in which it calculates off and sums based off the inserted data and the multiplication formulas seem to work fine, but unless the totals are formatted properly in Excel as \"numbers\" instead of text the sum will not function...</p>\n\n<p>Solution must be free-form based (if there is a solution at all), I don't want to transfer all my code to SSIS...</p>\n\n<p>Update/Insert code:</p>\n\n<pre><code>    SELECT @sqlu = 'UPDATE OPENROWSET(' +\n    '''Microsoft.ACE.OLEDB.12.0'', ' +\n    '''Excel 12.0;Database=' + @File + ';HDR=YES'', ' +\n    '''SELECT * FROM [Base$B1:G601]'')\n    SET \n    col1 = '''', col2 = '''', col3 = '''', col4 = '''', col5 = '''', col6 = '''' '\n\n\n    EXEC (@sqlu)\n\n\n    SELECT @sqli = 'INSERT INTO OPENROWSET(' +\n    '''Microsoft.ACE.OLEDB.12.0'', ' +\n    '''Excel 12.0;Database=' + @File + ';HDR=NO'', ' +\n    '''SELECT * FROM [Base$B1:G2]'')\n\n    SELECT col1, col2, col3, col4, col5, col6\n    FROM [DATABASE].[dbo].tbl_CIM\n    WHERE col1 IN(''' + @area + ''')'\n\n\n    EXEC (@sqli)\n</code></pre>\n\n<p>The second problem and it may not be a problem for now but later - after the insert, it seems to create borders around the results. Is there also a potential way to remove those during the result transfer?</p>\n\n<p>Any help or sources to research if it is a driver issue is appreciated as I could find none.</p>\n"},{"tags":["sql","sql-server","performance","sql-server-2008","ssis"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":497,"score":4,"question_id":9290291,"title":"SQL Script in VM taking long time for execution","body":"<p>I have the Execute SQL Script package that contains the script to insert about 150K records.</p>\n\n<p>Problem in here is when I execute the package in the Virtual machine its taking 25 min's approx and the same package in physical machine its taking 2 min's</p>\n\n<p>Question 1? Why its taking that much time to load the same data in VM.\nQuestion 2? How to solve this performance issue.</p>\n\n<p>Physical machine configuration has 4GB Ram and 250GB HD + Windows server 2008 R2 + SQL server 2008 R2 Standard Edition.\nVirtual machine has the same Configuration</p>\n\n<p><strong>Update: The Problem is with the SQL Server in VM.</strong></p>\n\n<p><strong>Question 1? Why its taking that much time to Run the same script in VM.</strong></p>\n\n<p><strong>Question 2? How to solve this performance issue.</strong></p>\n\n<p>Both the batabases schema in Physical Machine and VM are identical. Other databases are also same. There was no indexing applied for that tables in both machines. Datatypes are same. harddisk as I said has the same configuration.</p>\n\n<p>No RAID is done on both the machines.</p>\n\n<blockquote>\n  <p>Physical machine has the 2.67GHz RAM Quad Core and in the virtual machine has the\n  2.00GHz RAM Quad Core</p>\n</blockquote>\n\n<p>Version of SQL PM:</p>\n\n<p>Microsoft SQL Server 2008 R2 (RTM) - 10.50.1600.1 (X64) Apr  2 2010 15:48:46    Copyright (c) Microsoft Corporation Standard Edition (64-bit) on Windows NT 6.1  (Build 7601: Service Pack 1)</p>\n\n<p>Version of SQL PM:</p>\n\n<p>Microsoft SQL Server 2008 R2 (RTM) - 10.50.1600.1 (X64) Apr  2 2010 15:48:46    Copyright (c) Microsoft Corporation Standard Edition (64-bit) on Windows NT 6.1  (Build 7601: Service Pack 1) (Hypervisor)</p>\n\n<p>I executed the script Execution plan for both are the same as there is no difference in plan.</p>\n\n<p>Vendor is HP ML350 Machine.</p>\n\n<p>There are almost 20 VM's on the same physical server out of which 7 servers are active.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":5,"favorite_count":5,"up_vote_count":7,"down_vote_count":0,"view_count":16074,"score":7,"question_id":947281,"title":"Multiple Column Pivot in T-SQL","body":"<p>I am working with a table where there are multiple rows that I need pivoted into columns.  So the pivot is the perfect solution for this, and works well when all I need is one field.  I am needing to return several fields based upon the pivot.  Here is the pseudo code with specifics stripped out:</p>\n\n<pre><code>SELECT \n  field1,\n  [1], [2], [3], [4]\nFROM\n  (\n  SELECT \n    field1, \n    field2, \n    (ROW_NUMBER() OVER(PARTITION BY field1 ORDER BY field2)) RowID\n  FROM tblname\n  ) AS SourceTable\nPIVOT\n  (\n  MAX(field2)\n  FOR RowID IN ([1], [2], [3], [4])\n  ) AS PivotTable;\n</code></pre>\n\n<p>The above syntax works brilliantly, but what do I do when I need to get additional information found in field3, field4....?</p>\n"},{"tags":["sql-server","tsql","ssis"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3125,"score":1,"question_id":1236505,"title":"isdate function in ssis derived component","body":"<p>Hi\n  Is there any way to check Date(like isDate function in TSQL)  column in SSIS package derived column expression after extraction from Sourcefile before loading to target dtabase?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":305,"score":1,"question_id":3616454,"title":"SQL Server: COLLATE CS->CI performance vs UPPER","body":"<p>What's better to use when comparing columns that could contains values with different cases? \nIs Collate faster?\nJust trying to figure this out because in our project with tons of data comparisons.\nwe use:</p>\n\n<pre><code>select * from table t1, table t2 where \nt1.col1 collate SQL_Latin1_General_CP1_CI_AS = t2.colb collate SQL_Latin1_General_CP1_CI_AS \n</code></pre>\n\n<p>why we can't rewrite as:</p>\n\n<pre><code>select * from table t1, table t2 where \nUPPER(t1.col1)  = UPPER(t2.colb)\n</code></pre>\n"},{"tags":["sql-server","bulkinsert","xlsx"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":45,"score":-1,"question_id":13124680,"title":"How to Bulk Insert from XLSX file extension?","body":"<p>Can anyone advise how to bulk insert from xlsx file? I have something like below but does not work. I tried the FIELDDEMINATOR like \"<strong>\\t</strong>\",   \"<strong>,</strong>\",   \"<strong>;</strong>\",   \"<strong>|</strong>\", but failed to retrieve the contents from xlsx file. However it doesn't have any error.</p>\n\n<pre><code>BULK INSERT #EVB FROM 'C:\\Users\\summer\\Desktop\\Sample\\premise.xlsx' \nWITH (FIELDTERMINATOR = '\\t', ROWTERMINATOR = '\\n', FIRSTROW = 2);\n\nSELECT * FROM #EVB\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13124165,"title":"Separating column into two separate columns","body":"<p>I have a column <code>name</code>.  There are entries such-as:</p>\n\n<pre><code>Smith, John\nSmith, Joe\nOne whole entry\n</code></pre>\n\n<p>I need them separated into two columns as this:</p>\n\n<pre><code>LastName        | FirstName\n---------------------------\nSmith           | John\nSmith           | Joe\nOne whole entry | \n</code></pre>\n\n<p>I'm using this query:</p>\n\n<pre><code>SELECT left(name, CHARINDEX(', ', name)) as LastName FROM LookUps\n</code></pre>\n\n<p>I've tried the following above, but it's displaying the following comma (e.g. <em>Smith,</em>). I need it to remove this following comma, but also display the full information for those entries without a comma.</p>\n\n<p>Any help would be appreciated.  Thanks..</p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":11850515,"title":"how to join top 1 quickly","body":"<p>I have a table with devices, and a second table with performance counters.  So I have device A  which has lets say 1000 entries in the performance counters table.  I am trying to get all the devices, 2500 of them, and their most recent performance counter.  I have used an Outer Apply,  which does accomplish the desired results, but the query takes 5 minutes to execute.</p>\n\n<p>Is this the best way to get the info I am looking for or is there a better way?  Is the performance of this query normal, and I am just asking too much?  I am thinking of creating a third 'temp' table nightly that will hold this data so I can display and query the info quickly.  What are the best practices for something like this?  </p>\n\n<p>Here is my current query:</p>\n\n<pre><code>   select * from Device D\n      OUTER APPLY\n          ( select top 1 *\n              FROM PerformanceCounterValues\n              where instance_id = D.pkid\n              order by collection_time desc\n           ) as tbl2\n</code></pre>\n\n<p>----- Solved ----</p>\n\n<p>Here is my final actual query, and it works in 0 seconds.  </p>\n\n<pre><code>SELECT pkid, D.IDDevice, D.IDHardware, H.IDRecorder, D.Name, D.Description, H.Name as HardwareName, H.URI, R.HostName, R.Name as RecorderInstance, tbl2.collection_time, tbl2.raw_value, tbl2.calculated_value\n  FROM [Surveillance].[dbo].[PerformanceCounterInstance] PCI\n  JOIN [Surveillance].[dbo].[Devices] D on D.IDDevice = (SELECT REPLACE(STUFF([instance_name],1,CHARINDEX('[',[instance_name]),''),']',''))\n  JOIN [Surveillance].[dbo].[Hardware] H on H.IDHardware = D.IDHardware\n  JOIN [Surveillance].[dbo].[Recorders] R on R.IDRecorder = H.IDRecorder\n    OUTER APPLY\n    ( select top 1 *\n        FROM [Surveillance].[dbo].[PerformanceCounterValue]\n        where instance_id = PCI.pkid\n        order by collection_time desc\n        ) as tbl2\n  where category_name = 'VideoOS Recording Server Device Storage'\n  and D.Enabled = 1\n</code></pre>\n\n<p>It was just setting up the index that made the speed increase.</p>\n"},{"tags":["sql-server","replace","sql-update"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":29,"score":-1,"question_id":13124220,"title":"Using replace in update","body":"<p>I have a table with Projects, in the description field I want to replace Char(10) with '' in a lot of records.</p>\n\n<p>I can replace it record by record manually like this:</p>\n\n<pre><code>UPDATE tblProjects\nSET    Description = (SELECT Replace(Description, Char(10), ' ')\n                      FROM   tblProjects\n                      WHERE  ( Description LIKE '%' + Char(10) + '%' )\n                             AND ProjectID = XAXD)\nWHERE  ( Description LIKE '%' + Char(10) + '%' )\n       AND ProjectID = XAXD\n</code></pre>\n\n<p>but would like a more generic solution like for foreach project and then have ProjectID as a variable.</p>\n"},{"tags":["sql-server","query","stored-procedures","join","outer-join"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13124004,"title":"How show datetime select only in Sql Server?","body":"<p>I need show <code>datetime</code> when I select datetime only. Because I try to run SQL but show all <code>datetime</code>.</p>\n\n<p>Table <code>Emp</code>:</p>\n\n<pre><code>EmpNo   fullName\n00001   Midna\n00002   Klog\n00003   Porla\n00004   Seka\n00005   Mila\n</code></pre>\n\n<p>Table <code>tFile</code>:</p>\n\n<pre><code>EmpNo   cDate                     cTime\n00001   2012-10-29 00:00:00.000   2012-10-29 07:52:00.000\n00001   2012-10-29 00:00:00.000   2012-10-29 19:00:00.000\n00002   2012-10-29 00:00:00.000   2012-10-29 07:40:00.000\n00002   2012-10-29 00:00:00.000   2012-10-29 19:32:00.000\n00005   2012-10-29 00:00:00.000   2012-10-29 07:58:00.000\n00005   2012-10-29 00:00:00.000   2012-10-29 18:35:00.000\n</code></pre>\n\n<p>This code</p>\n\n<pre><code>SELECT \n   em.EmpNo as 'EmpNo', \n   case \n       when tf.cDate &lt;&gt; null then tf.cDate \n            else coalesce(tf.cDate, '2012-10-29') \n   end as 'cDate', \n   Min(tf.cTime) as 'timeIn', \n   Max(tf.cTime) as 'timeOut'\nFROM \n   tFile tf \nFull Outer join \n   Emp em On tf.EmpNo = em.EmpNo\nGroup By \n   em.EmpNo,tf.cDate\nOrder By \n   'EmpNo'\n</code></pre>\n\n<p>returns this result:</p>\n\n<pre><code>EmpNo   cDate                     timeIn                     timeOut\n-------------------------------------------------------------------------------------\n00001   2012-10-21 00:00:00.000   2012-10-21 07:22:00.000    2012-10-21 17:35:00.000\n00001   2012-10-24 00:00:00.000   2012-10-24 07:30:00.000    2012-10-24 19:00:00.000\n00001   2012-10-29 00:00:00.000   2012-10-29 07:52:00.000    2012-10-29 19:00:00.000\n00002   2012-10-25 00:00:00.000   2012-10-25 07:58:00.000    2012-10-25 18:35:00.000\n00002   2012-10-22 00:00:00.000   2012-10-22 08:04:00.000    2012-10-22 17:55:00.000\n00002   2012-10-24 00:00:00.000   2012-10-24 08:00:00.000    2012-10-24 18:45:00.000\n00002   2012-10-29 00:00:00.000   2012-10-29 07:40:00.000    2012-10-29 19:32:00.000\n00003   2012-10-29 00:00:00.000   NULL                       NULL\n00004   2012-10-29 00:00:00.000   NULL                       NULL\n00005   2012-10-28 00:00:00.000   2012-10-28 07:30:00.000    2012-10-28 19:20:00.000\n00005   2012-10-27 00:00:00.000   2012-10-27 07:38:00.000    2012-10-27 19:30:00.000\n00005   2012-10-29 00:00:00.000   2012-10-29 07:58:00.000    2012-10-29 18:35:00.000\n</code></pre>\n\n<p>But I need this result:</p>\n\n<p>I select date ex. <code>2012-10-29</code> then I need to show all rows with <code>2012-10-29</code> only.</p>\n\n<p>But some <code>Empno</code> don't have data in <code>2012-10-29</code> it's set NULL.</p>\n\n<pre><code>EmpNo   cDate                     timeIn                     timeOut\n---------------------------------------------------------------------------------------\n00001   2012-10-29 00:00:00.000   2012-10-29 07:52:00.000    2012-10-29 19:00:00.000\n00002   2012-10-29 00:00:00.000   2012-10-29 07:40:00.000    2012-10-29 19:32:00.000\n00003   2012-10-29 00:00:00.000   NULL                       NULL\n00004   2012-10-29 00:00:00.000   NULL                       NULL\n00005   2012-10-29 00:00:00.000   2012-10-29 07:58:00.000    2012-10-29 18:35:00.000\n</code></pre>\n\n<p>Thanks for your time. :)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","select"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":57,"score":3,"question_id":13121094,"title":"Doing a comparison using the previous row?","body":"<p>I'm trying to work out an efficient way of comparing two rows in SQL Server 2008.  I need to write a query which finds all rows in the <code>Movement</code> table which have <code>Speed &lt; 10</code> N consecutive times.</p>\n\n<p>The structure of the table is:</p>\n\n<p>EventTime\nSpeed </p>\n\n<p>If the data were:</p>\n\n<pre><code>2012-02-05 13:56:36.980, 2\n2012-02-05 13:57:36.980, 11\n2012-02-05 13:57:46.980, 2\n2012-02-05 13:59:36.980, 2\n2012-02-05 14:06:36.980, 22\n2012-02-05 15:56:36.980, 2\n</code></pre>\n\n<p>Then it would return rows 3/4 (13:57:46.980 / 13:59:36.980) if I looked for 2 consecutive rows, and would return nothing if I looked for three consecutive rows.  The order of the data is EventTime/DateTime only.</p>\n\n<p>Any help you could give me would be great.  I'm considering using cursors but they're usually pretty inefficient.  Also, this table is approximately 10m rows in size, so the more efficient the better! :)</p>\n\n<p>Thanks!</p>\n"},{"tags":["c#",".net","sql-server","deployment","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":13046867,"title":"Setup and deployment .NET application with SQL Server Express database in Microsoft Visual Studio 2010?","body":"<p>I have searched a lot before posting my question here, but I could not find real answer which works for me.</p>\n\n<p>I have developed a WPF (C#) project which uses SQL Server Express database on my machine. I created my database in SQL Server Management Studio. Now I am connecting to my database using this string in my code.</p>\n\n<pre><code>public static SqlConnection conn = new SqlConnection(\"Server=\" + @\".\\\" +\n  \";Initial Catalog=Store;\" +\n  \"MultipleActiveResultSets=True;\" +\n  \"Integrated Security=False;\" +\n  \"User ID=\" + Login.login + \";\" +\n  \"Password=\" + Login.password + \";\"\n);\n</code></pre>\n\n<p>On first execution, a login window appears where users inputs their login and password saved in the <code>user</code> table of my database. If authentication is succesful , it connects to the MainWindow of my Project. My database is located in \n<code>C:\\Program Files (x86)\\Microsoft SQL Server\\MSSQL.1\\MSSQL\\Data</code></p>\n\n<p>How should I create a setup project in order to get users to install my project with a single click? I mean when they click to setup, it should deploy my project with my database. It should work on other machines like it is working in my machine. </p>\n\n<p>What are the steps? What should I do. Please bear in mind I am using Visual Studio 2010, and that my database is created in Sql Server Express 2008 using Management Studio. Should I show SQL Express 2008 in the prerequisites and what about instances? I am very confused now. </p>\n\n<p>Please do not provide me with reference which you did not check by yourself. I have tried many of them, they are not working for me.</p>\n"},{"tags":["sql-server","math"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13111191,"title":"distribute list to buckets by window or cycle for processing","body":"<p>In SQL Server I have a source list of id's that I want to re-order in a specific way for processing. My original table has a list of ids like 10,10,10,10,10,20,20,20,20,30,40,40,50,50,60 and a unique key associated with each one. They can be in any order. I want to distribute them to buckets by window or cycle so that they won't conflict. I'm familiar with the aggregate functions, I'm having trouble with the math to get it distributed. I could do it with a loop but for performance reasons I would like to do it in a single query if possible.</p>\n\n<p>I have a query to get a count and priority like</p>\n\n<pre><code>Count   Id  Priority\n5       10  1\n4       20  2\n2       40  3\n2       50  4\n1       30  5\n1       60  6\n</code></pre>\n\n<p>The # of buckets is arbitrary although decided ahead of time. If it was 3 I want id's 10,20,40 in the first cycle then 10,20,50 in the second cycle. If the bucket was 4 then 10,20,40,50 in first and 10,20,40,50 again in second. </p>\n\n<p>Another way for me to express the problem is I want to grab the first x from the new table by count, decrement the count and then grab the next x until exhausted.</p>\n\n<p>Took the solution suggested and re-wrote it but I'm still looking for a single sql query solution if possible.</p>\n\n<p>I've updated the suggested loop a bit which should be a little more optimized haven't yet updated it to my real workload</p>\n\n<pre><code>declare @bucket int, @b int, @maxrows int  \ndeclare @buckets table (fstrEntityHash varchar(100), bucket int)\ndeclare @count table (flngCount int, fstrEntityHash varchar(100))\ndeclare @bucketTemp table (fstrEntityHash varchar(100), bucket int)\n\nselect @bucket = 3, @maxrows = 20\n\ninsert into @count\nselect  COUNT(1) as flngCount, \n    fstrEntityHash\nfrom tblTest\ngroup by fstrEntityHash\norder by COUNT(1) desc\n\nset @b = 1\nwhile (1 = 1)\nbegin\ninsert into @bucketTemp\nselect top (@bucket) fstrEntityHash, @b\nfrom @count\nwhere   flngCount &gt; 0\norder by flngCount desc;\n\nif @@rowcount = 0\n   break\n\n update C\n set    C.flngCount -= 1\n from   @count C, @bucketTemp I\n where  C.fstrEntityHash = I.fstrEntityHash\n\ninsert into @buckets\nselect  * \nfrom        @bucketTemp\n\nif (select count(1) from @buckets) &gt;= @maxrows\n   break\n\n select @b = @b + 1\n delete from @bucketTemp\n\nend\n\nselect * from @buckets\n</code></pre>\n"},{"tags":["c#","sql","sql-server","sql-server-2008","sqlbulkcopy"],"answer_count":6,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":4505,"score":6,"question_id":2593689,"title":"How to prevent duplicate records being inserted with SqlBulkCopy when there is no primary key","body":"<p>I receive a daily XML file that contains thousands of records, each being a business transaction that I need to store in an internal database for use in reporting and billing.\nI was under the impression that each day's file contained only unique records, but have discovered that my definition of unique is not exactly the same as the provider's. </p>\n\n<p>The current application that imports this data is a C#.Net 3.5 console application, it does so using SqlBulkCopy into a MS SQL Server 2008 database table where the columns exactly match the structure of the XML records. Each record has just over 100 fields, and there is no natural key in the data, or rather the fields I can come up with making sense as a composite key end up also having to allow nulls. Currently the table has several indexes, but no primary key.</p>\n\n<p>Basically the entire row needs to be unique. If one field is different, it is valid enough to be inserted. I looked at creating an MD5 hash of the entire row, inserting that into the database and using a constraint to prevent SqlBulkCopy from inserting the row,but I don't see how to get the MD5 Hash into the BulkCopy operation and I'm not sure if the whole operation would fail and roll back if any one record failed, or if it would continue.</p>\n\n<p>The file contains a very large number of records, going row by row in the XML, querying the database for a record that matches all fields, and then deciding to insert is really the only way I can see being able to do this. I was just hoping not to have to rewrite the application entirely, and the bulk copy operation is so much faster.</p>\n\n<p>Does anyone know of a way to use SqlBulkCopy while preventing duplicate rows, without a primary key? Or any suggestion for a different way to do this?</p>\n"},{"tags":[".net","sql-server","setup-project"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13123184,"title":"sql server installation during running setup","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4890970/free-installer-that-can-install-prequisites-net-framework-sql-server\">Free installer that can install prequisites (.net framework, sql server)</a>  </p>\n</blockquote>\n\n\n\n<p>My project is in visual studio 2010.</p>\n\n<p>I am going to create custom action based setup project.</p>\n\n<p>But i want that in custom action SQl server installation will be done only when i say yes to sql server installation.and also to be installed silently. Also i should get the status whether it is successfully installed or not, because i have to restore database on that installed instance. </p>\n\n<p>In windows two msi installer not works together.so please let me know how can i achieve this.</p>\n"},{"tags":["sql-server","synchronization","free","compare"],"answer_count":11,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":6077,"score":8,"question_id":3422771,"title":"SQL Server database compare and sync tool (Free)","body":"<p>Looking for a free and best tool to compare and sync two SQL Server databases. I've searched in stackoverflow for the compare tools but most of them are buy only. Basically this tool will be used for non-commercial use and for developer only. </p>\n\n<p>Can anybody suggest tool used by them and it is free?</p>\n"},{"tags":["c#","sql-server","multithreading","sockets","client"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":1,"view_count":75,"score":3,"question_id":13121531,"title":"Multi Client Server - common way for 2 way connection in","body":"<p>I just want to know how the proper way of doing 2 way connection with one socket is (C#).</p>\n\n<p>I need the client sending and also receiving data from the server without to open the port on the client-pc / router.</p>\n\n<p>The server will be a multiplayer game server and the clients should not extra open a port to play the game.</p>\n\n<p>So does a simple socket connection work in 2 ways (server has a socket listener, and client connects to the server socket)?</p>\n\n<p>Hope that text pretty much explains my question.</p>\n"},{"tags":["sql","sql-server","sqlprofiler"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13122202,"title":"SQL Server Profiler, ObjectName column, 'Split'","body":"<p>What is the meaning of <code>ObjectName</code> column in SQL Server Profiler?</p>\n\n<p>This <a href=\"http://msdn.microsoft.com/en-us/library/aa173882(v=sql.80).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/aa173882(v=sql.80).aspx</a> gives rather concise definition.</p>\n\n<p>For the records that are interesting to me it's either blank -- when executing statement -- or it contains a stored procedure name. But I just recently noticed that it might also contain 'Split' as a value.</p>\n\n<p>What is the meaning of such a record (entry in Profiler) then?</p>\n"},{"tags":["sql-server","ssas"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13122496,"title":"Tabular mode disabled during SSAS installation","body":"<p>I am trying to install SSAS in Tabular Mode. However, i find that the radio button is disabled. I am installing it on a separate instance as well. The regular Multidimensional SSAS  had been installed first.I am installing Standard SQL server .<img src=\"http://i.stack.imgur.com/k6VVn.png\" alt=\"enter image description here\"> . </p>\n"},{"tags":["sql","sql-server","netezza"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":13086194,"title":"Grouping and Dividing Netezza","body":"<p>I have the following query that divides each row in the sum(rev) column by the sum of the column.</p>\n\n<p>For the following example the sum of sum(rev) column is 23193.The Divide column is derived by : row in sum(rev)/sum(rev)</p>\n\n<pre><code>select date,id,sum(rev), \nNULLIF(rev,0) / sum(rev) over() as Divide\nfrom test \nwhere month(date) = 11\nand year(date) = 2012\nand day(date) = 02\nand id = 'Client1'\ngroup by date,id,rev\nhaving sum(rev) &lt;&gt; 0\norder by date\n\n\ndate                  id      sum(rev)      Divide\n\n2012-11-02 00:00:00 Client1     1562.00     0.067348\n2012-11-02 00:00:00 Client1     1.00        0.000043\n2012-11-02 00:00:00 Client1     4689.00     0.202173\n2012-11-02 00:00:00 Client1     267.00      0.011512\n2012-11-02 00:00:00 Client1     16674.00    0.718924\n</code></pre>\n\n<p>There are 2 problems </p>\n\n<p>1.) When the day(date) condition is commented the values retrieved are wrong.It does not give the correct value in the Divide Computation</p>\n\n<pre><code>    date               sum(rev)         Divide\n    2012-11-02 00:00:00 1.00            0.000002\n    2012-11-02 00:00:00 267.00          0.000412\n    2012-11-02 00:00:00 1562.00         0.002412\n    2012-11-02 00:00:00 4689.00         0.007241\n    2012-11-02 00:00:00 16674.00        0.025749\n</code></pre>\n\n<p>2.) I want to group by date.So since we have records only for 2-11-2012 there must be only one line of record for each day</p>\n\n<p>Please help fix these two errors</p>\n\n<p>Ref: <a href=\"http://stackoverflow.com/questions/12939227/find-column-value-by-dividing-with-sum-of-a-column\">Find column Value by dividing with sum of a column</a></p>\n"},{"tags":["sql-server"],"answer_count":4,"favorite_count":4,"up_vote_count":17,"down_vote_count":0,"view_count":48280,"score":17,"question_id":1589466,"title":"SQL Server - Execute Stored Procedure with Output Parameter?","body":"<p>I have a stored procedure that I am trying to test. I am trying to test it through SQL Management Studio. In order to run this test I enter</p>\n\n<p>exec my_stored_procedure 'param1Value', 'param2Value'</p>\n\n<p>The final parameter is an output parameter. However, I do not know how to test a stored procedure with output parameters. How do I run a stored procedure with an output parameter?</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13122318,"title":"How to store complex records for referencing historical revisions?","body":"<p>I have a table on my database that outlines complex processes in a <a href=\"http://en.wikipedia.org/wiki/Work_breakdown_structure\" rel=\"nofollow\">work breakdown structure</a> (similar to what's used to create Gantt charts).  There are multiple rows for a particular process, each row outlining a hierarchical step of a particular process.  </p>\n\n<p>I then have a table with some product types, each being linked to a particular process.  When an order for a particular product is placed - it is to be manufactured with the associated process.  </p>\n\n<p>In my situation, the processes can be dynamic (steps added or removed, for example).  </p>\n\n<p>I'm curious as to what the best way to capture current and historical revisions of each process is, such that even though a process may have evolved over time - I can historically go back to a particular order and determine what the process looked like at that time.  </p>\n\n<p>I'm sure there are multiple ways to go about this, using logging or triggers with a new history table - but I've had no experience doing something like this and I'd like to know what worked well for others.  </p>\n"},{"tags":["sql-server","sql-server-2005","sorting","natural-sort"],"answer_count":15,"favorite_count":10,"up_vote_count":19,"down_vote_count":0,"view_count":13080,"score":19,"question_id":34509,"title":"Natural (human alpha-numeric) sort in Microsoft SQL 2005","body":"<p>We have a large database on which we have DB side pagination. This is quick, returning a page of 50 rows from millions of records in a small fraction of a second.</p>\n\n<p>Users can define their own sort, basically choosing what column to sort by.  Columns are dynamic - some have numeric values, some dates and some text.</p>\n\n<p>While most sort as expected text sorts in a dumb way. Well, I say dumb, it makes sense to computers, but frustrates users.</p>\n\n<p>For instance, sorting by a string record id gives something like:</p>\n\n<pre><code>rec1\nrec10\nrec14\nrec2\nrec20\nrec3\nrec4\n</code></pre>\n\n<p>...and so on.</p>\n\n<p>I want this to take account of the number, so:</p>\n\n<pre><code>rec1\nrec2\nrec3\nrec4\nrec10\nrec14\nrec20\n</code></pre>\n\n<p>I can't control the input (otherwise I'd just format in leading 000s) and I can't rely on a single format - some are things like \"{alpha code}-{dept code}-{rec id}\".</p>\n\n<p>I know a few ways to do this in C#, but can't pull down all the records to sort them, as that would be to slow.</p>\n\n<p>Does anyone know a way to quickly apply a natural sort in Sql server?</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13121831,"title":"Foreign Key Constraint 5","body":"<p>I have two tables in my database. <code>TableOne</code> has <code>theKey</code> primary key. <code>TableTwo</code> has a foreign key <code>theKey</code> that refers to the corresponding column in the <code>TableOne</code>. Now I am trying to update <code>theKey</code> in <code>TableTwo</code>:</p>\n\n<pre><code>  UPDATE TableTwo\n  SET theKey = NewIk\n  FROM TableTwo W\n  JOIN TableThree D ON W.theKey_backup = D.OldIk\n  WHERE dt &gt;= '2012-05-01'\n</code></pre>\n\n<p>But I receive the following error:</p>\n\n<blockquote>\n  <p>The UPDATE statement conflicted with the FOREIGN KEY constraint\n  \"FK_TableTwo_TableOne\". The conflict occurred in database \"MyDB\",\n  table \"dbo.TableOne\", column 'theKey'.</p>\n</blockquote>\n\n<p>Could you please explain why I get this error if I don't touch the <code>TableOne</code>?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","stored-procedures","insert-update","column-store-index"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13117478,"title":"SQL Server columnstore index update/insert in stored procedure","body":"<p>I was having fun testing out the columnstore index feature of sql server 2012. Because you can't update/insert tables with such indices I read on some options: keep a separate table and use a new partition for every bulk insert or disable the index, perform updates/inserts and then rebuild the index.</p>\n\n<p>For my test I chose the latter option and ended up with this stored procedure:</p>\n\n<pre><code>-- Disable the columnstore index.\nALTER INDEX [All_Columns_Columnstore_Index] ON [dbo].[Tick] DISABLE\n\n-- Insert data into tick table from staging table.\ninsert into Tick\nselect [Date],\n       SymbolID,\n       Price\nfrom TickTemporary\n\n-- Delete data from staging table.\ndelete from TickTemporary\n\n-- Enable (rebuild) the columnstore index.\nALTER INDEX [All_Columns_Columnstore_Index] ON [dbo].[Tick] REBUILD\n</code></pre>\n\n<p>If I execute these lines manually everything works fine. But if I run the procedure, I get the error that updates/inserts can't be performed on a table that has a columnstore index. </p>\n\n<p>Why is this?</p>\n\n<p>Update:</p>\n\n<p>I followed the advice in the answer I previously accepted but I still get the same thing.</p>\n\n<pre><code>-- SET NOCOUNT ON added to prevent extra result sets from\n-- interfering with SELECT statements.\nSET NOCOUNT ON;\n\n-- Disable the columnstore index.\nEXEC DisableColumnStoreIndex\n\n-- Insert data into tick table from staging table.\ninsert into Tick\nselect [Date],\n       SymbolID,\n       Price\nfrom TickTemporary\n\n-- Delete data from staging table.\ndelete from TickTemporary\n\n-- Enable (rebuild) the columnstore index.\nEXEC RebuildColumnStoreIndex\n</code></pre>\n\n<p>Even tried placing \"begin tran\" and \"commit tran\" around the sproc calls.</p>\n\n<p>Using dynamic sql like:</p>\n\n<pre><code>declare @sql nvarchar(max)\nset @sql =\n    'insert into Tick\n     select [Date],\n            SymbolID,\n            Price\n     from TickTemporary'\nexec(@sql)\n</code></pre>\n\n<p>works, but really, I want to get by without dynamic sql. Isn't it possible in this case?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":11,"score":-3,"question_id":13121453,"title":"How to use log shipping in database","body":"<p>we want to take backup of database from one server and restore on other for this we want to use log shipping.\nI don't know how to use it and what access rights user need on the server to do log shipping.\nCould you please let me know what step by step procedure involved to do the same.\nThanks in advance</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13121088,"title":"SQL sub query select doubts","body":"<p>LogTable in SQL Server</p>\n\n<pre><code>timestamp                  user_name     session_id\n2012-10-17 06:30:10        Sanjay        034A955F\n2012-10-17 06:30:20        Sanjay        034A955F\n2012-08-20 13:20:59        John          0547961A \n2012-08-20 13:21:05        John          0547961A \n2012-08-20 13:22:10        John          0547961A \n2012-10-17 04:02:10        John          0977661B \n</code></pre>\n\n<p>Desired output</p>\n\n<pre><code>user       Total_login      This_Month_Login   Recent_Login  \nSanjay     2                2                  2012-10-17 06:30:10 \nJohn       4                1                  2012-10-17 04:02:10 \n</code></pre>\n\n<p>I tried to write SQL SELECT query to get above output but I am not good in SQL so couldn't take it ahead and wrote only for 2 columns. Can you please help me to get above select output?</p>\n\n<pre><code>select user_name as 'User', count (distinct session_id) as 'Total_Login' \nfrom \"LogTable\" \ngroup by user_name\n</code></pre>\n"},{"tags":["sql-server","ruby","linux","freetds","isql"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":2337,"score":1,"question_id":8010361,"title":"FreeTDS - tsql connects, isql fails","body":"<p>I'm trying to connect to a database on my host machine (windows xp, sql server 05).  My guest machine is Ubuntu 10.04.  I can connect and execute commands with tsql, but isql fails. Below are my config files and error messages.</p>\n\n<p>freetds.conf</p>\n\n<pre><code>text size = 64512\n\n[SQLEXPRESS]\nhost = 192.168.163.1\nport = 1433\ntds version = 7.0\n</code></pre>\n\n<p>odbcinst.ini</p>\n\n<pre><code>[FreeTDS]\nDescription     = TDS driver (Sybase/MS SQL)\nDriver          = /usr/lib/odbc/libtdsodbc.so\nSetup           = /usr/lib/odbc/libtdsS.so\nCPTimeout       =\nCPReuse         =\nFileUsage       = 1\n</code></pre>\n\n<p>odbc.ini</p>\n\n<pre><code>[SQLEXPRESS]\nDriver          = FreeTDS\nDescription     = ODBC connection via FreeTDS\nTrace           = No\nServername  = 192.168.163.1\nDatabase        = SCOPE_Peel\nPort        = 1433\nUID         = sa\nPWD         = test1234\nReadOnly    = No\n</code></pre>\n\n<p>tsql:</p>\n\n<pre><code>tsql -S SQLEXPRESS  -U sa\n#success\n</code></pre>\n\n<p>isql:</p>\n\n<pre><code>isql SQLEXPRESS sa test1234 -v\n[S1000][unixODBC][FreeTDS][SQL Server]Unable to connect to data source\n[ISQL]ERROR: Could not SQLConnect\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2000"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":64,"score":1,"question_id":13111668,"title":"How to order the numbers?","body":"<p>Table1</p>\n\n<pre><code>id value\n---------    \n 1  100\n2A  200\n 2  300\n10  500\n 8  200\n....\n\nSelect * \nfrom table1 \norder by id\n</code></pre>\n\n<p>Showing output as</p>\n\n<pre><code>id value\n------------    \n 1 100\n10 500\n2A 200\n 2 300\n 8 200\n....\n</code></pre>\n\n<p>How to make a proper order?</p>\n\n<p>Expected output</p>\n\n<pre><code>id value\n----------\n 1 100\n 2 300\n2A 200\n 8 200\n10 500\n....\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":13119925,"title":"Find out the number of Days and nights using sql query","body":"<p>I have a situation like find out the number of days and nights in a given Date range in sql can anyone help me..\nthanks in advance </p>\n"},{"tags":["c++","c","sql-server","middleware"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13121107,"title":"getting mssql queries by writing a middleware","body":"<p>Can anyone please show me the right direction for writing a middleware for mssql server. What I want to do is setup a listener on the mssql 1433 tcp port which will accepts db connections, extract the query and write it on file and forward the connection to a real mssql server on another IP or the same for processing.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server","tsql","header"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":8329,"score":1,"question_id":4964162,"title":"How to add table column headings to sql select statement","body":"<p>I have a SQL select statement like this:</p>\n\n<pre><code>select FirstName, LastName, Age from People\n</code></pre>\n\n<p>This will return me something like a table:</p>\n\n<pre><code>Peter  Smith    34\nJohn   Walker   46\nPat    Benetar  57\n</code></pre>\n\n<p>What I want is to insert the column headings into the first row like:</p>\n\n<pre><code>First Name  Last Name  Age\n=========== ========== ====\nPeter       Smith      34\nJohn        Walker     46\nPat         Benetar    57\n</code></pre>\n\n<p>Can someone suggest how this could be achieved?</p>\n\n<p>Could you maybe create a temporary table with the headings and append the data one to this?</p>\n"},{"tags":["sql-server","sql-server-2005","query"],"answer_count":7,"favorite_count":5,"up_vote_count":10,"down_vote_count":0,"view_count":8039,"score":10,"question_id":235515,"title":"Hierarchical Queries in SQL Server 2005","body":"<p>Way back when I was working in an Oracle shop I took the CONNECT_BY for granted.  Now I'm stuck working with SQL Server 2005 and have some nasty object hierarchies.  Specifically, we have a self referencing table where all child records have a column with their parent's id.  Currently we have a view that maps children to levels in the hierarchy and a nasty query that does the heavy lifting to connect parents with their children.  While this method works, it is far from elegant and reeks of taint.  I'm just curious how other people retrieve hierarchical data from SQL Server 2005.</p>\n"},{"tags":["sql-server","editor","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":40,"score":3,"question_id":13118589,"title":"Can I define #regions in the visual studio 2012 t-sql editor?","body":"<p>I would like to know if there is an extension that allows me to define regions inside the visual studio 2012 editor while editing user defined functions or plain t-sql queries.</p>\n\n<p>I've tried the following but it doesn't seem to do much:</p>\n\n<pre><code>-- #region This is a region with t-sql code\n   ...\n-- #endregion\n</code></pre>\n"},{"tags":["android","sql-server","json"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13120461,"title":"Android JSON Communication","body":"<p>I had developed a android project which get data from MS-SQL.I used ksop and gson jar files to send and revise data from sql.The project is working fine.\n              But i want to know that  Is there any single jar file which help the communication more easier and help to avoid the usage of this two jar files\n                Any one with ideas please share.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13072021,"title":"Slow running query on my machine only","body":"<p>I'm running a simple <strong><code>select * from table</code></strong> query against Microsoft SQL Server 2005. The table has about 41000 records with a PK clustered index and I'm using windows integrated authentication.</p>\n\n<ul>\n<li><p>When I run this on my machine using Microsoft SQL Server Management Studio the query completes in about 1h45m. I have tried swithing from grid to text output, running it from command line using <code>SQLCMD</code> also tried ececuting <code>DBCC USEROPTIONS</code>, <code>DBCC DROPCLEANBUFFERS</code>, <code>DBCC FREEPROCCACHE</code> prior the query... nothing changed the speed of the query.</p></li>\n<li><p>When I run it from coleague workstation using my credentials the query completes normaly in no time. If a coleague runs the query on my workstation using their credentials the query is very slow as described above.</p></li>\n</ul>\n\n<p>I'm running out of ideas how to troubleshoot this problem. Somehow the problem seem to be linked to my machine, but I can not make sense out of it. Please also consider the following:</p>\n\n<ul>\n<li>I checked and made sure ODBC tracing is not enabled on my machine (Win7-64bit). I have installed SQL Server client tools with Microsoft Management Studio 2008 R2 and this is what I'm using to query the database.</li>\n<li>I also used VS2010 to run the same sql query and the result is identical.</li>\n<li>I run the query against copy of the same table/database but on a different server and the issue persists.</li>\n<li>When I run <strong><code>select count(*) from table</code></strong> - the query completes normaly with no delay.</li>\n<li>When I run a trace with SQL Server Profiler the query is just a long running query - I can not see anything abnormal.</li>\n<li>When I run the query in MS SQL Server Management Studio using text out put I can see after the initial buffer of about 85 records the subsequent records arrive in bulk of about 400 records at a time. For example 85 -> 407 -> 804 -> 1210 -> 1605 -> 1897 -> 2161 -> 2753 -> 3051 -> 3342 -> 3676 -> 4002 etc. In comparison of the coleagues workstation where you can see the records painted as continuous stream as the data arrives!???</li>\n<li>I also compared the actual Query Execution Plans on my machine and the other where the query is running normally - they appear to be identical.</li>\n</ul>\n\n<p>Could anyone make sense what could be going wrong here? Why running this from my machine is very slow but it executes normally from another workstation?... \nAny suggested actions steps to troubleshoot this problem?</p>\n\n<p>Thanks to everyone in advance!</p>\n"},{"tags":["c#","asp.net","sql","sql-server","duplicates"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":120,"score":1,"question_id":13052403,"title":"How duplicate entries be prevented while using SqlBulkCopy?","body":"<p>I am importing excel data into sql server using SqlbulkCopy, but the problem is i want to prevent any duplicate records being entered. Is there a way  by which duplicate can be ignored or deleted automatically?</p>\n\n<pre><code>protected void Button1_Click(object sender, EventArgs e)\n{\n    string strFileType = System.IO.Path.GetExtension(FileUpload1.FileName).ToString().ToLower();\n    string strFileName = FileUpload1.PostedFile.FileName.ToString();\n\n    FileUpload1.SaveAs(Server.MapPath(\"~/Import/\" + strFileName + strFileType));\n    string strNewPath = Server.MapPath(\"~/Import/\" + strFileName + strFileType);\n\n    string excelConnectionString = String.Format(@\"Provider=Microsoft.Jet.OLEDB.4.0;\" + \"Data Source=\" + strNewPath + \"; Extended Properties=Excel 8.0;\");\n\n    // Create Connection to Excel Workbook\n    using (OleDbConnection connection = new OleDbConnection(excelConnectionString))\n    {\n        var command = new OleDbCommand(\"Select ID,Data FROM [Sheet1$]\", connection);\n\n        connection.Open();\n\n        // Create DbDataReader to Data Worksheet\n        using (DbDataReader dr = command.ExecuteReader())\n        {\n            // SQL Server Connection String\n            string sqlConnectionString = \"Data Source=ARBAAZ-1B14C081;Initial Catalog=abc;Integrated Security=True\";\n\n            con.Open();\n            DataTable dt1 = new DataTable();\n            string s = \"select count(*) from ExcelTable\";\n            string r = \"\";\n            SqlCommand cmd1 = new SqlCommand(s, con);\n\n            try\n            {\n                SqlDataAdapter da1 = new SqlDataAdapter(cmd1);\n                da1.Fill(dt1);\n            }\n            catch\n            {\n            }\n\n            int RecordCount;\n            RecordCount = Convert.ToInt32(cmd1.ExecuteScalar());\n            r = RecordCount.ToString();\n            Label1.Text = r;\n            con.Close();\n            int prv = Convert.ToInt32(r);\n\n            // Bulk Copy to SQL Server\n            using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n            {\n                bulkCopy.DestinationTableName = \"ExcelTable\";\n\n                SqlBulkCopyColumnMapping mapping1 = new SqlBulkCopyColumnMapping(\"excelid\", \"id\");\n                SqlBulkCopyColumnMapping mapping2 = new SqlBulkCopyColumnMapping(\"exceldata\", \"data\");\n\n                bulkCopy.ColumnMappings.Add(mapping1);\n                bulkCopy.ColumnMappings.Add(mapping2);\n\n                bulkCopy.WriteToServer(dr);\n            }\n\n            con.Open();\n\n            DataTable dt = new DataTable();\n            s = \"select count(*) from ExcelTable\";\n            r = \"\";\n            SqlCommand cmd = new SqlCommand(s, con);\n\n            try\n            {\n                SqlDataAdapter da = new SqlDataAdapter(cmd);\n                da.Fill(dt);\n            }\n            catch\n            {\n            }\n\n            RecordCount = Convert.ToInt32(cmd.ExecuteScalar());\n            r = RecordCount.ToString();\n            Label1.Text = r;\n            con.Close();\n            int ltr = Convert.ToInt32(r);\n\n            if (prv == ltr)\n            {\n                Label1.Text = \"No records Added\";\n            }\n            else\n            {\n                Label1.Text = \"Records Added Successfully !\";\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Can this problem be fixed by creating a trigger to delete duplicates? if yes how? i am a newbie i have never created a trigger.</p>\n\n<p>Another problem is no matter what i try i am unable to get column mapping to work. I am unable to upload data when column names in excel sheet and database are different.</p>\n"},{"tags":["c#","asp.net","sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":73,"score":-1,"question_id":13119847,"title":"Formatting date in date which is being read from excel?","body":"<p>I am importing excel sheet into sql server db table the excelsheet has :\nid|data(which is date in mm/dd/yyyy)\ni am able to upload the data into db table but i want the date to be covnerted into yyyy/mm/dd before sending it to database. I tried a piece of code but it did not work</p>\n\n<pre><code>        DataTable dt7 = new DataTable();\n        dt7.Load(dr);\n        DataRow[] ExcelRows = new DataRow[dt7.Rows.Count];\n        // Bulk Copy to SQL Server\n        using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n        {\n            bulkCopy.DestinationTableName = \"ExcelTable\";\n\n            dt7.Rows.CopyTo(ExcelRows, 0);\n\n            for (int i = 0; i &lt; ExcelRows.Length; i++)//i represents the row\n            {\n                var oldDate = ExcelRows[i][\"data\"].ToString();\n                var newDate = Convert.ToDateTime(oldDate);\n\n                ExcelRows[i][\"data\"] = newDate.ToString(\"yyyy/MM/dd\");\n            }\n\n            bulkCopy.WriteToServer(ExcelRows);\n</code></pre>\n\n<p>ERROR:String was not recognized as a valid DateTime.\ni have tried all 3 datatypes in database nvarchar,varchar,datetime. Same error</p>\n"},{"tags":["sql","sql-server","restore"],"answer_count":7,"favorite_count":1,"up_vote_count":12,"down_vote_count":0,"view_count":31370,"score":12,"question_id":3037682,"title":"Restore DB  Error RESTORE HEADERONLY is terminating abnormally. ","body":"<p>I have taken backup of SQL Server 2008 DB on server, and download them to local environment.</p>\n\n<p>I am trying to restore that database and it is keep on giving me following error.</p>\n\n<blockquote>\n  <hr>\n  \n  <p>An exception occurred while executing\n  a Transact-SQL statement or batch.\n  (Microsoft.SqlServer.ConnectionInfo)</p>\n  \n  <p>------------------------------ ADDITIONAL INFORMATION:</p>\n  \n  <p>The media family on device\n  'C:\\go4sharepoint_1384_8481.bak' is\n  incorrectly formed. SQL Server cannot\n  process this media family. RESTORE\n  HEADERONLY is terminating abnormally.\n  (Microsoft SQL Server, Error: 3241)</p>\n  \n  <p>For help, click:\n  <a href=\"http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=09.00.4053&amp;EvtSrc=MSSQLServer&amp;EvtID=3241&amp;LinkId=20476\" rel=\"nofollow\">http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=09.00.4053&amp;EvtSrc=MSSQLServer&amp;EvtID=3241&amp;LinkId=20476</a></p>\n</blockquote>\n\n<p>I have tried to create a temp DB on server and tried to restore the same backup file and that works.  I have also tried no. of times downloading file from server to local pc using different options on Filezila (Auto, Binary)</p>\n\n<p>But its not working.  After that I tried to execute following command on server.</p>\n\n<pre><code>BACKUP DATABASE go4sharepoint_1384_8481 \nTO DISK=' C:\\HostingSpaces\\dbname_jun14_2010_new.bak' with FORMAT\n</code></pre>\n\n<p>It is giving me following error:</p>\n\n<blockquote>\n  <p>Msg 3201, Level 16, State 1, Line 1 Cannot open backup device\n  'c:\\Program Files\\Microsoft SQL\n  Server\\MSSQL10.SQLEXPRESS\\MSSQL\\Backup\\\n  C:\\HostingSpaces\\dbname_jun14_2010_new.bak'. Operating system error\n  123(The filename, directory name, or volume label syntax is\n  incorrect.). Msg 3013, Level 16, State 1, Line 1 BACKUP DATABASE is\n  terminating abnormally.</p>\n</blockquote>\n\n<p>After researching I found the following 2 useful links: </p>\n\n<ol>\n<li><a href=\"http://support.microsoft.com/kb/290787\" rel=\"nofollow\">http://support.microsoft.com/kb/290787</a></li>\n<li><a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlsetupandupgrade/thread/4d5836f6-be65-47a1-ad5d-c81caaf1044f\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/sqlsetupandupgrade/thread/4d5836f6-be65-47a1-ad5d-c81caaf1044f</a></li>\n</ol>\n\n<p>But I am still not able to restore Database correctly.</p>\n\n<p>Any help would be much appreciated.  Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":481,"score":2,"question_id":2732356,"title":"List of all tables with a relationship to a given table or view","body":"<p>In SQL Server is there a command to return a list of all tables with a relationship to a given table or view?</p>\n\n<p>EDIT: SQL SERVER 2008</p>\n"},{"tags":["c#","asp.net","sql-server","authorization","windows-authentication"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":127,"score":0,"question_id":13119692,"title":"ASP.NET C# Authentication Autorization","body":"<p>I am as a study project developed a website in ASP.net. In my web.config file i have autheticaion mode as windows. and i am using an <code>appsettings</code> connection string to connect to my SQL2005 database.\nNow i want to know what kind of authentication is this?\nIs this windows? forms? or anonymous authentication?</p>\n\n<p>I have user table in sql 2005 and my first screen is login page. Obviously this user table has login details like username and password which will be matched to user input.</p>\n\n<p>I dont understand i have read so many post on authorization and authienticaion but please clear me on this. Thanks in advance. </p>\n"},{"tags":["sql","sql-server"],"answer_count":9,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":6873,"score":1,"question_id":116888,"title":"Like in CASE statement not evaluating as expected","body":"<p>Given this data:</p>\n\n<pre><code>CREATE TABLE tmpTable(\nfldField varchar(10) null);\n\nINSERT INTO tmpTable\nSELECT 'XXX'\nUNION ALL \nSELECT 'XXX'\nUNION  ALL\nSELECT 'ZZZ'\nUNION  ALL\nSELECT 'ZZZ'\nUNION  ALL\nSELECT 'YYY'\n\nSELECT\nCASE WHEN fldField like 'YYY' THEN 'OTH' ELSE 'XXX' END AS newField\nFROM tmpTable\n</code></pre>\n\n<p>The expected resultset is:<br />\nXXX<br />\nXXX<br />\nXXX<br />\nXXX<br />\nOTH  </p>\n\n<p>What situation would casue SQL server 2000 to NOT find 'YYY'?  And return the following as the resultset:<br />\nXXX<br />\nXXX<br />\nXXX<br />\nXXX<br />\nXXX  </p>\n\n<p>The problem is with the like 'YYY', I have found other ways to write this to get it to work, but I want to know why this exact method doesn't work.  Another difficulty is that it works in most of my SQL Server 2000 environments.  I need to find out what is different between them to cause this.  Thanks for your help.</p>\n"},{"tags":["sql-server","bulkinsert","trim"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13117692,"title":"Trim Empty Space Before Bulk Insert","body":"<p>How to I trim empty space when doing bulk insert? I have the sample data as below:</p>\n\n<pre><code>| |100  |4000009|1000 |01    |                                   |201004471|          |28.01.1972|10.04.2012|300485|ABC 307.07B            |01   |                         |          |SSC |SSC  |CA02      |00   |      |0       |SESC    |COM  |01      |01   |00.00.0000|00.00.0000|FR1  |\n</code></pre>\n"},{"tags":["sql-server","ssas","xmla"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":13,"score":1,"question_id":13119574,"title":"Finding Microsoft.AnalysisServices.Xmla dll in SQL Server 2008 R2","body":"<p>I'm not able to find <strong>Microsoft.AnalysisServices.XMLA.dll</strong> that I need to import</p>\n\n<pre><code>using Microsoft.AnalysisServices.Xmla;\n</code></pre>\n\n<p>I have found some articles and answered questions for SQL Server 2005 and 2012. But nothing works for me in the 2008 R2 version. My SQL Server/Analysis services is installed with all features enabled as far as I can tell and still there is no dll with the name I want anywhere on my computer. I don't need a redistributable solution because all computers using this product will have a full SSAS installation on them.</p>\n\n<p>This thread adresses the same problem but without any useable answer: <a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlanalysisservices/thread/84f06276-208a-48e8-be88-b6bdc24406d6\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/sqlanalysisservices/thread/84f06276-208a-48e8-be88-b6bdc24406d6</a></p>\n\n<p>Do I need to install something extra or did I miss it in some way? No it is not in \\windows\\assembly\\gac_msil\\microsoft.analysisservices.xmla.dll as the reply in the above forum post suggests.</p>\n\n<p>Any help will be greatly appreciated.</p>\n"},{"tags":["c#","sql-server","linq-to-sql","composite-primary-key"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":13107129,"title":"Table name as part of primary key","body":"<p>I have an audit trailing system in my project from <a href=\"http://doddleaudit.codeplex.com/\" rel=\"nofollow\">http://doddleaudit.codeplex.com/</a>. \nAs you can see on this image it records the <strong>EntityTable</strong> - which is the table name, and the <strong>EntityTableKey</strong> - which is the primary key <img src=\"http://i.stack.imgur.com/vfvrI.png\" alt=\"enter image description here\"></p>\n\n<p>I would like to associate the audit records with the tables it had recorder, then query the result in linq to sql. But the problem is if the audit table has record for <strong>orders</strong> and record for <strong>products</strong> it will never know just by the primary key, where does the record belong, thus i need to use the table name as part of the key. </p>\n\n<p>So the question is: Is it possible to create a relation that will have a composite primary key that contains the table name in it?</p>\n\n<pre><code>AuditRecord to Orders\nAuditRecord to Products\n</code></pre>\n"},{"tags":["c#",".net","sql","sql-server","null"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":13118997,"title":"Checking if column allows null values, C#?","body":"<p>How do I check if a specified column allows null values or not?</p>\n\n<p>I'm using the following code to print all the columns, but I also want to print if the column allows null values:</p>\n\n<pre><code>cnn = new SqlConnection(connetionString);\ncnn.Open();\n\nSqlCommand myCommand = new SqlCommand(\"select * from \" + tableName, cnn);\nSqlDataAdapter da = new SqlDataAdapter(myCommand);\nDataSet ds = new DataSet();\n\nda.Fill(ds, tableName);\n\nforeach (DataColumn dc in ds.Tables[0].Columns)\n{\n     // Print stuff here, dc.ColumnName is the column name\n}\n</code></pre>\n\n<p>The DataColumn.allowDBnull property doesn't seem to work when getting a predefined table, it's always set to true, even in columns that doesn't allow nulls.</p>\n\n<p>Thanks for your time!</p>\n"},{"tags":["mysql","sql-server","ms-access"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13118854,"title":"MySQL or MSSQL as backend for Access database?","body":"<p>A client wants me to migrate his (very big) Microsoft Access database to a SQL server, keeping Access as the frontend. They have many users already and performance issues are getting worse.</p>\n\n<p>Now, which SQL server would be most appropriate?</p>\n\n<p><code>MySql</code>: I have many years experience with MySQL and consider myself an expert, although not in connection with Access. Being free, MySQL is also attractive to my client.</p>\n\n<p><code>MSSQL</code>: I was once very experienced with MSSQL but it was 12 years ago or more. Much has happened since. But being a Microsoft product, I figure that data migration to the SQL server and use with Access in general might be somewhat more streamlined, which could perhaps compensate for the lack of (recent) experience with the product.</p>\n\n<p>So, how is it working with MySQL as a backend for Access as opposed to MSSQL? Should I count on major obstacles that would work increase the time needed for the migration considerably or would my great experience with MySQL more than compensate for such obstacles?</p>\n"},{"tags":["sql","sql-server","query","stored-procedures","full-outer-join"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13118578,"title":"How can I use full outer join?","body":"<p>I need use join 2 table show all data.</p>\n\n<p><strong>Exam</strong></p>\n\n<p><strong>Table Contact</strong></p>\n\n<pre><code>numCode | fullName\n00001   | Midna \n00002   | Klog\n00003   | Porla\n00004   | Seka\n00005   | Mila\n</code></pre>\n\n<p><strong>Table dateFile</strong></p>\n\n<pre><code>numCode | dateCurr\n00001   | 2012-10-29 00:00:00.000\n00002   | 2012-10-29 00:00:00.000\n00005   | 2012-10-29 00:00:00.000\n</code></pre>\n\n<p><strong>Code Sql Server</strong></p>\n\n<pre><code>SELECT df.numCode as 'numCode', tf.dateCurr as 'dateCurr'\nFROM dateFile df Full Outer join Contact ct On ct.numCode = df.numCode\nWHERE df.dateCurr = '2012-10-29'\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre><code>numCode | dateCurr\n00001   | 2012-10-29 00:00:00.000\n00002   | 2012-10-29 00:00:00.000\n00005   | 2012-10-29 00:00:00.000\n</code></pre>\n\n<p><strong>But I need output get:</strong></p>\n\n<pre><code>numCode | dateCurr\n00001   | 2012-10-29 00:00:00.000\n00002   | 2012-10-29 00:00:00.000\n00003   | 2012-10-29 00:00:00.000  (Insert Date from choose datetime)\n00004   | 2012-10-29 00:00:00.000  (Insert Date from choose datetime)\n00005   | 2012-10-29 00:00:00.000\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5489,"score":0,"question_id":388497,"title":"How to switch sql-2005 Select Case When T-sql Naming?","body":"<pre><code>select \n(Case Remark01\nWhen 'l1' then type1\nwhen 'l2' then type2\nend) AS [?] --Remark .....want to switch name in here\nfrom mytable\n</code></pre>\n\n<p>Example ....</p>\n\n<pre><code>select \n(Case level\nWhen 'l1' then type1 ('l1' mean check constant string)\nwhen 'l2' then type2(('l2' mean check constant string))\nend) AS <b>(Case when 'l1' then [type01] Else [type02])</b>\nfrom mytable\n</pre>\n\n<pre>select level,type1,type2 from mytable\n</code></pre>\n\n<p>I using two program this mytable<br>\none program is want to show menu only type1 only<br>\none program is want to show menu only  type2 only<br>\nI using one view using two program..</p>\n"},{"tags":["sql-server","batch","zip","compress"],"answer_count":7,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":4871,"score":4,"question_id":2375448,"title":"SQL Server 2008 - how to zip backup files and move to remote server","body":"<p>I have the non-enterprise edition of SQL Server 2008. I do nightly backups, manually zip the files and then manually copy to a remote server.</p>\n\n<p>I need to automate this using batch files. Copying files from server to server is easy but how do I automate the zipping of the backup first?</p>\n\n<p>The full process I need is:</p>\n\n<ol>\n<li>Run the backup nightly</li>\n<li>Zip the backup to reduce size (with a unique zip filename)</li>\n<li>Move the zip file to a remote server which is setup as a network drive on the database server</li>\n</ol>\n\n<p>I confess the compression part has thrown me off. Any advice would be very much welcomed.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":12,"favorite_count":2,"up_vote_count":14,"down_vote_count":0,"view_count":50008,"score":14,"question_id":889629,"title":"How to get a date in YYYY-MM-DD format from a TSQL datetime field?","body":"<p>How do I retrieve a date from SQL Server in YYYY-MM-DD format? I need this to work with SQL Server 2000 and up. Is there a simple way to perform this in SQL Server or would it be easier to convert it programatically after I retrieve the result set?</p>\n\n<p>I've read the <a href=\"http://technet.microsoft.com/en-us/library/ms187928.aspx\">CAST and CONVERT</a> on Microsoft Technet, but the format I want isn't listed and changing the date format isn't an option. </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13118273,"title":"Is there a way to restore sql server to default settings?","body":"<p>Basically i want all constraints, rules, keys , databases everything removed i want it as it was on the day i installed it . I do not want to re install it. Simply deleting database might not fix the problem i have</p>\n"},{"tags":["sql-server","database","migration","firebird"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13118350,"title":"Migrating a database with modifiable primary keys to MSSQL","body":"<p>I have to migrate a Firebird database to MS SQL, and the original author designed the database in the way that it has mutable primary keys. For example, we have a tables</p>\n\n<pre><code>PRODUCTS with primary key (NAME,CATEGORY,SHORTNAME) and some data\nPRICE_LISTING (NAME,CATEGORY,SHORTNAME) - foreign key to PRODUCT, and some data like price\nPRODUCT_ALTERNATIVES (ORIGINAL_NAME,ORIGINAL_CATEGORY,ORIGINAL_SHORTNAME; REPLACEMENT_NAME,REPLACEMENT_CATEGORY,REPLACEMENT_SHORTNAME) - foreign keys to PRODUCTS\n</code></pre>\n\n<p>as you can see, whenever product name changes, lot of data in other tables has to change. The original author solved this with cascading update on the foreign keys. For some reasons, MS SQL doesn't allow me to use cascading update on the foreign key, so the database cannot be migrated so easily. </p>\n\n<p>What makes things worse is that the software has a lot of editing screens, that use DataSets, DataGridViews and binding in Windows Forms, so the editor works pretty much automagically. For example, editor for <code>PRODUCTS</code> is a simple windows form, and whenever user renames a product (changes its <code>NAME</code>), the changes are propagated through database (via cascading update) to <code>PRICE_LISTING</code> and <code>PRODUCT_ALTERNATIVES</code> tables. And also, if the app wants to show price listings, it does simple <code>SELECT * FROM PRICE_LISTING</code> that includes product names and price.</p>\n\n<p>One approach might be to add surrogate keys - <code>ID</code> identity columns to each table, then modify for example <code>PRICE_LISTING</code> table to (<code>PRODUCT_ID, price</code>) etc. But then, to show price, I'd have to define view that will </p>\n\n<pre><code>SELECT *,PRODUCT.NAME,PRODUCT.CATEGORY,PRODUCT.SHORTNAME FROM PRICE_LISTING join PRODUCT on ...\n</code></pre>\n\n<p>then, the automatically generated DataSets etc. will have to be modified to select from view, update the view.</p>\n\n<p>In a nutshell and from the original author's perspective, we are breaking the program and making it more complicated. The only single thing that does not work when ported in a straightforward manner is the cascading update, but I see that the database design is very flawed and it will be a maintenance nightmare if not fixed.</p>\n\n<p>What to do?</p>\n"},{"tags":["mysql","sql","sql-server","database","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":13117710,"title":"How to export all words from sql table or sql database","body":"<p>Let's say we have following table.</p>\n\n<pre>\nUserId | Message\n-------|-------------\n1      | Hi, have a nice day\n2      | Hi, I had a nice day\n\n</pre>\n\n<p>I need to have all { Hi,-have-a-nice-day-I-had } words separately.\nIs there any way to do that ? What if I want to export words from whole database tables ?</p>\n\n<p>Similar results would be also good.</p>\n"},{"tags":["sql-server","sql-server-express"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13118164,"title":"SQL express with 20000 databases won't start","body":"<p>I have a SQL Server express instance with 20,000 databases (twenty thousand databases).. and the service won't start.\nI get error message 1053: The service did not respond to the start or control request in a timely fashion.</p>\n\n<p>I'm just doing some testing of sharding, trying out some ideas.  Apparently, I shouldn't leave this many databases attached at the same time... I can work around this... I just wish I knew more how to predict / forecast regarding the real limits of SQL Server 2012 Express.</p>\n\n<hr>\n\n<p>Error 1</p>\n\n<blockquote>\n  <p>There is insufficient system memory in resource pool 'internal' to run this query.</p>\n</blockquote>\n\n<p>Error 2</p>\n\n<blockquote>\n  <p>Script level upgrade for database 'master' failed because upgrade step 'msdb110_upgrade.sql' encountered error 701, state 123, severity 25. This is a serious error condition which might interfere with regular operation and the database will be taken offline. If the error happened during upgrade of the 'master' database, it will prevent the entire SQL Server instance from starting. Examine the previous errorlog entries for errors, take the appropriate corrective actions and re-start the database so that the script upgrade steps run to completion.</p>\n</blockquote>\n\n<p>Error 3</p>\n\n<blockquote>\n  <p>Cannot recover the master database. SQL Server is unable to run. Restore master from a full backup, repair it, or rebuild it. For more information about how to rebuild the master database, see SQL Server Books Online.</p>\n</blockquote>\n\n<p>I assume I should uninstall and reinstall, and then attach half as many databases and split the load between two database servers?</p>\n"},{"tags":["sql","c","sql-server","windows","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13117841,"title":"Get instance name from data source name","body":"<p>I'm using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms715433%28v=vs.85%29.aspx\" rel=\"nofollow\">SQLDriverConnect</a> function to connect to database. In connection string I can specify ODBC pre-configured data source name (DSN), function resolves necessary attributes and all works fine. But after successful connection I need to get instance name to which I have connected or connection port (because there can be several instances of mssql running on server). How can I implement this?</p>\n"},{"tags":["sql-server","subquery","sql-update","multiple-tables"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12363047,"title":"How to update column in a table from another table based on condition?","body":"<p>I am having two tables </p>\n\n<ol>\n<li>student table it contains (Student_id,school_code,name,year,...)</li>\n<li>school table it contains (school_id,School_code,School_name,year\netc.....)</li>\n</ol>\n\n<p>I want to update the school_code column in the student table with the school_id column in the school code table based on school code and year. i m having five years data. so school_id varies for every year. </p>\n\n<p>My query was </p>\n\n<pre><code>UPDATE Master.Student\n   SET school_code=( select school_id from Master.school as sc\n  JOIN master.student as st\n    ON st.school_code=sc.school_code\n WHERE sc.year=x)\n WHERE st.year=x;\n</code></pre>\n\n<p>But its not updating. I am getting error of <code>subquery returns more than one value</code>.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":51,"score":1,"question_id":13116036,"title":"Insert Trigger , Help Please","body":"<p>I have 'Employee Registration' form (Windows Application). When the employee registration is done, at the same time i want to create an user. Taking the 'EmpCode' value from 'Employee Registration' and making it the value of 'UserName'. Please help me to write a trigger for it. </p>\n\n<p>Employee Registration Table\nColumns are</p>\n\n<pre><code>EMPCODE, \nEMPNAME, \nDESIGNATION, \nDEPARTMENT, \nDOJ,  \nEMAILID, \nCATEGORY, \nEMPSTATUS, \nEMPMANAGER etc etc\n</code></pre>\n\n<p>UserCreation Table\nColumns are</p>\n\n<pre><code>USERNAME, \nUSERPASSWORD, \nUSERMAPPINGCODE, \nUSERTYPE, \nUSERACTIVE, \nUSEREMAIL\n</code></pre>\n\n<p>When the insertion for 'employee regstratn' happens, same time the following thngs shud happen in 'UserCreation ' table....,</p>\n\n<p><code>EMPCODE</code>'s value should be saved as <code>USERNAME</code>'s value. \n<code>EMPNAME</code>'s value should be saved as <code>USERPASSWORD</code>'s value.\n<code>USERMAPPINGCODE</code>'s value optional \n<code>CATEGORY</code>'s value should be saved as <code>USERTYPE</code>'s value. \n<code>USERACTIVE</code>'s value is 1\n<code>EMAILID</code>'s value should be saved as <code>USEREMAIL</code>'s value</p>\n\n<p>Please help....</p>\n"},{"tags":["sql-server","if-statement","subquery"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13117463,"title":"IF ELSE in subquery SQL Server","body":"<p>I have 2 tables as below, and insert data into <code>ftable</code> from <code>f_table</code> accordingly. I want to insert <code>field_3</code> into <code>field3</code> if <code>field_3</code> exists, else insert <code>field_4</code> into <code>field3</code>. </p>\n\n<p>How do I do that? Much appreciate for any reply.</p>\n\n<pre><code>CREATE TABLE ftable\n(\nfield1 int null,\nfield2 int null,\nfield3 char(1)\n);\n\nCREATE TABLE f_table\n(\nfield_1 int null,\nfield_2 int null,\nfield_3 char(1),\nfield_4 char(1)\n);\n\nINSERT INTO ftable (field1, field2, field3) \n    SELECT (field_1, field_2, field_3) \n    FROM f_table;\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","case"],"answer_count":13,"favorite_count":25,"up_vote_count":168,"down_vote_count":0,"view_count":411050,"score":168,"question_id":63447,"title":"How do you perform an IF...THEN in an SQL SELECT?","body":"<p>How do I perform an IF...THEN in an SQL SELECT statement?</p>\n\n<p>For example;</p>\n\n<pre><code>SELECT IF(Obsolete = 'N' or InStock = 'Y';1;0) as Salable, * FROM Product\n</code></pre>\n"},{"tags":["sql","sql-server","full-text-search","sql-server-2008-r2","wordbreaker"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":80,"score":2,"question_id":12395465,"title":"SQL2008 fulltext index search without word breakers","body":"<p>I are trying to search an FTI using <code>CONTAINS</code> for Twitter-style usernames, e.g. @username, but word breakers will ignore the @ symbol. Is there any way to disable word breakers? From research, there is a way to create a custom word breaker DLL and install it and assign it but that all seems a bit intensive and, frankly, over my head. I disabled stop words so that dashes are not ignored but I need that @ symbol. Any ideas?</p>\n"},{"tags":["sql-server","sql-server-2008","fulltext","fulltext-index"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":316,"score":2,"question_id":3914798,"title":"Can I define which word breakers to use when building a mssql fulltext index?","body":"<p>I have created a fulltext catalog that stores the data from some of the columns in a table, but the contents seem to have been split apart by characters that I don't really want to be considered word delimiters. (\"/\", \"-\", \"_\" etc..)</p>\n\n<p>I know that I can set the language for word breaker, and <a href=\"http://msdn.microsoft.com/en-us/library/ms345188.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms345188.aspx</a> gives som idea on how to install new languages - but I need more direct control than that, because all of those languages still break on the characters I want to not break on.</p>\n\n<p>Is there a way to define my own language to use for finding word breakers?</p>\n"},{"tags":["sql","sql-server","tsql","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":13114627,"title":"SQL Server / T-SQL need to modify dynamic stored procedure?","body":"<p>I have a stored procedure that dynamically generates <code>MERGE</code> TSQL statements to handle SCD Type 1 updates between the given Dimension / Staging table dump.</p>\n\n<p>Here is the T-SQL code (modified from the original code by Alex Whittles):</p>\n\n<pre><code>USE [OPPY_DWUSD]\nGO\n\nALTER PROCEDURE [dbo].[GenerateMerge]\n/***************************************************************\n*                                                              *\n*   Script for use with blog post                              *\n*     \"Automating T-SQL Merge to load Dimensions (SCD)\"        *\n*     http://www.purplefrogsystems.com/blog/2012/04/automating-t-sql-merge-to-load-dimensions-scd\n*                                                              *   \n*   Posted: 6th April 2012                                     *\n*                                                              *\n*   By: Alex Whittles - Purple Frog Business Intelligence      *\n*       www.PurpleFrogSystems.com                              *\n*                                                              *\n*   All code samples are provided AS IS without warranty of  *\n*   any kind, either express or implied, including but not     *\n*   limited to the implied warranties of merchantability       *\n*   and/or fitness for a particular purpose.                   *\n*                                                              *\n***************************************************************/\n\n@Dimension  varchar(50),\n@Schema     varchar(50),\n@ETLTable   varchar(50),\n@ETLSchema  varchar(50),\n@Execute    bit=0  --Should the resulting merge be returned or executed\nAS\nBEGIN\nSET NOCOUNT ON;\n\n--Create Carriage return variable to format the resulting query\nDECLARE @crlf char(2)\nSET @crlf = CHAR(13)\n\n\n--Find out which Audit fields are used\nDECLARE @UseIsInferred bit\nDECLARE @UseFirstCreated bit\nDECLARE @UseValidTo bit\nDECLARE @UseIsRowCurrent bit\nDECLARE @UseLastUpdated bit\n\nSET @UseIsInferred = ISNULL((SELECT MAX(1) \nFROM sys.columns c\n        INNER JOIN sys.tables t on c.object_id = t.object_id\n        INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\nWHERE       s.name = @Schema\n        AND t.name = @Dimension\n        AND c.name = 'IsInferred'\n),0)\n\nSET @UseFirstCreated= ISNULL((SELECT MAX(1) \nFROM sys.columns c\n        INNER JOIN sys.tables t on c.object_id = t.object_id\n        INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\nWHERE       s.name = @Schema\n        AND t.name = @Dimension\n        AND c.name = 'FirstCreated'\n),0)\n\nSET @UseValidTo = ISNULL((SELECT MAX(1) \nFROM sys.columns c\n        INNER JOIN sys.tables t on c.object_id = t.object_id\n        INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\nWHERE       s.name = @Schema\n        AND t.name = @Dimension\n        AND c.name = 'ValidTo'\n),0)\n\nSET @UseIsRowCurrent = ISNULL((SELECT MAX(1) \nFROM sys.columns c\n        INNER JOIN sys.tables t on c.object_id = t.object_id\n        INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\nWHERE       s.name = @Schema\n        AND t.name = @Dimension\n        AND c.name = 'IsRowCurrent'\n),0)\n\nSET @UseLastUpdated = ISNULL((SELECT MAX(1) \nFROM sys.columns c\n        INNER JOIN sys.tables t on c.object_id = t.object_id\n        INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\nWHERE       s.name = @Schema\n        AND t.name = @Dimension\n        AND c.name = 'LastUpdated'\n),0)\n\n\n--Identify the business key column(s)\n--Also define what the null replacement should be\nDECLARE myCurBK Cursor FOR \nSELECT c.name\n    , CASE WHEN ty.name IN ('text', 'ntext', 'varchar', 'char', 'nvarchar', 'nchar') THEN ''''''\n        WHEN ty.name IN ('tinyint', 'smallint', 'int', 'real', 'money', 'float', 'bit', 'decimal', 'numeric','smallmoney','bigint') THEN '0'\n        WHEN ty.name IN ('date', 'datetime') THEN '''19000101'''\n        ELSE 'NULL' END AS NullRep\nFROM sys.columns c\n    INNER JOIN sys.tables t on c.object_id = t.object_id\n    INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\n    INNER JOIN sys.types ty ON c.user_type_id = ty.user_type_id\n    INNER JOIN sys.extended_properties ep \n         ON t.object_id=ep.major_id\n        AND c.column_id=ep.minor_id\n        AND ep.class=1\n        AND ep.name='SCD'\nWHERE s.name = @Schema\n    AND t.name = @Dimension\n    AND ep.value = 'BK'\nORDER BY c.column_id\n\n--Identify all fields to be merged (Exclude Type 0)\nDECLARE myCurType1 Cursor\nFOR SELECT c.name\n    , CASE WHEN ty.name IN ('text', 'ntext', 'varchar', 'char', 'nvarchar', 'nchar') THEN ''''''\n        WHEN ty.name IN ('tinyint', 'smallint', 'int', 'real', 'money', 'float', 'bit', 'decimal', 'numeric','smallmoney','bigint') THEN '0'\n        WHEN ty.name IN ('date', 'datetime') THEN '''19000101'''\n        ELSE 'NULL' END AS NullRep\n    FROM sys.columns c\n        INNER JOIN sys.tables t on c.object_id = t.object_id\n        INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\n        INNER JOIN sys.types ty ON c.user_type_id = ty.user_type_id\n        LEFT JOIN sys.extended_properties ep \n             ON t.object_id=ep.major_id\n            AND c.column_id=ep.minor_id\n            AND ep.class=1\n            AND ep.name='SCD'\n    WHERE s.name = @Schema\n        AND t.name = @Dimension\n        AND c.is_identity=0\n        AND ISNULL(ep.value,'1') NOT IN ('0', 'Audit', 'BK')\n    ORDER BY c.column_id ASC\n\n--Identify all fields for insert\nDECLARE myCurAll Cursor\nFOR SELECT c.name\n    , CASE WHEN ty.name IN ('text', 'ntext', 'varchar', 'char', 'nvarchar', 'nchar') THEN ''''''\n        WHEN ty.name IN ('tinyint', 'smallint', 'int', 'real', 'money', 'float', 'bit', 'decimal', 'numeric','smallmoney','bigint') THEN '0'\n        WHEN ty.name IN ('date', 'datetime') THEN '''19000101'''\n        ELSE 'NULL' END AS NullRep\n    FROM sys.columns c\n        INNER JOIN sys.tables t on c.object_id = t.object_id\n        INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\n        INNER JOIN sys.types ty ON c.user_type_id = ty.user_type_id\n    WHERE s.name = @Schema\n        AND t.name = @Dimension\n        AND c.name NOT IN ('LastUpdated', 'IsInferred', 'FirstCreated', 'ValidTo', 'IsRowCurrent')\n        AND c.is_identity=0\n    ORDER BY c.column_id ASC\n\nDECLARE @Field varchar(255)\nDECLARE @NullRep varchar(20)\nDECLARE @SQL varchar(max)\nDECLARE @SQL2 varchar(max)\nDECLARE @SQL3 varchar(max)\n\n--Now start building up the dynamic SQL\n\nSET @SQL ='MERGE [' + @Schema + '].[' + @Dimension + '] AS Target'\nSET @SQL = @SQL + @crlf + 'USING [' + @ETLSchema + '].[' + @ETLTable + '] AS Source'\n\nOPEN myCurBK\nFETCH NEXT FROM myCurBK INTO @Field, @NullRep\nIF (@@FETCH_STATUS&gt;=0)\n    BEGIN\n        SET @SQL = @SQL + @crlf + '       ON Target.' + '[' + @Field + ']' +  ' = Source.' + '[' + @Field + ']'\n        FETCH NEXT FROM myCurBK INTO @Field, @NullRep\n    END\nWHILE (@@FETCH_STATUS&lt;&gt;-1)\nBEGIN\n    IF (@@FETCH_STATUS&lt;&gt;-2)\n        SET @SQL = @SQL + @crlf + '       AND Target.' + '[' + @Field + ']' +  ' = Source.' + '[' + @Field + ']'\n    FETCH NEXT FROM myCurBK INTO @Field, @NullRep\nEND\nCLOSE myCurBK\n\nIF @UseIsRowCurrent&gt;0   SET @SQL = @SQL + @crlf + '       AND Target.IsRowCurrent=1'\n\nSET @SQL = @SQL + @crlf + '    WHEN MATCHED'\n\nOPEN myCurType1\nFETCH NEXT FROM myCurType1 INTO @Field, @NullRep\n\nIF (@@FETCH_STATUS&gt;=0)\n    BEGIN\n        SET @SQL = @SQL + @crlf + '       AND (ISNULL(Target.' + '[' + @Field + ']' + ',' + @NullRep + ') &lt;&gt; ISNULL(Source.' + '[' + @Field + ']' + ',' + @NullRep + ')'\n        FETCH NEXT FROM myCurType1 INTO @Field, @NullRep\n    END\nWHILE (@@FETCH_STATUS&lt;&gt;-1)\nBEGIN\n    IF (@@FETCH_STATUS&lt;&gt;-2)\n        SET @SQL = @SQL + @crlf + '       OR ISNULL(Target.' + '[' + @Field + ']' + ',' + @NullRep + ') &lt;&gt; ISNULL(Source.' + '[' + @Field + ']' + ',' + @NullRep + ')'\n    FETCH NEXT FROM myCurType1 INTO @Field, @NullRep\nEND\nCLOSE myCurType1\n\nSET @SQL = @SQL + @crlf + '      )'\nSET @SQL2 = '    THEN UPDATE SET'\n\nOPEN myCurType1\nFETCH NEXT FROM myCurType1 INTO @Field, @NullRep\nIF (@@FETCH_STATUS&gt;=0)\n    BEGIN\n        SET @SQL2 = @SQL2 + @crlf + '       ' + '[' + @Field + ']' + ' = Source.' + '[' + @Field + ']'\n        FETCH NEXT FROM myCurType1 INTO @Field, @NullRep\n    END\nWHILE (@@FETCH_STATUS&lt;&gt;-1)\nBEGIN\n    IF (@@FETCH_STATUS&lt;&gt;-2)\n        SET @SQL2 = @SQL2 + @crlf + '      ,' + '[' + @Field + ']' + ' = Source.' + '[' + @Field + ']'\n    FETCH NEXT FROM myCurType1 INTO @Field, @NullRep\nEND\nCLOSE myCurType1\n\nIF @UseLastUpdated&gt;0   SET @SQL2 = @SQL2 + @crlf + '      ,LastUpdated = GetDate()'\n\nSET @SQL3 = '    WHEN NOT MATCHED THEN'\nSET @SQL3 = @SQL3 + @crlf + '         INSERT ('\n\nOPEN myCurAll\nFETCH NEXT FROM myCurAll INTO @Field, @NullRep\nIF (@@FETCH_STATUS&gt;=0)\n    BEGIN\n        SET @SQL3 = @SQL3 + @crlf + '           ' + '[' + @Field + ']'\n        FETCH NEXT FROM myCurAll INTO @Field, @NullRep\n    END\nWHILE (@@FETCH_STATUS&lt;&gt;-1)\nBEGIN\n    IF (@@FETCH_STATUS&lt;&gt;-2)\n        SET @SQL3 = @SQL3 + @crlf + '           ,' + '[' + @Field + ']'\n    FETCH NEXT FROM myCurAll INTO @Field, @NullRep\nEND\nCLOSE myCurAll\n\n\nIF @UseIsInferred&gt;0     SET @SQL3 = @SQL3 + @crlf + '           ,IsInferred'\nIF @UseFirstCreated&gt;0   SET @SQL3 = @SQL3 + @crlf + '           ,FirstCreated'\nIF @UseValidTo&gt;0        SET @SQL3 = @SQL3 + @crlf + '           ,ValidTo'\nIF @UseIsRowCurrent&gt;0   SET @SQL3 = @SQL3 + @crlf + '           ,IsRowCurrent'\nIF @UseLastUpdated&gt;0    SET @SQL3 = @SQL3 + @crlf + '           ,LastUpdated'\nSET @SQL3 = @SQL3 + @crlf + '         ) VALUES ('\n\nOPEN myCurAll\nFETCH NEXT FROM myCurAll INTO @Field, @NullRep\nIF (@@FETCH_STATUS&gt;=0)\n    BEGIN\n        SET @SQL3 = @SQL3 + @crlf + '            Source.' + '[' + @Field + ']'\n        FETCH NEXT FROM myCurAll INTO @Field, @NullRep\n    END\nWHILE (@@FETCH_STATUS&lt;&gt;-1)\nBEGIN\n    IF (@@FETCH_STATUS&lt;&gt;-2)\n        SET @SQL3 = @SQL3 + @crlf + '           ,Source.' + '[' + @Field + ']'\n    FETCH NEXT FROM myCurAll INTO @Field, @NullRep\nEND\nCLOSE myCurAll    \n\nIF @UseIsInferred&gt;0     SET @SQL3 = @SQL3 + @crlf + '           ,0'\nIF @UseFirstCreated&gt;0   SET @SQL3 = @SQL3 + @crlf + '           ,GetDate()'\nIF @UseValidTo&gt;0        SET @SQL3 = @SQL3 + @crlf + '           ,NULL'\nIF @UseIsRowCurrent&gt;0   SET @SQL3 = @SQL3 + @crlf + '           ,1'\nIF @UseLastUpdated&gt;0    SET @SQL3 = @SQL3 + @crlf + '           ,GetDate()'\nSET @SQL3 = @SQL3 + @crlf + '         );'\n\n--clean up\nDEALLOCATE myCurType1\nDEALLOCATE myCurAll\nDEALLOCATE myCurBK\n\nIF @Execute = 1\nBEGIN\n    EXEC(@SQL + @SQL2 + @SQL3)           \nEND\nELSE\nBEGIN    \n    PRINT @SQL\n    PRINT @SQL2\n    PRINT @SQL3\nEND\n\nEND\n</code></pre>\n\n<p>In the stored procedure above, when I pass in the variables, it produces this code:</p>\n\n<pre><code>MERGE [DIM].[COMPANY] AS Target\nUSING [DBO].[DWUSD_LIVE] AS Source\n    ON Target.[comp] = Source.[comp]\n WHEN MATCHED\n    AND (ISNULL(Target.[comp name],'') &lt;&gt; ISNULL(Source.[comp name],'')\n    OR ISNULL(Target.[comp description],'') &lt;&gt; ISNULL(Source.[comp description],'')\n   )\nTHEN UPDATE SET\n    [comp name] = Source.[comp name]\n   ,[comp description] = Source.[comp description]\n   ,LastUpdated = GetDate()\nWHEN NOT MATCHED THEN\n      INSERT (\n        [comp]\n        ,[comp name]\n        ,[comp description]\n        ,FirstCreated\n        ,LastUpdated\n      ) VALUES (\n         Source.[comp]\n        ,Source.[comp name]\n        ,Source.[comp description]\n        ,GetDate()\n        ,GetDate()\n      );\n</code></pre>\n\n<p>What I need to be able to do is add a <code>DISTINCT</code> <code>SELECT</code> subquery at the beginning...</p>\n\n<pre><code>MERGE [dim].[Company] AS Target\nUSING (\nSELECT DISTINCT \n[COMP NAME],\n[COMP DESCRIPTION],\n[COMP]\nFROM [dbo].[DWUSD_LIVE]\n) AS Source\n</code></pre>\n\n<p>So that when it looks at the source (staging table) it does a <code>SELECT DISTINCT</code> on the same columns found in the dimension but not including the audit columns (<code>FirstCreated</code> / <code>LastUpdated</code>).</p>\n\n<p>My staging table has duplicate records, thus I only need to <code>SELECT DISTINCT</code> otherwise I end up with multiple records in my dimension.</p>\n"},{"tags":["sql-server","xml","sql-server-2008-r2","xquery"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13114959,"title":"Querying XML column in SQL Server","body":"<p>I'm running SQL Server 2008 R2, and have a table that I audit update statements.</p>\n\n<pre><code>create table STG_Participant_16_Month\n(\nSerial                  int,\nID                      varchar(10),\nStartTime               datetime, \nFinishTime              datetime, \nChildID                 varchar(10),\nchildIndex              int,\nRecord_State            varchar(15),\nDuplicate_flag          varchar(1)\n);\n</code></pre>\n\n<p>When table X is updated, it inserts a record into an audit table:</p>\n\n<pre><code>select * \ninto STG_Participant_16_Month_AUDIT \nfrom STG_Participant_16_Month;\n\nalter table STG_Participant_16_Month_AUDIT\nadd audit_user                       varchar(30),\n    audit_action                     varchar(1),\n    audit_date                       datetime,\n    columns_updated                  xml;\n</code></pre>\n\n<p>I create a record and do an update:</p>\n\n<pre><code>insert into STG_Participant_16_Month\n( Serial, ID, StartTime, FinishTime, ChildID, childIndex,\n  Record_State, Duplicate_flag )\nvalues\n(  90, 'ID', getdate(), getdate(), 'ChildID', 1,\n  'LOADED', 'N');\n\nupdate STG_Participant_16_Month set serial=99, ID='xx', childIndex=99  where serial=90;\n</code></pre>\n\n<p>I see output as follows:</p>\n\n<pre><code>&lt;Fields&gt;\n  &lt;Field Name=\"Serial\" /&gt;\n  &lt;Field Name=\"ID\" /&gt;\n  &lt;Field Name=\"childIndex\" /&gt;\n&lt;/Fields&gt;\n</code></pre>\n\n<p>How do I create a query which just shows the text values?</p>\n\n<pre><code>Serial\nID\nchildIndex\n</code></pre>\n"},{"tags":["c#","asp.net","sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":117,"score":0,"question_id":13116292,"title":"Converting a date column in DataTable to desired format before importing it in sql server","body":"<p>I am importing an excel sheet into sql server db table the table consists of \nid | data(which is actually date in mm/dd/yyyy)\nI am able to import the data into database table BUT i want the data(date) column of excel sheet to be converted in to yyyy/mm/dd format before importing it into sql server. Here is my code to import excel sheet:</p>\n\n<pre><code>      DataTable dt7 = new DataTable();\n      dt7.Load(dr);\n\n                // Bulk Copy to SQL Server\n     using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n     {                       \n\n\n     bulkCopy.DestinationTableName = \"ExcelTable\";\n\n\n     bulkCopy.WriteToServer(dt7);\n\n\n     }\n     dr.Close();\n</code></pre>\n\n<p>I have found a piece of code to convert mm/dd/yyyy into yyyy/mm/dd:</p>\n\n<pre><code>    string a = \"12/20/2012\";\n    DateTime dt = Convert.ToDateTime(a);\n    string st = dt.ToString(\"yyyy/MM/dd\");\n    Label1.Text = a;\n    Label2.Text = st;\n</code></pre>\n\n<p>but i have no idea how to implement it in my code. I am a complete newbie so you might have to explain with code :(</p>\n"},{"tags":["c#","asp.net","sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13115655,"title":"How to manipulate the excel data in SqlBulkCopy?","body":"<p>I am importing excel sheet into sql server db table, for eg:\nid | Data(which is date)\nthe format of date in excel is mm/dd/yyyy i want it to get stored in database as yyyy/mm/dd i have no idea how to do it the following is my code to upload the excel:</p>\n\n<pre><code>   using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n                {\n                   bulkCopy.DestinationTableName = \"ExcelTable\";\n                   bulkCopy.WriteToServer(dr);\n\n               }\n                dr.Close();\n</code></pre>\n\n<p>and i found a code to convert date but i dont know how to integrate this code with the above: </p>\n\n<pre><code>    string a = \"12/20/2012\";\n    DateTime dt = Convert.ToDateTime(a);\n    string st = dt.ToString(\"yyyy/MM/dd\");\n    Label1.Text = a;\n    Label2.Text = st;\n</code></pre>\n"},{"tags":["sql-server","linq","stored-procedures"],"answer_count":11,"favorite_count":5,"up_vote_count":4,"down_vote_count":0,"view_count":10660,"score":4,"question_id":752064,"title":"Performance Difference between LINQ and Stored Procedures","body":"<h3>Related</h3>\n\n<blockquote>\n  <p><a href=\"http://stackoverflow.com/questions/14530/linq-to-sql-vs-stored-procedures\">LINQ-to-SQL vs stored procedures?</a></p>\n</blockquote>\n\n<p>I have heard a lot of talk back and forth about the advantages of stored procedures being pre compiled. But what are the actual performance difference between LINQ and Stored procedures on Selects, Inserts, Updates, Deletes? Has anyone run any tests at all to see if there is any major difference. I'm also curious if a greater number of transactions makes a difference.</p>\n\n<p>My guess is that LINQ statements get cached after the first transaction and performance is probably going to be nearly identical. Thoughts?</p>\n"},{"tags":["sql-server","geocoding","geospatial"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":13112899,"title":"How to get the bounding coordinates for a US postal(zip) code?","body":"<p>Is there a service/API that will take a postal/zip code and return the bounding(perimeter) coordinates so I can build a Geometry object in a MS SQL database?</p>\n\n<p>By bounding coordinates, I mean I would like to retrieve a list of GPS coordinates that construct a  polygon that defines the US zip code. </p>\n"},{"tags":["sql-server","hibernate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13115314,"title":"Hibernate SQLServerException for username","body":"<p>I'm trying to run a java app that uses Hibernate and MS SQL Server Express.</p>\n\n<p>SQL Server is configured with windows authentication as the login methond. I've also enabled TCP/IP port 1433(default), but I still keep getting the following error.</p>\n\n<pre><code>...// more output\nat test.models.TestHibernate.main(TestHibernate.java:11)\nCaused by: com.microsoft.sqlserver.jdbc.SQLServerException: Login failed for user 'not required'. ClientConnectionId:de7daf69-2619-4906-b063-459a5b614bdb\n...// more output\n</code></pre>\n\n<p>The line throwing the exception:</p>\n\n<pre><code>session.beginTransaction();\n</code></pre>\n\n<p>hibernate.cfg.xml:</p>\n\n<pre><code>&lt;property name=\"connection.driver_class\"&gt;com.microsoft.sqlserver.jdbc.SQLServerDriver&lt;/property&gt;\n        &lt;property name=\"connection.url\"&gt;jdbc:sqlserver://localhost;databaseName=hibernatexml;integratedSecurity=false;&lt;/property&gt;\n        &lt;property name=\"connection.username\"&gt;not required&lt;/property&gt;\n        &lt;property name=\"connection.password\"/&gt;\n</code></pre>\n\n<p>I removed other configuration errors but with this I'm out of ideas. If you need more info just let me know</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","sql-server","regex","select"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13115251,"title":"Use regular expression for naming unnamed columns in query","body":"<p>Here is my code:</p>\n\n<pre><code>--INSERT INTO #TempTable\n    --(\n    --  coverageID,\n    --  coverageName,\n    --  coverageDesc,\n    --  clausesID,\n    --  clausesCode,\n    --  clausesDesc,\n    --  LastModBy,\n    --  UpdatedOn,\n    --  FullName,\n    --  LastModOn,\n    --  IsCompulsory\n    --)\n\n    SELECT\n        maCoverage.coverageID,\n        maCoverage.coverageName,\n        maCoverage.cd,\n        maClauses.cID,\n        maClauses.IOiusa * maClauses.Precode +             dbo.getcodety(maClauses.tim1,mClauses.cID),\nclausesCode,\n        maClauses.clausesDesc,\n        siUser.UserID AS LastModBy,\n         maClauses.UpdatedOn,\n            siUserProfile.FullName,\n        maClauses.LastModOn,\n        maClauses.IsCompulsory\n    ...\n</code></pre>\n\n<p></p>\n\n<p>Now, as you can see temp table has been commented out, the problem is after execution some columns have different name and some of them are unnamed...\nI wonder is there anyway to get the column names from Insert definition just before select query and one by one name columns in select query...\nlike following:</p>\n\n<pre><code>SELECT\n        maCoverage.coverageID,\n        maCoverage.coverageName,\n        maCoverage.cd As CoverageDesc,\n        maClauses.cID As ClausesID,\n        maClauses.IOiusa * maClauses.Precode +dbo.getcodety(maClauses.tim1,mClauses.cID) As ClausesCode,\n        maClauses.clausesDesc,\n        siUser.UserID AS LastModBy,\n         maClauses.UpdatedOn,\n            siUserProfile.FullName,\n        maClauses.LastModOn,\n        maClauses.IsCompulsory\n</code></pre>\n\n<p>I hope someone help me soon...</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server","tsql","dynamic-sql"],"answer_count":6,"favorite_count":0,"up_vote_count":8,"down_vote_count":0,"view_count":34571,"score":8,"question_id":662049,"title":"Dynamic SQL results into temp table in SQL Stored procedure","body":"<p>The code is as follows: </p>\n\n<pre><code>ALTER PROCEDURE dbo.pdpd_DynamicCall \n@SQLString varchar(4096) = null\n\nAS\n\nBegin\n\n    create TABLE #T1 ( column_1 varchar(10) , column_2 varchar(100) )\n\n    insert into #T1 \n        execute ('execute ' + @SQLString )\n\n    select * from #T1 \n\nEnd\n</code></pre>\n\n<p>The problem is that I want to call different procedures that can give back different columns.\nTherefore I would have to define the table #T1 generically.\nBut I don't know how.</p>\n\n<p>Can anyone help me on this problem?</p>\n"},{"tags":["asp.net","sql-server","ado.net","insert","bulkinsert"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":5222,"score":1,"question_id":2472184,"title":"Insert ADO.Net DataTable into an SQL table","body":"<p>The current solution i implemented is awful!</p>\n\n<p>I use a <code>for... loop</code> for inserting records from an ADO.NET data-table into an SQL table.</p>\n\n<p>I would like to insert at once the data-table into the SQL table, without iterating...</p>\n\n<p>Is that possible, or am i asking too much?</p>\n"},{"tags":["php","sql-server","odbc"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13115039,"title":"How to display 'text' data correctly with Microsoft ODBC driver for Linux? Currently displaying as random characters","body":"<p>I am trying to display the contents of a field in a MS SQL database, the data type of which is 'text'. When I connect to the database with MS Excel on a PC the value looks something like:</p>\n\n<blockquote>\n  <p>Shipped on the: 18/10/12 Toll IPEC Connote Number: XXX XXX XXXX</p>\n</blockquote>\n\n<p>When I connect to the database with PHP using the Microsoft ODBC driver for Linux, the output of the text field will display random characters, which are slightly different each time I run the exact same script. Here is what it output the last four times:</p>\n\n<blockquote>\n  <p>Xisep)!wXment.class.php))</p>\n  \n  <p>5isep)!ment.class.php))</p>\n  \n  <p>}isep)!}ment.class.php))</p>\n  \n  <p>t)!!Owner_IDt)8</p>\n</blockquote>\n\n<p>Not sure where it's getting the 'ment.class.php' bit from. That looks like the end of the name of one of my classes, but not one that is included in this particular script. Is the driver broken or what? All other data types (int, varchar, datetime etc) seem to display correctly, the problem only seems to happen with this one text field.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>&lt;?php\n\nrequire('ConnectWise.inc.php');\n\n$config = new CW_Config;\n\n// Connect to database\n$dbcnx = odbc_connect(\"ConnectWise\", $config-&gt;db_username, $config-&gt;db_password);\n\n// Query database\n$query = \"select * from Billing_Log where Invoice_Number = '24011'\";\n$result = odbc_exec($dbcnx, $query);\nwhile ($row = odbc_fetch_array($result)) {\n    echo $row['Top_Comment'] . \"\\n\";\n}\n\nodbc_close($dbcnx);\n</code></pre>\n\n<p>Here is the output of my last few attempts:</p>\n\n<blockquote>\n  <p>\\3!!Y!</p>\n  \n  <p>!!Y!</p>\n  \n  <p>&amp;!!Y!</p>\n</blockquote>\n"},{"tags":["php","sql-server","character-encoding"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2496,"score":3,"question_id":4663325,"title":"Why do I get invalid characters when converting MS SQL Data to MYSQL?","body":"<p>I'm writing a PHP script to import data into a MYSQL database from a Microsoft SQL Server 2008 database.</p>\n\n<p>The MSSQL Server is set with a collation of \"SQL_Latin1_General_CP1_CI_AS\" and the data in question is being stored in a column of the type \"nchar\".</p>\n\n<p>My PHP web pages use</p>\n\n<pre><code>&lt;meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\"&gt;\n</code></pre>\n\n<p>to indicate that they should be displayed with UTF-8 Character encoding.</p>\n\n<p>I'm pulling the data from the MSSQL database using the sqlsrv PHP extension.</p>\n\n<pre><code>$sql = 'SELECT * FROM [tArticle] WHERE [ID] = 6429';\n$stmt = &amp;sqlsrv_query($dbHandler, $sql);\n\nwhile ($row = sqlsrv_fetch_object($stmt)) {\n  // examples of what I've tried simply to display the data\n  echo $row-&gt;Text1;\n  echo utf8_encode($row-&gt;Text1);\n  echo iconv(\"ISO-8859-1\", \"UTF-8\", $row-&gt;Text1);\n  echo iconv(\"ISO-8859-1\", \"UTF-8//TRANSLIT\", $row-&gt;Text1);\n}\n</code></pre>\n\n<p>Forget about inserting the data into the MYSQL database for now.  I can't get the string to display properly in my PHP page.  From the examples in my listing:</p>\n\n<pre><code>echo $row-&gt;Text1\n</code></pre>\n\n<p>is rendered by my browser as an obviously invalid character:  \"Lucys\"</p>\n\n<p>all of the examples following that one are rendered as blanks:  \"Lucys\"</p>\n\n<p>It looks like a character set mismatch problem to me but how can I get this data to display properly from the MS SQL database (without changing my web-page encoding)?  If I can figure that out I can probably work out the storing it in the MYSQL database part.</p>\n"},{"tags":["sql-server","ssis"],"answer_count":4,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":3603,"score":3,"question_id":1800119,"title":"How do you get an SSIS package to only insert new records when copying data between servers","body":"<p>I am copying some user data from one SqlServer to another.  Call them Alpha and Beta.  The SSIS package runs on Beta and it gets the rows on Alpha that meet a certain condition.  The package then adds the rows to Beta's table.  Pretty simple and that works great.</p>\n\n<p>The problem is that I only want to add new rows into Beta.  Normally I would just do something simple like....</p>\n\n<pre><code>INSERT INTO BetaPeople\n SELECT * From AlphaPeople\n where ID NOT IN (SELECT ID FROM BetaPeople)\n</code></pre>\n\n<p>But this doesn't work in an SSIS package.  At least I don't know how and that is the point of this question.  How would one go about doing this across servers?</p>\n"},{"tags":["sql-server","dax"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13114702,"title":"MDX equation convert to DAX equation","body":"<p>I'm studying SQL Server Tabular model.<br/>I'm struggle to transfer a MDX equation to DAX equation.</p>\n\n<p>I want to show every month's PC count changing(incremental or decremental) rate using following calculation.<br/>(current month PC count - previous month PC count) / previous month PC Count</p>\n\n<p>This is MDX equation and it is working well in multi-dimensional model.<br/>\n[PC Count] is Last non-empty value.</p>\n\n<pre><code>(([Date].[Fiscal QTR].CURRENTMEMBER, [Measures].[PC Count])\n-\n([Date].[Fiscal QTR].PREVMEMBER, [Measures].[PC Count]))\n/\n([Date].[Fiscal QTR].PREVMEMBER, [Measures].[PC Count])\n</code></pre>\n\n<p>I made a DAX equation for current month PC count</p>\n\n<pre><code>PC Count:=\nCALCULATE(\n    SUM([PC Count]),\n    FILTER(Time, Time[DateKey] = MAX(vwFact_PCCount[DateKey]))\n)\n</code></pre>\n\n<p>This is working well in Grid view(SSDT) and Performance Point.\nbut the following MDX equation for previous month PC Count is working well in grid view(SSDT) but this equation shows error in Performance Point when I bottom axis(month).</p>\n\n<pre><code>Previous Month Count:=CALCULATE(\n    SUM([PC Count]),\n    FILTER(Time, Time[DateKey] = FORMAT(DATE(LEFT(Max(vwFact_PCCount[DateKey]),4),\n                                             RIGHT(LEFT(Max(vwFact_PCCount[DateKey]),6),2)\n                                             ,1)-1\n                                        , \"yyyyMMdd\") *1)\n)\n</code></pre>\n\n<p>I don't know what is wrong my Previous Month Count equation.\nHow can I get this result using DAX?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13114198,"title":"SQL Server tuning - index vs. statistics","body":"<p>We ran the SQL tuning advisor and it produced a list of possible indexes and statistics. What the index is clear, but are those \"statistics\" also important to create? What do they precisely (I assume they collect data, but who uses it)?</p>\n"},{"tags":["c#","sql-server","winforms","radio-button","global-variables"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13105887,"title":"Passing a value to a global variable for reference with WinForms (C#) and SQL Connection","body":"<p>I need two global variables to be accessed by multiple winforms at various stages.</p>\n\n<p>The first is in regards to a distinct user, after logging in to the app,\nother winforms need to get data from sql server tables based on the user who logged in.</p>\n\n<pre><code>SqlCommand cmd = new SqlCommand(\"SELECT * FROM regClient WHERE client_ID = **[GLOBAL VARIABLE]**\", con);\n</code></pre>\n\n<hr>\n\n<p>The second follows this in that the user can log in as either a <strong>Client</strong> or <strong>Student</strong>. Different statements need to be called based on this. This value is set by radiobutton on the login window.</p>\n\n<p>So if radClient is checked set global to 'client', if radStudent is checked set global to 'student'\nthen with other winforms can call select statements or enable/visible based on what the global is.</p>\n\n<hr>\n\n<p>I believe I can store variables in <strong>Programs.cs</strong> but I'm not sure.</p>\n"},{"tags":["sql-server","triggers","updatable-views","merge-statement"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13113909,"title":"Instead of Trigger on View using Merge doesn't apply table default values","body":"<p>I have an updateable view using an instead of trigger for insert/update. That trigger uses Merge. I'm finding that the Merge statement isn't applying the default constraints from the underlying physical table, although the merge documentation suggests it should.</p>\n\n<p>The following example demonstrates:</p>\n\n<pre><code>create table tblTest\n(\n    id uniqueidentifier not null primary key default newid(),\n    forename varchar(20),\n    surname varchar(20) not null default 'xxyyzz'\n)\ngo\n\ncreate view vwTest as select * from tblTest\ngo\n\ncreate Trigger vwTest_trigger_insteadof_insert_update On vwTest\nInstead of Insert, Update As\nbegin\nset nocount on\nMerge tblTest t\n\nUsing\n    inserted i On (t.id = i.id)\n\nWhen Matched Then\n    Update\n        Set\n        t.forename = i.forename,\n        t.surname = i.surname\n\nWhen Not Matched By Target Then\n    Insert\n    (\n        id,\n        forename,\n        surname\n\n    )\n    Values\n    (\n        i.id,\n        i.forename,\n        i.surname\n\n    )\nOUTPUT $action, Inserted.*, Deleted.*\n;\nend\ngo\n\n--Inserts to physical table work as expected\ninsert into tblTest (id) values (newid())\ninsert into tblTest (surname) values ('smith')\n\n--Inserts into updateable view fail as no defaults are set\n--from the underlying physical table\ninsert into vwTest (id) values (newid())\ninsert into vwTest (surname) values ('jones')\n</code></pre>\n\n<p>I see someone had something similar in <a href=\"http://stackoverflow.com/questions/2200731/using-default-values-in-an-instead-of-insert-trigger\">Using default values in an INSTEAD OF INSERT trigger</a> and solved it by copying the rows in inserted into a temporary and then altering the temp table to add in the default constraints from the physical table. I'm not sure I could tolerate the performance issues of these additional steps.</p>\n"},{"tags":["sql","sql-server","query","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":63,"score":-1,"question_id":13112759,"title":"How to select a record that is between two dateranges and two input parameters StartDate and EndDate in SQL server?","body":"<p>In my database I have a group which can be active in a week with opening hours.<br>\nGroup A Startdate: 22-10-2012 EndDate: 28-10-2012 (Startdate is always beginning of the week)<br>\nGroup A Startdate: 29-10-2012 EndDate: 04-11-2012 (Always end of the week)</p>\n\n<p>Group A has two different opening hours in this two weeks. </p>\n\n<p>Now I have a stored procedure that returns the active group by looking the input parameters StartDate and EndDate. If this two parameters are between the startdate and end date of ONE week then I'm getting the right opening hours.</p>\n\n<p>But when the input parameters are about TWO weeks (Begindate: 22-10-2012 and EndDate: 30-10-2012) then I get the opening hours of two weeks.  </p>\n\n<pre><code>declare @Begindate datetime    \nset @Begindate = '2012-10-22'\n\ndeclare @Enddate datetime   \nset @Enddate = '2012-11-02'\n\n\nSELECT Id, Date, ..., ...   \nFROM Table1 t1  \nINNER JOIN Combinations c ON t1.Id=c.Table1Id\nINNER JOIN Group g ON c.GroupId=g.Id  \nWHERE t1.Date&lt;= @Enddate) AND (t1.Date&gt;= @Begindate  (gets dates I need)   \nAND g.BeginDate &lt;=@Enddate and g.Enddate &gt;= @Begindate (Gets active groups)\n\n\nSome table data:\n\nTable1:\n\nId    Date         GroupId\n1     2012-10-23   10\n1     2012-10-29   10\n\n\n\nCombinations: (holds the relation between Table1 and Group)\n\nID  Table1Id    GroupId\n1   10          1\n\n\nGroup Table:\n\nID    Name     StartDate   EndDate     MondayOpen   MondayClose ...\n1     Group A  2012-10-22  2012-10-28  08:00        18:00\n1     Group A  2012-10-29  2012-11-04  13:00        18:00\n</code></pre>\n\n<p>With this query I am getting a group two times because both the inputparametes are over two weeks. </p>\n\n<p>How can I get for the dates (from t1) the correct opening dates looking the group Begin and End date?</p>\n"},{"tags":["sql-server","windows-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":386,"score":0,"question_id":10552467,"title":"Cannot Open Microsoft SQL Server Management Studio","body":"<p>I have a big problem. While am opening Microsoft SQL Server Management Studio it appears me an error: </p>\n\n<p>\"Cannot find one or more components. Please reinstall the application\"</p>\n\n<p>I was searching solutions in Internet but I didn't found anything helpful.</p>\n\n<p>I have SQL Server 2012 and Windows Server 2008 R2.</p>\n\n<p>Some suggestion?</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","asp.net","sql-server","visual-studio-2010","asp.net-mvc-3"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":203,"score":1,"question_id":7776437,"title":"Visual Studio 2010 SQL Developement Server stopped working","body":"<p>I was making minor modifications to a view in my ASP.NET MVC3 C# appication when all of a sudden the application would no longer run.  The error message is as follows:  </p>\n\n<p>System.Data.SqlClient.SqlException: A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Shared Memory Provider, error: 40 - Could not open a connection to SQL Server)</p>\n\n<p>Upon close inspection of the server explorer I noticed that all database connections are no longer working.  I cannot expand any of the connections to view the tables and data I previously generated within.  When I attempt to, there is a pop-up window that is generated that repeats the exact same error as above.  </p>\n\n<p>It is important to note that I was not making any modifications to any portion of the aplication that pertains to a database.  I was rearangeing some of the visual components of a view in my application when all of this occurred.  I had just recently restarted my computer and had made no other modificatins since that time.  </p>\n\n<p>At first I thought that somehow SQL Express had overwritten my developement envirnments verson of sql server and began to reinstall sql express.  The installation fails every time now.  There is no specific error.  Windows generates an error message saying that the setup application \"stoped working\" and hangs until closed.  I have tried several different versions of the sql express installation package and they all result in the same error happeneing at different points in the installation process.  To be clear, I'm not even sure sql express is the problem.  I don't know why it would be since I'm using the sql server that is built into visual studio 2010.  </p>\n\n<p>I am at an impass and cannot continue with my work until this is resolved.  If I can't resolve it I don't get to continue to work so any input you can give me will be greatly appreciated.  I won't be sleeping until I can get this working again.</p>\n\n<p>D.A.P.</p>\n"},{"tags":["sql-server","stored-procedures"],"answer_count":5,"favorite_count":0,"up_vote_count":10,"down_vote_count":0,"view_count":17350,"score":10,"question_id":2397161,"title":"How to convert int to char with leading zeros?","body":"<p>I need to convert int data table field to char leading zeros</p>\n\n<p>example:</p>\n\n<p>1 convert to '001'</p>\n\n<p>867 convert to '000867'</p>\n\n<p>thx.</p>\n\n<hr>\n\n<p>This is my response 4 Hours later ...</p>\n\n<p>I tested this T-SQL Script and work fine for me !</p>\n\n<pre><code>DECLARE @number1 INT, @number2 INT\n\nSET @number1 = 1\n\nSET @number2 = 867\n\nSELECT RIGHT('000' + CAST(@number1 AS NCHAR(3)), 3 ) AS NUMBER_CONVERTED\n\nSELECT RIGHT('000000' + CAST(@number2 AS NCHAR(6)), 6 ) AS NUMBER_CONVERTED\n</code></pre>\n\n<hr>\n\n<p>I created this user function</p>\n\n<p>T-SQL Code :</p>\n\n<pre><code>CREATE FUNCTION CIntToChar(@intVal BIGINT, @intLen Int) RETURNS nvarchar(20)\nAS\nBEGIN\n\n    -- BIGINT = 2^63-1 (9,223,372,036,854,775,807) Max size number\n\n    -- @intlen contains the string size to return\n    IF @intlen &gt; 20\n       SET @intlen = 20\n\n    RETURN REPLICATE('0',@intLen-LEN(RTRIM(CONVERT(nvarchar(20),@intVal)))) \n        + CONVERT(nvarchar(20),@intVal)\n\nEND\n</code></pre>\n\n<p>Example :</p>\n\n<p>SELECT dbo.CIntToChar(  867,  6  ) AS COD_ID</p>\n\n<p>OUTPUT</p>\n\n<p>000867</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":18,"score":-1,"question_id":13110662,"title":"Searching for various numbers from a given list inside a table","body":"<p>I have a simple question that i could not find any reference to and i would appreciate any help.\ni have a list of user_ids sent from the client to the server - for example - (1,2,3,4)\nand i want to search in a table of groups how many time each group got the those users inside.\nthe groups table's columns are : group_id,group_name,user_id</p>\n\n<p>and i want the result to show each group name and the number of times number from the searched list's numbers appear inside.</p>\n\n<p>i also want to show if it doesn't as 0.</p>\n\n<p>example:</p>\n\n<pre><code>groupName     NumOfCustomersFromTheSentListThatAreAttachedToTheGroup\n  A                   0\n  B                   3\n</code></pre>\n\n<p>i was thinking something like:\nselect group_id,COUNT(userID) FROM userByGroup where userID in (1,2,3,4) group by group_id;</p>\n\n<p>but then i have 2 problems:</p>\n\n<ol>\n<li>i don't see that ones with no appearance (because of the WHERE)</li>\n<li>i get a record for each appearance and i want a record for each group</li>\n</ol>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13110592,"title":"Store table in separate filegroup in SQL Server","body":"<p>I have big SQL Server database, with a lot of blob data in some tables.</p>\n\n<p>For performance optimization, I want to move one table to separate hard drive.</p>\n\n<p>I created new filegroup, and \"row data\" file.</p>\n\n<p>But, I can't change any parameters in table properties: they are all disabled.</p>\n\n<p>And I don't know a way to enable it.</p>\n\n<p>Can anybody help me?</p>\n\n<p><img src=\"http://i.stack.imgur.com/KTyAu.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server","common-table-expression"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":13094576,"title":"Finding the next result when none is found?","body":"<p>I am attempting to traverse a hierarchy with a CTE and it works fine in one scenario but not another and that is where I am stuck. </p>\n\n<p>Given the query;</p>\n\n<pre><code>;WITH BOMcte (ID, Code, BomName , ProductID, ProductCode, ProductName , ParentAssemblyID )\nAS\n(\n    SELECT   b.id,\n             b.code,\n             b.name,\n             p.id,\n             p.default_code,\n             p.name_template,\n             b.bom_id\n    FROM mrp_bom AS b\n    INNER JOIN product_product p on b .product_id = p.id    \n    WHERE b. bom_id IS NULL \n    and b.id = @AssemblyID \n    UNION ALL\n    SELECT   b.id,\n             b.code,\n             b.name,\n             p.id,\n             p.default_code,\n             p.name_template,\n             b.bom_id\n    FROM mrp_bom AS b\n    INNER JOIN product_product p on b .product_id = p.ID    \n    INNER JOIN BOMcte AS cte ON b.bom_id = cte.ID    \n)\nSELECT BoM.* FROM BOMcte BoM\n</code></pre>\n\n<p>The query works just as I expected because the BoM drills down to the child boms on the column bom_id. </p>\n\n<p>In code (from OpenERP) when a child BoM isn't found, (no bom_id) a child product is searched for based on the product_id:</p>\n\n<pre><code>sids = bom_obj.search(cr, uid, [('bom_id','=',False),('product_id','=',bom.product_id.id)])\n</code></pre>\n\n<p>I am wondering if there is a method I can use to accomplish the same thing in SQL. Once the CTE doesn't return rows, check with the product_id and a null bom_id. I had thought about another recursive member but I don't think that's what I am looking for.</p>\n\n<p>I know my question probably isn't very clear but, any suggestions?</p>\n\n<p>SQL Fiddle example data here: <a href=\"http://sqlfiddle.com/#!3/b9052/1\" rel=\"nofollow\">http://sqlfiddle.com/#!3/b9052/1</a></p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":57,"score":0,"question_id":13109370,"title":"Match two Columns in SQL Join","body":"<p>I have following Table Structure :</p>\n\n<p>Table: CashStatus (Can have duplicate entries for \"ATM\")</p>\n\n<pre><code>ATM  Cash   Device\nA01  55     BASE\nA01  1      IST\nA02  1      BASE\nA02  78     IST\n</code></pre>\n\n<p>Table : ATM (Unique Entry for ATM Column)</p>\n\n<pre><code>ATM   DEVICE\nA01   BASE\nA02   IST\n</code></pre>\n\n<p>I want to retreive only those rows from <code>CashStatus</code> table who's <code>ATM &amp; Device</code> Column matches with as with <code>ATM</code> Table</p>\n\n<p>I did some research and tried the following query:-</p>\n\n<pre><code>SELECT *\n  FROM CashStatus \n WHERE EXISTS (SELECT 'X'\n                 FROM ATM\n                WHERE ATM = TermId collate SQL_Latin1_General_CP1_CI_AS\n               AND DeviceName = Devicetype collate SQL_Latin1_General_CP1_CI_AS);\n</code></pre>\n\n<p>But it gives error : <code>Expression type int is invalid for COLLATE clause.</code></p>\n"},{"tags":["sql","sql-server","replication"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1801,"score":4,"question_id":4744282,"title":"SQL Server : subscription : how to know if a table is under replication/subscription","body":"<p>In SQL Server, on the \"Subscription side\", how can you know if a table is under replication/subscription?</p>\n\n<p>Any idea?</p>\n"},{"tags":["sql","sql-server","tsql","pivot"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":13103114,"title":"T:SQL: select values from rows as columns","body":"<p>I have a table for Profiles stores profile properties values in row style, ex:</p>\n\n<pre><code>[ProfileID]     [PropertyDefinitionID]      [PropertyValue]\n1               6                           Jone\n1               7                           Smith\n1               8                           Mr\n1               3                           50000\n</code></pre>\n\n<p>and another table for property definitions :</p>\n\n<pre><code>[PropertyDefinitionID]  [PropertyName]\n6                       FirstName\n7                       LastName\n8                       Prefix\n3                       Salary\n</code></pre>\n\n<p>How to use <code>PIVOT</code> or any other way to show it in this way:</p>\n\n<pre><code>[ProfileID] [FirstName] [LastName]  [Salary]\n1           Jone        Smith       5000\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":13090398,"title":"Avoid duplicate names in a dataset","body":"<p>I am fetching data from a table and binding to a label and Drop down in a gridview but i want to filter the duplicate names from the table and assign the corresponding dates to the DDL how can do this? or else is there any other alternative?</p>\n\n<pre><code> private DataSet get()\n    {\n        string sql = \"select Id,Name,RunDate from Historytable\";\n        SqlDataAdapter da=new SqlDataAdapter(sql,con);\n        DataSet ds=new DataSet();\n        da.Fill(ds);\n        return ds;\n    }\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/NZuWG.png\" alt=\"enter image description here\"></p>\n\n<pre><code> protected void GridView1_RowDataBound1(object sender, GridViewRowEventArgs e)\n    { \n\n        //what to code here?\n\n\n        }\n</code></pre>\n"},{"tags":["c#","sql-server","date","datetime","insert"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":56,"score":0,"question_id":13110170,"title":"How can I run auto datetime in SQL Server?","body":"<p>I use C# .NET</p>\n\n<p>I need run auto <code>datetime</code> in my project and save in SQL Server</p>\n\n<p><strong>Exam.</strong></p>\n\n<p>In SQL Server</p>\n\n<pre><code>Datetime    | workDate\n-------------------------\n25-10-2012  | work\n26-10-2012  | work\n28-10-2012  | work\n</code></pre>\n\n<p>In my project, I'm searching datetime between 25-28</p>\n\n<p>I need program output</p>\n\n<pre><code>25-10-2012  work\n26-10-2012  work\n27-10-2012  null\n28-10-2012  work\n</code></pre>\n\n<p>But now I get:</p>\n\n<pre><code>25-10-2012  work\n26-10-2012  work\n28-10-2012  work\n</code></pre>\n\n<p>Because my data save status work only when status don't work it's not save in database.</p>\n\n<p>How can I use insert value null, show data to my project and save in SQL Server?</p>\n\n<p>Thanks For your Time :).</p>\n"},{"tags":["sql","sql-server","stored-procedures","group-by","informix"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":13093683,"title":"MS SQL To Informix 11 - Group By converted datetime","body":"<p>I am attempting to move a stored proceedure from Microsoft SQL Server 2000 to Informix 11. The original SP contains a final select statement with a GROUP BY statement that includes a converted datetime:</p>\n\n<pre><code>group by convert(varchar(8), c.startDateTime, 1)\n</code></pre>\n\n<p>When i convert this to Infomrix syntax the get a syntax error at run time:</p>\n\n<pre><code>GROUP BY (c.startDateTime::DATETIME YEAR TO DAY)::VARCHAR(10)\n</code></pre>\n\n<p>Can someone please point me to how, if possible, this can be done in Informix?  If this is not possible, which I suspect, how would you typically handle this in the overall query?</p>\n"},{"tags":["php","sql-server","database"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13109012,"title":"From PDO to SQLSRV","body":"<p>I used PDO for MYSql before but now i need to use Microsoft SQL Server Driver for PHP.</p>\n\n<p>I found the manual.\n<a href=\"http://php.net/manual/en/book.sqlsrv.php\" rel=\"nofollow\">http://php.net/manual/en/book.sqlsrv.php</a></p>\n\n<p>I use Example #2 to connect to the new SQL database:\n<a href=\"http://www.php.net/manual/en/function.sqlsrv-connect.php\" rel=\"nofollow\">http://www.php.net/manual/en/function.sqlsrv-connect.php</a></p>\n\n<p>How do I 'convert' the following (PDO mysql) to work with sqlsrv: </p>\n\n<pre><code>$username = 'test';\n\ntry {\n$conn = new PDO('mysql:host=$host;dbname=$database', $username, password);\n$stmt = $conn-&gt;prepare('SELECT username users WHERE username = :username LIMIT 1');\n$stmt-&gt;execute(array('username' =&gt; $username));\n\nif ($stmt-&gt;rowCount() &gt; 0) {\n$result = $stmt-&gt;fetch();\n\n    echo $result['username'];\n\n} else {\n    echo 'Nothing found.';\ndie();\n}\n} catch(PDOException $e) {\necho 'ERROR: ' . $e-&gt;getMessage();\n}\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13109526,"title":"SQL Counting (More than)","body":"<pre><code>distrikt = district\n\nSELECT POST.distrikt, COUNT(PERSON.personnr)\n  FROM [dbo].POST join [dbo].PERSON on POST.postnr = PERSON.postnr\n  WHERE ?\n  GROUP BY POST.distrikt\nGO\n</code></pre>\n\n<p>I need to view the districts showing the number of persons associated with each, but it should only show the districts which contain 2 or more persons. I tried using <code>COUNT(PERSON.personnr) &gt; 2</code>, but that didn't work. Apart from that, it shows the districts and associated persons just fine. </p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":5,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":453,"score":0,"question_id":9788599,"title":"SQL: Join with substrings","body":"<p>I have a table <strong>A</strong> with the string-column <strong>a</strong> and a table <strong>B</strong> with the string-column <strong>b</strong>. a is a substring of b. Now I want to <strong>join</strong> the the to tables via <strong>a and b</strong>. Is this possible?</p>\n\n<p>I want something like this:</p>\n\n<p><strong><code>Select * from A,B where A.a *\"is substring of\"* B.b</code></strong></p>\n\n<p>How can I write this in <strong>SQL</strong> (Transact-SQL)?</p>\n"},{"tags":["sql","sql-server","visual-studio"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13108956,"title":"Get first table count which has been unioned into multiple tables","body":"<p>Here is a pseudo code what I want.\nI need to get count of fist union in following statement.</p>\n\n<pre><code>SELECT *  \nFROM Table1 \nUNION \nSELECT Cats.Id + (SELECT COUNT(*) FROM Fist_Union_Result), \n       Cats.Name \nFROM Table2\n</code></pre>\n\n<p>Any idea ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":3,"view_count":58,"score":-1,"question_id":13099038,"title":"Get max of column using sum","body":"<p>I have one table with following data..</p>\n\n<pre><code>saleId amount date\n-------------------------\n  1     2000  10/10/2012\n  2     3000  12/10/2012\n  3     2000  11/12/2012\n  2     3000  12/10/2012\n  1     4000  11/10/2012\n  4     6000  10/10/2012\n</code></pre>\n\n<p>From my table I want result with max of sum amount between dates 10/10/2012 and 12/10/2012 which for the data above will be:</p>\n\n<pre><code>saleId  amount \n---------------\n1       6000\n2       6000\n4       6000\n</code></pre>\n\n<p>Here 6000 is the max of the sums (by saleId) so I want ids 1, 2 and 4.</p>\n"},{"tags":["sql-server","visual-studio","linq-to-entities"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":443,"score":2,"question_id":7947959,"title":"How do I add a database diagram in visual studio 2010?","body":"<p>I created a database in App_Data, but when I try to generate a diagram for it by right clicking on  \"Database Diagrams\" and then adding a new diagram I get the error: \"Could not obtain information about Windows NT group/user\"</p>\n\n<p>with the error code 0x534</p>\n\n<p>Does anyone know how I can create database diagrams?</p>\n\n<p>I tried googling but no obvious answers came up.</p>\n"},{"tags":["sql-server","xml","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":30,"score":2,"question_id":13109025,"title":"Quering XML in SQL Server without a schema","body":"<p>I have a database that stores a large chunk of XML containing information about installations our companies products. There is no schema defined for the XML and no one has a list of all potential tags.</p>\n\n<p>Each record has hundreds of structures like this: </p>\n\n<pre><code>&lt;array type=\"DWORD\" name=\"m_somesetting.SMTPPorts\" size=\"5\"&gt; \n   &lt;set&gt;19&lt;/set&gt; \n   &lt;set&gt;1D0&lt;/set&gt; \n   &lt;set&gt;14B&lt;/set&gt; \n&lt;/array&gt;\n</code></pre>\n\n<p>I have been asked to create a table showing each possible tag a value and a count of how many of our tens of thousands of records have that particular setting.</p>\n\n<p>Does anyone know how I might automate this? I have a reasonable understanding of how to do queries against XML but I need some way to first get each tag that exists and then get each unique value that exists and finally a count of records that contain that value.</p>\n\n<p>Any ideas of how to do this short of hand coding each possible tag into a query?</p>\n"},{"tags":["sql","sql-server","visual-studio","ado.net","entitydatasource"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":23,"score":-1,"question_id":13108810,"title":"ADO.NET EntityDataSource Error >> The right expression must be of numeric or string type","body":"<p>I have two tables which I want to merge them into one as a view or query.</p>\n\n<pre><code>(SELECT \n     MainCats.Id, MainCats.Name AS Title, CAST(NULL AS System.String) AS PID \n FROM MainCats) \n\nUNION \n\n(SELECT \n     Cats.Id +  (SELECT COUNT(MainCats.Id) FROM MainCats), Cats.Name, Cats.CatID \n FROM Cats)\n</code></pre>\n\n<p>The error is about third <code>Select</code> which contains <code>Count</code> .</p>\n\n<p>All I need is to get a scalar value.</p>\n\n<p>Also I have tried to CAST whole select to numeric type with no luck.</p>\n\n<p>Any idea ?</p>\n"},{"tags":["sql-server","datetime","order"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":34,"score":-3,"question_id":13108962,"title":"SQL Server ORDER BY by datetime","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13108785/order-by-sql-timestamp\">Order by SQL timestamp</a>  </p>\n</blockquote>\n\n\n\n<p>I have a column added to every row which is filled with the <code>NOW()</code> function. This column is of datatype <code>DATETIME</code> and looks like this: <code>2012-10-28 13:50:40</code>. </p>\n\n<p>Can I just use the SQL <code>ORDER BY DESC</code>, to show the latest entries first? </p>\n\n<p>Thanks!\nSander</p>\n"},{"tags":["sql-server","entity-framework","ef-code-first","data-migration","code-first-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":13103349,"title":"How to add a new code-first migration with a newly-generated database?","body":"<p>I've enabled code-first migrations on my entity framework project, and have added several migrations which do things like rename tables.  However, I have now deleted the database and caused entity framework to generate a brand new database based on my latest data model.  If I try to run:</p>\n\n<pre><code>PM&gt; Add-Migration TestMigration\n</code></pre>\n\n<p>... it tells me that I need to apply the existing migrations first.  So I run:</p>\n\n<pre><code>PM&gt; Update-Database\n</code></pre>\n\n<p>... but the trouble is that it's trying to update a database that doesn't need updating; it's already based on the latest data model.  So I get an error when it tries to rename a table that now doesn't exist.</p>\n\n<p>Is there some way I can indicate to data migrations that my database is up-to-date and doesn't need any migrations running on it?  What should I do?</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":48,"score":4,"question_id":13108590,"title":"SELECT COUNT within date range","body":"<p>I'm trying to get a count of emails received during a date range using MSSQL Express 2005. I've managed that much, but now I want to split out the data into what was done with it. </p>\n\n<p>Here's what I've got so far: </p>\n\n<pre><code>SELECT EmailAddress, COUNT(EmailAddress) \n  FROM mails \n  WHERE ReceivedTime &gt;= DATEADD(DAY, -7, GETDATE()) \n  GROUP BY EmailAddress\n    HAVING COUNT(EmailAddress) &gt; 10\n</code></pre>\n\n<p>That gives me a list of addresses who mailed more than 10 times in the last week, but we have another column that tells us what happened with the mail. I'm trying to achieve something like this: </p>\n\n<pre><code>SELECT EmailAddress, \n  COUNT(ActionTaken WHERE ActionTaken=\"Deleted\") AS Deleted,\n  COUNT(ActionTaken WHERE ActionTaken=\"Replied\") AS Replied,\n  COUNT(ActionTaken WHERE ActionTaken=\"Read\") AS Read,\n  COUNT(EmailAddress) AS Total\n  FROM mails \n  WHERE ReceivedTime &gt;= DATEADD(DAY, -7, GETDATE()) \n  GROUP BY EmailAddress\n    HAVING COUNT(EmailAddress) &gt; 10\n</code></pre>\n\n<p>I'm looking for a result set along these lines: </p>\n\n<pre><code> EmailAddress     | Deleted | Replied | Read | Total\n ---------------------------------------------------\n user1@domain.com | 4       | 5       | 3    | 12\n user2@domain.com | 2       | 6       | 3    | 11\n</code></pre>\n\n<p>I'm pretty sure it has something to do with using OVER(PARTITION BY) clauses, but I've hit a wall. I realise the ActionTaken field isn't ideal, but I didn't build it!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","delete","delete-row"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":13108778,"title":"Fast deletion of many rows in data warehouse data","body":"<p>In SQL Server 2008 I have some million rows of data which needs be deleted. They are scattered across a handful of tables. Deletion takes up to 20 seconds which I think is way to slow! The data to be deleted is identified by a <code>timestamp</code> column. Here is what I have done so far in order to optimize:</p>\n\n<ul>\n<li>Using isolation level <code>read uncommitted</code>. I don't care about transactions. If we fail the user will issue the delete operation again. And new data is ensured not to have the <code>timestamp</code> we are deleting.</li>\n<li>Deleting leaf tables before parent tables.</li>\n<li>The <code>timestamp</code> column is part of the PK clustered index, in fact its the first position of the PK/index.</li>\n<li>Each table is emptied using a loop which deletes top 200000 entries in order to reduce the transaction log overhead.</li>\n<li>Neither I/O nor CPU is maxed out on the server</li>\n</ul>\n\n<p>What have I overlooked? </p>\n\n<p>Also I am in doubt of the effect of moving the timestamp column to  the first position in the PK. After doing so, must I reorganize the tables or is SQL Server smart enough to do this itself. My understanding of clustered index is that since it defines the physical layout of the rows, it is force into reorganizing the data. But we have no complaints from the customer that the changing clustered index operation took a long time to perform.</p>\n"},{"tags":["sql-server","sql-server-2008","ssms","ssms2008"],"answer_count":4,"favorite_count":3,"up_vote_count":15,"down_vote_count":0,"view_count":6838,"score":15,"question_id":2004789,"title":"How to alter SQL in \"Edit Top 200 Rows\" in SSMS 2008","body":"<p>In SQL Server 2008 Management Studio, when I right click on a database table and choose \"<strong>Select Top 100 Rows</strong>\", I can then e.g. easily add a \"ORDER BY \" statement to the SQL. That works <strong>fine</strong>.</p>\n\n<p>But when I do choose \"<strong>Edit Top 200 Rows</strong>\", I don't have the ability to <strong>alter</strong> the SQL (which makes it hard to find and edit a record just added in the 10,000 that are there.</p>\n\n<p>I am quite sure I was able to do this in <strong>SQL Server 2000</strong>.</p>\n\n<p><strong>Is there any way in SMSS 2008 to alter the way the records are displayed when editing records?</strong></p>\n"},{"tags":["asp.net","sql-server","vb.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13106142,"title":"Move from VB executeScalar to dynamic selection","body":"<p>I have a menu that has image buttons selected with VB using a method that selects the first image of the list of items shown if you click on that menu item. What I'm trying to do is to display a random image instead. Currently there is this method in VB controlling the image shown.</p>\n\n<pre><code>    Dim conn As New SqlConnection()\n        Dim cmd As New SqlCommand()\n\n        conn.ConnectionString = FlashDB.ConnectionString\n        cmd.Connection = conn\n        cmd.CommandType = CommandType.StoredProcedure\n        cmd.CommandText = \"get_first_flash\"\n\n        Dim idParam As New SqlParameter(\"@collectionID\", CollectionID)\n        cmd.Parameters.Add(idParam)\n\n\n        Dim result As Object\n        Dim previousConnectionState As ConnectionState = conn.State\n        Try\n            If conn.State = ConnectionState.Closed Then\n                conn.Open()\n            End If\n            result = cmd.ExecuteScalar()\n\n        Finally\n            If previousConnectionState = ConnectionState.Closed Then\n                conn.Close()\n            End If\n        End Try\n\n        Return \"images/thumbnails/\" &amp; result\n\n   //In the html\n   &lt;a href='viewproject.aspx?swfID=&lt;%# Eval(\"swfID\") %&gt;' &gt;\n         &lt;img src=\"images/thumbnails/&lt;%# Eval(\"thumbnail\") %&gt;\"\n              height=\"150\" width=\"180\" /&gt;&lt;/a&gt;\n</code></pre>\n\n<p>Is there a different method I can use to skip using executeScalar to give me that dynaimic response as apposed to a image in the first row.</p>\n\n<p>Thanks</p>\n"},{"tags":["mysql","sql","sql-server","visual-studio-2010","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":655,"score":0,"question_id":6311124,"title":"error 26 on sql server","body":"<p>I have prepared a program with Visual Basic 2010 and am using SQL database. (service based database) it works properly. But sometimes (when i dont use computer for a period like 2 hours) I try to start my program on VB (F5), it waits, and then gives this error:</p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occured while establishing a connection to SQL Server. The server was not found or is not accesible. Verify that the instance name is correct and that SQL Server name is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified.)</p>\n</blockquote>\n\n<p>However, after restarting my computer one or two times, there is no error: it works well. I have googled it, but nothing helps. I'm afraid this error will be a problem when the user uses the program. How might I solve this?</p>\n"},{"tags":["java","sql-server","netbeans"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":884,"score":1,"question_id":6892783,"title":"connecting to SQL Server from Netbeans","body":"<p>I am trying to connect to a server instance of SQL Server 2010 that I installed recently using NetBeans. I have downloaded the latest JDBC driver for MS SQL Server, but I cannot get the right connection string to connect to this database. I think I am missing the following values in the connection:</p>\n\n<ul>\n<li>Port</li>\n<li>Instance Name</li>\n<li>and I am not sure if my username should be <strong><em></strong>/</em>*** or only the name that appears after the /</li>\n</ul>\n\n<p>'jdbc:sqlserver://'</p>\n\n<p>Any help appreciated,</p>\n\n<p>Ted</p>\n"},{"tags":["c#","sql-server","view","entity-framework-4.1"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13107723,"title":"SQL text cannot be represented in the grid pane and diagram pane","body":"<p>I am working on entity Model.  I updated the view to entity model, but this view not showing the correct data.  I searched on Google, and a few members suggested that add one more column to the view. So, I just added one column to the View.</p>\n\n<p><code>row_number()</code> over (order by <code>Employee.EmployeeID</code>) as PK,</p>\n\n<p>In the Employee table the <code>EmployeeId</code> column is identity column.</p>\n\n<p>I run the entity model. Now, the view is showing correct data. The problem is when I see the view design in SQL, it is not showing.  When I remove the <code>row_number()</code> from the view, it is showing in the design of the view.</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13099101,"title":"SSIS Package Login failed while executing as Scheduled Job","body":"<p>I Have Created SSIS package which selects data from Source DB and Inserts it in my Destination DB. All the Connections string are Working fine as the Test Connection  is Succeeded when i debug the package.</p>\n\n<p><strong>My package Executes well when i run it in Visual Studio. But If i try to run it as Scheduled Job in SQL Server . It gives me error as</strong> <code>Data Flow Task ADO NET Source [1]  \"Login Failed for user 'ags' for Source Database\"</code> </p>\n\n<p>My Source DB is remotely Located.  </p>\n\n<p>Package Settings :</p>\n\n<pre><code>EncryptAllWithPassword\n</code></pre>\n\n<p>SQL Agent Settings</p>\n\n<pre><code>Owner : uagsrep (My SQL Server User)\nType : SQL Server Integration Service Package\nRun AS : SQL Server Agent Service Account\n</code></pre>\n\n<p>Database is SQL Server 2008</p>\n"},{"tags":["sql-server"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":7445,"score":0,"question_id":312576,"title":"How to simply generate the CREATE SQL script for a table and data?","body":"<p>So i'm used to PHPMySQL where if I want to transfer a table from one database to another, I:</p>\n\n<ul>\n<li>go to the table</li>\n<li>click \"export\"</li>\n<li>CTRL-C</li>\n<li>go to the other database, insert SQL, CTRL-V</li>\n</ul>\n\n<p>In MS SQL Server 2008 Express, I try:</p>\n\n<ul>\n<li>right-click, script table as, CREATE TO\n<ul>\n<li>but this only gives me the CREATE TABLE sql, not the INSERT INTO sql</li>\n</ul></li>\n<li>right-click, script table as, INSERT TO\n<ul>\n<li>this gives me INSERT TO sql but assumes that I am going to fill in the data (!)</li>\n</ul></li>\n<li>so I fire up the SQL Server 2008 Express Import/Export Data Wizard, but it doesn't seem to give me the simple CREATE/INSERT INTO script that I want either. :-(</li>\n</ul>\n\n<p>So how can I get a simple SQL dump of a table in MS SQL Server 2008 Express, the kind that PHPMySQL gives me:</p>\n\n<pre><code>-- phpMyAdmin SQL Dump\n-- version 2.11.9.2\n-- http://www.phpmyadmin.net\n--\n-- Host: localhost\n-- Generation Time: Nov 23, 2008 at 03:34 PM\n-- Server version: 5.0.67\n-- PHP Version: 5.2.6\n\nSET SQL_MODE=\"NO_AUTO_VALUE_ON_ZERO\";\n\n--\n-- Database: `test`\n--\n\n-- --------------------------------------------------------\n\n--\n-- Table structure for table `members`\n--\n\nCREATE TABLE IF NOT EXISTS `members` (\n  `id` int(11) NOT NULL auto_increment,\n  `firstName` varchar(50) collate latin1_general_ci NOT NULL,\n  `lastName` varchar(50) collate latin1_general_ci NOT NULL,\n  `age` int(11) NOT NULL,\n  PRIMARY KEY  (`id`)\n) ENGINE=MyISAM  DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci AUTO_INCREMENT=4 ;\n\n--\n-- Dumping data for table `members`\n--\n\nINSERT INTO `members` (`id`, `firstName`, `lastName`, `age`) VALUES\n(1, 'Jim', 'Taylor', 34),\n(2, 'John', 'McGregor', 23),\n(3, 'Alice', 'Anderson', 33);\n</code></pre>\n"},{"tags":["c#",".net","sql-server","ado.net",".net-3.0"],"answer_count":6,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":838,"score":0,"question_id":6889041,"title":"Parameterised DataTable Split","body":"<p>I wrote a method for splitting a DataTable into multiple small data tables; however I am getting exception. How do I correct it? Please share the code.</p>\n\n<p>Exception message:</p>\n\n<blockquote>\n  <p>This row already belongs to another table.</p>\n</blockquote>\n\n<p>Framework: .Net 3.0</p>\n\n<pre><code>private static List&lt;DataTable&gt; SplitDataTable(DataTable dt, int size)\n{\n    List&lt;DataTable&gt; split = new List&lt;DataTable&gt;();\n    DataTable current = dt.Clone();\n    int iterator = 0;\n    foreach (DataRow dr in dt.Rows)\n    {\n        iterator = iterator + 1;\n        if (iterator == size)\n        {\n            current = dt.Clone();\n            split.Add(current);\n            iterator = 0;\n        }\n        current.Rows.Add(dr);\n        //Exception: This row already belongs to another table.\n    }\n    return split;\n}\n</code></pre>\n\n<p>Client:</p>\n\n<pre><code>static void Main(string[] args)\n{\n    DataTable dt = new DataTable();\n    dt.Columns.Add(\"TEST\", typeof(int));\n    dt.Columns.Add(\"VAL\", typeof(string));\n    dt.Rows.Add(0,\"a\");\n    dt.Rows.Add(1,\"b\");\n    dt.Rows.Add(2,\"c\");\n    dt.Rows.Add(3,\"d\");\n\n    List&lt;DataTable&gt; split = SplitDataTable(dt, 2);\n}\n</code></pre>\n"},{"tags":["sql","sql-server","ms-access"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1409,"score":1,"question_id":3145270,"title":"select from access database file and insert to sql Database","body":"<p>I have an access database file (test.mdb) and I need to write a stored procedure which will select some records from tblTest in test.mdb and insert them into tbsqlTest in my sql database .\n==> I need a SP like this :</p>\n\n<pre><code>BEGIN\n    select * into tblTest from [test.mdb].[tblTest]\n    where (my condition)\nEND\n</code></pre>\n"},{"tags":["sql-server","tsql","sql-server-2008","ssms2008"],"answer_count":3,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":686,"score":5,"question_id":7207779,"title":"Scripts all Sprocs at once with DROP and CREATE","body":"<p>SQL Server 2008</p>\n\n<p><strong>Goal:</strong> To generate scripts for creating sprocs that are already in the DB. Must be one script per file.</p>\n\n<p>I know I can simply right click the database and 'Tasks>Generate Scripts', but that doesn't script the sproc in the template I want.</p>\n\n<p>I need the sproc to be scripted in the same template you get when you right click the sproc from the object explorer and 'Script Stored Procedure As>DROP and CREATE'.</p>\n\n<p>It's true you get a similar version of this through 'Tasks>Generate Scripts' but the main difference is the 'Tasks>Generate Scripts' method creates the script via the <code>dbo.sp_executesql</code> command because you cannot nest a <code>CREATE PROCEDURE</code> inside of an <code>IF</code> block</p>\n\n<p>Tasks>Generate produces this:</p>\n\n<pre><code>USE someDB\nGO\n\nIF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'somesproc') AND type in (N'P', N'PC'))\nDROP PROCEDURE someSproc\nGO\n\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nIF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'someSproc') AND type in (N'P', N'PC'))\nBEGIN\nEXEC dbo.sp_executesql @statement = N'-- =============================================\nCREATE PROCEDURE \nAS\nBEGIN\n\nEND\n' \nEND\nGO\n</code></pre>\n\n<p>But I require this (as found from right clicking the sproc):</p>\n\n<pre><code>USE someDB\nGO\n\nIF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'someSproc') AND type in (N'P', N'PC'))\nDROP PROCEDURE someSproc\nGO\n\nUSE someDB\nGO\n\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE PROCEDURE someSproc\n\nAS\nBEGIN\n    SET NOCOUNT ON;\n\nEND\n\nGO\n</code></pre>\n\n<p>Any ideas?</p>\n"},{"tags":["sql-server","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":2433,"score":6,"question_id":2429434,"title":"TSQL: grouping customer orders by week","body":"<p>I have a table with a collection of orders. The fields are:</p>\n\n<ul>\n<li><code>customerName</code> (text) </li>\n<li><code>DateOfOrder</code> (datetime).</li>\n</ul>\n\n<p>I would like to show totals of orders per week per customer. I would like to have it arranged for the Friday of each week so that it looks like this:</p>\n\n<pre><code>all dates follow mm/dd/yyyy\n\n\"bobs pizza\", 3/5/2010, 10\n\"the phone co\",3/5/2010,5\n\"bobs pizza\", 3/12/2010, 3\n\"the phone co\",3/12/2010,11\n</code></pre>\n\n<p>Could somebody please show me how to do this?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","database","microsoft"],"answer_count":7,"favorite_count":1,"up_vote_count":16,"down_vote_count":0,"view_count":2761,"score":16,"question_id":681282,"title":"How come the message \"Table is marked for deletion\" keeps appearing?","body":"<p>Using SQL Server 2008 and I'm doing some schema construction in the Management Studio designer.</p>\n\n<p>I created a table early in the process called \"Animal\", but then decided to delete shortly after. I deleted it via the tree view in Management Studio (right-click delete).</p>\n\n<p>Now I'm late in the process, I would like to recreate the table \"Animal\" but with different fields.</p>\n\n<p>The second time round with Animal gets created fine, but when I try to add the table to my diagram I get the message \"Table 'Animal' is marked for deletion, can't be added to the diagram or opened in the table designer\".</p>\n\n<p>What's the deal? How can I use this table normally again and not suffer from older table naming conflicts?</p>\n\n<p>Alternatively, if the table is marked for deletion, can I actually invoke deletion somehow? Then recreate another table with the same name.</p>\n\n<p>This is a little annoying. Would appreciate any help.</p>\n"},{"tags":["sql-server","xml","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":55,"score":4,"question_id":13096203,"title":"SQL Server .nodes() XML parent nodes by name","body":"<pre><code>    declare @xmlsample xml =\n'&lt;root&gt;\n    &lt;solution&gt;\n        &lt;solutionnumber&gt;1&lt;/solutionnumber&gt;\n            &lt;productgroup&gt;\n                &lt;productcategory&gt;\n                    &lt;price&gt;100&lt;/price&gt;\n                    &lt;title&gt;Some product&lt;/title&gt;\n                    &lt;tax&gt;1&lt;/tax&gt;\n                &lt;/productcategory&gt;\n            &lt;/productgroup&gt;\n            &lt;productcategory2&gt;\n                    &lt;price&gt;200&lt;/price&gt;\n                    &lt;title&gt;Some other product&lt;/title&gt;\n                    &lt;tax&gt;2&lt;/tax&gt;\n            &lt;/productcategory2&gt;\n    &lt;/solution&gt;\n    &lt;solution&gt;\n        &lt;solutionnumber&gt;2&lt;/solutionnumber&gt;\n            &lt;productcategory2&gt;\n                    &lt;price&gt;200&lt;/price&gt;\n                    &lt;title&gt;Some other product&lt;/title&gt;\n                    &lt;tax&gt;2&lt;/tax&gt;\n            &lt;/productcategory2&gt;\n    &lt;/solution&gt;\n&lt;/root&gt;'\n\nSELECT \n    --T.C.value('(./ancestor::ns1:solutionNumber)[1]', 'varchar(50)') AS solutionnumber ?? no clue\n    T.C.value('(price)[1]', 'numeric(18,2)') AS price\n    ,T.C.value('(title)[1]', 'varchar(50)') AS title\n    ,T.C.value('(tax)[1]', 'numeric(18,2)') AS tax\nFROM @xmlsample.nodes('//node()[title]') AS T(C)\n</code></pre>\n\n<p>A representation of the XML I am attempting to shred in SQL Server 2008 r2. I find the \"title\" node and grab the values I need that are in the product category. Now I would like to get the \"solution number\" however this could be one or more parent nodes above the product as there are certain product \"groups.\"</p>\n\n<p>How would I go about check the parent nodes by name (\"solutionnumber\") until I find it? Thanks for any assistance.</p>\n"},{"tags":["sql-server","vb.net","loops"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2665,"score":0,"question_id":5402934,"title":"Loading data from SQL Server row by row to textboxes","body":"<p>I am trying to retrieve data row by row from my SQL Server and load them into my respective textboxes, I was doing the below code but of course it doesn't work as the For Each loop will load every single textboxes with each data retrieved, ran out of ideas. Appreciate if someone can give me a boost here. Thanks.</p>\n\n<pre><code>Private Sub retrieve_Data()\n        Dim con As New SqlConnection\n        Dim cmd As New SqlCommand\n\n        Try\n            con.ConnectionString = \"Data Source=HPEnvy-HP; Initial Catalog=Cinema; User Id=&lt;id&gt;; Password=&lt;password&gt;;\"\n            con.Open()\n            cmd.Connection = con\n\n            cmd.CommandText = \"SELECT [movie_ID], [movie_Title] FROM [Movie_Table] ORDER BY [MOVIE_ID] \"\n\n            Dim lrd As SqlDataReader = cmd.ExecuteReader()\n\n            While lrd.Read()\n\n                Dim reader As String = lrd(1).ToString\n                Dim arrLoad As New ArrayList\n\n\n                arrLoad.Add(lrd(1).ToString)\n                For i = 0 To arrLoad.Count - 1\n                    For Each cCtrl As Control In Panel1.Controls\n                        If TypeOf cCtrl Is TextBox Then\n                            Dim txtBox As New TextBox\n                            txtBox = cCtrl\n                            txtBox.Text = arrLoad.Item(i)\n                        End If\n                    Next\n                Next\n    End While\n\n        Catch ex As Exception\n            MessageBox.Show(\"Error while retrieving records on table...\" &amp; ex.Message, \"Load Records\")\n        Finally\n            con.Close()\n        End Try\n    End Sub\n</code></pre>\n"},{"tags":[".net","sql","sql-server","debugging","sqlclr"],"answer_count":1,"favorite_count":0,"up_vote_count":10,"down_vote_count":1,"view_count":460,"score":9,"question_id":8449161,"title":"SQL CLR Debugging getting \"Canceled by user\"","body":"<p>When I'm trying to debug a SQL CLR via a SQL Test script in VS2010 (with MSSQL 2008) I get \"Canceled by user\" in the Debug output window as soon the deployment finish (which is successful.)</p>\n\n<p>I have been up and down the Internet and tried all found solutions and still no go.</p>\n\n<p>System:</p>\n\n<blockquote>\n  <p>Windows Server 2008 R2 Standard SP 1<br>\n  64 bit Visual Studio 2010<br>\n  Ultimate SQL Server 2008 R2 (Both running on the same computer)</p>\n</blockquote>\n\n<p>Steps taken:</p>\n\n<ul>\n<li>VS 2010 is run as administrator.</li>\n<li>SQL Connection User has sysadmin rights on SQL 2008</li>\n<li>Firewall is set up to allow inbound on the required ports for both VS 2010 and SQL 2008</li>\n</ul>\n\n<p>Been through: <a href=\"http://msdn.microsoft.com/en-us/library/ms165051.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms165051.aspx</a></p>\n\n<p>And: <a href=\"http://msdn.microsoft.com/en-us/library/ee828498.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ee828498.aspx</a></p>\n\n<p>Tried set set Target Framework to 2.0 (from 3.5)</p>\n\n<p>Tried unchecked \"Deploy code\" in Project Properties under \"Deploy\" section.</p>\n\n<p>Under Database in Project Properties is set to \"Unsafe\" and Assembly owner to \"dbo\".</p>\n"},{"tags":["c#","sql-server","database","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":208,"score":3,"question_id":12292644,"title":"Speed up update of 185k rows in SQL Server 2008?","body":"<p>I have a binary file with about <strong>185k</strong> rows in it. <code>C#</code> parses file in seconds. What would be the best way to update <code>MSSQL</code> table with that data?</p>\n\n<p>What I've tried:</p>\n\n<ol>\n<li>Easiest way - read binary row, parse, update table. The whole process takes around 2 days to update all the data.</li>\n<li>Combine 200 update queries and send them at once to the MSSQL. In this case, update takes 8 to 10 hrs.</li>\n<li>Combine 500+ queries into single one. Works faster, but drops timeout exceptions time to time, so some updates are not going through.</li>\n</ol>\n\n<p>Any advice on how to speed up the update process?</p>\n"},{"tags":["sql-server","nhibernate","caching","common-table-expression"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13092464,"title":"Caching Common Table Expressions (CTE) queries in NHibernate","body":"<p>I have a table holding hierarchical data that I am querying for from my web app using NHibernate. It's pretty straight forward</p>\n\n<pre><code>CREATE TABLE [dbo].[Relationships](\n    [RelationshipId] [uniqueidentifier] NOT NULL,\n    [ParentId] [uniqueidentifier] NULL,\n    [ParentTypeId] [uniqueidentifier] NULL,\n    [ChildId] [uniqueidentifier] NOT NULL,\n    [ChildTypeId] [uniqueidentifier] NOT NULL\n)\n</code></pre>\n\n<p>Now to query information from this table I'm using a feature of SQL Server (since 2005) called Common Table Expressions, or CTE for short. It lets me write recursive queries which are extremely useful for table like the one above.</p>\n\n<pre><code>WITH Ancestors(RelationshipId, ParentId, ChildId) \nAS \n(\n    SELECT r.RelationshipId, r.ParentId, r.ChildId \n        FROM Relationships r \n        WHERE ChildId = :objectId \n    UNION ALL \n    SELECT r.RelationshipId, r.ParentId, r.ChildId \n        FROM Relationships r \n            INNER JOIN Ancestors \n                ON Ancestors.ParentId = r.ChildId \n) \nSELECT RelationshipId, ParentId, ChildId FROM Ancestors\n</code></pre>\n\n<p>Now, this is great and the performance isn't that bad but it can be taxing when I try to use this to determine ancestors going up the tree, or worse, using a similar query to determine decendants.</p>\n\n<p>Now I'd like to simply cache the results from this query but I'm getting an error from nHibernate <code>Index was outside the bounds of the array.</code> if I have <code>.SetCacheable(true)</code>. If I remove the cache support the query works fine.</p>\n\n<p>The query works fine if I remove the caching support from my call to <code>Session.CreateSQLQuery()</code> Now I've looked online to try and find a cause but I haven't found a consensus amongst the results I found.</p>\n\n<p>So while I am curios <strong>why</strong> it doesn't work, I'm more interested in finding a workaround to get caching to work with my CTE in nHibernate?</p>\n"},{"tags":["sql-server","tsql","indexing","reverse-engineering"],"answer_count":16,"favorite_count":27,"up_vote_count":45,"down_vote_count":0,"view_count":90070,"score":45,"question_id":765867,"title":"List of all index & index columns in SQL Server DB","body":"<p>How do I get a list of all index &amp; index columns in SQL Server 2005+? The closest I could get is:</p>\n\n<pre><code>select s.name, t.name, i.name, c.name\n from sys.tables t\ninner join sys.schemas s on t.schema_id = s.schema_id\ninner join sys.indexes i on i.object_id = t.object_id\ninner join sys.index_columns ic on ic.object_id = t.object_id\n\tinner join sys.columns c on c.object_id = t.object_id and\n\t\tic.column_id = c.column_id\n\nwhere i.index_id &gt; 0    \nand i.type in (1, 2) -- clustered &amp; nonclustered only\nand i.is_primary_key = 0 -- do not include PK indexes\nand i.is_unique_constraint = 0 -- do not include UQ\nand i.is_disabled = 0\nand i.is_hypothetical = 0\nand ic.key_ordinal &gt; 0\n\norder by ic.key_ordinal\n</code></pre>\n\n<p>which is not exactly what I want. What I want is to list all user-defined indexes (which means no indexes which support unique constraints &amp; primary keys) with all columns (ordered by how do they apper in index definition) plus as much metadata as possible.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","csv"],"answer_count":7,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":7798,"score":3,"question_id":5611715,"title":"Where value in column containing comma delimited values","body":"<p>Hi I am wondering how to write an SQL statement for SQL Server 2008 that Selects entry's where a column contains a value, now the value within the column is a comma delimited list (usually - there could only be one entry (and no leading comma)) so what In checking for is \"is this value contained somewhere within the list?\", for instance:</p>\n\n<pre><code>COLUMN = Cat, Dog, Sparrow, Trout, Cow, Seahorse\nDoes COLUMN contain Cat? YES\nDoes COLUMN contain horse? NO\nDoes COLUMN contain Sheep? NO\n</code></pre>\n\n<p>or</p>\n\n<pre><code>COLUMN = Mouse\nDoes COLUMN contain Hare? NO\nDoes COLUMN contain Mouse? YES\n</code></pre>\n\n<p>etc</p>\n\n<p>I was thinking I could use the 'IN' keyword as such</p>\n\n<pre><code>SELECT id_column FROM table_name WHERE 'Cat' IN COLUMN\n</code></pre>\n\n<p>but this does not work as it seems that you can only use that to check if a column contains one of a series of comma delimited values.</p>\n\n<p>I also cannot use CONTAINS() OR 'LIKE' as this, in the above example would return values for 'horse' as the whole string contains horse in 'Seahorse', and I can't search for the needle plus a comma (if I'm looking for 'horse' the search would be 'horse,') as what if the entry is at the end of a the list?  And I can't search for a comma plus a needle (if I'm looking for 'horse' the search would be ',horse')\nas what if the entry is the first in the list? And I can't use both as what if the entry is the only (single) entry?</p>\n\n<p>Thanks for any help anyone can give.</p>\n\n<p>Cheers.</p>\n"},{"tags":["sql","sql-server","database-design","view"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13104586,"title":"SQLServer - Error when trying to update view - Cannot as would update base tables","body":"<p>Can someone help in regards to this SQL problem. I have a database I have constructed. it tracks sporting events and so in it has a table for seasons(years), rounds(1 to 26) a draw tables which aims to show how many teams play each round in each season. I separated the seasons and rounds from draws to reduce the replication of having 8 round 1, 2...</p>\n\n<p>So now I created a view to attempt to add a season of draws in. However I receive this error that I cannot update as it affects base tables. </p>\n\n<p><img src=\"http://i.stack.imgur.com/ZiYi3.png\" alt=\"SQLServer Round View\"></p>\n\n<p>this is my view</p>\n\n<pre><code>USE [NRL_DataMartDesign]\nGO\n\n/****** Object:  View [dbo].[RoundGames]    Script Date: 10/28/2012 08:58:02 ******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE VIEW [dbo].[RoundGames]\nAS\nSELECT     dbo.Draw.Date, dbo.Draw.HomeTeam, dbo.Draw.AwayTeam, dbo.Venue.VenueName, dbo.SeasonRound.RoundID, dbo.Round.RoundNumber\nFROM         dbo.Draw INNER JOIN\n                      dbo.Venue ON dbo.Draw.VenueFk = dbo.Venue.VenueID INNER JOIN\n                      dbo.Round ON dbo.Draw.RoundNumberFk = dbo.Round.RoundID INNER JOIN\n                      dbo.SeasonRound ON dbo.Round.RoundID = dbo.SeasonRound.RoundID\n\nGO\n</code></pre>\n\n<p>This is my tables\n<strong>Draw</strong></p>\n\n<pre><code>CREATE TABLE [dbo].[Draw](\n    [DrawId] [int] IDENTITY(1,1) NOT NULL,\n    [RoundNumberFk] [int] NULL,\n    [HomeTeam] [nchar](20) NULL,\n    [AwayTeam] [nchar](20) NULL,\n    [VenueFk] [int] NULL,\n    [Date] [datetime] NULL,\n    [TeamListFk] [int] NULL,\n CONSTRAINT [PK_Draw] PRIMARY KEY CLUSTERED \n(\n</code></pre>\n\n<p><strong>Round</strong></p>\n\n<pre><code>CREATE TABLE [dbo].[Round](\n    [RoundID] [int] IDENTITY(1,1) NOT NULL,\n    [RoundNumber] [smallint] NULL,\n CONSTRAINT [PK_Round] PRIMARY KEY CLUSTERED \n(\n</code></pre>\n\n<p><strong>SeasonRound</strong></p>\n\n<pre><code>CREATE TABLE [dbo].[SeasonRound](\n    [SeasonID] [int] NOT NULL,\n    [RoundID] [int] NOT NULL\n) ON [PRIMARY]\n\nGO\n\nALTER TABLE [dbo].[SeasonRound]  WITH CHECK ADD  CONSTRAINT [FK_SeasonRound_Round] FOREIGN KEY([RoundID])\nREFERENCES [dbo].[Round] ([RoundID])\nGO\n\nALTER TABLE [dbo].[SeasonRound] CHECK CONSTRAINT [FK_SeasonRound_Round]\nGO\n\nALTER TABLE [dbo].[SeasonRound]  WITH CHECK ADD  CONSTRAINT [FK_SeasonRound_Season] FOREIGN KEY([SeasonID])\nREFERENCES [dbo].[Season] ([SeasonId])\nGO\n\nALTER TABLE [dbo].[SeasonRound] CHECK CONSTRAINT [FK_SeasonRound_Season]\nGO\n</code></pre>\n\n<p><strong>Venue</strong></p>\n\n<pre><code>CREATE TABLE [dbo].[Venue](\n    [VenueID] [int] IDENTITY(1,1) NOT NULL,\n    [VenueName] [varchar](50) NULL,\n    [State] [varchar](25) NULL,\n    [Capacity] [int] NULL,\n    [HomeTeam] [int] NULL,\n CONSTRAINT [PK_Venue] PRIMARY KEY CLUSTERED \n(\n</code></pre>\n\n<p>Can anyone provide any assistance as to what I am doing wrong here?</p>\n\n<p>Edit: it appears from the comments the better question would be\" What is the best way to add data to the database using these tables\" As this is what I am trying to achieve .</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","common-table-expression","nearest-neighbor"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13103097,"title":"SQL Server : generating nearest neighbour routes","body":"<p>Having a little trouble with generating routes using a nearest neighbour methodology with SQL Server in T-SQL. </p>\n\n<p><strong>Note:</strong> Using SQL Server 2008, I do not have access to spatial extensions.</p>\n\n<p><strong>Background:</strong></p>\n\n<p>I have a query, which through a series of loops and loops within loops builds routes, however, this query can take in excess of 10 minutes to traverse over 100+ visits.</p>\n\n<p>I have a working system, but I would like to bring the execution time down. Trying to minimise loops as they seem to kill performance. I recently stumbled on CTEs and they have been wonderful for my optimisation so far.</p>\n\n<p>I have the following table populated with all the visits that I have over a given period:</p>\n\n<pre><code>DECLARE @Visits TABLE \n(\n    Unique_ID int identity(1,1), \n    Location_ID int, \n    Day_ID int, \n    Lat float, \n    Long float\n)\n</code></pre>\n\n<p>And I have built a legend of all possible paths per day using:</p>\n\n<pre><code>DECLARE @VisitLegend TABLE  \n(\n    Day_ID int, \n    locationFromId int, \n    locationToId int, \n    distance float\n)\n\nINSERT INTO @VisitLegend (dayId, locationFromId , locationToId , distance)\nSELECT \nv1.Day_ID,\nv1.Unique_ID, \nv2.Unique_ID, \n[dbo].[udf_Distance_Between] (v1.Lat, v1.Long, v2.Lat, v2.Long)\nFROM @Visits v1\nJOIN @Visits v2 on v1.Unique_ID &lt;&gt; v2.Unique_ID \n         AND v1.Current_Day_ID = v2.Current_Day_ID \n         AND NOT (v1.Unique_ID = v2.Unique_ID and v2.Unique_ID = v1.Unique_ID)\n</code></pre>\n\n<p><strong>Question:</strong></p>\n\n<p>Is there a way where I can step through each visit in the <code>@Visits</code> table, traverse the <code>@Visit</code> Legend table by the shortest distance without going to the same visit twice ?</p>\n\n<p>I did make a stab at using a CTE with recursion, however my problem is that I cannot prevent it from selecting a visit again further up the tree, nor can I limit the recursive subset to the smallest distance without trying to use an aggregate or a joined subquery which would only work with references to the parent query.</p>\n\n<p>My current attempt was:</p>\n\n<pre><code>;WITH pathBuilder(dayId, nodeId, distance) AS\n(\n    SELECT Day_ID, Unique_ID, CAST(0.0 as float)\n    FROM @Visits \n        UNION ALL\n    SELECT pb.dayId, vl.locationToId, vl.distance\n    FROM pathBuilder pb\n    JOIN @VisitLegend vl on vl.dayId = pb.dayId \n        and vl.locationFromId = pb.locationId \n)\nSELECT * FROM pathBuilder\n</code></pre>\n\n<p>However I cannot seem to get this to select the locations from the visits table, then step through each in the legend following the shortest and never going back to a <code>visitLocationId</code> that it has already visited.</p>\n\n<p><strong>Intended result:</strong></p>\n\n<p><code>@VisitLegend</code> has the following:</p>\n\n<pre><code>dayId       locationFromId locationToId distance\n----------- -------------- ------------ -----------\n1           1              2            5\n1           1              3            4\n1           2              1            5\n1           2              3            7\n1           3              1            4\n1           3              2            7\n</code></pre>\n\n<p>Which would produce the sequences: </p>\n\n<pre><code>1, 3, 2\n2, 1, 3\n3, 1, 2\n</code></pre>\n\n<p>Any ideas ? Been banging my head against the wall for quite some time on this.</p>\n\n<p>Otherwise is it a case of just using loops and bearing with the execution time?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13104356,"title":"Display varbinary as a downloadable link","body":"<p>Fairly straightforward question, I have images stored in my database as varbinary and would like to provide a link to these images rather than displaying them on the website. When a user clicks the link he/she should be able to download the image.  </p>\n"},{"tags":["sql-server","sql-server-2005","encryption","symmetric-key"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3404,"score":3,"question_id":209927,"title":"SQL Server 2005 - Restoring an encrypted DB on a different server","body":"<p>I have backed up an encrypted DB (symmetric key/certificate) and \nrestored it on a different server. </p>\n\n<p>Unfortuantely we're having problems with the decryption... hoping \nsomeone can help. </p>\n\n<p>In the restored db, I can see the Symmetric Key and the Certificate in \nSSMS, but when I try to Open the key using the cert ( open symmetric \nkey KeyA decryption by certificate CertB )I get the \nfollowing <em>very descriptive</em> error: </p>\n\n<p>Msg 15466, Level 16, State 1, Line 1 \nAn error occurred during decryption. </p>\n\n<p>Any ideas?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["asp.net","sql-server","vb.net","web-config"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13104267,"title":"MSDataShape SQL Provider connection string in ASP.net web.config file","body":"<p>My application requires the use of the MSDataShape SQL Provider and I want to store the connection string in my web.config file.</p>\n\n<p>My DataShape connection string works when I hardcode the connection string as follows:</p>\n\n<blockquote>\n  <p><code>Dim _sqlConnection As OleDbConnection = New OleDbConnection(\"Provider=MSDataShape;Data Provider=SQLOLEDB;Data Source=.;Initial Catalog=XXX;Password=XXX;PASSWORD=XXX;Persist Security Info=True;User ID=XXX;User Id=XXX;\")</code></p>\n</blockquote>\n\n<p>However, the \"connectionString\" attribute in the web.config \"add\" tag does not accept the keyword \"provider\", where MSDataShape is specified, and I do not know what to put in the \"providerName\" attribute (e.g System.Data.OleDb).</p>\n\n<p>Any help would be appreciated.</p>\n"},{"tags":["sql-server"],"answer_count":8,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1591,"score":2,"question_id":481954,"title":"SQL server DB restored.Login failed error","body":"<p>Dear TEchies,\nI have restored one db back up to my SQL server. I have an ASP program which is accessing the db.When i am running this ,i am getting an error login failed for this user.What exactly i have to do for this ??</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1355,"score":0,"question_id":10918142,"title":"Could not load file or assembly 'Microsoft.SqlServer.DTSRuntimeWrap'","body":"<p>I can't figure out why I'm getting this error when I run my application (MVC 3).  The project has a reference to Microsoft.SQLServer.ManagedDTS.  I have both SQL Server 2008 R2 and SQL Server 2012 (both Express) installed.  I'm using 2012 with this application.</p>\n\n<pre><code>Server Error in '/' Application.\n\nCould not load file or assembly 'Microsoft.SqlServer.DTSRuntimeWrap' or one of its dependencies. An attempt was made to load a program with an incorrect format.\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \n\nException Details: System.BadImageFormatException: Could not load file or assembly 'Microsoft.SqlServer.DTSRuntimeWrap' or one of its dependencies. An attempt was made to load a program with an incorrect format.\n\nSource Error: \n\nAn unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.\n\nAssembly Load Trace: The following information can be helpful to determine why the assembly 'Microsoft.SqlServer.DTSRuntimeWrap' could not be loaded.\n\n\nWRN: Assembly binding logging is turned OFF.\nTo enable assembly bind failure logging, set the registry value [HKLM\\Software\\Microsoft\\Fusion!EnableLog] (DWORD) to 1.\nNote: There is some performance penalty associated with assembly bind failure logging.\nTo turn this feature off, remove the registry value [HKLM\\Software\\Microsoft\\Fusion!EnableLog].\n\nStack Trace: \n\n\n[BadImageFormatException: Could not load file or assembly 'Microsoft.SqlServer.DTSRuntimeWrap' or one of its dependencies. An attempt was made to load a program with an incorrect format.]\n   System.Reflection.RuntimeAssembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks) +0\n   System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection, Boolean suppressSecurityChecks) +567\n   System.Reflection.RuntimeAssembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection) +192\n   System.Reflection.Assembly.Load(String assemblyString) +35\n   System.Web.Configuration.CompilationSection.LoadAssemblyHelper(String assemblyName, Boolean starDirective) +123\n\n[ConfigurationErrorsException: Could not load file or assembly 'Microsoft.SqlServer.DTSRuntimeWrap' or one of its dependencies. An attempt was made to load a program with an incorrect format.]\n   System.Web.Configuration.CompilationSection.LoadAssemblyHelper(String assemblyName, Boolean starDirective) +11568160\n   System.Web.Configuration.CompilationSection.LoadAllAssembliesFromAppDomainBinDirectory() +485\n   System.Web.Configuration.AssemblyInfo.get_AssemblyInternal() +79\n   System.Web.Compilation.BuildManager.GetReferencedAssemblies(CompilationSection compConfig) +337\n   System.Web.Compilation.BuildManager.CallPreStartInitMethods() +280\n   System.Web.Hosting.HostingEnvironment.Initialize(ApplicationManager appManager, IApplicationHost appHost, IConfigMapPathFactory configMapPathFactory, HostingEnvironmentParameters hostingParameters, PolicyLevel policyLevel, Exception appDomainCreationException) +1167\n\n[HttpException (0x80004005): Could not load file or assembly 'Microsoft.SqlServer.DTSRuntimeWrap' or one of its dependencies. An attempt was made to load a program with an incorrect format.]\n   System.Web.HttpRuntime.FirstRequestInit(HttpContext context) +11700896\n   System.Web.HttpRuntime.EnsureFirstRequestInit(HttpContext context) +141\n   System.Web.HttpRuntime.ProcessRequestNotificationPrivate(IIS7WorkerRequest wr, HttpContext context) +4869125\n</code></pre>\n"},{"tags":["sql-server","visual-studio","iis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13094128,"title":"Local IIS Web server cannot connect to SQL Server","body":"<p>When I use the local IIS Web server, my ASP.NET MVC application is unable to connect to SQL Server. The database is on another server. However, if I use the Visual Studio Development Server, it works just fine.</p>\n\n<p>Anyone know what settings I'm missing? Should something change in my Web.config?\nYes, TCP/IP is enabled on SQL Server.</p>\n\n<p>Here is the error I get -</p>\n\n<pre><code>A network-related or instance-specific error occurred while establishing a \nconnection to SQL Server. The server was not found or was not accessible. \nVerify that the instance name is correct and that SQL Server is configured \nto allow remote connections. (provider: Named Pipes Provider, error: 40 - Could \nnot open a connection to SQL Server)\n</code></pre>\n\n<p>Here is my connection string - </p>\n\n<pre><code>connectionString=\"SERVER=servername;Initial Catalog=dbname;User ID=userid;Password=passwd\" providerName=\"System.Data.SqlClient\"\n</code></pre>\n"},{"tags":["c#","sql-server","linq"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13099329,"title":"Filling Drop down list based on name","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13090398/avoid-duplicate-names-in-a-dataset\">Avoid duplicate names in a dataset</a>  </p>\n</blockquote>\n\n\n\n<p>I am fetching data from a table and binding to a label and Drop down in a gridview but i want to filter the duplicate names from the table and assign the corresponding dates to the DDL how can do this? or else is there any other alternative?</p>\n\n<p>How to bind the DDL based on label name??</p>\n\n<p><img src=\"http://i.stack.imgur.com/kExj4.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","datetime","date-range"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":13099364,"title":"SQL Server : fetching records between two dates?","body":"<p>In SQL I write a <code>SELECT</code> statement to fetch data between two dates, using <code>between and</code> </p>\n\n<p>Ex:</p>\n\n<pre><code>select * \nfrom xxx \nwhere dates between '2012-10-26' and '2012-10-27'\n</code></pre>\n\n<p>But the rows returned are for 26th only, not 26th and 27th.</p>\n\n<p>Can you help me? Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","query-optimization"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13099463,"title":"Query Optimizing Request","body":"<p>I am very sorry if this question is structured in not a very helpful manner or the question itself is not a very good one!</p>\n\n<p>I need to <code>update</code> a <code>MSSQL</code> <code>table</code> call <code>component</code> every 10 minutes based on information from another <code>table</code> call <code>materials_progress</code></p>\n\n<p>I have nearly 60000 records in <code>component</code> and more than 10000 records in <code>materials_progress</code></p>\n\n<p>I wrote an <code>update query</code> to do the job, but it takes longer than 4 minutes to complete execution!\nHere is the <code>query</code> : </p>\n\n<pre><code>UPDATE component \nSET stage_id = \nCASE \n    WHEN t.required_quantity &lt;= t.total_received THEN 27\n    WHEN t.total_ordered &lt; t.total_received THEN 18\n    ELSE 18\nEND\nFROM\n    (\n    SELECT \n        mp.job_id,  \n        mp.line_no,  \n        mp.component,  \n        l.quantity AS line_quantity, \n        CASE WHEN mp.component_name_id = 2 THEN l.quantity*2\n            ELSE l.quantity\n        END AS required_quantity,\n        SUM(ordered) AS total_ordered, SUM(received) AS total_received ,\n        c.component_id \n    FROM line l \n    LEFT JOIN component c ON c.line_id = l.line_id\n    LEFT JOIN materials_progress mp ON l.job_id = mp.job_id AND l.line_no = mp.line_no AND c.component_name_id = mp.component_name_id \n    WHERE \n        mp.job_id IS NOT NULL  \n        AND (mp.cancelled IS NULL OR mp.cancelled = 0)\n        AND (mp.manual_override IS NULL OR mp.manual_override = 0)\n        AND c.stage_id = 18\n    GROUP BY  mp.job_id,  mp.line_no,  mp.component, l.quantity, mp.component_name_id, component_id\n    ) AS t\n\nWHERE \n    component.component_id = t.component_id\n</code></pre>\n\n<p>I am not going to explain the scenario as it too complex.. could somebody please please tell me what makes this query this much expensive and a way to get around it?</p>\n\n<p>Thank you very very much in advance!!!</p>\n\n<p>Edit 1:\nHere is the execution plan;\n<img src=\"http://i.stack.imgur.com/xNgxe.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","query","sql-server-2008-r2","sql-function"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":13103353,"title":"How to create a nullable record in SQL Server 2008 R2?","body":"<p>I create a <code>Inline table function</code> in SQL Server 2008 R2, and I realized some queries return any record. So I'd like when that happens, returns a record with all the empty columns.</p>\n\n<p>By example:</p>\n\n<pre><code>Col1   Col2   Col3\nNULL   NULL   NULL\n</code></pre>\n\n<p>UPDATE: Here is the function</p>\n\n<pre><code>ALTER FUNCTION [dbo].[GetWorksheetSummaryByObjective](@objectiveId [smallint], @testTemplateId [smallint])\nRETURNS @resultTable TABLE (\n    [AnsweredWorksheetId] [smallint] NOT NULL,\n    [LastDate] [date] NULL,\n    [BestScore] [smallint] NULL,\n    [ShouldBeMakeUp] [tinyint] NOT NULL\n)\nAS \nBEGIN\n\n    INSERT @resultTable\n    SELECT TOP 1 B.Id AS AnsweredWorksheetId, A.Date, CONVERT(smallint, B.Score * 100),\n        CASE\n        WHEN B.Score &gt;= 0.7 THEN 0\n        ELSE 1\n        END AS ShouldBeMakeUp\n    FROM AnsweredTest AS A\n    RIGHT JOIN AnsweredWorksheet AS B ON (A.Id = B.AnsweredTestId)\n    WHERE B.ObjectiveId = @objectiveId AND A.ExamTemplateId = @testTemplateId\n    ORDER BY B.Score DESC\n\n    RETURN\nEND\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","view","primary-key"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13100088,"title":"How to add a new column (as a primary key column ) to view","body":"<p>Is it possible to add the column (PK) to view. if yes..How can we?</p>\n\n<p>This is my view :</p>\n\n<pre><code>CREATE VIEW [dbo].[SalesDetailView]\nAS\nSELECT\n    DATENAME(yyyy, SH.CreatedDateTime) AS Year,\n    DATENAME(mm, SH.CreatedDateTime) AS Month, SH.CreatedDateTime AS Date,\n    SH.TransactionName AS Type, SH.SalesHeaderID AS No,\n    Customer.CustomerName AS Customer,\n    CustomerGroup.CustomerGroupName AS Customer_Group, SH.Reference AS Memo,\n    Item.ItemName AS Item, SD.LineDescription AS Item_Description,\n    Item.ItemType AS Item_Type, Item.UOM,\n    ItemGroup.ItemGroupName AS Item_Group,\n    CAST (SD.Quantity AS INT) AS Quantity, CAST(SD.Amount AS MONEY) AS Amount,\n    SD.Price, SD.Discount, SH.ExchangeRate AS Exchange_Rate,\n    Currency.CurrencyDescription AS Currency, SD.ClassID AS Class_ID,\n    SD.SalesTaxID AS SalesTax_ID, SalesTaxGroup.SalesTaxGroupName AS Tax_Group,\n    Employee.EmployeeName AS Salesperson,\n    ShippingMethod.ShippingMethodName AS Shipping_Method,\n    PaymentTerm.PaymentTermName AS Payment_Term,\n    PaymentMethod.PaymentMethodName AS Payment_Method\nFROM\n    SalesHeader SH, Customer\nLEFT OUTER JOIN \n    SalesDetail SD ON SH.SalesHeaderID = SD.SalesHeaderID\nLEFT OUTER JOIN \n    Item ON SD.ItemID = Item.ItemID\nLEFT OUTER JOIN \n    ItemGroup ON Item.ItemGroupId = ItemGroup.ItemGroupID\nLEFT OUTER JOIN \n    CustomerGroup ON Customer.CustomerGroupId = CustomerGroup.CustomerGroupID\nLEFT OUTER JOIN \n    Employee ON Customer.EmployeeID = Employee.EmployeeID\nLEFT OUTER JOIN \n    Currency ON Customer.CurrencyID = Currency.CurrencyID\nLEFT OUTER JOIN \n    SalesTaxGroup ON Customer.SalesTaxGroupID = SalesTaxGroup.SalesTaxGroupID\nLEFT OUTER JOIN \n    PaymentTerm ON Customer.PaymentTermID = PaymentTerm.PaymentTermID\nLEFT OUTER JOIN \n    ShippingMethod ON Customer.ShippingMethodID = ShippingMethod.ShippingMethodID\nLEFT OUTER JOIN \n    PaymentMethod ON Customer.PaymentMethodID = PaymentMethod.PaymentMethodID\nWHERE\n    SH.CustomerID = Customer.CustomerID\n    AND SH.TransactionName &lt;&gt; 'SalesOrder'\n    AND Sh.TransactionName &lt;&gt; 'Quote'\n</code></pre>\n"},{"tags":["php","sql-server","database","linux"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13103480,"title":"How to connect to a remote MSSQL database with PHP on Linux?","body":"<p>I've got a problem and there doesn't seem to be a strait forward solution.</p>\n\n<p>I'm running a Linux server with PHP and need to connect to a MSSQL database on a remote server (I don't have control over this server). Speaking to my host, they say that it's not possible eto install the MSSQL extensions on a linux box as they are only available on Windows Servers. So, I'm looking to see what other options i have.</p>\n\n<p>Any ideas how I can do this on a linux box?!</p>\n"},{"tags":["sql-server","tsql","variables"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":13103264,"title":"TSQL: Find declared length of a variable","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/9686525/data-type-size-of-variable-in-sql\">Data type size of variable in sql</a>  </p>\n</blockquote>\n\n\n\n<p>Can you find the declared max length of a variable using <code>T-SQL</code>?</p>\n\n<p>For example: </p>\n\n<pre><code>DECLARE @myVar varchar(123) \n</code></pre>\n\n<p>-- How can I find the max length of <code>@myVar</code> would be 123?</p>\n"},{"tags":["java","sql","sql-server","jdbc","resultset"],"answer_count":5,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":8065,"score":5,"question_id":7886462,"title":"Get row count of a resultset in java","body":"<p>I'm trying to create a simple method that excepts a ResultSet as a parameter and sends back an int that contains the row count of the ResultSet. Is this a valid way of doing this or not so much?</p>\n\n<pre><code>int size = 0;\n    try {\n        while(rs.next()){\n            size++;\n        }\n    }\n    catch(Exception ex) {\n        System.out.println(\"------------------Tablerize.getRowCount-----------------\");\n        System.out.println(\"Cannot get resultSet row count: \" + ex);\n        System.out.println(\"--------------------------------------------------------\");\n    }\n</code></pre>\n\n<p>I tried this:</p>\n\n<pre><code>int size = 0;\ntry {\n    resultSet.last();\n    size = resultSet.getRow();\n    resultSet.beforeFirst();\n}\ncatch(Exception ex) {\n    return 0;\n}\nreturn size;\n</code></pre>\n\n<p>But I got an error saying <strong>\"com.microsoft.sqlserver.jdbc.SQLServerException: The requested operation is not supported on forward only result sets.\"</strong></p>\n\n<p>Thanks in advance for the pointers!</p>\n"},{"tags":["php","sql-server"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":835,"score":1,"question_id":6846052,"title":"Problem printing MSSQL datetime to html using PHP (sqlsrv extension)","body":"<p>I've got a flexible block of code that allows me to print the results of a query to a simple html table.  However, when that table contains a field of type 'datetime', the print() function doesn't work and my loop ends.</p>\n\n<p>In the past, using PHP and MySQL (as opposed to Microsoft SQL Server, which is what I'm using now) printing the date was no problem, so I'm not sure what I'm missing now.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>// $row is the current row.\n// $nkeys is the array of (String) keys that correspond to columns in the table.\ndo {\n    print (\"&lt;tr&gt;\\n\");\n    foreach($nkeys as $k) {\n        echo (\"&lt;td&gt;$row[$k]&lt;/td&gt;\");\n    } \n    print (\"&lt;/tr&gt;\\n\");\n} while ($row = sqlsrv_fetch_array($stmt));\n</code></pre>\n\n<p>Is there a special function other than print() or echo that will properly print the date?</p>\n"},{"tags":["asp.net","sql-server","database","entity-framework","ef-code-first"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":13086006,"title":"How can I force entity framework to insert identity columns?","body":"<p>I want to write some C# code to initialize my database with some seed data.  Clearly, this is going to require the ability to be able to set the values of various Identity columns when inserting.  I'm using a code-first approach.  By default, <code>DbContext</code> handles the database connection and so you can't <code>SET IDENTITY_INSERT [dbo].[MyTable] ON</code>.  So, what I've done so far is use the <code>DbContext</code> constructor that lets me specify a DB connection to be used.  Then, I set <code>IDENTITY_INSERT</code> to <code>ON</code> in that DB connection, and then try to insert my records using entity framework.  Here's an example of what I've got so far:</p>\n\n<pre><code>public class MyUserSeeder : IEntitySeeder {\n    public void InitializeEntities(AssessmentSystemContext context, SqlConnection connection) {\n        context.MyUsers.Add(new MyUser { MyUserId = 106, ConceptPersonId = 520476, Salutation = \"Mrs\", Firstname = \"Novelette\", Surname = \"Aldred\", Email = null, LoginId = \"520476\", Password=\"28c923d21b68fdf129b46de949b9f7e0d03f6ced8e9404066f4f3a75e115147489c9f68195c2128e320ca9018cd711df\", IsEnabled = true, SpecialRequirements = null });\n        try {\n            connection.Open();\n            SqlCommand cmd = new SqlCommand(\"SET IDENTITY_INSERT [dbo].[MyUser] ON\", connection);\n            int retVal = cmd.ExecuteNonQuery();\n            context.SaveChanges();\n        }\n        finally {\n            connection.Close();\n        }\n    }\n}\n</code></pre>\n\n<p>So close and yet so far - because, although <code>cmd.ExecuteNonQuery()</code> works fine, when I then run <code>context.SaveChanges()</code>, I'm informed that \"Explicit value must be specified for identity column in table 'MyUser' either when IDENTITY_INSERT is set to ON or when a replication user is inserting into a NOT FOR REPLICATION identity column.\"</p>\n\n<p>Presumably, because MyUserId (which is the Identity column in the MyUser table) is the primary key, entity framework doesn't try to set it when I call <code>context.SaveChanges()</code>, even though I gave the <code>MyUser</code> entity a value for the <code>MyUserId</code> property.</p>\n\n<p>Is there a way to force entity framework to try and insert even primary key values for an entity, then?  Or maybe a way to temporarily mark <code>MyUserId</code> as not being a primary key value, so EF tries to insert it?</p>\n"},{"tags":["sql-server","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13101414,"title":"Identity column and using order by in query","body":"<p>I use SQL Server 2008 R2 and have a table with an <code>id</code> column as <code>identity(1,1)</code>. If I want to get query ordered by id column, do must use <code>Order By ID</code> or not necessary. </p>\n\n<p><strong>EDIT :</strong>\nI have a unique clustered index on ID column. do this index guaranteed that my query sorted by id by default.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1391,"score":3,"question_id":2136336,"title":"Sql Server 2008 Cross-database table linking (relationships)","body":"<p>I have a bit of an issue, and to be honest I don't think there's an answer, but I'll give it a try anyway.</p>\n\n<p>So I have two databases [A]->Company and [B]->Product. Both databases have a Country table which is then linked to other tables in each individual database. The problem is that the data between the two Country tables is a complete duplicate. So, I essentially have to duplicate some of the relationships in each database, and maintenance on top of that is just difficult...</p>\n\n<p>So, I'm curious is there a way to create a cross-database relationship between tables so I can have only one set of Country+Helper tables that govern both databases?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server","vbscript","sql-agent"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":6444551,"title":"SQL Agent and Running SSIS Across Network Not Working","body":"<p>I have a vb script which moves files from one server to another and it works successfully when run manually but when a job is created in SQL Agent to automate the process it doesn't perform the task.  SQL Agent doesn't fail it simply does not perform the move.  </p>\n\n<p>I granted local admin rights to the account performing the task and still nothing. I copied the files manually to the local SQL Server but I still get the same outcome when attempting to run the job in SQL Agent.  </p>\n\n<p>I also tried using FQDN but it still doesn't perform the process.  Any suggestions?  Please help and thanks in advance.</p>\n"},{"tags":["mysql","sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13097817,"title":"How to create table inside an another table column?","body":"<p>Given a scenario, I have one table lets say Table(Id,name,Question)..I wanted to create another table inside Question Column...Can anybody help me out regarding above mentioned query</p>\n"},{"tags":["sql-server","xml","bulkinsert","bcp"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1460,"score":2,"question_id":8530353,"title":"Sql Bulk insert XML format file with double quotes in terminator","body":"<p>I'm trying to insert some data into a table from a csv document which has all of the fields delimited with \"\"</p>\n\n<p>ie.</p>\n\n<pre><code> APPLICANTID,NAME,CONTACT,PHONENO,MOBILENO,FAXNO,EMAIL,ADDR1,ADDR2,ADDR3,STATE,POSTCODE\n \"3\",\"Snoop Dogg\",\"Snoop Dogg\",\"411\",\"\",\"\",\"\",\"411 High Street\",\"USA \n \",\"\",\"USA\", \"1111\" \"4\",\"LL Cool J\",\"LL Cool J\",\"\",\"\",\"\",\"\",\"5 King\n Street\",\"\",\"\",\"USA\",\"1111\"\n</code></pre>\n\n<p>I am using an xml format file to try and overcome the \"\" delimiters as I believe I would have to update the data again after importing to remove the inital \" if it did not.</p>\n\n<p>My format file looks like the following:</p>\n\n<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;BCPFORMAT xmlns=\"http://schemas.microsoft.com/sqlserver/2004/bulkload/format\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n &lt;RECORD&gt;\n  &lt;FIELD ID=\"1\" xsi:type=\"NCharTerm\" TERMINATOR='\",' MAX_LENGTH=\"12\"/&gt;\n  &lt;FIELD ID=\"2\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"3\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"4\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"5\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"6\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"7\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"8\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"9\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"10\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"11\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"12\" xsi:type=\"CharTerm\" TERMINATOR=\"\\r\\n\" COLLATION=\"Latin1_General_CI_AS\"/&gt;\n &lt;/RECORD&gt;\n &lt;ROW&gt;\n  &lt;COLUMN SOURCE=\"1\" NAME=\"APPLICANTID\" xsi:type=\"SQLINT\"/&gt;\n  &lt;COLUMN SOURCE=\"2\" NAME=\"NAME\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"3\" NAME=\"CONTACT\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"4\" NAME=\"PHONENO\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"5\" NAME=\"MOBILENO\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"6\" NAME=\"FAXNO\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"7\" NAME=\"EMAIL\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"8\" NAME=\"ADDR1\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"9\" NAME=\"ADDR2\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"10\" NAME=\"ADDR3\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"11\" NAME=\"STATE\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"12\" NAME=\"POSTCODE\" xsi:type=\"SQLCHAR\"/&gt;\n &lt;/ROW&gt;\n&lt;/BCPFORMAT&gt;\n</code></pre>\n\n<p>and I am running the import with the following:</p>\n\n<pre><code>BULK INSERT [PracticalDB].dbo.applicant \nFROM 'C:\\temp.csv'\nWITH (KEEPIDENTITY, FORMATFILE='C:\\temp.xml', FIRSTROW = 2)\n</code></pre>\n\n<p>I am getting the error:</p>\n\n<blockquote>\n  <p>Msg 4864, Level 16, State 1, Line 1 Bulk load data conversion error\n  (type mismatch or invalid character for the specified codepage) for\n  row 2, column 1 (APPLICANTID).</p>\n</blockquote>\n\n<p>for all of the rows.</p>\n\n<p>I have tried various different combinations for the terminator including using:</p>\n\n<pre><code>TERMINATOR=\"&amp;quot;,\"\nTERMINATOR=\"\\\",\"\nTERMINATOR='\",\"\nTERMINATOR='\\\",\"\n</code></pre>\n\n<p>and none of them seem to work.</p>\n\n<p>Is there a correct way to escape the \" so that it will be parsed correctly, assuming that that is my problem here.</p>\n"},{"tags":["sql-server","visual-studio","sql-server-express"],"answer_count":5,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":3987,"score":1,"question_id":6535532,"title":"How to import .sql file into SQL Server Express","body":"<p>I have a plain sql file with some SQL INSERT statements.   </p>\n\n<p>Is it possible to import it in my local SQL Server Express instance?</p>\n"},{"tags":["sql-server","silverlight","entity-framework","table","big"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":112,"score":0,"question_id":9748830,"title":"How to load silverlight Entities with a large number of records?","body":"<p>I have a big table in my SQL Server database with 38000 records! When loading this table in my Silverlight application, it shows 0 records loaded. When i load the same table with less records (1000 for example ) the entity is loaded with all records! </p>\n\n<p>Can anyone help me please? </p>\n\n<pre><code>      loadhabitaion = this.friendsContext.Load(this.friendsContext.GetHyd_poliQuery());\n      loadhabitaion.Completed += new EventHandler(loadhabitaion_Completed);\n      void loadhabitaion_Completed(object sender, EventArgs e)\n\n         {\n\n        MessageBox.Show(loadhabitaion.Entities.Count().ToString());\n          //it returns 0\n         }\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-ce"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1042,"score":1,"question_id":2159508,"title":"SQL Compact - Error executing multiple insert statements","body":"<p>I'm using management studio to connect to my sql mobile/compact database.</p>\n\n<p>I'm trying to insert some dummy data into some tables, for example:</p>\n\n<pre><code>INSERT INTO FlooringTypes (FlooringType) VALUES ('Carpet')  \nINSERT INTO FlooringTypes (FlooringType) VALUES ('Smooth')\n</code></pre>\n\n<p>However it returns the error:</p>\n\n<blockquote>\n  <p>Major Error 0x80040E14, Minor Error 25501</p>\n</blockquote>\n\n<p>If I run them seperately it works fine.</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":29,"score":-1,"question_id":13100843,"title":"Avoid repeating name in gridview with a unique name?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13090398/avoid-duplicate-names-in-a-dataset\">Avoid duplicate names in a dataset</a>  </p>\n</blockquote>\n\n\n\n<p><img src=\"http://i.stack.imgur.com/pMclb.png\" alt=\"enter image description here\"></p>\n\n<p>I am populating some data from DB and i have some duplicate template names and when i want to show in the front end i have to display only unique template name i.e \"test\" only once how can i achieve this??</p>\n\n<pre><code> private DataSet GridLoading()\n{\n    // DataTable dt = new DataTable();\n    DataSet ds = new DataSet();\n    ds = Common.LoadingGrid();\n    GridView1.DataSource = ds;\n    GridView1.DataBind();\n    return ds;\n}\n\n  public static DataSet LoadingGrid()\n    {\n        DBAccess objDBAccess = new DBAccess();\n       DataSet ds = new DataSet();\n\n\n        try\n        {\n\n           objDBAccess.AddParameter(\"@tempname\", SqlDbType.VarChar);\n           objDBAccess.AddParameter(\"@runby\", SqlDbType.VarChar);\n            ds = objDBAccess.ExecuteDataSet(\"load\");\n\n\n            return ds;\n</code></pre>\n"},{"tags":["sql-server","nocount"],"answer_count":6,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":1878,"score":4,"question_id":26552,"title":"What are the advantages and disadvantages of turning NOCOUNT off in SQL Server queries?","body":"<p>What are the advantages and disadvantages of turning NOCOUNT off in SQL Server queries?</p>\n"},{"tags":["c#","sql-server","methods"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13100218,"title":"How to get a method to work in all forms in my project in c#","body":"<p>I wrote code(connection string) to open sql database in form1  then i need to open the same database in form2 .\nso i think to write method to do this ?\nHow to get this method to work in all forms in my project in c#, where i neet to plse it to work in all project forms????\nplz help</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":255,"score":0,"question_id":6825199,"title":"SQL server suspect/Off line mode and Data lost","body":"<p>Suddenly I saw my SQL Server is in suspect/OFF Line mode. That's why I am not able to do any any operation in my db. For this reason I restarted my server (Windows Server 2003) .</p>\n\n<p>But when I get ready I found that some of my data has been lost.  I have no any back up of my db.</p>\n\n<p>Is there any way to get back the data that I have lost.</p>\n\n<p>the error log:</p>\n\n<blockquote>\n  <p>Could not redo log record (5108:10151:5), for transaction ID\n  (0:1552370), on page (1:3679), database '??'</p>\n</blockquote>\n"},{"tags":[".net","sql-server","transactions","transactionscope"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":7028,"score":6,"question_id":2858750,"title":"What is the reason of \"Transaction context in use by another session\"","body":"<p>I'm looking for a description of the root of this error: \"Transaction context in use by another session\".</p>\n\n<p>I get it sometimes in one of my unittests so I can't provider repro code. But I wonder what is \"by design\" reason for the error.</p>\n\n<p>UPDATE: the error returns as SqlException from SQL Server 2008. A place where I get the error seems to be single-threaded. But probably I have unittests interaction as I get the error where run several tests at once (MSTest in VS2008sp1).\nBut the failing test looks like:</p>\n\n<ul>\n<li>create an object and save it inside DB-transaction (commit)</li>\n<li>create TransactionScope</li>\n<li>trying to open a connection - here I get SqlException with such stacktrace:</li>\n</ul>\n\n<p>.</p>\n\n<pre><code>System.Data.SqlClient.SqlException: Transaction context in use by another session.\n   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj)\n   at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)\n   at System.Data.SqlClient.TdsParser.TdsExecuteTransactionManagerRequest(Byte[] buffer, TransactionManagerRequestType request, String transactionName, TransactionManagerIsolationLevel isoLevel, Int32 timeout, SqlInternalTransaction transaction, TdsParserStateObject stateObj, Boolean isDelegateControlRequest)\n   at System.Data.SqlClient.SqlInternalConnectionTds.PropagateTransactionCookie(Byte[] cookie)\n   at System.Data.SqlClient.SqlInternalConnection.EnlistNonNull(Transaction tx)\n   at System.Data.SqlClient.SqlInternalConnection.Enlist(Transaction tx)\n   at System.Data.SqlClient.SqlInternalConnectionTds.Activate(Transaction transaction)\n   at System.Data.ProviderBase.DbConnectionInternal.ActivateConnection(Transaction transaction)\n   at System.Data.ProviderBase.DbConnectionPool.GetConnection(DbConnection owningObject)\n   at System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection)\n   at System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory)\n   at System.Data.SqlClient.SqlConnection.Open()\n</code></pre>\n\n<p>I've found these posts:</p>\n\n<ul>\n<li><a href=\"http://blogs.msdn.com/asiatech/archive/2009/08/10/system-transaction-may-fail-in-multiple-thread-environment.aspx\" rel=\"nofollow\">http://blogs.msdn.com/asiatech/archive/2009/08/10/system-transaction-may-fail-in-multiple-thread-environment.aspx</a></li>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/ff649002.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ff649002.aspx</a></li>\n</ul>\n\n<p>But I can't understand what <em>\"Multiple threads sharing the same transaction in a transaction scope will cause the following exception: 'Transaction context in use by another session.'\"</em> means. All words are understandable but not the point. </p>\n\n<p>I actually can share a system transaction between threads. And there is even special mechanism for this - DependentTransaction class and Transaction.DependentClone method.</p>\n\n<p>I'm trying to reproduce a usecase from the first post:</p>\n\n<ol>\n<li>Main thread creates DTC transaction, receives DependentTransaction (created using Transaction.Current.DependentClone on the main thread</li>\n<li>Child thread 1 enlists in this DTC transaction by creating a transaction scope based on the dependent transaction (passed via constructor)</li>\n<li>Child thread 1 opens a connection</li>\n<li>Child thread 2 enlists in DTC transaction by creating a transaction scope based on the dependent transaction (passed via constructor)</li>\n<li>Child thread 2 opens a connection</li>\n</ol>\n\n<p>with such code:</p>\n\n<pre><code>using System;\nusing System.Threading;\nusing System.Transactions;\nusing System.Data;\nusing System.Data.SqlClient;\n\npublic class Program\n{\n    private static string ConnectionString = \"Initial Catalog=DB;Data Source=.;User ID=user;PWD=pwd;\";\n\n    public static void Main()\n    {\n        int MAX = 100;\n        for(int i =0; i&lt; MAX;i++)\n        {\n            using(var ctx = new TransactionScope())\n            {\n                var tx = Transaction.Current;\n                // make the transaction distributed\n                using (SqlConnection con1 = new SqlConnection(ConnectionString))\n                using (SqlConnection con2 = new SqlConnection(ConnectionString))\n                {\n                    con1.Open();\n                    con2.Open();\n                }\n                showSysTranStatus();\n\n                DependentTransaction dtx = Transaction.Current.DependentClone(DependentCloneOption.BlockCommitUntilComplete);\n                Thread t1 = new Thread(o =&gt; workCallback(dtx));\n                Thread t2 = new Thread(o =&gt; workCallback(dtx));\n                t1.Start();\n                t2.Start();\n                t1.Join();\n                t2.Join();\n\n                ctx.Complete();\n            }\n            trace(\"root transaction completes\");\n        }\n    }\n    private static void workCallback(DependentTransaction dtx)\n    {\n        using(var txScope1 = new TransactionScope(dtx))\n        {\n            using (SqlConnection con2 = new SqlConnection(ConnectionString))\n            {\n                con2.Open();\n                trace(\"connection opened\");\n                showDbTranStatus(con2);\n            }\n            txScope1.Complete();\n        }   \n        trace(\"dependant tran completes\");\n    }\n    private static void trace(string msg)\n    {\n        Console.WriteLine(Thread.CurrentThread.ManagedThreadId + \" : \" + msg);\n    }\n    private static void showSysTranStatus()\n    {\n        string msg;\n        if (Transaction.Current != null)\n            msg = Transaction.Current.TransactionInformation.DistributedIdentifier.ToString();\n        else\n            msg = \"no sys tran\";\n        trace( msg );\n    }\n\n    private static void showDbTranStatus(SqlConnection con)\n    {\n        var cmd = con.CreateCommand();\n        cmd.CommandText = \"SELECT 1\";\n        var c = cmd.ExecuteScalar();\n        trace(\"@@TRANCOUNT = \" + c);\n    }\n}\n</code></pre>\n\n<p>It fails on Complete's call of root TransactionScope. But error is different:\nUnhandled Exception: System.Transactions.TransactionInDoubtException: The transaction is in doubt. --->\npired.  The timeout period elapsed prior to completion of the operation or the server is not responding.</p>\n\n<p>To sum up: I want to understand what \"Transaction context in use by another session\" means and how to reproduce it.</p>\n"},{"tags":["sql-server","business-intelligence","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":193,"score":0,"question_id":11177567,"title":"No selection to install SSIS, SSRS and SSAS","body":"<p>Goal:<br>\nInstall Developer SQL Server 2012+ Business intelligence and its SSIS, SSRS and SSAS in my computer.  </p>\n\n<p>Problem:<br>\nCan't find the settings or something similar in the install selection  to install SSIS, SSRS and SSAS in my computer.</p>\n\n<p>Before doing the installation, a screen was displayed with selection of feature. Look at the picture.</p>\n\n<p><img src=\"http://i.stack.imgur.com/MRDuf.gif\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":1,"view_count":167,"score":5,"question_id":12842251,"title":"Update the same table in SQL Server","body":"<p>I was trying to update the same table data from same table data.</p>\n\n<p>My SP is as shown below :</p>\n\n<pre><code>UPDATE T1\nSET T1.Name = T2.Name\n   , T1.Age = T2.Age\n   , T1.Subject = T2.Subject\nFROM Student T1\n   , Student T2\nWHERE T1.StudentID = @OldID\n   AND T2.StudentID = @NewID\n</code></pre>\n\n<p>When I am executing this query, there is no error. But the update is not working.</p>\n\n<p>[here NO Common column values to compare like T1.StudentID = T2.StudentID]</p>\n"},{"tags":["sql","sql-server","decimal","number-formatting"],"answer_count":6,"favorite_count":0,"up_vote_count":18,"down_vote_count":0,"view_count":114993,"score":18,"question_id":441600,"title":"Write a number with two decimal places SQL server","body":"<p>How do you write number in two decimal place for sql server?</p>\n"},{"tags":["sql-server","delphi","ado"],"answer_count":1,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":126,"score":7,"question_id":13074765,"title":"TADOQuery Join tables - Insert \\ Delete records from result","body":"<p>Using a single <code>TADOQuery</code> i pull records from two different tables using a left outer join:  </p>\n\n<pre><code>Select M*, D.* from Courier M Left outer join Courier_VT D on M.Courier_Identifier = D.FK_Courier_Identifier\n</code></pre>\n\n<p>I use a <code>TDBGrid</code> to successfully post field updates to my MSSQL DB.</p>\n\n<p>Since there is foreign key reference (<code>FK_Courier_Identifier</code> with <code>Courier_Identifier</code>) I get a error when I insert a record, </p>\n\n<blockquote>\n  <p>Cannot Insert the value Null in to column 'FK_Courier_Identifier', table Courier_VT; column does not allow null</p>\n</blockquote>\n\n<p>but a record is posted in Courier table, i do know that i need to assign the <code>Courier_Identifier</code> to <code>FK_Courier_Identifier</code> before posting but don't how and where to do it</p>\n\n<p>How do we Insert \\ Delete records in this scenario ? Is it possible to achieve using a single <code>TADOQuery</code> ? </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":65,"score":4,"question_id":13093642,"title":"Select rows with same column A but different column B","body":"<pre><code>ID          Zip        Room\n----------- ---------- ------\n317         94087      S105\n318         94087      L603\n1739        94404-1801 L603\n1823        94401-2129 L603\n1824        94401-2129 L603\n2135        94404-1801 L603\n2268        95136-1459 S604\n2269        95136-1459 S604\n3704        92673-6417 L402\n4479        93454-9670 L402\n4480        93454-9670 L402\n4782        92395-4681 L402\n4783        92395-4681 L402\n4852        92886-4411 L402\n4853        92886-4411 L402\n4959        92673-6417 L402\n5153        91773-4028 L402\n5202        91773-4028 L402\n5211        91765-2959 L402\n5212        91765-2959 L402\n5388        92336-0605 L402\n5392        92336-0605 L402\n5727        92870      L402\n5728        92870      L402\n5831        92557      L402\n5916        92557      L402\n</code></pre>\n\n<p>How do I select ID's that has THE SAME zip but different Room ?</p>\n\n<p>In the table above, I want the result to be:</p>\n\n<pre><code>ID          Zip        Room\n----------- ---------- ------\n317         94087      S105\n318         94087      L603\n</code></pre>\n\n<p>Using SQL Server 2008</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","join"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13098731,"title":"SQL Join Issue return DISTINCT Names","body":"<p>I have the following two tables with data like so:</p>\n\n<pre><code>Table Values\n var_label\n 1\n 2\n 2\n 1\n 3\n\nTable Codes\nvar_code\n1\n2\n4\n2\n</code></pre>\n\n<p>I need to join these tables and get the distinct result.  The var_label and var_code are equal pieces of data.  I want to have the joined output like so:</p>\n\n<pre><code> MyColumn\n1\n2\n3\n4\n</code></pre>\n\n<p>Wht's the best way to do this?</p>\n"},{"tags":["sql-server","tsql","sql-server-2012","common-table-expression","materialized"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":13090037,"title":"T-SQL CTE materializing techniques not working on SQL Server 2012","body":"<p>I have to use the following techniques to materialized my CTEs and increase the view performance:</p>\n\n<pre><code>WITH CTE AS(\n    SELECT TOP 100 PERCENT\n    ORDER BY ...\n)\n\nWITH CTE AS(\n    SELECT TOP 2147483647\n    ORDER BY ...\n)\n</code></pre>\n\n<p>Now, neither of this ways works. Has anyone face the same issue or know if in SQL Server 2012 this things are not valid?</p>\n"},{"tags":["sql-server","sql-server-2000"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":15689,"score":4,"question_id":2729126,"title":"How to find column names for all tables in all databases in SQL Server","body":"<p>I want to find all column names in all tables <strong>in all databases</strong>. Is there a query that can do that for me? The database is Microsoft SQL Server 2000.</p>\n"},{"tags":["sql","sql-server","vba","ms-access-2007"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1251,"score":1,"question_id":5530465,"title":"Switching Access 2007 accdb backend to SQL server express / Best frontend options?","body":"<p>After reading many posts on this site, I am considering replacing my accdb be (2007) with SQL Server or SQL Server Express?  My fe is currently accdb (accde upon deployment). Is there any advantage to connecting to SQL using .adp as opposed to .accde?  I currently link to tables in SQL using ocdb and it seams to work fine. </p>\n\n<p>The only other question I have is, how much effort is it to create my fe forms using Visual Basic in Visual Studio Express?  The idea of having a standalone exe makes it tempting.  Am i looking at a big learning curve to go from vba to vb?  I'm assuming the funtionality of my code can be replicated in vb with some changes required. </p>\n\n<p>Just seems like a good time to make this decision, while I'm still in the design stage. </p>\n\n<p>Thanks.  </p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13097884,"title":"Data not inserting in c# but same data is inserted in SQL Server query browser","body":"<p>I have a link button in my gridview at which I have some to insert value in table but it is not inserting but query data on debug mode when I tested on SQL Server it is inserted so whats the problem</p>\n\n<pre><code>protected void gvPO_RowCommand(object sender, GridViewCommandEventArgs e)\n{\n        if (e.CommandName == \"Select\")\n        {\n            c.GetConection();\n            SqlCommand cmd = new SqlCommand(\"delete from tmpMateIN\", c.con);\n            cmd.ExecuteNonQuery();\n            DataTable dt;\n\n            int index = Convert.ToInt32(e.CommandArgument);\n            gvPO.SelectedIndex = index;\n\n            if (Convert.ToInt16(gvPO.SelectedIndex) &lt; 0)\n            {\n                lblMsg.Text = \"Please Select Code !\";\n                return;\n            }\n\n            dt = oAccount.GetPO((int)Session[\"CompCode\"], 79, Convert.ToInt16(((LinkButton)gvPO.Rows[gvPO.SelectedIndex].Cells[0].FindControl(\"lnkCode\")).Text.ToString()));\n\n            for (int i = 0; i &lt; dt.Rows.Count; i++)\n            {\n                String s6 = \"insert into tmpMateIN(compcode ,msttype ,mstcode,mstdate ,mstchno ,mstblno ,mstbldt ,mstcust ,itdsrno , itditem ,itdquan ,itdrema ,itemname  ,acctname ,ItmSize , unitname ,itemsize ,chno , chdt  ,godown, packsize ,itdRate , itdDisc , itdAmou  , mstInvNo , mstOrdNo,mstInvDt ,mstOrdDt ,mstrema , mstexcDes , msttaxDes ,msttaxper , mstfrghtDes , mstfrghtper , mstdeliDes ,mstpayDes , mstvaliDes, mstqno, mstqdt , itdthickness , itdlength ,itdwidth ,itdweight, itdtowt , acctaddr , custemail , mstpayMode , mstdepa,itdrefq,itdorgq)values(\" + (int)Session[\"CompCode\"] + \",79,'\" + dt.Rows[i][\"mstcode\"] + \"','\" + dt.Rows[i][\"mstdate\"] + \"',\" + dt.Rows[i][\"mstchno\"] + \",'\" + dt.Rows[i][\"mstchno\"] + \"','\" + dt.Rows[i][\"mstdate\"] + \"','\" + dt.Rows[i][\"mstptcode\"] + \"','\" + (i + 1) + \"','\" + dt.Rows[i][\"itditem\"] + \"','\" + dt.Rows[i][\"itdquan\"] + \"','\" + dt.Rows[i][\"itdrema\"] + \"','\" + dt.Rows[i][\"itdnarr\"] + \"','\" + dt.Rows[i][\"AcctName\"] + \"','\" + dt.Rows[i][\"itdnarr\"] + \"','\" + dt.Rows[i][\"UnitName\"] + \"' ,'\" + dt.Rows[i][\"itdunit\"] + \"','','\" + dt.Rows[i][\"mstdate\"] + \"','','',\" + dt.Rows[i][\"itdRate\"] + \",\" + dt.Rows[i][\"itdamou\"] + \" ,\" + dt.Rows[i][\"itdAmou\"] + \",'\" + dt.Rows[i][\"mstInvNo\"] + \"','\" + dt.Rows[i][\"mstindno\"] + \"','\" + dt.Rows[i][\"mstdate\"] + \"','\" + dt.Rows[i][\"mstdate\"] + \"','\" + dt.Rows[i][\"mstrema\"] + \"','','','\" + dt.Rows[i][\"mstTaxPer\"] + \"','\" + dt.Rows[i][\"mstfrghtDes\"] + \"','\" + dt.Rows[i][\"mstfrghtper\"] + \"','\" + dt.Rows[i][\"mstdeliDes\"] + \"','\" + dt.Rows[i][\"mstpayDes\"] + \"','\" + dt.Rows[i][\"mstvaliDes\"] + \"','\" + dt.Rows[i][\"mstqno\"] + \"','\" + dt.Rows[i][\"mstpodate\"] + \"','\" + dt.Rows[i][\"itdthickness\"] + \"','\" + dt.Rows[i][\"itdsource\"] + \"','\" + dt.Rows[i][\"itddestin\"] + \"','\" + dt.Rows[i][\"itdweight\"] + \"','\" + dt.Rows[i][\"itdtowt\"] + \"','','\" + dt.Rows[i][\"acctaddr\"] + \"','\" + dt.Rows[i][\"mstpayMode\"] + \"','\" + dt.Rows[i][\"mstContactPerson\"] + \"','\" + dt.Rows[i][\"mstlotno\"] + \"','\" + dt.Rows[i][\"mstsection\"] + \"' )\";\n\n                SqlCommand cmd1 = new SqlCommand(s6, c.con);\n                cmd1.ExecuteNonQuery();\n            }\n\n            c.CloseConnection();\n            Response.Redirect(\"Poreport.aspx\");\n    }\n}    \n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13098008,"title":"have to get data from VISIT_Table filter with only date no time","body":"<pre><code>\"SELECT * FROM VISIT_Table WHERE ID='\" + ID + \"' AND DATE ='\" + DateTime.Now.ToString(\"yyyy-MM-dd\") + @\"'\";\n</code></pre>\n\n<p>Above is my query I have to get data from <code>VISIT_Table</code> filter with only date no datetime..</p>\n\n<p>In database <code>visit_date</code> stores <code>2012-10-27 11:10:35</code> I have to get data with only date no time</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":33,"score":2,"question_id":13095216,"title":"SQL no primary or candidate keys in the referenced table","body":"<p>Here's my problem when I write my SQLSever expressions:</p>\n\n<blockquote>\n  <p>There are no primary or candidate keys in the referenced table 'Room'<br>\n  that match the referencing column list in the foreign key 'FK_<em>Booking</em>_RoomNo__4E298478'.</p>\n</blockquote>\n\n<p>And some snapshots to my program:</p>\n\n<pre><code>CREATE TABLE Booking(\n   HotelNo  NVARCHAR(4)     not null,\n   GuestNo      SMALLINT,  \n   DateFrom DATETIME    not null,\n   DateTo       DATETIME,\n   RoomNo       SMALLINT    not null,\n\n   PRIMARY KEY (HotelNo,DateFrom,RoomNo), \n   FOREIGN KEY (HotelNo) REFERENCES Hotel(HotelNo),\n   FOREIGN KEY (GuestNo) REFERENCES Guest(GuestNo),\n   FOREIGN KEY (RoomNo) REFERENCES Room(RoomNo));  &lt;---trouble on this line\n\nCREATE TABLE Room(\n   RoomNo       SMALLINT    not null, \n   HotelNo  NVARCHAR(4)     not null, \n   RoomType     NVARCHAR(25),\n   Price        DECIMAL(5,2),\n\n   PRIMARY KEY (RoomNo,HotelNo), \n   CONSTRAINT fk_Room FOREIGN KEY (HotelNo) REFERENCES Hotel(HotelNo));\n</code></pre>\n\n<p>and here is the Hotel table</p>\n\n<pre><code>CREATE TABLE Hotel(\n   HotelNo  NVARCHAR(4)     not null,\n   HotelName    NVARCHAR(25),\n   City     NVARCHAR(25),\n\n   PRIMARY KEY (HotelNo) );\n</code></pre>\n\n<p>I tried to do some search on this problem, and it says this might be caused when there's no primary key defined in the table Room, but as above, it is defined.</p>\n\n<p>Can someone please help me with this problem? </p>\n\n<p>Thank you in advance.</p>\n"},{"tags":["sql-server","zero","truncation"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13098355,"title":"How should I insert values into table with out truncation of zeros in SQL Server","body":"<p>I got a table EMPLOYEE1 and i'm trying to insert values into it</p>\n\n<pre><code>INSERT INTO EMPLOYEE1 values(00001, 00004566)\n</code></pre>\n\n<p>But it inserts the values as 1 and 4566 truncating zero's why does this happen. can some one help me out</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":31966,"score":8,"question_id":2474839,"title":"Unable to login to SQL Server + SQL Server Authentication + Error: 18456","body":"<p>I have created login account on my localhost\\sql2008 Server (Eg. User123)</p>\n\n<p>Mapped to Database (default)</p>\n\n<p>Authentication Mode on SQL Server is set to both (Windows and SQL)</p>\n\n<p>But login to SQL Server fails with following message (for User123)</p>\n\n<p>Note:  Have checked multiple time that UserName / Password are typed in correctly</p>\n\n<p>Error Details:</p>\n\n<blockquote>\n  <p>Login failed for user 'User123'\n  (Net.SqlClient Data Provider)</p>\n  \n  <p>Server Name : localhost\\sql2008 Error\n  Number: 18456 Severity : 14 State : 1\n  Line Number : 65536</p>\n</blockquote>\n\n<p>any help on this please.</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":19,"score":-6,"question_id":13098270,"title":"Datagridview dynamic editing in c#","body":"<p>I am trying to add data to datagridview dynamically in a winform.How can I do that ?</p>\n\n<p>Please help me.Thanks in advance.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13096707,"title":"Passing data into nested cursors in TSQL","body":"<p>I have a cursor that gets data and fetches it into @data_table.  Then in the while loop I want to pass that @data_table into another cursor (as the table name) to run some more processing. I keep getting a declare @data_table error. How do I fix this?</p>\n\n<pre><code>DECLARE @var_name varchar(50)\nDECLARE @data_table varchar(50)\nDECLARE @data_value varchar(50)\n\nDECLARE curDiscreteVars CURSOR LOCAL\n\nFOR SELECT DISTINCT v.var_name, v.data_table \n    FROM dbo.vars v\n    GROUP BY v.var_name, v.data_table\n\n-- Loop through cursor, translating variable values as needed, and generate counts for each val_code for a variable\nOPEN curDiscreteVars\nFETCH NEXT FROM curDiscreteVars \n    INTO @var_name, @data_table\n\nWHILE @@FETCH_STATUS  = 0\nBEGIN\n    --loop through all possible data values\n\n    DECLARE curValues CURSOR LOCAL\n\n    FOR SELECT DISTINCT @var_name  \n        FROM @data_table\n\n    OPEN curValues\n    FETCH NEXT FROM curValues \n        INTO @data_value\n\n    WHILE @@FETCH_STATUS  = 0\n    BEGIN\n        print @var_name\n\n\n\n        FETCH NEXT FROM curValues \n        INTO @data_value\n    END\n\n    CLOSE curValues\n    DEALLOCATE curValues\n\n    FETCH NEXT FROM curDiscreteVars \n    INTO @var_name, @data_table\nEND\n\nCLOSE curDiscreteVars\nDEALLOCATE curDiscreteVars\n</code></pre>\n"},{"tags":["sql-server","identity"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":40,"score":0,"question_id":13097727,"title":"Identity reseed in sql server not behaving as expected, inside turn constrain off and on block","body":"<pre><code>--drop table table_1;\ncreate table table_1 (a int identity(1,1) PRIMARY KEY,b int);\nALTER TABLE table_1 NOCHECK CONSTRAINT all;\nDBCC CHECKIDENT (table_1, RESEED,100);\nset IDENTITY_INSERT table_1 ON;\ninsert into table_1 (a,b) values (33,300);\ninsert into table_1 (a,b) values (34,400);\nset IDENTITY_INSERT table_1 OFF;\nALTER TABLE table_1  WITH CHECK CHECK CONSTRAINT all;\nselect IDENT_SEED('table_1') as [seed], IDENT_CURRENT('table_1') as [current], IDENT_INCR('table_1') as [Increment];\n-- seed: 1, current_identity: 33,increment: 1 [surprise]\n-- insert into table_1 (b) values (500); [fails]\n--      fails as indentity is 33 \n--      tries to insert 34 and 34 already present\n</code></pre>\n\n<p>why is the indentity starting from 33, and starting NOT from 100 as expected ? </p>\n\n<pre><code>-- drop table table_2;\ncreate table table_2 (a int identity(1,1) PRIMARY KEY,b int);\nALTER TABLE table_2 NOCHECK CONSTRAINT all;\nDBCC CHECKIDENT (table_2, RESEED,100);\nset IDENTITY_INSERT table_2 ON;\ninsert into table_2 (a,b) values (33,300);\ninsert into table_2 (a,b) values (35,300);\nset IDENTITY_INSERT table_2 OFF;\ninsert into table_2 (b) values (9999); -- inserting a row before turning on all constraints\nALTER TABLE table_2  WITH CHECK CHECK CONSTRAINT all;\nselect IDENT_SEED('table_2') as [seed], IDENT_CURRENT('table_2') as [current], IDENT_INCR('table_2') as [Increment];\n-- seed:  1, current_identity: 101,increment: 1 [excpected]\ninsert into table_2 (b) values (500)\n</code></pre>\n\n<p>This is working as expected.</p>\n\n<p>Why is the reseed done inside the constraint turn OFF, turn All block; not honored when row[s] without identity check on are not inserted within the block ?</p>\n"},{"tags":["php","sql-server","arabic"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":896,"score":1,"question_id":3253214,"title":"PHP get Arabic Content from SQL SERVER","body":"<p>how can i get Arabic content when i run MSSQL_QUERY?\nit appears as ????\ni tried to do this\n$res=mssql_query($q);\n$row=mssql_fetch_row($res)\necho iconv(\"unicode\",\"utf-8\",$row[0])\nbut in this case it shows the value as Chinese letters as \nany suggestion is highly appreciated </p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":6,"favorite_count":5,"up_vote_count":13,"down_vote_count":0,"view_count":3341,"score":13,"question_id":2759756,"title":"is it possible to select EXISTS directly as a bit?","body":"<p>I was wondering if it's possible to do something like this (which doesn't work): </p>\n\n<p><code>select cast( (exists(select * from theTable where theColumn like 'theValue%') as bit)</code></p>\n\n<p>Seems like it should be doable, but lots of things that should work in SQL don't ;) I've seen workarounds for this (SELECT 1 where... Exists...) but it seems like I should be able to just cast the result of the exists function as a bit and be done with it.</p>\n"},{"tags":["php","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3409,"score":1,"question_id":6674320,"title":"Fatal error: Call to undefined function mssql_connect() in php","body":"<p>I'm running Windows Server, MS Sql and IIS6.  I am trying to connect php to ms sql database, and I keep getting the following error from the script</p>\n\n<blockquote>\n  <p>Fatal error: Call to undefined function mssql_connect() in .... on line x</p>\n</blockquote>\n\n<p>I have install zend studio in <code>C:\\Program Files\\Zend\\ZendStudio-5.5.0</code> directory.  Configure IIS server and set the path variable to <code>;C:\\Program Files\\Zend\\ZendStudio-5.5.0\\bin\\php5</code> also.\nThe zend studio folder contains php4 and php5 inside the bin dir. I have added <code>extension=php_mssql.dll</code> in the <code>php.ini</code> file which is inside the <code>C:\\Program Files\\Zend\\ZendStudio-5.5.0\\bin\\php5</code> folder. And added <code>php_mssql.dll</code> in the ext dir. <code>php.ini</code> file is placed in windows path <code>C:\\WINDOWS</code> also.</p>\n\n<p>I'm new to PHP, I searched but nobody ever seems fixed this issue. I'll be greatful for any help.</p>\n"},{"tags":["sql","sql-server","dynamic"],"answer_count":3,"favorite_count":4,"up_vote_count":16,"down_vote_count":0,"view_count":16711,"score":16,"question_id":548090,"title":"Dynamic SQL - EXEC(@SQL) versus EXEC SP_EXECUTESQL(@SQL)","body":"<p>What are the real world pros and cons of executing a dynamic SQL command in a stored procedure in SQL Server with</p>\n\n<pre><code>EXEC(@SQL)\n</code></pre>\n\n<p>versus</p>\n\n<pre><code>EXEC SP_EXECUTESQL(@SQL)\n</code></pre>\n\n<p>?</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13074273,"title":"Unable to Auto-Create ASPNETDB.MDF - Visual Web Developer Express 2008 / SQL Express 2008","body":"<p>I Recently began learning ASP.net / SQL. I Installed Sql Server 2008R2 Express Edition; and Visual Web Designer 2008 Express Edition. I recently tried to create a login page and was unsuccessful; any help would be appreciated. I tried by taking the following steps:\n<br/>-Create New WebSite<br/>-Go to design view<br/> -Drag \"login status\" into design view; Drag \"Login\" control onto design view as well; <br/> -In Web.config I changed the authentication to \"forms\" (didnt add anything else) <br/> -Run the page without debug / Type in any information in the login to have a \"ASPNETDB.MDF\" file automatically created into my \"app_data\" folder; \nand i receive the error below.</p>\n\n<p>Note: Sql Server has \"allow Remote connections\" enabled, In configuration manager i enabled tcp/ip and \"pipes\" (these were measures i took after the fact that i couldnt get the DB auto created.) I Have tried \"connecting databases\" to my visual web designer program. Also worth noting that When connecting databases i use .\\ or localhost\\   no istance name because this is the only way V.W.Designer detects my databases. </p>\n\n<p><img src=\"http://i.stack.imgur.com/nAvcs.png\" alt=\"Error I get\"></p>\n\n<p>The stack trace you cant see in the picture is as follow:</p>\n\n<blockquote>\n  <p>[SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified)]\n     System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection) +4849015\n     System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj) +194\n     System.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, Boolean ignoreSniOpenTimeout, Int64 timerExpire, Boolean encrypt, Boolean trustServerCert, Boolean integratedSecurity, SqlConnection owningObject) +4862333\n     System.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, Boolean ignoreSniOpenTimeout, Int64 timerExpire, SqlConnection owningObject) +90\n     System.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(String host, String newPassword, Boolean redirectedUserInstance, SqlConnection owningObject, SqlConnectionString connectionOptions, Int64 timerStart) +376\n     System.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(SqlConnection owningObject, SqlConnectionString connectionOptions, String newPassword, Boolean redirectedUserInstance) +221\n     System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, Object providerInfo, String newPassword, SqlConnection owningObject, Boolean redirectedUserInstance) +189\n     System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection) +4863459\n     System.Data.ProviderBase.DbConnectionFactory.CreateNonPooledConnection(DbConnection owningConnection, DbConnectionPoolGroup poolGroup) +29\n     System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection) +4865788\n     System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory) +117\n     System.Data.SqlClient.SqlConnection.Open() +122\n     System.Web.Management.SqlServices.GetSqlConnection(String server, String user, String password, Boolean trusted, String connectionString) +82</p>\n  \n  <p>[HttpException (0x80004005): Unable to connect to SQL Server database.]\n     System.Web.Management.SqlServices.GetSqlConnection(String server, String user, String password, Boolean trusted, String connectionString) +137\n     System.Web.Management.SqlServices.SetupApplicationServices(String server, String user, String password, Boolean trusted, String connectionString, String database, String dbFileName, SqlFeatures features, Boolean install) +94\n     System.Web.Management.SqlServices.Install(String database, String dbFileName, String connectionString) +25\n     System.Web.DataAccess.SqlConnectionHelper.CreateMdfFile(String fullFileName, String dataDir, String connectionString) +395</p>\n</blockquote>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":158,"score":0,"question_id":4002961,"title":"Trigger on Select","body":"<p>I want to return different results to user when using Select because it returns wrong value and i cant use view or something else because its third party appliction. </p>\n\n<p>I want to make instead of his select perform another select trigger or any thing else.</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":102,"score":2,"question_id":13075854,"title":"Displaying multiple images in one datalist template cell","body":"<p>I know there's a lot of questions about the subject, but my situation is sort of different.\nI'm trying to display 3 images in one datalist cell, for example I have a product table in SQL server that can have multiple images.</p>\n\n<pre><code> Image Mapping table \n ID     URL_Mapping_ID ProductID  \n 1      image 1.png    1\n 2      image 2.png    1\n 3      image 3.png    1   \n\n Product Table \n ProductID   Product\n 1           Chips\n</code></pre>\n\n<p>Upon selecting it from SQL, the result is multiple rows but with different Images.</p>\n\n<p>Now on my asp datalist I have to show 1 product with all the images, so that the user can enlarge the thumbnails.    </p>\n\n<p>What will the best way be to implement this scenario?</p>\n"},{"tags":["sql-server","vb6","ado"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13095621,"title":"\"Class not registered\" error when opening recordset using VB6","body":"<p>I started getting this problem recently. Don't know how it started but I know I disabled some windows services that startup, and deleted some odbc, probably a mysql odbc data source but I'm using MS SQL 2000 for the following.</p>\n\n<p>I get the error when trying to populate the recordset, and the error details are:\n<em>\"Run-time error '-2147221164 (80040154)': Class not registered.\"</em></p>\n\n<pre><code>Private Sub cmdTestConnection_Click()\nDim conn As ADODB.Connection\nSet conn = New ADODB.Connection\nconn.ConnectionString = \"Provider=SQLOLEDB.1;Initial Catalog=dbname;Data Source=mrtestpc2\\sql2000pwd;Extended Properties=uid=sa;pwd=passwordhere;\"\nDim rs As ADODB.Recordset\nSet rs = New ADODB.Recordset\nconn.Open\nrs.Open \"select * from tablename\", conn 'ERROR here\nMsgBox CStr(rs.RecordCount)\nEnd Sub\n</code></pre>\n\n<p>The references that might be relevant to this issue which I have ticked is:\nMicrosoft ActiveX Data Objects 2.8 Library </p>\n\n<p>I've tried with different versions with the above reference, from 2.8 to 2.5 but still get the same problem.</p>\n\n<p>EDIT: I'm trying to figure out whether it's an MDAC issue.\nEDIT: I'm running windows xp sp3.</p>\n"},{"tags":["java","sql-server","jdbc","schema"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1150,"score":0,"question_id":3669352,"title":"JDBC Change Default Schema","body":"<p>I'm trying to connect to a sql server 2005 database via JDBC.  </p>\n\n<p>I get the error:</p>\n\n<blockquote>\n  <p>com.microsoft.sqlserver.jdbc.SQLServerException: The SELECT permission\n  was denied on the object 'MyTable', database 'MyDatabase', schema\n  'dbo'.</p>\n</blockquote>\n\n<p>The schema I use to connect is \"MyUser\".  How do I connect using MyUser as opposed to dbo?</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":801,"score":2,"question_id":1570995,"title":"How to embed images in e-mails sent by msdb.dbo.sp_send_dbmail?","body":"<p>I'm trying to send e-mails to contacts stored in SQL Server database. The e-mails contain images. </p>\n\n<p>I tried the code below,</p>\n\n<p>EXEC msdb.dbo.sp&#95;send&#95;dbmail<br/>\n   @recipients = 'name@address.com;',<br/>\n   @subject = 'Sending Mail from SQL Server Test',<br/>\n   @file_attachments = 'C:\\inetpub\\wwwroot\\pagerror.gif',<br/>\n   @body=N'&lt;img src=\"pagerror.gif\" /&gt;',<br/> \n   @body_format = 'HTML';</p>\n\n<p>but some e-mail providers (like Yahoo) assume the sent mail as spam. What i need is to create the &lt;img&gt; tag like the ones generated by Outlook:</p>\n\n<p>&lt;img width=482 height=675 id=\"_x0000_i1025\" src=\"cid:image002.png@01CA4B5E.28AE48C0\"&gt;</p>\n\n<p>With this tag, Yahoo doesn't assume it as spam. How to process the image so I can refer it like above?</p>\n\n<p>I'm not an advanced SQL Server programmer. I really need a step-by-step tutorial. Please help...</p>\n\n<p>Many thanks in advance</p>\n\n<p>Haris</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13095183,"title":"getting cumulative average per client_ID","body":"<p>I have a table called:</p>\n\n<p><strong>F_Accession_Daily</strong></p>\n\n<pre><code>test_id varchar\nreceived_date date\npatient_id varchar\nclient_id varchar\n</code></pre>\n\n<p>There can be multiple test_id's per patient. Every test_id has only one received_date. every client_id can have multiple patient_id's. </p>\n\n<p>right now I am returning the average test frequency of times tested (<strong>TestFreq</strong>) per <code>client_id</code>. I have a column that will return </p>\n\n<blockquote>\n  <p>[test frequency of patients that had 2 and only 2 tests], [test\n  frequency for patients that had 3 and only 3 tests], [test frequency\n  for patients that had 4 and only 4].....[12 and only 12]. (these are labeled below as testfreq1, testfreq2, testfreq3....testfreq12</p>\n</blockquote>\n\n<p>These are only a client_id basis. </p>\n\n<p>example of the returned data:</p>\n\n<pre><code>+-----------+----------------+---------------+-----------------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+---------+---------+------------+---------+---------+------------+---------+\n| client_id | MonthsCustomer | TotalPatients | Totalaccessions | count1 | TestFreq1 | stdv1 | count2 | TestFreq2 |  stdv2  | count3 | TestFreq3 |  stdv3  | count4 | TestFreq4 |  stdv4  | count5 | TestFreq5 |  stdv5  | count6 | TestFreq6 |  stdv6  | count7 | TestFreq7 |  stdv7  | count8 | TestFreq8 |  stdv8  | count9 | TestFreq9 |  stdv9  | count10 | TestFreq10 | stdv10  | count11 | TestFreq11 | stdv11  | count12 | TestFreq12 | stdv12  |\n+-----------+----------------+---------------+-----------------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+---------+---------+------------+---------+---------+------------+---------+\n|    100001 |             42 |          4289 |           15393 |   1976 |         0 |     0 |    719 |       152 | 202.793 |    385 |       140 | 136.356 |    262 |       130 | 99.5561 |    183 |       117 | 81.273  |    136 |       111 | 71.8437 |    112 |       104 | 62.8288 | 87     | 98        | 51.9194 |     75 |        89 | 49.9136 |      63 |         96 | 40.0267 |      57 |         94 | 37.497  | 45      | 102        | 32.6785 |\n|    100003 |             34 |          2098 |           16026 |    509 |         0 |     0 |    303 |        68 | 97.9581 |    190 |        62 | 55.5366 |    137 |        61 | 50.9664 |    101 |        61 | 48.5921 |     89 |        46 | 27.7256 |     62 |        55 | 38.2849 | 77     | 46        | 27.995  |     60 |        49 | 27.8421 |      51 |         47 | 22.2794 |      48 |         42 | 21.0575 | 40      | 46         | 19.9365 |\n|    100004 |             36 |          5841 |           10693 |   3712 |         0 |     0 |   1122 |       223 | 256.033 |    468 |       236 | 157.251 |    211 |       181 | 103.755 |    165 |       175 | 76.5761 |     86 |       161 | 67.6254 |     46 |       151 | 55.4122 | 13     | 121       | 31.1677 |     12 |       104 | 45.7847 |       2 |         88 | 7.77817 |       3 |         92 | 36.2261 | NULL    | NULL       | NULL    |\n|    100008 |             37 |           581 |            1276 |    249 |         0 |     0 |    174 |        96 | 63.7575 |     91 |        72 | 35.5402 |     38 |        60 | 19.4539 |      9 |        59 | 10.2402 |      5 |        25 | 12.6372 |      1 |        43 | NULL    | NULL   | NULL      | NULL    |      2 |        27 | 4.94975 |       3 |         17 | 12.2202 |       1 |         28 | NULL    | 3       | 21         | 4.04145 |\n+-----------+----------------+---------------+-----------------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+---------+---------+------------+---------+---------+------------+---------+\n</code></pre>\n\n<p>I need to add another column that gives the <code>TOTAL AVERAGE TEST FREQUENCY</code> per client_id. </p>\n\n<p>Another words, I would like to get the average of all the patients per client. </p>\n\n<p>the formula to get the average test frequency is:</p>\n\n<pre><code>(max(received_date) - min(received_date) )/ (count(distinct test_id)-1)\n</code></pre>\n\n<p>I need to get the average of above per patient per client, how do I do it?</p>\n\n<p>Thank you so much for your guidance.</p>\n\n<p>here's my current query that returned the above dataset:</p>\n\n<pre><code>with counted as(\n SELECT\n    client_id,\n    --case when COUNT(*)&gt;=12 then 12 else COUNT(*) end  TimesTested, \n    COUNT(*) as timestested,\n    case when count(*)&gt;1 then\n    (datediff(day,MIN(received_date),max(received_date)))\n  /(COUNT(*)-1) \n else\n 0\n end as testfreq\n  FROM f_accession_daily\n  GROUP BY\n    client_id,\n    patient_id    \n\n),counted2 as (\n  SELECT\n    client_id,\n   TimesTested,\n    CAST(COUNT(*) AS varchar(30)) AS count,\n    CAST(AVG(testfreq) as varchar(30)) as TestFreq,\n    CAST(STDEV(TestFreq) as varchar(30)) Stdv\n  FROM counted\n  GROUP BY\n    client_id,\n    TimesTested\n    )\n    ,\nunpivoted AS (\n  SELECT\n    client_id,\n    ColumnName + CAST(TimesTested AS varchar(10)) AS ColumnName,\n    ColumnValue\n  FROM counted2\n  UNPIVOT (\n    ColumnValue FOR ColumnName IN (count, TestFreq,stdv)\n  ) u\n),\npivoted AS (\n  SELECT\n    client_id clientid,\n    count1, TestFreq1,stdv1,\n    count2, TestFreq2,stdv2,\n    count3, TestFreq3,stdv3,\n    count4, TestFreq4,stdv4,\n    count5, TestFreq5,stdv5,\n    count6, TestFreq6,stdv6,\n    count7, TestFreq7,stdv7,\n    count8, TestFreq8,stdv8,\n    count9, TestFreq9,stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n  FROM unpivoted\n  PIVOT (\n    MAX(ColumnValue) FOR ColumnName IN (\n      count1,TestFreq1,stdv1,\n      count2,TestFreq2,stdv2,\n      count3,TestFreq3,stdv3,\n      count4,TestFreq4,stdv4,\n      count5,TestFreq5,stdv5,\n      count6,TestFreq6,stdv6,\n      count7,TestFreq7,stdv7,\n    count8, TestFreq8,   stdv8,\n    count9, TestFreq9,   stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n    )\n  ) p\n)\n,\nPatientStats as\n(\n select \n distinct\n f.client_id\n ,datediff(MM,c.mlis_date_established,GETDATE()) MonthsCustomer\n ,count(distinct patient_id) TotalPatients\n ,count(distinct accession_id) Totalaccessions\n from F_ACCESSION_DAILY f\n left join D_CLIENT c\n on f.CLIENT_ID=c.CLIENT_ID\n group by f.client_id,c.mlis_date_established\n)\n,\nOver12\nas\n(\nselect client_id,SUM(c) sumcount from\n(\nselect CLIENT_ID,COUNT(*) c\nfrom F_ACCESSION_DAILY\ngroup by CLIENT_ID,PATIENT_ID\nhaving count(*)&gt;12\n) a\ngroup by client_id\n)\n, final as (\nSELECT p.*,pivoted.*,Over12.sumcount SumofGreaterThan12\nFROM pivoted\nleft join PatientStats p\non p.CLIENT_ID=pivoted.CLIENTID\nleft join Over12\non over12.CLIENT_ID=p.CLIENT_ID\nwhere p.CLIENT_ID not in (select CLIENTid from SalesDWH..TestPractices)\n)\n/* Get the data into a temp table */\nSELECT * INTO #TempTable\nFROM final\n/* Drop the cloumns that are not needed */\nALTER TABLE #TempTable\nDROP COLUMN clientid\n/* Get results and drop temp table */\nSELECT * FROM #TempTable\norder by 1 \nDROP TABLE #TempTable\n</code></pre>\n"},{"tags":["sql-server","activex","dts"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13095081,"title":"How stop a DTS from ActiveX Task?","body":"<p><img src=\"http://subir.cc/images/ros.png\" alt=\"a busy cat](![a busy cat\">\n!\n)</p>\n\n<p>That sentence does not work. I want my dts abort when a one packed get failed. </p>\n\n<pre><code>'**********************************************************************\n'  Visual Basic ActiveX Script\n'************************************************************************\n\nFunction Main()\n    Main = DTSTaskExecResult_Failure\nEnd Function\n</code></pre>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13091505,"title":"SQL Server - Reference a column by name in agrregate function","body":"<p>Our application uses a series of tables with many varchar(1000) columns in them. During development of the system, that was considered to be more than enough space for the users to enter text. However, now we're encountering problems with text being cut off, so it seems like some users are entering more text that it can hold. However, I believe that there's rampant misuse of these fields, and I want to see which columns are being used.</p>\n\n<p>From a different question that was answered here on SO, I've come up with the following query to extract the names of the varchar columns in a table:</p>\n\n<pre><code>select\n   syscolumns.name as [Column],\n   syscolumns.length as [MaxLength]\nfrom \n   sysobjects, syscolumns \nwhere sysobjects.id = syscolumns.id\nand   sysobjects.xtype = 'u'\nand   sysobjects.name = 'TableWithTooManyVarcharColumns'\nand syscolumns.xusertype = 167\n</code></pre>\n\n<p>but now I want to use the names of these columns in a new query, and calculate </p>\n\n<pre><code>SELECT \n[Column] as [Name],\n[MaxLength],\nMAX(LEN([Column])) as [MaxUsedLength],\nAVG(LEN([Column])) as [AvgUsedLength],\nSTDEV(LEN([Column])) as [StdDev]\nFROM TableWithTooManyVarcharColumns\nINNER JOIN **{{ reference to table from query above }}**\n</code></pre>\n\n<p>Of course, the first query returns the name of the column, while the second one needs a reference to the column, so I'm not sure how to combine them properly. Any SQL Server gurus able to help?</p>\n"},{"tags":["sql-server","sql-server-agent"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1907,"score":3,"question_id":5407817,"title":"The proper way to disable/enable SQLServer Agent Jobs","body":"<p>I have a number of SQLServer agent scheduled jobs, one of them performs a full database backup. I want to disable some other jobs when backup begins and re-enable them once backup is done. What is the right way to do so?  I was thinking about adding one of the following tsql commands to the first step of the backup task (and respective enable commands to the last step), but I cannot find which one is better (or maybe there is another way).</p>\n\n<pre><code>UPDATE MSDB.dbo.sysjobs\nSET Enabled = 0\nWHERE [Name] IN (....)\n</code></pre>\n\n<p>Or a number of <code>EXEC dbo.sp_update_job</code> ?<br>\nThanks.</p>\n"},{"tags":["sql-server","sql-server-2008","indexed-view"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2404,"score":3,"question_id":3501825,"title":"SQL Server Create View Index which contains distinct or group by","body":"<p>I have a table of address data in my SQL server database. This table is not normalized so it contain many addresses the are repeated. Each unique address can be identified by an Id field (these ids repeat often in the table).</p>\n\n<p>So i created a view on the table to extract all the unique addresses, using Select Distinct(AddressId) from the original table.</p>\n\n<p>Now i would like to create an index on this view to increase the speed of searching, but SQL server is not allowing me to create an index on the view as it contains a distinct or group by (i have tried both to see if it would allow me create index)</p>\n\n<p>Has anyone got any solution around this? or any views to an alternate way to do this.</p>\n\n<p>I need to query this view based on address keywords and return the ones based on the matching count, i have this query in place i'm trying to speed it up by indexing fields in the view.</p>\n\n<p>SQL Server 2008</p>\n\n<pre><code>SELECT      \n    AddressId,  \n    AddressNumber,  \n    AddressName, \n    Town, \n        City,\n        Country,\n    COUNT_BIG(*) As AddCount--,\n    --TRIM(AddressNumber + ' ') + LTRIM(AddressName + ' ')  + LTRIM(Town + ' ') + RTRIM(City + ' ') AS AddressLookup\nFROM\n    [Address] A\nGROUP BY\n    AddressId,\n    AddressNumber, \n    AddressName, \n    Town, \n    City, \n    Country\n</code></pre>\n\n<p>is my query....</p>\n\n<p>if i take out the column with AddressLookup i can add the indexes</p>\n\n<p>Cheers</p>\n"},{"tags":["sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3068,"score":1,"question_id":3127554,"title":"can we write update and delete queries in views?","body":"<pre><code>i have a doubt, in sql server 2005 views. views created by using select statement.\n</code></pre>\n\n<p>can we write update and delete statements in views .</p>\n"}]}
