{"total":54451,"page":1,"pagesize":100,"questions":[{"tags":["sql","sql-server","database","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13298432,"title":"SQL Nested JOIN","body":"<p>I am attemping to do a nested join from 2 sets of unioned tables.   I do not understand why I am getting the following errors:</p>\n\n<blockquote>\n  <p>Msg 156, Level 15, State 1, Line 15 Incorrect syntax near the keyword\n  'INNER'. Msg 156, Level 15, State 1, Line 24 Incorrect syntax near the\n  keyword 'On'.</p>\n</blockquote>\n\n<p>I assume based on the errors there is a problem with my ()'s but the syntax does follow the language shown from <a href=\"http://msdn.microsoft.com/en-us/library/office/bb208854%28v=office.12%29.aspx\" rel=\"nofollow\">Inner Join Operation</a>.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>SELECT TOP 1000\n\nPus.SerialnoId,Hus.RT,Hus.DIVISION,Hus.REGION,Hus.ADJHSG,Hus.ADJINC,Hus.WGTP,Hus.NP,Hus.TYPE,Hus.ACR,Hus.AGS,Hus.BLD,Hus.BUS,Hus.CONP,Hus.ELEP,Hus.FS,Hus.FULP,Hus.GASP,Hus.HFL,Hus.INSP,Hus.KIT,Hus.MHP,Hus.MRGI,Hus.MRGP,Hus.MRGT,Hus.MRGX,Hus.RNTM,Hus.RNTP,Hus.SMP,Hus.TEL,Hus.TEN,Hus.VACS,Hus.VEH,Hus.WATP,Hus.YBL,Hus.FES,Hus.FINCP,Hus.FPARC,Hus.GRNTP,Hus.GRPIP,Hus.HHL,Hus.HHT,Hus.HINCP,Hus.HUGCL,Hus.HUPAC,Hus.HUPAOC,Hus.HUPARC,Hus.LNGI,Hus.MV,Hus.NOC,Hus.NPF,Hus.NPP,Hus.NR,Hus.NRC,Hus.OCPIP,Hus.PARTNER,Hus.PSF,Hus.R18,Hus.R60,Hus.R65,Hus.RESMODE,Hus.SMOCP,Hus.SMX,Hus.SRNT,Hus.SVAL,Hus.TAXP,Hus.WIF,Hus.WKEXREL,Hus.WORKSTAT,Hus.FACRP,Hus.FAGSP,Hus.FBDSP,Hus.FBLDP,Hus.FBUSP,Hus.FCONP,Hus.FELEP,Hus.FFSP,Hus.FFULP,Hus.FGASP,Hus.FHFLP,Hus.FINSP,Hus.FKITP,Hus.FMHP,Hus.FMRGIP,Hus.FMRGP,Hus.FMRGTP,Hus.FMRGXP,Hus.FPLMP,Hus.FRMSP,Hus.FRNTMP,Hus.FRNTP,Hus.FSMP,Hus.FSMXHP,Hus.FSMXSP,Hus.FTAXP,Hus.FTELP,Hus.FTENP,Hus.FVACSP,Hus.FVALP,Hus.FVEHP,Hus.FWATP,Hus.FYBLP,Hus.WGTP1,Hus.WGTP2,Hus.WGTP3,Hus.WGTP4,Hus.WGTP5,Hus.WGTP6,Hus.WGTP7,Hus.WGTP8,Hus.WGTP9,Hus.WGTP10,Hus.WGTP11,Hus.WGTP12,Hus.WGTP13,Hus.WGTP14,Hus.WGTP15,Hus.WGTP16,Hus.WGTP17,Hus.WGTP18,Hus.WGTP19,Hus.WGTP20,Hus.WGTP21,Hus.WGTP22,Hus.WGTP23,Hus.WGTP24,Hus.WGTP25,Hus.WGTP26,Hus.WGTP27,Hus.WGTP28,Hus.WGTP29,Hus.WGTP30,Hus.WGTP31,Hus.WGTP32,Hus.WGTP33,Hus.WGTP34,Hus.WGTP35,Hus.WGTP36,Hus.WGTP37,Hus.WGTP38,Hus.WGTP39,Hus.WGTP40,Hus.WGTP41,Hus.WGTP42,Hus.WGTP43,Hus.WGTP44,Hus.WGTP45,Hus.WGTP46,Hus.WGTP47,Hus.WGTP48,Hus.WGTP49,Hus.WGTP50,Hus.WGTP51,Hus.WGTP52,Hus.WGTP53,Hus.WGTP54,Hus.WGTP55,Hus.WGTP56,Hus.WGTP57,Hus.WGTP58,Hus.WGTP59,Hus.WGTP60,Hus.WGTP61,Hus.WGTP62,Hus.WGTP63,Hus.WGTP64,Hus.WGTP65,Hus.WGTP66,Hus.WGTP67,Hus.WGTP68,Hus.WGTP69,Hus.WGTP70,Hus.WGTP71,Hus.WGTP72,Hus.WGTP73,Hus.WGTP74,Hus.WGTP75,Hus.WGTP76,Hus.WGTP77,Hus.WGTP78,Hus.WGTP79,Hus.WGTP80 \n,Pus.RT,Pus.SPORDER,Pus.ST,Pus.ADJINC,Pus.PWGTP,Pus.AGEP,Pus.CIT,Pus.COW,Pus.DDRS,Pus.DEYE,Pus.DOUT,Pus.DPHY,Pus.DREM,Pus.ENG,Pus.FER,Pus.GCL,Pus.GCM,Pus.GCR,Pus.INTP,Pus.JWMNP,Pus.JWRIP,Pus.JWTR,Pus.LANX,Pus.MAR,Pus.MIG,Pus.MIL,Pus.MLPA,Pus.MLPB,Pus.MLPC,Pus.MLPD,Pus.MLPE,Pus.MLPF,Pus.MLPG,Pus.MLPH,Pus.MLPI,Pus.MLPJ,Pus.MLPK,Pus.NWAB,Pus.NWAV,Pus.NWLA,Pus.NWLK,Pus.NWRE,Pus.OIP,Pus.PAP,Pus.RETP,Pus.SCH,Pus.SCHG,Pus.SCHL,Pus.SEMP,Pus.SEX,Pus.SSIP,Pus.SSP,Pus.WAGP,Pus.WKHP,Pus.WKL,Pus.WKW,Pus.YOEP,Pus.ANC,Pus.ANC1P,Pus.ANC2P,Pus.DECADE,Pus.DRIVESP,Pus.ESP,Pus.ESR,Pus.HISP,Pus.INDP,Pus.JWAP,Pus.JWDP,Pus.LANP,Pus.MIGPUMA,Pus.MIGSP,Pus.MSP,Pus.NAICSP,Pus.NATIVITY,Pus.OC,Pus.PAOC,Pus.PERNP,Pus.PINCP,Pus.POBP,Pus.POVPIP,Pus.POWPUMA,Pus.POWSP,Pus.QTRBIR,Pus.RAC1P,Pus.RAC2P,Pus.RAC3P,Pus.RACAIAN,Pus.RACASN,Pus.RACBLK,Pus.RACNHPI,Pus.RACNUM,Pus.RACSOR,Pus.RACWHT,Pus.RC,Pus.SFN,Pus.SFR,Pus.VPS,Pus.WAOB,Pus.FAGEP,Pus.FANCP,Pus.FCITP,Pus.FCOWP,Pus.FDDRSP,Pus.FDEYEP,Pus.FDOUTP,Pus.FDPHYP,Pus.FDREMP,Pus.FENGP,Pus.FESRP,Pus.FFERP,Pus.FGCLP,Pus.FGCMP,Pus.FGCRP,Pus.FHISP,Pus.FINDP,Pus.FINTP,Pus.FJWDP,Pus.FJWMNP,Pus.FJWRIP,Pus.FJWTRP,Pus.FLANP,Pus.FLANXP,Pus.FMARP,Pus.FMIGP,Pus.FMIGSP,Pus.FMILPP,Pus.FMILSP,Pus.FOCCP,Pus.FOIP,Pus.FPAP,Pus.FPOBP,Pus.FPOWSP,Pus.FRACP,Pus.FRELP,Pus.FRETP,Pus.FSCHGP,Pus.FSCHLP,Pus.FSCHP,Pus.FSEMP,Pus.FSEXP,Pus.FSSIP,Pus.FSSP,Pus.FWAGP,Pus.FWKHP,Pus.FWKLP,Pus.FWKWP,Pus.FYOEP,Pus.PWGTP1,Pus.PWGTP2,Pus.PWGTP3,Pus.PWGTP4,Pus.PWGTP5,Pus.PWGTP6,Pus.PWGTP7,Pus.PWGTP8,Pus.PWGTP9,Pus.PWGTP10,Pus.PWGTP11,Pus.PWGTP12,Pus.PWGTP13,Pus.PWGTP14,Pus.PWGTP15,Pus.PWGTP16,Pus.PWGTP17,Pus.PWGTP18,Pus.PWGTP19,Pus.PWGTP20,Pus.PWGTP21,Pus.PWGTP22,Pus.PWGTP23,Pus.PWGTP24,Pus.PWGTP25,Pus.PWGTP26,Pus.PWGTP27,Pus.PWGTP28,Pus.PWGTP29,Pus.PWGTP30,Pus.PWGTP31,Pus.PWGTP32,Pus.PWGTP33,Pus.PWGTP34,Pus.PWGTP35,Pus.PWGTP36,Pus.PWGTP37,Pus.PWGTP38,Pus.PWGTP39,Pus.PWGTP40,Pus.PWGTP41,Pus.PWGTP42,Pus.PWGTP43,Pus.PWGTP44,Pus.PWGTP45,Pus.PWGTP46,Pus.PWGTP47,Pus.PWGTP48,Pus.PWGTP49,Pus.PWGTP50,Pus.PWGTP51,Pus.PWGTP52,Pus.PWGTP53,Pus.PWGTP54,Pus.PWGTP55,Pus.PWGTP56,Pus.PWGTP57,Pus.PWGTP58,Pus.PWGTP59,Pus.PWGTP60,Pus.PWGTP61,Pus.PWGTP62,Pus.PWGTP63,Pus.PWGTP64,Pus.PWGTP65,Pus.PWGTP66,Pus.PWGTP67,Pus.PWGTP68,Pus.PWGTP69,Pus.PWGTP70,Pus.PWGTP71,Pus.PWGTP72,Pus.PWGTP73,Pus.PWGTP74,Pus.PWGTP75,Pus.PWGTP76,Pus.PWGTP77,Pus.PWGTP78,Pus.PWGTP79,Pus.PWGTP80\n\nFROM \n\n    (select * FROM \n        (select serialnoId,RT,DIVISION,PUMA,REGION,ST,ADJHSG,ADJINC,WGTP,NP,TYPE,ACR,AGS,BLD,BUS,CONP,ELEP,FS,FULP,GASP,HFL,INSP,KIT,MHP,MRGI,MRGP,MRGT,MRGX,RNTM,RNTP,SMP,TEL,TEN,VACS,VEH,WATP,YBL,FES,FINCP,FPARC,GRNTP,GRPIP,HHL,HHT,HINCP,HUGCL,HUPAC,HUPAOC,HUPARC,LNGI,MV,NOC,NPF,NPP,NR,NRC,OCPIP,PARTNER,PSF,R18,R60,R65,RESMODE,SMOCP,SMX,SRNT,SVAL,TAXP,WIF,WKEXREL,WORKSTAT,FACRP,FAGSP,FBDSP,FBLDP,FBUSP,FCONP,FELEP,FFSP,FFULP,FGASP,FHFLP,FINSP,FKITP,FMHP,FMRGIP,FMRGP,FMRGTP,FMRGXP,FPLMP,FRMSP,FRNTMP,FRNTP,FSMP,FSMXHP,FSMXSP,FTAXP,FTELP,FTENP,FVACSP,FVALP,FVEHP,FWATP,FYBLP,WGTP1,WGTP2,WGTP3,WGTP4,WGTP5,WGTP6,WGTP7,WGTP8,WGTP9,WGTP10,WGTP11,WGTP12,WGTP13,WGTP14,WGTP15,WGTP16,WGTP17,WGTP18,WGTP19,WGTP20,WGTP21,WGTP22,WGTP23,WGTP24,WGTP25,WGTP26,WGTP27,WGTP28,WGTP29,WGTP30,WGTP31,WGTP32,WGTP33,WGTP34,WGTP35,WGTP36,WGTP37,WGTP38,WGTP39,WGTP40,WGTP41,WGTP42,WGTP43,WGTP44,WGTP45,WGTP46,WGTP47,WGTP48,WGTP49,WGTP50,WGTP51,WGTP52,WGTP53,WGTP54,WGTP55,WGTP56,WGTP57,WGTP58,WGTP59,WGTP60,WGTP61,WGTP62,WGTP63,WGTP64,WGTP65,WGTP66,WGTP67,WGTP68,WGTP69,WGTP70,WGTP71,WGTP72,WGTP73,WGTP74,WGTP75,WGTP76,WGTP77,WGTP78,WGTP79,WGTP80 from dbo.AcsBy320052007Hus\n        UNION ALL \n        select serialnoId,RT,DIVISION,PUMA,REGION,ST,ADJHSG,ADJINC,WGTP,NP,TYPE,ACR,AGS,BLD,BUS,CONP,ELEP,FS,FULP,GASP,HFL,INSP,KIT,MHP,MRGI,MRGP,MRGT,MRGX,RNTM,RNTP,SMP,TEL,TEN,VACS,VEH,WATP,YBL,FES,FINCP,FPARC,GRNTP,GRPIP,HHL,HHT,HINCP,HUGCL,HUPAC,HUPAOC,HUPARC,LNGI,MV,NOC,NPF,NPP,NR,NRC,OCPIP,PARTNER,PSF,R18,R60,R65,RESMODE,SMOCP,SMX,SRNT,SVAL,TAXP,WIF,WKEXREL,WORKSTAT,FACRP,FAGSP,FBDSP,FBLDP,FBUSP,FCONP,FELEP,FFSP,FFULP,FGASP,FHFLP,FINSP,FKITP,FMHP,FMRGIP,FMRGP,FMRGTP,FMRGXP, FPLMP,FRMSP,FRNTMP,FRNTP,FSMP,FSMXHP,FSMXSP,FTAXP,FTELP,FTENP,FVACSP,FVALP,FVEHP,FWATP,FYBLP,WGTP1,WGTP2,WGTP3,WGTP4,WGTP5,WGTP6,WGTP7,WGTP8,WGTP9,WGTP10,WGTP11,WGTP12,WGTP13,WGTP14,WGTP15,WGTP16,WGTP17,WGTP18,WGTP19,WGTP20,WGTP21,WGTP22,WGTP23,WGTP24,WGTP25,WGTP26,WGTP27,WGTP28,WGTP29,WGTP30,WGTP31,WGTP32,WGTP33,WGTP34,WGTP35,WGTP36,WGTP37,WGTP38,WGTP39,WGTP40,WGTP41,WGTP42,WGTP43,WGTP44,WGTP45,WGTP46,WGTP47,WGTP48,WGTP49,WGTP50,WGTP51,WGTP52,WGTP53,WGTP54,WGTP55,WGTP56,WGTP57,WGTP58,WGTP59,WGTP60,WGTP61,WGTP62,WGTP63,WGTP64,WGTP65,WGTP66,WGTP67,WGTP68,WGTP69,WGTP70,WGTP71,WGTP72,WGTP73,WGTP74,WGTP75,WGTP76,WGTP77,WGTP78,WGTP79,WGTP80 from dbo.AcsBy320082010Hus \n        ) AS Hus\n    )\n    INNER JOIN \n    (select * FROM \n        (\n        SELECT serialnoId,RT,SPORDER,PUMA,ST,ADJINC,PWGTP,AGEP,CIT,COW,DDRS,DEYE,DOUT,DPHY,DREM,ENG,FER,GCL,GCM,GCR,INTP,JWMNP,JWRIP,JWTR,LANX,MAR,MIG,MIL,MLPA,MLPB,MLPC,MLPD,MLPE,MLPF,MLPG,MLPH,MLPI,MLPJ,MLPK,NWAB,NWAV,NWLA,NWLK,NWRE,OIP,PAP,RETP,SCH,SCHG,SCHL,SEMP,SEX,SSIP,SSP,WAGP,WKHP,WKL,WKW,YOEP,ANC,ANC1P,ANC2P,DECADE,DRIVESP,ESP,ESR,HISP,INDP,JWAP,JWDP,LANP,MIGPUMA,MIGSP,MSP,NAICSP,NATIVITY,OC,PAOC,PERNP,PINCP,POBP,POVPIP,POWPUMA,POWSP,QTRBIR,RAC1P,RAC2P,RAC3P,RACAIAN,RACASN,RACBLK,RACNHPI,RACNUM,RACSOR,RACWHT,RC,SFN,SFR,VPS,WAOB,FAGEP,FANCP,FCITP,FCOWP,FDDRSP,FDEYEP,FDOUTP,FDPHYP,FDREMP,FENGP,FESRP,FFERP,FGCLP,FGCMP,FGCRP,FHISP,FINDP,FINTP,FJWDP,FJWMNP,FJWRIP,FJWTRP,FLANP,FLANXP,FMARP,FMIGP,FMIGSP,FMILPP,FMILSP,FOCCP,FOIP,FPAP,FPOBP,FPOWSP,FRACP,FRELP,FRETP,FSCHGP,FSCHLP,FSCHP,FSEMP,FSEXP,FSSIP,FSSP,FWAGP,FWKHP,FWKLP,FWKWP,FYOEP,PWGTP1,PWGTP2,PWGTP3,PWGTP4,PWGTP5,PWGTP6,PWGTP7,PWGTP8,PWGTP9,PWGTP10,PWGTP11,PWGTP12,PWGTP13,PWGTP14,PWGTP15,PWGTP16,PWGTP17,PWGTP18,PWGTP19,PWGTP20,PWGTP21,PWGTP22,PWGTP23,PWGTP24,PWGTP25,PWGTP26,PWGTP27,PWGTP28,PWGTP29,PWGTP30,PWGTP31,PWGTP32,PWGTP33,PWGTP34,PWGTP35,PWGTP36,PWGTP37,PWGTP38,PWGTP39,PWGTP40,PWGTP41,PWGTP42,PWGTP43,PWGTP44,PWGTP45,PWGTP46,PWGTP47,PWGTP48,PWGTP49,PWGTP50,PWGTP51,PWGTP52,PWGTP53,PWGTP54,PWGTP55,PWGTP56,PWGTP57,PWGTP58,PWGTP59,PWGTP60,PWGTP61,PWGTP62,PWGTP63,PWGTP64,PWGTP65,PWGTP66,PWGTP67,PWGTP68,PWGTP69,PWGTP70,PWGTP71,PWGTP72,PWGTP73,PWGTP74,PWGTP75,PWGTP76,PWGTP77,PWGTP78,PWGTP79,PWGTP80 FROM dbo.AcsBy320052007Pus\n        UNION ALL \n        select serialnoId,RT,SPORDER,PUMA,ST,ADJINC,PWGTP,AGEP,CIT,COW,DDRS,DEYE,DOUT,DPHY,DREM,ENG,FER,GCL,GCM,GCR,INTP,JWMNP,JWRIP,JWTR,LANX,MAR,MIG,MIL,MLPA,MLPB,MLPC,MLPD,MLPE,MLPF,MLPG,MLPH,MLPI,MLPJ,MLPK,NWAB,NWAV,NWLA,NWLK,NWRE,OIP,PAP,RETP,SCH,SCHG,SCHL,SEMP,SEX,SSIP,SSP,WAGP,WKHP,WKL,WKW,YOEP,ANC,ANC1P,ANC2P,DECADE,DRIVESP,ESP,ESR,HISP,INDP,JWAP,JWDP,LANP,MIGPUMA,MIGSP,MSP,NAICSP,NATIVITY,OC,PAOC,PERNP,PINCP,POBP,POVPIP,POWPUMA,POWSP,QTRBIR,RAC1P,RAC2P,RAC3P,RACAIAN,RACASN,RACBLK,RACNHPI,RACNUM,RACSOR,RACWHT,RC,SFN,SFR,VPS,WAOB,FAGEP,FANCP,FCITP,FCOWP,FDDRSP,FDEYEP,FDOUTP,FDPHYP,FDREMP,FENGP,FESRP,FFERP,FGCLP,FGCMP,FGCRP,FHISP,FINDP,FINTP,FJWDP,FJWMNP,FJWRIP,FJWTRP,FLANP,FLANXP,FMARP,FMIGP,FMIGSP,FMILPP,FMILSP,FOCCP,FOIP,FPAP,FPOBP,FPOWSP,FRACP,FRELP,FRETP,FSCHGP,FSCHLP,FSCHP,FSEMP,FSEXP,FSSIP,FSSP,FWAGP,FWKHP,FWKLP,FWKWP,FYOEP,PWGTP1,PWGTP2,PWGTP3,PWGTP4,PWGTP5,PWGTP6,PWGTP7,PWGTP8,PWGTP9,PWGTP10,PWGTP11,PWGTP12,PWGTP13,PWGTP14,PWGTP15,PWGTP16,PWGTP17,PWGTP18,PWGTP19,PWGTP20,PWGTP21,PWGTP22,PWGTP23,PWGTP24,PWGTP25,PWGTP26,PWGTP27,PWGTP28,PWGTP29,PWGTP30,PWGTP31,PWGTP32,PWGTP33,PWGTP34,PWGTP35,PWGTP36,PWGTP37,PWGTP38,PWGTP39,PWGTP40,PWGTP41,PWGTP42,PWGTP43,PWGTP44,PWGTP45,PWGTP46,PWGTP47,PWGTP48,PWGTP49,PWGTP50,PWGTP51,PWGTP52,PWGTP53,PWGTP54,PWGTP55,PWGTP56,PWGTP57,PWGTP58,PWGTP59,PWGTP60,PWGTP61,PWGTP62,PWGTP63,PWGTP64,PWGTP65,PWGTP66,PWGTP67,PWGTP68,PWGTP69,PWGTP70,PWGTP71,PWGTP72,PWGTP73,PWGTP74,PWGTP75,PWGTP76,PWGTP77,PWGTP78,PWGTP79,PWGTP80 FROM dbo.AcsBy320082010Pus\n        ) AS Pus\n    )\n\nOn Hus.SerialNoId = Pus.SerialNoId\n</code></pre>\n"},{"tags":["sql-server","azure","sql-azure"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13296150,"title":"calculate size of sql azure database","body":"<p>How can I calculate the current size of a SQL Azure Database? (Not the maximum size limit)</p>\n\n<p>Several places (<a href=\"http://blogs.msdn.com/b/sqlazure/archive/2010/08/10/10048453.aspx\" rel=\"nofollow\">like this</a>) suggest using this sql: </p>\n\n<pre><code>SELECT SUM(reserved_page_count) * 8192\nFROM    sys.dm_db_partition_stats\n</code></pre>\n\n<p>However when executing this as the Administrator login I get this error: </p>\n\n<pre><code>Msg 297, Level 16, State 1, Line 1\nThe user does not have permission to perform this action.\n</code></pre>\n"},{"tags":["sql-server","view","group-by","subquery","multiple-tables"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5,"score":0,"question_id":13298501,"title":"CREATE Sql Server VIEW from multiple tables GROUPing BY, SELECTing subqueries AS aliases","body":"<p>Building on this post: <a href=\"http://stackoverflow.com/questions/13239820/ms-version-of-this-mysql-view-with-group-by\">MS Version of This MySQL View with GROUP BY?</a></p>\n\n<p>How can subqueries be added?</p>\n\n<p>All I want is to add to that view is an alias from a SELECT as an alias like:</p>\n\n<pre>... AS table2column2, (SELECT column1 FROM dbo.table3 WHERE constant = 1) AS table3column1, ...</pre>\n\n<p>Yes, I've looked everywhere.  Interwebs have nada.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13298459,"title":"SQL help, adding results to create single table?","body":"<p>How do I add the sums from each results, so that the end results would give me a table like below?</p>\n\n<pre>Date | Sum1       | Sum2\n1108  | Total sum1 | Total sum2\netc. </pre>\n\n<pre><code>DECLARE @StartDate      int\nDECLARE @EndDate  int\n\nSET         @StartDate  = XXXXXX\nSET         @EndDate    = XXXXXX\n\nSELECT                  ODATE,\n                        SUM(CASE WHEN [COLUMN1] IN (X,X) THEN 1 ELSE 0 END)+ SUM(CASE WHEN [COLUMN3] IN (X) THEN 1 ELSE 0 END) AS SUM1,\n                      SUM(CASE WHEN [COLUMN2] IN (X,X) THEN 1 ELSE 0 END) AS SUM2\n\n\nFROM              [Db1]..\nWHERE             ODATE Between @StartDate And @EndDate\n\nUNION ALL\nSELECT                  ODATE,\n                        SUM(CASE WHEN [COLUMN1] IN (X,X) THEN 1 ELSE 0 END)+ SUM(CASE WHEN [COLUMN3] IN (X) THEN 1 ELSE 0 END) AS SUM1,\n                      SUM(CASE WHEN [COLUMN2] IN (X,X) THEN 1 ELSE 0 END) AS SUM2        \n\nFROM              [Db2]..\nWHERE             ODATE Between @StartDate And @EndDate\n\nUNION ALL\nSELECT                  ODATE,\n                        SUM(CASE WHEN [COLUMN1] IN (X,X) THEN 1 ELSE 0 END)+ SUM(CASE WHEN [COLUMN3] IN (X) THEN 1 ELSE 0 END) AS SUM1,\n                      SUM(CASE WHEN [COLUMN2] IN (X,X) THEN 1 ELSE 0 END) AS SUM2        \n\nFROM              [Db3]..\nWHERE             ODATE Between @StartDate And @EndDate\n</code></pre>\n"},{"tags":["c#",".net","sql-server","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":19,"score":2,"question_id":13298310,"title":"Insert default value via EntityFramework","body":"<p>I have default constraint on my caption field in database. In web app if caption is empty NULL value passed to database and database returns exception because samo field it cannot be null (Caption varchar(50) NOT NULL).</p>\n\n<p>So, what is easiest way to set some value (\"\" - empty string) or avoid to send NULL to database if value is really not provided. How I can set that in EntityFrameowrk, or maybe in data access layer...?</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":2,"view_count":31,"score":0,"question_id":13297547,"title":"SQL Server and implicit conversion of types","body":"<p>Where does SQL Server do implicit conversion and what are the rules it follows? I.E when does it convert the left side of the equality operator over the right side?</p>\n\n<pre>Foobar\nid int not null \nquantity int not null\nquantityTest byte not null\ndate varchar(20) not null\ndateTest datetime</pre>\n\n<pre><code>SELECT id\nFROM Foobar\nWHERE quantity &gt; '3'\n\nSELECT id\nFROM foobar\nWHERE quantityTest &gt; 3\n\nSelect id\nFROM foobar\nWHERE date = 20120101\n</code></pre>\n"},{"tags":["sql-server","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5,"score":0,"question_id":13298293,"title":"Using a View with Entity Framework 5 Code First","body":"<p>I have created a SQL Server view which performs some reasonably complex logic on other tables/entities in my model and which exposes a series of columns. All but one of these columns are simple types (bigints, nvarchars etc) but one is a complex entity within my model.</p>\n\n<p>I have created an entity which maps to this view as follows:</p>\n\n<pre><code>public class NetworkSuppliersByClient : Entity, IKeyed&lt;long&gt;\n{\n    public long NetworkSuppliersByClientId { get; set; }\n\n    public long NetworkId { get; set; }\n    public String NetworkName { get; set; }\n    public long OwningClientId { get; set; }\n    public long ClientId { get; set; }\n    public virtual Supplier Supplier { get; set; }\n    public bool PublicEntry { get; set; }\n\n    public long GetKey ()\n    {\n        return NetworkSuppliersByClientId;\n    }\n}\n</code></pre>\n\n<p>As you can see, the Supplier entry maps to an existing entity within the model, itself being a complex type with other contained entities (aka tables).</p>\n\n<p>The issue that I have is that when I try to read from the view I get the error \"<strong><em>The entity type NetworkSuppliersByClient is not part of the model for the current context.</em></strong>\".</p>\n\n<p>However, when I try to register the entity with the context as a DbSet I get the error \"<strong><em>There is already an object named 'NetworkSuppliersByClients' in the database.</em></strong>\" as it tries to create a table with the same name as the already existing view.</p>\n\n<p>Is there any way around this, for example to inhibit EF from trying to create the table at startup, or is there a better way to read from a view?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13296400,"title":"MSSQL select single row with all references counted","body":"<p>I am attempting to do something using MSSQL that I believe is possible (easily) but I do not know how to vocalize the correct search string. I have the situation below.</p>\n\n<pre><code>Table A\nUID  | Value....\n1    | a\n2    | b\n3    | c\n\n\nTable B\nPartTypes_uid_fk   | Value....\n1           | a\n1           | b\n1           | c\n1           | d\n1           | e\n3           | 67\n3           | 1354\n</code></pre>\n\n<p>I am attempting to get the following result, query Table A for all results {TableA.*} and on the same row result show the number of table b references {count TableB.tableA_fk}\nWhat I have so far is the following.</p>\n\n<p><code>SELECT DISTINCT t1.uid, CONVERT(varchar(MAX), t1.Name) AS Name, CONVERT(varchar(MAX), t1.Description) AS Description, \nCount(t2.Items_uid_fk) OVER (Partition By t2.PartTypes_uid_fk) as Count \nFROM [Table1] as t1 left outer join Table2 as t2 on t2.PartTypes_uid_fk=t1.uid;</code></p>\n\n<p>This works for all of Table A records with an associated record in Table B but if there are 0 entries in Table B it won't work. The conversion of the varchars was required due to the fact they are ntext format and it was distinct.</p>\n\n<p>Thank you for all your help in advance.\nStephen</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":6,"favorite_count":7,"up_vote_count":18,"down_vote_count":0,"view_count":2043,"score":18,"question_id":1597442,"title":"Subquery using Exists 1 or Exists *","body":"<p>I used to write my EXISTS checks like this:</p>\n\n<pre><code>IF EXISTS (SELECT * FROM TABLE WHERE Columns=@Filters)\nBEGIN\n   UPDATE TABLE SET ColumnsX=ValuesX WHERE Where Columns=@Filters\nEND\n</code></pre>\n\n<p>One of the DBA's in a previous life told me that when I do an <code>EXISTS</code> clause, use <code>SELECT 1</code> instead of <code>SELECT *</code></p>\n\n<pre><code>IF EXISTS (SELECT 1 FROM TABLE WHERE Columns=@Filters)\nBEGIN\n   UPDATE TABLE SET ColumnsX=ValuesX WHERE Columns=@Filters\nEND\n</code></pre>\n\n<p>Does this really make a difference?</p>\n"},{"tags":["sql","sql-server","reporting-services","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13297717,"title":"How can we send email with an attachment to 500 people using SQL Server (SSIS, SSRS or SQL AGENT)","body":"<p>I need your advice. How can we send email with an attachment to 500 users. We are using SQL Server 2008 R2 Enterprise edition in our company.</p>\n\n<p>I had tried using the <code>Send Mail</code> task from SSIS, but seems we can send maximum of 18 recipients due to the constraint in <code>To: Cc: Bcc:</code>.</p>\n\n<p>Is there any way we can send using SQL Agent or SSRS ??</p>\n\n<p>I have another doubt regarding SSRS report subscription recipients. </p>\n\n<p>To how many maximum number of recipients we can send report using subscription. The reason i am asking this second is if i can send a report to 500 users by using SSRS report subscription then i can use SSRS.</p>\n\n<p>Thanks for your time!! </p>\n"},{"tags":["sql","sql-server","query","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":13241518,"title":"sql query including month columns?","body":"<p>I was wondering if I could get some ideas or direction on a sql query that would output column months. Here is my current query..</p>\n\n<pre><code>select A.assetid, A.Acquisition_Cost, B.modepreciaterate from FA00100 A\ninner join FA00200 B on A.assetindex = B.assetindex\nwhere MoDepreciateRate != '0'\n</code></pre>\n\n<p>I would like to add more columns that look as such:</p>\n\n<pre><code>select assetid, acquisition_cost, perdeprrate, Dec_2012, Jan_2013, Feb_2013....\n\nwhere Dec_2012 = (acquisition_cost - MoDepreciateRate*(# of months))\nand Jan_2013 = (acquisition_cost - MoDepreciateRate*(# of months))\n</code></pre>\n\n<p>where # of months can be changed.</p>\n\n<p>Any help would be really appreciated. Thank you!</p>\n\n<p>Here is an example of what I would like the output to be with '# of months' = 4</p>\n\n<pre><code>assetid SHRTNAME    Acquisition_Cost    perdeprrate Dec_2012    Jan_2013    Feb_2013    Mar_2013\nCS-013  GEH INTEG   17490.14            485.83      17004.31    16518.48    16032.65    15546.82\nCS-014  WEB BRD     14560               404.4507    14155.5493  13751.0986  13346.6479  12942.1972\n</code></pre>\n"},{"tags":["asp.net","sql","sql-server"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":64,"score":0,"question_id":12177545,"title":"Counting Duplicates from table","body":"<p>I have got a table which i have mentioned below, i need to get a total results avoiding duplicates , can any one provide any assistance or suggestions on how to get the results mentioned below, thankyu</p>\n\n<pre><code>ID      name    Total   Used\n24     John     5        2\n24     John     10       6\n27     Peter    20       0\n27     Peter    20       5\n</code></pre>\n\n<p>Result should be something like this </p>\n\n<pre><code>ID      name    Total   Used\n24     John     15       8\n27     Peter    40       5\n</code></pre>\n"},{"tags":["c#","sql-server","entity-framework","sql-server-ce"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13297827,"title":"Use same EDMX for different Databases (Local & Server)","body":"<p>I'm working on a project where I have a local database (SQL CE) which is used as sort of a buffer while no connection to the server exists. On the server I want to use the same database-layout.</p>\n\n<p>Of course I want to use the same EDMX-File which is in a Common.dll available on the Server and the Client.</p>\n\n<p>In the Client I have a connection string with provider=System.Data.SqlServerCe.3.5 while it is provider=System.Data.SqlClient on the server.</p>\n\n<p>My problem comes when I want to save sth on the Server-side: \"The provider manifest given is not of type 'System.Data.SqlClient.SqlProviderManifest'.\"</p>\n\n<p>Is there even a chance to use the same EDMX-File on both parts?\nOr is there any best practice how to handle such a constellation?</p>\n\n<p>Thank you for your help!</p>\n"},{"tags":["sql-server","sql-server-2008-r2","postgis","postgresql-9.2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":7,"score":-1,"question_id":13293885,"title":"Converting a SQL Server 2008 R2 database to PostGIS","body":"<p>I have a database in SQL Server 2008 R2 which needs to be converted into a PostGIS one.</p>\n\n<p>I have PostGres 9.2 installed with the PostGIS extension. What should be my next step to convert my existing SQL Server 2008 R2 database into a PostGIS equivalent?</p>\n\n<p>Thanks.</p>\n"},{"tags":["java","sql-server","jtds","windows-integrated-authe"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5,"score":0,"question_id":13297351,"title":"SQL Server JTDS Connection Issue","body":"<p>This is weird, I am connecting to a sql server 2008 instance that has integrated authentication configured for windows. I found a way to bypass integrated authentication it by doing this in code: </p>\n\n<pre><code>Connection con = DriverManager.getConnection( \"jdbc:jtds:sqlserver://mydbserver/myDbname;useNTLMv2=true;username=$jboss;password=1234;domain=MYDOMAIN\", \"$jboss\", \"1234\");\n</code></pre>\n\n<p>So that above after doing the class for name on the jtds drivers it works perfect. However, I need to put this as a connection string in a config file and when I change the above to use the method call on getConnection without explicity sending in the username,password params like this: </p>\n\n<pre><code> Connection con = DriverManager.getConnection( \"jdbc:jtds:sqlserver://mydbserver/myDbname;useNTLMv2=true;username=$jboss;password=1234;domain=MYDOMAIN\");\n</code></pre>\n\n<p>I get a Native SSPI library not loaded exception because its trying to authenticate using windows authentication. So I find the dll in the jts distribution add ntlmauth.dll to my bin and system classpath and then I get an untrusted domain login exception which I know I can resolve by doing \"RUNAS.exe \" under the domain but that gets me back to having to use integrated authentication which I don't want. </p>\n\n<p>The question comes down to, why can I create a Connection without any issues by passing in the username and password as params on the getConnection() method but when I don't it forces integrated authentication. This would not be an issue if I created the Connection myself in code but I need a single connection string to put in my properties file and don't know how to construct a connection string that will call getConnection() and supply the username,password as params. </p>\n\n<p>I hate these tedious issues have Googled but have come up empty handed, any input would help. - Duncan </p>\n"},{"tags":["sql-server","visual-studio-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":209,"score":2,"question_id":856304,"title":"Change run action in Visual Studio database project","body":"<p>I have a database project in Visual Studio 2008, and I want the ability to run a preprocessor on my sql code (using it to allow for variable database names without resorting to dynamic sql).  So I'd like to change what action occurs when I hit the run button to include running the code through the preprocessor automatically.</p>\n\n<p>Is there a way to do this?  I looked through the dbp file, and there don't seem to be any options even close to this.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13297530,"title":"Retrieve a column from a table then insert it to a new table","body":"<p>I just created a table in SQL 2008. This table has two columns.</p>\n\n<pre><code>CREATE TABLE [dbo].[MyTable]\n(\n[pkey] [bigint] not null,\n[Number] [int]  not null\n)\n</code></pre>\n\n<p>Now I want to insert values into it. The first column can be obtained from another table <code>dbo.OldTable</code>. It has many records and I don't want to manually insert the data. The second column <code>Number</code> can be a <code>0</code> in each row. What is the best way to do this?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":40,"score":3,"question_id":13296853,"title":"SQL Server: how do I get data from a history table?","body":"<p>Can you please help me build an SQL query to retrieve data from a history table?</p>\n\n<p>I'm a newbie with only a one-week coding experience. I've been trying simple SELECT statements so far but have hit a stumbling block.</p>\n\n<p>My football club's database has three tables. The first one links balls to players:</p>\n\n<pre><code>BallDetail\n\n| BallID | PlayerID | TeamID |\n|-------------------|--------|\n|      1 |       11 |     21 |\n|      2 |       12 |     22 |\n</code></pre>\n\n<p>The second one lists things that happen to the balls:</p>\n\n<pre><code>BallEventHistory\n\n| BallID | Event |  EventDate |\n|--------|------ |------------|\n|      1 |  Pass | 2012-01-01 |\n|      1 | Shoot | 2012-02-01 |\n|      1 |  Miss | 2012-03-01 |\n|      2 |  Pass | 2012-01-01 |\n|      2 | Shoot | 2012-02-01 |\n</code></pre>\n\n<p>And the third one is a history change table. After a ball changes hands, history is recorded:</p>\n\n<pre><code>HistoryChanges\n\n| BallID | ColumnName | ValueOld | ValueNew |\n|--------|------------|----------|----------|\n|      2 |   PlayerID |       11 |       12 |\n|      2 |     TeamID |       21 |       22 |\n</code></pre>\n\n<p>I'm trying to obtain a table that would list all passes and shoots Player 11 had done to all balls before the balls went to other players. Like this:</p>\n\n<pre><code>| PlayerID | BallID | Event | Month |\n|----------|--------|-------|-------|\n|       11 |      1 |  Pass |   Jan |\n|       11 |      1 | Shoot |   Feb |\n|       11 |      2 |  Pass |   Jan |\n</code></pre>\n\n<p>I begin so:</p>\n\n<pre><code>SELECT PlayerID, BallID, Event, DateName(month, EventDate)\nFROM BallDetail bd INNER JOIN BallEventHistory beh ON bd.BallID = beh.BallID\nWHERE PlayerID = 11 AND Event IN (Pass, Shoot) ...\n</code></pre>\n\n<p>But how to make sure that Ball 2 also gets included despite being with another player now? </p>\n"},{"tags":["java","sql-server","eclipse","spring-jdbc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13297497,"title":"Adding JDBC jar so Spring Framework can find it","body":"<p>I am new to Java, Spring, and Eclipse.  I am working on a simple Spring program that is using Spring Framework JDBC to connect to Microsoft SQL Server 2012.  With the correct configuration I have succeeded in using the traditional JDBC to talk to the database.  The problem I am running into is the application is not able to find the Microsoft JDBC driver.  I am assuming it is simply a matter of referencing the JAR file differently.  Here is what I currently have for my classpath file:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;classpath&gt;\n    &lt;classpathentry kind=\"src\" output=\"target/classes\" path=\"src/main/java\"/&gt;\n    &lt;classpathentry excluding=\"**\" kind=\"src\" output=\"target/classes\" path=\"src/main/resources\"/&gt;\n    &lt;classpathentry kind=\"con\" path=\"org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6\"/&gt;\n    &lt;classpathentry kind=\"con\" path=\"org.eclipse.m2e.MAVEN2_CLASSPATH_CONTAINER\"/&gt;\n    &lt;classpathentry kind=\"lib\" path=\"C:/Program Files/Microsoft JDBC Driver 4.0 for SQL Server/sqljdbc_4.0/enu/sqljdbc4.jar\"/&gt;\n    &lt;classpathentry kind=\"output\" path=\"target/classes\"/&gt;\n&lt;/classpath&gt;\n</code></pre>\n\n<p>And here is the app-context.xml file:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\"\n    xsi:schemaLocation=\"\n      http://www.springframework.org/schema/beans   http://www.springframework.org/schema/beans/spring-beans-3.1.xsd\n      http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd\"&gt;\n\n    &lt;bean id=\"dataSource\" class=\"org.apache.commons.dbcp.BasicDataSource\"&gt;\n        &lt;property name=\"driverClassName\" value=\"com.microsoft.sqlserver.jdbc.Driver\"/&gt;\n        &lt;property name=\"url\" value=\"jdbc:sqlserver://localhost;databaseName=ProSpringCh8\"/&gt;\n        &lt;property name=\"username\" value=\"****\"/&gt;\n        &lt;property name=\"password\" value=\"****\"/&gt;\n    &lt;/bean&gt;\n\n    &lt;context:property-placeholder location=\"jdbc.properties\" /&gt;\n\n    &lt;bean id=\"contactDao\" class=\"com.accumed.DatabaseTest.dao.jdbc.xml.JdbcContactDao\"&gt;\n        &lt;property name=\"dataSource\"&gt;\n            &lt;ref local=\"dataSource\"/&gt;\n        &lt;/property&gt;\n    &lt;/bean&gt;\n\n&lt;/beans&gt;\n</code></pre>\n"},{"tags":["sql","sql-server","stored-procedures","join"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13297046,"title":"How can I check one table for an entry but use default value if it doesn't exist?","body":"<p>I have 2 tables. <code>TableA</code> has columns <strong>OldLogin</strong> and <strong>NewLogin</strong>. <code>TableB</code> has <strong>ID</strong>, <strong>IsManager</strong>, and <strong>CanChange</strong>.</p>\n\n<p>I'm writing a stored procedure with an input parameter <code>login</code>. It needs ultimately return all columns in <code>TableB</code> where <code>login = ID</code> but it first needs to check <code>TableA</code> to see if it needs to use <strong>NewLogin</strong>. </p>\n\n<p>So, can someone help me write a query that says \"show me all columns in <code>TableB</code> where ID = (login OR NewLogin)\"?</p>\n\n<p>Thanks!</p>\n\n<p>EDIT: Added code:</p>\n\n<pre><code>DECLARE @login varchar(30) = 'test'\n\nSELECT ISNULL(NewLogin, @login) AS NewLogin, TableB .IsManager, TableB.CanChange\nFROM TableA\nLEFT JOIN TableB ON TableB.ID = ISNULL(NewLogin, @login)\nWHERE OldLogin = @login\n</code></pre>\n\n<p>THe above code works only if @login exists in TableA. I get no results if it doesn't exist in that table.</p>\n"},{"tags":["c#","sql-server","entity-framework","entity-framework-5","ef-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13296996,"title":"Entity Framework Migrations renaming tables and columns","body":"<p>I renamed a a couple entities and their navigation properties and generated a new Migration in EF 5. As is usual with renames in EF migrations, by default it was going to drop objects and recreate them. That isn't what I wanted so I pretty much had to build the migration file from scratch.</p>\n\n<pre><code>    public override void Up()\n    {\n        DropForeignKey(\"dbo.ReportSectionGroups\", \"Report_Id\", \"dbo.Reports\");\n        DropForeignKey(\"dbo.ReportSections\", \"Group_Id\", \"dbo.ReportSectionGroups\");\n        DropForeignKey(\"dbo.Editables\", \"Section_Id\", \"dbo.ReportSections\");\n        DropIndex(\"dbo.ReportSectionGroups\", new[] { \"Report_Id\" });\n        DropIndex(\"dbo.ReportSections\", new[] { \"Group_Id\" });\n        DropIndex(\"dbo.Editables\", new[] { \"Section_Id\" });\n\n        RenameTable(\"dbo.ReportSections\", \"dbo.ReportPages\");\n        RenameTable(\"dbo.ReportSectionGroups\", \"dbo.ReportSections\");\n        RenameColumn(\"dbo.ReportPages\", \"Group_Id\", \"Section_Id\");\n\n        AddForeignKey(\"dbo.ReportSections\", \"Report_Id\", \"dbo.Reports\", \"Id\");\n        AddForeignKey(\"dbo.ReportPages\", \"Section_Id\", \"dbo.ReportSections\", \"Id\");\n        AddForeignKey(\"dbo.Editables\", \"Page_Id\", \"dbo.ReportPages\", \"Id\");\n        CreateIndex(\"dbo.ReportSections\", \"Report_Id\");\n        CreateIndex(\"dbo.ReportPages\", \"Section_Id\");\n        CreateIndex(\"dbo.Editables\", \"Page_Id\");\n    }\n\n    public override void Down()\n    {\n        DropIndex(\"dbo.Editables\", \"Page_Id\");\n        DropIndex(\"dbo.ReportPages\", \"Section_Id\");\n        DropIndex(\"dbo.ReportSections\", \"Report_Id\");\n        DropForeignKey(\"dbo.Editables\", \"Page_Id\", \"dbo.ReportPages\");\n        DropForeignKey(\"dbo.ReportPages\", \"Section_Id\", \"dbo.ReportSections\");\n        DropForeignKey(\"dbo.ReportSections\", \"Report_Id\", \"dbo.Reports\");\n\n        RenameColumn(\"dbo.ReportPages\", \"Section_Id\", \"Group_Id\");\n        RenameTable(\"dbo.ReportSections\", \"dbo.ReportSectionGroups\");\n        RenameTable(\"dbo.ReportPages\", \"dbo.ReportSections\");\n\n        CreateIndex(\"dbo.Editables\", \"Section_Id\");\n        CreateIndex(\"dbo.ReportSections\", \"Group_Id\");\n        CreateIndex(\"dbo.ReportSectionGroups\", \"Report_Id\");\n        AddForeignKey(\"dbo.Editables\", \"Section_Id\", \"dbo.ReportSections\", \"Id\");\n        AddForeignKey(\"dbo.ReportSections\", \"Group_Id\", \"dbo.ReportSectionGroups\", \"Id\");\n        AddForeignKey(\"dbo.ReportSectionGroups\", \"Report_Id\", \"dbo.Reports\", \"Id\");\n    }\n</code></pre>\n\n<p>All I'm trying to do is rename <code>dbo.ReportSections</code> to <code>dbo.ReportPages</code> and then <code>dbo.ReportSectionGroups</code> to <code>dbo.ReportSections</code>. Then I need to rename the foreign key column on <code>dbo.ReportPages</code> from <code>Group_Id</code> to <code>Section_Id</code>.</p>\n\n<p>I am dropping the foreign keys and indexes linking the tables together, then I am renaming the tables and the foreign key column, then I'm adding the indexes and foreign keys again. I assumed this was going to work but I am getting a SQL error.</p>\n\n<blockquote>\n  <p>Msg 15248, Level 11, State 1, Procedure sp_rename, Line 215\n  Either the parameter @objname is ambiguous or the claimed @objtype (COLUMN) is wrong.\n  Msg 4902, Level 16, State 1, Line 10\n  Cannot find the object \"dbo.ReportSections\" because it does not exist or you do not have permissions.</p>\n</blockquote>\n\n<p>I'm not having an easy time figuring out what is wrong here. Any insight would be tremendously helpful.</p>\n"},{"tags":["sql","sql-server","pivot","case"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":28,"score":-1,"question_id":13295301,"title":"Select In PIVOT","body":"<p>Is there any way to have a CASE SELECT Statement in a PIVOTED Column. My Code is as follows</p>\n\n<pre><code>SELECT PName, [RN], [HA], [LVN], [MSW], [SC] \nFROM \n(\n   Query\n\n ) src \n\n  pivot\n    (\n     max(Visits)\n    for Discipline in ([RN], [HA], [LVN], [MSW], [SC])\n    ) piv\n</code></pre>\n\n<p>I am getting the output as follows</p>\n\n<pre><code>   Pname        RN         HA          LVN        MSW        SC\n    AA        AG-2/W    LO-1/W       NA-1/W     SK-2/W     NO-2/MON\n    AA        JL-2/W     NULL         NULL        NULL       NULL\n</code></pre>\n\n<p>Because there have been 2 RNs assigned to 1 PN I want to summarize the results only in 1 Row and select only 1 value to be displayed in the RN column so that the result is only as follows based on my condition. </p>\n\n<pre><code>    Pname        RN         HA          LVN        MSW        SC\n    AA        JL-2/W    LO-1/W       NA-1/W     SK-2/W     NO-2/MON\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2000"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1002,"score":0,"question_id":5043443,"title":"Delete with inner join across 3 tables","body":"<p>I have three tables one of this storing users basic information, the other one is profile information and the last one is storing user picture.</p>\n\n<p>When i deleting these user i need to delete all of the data in these tables. So i write a query like this.</p>\n\n<pre><code>DELETE Kullanicilar FROM Kullanicilar \nINNER JOIN ProfilBilgileri ON Kullanicilar.ID = ProfilBilgileri.UyeID \nINNER JOIN UyeResim ON Kullanicilar.ID = UyeResim.UyeID \nWHERE Kullanicilar.ID=@ID\n</code></pre>\n\n<p>But it just deleting the data from \"Kullanicilar\" table.<br />\nAny suggestions?</p>\n\n<p>EDIT : I'm using MSSQL 2008 but hosting firm 2000 so i need compatible code.</p>\n"},{"tags":["asp.net","sql-server","windows","timeout"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13291996,"title":"Is my server lacking storage space?","body":"<p>I have two ASP.Net web applications using SQL Server 2005 hosted on a dedicated  Windows 2003 server. One of the applications only receives around 100 unique hits a day, however, the other receives on average 6,000 unique hits a day. Both applications have been live for around 4 years now without any problems.</p>\n\n<p>Recently I have noticed both applications slowing down quite a bit, page loads taking a long time, much longer than usual. I have also noticed one of the applications getting the following error maybe once or twice a day</p>\n\n<blockquote>\n  <p>System.Data.SqlClient.SqlException: Timeout expired.  The timeout\n  period elapsed prior to completion of the operation or the server is\n  not responding.    at\n  System.Data.SqlClient.SqlConnection.OnError(SqlException exception,\n  Boolean breakConnection)    at\n  System.Data.SqlClient.SqlInternalConnection.OnError(SqlException\n  exception, Boolean breakConnection)    at\n  System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject\n  stateObj)    at System.Data.SqlClient.TdsParser.Run(RunBehavior\n  runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream,\n  BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject\n  stateObj)</p>\n</blockquote>\n\n<p>The capacity of the two databases together comes to around 3 Gig, and the C Drive on the Server is around 20 Gig. However, the current free space on the C Drive is sitting at 3 Gig.</p>\n\n<p>I thought originally the timeout error was coming from leaking connections in my code, but now I am not so sure because as stated, the applications have been live for 4 years now without any trouble like this.</p>\n\n<p>Do you think the issue could be my server?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":29,"score":0,"question_id":13295521,"title":"I'd like to create a series of tables on which I'll loop to do some scenario analysis","body":"<p>Planning to use cursors (simply preference) to do the looping and wondering if there's a better way of setting something like this up than creating dummy tables to house the variables (eg, create table, then populate via INSERT INTO/VALUES() calls) and then selecting from those created tables into the cursors to do the looping.  </p>\n\n<p>I estimate I'll have three sets of parameters, so in setting this up I'll have three nested cursors.  </p>\n\n<p>My big question is in getting my parameters into the cursors for looping, something like this seems sloppy and I'm wondering if there's a better way (simply selecting 10,20,30 within the cursor declaration results in them being housed as columns rather than rows):</p>\n\n<pre><code>CREATE TABLE #countTable (\ncnt SMALLINT )\n\nINSERT INTO #countTable\nVALUES (10,20,30) \n</code></pre>\n\n<p>Any more efficient approaches for this type of scenario analysis?</p>\n\n<p>EDIT:  Related to the set-based comments...I'm trying to create distinct portfolios of securities with different characteristics (as described in my comment below:  X total securities, Y max single security portfolio weight, and Z sector allocation).  From what I've just read on set-based approaches, set-based logic aims to effectively borrow parts of processing for subsequent 'scenarios' (ie, if I pull the top 50 securities, I can, from the resulting set, also pull the top 40 securities rather than querying the original data set again, as the top 40 is a subset of the top 50).  </p>\n\n<p>It seems to me this would be possible for the example laid out above (ie, top 40 from top 50), but NOT for the other examples (max security allocation or sector allocation), as different scenarios aren't subsets of others as they are for the number of securities (eg, a 10% max security weight scenarios isn't either a sub- or superset of a 5% max weight scenario).  Does this sound accurate or is there something I'm missing?</p>\n"},{"tags":["sql-server","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13296106,"title":"Transpose rows into columns","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/7002069/how-to-transpose-a-resultset-from-sql\">How to Transpose a resultset from SQL</a>  </p>\n</blockquote>\n\n\n\n<p>How can I transform the following result set :</p>\n\n<pre><code>month       value1   value2  value3\n-----------------------------------\njanuary     100000   200000  300000\nfebruary    250000   650000  600000\nmarch       350000   300000  900000\n</code></pre>\n\n<p>into the following:</p>\n\n<pre><code>month     january  february  march\n------------------------------------\nvalue1    1000000  2000000   3000000\nvalue2    2500000  6500000   6000000\nvalue3    3500000  3000000   9000000\n</code></pre>\n\n<p>using T-SQL</p>\n"},{"tags":["sql-server","backup","database-backup"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":13296107,"title":"SQL Server Partial Database Backup (excluding some tables)","body":"<p>I'm managing a reasonably large SQL Server database. Some tables contain data that are business-critical and must be backed up offsite daily. But we also have other (read-write) tables that take up about half the size of the database that aren't business-critical.  What I would like to do is something like this:</p>\n\n<pre><code>Primary filegroup: Tables A, B, C --&gt; daily backup\nSecondary filegroup: Tables D, E, F --&gt; monthly (or occasional manual) backup\n</code></pre>\n\n<p>When I tried to test this, I got errors while trying to restore the filegroups.  It looks like I can't restore a single filegroup alone or different file groups from different points in time.  Ideally, I'd like to be able to just restore the primary filegroup (the most important one) first, and then restore the secondary one. I'm willing to accept some data loss on the secondary filegroup.</p>\n\n<p>Can this be done?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2012"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13295559,"title":"Remove extra blank lines in Alter stored procedure or function","body":"<p>In SQL Server 2012 when I write code for a stored procedure and for any function. After that when I want to alter it added extra blank line gap Each and Every time, that's why it seem very bad..</p>\n\n<p><img src=\"http://i.stack.imgur.com/xOec6.png\" alt=\"enter image description here\"></p>\n\n<p>I want to know some SQL Server setting or any other to resolve this issue</p>\n"},{"tags":["sql","sql-server","datetime-operation","sql-convert"],"answer_count":14,"favorite_count":8,"up_vote_count":38,"down_vote_count":0,"view_count":202970,"score":38,"question_id":74385,"title":"How to convert DateTime to VarChar","body":"<p>I am working on a query in Sql Server 2005 where I need to convert a value in DateTime variable into a varchar variable in 'yyyy-mm-dd' format (without time part). </p>\n\n<p>Please help, thanks.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13295900,"title":"Deriving a text string from a date","body":"<p>I could use some help deriving a year quarter from a text string that represents a date. I have a string, say '20121230', to represent 12/30/2012. Somehow, someway, I need to convert this value into '4Q12.' I get stuck after converting the 20121230 into a date:</p>\n\n<pre><code>CONVERT(date,datestringfield,111)\n</code></pre>\n\n<p>I need help deriving the quarter and year from this date and then converting the quarter and year to a string format 4Q12. Any help would be greatly appreciated</p>\n"},{"tags":["php","mysql","sql-server","visual-studio"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":9,"score":1,"question_id":13293623,"title":"using visual studio database file as ms sql server for wamp(php with ms sql)","body":"<p>previously i am using php with mysql to work with but due to client requirements i changed from mysql to .net ,c#,Linq and database file  and they said to use visual studio and i downloaded 2012 edition and i am searching for using the previously done php script to work with visual studio database file. so, please tell me the way to access the database.\nand i am very new to visual studio and i am searching for database login details..</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":30,"score":2,"question_id":13294593,"title":"Trimming spaces out of a string based on a pattern in SQL Server","body":"<p>I have a varchar(max) field with XML data in it. I need to clean it by removing the spaces between the tags. For eg:</p>\n\n<pre><code>&lt;/tns:time_changed&gt;   &lt;tns:changed_properties&gt;  \n</code></pre>\n\n<p>should be cleaned as </p>\n\n<pre><code>&lt;/tns:time_changed&gt;&lt;tns:changed_properties&gt;  \n</code></pre>\n\n<p>I need to do this in a single query and I cannot use replace all white spaces as there are other relevant spaces in the content.</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":13,"score":2,"question_id":13295406,"title":"changing transaction isolation level by configuration","body":"<p>We have somo blocking problems because workflow foundation creates lots of serializable transactions.</p>\n\n<p>Do you know a way for changing every transaction in sql server from serializable to readcommitted?</p>\n\n<p>Can it be made through configuration?</p>\n"},{"tags":["sql","sql-server","tree","root","adjacency-list"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":11646409,"title":"Finding the root node of a descendant in an Adjacency List","body":"<p>In an <strong>Adjacency List</strong> table, given the id of a node, how can I find it's associated <strong>root node</strong>?</p>\n\n<p><em>Note:</em></p>\n\n<p><em>The table contains multiple trees so I cannot simply search for the null parentId.</em></p>\n\n<p><strong>Further Information:</strong></p>\n\n<p>This is what I currently have, any issues or improvements to this?</p>\n\n<pre><code>with tree as\n(\n    select \n        t.*\n\n    from table1 t\n    where t.id = @id\n\n    union all \n\n    select \n        t2.*\n\n    from tree\n    join table1 t2 on tree.parentId = t2.id\n) \n\nselect * \nfrom tree\nwhere parentId is null\n</code></pre>\n"},{"tags":["c#","sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13290804,"title":"How do I change the Data source into Microsoft SQL Server in Visual C#?","body":"<p>I was using this <a href=\"http://razibdeb.wordpress.com/2011/01/23/sql-server-2008-basics-connection-with-vs2010/\" rel=\"nofollow\">tutorial</a> and I'm stuck in this <a href=\"http://razibdeb.files.wordpress.com/2011/01/ms-sql.png\" rel=\"nofollow\">part</a>. The guide tells me to choose 'Microsoft SQL Server', however this is not included in the options of my computer. I only have 'Microsoft Database File', 'Microsoft Server Compact', and 'Microsoft Database Server File'. </p>\n\n<p>How could I add the option 'Microsoft SQL Server'?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":33,"score":0,"question_id":13293975,"title":"Month year back (SQL)","body":"<p>I m trying to dig more in the SQL query , I'm with it.</p>\n\n<pre><code>Yearmo      Back_1_month\n-------     ------------\n 201202      201201            Where 201202 is Feb 2012 , 201201 is Jan 2012\n 201201      201112            \n 201204      201203            \n 201212      201211\n</code></pre>\n\n<p>I m confused , how can make it for 201201.</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":50,"score":-1,"question_id":13294314,"title":"How can I create SQL Query which Takes Parameters from URL in asp.net C#","body":"<p>my link is like </p>\n\n<pre><code>http://localhost/default.aspx?phone=9057897874&amp;order=124556\n</code></pre>\n\n<p>Here Is my basic Page for passing Parameter In URL from ASP.net</p>\n\n<pre><code>&lt;%@ Page Language=\"C#\" AutoEventWireup=\"true\" CodeBehind=\"Default.aspx.cs\"     Inherits=\"WebApplication2._Default\" %&gt;\n&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"   \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;\n\n&lt;html xmlns=\"http://www.w3.org/1999/xhtml\" &gt;\n&lt;head runat=\"server\"&gt;\n&lt;title&gt;Untitled Page&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;form method=\"get\" action=\"default.aspx\"&gt;\n\n&lt;label&gt;Phone No&lt;/label&gt;\n&lt;input type=\"text\" name=\"phone\" /&gt;\n&lt;br /&gt;\n&lt;label&gt;Order No&lt;/label&gt;\n&lt;input type=\"text\" name=\"order\" /&gt;\n&lt;br /&gt;\n&lt;input type=\"submit\" value=\"submit\" /&gt;\n&lt;br /&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>\n</p>\n\n<p>my c# file where I can store the prameters in Variables </p>\n\n<pre><code>namespace WebApplication2\n {\npublic partial class _Default : System.Web.UI.Page\n{\n    protected void Page_Load(object sender, EventArgs e)\n    {\n        string strQuery;\n\n        string phone = Request.QueryString[\"phone\"];\n        if (phone != null)\n        {\n            Response.Write(\"phone no is \");\n            Response.Write(phone);\n        }\n        else\n\n        {\n            Response.Write(\"You phone number is not correct\");\n        }\n\n        string order_no = Request.QueryString[\"order\"];\n        if (order_no != null)\n        {\n            Response.Write(\"Order No is \");\n            Response.Write(order_no);\n        }\n        else\n        {\n            Response.Write(\"You Order number is not correct\");\n        }\n\n//How I can Connect to Mysql Server\n\n        strQuery = \"SELECT order_status where orde01=''\" + order_no + \"'' and phone01=''\" + phone + \"''\";\n\n        Response.Write(strQuery);\n}\n}\n</code></pre>\n\n<p>I'm trying to doing something like this but it's only give me whole query as string.\nI am new on this topic.\nAny help will be appreciate\nThanks </p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":20,"score":0,"question_id":13294882,"title":"Have one part of a query update based on another","body":"<p>I'm not looking for a specific answer to a question so much as a general direction of what to look for when doing further research.  I have a query which is very useful and a certain aspect, <code>mytable.column1</code> I frequently change.  Depending on what <code>mytable.column1</code> is, there is an alias in the table that I would like to change as well.  So, if <code>mytable.column1</code> is 1 the alias needs to be something like <code>aliasFor1</code>, if it's two, then the alias needs to be <code>aliasFor2</code>.  What is the nomenclature for doing something such as this, and what are some good resources for reading up on it?  </p>\n\n<p>If you're going to down vote a question, please respectfully say why you believe it to be not a valid question.</p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures","parameters","table-valued-parameters"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":10,"score":2,"question_id":13295050,"title":"How to organize or avoid temporary User Defined Table Type when passing Table-Valued Parameters","body":"<p>As it was discussed here: <a href=\"http://stackoverflow.com/questions/209686/passing-list-to-sql-stored-procedure\">Passing List&lt;&gt; to SQL Stored Procedure</a> and in many other places, one way to pass table as parameter is to use SqlParameter.</p>\n\n<p>The problem with this is that it requires to specify User Defined Table Type in TypeName property.</p>\n\n<p>I need to load data from an Excel file and pass it as parameter to SQL Statement which will join this data with other database tables to get the result.</p>\n\n<p>In order to do that I would need to create User Defined Table Type for each possible variation of Excel file. I don't want to pollute SQL types with those types that are used just to pass data from each Excel file. How do I achieve that ?</p>\n\n<p>You may ask how can I join something that I don't know type of - the answer is - I know names and types of some fields, but not all. Also if I want to return joined data using select * it would work with any list of fields without me hardcoding all of them inside type.</p>\n\n<p>I can't use OPENROWSET to join this file directly from SQL because I have 64 bit SQL Server and it does not work giving me strange error.</p>\n\n<p>There is concept of temporary tables in SQL Server, but there is no concept of temporary types, how do I simulate temporary type or avoid using it when passing table ?</p>\n\n<p>I could pass data as XML, but it seems less efficient if data size is large enough plus data size is limited to 2Gb.</p>\n\n<p>One way to organize it is to create type, then execute statement, then drop type after or use TRY..CATCH and drop type inside catch.</p>\n\n<p>Another is make special schema, generate unique type names into that schema and clean it from time to time using garbage collection SQL job. And it can be used in combination with first way just to clean leftovers.</p>\n\n<p>Any other suggestions ?</p>\n"},{"tags":["sql-server","ms-access","connection-string"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":795,"score":2,"question_id":1385900,"title":"Moving ms access driven site from sql server to jabry.com - connection string problems","body":"<p>I've done a fair bit of mysql php programming but am pretty new to asp/access etc.</p>\n\n<p>This will either be incredibly easy or impossible!</p>\n\n<p>SUMMARY:</p>\n\n<p>I'm trying to transfer a web application from a corporate network to an external web host for testing and don't know how to connect the pages to the database on the new server.</p>\n\n<p>BACKGROUND:</p>\n\n<p>I've inherited a  (ms access) database driven website from a corporate server and have been asked to pull it apart and document it so that there's no single point of failure issue with it (the original programmer disappeared long ago)</p>\n\n<p>It was hosted on an ms sql server on the corporate network.</p>\n\n<p>I've obtained some free hosting for access driven websites at www.jabry.com and hoped to transfer the whole application to there and use that as a test bed.</p>\n\n<p>I got a copy of the .mdb file and uploaded it to jabry. My question is what connection should i use to the new database?</p>\n\n<p>THIS IS THE OLD CONNECTION INSTRUCTION :</p>\n\n<pre><code>dim objConn\nset objConn = Server.CreateObject(\"ADODB.Connection\")\nobjConn.Open \"PROVIDER=SQLOLEDB;DATA SOURCE=UKNTHSQL900;UID=****User;PWD=***able8; DATABASE=PropertyRegister\"\n</code></pre>\n\n<p>JABRY RECOMMEND USING :</p>\n\n<pre><code>Dim Conn\nSet Conn = Server.CreateObject(\"ADODB.Connection\")\nstrConnection = \"DRIVER=Microsoft Access Driver(*.mdb);DBQ=\" &amp; Server.MapPath(\"/USERNAME/db/yourdatabase.mdb\")\noConn.Open(strConnection)\n</code></pre>\n\n<p>I've tried various permutations to get this to work, but after a couple of hours(!) thought I'd better get some help. </p>\n\n<p>Can I use a dsnless connection when a password is required? Are the two server types completely incompatible? Please help!</p>\n"},{"tags":["sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13294422,"title":"Creating a schema called 'master'","body":"<p>I've created a schema called master in SS2008, however every time I type in the word, it's formatted as blue, rather than black. Should I be worried? I've checked the reserved word list, and it doesn't seem to be on there.</p>\n"},{"tags":["sql-server","firefox","google-chrome","vfp","ole-automation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13275818,"title":"Create a VFP Chrome or FireFox Object","body":"<p>We have a VFP application and need to open a specific site in Chrome or Firefox.  The site is optimized for either of those browsers.</p>\n\n<p>We know how to <code>Createobject</code> for <code>InternetExplorer.Application</code> to open a browser inside our application.  This allows us to interract with the browser.  However, it works only with <code>IE</code>.  </p>\n\n<p>Does anyone know how to accomplish the same purpose using either <code>Chrome</code> or <code>Firefox</code>?  </p>\n\n<p>We have done this to open the default browser (which is <code>Chrome</code> or <code>Firefox</code>).</p>\n\n<pre><code>oShell = Createobject(\"wscript.shell\")\noShell.Run(lcUrl)\n</code></pre>\n\n<p>The issue with this approach is that it just opens the browser and we cannot interact with it (e.g. pass values and read items on the page).</p>\n\n<p>At a minimum, if we can open <code>Chrome</code> or <code>Firefox</code> and pass POST parameters without using a <code>querystring</code> that would be an acceptable start.</p>\n"},{"tags":["sql","sql-server","tsql","date"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":127,"score":1,"question_id":12474658,"title":"Calculate total working days left of the month","body":"<p>Below is my code to calculate the total amount of working days in the current month.</p>\n\n<pre><code>DECLARE @my int\nDECLARE @myDeduct int\nDECLARE @day INT\nDECLARE @mydate DATETIME\n\nSET @mydate = getDate()\n\nSET @myDeduct = 0\nSET DateFirst 1 -- Set it monday=1 (value)\n\n--Saturday and Sunday on the first and last day of a month will Deduct 1\nIF (DATEPART(weekday,(DATEADD(dd,-(DAY(@mydate)-1),@mydate))) &gt; 5)\nSET @myDeduct = @myDeduct + 1\n\nIF (DATEPART(weekday,(DATEADD(dd,-(DAY(DATEADD(mm,1,@mydate))),\n                                                 DATEADD(mm,1,@mydate)))) &gt; 5)\nSET @myDeduct = @myDeduct + 1\n\nSET @my = day(DATEADD(dd,-(DAY(DATEADD(mm,1,@mydate))),DATEADD(mm,1,@mydate)))\n\nselect (((@my/7) * 5 + (@my%7)) - @myDeduct) as Working_Day_per_month\n</code></pre>\n\n<p>How can I now calculate how many of those working days are left for the current month?\nNot worried about public holidays.</p>\n"},{"tags":["sql","sql-server","function","scalar"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":8,"score":1,"question_id":13293516,"title":"When is the dm_db_partition_stats updated?","body":"<p>I want to create a scalar SQL function that checks the row count of a table using dm_db_partition_stats. I have a handful of tables that get pushed to me and during that time the tools that use those tables are rendered useless. </p>\n\n<p>I have these tables backed up on another server. What I'd like to do is run a check on the row count. If the results are 0 then the scalar function will return a 1. In the .NET front-end if a 1 is returned then it can query the backup data.</p>\n\n<p>My question is when will the row count get updated in dm_db_partition_stats? Is it immediately or is there some lag involved?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008-r2","common-table-expression"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13293359,"title":"Joining massive CTE tables (13,000,000 rows+) performance problems","body":"<p>We have a production database that manages personnel booking at 100s of branches for years in advance with minute level accuracy.</p>\n\n<p>Part of this system are reports that highlight gaps, i.e. compare branch opening hours and staff bookings to see if any branches are open with nobody booked.</p>\n\n<p>It also checks for overlaps, double bookings etc all at the same time, basically minute level accuracy is required.</p>\n\n<p>The way we're doing this is to expand the start and end times of openings hours and bookings into minutes with an integer tally table:</p>\n\n<pre><code>--===== Create and populate the Tally table on the fly\n SELECT TOP 16777216\n        IDENTITY(INT,1,1) AS N\n   INTO dbo.Tally\n   FROM Master.dbo.SysColumns sc1,\n        Master.dbo.SysColumns sc2,\n        Master.dbo.SysColumns sc3\n\n--===== Add a Primary Key to maximize performance\n  ALTER TABLE dbo.Tally\n    ADD CONSTRAINT PK_Tally_N \n        PRIMARY KEY CLUSTERED (N) WITH FILLFACTOR = 100\n</code></pre>\n\n<p>We utilise this static indexed tally table to expand opening hours and bookings as follows:</p>\n\n<pre><code>SELECT   [BranchID] ,\n        [DayOfWeek] ,\n        DATEADD(MINUTE, N - 1, StartTime)\nFROM     OpeningHours\n        LEFT OUTER JOIN tally ON tally.N BETWEEN 0\n                                         AND     DATEDIFF(MINUTE, OpeningHours.StartTime, OpeningHours.EndTime) + 1\n</code></pre>\n\n<p>The problem is, once we have the 13,000,000 \"open minutes\" and the \"booked minutes\" we then need to join the results to see what's covered:</p>\n\n<pre><code>SELECT   OpenDatesAndMinutes.[Date] ,\n                                OpenDatesAndMinutes.[Time] ,\n                                OpenDatesAndMinutes.[BranchID] ,\n                                ISNULL(BookedMinutes.BookingCount, 0) AS BookingCount\n                       FROM     OpenDatesAndMinutes\n                                LEFT OUTER JOIN BookedMinutes ON OpenDatesAndMinutes.BranchID = BookedMinutes.BranchID\n                                                                 AND OpenDatesAndMinutes.[Date] = BookedMinutes.[Date]\n                                                                 AND OpenDatesAndMinutes.[Time] = BookedMinutes.[Time]\n</code></pre>\n\n<p>As you can imagine, joining on the branch, date &amp; time with 13,000,000 rows all stored in CTE tables takes AGES - running it for a week isnt too bad, about 10 seconds but if we run it for 6 months (13,000,000 minutes) bloats to 25 minutes+</p>\n\n<p>Once we have joined the open minutes to the booked minutes we then group the data on islands and present to the user:</p>\n\n<pre><code>CrossTabPrep ( [Date], [Time], [BranchID], [BookingCount], [Grp] )\n  AS ( SELECT   [Date] ,\n                [Time] ,\n                [BranchID] ,\n                [BookingCount] ,\n                DATEPART(HOUR, Time) * 60 + DATEPART(MINUTE, Time) - ROW_NUMBER() OVER ( PARTITION BY [BranchID], Date, [BookingCount] ORDER BY Time ) AS [Grp]\n       FROM     PreRender\n     ),\nFinalRender ( [BranchID], [Date], [Start Time], [End Time], [Duration], [EntryCount], [EntryColour] )\n  AS ( SELECT   [BranchID] ,\n                [Date] ,\n                MIN([Time]) AS [Start Time] ,\n                MAX([Time]) AS [End Time] ,\n                ISNULL(DATEDIFF(MINUTE, MIN([Time]), MAX([Time])), 0) AS Duration ,\n                [BookingCount] AS EntryCount ,\n                CASE WHEN [BookingCount] = 0 THEN 'Red'\n                     WHEN [BookingCount] = 1 THEN 'Green'\n                     ELSE 'Yellow'\n                END AS EntryColour\n       FROM     CrossTabPrep\n       GROUP BY [BranchID] ,\n                [Date] ,\n                [BookingCount] ,\n                [Grp]\n     )\n</code></pre>\n\n<p>Quite simply, is my method efficient? is there any way i can improve on this method whilst retaining minute level accuracy? When dealing with massive CTE tables such as this, would there be any benefit in dumping this data to indexed temp tables &amp; joining them instead?</p>\n\n<p>Another thing I was considering is replacing the DATE &amp; TIME(0) data types that the big join uses, would is be more efficient if I cast these to integers?</p>\n\n<p>Here is the Full CTE in case that helps:</p>\n\n<pre><code>WITH    OpeningHours ( [BranchID], [DayOfWeek], [StartTime], [EndTime] )\n          AS ( SELECT   BranchID ,\n                        DayOfWeek ,\n                        CONVERT(TIME(0), AM_open) ,\n                        CONVERT(TIME(0), AM_close)\n               FROM     db_BranchDetails.dbo.tbl_ShopOpeningTimes (NOLOCK)\n                        INNER JOIN @tbl_Days Filter_Days ON db_BranchDetails.dbo.tbl_ShopOpeningTimes.DayOfWeek = Filter_Days.DayNumber\n               WHERE    CONVERT(TIME(0), AM_open) &lt;&gt; CONVERT(TIME(0), '00:00:00')\n               UNION ALL\n               SELECT   BranchID ,\n                        DayOfWeek ,\n                        CONVERT(TIME(0), PM_open) ,\n                        CONVERT(TIME(0), PM_close)\n               FROM     db_BranchDetails.dbo.tbl_ShopOpeningTimes (NOLOCK)\n                        INNER JOIN @tbl_Days Filter_Days ON db_BranchDetails.dbo.tbl_ShopOpeningTimes.DayOfWeek = Filter_Days.DayNumber\n               WHERE    CONVERT(TIME(0), PM_open) &lt;&gt; CONVERT(TIME(0), '00:00:00')\n               UNION ALL\n               SELECT   BranchID ,\n                        DayOfWeek ,\n                        CONVERT(TIME(0), EVE_open) ,\n                        CONVERT(TIME(0), EVE_close)\n               FROM     db_BranchDetails.dbo.tbl_ShopOpeningTimes (NOLOCK)\n                        INNER JOIN @tbl_Days Filter_Days ON db_BranchDetails.dbo.tbl_ShopOpeningTimes.DayOfWeek = Filter_Days.DayNumber\n               WHERE    CONVERT(TIME(0), EVE_open) &lt;&gt; CONVERT(TIME(0), '00:00:00')\n             ),\n        DateRange ( [Date], [DayOfWeek] )\n          AS ( SELECT   CONVERT(DATE, DATEADD(DAY, N - 1, @StartDate)) ,\n                        DATEPART(WEEKDAY, DATEADD(DAY, N - 1, @StartDate))\n               FROM     tally (NOLOCK)\n               WHERE    N &lt;= DATEDIFF(DAY, @StartDate, @EndDate) + 1\n             ),\n        OpenMinutes ( [BranchID], [DayOfWeek], [Time] )\n          AS ( SELECT   [BranchID] ,\n                        [DayOfWeek] ,\n                        DATEADD(MINUTE, N - 1, StartTime)\n               FROM     OpeningHours\n                        LEFT OUTER JOIN tally ON tally.N BETWEEN 0\n                                                         AND     DATEDIFF(MINUTE, OpeningHours.StartTime, OpeningHours.EndTime) + 1\n             ),\n        OpenDatesAndMinutes ( [Date], [Time], [BranchID] )\n          AS ( SELECT   DateRange.[Date] ,\n                        OpenMinutes.[Time] ,\n                        OpenMinutes.BranchID\n               FROM     DateRange\n                        LEFT OUTER JOIN OpenMinutes ON DateRange.DayOfWeek = OpenMinutes.DayOfWeek\n               WHERE    OpenMinutes.BranchID IS NOT NULL\n             ),\n        WhiteListEmployees ( [DET_NUMBERA] )\n          AS ( SELECT   DET_NUMBERA\n               FROM     [dbo].[tbl_ChrisCache_WhiteList]\n               WHERE    [TimeSheetV2_SecurityContext] = @TimeSheetV2_SecurityContext\n             ),\n        BookedMinutesByRole ( [Date], [Time], [BranchID], BookingCount )\n          AS ( SELECT   [BookingDate] ,\n                        DATEADD(MINUTE, N - 1, StartTime) ,\n                        BranchID ,\n                        COUNT(BookingID) AS Bookings\n               FROM     tbl_Booking (NOLOCK)\n                        INNER JOIN tbl_BookingReason  (NOLOCK) ON dbo.tbl_BookingReason.ReasonID = dbo.tbl_Booking.ReasonID\n                        INNER JOIN tbl_ChrisCache  (NOLOCK) ON dbo.tbl_Booking.DET_NUMBERA = dbo.tbl_ChrisCache.DET_NUMBERA\n                        INNER JOIN @ValidPosCodes AS Filter_PostCodes ON dbo.tbl_ChrisCache.POS_NUMBERA = Filter_PostCodes.POSCODE\n                        LEFT OUTER JOIN tally (NOLOCK) ON tally.N BETWEEN 0\n                                                                  AND     DATEDIFF(MINUTE, tbl_Booking.StartTime, tbl_Booking.EndTime) + 1\n               WHERE    ( Void = 0 )\n                        AND tbl_BookingReason.CoverRequired = 0 --#### Only use bookings that dont require cover\n                        AND tbl_booking.BranchID &lt;&gt; '023'   --#### Branch 23 will always have messy data\n                        AND ( dbo.tbl_Booking.BookingDate BETWEEN @StartDate\n                                                          AND     @EndDate )\n               GROUP BY [BookingDate] ,\n                        BranchID ,\n                        DATEADD(MINUTE, N - 1, StartTime)\n             ),\n        BookedMinutesByWhiteList ( [Date], [Time], [BranchID], BookingCount )\n          AS ( SELECT   [BookingDate] ,\n                        DATEADD(MINUTE, N - 1, StartTime) ,\n                        BranchID ,\n                        COUNT(BookingID) AS Bookings\n               FROM     tbl_Booking(NOLOCK)\n                        INNER JOIN tbl_BookingReason (NOLOCK) ON dbo.tbl_BookingReason.ReasonID = dbo.tbl_Booking.ReasonID\n                        INNER JOIN tbl_ChrisCache (NOLOCK) ON dbo.tbl_Booking.DET_NUMBERA = dbo.tbl_ChrisCache.DET_NUMBERA\n                        INNER JOIN WhiteListEmployees Filter_WhiteList ON dbo.tbl_Booking.DET_NUMBERA = Filter_WhiteList.DET_NUMBERA\n                        LEFT OUTER JOIN tally (NOLOCK) ON tally.N BETWEEN 0\n                                                                  AND     DATEDIFF(MINUTE, tbl_Booking.StartTime, tbl_Booking.EndTime) + 1\n               WHERE    ( Void = 0 )\n                        AND tbl_BookingReason.CoverRequired = 0 --#### Only use bookings that dont require cover\n                        AND tbl_booking.BranchID &lt;&gt; '023'   --#### Branch 23 will always have messy data\n                        AND ( dbo.tbl_Booking.BookingDate BETWEEN @StartDate\n                                                          AND     @EndDate )\n               GROUP BY [BookingDate] ,\n                        BranchID ,\n                        DATEADD(MINUTE, N - 1, StartTime)\n             ),\n        BookedMinutes ( [Date], [Time], [BranchID], BookingCount )\n          AS ( SELECT   [Date] ,\n                        [Time] ,\n                        [BranchID] ,\n                        BookingCount\n               FROM     BookedMinutesByRole\n               UNION\n               SELECT   [Date] ,\n                        [Time] ,\n                        [BranchID] ,\n                        BookingCount\n               FROM     BookedMinutesByWhiteList\n             ),\n        PreRender ( [Date], [Time], [BranchID], [BookingCount] )\n          AS ( SELECT   OpenDatesAndMinutes.[Date] ,\n                        OpenDatesAndMinutes.[Time] ,\n                        OpenDatesAndMinutes.[BranchID] ,\n                        ISNULL(BookedMinutes.BookingCount, 0) AS BookingCount\n               FROM     OpenDatesAndMinutes\n                        LEFT OUTER JOIN BookedMinutes ON OpenDatesAndMinutes.BranchID = BookedMinutes.BranchID\n                                                         AND OpenDatesAndMinutes.[Date] = BookedMinutes.[Date]\n                                                         AND OpenDatesAndMinutes.[Time] = BookedMinutes.[Time]\n             ),\n        CrossTabPrep ( [Date], [Time], [BranchID], [BookingCount], [Grp] )\n          AS ( SELECT   [Date] ,\n                        [Time] ,\n                        [BranchID] ,\n                        [BookingCount] ,\n                        DATEPART(HOUR, Time) * 60 + DATEPART(MINUTE, Time) - ROW_NUMBER() OVER ( PARTITION BY [BranchID], Date, [BookingCount] ORDER BY Time ) AS [Grp]\n               FROM     PreRender\n             ),\n        DeletedBranches ( [BranchID] )\n          AS ( SELECT   [ShopNo]\n               FROM     [dbo].[vw_BranchList]\n               WHERE    [Branch_Deleted] = 1\n             ),\n        FinalRender ( [BranchID], [Date], [Start Time], [End Time], [Duration], [EntryCount], [EntryColour] )\n          AS ( SELECT   [BranchID] ,\n                        [Date] ,\n                        MIN([Time]) AS [Start Time] ,\n                        MAX([Time]) AS [End Time] ,\n                        ISNULL(DATEDIFF(MINUTE, MIN([Time]), MAX([Time])), 0) AS Duration ,\n                        --dbo.format_timeV2(ISNULL(DATEDIFF(SECOND, MIN([Time]), MAX([Time])), 0)) AS DurationF ,\n                        [BookingCount] AS EntryCount ,\n                        CASE WHEN [BookingCount] = 0 THEN 'Red'\n                             WHEN [BookingCount] = 1 THEN 'Green'\n                             ELSE 'Yellow'\n                        END AS EntryColour\n               FROM     CrossTabPrep\n               GROUP BY [BranchID] ,\n                        [Date] ,\n                        [BookingCount] ,\n                        [Grp]\n             )\n            SELECT  [BranchID] ,\n                    CONVERT(VARCHAR(10), DATEADD(DAY, 7, CONVERT(DATETIME, CONVERT(VARCHAR(10), DATEADD(day, -1 - ( DATEPART(dw, [Date]) + @@DATEFIRST - 2 ) % 7, [Date]), 103) + ' 23:59:59', 103)), 103) AS WeekEnding ,\n                    [Date] ,\n                    [Start Time] ,\n                    [End Time] ,\n                    [Duration] ,\n                    CONVERT(VARCHAR, ( [Duration] * 60 ) / 3600) + 'h ' + CONVERT(VARCHAR, ROUND(( ( CONVERT(FLOAT, ( ( [Duration] * 60 ) % 3600 )) ) / 3600 ) * 60, 0)) + 'm' AS [DurationF] ,\n                    [EntryCount] ,\n                    [EntryColour] ,\n                    CASE WHEN [EntryCount] = 0 THEN 'Red'\n                         WHEN [EntryCount] &gt;= 1 THEN 'Green'\n                    END AS DurationColour ,\n                    CASE WHEN [EntryCount] = 0 THEN 'This period of open-time isnt covered'\n                         WHEN [EntryCount] &gt;= 1 THEN 'This period of open-time is covered by ' + CONVERT(VARCHAR, [EntryCount]) + ' booking(s)'\n                    END AS [DurationComment]\n            FROM    FinalRender\n            WHERE   FinalRender.BranchID NOT IN ( SELECT    [BranchID]\n                                                  FROM      DeletedBranches )\n</code></pre>\n"},{"tags":["sql-server","tsql","triggers","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":145,"score":0,"question_id":10866548,"title":"Trigger not firing in production but does in non-production","body":"<p>I have a trigger that is firing with out issue in non-production but the same exact code is failing to fire in production. I've confirmed it's not disabled and I've done a trace to see that it is not even executing in production.. I've checked the relevant <code>OBJECTPROPERTY</code> elements and they are the same. I've confirm the code is the same. I've confirmed the same inserts are coming from the application. Below is the code for this trigger:</p>\n\n<pre><code>/****** \n  Object:  Trigger [dbo].[tr_trigger_ins]    \n  Script Date: 06/02/2012 16:51:51 \n******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER OFF\nGO\n\nCREATE TRIGGER [dbo].[tr_trigger_ins] ON [dbo].[table_1]\nFOR INSERT\nAS\nBEGIN\n  UPDATE table_2\n    SET col_1 =\n      CASE \n        WHEN i.col_2 = '0' THEN 0 ELSE 1\n      END\n  FROM INSERTED i\n  INNER JOIN table_3 pa \n    ON i.col_3 = pa.col_3 AND pa.col_4 = 'ispublic'\n  INNER JOIN table_4 pp  \n    ON i.col_5 = pp.col_5\n  INNER JOIN table_2 cs\n    ON pp.col_6 = cs.col_6\nEND\nGO\n</code></pre>\n\n<p>Below is a trigger that is an instead of insert on the same table that is executing in both environments:</p>\n\n<pre><code>/****** \n  Object:  Trigger [dbo].[tr_trigger_before_ins]    \n  Script Date: 06/02/2012 16:55:52 \n******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER OFF\nGO\n\nCREATE TRIGGER [dbo].[tr_trigger_before_ins] ON [dbo].[table_1]\nINSTEAD OF INSERT\nAS\nBEGIN\n  INSERT INTO table_1\n    SELECT * FROM INSERTED\n    WHERE col_3 in (73, 199)\nEND\nGO\n</code></pre>\n\n<p>Any help is greatly appreciated. </p>\n"},{"tags":["sql-server","sql-server-2005","dynamic-sql"],"answer_count":7,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":10418,"score":4,"question_id":1037174,"title":"sql use statement with variable","body":"<p>I'm trying to switch the current database with a SQL statement.\nI have tried the following, but all attempts failed:</p>\n\n<ol>\n<li>USE @DatabaseName</li>\n<li>EXEC sp_sqlexec @Sql -- where @Sql = 'USE [' + @DatabaseName + ']'</li>\n</ol>\n\n<p>To add a little more detail.</p>\n\n<p>EDIT: I would like to perform several things on two separate database, where both are configured with a variable. Something like this:</p>\n\n<pre><code>USE Database1\nSELECT * FROM Table1\n\nUSE Database2\nSELECT * FROM Table2\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":71,"score":2,"question_id":13151650,"title":"SQL Converting an INSERT SELECT to UPDATE as well","body":"<p>I have some SQL written up to address my problem but it is not quite ready. I have been attempting different queries for days now without much luck. FYI I inherited this DB so it may be a bit more advanced than what I am used to. </p>\n\n<p>There is a many-to-many relationship between Formula and Color using the bridge table FormulaColor. FormulaColor has the columns (FormulaId, ColorId, Percentage).</p>\n\n<p>My Business problem, we are converting all the formulas that use color A with the colors B(1%), C(2.8%) and D(96.2%). So if a Formula currently uses the color A as 50% of the formula then I would add a row for that formula with the B color and a percentage of .5%, a row for C color with a percentage of 1.4% and a row for D color with a percentage of 48.1%.</p>\n\n<p>The problem though, is a given formula that contains color A, may also already contain one or more of colors B, C or D. In that case I need to update the percentage by simply adding what was calculated above.</p>\n\n<p>The actual sql that I have so far is as follows. *Note that this is just for handling 1 of the new colors (ColorId=2594)</p>\n\n<pre><code>INSERT INTO FormulaColor (FormulaId, ColorId, Percentage) \nSELECT FormulaId, 2594 as ColorId, round((.01*FormulaColor.Percentage),2) as Percentage\nFROM FormulaColor WHERE ColorId=2595;\nDELETE FROM FormulaColor WHERE ColorId = 2595;\n</code></pre>\n\n<p>I was thinking that using the upsert method that uses @@rowscount is what I need? If so, I can't figure out how to do the update to just add the calculated amount to the percentage.</p>\n\n<p>Any help or resources is appreciated!</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I ended up using the solution from Andriy M. In case it helps someone else out I am posting the actual SQL that I used.</p>\n\n<pre><code>DECLARE @DeletedColor int;\nDECLARE @Replacement TABLE (ColorId int, Percentage float);\n\n-- old ColorId getting replaced\nSET @DeletedColor = 2595\n\n-- new ColorId's and the percentages needed to recalculate\nINSERT INTO @Replacement (ColorId, Percentage) VALUES (2594, .01)\nINSERT INTO @Replacement (ColorId, Percentage) VALUES (2521, .028)\nINSERT INTO @Replacement (ColorId, Percentage) VALUES (2533, .962)\n\nSELECT\n  fc.FormulaId,\n  r.ColorId,\n  Percentage = round(fc.Percentage * r.Percentage, 2)\nINTO #FormulaColor\nFROM FormulaColor fc\nCROSS JOIN @Replacement r\nWHERE fc.ColorId = @DeletedColor\n;\n\nUPDATE old\nSET old.Percentage = old.Percentage + new.Percentage\nFROM FormulaColor old\nINNER JOIN #FormulaColor new\n ON old.FormulaId = new.FormulaId\nAND old.ColorId   = new.ColorId\n;\n\nINSERT INTO FormulaColor (FormulaId, ColorId, Percentage)\nSELECT new.FormulaId, new.ColorId, new.Percentage\nFROM #FormulaColor new\nLEFT JOIN FormulaColor old\n ON old.FormulaId = new.FormulaId\nAND old.ColorId   = new.ColorId\nWHERE old.FormulaId IS NULL\n;\n\nDELETE FROM FormulaColor WHERE ColorId = @DeletedColor;\n</code></pre>\n"},{"tags":["sql","sql-server","sqlcmd"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1090,"score":1,"question_id":1174231,"title":"How do we tell sqlcmd to continue \"on error\" with next batch?","body":"<p>Any ideas on how to accomplish this?</p>\n\n<pre><code>USE [db_name]\nBEGIN TRANSACTION\n...TONS OF INSERTS\nCOMMIT;\nRAISERROR (..) WITH NOWAIT;  //If error continue with next batch\n\nBEGIN TRANSACTION\n...TONS OF INSERTS\nCOMMIT;\nRAISERROR (..) WITH NOWAIT;\n\n...\n</code></pre>\n"},{"tags":["sql","sql-server","query","sql-server-2005","split"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13291954,"title":"SQL Query to split shipping cost over multiple items / rows","body":"<p>I am trying to create a query that will allow me to split a single figure over multiple rows.</p>\n\n<p>For example, purchase order x may have 15 items allocated to it.  Shipping cost is, say, 9.95.  How can I calculate 1/15th of 9.95 and then update the cost price of the stock with 1/15th of the shipping cost?</p>\n\n<p>Therefore the cost price of the item would increase from 4.50 to 5.16 (4.50 + 0.66).</p>\n"},{"tags":["sql-server","reporting-services","ssis","sql-server-2008-r2","ssas"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":20,"score":-4,"question_id":13293982,"title":"Recommended books for SQL Server 2008 R2","body":"<p>After a long wait my company bosses decided to upgrade from SQL Server 2000 to 2008 R2. Just wondering if someone can suggest me with good SQL Server books which cover SSMS (SSIS, SSRS and SSAS). Also I'm not a beginner.</p>\n"},{"tags":["sql-server","tsql","inner-join"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":13277252,"title":"Effectively COUNTing and SUMing on a large inner join","body":"<p>Please consider the following case (simplified for the sake of the question):</p>\n\n<p>I have the following tables in the SQL Server 2012 database:</p>\n\n<pre><code>Parent_Table\n\nId  | Parent table fields\n----+--------------------\n1   | ...\n2   | ...\n3   | ...\n...\n\nChild_Table\n\nId  | ParentId | Child table fields\n----+----------+-------------------\n1   | 2        | ...\n2   | 1        | ...\n3   | 1        | ...\n4   | 3        | ...\n5   | 2        | ...\n...\n\nBig_Table\n\nId      | ChildId  | Value  | Status  | Other fields\n--------+----------+--------|---------------------\n1       | 12       | 672    | Closed  |\n2       | 23       | 133    | Closed  |\n3       | 7        | 2611   | Open    |\n4       | 14       | 84     | Closed  |\n...\n1295769 | 23       | 458    | Closed  |\n1295770 | 18       | 1046   | Open    |\n1295771 | 7        | 8      | Open    |\n</code></pre>\n\n<p>The Child and Parent tables are relatively small (roughly 100 Parent entries and 5 Child entries per parent) and their entries are inserted or deleted only a few times a day.</p>\n\n<p>The \"Big Table\", on the other hand, is growing fast (100 entries per second, for the sake of discussion), and the status of rows becomes Closed after a while (think of client sessions, which is the actually the case here).</p>\n\n<p>I need to periodically (every few seconds) provide the number of Big_Table rows and the sum of the Big_Table.Value column <strong>for a specified Parent.Id</strong> - a different one every time.</p>\n\n<p>I suspect that the straightforward implementation (using inner joins etc.) might be extremely inefficient, and better solution may include additional tables, a table of counters of some sort or I should just implement this in my service code (?!) and take care of persistence somehow.</p>\n\n<p>What would be the \"right\" (efficiency-wise) way of implementing the above?  A solution which handles additional levels of parents/children would be the best one. </p>\n"},{"tags":["sql-server","unit-testing","fulltext-index","population"],"answer_count":4,"favorite_count":1,"up_vote_count":10,"down_vote_count":0,"view_count":4497,"score":10,"question_id":2727911,"title":"How can I know when SQL Full Text Index Population is finished?","body":"<p>We are writing unit tests for our ASP.NET application that run against a test SQL Server database. \nThat is, the ClassInitialize method creates a new database with test data, and the ClassCleanup deletes the database. We do this by running .bat scripts from code.</p>\n\n<p>The classes under test are given a connection string that connects to the unit test database rather than a production database.</p>\n\n<p>Our problem is, that the database contains a full text index, which needs to be fully populated with the test data in order for our tests to run as expected.</p>\n\n<p>As far as I can tell, the fulltext index is always populated in the background. I would like to be able to either:</p>\n\n<ol>\n<li>Create the full text index, fully populated, with a synchronous (transact-SQL?) statement, or</li>\n<li>Find out when the fulltext population is finished, is there a callback option, or can I ask repeatedly?</li>\n</ol>\n\n<p>My current solution is to force a delay at the end the class initialize method - 5 seconds seems to work - because I can't find anything in the documentation.</p>\n"},{"tags":["sql","sql-server","database","script"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13291043,"title":"Script to get detached databases from folder and subfolders","body":"<p>Is there a way to find out if SQL Server databases are attached from a directory with many subfolders apart from going to properties of each .mdf and checking if it is attached?</p>\n\n<p>Is there a script that can check folders/subfolders an write to file to accomplish this?</p>\n\n<p>THanks all.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","query-optimization"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13290797,"title":"Is there any potential probelm removing this ISNULL statement?","body":"<p>So recently we uncovered a long running proc and one of my colleagues pointed out that that dropping the ISNULL in the where clause sped things up for reasons pointed out in this post <a href=\"http://stackoverflow.com/questions/8924913/is-there-is-any-performance-issue-while-using-isnull-in-sql-server\">Is there is any Performance issue while using ISNULL() in SQL Server?</a>. I did some Google searching but couldn't find out for sure if there was any danger in missing data. I know if you say something like this </p>\n\n<pre><code>WHERE ID NOT IN (SELECT MemberID FROM Person WHERE MemberId IS NOT Null)\n</code></pre>\n\n<p>and MemberId is nullable you won't get any matches if you don't include the \"IS NOT NULL\" but I think that is a different issue? Maybe not? </p>\n\n<p>Here is the change my coworker is proposing. </p>\n\n<pre><code>where ISNULL(ct.DisabilityBenefitsConnectAuthorized,0) = 1\n</code></pre>\n\n<p>Would become</p>\n\n<pre><code>where ct.DisabilityBenefitsConnectAuthorized = 1\n</code></pre>\n\n<p>It doesn't seem to be effecting results however I am not 100% sure that it couldn't and we just don't know it. </p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":5564,"score":0,"question_id":7430560,"title":"How to check if cursor exists (open status)","body":"<p>How do I check if a cursor is open or not? Because many times I am encountering the error 'Cursor already exists'. Please let me know how can I check whether a cursor is already in open status.</p>\n\n<p>In fact I have closed as well as Deallocated it at the end (CLOSE ppm_cursor; DEALLOCATE ppm_cursor;) But Still i am getting the same error what could be the reason.</p>\n"},{"tags":["sql-server","ms-access"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13284935,"title":"How do I prevent Access locking database","body":"<p>I have an Microsoft Access application that has a \"continous forms\" subform.  When accessing that form in my application I have discovered that SQL Server has \"a lot\" of locks (over 1000). [Found by doing a select 1000 records from master database view sys.dm_trans_locks].</p>\n\n<p>The data source for the form is a Pass Through Query called qryProspect summary.  It in turn just has the SQL \"EXEC qryProspectSummary\" to call a stored procedure which returns the required data.</p>\n\n<p>the Stored Procedure \"qryProspectSummary\" is just a complex select statement - with some nested selects and unions and joins over several tables.  Running it from SQL Server Management studio produces the correct results and doesn't lock any parts of the database.</p>\n\n<p>I have set the datasource recordset type to \"snapshot\".</p>\n\n<p>How can I prevent Access taking out all these locks - it effectively destroys any multi-user working for what is supposed to be just a data snapshot.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","formatting","sql-update"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13291207,"title":"how to format date in sql server","body":"<p>I am trying to update a date field in my table but would to convert the date format into dd/mm/yy.\n    i have tried this method but it is still showing like this yyyy-mm-dd</p>\n\n<pre><code> UPDATE MyTable \n        SET MyField = convert (varchar,GETDATE(), 101)\n       where ID = '221'\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","azure","named-instance"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13279378,"title":"Cannot connect to a SQL Server 2008 named instance hosted in a azure virtual machine","body":"<p>When I try to connect to a named instance in a SQL Server hosted in a Azure VM, I get this message: </p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while\n  establishing a connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: SQL\n  Network Interfaces, error: 26 - Error Locating Server/Instance\n  Specified) (Microsoft SQL Server, Error: -1)</em></p>\n</blockquote>\n\n<p>The problem is the SQL Server browser is not working properly, when I start the browser service it closes after a few seconds and the event log says </p>\n\n<blockquote>\n  <p><em>There are no instances of SQL Server or SQL Server Analysis Services.</em></p>\n</blockquote>\n\n<p>But I do have a named instance, I can connect locally to this instance.</p>\n\n<p>I've re-installed SQL Server browser and the instance but ii does not work.</p>\n\n<p>The host is an Azure virtual machine Windows Server 2008 datacenter.</p>\n\n<p>Please help.</p>\n\n<p>Thank you</p>\n\n<p>UPDATE 11/08/2012\nIn fact I can connect to the default instance remotely, but I cannot do it with the named instance, by example, I connect remotely with the dns: , but if I try with \\UAT, I cannot connect.</p>\n\n<p>UPDATE\nWell, it seems the problem is when someone tries to connect to a named instance the port 1434 for the SQL Browser must be open, so that means we need to create that endpoint in the azure management portal, the problem is the sql browser looks for the named instance and answer with a dynamic port. At the end I thought it was a lot of trouble to configure all that and anyways my sql browser was not detecting my named instance so I decided to create a new endpoint to listen for the named instance and assign an static port to that instance, now I can connect with the IP/Port. I'm still curious how can I configure the Azure VM, SQL Browser, SQL Sever and firewall to be able to connect with the dns/instance using the SQL Browser. </p>\n"},{"tags":["sql-server","unix","odbc","sas"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13284616,"title":"UNIX SAS connectivity with SQL SERVER Window Authentication","body":"<p>I have a UNIX SAS and SQL Server on Windows XP. I am trying to make a connection between UNIX SAS and SQL Server in Windows Authentication Mode. I made an ODBC Connection but when I try to connect using the following command:</p>\n\n<pre><code>libname odbclib odbc noprompt=\"dsn=SQLDataODBC;Trusted_Connection=yes\" schema=DBO;\n</code></pre>\n\n<p>I got the following error:</p>\n\n<pre><code>\"ERROR: The ODBC engine cannot be found.\"\n</code></pre>\n\n<p>How can I resolve this?</p>\n"},{"tags":["sql","sql-server","database","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13292631,"title":"Database query to handle when specific rows don't exist","body":"<p>Sorry for the bad title, it is hard to explain in one sentence what I am having problems with. So I have a stats database for basketball. What I am trying to do is group the stats for one team in one row then group all the stats this team played against in one other row. What I have now works if there are opponent stats in the database, but it is possible to not have opponent stats and just have the team stats. Hard to explain why, so please just go with that.</p>\n\n<p>So lets say I have 3 rows like this:</p>\n\n<pre><code>COMP_ID | TEAM_ID | OFF_REB | DEF_REB\n  1     |  100   |   5     |    4\n  2     |  100   |   1     |    1\n  3     |  100   |   3     |    7\n</code></pre>\n\n<p>Basically, there are 3 games, and I only have team 100's stats. I would like to get all of the OFF and DEF rebounds for team 100 in a row and then all of the opponent OFF and DEF rebounds in another row. If there are no opponent stats, just 0's will be fine.</p>\n\n<p>FYI - What I do now is do a group by to package the team 100's stats together and also to package the opponent stats together. For the TEAM_ID of the opponent stats, I group them into -999 value so I know they are opponent values.</p>\n\n<p>Here is the query I have now:</p>\n\n<pre><code>SELECT CASE WHEN TEAM_ID &lt;&gt; 100 THEN -999 ELSE 100 END AS TEAM_ID, SUM(OFF_REB+DEF_REB) REBS\nFROM V_STATS_COMP\nWHERE COMP_ID IN (SELECT COMP_ID FROM COMPETITIONS WHERE HOME_ID = 100 OR VIS_ID = 100)\nGROUP BY CASE WHEN TEAM_ID &lt;&gt; 100 THEN -999 ELSE 100 END\nORDER BY TEAM_ID\n</code></pre>\n\n<p>With this query, I get only 1 row back and thats for team 100. How do I adjust it to get the -999 row even if there are no stats available?</p>\n\n<p>Edit to show desired results: </p>\n\n<pre><code>TEAM_ID | REBS\n  100   |  21\n -999   |  0\n</code></pre>\n\n<p>Of course if there were opponent stats, id like to see their REBS value.</p>\n"},{"tags":["sql-server","database","data-warehouse"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":27,"score":0,"question_id":13259594,"title":"retrieve data from multiple tables and store them in one table confronted the duplicates","body":"<p>I'm working on some critical data retrieving report tasks and find some difficulties to\nproceed. Basically, it's belonging to medical area and the whole data is distributed in\nseveral tables and I can't change the architecture of database tables design. In order to\nfinish my report, I need the following steps:</p>\n\n<pre><code>1- divide the whole report to several parts, for each parts retrieve data by using\nseveral joins. (like for part A can be retrieved by this:\nselect a1.field1, a2.field2 from a1 left join a2 on a1.fieldA= a2.fieldA ) then I can\ngot all the data from part A.\n\n2- the same things happened for part B\nselect b1.field1, b2.field2 from b1 left join b2 on b1.fieldB= b2.fieldB, then I also\nget all the data from part B.\n\n3- same case for part C, part D.....and so on.\n</code></pre>\n\n<p>The reason I divide them is that for each part I need to have more than 8 joins (medical data is always complex) so I can't finish all of them within a single join (with more than 50 joins which is impossible to finish...)</p>\n\n<p>After that, I run my Spring Batch program to insert all the data from part A and data from part b, part c.. into one table as my final report table. The problem is not every part will have same number of rows which means part A may return 10 rows while part b may return 20 rows. Since the time condition for each part is the same (1 day) and can't be changed so just wondering how can I store all these different part of data into one table with minimum overhead. I don't want to have to many duplicates, thanks for the great help.</p>\n\n<p>Lei</p>\n"},{"tags":["sql-server","alerts"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":5008,"score":3,"question_id":334650,"title":"SQL Server Alerts - Best Practices","body":"<p>What SQL Server Alerts do you always setup for every database? What do you always monitor regardless of the database?</p>\n"},{"tags":["sql-server","entity-framework","code-first","sql-server-2008-express"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13292002,"title":"SQL Server Express Entity Framework code-first","body":"<p>I Tried to use the code first approach to create my database \nI created every class that I needed and then added a web form to my project and a grid view to it. then I tried to set the grid view's data source to the data base. when I want to Choose a new connection it actually finds my database automatically named \"TimeTrackerDbContext\" but when I hit next I get this error : \n\"Database Schema Could not be retrieved for this connection. A network related or instance-specific error occured while establishing a connection to sql server. the server was not found or was not accessible. verify that the instance name is correct and that sql server is configured to allow remote connections. (provider: Named Pipes Provider, error:40 - Could not open a connection to SQL Server)\nat DataObjectSupport(422,6)\"</p>\n\n<p>my connection strings section in web.config is:\n\"name=\"TimeTrackerDbContext\" connectionString=\"server=./SqlExpress;integrated security=SSPI; database =TimeTracker\" providerName=\"System.Data.SqlClient\"</p>\n\n<p>and I use win 8. \nCan you help?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","etl"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13292222,"title":"ETL SQL Server 2008 - How to handle non-matching records?","body":"<p>I am fairly new to ETL. I am working on this proc and what it does is it loads birthdates of people. This is loaded from a fact table onto a different table. There is no key to join them by, all the three tables involved. I am going to split the Name field and do match with the split name. This loads the matching ones, but my question is I have to load the non matching ones to a different third table. How do I do that logic? </p>\n\n<pre><code>update FactTableEmp F\n       set Bdate = S.Birthdate\n\nfrom   FactTableEmp\n       cross apply dbo.split(Name) as u\n       join SourceTableEmp S on u.Fname = s.FirstName and u.LName = S.Lastname  \n\n--Is using the one below going to work using the same way above?\nu.Fnames != S.FirstName\nu.Lname != S.Lastname\n</code></pre>\n"},{"tags":["c#","sql","sql-server","smo"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12704919,"title":"Create a copy of partitioned tables using SMO","body":"<p>I'm trying to use SMO to replicate a copy of a partitioned table:</p>\n\n<pre><code>using (var scope = new TransactionScope()) \n{ \n    var copiedtable = CreateTable(sourcetable);\n\n    createColumns(sourcetable, copiedtable);\n    CreateIndexes(sourcetable, copiedtable);\n    CreateForeignKeys(sourcetable, copiedtable);\n\n    sourcetable.PartitionScheme = sourcetable.PartitionScheme + \"1\";\n\n    scope.Complete();\n    return copiedtable; \n } \n</code></pre>\n\n<p>The copy is created but the partition scheme is ignored, is there a way to align to the partition scheme?  Am I going about things the wrong way?  I receive no error message or exception the code silently creates an unpartitioned copy of the partitioned table.</p>\n\n<p>I want to automate as I have several hundred tables where the partitions are aligned to the wrong schema.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1159,"score":1,"question_id":7700216,"title":"get the date and time for today at midnight and add to it","body":"<p>Is there a sql command to get today's date at midnight and be able to add a number of minutes to it?</p>\n"},{"tags":["sql-server","service-broker"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13213166,"title":"Service Broker: How can I detect the script is executed on the wanted machine?","body":"<p>My SQL scripts are generated from templates. They contain the IP address. There can be a lot of them and the operator can by mistake execute the incorrect script. How the script can check if it was launched on the correct machine? (Otherwise, I would like to print the message and exit.)</p>\n\n<p>Is it possible at all?</p>\n\n<p>Thanks,\n   Petr</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13288742,"title":"Linking IDs of the same row to other tables","body":"<p>I have a mapping table that can hold IDs from the same table.</p>\n\n<p>For example I have :</p>\n\n<p>Variables ( Table )\nValues ( Table)\nVariables_Values ( Mapping table )</p>\n\n<p>The mapping table has the following fields :</p>\n\n<pre><code>VariableID\nTo_VariableID\nTo_ValueID\n</code></pre>\n\n<p>So it is possible for a row to have two variable IDs, or a variable ID and a value ID.\nIt is always a pair, so there cannot be two variable IDs and a value ID at the same time.</p>\n\n<p>Now, in the Variables and Values tables, there is a Name field, so variables and values also have names.</p>\n\n<p>I want to create a query that will display the names based on the IDs in the mapping table, but I am not sure how.</p>\n\n<p>Right now I have a query that returns results that look like this :</p>\n\n<p>VariableName To_VariableID To_ValueID</p>\n\n<p>I would like to display VariableName_2, ValueName instead of To_VariableID To_ValueID.</p>\n\n<p>Is there a technique for this?\nCould it be a combination of the following queries? </p>\n\n<pre><code>SELECT map.ID, map.TransitionID, variable.Name\nFROM Variables AS variable INNER JOIN Mapping AS map \nON variable.VariableID = map.VariableID\n\nSELECT variable.VariableID, variable.Name\nFROM Variable AS variable\nWHERE variable.VariableID IN ( SELECT map.To_VariableID FROM Mapping AS map)\n\nSELECT value.Name\nFROM Values AS value\nWHERE value.ValueID IN ( SELECT map.To_ValueID FROM Mapping AS map)\n</code></pre>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2000"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1844,"score":0,"question_id":4068588,"title":"Validate telephone number in SQL Server 2000","body":"<p>Does anyone have a nifty way of validating telephone numbers using sql (SQL Server 2000).</p>\n\n<p>I need to select all users fro ma Db that have valid phone number</p>\n\n<p>Thanks\nSp</p>\n\n<pre><code>Valid number \n08450000000\n01332000000\n07444000000\n+441332000000\n</code></pre>\n\n<p>Standard UK numbers</p>\n"},{"tags":["sql","sql-server","regex","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13291639,"title":"TSQL Simple Regex Matching","body":"<p>I need to check if a variable is a value 10.00 through 10.09. How can I do this by regex ?</p>\n\n<pre><code>IF SomeRegExFunction(@var, '10.0*')\n    print 'It worked'\n</code></pre>\n\n<p>Is there some way to do this? </p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","tsql","join","inner-join"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":28,"score":2,"question_id":13291855,"title":"Invalid Column name when using INNER JOIN to get values from two tables","body":"<p>I have two tables:</p>\n\n<p>tbl_profiles_and_users:</p>\n\n<pre><code>[id] [int] IDENTITY(1,1) NOT NULL,\n[profile_id] [int] NOT NULL,\n[user_id] [nvarchar](50) NULL\n</code></pre>\n\n<p>tbl_profiles_and_activities:</p>\n\n<pre><code>[id] [int] IDENTITY(1,1) NOT NULL,\n[profile_id] [int] NOT NULL,\n[user_id] [nvarchar](50) NOT NULL,\n[activity_name] [nvarchar](50) NULL,\n[check] [int] NULL,\n[preferred] [int] NULL\n</code></pre>\n\n<p>both tables have entries in them, and I am trying to select the user, and activities, only from within a specified profile.</p>\n\n<p>I am trying to do this with the following join:</p>\n\n<pre><code>use [dbName]\n\nSELECT p1.user_id AS User_ID, [p2.activity_name] as [Activity_Name]\nFROM tbl_profiles_and_users AS p1 \nINNER JOIN tbl_profiles_and_activities AS p2 \nON p1.user_id = p2.user_id AND p1.profile_id = p2.profile_id\n</code></pre>\n\n<p>but I receive the message \nInvalid column name 'p2.activity_name'\nWhat am I doing wrong? Can I achieve the desired results with a Join?</p>\n"},{"tags":["sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13246511,"title":"Improving SQL Server query performance","body":"<p>I have a written a query in which I create a string and take distinct values from the table based on conditions.</p>\n\n<p>The table has some 5000 rows. This query takes almost 20 second to execute.</p>\n\n<p>I believe that the string comparisons have made the query so slow. But I wonder what are my alternatives. </p>\n\n<p><strong>Query:</strong></p>\n\n<pre><code>select distinct\n   Convert(nvarchar, p1.trafficSerial) +' ('+  p1.sourceTraffic + ' - ' + p1.sinkTraffic + ' )' as traffic\nfrom \n   portList as p1\ninner join \n   portList as p2 ON p1.pmId = p2.sinkId\n                  AND P1.trafficSerial IS NOT NULL \n                  AND (p1.trafficSerial = p2.trafficSerial) \n                  AND (P1.sourceTraffic = P2.sourceTraffic) \n                  AND (P1.sinkTraffic = P2.sinkTraffic)\nwhere \n   p1.siteCodeID = @SiteId\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","math","calculator"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":33,"score":-4,"question_id":13291491,"title":"SQL Server 2012 Calculate total with tax","body":"<p>there needs to be 3 columns </p>\n\n<p>the tax needs to be 13%</p>\n\n<p>the tax amount needs to be added to the InvoiceTotal the amount that it adds needs to be put in the tax column and the InvoiceTotal needs to be added by the Tax amount and put into the Total Column but only if the InvoiceTotal is greater then 0$ aka if there is a balance owed </p>\n\n<p>InvoiceTotal is the only place you need to draw data from and InvoiceTotal is a column in the tables called Invoices</p>\n\n<p>Structure below: </p>\n\n<p>InvoiceTotal  Tax  Total</p>\n"},{"tags":["sql-server","asp.net-mvc","visual-studio-2010"],"answer_count":3,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":4009,"score":6,"question_id":9003056,"title":"Create MVC4 Membership Database","body":"<p>Im farmiliar with aspnet_regsql.exe to create a membership database (it produces 11 tables)</p>\n\n<p>However, in my MVC4 project VS2010 created a Membership Database with just six tables (Applications, Memberships, Profiles, Roles, Users &amp; UsersInRoles)</p>\n\n<p>How can I create a database with this (new?) schema?</p>\n"},{"tags":["sql-server","tsql","default-value","between","divide"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13290775,"title":"T-SQL Divide value across rows","body":"<p>I have the following columns and data in table:</p>\n\n<pre><code>PeriodID Days\n1        NULL\n2        NULL\n3        NULL\n4        NULL\n5        NULL\n</code></pre>\n\n<p>Then I have days that should divide across the rows as follows:</p>\n\n<ol>\n<li><p>If Days &lt; 5 (for example 2) I will have:</p>\n\n<pre><code>PeriodID Days\n1        NULL\n2        NULL\n3        NULL\n4        1\n5        1\n</code></pre></li>\n<li><p>If days >= 5 and days%5=0 (for example 5) I will have:</p>\n\n<pre><code>PeriodID Days\n1        1    \n2        1    \n3        1    \n4        1    \n5        1\n</code></pre></li>\n<li><p>If days > 5 and days%5!=0 (for example 12) I will have:</p>\n\n<pre><code>PeriodID Days\n1        3    \n2        3    \n3        2    \n4        2    \n5        2\n</code></pre></li>\n</ol>\n\n<p>I am able doing this with loops, and I hope for better solution using some smart technique or T-SQL function. Thanks in advance.</p>\n"},{"tags":["sql-server","vb.net","guid","uniqueidentifier"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13290737,"title":"Build GUID from string Values and then ( De-Build) them?","body":"<p>I have a program where the user inputs a password to log in. The password is then saved within a SQL 2000 Database table called users.</p>\n\n<p>The problem is that any one who has SQL Query Analyzer or Enterprise Manager can very easily read these passwords.</p>\n\n<p>I want the program to construct a GUID from each user's password and store that GUID inside the SQL table and then when it's validating user password input it deconstructs the related GUID and gets the original string value to match it with user input.</p>\n\n<p>Now I'm not sure this is possible but I heard some IT specialists talking about the subject and they weren't the kind you would ask for help.</p>\n"},{"tags":["java","sql-server","jdbc","fitnesse"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":13258469,"title":"SQLServerException while trying to use Fitnesse and DbFit and SQL Server","body":"<p>I am new to both (Java) FitNesse and SQL Server, I want to have a basic SQL test working with DbFit,</p>\n\n<p>I have the following in root:</p>\n\n<pre><code>!path c:\\fitnesse\\lib\\dbfit.jar\n!path c:\\fitnesse\\lib\\fitlibrary.jar\n!path c:\\fitnesse\\lib\\sqljdbc4.jar\n|Import|\n|dbfit.SqlServerTest|\n</code></pre>\n\n<p>I have the following in my HelloWorldTest,</p>\n\n<pre><code>!contents -R2 -g -p -f -h\n\n!|dbfit.SqlServerTest|\n\n|Connect|LOCALSQLEXPRESS|sa|Password|somePassword:|\n\n|eg.Division|\n|numerator|denominator|quotient?|\n|10       |2          |5        |\n|12.6     |3          |4.2      |\n|100      |4          |33       |  \n</code></pre>\n\n<p>What I have tried: </p>\n\n<ul>\n<li>I have double checked my SQLExpress username and password and the SqlServer instance is at localhost.I doubt this is a firewall issue. (My understaning of firewall is quite weak admittedly.)</li>\n<li>Looking at Sql Server Configuration Manager (SSCM), \n<ul>\n<li>I see that \"SQL Server (SQLEXPRESS) is running as Process with ID 2316, </li>\n<li>Using the PowerShell command \"nestat -a -no | Select-String 2316\", I see that the process on port 55618.</li>\n</ul></li>\n<li>In SSCM, I then create alias called \"LOCALSQLEXPRESS\" in both \"SQL Native Client 11.0 Configuration (32bit)\" and  \"SQL Native Client 11.0 Configuration\" as I have no idea what my JDBC is using. (Apparently, JDBC for SQL Server does not support named instance, I got an exception telling me so when I was trying to connect to \\localhost\\SQLEXPRESS directly)\nI have also enabled \"TCP/IP\" and \"Shared Memory\" in \"Protocols for SQLEXPRESS\". </li>\n</ul>\n\n<p>I am getting the following error when I run the test: </p>\n\n<blockquote>\n  <p>com.microsoft.sqlserver.jdbc.SQLServerException: The TCP/IP connection\n  to the host LOCALSQLEXPRESS, port 1433 has failed. Error: \"null.\n  Verify the connection properties. Make sure that an instance of SQL\n  Server is running on the host and accepting TCP/IP connections at the\n  port. Make sure that TCP connections to the port are not blocked by a\n  firewall.\".</p>\n</blockquote>\n\n<p>(Note the port number of 1433, despite my alias point to port 55618.)</p>\n\n<p>This is my first post at StackOverflow, please excuse any silliness. Can anyone shed any light? </p>\n"},{"tags":["sql","sql-server","xml"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13289773,"title":"Sql server xml select query xpath is slow","body":"<p>My XML structure:</p>\n\n<pre><code>&lt;Items&gt;\n  &lt;Item&gt;\n    &lt;guid&gt;FC550573-7171-997F-752D-8D65590CBFD6&lt;/guid&gt;\n    &lt;Objects&gt;\n       &lt;Object&gt;\n         &lt;type&gt;0&lt;/type&gt;\n         &lt;guid&gt;E10D9DA9-2C8D-8024-2F07-DF21395811BF&lt;/guid&gt;\n       &lt;/Object&gt;\n       &lt;Object&gt;\n         &lt;type&gt;0&lt;/type&gt;\n         &lt;guid&gt;D8338400-35C7-781E-A039-C0FDDF80714A&lt;/guid&gt;\n       &lt;/Object&gt;\n    &lt;/Objects&gt;\n  &lt;/Item&gt;\n&lt;/Items&gt;\n</code></pre>\n\n<p>When filling the Objects Table:</p>\n\n<pre><code>CREATE TABLE [dbo].[Objects](\n    [item_guid] [varchar](36) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,\n    [type] [int] NOT NULL,\n    [guid] [varchar](36) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL\n) ON [PRIMARY]\n</code></pre>\n\n<p>Using the Query:</p>\n\n<pre><code>INSERT INTO [dbname].[dbo].[Objects]\n           ([item_guid]\n           ,[type]\n           ,[guid])\nSELECT\n X.source.query('../../guid').value('.','VARCHAR(36)') as item_guid,\n X.source.query('type').value('.','INT') as type,\n X.source.query('guid').value('.','VARCHAR(36)') as guid\nFROM(\nSelect xmldata from XmlFiles where fullpath=@fp\n) AS T(x)\nCROSS APPLY x.nodes('Items/Item/Objects/Object') As X(source)\n</code></pre>\n\n<p>This line is making the query VERY slow:</p>\n\n<pre><code>X.source.query('../../guid').value('.','VARCHAR(36)') as item_guid\n</code></pre>\n\n<p>What is the proper approach here?</p>\n"},{"tags":["sql","sql-server","view","yield"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13290847,"title":"Yield Return equivalent in SQL Server","body":"<p>I am writing down a view in SQL server (DWH) and the use case pseudo code is:</p>\n\n<pre><code>-- Do some calculation and generate #Temp1\n-- ... contains other selects\n\n-- Select statement 1\nSELECT * FROM Foo\nJOIN #Temp1 tmp on tmp.ID = Foo.ID\nWHERE Foo.Deleted = 1\n\n-- Do some calculation and generate #Temp2\n-- ... contains other selects\n\n-- Select statement 2\nSELECT * FROM Foo\nJOIN #Temp2 tmp on tmp.ID = Foo.ID\nWHERE Foo.Deleted = 1\n</code></pre>\n\n<p>The result of the view should be:</p>\n\n<pre><code>Select Statement 1\nUNION\nSelect Statement 2\n</code></pre>\n\n<p>The intended behavior is the same as the <code>yield return</code>in C#. Is there a way to tell the view which <code>SELECT</code> statements are actually part of the result and which are not? since the small calculations preceding what I need also contain selects.</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13290325,"title":"Output parameter in stored procedure is null","body":"<p>I can't seem to get the output parameter right, it's empty where I'm exepecting 'TEMPTABLE'?</p>\n\n<pre><code>create table TEMPTABLE\n(\n  Id int identity primary key,\n  Name nvarchar(50) not null,\n);\nGO\n\ninsert into TEMPTABLE(Name) values('Name 1');\nGO\n\nDECLARE @PARMOUTP nvarchar(50)\nDECLARE @ParameterDefinition AS NVARCHAR(2000)\nDECLARE @DestTable VARCHAR(50)\ndeclare @sql nvarchar(max)\n\n    set @sql = 'SELECT   OBJECT_NAME(OBJECT_ID) AS TABLENAME \n                FROM     SYS.IDENTITY_COLUMNS  \n                WHERE OBJECT_NAME(OBJECT_ID) = @DestTable'\n\nset @DestTable = 'TEMPTABLE'\n\nset @ParameterDefinition = '@DestTable VARCHAR(50), @PARMOUTP VARCHAR(50) OUTPUT'\n\n\nEXECUTE sp_executesql @sql,\n                  @ParameterDefinition,\n                  @DestTable,\n                  @PARMOUTP OUTPUT\n\nprint @PARMOUTP;\nprint isnull(@PARMOUTP, 'PARMOUTP is null!');\n</code></pre>\n\n<p>What am I doing wrong here?</p>\n\n<p>Regards,</p>\n\n<p>Mike</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13290889,"title":"SQL Server -- Efficient String Contains Over Very Large Tables","body":"<p>I have a table that currently contains 10 million records.</p>\n\n<p>One of the columns is <code>SourceText</code> of type <code>nvarchar(4000)</code>.</p>\n\n<p>I need a <em>very</em> efficient way to search the SourceText to see if it contains another string. </p>\n\n<p>I have extreme flexibility will the table structures--I can modify the insert procedure and use other, better indexed tables to track things.  One thought was to  tokenize the SourceText by word and store the words in an indexed table, then use a mapping table to map to the main table.  The problem is that the <code>SourceText</code> column can be any language, and there are always rules re:parantheses, etc.  For example, in english if I tokenize using ' ' as the delimiter, I will still get things like <code>(Where</code> instead of <code>Where</code>, which is problematic.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","sql-update","database-update"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":9053805,"title":"Update statement issue","body":"<p>I have an issue that, while using sql server 2005 i have executed update query without where clause (by mistake) and all the original values of the column get lost.</p>\n\n<p>How can I get old values??</p>\n\n<p>Any suggestion/tips/solution is welcome and will be highly appreciated.</p>\n"},{"tags":["sql-server","sql-azure"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13267947,"title":"Non Clustered index being ignored","body":"<p>I have <code>archived_events</code> table with the following indexes.</p>\n\n<pre><code>    CREATE NONCLUSTERED INDEX [IX_archived_events_5] ON [dbo].[archived_events]\n    (\n        [account_id] ASC\n    )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)\n    GO\n\nALTER TABLE [dbo].[archived_events] ADD  CONSTRAINT [PK_archived_events] PRIMARY KEY CLUSTERED \n(\n    [event_type] DESC,\n    [id] DESC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)\nGO\n</code></pre>\n\n<p>The problem is that when I execute the following query, I see in the execution plan that it does Clusterd Index Scan on [PK_archived_events]</p>\n\n<pre><code>SELECT *                                  \nFROM   archived_events ae WITH(nolock) \nWHERE     ( 30 = ae.[account_id] ) \n</code></pre>\n\n<p>What is the reason that the non clustered index is being ignored?</p>\n\n<p><em>Also a note that this is SQL Azure, not sure if it matters.</em></p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13289446,"title":"database email with attachement(excel file / pdf file)?","body":"<p>I've to send a mail from database to my mail-id with attachment.</p>\n\n<pre><code>EXEC msdb.dbo.sp_send_dbmail\n    @profile_name = 'Adventure Works Administrator',\n    @recipients = 'danw@Adventure-Works.com',\n    @query = 'SELECT COUNT(*) FROM AdventureWorks2012.Production.WorkOrder\n                  WHERE DueDate &gt; ''2004-04-30''\n                  AND  DATEDIFF(dd, ''2004-04-30'', DueDate) &lt; 2' ,\n    @subject = 'Work Order Count',\n    @attach_query_result_as_file = 1 ;\n</code></pre>\n\n<p>from this code i'm getting result in txt file. but <strong>i want to get query result in pdf file or excel file</strong></p>\n\n<p>anybody known means please share with me.</p>\n\n<p>advance thanks !!! :)</p>\n"},{"tags":["sql-server","sql-server-2005","view","sql-management-studio","rownumber"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13280520,"title":"ROW_NUMBER() in a view in SQL Server 2005","body":"<p>I have tried the following query in Microsoft SQL Server Management Studio:</p>\n\n<pre><code>select \n   ROW_NUMBER() OVER(ORDER BY ret_id, dep_id DESC) AS 'Row Number' \nfrom \n   Round_Trip_View\n</code></pre>\n\n<p>and it works.</p>\n\n<p>I have tried the same to create a view, and it crashed.</p>\n\n<p>Any idea?</p>\n\n<p>I am looking to assign a kind of id for each row in my view and I appreciate any alternative ideas :)</p>\n"},{"tags":["sql","sql-server","ssis","ssas","business-intelligence"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":26,"score":3,"question_id":13288749,"title":"Is it necessary to use SSIS to create SSAS cubes using Oracle data?","body":"<p>I'm working on research project using Microsoft BI Stack and Oracle Database. When working with these two technologies I was able to use SSIS and SSRS. </p>\n\n<p>My process was connecting Oracle database through SSIS and SSAS.</p>\n\n<p>Yes, it has worked but SSIS is responsible for the ETL process. I was still able to create cubes in SSAS without using SSIS. </p>\n\n<p>What's the difference between these two processes?</p>\n\n<ol>\n<li><p>When using SSAS without SSIS, is it automatically invoking the SSIS process (ETL) behind the scenes?</p></li>\n<li><p>If yes, what's the point of having SSIS?</p></li>\n</ol>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":9,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":7828,"score":2,"question_id":1227707,"title":"How to get last insert/update/delete datetime on Sql Server 2005?","body":"<p>not a duplicate of <a href=\"http://stackoverflow.com/questions/1227593/how-to-get-last-modification-datetime-on-sql-server-2005\">my previous question</a></p>\n\n<p>Is there any way to get the latest datetime when a table/database had an insert/update/delete on Sql Server 2005? Preferably without creating triggers..</p>\n\n<p>I know that when you need the last update per row, you need triggers. But I am not sure if they are needed when you just want to get the last update for the whole table.</p>\n"},{"tags":["sql-server","datatrigger"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1961,"score":1,"question_id":6217484,"title":"SQL Server trigger on insert,delete & update on table","body":"<p>I have a table <code>Product</code> and another table <code>ProductLog</code>.</p>\n\n<p>The log table needs to track two columns in the <code>Product</code> table. Each time there is an insert, update or delete on those columns I need to update the log table. </p>\n\n<p>Do I need to write three separate triggers, or can one trigger handle these operations?</p>\n\n<p>I also need to know the type of operation, for example I will need to know if the entry in the log table was because of insert or delete or update. If any one give me an example that would be great.</p>\n"},{"tags":["java","sql-server","spring","hibernate"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13289628,"title":"Using Hibernates EntityManagerFactory","body":"<p>I have two databse setups in my persistence file. One for local host, and one for sql server database . I am trying to connect to the server first using </p>\n\n<pre><code>EntityManagerFactory emf = Persistence.createEntityManagerFactory(\"myemf\");\n</code></pre>\n\n<p>If this is unable to connect to the database then i want to default to the other database from my persistence file. However, the above code does not seem to throw an exception so how can I logically check if a connection is not availabke and reassign my emf variable?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","reporting-services","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13289138,"title":"Log file for ReportServerTempDB growing unexpectedly","body":"<p>The transaction log file for the ReportServerTempDB database (database installed with Reporting Services) is has grown to over 100GB. And I'm not sure why.</p>\n\n<p>Here are the file sizes: </p>\n\n<ul>\n<li>D:\\SQLDatabases\\ReportServer.mdf - 0.7GB</li>\n<li>G:\\SQLDatabases\\ReportServer.ldf - 1.8GB</li>\n<li>E:\\SQLDatabases\\ReportServerTempDB.mdf - 5GB</li>\n<li>G:\\SQLDatabases\\ReportServerTempDB.ldf - <strong>107.6GB</strong> </li>\n</ul>\n\n<p>Recovery mode for all these database is <strong>SIMPLE</strong>.\nWe are using SQL Server 2008 R2 Standard Edition.</p>\n\n<p>EDIT: Something that is unique to the reporting services databases: \nThe collation for these databases is Latin1_General_CI_AS_KS_WS. But for all other database it is Latin1_General_CI_AS. </p>\n\n<p>I don't want to just shink the log files and carry on, because they might just grow again. And I can't see why they should be so large.</p>\n\n<ol>\n<li>Does anyone know what could cause the log file (and the data file) for the ReportServerTempDB database to grow so much</li>\n<li>And what I should do about it?</li>\n<li>Could this indicate a problem with our Report Server?</li>\n</ol>\n"},{"tags":["sql-server","asp.net-mvc","simplemembership"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12973307,"title":"SimpleMembership with SQL Server Express database","body":"<p>I have recently discovered that ASP.NET MVC 4 uses SimpleMembership rather than the traditional ASP.NET Membership provider.</p>\n\n<p>I am looking to use SimpleMembership but I also wish to use an Sql Server express database (I will be using a 'real' Sql Server db later on).</p>\n\n<p>I am used to using aspnet_regsql to setup my sql server databases for application services and therefore inserting the necessary membership tables.</p>\n\n<p>However, this application will not setup a DB to work with SimpleMembership.</p>\n\n<p>Can anyone tell me how to do this?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures","sql-update"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13288803,"title":"SQL Server : update multiple rows dynamically","body":"<p>I want to update multiple rows in my database, the values might be different. Imagine this table:</p>\n\n<pre><code>Username   FirstName   LastName \n-------------------------------\nuser1      John        Doe \nuser2      Jane        Doe\nuser3      bill        gates\n</code></pre>\n\n<p>If I want to update the table so it looks like this:</p>\n\n<pre><code>Username   FirstName   LastName \n-------------------------------\nuser1      John        Deer \nuser2      Jane        Farmer\nuser3      Gill        Bates\n</code></pre>\n\n<p>Is it best to use one <code>UPDATE</code> statement for each user? Or is it possible to do this with one query?</p>\n\n<p>Also is it possible to put it in a stored procedure and provide a collection of values?</p>\n\n<p>Second question is it best to check if the values are changed before doing an update? Or just update everyone even if the value is the same? </p>\n\n<p>I am currently using SQL Server 2005 and C# for the application if that is relevant.</p>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework","skip-take"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":173,"score":2,"question_id":11103115,"title":"Take and Skip in SQL Server and EF","body":"<p>I have a ASP.NET MVC 4 application and I'm using EF. I have a table and a SQL view(the view displays rows from this table plus some unimportant data(~ 1000 records)) with ~ 400.000 records.\nWhen I display the data in EF it takes 25 seconds</p>\n\n<pre><code>    MVCAppEntities db = new MVCAppEntities();\n    public ActionResult Index()\n    {\n        return View(db.vvItem.OrderBy(n =&gt; n.Code).Skip(20).Take(40).ToList());\n    }\n</code></pre>\n\n<p>In SQL Server Management Studio this query takes 0-1 seconds</p>\n\n<pre><code>select  code, quantity, name, price\nfrom (\n    select *,\n           row_number() over(order by code) as rn\n    from vvItem       \n ) as T\nwhere T.rn between 20 and 40\n</code></pre>\n\n<p><strong>Q</strong> : Why is the EF query so slow ? should I make a SP to do the Skip and Take ?</p>\n"},{"tags":["sql-server","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13288484,"title":"If I send a mail from msdb..sp_send_dbmail ho do I monitor auto-generated replies?","body":"<p>I'm sending some emails using msdb..sp_send_dbmail</p>\n\n<p>Say for example the attachment was too large at the recipients exchange server side and they send back an automatic email response.</p>\n\n<p>It is not possible to script the monitoring of these return emails? \nIs the only way of monitoring these reply emails via a client that monitors the replies in the return mailbox?</p>\n"},{"tags":["c#","java","sql-server","jdbc","odbc"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":13274852,"title":"What Java and/or C# frameworks are avaiable to implement SQL server accessible via ODBC/JDBC?","body":"<p>I need to figure out how to create server which behaves like SQL server in respect of accepting connections via ODBC, JDBC, etc, but implemented by me on C# (and/or Java) I.e. I don't want to create tables, call stored procs etc.\nFor the sake of example I just want to have query implemented:</p>\n\n<p>select * from HardcodedTableOfMyFavoriteColors</p>\n\n<p>Any other queries should just fail. The query should return just few colors (hardcoded in server code).</p>\n\n<p>If somebody interested why I need such thing the answer is below.</p>\n\n<p>My actual purpose is to be able to create C# (or Java) server accessible via JDBC/ODBC/etc way from legacy app with strictly defined set of queries. I hope framework will be able to parse query to XML to make my life a bit easier. However response data will be generated by my code and could be something depending on other systems, time etc. On client side response should look like usual SQL server response processed via the same JDBC/ODBC etc API calls.\nBy doing such substitution I hope to reimplement bloated stored procedure logic in C# (or Java) without need to change clients.</p>\n\n<p>Unfortunately I have to have implementation of such SQL-mimic server on both Linux and Windows because I forced to deal with home-grown Java library on Linux and C# on Windows to access custom COM objects.</p>\n\n<p>Anyone?</p>\n"},{"tags":["sql-server","microsoft"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13287252,"title":"Cannot start LocalDB","body":"<p>Cannot start LocalDB instance, I have installed and re-installed over and over. </p>\n\n<p>Keep getting this error :</p>\n\n<blockquote>\n  <p>Start of LocalDB instance \"v11.0\" failed because of the following error:\n  Error occurred during LocalDB instance startup: SQL Server process failed to start.</p>\n</blockquote>\n\n<p>Anyone any advice ? ? </p>\n\n<p>Microsoft SQL Server 2012, i have ensured the FULL installation options, stopped all services SQL related and tried restarting . </p>\n\n<pre><code>sqllocal info \n</code></pre>\n\n<p>gives me : </p>\n\n<blockquote>\n  <p>Projects\n  v11.0</p>\n</blockquote>\n\n<p>when i try </p>\n\n<pre><code>sqllocal start v11.0\n</code></pre>\n\n<p>I get the above error. </p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":7,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":24373,"score":2,"question_id":1781946,"title":"Getting only Month and Year from SQL DATE","body":"<p>I need to access only Month.Year from Date field in SQL Server.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13286621,"title":"Does ROLLBACK TRANSACTION imply a commit if not rolled-back","body":"<p>My <code>SQL-Server</code> learning curve has been back-to-front and after several yrs I'm battling to use <code>TRANSACTION</code> code effectively. </p>\n\n<p>If <code>COMMIT TRANSACTION</code> is not explicitly stated then at the point of <code>ROLLBACK TRANSACTION</code> if no errors have occurred in preceding code will the transaction then be committed? The question is in connection with a structure like the following:</p>\n\n<pre><code>USE MyDataBase;\nGO\n     BEGIN TRANSACTION;\n        --complex query X here  \n     ROLLBACK TRANSACTION; PRINT N'Rolled back the transaction.';\nGO\n</code></pre>\n\n<p>...I thought <code>ROLLBACK TRANSACTION</code> was used in a situation where you do not want changes to be made to a db if an error has occured in the <em>preceding</em> script - in the above this would be <code>X</code>. If i wanted to explicitly state <code>COMMIT TRANSACTION</code> in the above then where should it be located?</p>\n\n<p>To confuse myself even more I've got the following - why is it rolling back twice? Is an error occuring to create the <code>ROLLBACK</code>?</p>\n\n<pre><code>USE WHAnalysis;\nGO\n    BEGIN TRANSACTION;\n\n        IF @@TRANCOUNT = 1\n            SELECT @@TRANCOUNT\n            --do a complex query here\n\n    ROLLBACK TRANSACTION; PRINT N'Rolled back the transaction.';\nGO\n</code></pre>\n"},{"tags":["c#",".net","sql-server","sql-server-2008","ado.net"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13287694,"title":"Getting row right after insert returns no result","body":"<p>I am running unit tests and when I try to insert data in the database and getting it right after, I don't get anything (I have tried with <code>DataAdapter</code> and <code>DataReader</code>).</p>\n\n<p>However when I put a 3 seconds sleep (even with 1 second it doesn't work...) between the insert and the select I get the result.</p>\n\n<p>In SQL Server Profiler I can see the execution, the insert is well done and is completed about 10 miliseconds before the select begins.</p>\n\n<p>I can't find out where this comes </p>\n\n<p>The code looks like this :\nInsert method</p>\n\n<pre><code>SqlCommand command = new SqlCommand(sqlTemplate);\ncommand.Parameters.Add(Sql4oConstants.Sql4oIdParameterName, SqlDbType.UniqueIdentifier).Value = id;\ncommand.Parameters.Add(Sql4oConstants.Sql4oTimestampParamterName, SqlDbType.DateTime).Value = DateTime.Now;\n\ncommand.CommandTimeout = dataSourceDescription.CommandTimeout;\nDatabaseManager.ExecuteNonQuery(dataSourceDescription.ConnectionString, command);\n</code></pre>\n\n<p>Get method</p>\n\n<pre><code>public static void Fill(string connectionString, DataTable table, SqlCommand command)\n    {\n        try\n        {\n            LogStorageWriter.WriteLogEntry(log, EStorageLevelLog.Debug, string.Format(\"Execute query: {0}\", command.CommandText));\n\n            using (SqlConnection conn = new SqlConnection(connectionString))\n            {\n                command.Connection = conn;\n                using (SqlDataAdapter adapter = new SqlDataAdapter(command))\n                {\n                    adapter.Fill(table);\n                }\n            }\n        }\n        catch (InvalidOperationException e)\n        {\n            LogStorageWriter.WriteLogEntry(log, EStorageLevelLog.Error, string.Format(\"Exception : {0}\", e.ToString()));\n        }\n    }\n</code></pre>\n"}]}
{"total":54451,"page":2,"pagesize":100,"questions":[{"tags":["sql","mysql","sql-server","oracle"],"answer_count":5,"favorite_count":7,"up_vote_count":16,"down_vote_count":0,"view_count":2644,"score":16,"question_id":697671,"title":"Stored Procedure with optional \"WHERE\" parameters","body":"<p>I have a form where users can specify various parameters to dig some data (status, date ecc).</p>\n\n<p>I can producea query that is:\nSELECT * FROM table WHERE:\nstatus_id = 3\ndate = \nother_parameter = </p>\n\n<p>etc. Each WHERE is optional (i can select all the rows with status =3, or all the rows with date = 10/10/1980, or all the rows with status = 3 AND date = 10/10/1980 ecc.</p>\n\n<p>Given a large number of parameters, all optional, what is the best way to make up a dynamic stored procedure?</p>\n\n<p>I'm working on various DB:\nMySQL, Oracle and SQLServer.</p>\n"},{"tags":["sql-server","visual-studio-2010"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":105,"score":6,"question_id":13117683,"title":"I can't create a database diagram in VS2010 for SQL Server Express","body":"<p>For some reason, when I click <code>Add Diagram</code> in Server Explorer I am left with an empty tab for designing diagrams. However, there is no dialog box which usually asks what tables to add. The dropdown menu at the top called <code>Diagrams</code> also has all the buttons inactive. </p>\n\n<p>What could be the reason? </p>\n\n<p>I have my SQL Server Express running (checked in SQL Server Configuration Manager). Version - 10.1.</p>\n"},{"tags":["sql-server","reporting-services","ssrs-2008","ssrs-reports"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":13087095,"title":"Handle NULL values in SQL Server Reporting Services","body":"<p>I have developed one report using SSRS Report Builder. The report contains several parameters in which one of the parameter contains NULL values apart from the values that it fetches from the database.</p>\n\n<p>Now when I select NON-NULL values from that parameter the report runs fine because I'm using IN Clause (as the parameter values are multi-select). But when I select NULL (and not any other values) from that parameter, the IN clause doesn't works as IN doesn't take NULL.</p>\n\n<p>Hence what/how should I modify my query so that it could handle both --- NULL and NON-NULL Values?</p>\n"},{"tags":["sql","sql-server","query","select"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":42,"score":0,"question_id":13286661,"title":"what does a select statement returns if condition doesn't match?","body":"<p>For example if I have following statement</p>\n\n<pre><code>declare @uid int;\nset @uid = (select id from tablename where condition)\n</code></pre>\n\n<p>In this case if condition doesn't match then what it will return to <code>@uid</code>.</p>\n"},{"tags":["sql","sql-server","oracle","plsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":38,"score":-6,"question_id":13286424,"title":"difference between oracle sql and sql server?","body":"<p>I  want to know the difference between Oracle SQL, PL/SQL and SQL Server's T-SQL. </p>\n\n<p>Right now I'm using SQL Server (Management Studio) and I'm accessing data using SQ. </p>\n\n<p>Is Oracle's SQL different from the SQL that is used by SQL Server? </p>\n\n<p>Also what is PL/SQL, is it different from Oracle SQL?</p>\n"},{"tags":["c#","asp.net","sql-server","visual-studio","datareader"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2424,"score":1,"question_id":6179139,"title":"Invalid attempt to call MetaData when reader is closed?","body":"<p>I'm running an if else statement off of a datareader to query table data and activate/de-activate some controls on a page. I implemented a using statement to automatically close the connection and the reader when I close the block, but I still get the reader is closed error on each of my if else statements. What's missing? Code below:</p>\n\n<pre><code>string comnt = \"SELECT StatusId FROM Submission WHERE SubmissionId =\" + x;\n\n\n    using (SqlConnection editConn = new SqlConnection(connectionString))\n    {\n        editConn.Open();\n\n        using (SqlCommand statCmd = new SqlCommand(comnt, editConn))\n        {\n            SqlDataReader dr = statCmd.ExecuteReader();\n            dr.Read();\n            if (dr.GetInt32(0) &gt; 0)\n            {\n                PanelComment.Visible = true;\n                PanelQuote.Visible = false;\n                LnbFid.Visible = false;\n                LnbCrim.Visible = false;\n                LnbEo.Visible = false;\n                LnbEpl.Visible = false;\n                LnbNot.Visible = false;\n                LnbPriv.Visible = false;\n                LnbPub.Visible = false;\n\n            }\n            else\n            {\n                PanelComment.Visible = false;\n            }\n\n        } \n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":871,"score":0,"question_id":3260392,"title":"SQL Server Difference (opposite of intersect)","body":"<p>Looking for the easist/most scalable way to do a set \"difference\" in SQL Server see below.\n<img src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Venn0110.svg/384px-Venn0110.svg.png\" alt=\"alt text\"></p>\n\n<p>If you can't tell from the picture i am looking for everything that is not in the intersection.  </p>\n\n<p>I have seen one way to do it:</p>\n\n<pre><code>select * from (      \n    (select 'test1' as a, 1 as b)\n union all\n  (select 'test2' as a , 2 as b union all select 'test1' as a , 1 as b )\n)un group by a,b  having count(1)=1\n</code></pre>\n\n<p>But i fear what would happen if i used two large sets (i will not be querying from select '' constant statements, my queries will be pulling from real tables.)</p>\n\n<p><em>EDIT:</em></p>\n\n<p>Possible solution...</p>\n\n<pre><code>drop table #temp_a;\ndrop table #temp_b;\n\n go\n\n\n  select * into #temp_a from (\n   select 1 as num, 'String' as two, 'int'as three, 'purple' as four union all\n   select 2 as num, 'dog' as two, 'int'as three, 'purple' as four union all\n   select 3 as num, 'dog' as two, 'int'as three, 'cat' as four ) a \n\nselect * into #temp_b from (\n  select 1 as num, 'String' as two, 'decimal'as three, 'purple' as four union all\n  select 2 as num, 'dog' as two, 'int'as three, 'purple' as four union all\n  select 3 as num, 'dog' as two, 'int'as three, 'dog' as four ) b \n\n\n\n\n\n   SELECT IsNull(a.num, b.num) A,IsNull(a.two, b.two) B, IsNull(a.three, b.three) C,                  \n      IsNull(a.four, b.four) D \n     FROM #temp_a a \n   FULL OUTER JOIN #temp_b b ON (a.num=b.num AND a.two=b.two and a.three=b.three and a.four=b.four)\n    WHERE   (a.num is null or b.num is null  )\n</code></pre>\n\n<p>RESULTS:  </p>\n\n<blockquote>\n  <p>1 String  int purple </p>\n  \n  <p>3 dog int cat</p>\n  \n  <p>1 String  dec purple</p>\n  \n  <p>3 dog int dog</p>\n</blockquote>\n"},{"tags":["sql-server","performance","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":124,"score":1,"question_id":2623425,"title":"SQL Server: how can I know my stored procedure is optimum in performance","body":"<p>I would like to know how to measure/know that one's stored procedure is optimum in performance. That stored procedure can be inserting/deleting/updating or manipulating data in that procedure. Please describe the way/approach how to know performance in SQL Server. </p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server","pivot","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":37,"score":2,"question_id":13285264,"title":"need help in writing pivot query to select columns from different select statements","body":"<p>I am using SQL Server 2012, i need help in getting the following output. My table structure is as follows:</p>\n\n<pre><code>declare @TestTable table (MaterialCode char(5), ItemCode char(5), ItemName varchar(50))\n\ninsert into @TestTable values ('AA-01', 'A0001', 'iPhone')\ninsert into @TestTable values ('AA-02', 'A0001', 'iPad')\ninsert into @TestTable values ('AA-03', 'A0001', 'iPod')\n\ninsert into @TestTable values ('AA-01', 'B0001', 'Galaxy Tab')\ninsert into @TestTable values ('AA-02', 'B0001', 'Galaxy Note')\n\ninsert into @TestTable values ('AA-01', 'C0001', 'Nokia Lumnia')\ninsert into @TestTable values ('AA-02', 'C0001', 'Motorola')\ninsert into @TestTable values ('AA-03', 'C0001', 'Samsung S3')\ninsert into @TestTable values ('AA-04', 'C0001', 'Sony')\n\n--select * from @TestTable\n\nselect MaterialCode, ItemCode as [A_ItemCode], ItemName as [A_ItemName] \nfrom @TestTable where ItemCode='A0001'\n\nselect MaterialCode, ItemCode as [B_ItemCode], ItemName as [B_ItemName] \nfrom @TestTable where ItemCode='B0001'\n\nselect MaterialCode, ItemCode as [C_ItemCode], ItemName as [C_ItemName] \nfrom @TestTable where ItemCode='C0001'\n</code></pre>\n\n<p>And the output i need should produced from the above three select statements, which should be as follows:</p>\n\n<p><img src=\"http://i.stack.imgur.com/xpRV8.png\" alt=\"enter image description here\"></p>\n\n<p>As you can see, when there is no record, NULLs are displayed there. Can anyone help me getting this output. TIA.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>@JohnLBevan, I tried your pivot approach and when I have another record which is has ItemCode = D0001</p>\n\n<pre><code>insert into @TestTable values ('AA-05', 'D0001', 'Test1')\n</code></pre>\n\n<p>now even that record is being displayed as</p>\n\n<pre><code>AA-05   NULL    NULL    NULL    NULL    NULL    NULL\n</code></pre>\n\n<p>How to avoid these type of records.</p>\n"},{"tags":["sql","sql-server","database","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13284952,"title":"Add join results as new column based on values from join","body":"<p>I've never done something like this, and I tried finding it on google but without result.</p>\n\n<p>I have 3 tables that look like this:</p>\n\n<p><strong>Orders:</strong></p>\n\n<pre><code>OdredID (int) PK,\nUserID (int) FK,\nOdredDate (datetime)\n</code></pre>\n\n<p><strong>Components:</strong></p>\n\n<pre><code>ComponentID (int) PK,\nName (nvarchar(50)),\nType (nvarchar(max))\n</code></pre>\n\n<p><strong>OrderComponent:</strong></p>\n\n<pre><code>OrderComponentID (int) PK,\nOrderID (int) FK,\nComponentID (int) FK,\nValue (nvarchar(max))\n</code></pre>\n\n<p>Lets say one order has 3 components with names: <code>[CPU, Motherboard, Memory]</code> and values <code>[1GHz, AsusP5, 2GB Kingston DDR3]</code></p>\n\n<p>I need a result has columns like this:</p>\n\n<pre><code>OrderID  UserID   Date          CPU    Motherboard   Memory\n   1        1     2012-05-21    1GHz   AsusP5        2GB Kingston DDR3\n</code></pre>\n\n<p>Basically I need every join row to go as new column with name taken from <code>Name</code> column of join table and value from <code>Value</code> column.</p>\n"},{"tags":["sql","sql-server","tsql","sql-function"],"answer_count":3,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":51,"score":5,"question_id":13284222,"title":"Database Function VS Case Statement","body":"<p>Yesterday we got a scenario where had to get type of a <code>db field</code> and on base of that we had to write the description of the field. Like </p>\n\n<pre><code>Select ( Case DB_Type When 'I' Then 'Intermediate'\n                      When 'P' Then 'Pending'\n                      Else 'Basic'\n         End)\nFrom DB_table\n</code></pre>\n\n<p>I suggested to write a db function instead of this case statement because that would be more reusable. Like</p>\n\n<pre><code>Select dbo.GetTypeName(DB_Type) \nfrom DB_table\n</code></pre>\n\n<p>The interesting part is, One of our developer said using database function will be <strong>inefficient</strong> as <code>database functions</code> are <strong>slower</strong> than <code>Case statement</code>. I searched over the internet to find the answer which is better approach in terms of efficiency but unfortunately I found nothing that could be considered satisfied answer. Please enlighten me with your thoughts, which approach is better?</p>\n"},{"tags":["mysql","sql-server","webserver"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13284728,"title":"Creating and managing database in Godaddy server","body":"<p>I want to create and manage a database in my Godaddy server for authentication purpose. How can i do this?..Is there any pre-configuration needs to be done in the server?</p>\n"},{"tags":["sql","sql-server","select","distinct"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":49,"score":-2,"question_id":13285092,"title":"How to get Distinct values from all columns of a table in SQL Server","body":"<p>I want to retrieve record for distinct value with it's ID ,Table is like this ::</p>\n\n<pre><code>ID     Name\n1      Soap\n2      eridu\n3      Soap\n4      rewfig\n5      Soap\n</code></pre>\n\n<p>Now I want result:</p>\n\n<pre><code>ID  Name\n1   Soap\n2   eridu\n3   rewfig\n</code></pre>\n\n<p>I use like this: [Table Name is tblRecord</p>\n\n<pre><code>select Distinct(Name) ,ID\n  from tblRecord\n where Name in (select Distinct(Name) \n                  from tblRecord\n               )\n</code></pre>\n"},{"tags":["sql","sql-server","query","graph","subgraph"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":35,"score":3,"question_id":13281776,"title":"SQL: Finding a subgraph","body":"<p>I have a graph network stored in an SQL server. The graph network ( collection of labeled, undirected and connected graphs) is stored in Vertex-Edge mapping scheme (i.e there are 2 tables..one for vertices and one for edges) :</p>\n\n<p>Vertices ( graphID , vertexID, vertexLabel )</p>\n\n<p>Edges  ( graphID , sourceVertex  , destinationVertex ,edgeLabel )</p>\n\n<p>I am looking for a simple way of counting a particular subgraph in this network. For example: I would like to find how many instances of \"A-B-C\" are present in this network : \"C-D-A-B-C-E-A-B-C-F\". I have a few ideas on how this can be done in say Java or C++ ...but I have no clue how to approach this problem using SQL. any ideas?</p>\n\n<p>A little background: I'm no student..this is a small project I would like to pursue. I do a lot of social media analysis (in memory) but have little experience mining graphs against an SQL database.</p>\n"},{"tags":["sql","sql-server","insert","left-join","statement"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":44,"score":-2,"question_id":13284959,"title":"How can I Insert all statement to sql?","body":"<p>i need insert all statement but it's don't insert all record.\nsample query 100 record but insert 20 record?</p>\n\n<p>how can i insert all record.</p>\n\n<p><strong>Table filesTA2</strong></p>\n\n<pre><code>EmpNo     ChkDate\n00001     2012-10-15 00:00:00.000\n00002     2012-10-15 00:00:00.000\n00003     2012-10-15 00:00:00.000\n00004     2012-10-15 00:00:00.000\n00005     2012-10-15 00:00:00.000\n</code></pre>\n\n<p><strong>Table LeaveRecord:</strong></p>\n\n<pre><code>EmployeeRun    StartDate\n00008          2012-10-15 00:00:00.000\n00009          2012-10-15 00:00:00.000\n</code></pre>\n\n<p><strong>Code:</strong></p>\n\n<pre><code>INSERT INTO filesTA2 (EmpNo,ChkDate)\nSELECT DISTINCT em.EmployeeNo, coalesce(tf.ChkDate, lr.StartDate) as 'Date'\nFROM Employee em\nLEFT JOIN filesTA2 tf on tf.EmpNo = em.EmployeeNo and tf.ChkDate = '2012-10-15'\nLEFT JOIN LeaveRecord lr on lr.EmployeeRun = em.EmployeeNo and lr.StartDate = '2012-10-15'\nWHERE em.Resigned = '0' and em.Terminated = '0' and em.EmployeeNo not Between '1000001' and '1000004' and tf.ChkDate is null\nOrder By em.EmployeeNo\n</code></pre>\n\n<p><strong>This code get output:</strong></p>\n\n<pre><code>Employee     Date\n00006        NULL\n00007        NULL\n00008        2012-10-15 00:00:00.000\n00009        2012-10-15 00:00:00.000\n00010        NULL\n</code></pre>\n\n<p><strong>when i insert to table filesTA2 get output:</strong></p>\n\n<pre><code>EmpNo     ChkDate\n00001     2012-10-15 00:00:00.000\n00002     2012-10-15 00:00:00.000\n00003     2012-10-15 00:00:00.000\n00004     2012-10-15 00:00:00.000\n00005     2012-10-15 00:00:00.000\n00008     2012-10-15 00:00:00.000\n00009     2012-10-15 00:00:00.000\n</code></pre>\n\n<p><strong>But I need insert all record output. How can I?</strong></p>\n\n<p>Thanks for you time. :)</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13284650,"title":"to display all records from one table and sum of rows from another table","body":"<p>I have two tables HouseKeeping with fields RoomNo,FloorNo,StockItem,Requirement and Stock table with fields Item ,Available.I want to select all rows from HouseKeeping table and sum of requirement from stock table.I have used this query to get sum of requirement from stock table</p>\n\n<p><code>SELECT SUM(Requirement) AS Requirement, StockItem\nFROM  HouseKeeping\nGROUP BY StockItem</code></p>\n\n<p>in addition to this i also want all records(select * from Stock).How to do it? please reply as soon as possible.Thanks</p>\n"},{"tags":["sql-server","sql-server-2008-r2"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13283203,"title":"Does a varbinary(max) column occupy space if value is null?","body":"<p>I have a table with a column of type <code>varbinary(max)</code>. I have some rows that have data in that column while others do not; they are null. </p>\n\n<p>My question is: does the column with <code>NULL</code> also occupy 2 bytes per row? I am using SQL Server 2008 R2.</p>\n\n<p>Thank you</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13281741,"title":"SQL Trigger is Updating random row not the joined row","body":"<p>I have this query in a update trigger</p>\n\n<pre><code>UPDATE [FSSQLPROD01].[collectionsDELETE].[dbo].[collections] \nSET \n    Defendant_1 = i.DisplayName \n    , Loan_Number_1 = i.Comments \n    , Client = i.KS_BookName \n    , Date_Instructed = i.OpenDate \n    , Person_Responsible_name = i.ResponsibleFeeEarnerName \n    , Person_Responsible_Email = i.ResponsibleFeeEarnerEmail \n    , Person_Acting_name = i.BillingFeeEarnerName \n    , Person_Acting_email = i.BillingFeeEarnerEmail \n    , Agent_Acting_name = i.BillingFeeEarnerName \n    , Agent_Acting_email = i.BillingFeeEarnerEmail \n    , CBA_Panel_Service_Area = i.KS_ServiceCat \n    , HBN_Number = i.KS_ClientAcctRef \n    , St_George_Contact = i.KS_Instructor \nFROM \n    [FSSQLPROD01].[collectionsDELETE].[dbo].[collections] c\nINNER JOIN \n    Inserted i\nON\n    Left(c.file_number, 6) COLLATE DATABASE_DEFAULT = i.MatterNumber COLLATE DATABASE_DEFAULT\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/cjJ1P.jpg\" alt=\"enter image description here\">\nNow the Join connection matches up on the File_Number e.g. 70003-1 but for some unknown reason the data that should be updated to this Row is been updated to a toally random row 614864-7 </p>\n\n<p>I can continue to execute the trigger and tring to update the 70003-1 row but i continues to update the other row  614864-7 </p>\n\n<p>This is also running across a linked server the trigger is on one server up dating the other servers</p>\n\n<p>Server tigger sits on Microsoft SQL Server 2005 - 9.00.3042.00 (X64)   Feb 10 2007 00:59:02   Copyright (c) 1988-2005 Microsoft Corporation  Enterprise Edition (64-bit) on Windows NT 5.2 (Build 3790: Service Pack 2) </p>\n\n<p>Server trigger is updating Microsoft SQL Server 2005 - 9.00.3042.00 (X64)   Feb 10 2007 00:59:02   Copyright (c) 1988-2005 Microsoft Corporation  Enterprise Edition (64-bit) on Windows NT 5.2 (Build 3790: Service Pack 2) </p>\n\n<p>I have been thinking that updating the servers SP to SP4 may fix the problem?</p>\n\n<p>Does anyone have a reson why this might be haapening the Server </p>\n\n<p>Ammendment </p>\n\n<p>Yeah i actually hardcoded the values and simplified the SQL Statement it works as it should </p>\n\n<pre><code>DECLARE @MatterNumber as varchar(50)\nSET @MatterNumber = (SELECT i.MAtternumber FRom Inserted as i) + '-1'\nPrint @MatterNumber\n\nUPDATE [FSSQLPROD01].[collectionsDELETE].[dbo].[collections] \n       SET Loan_Number_1 = 123\n       WHERE file_number =  @MatterNumber\n</code></pre>\n\n<p>But as soon as I set a Declared Varible value to Loan_Number_1 or any of the other columes this is when the problem starts to happen</p>\n\n<pre><code>DECLARE @LoanNumber as varchar(50)\nSET @LoanNumber =    (SELECT i.Comments FRom Inserted as i)\n    Print @LoanNumber\nDECLARE @MatterNumber as varchar(50)\nSET @MatterNumber = (SELECT i.MAtternumber FRom Inserted as i) + '-1'\n\nPrint @MatterNumber -I print here I see 70003-1\n\nUPDATE [FSSQLPROD01].[collectionsDELETE].[dbo].[collections] \n       SET Loan_Number_1 = @LoanNumber\n\n       WHERE file_number =  @MatterNumber\n\nPrint @MatterNumber -I print here I see 70003-1\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13282785,"title":"One table with redundant data in one column vs Multiple tables","body":"<p>I have a scenario wherein I have users uploading their custom preferences to the conversion being done by our utility. So, the problem we are facing is </p>\n\n<blockquote>\n  <p>should we keep these custom mappings in one table with an extra column of UID or maybe GUID\n  , </p>\n</blockquote>\n\n<p>or </p>\n\n<blockquote>\n  <p>should we create tables on the fly for every user that registers with us and provide him/her a separate table for their custom mappings altogether? </p>\n</blockquote>\n\n<p>We're more inclined to having just an extra column and one table for the custom mappings, but does the redundant data in that one column have any effect on performance? On the other hand, logic dictates us to normalize our tables and have separate tables. I'm rather confused as to what to do.</p>\n"},{"tags":["c#","sql-server","microsoft","sync","microsoft-sync-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13265884,"title":"Microsoft Sync Framework for File (Client) and SQL Server Database (Server) synchronization","body":"<p>I'm trying to implement the syncing solution using Microsoft Sync Framework. The server will be SQL server database contains the documents in FileStream and client will be the File system (Windows OS). \nI have seen file synchronization provider with the Azure Blob Storage/Custom provider. But have not seen this. Do anybody have any idea on this.\nMy application scenario is :The database server contains the File/Documents in the form of byte array by the FileStream mechanism from SQL server.\nAnd the Sync activity will syncronize the documents from SQL server to any given file system.\nPlease help me out.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","insert","table-variable"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13281201,"title":"SELECT statement that executes instantly, takes forever to insert into table variable","body":"<p>I have the following SQL code below. It is taking forever to complete but if I run just the <code>SELECT DISTINCT ID, ParentID FROM Y WHERE ID IN (3,4)</code>, it completes instantly.</p>\n\n<pre><code>DECLARE @table TABLE\n(\n  ID int,\n  ParentID int\n)\n\nINSERT INTO @table \nSELECT DISTINCT ID, ParentID FROM Y WHERE ID IN (3,4)\n\nSELECT * FROM @table\n</code></pre>\n\n<p>What is going on, this makes no sense.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13282155,"title":"Invalid Syntax for CTE","body":"<p>what in the world could be wrong, the syntax looks fine:</p>\n\n<pre><code>With photos(PhotoID, MemberID) as\n(\n    select  photoID,\n            memberID\n    from MemberPhotos\n)\n\nselect PhotoID, MemberID from photos\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008-r2"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13274628,"title":"SQL Server - Count characters between two characters","body":"<p>How would one count the number of letters (alphabetically a to z or z to a) between two characters?</p>\n\n<p>For example:</p>\n\n<pre><code>WITH    ExampleData\n          AS ( SELECT   'a' AS StartChar, 'e' AS EndChar\n               UNION ALL\n               SELECT   'm', 'r'\n               UNION ALL\n               SELECT   'f', 'a'\n             )\n    SELECT  StartChar ,\n            EndChar\n    FROM    ExampleData\n</code></pre>\n\n<p>Would need to produce:</p>\n\n<pre><code>StartChar   EndChar    Diff\na           e          4\nm           r          5\nf           a          -5\n</code></pre>\n\n<p>I see how this could easily be done using udf's and a while loop but I was wondering if there was a faster way?</p>\n"},{"tags":["sql","sql-server","query","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":44,"score":3,"question_id":13276318,"title":"Returning not found values in query","body":"<p>I'm working on a project, and I have a list of several thousand records that I need check.  I need to provide the list of the ones NOT found, and provide the query I use to locate them so my superiors can check their work.</p>\n\n<p>I'll admit I'm relatively new to SQL. I don't have access to create temporary tables, which is one way I had thought of to do this.</p>\n\n<p>A basic idea of what I'm doing:</p>\n\n<pre><code>select t.column1, t.column2\nfrom table1 t\nwhere t.column1 in ('value1','value2','value3')\n</code></pre>\n\n<p>If value1 and value3 are in the database, but value2 is not, I need to display value2 and not the others.</p>\n\n<p>I have tried <code>ISNULL</code>, embedding the query, and trying to select <code>NOT</code> values from the query.  </p>\n\n<p>I have searched for returning records not found in a query on Google and on this site, and still found nothing.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":38,"score":0,"question_id":13269638,"title":"Custom Group By and place some records in one group","body":"<p>please consider data:</p>\n\n<pre><code> Id          Group            Value\n -----------------------------------\n 1            1                10\n 2            1                12\n 3            1                10\n 4            2                90\n 5            2                10\n 6            3                30\n 7            4                12\n 8            4                11\n 9            5                10\n 10           5                11\n</code></pre>\n\n<p>I want to do <code>Group By</code> on this data as <code>1,2,3</code> place in one group and <code>4,5</code> place in another group. How I can do this with <code>SQL Server</code>?</p>\n\n<p>thanks</p>\n\n<hr>\n\n<p><strong>Edit 1)</strong></p>\n\n<p>I want this result:</p>\n\n<pre><code>Groups                              Count\n-----------------------------------------\nGroup for 1,2,3                       6\nGroup for 4,5                         4\n</code></pre>\n"},{"tags":["sql","sql-server","casting"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13282223,"title":"Using cast in SQL with multiple column selections","body":"<p>Basically I'd like to get this command to work:</p>\n\n<pre><code>$sql = \"SELECT (EntryDate + TotalTime) as DataLine FROM TimeSheet WHERE EmployeeID='AA01'\";\n</code></pre>\n\n<p>EntryDate is in the database as a text, but TotalTime is a Number. I need to cast TotalTime as a text, because I've noticed if I combine two differing types of values, it just blanks out the output. </p>\n\n<p>I know I'm supposed to use CAST(TotalTime as XXX) but I'm not sure what I can legally cast it to (char/nchar doesn't seem to work, neither does string nor text). I always get an error of the form...</p>\n\n<pre><code>Syntax error (missing operator) in query expression '(EntryDate + CAST(TotalTime as string) as DataLine FROM TimeSheet WHERE EmployeeID='AA01''\n</code></pre>\n\n<p>Could I get some help? Thank you!</p>\n\n<p><strong>EDIT</strong> I would like to note this isn't intended to add together the values of EntryDate and TotalTime together to produce a single value. I simply want it to give me the EntryDate value as well as the TotalTime value combined into a single line that would read something like:</p>\n\n<p>\"10/31/12 9.25\"</p>\n\n<p><strong>EDIT AGAIN</strong> I'm sorry for not specifying before, I'm using MSSQL</p>\n"},{"tags":["sql-server","sql-server-2005","transaction-log"],"answer_count":21,"favorite_count":37,"up_vote_count":90,"down_vote_count":0,"view_count":203350,"score":90,"question_id":56628,"title":"How do you clear the transaction log in a SQL Server 2005 database?","body":"<p>I'm not a SQL expert, and I'm reminded of the fact every time I need to do something beyond the basics. I have a test database that is not large in size, but the transaction log definitely is. How do I clear out the transaction log?</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":33,"score":2,"question_id":13277674,"title":"convert string to date in sql server","body":"<p>How do I convert <code>YYYY-MM-DD</code> (<code>2012-08-17</code>) to a date in SQL Server?</p>\n\n<p>I don't see this format listed on the help page: <a href=\"http://msdn.microsoft.com/en-us/library/ms187928.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms187928.aspx</a></p>\n"},{"tags":["php","sql-server","pdo"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":11,"score":-1,"question_id":13281344,"title":"Is it possible to use PDO with the mssql packages on CentOS the same way that Ubuntu allows with php5-sybase?","body":"<p>I'm needing to connect to an MSSQL server with PHP, and I can do this fine with PDO methods in Ubuntu having php5-sybase installed. I haven't attempted this on CentOS yet, but my production environment will be PHP5 on CentOS and I want to know if there will be any extra issues I need to be aware of.</p>\n"},{"tags":["sql-server","vb.net","visual-studio-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13281334,"title":"How frequently should I update datatable from VB.Net to SQL Server","body":"<p>I've got a VB 2008 process that is scraping a website and continuously creating new records which will eventually be inserted into a remote SQL Server. I'm wondering what's the most efficient way to be updating my database.</p>\n\n<p>Here are the options I know of available:</p>\n\n<ul>\n<li>Call an INSERT each time a new record is created. (Using the command object or a parameterized query or a table adapter or some other way.)</li>\n<li>Add the new row to a datatable and update the datatable back to the server (using a table adapter) when I'm done creating all the records (this could be in the hundreds of thousands though).</li>\n<li>Add the new row to a datatable and update the datatable back to the server (using a table adapter) every few hundred or so records.</li>\n</ul>\n\n<p>Which of these is the proper/recommended approach to do this? Or is there another way I'm unfamiliar with?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13278058,"title":"SQL Server LIKE on datepart doesnt work for the time element","body":"<p>I am trying to return rows in my table that have a certain date but also a certain hour.</p>\n\n<p>At the moment I can handle the date part of the query just fine by using:</p>\n\n\n\n<pre class=\"lang-sql prettyprint-override\"><code>CONVERT(VARCHAR(25), col1, 126) LIKE '2012-11-05%' \n</code></pre>\n\n<p>That works perfectly and returns all rows where col1 has a value of the 5th November. However when I also want to add the hour to the end like this:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CONVERT(VARCHAR(25), col1, 126) LIKE '2012-11-05 15%' \n</code></pre>\n\n<p>That query returns no rows, even though there are rows with the hour set to 15.</p>\n\n<p>It looks like the time element of the query needs some kind of different syntax? I just wondered if anyone can confirm this?</p>\n"},{"tags":["sql-server","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13273356,"title":"How to process XML files and update a table using SSIS package?","body":"<p>I have two XML files <code>accepted.XML</code> and <code>rejected.XML</code> which have similar structure. One of the nodes of these files is <strong>CLIENT_CLAIM_NUM</strong>. </p>\n\n<p>If the <code>CLIENT_CLAIM_NUM</code> is from accepted.xml, I need to update an SQL Server table with corresponding status as accepted. Same is the case with rejected.xml. My accepted.XML has the following structure:</p>\n\n<h3>Accepted.xml file layout:</h3>\n\n<pre><code> &lt;CLAIM&gt; \n      &lt;CLIENT_CLAIM_NUM&gt;1&lt;/CLIENT_CLAIM_NUM&gt; \n      &lt;Vendor_ASSIGNED_CLAIM_NUM&gt;434772&lt;/Vendor_ASSIGNED_CLAIM_NUM&gt; \n      &lt;LASTNAME&gt;#########&lt;/LASTNAME&gt; \n      &lt;Date&gt;2012-01-06T00:00:00&lt;/Date&gt;\n &lt;/CLAIM&gt;\n</code></pre>\n\n<p>Also how can I send the count of claim numbers in each file by mail?</p>\n\n<p>I used a Data flow task and an XML source to parse the XML. It gives the nodes as columns but how can I store it in a variable or update table with those columns. I cannot use a staging table as I wanted all this in a single package </p>\n"},{"tags":["sql","sql-server","sql-server-2008","hierarchical-data"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13280265,"title":"Flattening a SQL hierarchical data structure in SQL without cursors","body":"<p>Let's say I have the following table</p>\n\n<pre><code>SectionID ParentIDSection DatumID\n   1           NULL         1\n   2            1           2\n   3            1           3\n   4            2           4\n</code></pre>\n\n<p>Now, let's  pretend I want to select all DatumIDs under SectionID = 1, even if it is part of its descendants children so that I would get</p>\n\n<pre><code>SectionID DatumID\n  1         1\n  1         2\n  1         3\n  1         4\n</code></pre>\n\n<p>Is it possible to this without explicitly iterating over the first table recursively with a cursor?</p>\n"},{"tags":["sql-server","sqlclr"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12038033,"title":"Can I develop an SQL/CLR function that can accept arguments of any type like MAX()?","body":"<p>For example, can I develop MAX() function using C# by myself? Thanks!</p>\n"},{"tags":["sql","sql-server","performance","query","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13280548,"title":"Performance issue in retrieving multiple output of the same column with different values from a single table","body":"<p>is there anyway to get the following results from query without joining the same table three times (or) without reading the same \"wordlocation\" table three times (or more if there are more words)? If there are three or more words, it takes about over a minute for the results to be returned.</p>\n\n<p>Currently \"wordlocation\" table has three rows being (\"bookid\",\"wordid\",\"location\") and it currently has 917802 rows.</p>\n\n<p>What I am trying to do is </p>\n\n<ol>\n<li>retrieve the \"bookid\" that contains all the words specified in the query by \"wordid\".</li>\n<li>sum word count of all words (from the query) from each book</li>\n<li>minimum values of each word location, e.g. (min(w0.location), min (w1.location)</li>\n</ol>\n\n<p>I have tried commenting out count(w0.wordid) and min(location) calculations to see whether they are affecting the performance but this is not the case. Joining the same table multiple time was the case.</p>\n\n<p><img src=\"http://i.stack.imgur.com/SYLB7.jpg\" alt=\"enter image description here\"></p>\n\n<p>(this is the same code as the above image)   </p>\n\n<pre><code>select \n    w0.bookid, \n    count(w0.wordid) as wcount, \n    abs(min(w0.location) + min(w1.location) + min(w2.location)) as wordlocation, \n    (abs(min(w0.location) - min(w1.location)) + abs(min(w1.location) - min(w2.location))) as distance \n    from \n    wordlocation as w0 \n    inner join \n    wordlocation as w1 on w0.bookid = w1.bookid \n    join \n    wordlocation as w2 on w1.bookid = w2.bookid \n    where \n    w0.wordid =3 \n    and \n    w1.wordid =52 \n    and \n    w2.wordid =42\n    group by w0.bookid \n    order by wcount desc;\n</code></pre>\n\n<p>This is the result that I am looking for, and which I got from running the above query, but it takes too long if I specify more than 3 words, e.g. (w0 = 3, w1 = 52 , w2 = 42, w3 = 71)</p>\n\n<p><img src=\"http://i.stack.imgur.com/08dD5.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","oracle","database-link","heterogeneous-services"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":12,"score":2,"question_id":13280777,"title":"Unable to create objects with db link; ORA - 0251: another session or branch in same transaction failed or finalized","body":"<p>I have a Heterogeneous Link between Oracle 11.2.0.3 and SQL Server 2008. When I attempt to create views, or procedures that reference the Heterogeneous Services views for system tables, I get 4 errors listed below:</p>\n\n<p>ORA-00604: error occured at recursive SQL level 1</p>\n\n<p>ORA-02051: another session or branch in same transaction failed or finalized</p>\n\n<p>ORA-06512: at \"SYS.HS$_DDTF_SQLTABLES\", line 58</p>\n\n<p>ORA-06512: at line 1</p>\n\n<p>As an example, these errors are created when I try to execute the following code:</p>\n\n<pre><code>CREATE VIEW ALLMYTABLES AS\nSELECT * FROM ALL_TABLES@DBLINKNAME;\n</code></pre>\n\n<p>I am however able to create views on any normal table:</p>\n\n<pre><code>CREATE VIEW RANDOMTABLE AS\nSELECT * FROM RANDOMTABLE@DBLINKNAME;\n</code></pre>\n\n<p>I have done some research to issues similar to this one, but have not found any references to this specific issue. I believe it may have something to do with the conflict between the concurrent operations of creating the view and the select * statement call to the SQL server database. Or perhaps that the records are not entirely fetched when the view is created.</p>\n\n<p>I do not know the specifics of the HS link configuration and properties.</p>\n"},{"tags":["php","sql-server","sql-server-2008","doctrine2","freetds"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13280717,"title":"SELECT problems with Doctrine and MS SQL 2008","body":"<p>We have written an application using Doctrine2, which works great when used with a MySQL or Postgres database.</p>\n\n<p>We now connected the application with a SQL Server 2008 database using <a href=\"http://de3.php.net/manual/en/ref.pdo-dblib.php\" rel=\"nofollow\">PDO Driver DBLib</a> which uses the <code>FreeTDS</code> implementation for the Tabular DataStream protocol, which is shared by SQL Server and Sybase.</p>\n\n<p>The initial schema creation, transactions and <code>INSERT</code>s into the tables work fine .. after some tweaking of the Doctrine <code>SQLServerPlatform</code> and our MSSQL Driver package. </p>\n\n<p>But when selecting data, we face the following error:</p>\n\n<pre><code>General error: 20019 Attempt to initiate a new Adaptive Server operation with results pending\n</code></pre>\n\n<p>After plenty of googling I found <a href=\"http://www.freetds.org/faq.html#pending\" rel=\"nofollow\">this detail in the FAQ of FreeTDS</a>:</p>\n\n<blockquote>\n  <p>If you are accustomed to programming with other database servers, you may be surprised when you first encounter this aspect of the TDS protocol.  [...]<br><br>The server requires the client either to read all the results from a query, or to indicate that no further rows are desired i.e., to issue a cancellation. Until one of those two things happens, the server will not accept new queries on that connection. It will complain about \"pending results\".</p>\n</blockquote>\n\n<p>So the cause for the error message is that for some reason, Doctrine (DBAL->PDO->FreeTDS) did not read all the result rows from the connection buffer, and the server / library doesn't allow the application to issue a new <code>exec()</code>/<code>execute()</code> until all rows are read.</p>\n\n<ul>\n<li>Is my understanding right that <code>$doctrinequery-&gt;getResults()</code> fetches all results before it returns?</li>\n<li>Is my understanding right that <code>$entity-&gt;getLinkedEntity()</code> (i.e. <code>$user-&gt;getGroupNames()</code>) fetches all results before it returns?</li>\n<li>How would you tackle down where exactly the problem is? <br>The stacktraces are not helping me and the codebase is already grown.</li>\n<li>Did anybody else already have this problem and can share some insights?</li>\n<li>Is there an alternative we can use to connect Doctrine to MSSQL which does not suffer this problem?</li>\n</ul>\n"},{"tags":["sql-server","oracle","sharepoint2010"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13280032,"title":"Setting an external content type in SharePoint Designer 2010 - linked Oracle server","body":"<p>Okay, so I have an MS SQL server that's linked to an Oracle DB. I can use \"OPENQUERY\" to successfully query against it.</p>\n\n<p>What I'm trying to do now is create an external content type in SharePoint Designer 2010 that points to the MS SQL server but uses the Oracle DB. Here's what I tried:</p>\n\n<p>Connection Properties\nDatabase Server: [MS SQL server]\nDatabase Name: [Oracle DB name]\nConnect with Impersonated Custom Identity\nSecure Store Application ID: [MS SQL login]</p>\n\n<p>If anyone else has had success with this or can offer suggestions, I'd love to hear them and would be very appreciative :)</p>\n"},{"tags":["sql-server","visual-studio","visual-studio-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":13040563,"title":"How to export database schema in Visual Studio 2012?","body":"<p>I am having a hard time figuring out how to export a database creation script in VS 2012. Is this possible?</p>\n"},{"tags":["sql-server","sql-server-2008","case"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13278148,"title":"case statement to select multiple rows at once","body":"<p>I am looking to pull the same columns from two different tables, based on a conditional argument.</p>\n\n<p>So i have stumbled upon the CASE statement which I have not used much before. I have found this will work for me in this mannor, but I would like it if I could do one CASE statement and then select the columns i need, rather then doing it per column.</p>\n\n<p>Here is an example of what I have and working, just seems a little redundant.</p>\n\n<pre><code>SELECT TOP(10)\n    u1.userid as userid,\n    version = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN 3\n        ELSE 4\n    END,\n    nameOrg = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN CONVERT(NVARCHAR, u1.title)\n        ELSE CONVERT(NVARCHAR, u2.title)\n    END,\n    nameContact = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN CONVERT(NVARCHAR, u1.contact)\n        ELSE CONVERT(NVARCHAR, u2.contact)\n    END,\n    pltName = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN p1.name\n        ELSE p2.name\n    END\nFROM\n    usr1 u1\nLEFT OUTER JOIN\n    usr2 u2\n    ON u1.userid = u2.userid\nLEFT OUTER JOIN\n    plt2 p2\n    ON u2.pltid = p2.pltid\nLEFT OUTER JOIN\n    plt1 p1\n    ON u1.pltid = p1.pltid\n</code></pre>\n\n<p>Any advise?</p>\n\n<ul>\n<li>Edit mov 7, 5:22: added join to plt table and pltName case, to add to required functionality.</li>\n</ul>\n"},{"tags":[".net","sql-server","wpf","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":12,"score":3,"question_id":13278889,"title":"How to add data to SQL Server Express database using Entity Framework","body":"<p>I'm writing simple program for my university. I created an Entity Framework model, draw diagrams, created database from model, applied SQL file on my database and now I'm trying to add some items to the DB. </p>\n\n<p>I'm doing it this way:</p>\n\n<pre><code>using (NewsletterEntities context = new NewsletterEntities())\n{\n   Sender newSender = new Sender();\n   newSender.Login = Login.Text;\n   newSender.Password = Password.Text;\n   newSender.Port = 23;\n   newSender.SMTP = SMTP.Text;\n   newSender.Email = Email.Text;\n   newSender.SenderID = 0;\n\n   context.Senders.AddObject(newSender);\n   context.SaveChanges();\n}\n</code></pre>\n\n<p>When I try to execute it it pops up with inner exception: </p>\n\n<blockquote>\n  <p>Cannot insert explicit value for identity column in table 'Senders' when IDENTITY_INSERT is set to OFF.</p>\n</blockquote>\n\n<p>I was trying to look for the error, but I don't know much about entity framework and couldn't find anything specific.</p>\n\n<p>Can anyone help?</p>\n"},{"tags":["sql-server","constraints","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":36,"score":2,"question_id":13278514,"title":"How can I represent rows and columns in an application in MSSQL?","body":"<p>I have an application that displays tabular information and allows the user to enter and edit it. I have been working on the database design for this and have come across the following problem.</p>\n\n<p>I want to avoid creating an MSSQL table for each table in the application, so I've been trying to represent all of the tables together, in two tables.</p>\n\n<p>I have defined a <code>MyAppTable</code> table which has <code>Id INTEGER</code> primary key and a <code>Name CHARACTER VARYING(255)</code> columns.</p>\n\n<p>From there, I have defined a <code>MyAppColumn</code> table which foreign keys against the <code>MyAppTable.Id</code> column and also has a <code>Position INTEGER</code> column to indicate its position in the rendered table.</p>\n\n<p>Finally, I have defined a <code>MyAppRow</code> table which foreign keys against the <code>MyAppColumn.Id</code> column and has a <code>Data BINARY(32)</code> column. It's a table of small files, so this data type is fitting.</p>\n\n<p>The actual problem is that I cannot guarantee that the <code>MyAppColumn.Position</code> column will be unique for each <code>MyAppTable</code>.</p>\n\n<p>An example of a normal situation:</p>\n\n<ul>\n<li><code>MyAppTable</code> with <code>Id</code> 0</li>\n<li><code>MyAppColumn</code> with <code>Id</code> 0, <code>TableId</code> 0, <code>Position</code> 0</li>\n<li><code>MyAppColumn</code> with <code>Id</code> 1, <code>TableId</code> 0, <code>Position</code> 1</li>\n<li><code>MyAppRow</code> with <code>ColumnId</code> 0, <code>Data</code> [something]</li>\n<li><code>MyAppRow</code> with <code>ColumnId</code> 1, <code>Data</code> [something]</li>\n<li><code>MyAppTable</code> with <code>Id</code> 1</li>\n<li><code>MyAppColumn</code> with <code>Id</code> 2, <code>TableId</code> 1, <code>Position</code> 0</li>\n<li><code>MyAppRow</code> with <code>ColumnId</code> 2, <code>Data</code> [something]</li>\n</ul>\n\n<p>An example of a situation I want to make impossible in the database:</p>\n\n<ul>\n<li><code>MyAppTable</code> with <code>Id</code> 0</li>\n<li><code>MyAppColumn</code> with <code>Id</code> 0, <code>TableId</code> 0, <code>Position</code> 0</li>\n<li><code>MyAppColumn</code> with <code>Id</code> 1, <code>TableId</code> 0, <code>Position</code> 0</li>\n</ul>\n\n<p>As you can see, I want some way of constraining a pair of columns. The two columns <code>TableId</code> and <code>Position</code> should be <code>UNIQUE</code> but if that were done independently, it would mean two tables could never have columns both at a <code>Position</code> of 0.</p>\n\n<p>How can I accomplish this in Microsoft SQL Server 2012?</p>\n"},{"tags":["sql-server","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":24,"score":-2,"question_id":13278641,"title":"What is a wrapper for a stored procedure in sql server?","body":"<p>What is the definition of a wrapper for a stored procedure in sql server?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13277646,"title":"SQL Grouping by predefined date range","body":"<p>I have the following: </p>\n\n<p><a href=\"http://sqlfiddle.com/#!2/fca3d/1\" rel=\"nofollow\">http://sqlfiddle.com/#!2/fca3d/1</a></p>\n\n<p>I'm trying to now add one row for each week in the year, and filter the contacts accordingly.  The new table will look like: </p>\n\n<pre><code>        Status 1    Status 2    Status 3\nWeek 1      3          4           2\nWeek 2      1          5           3\nWeek 3      2          2           4\n</code></pre>\n\n<p>I think that DATEADD needs to be used, however I'm at a loss in terms of how to begin changing my query.  Any help would be much appreciated!  </p>\n"},{"tags":["sql-server","visual-studio-2010","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":13,"score":-1,"question_id":13277044,"title":"Entity Framework database not showing","body":"<p>When I select 'add a new item' and then select 'ADO.NET Entity Data Model' and select 'Generate from database' in Visual Studio only some databases show up but other databases I have added don't? </p>\n"},{"tags":["sql-server","sharepoint2010","sharepoint-designer","sql-server-2008-express"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1428,"score":1,"question_id":7890125,"title":"Connect Sharepoint 2010 (external content type) to MSSQL Linked Server","body":"<p>I can't seem to connect to my linked server database from within the external content type definition screen in Microsoft Sharepoint 2010.</p>\n\n<p>When I access my Linked Server from with SQL Server Management Studio, it works fine:</p>\n\n<pre><code>SELECT * FROM MyLinkedServer.MyCatalog.MyDatabase.MyTable\n</code></pre>\n\n<p>returns all the records just fine.</p>\n\n<p>But in Sharepoint I choose \"External Content Type\", i create one; On the next screen I click \"External system, click here to detect external datasources ..\" (or something similiar).</p>\n\n<pre><code>- Add connect/datasource  \n  * Datasourcetype: SQL server  \n  * Databaseserver: MySQLServerIP\\InstanceName (ex. 192.168.1.2\\SQLEXPRESS)  \n  * Databasename: MyLinkedServer.MyCatalog.MyDatabase (ex. AS400.COMPANY1.ERPSYS)  \n  * Name (optional): &lt;Empty&gt;  \n  * Select 'Connect using the user-id (first option)'  \n- OK.  \n</code></pre>\n\n<p>ERROR:</p>\n\n<blockquote>\n  <p>Cannot connect to the LobSystem (external system) Cannot open database\n  \"AS400.COMPANY1.ERPSYS requested by the login. The login failed. Login\n  failed for user 'MYDOMAIN\\me'.</p>\n</blockquote>\n\n<p>I use the same user for SQL Management studio and Sharepoint. I should have permission to access the Linked Server. I've set the specific credentials for the Linked Server for MYDOMAIN\\me.</p>\n\n<p>I can connect directly to a SQL database (which is not on a linked server) though..</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":39,"score":1,"question_id":13277588,"title":"SQL INNER JOINS in SP converting date and/or time from character string getting error message","body":"<p>I have searched about 20 results apertaining to the error message \"Conversion failed when converting date and/or time from character string.\" and none seem to address my issue.</p>\n\n<p>A little history, last Friday the queries were working just fine and the data returned was proper. On the following Monday, the queries no longer worked and gave this error message, \"Conversion failed when converting date and/or time from character string.\"  So, after a few hours of battling it was able to run a function with the offending code in it and the query ran perfect again. Until this morning. I came into the office and ran the query and received the error \"Conversion failed when converting date and/or time from character string.\"  So now I am pulling my hair out.</p>\n\n<p>I started by verifying each record being returned is, in fact, a valid date using the isDate function. All the dates are valid dates in string format. I am simply doing a check to see whether or not the record is older than 1 year. </p>\n\n<p>I do have several INNER JOINS and have been wondering if they are affecting the output.</p>\n\n<pre><code>SELECT \ngc2p.partnumber, gc2p.orderby, gc2p.campaigncode, gp2a.assetfilename\nFROM [StepMirror].[dbo].[stepview_nwppck_ngn_getclassification2productrefs] gc2p\n,[StepMirror].[dbo].[stepview_nwppck_ngn_getpimweblegalattrlist1] gpwa\n,[StepMirror].[dbo].[stepview_nwppck_ngn_getclassification2assetrefs] gc2a \n,[StepMirror].[dbo].[stepview_nwppck_ngn_getproduct2assetrefs] gp2a \nWHERE gc2p.partnumber=gpwa.PARTNUMBER and\ngc2p.id=gc2a.id and\ngp2a.PRODUCTNAME=gpwa.PARTNUMBER and\nATTRIBUTENAME='New Date' AND \nATTRIBUTEVALUE &gt; dateadd(month,-12,getdate()) AND \ngc2p.id = '5665976' and \ngc2a.assettype='Primary Image' AND \ngp2a.ASSETTYPE = 'Primary Image'\norder by gc2p.orderby\n</code></pre>\n\n<p>If anyone could give me a helping hand that would be wonderful.</p>\n\n<p>Edit: The query runs fine when I remove 'ATTRIBUTEVALUE > dateadd(month,-12,getdate())'. I forgot to mention the exact part of the query throwing the error.</p>\n\n<p>Edit: Updated Query - <strong>Now Working Query</strong> for those seeking a similar answer.</p>\n\n<pre><code>SELECT TOP 18 gc2p.partnumber, gpwa.ATTRIBUTECNAME,gp2a.ASSETFILENAME, gpwa.ATTRIBUTEVALUE\nFROM [StepMirror].[dbo].[stepview_nwppck_ngn_getclassification2productrefs] gc2p\nINNER JOIN [StepMirror].[dbo].[stepview_nwppck_ngn_getpimweblegalattrlist1] gpwa ON gc2p.partnumber=gpwa.PARTNUMBER and gpwa.ORDERBY='96'\nINNER JOIN [StepMirror].[dbo].[stepview_nwppck_ngn_getclassification2assetrefs] gc2a ON gc2p.id=gc2a.id\nINNER JOIN [StepMirror].[dbo].[stepview_nwppck_ngn_getproduct2assetrefs] gp2a ON gc2p.partnumber=gp2a.PRODUCTNAME\nWHERE gc2p.id = 5665976 AND gp2a.assettype='Primary Image' AND gc2a.assettype='Primary Image' \nAND(CASE WHEN ISDATE(ATTRIBUTEVALUE)  = 0 then NULL ELSE ATTRIBUTEVALUE END) &gt; dateadd(month,-12,getdate())\norder by gc2p.orderby\n</code></pre>\n"},{"tags":["sql-server","locking","partitioning"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13053531,"title":"SQL Server - Force shared lock on partition","body":"<p>I am using partition switching to rebuild indexes on a staging table without dropping them on the partitioned table as in <a href=\"http://msdn.microsoft.com/en-us/library/ms191160%28v=sql.105%29.aspx\" rel=\"nofollow\">microsoft's article</a>.</p>\n\n<p>I have what boils down to </p>\n\n<pre><code>BEGIN TRAN\nALTER INDEX IX_Working ON dbo.WorkingTable DISABLE\n\nINSERT INTO dbo.WorkingTable ( Id, PartitionColumn, Values...)\nSELECT Id, PartitionColumn, Values...\nFROM PartitionedTable WITH (HOLDLOCK)\nWHERE PartitionColumn &lt;= @rightboundary\nAND PartitionColumn &gt; @leftboundary\n\nINSERT INTO WorkingTable ( Id, PartitionColumn, Values...)\nSELECT Id, PartitionColumn, Values...\nFROM Imports\n\nALTER INDEX IX_Working ON WorkingTable REBUILD -- SLOW BIT\n\nALTER TABLE PartitionedTable SWITCH PARTITION @partition TO SwapTable\nALTER TABLE WorkingTable SWITCH TO PartitionedTable PARTITION @partition\n\nTRUNCATE TABLE SwapTable\nCOMMIT\n</code></pre>\n\n<p>Now during this operation I need to block any updates to the partition being reindexed but still allow them on other partitions. The PartionedTable has lock escalation set to auto. I am trying to do this with the HOLDLOCK but I'm still able to do INSERT INTO PartionedTable (Id, @somevalueInTheRange, Values...) from another connection during the slow bit.</p>\n\n<p>How can I block this while still allowing selects?</p>\n"},{"tags":["sql","sql-server","percentile"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13278051,"title":"SQL Percercentile Calculation","body":"<p>I have the following query, which even without a ton of data (~3k rows) is still a bit slow to execute, and the logic is a bit over my head - was hoping to get some help optimizing the query or even an alternate methodology:</p>\n\n<pre><code>Select companypartnumber, (PartTotal + IsNull(Cum_Lower_Ranks, 0) ) / Sum(PartTotal) over() * 100 as Cum_PC_Of_Total\nFROM PartSalesRankings PSRMain\nLeft join \n    (\n        Select PSRTop.Item_Rank, Sum(PSRBelow.PartTotal) as Cum_Lower_Ranks\n          from partSalesRankings PSRTop\n          Left join PartSalesRankings PSRBelow on PSRBelow.Item_Rank &lt; PSRTop.Item_Rank\n         Group by PSRTop.Item_Rank \n    ) as PSRLowerCums on PSRLowerCums.Item_Rank = PSRMain.Item_Rank\n</code></pre>\n\n<p>The PartSalesRankings table simply consists of CompanyPartNumber(bigint) which is a part number designation, PartTotal(decimal 38,5) which is the total sales, and Item_Rank(bigint) which is the rank of the item based on total sales.</p>\n\n<p>I'm trying to end up with my parts into categories based on their percentile - so an \"A\" item would be top 5%, a \"B\" item would be the next 15%, and \"C\" items would be the lower 80th percentile.  The view I created works fine, it just takes almost three seconds to execute, which for my purposes is quite slow.  I narrowed the bottle neck to the above query - any help would be greatly appreciated.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":23,"score":1,"question_id":13277056,"title":"How to check SQL Server Performance Tuning for Stored Procedures","body":"<p>I'm creating a stored procedures for an application that will generate some business logic in <a href=\"/questions/tagged/sql-server\" class=\"post-tag\" title=\"show questions tagged 'sql-server'\" rel=\"tag\">sql-server</a>.  How can I check performance of stored procedures like speed,accuracy etc. \nAny ideas or direction will be much appreciated</p>\n"},{"tags":["sql-server","northwind"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13277670,"title":"Select Company Names with more than X Orders","body":"<p>The Order table has the list of orders as well as a Customer ID for every order. And different orders can have the same customer ID , meaning a company has put in multiple orders (Given that Customer ID is the ID for the company).</p>\n\n<p>Company Name comes from the Customer Table and my goal is to select company names with more than X number of orders.</p>\n\n<p>Now, my first step is to join these two tables to compare, and then I can also Select company name, but I am confused as to how to select only the companies with more than X orders.</p>\n\n<p>So far I have this, which writes out a company name X amount of times for X amount of orders they have issued. </p>\n\n<pre><code>SELECT CompanyName\n    FROM Orders, Customers\n        WHERE Orders.CustomerID = Customers.CustomerID;\n</code></pre>\n\n<p>How do I only get the company names greater than X Orders? I tried with \nWHERE COUNT(CompanyName)>3 , but that just gave errors. I don't think I learned any other\nway how to quantitize Selects from columns.</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13277549,"title":"SQL server exclude anything but a number","body":"<p>is their a way to exclude results pulled in a query that start with anything but a number. Exclude anytXing starting in a letter.</p>\n\n<p>I tried</p>\n\n<pre><code> Where a.value like '0%'\n       And a.value  like '1%'\n       And a.value like '2%' \n         .......3-9\n</code></pre>\n"},{"tags":["sql-server","function"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13276798,"title":"function separate string","body":"<p>I have this question for you.I am working a function which has the whole address in one field.I am trying to separate it.I have started working on the one below and I am having difficulty when I try to work on the zip ,I want to test if there is a zip first at the end and if so I am trying to separate it from the state.Could you please have alook at it?Thanks alot guys as usual I appreciate you support..</p>\n\n<pre><code>      declare @var1 varchar(100)='1234 S.Almeda way,Seattle,WA9810'--just an example\n        ,@u int\n        ,@r int\n        ,@var2 varchar(100)\n        ,@var3 varchar(100)\n        ,@Zip varchar(25)\n        ,@var4 varchar(100)=null\n             set @u = charindex(',', @var1)\n             set @var2=rtrim(ltrim(substring(@var1, @u+1, 999)))\n             set @r=CHARINDEX(',',@var2)\n             set @var3=rtrim(ltrim(substring(@var2, @r+1, 999)))\n\n             --set @var4=RIGHT(@var3,5)--not enough\n             if (len(@var3)&gt;=5 and ISNUMERIC(@var3)=1 )\n             set  @var4=RIGHT(@var3,5)\n             set rtrim(substring(@var3,1,len(@var3)-5))\n             else set @var4=''\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13276778,"title":"Changing the name of a SQL database missing tables","body":"<p>when changing the name of a SQL server 2005 database moving mdf and ldf files.</p>\n\n<p>First i run a script in my program's install:</p>\n\n<pre><code>Alter Database [[DBNAME]] MODIFY NAME = [[RENAMEDBNAME]] \n\nAlter Database [[RENAMEDBNAME]] MODIFY FILE ( NAME =  [[DBNAME]], NEWNAME = [[RENAMEDBNAME]] )\n\nAlter Database [[RENAMEDBNAME]] MODIFY FILE ( NAME =  [[DBNAME]_log], NEWNAME = [[RENAMEDBNAME]_log] )\n\nAlter Database [[RENAMEDBNAME]] MODIFY FILE ( NAME =[[RENAMEDBNAME]]  , FILENAME  ='[DBPATH][RENAMEDBNAME].mdf'  )\n\nAlter Database [[RENAMEDBNAME]] MODIFY FILE ( NAME =[[RENAMEDBNAME]_log]  , FILENAME  ='[DBPATH][RENAMEDBNAME]_log.ldf'  )\n</code></pre>\n\n<p>ALTER DATABASE  [[RENAMEDBNAME]] SET OFFLINE GO</p>\n\n<p>then I move the files in code.</p>\n\n<p>then in the next script I use</p>\n\n<pre><code>ALTER DATABASE  [[RENAMEDBNAME]] SET ONLINE GO\n</code></pre>\n\n<p>The tables are missing from the database - Any ideas?\nShould I use backup and restore?</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","sql-server","sqlcommand"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13276173,"title":"SQL command returns invalid object name database.table","body":"<p>I run this code:</p>\n\n<pre><code>                    SqlConnection polaczenie;\n                    polaczenie = new SqlConnection(dane_polaczenia);\n                    SqlCommand cmd = new SqlCommand();\n                    cmd.Connection = polaczenie;\n                    polaczenie.Open();\n                    cmd.CommandText = @\"SELECT * FROM test.test\";\n                    cmd.ExecuteNonQuery();\n</code></pre>\n\n<p>After executing I got exception <code>Invalid object name 'test.test'.</code> </p>\n\n<p>Database and table values are correct.</p>\n\n<p>How to specify <code>database.table</code> in <code>CommandText</code> correctly?</p>\n"},{"tags":["sql","sql-server","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13268760,"title":"Alter stored procedure or function added extra blank line gap","body":"<p>In SQL Server 2012 when I write code for stored procedure and for any function. After that when I want to alter it added extra blank line gap, that's why it seem very unacceptable lenghty..</p>\n\n<pre><code>CREATE proc sp_delete_Rte_article_admin_Latest   \n(    \n@id int    \n)    \nas    \nbegin    \nif exists (select * from tblRte where Id=@id )    \nbegin    \n    declare @IvanID bigint  \n\n    set @IvanID=(select [IvanArtId] from tblRte where Id=@id )  \n    insert into tblRteOnDelete([IvanArtId],[StoryType],[ChannelType],[Filename],\n                [Headline],[PublishDate],[Title],[DocScope],[KeyWord],[Byline],[City],\n                [State],[StoryDate],[BodyContents],[DownloadedDate],DeleteDate)\n    select [IvanArtId],[StoryType],[ChannelType],[Filename],[Headline],[PublishDate],\n           [Title],[DocScope],[KeyWord],[Byline],[City],[State],[StoryDate],\n           [BodyContents],[DownloadedDate],GETDATE()\n      from tblIvanhoeXmlFeeds\n     where Id=@id   \n\n    delete from tblRte where Id=@id   \n    delete from tblUpdatedRteTopics where IvanArtId=@IvanID  \n    delete from tblCheckAllowRte where ArticleID=@IvanID  \n    delete from tblAddRteeApprove where ArticleID=@IvanID  \n\n    return 1    \nend    \nelse    \nbegin    \n    return 0    \nend    \nend\n</code></pre>\n\n<p>What should do for moving this for all time..any setting ?</p>\n"},{"tags":["sql-server","windows","oracle","iis","rdf"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13273227,"title":"Semantic Web - Store app data directly in RDF or store in SQL and export/import later","body":"<p>I have a standard IIS web application which stores its data in a standard SQL Server or Oracle DB.\nI'm now interested in storing the data in <a href=\"http://www.rdfabout.com/quickintro.xpd\" rel=\"nofollow\">RDF</a> format, to go full <strong>Semantic Web</strong>.</p>\n\n<p>Is it recommended to store data directly in RDF format? CRUDQ operations will be done on the data. Performance wise is this a good move?</p>\n\n<p><strong>If not</strong> (like I'm assuming), I guess I'd maintain standard SQL DBs and export/import data to/from RDF? How can I do this? Are there good converters out there?</p>\n"},{"tags":["sql-server"],"answer_count":14,"favorite_count":2,"up_vote_count":18,"down_vote_count":0,"view_count":59579,"score":18,"question_id":546746,"title":"SQL Server 2008 Windows Auth Login Error: The login is from an untrusted domain","body":"<p>When attempting to connect to a SQL Server 2008 Instance using Management Studio, I get the following error:</p>\n\n<blockquote>\n  <p>Login failed. The login is from an\n  untrusted domain and cannot be used\n  with Windows authentication.\n  (Microsoft SQL Server, Error: 18452)</p>\n</blockquote>\n\n<p>I can login using SQL Authentication without problem.  I've been getting this error all of a sudden.  I have Mixed Mode Authentication turned on.  </p>\n\n<p>Does anyone have any experience with this?</p>\n\n<p>Additional Info:\n64-bit version of SQL\nEnterprise Edition\nOn Windows 2003 Server</p>\n\n<p><strong>EDIT: The issue was caused by a down Active Directory Server, which of course could not authenticate the Windows account. Thank you for your assistance.</strong>   </p>\n"},{"tags":["sql-server","tsql","database-performance"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13274083,"title":"COLLATE clause cannot be used on expressions containing a COLLATE clause","body":"<p>I have two tables: tab1 and tab2. Every table has only one VARCHAR(MAX) column.</p>\n\n<p>I need to obtain only those pairs of values, which are equals, but differs in only case.</p>\n\n<p>Example input:</p>\n\n<pre><code>tab1.t1     tab2.t2\n-----------------------\nfff     fff\nFFF     fff\nFff     fff\nFFF     FFA\nFfA     FFF\nFFF     aaa\nbbb     aaa\n\nRelated output:\n\nt1      t2\n-----------------------\nfff     FFF\nFFF     fff\nFff     fff\nFff     FFF\nFfA     FFA\n</code></pre>\n\n<p>Tables tab1 and tab2 are big enough in real our real database (~ 800-1000 rows). And there are about 500-600 columns for which I need to produce this operation.</p>\n\n<p>So I need to write a fast solution.\nI write an alghoritm:</p>\n\n<ol>\n<li>remove all duplicates using case sensitive collation from tab1</li>\n<li>remove all duplicates using case sensitive collation from tab2</li>\n<li>join result sets from previous steps using case insensitive collation</li>\n<li>filter out (WHERE clause) rows which values are not equals using case sensitive collation</li>\n<li>remove duplicate rows using case sensitive collation</li>\n</ol>\n\n<p>I tried so:</p>\n\n<pre><code>SELECT DISTINCT tt.t1 COLLATE Cyrillic_General_CS_AS, tt.t2 COLLATE Cyrillic_General_CS_AS\nFROM (\n    SELECT tt1.t1, tt2.t2\n    FROM \n    (\n        SELECT tab1.t1 COLLATE Cyrillic_General_CS_AS\n                       AS t1\n        FROM (VALUES('fff'),('FFF'),('Fff'),('FFF'),('FfA'),('FFF'),('bbb')) AS tab1(t1)\n        GROUP BY tab1.t1 COLLATE Cyrillic_General_CS_AS\n    ) tt1 INNER JOIN\n    (\n        SELECT tab2.t2 COLLATE Cyrillic_General_CS_AS\n                       AS t2\n        FROM (VALUES('fff'),('fff'),('fff'),('FFA'),('FFF'),('aaa'),('aaa')) AS tab2(t2)\n        GROUP BY tab2.t2 COLLATE Cyrillic_General_CS_AS\n    ) tt2\n    ON tt1.t1 = tt2.t2 COLLATE Cyrillic_General_CI_AS\n) AS tt\nWHERE tt.t1 &lt;&gt; tt.t2 COLLATE Cyrillic_General_CS_AS\n</code></pre>\n\n<p>but it an error occur:</p>\n\n<blockquote>\n  <p>\"COLLATE clause cannot be used on expressions containing a COLLATE clause.\"</p>\n</blockquote>\n\n<p>Please suggest me how to avoid this problem without using user defined functions, temp tables, or removing group by clause (i tried them - they hardly slow down execution).</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13275758,"title":"Cannot connect with sqmcmd although MS SQL Server Management Studio can","body":"<p>I have a case where I need to connect to a remote database. Using MS SQL Server Management Studio I can connect without any problems. But I have trouble doing the same with sqlcmd.</p>\n\n<p>Can someone tell me what the Mgmt Studio does differently?</p>\n\n<p>Right now, I'm doing this:</p>\n\n<pre><code>sqlcmd /S server_name -E\n</code></pre>\n\n<p>I'm using SQL Server 2008 R2.</p>\n\n<p>Thanks,\nChristian</p>\n"},{"tags":["sql","sql-server","database","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":23,"score":2,"question_id":13274950,"title":"list all tables that don't exist but are used in a view sql server","body":"<p>I can't seem to get all the table names that a view is trying to use.</p>\n\n<p>Currently, I am using <code>INFORMATION_SCHEMA.VIEW_COLUMN_USAGE</code> to find which tables are used. But, it only finds tables that currently exist. I want to find out if that view is trying to use tables that don't exist.</p>\n\n<p><code>View_Column_Usage</code> will only find columns that are used in the view. You can check to see if those columns are in any of the current tables columns to find which columns aren't used, but you can't find which tables aren't used.</p>\n\n<p>Does anyone know a table I can use to find which tables are used in a view, but do not exist?</p>\n"},{"tags":["c#",".net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":12964757,"title":"Pass sysname in datatable TVP","body":"<p>I have a stored procedure using the type below as a param</p>\n\n<pre><code>    CREATE TYPE [dbo].[columnOrderTableType] AS TABLE\n     ([id]                     [int]        IDENTITY(1,1) NOT NULL\n     ,[columnName]             [sysname]                  NOT NULL\n</code></pre>\n\n<p>I need to pass a datatable from my api as TVP to this sproc</p>\n\n<p>When I use string as value for the columnName I get an error saying that type doesnt match the types reqd for columnOrderTableType</p>\n\n<p>How do I pass a sysname in datatable?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13267949,"title":"Update field in Source table with Identity after insert target with merge statement","body":"<p>I have a table Items which should have a corresponding record in the table LanguageText. The ID (Identity) of LanguageText is registered in the Items.LanguageTextId field in my Items table.</p>\n\n<p>What I want to accomplish is a merge between LanguageText and Items for all records with null in Items.LanguageTextId and insert the itemname / text of these Item records in LanguageText plus update the LanguageTextId with the ID value from the newly inserted LanguageText record (SCOPE_IDENTITY()?)</p>\n\n<p>The insert works fine:</p>\n\n<pre><code>MERGE [dbo].[LanguageText] AS target\nUSING (SELECT [Items].* from [dbo].Items ) AS source \nON (TARGET.Id = SOURCE.LanguageTextId) \nWHEN NOT MATCHED By Target THEN \n    INSERT   \n       ([Text])\n VALUES\n       (source.[ItemName]);\n</code></pre>\n\n<p>end</p>\n\n<p>But I don't know how to update my items.Languagetextid, can I do something with:\nOUTPUT $action, INSERTED.ID ?\nOr is there a better way to have this done??</p>\n\n<p>Thanks in advance,</p>\n\n<p>Mike</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13275613,"title":"ASP.NET multiple dropdownlists options from SQL Server","body":"<p>I want to make 2 dropdownlist. First dropdownlist(Second dropdownlist won't show up until first one is selected) will have 3 choice to choose which table want to view. After select one of those, the second dropdownlist show up with list of values from specific column. After select one of those, then GridView table will show up to show display only from second selected dropdownlist. For example, first dropdownlist will have Cluster, Server, and Database. I select Database then second dropdownlist show up with list of Database name. I pick Database77 and then GridView table show up with results only from Database77.</p>\n\n<p>Is there any good example you can provide or a link from website?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","version-control"],"answer_count":3,"favorite_count":3,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":13274498,"title":"Add version control to existing SQL Server database","body":"<p>I am part of a development team currently working with a database that does not have any kind of source control. We work with SQL Server 2008 R2 and have always managed the DB directly with SSMS. It now has ~340 tables and ~1600 stored procedures, plus a few triggers and views, so it is not a small DB.</p>\n\n<p>My goal is to have the DB under version control, so I have been reading articles, like <a href=\"http://bitly.com/9cJmGR\" rel=\"nofollow\">Scott Allen's series</a> and many old SO related questions. But I am still unable to decide on how to proceed.</p>\n\n<p>What I'm thinking of is to script the database schema in one file, then procedures, triggers and views in one file each. Then keep everything versioned under Mercurial. But of course, every member of the team can access SSMS and directly change the schema and procedures, with the possibility that any of us can forget to replicate those changes in the versioned files.</p>\n\n<p>What better options are there? And, did I forget any element worth having source control of? My biggest concern is that most of the literature I found explains how to do version control when creating a new database, but not when it is already old and relatively big.</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13273371,"title":"storing images in database or on hard drive","body":"<p>I'm working on an ASP.NET web app, this web site is hosted on a VDS (virtual dedicated server) which has a big hard drive (30 GB). Users can upload pictures and currently images are stored in database image columns (SQL server 2008). Is it better to store images as files on hard drive instead of saving them in database? what are pros and cons of each method? I think there would be about 100 pictures each day so I suppose database will grow quickly and finally I'll have a really big MDF file!</p>\n"},{"tags":["sql-server","vb.net","impersonation","runas"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13273300,"title":"Impersonate remote user in vb.net to access MS SQL Server","body":"<p>I'm trying to impersonate a domain user over vpn. I am able to run management studio from the command prompt using the RUNAS command. However, I can't do the same with my vb application (.net 4.5, winforms, using VS 2012 Express) in either debug mode or published app. Here is what I tried:</p>\n\n<ul>\n<li>runas command of my application (from the location of the shortcut in Start Menu Programs, as well as the executable); in these cases, after I input the password in the command prompt, I get 'unknown user or bad password' error.</li>\n<li>I've tried the impersonate user within the code as indicated on several websites such as [http://williamfaulkner.co.uk/2009/04/vbnet-run-as-administrator-impersonate-a-user-2008/][1], which seems like a variation of that listed on MSDN that uses calls advapi.dll (I'm not really sure how it works). In this case, I also get 'unknown user or bad password' error when the code tries to query the SQL server.</li>\n</ul>\n\n<p>Does anyone have any explanation for these errors and/or how I might solve this. I'm assuming that if I can impersonate and run ssms, I should be able to do it within my vb app.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server","tsql","binary","hex","like-operator"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13262433,"title":"Binary column SELECT with LIKE","body":"<p>I'm trying to find specific lines of data from a <code>BINARY</code> column.</p>\n\n<p>Example data in the <code>BINARY(2000)</code> column:</p>\n\n<pre><code>0x0600700701000C006B6173616E74696E676B6F000000000003000A0078009C0000000000E612101E000000000000000000006B031813361E00000000000000000000D4014B13141C0000000000000000000053017C13261E00000000000000000000A102E113361E000000000000000000009E02FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF2201073200000000000000000000D604D11C101C000000000000000000008C01FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0170000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000220047003700280016000F0001000B0003003F000000480200001D0000003101000000000000562B00003710000000000000134B000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB517010000000000000000000000000012060200000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF191404000000000000000000000000009A13051D00000000000000000000A0029A13051D00000000000000000000A002BC3B0700000000000000000000000000FE050817000000000000000000000000FE05091E00000000000000000000000012060200000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF191404000000000000000000000000009A13051D00000000000000000000A0029A13051D00000000000000000000A002FB050F0D000000000000000000000100FB05101E000000000000000000000100FB05111E000000000000000000000100FE13121D00000000000000000000B402FE13121D00000000000000000000B402E213141E00000000000000000000BC02E213141E00000000000000000000BC023613161D00000000000000000000FE003613161D00000000000000000000FE00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB05191E000000000000000000000100FE13121D00000000000000000000B402FE13121D00000000000000000000B402E213141E00000000000000000000BC02E213141E00000000000000000000BC023613161D00000000000000000000FE003613161D00000000000000000000FE000413201E00000000000000000000CC000413201E00000000000000000000CC002E01222C000000000000000000008F052E01222C000000000000000000008F05FB05241E000000000000000000000100FB05251E000000000000000000000100FB05261E000000000000000000000100FB05271E0000000000000000000001000413201E00000000000000000000CC000413201E00000000000000000000CC002E01222C000000000000000000008F052E01222C000000000000000000008F05FB052C1E000000000000000000000100FC052D1E000000000000000000000000A9262E2E000000000000000000000000A9262E2E000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF2E01222C000000000000000000008F052E01222C000000000000000000008F05FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA9262E2E000000000000000000000000A9262E2E000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070000005E000000000000000000000000000000000000000500000000000000FFFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n</code></pre>\n\n<p>This data has 1 result of <code>2201</code> somewhere in it. (try searching the data for 2201 and you will get 1.)</p>\n\n<p>Now I'm trying to use this query: (it should give me 512 rows of results)</p>\n\n<pre><code>SELECT * \nFROM table\nWHERE binaryfield LIKE '%2201%'\nORDER BY key\n</code></pre>\n\n<p>But no luck in getting results.</p>\n\n<p>Notes: 2201 actually is 290. I'm trying to look for the decimal value 290 which is 2201 in hex in the data that is in endian.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>Tried this query (searching for: 15584)</p>\n\n<pre><code>SELECT *\nFROM CHAR_DATA1\nWHERE CHAR_DATA LIKE '%'+CAST(0xE03C AS nvarchar(MAX))+'%'\nORDER BY CHAR_KEY;\n</code></pre>\n\n<p>Now its returning almost all rows. Even manually checked the rows for E03C but none was found, but when running the query it gets returned. very odd. ideas?</p>\n"},{"tags":["sql-server","entity-framework-5","localdb"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13275054,"title":"EF5: Cannot attach the file {0}' as database '{1}'","body":"<p>I'm encountering the exact issue as described <a href=\"http://odetocode.com/Blogs/scott/archive/2012/08/14/a-troubleshooting-guide-for-entity-framework-connections-amp-migrations.aspx\" rel=\"nofollow\">here</a> (read section \"Cannot Attach to Deleted MDF File\"), but the solution to the problem is not told there...</p>\n\n<p>I did delete the DB file and now I get that nasty error message when running the application expecting it to use it's initializer.\nAny way to fix this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13274296,"title":"Auto Increment feature of SQL Server","body":"<p>I have created a table named as ABC. It has three columns which are as follows:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/3sx3t.png\" alt=\"enter image description here\">              </p>\n\n<p>The column <code>number_pk</code> <code>(int)</code> is the <strong>primary key</strong> of my table in which I have made the <code>auto increment</code> feature on for that column.</p>\n\n<p>Now I have deleted two rows from that table say <code>Number_pk= 5</code> and <code>Number_pk =6</code>.</p>\n\n<p>The table which I get now is like this:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/bTpbm.png\" alt=\"enter image description here\"></p>\n\n<p>Now if I again enter two new rows in this table with the same value I get the two new <code>Number_pk starting from 7 and 8</code> i.e,</p>\n\n<p><img src=\"http://i.stack.imgur.com/Y3fLv.png\" alt=\"enter image description here\"></p>\n\n<p>My question is that what is the logic behind this since I have deleted the two rows from the table. I know that a simple answer is because I have set the auto increment on for the primary key of my table. But I want to know is there any way that I can insert the two new entries starting from the last Number_pk without changing the design of my table?</p>\n\n<p>And how the <strong><em>SQL Server manage this record since I have deleted the rows from the database??</em></strong></p>\n"},{"tags":["sql-server","visual-studio-2012","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13274573,"title":"Entity Framework 5 SaveChanges does not save data to all related tables","body":"<p>I am updating an Entity Framerwork 4.1 / MVC 3 to Entity Framework 5.0 / MVC 4 using Visual Studio 2012. The database is SQL Server 2005. Below is an image of the database tables and their relationships. Each table has a primary key. The primary keys in the auxillary tables are Identity. Tables are related by FormId. </p>\n\n<p><img src=\"http://i.stack.imgur.com/kX9QH.png\" alt=\"Database Tables\"></p>\n\n<p>When I <strong>Update from Database</strong>, EF imports the tables and their relationships.</p>\n\n<p>Using EF 4.1 I was able to write the following code that successfully saved (inserted) in all four tables with one SaveChanges() call. I created a new GUID programmatically and added nsForm to the other three tables. When SaveChanges() was executed, EF 4 saved NSForm first and applied the FormId to the other three tables automatically as it saved each of them.</p>\n\n<pre><code>        DateTime currentDateTime = DateTime.Now;\n        Guid formGuid = System.Guid.NewGuid();\n        bool success = false;\n\n            using (var context = new NSAFormsEntities())\n            {\n                NSAFormsEDM.NSForm nsForm = new NSAFormsEDM.NSForm();\n                SpeakerphoneForm speakerphoneForm = new SpeakerphoneForm();\n                NSAFormsEDM.Requestor requestor = new NSAFormsEDM.Requestor();\n                NSAFormsEDM.Authorizer authorizer = new NSAFormsEDM.Authorizer();\n\n                nsForm.FormGuid = formGuid;\n                nsForm.Form = \"Speakerphone\";\n                nsForm.CreateDate = currentDateTime;\n                nsForm.ModifiedBy = currentUser;\n\n                #region Speakerphone\n                speakerphoneForm.FormGuid = formGuid;\n                speakerphoneForm.ServiceDate = speakerphoneVM.ServiceDate;\n                speakerphoneForm.LocationId = speakerphoneVM.LocationId;\n                speakerphoneForm.CreateDate = currentDateTime;\n                speakerphoneForm.CreatedBy = currentUser;\n                speakerphoneForm.NSForm = nsForm;\n                #endregion\n\n                #region Requestor\n                requestor.FormGuid = formGuid;\n                requestor.NetworkId = currentUser;\n                requestor.CreateDate = currentDateTime;\n                requestor.CreatedBy = currentUser;\n                requestor.NSForm = nsForm;\n                #endregion\n\n                #region Authorizer\n                authorizer.FormGuid = formGuid;\n                authorizer.NetworkId = authorizerVM.NetworkId;\n                authorizer.CreateDate = currentDateTime;\n                authorizer.CreatedBy = currentUser;\n                authorizer.NSForm = nsForm;\n                #endregion\n\n                context.NSForms.Add(nsForm);\n                context.SaveChanges();\n                success = true;\n            }\n</code></pre>\n\n<p>Now, using EF 5.0 only data in NSForm is inserted. Apparantly, EF 5 no longer propogates the FormId key, as expressed in the table relationships, to the three auxillary tables</p>\n\n<p>Questions: How should code using EF 5 be written in order to insert data into all of the tables with one SaveChanges() call?</p>\n\n<p>Thanks,</p>\n\n<p>Arnold</p>\n"},{"tags":["sql","sql-server","query","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13274256,"title":"Swapping rows and columns in a \"Group by\" query","body":"<p>I currently have the following: </p>\n\n<pre><code>SELECT status,count(status) AS count\n  FROM [DB].[dbo].[contact]\n  GROUP BY status\n</code></pre>\n\n<p>Which gives me the following: </p>\n\n<pre><code>Status 1   |   12\nStatus 2   |   23\nStatus 3   |   63\n</code></pre>\n\n<p>I'm trying to get the table to look like this: </p>\n\n<pre><code>Status 1   Status 2   Status 3  \n   12        23         63\n</code></pre>\n\n<p>Eventually the table will look like this: </p>\n\n<pre><code>                 Status 1   Status 2   Status 3  \nDate Range 1        12        23         63\nDate Range 2        23        2           3       \n</code></pre>\n\n<p>I'm just not sure what to do now.  What kind of SQL commands / syntax should I study to get this done?  This is my first time looking at SQL so any pointers would be awesome.  </p>\n"},{"tags":["sql","sql-server","vbscript","connection-string","adodb"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":1,"question_id":13089112,"title":"Unable to use vbscript to connect to sql server on diffrenet domain","body":"<p>I'm using vbscript to try to connect to a sql server on another domain. The server is part of a cluster and is SQL Server Data Center Edition (64bit). I can ping the server from my machine. I'm using the IP address to connect which works fine on SSMS.\nThe vbscript code I'm using is:</p>\n\n<pre><code>Set cn = CreateObject(\"ADODB.Connection\")\ncn.Open \"DRIVER={SQL Server};Server=123.456.345.567\\instance;Database=MyDB;User\nID=domain\\myuserid;Password=mypass;\"\nstrCommandText = \"Select * from mytable\"\ncn.Execute strCommandText\n</code></pre>\n\n<p>When I run this, I get the following error: \nMicrosoft OLE DB Provider for\nODBC Drivers: [Microsoft][ODBC SQL Server Driver][SQL Server]Login failed for user 'domain\\myuserid'.</p>\n\n<p>I can't join my test machine to the domain and I can't use sql authentication as it's disabled on the sql server.</p>\n\n<p>What do I need to do to get this to work?</p>\n"},{"tags":["c#","sql-server","crystal-reports"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13274399,"title":"CrystalDecisions.CrystalReports.Engine.ReportDocument' threw an exception","body":"<p>Once my crystal report sap 2010 was corrupted and re installed my crystal report software but nothing changed after that i followed the instruction on this link </p>\n\n<pre><code>http://social.msdn.microsoft.com/Forums/en-US/vscrystalreports/thread     /c0a40e76-7bd9-4113-85a7-190873318c07/\n</code></pre>\n\n<p>and after installing crystal report software i re installed my software and the things start working again. Now i am facing same error again </p>\n\n<pre><code>CrystalDecisions.CrystalReports.Engine.ReportDocument' threw an exception\n</code></pre>\n\n<p>But the above is not a permenant solution, Please Help.</p>\n"},{"tags":["c#","sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":49,"score":0,"question_id":13273333,"title":"Compare two Tables SQLSE","body":"<p>I want to know if that possible to compare two columns in two different tables in one database using C# with SQLSE.  if the two table has the same data in order, i can say the two tables are match; otherwise, there is no match.</p>\n\n<p>// More info </p>\n\n<p>I want to compare two column has repeated value the two column vlaues come from actual combination of visits for two patients and i want to check do they visit the hospital on the same date and rational insted to go for every 5 combination and compare the match i want to compare the whole table</p>\n"},{"tags":["php","sql-server","stored-procedures","parameters"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":11,"score":1,"question_id":13274261,"title":"php sqlsrv_query stored procedure with naming parameters","body":"<p>Im using php 5.4 with sqlsrv extension and I'm trying to call this sample stored procedure (NorthWind database):</p>\n\n<pre><code>create  PROCEDURE [dbo].[GetCategories] \n@CategoryID int = null\nAS\nSELECT * from dbo.Categories where CategoryID= IsNull(@CategoryID,CategoryID)\n</code></pre>\n\n<p>And I'm using this sqlsrv_query syntax:</p>\n\n<pre><code>$sql = \"{ call dbo.GetCategories (?)}\";\n$catID=2;\n$params = array($catID);\n$stmt = sqlsrv_query( $conn, $sql,$params);\n</code></pre>\n\n<p>I want to specify parameter name and value in $params, just like this:</p>\n\n<pre><code>$sql = \"dbo.GetCategories\";\n$catID=2;\n$params = array(\"@CategoryID\"=&gt;$catID);\n$stmt = sqlsrv_query( $conn, $sql,$params);\n</code></pre>\n\n<p>It return this error: String keys are not allowed in parameters arrays.</p>\n\n<p>How can i solve this problem?\nThanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13273885,"title":"How do I fetch only records created in the past year from a table within SSIS package?","body":"<p>I have a column <strong>CT_DT</strong> in a  table. I have to process only transactions created within the past <code>365 days</code>.</p>\n\n<p>For example, suppose the current date is <strong>Nov 7, 2012</strong>, I have to process only those transaction that were created since <strong>Nov 7, 2011</strong>. I am using conditional filter within the SSIS package.</p>\n"},{"tags":["sql-server","sqlite","auto-increment"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":15,"score":2,"question_id":13273403,"title":"Is there a set identity_insert on equivalent for SQLite?","body":"<p>In TSQL there is </p>\n\n<pre><code>SET IDENTITY_INSERT ON;\n</code></pre>\n\n<p>is there a functional equivalent in SQLite?</p>\n"},{"tags":["sql","sql-server","sql-server-2008-r2","common-table-expression"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":13271764,"title":"Split rows in table using CTE","body":"<p>I have the following rows from a table in SQL Server 2008 R2</p>\n\n<pre><code>+-------------------------------------------+\n|  ID          EntryType dt         price   |\n+-------------------------------------------+\n| 14          4         2012-11-07 0.025000 |\n| 16          5         2012-11-07 0.026000 |\n| 18          6         2012-11-07 0.026000 |\n| 20          7         2012-11-07 0.026000 |\n+-------------------------------------------+\n</code></pre>\n\n<p>What I would like to do is spread the rows based on the EntryType (the EntryType doesn't change)</p>\n\n<pre><code>For EntryType = 4 (1 row)\nFor EntryType = 5 (2 row)\nFor EntryType = 6 (3 row)\nFor EntryType = 7 (9 row)\n</code></pre>\n\n<p>and the dt field will be incremented (in a Month interval), so the output looks like this:</p>\n\n<pre><code>+-----------+-----------+-------+\n| EntryType |    dt     | Price |\n+-----------+-----------+-------+\n|         4 | 11/7/2012 | 0.024 |\n|         5 | 12/7/2012 | 0.025 |\n|         5 | 1/7/2013  | 0.025 |\n|         6 | 2/7/2013  | 0.026 |\n|         6 | 3/7/2013  | 0.026 |\n|         6 | 4/7/2013  | 0.026 |\n|         7 | 5/7/2013  | 0.027 |\n|         7 | 6/7/2013  | 0.027 |\n|         7 | 7/7/2013  | 0.027 |\n|         7 | 8/7/2013  | 0.027 |\n|         7 | 9/7/2013  | 0.027 |\n|         7 | 10/7/2013 | 0.027 |\n|         7 | 11/7/2013 | 0.027 |\n|         7 | 12/7/2013 | 0.027 |\n|         7 | 1/7/2014  | 0.027 |\n+-----------+-----------+-------+\n</code></pre>\n\n<p>Is it possible to do that with CTE and SQL?</p>\n"},{"tags":["sql-server","sql-server-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13273317,"title":"How do I generate insert statements with Sql server 2012?","body":"<p>I have sql server 2012 express and just installed the latest version of ssms tools from <a href=\"http://www.ssmstoolspack.com/Download\" rel=\"nofollow\">http://www.ssmstoolspack.com/Download</a></p>\n\n<p>With sql server 2008 express and ssms tools I was able to right click on a table and see an ssms tools option that allowed me to generate insert statements for a table but now I don't see it? Anyone know how I can generate the insert statements for a table?</p>\n"},{"tags":["sql-server","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2809,"score":1,"question_id":1180568,"title":"How to resolve the error loading SSIS packages using 32-bit dtexec on a x64 machine?","body":"<p>I have Integration Services packages that need to work with Excel files (shudder) and also need to execute on x64. I have a handle on the whole SSIS x64 vs. 32-bit issue, so I am scheduling these problem-child packages using MS suggested technique of using SQL Agent job step type <code>Operating System</code> / <code>CMDExec</code>, with a command line string that explicitly calls the 32-bit dtexec. So far so good.</p>\n\n<p>Here's the issue: the packages still fail to load, and complain about failing to load not the Excel bits, but instead my handy Log Provider that logs to SQL Server. This is the error message, edited for object names:</p>\n\n<blockquote>\n  <p>Started:  2:33:01 PM<br>\n  Error: 2009-07-24 14:33:06.51<br>\n  Code: 0xC0010018<br>\n  Source:<br>\n  Description: </p>\n  \n  <p>Error loading value \"&lt;DTS:ConnectionManager xmlns:DTS=\"www.microsoft.com/SqlServer/Dts\"&gt;&lt;DTS:Property DTS:Name=\"DelayValidation\"&gt;0&lt;/DTS:Property&gt;&lt;DTS:Property DTS:Name=\"ObjectName\"&gt;My_LogCon&lt;/DTS:Property&gt;&lt;DTS:Property DTS:Name=\"DTSID\"&gt;{86320FE6-AEFD-4A58-9277-84685B9B9\" from node \"DTS:ConnectionManager\".<br>\n  End Error  Could not load package \"c:\\folder\\mypkg.dtsx\" because of error 0xC0010014.<br>\n  Description: The package failed to load due to error 0xC0010014 \"One or more error occurred. There should be more specific errors preceding this one that explains the details of the errors. This message is used as a return value from functions that encounter errors.\". This occurs when CPackage::LoadFromXML fails.  ...  Process Exit Code 5.  The step failed.</p>\n</blockquote>\n\n<p>The packages run perfectly in 32-bit Visual Studio/debug. Anyone seen this type of thing?</p>\n"},{"tags":["c#",".net","sql-server","stream"],"answer_count":4,"favorite_count":38,"up_vote_count":123,"down_vote_count":0,"view_count":106938,"score":123,"question_id":411592,"title":"How do I save a stream to a file?","body":"<p>I have a <code>StreamReader</code> object that I initialized with a stream, now I want to save this stream to disk (the stream may be a <code>.gif</code> or <code>.jpg</code> or <code>.pdf</code>).</p>\n\n<p>Existing Code:</p>\n\n<pre><code>StreamReader sr = new StreamReader(myOtherObject.InputStream);\n</code></pre>\n\n<ol>\n<li>I need to save this to disk (I have the filename).</li>\n<li>In the future I may want to store this to SQL Server.</li>\n</ol>\n\n<p>I have the encoding type also, which I will need if I store it to SQL Server, correct?</p>\n"},{"tags":["mysql","sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13273045,"title":"Converting mySQL select to SQL select","body":"<p>I have this mySQL select statement that works just as I need it to;</p>\n\n<pre><code>SELECT `requires`, `level` FROM `fp` WHERE `model` = '\".$model.\"' GROUP BY `level` ORDER BY `menu_order`\n</code></pre>\n\n<p>In the table both <em>requires</em> and <em>level</em> are char fields. When sorted by *menu_order* the first row of each value of <em>level</em> will always be the value of <em>requires</em> that I want to retrieve.</p>\n\n<p>For the SQL version I use;</p>\n\n<pre><code>SELECT requires, level FROM fp WHERE model = '\" &amp; model &amp; \"' GROUP BY level ORDER BY menu_order\n</code></pre>\n\n<p>Now when I try to run this same query on SQL I get;</p>\n\n<p>requires'_is_invalid_in_the_select_list_because_it_is_not_contained_in_either_an_aggregate_function_or_the_GROUP_BY_clause</p>\n\n<p>I found many examples of this error but all seem to be way more complicated than what I'm trying to do. Maybe I've been using mySQL for so long that my brain is stuck in that way of thinking.</p>\n\n<p>How should that select statement be written in SQL?</p>\n"},{"tags":["c#","sql-server","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2113,"score":1,"question_id":6824188,"title":"SqlDataSourceEnumerator.Instance.GetDataSources() does not locate local SQL server 2008 instance","body":"<p>I use the following code to list all the remote and local SQL Server instances:</p>\n\n<pre><code>public static void LocateSqlInstances()\n  {\n     using( DataTable sqlSources = SqlDataSourceEnumerator.Instance.GetDataSources())\n     {\n        foreach(DataRow source in sqlSources.Rows )\n        {\n           string instanceName = source[\"InstanceName\"].ToString();\n\n           if (!string.IsNullOrEmpty(instanceName))\n           {\n              Console.WriteLine(\" Server Name:{0}\", source[\"ServerName\"]);\n              Console.WriteLine(\"   Instance Name:{0}\", source[\"InstanceName\"]);\n              Console.WriteLine(\"   Version:{0}\", source[\"Version\"]);\n              Console.WriteLine();\n           }\n        }\n        Console.ReadKey();\n     }\n  }\n</code></pre>\n\n<p>running the code on my local machine. The code can find and list a SQL server express instance (version 9.0.5000) installed but failed to list the other SQL server instance (version 10.0.1600).</p>\n\n<p>I've done a lot of research on the Internet and made sure that 1-the Sql Broswer is runing and 2 - the UDP port 1434 is open.</p>\n\n<p>Anybody knows why? Thanks.</p>\n"},{"tags":["sql-server","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13257186,"title":"Error Creating Stored Procedure in SQLServer","body":"<p>This is my stored procedure I am trying to create:</p>\n\n<pre><code>CREATE PROCEDURE [cih_owner].[UpdateDisplayOrder]\n    @CbpTableName varchar (21), \n    @CbpObjId int,\n    @CbpId int,\n    @DisplayOrder int\nAS\nBEGIN\n    IF (@CbpTableName = \"CbpActivity\")\n    BEGIN\n        UPDATE [cih_owner].[CbpActivity] SET DisplayOrder = @DisplayOrder WHERE Id = @CbpObjId AND CbpId = @CbpId\n        ;\n    END\nEND\nGO\n</code></pre>\n\n<p>However, in line that reads:\n<code>(@CbpTableName = \"CbpActivity\")</code>\nI get squigglies under \n<code>\"CbpActivity\"</code>\nwith the error\n<code>Invalid column name 'CbpActivity'</code></p>\n\n<p>All I am trying to do is compare a string that I sent to the stored procedure. </p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server","ado.net","visual-foxpro","vfp"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":11312142,"title":"using ADO.NET to select from multiple VFP tables","body":"<p>I need to select from 2 VFP free tables on some different network locations.</p>\n\n<p>I've managed to get both tables into a dataset as two DataTables and add a Relation for them.</p>\n\n<p>Now I need to join them and the result to insert into a SQL server database.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13210454,"title":"sql cte if statement","body":"<p>This might be a bad idea but just wondering?</p>\n\n<pre><code>;with Products\nAS\n(\n/* can you have an if statement in here? */\nselect * from products\n\n/* or */\n\nselect * from products \nwhere condition\n\n)\n</code></pre>\n\n<p>what i'm thinking is what if sometimes you have a search string or not. How do you make that a consideration in cte?</p>\n\n<p>Or maybe it would be a better idea to have 2 cte in one procedure?</p>\n"},{"tags":[".net","sql-server","linq-to-sql","stored-procedures","executequery"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":361,"score":4,"question_id":3284747,"title":"Is it possible to return multiple result sets using ExecuteQuery in Linq to Sql?","body":"<p>I know that you can return multiple results from a stored procedure and through the method generated by the designer.</p>\n\n<p>However, I'm trying to do the same using ExecuteQuery but it doesn't seem like it's possible.\nHas anyone tried or know whether this is possible?</p>\n\n<p>Basically I'm trying to run an ad-hoc stored procedure.  By ad-hoc, I mean a stored procedure that wasn't available during design-time.</p>\n"},{"tags":["sql-server","sql-server-2008","reporting-services","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13270332,"title":"Report Builder/SSRS and RDLs - HTML <img> support?","body":"<p>I'm completely new to SSRS so apologies if this is a silly question. I have an RDL with a HTML placeholder however if I pass an <code>&lt;img&gt;</code> tag in the dataset this does not render.</p>\n\n<p>I see on <a href=\"http://technet.microsoft.com/en-us/library/ff519562.aspx\" rel=\"nofollow\">this Technet</a> article that there is a list of supported tags, which unfortunately doesn't include <code>&lt;img&gt;</code>. I've been able to add an image with an external source based on an expression which uses a dataset field so it seems a little strange that you can't use images in HTML placeholders. Is there a workaround for this at all?</p>\n"},{"tags":["asp.net","sql-server","nopcommerce"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13251067,"title":"'SysUtcDateTime' error during nopCommerce install - ASP.NET","body":"<p>Having bought a copy of the shop made in nopCommerce (files and database) we are trying to implement it on our server. After copy, such mistake appears:</p>\n\n<blockquote>\n  <p><strong>SysUtcDateTime' is not a recognized built-in function name.</strong></p>\n  \n  <p>Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </p>\n  \n  <p>Exception Details: System.Data.SqlClient.SqlException: 'SysUtcDateTime' is not a recognized built-in function name.</p>\n  \n  <p><strong>Source Error:</strong> </p>\n  \n  <p>An unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.</p>\n</blockquote>\n\n<p>I found out <a href=\"http://www.nopcommerce.com/boards/t/6441/sql2005-sysutcdatetime-is-not-a-recognized-built-in-function-name.aspx#82244\" rel=\"nofollow\">here</a> that it might be connected with the wrong version of SQL server in Nop.BusinessLogic. So, after simple edit in Notepad++ I changed '2008' to '2005', but no effects : (</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13271685,"title":"SQL Login notification","body":"<p>I want to be notified of SQL Server logins that has a particular value for the <code>Application Name</code> property of the connection string. Can someone help me to get these type of notifications by email or by any other recommended method?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13255746,"title":"Can Execute Procedure But Job That Runs Procedure Errors?","body":"<p>I have a procedure that pulls data from my database and uses MSDB.DBO.sp_send_dbmail to send out e-mails.  The procedure itself runs without a hitch when I use 'EXEC myprocedure'.  But when I set up a job for the procedure, the job fails with the following error </p>\n\n<blockquote>\n  <p>'Error formating query, probably invalid parameters [SQLState\n  42000](Error 22050).  The step failed'</p>\n</blockquote>\n\n<p>There is one step in the job with the TSQL statement 'EXEC myprocedure', using the database that my procedure is stored on.  Does anyone know what could be causing this error?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I've narrowed the problem down. It's something with the Exchange server I use. I was using a domain address (ie. mail.mycompany.com) as the 'Server name' under Database Mail's account configuration wizard. I was unable to send e-mails to listservs and external users using this domain address. I talked to our Exchange guy and he recommended using the actual IP address of one of the mail servers (ie. 10.123.53.53). That fixed the problem with listservs and external users, but now I am unable to send e-mails when I run my procedure using a job (the procedure itself executes properly when I manually run it). Does anyone know what criteria on our Exchange server I will need to change to fix this? </p>\n"},{"tags":["sql-server","sql-agent-job"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":20,"score":-2,"question_id":13272088,"title":"How to stop a SQL Server 2005 job at a set time or elapsed time","body":"<p>I thought I'd share this since I had to come up with the answers mostly myself.  I hope this saves someone some time!</p>\n\n<p>There's no automatic mechanism to stop a SQL Server Agent job after a set period of time.  If you're executing a stored procedure, particularly one that uses looping, you can use this approach to build it in.</p>\n\n<p>Here's my proof-of-concept code you can use to reassure yourself and tinker with:</p>\n\n<pre><code>    DECLARE @beginTime datetime\n    DECLARE @endTime datetime\n\n    SET @beginTime = GETDATE()\n    SELECT @beginTime\n\n    SET @endTime = DATEADD(s, 10, @beginTime)\n    SELECT @endTime\n\n    WAITFOR DELAY '00:00:05'\n\n    IF GETDATE() &gt; @endTime\n    Begin\n        PRINT 'EXITING Block 1'\n        RETURN\n    End\n    ELSE\n    Begin\n        PRINT 'Continuing Block 1'\n    End\n\n    WAITFOR DELAY '00:00:06'\n\n    IF GETDATE() &gt; @endTime\n    Begin\n        PRINT 'EXITING Block 2'\n        RETURN\n    End\n    ELSE\n    Begin\n\n\nPRINT 'Continuing Block 2'\nEnd\n</code></pre>\n\n<p>Your results will come out as this, showing that after 5 seconds the comparison of @endTime to the current time (GETDATE), the full 10 seconds set with the DATEADD function have not yet elapsed yet (Block 1 continues) but after another 6 seconds the elapsed time has passed and the script exits with the return statement (Block 2 exits).</p>\n\n<pre><code>(1 row(s) affected)\n\n(1 row(s) affected)\nContinuing Block 1\nEXITING Block 2\n</code></pre>\n\n<p>And I adapted this to my real-world usage inside a WHILE block that purges rows from a table:</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[usp_PurgeX12BillingData] \nAS\nBEGIN\n    DECLARE @pDate datetime\n    DECLARE @minID int\n    DECLARE @maxID int\n\n    DECLARE @beginTime datetime\n    DECLARE @endTime datetime\n\n    SET @beginTime = GETDATE()\n    SET @endTime = DATEADD(hh, 5, @beginTime)\n\n    PRINT 'Set to run from ' + CONVERT(varchar(10), @beginTime, 108) + ' to ' + CONVERT(varchar(10), @endTime, 108)\n\n    SET @pDate = CONVERT(varchar(10), dateadd(mm, -72, getdate()), 101) \n\n    PRINT 'Purging data older than: ' + CONVERT(varchar(10), @pDate, 101)\n\n    SELECT @maxID = count(*) FROM bil_x12 WITH (NOLOCK)\n    WHERE transmission_date &lt; @pDate\n\n    PRINT 'Number of rows: ' + cast(@maxID AS nvarchar(32))\n\n    SELECT IDENTITY(INT,1,1) AS row_id, transmission_id --, transmission_date \n        INTO #oldX12billingRows \n    FROM BIL_X12\n    WHERE transmission_date &lt; @pDate\n\n    SET @minID = 0\n\n    PRINT 'Deleting from BIL_X12: Min PK = ' + cast(@minID AS nvarchar(32)) + ', Max PK = ' + cast(@maxID as nvarchar(32)) + \n            ', Total Rows = ' + cast((@maxID - @minID) AS nvarchar(32))\n\n    WHILE @minID &lt; @maxID\n    Begin\n        IF GETDATE() &gt; @endTime\n        Begin           \n            RETURN\n        End\n\n      SET @minID = @minID + 2000\n      IF @minID &gt; @maxID\n      Begin\n        SET @minID = @maxID\n      End\n      PRINT 'deleting pks less than ' + cast(@minID AS nvarchar(32))\n      Begin Transaction temptran1234\n        DELETE FROM BIL_X12 WHERE transmission_id IN (SELECT transmission_id FROM #oldX12billingRows WHERE row_id &lt;= @minID)\n      Commit Transaction temptran1234\n      WAITFOR DELAY '00:00:05'\n    End\n\n    DROP TABLE #oldX12billingRows\nEND\n</code></pre>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":79,"score":2,"question_id":13271400,"title":"Allowing * in SQL query","body":"<p>I have a stored procedure and I want to allow * in it so that if user:</p>\n\n<ul>\n<li>types t* then taller, tea returns</li>\n<li>types * or <em>.</em> then all results are returned</li>\n<li>types t then all results which have t are returned like ptv, tall, sit</li>\n</ul>\n\n<p>my stored procedure is this:</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[SearchEntityDataNew]\n    @SearchText varchar(100) = '*'\n\nAS\nBEGIN\n    SELECT 'Entity' as pagetype,EntityID,EntityData,EntityDataID \n    FROM EntityData \n    WHERE  EntityData LIKE '%' + @SearchText+ '%'\n    OR @SearchText = '*'\n\n    union all\n\n    SELECT 'Property' as pagetype,PropertyID,PropertyValue,EntityDataID  \n    FROM EntityDataProperty \n    WHERE  PropertyValue LIKE '%' + @SearchText+ '%'\n    OR @SearchText = '*'\nEND\n</code></pre>\n"},{"tags":["sql","sql-server","group-by"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13260441,"title":"SQL query group by nearby timestamp","body":"<p>I have a table with a timestamp column. I would like to be able to group by an identifier column (e.g. cusip), sum over another column (e.g. quantity), but only for rows that are within 30 seconds of each other, i.e. <strong>not</strong> in fixed 30 second bucket intervals. Given the data:</p>\n\n<pre>\n       cusip| quantity|    timestamp\n============|=========|=============\nBE0000310194|      100| 16:20:49.000\nBE0000314238|       50| 16:38:38.110\nBE0000314238|       50| 16:46:21.323\nBE0000314238|       50| 16:46:35.323\n</pre>\n\n<p>I would like to write a query that returns:</p>\n\n<pre>\n       cusip| quantity\n============|=========\nBE0000310194|      100\nBE0000314238|       50\nBE0000314238|      100\n</pre>\n\n<p>Edit:\nIn addition, it would greatly simplify things if I could also get the MIN(timestamp) out of the query.</p>\n"},{"tags":["sql-server","database","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":24,"score":-1,"question_id":13262025,"title":"Creating a trigger in SQL Server Management Studio 2012","body":"<p>Given the following question based on the database below.\na)  Create a trigger that will automatically update the quantity on hand each time that a product is sold as listed as a row in the LINE table. In other words, a line row is inserted as part of an invoice. Each line is linked to a product. Decrement the quantity on hand (P_QOH) by the number ordered.</p>\n\n<p><a href=\"http://i.stack.imgur.com/wWX17.png\" rel=\"nofollow\">http://i.stack.imgur.com/wWX17.png</a></p>\n"},{"tags":["sql-server","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13270467,"title":"How to connect to SQL Server 2000 database from Visual Studio 2012","body":"<p>I have a SQL Server 2000 database that I need to access from Visual Studio 2012. Needless to say the data provider for SQL Server requires SQL Server 2005 or above, and the data provider for OLE, which claims to support SQL Server 2000 or above, says \"SQL Server Native Client 11.0 does not support connections to SQL Server 2000 or earlier versions.\"</p>\n\n<p>Is there some kind of plug-in I can install that will let me access SQL Server 2000?</p>\n\n<p>Eventually my app will live ON the server itself. Is it going to need something special to access this older database?</p>\n"},{"tags":["php","sql-server","iis","windows-server-2003","php-extension"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":13,"score":2,"question_id":13271075,"title":"sqlsrv hangs in windows with php 5.4","body":"<p>I know this was asked alot of times but all the answers are outdated.</p>\n\n<p>As of PHP 5.3, as we all know mssql is <strong>not</strong> supported, so went on installing Microsoft's <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=20098\" rel=\"nofollow\">sqlsrv</a>\ndriver for this, as it seems to be the only option out there (I'm open to suggestions!).</p>\n\n<p>Now I'm using PHP 5.4 on a Windows server 2003, SQL Server 2005 with IIS as webserver.</p>\n\n<p>I've followed about a million guides and i've installed everything accordingly, but the driver just wont load, <code>sqlsrv</code> won't show on <code>phpinfo()</code> or it hangs.</p>\n\n<p>This is what i've done in php.ini :</p>\n\n<pre><code> extension=php_sqlsrv_54_nts.dll\n</code></pre>\n\n<p>And the <code>extension_dir</code> is set to <code>C:\\PHP\\ext</code>, though phpinfo() shows its loading a php.ini file from progrem files, so i'm editing 2 php.ini files every time as i'm not sure which one is active.\nFor the same reason i've put the dll files in both locations.</p>\n\n<p>There is no information for this problem!\nall the solutions are for people who have used the wrong versions, etc.</p>\n\n<p>I've tried applying every single dll and all with the same result, including Threaded and non-threaded.</p>\n\n<p>What can i do?</p>\n"},{"tags":["sql-server","intellisense","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13270186,"title":"SQL Server 2008 R2 intellisense doesn't work","body":"<p>The SQL Server 2008 R2 Management Studio intellisense stopped working a month ago though it is enabled. I read that this issue may be caused by the .NET framework 4.0 SP1 and tried some of the suggestions but nothing worked:</p>\n\n<ul>\n<li>I have installed the cumulative update package: <code>SQLServer2008R2_RTM_CU7_2507770_10_50_1777_x64</code></li>\n<li>I re-registered the <code>TextMgrP.dll</code></li>\n</ul>\n\n<p>Any other suggestions what can be done?</p>\n\n<p>The SSMS version is: Microsoft SQL Server Management Studio 10.50.1617.0</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13270462,"title":"Case when in variable declaration","body":"<p><img src=\"http://i.stack.imgur.com/jvpqC.jpg\" alt=\"enter image description here\"></p>\n\n<p>I'm looking for another column that will give the overall total counts from each gender next to the <code>eduCounts</code> column.  The rest of the query works fine.  Finding the distinct gender counts in this case has to be done by <code>select count(distinct patid) from...</code></p>\n\n<p>first try:</p>\n\n<pre><code>declare @sexcounts int\nset @sexcounts = case when members.sex 'm' then (select COUNT(distinct patid) from members where sex='m')\n                 when members.sex 'f' then (select COUNT(distinct patid) from members where sex='f')\n\nselect sex, edutext, COUNT(*) as eduCounts from \n(\nselect distinct m.patid, m.sex, e.eduText\n    from members as m\n    inner join claims as c on c.patid=m.PATID\n    inner join icdClm as ic on ic.clmid=c.clmid\n    inner join tblICD as t on t.ICD=ic.icd\n    inner join EducationTable as e on e.eduID=m.education\n    inner join IncomeTable as i on i.incomeID=m.income\n    where ISNUMERIC(ic.icd)=1 and SUBSTRING(ic.icd,1,3)='707'\n)t\ngroup by sex, eduText\norder by sex\n</code></pre>\n\n<p>second try:</p>\n\n<pre><code>declare @sexcounts int\nset @sexcounts = (select COUNT(distinct patid),case when sex 'm' then (select COUNT(distinct PATID) from members where sex='m') else (select COUNT(distinct patid) from members where sex='f') \n                    from members)\n\n    select sex, edutext, COUNT(*) as eduCounts from \n    (\n    select distinct m.patid, m.sex, e.eduText\n        from members as m\n        inner join claims as c on c.patid=m.PATID\n        inner join icdClm as ic on ic.clmid=c.clmid\n        inner join tblICD as t on t.ICD=ic.icd\n        inner join EducationTable as e on e.eduID=m.education\n        inner join IncomeTable as i on i.incomeID=m.income\n        where ISNUMERIC(ic.icd)=1 and SUBSTRING(ic.icd,1,3)='707'\n    )t\n    group by sex, eduText\n    order by sex\n</code></pre>\n\n<p>I know I could make a derived table and join on the sex column, but I'd like to know how to do it with a variable if at all possible.</p>\n"}]}
{"total":54451,"page":3,"pagesize":100,"questions":[{"tags":["sql-server","sql-server-2005","security"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1321,"score":2,"question_id":5166641,"title":"SQL Server Foreign Keys across database boundaries - techniques for enforcement","body":"<p>I have two separate SQL Server 2005 databases (on the same server) </p>\n\n<ul>\n<li>security database  </li>\n<li><p>main application database</p></li>\n<li><p>The security database has a  <strong>user table</strong> with everything needed to authenticate.  - </p></li>\n<li>The application database has a <strong>person table</strong> with extended user details. There is a 1-1 mapping between the security database user table and the application database person table.</li>\n</ul>\n\n<p>I want to enforce a mapping between the user and the person table. I'm assuming that foreign keys can't be mapped across databases thus I am wondering what to do to enforce the integrity of the relationship.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13267862,"title":"Where I can check user-define table type in SQL Server 2008 in SSMS? and how can I insert new column into it?","body":"<p>I need to add some more columns into my current <code>user-define table type in SQL Server 2008</code></p>\n\n<p>But I didn't see any table type in particular database under <code>Tables</code> .</p>\n\n<p>Where exactly I need to check and how can I modify the design of existing <code>user-define table type in SQL Server 2008</code></p>\n\n<p>I'm using <code>SQL SERVER 2008</code> and <code>SSMS</code></p>\n\n<p>Where I can find that table in <code>SSMS</code> , </p>\n\n<p>so that I can go and modify table type.</p>\n\n<p>thanks</p>\n\n<p>for previous question answer </p>\n\n<p>Please can any one help to sql <code>alter type table</code> syntax <code>add column</code> ?\nhow can I insert any new column ... as ALTER is not working.. it is disable </p>\n"},{"tags":["sql","sql-server","query","datepart"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13270325,"title":"Using DATEPART for AM works correctly but does not work for PM query","body":"<p>I'm using a query to pull a report for our 3rd shift folks.  </p>\n\n<p>The issue I just noticed when the report was mailed with 0 results is that I have it set right now to run from 6pm to 5:59am the next morning.  Since I have the date field = the <code>GETDATE</code>, it doesn't see the results from the night prior(1800-2359).  I was thinking of having this just pull from like -12 hours, but the button can be pressed at anytime to look at results.  </p>\n\n<p>So if they pushed it before the end of the shift, it would show some of 1st shifts entries.  I want it to only run from 1800-0559 the next morning, no matter if the button is pressed before midnight or after midnight.  I hope this makes sense.  I'm not even sure if the between recognizes to go to 00 after it's hit 2359.  I have this built into a VB.net application, and they can press the button anytime they want to get results.  This is for management to track what is being done as the employees are required to enter data real time when issues are taking place.  </p>\n\n<p>Thanks for any help.  Hope I made enough sense!  :D</p>\n\n<pre><code>SELECT \n   Assignment, Datemodified, General, \n   IncNumber, NextSteps, PDCRStatus, \n   RootCause, Status, Summary, \n   Timings, UserID \nFROM \n   Turnover \nWHERE DATEPART(HOUR, datemodified) between 18 and 05 \nAND CONVERT(NVARCHAR(50),datemodified,103) = CONVERT(NVARCHAR(50),GETDATE(),103);\n</code></pre>\n"},{"tags":["asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":33,"score":-1,"question_id":13266959,"title":"Login to authenticated users","body":"<p>I have a 2 textbox for username and password and a button. I want to allow authenticated users to login and redirect to another page and display welcome authenticated username.Or else display the message Invalid username.How to perform this using session and connect to database.How to configure with database. Please help me.</p>\n\n<pre><code>My code is\n</code></pre>\n\n<p></p>\n\n<pre><code>        &lt;div id=\"loginbox\"&gt;\n            &lt;div align=\"center\" style=\"width: 100%;\"&gt;\n\n\n            &lt;/div&gt;--%&gt;\n            &lt;br /&gt;\n\n                        &lt;label for=\"username\"&gt;Username:&lt;/label&gt; &lt;input type=\"text\"   \nid=\"username\" /&gt;&lt;/li&gt;\n   &lt;label for=\"password\"&gt;Password:&lt;/label&gt; &lt;input type=\"password\" id=\"password\" /&gt;\n\n&lt;input type=\"button\" runat=\"server\" value=\"Login\"&gt;\n\n\n&lt;/form&gt;\n\nMy .cs code\n\nprotected void btnLogin_onclick(object sender, EventArgs e)\n{\n    string connect = \"Data Source=ST0022;Initial Catalog=QuickMove_Globe;Persist   \nSecurity Info=True;User ID=sa;Password=good\";\n    string query = \"Select Count(*) From Common.Users Where UserID = ? And Password =   \n?\";\n    int result = 0;\n    SqlConnection con= new SqlConnection(connect);\n        SqlCommand cmd = new SqlCommand(query, con);\n\n            cmd.Parameters.AddWithValue(\"UserID\",username.Value);\n            cmd.Parameters.AddWithValue(\"Password\", password.Value);\n            con.Open();\n            Session[\"User\"] = username.Value;\n            result = (int)cmd.ExecuteScalar();\n\n    if (result &gt; 0)\n    {\n        Response.Redirect(\"TestPortalPage.aspx\");\n    }\n    else\n    {\n        lbluser.Text = \"Invalid credentials\";\n    }\n\n\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":33,"score":0,"question_id":13269545,"title":"SQL View creation error","body":"<p>I am trying to copy a view from one database to another and get the error :</p>\n\n<blockquote>\n  <p>Msg 4121, Level 16, State 1, Procedure vwPAProjects_Summary_New_2 \n  Line 2<br>\n  <em>Cannot find either column \"dbo\" or the user-defined function or\n  aggregate \"dbo.GetContractName\", or the name is ambiguous</em></p>\n</blockquote>\n\n<p>The view I am copying over is:</p>\n\n<pre><code>USE [GRAUD]\nGO\n/****** Object:  View [dbo].[vwPAProjects_Summary_New_2]    Script Date: 11/07/2012 11:57:30 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE VIEW [dbo].[vwPAProjects_Summary_New_2] AS \nselect\n dbo.GetContractName(PAPROJNUMBER) 'CONTRACT',\nPACONTNUMBER,\nisnull(dbo.GetEmployeeName(PABusMgrID),dbo.GetContractPartner(PACONTNUMBER)) 'Project Manager ID',\ncase PASTAT\nwhen 1 then 'Open'\nelse 'Closed'\nend 'Status',\ncase PAProjectType\nwhen 3 then 'Fixed Price'\nelse 'Time and Materials'\nend 'Project Type',\nPAProject_Fee_Amount 'Project Fee Amount',\nPAFTotalCost 'Forecast Total Cost',\n(PAProject_Fee_Amount - PAFTotalCost) 'Forcast Profit',\ncase\n    when PAProject_Fee_Amount = 0 then '0.00%'\n    else cast(cast(((PAProject_Fee_Amount - PAFTotalCost)/PAProject_Fee_Amount)*100 as decimal(19,2)) as varchar(21)) + '%'\nend 'Forcast %',\nPAPostedBillingsN 'Actual Billings',\nPAPostedTotalCostN 'Actual Total Cost',\n(PAPostedBillingsN - PAPostedTotalCostN) 'Current Actual Profit',\ncase\n    when PAPostedBillingsN = 0 then '0.00%'\n    else cast(cast(((PAPostedBillingsN - PAPostedTotalCostN)/PAPostedBillingsN)*100 as decimal(19,2)) as varchar(21)) + '%'\nend 'Current %'\n\nfrom PA01201\nwhere PASTAT = 1\n</code></pre>\n\n<p>Can anybody advise on how I can get this to copy over?  It has worked on other databases after I have copied it over but I cannot see any differences that would stop it this time?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13269787,"title":"SQL Server backup failing. Error: 3041, Severity: 16, State: 1","body":"<p>First of all, I'm very new at stackoverflow, so please bear with me.</p>\n\n<p>I'm running a SQL Server 9.0.4060.</p>\n\n<p>My problem is: my SQL Server backup keeps failing on a lot of the databases.</p>\n\n<p>The Maintenance plan runs to different backup jobs:</p>\n\n<p>DIFF backup everyday at 20:30 and FULL backup every Sunday at 20:30.</p>\n\n<p>I get these two errors foreach database that fails to complete the backup:</p>\n\n<pre><code>Date        06-11-2012 20:31:06\nLog     SQL Server (Current - 07-11-2012 11:43:00)\nSource      Backup\nMessage\nBACKUP failed to complete the command BACKUP DATABASE (dbname) WITH DIFFERENTIAL. Check the backup application log for detailed messages.\n\nDate        06-11-2012 20:31:06\nLog     SQL Server (Current - 07-11-2012 11:43:00)\nSource      Backup\nMessage\nError: 3041, Severity: 16, State: 1.\n</code></pre>\n\n<p>If you guys need any other information, just say the word.</p>\n"},{"tags":["sql-server","delete","foreign-keys","constraints"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13269900,"title":"ON DELETE NO ACTION constraint in SQL Server database","body":"<p>What I want to do is when I delete a row from the parent table to keep the data in the child table. </p>\n\n<p>Meaning that if I have a table department, which is the parent table with two columns - <code>depNo</code> and <code>depName</code>, and a child table with three columns - <code>emNo</code>, <code>emName</code> and <code>depNo (FK)</code>.</p>\n\n<p>I want to be able to delete the row in the parent table, but to keep the one in the child table (in my case it is connected with licenses and is a good idea to keep track of it, even if the user  is already deleted).</p>\n\n<p>I guess <code>ON DELETE NO ACTION</code> won't work, because it will give me an error if I try to delete the row in the parent table. </p>\n\n<p><code>CASCADE</code> and <code>SET NULL</code> are not good in this case. </p>\n\n<p><code>SET Default</code> - it won't work because I can't make a default value - it could be different (and its 100% sure it will be).</p>\n\n<p>Any ideas how to make it ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13269586,"title":"SQL adding additional columns to a query","body":"<p>I'm trying to create a query that allows me to see all of the customers orders and to add an additional column using sql to view the total amount that the customer owes.</p>\n\n<p>the following code retrieves the correct data:</p>\n\n<pre><code>SELECT\n    cu.FName + '  ' + cu.SName as 'Name', \n    cu.Address1 + ', ' + cu.Address2 + ', ' + cu.Address3 as 'Dispatch Address', \n    cu.PostCode, \n    co.DateOrdered, co.DateDispatched, \n    ma.MaterialName, \n    it.Quantity, \n    ma.Price as 'Total' \nFROM\n    Customers cu \nLEFT JOIN \n    CustomerOrder co ON co.CustomerID = cu.CustomerID \nLEFT JOIN\n    ItemOrder it ON it.OrderID = co.OrderID \nLEFT JOIN \n    Materials ma ON ma.MaterialID = it.MaterialID \n</code></pre>\n\n<p>I now need to add additional code to the above to add a column to show the total amount the customer owes, but I'm stuck, can anybody help?</p>\n\n<pre><code>Date Order   |    Dispatch Date | Item  | QTY  |   Price | TOTAL AMOUNT FOR BOTH ROWS\n2012-10-30   |    2012-11-25    | Bath  | 1    |   49.99 |  \n2012-10-30   |    2012-11-25    | Sink  | 1    |   55.99 |\n</code></pre>\n"},{"tags":["sql-server","hadoop"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13251994,"title":"Access SQL Server in Hadoop","body":"<p>What I want to do:\n  The program is designed to load regional sales data from SQL Server 2008 and run simple statistics computation on MapReduce to get total sales in each regions. The erro I got says the program can't find the sqljdbc4.jar file, however,  the file did had copied into the location specified in code.</p>\n\n<ol>\n<li><p>So the code likes: </p>\n\n<pre><code>//fileName: MRExp.java\npublic class MRExp {\n    public static void main(String[] args) throws IOException {\n        JobConf conf = new JobConf(MRExp.class);\n        DistributedCache.addFileToClassPath(new Path(\"/userX/sqljdbc4.jar\"), conf);\n\n        conf.setMapperClass(MRMapper.class);\n        conf.setReducerClass(MRReducer.class);\n\n        conf.setMapOutputKeyClass(Text.class);\n        conf.setMapOutputValueClass(LongWritable.class);\n\n        conf.setOutputKeyClass(LongWritable.class);\n        conf.setOutputValueClass(Text.class);\n\n        conf.setInputFormat(DBInputFormat.class);\n        FileOutputFormat.setOutputPath(conf, new Path(args[0]));\n\n        DBConfiguration\n                .configureDB(\n                        conf,\n                        \"com.microsoft.sqlserver.jdbc.SQLServerDriver\",\n                        \"jdbc:sqlserver://MyDbServerAddr:1433;databaseName=ThisDb;integratedSecurity=true;\",\n                        \"db_userName\", \"db_Pws\");\n\n        DBInputFormat\n                .setInput(conf, InfoUnit.class,\n                        \"SELECT R_NAME,L_ORDERKEY from dbo.United10MB ;\"/* inputQuery */\n                        , \"SELECT COUNT(L_ORDERKEY) from dbo.United10MB\"/* inputCountQuery */);\n\n        try {\n            JobClient.runJob(conf);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>\n\n<p>//followed by the definition of MRMapper and MRReducer and InfoUnit. InfoUnit implements Writable, DBWritable. </p></li>\n<li><p>Files Location:</p>\n\n<p>[root@test MRExp]# pwd<br>\n/root/MRExp<br>\n[root@test MRExp]# ls<br>\nclasses  hadoop-0.20.2-core.jar  MRExp.java  sqljdbc4.jar</p></li>\n<li><p>Then, for compiling MRExp.java:</p>\n\n<p>[root@test MRExp]#  javac -classpath hadoop-0.20.2-core.jar -d classes/ MRExp.java<br>\n[root@test MRExp]#  jar -cvf MRExp.jar -C classes/ .  </p></li>\n</ol>\n\n<p>but also copying sqljdbc4.jar to HDFS:</p>\n\n<pre><code>[root@test MRExp]#  hadoop dfs -copyFromLocal sqljdbc4.jar /userX  \n</code></pre>\n\n<p>so we get:</p>\n\n<pre><code>[root@test MRExp]# ls  \nclasses  hadoop-0.20.2-core.jar  MRExp.jar  MRExp.java  sqljdbc4.jar  \n</code></pre>\n\n<ol>\n<li><p>After the above, fire the MapR Process:</p>\n\n<p>[root@test MRExp]#  hadoop jar MRExp.jar mrexp.MRExp /userX/output  </p></li>\n</ol>\n\n<p>But the program says: </p>\n\n<pre><code>17:02:50 WARN mapreduce.JobSubmitter: Use GenericOptionsParser for parsing the arguments. Applications should implement Tool for the same.\n12/10/28 17:02:50 INFO mapreduce.JobSubmitter: Cleaning up the staging area /tmp/hadoop-yarn/staging/root/.staging/job_1350984913454_0009\njava.lang.RuntimeException: java.lang.RuntimeException: java.lang.ClassNotFoundException: com.microsoft.sqlserver.jdbc.SQLServerDriver\n        at org.apache.hadoop.mapreduce.lib.db.DBInputFormat.setConf(DBInputFormat.java:165)\n        at org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:70)\n        at org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:130)\n        at org.apache.hadoop.mapred.JobConf.getInputFormat(JobConf.java:607)\n        at org.apache.hadoop.mapreduce.JobSubmitter.writeOldSplits(JobSubmitter.java:476)\n        at org.apache.hadoop.mapreduce.JobSubmitter.writeSplits(JobSubmitter.java:468)\n        at org.apache.hadoop.mapreduce.JobSubmitter.submitJobInternal(JobSubmitter.java:359)\n        at org.apache.hadoop.mapreduce.Job$11.run(Job.java:1226)\n        at org.apache.hadoop.mapreduce.Job$11.run(Job.java:1223)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:396)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1232)\n        at org.apache.hadoop.mapreduce.Job.submit(Job.java:1223)\n        at org.apache.hadoop.mapred.JobClient$1.run(JobClient.java:609)\n        at org.apache.hadoop.mapred.JobClient$1.run(JobClient.java:604)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:396)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1232)\n        at org.apache.hadoop.mapred.JobClient.submitJob(JobClient.java:604)\n        at org.apache.hadoop.mapred.JobClient.runJob(JobClient.java:880)\n        at mrexp.MRExp.main(MRExp.java:70)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.hadoop.util.RunJar.main(RunJar.java:208)\nCaused by: java.lang.RuntimeException: java.lang.ClassNotFoundException: com.microsoft.sqlserver.jdbc.SQLServerDriver\n        at org.apache.hadoop.mapreduce.lib.db.DBInputFormat.getConnection(DBInputFormat.java:191)\n        at org.apache.hadoop.mapreduce.lib.db.DBInputFormat.setConf(DBInputFormat.java:159)\n        ... 25 more\nCaused by: java.lang.ClassNotFoundException: com.microsoft.sqlserver.jdbc.SQLServerDriver\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:202)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:190)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:306)\n        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:247)\n        at java.lang.Class.forName0(Native Method)\n        at java.lang.Class.forName(Class.java:169)\n        at org.apache.hadoop.mapreduce.lib.db.DBConfiguration.getConnection(DBConfiguration.java:148)\n        at org.apache.hadoop.mapreduce.lib.db.DBInputFormat.getConnection(DBInputFormat.java:185)\n        ... 26 more\n</code></pre>\n"},{"tags":["java","sql-server","jdbc","ioerror"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13267764,"title":"I/O Error: SSO Failed: Native SSPI library not loaded","body":"<p>Trying to run the following bit of code:</p>\n\n<pre><code>import java.sql.DriverManager;\npublic class Connect {\npublic static void main(String[] args){\n    try{\n        String databaseDriver = \"net.sourceforge.jtds.jdbc.Driver\";\n        Class.forName(databaseDriver);\n    }\n    catch (Exception e) {\n        e.printStackTrace();\n    }\n\n    try{\n        String url = \"jdbc:jtds:sqlserver://BHX:1433/Forecast;instance=SQLEPXRESS\";\n        java.sql.Connection con = DriverManager.getConnection(url);\n        System.out.println(\"Connection\");\n    }\n    catch (Exception e){\n        e.printStackTrace();\n    }\n  }\n}\n</code></pre>\n\n<p>My SQLServer is running on port 1433 on machine BHX.</p>\n\n<p>The error message I'm getting is as follows:</p>\n\n<pre><code>java.sql.SQLException: I/O Error: SSO Failed: Native SSPI library not loaded. Check the     java.library.path system property.\nat net.sourceforge.jtds.jdbc.TdsCore.login(TdsCore.java:615)\nat net.sourceforge.jtds.jdbc.ConnectionJDBC2.&lt;init&gt;(ConnectionJDBC2.java:352)\nat net.sourceforge.jtds.jdbc.ConnectionJDBC3.&lt;init&gt;(ConnectionJDBC3.java:50)\nat net.sourceforge.jtds.jdbc.Driver.connect(Driver.java:185)\nat java.sql.DriverManager.getConnection(Unknown Source)\nat java.sql.DriverManager.getConnection(Unknown Source)\nat Connect.main(Connect.java:14)\nCaused by: java.io.IOException: SSO Failed: Native SSPI library not loaded. Check the java.library.path system property.\nat net.sourceforge.jtds.jdbc.TdsCore.sendMSLoginPkt(TdsCore.java:1893)\nat net.sourceforge.jtds.jdbc.TdsCore.login(TdsCore.java:588)\n... 6 more\n</code></pre>\n\n<p>I've read up on why this usually occurs and found a similar question <a href=\"http://stackoverflow.com/questions/4219968/java-sql-sqlexception-i-o-error-sso-failed-native-sspi-library\">here</a>, but this doesn't seem to work. When running the code I've inlcuded the following argument to locate the SSO file:</p>\n\n<pre><code>-Djava.library.path=/Tester/jdbc/x64/SSO\n</code></pre>\n\n<p>And this is the structure of my files</p>\n\n<pre><code>**Tester**\n   *src*\n     default package \n         Connect.java\n   *JRE System Library*\n   *jdbc*\n     conf\n     html\n     IA64\n     x64\n       SSO\n        ntlmauth.dll\n     x86\n</code></pre>\n\n<p>Can you spot anything wrong?\nThanks.</p>\n"},{"tags":["sql-server","sql-server-2008","code-reuse"],"answer_count":3,"favorite_count":3,"up_vote_count":17,"down_vote_count":0,"view_count":9764,"score":17,"question_id":3795263,"title":"Errors: \"INSERT EXEC statement cannot be nested.\" and \"Cannot use the ROLLBACK statement within an INSERT-EXEC statement.\" How to solve this?","body":"<p>I have three stored procedures <code>Sp1</code>, <code>Sp2</code> and <code>Sp3</code>.</p>\n\n<p>The first one (<code>Sp1</code>) will execute the second one (<code>Sp2</code>) and save returned data into <code>@tempTB1</code> and the second one will execute the third one (<code>Sp3</code>) and save data into <code>@tempTB2</code>.</p>\n\n<p>If I execute the <code>Sp2</code> it will work and it will return me all my data from the <code>Sp3</code>, but the problem is in the <code>Sp1</code>, when I execute it it will display this error:</p>\n\n<blockquote>\n  <p>INSERT EXEC statement cannot be nested</p>\n</blockquote>\n\n<p>I tried to change the place of <code>execute Sp2</code> and it display me another error:</p>\n\n<blockquote>\n  <p>Cannot use the ROLLBACK statement\n  within an INSERT-EXEC statement.</p>\n</blockquote>\n"},{"tags":["asp.net","sql","sql-server","sql-server-2005","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":479,"score":0,"question_id":6120957,"title":"SQL Query Problem in Inline Query in Asp.net","body":"<p>My sql table structure is this</p>\n\n<pre><code>ID  DataName\n1   Lipsum lorem \n3   lipsum's lorem\n</code></pre>\n\n<p>My inline query in asp.net is that</p>\n\n<pre><code>select * from table where DataName like 'lipsum's lorem'\n</code></pre>\n\n<p>It gives the following errors:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Line 1\nIncorrect syntax near 's'.\nMsg 105, Level 15, State 1, Line 1\nUnclosed quotation mark after the character string ''.\n</code></pre>\n\n<p>I don't want to create a stored procedure to prevent this, I want a solution to this using inline queries.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":5,"favorite_count":1,"up_vote_count":10,"down_vote_count":0,"view_count":11676,"score":10,"question_id":1383494,"title":"Alter user defined type in Sql Server","body":"<p>I created few user defined types in DB as below</p>\n\n<pre><code>CREATE TYPE [dbo].[StringID] FROM [nvarchar](20) NOT NULL\n</code></pre>\n\n<p>and assigned to various tables. My tables in db are in various schemas (not only dbo)</p>\n\n<p>But I realized I need bigger field, and I need to alter, e.g increase from nvarchar to nvarchar, but there is no ALTER TYPE statement</p>\n\n<p>I need a script that temp table/ cursor whatever and save there all tables and fields where my type is used. Then change existing fields to base type - e.g. from CustID [StringID] to CustID [nvarchar(20)].\nDrop the user type and recreate it with new type - e.g. nvarchar(50)\nand finally set back fields to user type</p>\n\n<p>I do not have rules define on types, so don't have to drop rules and re-add them</p>\n\n<p>I'm not very familiar with T-Sql, so any help is appreciated.</p>\n"},{"tags":["sql-server","entity-framework","stored-procedures"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13265914,"title":"How do I build my EF models so they are based on a stored procedure select","body":"<p>I am completely new to EF and a bit lost, to be honest.\nI have an existing database, and everything is going through stored procedures. Even the selects are stored procedures. \nMy model needs to use this, but I have no idea how to begin.\nI assume I can really use the auto-generate, if the objects are to be based on the stored procedures output, instead of the tables.</p>\n\n<p>I have tried googling, but to be honest, I don't think I know what to look for.</p>\n\n<p>If I create an empty entity framework model, and build all the objects myself, can I somehow get the data by executing a stored procedure instead of mapping directly to a table?</p>\n\n<p>And how do I do this? \nAny articles I need to read? My searching seems to always end up with fancy auto-generation articles, that seems to not apply in my case.</p>\n\n<p>I know this is kind of a broad question, but I am somewhat lost here. Any help is much appreciated.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>So, I have learnt that I can create a complex type, based on the stored select. But, I don't really see a way, to map update/insert/delete procedures onto this. I don't really understand how to link the entity type and the complex type together, if that is even possible or the way to do it.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":3086,"score":4,"question_id":528529,"title":"Self-referencing constraint in MS SQL","body":"<p>Is it true that MS SQL restrict self-referencing constraints with ON DELETE CASCADE option? \nI have a table with parent-child relation, PARENT_ID column is foreign key for ID. Creating it with ON DELETE CASCADE option causes error </p>\n\n<blockquote>\n  <p>\"Introducing FOREIGN KEY constraint\n  may cause cycles or multiple cascade\n  paths. Specify ON DELETE NO ACTION or\n  ON UPDATE NO ACTION, or modify other\n  FOREIGN KEY constraints.\"</p>\n</blockquote>\n\n<p>I can't believe that I have to delete this hierarchy in recursive mode. Is there any issue except triggers?</p>\n"},{"tags":["sql-server","sql-server-2008","csv","bulkinsert"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4046,"score":1,"question_id":3756560,"title":"How to Bulk Insert csv with double quotes around all values?","body":"<p>I am trying to insert a .csv file into SQL Server 2008 R2.</p>\n\n<p>The .csv is 300+MB from <a href=\"http://ipinfodb.com/ip_database.php\" rel=\"nofollow\">http://ipinfodb.com/ip_database.php</a> Complete\n(City), 4.0M records.</p>\n\n<p>Here're the top 5 lines, with 1st line = column headers:</p>\n\n<pre><code>\"ip_start\";\"country_code\";\"country_name\";\"region_code\";\"region_name\";\"city\";\"zipcode\";\"latitude\";\"longitude\";\"metrocode\"\n\"0\";\"RD\";\"Reserved\";;;;;\"0\";\"0\";\n\"16777216\";\"AU\";\"Australia\";;;;;\"-27\";\"133\";\n\"17367040\";\"MY\";\"Malaysia\";;;;;\"2.5\";\"112.5\";\n\"17435136\";\"AU\";\"Australia\";;;;;\"-27\";\"133\";\n</code></pre>\n\n<p>I tried Import and Export Data, and BULK INSERT, but haven't been able to import them correctly yet.</p>\n\n<p>Shall I resort to use bcp? can it handle stripping the <code>\"\"</code>? how?</p>\n\n<p>Thank you very much.</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13268241,"title":"Random Function behavior in SELECT query in MS SQL server","body":"<p>I have a written a random function[dbo.UDF_Q_RandomNumber()] that generates a floating type random number between 0 and 1. </p>\n\n<pre><code>DECLARE @upper=10    \nDECLARE @lower=1    \nSELECT  ROUND(CAST((@lower+(@upper-@lower)*dbo.UDF_Q_RandomNumber())AS INT),0) \n</code></pre>\n\n<p>The above code generates a random number between 1 and 10.</p>\n\n<p>Now i made a temporary table #tempTable with 10 rows in it with coulumns 'Id' and 'Number'</p>\n\n<pre><code>Id  Number\n1   1\n2   2\n3   3\n4   4\n5   5\n6   6\n7   7\n8   8\n9   9\n10  10 \n</code></pre>\n\n<p>SQL Query:</p>\n\n<pre><code>CREATE TABLE #tempTable(Id INT,Number INT)\nINSERT INTO #tempTable VALUES (1,1)\nINSERT INTO #tempTable VALUES (2,2)\nINSERT INTO #tempTable VALUES (3,3)\nINSERT INTO #tempTable VALUES (4,4)\nINSERT INTO #tempTable VALUES (5,5)\nINSERT INTO #tempTable VALUES (6,6)\nINSERT INTO #tempTable VALUES (7,7)\nINSERT INTO #tempTable VALUES (8,8)\nINSERT INTO #tempTable VALUES (9,9)\nINSERT INTO #tempTable VALUES (10,10)\nDECLARE @maxCount INT;\nSELECT @maxCount=  COUNT(1) FROM #tempTable\nSELECT * FROM #tempTable\nSELECT Number FROM #tempTable WHERE Id= ROUND(CAST((1+(@maxCount-1)*dbo.UDF_Q_RandomNumber())AS INT),0)\nDROP TABLE #tempTable\n</code></pre>\n\n<p>Here the query </p>\n\n<pre><code>**SELECT Number FROM #tempTable WHERE Id= ROUND(CAST((1+(@maxCount-1)*dbo.UDF_Q_RandomNumber())AS INT),0)**\n</code></pre>\n\n<p>sometimes gives 2 rows and sometimes null which should not come as Id selected is between 1 and 10 (the rows in temptable) and  every Id has value too.\nPlease help .</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":189,"score":0,"question_id":8731229,"title":"SQL Server string getting truncated","body":"<p>I have a column (<code>col1</code>) with <code>nvarchar(max)</code>.</p>\n\n<p>I am trying to do </p>\n\n<pre><code>DECLARE @my_string NVARCHAR(max)\nset @my_string = N'test'\n\nUPDATE dbo.tab1 \nSET col1 = @my_string + ISNULL(col1, N'')\n</code></pre>\n\n<p>no  luck , I have no idea why it is happening. @marc_s</p>\n\n<p>The string value in <code>col1</code> getting truncated after 250 characters. This happening in both SQL Server 2005 and 2008.</p>\n"},{"tags":["c#","sql-server","entity-framework","extended-properties"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13268446,"title":"Get Extended Property in edmx modeling Db","body":"<p>I have a database modelling by Entity Framework. I need to read the extended properties of each table through the object context associated to my Db. How can i do?</p>\n\n<p>Thank's in advance</p>\n"},{"tags":["sql-server","views"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":616,"score":4,"question_id":6460421,"title":"SQL Server 2008 - sp_refreshview bombing out on some views","body":"<p>I've inherited a fairly substantial project, which makes extensive use of SQL Server (2005 and 2008) views.</p>\n\n<p>One step in the build process is the call the <code>sp_refreshviews</code> system stored procedure, to make sure, no changes on any tables have broken our views. This works fine .... except for about three or four (out of 200+) views....</p>\n\n<p>With those, it just bombs out - gives odd error messages like </p>\n\n<blockquote>\n  <p>Msg 15165, Level 16, State 1,\n  Procedure\n  sp_refreshsqlmodule_internal, Line 55<br>\n  Could not find object\n  'vYourViewNameHere' or you do not\n  have permission.</p>\n</blockquote>\n\n<p>which is dead wrong - that view <strong>does</strong> exist, and I definitely <strong>can</strong> select from it.</p>\n\n<p>I cannot seem to find any good concise information about <strong>why</strong> this happens, what triggers it... any ideas? Is there anything I could do to detect such problematic views? Can I change their definitino so that they'd be refreshable again? </p>\n\n<p><strong>Update:</strong> I logged a bug report on Microsoft Connect for this - if you agree this seems odd and needs to be fixed, please vote for it!</p>\n\n<p><a href=\"https://connect.microsoft.com/SQLServer/feedback/details/676728/sp-refreshview-crashes-with-misleading-error-on-views-with-schemabinding\" rel=\"nofollow\">https://connect.microsoft.com/SQLServer/feedback/details/676728/sp-refreshview-crashes-with-misleading-error-on-views-with-schemabinding</a></p>\n"},{"tags":["sql","sql-server","sql-server-2008","merge","case"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13268170,"title":"Merge Statement: Don't update blank field","body":"<p>I'm performing a MERGE statement from a temp table <code>t</code> into the main table <code>ts</code>, matching on an ID field. It contains the following:</p>\n\n<pre><code>WHEN MATCHED THEN UPDATE\n   SET ts.username = t.username, ts.password = t.password, ts.title = t.title, ts.firstname = t.firstname, ts.surname = t.surname, ts.email = t.email\n</code></pre>\n\n<p>If the username and password is blank in the temp table <code>t</code>, I don't want to update the main table <code>ts</code>. How can I do this?</p>\n\n<p>EDIT: Seems like a <code>CASE</code> statement or using <code>COALESCE(NULLIF(t.username, ''), ts.username)</code> will work. Which is best?</p>\n"},{"tags":["sql-server","asp-classic"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13268231,"title":"creating a simple sql server search box in asp","body":"<p>i managed to find an example piece of code on the web which i have tweaked for my own use... however i can't get it to work and im pretty sure the original doesnt work either...</p>\n\n<p>i have a simple form on one page:</p>\n\n<pre><code>&lt;!-- #include file=\"Header.asp\" --&gt;\n&lt;!-- #include file=\"database.asp\"--&gt;\n&lt;form id=\"form1\" name=\"form1\" method=\"get\" action=\"searchresultTEST2.asp\"&gt;\n&lt;label&gt;Enter Keywords:\n&lt;input type=\"text\" name=\"searchTerm\"&gt;\n&lt;/label&gt;\n&lt;p&gt;\n&lt;input type=\"submit\" name=\"Submit\" value=\"Submit\"&gt;\n&lt;/p&gt;\n&lt;/form&gt;\n&lt;!-- #include file=\"footer.asp\" --&gt;\n</code></pre>\n\n<p>the database.asp file contains the connection to the database which is used across the all of the pages. (this works :)!)</p>\n\n<p>i then have this as a seperate search results page:</p>\n\n<pre><code>&lt;!-- #include file=\"Header.asp\" --&gt;\n&lt;!--#include file=\"database.asp\"--&gt;\n&lt;%\n'collect the form input\nsearchInput = Request.QueryString(\"searchTerm\")\n\n'check for a match\nSet myRecordSet = Connect.Execute (\"SELECT * FROM dbo.interiors WHERE Job_Num LIKE '%\" &amp; searchInput &amp; \"%'\")\n\n'display the results\nif myRecordSet.EOF then\nresponse.write(\"You searched for: \" &amp; searchInput &amp; \"&lt;br&gt;\")\nresponse.write(\"A match was not found.&lt;br&gt;Sorry try again.\")\nelse\nresponse.write(\"You searched for: \" &amp; searchInput &amp; \"&lt;br&gt;\")\nresponse.write(\"The record was found!&lt;br&gt;The match is: \" &amp; myRecordSet(\"myColumn\"))\nend if\n%&gt;\n&lt;br&gt;&lt;br&gt;\n&lt;a href=\"searchTEST2.asp\"&gt;Try Again&lt;/a&gt;\n</code></pre>\n\n\n\n<p>I receive the error: </p>\n\n<p>Microsoft VBScript runtime error '800a01a8'</p>\n\n<p>Object required: ''</p>\n\n<p>/Interiors/searchresultTEST2.asp, line 12 </p>\n\n<p>i know the SQL checks out okay so im not quite sure whats wrong with it, any help would be appreciated, thanks guys! :D</p>\n"},{"tags":["sql","sql-server","vb.net","sql-server-2008"],"answer_count":6,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":3372,"score":1,"question_id":1513438,"title":"How do I return a value to a sqldatareader if value is null?","body":"<p>I am currently using a sql data reader (in vb.net) to extract an article object via a stored proc from a SQL Server 2008 database. Part of this object includes the two properties shown below:</p>\n\n<pre><code>theArticle.Truthfulness = ((myReader.GetInt32(myReader.GetOrdinal(\"Truthfulness\"))))\ntheArticle.Relevance = ((myReader.GetInt32(myReader.GetOrdinal(\"Relevance\"))))\n</code></pre>\n\n<p>My problem is that the Truthfulness and Relevance may return a null value and this is causing the function to fall over.</p>\n\n<p>I think I understand why. I am asking for an integer value (getin32) and because null is returned it fails.</p>\n\n<p>How do I accommodate the null value from the database so it does not fall over?</p>\n"},{"tags":["sql-server","database","text","website","oracle11g"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13268124,"title":"Copying text from website to database","body":"<p>I plan to create a database, which gets filled and expanded regularly based on newsticker entries from the web.\nFor example the rows of the \"Latest Vessel Casualties\" box at <a href=\"http://www.lloydslistintelligence.com/llint/index.htm\" rel=\"nofollow\">http://www.lloydslistintelligence.com/llint/index.htm</a> should be added to a local database every day at a certain time.</p>\n\n<p>How would you approach this? Are there features provided by Oracle's database, or SQL Server? If not, how could you generally copy text from a certain website to a local text file?</p>\n"},{"tags":["sql","sql-server","computed-columns"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13267855,"title":"MS SQL format calculated column","body":"<p>I have a computed column which is calculated this way:</p>\n\n<pre><code>(dateadd(month,[amorted_months],[real_date_start]))\n</code></pre>\n\n<p>The above stays in the Formula property of the column. This formula displays for example </p>\n\n<p>'2013-02-28 10:22:15.583'</p>\n\n<p>Now I want to format the column and to display only the date , not the time. When I use the FORMAT function like this:</p>\n\n<pre><code>(FORMAT(dateadd(month,[amorted_months],[real_date_start]), 'YYYY-MM-DD'))\n</code></pre>\n\n<p>It says that there's an error in validation the formula. I'm not good at SQL syntax and I suppose this is really stupid. Thanks for the help!</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":35,"score":3,"question_id":13267127,"title":"SQL Server: Can I save binary data in an nvarchar column?","body":"<p>I know you can convert <code>binary data</code> to <code>nvarchar</code> and save in an <code>nvarchar</code> column, and then convert it back to <code>binary</code> when retrieving it. Will this work correctly all the time to give you your original <code>binary</code> data? Or could something get messed up in the translation? </p>\n\n<p>I am asking because we have a <code>nvarchar</code> column that saves passwords in plain text. I would like this to change to saving the PWs in encrypted text. If I use the function <code>EncryptByPassPhrase</code>, it return <code>varbinary</code>. I am wondering if I can just convert the output from <code>EncryptByPassPhrase</code> to <code>nvarchar</code> and save in the same Password column. This would be easier than creating a new column of type <code>varbinary</code> to save the encrypted PW.</p>\n\n<p>So I am proposing that I convert the current passwords like this:</p>\n\n<pre><code>UPDATE Users \nSET Password = CONVERT(nvarchar(200), EncryptByPassPhrase('whatever', Password))\n</code></pre>\n\n<p>Then I would decrypt and retrieve the PW like:</p>\n\n<pre><code>SELECT CONVERT(nvarchar(200), DecryptByPassPhrase('whatever', Password)) AS PW \nFROM Users\n</code></pre>\n\n<p>Will this always work correctly?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server","tsql","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13267349,"title":"T-SQL stored procedure - how to make parameter that accepts either integer or text","body":"<p>I have created a stored procedure that accepts 3 parameters.</p>\n\n<pre><code>@row int\n,@column VARCHAR(17)\n,@value int\n</code></pre>\n\n<p>I want the <code>@value</code> parameter to accept either text or integer because it updates different columns depending on <code>@column</code> parameter.</p>\n\n<p>Please advise</p>\n"},{"tags":["sql","sql-server"],"answer_count":6,"favorite_count":7,"up_vote_count":53,"down_vote_count":0,"view_count":101753,"score":53,"question_id":31057,"title":"How to insert a line break in a SQL Server VARCHAR/NVARCHAR string","body":"<p>I didn't see any similar questions asked on this topic, and I had to research this for something I'm working on right now. Thought I would post the answer for it in case anyone else had the same question.</p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13266534,"title":"Extract hostname from a URL","body":"<p>I have to trim the website name upto \".com\" or\"co.in\" in sql</p>\n\n<p>example: lets assume i have  site address as\"http://stackoverflow.com/questions/ask?title=trim\".\nI need to get the result as \"stackoverflow.com\".</p>\n\n<p>some scenario it may be like \"www.google.co.in\" then i need it to be \"google.co.in\"</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13266772,"title":"How can I select the latest event for a given user in Microsoft SQL Server 2008?","body":"<p>I have a database in Microsoft SQL Server 2008</p>\n\n<p>I have a table <code>[eventlog].[dbo].[USER_OPERATION]</code> with columns <code>[userID], [event_description], [event_date], [event_type], [eventID]</code></p>\n\n<p><code>eventID</code> is unique for, well, every given event that can happen.</p>\n\n<p>A given <code>UserID</code> is, of course, not unique for events (every user may have a lot of events associated with him) but is associated with a single individual user</p>\n\n<p>What I want is to create a query that would give me a list which only has the <em>latest</em> event for every user (that is to say, every <code>UserID</code>) and its associated info (the <code>event_type</code>, <code>eventID</code> and <code>event_description</code> of a given specific event).</p>\n\n<p>To illustrate:</p>\n\n<p>When performing</p>\n\n<pre><code>SELECT * \nFROM [eventlog].[dbo].[USER_OPERATION] \nORDER BY userID ASC\n</code></pre>\n\n<p>I get something along the lines of </p>\n\n<pre><code>|====================================================================================|\n|  eventID  |  userID  |        event_description        |  event_date  | event_type |\n|           |          |                                 |              |            |\n|   123     |    2     |  USER 2 broke something         |  03.11.11    |   CRASH    |\n|   391     |    2     |  USER 2 filed a complaint       |  30.04.10    |  COMPLAINT |\n|   392     |    2     |  USER 2 has bought beer         |  31.10.09    |  PURCHASE  |\n|   32      |    3     |  USER 3 broke something         |  22.10.11    |   CRASH    |\n|   568     |    4     |  USER 4 has requested support   |  05.12.11    |  SUPP_REQ  |\n|   691     |    4     |  USER 4 has bought beer         |  01.12.10    |  PURCHASE  |\n|   81      |    4     |  USER 4 updated personal data   |  17.07.11    |  PDAT_UPD  |\n|   141     |    5     |  USER 5 has bought beer         |  16.08.11    |  PURCHASE  |\n|   142     |    5     |  USER 5 broke something         |  16.08.11    |   CRASH    |\n|   269     |    6     |  USER 6 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|   845     |    7     |  USER 7 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|           |          |                                 |              |            |\n|====================================================================================|\n</code></pre>\n\n<p>As you can see, some users have multiple events with different dates associated with them.</p>\n\n<p>What I want is a query that will show me a list of users and what was the most recent date users had an event on (the output would, essentially, be a table which lists each users once, and shows the most recent event associated with each user, and associated event_description, event_date and event_type info). </p>\n\n<p>Let's call such a query result \"Recent Event Table\".</p>\n\n<p><b>Do note the \"unusual condition\" of User 5 (UserID 5) who broke something and bought beer at the same date. </p>\n\n<p>In such cases, I don't care WHICH of the two same-day events would go into the \"Recent Event Table\"</b>, it can be picked by random or whatever (though I would still would need the associated event_description and event_type info).</p>\n\n<p><b>Ideally</b>, the result would look like this (for same set of users as above):</p>\n\n<pre><code>|====================================================================================|\n|  eventID  |  userID  |        event_description        |  event_date  | event_type |\n|           |          |                                 |              |            |\n|   123     |    2     |  USER 2 broke something         |  03.11.11    |   CRASH    |\n|   32      |    3     |  USER 3 broke something         |  22.10.11    |   CRASH    |\n|   568     |    4     |  USER 4 has requested support   |  05.12.11    |  SUPP_REQ  |\n|   141     |    5     |  USER 5 has bought beer         |  16.08.11    |  PURCHASE  |\n|   269     |    6     |  USER 6 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|   845     |    7     |  USER 7 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|           |          |                                 |              |            |\n|====================================================================================|\n</code></pre>\n\n<p>If there is no way to just <i>\"pick any one of the two randomly or per some rule\"</i> for such \"date-dupes\" as User 5, having two entries in the \"Recent Event Table\" would be acceptable for such special cases, since they are very rare and I can handle them manually.</p>\n\n<p>In such (a little bit less fortunate) case the \"Recent Event Table\" would look like </p>\n\n<pre><code>|====================================================================================|\n|  eventID  |  userID  |        event_description        |  event_date  | event_type |\n|           |          |                                 |              |            |\n|   123     |    2     |  USER 2 broke something         |  03.11.11    |   CRASH    |\n|   32      |    3     |  USER 3 broke something         |  22.10.11    |   CRASH    |\n|   568     |    4     |  USER 4 has requested support   |  05.12.11    |  SUPP_REQ  |\n|   141     |    5     |  USER 5 has bought beer         |  16.08.11    |  PURCHASE  |\n|   142     |    5     |  USER 5 broke something         |  16.08.11    |   CRASH    |\n|   269     |    6     |  USER 6 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|   845     |    7     |  USER 7 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|           |          |                                 |              |            |\n|====================================================================================|\n</code></pre>\n\n<p>Which is also acceptable (but would need a bit additional pruning later).</p>\n\n<p>So, to summarize my question, is it possible to construct such a Microsoft SQL query that would give me a Recent Event Table along the lines of what was described above ?</p>\n\n<p>Thank you very much for your help in advance </p>\n"},{"tags":["sql-server","postgresql","stored-procedures"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13266469,"title":"SQL Server stored procedure like PostgreSQL stored procedure","body":"<p>I want to create a stored procedure in SQL Server that is like PostgreSQL stored procedure.</p>\n\n<p>SQL Server:</p>\n\n<p><strong>table1_test</strong></p>\n\n<pre><code>field1    field2\naaaa      bbbb\n</code></pre>\n\n<p><strong>table2_test</strong></p>\n\n<pre><code>field1    field2\ncccc      dddd\n\ncreate procedure test_proce as\n  select * from table1_test\n  select * from table2_test\n</code></pre>\n\n<p>SQL Server results:</p>\n\n<pre><code>field1    field2\naaaa      bbbb\n---------------------------------\nfield1    field2\ncccc      dddd\n</code></pre>\n\n<p>PostgreSQL:</p>\n\n<p><strong>table1_test</strong></p>\n\n<pre><code>field1    field2\naaaa      bbbb\n</code></pre>\n\n<p><strong>table2_test</strong></p>\n\n<pre><code>field1    field2\ncccc      dddd\n\ncreate function test_proc() returns void as $$\nBEGIN\nselect * from \"table1_test\";\nselect * from \"table2_test\";\nEND;\n$$Language plpgsql;\n</code></pre>\n\n<p>PostgreSQL results:</p>\n\n<pre><code>Success function.\n</code></pre>\n\n<p>I want show postgresql in multi-table result.</p>\n\n<p>that's impossible ?</p>\n"},{"tags":["c#",".net","sql-server","subtract"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13266422,"title":"Mssql Subtract certain percent","body":"<p>Im trying to subtract a certain percent of my price, into a AS columm.</p>\n\n<pre><code>SELECT TOP 2 *, price - (price * (discount/100)) AS discountedPrice FROM products WHERE discount != 0\n</code></pre>\n\n<p>But this seems not to work. What have i done wrong?</p>\n\n<p>I want it like this, let's say price is 500 and discount is 20. Then it'll have to subtract those 20 as percent of the 500.</p>\n\n<p>So 500 - 20%, just in Mssql format.</p>\n"},{"tags":["c#","sql-server","ado.net"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13265981,"title":"Execute SQL Server Stored Procedure with SqlHelper.ExecuteDataSet() and Get Return Value","body":"<p>I have an <code>SQL Server Stored Procedure</code>. This procedure have an output parameter.\nOn my <code>C#.NET</code> Appliaction, I execute this procedure via <code>SqlHelper.ExecuteDataSet()</code> and it returns a query result <code>DataSet</code>.\nHow can I get the output parameter from the stored procedure procedure while using <code>SqlHelper.ExecuteDataSet()</code>.\nSome article said that I need to use <code>SqlHelper.ExecuteNonQuery()</code> but I need the <code>DataSet</code> too.</p>\n\n<p>This is my code:</p>\n\n<pre><code>        public DataSet GetDataPerTable(string spName, string a, string b, out int c)\n        {\n            try\n            {\n                c = 0;\n\n                SqlParameter[] spParameter = new SqlParameter[3];\n\n                spParameter[0] = new SqlParameter(\"@a\", SqlDbType.Char, 4);\n                spParameter[0].Direction = ParameterDirection.Input;\n                spParameter[0].Value = a;\n\n                spParameter[1] = new SqlParameter(\"@b\", SqlDbType.Char, 1);\n                spParameter[1].Direction = ParameterDirection.Input;\n                spParameter[1].Value = b;\n\n                spParameter[2] = new SqlParameter(\"@c\", SqlDbType.Int);\n                spParameter[2].Direction = ParameterDirection.ReturnValue;                \n                c = Convert.ToInt32(spParameter[2].Value);\n\n                return SqlHelper.ExecuteDataset(Configuration.MyConnectionString, CommandType.StoredProcedure, spName, spParameter);\n            }\n            catch (Exception ex)\n            {\n\n                throw ex;\n            }\n        }\n</code></pre>\n\n<p>My <code>c</code> variable always return 0. Any Idea? Thanks in advance :)</p>\n\n<p>My Procedure is about like this:</p>\n\n<pre><code>CREATE PROCEDURE [dbo].SPR_MyProcedure (@a Char(4), @bChar(1), @c Int Output)  \nSELECT * \nFROM MyTable\nSet @c = 1\n</code></pre>\n"},{"tags":["sql-server","tsql","udf"],"answer_count":4,"favorite_count":2,"up_vote_count":1,"down_vote_count":1,"view_count":394,"score":0,"question_id":4035024,"title":"How to create a UDF or View in another database that references the correct sys.objects table in the caller?","body":"<p>Using SQL Server 2008, I'd like to create a UDF that gives me the create date of an object.  This is the code:</p>\n\n<pre><code>create function dbo.GetObjCreateDate(@objName sysname) returns datetime as\nbegin\n    declare @result datetime\n    select @result = create_date from sys.objects where name = @objname\n    return @result\nend\ngo\n</code></pre>\n\n<p>I'd like to put this UDF in the master database or some other shared database so that it is accessible from anywhere, except that if I do that then the <code>sys.objects</code> reference pulls from the <code>master</code> database instead of the database that I'm initiating my query from.  I know you can do this as the <code>information_schema</code> views sit in <code>master</code> and just wrap calls to local instances of sys.objects, so I'm hoping there's a simple way to do that with my UDF as well.</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":394,"score":1,"question_id":5563141,"title":"Convert text to date format","body":"<p>How do I convert a text format e.g. </p>\n\n<blockquote>\n  <p>Thursday, 1 January 2009</p>\n</blockquote>\n\n<p>to a date in <code>sql</code>?</p>\n\n<p>Thank you </p>\n"},{"tags":["sql-server","clr"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":13265648,"title":"conflict and otherness between data produced by a single clr stored procedure in two server","body":"<p>I have a very special problem !\nI have a clr stored procedure that is called by a windows application . there is not any problem when i do it in local instance of sqlserver . the problem occurs when using a remote server for doing this job . in this situation clr can't do it good . my output data is wrong and there are many differences in two servers' data . i want to know why these conflicts happen by a single clr sp ? \nmore info : i have a \"transactionscope\" in clr . \nthanks for your help !</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":17590,"score":5,"question_id":5136013,"title":"How to change column datatype in SQL Server database without losing data","body":"<p>I have SQL Server database and I just realized that I can change the type from one of the columns from <code>int</code> to <code>bool</code>. How can I do that without losing the data that is already entered into that table? </p>\n\n<p>PS. I am using SQL Server Server 2008.</p>\n"},{"tags":["sql","sql-server","sql-update"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13265369,"title":"SQL Update Select The multi-part identifier \"OLD_SP.Num\" could not be bound","body":"<pre><code>Declare @modCode varchar(3)\nSET @modCOde = 'SOR';\n\nUPDATE  Doc_SalesOrder\nSET     OLD_SP.Num = NEW_SP.NewNum\nFROM    Doc_SalesOrder as OLD_SP\nINNER JOIN\n(\n     Select\n       Id,\n       dbo.ApplyModuleCode(@modCode,Num) as NewNum \n     From Doc_SalesOrder\n     Where Num not LIKE '%'+@modCOde+'%'\n)NEW_SP ON OLD_SP.Id = NEW_SP.Id\n</code></pre>\n\n<p>When I  run the query the error is:</p>\n\n<blockquote>\n  <p>The multi-part identifier \"OLD_SP.Num\" could not be bound.</p>\n</blockquote>\n\n<p>Why?</p>\n"},{"tags":["sql-server","query","search","casting","binary"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13264305,"title":"SQL Server : Like Syntax and Add operator Error","body":"<p>I am using this syntax and it should work well if only it doesn't get an error.</p>\n\n<pre><code>SELECT\n   e.user_key,\n   e.char_key,\n   CONVERT(VARCHAR,substring(e.char_data, 9, 16)) AS name,\n   p.CHAR_DATA\nFROM \n   CHAR_DATA0 AS e\nINNER JOIN  \n   CHAR_DATA1 AS p ON e.CHAR_KEY = p.CHAR_KEY\nWHERE \n   p.CHAR_DATA LIKE '%'+CAST(cast(reverse(CONVERT(BINARY, 9998)) as BINARY(2)) AS BINARY(2))+'%'\nORDER BY \n   char_key\n</code></pre>\n\n<p>I need help. How to change this code for it to work?</p>\n\n<p><code>CHAR_DATA</code> column is of type <code>BINARY(2000)</code></p>\n\n<p>I have data like so: (got it using select)</p>\n\n<pre><code> 0x04005C03020F2789080100000F278908010000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFBA3B8C08000000BB3B8C080000000F2789080100000F278908010000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFBC3B8C08000000BD3B8C080000000F2789080100000F278908010000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFBE3B8C08000000BF3B8C080000000F2789080100000F278908010000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFC03B8C08000000C13B8C08000000B5388B08020000B5388B08020000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFBA3B8C08000000BB3B8C08000000B5388B08020000B5388B08020000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFBC3B8C08000000BD3B8C080000000E2789080100000E278908010000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFBE3B8C08000000BF3B8C080000000E2789080100000E278908010000FFFFFFFFFFFFFF0E2787080100000E278708010000FFFFFFFFFFFFFFC03B8C08000000C13BFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF0F27FFFF0100000F27FFFF0100000E2789080000000E278908000000FFFFFFFFFFFFFF7E107F08000000EC168408000000B0177D080000000F27FFFF0100000F27FFFF0100000E2789080000000E27890800000052167C081E000052167C081E0000E2167D08000000271F2005000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF0E2787080100000E27870801000052167C081E000052167C081E0000FFFFFFFFFFFFFF13127F08000000C813FFFF1E0000C813FFFF1E00000E2787080100000E27870801000028127A08000000BF3B2D05000000FFFFFFFFFFFFFF13127F08000000C813FFFF1E0000C813FFFF1E0000FFFFFFFFFFFFFFFFFFFFFFFFFFFF28127A08000000FFFFFFFFFFFFFF1B1A80081A00001B1A80081A0000E915FFFF1B0000E915FFFF1B000023067A0800000024147B0800000020120D05000000084792080100001B1A80081A00001B1A80081A0000E915FFFF1B0000E915FFFF1B000025067A0800000024147B0800000020120D05000000E21610050000000000009D000000FFFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n</code></pre>\n\n<p>I need to search somewhere in those lines if it contains the entry I'm trying to find.</p>\n\n<p>What I'm trying to find is always 2 bytes. So I'm looking for 0x0E27 in the syntax above.</p>\n\n<p>This is a working syntax but its not what I want to do:</p>\n\n<pre><code>SELECT \n   CONVERT(INT,cast(reverse(substring(char_data, 37, 2)) as BINARY(2))) AS helm \nFROM CHAR_DATA0 \nWHERE CHAR_KEY = 5\n</code></pre>\n\n<p>Another this is if I use nvarchar(MAX) it gives results that doesn't even contain the data I'm trying to find.</p>\n"},{"tags":["c#","sql-server","linq","linq-to-sql","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":53,"score":-2,"question_id":13262409,"title":"Why not get the desired output from stored procedure","body":"<p>To fulfill one of my requirements I need to pass a SQL query as a parameter to a stored procedure.</p>\n\n<p>My stored procedure syntax is:</p>\n\n<pre><code>create PROCEDURE spSelect \n    @Query VARCHAR(500)\nAS \n    EXEC( @Query)  \n    return  \n</code></pre>\n\n<p>To execute that stored procedure, I use this C# code:</p>\n\n<pre><code>DataContex db=new DataContex();\n    String sSQL = \" SELECT OrderID,ShipName FROM dbo.Orders\";\n    var result = db.spSelect(sSQL);\n</code></pre>\n\n<p>After execution, the <code>result</code> is <code>0</code>.</p>\n\n<p>Need help to understand what happen, why not I get desired output</p>\n\n<p>If have any query please ask, thanks in advance</p>\n"},{"tags":[".net","sql-server","web-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":16,"score":-1,"question_id":13262277,"title":"How to update central SQL Server database from several local SQL Server databases?","body":"<p>I currently have a central SQL server database that will maintain all records from the growing number of local client SQL server databases. This central server will be used to generate reports etc.</p>\n\n<p>The clients are running a local installation of a .NET web application where they can register and watch videos etc (all stored locally on the client). The web application stores registrations and viewing data in the local SQL server database.</p>\n\n<p>It is not feasible for me to have a full web application which all of these clients can access as we are streaming HD video content to the clients who are concerned about bandwidth. I wish this were possible as it would make my life 10x easier.</p>\n\n<p>I was thinking a windows service which will run on the clients and somehow connect to the central server database and insert all new registrations every hour or so. Or the local web application could insert directly into the central server database. My boss would prefer the local database setup though, which gives us a reliable backup as we can remotely access these databases and manually pull data if we need.</p>\n\n<p>Is this possible? I've read of web services which I think may satisfy my needs.</p>\n\n<p>Thanks for any help.</p>\n"},{"tags":["sql","sql-server","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13264779,"title":"How to display a null row between 2 tables","body":"<p>Using a view in SQL Server 2000</p>\n\n<p>Table1:</p>\n\n<pre><code>id  z1      z2      z3      z4   type\n--------------------------------------\n01A 300     400     300     400  01\n2B  300     400     300     500  02\n3C  700     600     400     300  01\n04A 500     400     800     900  01\n05B 400     300     400     300  02\n06  150     200     200     150  03\n....\n</code></pre>\n\n<p>Table2:</p>\n\n<pre><code>type  value1         value2\n------------------------------------    \n01    0      300\n01    301    500          \n02    0      200\n02    201    400\n03\n.....\n</code></pre>\n\n<p>I want to select the table1 rows based on table2 range:</p>\n\n<p>Combination for table1- <code>max(Z1, Z2) and max(Z3, Z4)</code></p>\n\n<p>If Max(z1,z2)  range is less than or equal to table2 max(value2) where table1.type = table2.type\nIf Max(z1, z2)  range is less than or equal to table2 max(value2) where table1.type = table2.type</p>\n\n<p>If z1, Z2 range less than or equal to table2 then i want to display the z1, z2 rows otherwise null\nIf z3, z4 range less than or equal to table2 then i want to display the z3, z4 rows otherwise null</p>\n\n<p>Expected output</p>\n\n<p>Table1:</p>\n\n<pre><code> id  z1      z2      z3      z4   type\n    --------------------------------------\n\n01A 300     400     300     400  01 ' `Both (z1, z2), (z3, z4) rows are matching with table2 for type 01`\n2B  300     400     null     null  02 ' (z1, z2) are matching, (z3, z4) rows are not matching with table2 for type 02\n3C  null    null     400     300  01 ' (z1, z2) rows are not matching, (z3, z4) rows are matching with table2 for type 01\n04A 500     400     null     null  01 ' (z1, z2) rows are matching, (z3, z4) rows are not matching with table2 for type 01\n05B 400     300     400     300  02 ' Both (z1, z2), (z3, z4) rows are matching with table2 for type 02\n\n....\n</code></pre>\n\n<p>Currently I'm using a view, I don't want to change to stored procedure because most of the report are using this view.</p>\n\n<p>How to do it in sql..?</p>\n"},{"tags":["sql-server","database","oracle","migration"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":20,"score":0,"question_id":13265099,"title":"Migration of SQL Server database to Oracle","body":"<p>I searched many converters and migration tools over internet but couldn't find the one I really need.</p>\n\n<p>Though there are some but they are on trial, I want free one, mysql provides migration facility but it doesn't convert 100%</p>\n"},{"tags":["sql-server","sql-server-2008","datetime","truncate"],"answer_count":13,"favorite_count":30,"up_vote_count":61,"down_vote_count":0,"view_count":81979,"score":61,"question_id":923295,"title":"How can I truncate a datetime in SQL Server?","body":"<p>What's the best way to truncate a datetime value (as to remove hours minutes and seconds) in SQL Server 2008?</p>\n\n<p>For example:</p>\n\n<pre><code>declare @SomeDate datetime = '2009-05-28 16:30:22'\nselect trunc_date(@SomeDate)\n\n-----------------------\n2009-05-28 00:00:00.000\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13265039,"title":"SQL passing a value in Like Command","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/390362/using-variable-in-sql-like-statement\">Using variable in SQL LIKE statement</a>  </p>\n</blockquote>\n\n\n\n<p>I want it to be like this and its ok..</p>\n\n<pre><code>Declare @modCode varchar(3)\nSET @modCOde = 'SOR';\n\nSelect dbo.ApplyModuleCode(@modCode, Num) \nFrom Doc_SalesOrder \nWhere Num not LIKE @modCOde\n</code></pre>\n\n<p>but I want to use it like this.</p>\n\n<pre><code>Declare @modCode varchar(3)\nSET @modCOde = 'SOR';\n\nSelect dbo.ApplyModuleCode(@modCode, Num) \nFrom Doc_SalesOrder \nWhere Num not LIKE %@modCOde%\n</code></pre>\n\n<p>How can I achieve what I want?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13264519,"title":"Getting weekly data from sql","body":"<p>I have a table which has a date column ands values according to dates.Normally if i want to select the data between two dates we use the <code>BETWEEN</code> syntax but it brings each day between those 2 values i have given.Is it possible to change it so it brings the dates with sopme interval i have given? For example if do a simple </p>\n\n<pre><code>SELECT * FROM METABLE WHERE DATE BETWEEN '2012-06-11' AND '2012-07-11'\n</code></pre>\n\n<p>It should bring me the dates as:</p>\n\n<pre><code>2012-06-11 myValue Stuff \n2012-06-12 myValue Stuff \n.\n.\n.\n2012-07-11 myValue Stuff.\n</code></pre>\n\n<p>IS it possible to change it to,</p>\n\n<pre><code>2012-06-11 myValue Stuff \n2012-06-18 myValue Stuff \n2012-06-25 myValue Stuff \n.\n.\n.\nUntil my end date.\n</code></pre>\n\n<p>So this gives me my weekly values.\nHow can i achieve that?</p>\n"},{"tags":["sql","sql-server","database","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13258850,"title":"table name of column from view","body":"<p>I have a view which returns 30 columns. The view is created by inner join of three tables. I wish to find out which column was taken from which table using a query rather than going through the view line by line.\nIs there a way to do that in sql server 2008?\nthanks in advance </p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13263497,"title":"SQL compare strings having version as value","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6855588/split-a-string-and-return-greatest-in-mssql\">Split a string and return greatest in mssql</a>  </p>\n</blockquote>\n\n\n\n<p>I need to compare strings which have version value, for example:\nstring1 = 2.3.4\nstring2 = 2.5.6\nNow in the above case i need to check which string version is greater?</p>\n"},{"tags":["sql-server","sql-server-2008","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":13256597,"title":"Trigger to Only Allow a Single Null Value Per Item ID","body":"<p>I am working on a database for equipment management, where users can sign in and out equipment. I have a table called TBL_Usage which keeps track of this. When an item is signed out, a new record is created in this table with the sign out date, and when it is signed back in, a sign in date is entered in the same record.</p>\n\n<p>For the purposes of this question, the table looks like this:\nTBL_Usage(Date_Out, Date_In, Equipment_ID)</p>\n\n<p>Now an item can't be signed out twice at the same time, therefore for each Equipment_ID, there can only be a maximum of one record where Date_In is null. I want to create a trigger/constraint to deal with this and am not quite sure how to set it up.</p>\n"},{"tags":["sql-server","sql-server-2008-r2","sql-management-studio"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13262034,"title":"SQL Server 2008 trace query and output (record rows) of query execution","body":"<p>I want to programmatically trace and save all queries and outputs (record rows) of queries execution in SQL Server 2008 R2.</p>\n\n<p>I've easily implemented a query grace program based on <code>TraceServer</code> class of SMO (Server Management Object) in Visual C#. </p>\n\n<p>However, I couldn't trace outputs (record rows) of queries execution which are like outputs in the results window in SSMS (SQL Server Management Studio).</p>\n\n<p>How can I trace and save them?</p>\n"},{"tags":["sql-server","stored-procedures","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13263598,"title":"Wild Cards in a stored procedure","body":"<p>I have a SQL Server database that contains a table <code>address(a_id:int, street:nvarchar(50), apt:nvarchar(50), city:nvarchar(50), state:nvarchar(50), zip:int)</code></p>\n\n<p>I have a stored procedure that returns the <code>a_id</code> for a specific address.</p>\n\n<pre><code>SELECT\n    address_id\nFROM\n     address a\nWHERE\n    street like '%'+ @street +'%'\n    and apt like '%'+ @apt +'%'\n    and zip = @zip\n</code></pre>\n\n<p>For example if I put in <code>1060 West Addison Street Chicago IL 60613</code> I would want to get the same <code>a_id</code> as <code>1060 W Addison Street Chicago IL 60613</code> or <code>1060 W. Addison Street Chicago IL 60613</code></p>\n\n<p>As you can see, I tried putting wild cards around the <code>street</code> and <code>apt</code> columns to account for differences in abbreviations and periods, but it does not work.</p>\n\n<p>Currently only the first example returns an <code>a_id</code>, as this is what matches whats in the db exactly</p>\n"},{"tags":["php","sql","sql-server","query"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13263569,"title":"Getting only the same result to appear in SQL","body":"<p>This is my code, later I will be putting it into php, but for the time being I am using it in a provided Query tester. We are doing the first degree of kevin bacon instead of the 6th.</p>\n\n<p><strong>My query is as follow:</strong> </p>\n\n<pre><code>SELECT name,year\nFROM actors\nJOIN roles ON roles.actor_id = actors.id\nJOIN movies ON movies.id=roles.movie_id\nWHERE actors.first_name= 'kevin' AND actors.last_name='bacon' OR actors.first_name= 'sean' AND actors.last_name='penn'\nORDER BY movies.name;\n</code></pre>\n\n<p><strong>it results in</strong> </p>\n\n<pre><code>Animal House 1978\nApollo 13 1995 \nFew Good Men, A 1992 \nFootloose 1984 \nHollow Man 2000 \nJFK 1991 \nMystic River 2003 \nMystic River 2003 \nPlanes, Trains &amp; Automobiles 1987 \nStir of Echoes 1999 \n</code></pre>\n\n<p><strong>How do I get it to show only Mystic River?</strong></p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":13177874,"title":"combine multiple rows int one row with many to many","body":"<p>Using SQL Server I have the following tables/ data</p>\n\n<p><strong>CUS_VISIT</strong></p>\n\n<pre><code>Cus_ID    Cus_Vis_ID\n1           01\n1           02\n2           01\n</code></pre>\n\n<p>and</p>\n\n<p><strong>CUS_EVENT</strong></p>\n\n<pre><code>Cus_Event_ID    Cus_ID    Cus_Vis_ID\n001               1            01\n002               1            01\n</code></pre>\n\n<p>and</p>\n\n<p><strong>CUS_XREF</strong></p>\n\n<pre><code>Cus_ID    Cus_Event_ID    Cus_Prt_ID    Cus_Seq_No\n1            001               1           1\n1            001               2           1\n</code></pre>\n\n<p>and</p>\n\n<p><strong>CUS_PRT</strong></p>\n\n<pre><code>Cus_ID    Cus_Prt_ID    Prt_Cd\n1            1            1A\n1            2            2A\n</code></pre>\n\n<p>I have tried numerous queries but didn't include them as i thought it would confuse things... most of them have used the xml path functionality but to no avail (i haven't been trying pivot since there is a massive list of codes).</p>\n\n<p>I am trying to get the following</p>\n\n<pre><code>SQL RESULTS\n\nCus_ID     Prt_Cd     Cus_Vis_ID\n1           1A,2A        1\n</code></pre>\n\n<p>what I end up with is</p>\n\n<pre><code>SQL RESULTS\n\nCus_ID     Prt_Cd     Cus_Vis_ID\n1           1A           1\n1           2A           1\n</code></pre>\n\n<p>The tables are linked by ...</p>\n\n<pre><code>CUS_VISIT.Cus_ID    = CUS_EVENT.Cus_ID \nCUS_VISIT.Cus_Vis_ID  = CUS_EVENT.Cus_Vis_ID\nCUS_VISIT.Cus_ID = CUS_XREF.Cus_ID\nCUS_EVENT.Cus_Event_ID = CUS_XREF.Cus_Event_ID    \nCUS_XREF.Cus_Prt_ID = CUS_PRT.Cus_Prt_ID \nCUS_XREF.Cus_ID = CUS_PRT.Cus_ID \n</code></pre>\n\n<p>I can almost get what I am after if I drop the <code>CUS_XREF.Cus_Prt_ID = CUS_PRT.Cus_Prt_ID</code> \njoin but then I get all of the part codes (<code>Prt_Cd</code>) for the customer not just the ones for that visit. </p>\n\n<p>If it would help to see my unsuccessful queries or if I have left anything out sorry just let me know. Thanks for any help.</p>\n\n<p>--</p>\n\n<p>here is my subquery</p>\n\n<pre><code>stuff((\n                  select ',' + B.prt_cd\n                    from CUS_PRT B \n                    WHERE B.prt_cd = XREF.prt_cd  -- this is killing me\n                    and XREF.cus_id=B.cus_id and \n                    -- some extra criteria i need but didn't think involved in my issue\n                    B.prt_typ='1'  \n                    and B.valid_entry='Y' and B.cur_entry_ind='Y'\n                    for xml path('')),1,1,'')\n</code></pre>\n\n<p>here is my latest attempt. I added a new post because I didn't realize an edit would move it to the top of the list again... I think i need another subquery somewhere but not sure where and how to tie it to the other two queries.</p>\n\n<pre><code>select distinct CUS_EVENT.cus_id, CUS_EVENT.cus_visit_id,\n    (Select CUS_PRT.prt_cd + ',' AS [text()]\n    From CUS_PRT, CUS_XREF\n    where \n    CUS_EVENT.cus_id=XREF.cus_id\n    and CUS_EVENT.cus_event_id = XREF.cus_event_id \n    and CUS_XREF.cus_id=CUS_PRT.cus_id \n    and CUS_XREF.cus_prt_id = CUS_PRT.cus_prt_id \n    and CUS_XREF.prt_seq_no ='1'\n    order by CUS_PRT.prt_cd\n    for XML PATH('')) [Codes]\nfrom CUS_EVENT\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":30,"score":-1,"question_id":13261497,"title":"incorrect syntax near in creating stored procedure on a remote db","body":"<p>I am trying to recreate a stored procedure on a database which is hosted on a remote server.\nWhen creating the same SP locally I don't get any errors but when I am trying to create the SP on the remote server I am getting this errors:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Procedure MySP, Line 26\nIncorrect syntax near 'MERGE'.\nMsg 102, Level 15, State 1, Procedure MySP, Line 27\nIncorrect syntax near 'S'.\n</code></pre>\n\n<p>Those errors are repeating in multiple SP and I didn't get them when I created the SP's on my local server.\nAny idea what can that be?\nHere is a sample SP:</p>\n\n<pre><code>USE [MyDatabase]\nGO\n/****** Object:  StoredProcedure [dbo].[InsertContractorInfo]    Script Date: 11/07/2012 01:08:31 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n-- =============================================\n-- Author:      &lt;Author,,Name&gt;\n-- Create date: &lt;Create Date,,&gt;\n-- Description: &lt;Description,,&gt;\n-- =============================================\n--exec [dbo].[InsertContractorInfo] \nCREATE PROCEDURE [dbo].[InsertContractorInfo]\n(@CompanyName nvarchar(50), \n @LicenseNumber nvarchar(50),\n @MailingAddress1 nvarchar(200),\n @MailingAddress2 nvarchar(200),\n @Phone nvarchar(10),\n @Fax nvarchar(10),\n @Mobile nvarchar(10),\n @Email nvarchar(200),\n @PercentCommercial int,\n @PercentResidental int,\n @TotalEmployees int,\n @AnnualSales decimal(18,2),\n @InsuranceCompanyContact nvarchar(100)=null,\n @InsuranceCompanyContactEmail nvarchar(100)=null,\n @InsuranceCompanyContactPhone nvarchar(100)=null,\n @ContractorID uniqueidentifier)\nAS\nBEGIN\nMERGE dbo.Contractor con\nUSING(SELECT 1 S) S\nON con.Oid = @ContractorID\nWHEN MATCHED THEN UPDATE \n   SET       \n      [CompanyName] = @CompanyName      \n      ,[LicenseNumber] = @LicenseNumber\n      ,[MailingAddress1] = @MailingAddress1\n      ,[MailingAddress2] = @MailingAddress2\n      ,[Phone] = @Phone\n      ,[Fax] = @Fax\n      ,[EMail] =@Email\n      ,[Mobile] =@Mobile      \n      ,[PercentCommercial] = @PercentCommercial\n      ,[PercentResidental] = @PercentResidental\n      ,[TotalEmployees] = @TotalEmployees\n      ,[ApproximateAnnualSales] = @AnnualSales      \n      ,[InsuranceCompanyContact] = @InsuranceCompanyContact\n      ,[InsuranceCompanyContactPhone] = @InsuranceCompanyContactPhone\n      ,[InsuranceCompanyContactEmail] = @InsuranceCompanyContactEmail      \nWHEN NOT MATCHED THEN\nINSERT \n           ([Oid]       \n           ,[CompanyName]           \n           ,[LicenseNumber]\n           ,[MailingAddress1]\n           ,[MailingAddress2]\n           ,[Phone]\n           ,[Fax]\n           ,[EMail]\n           ,[Mobile]                      \n           ,[PercentCommercial]\n           ,[PercentResidental]\n           ,[TotalEmployees]\n           ,[ApproximateAnnualSales]                      \n           ,[InsuranceCompanyContact]\n           ,[InsuranceCompanyContactPhone]\n           ,[InsuranceCompanyContactEmail])\n     VALUES\n           (@ContractorId           \n           ,@CompanyName           \n           ,@LicenseNumber\n           ,@MailingAddress1\n           ,@MailingAddress2\n           ,@Phone\n           ,@Fax\n           ,@EMail\n           ,@Mobile\n           ,@PercentCommercial\n           ,@PercentResidental\n           ,@TotalEmployees\n           ,@AnnualSales                     \n           ,@InsuranceCompanyContact\n           ,@InsuranceCompanyContactPhone\n           ,@InsuranceCompanyContactEmail\n           );\nEND\nGO\n</code></pre>\n\n<p>Thanks, Laziale</p>\n"},{"tags":["c#","sql-server","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13259655,"title":"Data integrity in Entity Framework","body":"<p>Are there any consensus as to what is considered the best method in always maintaining data integrity in Entity Framework. i.e. when adding or deleting entities, how do I make sure the loaded model is the most recent, and that nothing has changed on the db behind my back?</p>\n\n<p>A rough method that seem to work for me in the majority of cases, is to reload the context between sessions, i.e. not to have a persistent model, and reload/refresh in case of an error. This seems to work in cases of low data clashes, however is very costly when lots of changes happen in different services. Is there a flag to query if the data/row on disk have changed or event to make this refresh automatic, i.e. update any subscribers of certain tables/rows?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":7,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":5392,"score":9,"question_id":2384786,"title":"Delete SQL Server 2005 records without logging","body":"<p>How to delete records from SQL Server 2005 tables without logging them into transaction logs. </p>\n\n<p>I do not wish to log because once deleted, those records will never be needed again. </p>\n\n<p>Currently the various deletes take too much of time. Are there any other options to improve performance of delete statements? I can not use truncate since there is a where clause needed.</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13244767,"title":"unable to read a particular cell from excel using reader","body":"<p>I am importing excel into sql server db the excel sheet has three columns :   </p>\n\n<blockquote>\n  <p>id(number only)|data|passport  </p>\n</blockquote>\n\n<p>before importing it i want to check for certain things such as:<br>\n\n<li>the passport should begin a letter and rest of the characters must be numbers </li>\n<li>id must be numeric only </li></p>\n\n<p>I am able to check for passport but i am not able to check id even though i am using same code i used for checking passport. </p>\n\n<pre><code>             using (DbDataReader dr = command.ExecuteReader())\n        {\n            // SQL Server Connection String\n            string sqlConnectionString = \"Data Source=DITSEC3;Initial Catalog=test;Integrated Security=True\";\n\n            con.Open();\n            DataTable dt7 = new DataTable();\n            dt7.Load(dr);\n            DataRow[] ExcelRows = new DataRow[dt7.Rows.Count];\n            DataColumn[] ExcelColumn = new DataColumn[dt7.Columns.Count];\n\n            //=================================================\n            for (int i1 = 0; i1 &lt; dt7.Rows.Count; i1++)\n            {\n\n                if (dt7.Rows[i1][\"passport\"] == null)\n                {\n                    dt7.Rows[i1][\"passport\"] = 0;\n\n                }\n                if (dt7.Rows[i1][\"id\"] == null)\n                {\n                    dt7.Rows[i1][\"id\"] = 0;\n                }\n\n                string a = Convert.ToString(dt7.Rows[i1][\"passport\"]);\n                string b = dt7.Rows[i1][\"id\"].ToString();\n\n                if (!string.IsNullOrEmpty(b))\n                {\n                    int idlen = b.Length;\n\n                    for (int j = 0; j &lt; idlen; j++)\n                    {\n                        if (Char.IsDigit(b[j]))\n                        {\n                            //action\n                        }\n                        if(!Char.IsDigit(b[j]))\n                        {\n                            flag = flag + 1;\n                            int errline = i1 + 2;\n                            Label12.Text = \"Error at line: \" + errline.ToString();\n                            //Label12.Visible = true;\n                        }\n                    }\n                    if (!String.IsNullOrEmpty(a))\n                    {\n                        int len = a.Length;\n\n                        for (int j = 1; j &lt; len; j++)\n                        {\n                            if (Char.IsLetter(a[0]) &amp;&amp; Char.IsDigit(a[j]) &amp;&amp; !Char.IsSymbol(a[j]))\n                            {\n                                //action\n                            }\n                            else\n                            {\n                                flag = flag + 1;\n                                int errline = i1 + 2;\n                                Label12.Text = \"Error at line: \" + errline.ToString();\n                                //Label12.Visible = true;\n                            }\n\n\n                    }\n                }\n\n\n\n\n                 }\n</code></pre>\n\n<p>For some strange reason when i use breakpoint i can see the values of id as long as id is numeric in excel the moment flow comes to cell which has id as 25h547 the value if b turn \"\" any reason for this? i can give you entire code if you require. </p>\n"},{"tags":["sql-server","tsql","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13243430,"title":"How to solve this variable pass into batch_date?","body":"<p>I want to pass in @batch date into batch_date...But it shows error...The error is </p>\n\n<blockquote>\n  <p>Column 'dbo.tnx_tid_InvCheck_Details.Batch_Date' is invalid in the\n  select list because it is not contained in either an aggregate\n  function or the GROUP BY clause.</p>\n</blockquote>\n\n<p>The <code>InvCheck_Details</code> table has <code>batch_date</code> for each and every <code>part_no</code>. I want to group the part_no so that I can count(tid) and sum(tid_bal) by part_no. What should i do in order to run this script? TQ...</p>\n\n<pre><code>DECLARE @batch_date datetime\nSET @batch_date = '2012-10-13 00:00:00.000'\n\n\n\nCREATE TABLE #inv_check\n(batch_date datetime,part_no varchar(25),Number_of_tid int,Updated_DT int, Tot_Tid_Bal int)\n\nINSERT INTO #inv_check\nSELECT batch_date,part_no,COUNT(tid)as Number_of_tid,0,sum(Tid_Bal)\nFROM dbo.tnx_tid_InvCheck_Details\nwhere batch_date = @batch_date\nGroup by part_no\norder by part_no\n\nUPDATE #inv_check \nSET Updated_DT = isnull(d.Updated_DT,0) \n--select i.part_no,i.Number_of_tid, isnull(d.Updated_DT,0)\nFROM #inv_check i\nLEFT OUTER JOIN \n    (SELECT part_no, COUNT(LastUpdate_DT)as Updated_DT,\n    sum(tid_bal) as Tid_bal_sum\n    FROM dbo.tnx_tid_InvCheck_Details\n    Where NOT LastUpdate_DT IS NULL\n    Group by part_no) d on i.part_no=d.part_no  \n\n\n\n    DECLARE @sql int\n    DECLARE @sql1 int\n\n\nSELECT @sql1 = count(part_no) \nFROM #inv_check\n\nSELECT @sql = count(part_no)\nFROM #inv_check\nWHERE number_of_tid= Updated_DT\n\nSELECT @sql AS Parts_Counted,@sql1 AS Full_Parts\n\nDrop table #inv_check\n</code></pre>\n"},{"tags":["c#","sql-server","vs2010-express"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":130,"score":0,"question_id":13213644,"title":"Windows Form Application and SQL Server","body":"<p><strong>UPDATE 2</strong></p>\n\n<p>I fixed the error by adding <code>System.Configuration</code> to the reference file.   I had already added it to my class with <code>using System.Configuration;</code><br>\nI found the answer here: <a href=\"http://stackoverflow.com/questions/1274852/the-name-configurationmanager-does-not-exist-in-the-current-context/1836938#comment18074599_1836938\">The name 'ConfigurationManager' does not exist in the current context</a></p>\n\n<p>Any further issues will be addressed in a new question.</p>\n\n<p><strong>Original(ish) Post</strong></p>\n\n<p>I have Microsoft SQL Server Management Studio. In the studio I created a database called <code>Logbook</code> that exists locally on my computer.   </p>\n\n<p>I have also created a user interface using a Windows forms application in VS C# Express. I would like to connect it to my logbook database in order to update, select, delete, and insert entries into the database through the UI.</p>\n\n<p>However, I cannot figure out how connect the two. I have played around with the \"Add new data source\" wizard to no avail. I also cannot find anything helpful in the MSDN or other tutorials online.   </p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I created a new database and project to work with until I figure out how to properly do this so I don't accidently break anything in my project.<br>\nThe Schema is:</p>\n\n<pre><code>Student(sid: int, fname: char(10), lname: char(10), age:int, major:char(10))\nCourse(cid:int, desc:char(50), dept:char(10))\nEnrolled(sid:int, cid:int, quarter:char(10), grade:char(10))\n</code></pre>\n\n<p>Here is the connection string generated by the \"Add Data Source\" wizard</p>\n\n<pre><code>&lt;add name=\"boathouseLogConnectionString\"\n        connectionString=\"Data Source=.\\SQLEXPRESS;AttachDbFilename=&amp;quot;C:\\Program Files\\Microsoft SQL Server\\MSSQL11.SQLEXPRESS\\MSSQL\\DATA\\boathouseLog.mdf&amp;quot;;Integrated Security=True;Connect Timeout=30;User Instance=True\"\n        providerName=\"System.Data.SqlClient\" /&gt;\n</code></pre>\n\n<p>I have successfully gotten my database into the project.  However, when I try running a stored procedure I get this error <code>Argument Exception was unhandled.  Format of the initialization string does not conform to specification starting at index 0.</code></p>\n\n<p>The error occurs on line 2.  </p>\n\n<pre><code>        DataTable dt = new DataTable();\n        SqlConnection sqlConn = new SqlConnection(selectedConnectionString);\n        SqlCommand myCommand = new SqlCommand(\"proc_getMember\", sqlConn);\n        myCommand.CommandType = CommandType.StoredProcedure;\n        SqlDataAdapter da = new SqlDataAdapter(myCommand); \n</code></pre>\n\n<p>the <code>selectedConnectionString</code> variable is set to <code>boathouseLogConnectionString</code></p>\n"},{"tags":["sql-server","tsql"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":544,"score":3,"question_id":1070741,"title":"MS SQL Stored Procedure Problem","body":"<p>I have a stored procedure that works fine on my local SQL Server (2005 or 2008 cant recall off hand) but fails when I try to create the procedure on the Production server (SQL 2000). \nAny help would be appreciated. TIA. </p>\n\n<p>The stored procedure declaration is this:</p>\n\n<pre><code>/****** Object:  StoredProcedure [dbo].[AssignPCSCheckNumbers]    Script Date: 06/29/2009 13:12:24 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE PROCEDURE [dbo].[AssignPCSCheckNumbers]          \n(          \n    @MonthEnd    DATETIME,          \n    @Seed        INT,          \n    @ManifestKey UNIQUEIDENTIFIER,          \n    @Threshold   DECIMAL(9,2)          \n)          \n\nAS          \n\nSET NOCOUNT ON          \n\nBEGIN          \n\n\n--Create a temporary table variable to store our data          \nDECLARE @MyTemp TABLE \n( \n     ProducerNumber VARCHAR(20), \n     LastCheckDate DATETIME, \n     Due DECIMAL(9,2) DEFAULT 0,\n     Returned DECIMAL(9,2) DEFAULT 0          \n)\n\n--Fill the table with a listing of producers from our PCSItems table and their ACH Status\nINSERT INTO @MyTemp ( ProducerNumber ) \nSELECT      PCSItems.ProducerNumber \nFROM        PCSItems\nLEFT JOIN   Producer\nON          PCSItems.ProducerNumber = Producer.prodNum\nWHERE       ISNULL(Producer.PayCommissionByACH,0) = 0\n\n--UPDATE the table with the last time a check was printed for each\n--of these producers\nUPDATE      @MyTemp\nSET         LastCheckDate = (\nSELECT      ISNULL(MAX(EntryDate),'1/1/1901') \nFROM        CommissionLedger WITH (NOLOCK)\nWHERE       CommissionLedger.TransactionType = 1\nAND         CommissionLedger.ProducerNumber = [@MyTemp].ProducerNumber\n)\n\n\n--update the table with the amount of comission owed to each producer          \nUPDATE      @MyTemp           \nSET         Due = (\nSELECT      IsNull(SUM(CommPaid),0)          \nFROM        ProducerComm WITH (NOLOCK)          \nWHERE       ProducerComm.CommApplies = [@MyTemp].ProducerNumber\nAND         ProducerComm.EntryDate &gt;= LastCheckDate\nAND         ProducerComm.EntryDate &lt;= @MonthEnd\n)          \n\n--update the table with the amount of commission returned by each producer                             \nUPDATE      @MyTemp          \nSET         Returned = (\nSELECT      ISNULL(SUM(Amount), 0)\nFROM        CommissionLedger WITH (NOLOCK)          \nWHERE       CommissionLedger.ProducerNumber = [@MyTemp].ProducerNumber          \nAND         CommissionLedger.EntryDate  &gt;= [@MyTemp].LastCheckDate          \nAND         CommissionLedger.EntryDate  &lt;= @MonthEnd\n)\n\n--create a table to assist with our operations          \nDECLARE @MyFinal TABLE \n(\n    ID INT IDENTITY(1,1),           \n    ProducerNumber VARCHAR(10)          \n)\n\n--just insert the producers that are owed an amount over a user specified           \n--threshold          \nINSERT INTO @MyFinal ( ProducerNumber )           \nSELECT      ProducerNumber          \nFROM        @MyTemp          \nWHERE       (Due + Returned) &gt; @Threshold           \n\n--update our items with the check numbers finally =)          \nUPDATE      PCSItems           \nSET         CheckNumber = (SELECT  (([@MyFinal].ID - 1) + @Seed)      \n                           FROM    @MyFinal          \n                           WHERE   [@MyFinal].ProducerNumber = PCSItems.ProducerNumber)          \n\nSET NOCOUNT OFF          \n\nEND\nGO\n</code></pre>\n\n<p>And the error the server responds with is this:</p>\n\n<pre><code>Msg 107, Level 16, State 2, Procedure AssignPCSCheckNumbers, Line 35\nThe column prefix '@MyTemp' does not match with a table name or alias name used in the query.\nMsg 107, Level 16, State 2, Procedure AssignPCSCheckNumbers, Line 45\nThe column prefix '@MyTemp' does not match with a table name or alias name used in the query.\nMsg 107, Level 16, State 2, Procedure AssignPCSCheckNumbers, Line 55\nThe column prefix '@MyTemp' does not match with a table name or alias name used in the query.\nMsg 107, Level 16, State 2, Procedure AssignPCSCheckNumbers, Line 55\nThe column prefix '@MyTemp' does not match with a table name or alias name used in the query.\nMsg 107, Level 16, State 2, Procedure AssignPCSCheckNumbers, Line 79\nThe column prefix '@MyFinal' does not match with a table name or alias name used in the query.\nMsg 107, Level 16, State 2, Procedure AssignPCSCheckNumbers, Line 79\nThe column prefix '@MyFinal' does not match with a table name or alias name used in the query.\n</code></pre>\n"},{"tags":["sql-server","common-table-expression","table-variable"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13186684,"title":"Common Table Expressions slow when using a table variable","body":"<p>I have been experimenting with the following (simplified) CTE. When using a table variable () the query runs for minutes before I cancel it. Any of the other commented out methods return in less than a second. </p>\n\n<p>If I replace the whole WHERE clause with an INNER JOIN it is fast as well. </p>\n\n<p>Any ideas why using a table variable would run so slowly?</p>\n\n<p>FWIW: The database contains 2.5 million records and the inner query returns 2 records. </p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE TABLE #rootTempTable (RootID int PRIMARY KEY)\nINSERT INTO #rootTempTable VALUES (1360);\n\nDECLARE @rootTableVar TABLE (RootID int PRIMARY KEY);\nINSERT INTO @rootTableVar VALUES (1360);\n\nWITH My_CTE AS \n(\n      SELECT ROW_NUMBER() OVER(ORDER BY d.DocumentID) rownum, d.DocumentID, d.Title\n      FROM [Document] d\n      WHERE d.LocationID IN \n        (\n              SELECT LocationID \n              FROM Location \n                    JOIN @rootTableVar rtv ON Location.RootID = rtv.RootID -- VERY SLOW!\n                    --JOIN #rootTempTable tt ON Location.RootID = tt.RootID -- Fast\n                    --JOIN (SELECT 1360 as RootID) AS rt ON Location.RootID = rt.RootID -- Fast\n                    --WHERE RootID = 1360 -- Fast\n        )           \n) \nSELECT * FROM My_CTE WHERE (rownum &gt; 0) AND (rownum &lt;= 100) ORDER BY rownum\n</code></pre>\n\n<p>This is from when using the table variable. The query took over 17 minutes to run:\n<img src=\"http://i.stack.imgur.com/ZJXzP.png\" alt=\"enter image description here\"></p>\n\n<p><strong>Execution plans in XML format</strong></p>\n\n<p>Temp table: <a href=\"https://docs.google.com/open?id=0B66I-fxlyEtEZEthV3ZaWlNLWXM\" rel=\"nofollow\">https://docs.google.com/open?id=0B66I-fxlyEtEZEthV3ZaWlNLWXM</a></p>\n\n<p>Table variable: <a href=\"https://docs.google.com/open?id=0B66I-fxlyEtEbUFZa3RJejFCTkk\" rel=\"nofollow\">https://docs.google.com/open?id=0B66I-fxlyEtEbUFZa3RJejFCTkk</a></p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures","dynamic-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13259850,"title":"Dynamic SQL and stored procedure optimization","body":"<p>I've read that using Dynamic SQL in a stored procedure can hurt performance of your stored procedures. I guess the theory is that the store procedure won't store an execution plan for SQL executed via EXEC or sp_executesql.</p>\n\n<p>I want to know if this is true. If it is true, do I have the same problem with multiple nested IF blocks, each one with a different \"version\" of my SQL statement?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":1526,"score":2,"question_id":2561130,"title":"Merge overlapping date intervals","body":"<p>Is there a better way of merging overlapping date intervals?<br>\nThe solution I came up with is so simple that now I wonder if someone else has a better idea of how this could be done.</p>\n\n<pre><code>/***** DATA EXAMPLE *****/\nDECLARE @T TABLE (d1 DATETIME, d2 DATETIME)\nINSERT INTO @T (d1, d2)\n        SELECT '2010-01-01','2010-03-31' UNION SELECT '2010-04-01','2010-05-31' \n  UNION SELECT '2010-06-15','2010-06-25' UNION SELECT '2010-06-26','2010-07-10' \n  UNION SELECT '2010-08-01','2010-08-05' UNION SELECT '2010-08-01','2010-08-09' \n  UNION SELECT '2010-08-02','2010-08-07' UNION SELECT '2010-08-08','2010-08-08' \n  UNION SELECT '2010-08-09','2010-08-12' UNION SELECT '2010-07-04','2010-08-16' \n  UNION SELECT '2010-11-01','2010-12-31' UNION SELECT '2010-03-01','2010-06-13' \n\n/***** INTERVAL ANALYSIS *****/\nWHILE (1=1)  BEGIN\n  UPDATE t1 SET t1.d2 = t2.d2\n  FROM @T AS t1 INNER JOIN @T AS t2 ON \n            DATEADD(day, 1, t1.d2) BETWEEN t2.d1 AND t2.d2 \n  IF @@ROWCOUNT = 0 BREAK\nEND\n\n/***** RESULT *****/\nSELECT StartDate = MIN(d1) , EndDate = d2\nFROM @T\nGROUP BY d2\nORDER BY StartDate, EndDate\n\n/***** OUTPUT *****/\n/*****\nStartDate   EndDate\n2010-01-01  2010-06-13 \n2010-06-15  2010-08-16 \n2010-11-01  2010-12-31 \n*****/\n</code></pre>\n"},{"tags":["sql-server","reporting-services","parameters","ssrs-2008","ssrs-reports"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":3401,"score":4,"question_id":5252588,"title":"SSRS 2008: error message saying my parameter doesn't exist but it clearly does?","body":"<p>I have a report that has about 10 parameters and about 10 datasets and one datasource.  I typed alot but I really need help so I figured I would try and provide as much info about the problem as I could right from the start.      </p>\n\n<p>Let's simplify it all and pretend these are the relevant names of everything and that the report gets basic employee information:</p>\n\n<ul>\n<li>Parameters\n<ul>\n<li>facilityID: text in the format of a guid or uniqueidentifier, this is hidden and passed in so that the end user of the report can only view info for their own facility;  Single valued parameter, not blank not null, hidden, text</li>\n<li>startDate: start date range, let's say I want my report to include data starting Jan 1 this year; Single valued parameter, not blank not null, visible, datetime</li>\n<li>endDate:  end of the date range, let's say it's today/now; Single valued parameter, not blank not null, visible, datetime</li>\n<li><strong>viewOption</strong>:  three hard-coded values (label, value) (\"Current Employees\",1) and (\"Past Employees\",2) and (\"Employees that moved facilities\",3); Multi-valued Parameter (so select all is an option), not blank, not null, visible, text</li>\n<li>personID: based on the dataset getListOfNames where the label is the employee name and the value is their personID (guid/uniqueidentifier); Single select, not null, not blank, text and visible<br></li>\n</ul></li>\n<li>My Data Sets \n<ul>\n<li>getListOfNames:  this gets a list of people that were at the company in the provided date range at the given facility and where their employee status is in the viewOption parameter value (so it can be just one number or up to three).  This is a stored procedure but I have set up it to handle the multi-valued parameter by passing it join(parameter, \"~\") and then separating it out in the stored proc.  This works on 5 other reports.  </li>\n<li>getReportInfoOnSelectedPerson: main body query; after the user selects the employee they want data on, this takes that personID and the date range and fills the main table. </li>\n</ul></li>\n</ul>\n\n<p>The problem:<br>\nSSRS says viewOption doesn't exist.  But I see it, right there, in the Parameters folder on the left hand side.  I see it when I go to enter an expression under Parameters.  There is no squiggly red line under Parameters!viewOption.value.  But, when I try and put it as a value for a parameter used by the getListOfNames dataset, it errors.  If I put it in the getReportInfoOnSelectedPerson dataset and use it in the exact same way, SSRS is okay with that.  Wtf?  So... I have checked the rdl and everything is fine (where the actual parameter is declared, where it is used in the dataset reference, everything).  It's just this one dataset.  And I have a similar report that uses the same data set, same basic parameters and that report is fine.  I try setting the value of the dataset parameter to 1 or something and that is fine but when I try and set it to Parameter!viewOption.value it errors..... Now, above I said i normally pass the stored proc a Join on the paramater with a tilde ~ but I am trying to keep it simple and either get it to just work in general (either by passing it the first value of the multivalue viewOption parameter or turning that parameter into a single select and just passing the .value) but the join doesnt work either.  All of those things work for the other dataset, which is also a stored proc.  </p>\n\n<p><strong>This is my error:<br>\nAn error has occurred during report processing. (rsProcessingAborted)  The Value expression for the query parameter @viewOption contains an error: The expression referenced a non-existing parameter in the report parameters collection. (rsRuntimeErrorInExpression)</strong></p>\n\n<p>Which is clearly saying my parameter doesn't exist but I can SEE it... everywhere.  And  if I assign one of the other datasets' parameter values to the viewOption parameter it works without an error.  I've checked the rdl.</p>\n\n<p>I've had this problem before and it was fixed by deleting both the parameter and dataset and creating them again (for safety I renamed both of them).  That didn't work this time.</p>\n\n<p>I am so frustrated.  Please help....   </p>\n\n<p>Code? </p>\n\n<pre><code>      &lt;DataSet Name=\"getListOfNames\"&gt;\n      &lt;Fields&gt;\n          &lt;Field Name=\"personID\"&gt;\n              &lt;DataField&gt;PersonId&lt;/DataField&gt;\n              &lt;rd:TypeName&gt;System.Guid&lt;/rd:TypeName&gt;\n          &lt;/Field&gt;\n          &lt;Field Name=\"name\"&gt;\n              &lt;DataField&gt;name&lt;/DataField&gt;\n              &lt;rd:TypeName&gt;System.String&lt;/rd:TypeName&gt;\n          &lt;/Field&gt;\n      &lt;/Fields&gt;\n      &lt;Query&gt;\n          &lt;DataSourceName&gt;myDataSource&lt;/DataSourceName&gt;\n          &lt;CommandType&gt;StoredProcedure&lt;/CommandType&gt;\n          &lt;CommandText&gt;getListOfNames&lt;/CommandText&gt;\n          &lt;QueryParameters&gt;\n              &lt;QueryParameter Name=\"@fac\"&gt;\n                  &lt;Value&gt;=join(Parameters!fac.Value,\"~\")&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n              &lt;QueryParameter Name=\"@bldg\"&gt;\n                  &lt;Value&gt;=join(Parameters!bldg.Value,\"~\")&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n              &lt;QueryParameter Name=\"@unit\"&gt;\n                  &lt;Value&gt;=join(Parameters!unit.Value,\"~\")&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n              &lt;QueryParameter Name=\"@station\"&gt;\n                  &lt;Value&gt;=join(Parameters!station.Value,\"~\")&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n              &lt;QueryParameter Name=\"@startDate\"&gt;\n                  &lt;Value&gt;=Parameters!startDate.Value&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n              &lt;QueryParameter Name=\"@endDate\"&gt;\n                  &lt;Value&gt;=Parameters!endDate.Value&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n              &lt;QueryParameter Name=\"@viewOption\"&gt;\n                  &lt;Value&gt;=Join(Parameters!viewOption.Value, \"~\")&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n          &lt;/QueryParameters&gt;\n          &lt;rd:UseGenericDesigner&gt;true&lt;/rd:UseGenericDesigner&gt;\n      &lt;/Query&gt;\n  &lt;/DataSet&gt;\n\n\n\n&lt;ReportParameter Name=\"viewOption\"&gt;\n  &lt;DataType&gt;String&lt;/DataType&gt;\n  &lt;DefaultValue&gt;\n    &lt;Values&gt;\n      &lt;Value&gt;1&lt;/Value&gt;\n    &lt;/Values&gt;\n  &lt;/DefaultValue&gt;\n  &lt;Prompt&gt;View&lt;/Prompt&gt;\n  &lt;ValidValues&gt;\n    &lt;DataSetReference&gt;\n      &lt;DataSetName&gt;viewOptionQuery&lt;/DataSetName&gt;\n      &lt;ValueField&gt;value&lt;/ValueField&gt;\n      &lt;LabelField&gt;label&lt;/LabelField&gt;\n    &lt;/DataSetReference&gt;\n  &lt;/ValidValues&gt;\n  &lt;MultiValue&gt;true&lt;/MultiValue&gt;\n&lt;/ReportParameter&gt;\n\n\n\n&lt;DataSet Name=\"viewOptionQuery\"&gt;\n  &lt;Fields&gt;\n    &lt;Field Name=\"label\"&gt;\n      &lt;DataField&gt;label&lt;/DataField&gt;\n      &lt;rd:TypeName&gt;System.String&lt;/rd:TypeName&gt;\n    &lt;/Field&gt;\n    &lt;Field Name=\"value\"&gt;\n      &lt;DataField&gt;value&lt;/DataField&gt;\n      &lt;rd:TypeName&gt;System.Int32&lt;/rd:TypeName&gt;\n    &lt;/Field&gt;\n  &lt;/Fields&gt;\n  &lt;Query&gt;\n    &lt;DataSourceName&gt;flamingo&lt;/DataSourceName&gt;\n    &lt;CommandText&gt;select 'Other Facility' as label, 3 as value union select 'Past' as label, 2 as value union select 'Current' as label, 1 as value order by value&lt;/CommandText&gt;\n    &lt;rd:UseGenericDesigner&gt;true&lt;/rd:UseGenericDesigner&gt;\n  &lt;/Query&gt;\n&lt;/DataSet&gt;\n</code></pre>\n\n<p>This is how it is set up and getListOfNames is why the error is throw, if I change</p>\n\n<pre><code>              &lt;QueryParameter Name=\"@viewOption\"&gt;\n                  &lt;Value&gt;=Join(Parameters!viewOption.Value, \"~\")&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n</code></pre>\n\n<p>to</p>\n\n<pre><code>              &lt;QueryParameter Name=\"@viewOption\"&gt;\n                  &lt;Value&gt;=\"1~2\"&lt;/Value&gt;\n              &lt;/QueryParameter&gt;\n</code></pre>\n\n<p>then it works.... or the value can be just 1 or 1~2~3</p>\n\n<p>However... when I try and put join(Parameters!viewOption.value,\"~\") as the value for another dataset's query parameter it works and there is no error.  </p>\n\n<pre><code>  &lt;DataSet Name=\"getReportInfoOnSelectedPerson\"&gt;\n  &lt;Fields&gt;\n    &lt;Field Name=\"name\"&gt;\n      &lt;DataField&gt;name&lt;/DataField&gt;\n      &lt;rd:TypeName&gt;System.String&lt;/rd:TypeName&gt;\n    &lt;/Field&gt; \n    &lt;Field Name=\"Building\"&gt;\n      &lt;DataField&gt;Building&lt;/DataField&gt;\n      &lt;rd:TypeName&gt;System.String&lt;/rd:TypeName&gt;\n    &lt;/Field&gt;\n    &lt;Field Name=\"Unit\"&gt;\n      &lt;DataField&gt;Unit&lt;/DataField&gt;\n      &lt;rd:TypeName&gt;System.String&lt;/rd:TypeName&gt;\n    &lt;/Field&gt;\n    &lt;Field Name=\"desc\"&gt;\n      &lt;DataField&gt;desc&lt;/DataField&gt;\n      &lt;rd:TypeName&gt;System.String&lt;/rd:TypeName&gt;\n    &lt;/Field&gt; \n  &lt;/Fields&gt;\n  &lt;Query&gt;\n    &lt;DataSourceName&gt;myDataSource&lt;/DataSourceName&gt;\n    &lt;CommandType&gt;StoredProcedure&lt;/CommandType&gt;\n    &lt;CommandText&gt;Reports_BasicInfo&lt;/CommandText&gt;\n    &lt;QueryParameters&gt;\n      &lt;QueryParameter Name=\"@personID\"&gt;\n        &lt;Value&gt;=Parameters!personID.Value&lt;/Value&gt;\n      &lt;/QueryParameter&gt;\n      &lt;QueryParameter Name=\"@numberINeedToAggregateData\"&gt;\n        &lt;Value&gt;=Join(Parameters!viewOption.Value,\"~\")&lt;/Value&gt;\n        &lt;rd:UserDefined&gt;true&lt;/rd:UserDefined&gt;\n      &lt;/QueryParameter&gt;\n    &lt;/QueryParameters&gt;\n    &lt;rd:UseGenericDesigner&gt;true&lt;/rd:UseGenericDesigner&gt;\n  &lt;/Query&gt;\n&lt;/DataSet&gt;\n</code></pre>\n\n<p>And I already said this, but the stored proc/dataset that throws the error uses a parameter with the same set up in about 5 other reports (I have tried copying and pasting the relevant code sections from working reports but I still get the error).  So, what's wrong with this one?</p>\n"},{"tags":["sql-server","asp.net-mvc","linq","entity-framework","sql-server-2008-r2"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":178,"score":1,"question_id":12928463,"title":"Sometimes get Timeout expired exception with Linq to EF and after a restart of server, it works fine","body":"<p>I have hosted my website at rackspace cloud server.</p>\n\n<p>Sometimes I get the below exception while fetching records from database. The strange thing is that everything works fine for a few days after a restart and also I get this exception in only a few places and not everywhere.</p>\n\n<pre><code>Exception: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.\n\nException Details: System.Data.SqlClient.SqlException: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.\n\nStack Trace:\n\n\n[SqlException (0x80131904): Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.]\n   System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection) +404\n   System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning() +412\n   System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj) +1363\n   System.Data.SqlClient.SqlDataReader.ConsumeMetaData() +59\n   System.Data.SqlClient.SqlDataReader.get_MetaData() +118\n   System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString) +6387937\n   System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async) +6389506\n   System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result) +538\n   System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method) +28\n   System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method) +256\n   System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior) +19\n   System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand entityCommand, CommandBehavior behavior) +553\n\n[EntityCommandExecutionException: An error occurred while executing the command definition. See the inner exception for details.]\n   DataAccessLayer.dbCustomer.CompanyCustomerByLocationId(String sortExpression, Boolean asc, String nameSearchString, Int32 startRowIndex, Int32 maximumRows, Int32&amp; TotalRecord, Int64 companyId) in D:\\Dotnet Projects\\FutureZoom\\FutureZoom\\DataAccessLayer\\dbCustomer.cs:508\n   BusinessLogic.Customer.CompanyCustomerByLocationId(String sortExpression, Boolean asc, String nameSearchString, Int32 startRowIndex, Int32 maximumRows, Int64 CompanyId) in D:\\Dotnet Projects\\FutureZoom\\FutureZoom\\BusinessLogic\\Customer.cs:431\n   FutureZoom.Areas.Admin.Controllers.CompanyController.CustomerPaging(Int32 StartIndex, Int32 PageSize, String SortExp, Boolean Asc, String SearchExp, String Where) in D:\\Dotnet Projects\\FutureZoom\\FutureZoom\\FutureZoom\\Areas\\Admin\\Controllers\\CompanyController.cs:552\n   lambda_method(Closure , ControllerBase , Object[] ) +362\n   System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext controllerContext, IDictionary`2 parameters) +248\n   System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext controllerContext, ActionDescriptor actionDescriptor, IDictionary`2 parameters) +39\n   System.Web.Mvc.&lt;&gt;c__DisplayClass15.&lt;InvokeActionMethodWithFilters&gt;b__12() +125\n   System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodFilter(IActionFilter filter, ActionExecutingContext preContext, Func`1 continuation) +640\n   System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodWithFilters(ControllerContext controllerContext, IList`1 filters, ActionDescriptor actionDescriptor, IDictionary`2 parameters) +312\n   System.Web.Mvc.ControllerActionInvoker.InvokeAction(ControllerContext controllerContext, String actionName) +691\n   System.Web.Mvc.Controller.ExecuteCore() +162\n   System.Web.Mvc.ControllerBase.Execute(RequestContext requestContext) +305\n   System.Web.Mvc.&lt;&gt;c__DisplayClassb.&lt;BeginProcessRequest&gt;b__5() +62\n   System.Web.Mvc.Async.&lt;&gt;c__DisplayClass1.&lt;MakeVoidDelegate&gt;b__0() +20\n   System.Web.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +469\n   System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously) +375\n</code></pre>\n\n<p>My Linq query is mentioned below</p>\n\n<pre><code>query = context.Customers.Include(\"Company\").Include(\"Company.EmailCampaignerStatus\")\n                                           .OrderBy(m =&gt; m.EmailCampaignerStatus.FirstOrDefault().CreatedOn)                                           \n                                           .Where(m =&gt; m.FirstName.StartsWith(name) || m.LastName.StartsWith(name) || m.Email.StartsWith(name) || (m.FirstName + \" \" + m.LastName).StartsWith(name))\n                                           .Where(m =&gt; m.CompanyId == companyId)\n                                           .Where(m =&gt; m.CompanyLocationId == locationId)\n                                           .Skip(startRowIndex == 0 ? startRowIndex : startRowIndex - 1)\n                                           .Take(maximumRows)\n                                           .ToList();\n</code></pre>\n\n<p>Execution time for this query is not even 1 second on my local machine and also the same at server side after a restart but the execution time increases day by day and it fails to execute after few days (sometime fails and sometimes gives result).</p>\n\n<p>I observed that it took 31.05sec and fails and it take 51.09 sec and fails. Sometimes it takes more than 2 mins and gives result.</p>\n\n<p>I talked with rackspace people but they were unable to trace the actual cause for the same.</p>\n\n<p>Edit 1: I have seen below queries in SQL Profiler against my paging query</p>\n\n<pre><code>SELECT \n[Project3].[Id1] AS [Id], \n[Project3].[C1] AS [C1], \n[Project3].[Id] AS [Id1], \n[Project3].[CompanyId] AS [CompanyId], \n[Project3].[CompanyLocationId] AS [CompanyLocationId], \n[Project3].[FirstName] AS [FirstName], \n[Project3].[LastName] AS [LastName], \n[Project3].[Email] AS [Email], \n[Project3].[Address1] AS [Address1], \n[Project3].[Address2] AS [Address2], \n[Project3].[City] AS [City], \n[Project3].[State] AS [State], \n[Project3].[Country] AS [Country], \n[Project3].[Zip] AS [Zip], \n[Project3].[Phone] AS [Phone], \n[Project3].[SaleDate] AS [SaleDate], \n[Project3].[Notes] AS [Notes], \n[Project3].[Cost] AS [Cost], \n[Project3].[CreatedOn] AS [CreatedOn], \n[Project3].[ModifiedOn] AS [ModifiedOn], \n[Project3].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], \n[Project3].[Id2] AS [Id2], \n[Project3].[SubscriptionTypeId] AS [SubscriptionTypeId], \n[Project3].[PlanFeeAmount] AS [PlanFeeAmount], \n[Project3].[LoginId] AS [LoginId], \n[Project3].[IndustryTypeId] AS [IndustryTypeId], \n[Project3].[CompanyName] AS [CompanyName], \n[Project3].[NumberOfLocations] AS [NumberOfLocations], \n[Project3].[LogoImageName] AS [LogoImageName], \n[Project3].[WebsiteUrl] AS [WebsiteUrl], \n[Project3].[blsActive] AS [blsActive], \n[Project3].[Pending] AS [Pending], \n[Project3].[ExpiryDate] AS [ExpiryDate], \n[Project3].[C2] AS [C2], \n[Project3].[Id3] AS [Id3], \n[Project3].[UploadTicketId] AS [UploadTicketId], \n[Project3].[UploadStatus] AS [UploadStatus], \n[Project3].[CompanyId1] AS [CompanyId1], \n[Project3].[CompanyLocationId1] AS [CompanyLocationId1], \n[Project3].[CustomerId] AS [CustomerId], \n[Project3].[CreatedOn2] AS [CreatedOn1]\nFROM ( SELECT \n    [Limit2].[Id] AS [Id], \n    [Limit2].[CompanyId] AS [CompanyId], \n    [Limit2].[CompanyLocationId] AS [CompanyLocationId], \n    [Limit2].[FirstName] AS [FirstName], \n    [Limit2].[LastName] AS [LastName], \n    [Limit2].[Email] AS [Email], \n    [Limit2].[Address1] AS [Address1], \n    [Limit2].[Address2] AS [Address2], \n    [Limit2].[City] AS [City], \n    [Limit2].[State] AS [State], \n    [Limit2].[Country] AS [Country], \n    [Limit2].[Zip] AS [Zip], \n    [Limit2].[Phone] AS [Phone], \n    [Limit2].[SaleDate] AS [SaleDate], \n    [Limit2].[Notes] AS [Notes], \n    [Limit2].[Cost] AS [Cost], \n    [Limit2].[CreatedOn] AS [CreatedOn], \n    [Limit2].[ModifiedOn] AS [ModifiedOn], \n    [Limit2].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], \n    [Limit2].[Id1] AS [Id1], \n    [Limit2].[CreatedOn1] AS [CreatedOn1], \n    [Limit2].[Id2] AS [Id2], \n    [Limit2].[SubscriptionTypeId] AS [SubscriptionTypeId], \n    [Limit2].[PlanFeeAmount] AS [PlanFeeAmount], \n    [Limit2].[LoginId] AS [LoginId], \n    [Limit2].[IndustryTypeId] AS [IndustryTypeId], \n    [Limit2].[CompanyName] AS [CompanyName], \n    [Limit2].[NumberOfLocations] AS [NumberOfLocations], \n    [Limit2].[WebsiteUrl] AS [WebsiteUrl], \n    [Limit2].[blsActive] AS [blsActive], \n    [Limit2].[Pending] AS [Pending], \n    [Limit2].[ExpiryDate] AS [ExpiryDate], \n    [Limit2].[LogoImageName] AS [LogoImageName], \n    [Limit2].[C1] AS [C1], \n    [Extent4].[Id] AS [Id3], \n    [Extent4].[UploadTicketId] AS [UploadTicketId], \n    [Extent4].[UploadStatus] AS [UploadStatus], \n    [Extent4].[CompanyId] AS [CompanyId1], \n    [Extent4].[CompanyLocationId] AS [CompanyLocationId1], \n    [Extent4].[CustomerId] AS [CustomerId], \n    [Extent4].[CreatedOn] AS [CreatedOn2], \n    CASE WHEN ([Extent4].[Id] IS NULL) THEN CAST(NULL AS int) ELSE 1 END AS [C2]\n    FROM   (SELECT TOP (20) [Project2].[Id] AS [Id], [Project2].[CompanyId] AS [CompanyId], [Project2].[CompanyLocationId] AS [CompanyLocationId], [Project2].[FirstName] AS [FirstName], [Project2].[LastName] AS [LastName], [Project2].[Email] AS [Email], [Project2].[Address1] AS [Address1], [Project2].[Address2] AS [Address2], [Project2].[City] AS [City], [Project2].[State] AS [State], [Project2].[Country] AS [Country], [Project2].[Zip] AS [Zip], [Project2].[Phone] AS [Phone], [Project2].[SaleDate] AS [SaleDate], [Project2].[Notes] AS [Notes], [Project2].[Cost] AS [Cost], [Project2].[CreatedOn] AS [CreatedOn], [Project2].[ModifiedOn] AS [ModifiedOn], [Project2].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], [Project2].[Id1] AS [Id1], [Project2].[CreatedOn1] AS [CreatedOn1], [Project2].[Id2] AS [Id2], [Project2].[SubscriptionTypeId] AS [SubscriptionTypeId], [Project2].[PlanFeeAmount] AS [PlanFeeAmount], [Project2].[LoginId] AS [LoginId], [Project2].[IndustryTypeId] AS [IndustryTypeId], [Project2].[CompanyName] AS [CompanyName], [Project2].[NumberOfLocations] AS [NumberOfLocations], [Project2].[WebsiteUrl] AS [WebsiteUrl], [Project2].[blsActive] AS [blsActive], [Project2].[Pending] AS [Pending], [Project2].[ExpiryDate] AS [ExpiryDate], [Project2].[LogoImageName] AS [LogoImageName], [Project2].[C1] AS [C1]\n        FROM ( SELECT [Project2].[Id] AS [Id], [Project2].[CompanyId] AS [CompanyId], [Project2].[CompanyLocationId] AS [CompanyLocationId], [Project2].[FirstName] AS [FirstName], [Project2].[LastName] AS [LastName], [Project2].[Email] AS [Email], [Project2].[Address1] AS [Address1], [Project2].[Address2] AS [Address2], [Project2].[City] AS [City], [Project2].[State] AS [State], [Project2].[Country] AS [Country], [Project2].[Zip] AS [Zip], [Project2].[Phone] AS [Phone], [Project2].[SaleDate] AS [SaleDate], [Project2].[Notes] AS [Notes], [Project2].[Cost] AS [Cost], [Project2].[CreatedOn] AS [CreatedOn], [Project2].[ModifiedOn] AS [ModifiedOn], [Project2].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], [Project2].[Id1] AS [Id1], [Project2].[CreatedOn1] AS [CreatedOn1], [Project2].[Id2] AS [Id2], [Project2].[SubscriptionTypeId] AS [SubscriptionTypeId], [Project2].[PlanFeeAmount] AS [PlanFeeAmount], [Project2].[LoginId] AS [LoginId], [Project2].[IndustryTypeId] AS [IndustryTypeId], [Project2].[CompanyName] AS [CompanyName], [Project2].[NumberOfLocations] AS [NumberOfLocations], [Project2].[WebsiteUrl] AS [WebsiteUrl], [Project2].[blsActive] AS [blsActive], [Project2].[Pending] AS [Pending], [Project2].[ExpiryDate] AS [ExpiryDate], [Project2].[LogoImageName] AS [LogoImageName], [Project2].[C1] AS [C1], row_number() OVER (ORDER BY [Project2].[CreatedOn1] ASC) AS [row_number]\n            FROM ( SELECT \n                [Filter1].[Id] AS [Id], \n                [Filter1].[CompanyId] AS [CompanyId], \n                [Filter1].[CompanyLocationId] AS [CompanyLocationId], \n                [Filter1].[FirstName] AS [FirstName], \n                [Filter1].[LastName] AS [LastName], \n                [Filter1].[Email] AS [Email], \n                [Filter1].[Address1] AS [Address1], \n                [Filter1].[Address2] AS [Address2], \n                [Filter1].[City] AS [City], \n                [Filter1].[State] AS [State], \n                [Filter1].[Country] AS [Country], \n                [Filter1].[Zip] AS [Zip], \n                [Filter1].[Phone] AS [Phone], \n                [Filter1].[SaleDate] AS [SaleDate], \n                [Filter1].[Notes] AS [Notes], \n                [Filter1].[Cost] AS [Cost], \n                [Filter1].[CreatedOn] AS [CreatedOn], \n                [Filter1].[ModifiedOn] AS [ModifiedOn], \n                [Filter1].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], \n                [Limit1].[Id] AS [Id1], \n                [Limit1].[CreatedOn] AS [CreatedOn1], \n                [Extent3].[Id] AS [Id2], \n                [Extent3].[SubscriptionTypeId] AS [SubscriptionTypeId], \n                [Extent3].[PlanFeeAmount] AS [PlanFeeAmount], \n                [Extent3].[LoginId] AS [LoginId], \n                [Extent3].[IndustryTypeId] AS [IndustryTypeId], \n                [Extent3].[CompanyName] AS [CompanyName], \n                [Extent3].[NumberOfLocations] AS [NumberOfLocations], \n                [Extent3].[WebsiteUrl] AS [WebsiteUrl], \n                [Extent3].[blsActive] AS [blsActive], \n                [Extent3].[Pending] AS [Pending], \n                [Extent3].[ExpiryDate] AS [ExpiryDate], \n                [Extent3].[LogoImageName] AS [LogoImageName], \n                1 AS [C1]\n                FROM    (SELECT [Extent1].[Id] AS [Id], [Extent1].[CompanyId] AS [CompanyId], [Extent1].[CompanyLocationId] AS [CompanyLocationId], [Extent1].[FirstName] AS [FirstName], [Extent1].[LastName] AS [LastName], [Extent1].[Email] AS [Email], [Extent1].[Address1] AS [Address1], [Extent1].[Address2] AS [Address2], [Extent1].[City] AS [City], [Extent1].[State] AS [State], [Extent1].[Country] AS [Country], [Extent1].[Zip] AS [Zip], [Extent1].[Phone] AS [Phone], [Extent1].[SaleDate] AS [SaleDate], [Extent1].[Notes] AS [Notes], [Extent1].[Cost] AS [Cost], [Extent1].[CreatedOn] AS [CreatedOn], [Extent1].[ModifiedOn] AS [ModifiedOn], [Extent1].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId]\n                    FROM [dbo].[Customer] AS [Extent1]\n                    WHERE (([Extent1].[FirstName] LIKE @p__linq__0 ESCAPE N'~') OR ([Extent1].[LastName] LIKE @p__linq__1 ESCAPE N'~') OR ([Extent1].[Email] LIKE @p__linq__2 ESCAPE N'~') OR ([Extent1].[FirstName] + N' ' + [Extent1].[LastName] LIKE @p__linq__3 ESCAPE N'~')) AND ([Extent1].[CompanyId] = @p__linq__4) AND ([Extent1].[CompanyLocationId] = @p__linq__5) ) AS [Filter1]\n                OUTER APPLY  (SELECT TOP (1) \n                    [Extent2].[Id] AS [Id], \n                    [Extent2].[CreatedOn] AS [CreatedOn]\n                    FROM [dbo].[EmailCampaignerStatus] AS [Extent2]\n                    WHERE [Filter1].[Id] = [Extent2].[CustomerId] ) AS [Limit1]\n                LEFT OUTER JOIN [dbo].[Company] AS [Extent3] ON [Filter1].[CompanyId] = [Extent3].[Id]\n            )  AS [Project2]\n        )  AS [Project2]\n        WHERE [Project2].[row_number] &gt; 0\n        ORDER BY [Project2].[CreatedOn1] ASC ) AS [Limit2]\n    LEFT OUTER JOIN [dbo].[EmailCampaignerStatus] AS [Extent4] ON [Limit2].[CompanyId] = [Extent4].[CompanyId]\n)  AS [Project3]\nORDER BY [Project3].[CreatedOn1] ASC, [Project3].[Id1] ASC, [Project3].[Id] ASC, [Project3].[Id2] ASC, [Project3].[C2] ASC\n\nSELECT \n[GroupBy1].[A1] AS [C1]\nFROM ( SELECT \n    COUNT(1) AS [A1]\n    FROM [dbo].[Customer] AS [Extent1]\n    WHERE (([Extent1].[FirstName] LIKE @p__linq__0 ESCAPE N'~') OR ([Extent1].[LastName] LIKE @p__linq__1 ESCAPE N'~') OR ([Extent1].[Email] LIKE @p__linq__2 ESCAPE N'~') OR ([Extent1].[FirstName] + N' ' + [Extent1].[LastName] LIKE @p__linq__3 ESCAPE N'~')) AND ([Extent1].[CompanyId] = @p__linq__4) AND ([Extent1].[CompanyLocationId] = @p__linq__5)\n)  AS [GroupBy1]\n\n\nSELECT \nCASE WHEN ( EXISTS (SELECT \n    1 AS [C1]\n    FROM [dbo].[CompanyReviewSites] AS [Extent1]\n    WHERE [Extent1].[CompanyLocationId] = @p__linq__0\n)) THEN cast(1 as bit) WHEN ( NOT EXISTS (SELECT \n    1 AS [C1]\n    FROM [dbo].[CompanyReviewSites] AS [Extent2]\n    WHERE [Extent2].[CompanyLocationId] = @p__linq__0\n)) THEN cast(0 as bit) END AS [C1]\nFROM  ( SELECT 1 AS X ) AS [SingleRowTable1]\n\nSELECT \n1 AS [C1], \n[Extent1].[Id] AS [Id], \n[Extent1].[RiviewSiteId] AS [RiviewSiteId], \n[Extent1].[URL] AS [URL], \n[Extent1].[CompanyId] AS [CompanyId], \n[Extent1].[CompanyLocationId] AS [CompanyLocationId], \n[Extent2].[Id] AS [Id1], \n[Extent2].[ReviewSiteName] AS [ReviewSiteName], \n[Extent2].[ImageName] AS [ImageName]\nFROM  [dbo].[CompanyReviewSites] AS [Extent1]\nINNER JOIN [dbo].[ReviewSites] AS [Extent2] ON [Extent1].[RiviewSiteId] = [Extent2].[Id]\nWHERE [Extent1].[CompanyLocationId] = @p__linq__0\n</code></pre>\n"},{"tags":["sql-server","asp.net-mvc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13259641,"title":"Should I add a field like MarkedAsDeleted to my table?","body":"<p>I'm building an ASP.NET MVC application with SQL Server. I would like to know what will be a good practice for record deletion operations. I mean, when an item is deleted via web application, I would like to mark it as deleted, and then from an admin console, I will purge them if needed.</p>\n\n<p>Is this a good practice? Should I use or avoid?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","geospatial","spatial"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13259215,"title":"STintersects() to find the Intersection point","body":"<p>I have two geometry which I am using to check if they intersect and if they do I need the intersection point.</p>\n\n<p>Currently I can get only Boolean output where if it intersects = 1 and if it does not intersect it will give =0 . Is there any way I can find the intersection of two shapes in geometry?</p>\n\n<p>Cheers,</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13258759,"title":"Update a DateTimes's Time, but not the date","body":"<pre><code>MyTable:\n id     int\n Date1  DateTime\n Date2  DateTime\n</code></pre>\n\n<p>How can I set the time of Date2 to be the same as Date1 without affecting the date of Date2?</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":55,"score":0,"question_id":13255829,"title":"Dynamic WHERE condition based on variable","body":"<p>I have the follow line in SQL Server</p>\n\n<pre><code>((@data_inicial IS NULL OR @data_inicial = '') \nOR \ntbSO.dt_criacao &gt;= CAST(@data_inicial AS DATE))\n</code></pre>\n\n<p>I need to use the field tbSO.dt_criacao depending one parameter that I receive @cod_status.</p>\n\n<p>If @cod_status = 1 I have to use tbSO.dt_criacao <br/>\nIf @cod_status = 2 I have to use tbSO.dt_abertura <br/>\nIf @cod_status = 3 I have to use tbSO.dt_fechamento</p>\n\n<p>Can you help me in this issue?</p>\n\n<p>Best Regards</p>\n\n<p>Milton Camara</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13254027,"title":"Apply compression on multiple tables at once in SQL Server?","body":"<p>I am using MS SQL Server 2008, I am trying to do a <code>SELECT INTO</code> from one database to another, however I need the new tables to be compressed with row compression after they are built. </p>\n\n<p>I used a trigger before to set compression on all tables by default but that didnt work out so well because the trigger changes the schema and doesnt allow the data to be inserted. </p>\n\n<h2>Here is what i tried:</h2>\n\n<p>CREATE DATABASE dev_hold_test\nCOLLATE Latin1_General_100_CS_AS_WS;        --Sets collation on database\nGO</p>\n\n<p>USE dev_hold_test\nGO   </p>\n\n<p>--  Trigger to apply compression on tables after they are created.<br>\n-- START TRIGGER\nCREATE TRIGGER CompressTables<br>\nON DATABASE<br>\nAFTER CREATE_TABLE<br>\nAS<br>\nBEGIN<br>\n    DECLARE @TableSchema sysname, @TableName sysname<br>\n    SELECT  @TableSchema = EVENTDATA().value('(/EVENT_INSTANCE/SchemaName)[1]','sysname'),<br>\n            @TableName = EVENTDATA().value('(/EVENT_INSTANCE/ObjectName)[1]', 'sysname')   </p>\n\n<pre><code>DECLARE @SQL NVARCHAR(2000)   \n\nSET     @SQL =  'ALTER TABLE ' + QUOTENAME(@TableSchema) + '.' +    \n                QUOTENAME(@TableName) + ' REBUILD WITH (DATA_COMPRESSION=ROW)'  -- ROW | PAGE\n\nEXEC    (@SQL)   \n</code></pre>\n\n<p>END<br>\nGO</p>\n\n<p>---This SELECT is a test will expand to pull more data to create more tables-----</p>\n\n<p>SELECT testdbase_1.dbo.books.author, testdbase_1.dbo.books.text, testdbase_1.dbo.subjects.subject_name, testdbase_1.dbo.subjects.subject_title\nINTO dev_hold_test.dbo.BooksandSubs2\nFROM testdbase_1.dbo.books, testdbase_1.dbo.subjects</p>\n\n<hr>\n\n<p>If i create a table using CREATE it works fine, but when i use a SELECT INTO - it creates the table but does not populate it and gives an error saying the schema has been changed.\nSo i am doing away with the Trigger. I just need to \n1. Create the dbase\n2. Pull the data from the existing tables -which at this point will create new tables\n3. Check all tables to see which is compressed or Not\n4. apply compression on the tables that are not</p>\n\n<p>What other method could i use to set the compression on all the tables at once? #newbie</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13258297,"title":"A script to test existence of primary keys","body":"<p>Trying to figure out a SQL script to test the existence of primary keys in cerain tables.  If the table has no primary key, then the script should output the table name.</p>\n\n<pre><code>Tables to test:\nTableA\nTableB\nTableC\n</code></pre>\n\n<p>After running the script (and lets say TableA and TableC have PKs, but not TableB), then the output would be below:</p>\n\n<pre><code>NoKeys\nTableB\n</code></pre>\n"},{"tags":["sql","sql-server","query","tsql","sql-server-2000"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":13257860,"title":"When I run simple select query, is it possible not to show number of rows affected at the end?","body":"<p>I try to use OSQL in order to save query results in text file and later bulk insert those text file to a table. OSQL part is ok, however, in bulk insert, number of rows affected at the end of query results causes error. Here is an example;</p>\n\n<pre><code>select item_number, description, price from item\n\n3536114   Fruit mix     $3.99\n\n3536229   DO 20 liquid  $9.99\n\n3536251   Peppermint    $7.99\n\n(3 rows affected) ------&gt; I do not need this line.\n</code></pre>\n"},{"tags":["sql-server","database"],"answer_count":12,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":700,"score":3,"question_id":1006977,"title":"Altering a SQL Server table without impact","body":"<p>I have a table with some 30 columns, already used in the application extensively. i.e Select, Insert and Update operations for this table written in many different ways(in whatever ways the developers thought they were comfortable) in number of stored procedures and UDFs. I'm now handed with a task to extend the functionality for which the table serves and I'm in need to add additional detail to the table(generally can be assumed as an additional column to the table). Adding additional column to the table is a massive and inefficient task I don't want to do considering the impact it will cause elsewhere.</p>\n\n<p>Another way i can think of now is creating a new table with foreign key to the main table and maintaining the records in the new table. I'm skeptical of this way too. What is the effective way to handle this sort of modifications in the schema of the table?</p>\n\n<p>Using SQL Server 2000 in case it's needed.</p>\n\n<p>Edit:</p>\n\n<p>Unfortuantely, column should not accept NULL values. Missed this crucial info indeed</p>\n\n<p>Impacts i think which can occur due to already implemented poor practices are,</p>\n\n<blockquote>\n  <p>1) \"SELECT *\" and binding to some\n  datagrid directly to front end. (very\n  very low probable)</p>\n  \n  <p>2) using Column numbers to fetch from\n  dataset or datatable instead of column\n  names in front end when using \"SELECT\n  *\"</p>\n  \n  <p>3) \"Insert into\" with values given\n  sequentially instead of with column\n  names.</p>\n</blockquote>\n\n<p>By some way, if i can make the column to accept \"NULL\" values(by tweaking requirements a bit) any impact due to the above points?</p>\n\n<p>I'm doubtful of analysisng existing code because number of SPs and functions using this table can run into hundreds.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":8,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":1603,"score":5,"question_id":9740256,"title":"How to compare if two strings contain the same words in T-SQL for SQL Server 2008?","body":"<p>When I compare two strings in SQL Server, there are couple of simple ways with <code>=</code> or <code>LIKE</code>.</p>\n\n<p>I want to redefine equality as:  </p>\n\n<p><em>If two strings contain the same words - no matter in what order - they are equal, otherwise they are not.</em></p>\n\n<p>For example:  </p>\n\n<ul>\n<li><code>'my word'</code> and <code>'word my'</code> are equal</li>\n<li><code>'my word'</code> and <code>'aaamy word'</code> are not</li>\n</ul>\n\n<p>What's the best simple solution for this problem?</p>\n"},{"tags":["php","sql","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":35,"score":-2,"question_id":13257659,"title":"sqlsrv returns empty query","body":"<p>I got a weird problem, on a other webserver (and other mssql server) there wasn't a problem.\nBut now I can connect to the server, I can connect to the database.</p>\n\n<p>And I can execute a query (at least I can use the syntax and it doesn't show an error) but it has no results. Also a <code>sqlsrv_fetch_array</code> returns <code>false</code>..</p>\n\n<p>And I don't have that much mssql knowledge, so I just have a very basic installation.</p>\n\n<p>What did I do wrong or what information do you need?</p>\n\n<p>PS. I'm using windows sql server 2008 R2.</p>\n\n<p>Thank you in advance!</p>\n"},{"tags":["sql-server","linq","spaces"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":335,"score":1,"question_id":1879422,"title":"LINQ puts unwanted trailing spaces on strings","body":"<p>I have a very annoying problem with LINQ and MS SQL Server.</p>\n\n<p>Im currently making some software in WPF C# and use LINQ to generate classes from the data in the database.</p>\n\n<p>However, when i update a nvarchar or varchar field in the DB from my program, LINQ adds trailing spaces to the string!</p>\n\n<p>I have a field in a table defined like this:</p>\n\n<pre><code>ProductName = NVARCHAR(10)\n</code></pre>\n\n<p>So if i do this:</p>\n\n<pre><code>Product.Name = \"Bike\";\nProduct.Name = Product.Name.Trim();\nrepository.Add(Product);   // Runs an .InsertOnSubmit\nrepository.Save();         // Runs a .SubmitChanges\n</code></pre>\n\n<p>then the resulting data in the DB is \"Bike[SPACE][SPACE][SPACE][SPACE][SPACE][SPACE]\" where [SPACE] is just a space (can't write multiple spaces in this text here).</p>\n\n<p>Why does it do this, and how do i make it stop adding those annoying trailing spaces?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","reporting-services"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2260,"score":1,"question_id":150695,"title":"Where are all the places Sql Reporting Server Logs Errors?","body":"<p>It seems like Sql Reporting Services Server logs information in several places including web server logs and logging tables in the database. Where are all the locations SSRS logs to, and what type of errors are logged in each place?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":13256685,"title":"Optimization of query with counts of distinct column based on value of other column","body":"<p>There must be a better way to write this, but I'm just not sure what that is. Basically I'm trying to count the distinct values from one column where a condition is met in a separate column. I found this <a href=\"http://stackoverflow.com/questions/11853065/trying-to-count-distinct-values-of-a-field-based-on-value-of-a-different-field\">link</a>, but am not sure how to apply it here.</p>\n\n<p>Here is the query, I am using SQL Server 2008R2</p>\n\n<pre><code>SELECT lot,\n    (SELECT COUNT(DISTINCT d.pid) FROM invdet d WHERE upk = 0 and d.lot = [invdet].lot) as noUpk,\n    (SELECT COUNT(DISTINCT d.pid) FROM invdet d WHERE upk = 1 and d.lot = [invdet].lot) as isUpk\nFROM invdet\nWHERE ([status] in ('PQ','P2','FA','F2','BH','RL','SC','LD','PS'))\nGROUP BY lot\nHAVING COUNT(CASE WHEN invdet.upk = 1 THEN 1 ELSE null END) &gt; 0\n</code></pre>\n"},{"tags":["c#","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":13257037,"title":"C# function call never reaches first line of executable code, only on a particular pc","body":"<p>I have a piece of code that creates a new SQL-Server Express Database, and then runs a predefined table generation/population script.  Its a pretty straight forward and simple task, and the code works wonderfully under normal operations.  On one of our testing machines, this creation function stalls after creating the DB,  but before populating it.\nIt simply hangs with no error message, no deadlock (ui still responsive), and no CPU usage.  </p>\n\n<p>Further investigation and debugging determines that the line immediately before the LoadDatabaseTables() function call is executed, but the first line inside LoadDatabaseTables() is never reached. How exactly can a function be called, but then have the program fail to execute even the first line of the function?  </p>\n\n<p>The code in question is written in C#:</p>\n\n<pre><code>    ...snip...\n    bool success=false;\n    try\n    {\n        //...code that creates db, working as intended...\n    }\n    catch(Exception e)\n    {\n        //...error handling...\n    }\n    finally\n    {\n        //Params is a locally defined struct, containing int, bool, and string members\n        if(CreateScript(Params))  //generates appropriate script successfully, returns true\n        {\n            System.Windows.MessageBox.Show(\"About to enter load script\");\n            if(LoadDatabaseTables(Params))\n            {\n               success=true;\n            }\n        }\n    }\n    return success;\n}\n\nprivate bool LoadDatabaseTables(DatabaseParams Params)\n{\n    System.Windows.MessageBox.Show(\"Entered the load script\");\n    bool success = false;\n    Server server = null;\n    try\n    {\n        //...sql calls...\n        success = true;\n    }\n    catch (Exception ex)\n    {\n        //...exception handling...\n    }\n    return success;\n}\n...snip...\n</code></pre>\n\n<p>The first message \"About to enter load script\" is reached but the \"Entered the load script\" is not displayed, and the rest of the function does not execute, no exceptions are raised, nothing is returned.</p>\n\n<p>Unfortunately, this machine does not have the necessary tools/licenses to run full debugging, and the problem only occurs on this one machine.  The message boxes obviously are not included in the regular version of the code, and a just being used to attempt to diagnose the problem.  The code executes normally on other systems with and without these message boxes.</p>\n\n<p>Has anyone come across this kind of error before?  Any help would be most appreciated!</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13256877,"title":"SQL Server Customize Templates beyond Grid","body":"<p>How can I add custom sql commands to the default templates(used for <code>Script Table as...</code>)?</p>\n\n<p>Instead of:</p>\n\n<pre><code>UPDATE DB.dbo.table SET col1 = 'test'\n</code></pre>\n\n<p>I would like to have:</p>\n\n<pre><code>BEGIN TRANSACTION\n    UPDATE DB.dbo.table SET col1 = 'test'\nROLLBACK TRANSACTION\n</code></pre>\n\n<p>Or any custom code really. </p>\n\n<p>I did look at the <a href=\"http://stackoverflow.com/questions/1681645/change-default-template-in-sql-server-management-studio\">Change default template in SQL Server Management Studio</a> question, but it didn't allow for custom sql. It allowed you to set predefined properties.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":13256813,"title":"SELECT SUM() FROM (SELECT (SELECT ())","body":"<p>I have a correct working T-SQL-script in this form</p>\n\n<pre><code>SELECT  columnA\n        AS\n        'numbers'\nFROM    tableA\nWHERE   clause\n</code></pre>\n\n<p>This script gives me as one column, called numbers, of integers. I want to sum these.</p>\n\n<p>Calling the above lines 'script' I tried the following setup</p>\n\n<pre><code>SELECT  SUM(numbers)\nFROM    (\n            script\n        )\n</code></pre>\n\n<p>Reading <a href=\"http://stackoverflow.com/questions/10439122/select-count-from-select\">select count(*) from select</a> I supposed this to work, however, it does not. I keep getting \"Incorrect syntax near.\"</p>\n\n<p>I do not know if it is important but that is here named columnA is itself maked by a SELECT statement.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13256336,"title":"fill empty column with sequence","body":"<p>Is there any way to fill an empty column with a ascending sequence of numbers starting from 1, without using identity?</p>\n\n<p>I tried the following cursor but it is filling the same value (450) for all rows in the column:</p>\n\n<pre><code>declare cur3 cursor for\nselect new_id from sheet1$\ndeclare @no int\ndeclare @no1 int\nset @no1 = 1\nopen cur3\nfetch next from cur3 into @no\nwhile(@@FETCH_STATUS = 0)\nbegin\nupdate sheet1$ set new_id = @no1\nset @no1 = @no1 + 1\nfetch next from cur3 into @no\nend\nclose cur3\ndeallocate cur3\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":33,"score":-1,"question_id":13254417,"title":"trying to create a trigger that check age from an insert and place into another table if less than 18","body":"<p>Develop a trigger that will be placed on the marketing list table that will insert a record into the child table if the person's age is less than 18 once an insert is attempted.</p>\n\n<p>SEE the code below: </p>\n\n<pre><code>Create Trigger on_insert_marketing_list\nOn marketing_list for insert\nAs\nBEGIN\n        Declare @Name varchar (100)\n        Declare @Dob date\n        Declare @Gender char(1)\n        Declare @Parish VARCHAR(50)\n        Declare @Mobile varchar(50)\n        Declare @Provider varchar(50)\n        Declare @age int\n\n        Select @age = datediff(year,@dob,getdate())from inserted\n\n        If (@age) &lt; 18      \n        BEGIN\n        Insert Into Childlist values(@Name,@Dob,@Gender,@Parish,@Mobile,@Provider)\n        END\n\nEnd\n\ninsert into marketing_list (Name, Dob, Gender,  Parish,  Mobile, Mobile_Provider) values\n('Kendrick Lamar', '3/4/2005','M','Kingston', '18764532345','LIME')\n</code></pre>\n"},{"tags":["c#","sql-server","type-conversion"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13177330,"title":"how to convert string datatype to SQL's varbinary equivalent datatype?","body":"<p>Sorry for asking stupid question as I am newbie to C#.</p>\n\n<p>Currently doing a task in c# using OLEDB. The scenario is, I want to insert in one table which has information like username, pasword, etc. The Database is SQL Server. The column Pasword has a datatype varbinary(100). </p>\n\n<p>I want to convet from string datatype to SQL's varbinary equivalent datatype. I tried a little bit, but didn't succeed.</p>\n\n<p>Initially I just tried with <code>reader.GetString(5)</code>. But exception I got is : </p>\n\n<pre><code>\"Specified cast is not valid.\"\n</code></pre>\n\n<p><strong>* I forgot to mentioned below things *</strong></p>\n\n<p>Reader I used is OleDbDataReader.</p>\n\n<pre><code>oleParameter[7] = new OleDbParameter(\"@Password\", OleDbType.VarBinary, 100);\noleParameter[7].Value = reader1.GetBytes(5);\n</code></pre>\n\n<p>(Here I am reading from one table and inserting into another table.)</p>\n\n<p>Please help me.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13254583,"title":"Removing LOB column from table. Lob used page count not equals to 0","body":"<p>I altered a table that was used to contains a Lob column (VarBinary(MAX)).</p>\n\n<p>When I run </p>\n\n<pre><code>select * from sys.dm_db_partition_stats\nwhere [object_id] = object_id('MyTable')\n</code></pre>\n\n<p>the lob_used_page_count is 1014969. I thought it would be 0. Am I wrong or is there something I need to do?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":13207075,"title":"Format a number with commas but without decimals in SQL Server 2008 R2?","body":"<p>I am using the following to create a comma formatted number in T-SQL. How can I get rid of the decimal point and the digits after decimal. So if I get 1,112.00 after formatting, how would I get only 1,112?</p>\n\n<pre><code>SELECT CONVERT(varchar, CAST(1112 AS money), 1)\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":21,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":3884,"score":10,"question_id":101423,"title":"How do you continue to improve your SQL skills?","body":"<p>How do SQL developers go about keeping up on current techniques and trends in the SQL world?  Are there any blogs, books, articles, techniques, etc that are being used to keep up to date and in the know?</p>\n\n<p>There are a lot of opportunities out their for OO, procedural, and functional programmers to take part in a variety of open source projects, but it seems to me that the FOSS avenue is a bit more closed for SQL developers.</p>\n\n<p>Thoughts?</p>\n"},{"tags":["sql-server","linq"],"answer_count":6,"favorite_count":8,"up_vote_count":16,"down_vote_count":0,"view_count":10502,"score":16,"question_id":1722741,"title":"Defining a one-to-one relationship in SQL Server","body":"<p>I need to define a one-to-one relationship, and can't seem to find the proper way of doing it in SQL Server.</p>\n\n<p>Why a one-to-one relationship you ask? </p>\n\n<p>I am using WCF as a DAL (Linq) and I have a table containing a BLOB column. The BLOB hardly ever changes and it would be a waste of bandwidth to transfer it across every time a query is made.</p>\n\n<p>I had a look at <a href=\"http://sqlserver-tips.blogspot.com/2006/10/implementing-one-to-one-relationship.html\" rel=\"nofollow\">this solution</a>, and though it seems like a great idea, I can just see Linq having a little hissy fit when trying to implement this approach.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["mysql","sql-server","sql-server-2008","sql-server-2008-r2","mysql-workbench"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":291,"score":0,"question_id":11619177,"title":"SQL Server 2008 R2 to MySQL Migration","body":"<p>Is there a GUI tool out there that will allow me to migrate entire SQL Server 2008 R2 databases to MySQL?  I have MySQL Workbench installed, but it looks like there isn't a feature in it like SSIS to copy and paste entire databases from SQL Server.  I downloaded the MySQL Migration Toolkit, but it is no longer supported and I get a Java error when running it.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":6,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":594,"score":1,"question_id":6068619,"title":"Merging date intervals in SQL Server","body":"<p>I have the following data:</p>\n\n<pre><code>StartDate   |  EndDate\n-------------------------\n1982.03.02  |  1982.09.30 \n1982.10.01  |  1985.01.17 \n1985.06.26  |  1985.07.26 \n1985.07.30  |  1991.12.31 \n1992.01.01  |  1995.12.31 \n1996.01.01  |  2004.05.31 \n2004.06.05  |  2006.01.31 \n2006.02.01  |  2011.05.20              \n</code></pre>\n\n<p>I need to merge any intervals that are adjacent (both start and the end date are included in the intervals, so an interval ending on 2003.05.06 is adjacent with an interval starting on 2003.05.07), so in this case, the resulting set should be:</p>\n\n<pre><code>StartDate   |  EndDate\n-------------------------\n1982.03.02  |  1985.01.17 \n1985.06.26  |  1985.07.26 \n1985.07.30  |  2004.05.31 \n2004.06.05  |  2011.05.20              \n</code></pre>\n\n<p>For me, the obvious way to do this is to iterate the set with a cursor, and construct a result set row-by-row. However, this functionality will be within code that could potentially be called thousands of times in a day, on a server under heavy load, so I'd prefer not having any performance issues. Any data set is small (20 rows tops), and the data range is large, so any solution that generates all the dates in a range is unfeasible.</p>\n\n<p>Is there a better way I'm not seeing?</p>\n\n<hr>\n\n<p>Initialization code (from Damien's answer):</p>\n\n<pre><code>CREATE TABLE Periods (\n    StartDate datetime NOT NULL CONSTRAINT PK_Periods PRIMARY KEY CLUSTERED,\n    EndDate datetime NOT NULL\n)\n\nINSERT INTO Periods(StartDate,EndDate)\nSELECT '19820302', '19820930'\nUNION ALL SELECT '19821001', '19850117'\nUNION ALL SELECT '19850626', '19850726'\nUNION ALL SELECT '19850730', '19911231'\nUNION ALL SELECT '19920101', '19951231'\nUNION ALL SELECT '19960101', '20040531'\nUNION ALL SELECT '20040605', '20060131'\nUNION ALL SELECT '20060201', '20110520'\n</code></pre>\n"},{"tags":["sql-server","azure","load-balancing","failover","windows-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13254577,"title":"Azure VM availability, mirroring","body":"<p>Apologies for the noob question, I've never dealt with failover before.</p>\n\n<p>Currently we have a single hardware server running Windows Server, SQL Server, ASP.NET and a single (very large) web application.  We are considering migrating this to an Azure VM.</p>\n\n<p>I see in the SLA that Microsoft will only guarantee 99.95% availability if I am running <strong>more than one instance</strong> of an Azure VM, to allow for failure and reboots etc.</p>\n\n<p>Does this mean I therefore would have two servers to manage and maintain?  For example, two versions of SQL with a database on each, and two sets of ASP.NET application files?  If correct, this puts the price up dramatically.</p>\n\n<p>I assume there is no way to 'mirror' one server across to the other to reduce this workload?</p>\n\n<p>Also, our hardware server has 25,000 uploaded files on it.  Would we need to put these on a VHD then 'link' them to whichever live server was running, or does Azure do this automatically?  Or do they have to be mirrored from the live server to the failover server?</p>\n\n<p>Any pointers would be appreciated.  I've already read all the Azure documentation but it hasn't really made things much clearer...</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":33,"score":0,"question_id":13237477,"title":"How do I retrieve decimals when rounding an average in SQL","body":"<p>Here is my SQL statement</p>\n\n<pre><code>SELECT ROUND(AVG(column_name), 100) \nFROM [database].[dbo].[table]\n</code></pre>\n\n<p>The answer I retrieve is <code>3</code> with a possible range of numbers between <code>1 - 5</code> in 908 rows.</p>\n\n<p>I need it to say <code>3.0</code> or <code>3.09</code>. Is this possible?</p>\n"},{"tags":["php","sql-server","pdo"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":44,"score":2,"question_id":13208569,"title":"PDO_MSSQL and SQL Server 7","body":"<p>I have problem with establish connection with sql server 7 on different server using PDO/PHP. All works perfect on win 2003 32 bit/apache/php5.2.5 but I receive server not found when service is on win 2008R2 64bit/apache/php5.2.5. User/password are correct, firewall configured.</p>\n\n<p>I check, that PHP don't use 1433 port but try connect with 445 and 139 ports.</p>\n\n<p>Any idea?</p>\n\n<p>Stefan</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":54,"score":0,"question_id":13254504,"title":"Aggregation for join ON clause","body":"<p>I have a table <code>item_table</code> like this:</p>\n\n<pre><code>item   age\n--------------    \n1      1 \n1      6 \n2      2    \n</code></pre>\n\n<p>I have the other table <code>price_table</code> like this:</p>\n\n<pre><code>item    pricetype    price\n--------------------------    \n1       O             5\n1       P             6\n1       V             7\n2       O             8\n2       P             9\n2       V             10\n</code></pre>\n\n<p>So, I want to inner join above two tables.</p>\n\n<pre><code>select *\nfrom item_table i\ninner join price_table p\non ...\n</code></pre>\n\n<p>There are some conditions about the <code>on</code>:</p>\n\n<ol>\n<li>if <strong>the average of age</strong> of an item is bigger than <code>3</code>, then I do: <code>inner join price_table on pricetype = 'O' or pricetype = 'P'</code></li>\n<li>If not, then I do: <code>inner join price_table on pricetype = 'O' or pricetype = 'P' or pricetype = 'V'</code></li>\n</ol>\n\n<p>So there are conditions for <code>on</code> conditions.</p>\n\n<p>I then write the query like this:</p>\n\n<pre><code>select i.item, i.type, p.pricetype, p.price\nfrom item_table i\ninner join price_table p on i.item = p.item \n    and (avg(i.age) &gt;= 3 and p.pricetype in ('O', 'P'))\n        or (avg(i.age) &lt; 3 and p.pricetype in ('O', 'P', 'V'))\n</code></pre>\n\n<p>The error is given: <code>An aggregate cannot appear in an ON clause unless it is in a subquery contained in a HAVING clause or select list, and the column being aggregated is an outer reference.</code></p>\n\n<p>I can't move the <code>avg</code> to <code>Having</code> because other conditions are depending on the <code>avg</code>.</p>\n\n<p><strong>How can I write the select query?</strong></p>\n"},{"tags":["sql-server","datetime","function"],"answer_count":3,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":14366,"score":8,"question_id":3825893,"title":"SQL Server function to return minimum date (January 1, 1753)","body":"<p>I am looking for a SQL Server function to return the minimum value for datetime, namely January 1, 1753. I'd rather not hardcode that date value into my script.</p>\n\n<p>Does anything like that exist? (For comparison, in C#, I could just do <code>DateTime.MinValue)</code>\nOr would I have to write this myself?</p>\n\n<p>I am using Microsoft SQL Server 2008 Express.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":11110775,"title":"How to generate table name by datetime?","body":"<p>I realize this is syntactically bad but I figure it somewhat explains what I'm trying to do. Essentially, I have a batch job that is going to run each morning on a small table and as a part of the spec I need to create a backup prior to each load that can be accessed by a report.</p>\n\n<p>What I have so far is:</p>\n\n<pre><code>select  *\ninto    report_temp.MSK_Traffic_Backup_ + getdate()\nfrom    property.door_traffic\n</code></pre>\n\n<p>How can I make this function or should I consider doing this a better way?</p>\n"},{"tags":["sql-server","nhibernate","orm","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13253459,"title":"Relationships fixup in EntityFramework vs NHibernate","body":"<p>I have been experimenting with Entity Framework 4.4, NHibernate 3.3.1.4000  and SQL Server and I have noticed a difference when it comes to fixing up the relationships when you commit your changes, and I was wondering what is the best practice or if I'm doing something wrong.</p>\n\n<p>Here's what I tested.  I have a classic Parent linked to n Children.  I have 2 parents in the database with 20 children each.  I load both parents, and I take the first child of the first parent and assign that child the second parent.  I then commit the changes.</p>\n\n<p>In EF, after I have saved,  I can see that the count for the Children collection of both parents has been altered, so it fixed up the relationships.</p>\n\n<p>However, when I do the same thing in NHibernate, the counts remain the same.</p>\n\n<p>Here's my code setup to reproduce the issue.</p>\n\n<p><strong>POCOs:</strong></p>\n\n<pre><code>public class Parent\n{\n    public virtual int ParentId { get; set; }\n\n    public virtual string Name { get; set; }\n\n    public virtual IList&lt;Child&gt; Children { get; set; }\n\n    public Parent()\n    {\n        Children = new List&lt;Child&gt;();\n    }\n}\n\npublic class Child\n{\n    public virtual int ChildId { get; set; }\n\n    public virtual int ParentId { get; set; }\n\n    public virtual string Name { get; set; }\n\n    public virtual Parent Parent { get; set; }\n}\n</code></pre>\n\n<p><strong>NHibernate Parent mapping:</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\" ?&gt;\n&lt;hibernate-mapping xmlns=\"urn:nhibernate-mapping-2.2\"\n                   assembly=\"ConsoleApplication1\"\n                   namespace=\"ConsoleApplication1\"&gt;\n  &lt;class name=\"Parent\" table=\"Parents\"&gt;\n    &lt;id name=\"ParentId\" column=\"ParentId\" /&gt;\n    &lt;property name=\"Name\" column=\"Name\" /&gt;\n    &lt;bag name=\"Children\" cascade=\"all\"&gt;\n      &lt;key column=\"ParentId\"/&gt;\n      &lt;one-to-many class=\"Child\"/&gt;\n    &lt;/bag&gt;\n  &lt;/class&gt;\n&lt;/hibernate-mapping&gt;    \n</code></pre>\n\n<p><strong>NHibernate Child mapping:</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\" ?&gt;\n&lt;hibernate-mapping xmlns=\"urn:nhibernate-mapping-2.2\"\n                   assembly=\"ConsoleApplication1\"\n                   namespace=\"ConsoleApplication1\"&gt;\n  &lt;class name=\"Child\" table=\"Children\"&gt;\n    &lt;id name=\"ChildId\" column=\"ChildId\" /&gt;\n    &lt;property name=\"Name\" column=\"Name\" /&gt;\n    &lt;many-to-one name=\"Parent\" class=\"Parent\" column=\"ParentId\" not-null=\"true\" /&gt;\n  &lt;/class&gt;\n&lt;/hibernate-mapping&gt;    \n</code></pre>\n\n<p><strong>EF DbContext:</strong></p>\n\n<pre><code>public class Entities : DbContext\n{\n    public DbSet&lt;Parent&gt; Parents { get; set; }\n\n    public DbSet&lt;Child&gt; Children { get; set; }\n}\n</code></pre>\n\n<p><strong>App.config:</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;section name=\"hibernate-configuration\" type=\"NHibernate.Cfg.ConfigurationSectionHandler,NHibernate\" /&gt;\n  &lt;/configSections&gt;\n  &lt;hibernate-configuration xmlns=\"urn:nhibernate-configuration-2.2\"&gt;\n    &lt;session-factory&gt;\n      &lt;property name=\"connection.provider\"&gt;\n        NHibernate.Connection.DriverConnectionProvider\n      &lt;/property&gt;\n      &lt;property name=\"dialect\"&gt;\n        NHibernate.Dialect.MsSql2005Dialect\n      &lt;/property&gt;\n      &lt;property name=\"connection.driver_class\"&gt;\n        NHibernate.Driver.SqlClientDriver\n      &lt;/property&gt;\n      &lt;property name=\"connection.connection_string\"&gt;\n        Data Source=localhost;Initial Catalog=MaintainRelationshipsNH;Integrated Security=True;\n      &lt;/property&gt;\n    &lt;/session-factory&gt;\n  &lt;/hibernate-configuration&gt;\n  &lt;connectionStrings&gt;\n    &lt;add\n      name=\"Entities\"\n      providerName=\"System.Data.SqlClient\"\n      connectionString=\"Server=localhost;Database=MaintainRelationshipsNH;Trusted_Connection=true;\"/&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p><strong>Script to create the tables and data:</strong></p>\n\n<pre><code>create table Parents (\n   ParentId INT not null,\n   Name NVARCHAR(255) null,\n   primary key (ParentId)\n)\n\ncreate table Children (\n   ChildId INT not null,\n   Name NVARCHAR(255) null,\n   ParentId INT not null,\n   primary key (ChildId)\n)\n\nalter table Children\n    add constraint FK_Children_Parents\n    foreign key (ParentId)\n    references Parents\n\ndeclare @idChild int        \ninsert into Parents (ParentId, Name) values (0, 'John');\nset @idChild = 0\nwhile @idChild &lt; 20\nbegin\n   insert into Children (ChildId, Name, ParentId) values (@idChild, 'Child ' + convert(nvarchar(2), @idChild), 0);\n   set @idChild = @idChild + 1\nend\ninsert into Parents (ParentId, Name) values (1, 'Julie');\nwhile @idChild &lt; 40\nbegin\n   insert into Children (ChildId, Name, ParentId) values (@idChild, 'Child ' + convert(nvarchar(2), @idChild), 1);\n   set @idChild = @idChild + 1\nend\n</code></pre>\n\n<p><strong>NHibernate test code:</strong></p>\n\n<pre><code>System.Diagnostics.Debug.WriteLine(\"Test NHibernate:\");\n\nConfiguration configuration = new Configuration();\nconfiguration.Configure();\nconfiguration.AddAssembly(typeof(Parent).Assembly);\n\nISessionFactory sessionFactory = configuration.BuildSessionFactory();\n\nParent parent0, parent1;\nusing (ISession session = sessionFactory.OpenSession())\n{\n    using (ITransaction transaction = session.BeginTransaction())\n    {\n        parent0 = session.Load&lt;Parent&gt;(0);\n        parent1 = session.Load&lt;Parent&gt;(1);\n        System.Diagnostics.Debug.WriteLine(\"Before modifications and commit\");\n        System.Diagnostics.Debug.WriteLine(\"Parent0 number of children: \" + parent0.Children.Count);\n        System.Diagnostics.Debug.WriteLine(\"Parent1 number of children: \" + parent1.Children.Count);\n\n        parent0.Children[0].Parent = parent1;\n\n        transaction.Commit();\n    }\n}\nSystem.Diagnostics.Debug.WriteLine(\"After modifications and commit\");\nSystem.Diagnostics.Debug.WriteLine(\"Parent0 number of children: \" + parent0.Children.Count);\nSystem.Diagnostics.Debug.WriteLine(\"Parent1 number of children: \" + parent1.Children.Count);\n</code></pre>\n\n<p><strong>Entity framework test code:</strong></p>\n\n<pre><code>System.Diagnostics.Debug.WriteLine(\"Test Entity Framework:\");\n\nParent parent0, parent1;\nusing (Entities entities = new Entities())\n{\n    parent0 = entities.Parents.Find(0);\n    parent1 = entities.Parents.Find(1);\n    System.Diagnostics.Debug.WriteLine(\"Before modifications and commit\");\n    System.Diagnostics.Debug.WriteLine(\"Parent0 number of children: \" + parent0.Children.Count);\n    System.Diagnostics.Debug.WriteLine(\"Parent1 number of children: \" + parent1.Children.Count);\n    parent0.Children[0].Parent = parent1;\n\n    entities.SaveChanges();\n}\nSystem.Diagnostics.Debug.WriteLine(\"After modifications and commit\");\nSystem.Diagnostics.Debug.WriteLine(\"Parent0 number of children: \" + parent0.Children.Count);\nSystem.Diagnostics.Debug.WriteLine(\"Parent1 number of children: \" + parent1.Children.Count);\n</code></pre>\n\n<p>So basically with this test I can see the counts changing with EF but not with NHibernate.  Am I doing something wrong with NH or do I have to manually manage every part of the relationships affected by my changes ?  Thanks!</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":13253275,"title":"IF ELSE for the conditions of join?","body":"<p>I am using SQL Server.</p>\n\n<p>I have a table <code>item_table</code> like this:</p>\n\n<pre><code>item   age\n--------------    \n1      1 \n1      6 \n2      2    \n</code></pre>\n\n<p>I have the other table <code>price_table</code> like this:</p>\n\n<pre><code>item    pricetype    price\n--------------------------    \n1       O             5\n1       P             6\n1       V             7\n2       O             8\n2       P             9\n2       V             10\n</code></pre>\n\n<p>So, I want to inner join above two tables.</p>\n\n<pre><code>select *\nfrom item_table i\ninner join price_table p\non ...\n</code></pre>\n\n<p>There are some conditions about the <code>on</code>:</p>\n\n<ol>\n<li>if <strong>the average of age</strong> of an item is bigger than <code>3</code>, then I do: <code>inner join price_table on pricetype = 'O' or pricetype = 'P'</code></li>\n<li>If not, then I do: <code>inner join price_table on pricetype = 'O' or pricetype = 'P' or pricetype = 'V'</code></li>\n</ol>\n\n<p>So there are conditions for <code>on</code> conditions.</p>\n\n<p><strong>How can I write the select query?</strong></p>\n\n<p><strong>Edit:</strong>\nI changed the condition to be <strong>average of age</strong>, instead of <code>type</code></p>\n"},{"tags":["sql","sql-server","performance"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":13253522,"title":"Fast SQL Server search on 40M text records","body":"<p>I have a SQL Server 2005 database with a table containing 40 million records. Each record contains a column that stores a comma separated list of keywords. Each keyword is a combination of letters and numbers. The keywords are up to 7 characters long and on average there are 15 keywords per record. The keywords are not unique across rows.</p>\n\n<p>I want to search on full or part of the keyword.</p>\n\n<p>I've created Full text index which shows 328,245,708 unique key count. The search efficiency is fine for queries of 4 or more characters (around <strong>100ms</strong> on the test machine), but too slow for queries that have 3 or less characters (up to <strong>3s</strong> on the test machine).</p>\n\n<p>I've been trying both <code>CONTAINSTABLE</code> and <code>CONTAINS</code> queries of a sort <code>'[query]*'</code> with similar result.</p>\n\n<p>I believe the performance of the short queries is slower, because short words repeat across different records more frequently.</p>\n\n<p>Sorting the results is not crucial, and I've been trying to return <code>TOP X</code> results sorted on Rank from <code>CONTAINSTABLE</code>. This doesn't provide the desired performance.</p>\n\n<p>How can I make this search faster for short queries?</p>\n"},{"tags":["sql-server","bcp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13253417,"title":"SQL Server bcp parameter, native, character, Unicode native, Unicode character, when to use each?","body":"<p>I'm reading <a href=\"http://msdn.microsoft.com/en-us/library/ms191516.aspx\" rel=\"nofollow\">this page</a> that describing the bcp utility. It states that:</p>\n\n<blockquote>\n  <p>This section contains the following examples that show how to use bcp\n  commands to create a non-XML format file:</p>\n\n<pre><code>A. Creating a non-XML format file for native data\n\nB. Creating a non-XML format file for character data\n\nC. Creating a non-XML format file for Unicode native data\n\nD. Creating a non-XML format file for Unicode character data\n</code></pre>\n  \n  <p>The examples use the HumanResources.Department table in the\n  AdventureWorks2012 sample database. The HumanResources.Department\n  table contains four columns: DepartmentID, Name, GroupName, and\n  ModifiedDate.</p>\n</blockquote>\n\n<p>I'm not clear what does these types mean? When to use each?</p>\n\n<p>Thanks.</p>\n"}]}
{"total":54451,"page":4,"pagesize":100,"questions":[{"tags":["sql","sql-server","query","sql-server-2005"],"answer_count":9,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":76,"score":-1,"question_id":13253445,"title":"Select Part of Column","body":"<p>I was wondering if anyone could help with a query to select part of a column.</p>\n\n<p>The column 'criteriadata' contains data that would look like this:</p>\n\n<blockquote>\n  <p><strong>CriteriaData</strong></p>\n  \n  <p>14 27 15 C</p>\n  \n  <p>14 30 15 DD</p>\n  \n  <p>14 38 15 Pass</p>\n  \n  <p>14 33 15 Pass</p>\n</blockquote>\n\n<p>How can I select just the data that appears after the number 15.</p>\n\n<p>Many thanks.</p>\n"},{"tags":["c#","sql-server","visual-studio","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13253976,"title":"SQL Server Express looking for database in wrong folder","body":"<p>Here is the general problem I'm having:</p>\n\n<p>At work, we have a Visual Studio project that has a SQL project with Entity Framekwork (in addition to a lot of other projects that are class libraries). We are using the same base code for all our projects and just copying it in to a new folder, and adding a new web project and deleting the old web project. We create the database during development automatically if they don't exist already using a DbContext Initializer (it's the <code>DropCreateDatabaseAlways</code> one). Often, whenever this happens and we try to connect to the database, we get the following error:</p>\n\n<p><code>Database 'C:\\\\www\\\\[old project]\\\\app\\\\Web\\\\App_Data\\\\[new project database name from connection string].mdf' already exists. Choose a different database name.\\r\\nCannot attach the file 'C:\\\\www\\\\[new project]\\\\app\\\\Web\\\\App_Data\\\\[new project database name from connection string].mdf' as database '[new project database name]'.\"}</code></p>\n\n<p>It's basically looking in the old folder for the new database, but not actually creating the database like it's supposed to.</p>\n\n<p>Basically it's looking for the database in a different directory than the current project, even though the connection string specifies to attach from the <code>|DataDirectory|</code>. Cleaning the solution, changing the connection string, changing the app.config file, restarting the machine, etc. doesn't help at all. If I rename the folder on the project, it'll work though. </p>\n\n<p>I'm honestly totally flummoxed as to what's going on. I'm fairly competent in and around VS 2010 and SQL Server, so I feel like I should be able to figure out what's going on. It might be something simple that I'm missing, but any help would be appreciated.</p>\n"},{"tags":["asp.net","sql-server","api","soap","sitecore"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13253215,"title":"Need to pull fields from an issue in Sitecore","body":"<p>I'm working with SiteCore and I need to pull some data out of the software via either that API or the SQL database using a PHP script.  The reason I say both are possible is because even if the database changes later on, that doesn't matter to me.</p>\n\n<p>Anyway...</p>\n\n<p>I'm trying to pull any data fields that I can get from a particular issue.  This is my SOAP code so far, and it connects to the service and such, but the return isn't what I need...</p>\n\n<pre><code>try\n{\n    $client = new SoapClient('http://localhost:8083/sitecore/shell/webservice/service.asmx?WSDL');\n\n    $credentials = array('Password' =&gt; 'mypassword','Username' =&gt; 'sitecore\\myusername');\n\n    $Current_Issue = array(\n    'id' =&gt; '{043B69BA-3175-4184-812F-C925CE80324E}',\n    //'language' =&gt; 'en',\n    //'version' =&gt; '1',\n    //'allFields' =&gt; 'true',\n    'databaseName' =&gt; 'web',\n    'credentials' =&gt; $credentials\n    );\n\n    $response = $client-&gt;GetItemMasters($Current_Issue);\n    print_r($response);\n\n}\ncatch(SoapFault $e)\n{\necho $e-&gt;getMessage();\n}\ncatch(Exception $e)\n{\necho $e-&gt;getMessage();\n}\n</code></pre>\n\n<p>This is my output:</p>\n\n<pre><code>stdClass Object\n(\n    [GetItemMastersResult] =&gt; stdClass Object\n        (\n            [any] =&gt; &lt;sitecore xmlns=\"\"/&gt;\n        )\n\n)\n</code></pre>\n\n<p>ANY help is appreciated.  If anybody knows an example SQL query that I can use, that would be just as useful as an alternative method.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13252987,"title":"Inner Join two table-Valued Parameters doesn't work","body":"<p>I am trying to 'inner join' two table values parameters but when i execute the query it takes for ever and i have to stop debug in ms sql server management studio 2008.</p>\n\n<p>The query:</p>\n\n<pre><code>    @allClients [dbo].[ImportedClients] READONLY,\n    @NewClients [dbo].[ImportedClients] READONLY\n\n--Update Clients table in db with new clients\n\n    UPDATE [dbo].[Clients]\n        SET \n\n            Email = ISNULL(ct.Email, x.Email), \n            FirstName = ISNULL(ct.FirstName, x.FirstName), \n            LastName = ISNULL(ct.LastName, x.LastName), \n            Telephone = ISNULL(ct.Telephone, x.Telephone), \n            Cellphone = ISNULL(ct.Cellphone, x.Cellphone), \n\n\n\n        FROM @NewClients ct\n        inner join @allClients x \n        ON (x.Email = ct.Email)     \n\n        WHERE ct.Status &gt; -1 \n</code></pre>\n\n<p>What i am trying to do is: Update all the clients information for rows that exist in both @NewClients and @allClients so i used inner join. \nIs it possible to JOIN two  table-Valued Parameters?\nThis query doesn't (query doesn't complete without an error) work even with a few rows.</p>\n\n<p>any suggestions?</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":34,"score":3,"question_id":13253233,"title":"Easiest way to remove the first instance of two different words in a stored procedure","body":"<p>I've got a column that has some <code>&lt;p&gt;</code> tags like:</p>\n\n<pre><code>&lt;p&gt;test  test 2&lt;/p&gt;    &lt;p&gt;this is a test 2&lt;/p&gt;    &lt;p&gt;this is a test 3&lt;/p&gt;\n</code></pre>\n\n<p>What is the best way to always remove the first <code>&lt;p&gt;</code> with corresponding <code>&lt;/p&gt;</code>.</p>\n\n<p>So that the result becomes:</p>\n\n<pre><code>test test 2 &lt;p&gt; this is a test 2 &lt;/p&gt; &lt;p&gt; this is a test 3&lt;/p&gt;\n</code></pre>\n\n<p>It should work for any case even <code>&lt;p&gt;1&lt;/p&gt;</code> it should result in just <code>1</code>.</p>\n\n<p>I tried using <code>CHARINDEX</code> and <code>SUBSTRING</code> but I end up with a lot of hardcoded #'s :(.</p>\n"},{"tags":["sql-server","stored-procedures"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":5,"view_count":25,"score":-5,"question_id":13252456,"title":"To write a stored procedure to check if data types of columns in 2 tables are same","body":"<p>I have written a sp which checks if the number of rows and columns in two tables.Once that is done I have to check if data types are the same.How do I make sure that the data types are also the same.</p>\n\n<p>This is what I have so far:</p>\n\n<pre><code>CREATE PROCEDURE [sys].[sp_ADC_CheckExcelConfig]\n( \n @TableName1 varchar(100),\n @TableName2 varchar(100),\n @ReturnVal int output\n )\n\n\nAS\n\n declare @R1 int,@R2 int,@C1 int,@C2 int\n\n select @R1= COUNT(*) from @TableName1\n select @R2= COUNT(*) from @TableName2\n\n\n select @C1=COUNT(*) from information_schema.columns where table_name = @TableName1\n select @C2=COUNT(*) from information_schema.columns where table_name = @TableName1\n\n  if((@R1=@R2) and(@C1=@C2))\n   set @ReturnVal=1\n  else\n   set @ReturnVal=0\n\n\n\n return @ReturnVal\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13253259,"title":"SQL Server Replace Command with WIldcard","body":"<p>I am in need of some help. Thanks to fellow user davids, I was able to get certain things working within SQL Server and am in need of some more help. Here is what I am trying to do:</p>\n\n<pre><code>UPDATE Table1 SET keyfield=(REPLACE(REPLACE(Column1,'http://*/folder/',''),'.avi',''))\nUPDATE Table2 SET keyfield=(REPLACE(REPLACE(Column2,'http://server2/folder/',''),'.mpg',''))\n</code></pre>\n\n<p>Can anyone help me out or point me in the right direction to get the wildcard to work? This particular column, the * is an IP Address and it will change all the time. Granted I will know the IP's ahead of time and can probably do it one by one, but I would prefer to have it automatically replace. Thanks in advance!</p>\n"},{"tags":["sql-server","sql-server-2008","truncate","transaction-log"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13252899,"title":"Is there a congruent command to truncate for re-filling a table?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6266450/minimally-logged-insert-into\">Minimally Logged Insert Into</a>  </p>\n</blockquote>\n\n\n\n<p>I have a staging table that I'm going to truncate because a truncate isn't logged. Is there a flag that I can apply to the insert statement (or an alternate statement) so that refilling it will also not be logged in MS SQL Server?</p>\n"},{"tags":["sql","sql-server","ssms"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13252501,"title":"SQL Server Management Studio print in color","body":"<p>I am using SQL Server Management Studio 2012. I am trying to print a stored procedure in the color-coded syntax that it loves showing me, but cannot find an option to enable this. Any ideas?</p>\n\n<p>I know on VS2010 that we (finally) got color output for text, via an add-in on MS's site, but I cannot seem to locate anything for SQL Server Management Studio via Google. Why am I printing this thing out? Because it's 15 pages long, and I am trying to clean it up.  </p>\n"},{"tags":["sql","sql-server"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13252567,"title":"sql - How to selectively select by combining multiple conditions?","body":"<p>I am not sure how to describe my question (maybe title is not proper). </p>\n\n<h2>Here it is:</h2>\n\n<p>I have a table like this:</p>\n\n<pre><code>item   type stockdate    saledate\n\n1      1    2012-11-06   2012-11-05\n\n2      2    2012-11-06   2012-11-07\n\n3      2    2012-11-06   2012-11-05\n</code></pre>\n\n<p>So, I want to select from the above table.</p>\n\n<p>There are two conditions:</p>\n\n<ol>\n<li>if the <code>type</code> of an item is <code>1</code>, then I anyway show this item</li>\n<li>If the <code>type</code> of an item is <code>2</code>, but its <code>saledate &gt;= stockdate</code>, then I show; otherwise, I don't show</li>\n</ol>\n\n<p>So from the above table, I want to <code>show only item 1 and 2</code>, because item 1 has <code>type of 1</code>, item 2 has <code>type of 2</code> but its <code>saledate &gt;= stockdate</code>, item 3 cannot be shown because its <code>saledate&lt;stockdate</code>.</p>\n\n<p><strong>How can I write the select query?</strong></p>\n\n<p>I am using MS SQL Server.</p>\n"},{"tags":["sql-server"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":3130,"score":4,"question_id":3829271,"title":"How can I clone an SQL Server database on the same server in SQL Server 2008 Express?","body":"<p>I have an MS SQL Server 2008 Express system which contains a database that I would like to 'copy and rename' (for testing purposes) but I am unaware of a simple way to achieve this.</p>\n\n<p>I notice that in the R2 version of SQL Server there is a copy database wizard, but sadly I can't upgrade.</p>\n\n<p>Thanks in advance</p>\n\n<p>UPDATE\nThe database in question is around a gig.\nI attempted to restore a backup of the database I want to copy into a new database, but with no luck.</p>\n"},{"tags":["sql-server","plugins","database-management"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":142,"score":1,"question_id":2872837,"title":"Is there a way to create subdatabases as a kind of subfolders in sql server?","body":"<p>I am creating an application where there is main DB and where other data is stored in secondary databases. The secondary databases follow a \"plugin\" approach. I use SQL Server.</p>\n\n<p>A simple installation of the application will just have the mainDB, while as an option one can activate more \"plug-ins\" and for every plug-in there will be a new database.</p>\n\n<p>Now why I made this choice is because I have to work with an exisiting legacy system and this is the smartest thing I could figure to implement the plugin system.</p>\n\n<p>MainDB and Plugins DB have exactly the same schema (basically Plugins DB have some \"special content\", some important data that one can use as a kind of template - think to a letter template for example - in the application). Plugin DBs are so used in readonly mode, they are \"repository of content\". The \"smart\" thing is that the main application can also be used by \"plugin writers\", they just write a DB inserting content, and by making a backup of the database they creaetd a potential plugin (this is why all DBs has the same schema).</p>\n\n<p>Those plugins DB are downloaded from internet as there is a content upgrade available, every time the full PlugIn DB is destroyed and a new one with the same name is creaetd. This is for simplicity and even because the size of this DBs is generally small.</p>\n\n<p>Now this works, anyway I would prefer to organize the DBs in a kind of Tree structure, so that I can force the PlugIn DBs to be \"sub-DBs\" of the main application DB.</p>\n\n<p>As a workaround I am thinking of using naming rules, like:</p>\n\n<p>ApplicationDB (for the main application DB)</p>\n\n<p>ApplicationDB_PlugIn_N (for the N-th plugin DB)</p>\n\n<p>When I search for plugin 1 I try to connect to ApplicationDB_PlugIn_1, if I don't find the DB i raise an error. This situation can happen for example if som DBA renamed ApplicationDB_Plugin_1.</p>\n\n<p>So since those Plugin DBs are really dependant on ApplicationDB only I was trying to \"do the subfolder trick\".</p>\n\n<p>Can anyone suggest a way to do this? Can you comment on this self-made plugin approach I decribed above?</p>\n\n<p><strong>ADDED INFO (AFTER STARTING THE BOUNTY):</strong></p>\n\n<p>In the MainDB I plan to store the connection info to all the plugin DBs. Basically it is the database name, since I deigned the sytem in a way that even if I use multiple sql server logins to access the MainDB, behind the scenes a single user (typically \"sa\" or another user with admin privileges).</p>\n\n<p>So basically if I need to query multiple databases I will use the database name to distinguish between plugins, I don't need to explicitly create fileds called PluginID in the database tables.</p>\n\n<p>So somehow it works like this, in the main DB I store the plugin DB names. So I know the name of the plugins, so if I want to query all the GUNS from all plugins i will do something like this:</p>\n\n<pre><code>select * from ApplicationDB_Plugin_1.dbo.weapons where weapon_type = 'gun'\nunion\nselect * from ApplicationDB_Plugin_2.dbo.weapons where weapon_type = 'gun'\nunion\nselect * from ApplicationDB_Plugin_3.dbo.weapons where weapon_type = 'gun'\n</code></pre>\n\n<p>so the \"trick\" is using the dbname to distinguish between plugins. Now this work, but it seems a little \"dirty\" to me. My question is \"IS THERE A BETTER APPROACH YOU CAN ENVISION?\"</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2000","sql-update"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2470,"score":1,"question_id":3867164,"title":"SQL update query syntax with inner join","body":"<p>Can anyone find my error in this query?  I'm using SQL Server 2000 and I want to update all entries in the CostEntry table to the corresponding value in the ActiveCostDetails table.  The where clause DOES work with a select statement.</p>\n\n<pre><code>    UPDATE CostEntry CE \nINNER JOIN ActiveCostDetails As AD ON CostEntry.lUniqueID = ActiveCostDetails.UniqueID\n       SET CostEntry.sJobNumber = ActiveCostDetails.JobNumber\n     WHERE CostEntry.SEmployeeCode = '002'\n       AND SubString(CostCentre, 1, 1) = sDepartmentCode\n       AND substring(CostCentre, 3, 1) = sCategoryCode\n       AND substring(CostCentre, 5, 2) = sOperationCode\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13238590,"title":"How to suppress the headings output of a SQL query that returns no row","body":"<p>What I am trying to do is this. Set up a SQL job that will query the database every hour looking for bad integers (-1s or zeros). Then put the output into an email and send the results to the dev team. I'm searching 80+ tables. If a particular table has no errors, IE no -1s, 0s or NULLs, and therefore returns no rows, I want to suppress the headings as well. I don't want to email a form full of headings if there are no problems. I know that I could do an \"IF EXISTS\" \"ROWCOUNT >0\" but that requires running each query twice. Once to see if it returns rows, and if true, again to get the results. Does anyone know of a better way to do this?</p>\n"},{"tags":["sql-server","query","tsql","time"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":3,"view_count":53,"score":-2,"question_id":13246987,"title":"TSQL query to sum time periods per range","body":"<p>I need to create a query to sum day's hours and night's hours from a range intersec.\nFor example with this range:</p>\n\n<pre><code>8AM-8PM -&gt; day\n8PM-8AM -&gt; night\n</code></pre>\n\n<p>and one or more start-end time period:</p>\n\n<pre><code>7.30AM 10.00PM\n</code></pre>\n\n<p>I would like to get this values:</p>\n\n<pre><code>12 day's hours\n2.5 night's hours\n</code></pre>\n\n<p>I don't know which is the bast way to accomplish this function.</p>\n"},{"tags":["sql-server","signalr"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13245856,"title":"How to use SignalR in a webfarm, using Sql server as the backplane","body":"<p>Based on this topic <a href=\"http://stackoverflow.com/questions/12810002/signalr-sqlserver-listening\">signalr-sqlserver-listening</a>, SignalR can be used in a webfarm, using Sql server as the backplane to communicate messages to all webnodes.</p>\n\n<p>I wonder if there is any documentation/example on this.</p>\n"},{"tags":["c#","sql","sql-server","database"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13251809,"title":"how to re-order IDs after deleting a row in database","body":"<p>Im using C# to make program that has a sql database, in the database I have a table named <code>Workers</code>, it has an auto increament and Primary key <code>ID_column</code>, when I delete a record the IDs will have a gap between each other.</p>\n\n<p>what should I do re-order the IDs after deleting a record??</p>\n\n<p>UPDATE</p>\n\n<p>what i am going to do is to display the record on the screen after finding it,\nso I tried to do that using the <code>ID</code> but it make some exception because of these gaps !!</p>\n\n<p>UPDATE 2</p>\n\n<p>this is the code I tried to use</p>\n\n<pre><code>private void btnFind_Click(object sender, EventArgs e)\n    {\n        string searchFor = \"\";\n        string searchOn = \"\";\n        string searchString = \"\";\n        int results = 0;\n\n        if (searchTextBox.Text.Trim() == \"\")\n            MessageBox.Show(\"Nothing to search for\");\n\n        if (cb1.Text == \"Last Name\")\n        {\n            searchFor = searchTextBox.Text.Trim();\n            searchOn = \"last_Name=\";\n            searchString = searchOn + \"'\" + searchFor + \"'\";\n        }\n\n        if (cb1.Text == \"Job Title\")\n        {\n            searchFor = searchTextBox.Text.Trim();\n            searchOn = \"job_Title=\";\n            searchString = searchOn + \"'\" + searchFor + \"'\";\n        }\n\n        DataRow[] returnedRows;\n\n        returnedRows = ds1.Tables[\"Workers\"].Select(searchString);\n\n        results = returnedRows.Length;\n\n        if (results &gt; 0)\n        {\n            DataRow dr1;\n\n            dr1 = returnedRows[0];\n            inc = (int)dr1[\"Worker_ID\"]-1;\n\n            NavigateRecords();\n\n        }\n        else\n        {\n            MessageBox.Show(\"No such Record\");\n        }\n\n    }\n</code></pre>\n\n<p><code>inc</code> is the currently displayed record and <code>NavigateRecords()</code> is do display the recored with the giving number <code>inc</code></p>\n\n<pre><code>void NavigateRecords()\n    {\n        DataRow dRow = ds1.Tables[\"Workers\"].Rows[inc];\n\n        textBox1.Text =  dRow.ItemArray.GetValue(1).ToString();\n        textBox2.Text =  dRow.ItemArray.GetValue(2).ToString();\n        textBox3.Text =  dRow.ItemArray.GetValue(3).ToString();\n    }\n</code></pre>\n"},{"tags":["sql-server","entity-framework-4","compact-database"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2220,"score":2,"question_id":6947325,"title":"Connection string for using Sql Server Compact with Entity Framework?","body":"<p>I'm done trying to Google for this. I have installed sql ce 4.0, and have EF 4.1, but I can't get a proper connection string. Nothing on connectionstrings.com applies to me. I just want to create a SqlCeEngine object, but no matter what I try I get some exception. Most recently it's been \"Unknown connection option in connection string\" with either \"metadata\", \"app\", \"provider\", or \"provider connection string\" after it. I know EF requires metadata in the connection string. And I can't imagine how anything could do without \"provider connection string\".</p>\n\n<p>So far I have this:</p>\n\n<pre><code>&lt;add name=\"DBContext\" connectionString=\"provider connection string=&amp;quot;Data Source=MyDbFile.sdf;Persist Security Info=False;&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>At one point I had it with metadata:</p>\n\n<pre><code>&lt;add name=\"DBContext\" connectionString=\"metadata=res://*/Data.DBContext.csdl|res://*/Data.DBContext.ssdl|res://*/Data.DBContext.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=MyDbFile.sdf;Persist Security Info=False;&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>Does it need metadata or not? What goes in the \"app\" part of the connection string? What should the provider be, System.Data.SqlClient, or some CE version? (which I still can't find when I try to add references. My add references window still only contains System.Data.SqlServerCe version 3.5.1.0.) Or nothing? And what should go in the providerName attribute? Is System.Data.EntityClient correct? It's like there are 10 different variables here and every combination gives me a new equally mysterious error, none of which turns up anything useful on Google. I'm at my wits' end. Is this even possible?</p>\n"},{"tags":[".net","sql-server","architecture","polling"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13251365,"title":"Can I poll a database every 3 seconds","body":"<p>I am building a system to asynchronously send mails after processing data (could take up to 10 sec the processing).</p>\n\n<p>My initial idea was to have a windows service poll the database with data processing requests every 3 seconds for the first record to be processed. When done, poll and get the new first record to be processed. </p>\n\n<p>When there are no records left wait 3 seconds and poll again to check for records.</p>\n\n<p>I'm not sure if this is a good idea. The use of a timer is not a great way to program in my opinion. Also the performance and the use of the database even when not needed is a concern.</p>\n\n<p>What is the best practice in this case?</p>\n\n<p>Technologies used: .net 3.5, SQL Server, servers are in farm.</p>\n"},{"tags":["sql-server","ssis","etl"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":141,"score":1,"question_id":12510152,"title":"Deploying ssis 2012 with visual studio 2010","body":"<p>I've created a new SSIS package in Visual Studio 2010 and started deploying the package to a SQL 2012 database on a remote server.</p>\n\n<p>I can connect to the DB and see the SSISDB folder but when i deploy the package I get the following error:</p>\n\n<p>\"The path for 'ISServerExec.exe' cannot be found. The operation will now exit.\"</p>\n"},{"tags":["sql-server","xml","vb.net","web-services","ado.net"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13251520,"title":"Getting image from SQL Server, using ADO .NET / VB .NET","body":"<p>I created an Android application that use Web Services (writtend in VB .NET) for obtaining data in form of String and Integer. (the data is retrieved from sql server)\nNow I want to modify these services in order to download some images from sql server.</p>\n\n<p>A tipical service I used, has the following structure</p>\n\n<pre><code>POST /OmniaCare.asmx HTTP/1.1\nHost: localhost\nContent-Type: text/xml; charset=utf-8\nContent-Length: length\nSOAPAction: \"http://tempuri.org/GetProviders\"\n\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"     xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"     xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;\n  &lt;soap:Body&gt;\n&lt;GetProviders xmlns=\"http://tempuri.org/\"&gt;\n  &lt;Username&gt;string&lt;/Username&gt;\n  &lt;Password&gt;string&lt;/Password&gt;\n  &lt;Date&gt;int&lt;/Date&gt;\n&lt;/GetProviders&gt;\n  &lt;/soap:Body&gt;\n  &lt;/soap:Envelope&gt;\n   HTTP/1.1 200 OK\n   Content-Type: text/xml; charset=utf-8\n   Content-Length: length\n\n &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n &lt;soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"    xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;\n &lt;soap:Body&gt;\n   &lt;GetProvidersResponse xmlns=\"http://tempuri.org/\"&gt;\n     &lt;GetProvidersResult&gt;\n       &lt;Providers&gt;\n         &lt;Provider&gt;\n           &lt;cf&gt;string&lt;/cf&gt;\n           &lt;username&gt;string&lt;/username&gt;\n           &lt;description&gt;string&lt;/description&gt;\n           &lt;active&gt;int&lt;/active&gt;\n        &lt;/Provider&gt;\n      &lt;Providers&gt;\n         &lt;Provider&gt;\n           &lt;cf&gt;string&lt;/cf&gt;\n           &lt;username&gt;string&lt;/username&gt;\n           &lt;description&gt;string&lt;/description&gt;\n           &lt;active&gt;int&lt;/active&gt;\n        &lt;/Provider&gt;\n    &lt;/Providers&gt;\n    &lt;Message&gt;string&lt;/Message&gt;\n    &lt;Code&gt;int&lt;/Code&gt;\n  &lt;/GetProvidersResult&gt;\n    &lt;/GetProvidersResponse&gt;\n   &lt;/soap:Body&gt;\n  &lt;/soap:Envelope&gt;\n</code></pre>\n\n<p>In VB .NET I use this code for getting data and return information to the WS caller.</p>\n\n<pre><code>    Using conn As SqlConnection = New SqlConnection(Utilities.ConnectionString)\n            sqlcmd = New SqlClient.SqlCommand()\n            sqlcmd.Connection = conn\n            sqlcmd.CommandType = CommandType.StoredProcedure\n            sqlcmd.CommandText = \"SPGetProviders\" \n            sqlcmd.Parameters.Add(New SqlClient.SqlParameter(\"@param1\", codice_fiscale))\n            sqlcmd.Parameters.Add(New SqlClient.SqlParameter(\"@param2\", mydate))\n            sqlcmd.Parameters.Add(New SqlClient.SqlParameter(\"@mode\", 1))\n\n            da = New SqlClient.SqlDataAdapter()\n            da.SelectCommand = sqlcmd\n            table = New DataTable()\n            da.Fill(table)\n     End Using\n\n    For Each row In table.Rows\n            Provider = New ProviderC()\n            Provider.cf = Utilities.DBNullToVoidString(row.Item(\"cf\"))\n            Provider.username = Utilities.DBNullToVoidString(row.Item(\"user\"))\n            Provider.descrizione = Utilities.DBNullToVoidString(row.Item(\"description\"))\n            Provider.active= Convert.ToInt32(Utilities.DBNullToNothing(row.Item(\"active\")))\n\n    ListOfProvider.Add(Provider)\n\n\n   Next\n\n        Reserch.Providers= ListOfProvider.ToArray()\n        Reserch.Code= 0\n        Reserch.Message= \"ok\"\n\n   Return Reserch\n</code></pre>\n\n<p>where Reserch is an object containing the three parameters that should be returned from WS.</p>\n\n<p>All this code works pretty good. But now I want add a new output parameter in the WS that is an Image. From my SQL server I can obtain a URL where the image is located. \nThen, I can get this image using the obtained URL and how can I pass this image in the output parameter of WS? </p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":44,"score":3,"question_id":13250851,"title":"how to detect a faulty sequence column with sql?","body":"<p>I have this table</p>\n\n<pre><code>ID  |  Seq  \n------------\n A      1      \n A      2      \n A      3      \n B      1      \n B      2     \n B      3     \n B      3     &lt;--duplicate seq where ID=B\n C      1     \n C      2\n C      4     &lt;--missing seq id number 3\n D      1\n D      2\n .      .\n .      .\n</code></pre>\n\n<p>Is there a way to detect if/when there is an error in the logic of the Seq column, specifically if there are jumps and/or duplicates. </p>\n"},{"tags":["sql","sql-server","sql-server-2008","guid","entropy"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":23,"score":-1,"question_id":13251251,"title":"SQL Server 2008 GUID generation","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3242287/how-are-guids-generated-in-sql-server\">how are GUIDs generated in SQL Server?</a>  </p>\n</blockquote>\n\n\n\n<p>I wonder how SQL Server 2008 GUIDs are generated? Entropy bits</p>\n"},{"tags":["java","sql-server","jdbc"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13231606,"title":"jdbc:jtds Connection to SQL server","body":"<p>I am trying to create a connection between some Java and a SQL Server using a JDBC driver. I have created a Connection class which should form the connection to a server which is on my computer with example IP address 'BHX'</p>\n\n<p>Here is the Connection class</p>\n\n<pre><code>public class Connection {\n\npublic static void main(String[] args) throws Exception {\n\n    try {\n        String databaseDriver = \"net.sourceforge.jtds.jdbc.Driver\";\n        Class.forName(databaseDriver);\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n    try {               \n        String url = \"jdbc:jtds:sqlserver://BHX:1433/Forecast;instance=SQLEXPRESS\";\n        java.sql.Connection con =  DriverManager.getConnection(url);\n        System.out.println(\"Connection created\");\n        con.close();\n    } catch (Exception e1) {\n        e1.printStackTrace();\n    }\n}\n}\n</code></pre>\n\n<p>I'm wondering whether there is anything wrong with the url String, as when I run this code I get the following error:</p>\n\n<pre><code>java.sql.SQLException: Network error IOException: Connection refused: connect\nat net.sourceforge.jtds.jdbc.ConnectionJDBC2.&lt;init&gt;(ConnectionJDBC2.java:417)\nat net.sourceforge.jtds.jdbc.ConnectionJDBC3.&lt;init&gt;(ConnectionJDBC3.java:50)\nat net.sourceforge.jtds.jdbc.Driver.connect(Driver.java:185)\nat java.sql.DriverManager.getConnection(Unknown Source)\nat java.sql.DriverManager.getConnection(Unknown Source)\nat Connection.main(Connection.java:56)\nCaused by: java.net.ConnectException: Connection refused: connect\nat java.net.PlainSocketImpl.socketConnect(Native Method)\nat java.net.PlainSocketImpl.doConnect(Unknown Source)\nat java.net.PlainSocketImpl.connectToAddress(Unknown Source)\nat java.net.PlainSocketImpl.connect(Unknown Source)\nat java.net.SocksSocketImpl.connect(Unknown Source)\nat java.net.Socket.connect(Unknown Source)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nat java.lang.reflect.Method.invoke(Unknown Source)\nat net.sourceforge.jtds.jdbc.SharedSocket.createSocketForJDBC3(SharedSocket.java:311)\nat net.sourceforge.jtds.jdbc.SharedSocket.&lt;init&gt;(SharedSocket.java:261)\nat net.sourceforge.jtds.jdbc.ConnectionJDBC2.&lt;init&gt;(ConnectionJDBC2.java:318)\n... 5 more\n</code></pre>\n\n<p>I have seen similar questions <a href=\"http://stackoverflow.com/questions/1862283/help-me-create-a-jtds-connection-string\">(like this here)</a> but its looks as though I have followed all the possible solutions. I have checked that the TCP/IP are enabled in the configuration manager and also that the port number is 1433. </p>\n\n<p>I've tried running this with Firewalls disabled and still get the same error.</p>\n\n<p>telnet BHX 1433 and I am getting the following message '...Could not open connection to the host, on port 1433: Connect failed' </p>\n"},{"tags":["sql","sql-server","sql-server-2008","join","duplicate-removal"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":42,"score":2,"question_id":13250247,"title":"Join Tables SQL Server with duplicates","body":"<p>I have a table </p>\n\n<pre><code>col1\n\n1\n2\n</code></pre>\n\n<p>and other table </p>\n\n<pre><code>col1    col2    col3\n\n1          1    data value one                                    \n1          2    data value one                                    \n2          3    data value two   \n</code></pre>\n\n<p>and I want to join both tables to obtain the following result</p>\n\n<pre><code>col1  col2  col3\n\n1       1    data value one\n2       3    data value two\n</code></pre>\n\n<p>The second table have duplicates but I need to join only one (randomly). I've tried with Inner Join, Left Join, Right Join and always returns all rows. Actually I use <code>SQL Server 2008</code>.</p>\n"},{"tags":["sql","sql-server","xml","query"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13249503,"title":"SQL XML query from column","body":"<p>How to select file names from this kind of XML in a SQL Server column?</p>\n\n<ol>\n<li><p>file name is in attribute <code>VALUE</code> only if high level tag is object with name <code>File</code>\nlike this</p>\n\n<pre><code>&lt;Object NAME=\"File\"&gt;\n    &lt;Parameter ID=\"1\" NAME=\"Name\" VALUE=\"\\\\mysvr\\fiels\\readme1.txt\" /&gt;\n&lt;/Object&gt;\n</code></pre></li>\n<li><p>This sub-hierarchy can be placed on any level of xml (see example below)</p></li>\n<li><p>XML column can contain 0-N file names, I need list like this:</p>\n\n<pre><code>id, filename\n--- ------------------------\n 1  \\\\mysvr\\fiels\\readme1.txt\n 1  \\\\mysvr\\fiels\\readme2.txt\n 2  \\\\mysvr\\fiels\\readme3.txt\n 2  \\\\mysvr\\fiels\\readme4.txt\n</code></pre></li>\n</ol>\n\n<p>Example of XML contents:</p>\n\n<pre><code>declare @t1 table\n(   id int,\n   x XML\n)\n\ninsert into @t1 (id, x)\nselect 1,N'&lt;root name=\"name\" id=\"12\"&gt;\n&lt;class1&gt;\n  &lt;Object NAME=\"File\"&gt;\n              &lt;Parameter ID=\"1\" NAME=\"Name\" VALUE=\"\\\\mysvr\\fiels\\readme1.txt\" /&gt;\n   &lt;/Object&gt;\n&lt;/class1&gt;\n&lt;class1&gt;\n&lt;subclass1&gt;\n&lt;Object NAME=\"File\"&gt;\n              &lt;Parameter ID=\"10\" NAME=\"Name\" VALUE=\"\\\\mysvr\\fiels\\readme2.txt\" /&gt;\n&lt;/Object&gt;\n&lt;Object NAME=\"bitmap\"&gt;\n              &lt;Parameter ID=\"11\" NAME=\"my1\" VALUE=\"bmp\" /&gt;\n&lt;/Object&gt;\n&lt;/subclass1&gt;\n&lt;/class1&gt;\n&lt;/root&gt;'\nunion \nselect 2,N'&lt;root name=\"name\" id=\"12\"&gt;\n&lt;class1&gt;\n  &lt;Object NAME=\"File\"&gt;\n              &lt;Parameter ID=\"13\" NAME=\"Name\" VALUE=\"\\\\mysvr\\fiels\\readme3.txt\" /&gt;\n  &lt;/Object&gt;\n  &lt;Object NAME=\"Font\"&gt;\n              &lt;Parameter ID=\"22\" NAME=\"Tahoma\" VALUE=\"11\" /&gt;\n  &lt;/Object&gt;\n&lt;/class1&gt;\n&lt;class1&gt;\n&lt;subclass1&gt;\n  &lt;Object NAME=\"File\"&gt;\n              &lt;Parameter ID=\"14\" NAME=\"Name\" VALUE=\"\\\\mysvr\\fiels\\readme4.txt\" /&gt;\n  &lt;/Object&gt;\n&lt;/subclass1&gt;\n&lt;/class1&gt;\n&lt;/root&gt;'\n</code></pre>\n"},{"tags":["sql","sql-server","oracle","common-table-expression"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":45,"score":4,"question_id":13153819,"title":"how to select only row with max sequence without using a subquery?","body":"<p>I'm trying to select only the row with the highest seq for each ID</p>\n\n<pre><code>ID  |  Seq   |  Age\n-------------------\n A      1       20   \n A      2       30\n B      1       25\n B      2       32\n B      3       44\n B      4       48\n C      1       11\n</code></pre>\n\n<p>This appears to work</p>\n\n<pre><code>SELECT ID, Age\nFROM Persons a\nWHERE Seq = (SELECT MAX(Seq) FROM Persons b WHERE a.ID = b.ID)\n</code></pre>\n\n<p>But is this the best way, the only way? I don't like using subqueries if I don't have to and I recall you can use something but I forget what it is. Any idea?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":25,"score":2,"question_id":13248659,"title":"Round the third decimal place up into the second decimal place (e.g. $0.033 becomes $0.04)","body":"<p>When we increased the price with 10%, some products (the ones that have 3 decimal points), got an unwanted price change. For example, an item that had a price of <code>0.03</code> changed to <code>0.033</code>. </p>\n\n<p>Our client doesn't want a three decimal point in the pricing. </p>\n\n<p>We want to round the third decimal place up into the second decimal place (e.g. <code>$0.033</code> becomes <code>$0.04</code>).</p>\n\n<p>If my value is <code>0.033</code>, I want result to be <code>0.04</code>.</p>\n\n<p>Please help me</p>\n\n<p>Regards</p>\n\n<p>Amit Vyas</p>\n"},{"tags":["sql","sql-server","xml"],"answer_count":2,"favorite_count":4,"up_vote_count":8,"down_vote_count":0,"view_count":16678,"score":8,"question_id":869405,"title":"SQL Server: How to get hold of XML attributes in a query?","body":"<p>I'm currently trying to get all of the attributes from some XML with an SQL query.</p>\n\n<p>I've been attempting the following to retrieve it, but I must be missing something rather fundamental.</p>\n\n<pre><code>DECLARE @T varchar(max) \nSET @T = \n'&lt;root&gt;\n    &lt;Field FieldRowId=\"1000\"&gt;\n\t&lt;Items&gt;\n\t\t&lt;Item Name=\"CODE\"/&gt;\n\t\t&lt;Item Name=\"DATE\"/&gt;\n\t&lt;/Items&gt;\n    \t&lt;Attributes&gt;\n\t\t&lt;Attribute ID =\"1\"/&gt;\n    \t&lt;/Attributes&gt;\n    &lt;/Field&gt;\n    &lt;Field FieldRowId=\"2000\"&gt;\n\t&lt;Items&gt;\n                &lt;Item Name=\"CODE\"/&gt;\n                &lt;Item Name=\"DATE\"/&gt;\n\t&lt;/Items&gt;\n\t&lt;Attributes&gt;\n\t\t&lt;Attribute ID =\"2\"/&gt;\n\t&lt;/Attributes&gt;\n    &lt;/Field&gt;\n&lt;/root&gt;'\n\nDECLARE @X xml\n\nSET @X = CAST(@T as xml)\nSELECT Y.ID.value('@FieldRowId', 'int') as FieldID, \n   Y.ID.value('/Items/@Name', 'varchar(max)') as \"Name\",\n   Y.ID.value('/Attributes/@ID', 'int') as AttributeID\nFROM @X.nodes('/root/Field') as Y(ID)\n</code></pre>\n"},{"tags":["c#","sql","sql-server","linq","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":88,"score":3,"question_id":13249220,"title":"Using text SQL with LINQ","body":"<p>I'm currently having issues with using LINQ to SQL for my project. This is because most of the lengthy SQL queries (or <em>views</em>, rather) are hard-coded into C#, and what we've been doing all along is to use <code>context.Database.SqlQuery&lt;ClassName&gt;(sql, sqlParams)</code>.</p>\n\n<p>It's been generally very effective, but right now we need something more dynamic. We need to plug in stuff like <code>.Where(x =&gt; x.Name.Contains(\"Anonymous\")).Take(20)</code> or something else along the lines. However, plugging in directly to the previously mentioned line of code would result in the following:</p>\n\n<p><code>context.Database.SqlQuery&lt;ClassName&gt;(sql, sqlParams).Where(x =&gt; x.Name.Contains(\"Anonymous\")).Take(20);</code></p>\n\n<p>While it actually works and pulls the top 20 records where the name contains \"Anonymous\", the performance is pretty bad. What it does behind the scenes is to take all the records from that table and then finally filtering them after having loaded them to memory.</p>\n\n<p>I would then like to ask, is there any way to translate the text SQL to LINQ, or translate the LINQ to SQL, such that I can execute both my text SQL and LINQ in one single statement. If you don't actually have a solution, I'd gladly appreciate suggestions too...!</p>\n\n<p><strong>EDIT:</strong> I've considered using Expression Trees, but I'm not sure how they can actually fit into the picture. Also, I've considered using database views. But there are so many views (quite a number per table) it would definitely be a hassle to port everything over to MS SQL and then rewriting all the querying logic.</p>\n"},{"tags":["sql-server","delphi","firemonkey","livebindings","delphi-xe3"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":219,"score":0,"question_id":12305384,"title":"Delphi XE 3 LiveBindings AutoInc SQL Server","body":"<p>I have a Delphi XE3 Firemonkey app with LiveBindings to a SQL Server. I can connect and see all the data on a grid. I have a field (\"id\") which is an \"identity field\" on SQL (more commonly known as an AutoInc).</p>\n\n<p>When I try to add a record I get \"Field 'id' must have a value.\"</p>\n\n<p>In the past, the fix for this has been to turn off the required field boolean. (With DBISAM, for example, you make the field in the database itself not required and the DB engine fills it in when it gets there, but you can't make an identity field not required in MSSQL.) </p>\n\n<p>I've turned off the requirement for the TField itself, but that has no effect.</p>\n"},{"tags":["sql-server","sum","cross-apply"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13247275,"title":"cross apply in sql with sum","body":"<p>I have the following query:  </p>\n\n<pre><code>insert into [MyDB].[dbo].[Reports_ActivityStat] (ActivityID,TaskID,LS_HowOthersAnswered,LS_ImproveMyChances)\n(\nSELECT\nActivityID=tasks.ActivityID,\nTaskID=tasks.ID,\nCAST(\n        CASE \n            WHEN CHARINDEX('stats',item.value('(UsedLifeSavers)[1]', 'NVARCHAR(MAX)'))&gt;0\n                THEN 1 \n            ELSE 0 \n        END AS bit) as LS_HowOthersAnswered,\nCAST(\n        CASE \n            WHEN CHARINDEX('FiftyFifty',item.value('(UsedLifeSavers)[1]', 'NVARCHAR(MAX)'))&gt;0\n                THEN 1 \n            ELSE 0 \n        END AS bit) as LS_ImproveMyChances\n\nFROM  [MyDB].[dbo].[Tasks] as tasks CROSS APPLY [Progress].nodes ('//Progress/Steps/ProgressStep') Progress(item)\n)  \n</code></pre>\n\n<p>which acts on the following <code>Tasks</code> table:  </p>\n\n<pre><code> ID  |   ActivityID    |      Progress  \n  1  |        1        |  [example below..]  \n  2  |        1        |  [example below..]\n</code></pre>\n\n<p>Where <code>Progress</code> is an xml of the sort:  </p>\n\n<pre><code>&lt;Progress xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n  &lt;Steps&gt;\n    &lt;ProgressStep&gt;\n      &lt;FinishedOn&gt;2012-10-30T13:07:52.6374861+02:00&lt;/FinishedOn&gt;\n      &lt;Score&gt;0&lt;/Score&gt;\n      &lt;StartedOn&gt;2012-10-30T13:07:45.8234861+02:00&lt;/StartedOn&gt;\n      &lt;Status&gt;Finished&lt;/Status&gt;\n      &lt;StepIndex&gt;0&lt;/StepIndex&gt;\n      &lt;StepType&gt;Summary&lt;/StepType&gt;\n      &lt;UsedLifeSavers xmlns:a=\"http://schemas.datacontract.org/2004/07/MindLab.Logic.Study\" /&gt;\n    &lt;/ProgressStep&gt;\n    &lt;ProgressStep&gt;\n      &lt;FinishedOn i:nil=\"true\" /&gt;\n      &lt;PartNumber&gt;1&lt;/PartNumber&gt;\n      &lt;Score&gt;0&lt;/Score&gt;\n      &lt;StartedOn&gt;2012-10-30T13:07:52.6374861+02:00&lt;/StartedOn&gt;\n      &lt;Status&gt;NotFinished&lt;/Status&gt;\n      &lt;StepIndex&gt;1&lt;/StepIndex&gt;\n      &lt;StepType&gt;Information&lt;/StepType&gt;\n      &lt;SubmittedAnswersCount&gt;0&lt;/SubmittedAnswersCount&gt;\n      &lt;UsedLifeSavers xmlns:a=\"http://schemas.datacontract.org/2004/07/MindLab.Logic.Study\"&gt;\n        &lt;a:LifeSavers&gt;Stats&lt;/a:LifeSavers&gt;\n        &lt;a:LifeSavers&gt;FiftyFifty&lt;/a:LifeSavers&gt;\n      &lt;/UsedLifeSavers&gt;\n    &lt;/ProgressStep&gt;  \n  &lt;/Steps&gt;\n&lt;/Progress&gt;  \n</code></pre>\n\n<p>(usually there are many more than 2 steps..)  </p>\n\n<p>My query yields (not actual data, just sample):  </p>\n\n<pre><code> ID  |   ActivityID    |   TaskID   |    LS_HowOthersAnswered   |   LS_ImproveMyChances\n  1  |        1        |      1     |             0             |             0\n  2  |        1        |      1     |             1             |             0  \n  3  |        1        |      1     |             0             |             0    \n</code></pre>\n\n<p>This is almost what I need but not quite.<br>\nI need for every unique TaskID the <code>SUM</code> of all <code>LS_HowOthersAnswered</code> and <code>LS_ImproveMyChances</code>.<br>\nI was trying to group by, but couldn't make it because it's just too different from regular inner join in that matter..</p>\n"},{"tags":["c#","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13249306,"title":"How to find SQL Server instance name and server name from the code behind using c#?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6824188/sqldatasourceenumerator-instance-getdatasources-does-not-locate-local-sql-serv\">SqlDataSourceEnumerator.Instance.GetDataSources() does not locate local SQL server 2008 instance</a>  </p>\n</blockquote>\n\n\n\n<p>I am using code below to get all instance names and server names in my local machine, but it seems it is returning only one instance; how to get all list of instance name and server name in my local machine?</p>\n\n<pre><code>string myServer = Environment.MachineName;\n\nDataTable servers = SqlDataSourceEnumerator.Instance.GetDataSources();\n\nfor (int i = 0; i &lt; servers.Rows.Count; i++)\n{\n        if (myServer == servers.Rows[i][\"ServerName\"].ToString()) \n        {\n            if ((servers.Rows[i][\"InstanceName\"] as string) != null)\n            {\n                CmbServerName.Visibility = Visibility.Visible;\n                CmbServerName.Items.Add(servers.Rows[i][\"ServerName\"] + \"\\\\\" + servers.Rows[i][\"InstanceName\"]);\n\n            }\n            else\n            {\n                CmbServerName.Visibility = Visibility.Visible;\n                CmbServerName.Items.Add(servers.Rows[i][\"ServerName\"]);\n\n            }\n        }\n}\n</code></pre>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server","query","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13248976,"title":"How to insert, update, delete when import data from table to table?","body":"<p>I have a query that I need to run more than once a day. This query is importing data from a database to another. </p>\n\n<p>The target table structure is:  </p>\n\n<pre><code>Id   Date        Department  Location  PersonId  Starttime       EndTime       State\n1    2012-01-01      2           5       200     12:00:00.000    15:00:00.000   2\n</code></pre>\n\n<p>An application can also insert data to the target table. The records that are inserted by the application may not be updated also when this record exists in the source(temp table) table with another state.</p>\n\n<p>To make this possible I have an solution created. I will create an new column in the target table with a second state so that I can check.</p>\n\n<pre><code>Id   Date        Department  Location  PersonId  Starttime       EndTime       State   StateSource\n1    2012-01-01      2           5       200     12:00:00.000    15:00:00.000   2       2\n</code></pre>\n\n<p>Some Requirements:</p>\n\n<p>If a record is added by the application than StateSource will be NULL. Means that this record may not be deleted, updated or inserted again from the source table.</p>\n\n<p>If a Record is updated by the application than the value State and StateSource will be different. In this case I do not update this record.</p>\n\n<p>I will update if the state from the sourcetable and targettable are not same and the values from target table State = StateSource.</p>\n\n<p>I will INSERT a record when this is not exists in the target table. When records already exists do not insert (no matter if this is added by the application or my query on the first run).</p>\n\n<p>I will delete the records from the target when they are no more exists in my sourcetable and State=StateSource.</p>\n\n<p>I already have the following queries. I have decided to make 3 statements.</p>\n\n<pre><code>--Delete Statement first\nDelete from t\nfrom TargetTable t LEFT JOIN SourceTable s ON t.Id=s.Id \nand t.Date=s.Date \nand t.departments=s.Department\nand t.PersonId=s.PersonId\nand t.State=t.StateSource\n\n--Just delete if a date is no more exists from the source table and this records is NOT\n--changed by the application (t.State=t.StateSource)\n\n\n--Update statement second\nUpdate t\nset t.State = s.State\nFrom Targettable t INNER JOIN SourceTable s ON t.Id=s.Id \nand t.Date=s.Date \nand t.departments=s.Department\nand t.PersonId=s.PersonId\n\nThe problem here is:\n--when I have State 2 already in the targettable and in my sourcetable i have\n--another state then the state in the targettable changes. This would not be the case.\n\n\n--Insert Statement thirth\n\ninsert into TargetTable (Id, Date, Department, Location, PersonId, Starttime, EndTime,State, StateSource)\nselect Id, Date, Department, Location, PersonId, Starttime, EndTime,State, StateSource\nfrom SourceTable s \nWHERE Date not in (select Date \n                   from TargetTable t \n                   where t.id=s.id \n                   and t.PersonId=s.PersonId\n                   and t.date=s.date\n                   and t.department=s.department)     \n\n--I have no idea about how the insert should be because the application also can\n--insert records. When a record exists then no insert. What to do with the State?\n</code></pre>\n\n<p>Remember that the states that are changed by the application are leading.</p>\n\n<p>Can anyone help me with the desired result? </p>\n"},{"tags":["sql-server","sqlite","phonegap","synchronisation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":12,"score":-1,"question_id":13249450,"title":"microsoft sync framework and phonegap","body":"<p>In need of sync data from my mobile app to my SQL Server,? any piece of code or advise will help Basically , This is what I need:</p>\n\n<p>Download database records from SQL database server (using microsoft sync framework) into the database phone SQLite (Using PhoneGap) .??</p>\n"},{"tags":["sql-server","query-execution-plans"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13248927,"title":"Can I control the way SQL Server handles its execution plan?","body":"<p><strong>Situation:</strong></p>\n\n<p>I often have (no comments on database, it is history :)) columns where values are separated.</p>\n\n<p>So let's say we have a column <code>params</code> which contains for example <code>1,2,3,4,5</code>.</p>\n\n<p>If I need the values table based I split them with a <code>dbo.fn_Split()</code> function (several version can be found on the net - but out of scope here). So I get my virtual table.</p>\n\n<p>Today I ran into a situation where I have a column where I have this content <code>110&amp;mode=tree</code>.</p>\n\n<p>As I needed the <code>ID</code> only I said to myself... like usual, split and get the first value only:</p>\n\n<pre><code>SELECT TOP 1 [value] FROM dbo._fnSplit('110&amp;mode=tree','&amp;')\n</code></pre>\n\n<p>As I needed the value as int I added a CAST() around it.</p>\n\n<pre><code>CAST((SELECT TOP 1 [value] FROM dbo._fnSplit('110&amp;mode=tree','&amp;')) AS int)\n</code></pre>\n\n<p>Now after execution I got:</p>\n\n<blockquote>\n  <p><em>mode=tree cannot be converted to a type int</em></p>\n</blockquote>\n\n<p>Huch? I get only the first value which is an <code>Id</code> (I double checked the results) but it still try to convert the 2nd value as well. So it seems that SQL Server handles it differently in execution.</p>\n\n<p><strong>Question:</strong></p>\n\n<p>So is it generally possible to control how the execution plans handle this behaviour?</p>\n\n<p><strong>Sidenote:</strong></p>\n\n<p>I solved it for now doing this:</p>\n\n<pre><code>[...] WHERE id = CAST((CASE WHEN k.param LIKE '%&amp;%' THEN LEFT(k.swindowparam,PATINDEX('%&amp;%',k.param)-1) ELSE k.swindowparam END) AS int))\n</code></pre>\n\n<p>Check if string contains &amp; and if so so a LEFT with length found out by <code>PATINDEX</code>.</p>\n"},{"tags":["sql-server","delphi","ado","delphi-xe"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":159,"score":2,"question_id":11562865,"title":"Why does TClientDataSet get the wrong type for WideText fields?","body":"<p>I'm working with a service with Delphi XE and I receive a ClientDataset from a client. When I check the type of a field that is ftWideText, the system detects that the field is ftBlob. To understand the reason, I have saved the ClientDataset to a file and I get XML with an error with the definition of this field. I get:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;FIELD attrname=\"TEXTTEST\" fieldtype=\"bin.hex\" SUBTYPE=\"\" SUBTYPE=\"WideText\" /&gt;\n</code></pre>\n\n<p>The attribute SUBTYPE appears twice when the correct is:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;FIELD attrname=\"TEXTTEST\" fieldtype=\"bin.hex\" SUBTYPE=\"WideText\" /&gt;\n</code></pre>\n\n<p>This problem only appears over a server; the others work OK. I don't know where the problem is, if it's Delphi, ADO, SQL Server.</p>\n\n<p>If I change the Web service to another computer using the same database, all works OK. I think that it is an ADO problem with the components installed on the computer.</p>\n\n<p><strong>Update:</strong> I have the same problem with Windows 2003 Server computers. Two computers with MDAC 2.8 SP2 (ODBC components version 3.526) and both fails. I installed Microsoft SQLServer 2008 R2 to one of the computers and the problem is fixed. I need to know what is installed or reinstalled with SqlServer2008 to fix the problem. Apparently is related with ADO but now I have two machines with the same version of ADO and only one fails.</p>\n"},{"tags":["sql-server","sql-server-2005","tsql","truncate","foreign-keys"],"answer_count":13,"favorite_count":14,"up_vote_count":60,"down_vote_count":0,"view_count":77724,"score":60,"question_id":253849,"title":"Cannot truncate table because it is being referenced by a FOREIGN KEY constraint?","body":"<p>Using MSSQL2005, Can I truncate a table with a foreign key constraint if I first truncate the child table(the table with the primary key of the FK relationship)?</p>\n\n<p>I know I can use a DELETE without a where clause and then RESEED the identity OR</p>\n\n<p>Remove the FK, truncate and recreate but I thought as long as you truncate the child table you'll be OK however I'm getting a </p>\n\n<p>\"Cannot truncate table 'TableName' because it is being referenced by a FOREIGN KEY constraint.\"</p>\n\n<p>error.</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13249054,"title":"Database calculations are wrong","body":"<p>Here is what I'm setting:</p>\n\n<pre><code>result = price / (case when tax = 0 then @tax1h / 100 else @tax2 / 100 end + 1)\n</code></pre>\n\n<p>These are the values:</p>\n\n<pre><code>price = 17.5\ntax = 1\ntax2 = 6\n</code></pre>\n\n<p>17.5 / (6 / 100 + 1) = 16.5</p>\n\n<p>And this returns 17.5 Why is this happening and how to solve it?</p>\n"},{"tags":["sql-server","hbase","sqoop"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13248669,"title":"Sqoop free form query split by alias","body":"<p>I want to import data from MsSQL to HBase running a free form query which has an alias on the key I want to split by. For example my query is;</p>\n\n<pre><code>SELECT       convert(varchar,Table1.Field1) + '_' + Table2.field1 AS 'xyz' \nFROM         Table1\nINNER JOIN   Table2 \nON           Table1.field3 = Table2.field4\nWHERE        $CONDITIONS\n</code></pre>\n\n<p>And I want to split work units by this aliased field. So, in my sqoop query I have <code>--split-by 'xyz'</code> option. But, this doesn't work. I get;</p>\n\n<pre><code>Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: \nAmbiguous column name 'xyz'.\n</code></pre>\n\n<p>So, how can I make sqoop work with this aliased select field?</p>\n"},{"tags":["sql-server","tsql","join"],"answer_count":9,"favorite_count":11,"up_vote_count":21,"down_vote_count":0,"view_count":28223,"score":21,"question_id":111341,"title":"Combine multiple results in a subquery into a single comma-separated value","body":"<p>I've got two tables:</p>\n\n<pre><code>TableA\n------\nID, Name\n\nTableB\n------\nID, SomeColumn, TableA_ID (FK for TableA)\n</code></pre>\n\n<p>The relationship is one row of <code>TableA</code> - many of <code>TableB</code>.</p>\n\n<p>Now, I want to see a result like this:</p>\n\n<pre><code>ID     Name      SomeColumn\n\n1.     ABC       X, Y, Z (these are three different rows)\n2.     MNO       R, S\n</code></pre>\n\n<p>This won't work (multiple results in a subquery):</p>\n\n<pre><code>SELECT ID, Name, (SELECT SomeColumn FROM TableB WHERE F_ID=TableA.ID) FROM TableA\n</code></pre>\n\n<p>This is a trivial problem if I do the processing on the client side. But this will mean I will have to run X queries on every page, where X is the number of results of <code>TableA</code>. </p>\n\n<p>Note that I can't simply do a GROUP BY or something similar, as it will return multiple results for rows of <code>TableA</code>. </p>\n\n<p>I'm not sure if a UDF, utilizing COALESCE or something similar might work?</p>\n"},{"tags":["sql-server","g-wan"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":38,"score":0,"question_id":13237756,"title":"How to connect G-WAN to SQL Server?","body":"<p>I have a web server running G-WAN and CentOS. I'm trying to figure out the best way to make a connection to a Microsoft SQL Sever database. The most I need to do at this point is a simple insert from a G-WAN handler, nothing fancy.</p>\n\n<p>Anyone have any experience with this?</p>\n\n<p>My language preference is C#, Though C++ or C is fine too.</p>\n"},{"tags":["asp.net","sql-server","nosql","document-database","sisodb"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":10804547,"title":"does sisoDB use sql server database to store data","body":"<p>I'm looking for a NoSQL database to use with asp.net , and I came to <a href=\"http://www.sisodb.com/\" rel=\"nofollow\">sisoDB</a> . but as I understood it uses Sql server to save data and so it can use sql server features like security and ... . </p>\n\n<p>is it correct ? and what are pros and cons of this approach ? </p>\n"},{"tags":["c#","sql-server","database","backup","restore"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1439,"score":0,"question_id":5984553,"title":"c# express back up/restore database","body":"<p>I am completely lost here and I am running out of time. Let me explain my situation:</p>\n\n<p>I have created a software in C# express 2010 and SQL Server Express 2008 R2.</p>\n\n<p>Now in the settings section of my software, the user is supposed to be able to make manual back ups/restores of the database.</p>\n\n<p>Also he is supposed to be able to schedule back ups of the database, which will run at time that he will set.</p>\n\n<p>I do not have a clue on how to get both of these working and I am hoping that someone here may point me in the correct direction.</p>\n\n<ul>\n<li>I need to be able to create a\nbackup/restore of the database from\nthe click of a button</li>\n<li>I need to be able to schedule backup\nprocesses</li>\n</ul>\n\n<p>Please keep in mind that when the user will install the software on his computer, he will not have sql server installed (I am saying this because I am under the impression that SMO requires sql server to be pre installed on the client machine).</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server","ruby-on-rails-3","freetds"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":2616,"score":4,"question_id":6973371,"title":"FreeTDS problem connecting to SQL Server on Mac (Unexpected EOF from the server)","body":"<p>I have setup FreeTDS to connect to SQL Server database.  When I try to open TSQL in terminal on Mac (lion) I get this error:</p>\n\n<pre><code>locale is \"en_US.UTF-8\"\nlocale charset is \"UTF-8\"\nusing default charset \"UTF-8\"\nError 20017 (severity 9):\n    Unexpected EOF from the server\n    OS error 36, \"Operation now in progress\"\nError 20002 (severity 9):\n    Adaptive Server connection failed\nThere was a problem connecting to the server\n</code></pre>\n\n<p>Does anybody have a clue what could be causing this?</p>\n"},{"tags":["c#","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13178330,"title":"Populate DataGridView from another thread row by row using sqldatareader","body":"<p>I'm trying to execute some SQL queries that takes long time and returns a lot of rows, and that's why i use SqlDataReader for returning the rows.</p>\n\n<p>I execute the query in a separate thread, so the UI would be usable while the rows are returned.</p>\n\n<p>I also have a datatable, which i'm filling with the SqlDataReader, and the DataTable is bound to a BindingSource, and the BindingSource is bound to the DataGridView.</p>\n\n<p>The problem is that the DataGridView seems to be unable to bind the columns of the DataTable to the Columns in the DataGridView, and all cells in the grid shows blank. Even with AutoGenerateColumns=true, the data is not shown!</p>\n\n<p>The below is an example code quite similar to my problem:</p>\n\n<pre><code>public partial class Form2 : Form\n{\n    BindingSource binding;\n    DataTable dt = new DataTable();\n    DataGridView dgv;\n\n    public Form2()\n    {\n        InitializeComponent();\n\n        binding = new BindingSource();\n        binding.DataSource = dt;\n\n        dgv = new DataGridView();\n        dgv.Columns.Add(\"Column1\", \"Column1\");\n        dgv.Columns[0].DataPropertyName = \"Column1\";\n        dgv.AutoGenerateColumns = false;\n        dgv.DataSource = binding;\n        dgv.Click += new EventHandler(dgv_Click);\n        this.Controls.Add(dgv);\n\n        dostuff();  // ON FIRST TRY 5 ROWS SHOWN\n    }\n\n    void dgv_Click(object sender, EventArgs e)\n    {\n        dostuff();  // ON SECOND RUN EVERYTHING IS CLEARED!\n    }\n\n    void dostuff()\n    {            \n        dgv.DataSource = null;\n        dt.Rows.Clear();\n        dt.Columns.Clear();\n        dgv.DataSource = binding;\n\n        BackgroundWorker bgw = new BackgroundWorker();\n        bgw.DoWork += new DoWorkEventHandler(bgw_DoWork);\n        bgw.RunWorkerAsync();\n\n    }\n\n    void bgw_DoWork(object sender, DoWorkEventArgs e)\n    {\n        dt.Rows.Clear();\n        dt.Columns.Clear();\n\n        dt.Columns.Add(\"Column1\");\n\n        for (int i = 0; i &lt; 5; i++)\n        {\n            DataRow r = dt.NewRow();\n            r[0] = i;\n            dt.Rows.Add(r);\n        }\n    }\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13246561,"title":"select data vice versa","body":"<p>I have two table in my database.</p>\n\n<pre><code>1) User Table\n\nid  username    password    logo    email\n1   admin        admin      NULL    1   \n2   support     support     NULL    NULL    \n3   test        test        NULL    NULL    \n\n\n2) Link Account Table\n\nID  AccountID   LinkAccountID\n1       1           2\n</code></pre>\n\n<p>Now if i select username with accountid 1 then it will return me Admin and Support\n    same way if i select username with accountid 2 then also it will return admin and support\n    and if i select username with accountid 3 then it will return only test</p>\n\n<p>something like vice versa if in link account table account id is 1 or linkaccountid is 1 that will return both id</p>\n\n<p>Thanks in advance</p>\n\n<p>Regards</p>\n\n<p>Amit Vyas</p>\n"},{"tags":["sql-server","copy"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13247575,"title":"copy data from one DB to another DB with approximate same structure","body":"<p>I use EntityFramework to generate my database.\nNow I had an application in production from some time,and I need to change the database by adding some more columns to the tables and to change a 1-* relationship to 0..1-*.</p>\n\n<p>How can  do this easily? If I recreate the database from the edmx file, all data will be lost.\nwhat is the best way to address this issue?</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":13245663,"title":"SQL Server format decimal places with commas","body":"<p>How can I convert the decimal values to have some commas?</p>\n\n<p><a href=\"http://stackoverflow.com/questions/4269529/sql-server-2005-currency-format-with-commas-and-period\">this</a> Helps me. But my problem the decimal places are set to 2 only..I want the decimal to be 2, 3, or 4..example</p>\n\n<pre><code>1,234.123   or    1,234.12345\n</code></pre>\n\n<p>I tried</p>\n\n<pre><code>convert(varchar, convert(decimal(18, 4), 1234.1234567), 1) \n</code></pre>\n\n<p>Output : 1234.1234</p>\n\n<p>There is no comma. But if I use money the decimal are 2 only</p>\n\n<blockquote>\n  <p>convert(varchar, convert(money, 1234.1234567), 1) </p>\n  \n  <p>Output : 1,234.12</p>\n</blockquote>\n"},{"tags":["c#","sql","sql-server","sqldatareader"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13247241,"title":"DataReader problems getting data from 2 classes","body":"<p>I am very inexperienced with SQL, and have only had one lesson. I am trying to figure out how to get information from 2 classes using a DataReader. </p>\n\n<p>My Customer class:</p>\n\n<pre><code>public class Customer\n{\n    private CreditCard _creditCard;\n    private List&lt;Subscription&gt; _subscriptions;\n    private int _customerId;\n    private string _name;\n    private string _address;\n    private int _zipCode;\n    private string _city;\n    private string _email;\n    private string _password;\n\n\n    public Customer(int id, string name, string email, string password)\n    {\n        this._customerId = id;\n        this._name = name;\n        this._email = email;\n        this._password = password;\n        this._subscriptions = new List&lt;Subscription&gt;();\n    }\n\n    public Customer(int id, string name)\n    {\n        this._customerId = id;\n        this._name = name;\n        _subscriptions = new List&lt;Subscription&gt;();\n    }\n\n    public override string ToString()\n    {\n        return _customerId + \" \" + _name;\n    }\n\n    public int CustomerId\n    {\n        get { return _customerId; }\n        set { _customerId = value; }\n    }\n\n    public string Name\n    {\n        get { return _name; }\n        set { _name = value; }\n    }\n\n    public string Address\n    {\n        get { return _address; }\n        set { _address = value; }\n    }\n\n    public int ZipCode\n    {\n        get { return _zipCode; }\n        set { _zipCode = value; }\n    }\n\n    public string City\n    {\n        get { return _city; }\n        set { _city = value; }\n    }\n\n    public string Email\n    {\n        get { return _email; }\n        set { _email = value; }\n    }\n\n    public string Password\n    {\n        get { return _password; }\n        set { _password = value; }\n    }\n\n\n\n    public List&lt;Subscription&gt; Subscriptions\n    {\n        get { return _subscriptions; }\n    }\n\n    public void AddSubscription(Subscription s)\n    {\n        _subscriptions.Add(s);\n    }\n\n    public Subscription FindSubscription(int sId)\n    {\n        bool found = false;\n        int i = 0;\n        while (!found &amp;&amp; i &lt; _subscriptions.Count)\n        {\n            if (_subscriptions[i].SubscriptionId == sId)\n                found = true;\n            else\n                i++;\n        }\n        if (found)\n            return _subscriptions[i];\n        else\n            return new Subscription();\n    }\n\n}\n</code></pre>\n\n<p>My Subscription Class:</p>\n\n<pre><code>public class Subscription\n{\n    private SubscriptionType _subscriptionType;\n    private CarModel _carModel;\n    private List&lt;Booking&gt; _bookings;\n    private int _subscriptionId;\n\n    public Subscription(int subscriptionId, SubscriptionType subscriptionType, CarModel carModel)\n    {\n        this._subscriptionId = subscriptionId;\n        this._subscriptionType = subscriptionType;\n        this._carModel = carModel;\n        _bookings = new List&lt;Booking&gt;();\n    }\n\n    public Subscription()\n    { }\n\n    public int SubscriptionId\n    {\n        get { return _subscriptionId; }\n        set { _subscriptionId = value; }\n    }\n\n    public SubscriptionType SubscriptionType\n    {\n        get { return _subscriptionType; }\n    }\n\n    public CarModel CarModel\n    {\n        get { return _carModel; }\n    }\n\n    public override string ToString()\n    {\n        return this.SubscriptionId + \"\\t \" + this.SubscriptionType + \"\\t \" + this.CarModel;\n    }\n}\n</code></pre>\n\n<p>My Database class:</p>\n\n<pre><code>public class DBCustomer\n{\n    private static SqlCommand dbCmd = null;\n\n    public static List&lt;Customer&gt; GetCustomers()\n    {\n        List&lt;Customer&gt; returnList = new List&lt;Customer&gt;();\n        string sql = \"select * from Customer\";\n        dbCmd = AccessDBSQLClient.GetDbCommand(sql);\n\n        IDataReader dbReader;\n        dbReader = dbCmd.ExecuteReader();\n\n        Customer c;\n\n        while (dbReader.Read())\n        {\n            c = new Customer(Convert.ToInt32(dbReader[\"cId\"].ToString()), dbReader[\"cName\"].ToString());\n            returnList.Add(c);\n        }\n        AccessDBSQLClient.Close();\n        return returnList;\n\n    }\n\n    public static List&lt;Customer&gt; GetCustomersByEmail(string email)\n    {\n        List&lt;Customer&gt; returnList = new List&lt;Customer&gt;();\n        string sql = \"select * from Customer where cEmail = '\" + email+\"'\";\n        dbCmd = AccessDBSQLClient.GetDbCommand(sql);\n\n        IDataReader dbReader;\n        dbReader = dbCmd.ExecuteReader();\n\n        Customer c;\n\n        while (dbReader.Read())\n        {\n            c = new Customer(Convert.ToInt32(dbReader[\"cId\"].ToString()), dbReader[\"cName\"].ToString());\n            returnList.Add(c);\n        }\n        AccessDBSQLClient.Close();\n        return returnList;\n\n    }\n\n    public static List&lt;Subscription&gt; GetCustomerSubscriptions(int cId)\n    {\n        List&lt;Subscription&gt; returnList = new List&lt;Subscription&gt;();\n        string sql = \"select S.sId, ST.stName,CM.cmDescription \"\n                   + \"from Customer C, Subscription S, SubscriptionType ST, CarModel CM \"\n                   + \"where C.cId = S.cId \"\n                   + \"and S.stId = ST.stId \"\n                   + \"and S.cmId = CM.cmId \"\n                   + \"and C.cId = \" + cId;\n        dbCmd = AccessDBSQLClient.GetDbCommand(sql);\n\n        IDataReader dbReader;\n        dbReader = dbCmd.ExecuteReader();\n\n        Subscription s;\n\n        while (dbReader.Read())\n        {\n            //s = new Subscription();\n            s = new Subscription((int)(dbReader[\"sId\"]).ToString(),\n                    dbReader[\"stName\"],\n                    dbReader[\"cmDescription\"]);\n            returnList.Add(s);\n        }\n        AccessDBSQLClient.Close();\n        return returnList;\n\n    }\n</code></pre>\n\n<p>Obviously the GetCustomers and GetCustomersByEmail methods are working, but I have no idea how to make the GetCustomerSubscriptions method, as it has to return data fra 2 classes, and I cant just build a Customer to add to the resultset. </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13245044,"title":"corelated query","body":"<p>I have a table where I have some records as follows <br/></p>\n\n<pre><code>Model            Make            Color\n==================================================\nMaruti 800       2008            Black\nMaruti 800       2009            White\nMaruti Esteem    2000            Yelow\nMaruti Esteem    2010            Red\n</code></pre>\n\n<p>Now I want the Model, Make and Color which has maximum make in the list.<br/>\nI have tried writing query like this<br/></p>\n\n<pre><code>SELECT \n     Model,\n     MAX(Model),\n     Color\nfrom \n     tableName\nGROUP BY \n     Model,\n     Color\n</code></pre>\n\n<p>But the result are not coming which I would like<br/>\nIt should be like</p>\n\n<pre><code>Model            Make            Color\n===================================================\nMaruti 800       2009            White    \nMaruti Esteem    2010            Red\n</code></pre>\n\n<p>But the result is the whole table.</p>\n\n<p>I need only those record which has max Make Model Wise.<br/>\nI have also tried inner Query (co-related query) But in that also it is asking for group by.</p>\n"},{"tags":["c#","sql-server","asp.net-mvc-3","visual-web-developer","dataprovider"],"answer_count":7,"favorite_count":4,"up_vote_count":26,"down_vote_count":0,"view_count":24421,"score":26,"question_id":6508516,"title":"ASP.NET MVC 3 - Unable to find the requested .Net Framework Data Provider","body":"<p><em><strong>Background-info:</em></strong>  </p>\n\n<p>I'm using Microsoft Visual Web Developer 2010 Express.<br>\nInfo about my (lack of) experience: the problem occured within the first tutorial that I'm trying to work through.   </p>\n\n<p>Some additional-info:</p>\n\n<ul>\n<li>I'm comfortable with C#, Postgres, Rails (so MVC &amp; Web-apps are not new to me)</li>\n<li>I have <strong>no</strong> experience with ASP.NET or SQL Server  </li>\n</ul>\n\n<p><em><strong>Problem Description:</em></strong></p>\n\n<p>I'm trying to following exactly the steps from the <a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-mvc3-part1-cs\" rel=\"nofollow\">\"Intro to ASP.NET MVC 3\"</a>-tutorial and I'm running into a problem at <a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-mvc3-part5-cs\" rel=\"nofollow\">the first step from part 5 - Adding the MoviesController: </a></p>\n\n<p>When I'm trying to add the \"MoviesController\" with the exact settings that are shown in the tutorial and click 'Add' I get the following error:</p>\n\n<blockquote>\n  <p>\"Unable to retrieve metadata for\n  MvcMovie.Models.Movie. <strong>Unable to\n  find the requested .Net Framework Data\n  Provider.</strong> It may not be installed.\"</p>\n</blockquote>\n\n<p>Google gave a ton of results when searching for the phrase \"Unable to find the requested .Net Framework Data Provider\", but nothing has solved the problem so far.  </p>\n\n<p><em><strong>What I've tried:</em></strong></p>\n\n<p>I think SQL-Server was not installed so I installed it from the Visual-Studio Express ISO- got an error then I've run a repair from the ISO and it claimed that all 15 points including SQL Server Express repair &amp;.NET 4 Framework went through successfully.</p>\n\n<p>I've run the The_.NET_Framework_Setup_Verification_Tool which succeeded for everything.\n<a href=\"http://blogs.msdn.com/b/astebner/archive/2008/10/13/8999004.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/astebner/archive/2008/10/13/8999004.aspx</a></p>\n\n<p>After the mentioned (re-)installing &amp; repairing I recreated the Project and followed every step as described in the tutorial and got the same error. </p>\n\n<p>I found that I should look for DbProviderFactories in machine.config,</p>\n\n<p>The root-Web.config of the Project has the following entries</p>\n\n<pre><code>  &lt;connectionStrings&gt;\n    &lt;add name=\"MovieDBContext\"\n     connectionString=\"Data Source=|DataDirectory|Movies.sdf\"\n     providerName=\"System.Data.SqlServerCe.4.0\"/&gt;\n</code></pre>\n\n<p>My machine config-file has only one DbProviderFactories entry:</p>\n\n<pre><code>&lt;DbProviderFactories&gt;\n&lt;add name=\"Microsoft SQL Server Compact Data Provider\" invariant=\"System.Data.SqlServerCe.3.5\" description=\".NET Framework Data Provider for Microsoft SQL Server Compact\" type=\"System.Data.SqlServerCe.SqlCeProviderFactory, System.Data.SqlServerCe, Version=3.5.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91\"/&gt;&lt;/DbProviderFactories&gt;\n</code></pre>\n\n<p>then I found the following quote</p>\n\n<blockquote>\n  <p>\"we have changed the way\n  DbProviderFactories.GetFactoryClasses()\n  determines the framework providers in\n  VS2010. They are no longer listed in\n  the machine.config file. \"</p>\n</blockquote>\n\n<p>from <a href=\"http://social.msdn.microsoft.com/Forums/en-ZA/adodotnetdataproviders/thread/d79129c4-ae05-4c45-8997-bd90f5765a3a\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-ZA/adodotnetdataproviders/thread/d79129c4-ae05-4c45-8997-bd90f5765a3a</a></p>\n\n<p><em><strong>Question:</em></strong>  </p>\n\n<p><strong>So perhaps this is the wrong direction and since I have no clue what to try next, what steps should I take to investigate &amp; solve this problem?</strong><br>\nBtw. I have postgres installed, so if using postgres instead of SQL-server would be an easy solution let me know. For my own projects I would want to use a different DB anyway (probably postgres), but for now I would just want to be able to get successfully through the first and seemingly simple tutorial I've tried.</p>\n"},{"tags":["asp.net","sql-server","casting"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":29,"score":-3,"question_id":13246524,"title":"SQL Server cast varbinary to char display problems","body":"<p>I am using ASP.net to render data from a SQL server database in web page. The problem is when I cast data from <code>varbinary(50)</code> to <code>varchar(50)</code> using the below query </p>\n\n<pre><code>SELECT CAST([Customer] as varchar(50) ) as Customer From Inspection\n</code></pre>\n\n<p>i get some strange symbols   concatenated to my text </p>\n"},{"tags":["asp.net","sql-server","reporting"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13246395,"title":"How to deploy web app with reporting service asp.net with sql server 2008","body":"<p>I am new to SQL Server reporting services. I want to develop a web application which will be reporting application, primarily used to display financial reports. I want to use microsoft reporting services for that, because the same reports need to be shared by more than one application. I have the following doubts :</p>\n\n<ol>\n<li>How to deploy the application with the rdl files, can you suggest any hosting providers which provide database server with reporting service ?</li>\n<li>Will there be any extra cost for using reporting services ? and if so can anyone give me some idea about the cost of deploying the application ?</li>\n<li>which option of reporting has more advantages (rdl or rdlc) ?</li>\n</ol>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":291,"score":0,"question_id":9829134,"title":"Store special character in database table sql server","body":"<p>I want to store values which contains special character like ', \" etc in database table filed which have datatype varchar. Like I want to store 'Sale'sStore' value in table.</p>\n\n<p>How can I store it. Currently I was not able to store it. </p>\n"},{"tags":["sql","sql-server","performance","nested-sets","hierarchyid"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":115,"score":4,"question_id":12568201,"title":"SQL Server Nested set vs Hierarchyid performance","body":"<p>I have a hierarchical data. The most common queries will be \"get parent branch for node\" and \"get subtree of node\". Updates and inserts are not likely to occur often. I am choosing between nested sets and hierarchyid. As far as I am concerned, search on nested set should be pretty fast on indexed columns, however, I have no clue about internal implementation of hierarchyid. What should I use in order to achieve highest performance possible?</p>\n"},{"tags":["c#","jquery","asp.net","sql-server","linq"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":7,"view_count":39,"score":-7,"question_id":13246476,"title":"How to generate Dynamic Checkboxes & data tables in Jquery mobile using LINQ?","body":"<p>my task is </p>\n\n<p>1) when our page loads, automatically should generate a check box list using data in SQL server tabled data.<br>\n 2) user will select some options from those checkbox list and clicks on submit button.</p>\n\n<p>3) then we have to display a table dynamically which gives details of those selected    names/options.</p>\n\n<p>for example we have student table.. on page load we will display the checkboxes of student names from table column. when we select some of those students names and click on ''get marks'' button second page should display a \"DATA TABLE\"  with name &amp; marks columns..</p>\n\n<p>this is all concept should work using</p>\n\n<p>1) c#</p>\n\n<p>2) LINQ</p>\n\n<p>3) Jquery Mobile</p>\n\n<p>4) Data Tables</p>\n\n<p>5) SQL Server (inbuilded in VS)</p>\n\n<p>6) Visual Studio 2012</p>\n\n<p>even i dnt knw what is .net.. and what are the operations to be done.. iam started learning just now.. but iam very confused..\nbut i want to just create a jquery mobile application..\nplease help me.. (if possible please provide me code because even i am not able to follow examples now.)</p>\n\n<p>ThnQ for helping me.</p>\n"},{"tags":["sql","sql-server","query","sql-server-2000"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":72,"score":4,"question_id":13244832,"title":"SQL Server 2000 Query of total value and value from max date","body":"<p>I have this RoomTable with value</p>\n\n<pre><code>SID   Room   Date        APhase   BPhase   ACount  BCount\n1     One    10/28/2012  4        5         3       6\n2     One    10/29/2012  2        3        -1      -1\n3     One    10/30/2012  4        5         7      -1\n4     Two    10/28/2012  8        3         2       3\n5     Two    10/30/2012  3        5         4       6\n6     Three  10/29/2012  5        8         2      -1\n7     Three  10/30/2012  5        6        -1       4\n8     Four   10/29/2012  6        2        -1      -1\n9     Four   10/30/2012  5        8        -1      -1\n</code></pre>\n\n<p>What I want is to return the following:</p>\n\n<ol>\n<li>Total sum of APhase and BPhase of each Room.</li>\n<li>Value of ACount and BCount from max date of each Room</li>\n<li>If ACount value is -1 then use the previous date. Same as BCount.</li>\n<li>If ACount value is -1 and the previous date is -1 and so on. Then use 0. Same as BCount.</li>\n</ol>\n\n<p>I can get the query of number 1 with this query</p>\n\n<pre><code>SELECT Room, sum(APhase) as TotalAPhase, sum(BPhase) as TotalBPhase \nFROM RoomTable \nWHERE Date between '10/28/2012' and '10/30/2012'\ngroup by Room\norder by Room\n</code></pre>\n\n<p>But I'm confused on how to include the number 2-4 query.</p>\n\n<p>This is the output I want</p>\n\n<pre><code>Room  TotalAPhase  TotalBPhase  ACount   BCount\nOne   10           13           7        6\nTwo   11           8            4        6\nThree 10           13           2        4\nFour  11           10           0        0\n</code></pre>\n\n<p>Any ideas will be much appreciated. Thanks. </p>\n"},{"tags":["sql-server","sql-server-2008","tsql","transactions","rollback"],"answer_count":0,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":13246038,"title":"which is better approach for roll back transaction in sql server?","body":"<p>I came to know we can go for roll back transaction using \"<strong>set xact_abort on</strong>\"\ni want to know which is the better way for roll back transaction: use \"set xact_abort on\" or simple the following code</p>\n\n<pre><code>begin try\nbegin tran\n-- statements \ncommit tran\nend try\nbegin catch\nrollback tran\nend catch\n</code></pre>\n\n<p>Please help me to choose which is better approach while inserting number of records one time.</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13246115,"title":"Database management tool","body":"<p>I hope this is a suitable place to ask this question.</p>\n\n<p>I am working on a project that has a SQL Server back end, 30 or so tables, with many inter-dependencies.</p>\n\n<p>I want to focus my time on working on the user interface but seem to be spending a ridiculous amount of time writing management pages for my supporting tables and data entry and management.</p>\n\n<p>The database has (or will shortly) have all table relationships correctly defined, so I what I am searching for is a tool I can just point at my database and get a full data entry management system, for example I want to be able to</p>\n\n<ul>\n<li>click on Table A and see all the rows</li>\n<li>When editing a row, if a column has a lookup table - give me a dropdown list so I can chose from that list</li>\n<li>if the entry is not on that list let me \"ajax-ly\" create a new entry in that lookup table</li>\n<li>give me searching and sorting tools.</li>\n</ul>\n\n<p>am I looking for Nirvana here?  I have looked at using .NET MVC and a bunch of default controllers.  This works somewhat but there would be a lot of work to get me to where I want to be.</p>\n\n<p>Thanks in advance for your help,\nPatrick.</p>\n"},{"tags":["sql","sql-server","logic"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":33,"score":-1,"question_id":13245652,"title":"Can any body explain the logic mentioned in the description?","body":"<p>The best way to get the month name when you have the month number is </p>\n\n<p>Select DateName( month , DateAdd( month , @MonthNumber , 0 ) - 1 )</p>\n"},{"tags":["sql-server","oracle"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13245322,"title":"[Generic Connectivity Using ODBC][Microsoft][ODBC SQL Server Driver]COUNT field incorrect or syntax error (SQL State: 07001; SQL Code: 0)","body":"<blockquote>\n  <p><em>ERROR at line 1:<br>\n  ORA-28500: connection from ORACLE to a non-Oracle\n  system returned this message:<br>\n  [Generic Connectivity Using\n  ODBC][Microsoft][ODBC SQL Server Driver]<br>\n  COUNT field incorrect or syntax error<br>\n  (SQL State: 07001; SQL Code: 0) ORA-06512: at line 9</em></p>\n</blockquote>\n\n<p>Anyone know this error.. pls help us. </p>\n\n<p>thanks in advance.  </p>\n"},{"tags":["sql","sql-server","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":59,"score":-1,"question_id":13243047,"title":"Converting row to columns in SQL Server","body":"<p>I have a query that returns the following result set:</p>\n\n<pre><code>patName  SName   DISC    SCHEDULE   \nJM       AA      HA      2 per  Week\nJM       MAC     MSW     1 per  Month\nJM       ANG     RN      1 per  Week\nJM       JON     RN      1 per  Week\nJM       LRH     RN      1 per  Week\n</code></pre>\n\n<p>Is there any way I could display the result as follows using <code>PIVOT</code></p>\n\n<pre><code>PATNAME    HA           MSW             RN \n  JM    AA 2/Week   MAC 1/Month    ANG 1/week \n                                   JON 1/Week \n                                   LRH 1/Week\n</code></pre>\n\n<p>Edit, my query is as follows:</p>\n\n<pre><code>SELECT PatientName, [RN], [HA], [LVN], [MSW], [SC] \n  FROM \n  ( \n   SELECT DISTINCT (tblPatient.FirstName +' '+ tblPatient.LastName) As PatientName,\n   (tblStaff.StaffFirstName+' '+tblStaff.StaffLastName) As StaffName, \n    (tblStaffDiscipline.Discipline)As Discipline, \n    CAST(tblFrequencyOfVisit.NoOfVisit As Varchar)+' per '\n     + REPLACE (tblFrequencyOfVisit.Period,'/','') AS Visits new_value,\n   row_number() over(partition by PatientName, Discipline order by Discipline) rowNum\n   FROM tblPatient INNER JOIN\n   tblFrequencyOfVisit \n   ON tblPatient.PatientId = tblFrequencyOfVisit.PatientId \n   INNER JOIN tblStaffAssignment \n   ON tblPatient.PatientId = tblStaffAssignment.PatientId \n   AND tblFrequencyOfVisit.PatientId = tblStaffAssignment.PatientId \n   INNER JOIN tblStaffDiscipline \n   ON tblFrequencyOfVisit.DisciplineId = tblStaffDiscipline.DisciplineId \n   INNER JOIN tblStaff \n   ON tblStaffAssignment.StaffId = tblStaff.StaffId \n   AND tblStaffDiscipline.Discipline = tblStaff.StaffDisciplane \n )src  \n pivot\n (\n  max(new_value)\n  for Discipline in ([RN], [HA], [LVN], [MSW], [SC])\n) piv\n\n  WHERE\n  tblpatient.PatientId = '138' \n  AND NOT tblPatient.SOC IS NULL \n  AND tblPatient.EOC IS NULL \n  AND tblPatient.Hospiceid = '1' \n  AND tblFrequencyofVisit.FromDate = \n   (Select MAX(FROMDATE) \n   From tblfrequencyofVisit \n   Where tblFrequencyOfVisit.PatientId = tblPatient.PatientId \n   AND tblFrequencyofVisit.Disciplineid = tblStaffDiscipline.Disciplineid )\n</code></pre>\n"},{"tags":["sql-server","stored-procedures","tracking"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":119,"score":1,"question_id":9811881,"title":"SQL Server last called stored procedures with parameters","body":"<p>I am using ASP.NET environment.</p>\n\n<p>Is it possible to track last N number of stored procedures called with parameters info?</p>\n\n<p>I see in this article \"Recently executed stored procedures\";</p>\n\n<p><a href=\"http://sqlfool.com/2009/08/find-recently-executed-stored-procedures/\" rel=\"nofollow\">http://sqlfool.com/2009/08/find-recently-executed-stored-procedures/</a></p>\n\n<p>But I need input parameters also.</p>\n\n<p>If not what can be the best way to track it?</p>\n\n<p>For example, adding an insert statement to a information table for every single procedure beginning?</p>\n\n<p>Or is there any better solution for this?</p>\n"},{"tags":["c#","sql-server","parallel-extensions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":13123359,"title":"Invalid attempt to call Read when reader is closed","body":"<p>I have several portions of code in different classes that use this or very similar code to pull back some data from an SQL Server database. Most of them work, but I'm running into a problem on a few and really don't understand why. The code above will execute for 60-64 times, retrieving rows but then it blows up with a invalid read error. ive traced down the records for anything hinkey, but it appears to just hit anywhere between those records and stops. There are no calls out from this class to any other class functions, essentially, this is the onyl thing running.</p>\n\n<p>My connection string has a time out of 600 seconds and I have mars set as well. another note; this is being called from a Parallel.ForEach with the parallelism set to 2.</p>\n\n<p>As i said, I use this structure of code in multiple places through out the program, most of it working great, what worries me is not just the error, but the inconsistancy of its occurance.</p>\n\n<p>when I get rid of the Parallel.ForEach and just run it as foreach, it works. I need those threads though, or this takes far too long. And I'm also curious where the reader is closing.</p>\n\n<p><strong>Exception</strong>: System.InvalidOperationException--Invalid attempt to call Read when reader is closed. </p>\n\n<p><strong>Called Code:</strong></p>\n\n<pre><code> public string GetUnderwritingType(string id)\n    {\n        UnderwritingType uwt = new UnderwritingType();\n        GetRequiredPercent(id, ref uwt);\n        GetParticipation(id, ref uwt);\n        return CalculateUnderwritingType(ref uwt);\n    }\n    private void GetRequiredPercent(string id, ref UnderwritingType uwt)\n    {\n        DataCommon common = new DataCommon(Settings.Default.ReqPercentSP, id);\n        try\n        {\n      /******* Error on this reader statement ********/      \nusing (SqlDataReader reader = common.Command.ExecuteReader(CommandBehavior.CloseConnection))               {\n                /* no data */\n                if (reader.HasRows == false) return;\n                while (reader.Read())\n                {\n                    uwt.RequiredPercent.Add(Double.Parse(reader[REQ_PERCENT_FIELD].ToString()));\n                    uwt.MinimumCount.Add(Int32.Parse(reader[MIN_COUNT_FIELD].ToString()));\n                    uwt.UWType.Add(Int32.Parse(reader[UW_LEVEL_FIELD].ToString()));\n                }\n            }\n        }\n        catch (InvalidOperationException)\n        {\n            if (common.Connection.State == ConnectionState.Open) common.Connection.Close();\n            throw;\n        }\n        catch (SqlException)\n        {\n            if (common.Connection.State == ConnectionState.Open) common.Connection.Close();\n            throw;\n        }\n    }  \n</code></pre>\n\n<p><strong>Code that sets up connection:</strong></p>\n\n<pre><code>   public class DataCommon\n    {\n        private readonly SqlCommand _command;\n        private SqlConnection _connection;\n\n        public DataCommon(string storedProcedure, string id)\n        {\n            SetConnection();\n            _command = new SqlCommand(storedProcedure, Connection);\n            if (_command != null) _command.CommandType = CommandType.StoredProcedure;\n            _command.Parameters.Add(\"@Id\", SqlDbType.NVarChar).Value = id;\n        }\n        /// &lt;summary&gt;\n        ///   Gets the database connection.\n        /// &lt;/summary&gt;\n        public SqlConnection Connection\n        {\n            get { return _connection; }\n        }\n        /// &lt;summary&gt;\n        ///   Gets the database command object.\n        /// &lt;/summary&gt;\n        public SqlCommand Command\n        {\n            get { return _command; }\n        }\n        /// &lt;summary&gt;\n        ///   Sets the database connection.\n        /// &lt;/summary&gt;\n        private void SetConnection()\n        {\n            _connection = new SqlConnection {ConnectionString = Settings.Default.TestConnection};\n            _connection.Open();\n            if (_connection.State != ConnectionState.Open)\n                throw new DataException(Settings.Default.ConnectionErrorMessage);\n        }\n    }\n</code></pre>\n\n<p><strong>Connection string:</strong> Data Source=xxxxx;Initial Catalog=yyyyy;Trusted_Connection=True;MultipleActiveResultSets=True;Connection Timeout=600;</p>\n\n<p><strong>Stack Trace:</strong>\n.Data.SqlClient.SqlDataReader.ReadInternal(Boolean setTimeout)\n   at System.Data.SqlClient.SqlDataReader.Read()\n   at GroupDataAccess.EligibilityClassData.GetEligibilityClass(String id) in C:\\Subversion\\branches\\Fimmas\\FimmasToInfoHub\\GroupHubFeed\\GroupData\\EligibilityClassData.cs:line 95\n   at GroupLogic.GroupExtract.BuildEligibilityClass(String id, Group&amp; group) in C:\\Subversion\\branches\\Fimmas\\FimmasToInfoHub\\GroupHubFeed\\GroupLogic\\GroupExtract.cs:line 188\n   at GroupLogic.GroupExtract.&lt;>c_<em>DisplayClass2.b</em>_1() in C:\\Subversion\\branches\\Fimmas\\FimmasToInfoHub\\GroupHubFeed\\GroupLogic\\GroupExtract.cs:line 113\n   at System.Threading.Tasks.Task.InnerInvoke()\n   at System.Threading.Tasks.Task.Execute()</p>\n\n<p><strong>Initial Call to go through loop</strong> (when converted to normal foreach, everythings fine):</p>\n\n<pre><code>ParallelOptions options = new ParallelOptions();\noptions.MaxDegreeOfParallelism = 2;\nParallel.ForEach(ids, options, id =&gt; BuildGroup(id));\n</code></pre>\n\n<p><strong>calls</strong> </p>\n\n<pre><code>private void BuildGroup(string id)\n{\n   Group[] group = { new Group() };\n    Task eligibilityBlock = Task.Factory.StartNew(() =&gt;\n                                            BuildEligibilityClass(id, ref @group[0]));\n            Task.WaitAny(eligibilityBlock);\n             GroupList.Add(@group[0]);\n}\n</code></pre>\n\n<p><strong>Which calls</strong></p>\n\n<pre><code>    private static void BuildEligibilityClass(string id, ref Group group)\n    {\n        EligibilityClassData eligClassData = new EligibilityClassData();\n        group.EligibilityClassList = eligClassData.GetEligibilityClass(id);\n\n    }\n</code></pre>\n\n<p>which hits into one of those reads.</p>\n"},{"tags":["sql-server","database","oracle","triggers","sybase-ase"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":274,"score":0,"question_id":9639254,"title":"Is it better to have single trigger for Insert/Update/Delete, or multiple?","body":"<p>I have a requirement to mirror insert/update/delete operations from one table to another.\nFor example insert on tableA has to be copied into tableB, update to tableA applied to tableB, and delete from tableA be applied to tableB.\nIt's as simple as that, except tableB has 1 additional column for a constant value, so very simple triggers are needed.</p>\n\n<p>I'm not sure if it is better to write 3 separate triggers, or have one trigger that does all of the operations.</p>\n\n<p>This is for 3 databases: Sybase ASE, MSSQL and Oracle, and I'd like to keep it the solution similar (so either 3 for all databases or 1 for all of them).</p>\n\n<p>Is it just a matter of preference, to have 3 triggers vs. 1, or are there actual benefits to either solution?</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13237818,"title":"Permission Denied Accessing SQL Server Master Database from Windows Service","body":"<p>I have a Windows Service (running as Local System) and it needs to create/drop a database in the local SQL Server Express 2012. Doing so yields an error message:</p>\n\n<blockquote>\n  <p>\"CREATE DATABASE permission denied in database 'master'.\"</p>\n</blockquote>\n\n<p>I can connect to the instance as a local administrator and create/drop databases. Doesn't Local System have sysadmin permission on the local SQL Server? If not, how do I grant it permission?</p>\n"},{"tags":["sql-server","xsd","xml-schema"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13191263,"title":"create xml schema collection maximum value of fractionDigits restriction","body":"<p>I'm trying to load third party XSD Scheme to my SQL Server 2008 throught \"create xml schema collection\" statement</p>\n\n<p>There is a complex type based on \"xs:decimal\" with restrictions: </p>\n\n<pre><code>        &lt;xs:totalDigits value=\"31\"/&gt;\n        &lt;xs:fractionDigits value=\"14\"/&gt;\n</code></pre>\n\n<p>inside the XSD.</p>\n\n<p>And SQL Server returns error</p>\n\n<pre><code>Msg 6960, Level 16, State 2, Line 2\nComponent 'NAME' is outside of allowed range. Maximum for 'fractionDigits' is 10 and maximum number of digits for non fractional part is 28\n</code></pre>\n\n<p>But I still able to create a variable with type \"numeric(31,14)\"</p>\n\n<p>I didn't find any restrictions neither on w3c documentations nor in MSDN. Can you please guide me to some documentation on this restrictions. May be I can fix it with some Service Pack or Setting.</p>\n\n<p>SQL Server version: Microsoft SQL Server 2008 (SP3) - 10.0.5500.0 (X64)   Sep 21 2011 22:45:45   Copyright (c) 1988-2008 Microsoft Corporation  Enterprise Edition (64-bit) on Windows NT 6.1  (Build 7601: Service Pack 1) </p>\n\n<hr>\n\n<p>I found an answer on the MSDN (<a href=\"http://msdn.microsoft.com/en-us/library/ms190665%28v=sql.100%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms190665(v=sql.100).aspx</a>)</p>\n\n<blockquote>\n  <p>SQL Server does not support variable precision decimals. The\n  xs:decimal type represents arbitrary precision decimal numbers.\n  Minimally conforming XML processors must support decimal numbers with\n  a minimum of totalDigits=18. SQL Server supports totalDigits=38, but\n  limits the fractional digits to 10. All xs:decimal instanced values\n  are represented internally by the server by using the SQL type numeric\n  (38, 10).</p>\n</blockquote>\n\n<p>They map xs:decimal not to <em>numeric</em> type, but <em>decimal</em></p>\n"},{"tags":["sql-server","sql-server-2005","common-table-expression","parents"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":4010,"score":4,"question_id":665617,"title":"How to create an SQL Server 2005 CTE to return parent-child records, for children with multiple parents","body":"<p>I'm experimenting with CTE's in SQL Server but have reached a dead end with getting the following scenario to work. I have a hierarchy table similar to this:</p>\n\n<pre><code>Node(ID:439)\n  Node(ID:123)\n    Node(ID:900)        \n  Node(ID:56)\n    Node(ID:900)\n</code></pre>\n\n<p>Expected results:</p>\n\n<pre><code>NodeID ParentNodeID\n439    0\n123    439\n900    123\n56     439\n900    56\n</code></pre>\n\n<p>So basically we have a parent-child hierarchy table, with one subtle difference. Each child could potentially have more then one parent. I have researched many blog articles, and StackOverflow posts, about creating CTE's that return parent-child records, but they don't return all of the parents for the children, just the first one that it finds.</p>\n\n<p>Here's an example CTE that I tried:</p>\n\n<pre><code>WITH Heirarchy(NodeID, ParentNodeID)\nAS\n(\n    SELECT \n        T1.NodeID,\n          T1.ParentNodeID\n    FROM\n        ParentChildTable T1\n    WHERE\n        T1.NodeID = 439\n\n    UNION ALL\n    SELECT \n        T1.NodeID,\n        T1.ParentNodeID\n    FROM\n        Heirarchy T1\n        INNER JOIN Heirarchy TH ON TH.NodeID = T1.ParentNodeID\n)\n</code></pre>\n\n<p>(Note: The names of the tables and columns in the above CTE have been changed from the orginal for privacy purposes.)</p>\n\n<p>The above CTE works fine, it finds all the parent-child records starting from ID:439, but it only finds one parent for item ID:900, even though it has two parents.</p>\n\n<p>Could someone let me know if this is possible using CTE's, or is there another SQL way to do this?</p>\n\n<p>Cheers.\nJas.</p>\n"},{"tags":["sql-server","entity-framework-4.1","ef-code-first"],"answer_count":5,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":956,"score":2,"question_id":8452438,"title":"EF ExecuteStoredCommand with ReturnValue parameter","body":"<p>I'm creating a new application which needs to interface with legacy code :(.</p>\n\n<p>The stored procedure I'm attempting to call uses RETURN for its result. My attempts to execute and consume the return value result in the exception:</p>\n\n<blockquote>\n  <p>InvalidOperationException: When executing a command, parameters must be exclusively database parameters or values.</p>\n</blockquote>\n\n<p>Changing the stored proc to return the value another way isn't desired, since it either requires updating the legacy app or maintaining a nearly duplicate stored proc.</p>\n\n<p>The legacy stored proc synopsis:</p>\n\n<pre><code>DECLARE @MyID INT\nINSERT INTO MyTable ...\nSELECT @MyID = IDENTITY()\nRETURN @MyID\n</code></pre>\n\n<p>My Entity Framework / DbContext work, which yields the above InvalidOperationException.</p>\n\n<pre><code> SqlParameter parm = new SqlParameter() {\n    ParameterName = \"@MyID\",\n    Direction = System.Data.ParameterDirection.ReturnValue\n };\n\n DbContext.Database.ExecuteSqlCommand(\"EXEC dbo.MyProc\", parm);\n</code></pre>\n\n<p>Looking for any and all solutions which don't require the stored proc to be modified.</p>\n"},{"tags":["sql","sql-server","database","query","sql-server-2008-r2"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":78,"score":0,"question_id":11666009,"title":"SQL server query to get this output","body":"<p>I have a query which i am unable to get the output.\nBelow is the query to be executed</p>\n\n<p>Q: 2.   Write a query to find the city Name, Id and Count that has got maximum number of vehicles associated.</p>\n\n<p>Now, Given is the one table on which the query should be executed.</p>\n\n<pre><code>Vehicle_Detail_ID   City_ID\n56                    242\n57                    242\n58                    242\n59                    243\n60                    241\n61                    242\n62                    245\n</code></pre>\n\n<p>Another table which has the city name</p>\n\n<pre><code>City_ID City_Name\n242          Bangalore\n243          ChamarajNager\n241          Bellary\n245          Chitradurga\n</code></pre>\n\n<p>EXPECTED OUTPUT: </p>\n\n<pre><code>City_ID No_Vehicles\n242          4\n</code></pre>\n\n<p>Please tell me how to write the query which fetches me the right output.</p>\n\n<p>Given below is the query which gives the city Id and its vehicle count.\nTRIED: </p>\n\n<pre><code>SELECT c.city_id, COUNT(c.City_ID) AS NO_vehicles\n  FROM city c, vehicle_details v \n WHERE c.City_ID = v.City_ID\n GROUP BY c.City_ID\n</code></pre>\n\n<p>ACTUAL OUTPUT </p>\n\n<pre><code>City_ID No_Vehicles\n242             4\n243             1\n241             1\n245             1\n</code></pre>\n\n<p>Please help me to get max of these as shown in EXPECTED OUTPUT.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":3,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":1048,"score":5,"question_id":3650690,"title":"SQL SERVER Foreign Keys and Indexes","body":"<p>Is it a good practice to create an index to every foreing key  in my database?</p>\n"},{"tags":[".net","sql-server","sqlbulkcopy"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":957,"score":1,"question_id":4431273,"title":"SqlBulkCopy with different collations","body":"<p>I need to migrate data from one DB to another. I choosed to use SqlBulkCopy, but have a problem with it, because source database has different collation than destination, so, I've got an exception:</p>\n\n<pre><code>System.InvalidOperationException: The locale id '1049' of the source column 'Id' and the locale id '1033' of the destination column 'Id' do not match.\n   at System.Data.SqlClient.SqlBulkCopy.AnalyzeTargetAndCreateUpdateBulkCommand(BulkCopySimpleResultSet internalResults)\n   at System.Data.SqlClient.SqlBulkCopy.WriteToServerInternal()\n   at System.Data.SqlClient.SqlBulkCopy.WriteRowSourceToServer(Int32 columnCount)\n   at System.Data.SqlClient.SqlBulkCopy.WriteToServer(IDataReader reader)\n   at MigrateToNormalized.DirectMapCommand.Migrate(SqlConnection source, SqlConnection destination, SqlTransaction transaction) in D:\\Projects\\APS\\DTE\\MigrateTo\nNormalized\\MigrateToNormalized\\MigrateToNormalized\\DirectMapCommand.cs:line 53\n   at MigrateToNormalized.Program.Main(String[] args) in D:\\Projects\\APS\\DTE\\MigrateToNormalized\\MigrateToNormalized\\MigrateToNormalized\\Program.cs:line 32\n</code></pre>\n\n<p>Can anyone tell me, how to resolve this issue without direct usage of COLLATE statements in SQL query? Is there some easy way to change collation for all columns in source database?</p>\n"},{"tags":["sql-server","azure","sql-azure"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13241417,"title":"How to query the Sql azure federation tables","body":"<p>I have been through many federation tutorials, but all of them are dealing with how to get data into the federations and somehow missing the part that explains how to query the data after it's there.</p>\n\n<p>I found in the documentation that you cannot join between federation tables.  I wonder, how exactly do I query the tables? Will my current SPs continue to work with the new federation DBs? Is there any advanced tutorial on how to query the data?</p>\n"},{"tags":["sql-server","microsoft","amazon-rds","sql-management-studio"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":30,"score":2,"question_id":13242170,"title":"Where to get Microsoft SQL Management Studio when using Amazon RDS SQL servers?","body":"<p>My company is interested in using Amazon's RDS service for our Microsoft SQL Server Web Edition. However, we are a bit confused on how to actually connect to the database to initialize it.</p>\n\n<p>In the Amazon <a href=\"http://docs.amazonwebservices.com/AmazonRDS/latest/UserGuide/USER_ConnectToMicrosoftSQLServerInstance.html\" rel=\"nofollow\">Getting Started Documentation</a> it simply says \"2. Run Microsoft SQL Server Management Studio\". Where would I obtain this management studio if the reason I am using Amazon RDS is to avoid buying a SQL Server license in the first place? Are there other programs that can do the same?</p>\n\n<p>The connection settings from there seems very straight forward, but we're left looking for the actual software to connect.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13242261,"title":"sql server query on condition","body":"<p>There is a table:</p>\n\n<pre><code>ID   Name   Rank\n1    X       Professor\n2    X       Principal\n3    X       Term Prof\n4    X       assistant\n</code></pre>\n\n<p>What I want is want to write the stored procedure to select the last professor rank or assistant rank depending on the input. Here is the format of the stored proc:</p>\n\n<pre><code>create procedure proc_name(@includeassistant varchar(3))\n\nend\n</code></pre>\n\n<p>if includeassistant is \"yes\" then assistant then the last row must be displayed if include assistant is no then Term prof row must be given.\n</p>\n"},{"tags":["sql","sql-server","xml","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13242295,"title":"Add elements and attributes to XML column based on criteria?","body":"<p>With the following, I'd like to add <code>../attrdomv/udom/'some text'</code> within each <code>attr</code> node, of which there are many. However, based on the value of <code>attrlab</code>, 'some text' will be different for each element. I hope that makes sense. I initially considered reconstructing the entire xml column, but <code>'many nodes and elements'</code> contains attributes that are specific to a row, and not easy to reproduce prorgammatically. <code>../attrdomv/udom/'some text'</code> will be the same across each row. Here is a snippet of an existing column:</p>\n\n<pre><code>&lt;metadata xml:lang=\"en\"&gt;\n&lt;many nodes and elements&gt;\n  &lt;eainfo&gt;\n    &lt;detailed Name=\"fire.DBO.labels\"&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;OBJECTID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;OBJECTID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;OID&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdef Sync=\"TRUE\"&gt;Internal feature number.&lt;/attrdef&gt;\n        &lt;attrdefs Sync=\"TRUE\"&gt;Esri&lt;/attrdefs&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Sequential unique whole numbers that are automatically generated.&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;FeatureID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;FeatureID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;ZOrder&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;ZOrder&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;SymbolID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;SymbolID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n      &lt;/attr&gt;\n    &lt;/detailed&gt;\n  &lt;/eainfo&gt;\n&lt;/metadata&gt;\n</code></pre>\n\n<p>...and here is my desired result:</p>\n\n<pre><code>&lt;metadata xml:lang=\"en\"&gt;\n&lt;many nodes and elements&gt;\n  &lt;eainfo&gt;\n    &lt;detailed Name=\"fire.DBO.labels\"&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;OBJECTID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;OBJECTID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;OID&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdef Sync=\"TRUE\"&gt;Internal feature number.&lt;/attrdef&gt;\n        &lt;attrdefs Sync=\"TRUE\"&gt;Esri&lt;/attrdefs&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Sequential unique whole numbers that are automatically generated.&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;FeatureID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;FeatureID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Sequential unique GUID's that are automatically generated.&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;ZOrder&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;ZOrder&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Order of the Z&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;SymbolID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;SymbolID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Symbol Identifier GUID &lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n    &lt;/detailed&gt;\n  &lt;/eainfo&gt;\n&lt;/metadata&gt;\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13242004,"title":"How do I display different values as different columns in SQL?","body":"<p>I have a table with columns <code>UserID, SiteID, SiteViews</code> and another with <code>UserID, First, Last</code></p>\n\n<p>And I need to display the data as <code>First + Last, Site1Views, Site2Views</code></p>\n\n<p>There are only 2 site IDs and I need to have the sum of the SiteViews per User.</p>\n\n<p>Currently I have:</p>\n\n<pre><code>select s.UserFirstName + ' ' + s.UserLastName as 'Name', \nj1.SiteViews as 'Site1Name',\nj2.SiteViews as 'Site2Name' \nfrom (Users s INNER JOIN Usage j on s.UserID = j.UserID)\n</code></pre>\n\n<p>I don't know how to do this. Any help would be appreciated.</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":6,"score":1,"question_id":13241942,"title":"What is spt_columns_odbc_view and why is it not accessible?","body":"<p>I did <code>sp_helptext 'sys.sp_columns'</code> and saw that the the underlying table is <code>sys.spt_columns_odbc_view</code>, but I could not execute queries as I get <code>Invalid object name 'sys.spt_columns_odbc_view'</code>. </p>\n\n<p>Is this system table not queryable or am I lacking rights? Not much documentation is provided in msdn. </p>\n"},{"tags":["jquery","sql-server","ajax","mobile","asp-classic"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":124,"score":0,"question_id":12458855,"title":"JQuery Mobile and SQL Server for Hybrid Application","body":"<p>I'm interested to know if anyone has done any work in JQuery Mobile with classic ASP. It seems that PHP is a widely used server-side language with JQM but I can't seem to find anything with good ol' CLASP (I know it's old tech, but it's similarities to PHP are quite interesting). I have a long history with classic asp and would like to use that as opposed to learning PHP (if I avoid it).</p>\n\n<p>Here are the details ...</p>\n\n<p>I have an existing SQL database (on my server) with customer information that I want to simply list in JQM. It would be a three page app:\nPage1 - Logon (user authentication)\nPage2 - customer listing based on the customers associated (in the database) with the user's credentials\nPage3 - customer details - details of the selected customer from Page2</p>\n\n<p>When the user submits the logon form, the app goes to the server and gets credentials. Those credentials are then used on Page2 to list the customers that have the user's ID as the account manager. The user then clicks a customer, and the customerID is passed to the customer details page which is used to pull specific customer data from the database.</p>\n\n<p>The main difficulties I am having are -\n. the connection the SQL server database. How does javascript connect to the server-side and retrieve data? AJAX, JSON, web service?\n. how do I pass data from page to page? Credentials from the logon form, customer ID to the customer details page.</p>\n\n<p>My preference would be to use ASP, with AJAX/JSON calls to populate the server-side data but I don't know where to start. Any assistance would be much appreciated. I would be happy to give some advertising space on my blog to anyone who can give a well-detailed explanation.</p>\n\n<p>Thanks\nSteven\nw: <a href=\"http://www.stevenwoolston.com\" rel=\"nofollow\">http://www.stevenwoolston.com</a></p>\n"},{"tags":["sql","sql-server","stored-procedures","return-value"],"answer_count":5,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":7166,"score":7,"question_id":1035789,"title":"Return value from a stored proc on error","body":"<p>I have an sp in SQL Server that when errors returns -4</p>\n\n<p>What does -4 mean? Is there a table somewhere explaining what the possible return values are?</p>\n\n<hr>\n\n<p>There must be some standard</p>\n\n<p>For example</p>\n\n<pre><code>declare @RetVal int  \nEXEC @RetVal = stpTest  \nselect @RetVal\n</code></pre>\n\n<p>where stpTest is \"SELECT 1/0\" returns -6. </p>\n\n<p>-6 must mean something!</p>\n\n<hr>\n\n<p>The sp that returned -4 only has UPDATE and SELECT INTO statements in it.</p>\n\n<p>At no point does it do 'SELECT -4' so how can I \"find out what -4 means in that particular stored procedure\"?</p>\n\n<p>Also, if there is no standard then why does a divide by zero error always return -6?</p>\n\n<hr>\n\n<p>If you have an sp that does not return anything i.e. it doesn't have any select statements in it and you do:    </p>\n\n<pre><code>declare @RetVal int  \nEXEC @RetVal = yourSPName  \n</code></pre>\n\n<p>Then @RetVal will have a value of 0. </p>\n\n<p>If there is an error then @RetVal will be a value other then zero, for example if the only thing your sp does is \"SELECT 1/0\" then @RetVal will be -6.</p>\n\n<p>Try it and see</p>\n\n<p>My question is what do these return values mean? They must have some logical meaning! </p>\n"},{"tags":["sql","sql-server","sql-server-2008","table-valued-parameters"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13240720,"title":"Doing an existance check using a subquery with 'LIKE' on a table valued parameter","body":"<p>I am doing an import from excel into the database. I am passing a table valued parameter with a bunch of values, one of them being a foreign key. The catch is that in the database the key value is an <code>nvarchar</code> that always will have 2 or 3 zeroes in front of it, however the people that send the excel files did not properly format the column and those leading zeroes are cut off.</p>\n\n<p>The first thing I need to do in the procedure is to check that all these values exist in a parent table using <code>LIKE</code> (since the leading zeroes are missing). If any of the values don't exist in the parent table then the transaction does not proceed.</p>\n\n<p>I need some help with the MS SQL syntax for this.</p>\n"},{"tags":["c++","sql-server","database","odbc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13238821,"title":"trying to connect to MSSQL through a C++ ODBC connection but cant find the right demo","body":"<p>I am programming on my macbook pro and need to connect to my company's MSSQL server for programming a commercial product.</p>\n\n<p>How do you actually connect to it?  I was looking on the MSDN website, and i didnt quite get it.</p>\n\n<p>for the purposes of my demo, i was just going to create a new project within XCODE and just create a console application which will output the data.  Once that it set up, ill implement different things with the connection.</p>\n\n<p><strong>Edit:  Added some code:</strong></p>\n\n<pre><code>#include &lt;iostream&gt;\n//#include &lt;windows.h&gt;\n#include &lt;sqlext.h&gt;\n#include &lt;sqltypes.h&gt;\n#include &lt;sql.h&gt;\n\nusing namespace std;\n\nint main(int argc, const char * argv[])\n{\nSQLHENV hEnv;\nSQLHDBC hDbc;\nstring connection = \"AAA\";\nstring db = \"DB\";\nstring user = \"user\";\nstring pass = \"password\";\nstring data = \"DRIVER={SQL Server Native Client 11.0};SERVER=\"+connection+\";DATABASE=\"+db+\";UID=\"+user+\";PWD=\"+pass+\";\";\n//SQLCHAR* pwszConnStr = (SQLCHAR*)(\"Driver={SQL Server Native Client 11.0};Server=\"+connection+\";Database=\"+db+\";Uid=\"+user+\";Pwd=\"+pass+\";\");\nSQLCHAR* pwszConnStr = (SQLCHAR*)data.c_str();\n//cout  &lt;&lt; data &lt;&lt; endl;\ncout  &lt;&lt; pwszConnStr &lt;&lt; endl;\n//error seems to occur in 1 of the 3 SQL statements below.\nSQLAllocHandle(SQL_HANDLE_ENV, SQL_NULL_HANDLE, &amp;hEnv);\nSQLSetEnvAttr(hEnv, SQL_ATTR_ODBC_VERSION, (SQLPOINTER)SQL_OV_ODBC3, 0);\nSQLAllocHandle(SQL_HANDLE_DBC, hEnv, &amp;hDbc);\n\nRETCODE rc = SQLDriverConnect(hDbc, NULL, pwszConnStr, SQL_NTS, NULL, 0, NULL, SQL_DRIVER_PROMPT);\n\nif(rc == SQL_SUCCESS){\n    cout &lt;&lt; \"Connected to the Database\" &lt;&lt; endl;\n}else{\n    cout &lt;&lt; \"No Connection Established\" &lt;&lt; endl;\n}\n\n\nreturn 0;\n}\n</code></pre>\n\n<p>It fails to compile, and i am thinking it is related to me commenting out the windows.h file.  The issue is that windows.h is not found on my macbook pro and figure it is when developing in VStudios.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":52,"score":0,"question_id":13240298,"title":"Remove numbers from string sql server","body":"<p>I have a large database in which I want to do a part string search. The user will enter characters: <code>JoeBloggs.</code></p>\n\n<p>For arguments sake if I had a name <code>Joe 23 Blo Ggs 4</code> in the database. I want to remove everything in the name other than A-Z. </p>\n\n<p>I have the <code>REPLACE(Name, ' ','')</code> function to remove spaces and the <code>UPPER()</code> function to capitalize the name.</p>\n\n<p>Is there a more efficient fast way maybe by terms of regex to replace anything other than A-Z. I cannot change the values in the database.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["ruby-on-rails","sql-server","osx","unixodbc","iodbc"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":233,"score":1,"question_id":9925843,"title":"unixodbc and freetds setup on OSX and Rails 2.3.x","body":"<p>I'm trying to set up unixodbc on OSX (10.7.3), but it looks like iODBC is on the way. </p>\n\n<p>My config/database.yml:</p>\n\n<pre><code>development:\n  adapter: sqlserver\n  encoding: UTF8\n  mode: odbc\n  username: user\n  password: passwd\n  dsn: MY_DSN\n</code></pre>\n\n<p>ruby-obdc is installed and in the Gemfile:</p>\n\n<pre><code>gem 'ruby-odbc', :require =&gt; 'odbc_utf8'\n</code></pre>\n\n<p>/usr/local/etc/freetds.conf:</p>\n\n<pre><code>[MY_SERVER]\nhost = host.bla.com\nport = 1433\ntds version = 8.0\nclient charset = UTF-8\n</code></pre>\n\n<p>/usr/local/etc/odbc.ini</p>\n\n<pre><code>[MY_DSN]\nDriver=/usr/local/lib/libtdsodbc.so\nDescription=Sql Server Local\nServername=MY_SERVER\nPort=1433\nDatabase=my_database\n</code></pre>\n\n<p>When I run <code>script/console</code> and try to access any model:</p>\n\n<blockquote>\n  <blockquote>\n    <p>Product\n       ODBC::Error: IM002 (0) [iODBC][Driver Manager]Data source name not found and no default driver specified. Driver could not be loaded</p>\n  </blockquote>\n</blockquote>\n\n<p>It seems iODBC is being used to connect to the database, when I want to use unixodbc. How can I make my rails app use unixodbc instead of iODBC?</p>\n"},{"tags":["php","sql-server","odbc","connect","freetds"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12252005,"title":"Cannot connect to MSSQL 2008 db from php using odbc and freetds","body":"<p>I have been searching everywhere for solutions, but am getting more and more confused. </p>\n\n<p>I am trying to connect to a SQL Server 2008 db from php using FreeTDS. The server is a MediaTemple DV 4.0 and it is running CentOS 5.7.  I have a version of FreeTDS (v0.91) installed that I think I might have compiled several months back. When I run tsql -C it says my freetds.conf is in /usr/local/etc and a TDS version 5.0.  I need it to be TDS version 7.0, but when I change that conf file, it does not change. And I can't find the conf file it is using. (problem 1)</p>\n\n<p>I can connect to my db using tsql -H -p -U and run a query.  However in my php file, I get IM002 error which I believe is a connection error to the db.  I use odbc_connect for that. (problem 2, the biggest problem) </p>\n\n<p>I don't even know where to start, as I have been installing, uninstalling for about the last 2 months...</p>\n\n<p>I would welcome any suggestion on how to resolve the issue. As a side note, it used to work before I upgraded my DV at MediaTemple. </p>\n\n<p>Thanks!\nShawn</p>\n\n<p>Here is my tsql -C</p>\n\n<p>Compile-time settings (established with the \"configure\" script)\n                            Version: freetds v0.91\n             freetds.conf directory: /usr/local/etc\n     MS db-lib source compatibility: no\n        Sybase binary compatibility: no\n                      Thread safety: yes\n                      iconv library: yes\n                        TDS version: 5.0\n                              iODBC: no\n                           unixodbc: yes\n              SSPI \"trusted\" logins: no\n                           Kerberos: no</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13238927,"title":"why sql server not showing in odbc list?","body":"<p>i have sql server 2008 r2 installed in my server on network and i want to make odbc connection to this server from other device on network, but the problem that the sql server not show in the odbc list  .\nnote : the pc is pinging the server and the port 1433 is opened on the server.</p>\n"},{"tags":["sql-server","view","group-by","multiple-tables"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13239820,"title":"MS Version of This MySQL View with GROUP BY?","body":"<p>I was shown the ease that one can make a view from multiple tables, GROUPing BY an id of one of the tables in xception's awesome answer here: <a href=\"http://stackoverflow.com/questions/12761706/create-view-where-selectid-viewrowid\">CREATE VIEW WHERE SELECTid = VIEWrowID</a></p>\n\n<p>Is there any way to do that in MS?  Everywhere, I've read says \"no\", but no page gives an alternative.</p>\n\n<p>I don't need the counts or anything, just multiple columns from multiple tables GROUPed BY(?) a single column on one table.</p>\n\n<p>Thanks a lot in advance!</p>\n\n<p><strong>EXAMPLE</strong> </p>\n\n<p>Thank-you for responding.</p>\n\n<p>For the view's SELECT:</p>\n\n<pre><code>SELECT dbo.table1.column1 AS table1column1,\n       dbo.table1.column2 AS table1column2,\n       dbo.table2.column1 AS table2column1,\n       dbo.table2.column2 AS table2column2\nFROM table1, table2\nWHERE table2.column1 = table1.column1\nGROUP BY table1.column1\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server","c#-2.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":7,"view_count":88,"score":-7,"question_id":13239201,"title":"trying to save data in sql database","body":"<p>I am trying to save a response to a sql database. The response is in xml and it's of an unpredictable size: it may be 100000 or more characters.</p>\n\n<p>When I am getting response and trying to save to the database, it is not saving the full response.</p>\n\n<p>www.telcodata.us/query/queryareacodexml.html?npa=201</p>\n\n<p>This code is using asp.net and c#:</p>\n\n<pre><code>str = string.Empty;\nstr = \"npa=\" + Convert.ToString(i);\npUrl = string.Format(\"http://www.telcodata.us/query/queryareacodexml.html\");\n\nWebRequest webRequest = WebRequest.Create(pUrl);\n\nwebRequest.ContentType = \"application/x-www-form-urlencoded\";\nwebRequest.Method = \"POST\";\nbyte[] bytes = Encoding.ASCII.GetBytes(str);\nStream os = null;\ntry {\n    webRequest.ContentLength = bytes.Length;   \n    os = webRequest.GetRequestStream();\n    os.Write(bytes, 0, bytes.Length);        \n} catch (WebException ex) {\n    //\n} finally {\n    if (os != null) {\n        os.Close();\n    }\n}\n\ntry {\n    WebResponse webResponse = webRequest.GetResponse();\n    if (webResponse == null)\n    { Response.Write(\"&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;Nothing output&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;\"); }\n\n    StreamReader sr = new StreamReader(webResponse.GetResponseStream());\n\n    SqlConnection conn = new SqlConnection(            System.Configuration.ConfigurationManager.ConnectionStrings[\"DB_CONNSTRING\"].ConnectionString);\n    SqlCommand cmd = new SqlCommand(\"usp_insertPhoneDataFetch\",conn);\n    cmd.CommandType = CommandType.StoredProcedure;                    \n    cmd.Parameters.AddWithValue(\"@areaCode\",i);\n    cmd.Parameters.AddWithValue(\"@dataFetch\",sr.ReadToEnd());\n    conn.Open();\n    cmd.ExecuteNonQuery();\n    conn.Close();                   \n\n} catch (WebException ex) {\n    //\n}\n</code></pre>\n\n<p>--</p>\n\n<pre><code>CREATE TABLE [dbo].[tbl_phonedatafetch](    [tid] [int] IDENTITY(1,1)\nNOT NULL,   [areaCode] [int] NULL,  [data] [text] NULL,\n[dateSubmitted] [datetime] NOT NULL ) ON [PRIMARY] TEXTIMAGE_ON\n[PRIMARY]\n\nGO\n\nALTER TABLE [dbo].[tbl_phonedatafetch] ADD  CONSTRAINT\n[DF_tbl_phonedatafetch_dateSubmitted]  DEFAULT (getdate()) FOR\n[dateSubmitted] GO\n\n\nALTER PROCEDURE [dbo].[usp_insertPhoneDataFetch]     \n@areaCode as int,\n@dataFetch as nvarchar(Max)  \nAS\nBEGIN\ninsert into tbl_phonedatafetch&gt; (areaCode,data) values (@areaCode,@dataFetch)    \nEND\n</code></pre>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":52,"score":3,"question_id":13238866,"title":"Stored procedure containing inner join with count not working","body":"<p>Let's say i've got a databasetable looking a bit like this, containing information about some assignments.</p>\n\n<pre><code>Id   | ProfessionId      | Title       | Deadline     | DateCreated | ClosingDate\n1    |  5                | Something   | 01-12-2012   | 05-11-2012  | 12-11-2012\n2    |  6                | Something   | 01-12-2012   | 05-11-2012  | 12-11-2012\n3    |  7                | Something   | 01-12-2012   | 05-11-2012  | 12-11-2012\n4    |  7                | Something   | 01-12-2012   | 05-11-2012  | 12-11-2012\n</code></pre>\n\n<p>I want to generate an overview foreach profession (assignments belong to a certain profession) and count the number of assignment in each profession. The overview coming from the database should look like this;</p>\n\n<pre><code>Id | Name           | FriendlyUrl     | Ordinal   | NumberOfAssignments\n5  | Profession 1   | profession-1    | 1         | 1\n6  | Profession 2   | profession-2    | 1         | 1\n7  | Profession 3   | profession-3    | 1         | 2\n8  | Profession 4   | profession-4    | 1         | 0\n</code></pre>\n\n<p>I've currently got a stored procedure returning the overview above, except that the amount of assignments isn't correct. Assignments with a closingdate in the past (we then assume the assignment is closed) shouldn't be taken into the the total number of assignment.</p>\n\n<p>The current stored procedure is like this:</p>\n\n<pre><code>BEGIN\n    SELECT  p.Id, \n            p.Naam, \n            p.FriendlyUrl, \n            p.Ordinal, \n            COUNT(a.ProfessionId) AS NumberOfAssignments\n    FROM ME_Profession AS p \n    LEFT OUTER JOIN ME_Assignment AS a ON a.ProfessionId = p.Id\n    INNER JOIN ME_Client AS c ON a.ClientId = c.Id\n    INNER JOIN aspnet_Membership AS m ON m.UserId = c.UserId\n    WHERE m.IsApproved = 1 \n    GROUP BY p.Id, p.Naam, p.FriendlyUrl, p.Ordinal\nEND\n</code></pre>\n\n<p>I've already came up with and modified procedure like the one below, but it doesn't work. It feels like i'm either thinking too difficult or missing something obvious. What could go wrong?</p>\n\n<pre><code>SELECT        p.Id, p.Naam, p.FriendlyUrl, p.Ordinal, pc.NumberOfAssignments\nFROM            ME_Profession AS p \nINNER JOIN ME_Assignment AS a ON a.ProfessionId = p.Id \nINNER JOIN ME_Client AS c ON a.ClientId = c.Id\nINNER JOIN aspnet_Membership AS m ON m.UserId = c.UserId\nINNER JOIN (SELECT a2.ProfessionId, COUNT(*) AS NumberOfAssignments FROM ME_Assignment AS a2 GROUP BY a2.ProfessionId WHERE a2.Closingdate &gt; GETDATE()) pc ON p.ProfessionId = pc.ProfessionId\nWHERE        m.IsApproved = 1 AND a.Closingdate &gt; GETDATE()\nGROUP BY p.Id, p.Naam, p.FriendlyUrl, p.Ordinal\n</code></pre>\n\n<p><strong>UPDATE 1:</strong> Added where condition for date</p>\n"},{"tags":["sql-server","query","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13234761,"title":"Multiple rows in one","body":"<p>I know there are similar questions like mine but unfortunately I haven't found the corresponding solution to my problem.</p>\n\n<p>First off here's a simplified overview of my tables:</p>\n\n<ul>\n<li><p><code>Partner</code> table: <code>PartnerID, Name</code></p></li>\n<li><p><code>Address</code> table: <code>PartnerID, Street, Postcode, City, ValidFrom</code></p></li>\n<li><p><code>Contact</code> table: <code>PartnerID, TypID, TelNr, Email, ValidFrom</code></p></li>\n</ul>\n\n<p>A partner can have one or more addresses as well as contact info. With the contact info a partner could have let's say 2 tel numbers, 1 mobile number and 1 email. In the table it would look like this:</p>\n\n<pre><code>PartnerID   TypID   TelNr                   Email               ValidFrom\n1           1       0041 / 044 - 2002020                        01.01.2010\n1           1       0041 / 044 - 2003030                        01.01.2011\n1           2       0041 / 079 - 7003030                        01.04.2011\n1           3                               myemail@hotmail.com 01.06.2011\n</code></pre>\n\n<p>What I need in the end is, combining all tables for each partner, is like this:</p>\n\n<pre><code>PartnerID   Name    Street              Postcode        City            TelNr                               Email\n1           SomeGuy MostActualStreet    MostActualPC    MostActualCity  MostActual Nr (either type 1 or 2)  MostActual Email\n</code></pre>\n\n<p>Any help?</p>\n"},{"tags":["sql","sql-server","query","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13239312,"title":"Return 4 separate counts for single column in SSRS DataSet","body":"<p>I want to provide 5 counts to SSRS from a conditional count on a column.  For instance, suppose the column held the color of a product -- green ,blue, red and yellow.  What I would like to do is return the count of each in a single query.</p>\n\n<p>Although I can accomplish getting this done using a case statement:</p>\n\n<pre><code>Select\n      COUNT(*) 'Count',\n      case\n            When Color = 'BL' then 'Blue\n            When Color = 'RD' then 'Red\n            When Color = 'YL' then 'Yellow\n            When Color = 'GR' then 'Green\n            Else 'All Others'\n      End as Payment\nFrom COLORS(NoLock)\nGroup by\n      case\n            When Color = 'BL' then 'Blue\n            When Color = 'RD' then 'Red\n            When Color = 'YL' then 'Yellow\n            When Color = 'GRthen Green\n            Else 'All Others'\n      End\n</code></pre>\n\n<p>When I use the dataset is SSRS, all I get is the a single count.  I don't want to create 4 dataset queries as I'm actually selection the records by the parameters start and end date and I would end up having 5 sets of date parameters. </p>\n"},{"tags":["sql-server","sql-server-2008","user-permissions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2522,"score":0,"question_id":5362206,"title":"SQL Server 2008 user permissions","body":"<p>I am using SQL Server 2008 with SQL authentication... I wanna know permissions given to a particular users.... it should list all the permissions given to a particular user for a particular databases... plz reply fast...</p>\n"},{"tags":["c#","sql-server","installation","components","smo"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":13166278,"title":"How to reliably determine which components of SQL Server 2008 are installed, using C#?","body":"<p>I want to achieve the following programatically using C#.</p>\n\n<p>Query components installed in SQL Server 2008\ne.g</p>\n\n<ol>\n<li>Upgrade Tools</li>\n<li>Debug Symbols</li>\n<li>Replication Support</li>\n<li>Books Online</li>\n<li>Development Tools</li>\n</ol>\n\n<p>I have tried using SMO API for SQL Server tried to query Information Collection as well Configuration collection but could not find the any of the above three points.</p>\n\n<p>I need to be able to programmatically determine which SQL Server 2008 components are installed and which are not installed, just like SQL Server Installation setup which first checks to see which components are installed.</p>\n\n<p>One way is to query SQL Server Installation Log File, but it is not helpful if SQL Server is completely no there or if someone has deleted that log file. </p>\n\n<p>I need to reliably determine the installed SQL Server components</p>\n\n<p>Please help.</p>\n\n<p>Thanks</p>\n\n<p>Steve</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13238109,"title":"SQL Job Scheduler UI in silverlight","body":"<p>I use this query to get the values of a job and display it in a silverlight control. The UI is exactly like the SQL Job Scheduler UI. But I having hard time deciphering the numeric values in sysschedules to UI Elements.</p>\n\n<p>Especially the week, each value is multiplied by itself and 2. For eg, Sunday=1, Monday=2, Tuesday=4, Wed=8, Thu=16, Fri=32, Sat=64.\nIn sysschedules it's stored in combination of the values. For eg, if Fri and Sat are checked the freq_interval=96 (64+32), if all the days are checked it's value would be 127.</p>\n\n<p>My question is, is there a formula or something to know what days are selected using the numeric value.</p>\n\n<pre><code> SELECT   \n  schedule_id  \n  ,schedule_uid  \n  ,originating_server_id  \n  ,name  \n  ,owner_sid  \n  ,enabled  \n  ,freq_type  \n  ,freq_interval  \n  ,freq_subday_type  \n  ,freq_subday_interval  \n  ,freq_relative_interval  \n  ,freq_recurrence_factor  \n  ,dbo.FormatDate(active_start_date) as active_start_date  \n  ,dbo.FormatDate(active_end_date) as active_end_date  \n  ,dbo.FormatTime(active_start_time) as active_start_time  \n  ,dbo.FormatTime(active_end_time) as active_end_time  \n  ,date_created  \n  ,date_modified  \n  ,version_number  \n FROM msdb.dbo.sysschedules WHERE schedule_id=@scheduleId  \n</code></pre>\n"},{"tags":["sql","sql-server","database","database-design","database-schema"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":25,"score":-2,"question_id":13238584,"title":"good ebooks/resources for designing a database for Reporting & analysis purposes","body":"<p>I am working on designing a seperate database in Sql Server for analysis and reporting purposes.</p>\n\n<p>I searched online and found the below link to be somewhat useful:\n<a href=\"http://stackoverflow.com/questions/3331637/when-to-build-a-separate-reporting-database\">When to build a separate reporting database?</a></p>\n\n<p>I also denormalized some of the tables where I felt are necessary.</p>\n\n<p>I would like to know if someone could point me out to any resources ebooks/tutorials/blogs that would exclusively focus on designing of databases for analysis and reporting purposes.</p>\n\n<p>We currently have around 1TB of data within the database and the data is expected to grow\ntremendously within the coming months.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":13238668,"title":"Select into a view","body":"<p>I have a simple CTE <code>x</code> and I wish to select its contents into a view.  Can you select into a view using the same type of syntax that you can for a table? i.e.</p>\n\n<pre><code>SELECT * \nINTO newTable\nFROM OldTable\n</code></pre>\n\n<p>Can new views be created dynamically like this?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13238568,"title":"Filling Missing Values in Column","body":"<pre><code>Item  ID\nNULL  1\nNULL  2\n3     3\nNULL  4\nNULL  5\n</code></pre>\n\n<p>Im trying to get the output as</p>\n\n<pre><code>Item  ID\n1     1\n2     2\n3     3\n4     4\n5     5\n</code></pre>\n\n<p>using cursors i updated the bottom 2 nulls as 4 and 5 \nand using flags i have counted the NULLs above 3 but i cant access the top 2 positions ?\nis the approach correct ? </p>\n"},{"tags":["sql-server","network-protocols"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13238219,"title":"SQL Server Express cannot connect error: 28 - Server doesn't support requested protocol","body":"<p>I cannot connect to my local SQL Server Express (2012, but the version shouldn't matter) from my server (Windows 2008 R2) to use a tool on it (APEX SQL Data Diff if you are wondering). I can browse the network servers fine, and select my local instance from the dropdown of available servers, but when I go to search tables on the server, it times out with this error message (same is true of SSMS).</p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: SQL\n  Network Interfaces, error: 28 - Server doesn't support strong text\n  requested protocol) (Microsoft SQL Server, Error: -1)</em></p>\n</blockquote>\n\n<p>I have enabled the firewall - that's not it.</p>\n\n<p>I have allowed remote connections - that's not it.</p>\n\n<p>SQL Server Browser service is on and passed through the firewall - that's not it.</p>\n\n<p>I can connect fine with the same tools <strong><em>TO</em></strong> the server, but <strong><em>FROM</em></strong> the server it fails.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql-server","asp.net-mvc","linq"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13238522,"title":"SQL/Linq coding for a search feature in MVC app - best practice","body":"<p>I have a section of an ASP MVC app I building that displays an info sheet regarding a person, then there is a button which will allow the user to search the database, to see if this person is already in the database before saving the record.  If the record exists, then the feature needs to overwrite certain fields in the DB, kind of a 'search and merge/update'.  </p>\n\n<p>I am pretty sure this will go beyond my LINQ skills, so I am thinking of doing a stored proc, but I wanted to poll the masses to see what the accepted best practice is for something like this.</p>\n\n<p>Thank you for reading, and for your opinion.</p>\n"}]}
{"total":54451,"page":5,"pagesize":100,"questions":[{"tags":["sql-server","entity-relationship","sql-scripts"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13238452,"title":"Sql Server docs from create script","body":"<p>I have the create script of a rather big database (for Microsoft Sql Server) for which I'd like to have the entity-relationship model. What tools can I use to obtain this model (without having to read the script and draw it by hand...).</p>\n\n<p>If there are tools that can run natively in Mac OSX that would be great.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":13234067,"title":"How to write IN clause query to replace null for no value parameter","body":"<p>I am writing a query in which where clause have IN clause and there are large number of values in this IN clause , I want to fetch the result such that if there is no value exist in table for value given in IN clause then a raw containing 0 or null should return for that value. for example..</p>\n\n<pre>\nselect age,sex,date_joining from emp where name IN ('amit','john','paul','dilip')\n</pre>\n\n<p>Now assume for this query ,data for john and paul does not exist in database then result should be like below..</p>\n\n<pre>\n21    male   21-AUG-2011\nnull  null   null\nnull  null   null\n25    male   9-aug-2010\n</pre>\n\n<p>we can also have 0 instead of null if null is not possible</p>\n\n<p>Thanks...</p>\n"},{"tags":["sql-server","caching"],"answer_count":4,"favorite_count":11,"up_vote_count":32,"down_vote_count":0,"view_count":28493,"score":32,"question_id":1873025,"title":"How can I clear the SQL Server query cache?","body":"<p>I've got a simple query running against SQL Server 2005</p>\n\n<pre><code>select * from Table where Col = 'someval'\n</code></pre>\n\n<p>The first time I execute the query can take > 15 secs. Subsequent executes are back in &lt; 1 sec.</p>\n\n<p>How can I get SQL Server 2005 not to use any cached results? I've tried runnning</p>\n\n<pre><code>DBCC DROPCLEANBUFFERS\nDBCC FREEPROCCACHE\n</code></pre>\n\n<p>but this seems to have no effect on the query speed (still &lt; 1 sec).</p>\n"},{"tags":["sql-server"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1892,"score":4,"question_id":837615,"title":"Why does sql server generate stored procedures using sp_executesql statement with string?","body":"<p>When I generate sql schema creation scripts manually I usually just call 'Create Procedure...', however I notice that when you generate the script using the Tasks/Generate Scripts option it uses 'spexecutesql @statement = ..' e.g.</p>\n\n<pre><code>    EXEC dbo.sp_executesql @statement = N'-- =============================================\n    -- Author:  \tMe\n    -- Create date: 20/03/2009\n    -- Description: Does stuff\n    -- =============================================\n    CREATE PROCEDURE [dbo].[MyProc]\n        -- Add the parameters for the stored procedure here\n        @StartDate datetime\n    AS\n    BEGIN\n        -- SET NOCOUNT ON added to prevent extra result sets from\n        -- interfering with SELECT statements.\n        SET NOCOUNT ON;\n    ...\nEND\n'\n</code></pre>\n\n<p>Why is this? Is it something about retaining comments?\nThanks</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13237015,"title":"scope_identity returns null","body":"<p>I am writing a SP in SQL server</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[spAddUserBadge]\nAS\nBEGIN\nINSERT INTO dbo.SE_UserBadge\n(    \n[UID],\nBadgeID,\nBadgeAssignmentOrRenewalDate,\nBadgeExpiryDate ,\nAmountPaid, \nRemarks ,\nAssignedBy          \n)\nVALUES\n(\n17,1, 12-12-2012, 12-12-2013, 0.00, '', ''\n)\nSELECT SCOPE_IDENTITY() AS id    \nEND\nGO\n</code></pre>\n\n<p>SCOPE_IDENTITY is coming as NULL. where I am wrong?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":456,"score":0,"question_id":10834610,"title":"Date of inserting a row into table ","body":"<p>Is it possible to find date+time when a row was inserted into a table in SQL Server 2005?</p>\n\n<p>Does SQL Server log insert commands?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13237853,"title":"SQL Server Procedure Bad Cache Planning","body":"<p>I have some SQL code that uses PetaPoco that executes using sp_executesql. The query has 3 parameters: 2 dates and one string (as varchar(5)).</p>\n\n<p>The query takes 3 minutes to run - from the app or SSMS. If I run the same code in SSMS without sp_executesql (or parameters) it runs in 10 seconds and if I add the OPTION (OPTIMIZE FOR UNKNOWN) hint to the original code (using the sp) it runs in 3 seconds. I have cleared the cache using </p>\n\n<pre><code>  CHECKPOINT;\n  GO\n  DBCC DROPCLEANBUFFERS;\n  GO\n  DBCC FREEPROCCACHE;\n  GO\n</code></pre>\n\n<p>And I still can't get it to run as expected. It seems that adding the option to every query is a hack. Am I missing something?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":38,"score":-2,"question_id":13237623,"title":"Copy data into another table","body":"<p>How to copy (append) data from one table into another table with same schema in SQL Server?</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>I mean to say there is query </p>\n\n<pre><code>select * \ninto table1 \nfrom table2 \nwhere 1=1 \n</code></pre>\n\n<p>which creates <code>table2</code> with the same structure as <code>table1</code>. </p>\n\n<p>So is there any short query like this to only copy entire data only into an already existing table?</p>\n"},{"tags":["sql-server","tsql","ado.net","triggers"],"answer_count":9,"favorite_count":4,"up_vote_count":2,"down_vote_count":0,"view_count":3983,"score":2,"question_id":1798156,"title":"How to keep an audit/history of changes to the table","body":"<p>I've been asked to create a simple DataGrid-style application to edit a single table of a database, and that's easy enough. But part of the request is to create an audit trail of changes made, who made them, and the date/time.</p>\n\n<p>How might you solve this kind of thing?</p>\n\n<p>(I'll be using C# in VS2008, ADO.NET connected to SQL Server 2005, WPF and Xceed's DataGrid, if it makes any difference.)</p>\n"},{"tags":["sql","sql-server","xml"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13237407,"title":"SQL Server XML query: how to select values?","body":"<p>How to select file names from xml like this, i.e.\nI need only names:</p>\n\n<pre><code>c:\\temp\\f1.txt\nc:\\temp\\f2.txt\n</code></pre>\n\n<p>XML like this:</p>\n\n<pre><code>&lt;root name=\"name\" id=\"12\"&gt;\n&lt;class1&gt;\n     &lt;file name=\"c:\\temp\\f1.txt\"&gt;\n&lt;/class1&gt;\n&lt;class1&gt;\n   &lt;subclass1&gt;\n        &lt;file name=\"c:\\temp\\f2.txt\"&gt;\n    &lt;/subclass1&gt;\n&lt;/class1&gt;\n&lt;/root&gt;\n</code></pre>\n"},{"tags":["sql-server","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13233388,"title":"process the new files only","body":"<p>I have a source from which the files are to be processed. Multiple files are coming to that loacation at any time randomly (Package should run every 2 hours). I have to process only the new files, i can not delete, move the already processed files from that location. I can only copy the files to Archive location. How can I achieve this ?</p>\n"},{"tags":["c#",".net","sql-server","smo"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":46,"score":0,"question_id":13233982,"title":"Get Sql server's data using smo","body":"<p>I'm using Sql Server Smo to create the scheme of database by C# application. However, I need a bit more, I also need to get data from each table as a <strong>script</strong> like below:</p>\n\n<pre><code>--........................................\nINSERT INTO Table123 (...) VALUES (....)\nINSERT INTO Table456 (...) VALUES (....)\n--........................................\n</code></pre>\n\n<p>How can I do that and is it possible? Notice please that I need to create exactly a script using smo and not *.bak of a database, etc.</p>\n"},{"tags":["sql-server","sql-server-express"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13236110,"title":"Windows could not start the SQL Server Express on local computer","body":"<p>I have an exam on SQL tomorrow and I have no idea what to do, I need help as quick as possible. here's the error I get:</p>\n\n<p><code>i49.tinypic.com/rsd5sj.png</code></p>\n\n<p><img src=\"http://i.stack.imgur.com/emA7h.png\" alt=\"enter image description here\"></p>\n\n<p>thanks!</p>\n"},{"tags":["asp.net",".net","sql","sql-server","vb.net"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13235490,"title":"Archive checked records in grid view (Change 0 to 1 in database)","body":"<p>I have a grid view which pulls through data dictated by a stored procedure.</p>\n\n<p><img src=\"http://i.stack.imgur.com/S89rn.png\" alt=\"screen shot 1\"></p>\n\n<p>The stored procedure is called GetEverything.\nThe statement is made up of information from 2 tables, one with person detail, and one with vessel detail. The stored procedure select statement contains the following Where clause:</p>\n\n<pre><code>WHERE Vessel.ArchiveStatus = 0\n</code></pre>\n\n<p>By default, every new record that is created using the front end application is given a '0' for ArchiveStatus in the db.</p>\n\n<p>So, the gridview will only show me the records where the ArchiveStatus is 0, which by default is evertything.</p>\n\n<p>The 2 boxes, Check All and Uncheck All are working fully.</p>\n\n<p>What I need now is when a REF or REF(s) are selected and the button 'Archive Records' is clicked, for the 0 in the database to be updated to a 1 for that VesselREF.</p>\n\n<p>Can anoyone advise how to do this and give me some example code to put in the Default.aspx.vb file/ Event Handler for the archive records button.</p>\n\n<p>With this is place, the grid view will only display the non-archived records, and I can create a seperate grid view with its own SQL to bring through the archived records.</p>\n\n<pre><code>GridView.aspx\n\n    &lt;asp:GridView ID=\"GridView1\" runat=\"server\" AutoGenerateColumns=\"False\" \n        DataKeyNames=\"REF,VesselREF\" DataSourceID=\"SqlDataSource1\" Height=\"132px\" \n        style=\"text-align: center; font-family: Calibri; font-size: medium\" \n        Width=\"508px\" BackColor=\"#C4FFC4\"&gt;\n        &lt;AlternatingRowStyle BackColor=\"White\" /&gt;\n        &lt;Columns&gt;\n            &lt;asp:TemplateField HeaderText=\"REF\" InsertVisible=\"False\" SortExpression=\"REF\"&gt;\n\n                &lt;ItemTemplate&gt;\n                    &lt;a href=\"Details.aspx?REF=&lt;%# Eval(\"REF\")%&gt;\"&gt;&lt;%# Eval(\"REF\")%&gt;&lt;/a&gt;\n                    &lt;asp:CheckBox ID=\"RecordSelector\" runat=\"server\" /&gt;\n                &lt;/ItemTemplate&gt;\n            &lt;/asp:TemplateField&gt;\n            &lt;asp:BoundField DataField=\"Title\" HeaderText=\"Title\" SortExpression=\"Title\" /&gt;\n            &lt;asp:BoundField DataField=\"FirstName\" HeaderText=\"FirstName\" \n                SortExpression=\"FirstName\" /&gt;\n            &lt;asp:BoundField DataField=\"Surname\" HeaderText=\"Surname\" \n                SortExpression=\"Surname\" /&gt;\n            &lt;asp:BoundField DataField=\"VesselName\" HeaderText=\"VesselName\" \n                SortExpression=\"VesselName\" /&gt;\n            &lt;asp:BoundField DataField=\"VesselREF\" HeaderText=\"VesselREF\" \n                InsertVisible=\"False\" ReadOnly=\"True\" SortExpression=\"VesselREF\" /&gt;\n\n        &lt;/Columns&gt;\n    &lt;/asp:GridView&gt;\n</code></pre>\n"},{"tags":["sql","sql-server","date","time"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":2192,"score":6,"question_id":7105093,"title":"Difference between datetime and timestamp in sqlserver?","body":"<p>What is the difference between <code>Timestamp</code> and <code>Datetime</code> SQL Server?</p>\n\n<p>I thought Both formats are capable of storing date + time. Then, Where the difference is lying between them?</p>\n\n<p>But <code>Timestamp</code> is not capable of storing date, time information.</p>\n\n<p>Still Whats the difference?</p>\n"},{"tags":["sql-server","query","tsql","insert"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13235720,"title":"SQL Server append query","body":"<p>I have the following (not working) query:  </p>\n\n<pre><code>insert into [MyDB].[dbo].[Reports_StepsStat]  \n    (ActivityID,TaskID,StepIndex,StepStatus,TimeSpanInSeconds,Score)\nVALUES (\n  SELECT\n    tasks.ActivityID as ActivityID,\n    tasks.ID as TaskID,\n    [StepIndex]=item.value('(StepIndex)[1]', 'NVARCHAR(MAX)'),\n    [StepStatus]=item.value('(Status)[1]', 'NVARCHAR(MAX)'),\n    [TimeSpanInSeconds] = DATEDIFF(MINUTE, item.value('(StartedOn)[1]',    'datetime'),item.value('(FinishedOn)[1]', 'datetime')),\n    tasks.Score as Score\n  FROM \n    [MyDB].[dbo].[Tasks] as tasks \n  CROSS APPLY \n    [Progress].nodes ('//Progress/Steps/ProgressStep') Progress(item)\n)  \n</code></pre>\n\n<p>The inner select query (<code>SELECT task.ActivityID..</code>) works perfectly and produces the expected table.  </p>\n\n<p>The outer <code>insert into</code> part is supposed to append the result of the inner part to a table by the name of <code>Reports_StepsStat</code>. This does not work.  </p>\n\n<p>I have tried and succeeded doing that with <code>SELECT INTO</code>, but apparently <code>SELECT INTO</code> can only be used to create a new table, and not to append to an existing table, which is what I need.  </p>\n\n<p>The errors I get are:  </p>\n\n<blockquote>\n  <p><em>Msg 156, Level 15, State 1, Line 6</em><br>\n  <em>Incorrect syntax near the keyword 'SELECT'.</em><br>\n  <em>Msg 102, Level 15, State 1, Line 14</em><br>\n  <em>Incorrect syntax near ')'.</em></p>\n</blockquote>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":66,"score":0,"question_id":13235616,"title":"Converting INT to Time","body":"<p>I have a column in sql that is an INT and I have to convert it to time.</p>\n\n<p>I've tried </p>\n\n<pre><code>         CONVERT (VARCHAR, columnA / 600000)\n   + ':'\n   + RIGHT ('00' + CONVERT (VARCHAR, c_columnA % 60), 2)\n</code></pre>\n\n<p>but that's not the result.  Any idea's how the data might be being casted?</p>\n\n<p>Here a sample of the data:</p>\n\n<pre>\nINT |TIME\n4680001|13:00\n4680001|13:00\n4596001|12:45\n3846001|10:41\n4320001|12:00\n</pre>\n"},{"tags":["sql-server","sql-server-2005","named-instance"],"answer_count":7,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":16080,"score":10,"question_id":35026,"title":"SQL Server, convert a named instance to default instance?","body":"<p>I need to convert a named instance of SQL server 2005, to a default instance.</p>\n\n<p>Is there a way to do this without a reinstall?</p>\n\n<hr>\n\n<p>The problem is, 2 out of 6 of the developers, installed with a named instance. So its becoming a pain changing connection strings for the other 4 of us. I am looking for the path of least resistance to getting these 2 back on to our teams standard setup.  </p>\n\n<p>Each has expressed that this is going to be, too much trouble and that it will take away from their development time. I assumed that it would take some time to resolve, in the best interest of all involved, I tried combing through configuration apps installed and didn't see anything, so I figured someone with more knowledge of the inner workings would be here.</p>\n"},{"tags":["sql-server","versioning","database-versioning"],"answer_count":4,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":2105,"score":10,"question_id":451863,"title":"How do I version a SQL Server Database?","body":"<p>I need to put versions onto a SQL Server 2005 database and have these accessible from a .NET Application.  What I was thinking is using an Extended Properties on the Database with a name of 'version' and of course the value would be the version of the database.  I can then use SQL to get at this.  My question is does this sound like a good plan or is there a better way for adding versions to a SQL Server database?</p>\n\n<p>Lets assume I am unable to use a table for holding the Metadata.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":10,"down_vote_count":0,"view_count":135,"score":10,"question_id":13235382,"title":"Double IN Statements in SQL","body":"<p>Just curious about the IN statement in SQL.\nI know I can search multiple columns with one value by doing</p>\n\n<pre><code>'val1' IN (col1,col2)\n</code></pre>\n\n<p>And can search a column for multiple values</p>\n\n<pre><code>col1 IN ('val1','val2')   \n</code></pre>\n\n<p>But is there a way to do both of these simultaneously, without restorting to an repeating AND / OR in the SQl? I am looking to do this in the most scalable way, so independent of how many vals / cols i need to search in.\nSo essentially:</p>\n\n<pre><code>('val1','val2') IN (col1,col2)\n</code></pre>\n\n<p>but valid.</p>\n"},{"tags":["sql-server","ssas","mdx"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":34,"score":2,"question_id":13235169,"title":"Time hierarchy in SSAS (dyslexia)","body":"<p>Time dimension have hierarchies:</p>\n\n<ul>\n<li>Year  month  date </li>\n<li>Year  week  date</li>\n<li>Year - month</li>\n</ul>\n\n<p>I query them so:</p>\n\n<pre><code>LASTPERIODS( -12, StrToMember(\"[Time].[Year -  Week -  Date].[Week].&amp;[\" + Format(now(), \"yyyy-MM-\" + \"01T00:00:00\") + \"]\")) \n</code></pre>\n\n<p>returns null</p>\n\n<pre><code>LASTPERIODS( -12, StrToMember(\"[Time].[Year - Month].[Month].&amp;[\" + Format(now(), \"yyyy-MM-\" + \"01T00:00:00\") + \"]\"))\n</code></pre>\n\n<p>returns future 12 months</p>\n\n<p>If i query like this: </p>\n\n<pre><code>select non empty([Time].[Year -  Week -  Date].[Week].members) on 0\n</code></pre>\n\n<p>it will give me the week members..</p>\n\n<p>Am I missing some parameter?</p>\n"},{"tags":["sql-server","reliability","indexed-view"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13235391,"title":"Reliability of Indexed views","body":"<p>I just found out that a report I quickly threw together years ago has been the sole means of collecting millions of dollars, and there isn't anything being done to check if it is correct.  </p>\n\n<p>For performance reasons, the report makes heavy use of indexed views.  This concerns me, since while I have used indexed views a lot, I tend not to use them for anything this critical.  </p>\n\n<p>Is it possible that the indexed views can fail to update or otherwise return information different from the data in the tables?  How real of a risk is this?  Is there a good SQL script I can run periodically to check for errors?</p>\n"},{"tags":["c#","sql-server","entity-framework","database-connection"],"answer_count":9,"favorite_count":14,"up_vote_count":41,"down_vote_count":0,"view_count":47442,"score":41,"question_id":2475008,"title":"The underlying provider failed on Open","body":"<p>I was using .mdf for connect to DB and entityClient. Now I want to change the connection string so that there will be no .mdf</p>\n\n<p>Is this <code>connectionString</code> correct</p>\n\n<pre><code>&lt;connectionStrings&gt;\n&lt;!--&lt;add name=\"conString\" connectionString=\"metadata=res://*/conString.csdl|res://*/conString.ssdl|res://*/conString.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=.\\SQL2008;AttachDbFilename=|DataDirectory|\\NData.mdf;Integrated Security=True;Connect Timeout=30;User Instance=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;--&gt;\n&lt;add name=\"conString\" connectionString=\"metadata=res://*/conString.csdl|res://*/conString.ssdl|res://*/conString.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=.\\SQL2008;Initial Catalog=NData;Integrated Security=True;Connect Timeout=30;User Instance=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p></p>\n\n<p>because I always get error <code>The underlying provider failed on Open</code>?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":46,"score":3,"question_id":13235048,"title":"Multiple Rows in INSERTED table","body":"<p>On a table in MS SQL Server I need to run a CLR Stored Procedure on new rows if those rows meet certain criteria.  I thought that would be more or less straightforward:</p>\n\n<pre><code>if ((SELECT Cabinet FROM INSERTED) = 1 OR (SELECT Cabinet FROM INSERTED) = 3) AND (SELECT Result_02 FROM INSERTED) = 'N'\nBEGIN\n    DECLARE @id int\n    SET @id = (SELECT ID FROM INSERTED)\n    exec PrintLabel\n        @id,\n        N'LP 2844 LGE'\nEND;\n</code></pre>\n\n<p>However, this recently started throwing errors about a subquery returning multiple rows. I learned that INSERT triggers run once for each statement, not necessarily on individual rows. So, that IF statement can be working on multiple rows, and thus the error.</p>\n\n<p>My question is: how can I iterate over each new row if the rows are added in a batch (in this case via a MERGE statement). </p>\n"},{"tags":["c#",".net","sql-server","sql-server-2008-r2","clr"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":13066021,"title":"What .Net assemblies are integrated into the SQL Server 2008 R2 CLR as standard?","body":"<p>I have an existing assembly that has been used within SQL Server for some time. Today I added some experimental code that references <code>System.Data.Linq</code>. Creating the assembly within <strong>SQL 2008 R2</strong> resulted in this error:</p>\n\n<blockquote>\n  <p><em>Assembly 'system.data.linq, version=3.5.0.0, culture=neutral, publickeytoken=b77a5c561934e089.' was not found in the SQL catalog.</em></p>\n</blockquote>\n\n<p>This is not entirely unexpected, but I was wondering how to determine what the full set of standard '<strong>core</strong>' assembles is within 2008 R2. Presumably <code>System.Data.Linq</code> isn't one of them - but I would like to confirm this and also confirm what assemblies are provided as standard.</p>\n"},{"tags":["sql","sql-server","ssas","sql-server-2012","xmla"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13148511,"title":"Add attribute to cube and reprocess without original database","body":"<p>Every year we keep a historical copy of one of our cubes. This year someone decided they wanted to pay us money to add an attribute to the cube which did not previously exists. Fine, I like money,  but the issue is we don't have a backup of the database that we built this cube off of. </p>\n\n<p>So a question arises in my head, do we need that original database to add a new attribute to this cube? Is it possible for us to add a new attribute to the cube and only process this attribute without having the cube orignal datasource? </p>\n\n<p>Not having a great understanding of what is happening under the hood when I add an attribute to a SSAS cube and process, I can't say if this is or isn't possible. I could imagine that possibly, the cube has a snapshot in memory of the datasource that it can work off of. I can also imagine that this would be ridiculously inefficient so there is a chance this is no way in heck possible</p>\n\n<p>EDIT: It at least would seem feasible to add a calculated member that makes use of existing data in the cube.</p>\n\n<p>I also should mention that I tried to add an attribute to such a cube and received an error:</p>\n\n<blockquote>\n  <p>\"Dimension [Partner] cannot be saved  File system error failed to copy\n  file C:\\\\MYSQLSERVER\\OLAP\\DATA\\2013_Cube.db\\\\.dim\\.dstore  to C:\\\\MYSQLSERVER\\OLAP\\DATA\\2013_Cube.db\\\\.dim\\.dstore  file exists\"</p>\n</blockquote>\n\n<p>Sorry I faked those filepaths a little. </p>\n"},{"tags":["c++","sql-server","extended-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":8,"score":1,"question_id":13234817,"title":"Can srv_paramsetoutput() be used to set nvarchar(max) or varchar(max)?","body":"<p>I'm writing an extended stored procedure for SQL Server in C++.</p>\n\n<p>The user can provide OUT parameters which I can set using srv_paramsetoutput(). However, this seems to always fail when I try to set TEXT, VARCHAR(max) or NVARCHAR(max). Note that VARCHAR(max) is referred to internally as SRVBIGVARCHAR.</p>\n\n<p>Is there a common mistake I could be making or are these datatypes inaccessible to xprocs when used as output parameters?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13202697,"title":"Updating a set of data from the output of a Table Valued Function","body":"<p>I am trying to write up a query that are merging duplicate client records in to a single record. Right now I am just building a mapping table to know what I should map with what.</p>\n\n<p>Here are the two functions I wrote to aid me in this</p>\n\n<pre><code>CREATE FUNCTION FindDuplicateClients ()\nRETURNS TABLE AS RETURN \n(\n    select distinct CLIENT_GUID \n    from CLIENTS c\n    inner join\n    (\n        select FIRST_NAME, LAST_NAME, HOME_PHONE\n        from CLIENTS\n        group by FIRST_NAME, LAST_NAME, HOME_PHONE\n        having COUNT(*) &gt; 1\n    ) t on c.FIRST_NAME = t.FIRST_NAME and c.LAST_NAME = t.LAST_NAME and c.HOME_PHONE = t.HOME_PHONE)\ngo\n\n--Find other clients that map to this client\nCREATE FUNCTION FindDuplicateClientsByClient (@Client uniqueidentifier)\nRETURNS TABLE AS RETURN \n(\n    select distinct CLIENT_GUID \n    from CLIENTS c\n    inner join\n    (\n        select x.FIRST_NAME, x.LAST_NAME, x.HOME_PHONE\n        from CLIENTS x\n        inner join \n        (\n            select FIRST_NAME, LAST_NAME, HOME_PHONE\n            from CLIENTS\n            where CLIENT_GUID = @Client\n        ) y on x.FIRST_NAME = y.FIRST_NAME and x.LAST_NAME = y.LAST_NAME and x.HOME_PHONE = y.HOME_PHONE\n        group by x.FIRST_NAME, x.LAST_NAME, x.HOME_PHONE\n        having COUNT(*) &gt; 1\n    ) t on c.FIRST_NAME = t.FIRST_NAME and c.LAST_NAME = t.LAST_NAME and c.HOME_PHONE = t.HOME_PHONE\n    where CLIENT_GUID &lt;&gt; @Client)\ngo\n</code></pre>\n\n<p>The first function successfully returns all <code>CLIENT_GUID</code>'s that have more than 1 record, the second you pass in a GUID and it returns all other guids that share the \"Common Information\" (first name, last name, and home phone in this case)</p>\n\n<p>The problem is filling out my mapping table. I have some rules I need to follow to give priority to some of the duplicates. For example anyone who has had transactions needs to not have their <code>CLIENT_GUID</code> changed, but they are able to have other GUIDs merged in to them (if the other GUIDs had no transactions)</p>\n\n<pre><code>--Create Mapping table\nselect CLIENT_GUID, CAST(null as uniqueidentifier) as NEW_CLIENT_GUID\ninto #mapping\nfrom FindDuplicateClients()\n\n--Do not map people who have transactions\nupdate #mapping\nset NEW_CLIENT_GUID = CLIENT_GUID\nwhere CLIENT_GUID in (select CLIENT_GUID from trnHistory)\n</code></pre>\n\n<p>Now here is where I am running in to trouble. I don't know how to get the list of people who had <code>NEW_CLIENT_GUID</code> set in the previous query, run <code>FindDuplicateClientsByClient</code> against that GUID, and set <code>NEW_CLIENT_GUID</code> of any result to the <code>NEW_CLIENT_GUID</code> that was fed in to the function without using a cursor.</p>\n\n<p>Here is the method I came up with using a cursor</p>\n\n<pre><code>declare cur cursor LOCAL FAST_FORWARD for select NEW_CLIENT_GUID from #mapping where NEW_CLIENT_GUID is not null\ndeclare @NEW_CLIENT_GUID uniqueidentifier\n\nopen cur\nfetch next from cur into @NEW_CLIENT_GUID\nwhile @@fetch_status = 0\nbegin\n    update #mapping\n    set NEW_CLIENT_GUID = @NEW_CLIENT_GUID\n    where CLIENT_GUID in (select CLIENT_GUID from FindDuplicateClientsByClient(@NEW_CLIENT_GUID)) --Find duplicates to this record\n        and NEW_CLIENT_GUID is null --Do not reassign values that are already set (ie: duplicates that have transactions)\n\n    fetch next from cur into @NEW_CLIENT_GUID\nend \n\nclose cur\ndeallocate cur\n</code></pre>\n\n<p>To me, iterating over each result in <code>#mapping</code> that has a value set does not seem correct to me. What would be the correct way to do this? I am using SQL Server 2008 R2 but I would prefer if it was compatible with SQL Server 2005 too.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13234465,"title":"Multiple variables assignment using SET and SELECT","body":"<p>I use the following t-sql code for assign to variable a value obtained from select statement</p>\n\n<pre><code> DECLARE @cfMitt nvarchar(16)\n\n SET @cfMitt = (SELECT CfMittente\n    FROM Messaggi\n    WHERE IDMessaggio = @IDMessaggio)\n</code></pre>\n\n<p>If I want use multiple assignement I try with the following  code, but something is wrong:</p>\n\n<pre><code>DECLARE @cfMitt nvarchar(16)\nDECLARE @cfDest nvarchar(16)\n\nSET @cfMitt, @cfDest= (SELECT CfMittente, CfDestinatario\nFROM Messaggi\nWHERE IDMessaggio = @IDMessaggio)\n</code></pre>\n\n<p>Where is the error?</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":118,"score":0,"question_id":8182250,"title":"Allow Search for Invalid Date stored as string - Is it recommended or not","body":"<p>I have two tables for an Entity - say Valid_Doc and Invalid_Doc. If document is valid, then all the data gets saved in Valid_Doc table.In case any of the attribute of document is invalid , it gets saved in Invalid_Doc.Due_Date is on of the column of both the tables. In Invalid_Doc , we are saving <strong>Invalid dates as string</strong>.</p>\n\n<p>Suppose if user searches for documents through a SEARCH screen with following date </p>\n\n<p><strong>Due_Date - is after - 07/07/11</strong>,\nShall we show all the documents from both the tables.As Due_Date in Invalid_Doc  table is string, there is no way we can compare the entered search date with the dates available in database in <strong>Invalid_Doc</strong> table.</p>\n\n<p>Can someone please guide me whether to use DATEDIFF - i.e. need to convert the String date in DB to <strong>Date(millisecs)</strong> first and then do the comparison with the entered data.Doing this , there may be unpredictable results. So , shall we allow the user to search for Invalid doc through Date or NOT.</p>\n\n<pre><code>Select * FROM   invalid_doc iil WITH (nolock) WHERE\nCAST(Datediff(s, '19700101 05:00:00:000', iil.due_date) AS NUMERIC) * \n   1000 \n   BETWEEN '1120501800000' AND '1120501800000'\n</code></pre>\n\n<p>Where '1120501800000' and '1120501800000' are Date converted in milliseconds.</p>\n\n<p>Please suggest.</p>\n"},{"tags":["sql-server","getdate","datepart"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":13234184,"title":"Need To Pull Data With Specific Date Range From Current Day In Sql Express 2008","body":"<p>On my table I have a \"Datemodified\" column.  I was to be able to pull results based on that Column.  I want to be able to pull anything from 6am to 6pm.  This query needs to be able to be used everyday, so the ways I've seen, use a specific date and I can't get any of the queries I've looked for to work for my specific case.</p>\n\n<p>Here is what I've gotten to work so far, it pulls the right hour time frame, but I need it to run only for the current day.  Thanks all!</p>\n\n<pre><code>SELECT \n  Assignment\n  , Datemodified\n  , General\n  , IncNumber\n  , NextSteps\n  , PDCRStatus\n  , RootCause\n  , Status\n  , Summary\n  , Timings\n  , UserID \nFROM \n  Turnover \nWHERE \n  DATEPART(HOUR, datemodified) between 06 and 18 \n  --AND datemodified = GETDATE()\n</code></pre>\n"},{"tags":["sql","sql-server","select","parameters","where-clause"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13233676,"title":"How to improve performance of SQL query with parameters?","body":"<p>I'm using SQL Server 2005. </p>\n\n<p>I have a problems with executing SQL statements like this</p>\n\n<pre><code>DECLARE @Param1 BIT\nSET @Param1 = 1\n\nSELECT \n    t1.Col1,\n    t1.Col2\nFROM\n    Table1 t1\nWHERE\n    @Param1=0 OR\n    (t1.Col2 in \n        (SELECT  t2.Col4\n            FROM \n                Table2 t2\n            WHERE \n                t2.Col1 = t1.Col1 AND \n                t2.Col2 = 'AAA' AND \n                t2.t3 &lt;&gt; 0)\n    )\n</code></pre>\n\n<p>This query executes very long time.</p>\n\n<p>But if I replace <code>@Param1</code> with <code>1</code>, than query execution time is ~2 seconds. </p>\n\n<p>Any information how to resolve the problem would be greatly appreciated.</p>\n"},{"tags":["sql-server","xml","sql-server-2012","bulk-import"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13233868,"title":"bulk import of xml data in to sql server","body":"<p>I have a set of xml files that I want to parse the data of and import in to a sql server 2012 database. The provided xml files will be validated against a schema.</p>\n\n<p>I am looking as to what is the best method of doing this is. I have found this: <a href=\"http://msdn.microsoft.com/en-us/library/ms171878.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms171878.aspx</a> </p>\n\n<p>I am wondering if this is the best way or if there are others? </p>\n"},{"tags":["sql","sql-server","foreign-keys","sql-update","revert"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13233742,"title":"How to revert update query in sql server?","body":"<p>I am using SQL Server for my database. now there is table which has following columns.</p>\n\n<pre><code>PK_ID   FK_ID   Name   Description\n1        5       ABC      ABCDE\n2        7       EFG      EFT\n3        8       XUZ      Xyz\n4        11      TEF      TEF\n</code></pre>\n\n<p>Now by mistake i update some Fk_ID field with null value. Now I want to get back my all fk_id which is updated by null value. So is there any way to revert back fk_id's which has value previously?</p>\n\n<p>Can any one help me out to find out solution for the same?</p>\n"},{"tags":["c#","sql-server","asp.net-mvc","entity-framework","complex-data-types"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":71,"score":4,"question_id":13212338,"title":"Calling stored procedure in EF with Complex Data Type","body":"<p>I am new to working with <code>Entity Framework</code> in a sample <code>ASP.NET/MVC 3.0 VS2010</code> project. I have imported two stored procedures as Function Imports and, in doing so, created a complex data type for each.</p>\n\n<p>I am trying to run the following c# code:</p>\n\n<pre><code>public ComplexDataType RunStoredProc()\n{\n    var context = new DbEntities();\n    int param1 = 370;\n    int param2 = -1;\n    string param3 = \"Current\";\n\n    ComplexDataType result = new ComplexDataType;\n    result = context.StoredProc(param1, param2, param3);\n    return result;\n}\n</code></pre>\n\n<p>And I'm getting the error:</p>\n\n<pre><code>Cannot implicitly convert data type \n    System.Data.Objects.ObjectResult(ComplexDataType) to 'ComplexDataType'\n</code></pre>\n\n<p>What am I doing wrong? How do I properly store the results of the stored proc in a complex data type?</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13231825,"title":"SET datatype set in SQL Server","body":"<p>While creating a table I have to use the datatype <code>SET</code>, but it looks like there is no datatype <code>SET</code> in SQL Server. I was looking on the Microsoft's website and those are the datatypes that it supports: <a href=\"http://msdn.microsoft.com/en-us/library/ms187752.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms187752.aspx</a></p>\n\n<p>Which one should I use to replace the <code>SET</code>?</p>\n\n<p>I have used <code>SET</code> in MySQL database like this:</p>\n\n<pre><code>CREATE TABLE IF NOT EXISTS `configurations` (\n`index` int(11) NOT NULL AUTO_INCREMENT,\n`user_id` int(11) NOT NULL,\n`configDuration` int(5) NOT NULL,\n`configDurationPerspective` set('list_this_day','list_remaining') NOT NULL,\nPRIMARY KEY (`index`)\n) ENGINE=InnoDB  DEFAULT CHARSET=latin1;\n</code></pre>\n\n<p>And then when I insert data into the table it looks like this:</p>\n\n<pre><code>INSERT INTO 'configurations' (index, user_id, configDuration, configDurationPerspective) VALUES (1, 1, 2, 'list_this_day');\n</code></pre>\n\n<p>Never mind the quotes. Something messed up while pasting the code.</p>\n\n<p>Now I want to do the same thing, but in SQL Server.</p>\n"},{"tags":["sql","sql-server"],"answer_count":8,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":5231,"score":7,"question_id":331157,"title":"Does SQL Server CheckSum calculate a CRC? If not how can I get MS SQL to calculate a CRC on an arbitrary varchar column?","body":"<p>Does SQL Server CheckSum calculate a CRC? If not how can I get SQL Server to calculate a CRC on an arbitrary varchar column?</p>\n"},{"tags":["sql","sql-server","variables"],"answer_count":1,"favorite_count":1,"up_vote_count":6,"down_vote_count":1,"view_count":59,"score":5,"question_id":13233129,"title":"Declared variable behaving differently to hard coded string","body":"<p>I am trying to set a like parameter into a variable and allow that variable to accept wild cards (mssql 2005). If I use my parameter set to '%' it only returns a partial subset but if I hard code the query to use '%' it returns the full set. Why might the variable behave differently to the string?</p>\n\n<pre><code>DECLARE @wareno char(4); \nSET @wareno = '%';\nselect @wareno as a, * from waredesc where wareno like @wareno;\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>DECLARE @wareno char(4); \nSET @wareno = '%';\nselect @wareno as a, * from waredesc where wareno like '%';\n</code></pre>\n\n<p>The full scenario is switching based on a flag but is reproducible under the code above</p>\n\n<pre><code>DECLARE @wareno char(4); \nDECLARE @delprods bit;\n\n/**\nSET THESE PARAMETERS\n**/\nSET @wareno = '1'; \nSET @delprods = 'true'; /** if true all the warehouses should also be emptied for safety - products are held at a company level!**/\n\nIF @delprods = 1\nBEGIN\n    SET @wareno = '%';\nEND\nselect @wareno as a, * from waredesc where wareno like @wareno;\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":13231884,"title":"How can I speed up this SQL query","body":"<p>I have a piece of code in an ASP.NET application that builds a SQL query from a list of parameters. The number of parameters can vary, so various criteria can be added to this query.  The database is Microsoft SQL Server 2008.</p>\n\n<p>All the AND and OR's are generated programmatically.</p>\n\n<p>The query took more than 3 seconds to execute, but after some profiling and indexes it runs less than a second. Still I think the query itself can be optimized. I've looked at execution plans, but that doesn't mean much to me - not being a SQL guru.</p>\n\n<p>I wonder if the query can be done in a more intelligent fashion - I haven't been able to figure it out. Here's an example of the query:</p>\n\n<pre><code> SELECT [id], [WorkTitle], [CreateDate], [UpdateDate], [Writer], [ValidFrom], \n\n[ValidTo], [Text] \n FROM dbo.Texts T  \n WHERE Category_id = 3 AND '2012-11-06' BETWEEN ValidFrom AND ValidTo  \n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 1 AND CL.Value = '95068')       \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 1))  \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 2 AND CL.Value = 'C')       \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 2))  \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 3 AND CL.Value = 'HEL')       \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 3))  \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 4 AND CL.Value = 'CC')      \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 4))  \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 5 AND CL.Value = NULL)     \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 5))  \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 7 AND CL.Value = '321')      \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 7))  \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 9 AND CL.Value = 'DK7778')    \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 9))  \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 10 AND CL.Value = 'TFS')   \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 10)) \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 11 AND CL.Value = 'TMP')   \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 11)) \n\n AND (EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id   AND CL.Criteria_id = 13 AND CL.Value = 'OY-VKB')   \n    OR NOT EXISTS (SELECT 'X' FROM dbo.Criteria_List CL WHERE T.id = CL.Text_id AND CL.Criteria_id = 13)) \n</code></pre>\n\n<p>Any tips and tricks are appreciated.</p>\n\n<p>Cheers\nJens</p>\n"},{"tags":["c#",".net","sql-server","smo"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13229602,"title":"Using Smo in C# - skip constraint generating instructions at the beginning","body":"<p>I have to create a full copy of a remote db. I have only one useful and easy way to do it: by generating scripts. I am aware about other ways (create backup, for instance) but I can't use them for some reason.</p>\n\n<p>Since one table might be depend on another (has a foreign key, etc...) and because of this it's pretty difficult to figure out the valid order of creating tables, I decide to generate these \"dependable\" script instructions at the very end. </p>\n\n<p>Well, I know how to generate that \"dependable\" script instructions within (close to) table creation. But what should I do to skip them first only to generate them at the end?</p>\n\n<p>For instance:</p>\n\n<pre><code>--How I do NOT want\n--.........................\nCREATE TABLE Table1(....)\nALTER TABLE Table1 ADD CONSTRAINT ...\n\nCREATE TABLE Table2(....)\nALTER TABLE Table2 ADD CONSTRAINT ...\n\n\n\n--How I would like\n--.........................\nCREATE TABLE Table1(....)\nCREATE TABLE Table2(....)\n--.........................\nCREATE TABLE TableN(....)\n--.........................\n--the end of a script\nALTER TABLE Table1 ADD CONSTRAINT .....\n</code></pre>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13232583,"title":"Scripting for SQL Server 2005","body":"<p>This script works only in 2008 version:</p>\n\n<pre><code>declare @tab table(\nid_emp int,\nFIL_ROT_WID xml\n)\n\ninsert into @tab\nselect 0, '&lt;xml&gt;&lt;/xml&gt;'\n\ndeclare @xml_rot_widget xml\nset @xml_rot_widget = '&lt;ati id=\"1123\" val=\"new()\" /&gt;'\n\nupdate @tab\nset FIL_ROT_WID.modify('insert sql:variable(\"@xml_rot_widget\")\n                    as last\n                    into (/xml)[1]')\nwhere id_emp = 0\n\nselect * from @tab\n</code></pre>\n\n<p>In 2005 I receive the follow error:</p>\n\n<pre><code>XQuery: SQL type 'xml' is not supported in XQuery.\n</code></pre>\n\n<p>So, my question is:\nHow can I write code on 2008 (SQL Server Management Studio) that I will be sure that will works fine on 2005?</p>\n\n<p>Ps.: ** Tools > Options > SQL Server Object Explorer > Scripting > Script for server version** does not work.</p>\n\n<p>Tks</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13230441,"title":"Save multiple rows in one table in one connection IN sqlserver","body":"<p>Scenario: Just consider i have a table having 3 column Id, QuestionId and optedAnswer. I have a form which consists n no of question and some options for answer. On save button i want to save data in database(in my table). </p>\n\n<p>Problem: I want to save all the answers in one connection.</p>\n\n<p>Step taken by me: I made a string having  structure questionId:optedAnswwer | questionId : optedAnswer | and so on....\n I wrote a procedure. started a loop. split the data based on ':' and '|' and saved data in one connection. But it is a rigorous  task. Is there any way to save the data directly without using loop and split.</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":11,"score":0,"question_id":13229998,"title":"Trigger database update after control update on subform 1","body":"<p>I have a Cashbook table with these columns: </p>\n\n<p><code>Date</code>, <code>Ref</code>, <code>Acc_Code</code>, <code>Acc_Name</code>, <code>Details</code>, <code>Debit</code>, <code>Credit</code></p>\n\n<p>And an AccountPayable table with these columns: </p>\n\n<p><code>Date</code>, <code>Ref</code>, <code>Acc_Code</code>, <code>Acc_Name</code>, <code>Details</code>, <code>Debit,Credit</code></p>\n\n<p>And as any data entered into the AccountPayable table goes insert the same data into the Cashbook table, but when data is being modified in the AccountPayable, how can the modification reflect in the cashbook using SQL after update trigger to update the cashbook?</p>\n"},{"tags":["sql","sql-server","reporting-services","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":211,"score":2,"question_id":8527249,"title":"Multiple Versions of SQL Reporting Services ReportViewer","body":"<p>I have a simple ASP.NET application that use the SSRS ReportViewer control.  </p>\n\n<p>I was wondering if it is possible to support multiple versions of this control within the application?  </p>\n\n<p>My application is used by users who use a mixed bag of reporting services and the SQL Reporting Services ReportViewer 2010 (version 10.0) is not compatible with SSRS 2005, but the SQL Reporting Services ReportViewer version 9.0 is.  </p>\n\n<p>I would like them to be able to choose which version of reporting services they have and then the application choose the correct control.  </p>\n\n<p>Will having multiple versions of this referenced within the application cause conflicts?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","query-optimization"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":79,"score":-1,"question_id":13227560,"title":"SQL Server 2005 query optimization","body":"<p>My application need to get data from a SQL Server database. My problem is that there is 3 tables that has to be joined into a view. This takes a lot of time (about 30 sec to generate the view) So I was wondering if there is a way to optimize this SQL query?</p>\n\n<p>SQL query: </p>\n\n<pre><code>SELECT TOP (100) PERCENT Request1.RequestID,\n                         TrackIT.dbo.Sending.Barcode,\n                         TrackIT.dbo.Address_View.AdrID,\n                         TrackIT.dbo.Address_View.Name,\n                         TrackIT.dbo.Address_View.Street,\n                         TrackIT.dbo.Address_View.HouseNo,\n                         TrackIT.dbo.Address_View.Postal,\n                         TrackIT.dbo.Address_View.City,\n                         TrackIT.dbo.Address_View.Country,\n                         Request1.Latitude,\n                         Request1.Longitude,\n                         Request1.ReceivedDate\nFROM   (SELECT DISTINCT RequestID,\n                        Ltrim([Content]) AS Barcode,\n                        Latitude,\n                        Longitude,\n                        ReceivedDate\n        FROM   RequestWithLocation\n        WHERE  ( Site LIKE '%Z' )\n               AND ( [Content] &lt;&gt; '' )\n               AND ( AddressID = '0' )\n               AND ReceivedDate &gt; Dateadd(day, -7, Getdate())) AS Request1\n       INNER JOIN TrackIT.dbo.Sending\n         ON Request1.Barcode = TrackIT.dbo.Sending.Barcode\n       INNER JOIN TrackIT.dbo.Address_View\n         ON TrackIT.dbo.Sending.DeliveryAdrID = TrackIT.dbo.Address_View.AdrID\nORDER  BY AdrID \n</code></pre>\n\n<p>Can anyone help ?</p>\n"},{"tags":["javascript","sql","sql-server","asp-classic"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":13176438,"title":"Adding form data to a database ASP and SQL Server","body":"<p>I have been googling the net for hours and i still can't get my head around this!</p>\n\n<p>to start with, i have this code which is the form i have created.</p>\n\n<pre><code>&lt;!-- #include file=\"Header.asp\" --&gt;\n&lt;!-- #include file=\"Tauthenticate.asp\" --&gt;\n&lt;!--#include file=\"database.asp\"--&gt;\n\n&lt;SCRIPT LANGUAGE=\"JavaScript\"&gt;\n\nfunction confirmSubmit()\n{\nvar agree=confirm(\"Confirm?\");\nif (agree)\nreturn true ;\nelse\nreturn false ;\n}\n&lt;/script&gt;\n\n\n    &lt;table border=\"0\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" id=\"table17\"&gt;\n        &lt;tr&gt;\n            &lt;td background=\"../images/bar1.jpg\"&gt;&lt;font size=\"2\"&gt;&amp;nbsp;&lt;b&gt;Add \n            Skill&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;/table&gt;\n            &lt;table border=\"0\" width=\"100%\" id=\"table18\" cellspacing=\"0\" cellpadding=\"0\"&gt;\n                &lt;form method=\"POST\" action=\"SaveNewSkill.asp\"&gt;\n                &lt;tr&gt;\n\n                &lt;/tr&gt;\n\n                &lt;td width=\"108\"&gt;&lt;font face=\"Verdana\" size=\"2\" &gt;Employee &lt;/font&gt; &lt;/td&gt;\n    &lt;td&gt;\n\n\n        &lt;p&gt;&lt;font face=\"Verdana\"&gt;&lt;select size=\"1\" name=\"D1\"&gt;\n        &lt;%\n            sql=\"select User_ID, First_Name, Surname from Company Where Status not like 'left%' and (Company.Office='Manchester' or Company.Office='Romania') order by Surname\"\n            set users=conn.execute(sql)\n            do while not users.eof \n                %&gt;\n                    &lt;option value=\"&lt;%=users(\"User_ID\")%&gt;\"&gt;&lt;%=users(\"First_Name\") &amp; \" \" &amp; users(\"Surname\")%&gt;&lt;/option&gt;\n                &lt;%\n                users.movenext\n                loop\n                set users=nothing\n                %&gt;\n        &lt;/select&gt;&lt;/font&gt;&lt;/p&gt;\n\n    &lt;/td&gt;\n\n\n                &lt;tr&gt;\n                    &lt;td width=\"142\"&gt;&lt;b&gt;&lt;font size=\"2\" face=\"Verdana\"&gt;Skill&lt;/font&gt;&lt;/b&gt;&lt;/td&gt;&lt;td&gt;\n                    &lt;select size=\"1\" name=\"D3\"&gt;\n                    &lt;option value=\"AutoCad 2D\"&gt;AutoCAD 2D&lt;/option&gt;\n                    &lt;option value=\"3D Modeling\"&gt;3D Modeling&lt;/option&gt;\n                    &lt;option value=\"Sketchup\"&gt;Sketchup&lt;/option&gt;\n                    &lt;/select&gt;&lt;/td&gt;\n\n                &lt;/tr&gt;\n\n                &lt;tr&gt;\n                    &lt;td width=\"142\"&gt;&lt;b&gt;&lt;font size=\"2\" face=\"Verdana\"&gt;Current Skill Level&lt;/font&gt;&lt;/b&gt;&lt;/td&gt;&lt;td&gt;\n                    &lt;select size=\"1\" name=\"D4\"&gt;\n                    &lt;option value=\"1\"&gt;1&lt;/option&gt;\n                    &lt;option value=\"2\"&gt;2&lt;/option&gt;\n                    &lt;option value=\"3\"&gt;3&lt;/option&gt;\n                    &lt;option value=\"4\"&gt;4&lt;/option&gt;\n                    &lt;option value=\"5\"&gt;5&lt;/option&gt;\n                    &lt;/select&gt;&lt;/td&gt;\n\n                &lt;/tr&gt;\n\n                    &lt;tr&gt;\n                    &lt;td width=\"142\"&gt;&lt;b&gt;&lt;font size=\"2\" face=\"Verdana\"&gt;Required Skill Level&lt;/font&gt;&lt;/b&gt;&lt;/td&gt;&lt;td&gt;\n                    &lt;select size=\"1\" name=\"D4\"&gt;\n                    &lt;option value=\"1\"&gt;1&lt;/option&gt;\n                    &lt;option value=\"2\"&gt;2&lt;/option&gt;\n                    &lt;option value=\"3\"&gt;3&lt;/option&gt;\n                    &lt;option value=\"4\"&gt;4&lt;/option&gt;\n                    &lt;option value=\"5\"&gt;5&lt;/option&gt;\n                    &lt;/select&gt;&lt;/td&gt;\n\n                &lt;/tr&gt;\n\n                &lt;/form&gt;\n                &lt;/table&gt;\n    &lt;form&gt;&lt;p&gt;&lt;font size=\"2\"&gt;&lt;input type=\"submit\" value=\"Save\" name=\"B1\" onclick=\"return confirmSubmit()\"&gt;&lt;/font&gt;&lt;/form&gt;\n    &lt;td width=\"75\"&gt;\n            &lt;!-- #include file=\"footer.asp\" --&gt;\n</code></pre>\n\n<p>the files that are included are for the header, connection to the database and authentication to view the page in the first place (which all works).</p>\n\n<p>the form queries the database for our list of users then allows the user to select a skill from a list and define their current level of expertise.</p>\n\n<p>i have then created this \"save skill\" asp page.</p>\n\n<pre><code>&lt;!--#include file=\"database.asp\"--&gt;\n&lt;!--#include File=\"TUauthenticate.asp\"--&gt;\n\n\n&lt;%\n\n\nUser_ID=request.querystring(\"User_ID\")\nsql=\"select * from company where User_ID=\" &amp; User_ID\nset rs=conn.execute(sql)\nSession(\"User_ID\")=User_ID\n\n\nSkill=request.form(\"D3\")\nCurrent_Level=Request.form(\"D4\")\nUser_ID=request.form(\"D1\")\nRequired_Level=request.form(\"D5\")\n\nif request.form(\"B1\")&lt;&gt;\"\" then\nif skill = \"AutoCAD 2D\" then\nsqlq=\"insert into skills (User_ID, AutoCad_2D, AutoCad_2DR) Values (\" &amp; User_ID &amp; \",'\" &amp;    Current_Level &amp; \"','\" &amp; Required_Level &amp; \"')\"\nresponse.write(sqlq)\nset rs=conn.execute(sqlq)\nend if\nend if\n\n%&gt;\n</code></pre>\n\n<p>i have put this together using various pieces of working code but it will not save to the database... i understand its not very neat but i will sort that once i know whats wrong with it.</p>\n\n<p>i know i've included a little bit of javascript but i'd prefare if answers were in asp code (as im currently trying to study asp) </p>\n\n<p>Thanks in advance guys! :D</p>\n"},{"tags":["sql","sql-server","stored-procedures","openquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13230430,"title":"Insert Into a Table Across Linked Server From SP Using Openquery","body":"<p>I want to send data across from one server to another, I wish to improve my performance and wondered if OpenQuery is a good route to go down?</p>\n\n<p>I tried to do something like this;</p>\n\n<pre><code>INSERT INTO OPENQUERY (SERVERNAME, '(SELECT Num1, Num2, Num3 FROM [DBName].[dbo].TableName)')\n(Num1, Num2, Num3)\nSELECT Num1, Num2, Num3\n FROM #Temp\n</code></pre>\n\n<p>However this returns the error</p>\n\n<pre><code>The provider indicates that conflicts occurred with other properties or requirements.\n</code></pre>\n\n<p>I don't understand this as the query does run fine and produce the required results without OpenQuery...</p>\n\n<p>Could any of you advise me on this please?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":94,"score":6,"question_id":13229946,"title":"Difference between Tables and Temp Tables","body":"<p>why this code work without problem :</p>\n\n<pre><code>drop table t1 \nselect * into t1 from  master..spt_values\ndrop table t1 \nselect * into t1 from  master..spt_values\n</code></pre>\n\n<p>Output </p>\n\n<pre><code>Msg 3701, Level 11, State 5, Line 1\nCannot drop the table 't1', because it does not exist or you do not have permission.\n\n(2508 row(s) affected)\n\n(2508 row(s) affected)\n</code></pre>\n\n<p>but this code does not :</p>\n\n<pre><code>drop table #t1 \nselect * into #t1 from  master..spt_values\ndrop table #t1 \nselect * into #t1 from  master..spt_values\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>Msg 2714, Level 16, State 1, Line 4\nThere is already an object named '#t1' in the database.\n</code></pre>\n\n<p>what is the difference between Tables and Temp Tables in this code ?</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":61,"score":-1,"question_id":13228706,"title":"Update data from database on click of button","body":"<p>I have a kendo dropdown and on selected id value i want to update data of particular row from database on button click event.but my dat is not updating and the old values are shown again and again.Please suggest me how to do it.\nMy code is</p>\n\n<pre><code>&lt;script src=\"Js/jquery1.7.1.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n&lt;script src=\"CSS/kendo.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;script type=\"text/javascript\"&gt;\n  $(document).ready(function(){\n    $(\"#multi\").kendoDropDownList();\n    $(\"#editor\").kendoEditor();\n });\n&lt;/script&gt;\n&lt;form id=\"form1\" runat=\"server\"&gt;\n&lt;div&gt;\n   Select Template: &lt;select id=\"multi\" runat=\"server\"&gt;&lt;/select&gt;\n&lt;/div&gt;\n&lt;br /&gt;\n&lt;div&gt;\n  Template Name: &lt;input type=\"text\" id=\"txtName\" name=\"Name\" runat=\"server\" /&gt;\n&lt;/div&gt;\n&lt;div&gt;\nDescription:&lt;textarea name=\"comments\" id=\"txtComment\" cols=\"25\" rows=\"5\"   \nrunat=\"server\"&gt;&lt;/textarea&gt;\n&lt;br /&gt;\n&lt;/div&gt;\n&lt;div&gt;\nActive: &lt;input type=\"checkbox\" id=\"chkActive\" name=\"vehicle\" runat=\"server\" /&gt;\n&lt;/div&gt;\n&lt;div id=\"example\" class=\"k-content\"&gt;\n&lt;textarea id=\"editor\" rows=\"10\" cols=\"30\" style=\"width:740px;height:440px\"   \nrunat=\"server\"&gt;&lt;/textarea&gt;\n&lt;/div&gt;\n&lt;div&gt;\n\n&lt;button type=\"button\" id=\"btnUpdate\" runat=\"server\"   onserverclick=\"    \nbtnUpdate_onclick\" &gt;Save&lt;/button&gt;\n\n&lt;/div&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n</code></pre>\n\n<p>My .cs code is</p>\n\n<pre><code> protected void Page_Load(object sender, EventArgs e)\n{\n\n\n    Bind();\n}\n\nprivate void Bind()\n{\n    SqlConnection con = new SqlConnection(\"Data Source=ST0022;Initial \nCatalog=QuickMove_Globe;User ID=sa;Password=good\");\n    SqlDataAdapter da = new SqlDataAdapter();\n    DataSet ds = new DataSet();\n    da.SelectCommand = new SqlCommand(\"Select * from Templates\", con);\n    con.Open();\n    da.SelectCommand.ExecuteNonQuery();\n    da.Fill(ds);\n    con.Close();\n    multi.DataTextField = \"ID\";\n    multi.DataValueField = \"Name\";\n    multi.DataValueField = \"Description\";\n\n    multi.DataSource = ds.Tables[0];\n    multi.DataBind();\n}\n\nprotected void btnUpdate_onclick(object sender, EventArgs e)\n{\n\n\n\n    SqlConnection con = new SqlConnection(@\"Data Source=ST0022;Initial \nCatalog=QuickMove_Globe;Persist Security Info=True;User ID=sa;Password=good\");\n    SqlCommand cmd= new SqlCommand(\"Update_Temp\", con);\n\n    cmd.CommandType = CommandType.StoredProcedure;\n    //passing parameters\n    cmd.Parameters.AddWithValue(\"@ID\", Convert.ToInt32(multi.SelectedIndex));\n    cmd.Parameters.AddWithValue(\"@Name\",Convert.ToString(txtName.Value));\n    cmd.Parameters.AddWithValue(\"@Description\", Convert.ToString(txtComment.Value));\n    cmd.Parameters.AddWithValue(\"@Content\", Convert.ToString(editor.Value));\n    cmd.Parameters.AddWithValue(\"@Active\", (chkActive.Value).ToString());\n\n    SqlDataAdapter da = new SqlDataAdapter();\n\n    da.UpdateCommand=cmd;\n    con.Open();\n\n\n\n\n\n\n    cmd.ExecuteNonQuery();\n    con.Close();\n\n}\n</code></pre>\n"},{"tags":[".net","sql-server","logging","microsoft","sqlclr"],"answer_count":5,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":1396,"score":8,"question_id":7034969,"title":"SQL Server stops loading assembly","body":"<p>We have developed an assembly for the SQL Server 2008 R2.</p>\n\n<p>The assembly has been working for a week.  The managed stored proc inside the assembly was working fine for the whole week and then it stops working.  We have been seeing this problem couple times.  The way to make it work again is to restart the SQL Server.</p>\n\n<pre><code>Msg 10314, Level 16, State 11, Line 4\nAn error occurred in the Microsoft .NET Framework while trying to load assembly id 65536. The server may be running out of resources, or the assembly may not be trusted with PERMISSION_SET = EXTERNAL_ACCESS or UNSAFE. Run the query again, or check documentation to see how to solve the assembly trust issues. For more information about this error: \n  System.IO.FileLoadException: Could not load file or assembly 'myAssembly, Version=2.0.0.490, Culture=neutral, PublicKeyToken=5963130873dd3a75' or one of its dependencies. Exception from HRESULT: 0x80FC0E21 System.IO.FileLoadException:\n  at System.Reflection.Assembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, Assembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection)\n  at System.Reflection.Assembly.InternalLoad(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)\n  at System.Reflection.Assembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)\n  at System.Reflection.Assembly.Load(String assemblyString)\n</code></pre>\n\n<p>I have found different articles on the web.  </p>\n\n<p><a href=\"http://support.microsoft.com/kb/918040\">This KB</a> suggested that I might have restored the database from another SQL Server, which I swear I didn't.  </p>\n\n<p><a href=\"http://www.sqlskills.com/BLOGS/BOBB/category/SQLCLR.aspx\">This blog</a> said I might run into this if I installed .NET 3.5 on SQL Server 2005 but mine was SQL Server 2008 R2 and I did not install anything when this problem occurs.</p>\n\n<p>The main point is that it can keep going for a period of time.  It just stops working randomly.  Then, if we restart the SQL Server, it will start working again.  I have thought of my server was really running out of memory but now, I just see the problem again.  SQL Server is using 300MB RAM only and my server has 16GB RAM.  This sounds impossible that it's because I am running out of memory.</p>\n\n<p>Now, I want to collect more information on this problem.  Any log that I can turn on and look at?  Any suggestion that help troubleshooting this problem is welcome.</p>\n\n<p>I have run some SQL queries.</p>\n\n<pre><code>SELECT * from sys.dm_clr_properties\n=============================================\ndirectory   C:\\Windows\\Microsoft.NET\\Framework64\\v2.0.50727\\\nversion v2.0.50727\nstate   CLR is initialized\n</code></pre>\n\n<p>.</p>\n\n<pre><code>SELECT * from sys.dm_clr_appdomains\n======================================================\n0x0000000087160240  3   mydatabase.dbo[runtime].2   2011-08-12 08:44:08.940 10  1   E_APPDOMAIN_SHARED  1   1\n</code></pre>\n\n<p>.</p>\n\n<pre><code>SELECT * from sys.dm_clr_tasks\n======================================================\n0x000000008185A080  0x00000000818562C8  0x0000000000000000  E_TASK_ATTACHED_TO_CLR  E_ABORT_NONE    E_TYPE_ADUNLOAD 0   0\n0x00000000818CE080  0x00000000818CA2C8  0x0000000000000000  E_TASK_ATTACHED_TO_CLR  E_ABORT_NONE    E_TYPE_FINALIZER    0   0\n0x0000000081AD4C30  0x000000000400D048  0x0000000000000000  E_TASK_ATTACHED_TO_CLR  E_ABORT_NONE    E_TYPE_USER 0   0\n</code></pre>\n\n<p>.</p>\n\n<pre><code>SELECT * from sys.dm_clr_loaded_assemblies\n&lt;returns nothing&gt;\n</code></pre>\n\n<p><strong>* UPDATE *</strong></p>\n\n<p>On my SQL Server, I have created four databases.  Each of them with the same assembly attached to it.  Now, SQL Server refused to load the assembly and gave me the above error.</p>\n\n<p><code>SELECT * from sys.dm_clr_appdomains</code> shows me at that point there was only one appdomain loaded and <code>SELECT * from sys.dm_clr_loaded_assemblies</code> showed me there were no assemblies loaded at all.</p>\n\n<p>Then, I ran the same stored proc on the other three databases.  It worked and successfully loaded up the assemblies and successfully ran the stored proc.  After executing the stored proc.  <code>SELECT * from sys.dm_clr_appdomains</code> now shows me there are only four appdomain loaded and <code>SELECT * from sys.dm_clr_loaded_assemblies</code> showed me there are now three assemblies loaded.</p>\n\n<p>This makes sense.  Now, I hope if I run the stored proc again in the original database, it should get the assembly loaded as it were.  Guess what.  No, it doesn't.  It still gives me the same error.  It looks like this database is completely stuck.  The only way to fix it is to reboot the SQL Server.  I am hoping there is a flag/lock somewhere in the system table holding up this.  I cannot find it.  Any idea is welcome.</p>\n\n<p>Now, my SQL Server is in the state that requiring me to reboot to make it work again.  </p>\n\n<p><strong>* UPDATE (8/31/2011) *</strong></p>\n\n<p>It sounds like it's related to the database owner of the database.  This is kind of complicated.  We have two sites and two AD forests.  The SQL Server machine is joined to forest A but the database owner is from forest B.  The connection between forest A and forest B is not that stable since they are in two different sites physically connected by WAN.</p>\n\n<p>Once I change the database owner to a SQL Login (Non-Windows account), my stored proc is up running for couple weeks so far with no interruption.</p>\n\n<p>I will accept the answer if anybody can explain it.</p>\n"},{"tags":["c#","sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13229461,"title":"C# change date between different formats","body":"<p>I want to know if there's a way to change the date format depending on the users local date format setting. The date I will store in the DB it's <code>YYYY-MM-DD</code> but the users have different formats, like <code>DD-MM-YYYY</code> or <code>DD.MM.YYYY</code>. What is a clean, elegant way to ensure that my application always retrives the date in local date format, and SQL server always receives the date in <code>YYYY-MM-DD</code> to be stored.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":13745,"score":6,"question_id":1586560,"title":"How do I escape a single quote in sqlserver?","body":"<p>I'm trying to insert some text data into a table in SQLServer 9.\nThe text includes a single quote.\nHow do I escape that?\nI tried using two single quotes, but it threw me some errors.\neg. insert into my_table values('hi, my name''s tim.');</p>\n"},{"tags":["c#",".net","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1572,"score":1,"question_id":5899358,"title":"Addslashes / escape single quote in .NET","body":"<p>I'm maintaining a piece of code that concatenates SQL queries like:</p>\n\n<pre><code>string sql = \"SELECT* FROM table WHERE column = '\" + value + \"'\";\n</code></pre>\n\n<p>Now it turned out that if <strong>value</strong> contains <strong>'</strong> characted it will break SQL Server text statement. I searched a bit for method similar to PHP addslashes, but without success. There's <strong>Regex.Escape</strong> but it didn't do the trick. Is there any other way to address that issue except calling <strong>Replace</strong> method on string?:</p>\n\n<pre><code>string sql = \"SELECT* FROM table WHERE column = '\" + value.Replace(\"'\", \"''\") + \"'\";\n</code></pre>\n\n<p>Thanks,\nPawe</p>\n"},{"tags":["sql-server","quotes"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":467,"score":0,"question_id":4386400,"title":"Single quotes problem in SQL Server 2008","body":"<p>How this below insert query can be modified or escape single quote in SQL Server:</p>\n\n<pre><code>INSERT INTO &lt;tblname&gt; (title,desc)\nVALUES\n('Hen's Body','It's just best combination')\n</code></pre>\n\n<p>This query not run in SQL Server. I need similer solution to MySQL (like using backslash)as it is</p>\n\n<pre><code>INSERT INTO &lt;tblname&gt; (title,desc)\nVALUES('Hen\\'s Body','It\\'s just best combination')\n</code></pre>\n\n<p>Regards</p>\n"},{"tags":["c#","sql-server","fluent-nhibernate","collation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13229374,"title":"Fluent Nhibernate, adding collation as part of convention","body":"<p>Is it possible to control the collation generated by Nhibernate for all the columns of type nvarchar? Depending on the culture where the software is installed, it might be nice to control it from the installer which would read this option from configuration file.</p>\n\n<p>I've found just ways of adding collation to concrete query results</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13229241,"title":"How to create procedure with the same WHERE column","body":"<p>How can I create one procedure and the <code>WHERE</code> column is the same?</p>\n\n<p>The <code>WHERE</code> column is <code>QuotationNo</code></p>\n\n<p>This is the procedure signature:</p>\n\n<pre><code>create procedure (QUO1 int, QUO2 int, QUO3 int, QUO4 int)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Quote     price     quantity\n---------------------------------\n1234       2000        1000\n5678       2500        4000\n9012        3000        4500 \n3456        1000        1000\n</code></pre>\n\n<p>Thanks,</p>\n\n<p>Captain16</p>\n"},{"tags":["c#","sql-server","sql-server-2008-r2","database-connection","connection-string"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":212,"score":2,"question_id":11289696,"title":"Specifying Port With SqlConnectionStringBuilder?","body":"<p>I've ran into a snag. I have a need to specify the port number for my local installation of SQL Server 2008 R2. So far I've tried using the SqlConnectionStringBuilder with the data source set as <code>.\\TESTSERVER, 1433</code>, which by all the documentation should connect me to the server TESTSERVER on port 1433 (the default). </p>\n\n<p>The connection string looks like:</p>\n\n<p><code>{Data Source=\".\\TESTSERVER, 1433\";Initial Catalog=AdventureWorks;User ID=testuser;Password=MYPASSWORDHERE}</code></p>\n\n<p>However I get an error that looks like:</p>\n\n<blockquote>\n  <p>A network related or instance-specific error has occurred while establishing a connection SQL server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL server is configured to allow remote connections. (Provider: TCP provider, error:0 - no connection could be made because the target machine actively refused it. </p>\n</blockquote>\n\n<p>Upon verifying the connection string using <code>SqlConnectionStringBuilder.ToString()</code> it comes out almost how <a href=\"http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.connectionstring.aspx\" rel=\"nofollow\">MSDN</a> suggests. For some reason it wraps double quotes ONLY around the data source and nothing else. However this may just be the debugger removing the outside quotes since it's stored in a <code>string</code> datatype. I also verified that SQL server is accessible without specifying the port and it is. Finally, I verified that the server is allowed to accept remote connections. Considering this instance of SQL Server is installed locally, using the default port, and on my development computer I couldn't imagine why I would be getting an error like this.</p>\n\n<p>Is this because the SqlConnectionStringBuilder is overriding my port with it's own port? Do I need to for some reason open up ports on my firewall? Knowing it's a fully local installation it shouldn't be encountering firewall problems. I'd rather not have to manually build the connection string. Not that it's difficult, it just adds a layer of complexity to my code I'd rather not have unless needed.</p>\n\n<p>Any help would be appreciated. Thanks!</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>After a long hard digging through the SqlConnectionStringBuilder syntax it appears that it handles invalid parameters by passing then to the connection string surrounded in quotes. I'd imagine this is because it breaks the connectionstring. My question still remains: <strong>is there a way to pass port via SqlConnectionStringBuilder or will I have to build it myself?</strong></p>\n"},{"tags":["sql-server","winforms","connection-string"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":345,"score":1,"question_id":7006098,"title":"ConnectionString for connecting to SQL Server Database?","body":"<p>I have an application (WinForms) which using SQL Server as its database.</p>\n\n<p>Now I am using <code>app.config</code> file to access <code>ConnectionString</code>.</p>\n\n<p>Have a look at my <code>app.config</code> file</p>\n\n<pre><code>&lt;configuration&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"dbConnectionString\" \n         connectionString=\"Data Source=abc-79f1f531c9f;Initial Catalog=ItemStockInParth;Integrated Security=True;Pooling=False\"\n         providerName=\"System.Data.SqlClient\"/&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>You can see that <code>Data Source=abc-79f1f531c9f</code>.</p>\n\n<p>Here ==> <code>abc-79f1f531c9f</code> is server name which is running on my (Developer's) PC.</p>\n\n<p>Now when application is being installed at client's site, the server name should be changed to the server name which is running on the client machine or server name which will client machine use.</p>\n\n<p>Then what should be the best criteria for handling this situation?</p>\n\n<p>Means I have to create one new form which asking user to enter their <code>Server Name</code> and as per that I creating our ConnectionString?</p>\n\n<p>Or dynamically getting the <code>servername</code>?</p>\n\n<p>Or just hard-code the <code>Server Name</code> of client machine (or server name which will client machine use) inside our <code>App.config</code> file?</p>\n\n<p>please help..... </p>\n"},{"tags":["javascript","sql-server","database","connection"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9810,"score":0,"question_id":5622242,"title":"Using Javascript to connect SQL Server database","body":"<p>I need to use Javascript to read some data from SQl Server 2008 Database.\nSo I wrote this:(html page code)</p>\n\n<pre><code>&lt;!DOCTYPE html \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"&gt;\n&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\"/&gt;\n&lt;title&gt;Database Connect&lt;/title&gt;\n&lt;script type=\"text/javascript\"&gt;\nfunction loadDB(){\nvar connection = new ActiveXObject(\"ADODB.Connection\");\n\nvar connectionstring=\"Data Source=-;Initial Catalog=C:\\Program Files\\Microsoft SQL Server\\MSSQL10.MSSQLSERVER\\MSSQL\\DATA\\SIGMA_Database.mdf;User ID=;Password=\"\";Provider=SQLOLEDB\";\n\nconnection.open(connectionstring);\nvar rs = new ActiveXObject(\"ADODB.Recordset\");\n\nrs.Open(\"SELECT Username FROM Users\", connection);\nrs.MoveFirst();\nwhile(!rs.eof)\n{\n   document.write(rs.fields(1));\n   rs.MoveNext();\n}\n\nrs.close();\nconnection.close();\n\n}\n&lt;/script&gt;\n&lt;/head&gt;\n&lt;body onload=\"loadDB()\"&gt;\n&lt;div id=\"main\"&gt;&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>However, nothing happens!\nWhat is wrong with it?There're some cyrillic alphabet symbols in connection string, can it be a source of problem?Or another thing is going wrong?</p>\n"},{"tags":["sql-server","sql-server-ce","replication","merge-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13223063,"title":"SQL replication to SQL Compact 3.5 via FTP?","body":"<p>I'm trying replicate a SQL Server database to a device with SQL Compact 3.5 on it and I can get replication working fine via IIS. However, the publication has an option to use FTP to publish the replication data, but I don't seem to be able to configure SQL Compact to connect to the FTP site. There's nothing online that says I can't do that, but I also can't find a walk-through showing that I can.</p>\n\n<p>Does anybody know if I can connect a SQL Compact database to a publisher via FTP rather than IIS Web?</p>\n"},{"tags":["c#","sql-server","database","sql-server-2008","database-administration"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13227146,"title":"Want an idea in writing a code section","body":"<p>Scenario :\nI am creating a admin tool in C# which will restore a full sql server backup in a server and apply the transaction logs. After db come up. I have run a few scripts shown below. </p>\n\n<pre><code>use master\nEXEC sp_addlogin '&lt;destsid&gt;', '&lt;sidadmpass&gt;','&lt;dbname&gt;'\nuse &lt;dbname&gt;\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nEXEC sp_change_users_login 'Update_One','&lt;destsid&gt;','&lt;destsid&gt;'\nuse master\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse msdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC     sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse model\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse tempdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse master\ngrant all on xp_cmdshell to &lt;destsid&gt;\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'serveradmin'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'dbcreator'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'bulkadmin'\nuse &lt;dbname&gt;\nif object_id('sp_change_sapuser') is not null\n    drop procedure sp_change_sapuser \ncreate procedure sp_change_sapuser @oldid sysname, @newid sysname\nas begin\ndeclare @oldid_uid  smallint\ndeclare @newid_uid  smallint    \ndeclare @object     sysname\ndeclare @object_full    nvarchar(999)\nset @oldid_uid = user_id(@oldid)\nset @newid_uid = user_id(@newid)\nif @oldid_uid is not null and @newid_uid is not null\nbegin\ndeclare object_cursor cursor local for \nselect name from sysobjects where((xtype='U' and name &lt;&gt; 'dtproperties') or (xtype='V' and name not in ('syssegments','sysconstraints')) or (xtype='P' and name not like 'dt_%') or (xtype='D' and name not like 'DF__dtpropert%') or (xtype in ('FN','TF','IF'))) and @oldid_uid = uid\nopen object_cursor\nfetch next from object_cursor into @object\nwhile @@fetch_status=0\nbegin\nset @object_full = user_name(@oldid_uid) + '.' + @object\nexec sp_changeobjectowner @object_full, @newid\nfetch next from object_cursor into @object\nend\nend\nelse\nif @oldid_uid is null\nbegin\nprint '*** old database user does not exist ***'\nend\nif @newid_uid is null\nbegin\nprint '*** new database user does not exist ***'\nend\nend\nexec sp_change_sapuser '&lt;sourcesid&gt;', '&lt;destsid&gt;'\nuse master\nEXEC sp_grantlogin   'AMR\\&lt;destsid&gt;adm'\nEXEC sp_grantlogin   'AMR\\SAPService&lt;dbname&gt;'\nEXEC sp_defaultdb    'AMR\\&lt;destsid&gt;adm','&lt;dbname&gt;'\nEXEC sp_defaultdb    'AMR\\SAPService&lt;dbname&gt;','&lt;dbname&gt;'\nEXEC sp_addsrvrolemember 'AMR\\&lt;destsid&gt;adm',     'sysadmin'\nEXEC sp_addsrvrolemember 'AMR\\SAPService&lt;dbname&gt;', 'sysadmin'\nEXEC xp_sqlagent_proxy_account 'SET', '&lt;servername&gt;', 'SAPMssXPUser',N'&lt;sidadmpass&gt;'\nuse master\nEXEC sp_addlogin '&lt;destsid&gt;', '&lt;sidadmpass&gt;', &lt;dbname&gt;\nuse &lt;dbname&gt;\nEXEC sp_change_users_login 'Update_One','&lt;destsid&gt;','&lt;destsid&gt;'\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse master\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse msdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse model\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse tempdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse master\ngrant all on xp_cmdshell to &lt;destsid&gt;\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'serveradmin'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'dbcreator'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'bulkadmin'\n--EXEC xp_sqlagent_proxy_account 'SET', '&lt;servername&gt;', 'SAPMssXPUser', N'&lt;sidadmpass&gt;'\nEXEC sp_grantlogin   '&lt;destsid&gt;adm'\nEXEC sp_grantlogin   'SAPService&lt;dbname&gt;'\nEXEC sp_defaultdb    '&lt;destsid&gt;adm','&lt;dbname&gt;'\nEXEC sp_defaultdb    'SAPService&lt;dbname&gt;','&lt;dbname&gt;'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;adm',     'sysadmin'\nEXEC sp_addsrvrolemember 'SAPService&lt;dbname&gt;', 'sysadmin'\n</code></pre>\n\n<p>Note : values given  will be replaced with actual values.</p>\n\n<p>While running these scripts few may throw exceptions. But i want to continue even though some scripts throws error. And also i have removed GO(batch terminator) because i cannot add separate dll into server. Please suggest some idea to get this problem solved. </p>\n\n<p>Details :\nProgramming lang : C#\nDb - Sql Server 2005,08</p>\n"},{"tags":["sql","sql-server","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":13226351,"title":"How to retrieve the column value based on formula","body":"<p>Using a view in SQL Server 2000</p>\n\n<p><code>Table1</code>:</p>\n\n<pre><code>id  z1      z2      z3      z4   type\n--------------------------------------\n01A 300     400     300     400  01\n2B  300     400     300     400  02\n3C  500     300     400     300  01\n04A 500     400     500     400  01\n05B 400     300     400     300  02\n06  150     200     200     150  03\n....\n</code></pre>\n\n<p><code>Table2</code>:</p>\n\n<pre><code>type  Formula1           Formula2\n------------------------------------    \n01    ((Z1+Z2)/1000)*2   null\n02    null               ((Z3+Z4)/1000)*2\n03    ((Z1+Z2)/1000)*2   ((Z3+Z4)/1000)*2\n</code></pre>\n\n<p>I want to select the <code>table1</code> rows based on <code>table2</code> formula:</p>\n\n<ul>\n<li>in table2 type - 01 (z1 and z2 found) then i want to consider table1 z1 z2 columns</li>\n<li>in table2 type - 02 (z3 and z4 found) then i want to consider table1 z3 z4 columns</li>\n<li>in table2 type - 03 (z1, z2, z3 and z4 found) then i want to consider table1 z1, z2, z3 z4 columns</li>\n</ul>\n\n<p>Expected output</p>\n\n<p><code>Table1</code>:</p>\n\n<pre><code>id   z1     z2     z3     z4    type\n-------------------------------------    \n01A  300    400    null   null  01\n2B   null   null   300    400   02\n3C   500    300    null   null  01\n04A  500    400    null   null  01\n05B  null   null   400    300   02\n06   150    200    200    150   03\n</code></pre>\n\n<p>Currently I'm using a view, I don't want to change to stored procedure because most of the report are using this view.  </p>\n\n<p>How to do it in sql..?</p>\n"},{"tags":["sql","sql-server","sql-server-2000"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":13209331,"title":"How to split the row value","body":"<p>table1</p>\n\n<pre><code>value\n\n100 x 200 x 300 x 400  `I want to split this row bcoz more than 2 values`\n100 x 200\n1300 x 1400\n200 x 300 x 1200 x 2200  `I want to split this row bcoz more than 2 values`\n....\n</code></pre>\n\n<p>Value column is not fixed length, it may also contain <code>10 x 200 x 3000 x 5</code></p>\n\n<p>I want to take the first 2 values then the next 2 values will go to the next row after <code>x</code></p>\n\n<p>I want to split the rows like this:</p>\n\n<p>Expected Output</p>\n\n<pre><code>100 x 200 \n300 x 400\n100 x 200\n1300 x 1400\n200 x 300 \n1200 x 2200\n....\n</code></pre>\n\n<p><strong>Hint:</strong></p>\n\n<p>We can split the value for each x then we can join 2 values </p>\n\n<p>for example <code>20 x 10 x 5 x 1</code></p>\n\n<p>Split like this <code>20, 10 5, 1</code> then join <code>20 x 10, 5 x 1</code> </p>\n\n<p>The above method will work out, if it work out means then can i get some query for splitting and joining the rows..</p>\n\n<p>How can I do this in SQL?</p>\n\n<p>Need SQL Query Help</p>\n"},{"tags":["c#","sql-server","ado.net","views","sqlconnection"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13216564,"title":"Use SqlConnection.GetSchema to get Tables Only (No Views)","body":"<p>When I use </p>\n\n<pre><code>SqlConnection.GetSchema(\"Tables\");\n</code></pre>\n\n<p>it returns all the tables AND views for the target database.</p>\n\n<p>Is there any way to just return tables? All the research I have done indicates I am doing this correctly yet it always returns the views like they are tables. I have dug down into the DataTable in debug and I can't even find a difference. The data types are reported the same... As far as I can tell, it can't differentiate between a view and a table. (It does make sense in a way since a view for all intents and purposes IS a table.)</p>\n\n<p>I am using the Northwind database for testing.</p>\n\n<p>I am writing the application in C#.</p>\n\n<p>Here is the code that I am running to get the schema info. Pretty simple.</p>\n\n<pre><code>SQLCon.Open();\nDataTable tables = SQLCon.GetSchema(\"Tables\");\nSQLCon.Close();\n</code></pre>\n\n<p>I would very much like to use the getschema method and not have to query the database in another fashion... if at all possible.</p>\n"},{"tags":["sql-server","paging"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":39,"score":0,"question_id":13226758,"title":"How to use ROW_NUMBER() for paging data in procedure","body":"<p>i'm starter in sql server, i write this Query</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[SPSelectReport3] (@StringWhereParameter nvarchar(4000)=null)\nAS\nBEGIN\n\n    SET NOCOUNT ON;\n\n--  Begin Of Transaction\nbegin tran\n\ndeclare @Query nvarchar(max)\nset @Query='\n((SELECT Id,[Mesc]\n      ,[Line]\n      ,[Unit]\n      ,[Discription]\n      ,[InvQty]\n      ,[LastDateNil]\n      ,[ST_CODE]\n      ,[PlanCode]\n      ,[Min]\n      ,[Max]\n      ,[PbsNo]\n      ,[PbsDate]\n      ,[PbsQty]\n      ,[PbsQtyRec]\n      ,[DateDelay]\n      ,[PartNo]\n      ,[TranQty]\n      ,[TypeRequest]\n      ,[HeaderId]\n  FROM [MyMaterialDB].[dbo].[Report3]\n  WHERE headerid IN(SELECT HeaderId FROM [MyMaterialDB].[dbo].[Report3] WHERE line=''H'''+ @StringWhereParameter+'))\n  UNION\n  (\n    (SELECT Id,[Mesc]\n      ,[Line]\n      ,[Unit]\n      ,[Discription]\n      ,[InvQty]\n      ,[LastDateNil]\n      ,[ST_CODE]\n      ,[PlanCode]\n      ,[Min]\n      ,[Max]\n      ,[PbsNo]\n      ,[PbsDate]\n      ,[PbsQty]\n      ,[PbsQtyRec]\n      ,[DateDelay]\n      ,[PartNo]\n      ,[TranQty]\n      ,[TypeRequest]\n      ,[HeaderId]\n  FROM [MyMaterialDB].[dbo].[Report3]\n  WHERE mesc IN(SELECT mesc FROM [MyMaterialDB].[dbo].[Report3] WHERE line=''I''' +@StringWhereParameter+'))\n  UNION\n  (SELECT Id,[Mesc]\n      ,[Line]\n      ,[Unit]\n      ,[Discription]\n      ,[InvQty]\n      ,[LastDateNil]\n      ,[ST_CODE]\n      ,[PlanCode]\n      ,[Min]\n      ,[Max]\n      ,[PbsNo]\n      ,[PbsDate]\n      ,[PbsQty]\n      ,[PbsQtyRec]\n      ,[DateDelay]\n      ,[PartNo]\n      ,[TranQty]\n      ,[TypeRequest]\n      ,[HeaderId]\n  FROM [MyMaterialDB].[dbo].[Report3]\n  WHERE mesc IN(SELECT HeaderId FROM [MyMaterialDB].[dbo].[Report3] WHERE line=''I'''+@StringWhereParameter+')\n  )))\n  Order by Mesc,Line,unit'\n\n\n  exec(@Query)\n\n\n if @@error = 0    \n Commit Tran    \n Else   \n rollback tran\nEnd\n</code></pre>\n\n<p>i write this string Query and Get Where parametrs and concat Query and where after that run Query. i want paging result data but i dont know how to do paging.<br> please help me. thanks all.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":13227030,"title":"Finding first matched string in a column in SQL Server","body":"<p>I have a table as follows:</p>\n\n<pre><code>TABLE1\n\nNo  Description\n1   Hello Hai Hello\n2   Good Bad Good\n3   Hello Good Hai\n4   Hai Hello Bad\n5   Hello Hello Hello\n</code></pre>\n\n<p>Now if I run the following query:</p>\n\n<pre><code>Select * \nfrom TABLE1 \nwhere Description like '%Hai%' \n   OR  Description like '%Hello%' \n   OR Description like '%Good%'\n</code></pre>\n\n<p>I want the result as follows ( By adding one extra column \"FIRST MATCHED WORD\"):</p>\n\n<pre><code>No  Description     First Matched Word\n1   Hello Hai Hello     Hai\n2   Good Bad Good       Good\n3   Hello Good Hai      Hai\n4   Hai Hello Bad       Hai\n5   Hello Hello Hello   Hello\n</code></pre>\n\n<p>Hear my intention is to find out the first matched word depends on our query. Kindly help me.</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":30,"score":-2,"question_id":13227338,"title":"need solve using ASP.net for following scenario","body":"<p>having problem for making arithmetic operation using Bengali font in asp.net?</p>\n"},{"tags":["sql","sql-server"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":13226399,"title":"How can I write a query that returns \"between\" to return alphabetic data, not just numeric?","body":"<p>I have a <code>Daily_account</code> table:</p>\n\n<pre><code>customer_id    account_id            current_balance\n\n1                 D1                       200\n2                 d2                       300\n3                 d10                      400\n4                 d100                     500\n5                 d101                     600\n</code></pre>\n\n<p>Now I have a query: </p>\n\n<pre><code>select customer_id,account_id,current_balance\nfrom daily_account\nwhere account_id between 'D1' and'D100'\n</code></pre>\n\n<p>It is giving me output of account no of D1,D10,D100, but I want to get output of every no.\nHow to get output of every account which comes between D1 and d100?  </p>\n"},{"tags":["asp.net","sql-server","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":13223599,"title":"Insert multiple rows into SQL Server based on start and end dates","body":"<p>I need to insert several rows into a SQL Server database based on <code>Start Date</code> and <code>End Date</code> textboxes. </p>\n\n<p>E.G. <code>tbStartDate.Text = \"25/12/2012\"</code> and <code>tbEndDate.Text = \"29/12/2012\"</code> therefore I need to insert individual rows for the following dates:</p>\n\n<pre><code>25/12/2012\n26/12/2012\n27/12/2012\n28/12/2012\n29/12/2012\n</code></pre>\n\n<p>Please can you help me with the necessary T-SQL to achieve this?</p>\n"},{"tags":["sql-server","performance","stored-procedures","database-connection",".net-4.5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13224186,"title":"1 stored procedure returning 2 recordsets or 2 database calls","body":"<p>I am writing an ASP.NET 4.5 application that communicates with a SQL Server database. My repository layer communicates with the SQL Server via stored procedures.</p>\n\n<p>I want to query 2 related tables. The first query returns 1 row. The second query returns multiple rows related to the first query. Its not possible to return both in the one query. </p>\n\n<p>At the moment both queries are in the one stored procedure. I user multiple ado.net readers to parse the record set in to an object. </p>\n\n<p>Is the following more performant? </p>\n\n<p>Have two separate stored procedures. Each returning the above record sets in 2 separate calls. I then use the await keyword to indicate that the second call can asynchronously wait on the first i.e. using the new features in .net 4.5. This will keep the database connection open for a shorter period of time but means 2 database connections as oppose to 1.</p>\n"},{"tags":[".net","sql","sql-server","sql-server-2005"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":3461,"score":0,"question_id":4941489,"title":"Query vs Stored procedure; difference between two approaches","body":"<p>I am developing a web page for search. I have two options to build this page</p>\n\n<ol>\n<li><p>To build the query on page according to parameter enter by the user and send it to server.</p></li>\n<li><p>To send parameters to stored procedure and build query there and get it executed.</p></li>\n</ol>\n\n<p>I want to know that which approach I should adopt and why. </p>\n\n<p>I want to know the advantages or disadvantages of both approaches. </p>\n"},{"tags":["sql-server","ssis","oracle10g"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13180867,"title":"SSIS Oracle Query Returns No rows","body":"<p>I ran the query in SQL Developer (Oracle's tool), copied it over to SSIS, clicked Preview and it returns nothing. It works fine in Oracle. Any ideas? It does take about 120 seconds to run in Oracle.</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13225326,"title":"SQL Server Column Mapping","body":"<p>I have three scenarios that i'd like to handle, with some remapping i'm doing. </p>\n\n<p>Scenario #1\nI have Table A</p>\n\n<blockquote>\n  <p>Column A, Column B<br>   1, NULL  <br> 2, NULL  <br> 3, NULL  <br> 4,\n  NULL  <br> 5, NULL  <br> 6, NULL  <br></p>\n</blockquote>\n\n<p>How Can I Update Column B such that I begin with the next value of Column A  </p>\n\n<blockquote>\n  <p>Column A, Column B  <br> 1, 7  <br> 2, 8  <br> 3, 9  <br> 4, 10  <br>\n  5, 11  <br> 6, 12  <br></p>\n</blockquote>\n\n<p>Scenario #2\nI have Table A  </p>\n\n<blockquote>\n  <p>Column A, Column B  <br> 1, NULL  <br> 1, NULL  <br> 2, NULL  <br> 2,\n  NULL  <br> 3, NULL  <br> 3, NULL  <br> 3, NULL  <br></p>\n</blockquote>\n\n<p>How Can I Update Column B such that I begin with the next value of Column A but insuring I only update the values as a group like so  </p>\n\n<blockquote>\n  <p>Column A, Column B  <br> 1, 4  <br> 1, 4  <br> 2, 5  <br> 2, 5  <br>\n  3, 6  <br> 3, 6  <br> 3, 6  <br></p>\n</blockquote>\n\n<p>Scenario #3\nI have Table A that contains gaps in Column A  </p>\n\n<blockquote>\n  <p>Column A, Column B  <br> 1, NULL  <br> 1, NULL  <br> 4, NULL  <br> 4,\n  NULL  <br> 6, NULL  <br> 6, NULL  <br> 6, NULL  <br></p>\n</blockquote>\n\n<p>How Can I Update Column B such that I begin with the next value of Column A but insuring I only update the values as a group like so  </p>\n\n<blockquote>\n  <p>Column A, Column B  <br> 1, 7  <br> 1, 7  <br> 4, 8  <br> 4, 8  <br>\n  6, 9  <br> 6, 9  <br> 6, 9  <br></p>\n</blockquote>\n\n<p>Can I possibly handle all three of these scenario's in one statement? If so, how?\nAny help is much appreciated!  </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13224886,"title":"Why does a left join return differently to a NOT IN?","body":"<p>The following query is behaving somewhat strangely:</p>\n\n<pre><code>SELECT #batches.OutTo, PO_Number, CONVERT(varbinary, #batches.OutTo) , convert     (varbinary, PO_Number), \n    CASE WHEN convert(varbinary, #batches.OutTo) NOT IN (SELECT convert(varbinary,    PO_Number) FROM #pos) \n         THEN 'NOT IN' ELSE 'IN' END\nFROM #batches LEFT JOIN #pos ON \n    convert(varbinary, #batches.OutTo) = CONVERT(varbinary, PO_Number)\nWHERE #batches.OutTo IS NOT NULL\nGROUP BY #batches.OutTo, #pos.PO_Number\n\n\nOutTo       PO_Number   (No column name)    (No column name)    (No column name)\n311117      NULL        0x333131313137      NULL                    IN\n311130      311130      0x333131313330      0x333131313330          IN\n311259      NULL        0x333131323539      NULL                    IN\nL001934     L001934     0x4C303031393334    0x4C303031393334        IN\nL001988     NULL        0x4C303031393838    NULL                    IN\nL002002     NULL        0x4C303032303032    NULL                    IN\n</code></pre>\n\n<p>As you can see, the left join behaves correctly, but the NOT IN does not, returning IN for values that should be NOT IN. Why is this? Is it a bug, or a feature of SQL I don't know about?</p>\n"},{"tags":["sql-server","error-handling","ssas"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13007737,"title":"Error Log records in SSAS","body":"<p>We are processing cubes every day in job activity monitor, But on weekends w are receving email notification like \"cube processing hase been failed\". Is there any way to maintain error logs (like in ssis) on cubes?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1402,"score":3,"question_id":6134016,"title":"How to escape back slash in SQL server","body":"<pre><code>DECLARE @Query nvarchar(max)\nSET @Query ='DECLARE @Test nvarchar(max)\nSELECT @Test = ''\\a'\\b'\\c''\nSELECT @Test\nPRINT @Query\nexec sp_executesql @Query\n</code></pre>\n\n<p>I am trying to get an output as \\a\\b\\c. The above error is probably because I am not able to escape the \\ character.</p>\n"},{"tags":["sql-server","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":73,"score":-1,"question_id":10897473,"title":"Complex SQL Server Database Query","body":"<p>Previously I had only one table (I have more, ofc, but these are the ones I'm struggling with), which was the <code>UNIVERSITY</code> table.</p>\n\n<p>I now want to create two more tables : <code>STATE</code> and <code>CITY</code>.</p>\n\n<h3>Table Attributes</h3>\n\n<pre><code>UNIVERSITY: ID, NAME, SHORTNAME, FK_STATE, FK_CITY\n\nSTATE: ID, NAME, SHORTNAME\n\nCITY : ID, NAME\n</code></pre>\n\n<h3>Problem</h3>\n\n<p>I am parsing a excel sheet for the universities (including the city and state in which this university resides). Once I have all this information in memory, the hardest part comes.</p>\n\n<p>How do I:</p>\n\n<blockquote>\n  <p>Insert all Universities in the database,including its state and city, but querying the STATE and CITY databases for their IDs, to set the FK's of the university correctly.</p>\n</blockquote>\n\n<p>Example:<br>\nOnce I add a University named 'PUC-RIO', it is presented in 'RIO DE JANEIRO', (city) 'RIO DE JANEIRO' (state aswell). Adding the university itself is not a problem, but, how can I update its foreign key to the 'RIO DE JANEIRO' Key on state and city tables?</p>\n"},{"tags":["sql-server","variables","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13221637,"title":"Multiple variables in SQL Server stored procedure","body":"<p>I'm stuck on assigned variable values in this stored procedure.</p>\n\n<pre><code>@EntityID int,\n@Title1 varchar(10) OUTPUT,\n@Title2 varchar(10) OUTPUT\nAS\n  Declare @T1 varchar(10)\n  Declare @T2 varchar(10)\nBEGIN\n\n    SELECT     \n       dbo.Entity.EntityID, dbo.Types.TypeName AS Title1, Types_1.TypeName AS Title2\n    FROM         \n       dbo.Entity \n    LEFT OUTER JOIN\n       dbo.Types AS Types_1 ON dbo.Entity.Title2 = Types_1.TypeID \n                            AND dbo.Entity.Title2 = Types_1.TypeID \n    LEFT OUTER JOIN\n       dbo.Types ON dbo.Entity.Title1 = dbo.Types.TypeID\n    WHERE     \n       (dbo.Entity.EntityID = @EntityID)\nEND\n</code></pre>\n\n<p>I'm trying to return the values of <code>Title1</code> and <code>Title2</code>. The query works, and returns values, but I need to use them elsewhere.</p>\n\n<p>Thanks for your help.</p>\n\n<p>Steve</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":269,"score":0,"question_id":6736797,"title":"C#: Unknown constructor 'Parameter(String, TypeCode, Int)' of 'System.Web.UI.WebControls.Parameter'","body":"<p>In my code behind I have the code below to execute an insert command.  Two of the parameter values are to be set when the user clicks a particular button.  I broke it out this way because I'd like to reuse the <code>SqlDataSource</code>.</p>\n\n<p>My problem is with this line <code>(@\"Amount\", TypeCode.Int16, amount)</code>.  The specific error is <code>C#: Unknown constructor Parameter(String, TypeCode, Int) of System.Web.UI.WebControls.Parameter</code>.  Can someone point out what I did wrong? Or, please tell me what steps I can take to debug this.  I'm stuck.</p>\n\n<pre><code>    protected void InsertFees_Inserting(object sender, SqlDataSourceCommandEventArgs e)\n{\n    e.Command.Parameters[\"@UserID\"].Value = Convert.ToInt16(RadGrid1.SelectedValues[\"UserID\"].ToString());\n    e.Command.Parameters[\"@Type\"].Value = \"D\";\n    e.Command.Parameters[\"@Date\"].Value = DateTime.Now;\n    e.Command.Parameters[\"@Amount\"].Value = \"\";\n    e.Command.Parameters[\"@Description\"].Value = \"\";\n}\n\nprotected void RadButton2_Click(object sender, EventArgs e)\n{\n\n    try\n    {\n        int amount = Convert.ToInt16(RadNumericTextBox1.Text);\n        InsertFees.InsertParameters.Add(new Parameter(\"@Amount\", TypeCode.Int16, amount));\n        InsertFees.InsertParameters.Add(new Parameter(\"@Description\", TypeCode.String, RadTextBox2.Text));\n        InsertFees.Insert();\n        Label2.Text = \"Insert Successful\";\n    }\n\n    catch(Exception ex)\n    {\n        Panel1.Visible = true;\n        Label3.Text = ex.ToString();\n    }\n}\n</code></pre>\n"},{"tags":["sql","sql-server","query","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13223565,"title":"How can I split one record into two and set null values?","body":"<p>I have records with the following:</p>\n\n<pre><code>Id    Date          MondayMorning  MondayEvening  TuesdayMorning TuesdayEvening and so on\n1   2012-01-01          2               3               2              2\n2   2012-01-02          2               2               2              2\n</code></pre>\n\n<p>I want split record 1 in two records because the states of mondaymorning and mondayevening are not the same. If the state is the same then do nothing.  </p>\n\n<p>The result that I expect:</p>\n\n<pre><code>Id    Date          MondayMorning  MondayEvening  TuesdayMorning  TuesdayEvening\n1   2012-01-01          2               NULL          2                 2\n1   2012-01-01          NULL            3             NULL              NULL\n2   2012-01-02          2               2             2                 2\n</code></pre>\n\n<p>Please remember that also the other days can vary.</p>\n\n<p>I already have a query but, neem some changes. See the query on\n<a href=\"http://sqlfiddle.com/#!3/d41d8/5712\" rel=\"nofollow\">SQL Fiddle</a>.\nThe output you can see here is the case where it goes wrong. For TuesdayEvening and MondayEvening I am expecting 2.</p>\n\n<p>The information on SQL Fiddle is:</p>\n\n<pre><code>Declare @t Table(Id int identity,[Date] Datetime,MondayMorning Int,MondayEvening Int,TuesdayMorning Int,TuesdayEvening Int)\nInsert Into @t Select '2012-01-01',0,2,0,2\n\nSELECT id\n    ,date\n    ,MondayMorning\n    ,(CASE WHEN MondayEvening &lt;&gt; MondayMorning THEN NULL ELSE MondayEvening END) AS MondayEvening\n    ,TuesdayMorning\n    ,(CASE WHEN TuesdayEvening &lt;&gt; TuesdayMorning THEN NULL ELSE TuesdayEvening END) AS TuesdayEvening\nFROM @t \n\nUNION ALL \n\nSELECT id\n    ,date\n    ,NULL AS MondayMorning\n    ,(CASE WHEN MondayEvening = MondayMorning THEN NULL ELSE MondayEvening END) AS MondayEvening\n    ,NULL AS TuesdayMorning\n    ,(CASE WHEN TuesdayEvening = TuesdayMorning THEN NULL ELSE TuesdayEvening END) AS TuesdayEvening\nFROM @t\nWHERE --MondayMorning &lt;&gt; MondayEvening\n--OR TuesdayMorning &lt;&gt; TuesdayEvening\nMondayMorning &lt;&gt; MondayEvening\nAND (MondayMorning != 0 and MondayEvening != 0)\nOR TuesdayMorning &lt;&gt; TuesdayEvening\nAND (TuesdayEvening != 0 and TuesdayMorning != 0)\n</code></pre>\n"},{"tags":["sql-server","visual-studio","visual-studio-2012","sql-server-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":46,"score":0,"question_id":13222445,"title":"Error when trying to connect to SQL Server 2012 from Visual Studio 2012","body":"<p>The tools used:\nVisual Studio 2012, MS SQL Server 2012, and VB.NET MVC 4</p>\n\n<p>Here is a showcase of how I attempt to establish a connection to the server and create a database.</p>\n\n<p>In this example MS SQL Server Compact 4.0 is used:</p>\n\n<h2>Step 1</h2>\n\n<p>Do <code>add the server</code>. </p>\n\n<p>The <code>Windows username</code> is used.</p>\n\n<p><img src=\"http://i.stack.imgur.com/RjvFr.png\" alt=\"Connecting to the MS SQL Server 2012\"></p>\n\n<h2>Step 2</h2>\n\n<p>Do add the <code>database connection</code>.</p>\n\n<p>Also, do <code>test the connection</code>.</p>\n\n<p><img src=\"http://i.stack.imgur.com/N7Adf.png\" alt=\"Connecting to the MS SQL Server 2012\"></p>\n\n<h2>Step 3</h2>\n\n<p>Do <code>create a table</code>.</p>\n\n<p><img src=\"http://i.stack.imgur.com/EELhq.png\" alt=\"Connecting to the MS SQL Server 2012\"></p>\n\n<hr />\n\n<h2>As a Notice, This Question Has Been Rewritten</h2>\n\n<p>I have managed the connection to the MS SQL Sever Compact 4.0, successfully. Yet, I am still getting the following error message with the other possible choices: e.g. MS SQL Server 2012, and MS Access Database File.</p>\n\n<p><img src=\"http://i.stack.imgur.com/Af2yu.png\" alt=\"Error Message - MS SQL Server 2012\"></p>\n"},{"tags":["sql-server","data-structures","ssas","cube"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13122878,"title":"What is the data structure for sql server analysis service's cube data storage?","body":"<p>I want to know that what is the used data structure for storing cubes and what is the mechanism for reading data from that.</p>\n"},{"tags":["sql","sql-server","join","left-join","outer-join"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13221154,"title":"How can I get join not duplicate?","body":"<p>I get join 2 tables but use 3 table. I need not duplicate values. But I try join have duplicate.</p>\n\n<p>Table <code>peopleAll</code>:</p>\n\n<pre><code>pNo    pName\n-------------\n00001  Sang\n00002  Janta\n00003  Els\n00004  Est\n00005  Sam\n00006  John\n00007  Misan\n00008  Wila\n00009  light\n00010  Smith\n00011  Ritpo\n</code></pre>\n\n<p>Table <code>fTime</code>:</p>\n\n<pre><code>cNo    cDate                     cIn                        cOut\n-----------------------------------------------------------------------------------\n00001  2012-10-22 00:00:00.000   2012-10-22 07:59:00.000    2012-10-22 20:34:00.000\n00002  2012-10-22 00:00:00.000   2012-10-22 12:50:00.000    2012-10-22 19:50:00.000\n00003  2012-10-22 00:00:00.000   2012-10-22 12:01:00.000    2012-10-22 20:30:00.000\n00004  2012-10-22 00:00:00.000   2012-10-22 07:55:00.000    2012-10-22 20:30:00.000\n00005  2012-10-22 00:00:00.000   2012-10-22 07:27:00.000    2012-10-22 20:31:00.000\n00010  2012-10-22 00:00:00.000   2012-10-22 07:12:00.000    2012-10-22 20:22:00.000\n</code></pre>\n\n<p>Table <code>Leave</code>:</p>\n\n<pre><code>lNo    lDate                     lStart                     lStop\n-----------------------------------------------------------------------------------\n00002  2012-10-22 00:00:00.000   2012-10-22 08:00:00.000    2012-10-22 12:00:00.000\n00003  2012-10-22 00:00:00.000   2012-10-22 08:00:00.000    2012-10-22 12:00:00.000\n00011  2012-10-22 00:00:00.000   NULL                       NULL\n</code></pre>\n\n<p>This SQL code:</p>\n\n<pre><code>SELECT lr.lNo, lr.lDate, lr.lStart, lr.lStop \nFROM Leave lr \nWhere lr.cStart = '2012-10-22'\n\nUNION ALL\n\nSELECT pa.pNo, ISNULL(tf.cDate, Convert(nvarchar(10),'2012-10-22',114)),tf.cIn, tf.cOut\nFROM fTime tf FULL OUTER join peopleAll pa On tf.cNo = pa.pNo AND \ntf.cDate = Convert(nvarchar(10),'2012-10-22',114)\n</code></pre>\n\n<p>returns this output:</p>\n\n<pre><code>lNo    lDate                     lStart                     lStop\n-----------------------------------------------------------------------------------\n00001  2012-10-22 00:00:00.000   2012-10-22 07:59:00.000    2012-10-22 20:34:00.000\n00002  2012-10-22 00:00:00.000   2012-10-22 08:00:00.000    2012-10-22 12:00:00.000\n00002  2012-10-22 00:00:00.000   2012-10-22 12:50:00.000    2012-10-22 19:50:00.000\n00003  2012-10-22 00:00:00.000   2012-10-22 08:00:00.000    2012-10-22 12:00:00.000\n00003  2012-10-22 00:00:00.000   2012-10-22 12:01:00.000    2012-10-22 20:30:00.000\n00004  2012-10-22 00:00:00.000   2012-10-22 07:55:00.000    2012-10-22 20:30:00.000\n00005  2012-10-22 00:00:00.000   2012-10-22 07:27:00.000    2012-10-22 20:31:00.000\n00006  2012-10-22 00:00:00.000   NULL                       NULL\n00007  2012-10-22 00:00:00.000   NULL                       NULL\n00008  2012-10-22 00:00:00.000   NULL                       NULL\n00009  2012-10-22 00:00:00.000   NULL                       NULL\n00010  2012-10-22 00:00:00.000   2012-10-22 07:12:00.000    2012-10-22 20:22:00.000\n00011  2012-10-22 00:00:00.000   NULL                       NULL\n</code></pre>\n\n<p>I try to change <code>FULL OUTER JOIN</code> then <code>LEFT OUTER JOIN</code> and I get output:</p>\n\n<pre><code>lNo    lDate                     lStart                     lStop\n-----------------------------------------------------------------------------------\n00002  2012-10-22 00:00:00.000   2012-10-22 08:00:00.000    2012-10-22 12:00:00.000\n00002  2012-10-22 00:00:00.000   2012-10-22 12:50:00.000    2012-10-22 19:50:00.000\n00003  2012-10-22 00:00:00.000   2012-10-22 08:00:00.000    2012-10-22 12:00:00.000\n00003  2012-10-22 00:00:00.000   2012-10-22 12:01:00.000    2012-10-22 20:30:00.000\n00004  2012-10-22 00:00:00.000   2012-10-22 07:55:00.000    2012-10-22 20:30:00.000\n00007  2012-10-22 00:00:00.000   NULL                       NULL\n00008  2012-10-22 00:00:00.000   NULL                       NULL\n00010  2012-10-22 00:00:00.000   2012-10-22 07:12:00.000    2012-10-22 20:22:00.000\n00011  2012-10-22 00:00:00.000   NULL                       NULL\n</code></pre>\n\n<p>LEFT OUTER join have miss some field??</p>\n\n<p>I need this output:</p>\n\n<pre><code>lNo    lDate                     lStart                     lStop\n-----------------------------------------------------------------------------------\n00001  2012-10-22 00:00:00.000   2012-10-22 07:59:00.000    2012-10-22 20:34:00.000\n00002  2012-10-22 00:00:00.000   2012-10-22 12:50:00.000    2012-10-22 19:50:00.000 \n00003  2012-10-22 00:00:00.000   2012-10-22 12:01:00.000    2012-10-22 20:30:00.000\n00004  2012-10-22 00:00:00.000   2012-10-22 07:55:00.000    2012-10-22 20:30:00.000\n00005  2012-10-22 00:00:00.000   2012-10-22 07:27:00.000    2012-10-22 20:31:00.000\n00006  2012-10-22 00:00:00.000   NULL                       NULL\n00007  2012-10-22 00:00:00.000   NULL                       NULL\n00008  2012-10-22 00:00:00.000   NULL                       NULL\n00009  2012-10-22 00:00:00.000   NULL                       NULL\n00010  2012-10-22 00:00:00.000   2012-10-22 07:12:00.000    2012-10-22 20:22:00.000\n00011  2012-10-22 00:00:00.000   NULL                       NULL\n\n(00002,00003 from fTime)\n</code></pre>\n\n<p>Please help me. Thanks you for you time. :)</p>\n"},{"tags":["sql-server","sql-server-2008-r2","relationships","table-relationships"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":76,"score":4,"question_id":13167633,"title":"Create a One-to-Optional-One constraint in SQL Server","body":"<p>i have a <em>\"main table\"</em>, call it <code>Customers</code>:</p>\n\n<pre><code> CREATE TABLE Customers (\n     CustomerID int PRIMARY KEY NOT NULL,\n     FirstName nvarchar(50),\n     LastName nvarchar(50)\n )\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/42mi6.png\" alt=\"enter image description here\"></p>\n\n<p>And i have a <em>\"satellite table\"</em>, call it <code>Customer_IllegallyObtainedInformation</code>:</p>\n\n<pre><code>CREATE TABLE Customer_IllegallyObtainedInformation (\n    CustomerID int PRIMARY KEY NOT NULL,\n    CellPhonePin int,\n    SexualOrientation varchar(20),\n    EmailPassword varchar(50)\n)\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/Qx0Iv.png\" alt=\"enter image description here\"></p>\n\n<p>Now, what i <strong>want</strong> is a foreign key constraint from the <code>Illegal</code> table back to the main <code>Customers</code> table:</p>\n\n<p><img src=\"http://i.stack.imgur.com/MJgwD.png\" alt=\"enter image description here\"></p>\n\n<p>In other words:</p>\n\n<ul>\n<li>there <strong>can</strong> be a <code>Customer</code> <strong>without</strong> an <em><code>Illegal</code></em> entry</li>\n<li>but there can <strong>never</strong> be an <em><code>Illegal</code></em> entry without a <code>Customer</code></li>\n</ul>\n\n<p>My instinct was to, in the SQL Server database diagram, drag</p>\n\n<ul>\n<li><strong>FROM</strong> the <code>Illegal</code> table <strong>TO</strong> the <code>Customers</code> table</li>\n</ul>\n\n<p>Indicating to SQL Server that <code>Customers_IllegallyObtainedInformation</code> is the \"child\" in the relationship. Instead what happens in that SQL Server makes it a one-to-one relationship:</p>\n\n<p><img src=\"http://i.stack.imgur.com/QIqfU.png\" alt=\"enter image description here\"></p>\n\n<p>Meaning that if you try to insert a <code>Customer</code>, it will fail because there is no existing <code>Illegal</code> information. </p>\n\n<p>How can i create a <em>\"Parent-Child\"</em>, or <em>\"One-to-Optional-One\"</em> relationship in SQL Server?</p>\n\n<hr>\n\n<p><strong>Note:</strong> Don't confuse the example with the question. i could create an sacrificial primary surrogate key in the <code>Illegal</code> table:</p>\n\n<p><img src=\"http://i.stack.imgur.com/16t1b.png\" alt=\"enter image description here\"></p>\n\n<p>But that wasn't my question.</p>\n"},{"tags":["sql","sql-server","query","insert","character"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13218271,"title":"SQL statement using special charter","body":"<p>Can anyone please help me in correcting below statement:</p>\n\n<pre><code>SET @cmd='BULK INSERT ' + @Database + '.dbo.' + @tmp + ' from ' + @Out + @tmp + '.csv \nWITH (FIELDTERMINATOR = , , ROWTERMINATOR = \\n)' \n</code></pre>\n\n<p>Output of the above query is: </p>\n\n<blockquote>\n  <p>BULK INSERT MP2.dbo.GLCODE from C:\\SABA\\GLCODE.csv WITH\n  (FIELDTERMINATOR = , , ROWTERMINATOR = \\n)</p>\n</blockquote>\n\n<p>I want to print this in below manner:</p>\n\n<blockquote>\n  <p>BULK INSERT MP2.dbo.GLCODE from C:\\SABA\\GLCODE.csv WITH\n  (FIELDTERMINATOR =',', ROWTERMINATOR = '\\n')</p>\n</blockquote>\n"},{"tags":["sql","sql-server","tsql","adventureworks"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":67,"score":3,"question_id":13220573,"title":"Adventure Works Explanation","body":"<p>I've been looking at Microsoft's Adventure Works 2012 database. I'd be very interested if there's any information explaining why the tables were created as they are. Some sort of schema overview I guess.</p>\n\n<p>For example: </p>\n\n<p>Why they chose to create a <code>BusinessEntity</code> table as a sort of base class for Person, Employee, etc.</p>\n\n<p>Most of the data is normalized so why they chose to put the <code>CountryRegionCode</code> field into the <code>StateProvince</code> table instead of an ID to a separate table.</p>\n\n<p>Anyway I'm very interested in learning more about the decisions that went into the databases design. Anyone know a resource that goes into this sort of thing?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13221588,"title":"SQL retrieve info from multiple tables","body":"<p>i have a question about sql and i need to know if i can retrieve results using only sql.</p>\n\n<p>I need to find the distance in km of the route with the id=1 that starts from station 1 and arrive at station 4. So route 1 will pass from 4 stations (the number could be more or less). I need to find the distance that a train will cover crossing all the 4 stations. Which are: 5+10+15=30</p>\n\n<p>is it possible to get the answer using only SQL?</p>\n\n<p>below are the tables (i hope you understand the structure):</p>\n\n<p>you can see an image of the table <a href=\"http://studio9.com.cy/testing/sql.gif\" rel=\"nofollow\">here</a></p>\n\n<pre><code>route - station\n-----------------------\n1     - 1    \n1     - 2    \n1     - 3    \n1     - 4\n\n\nstation1 - station2 - distance (km)\n------------------------------------\n1        - 2        -   5\n2        - 3        -   10\n3        - 4        -   15\n</code></pre>\n"},{"tags":["sql-server","sharepoint","sharepoint2010","powerpivot"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":11107210,"title":"Sharing Powerpivot reports","body":"<p>I have generated a report in Powerpivot for excel and want to share it with other members of my team. I do not want all of them to download and install Powerpivot add-on.</p>\n\n<p>I found out that the report can be shared over SharePoint 2010. For this I need to get the Powerpivot add-on for SharePoint installed as part of SQL Server. Am I right or Is there any way I can get Powerpivot to work with SharePoint? Buying SQL server just for Powerpivot add-on is not worth it because we will not be using SQL server.\nIs there any other way in which I can share the report?</p>\n"},{"tags":["sql-server","visual-c#-express-2010"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13215172,"title":"Database Connection Error \"file in use\"","body":"<p>I am using Visual Studio 2010 C# Express and SQL Server Management Studio with SQL Server 2012\nI am getting an error when I try to connect a database to my Windows forms project. </p>\n\n<pre><code>\"This file is in use.  Enter a new name or\nclose the file that is open in another program\"\n</code></pre>\n\n<p>I poked around online to try to find a solution but none worked.   So i decided to create a brand new database and a brand new project.  But I still get the error!</p>\n\n<p>here are the steps I use:   </p>\n\n<ul>\n<li>First I connected to my locally hosted server  </li>\n<li>then i right-clicked on <code>Databases</code> and selected <code>New Database</code> and named it <code>school</code>  </li>\n<li>then i right clicked the <code>tables</code> folder on my new database and selected <code>new table</code>  </li>\n<li>I added thes tables <code>student, course, enrolled</code> </li>\n<li>finally i threw some bogus entries into it</li>\n</ul>\n\n<p>Now I jump over to VS   </p>\n\n<ul>\n<li>I select <code>New Project</code> then <code>Windows Forms Application</code> and name it <code>Registrar</code>  </li>\n<li>then i click <code>add new data source</code>   </li>\n<li>select <code>database</code> in the <code>Choose a data source type</code> window  </li>\n<li>then i select <code>Dataset</code> in the <code>Choose a Database Model</code> window  </li>\n<li>then I click <code>New Connection</code>  I change the DataSource to <code>Microsoft SQL Server Database   File</code> browse to the DATA folder inside my 'SQLEXPRESS' folder and when i click the 'school.mdf' file i get the above error.</li>\n</ul>\n\n<p>any help would be greatly appreciated.</p>\n"},{"tags":["mysql","sql-server","database","dedicated-server","development-machine"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":13221704,"title":"MySQL configuration type?","body":"<p>I am installing MySQL and when it reaches the configuration step it is asking me to select from on of the following server configuration types:</p>\n\n<ul>\n<li>Development Machine</li>\n<li>Server Machine</li>\n<li>Dedicated Machine</li>\n</ul>\n\n<p>I am new to mysql, the reason I am installing this is because I am making an application which will store data on a database using MySQL. Now, can someone explain what does these server configurable type mean and which one should I be selecting? </p>\n"},{"tags":["sql","sql-server","join","pagination"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13220743,"title":"Implement paging (skip / take) functionality with this query","body":"<p>I have been trying to understand a little bit about how to implement custom paging in SQL, for instance reading <a href=\"http://stackoverflow.com/questions/548475/efficient-way-to-implement-paging\">articles like this one</a>.</p>\n\n<p>I have the following query, which works perfectly. But I would like to implement paging with this one.</p>\n\n<pre><code>SELECT TOP x PostId FROM ( SELECT PostId, MAX (Datemade) as LastDate\n from dbForumEntry \n group by PostId ) SubQueryAlias\n order by LastDate desc\n</code></pre>\n\n<p><strong>What is it I want</strong></p>\n\n<p>I have forum posts, with related entries. I want to get the posts with the latest added entries, so I can select the recently debated posts.</p>\n\n<p>Now, I want to be able to get the \"top 10 to 20 recently active posts\", instead of \"top 10\".</p>\n\n<p><strong>What have I tried</strong></p>\n\n<p>I have tried to implement the ROW functions as the one in the article, but really with no luck. </p>\n\n<p>Any ideas how to implement it?</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13210881,"title":"Getting the Id of a row updated in Sql Server for a table with trigger","body":"<p>There is good answer here: <a href=\"http://stackoverflow.com/a/1610530/630169\">http://stackoverflow.com/a/1610530/630169</a> \nHowever if updated table have a trigger that does not work as SQL Server produces error: The target table 'my_table' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause. What to do if table has trigger?</p>\n"},{"tags":["sql-server","tsql","select"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13218684,"title":"T-SQL replace value on select","body":"<p>I have a column (<code>SERVICE_ID</code>) in my table where I can have only 3 values: 0, 1 and 2. </p>\n\n<p>On a <code>SELECT</code>, I'd like to change those values into English words for display:</p>\n\n<pre><code>select client, SERVICE_ID\nfrom customers\n</code></pre>\n\n<p>Currently displays:</p>\n\n<pre><code>| John     | 1\n| Mike     | 0\n| Jordan   | 1\n| Oren     | 2\n</code></pre>\n\n<p>I'd like to change the query to get:</p>\n\n<pre><code>| John     | QA\n| Mike     | development\n| Jordan   | QA\n| Oren     | management\n</code></pre>\n\n<p>There is any way to do this using only the select?</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2008","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":63,"score":0,"question_id":13216924,"title":"How can i update another tables after adding record to a table in sql server 2008","body":"<p>I have two same tables created in SQL Server 2008.</p>\n\n<p>What I need is:</p>\n\n<p><strong>Add the newest data inserted in <code>table1</code> into <code>table2</code>.</strong></p>\n\n<p>Is that possible? </p>\n\n<p>Something like services or triggers or stored procedures?</p>\n\n<p>I think that I have to use triggers, but I don't know how.</p>\n\n<p>I have these two tables:</p>\n\n<pre><code>table1  ( field1,field2,field3 )\ntable2  ( field1,field2,field3 )\n</code></pre>\n\n<p>when i insert into table1 i need table2 to be updated as the procedure below:    </p>\n\n<pre><code>&gt; IF NotExist(field1=value) in table2 THEN INSERT Into table2 ELSE UPDATE table2\n&gt; with new field1 value.\n</code></pre>\n"},{"tags":["sql","sql-server","join","distinct"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":13219582,"title":"SQL Query - Combine DISTINCT and TOP?","body":"<p>I have the following query I want to fire:</p>\n\n<pre><code>SELECT DISTINCT TOP(5) fp.PostId FROM dbForumPosts fp\nLEFT JOIN dbForumEntry fe ON fp.PostId = fe.PostId\nOrder by fe.Datemade DESC\n</code></pre>\n\n<p>However, when I fire it, I get the error:</p>\n\n<pre><code>Msg 145, Level 15, State 1, Line 1\nORDER BY items must appear in the select list if SELECT DISTINCT is specified.\n</code></pre>\n\n<p>I tried to change the query, so it used GROUP BY instead, but then I have the following problem:</p>\n\n<pre><code>Msg 8127, Level 16, State 1, Line 4\nColumn \"dbForumEntry.Datemade\" is invalid in the ORDER BY clause because it is not contained in either an aggregate function or the GROUP BY clause.\n</code></pre>\n\n<p><strong>WHAT DO I WANT:</strong></p>\n\n<p>Think of this as a forum. There are posts (dbForumPosts) and entries (dbForumEntry). There are 0-many entries pr post.</p>\n\n<p>What I want is to the get posts with the most recent activity (posts with the latest updated entries in).</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":13218892,"title":"SQL Server: +(unary) operator on non-numeric Strings","body":"<p>I am surprised! This statement below is valid in <code>SQL SERVER</code>:</p>\n\n<pre><code>SELECT  +'ABCDEF'\n</code></pre>\n\n<p>Has <code>SQL Server</code> defined <code>+</code> as a <code>Unary</code> operator for string types?</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13218482,"title":"Check for SQL Server existence before connection","body":"<p>We need to check for the existence of a SQL server across all domains prior to attempting to connect to the server. We can loop through the list of servers on the local domain use SQLDataSourceEnumerator, but that takes a few seconds to load up and it only gets the local domain. We are using SQL Server 2005 and 2008 servers as well as .Net 2010. We don't want to attempt to connect and wait for the 30 second or more timeout that appears to be standard if the server doesn't exist. </p>\n\n<p>Any suggestions would be helpful.</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13218851,"title":"SQL : Update ID; According to Date","body":"<p>I have Table below.</p>\n\n<p><img src=\"http://i.stack.imgur.com/GpVhy.jpg\" alt=\"enter image description here\"></p>\n\n<p>I like to <em>Update</em> <code>ID</code> according to date and then by User. </p>\n\n<h3>For Example</h3>\n\n<p><img src=\"http://i.stack.imgur.com/oyzfU.jpg\" alt=\"enter image description here\"></p>\n\n<h3>Thanks</h3>\n"},{"tags":["sql-server","ddl","ssms"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":2831,"score":6,"question_id":2431901,"title":"Forcing Management Studio to use ALTER TABLE instead of DROP/CREATE","body":"<p>I'm wondering if is there a way to force MSSQL Management Studio to produce a script like this:</p>\n\n<pre><code>ALTER TABLE Mytable\nADD MyCol bit NOT NULL\nCONSTRAINT MyColDefault\nDEFAULT 0 WITH VALUES\n\n\nALTER TABLE [dbo].Mytable\nALTER COLUMN MyCol2 int NULL\n\nGO \n</code></pre>\n\n<p>when I alter a very simple property of a column on a table.\nIf I do this in the designer and ask for the produced script, the script doesn't do such simple tasks, but instead copies all the data in a tmp table, drops the original table, renames the tmp table with the original table name. And, of course, drops and recreates every constraint and relationships.</p>\n\n<p>Is there any option I can change to change this behaviour? Or, this may be possible, is there some danger I don't see in using the simple ALTER TABLE above?</p>\n\n<p>thanks.</p>\n"},{"tags":["sql-server","cursor","structure"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":52,"score":-3,"question_id":13218625,"title":"cursor in sql server","body":"<pre><code>create table sales (\n    unitcode int ,\n    categorycode smallint ,\n    ddate varchar(10) ,\n    price float\n)\nand\ncreate table timetable (\n    year varchar(4) ,\n    month varchar(11) ,\n    ddate varchar(10)\n)\n</code></pre>\n\n<p>I have 2 tables and 3 years (2000,2001,2002) , I want to write a query with CURSOR to find this question:\nin eech month of eech year which 2 products have max price?</p>\n"}]}
{"total":54451,"page":6,"pagesize":100,"questions":[{"tags":["sql-server","asp.net-mvc","webmatrix","simplemembership"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13215644,"title":"Control the tables generated by SimpleMembershipProvider?","body":"<p>I found <code>SimpleMembershipProvider</code> to be pretty neat and productive.</p>\n\n<p>I was wondering if there is a way to control the generate table/column names/datatypes.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","full-text-search"],"answer_count":4,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":9953,"score":10,"question_id":6003240,"title":"Cannot use a CONTAINS or FREETEXT predicate on table or indexed view because it is not full-text indexed","body":"<p>I am getting following error in my SQL server 2008 R2 database:</p>\n\n<blockquote>\n  <p>Cannot use a <code>CONTAINS</code> or <code>FREETEXT</code> predicate on table or indexed view 'tblArmy' because it is not full-text indexed.</p>\n</blockquote>\n"},{"tags":["c#","sql-server","linq-to-sql","datacontext"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":70,"score":0,"question_id":13210066,"title":"no response from server","body":"<p>I'm using LINQ to SQL  (data context) of Microsoft. I also created stored procedure using SQL server 2008. When I call the stored procedure from within the c# code : </p>\n\n<pre><code>_context.Get_Data(params...)\n</code></pre>\n\n<p>always after 19 calls to the SQL server it get stuck, and an exception is thrown:</p>\n\n<blockquote>\n  <p>\"No response from server...\".</p>\n</blockquote>\n\n<p>I tried to execute the stored procedure from the SQL code and it works fine. I also added </p>\n\n<pre><code>with(no lock)\n</code></pre>\n\n<p>and nothing has happened.</p>\n\n<p>Do you have any suggestion for me?</p>\n\n<p>Stack Trace:</p>\n\n<blockquote>\n  <p>at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action1 wrapCloseInAction) at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action1 wrapCloseInAction) at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose) at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean&amp; dataReady) at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData() at System.Data.SqlClient.SqlDataReader.get_MetaData()</p>\n</blockquote>\n"},{"tags":["sql-server","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13216265,"title":"Usage of sequence in SQL Server 2012","body":"<p>I have <code>SQL Server 2012</code> and I want to know what's the usage of sequence. I Look for a sample to explain usage of sequence.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I know create and use Sequence in database. I want to know what is practical scenario for use of Sequence.</p>\n"},{"tags":["mysql","sql-server","oracle","postgresql","liquibase"],"answer_count":1,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":141,"score":7,"question_id":11955313,"title":"How to create ordered index with liquibase?","body":"<p>I am wondering if there is a generic way to create an \"ordered index\" with liquibase.</p>\n\n<p>Something that will produce these kind of SQL statement: </p>\n\n<pre><code>CREATE INDEX idx_name ON my_table (m_column DESC)\n</code></pre>\n\n<p>I need that for oracle, postgresql, mysql, and sql server.</p>\n\n<p>If not, I'll have to do it manually with the <code>SQL</code> tag for each RDBM.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","sql-server-express","ssms","sql-server-2008-express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3368,"score":0,"question_id":3172965,"title":"Can't connect to local computer via SQL Server 2008 Express Management Studio","body":"<p>HI, folks,  </p>\n\n<p>Previously, I had a SQL Server 2008 installed, but then I deleted it, and installed SQL Server 2008 Express Management Studio. And now I can't connect to local computer. I get error :</p>\n\n<blockquote>\n  <p>A network-related or instance-specific\n  error occured while establishing a\n  connection to SQL server. The server\n  was not found or was not\n  accesible.Verify that the instance\n  name is correct and that SQl Server is\n  configured to allow remote\n  connections.(provide: Named Pipes\n  Provider, error:40 - Could not open a\n  connection to SQL Server) (Microsoft\n  SQL Server, Error: 2).</p>\n</blockquote>\n\n<p>But I can create DB via VS2010. </p>\n"},{"tags":["sql-server","sql-server-2008","oracle10g","data-migration"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1983,"score":0,"question_id":3482067,"title":"How to migrate database from Oracle to SQL Server?","body":"<p>I have a database on <strong>Oracle 9i</strong>. Now I want to work on <strong>SQL Server 2008</strong>. I want  to migrate the Oracle database to SQL Server, but how do I do that? Give me some syntax? Thanks for the help.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":13192145,"title":"SQL return both table rows separately","body":"<p>I have two tables and want to return both table's rows. Both tables do not have any relation.</p>\n\n<p><code>Table 1</code> has columns <code>userid, name</code>, and other columns... and <code>Table 2</code> has only two columns <code>id, name</code>.</p>\n\n<p>I want both table results in one query result set.</p>\n\n<p>Table results:</p>\n\n<pre><code>userid name and other columns from Table 1.\nid     name and NULL, NULL should show as Table 2 do not have extra columns.\n</code></pre>\n"},{"tags":["c#","sql-server","sqldatatypes"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13216267,"title":"Issue with datatype nchar in SQL Server database","body":"<p>I am using SQL Server 2008, Visual Web Developer 2012 and .net 4.0. I created a table in SQL Server and added some columns to it. I gave some columns the datatype <code>nchar(10)</code>. </p>\n\n<p>Now my problem is that when I insert string of less than 10 characters as a value of the column type <code>nchar(10)</code> and when I fetched the value it inserts blank spaces to complete the 10 character string. </p>\n\n<p>Means if I insert <code>\"a\"</code> into column of type <code>nchar(10)</code>, \nthen when I fetch the value again I get back: <code>\"a         \"</code></p>\n\n<p>How can I resolve this issue ?</p>\n"},{"tags":["sql-server","sharing","mdf"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":3091,"score":0,"question_id":9093458,"title":"Can't connect to my own MDF file. Cannot open user default database. Login failed.Login failed for user... and other errors","body":"<p><strong>SQLSEXPRESS service IS running!!</strong></p>\n\n<p>I have I program I wrote some time ago and it works. It was written in MS Visual Studio with local MDF file. </p>\n\n<p>How is it possible to edit this file from Microsoft SQL Server Management Studio? I don't see this file in the list of globally connected databases.</p>\n\n<p>If I try to attach this file with Visual Studio Wizard, I get message that such database already exists, but when I set arbitrary logical name, I get sharing violation.</p>\n\n<p>How to reach MDF file?</p>\n\n<p><strong>EDIT 1</strong></p>\n\n<p>Now I found that my program also stopped to work.</p>\n\n<p>The summary of results of different attempts to reach MDF file:</p>\n\n<ol>\n<li>Program itself System.Data.SqlClient.SqlException (0x80131904): Cannot open user default database. Login failed. Login failed for user <code>&lt;username&gt;</code>. (windows user)</li>\n<li>Visual Studio, Data source = Microsoft SQL Server, Logical Name = \"\" <strong><em>Error message</em></strong>: An attempt to attach an auto-named database for file\n<code>&lt;filename&gt;</code> failed. A database with the same name exists, or\nspecified file cannot be opened, or it is located on UNC share.</li>\n<li>Visual Studio, Data source = Microsoft SQL Server, Logical Name = SOMENAME <strong><em>Error message</em></strong> Unable to open the physical file <code>&lt;filename&gt;</code>. Operating system error 32: \"32(The process cannot access the file because it is being used by another process )\".\nCannot attach the file <code>&lt;filename&gt;</code> as database SOMENAME.</li>\n<li>Visual Studio, Data source = Microsoft SQL Server Database File, Windows Authentication <strong><em>Error message</em></strong>: Cannot open user default database. Login failed. Login failed for user <code>&lt;username&gt;</code>.</li>\n<li>Visual Studio, Data source = Microsoft SQL Server Database File, SQL Server Authentication <strong><em>Error message</em></strong>: Failed to generate a user instance of SQL Server. Only an integrated connection can generate a user instance. The connection will be closed.</li>\n<li>Microsoft SQL Server Management Studio, Attach Database <strong><em>Error message</em></strong>: Unable to open the physical file <code>&lt;filename&gt;</code>. Operating system error 32: \"32(The process cannot access the file because it is being used by another process)\". (Microsoft SQL Server, Error: 5120)</li>\n</ol>\n"},{"tags":["sql-server","nhibernate","spatial","geography"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13214033,"title":"combining sql server spatial and NHibernate with CreateSqlQuery","body":"<p>I have not mapped geography table in sql server 2008, and I want to query it with a polygon instance in c# using nhibernate.\n<br>In the beggining I was trying to use sql server spatial directly but encountered this problem:\n<a href=\"http://stackoverflow.com/questions/238050/using-sql-server-2008-geography-types-with-nhibernates-createsqlquery\">Using SQL Server 2008 Geography types with nHibernate&#39;s CreateSQLQuery</a>\n<p>My second try was this:</p>\n\n<pre><code>session.CreateSQLQuery(\"select [shape] from [table] where (:codeShape).STIntersects([shape]) = 1\").SetParameter(\"codeShape\", codeShape, NHibernateUtil.Custom(typeof(MsSql2008GeographyType)));\n</code></pre>\n\n<p>however this try also raise an exception:\n<br></p>\n\n<pre><code>Could not execute query [select [shape] from [table] where (?).STIntersects([shape]) = 1\")] Name:codeShape - Value:POLYGON((30 40, ...))\n</code></pre>\n\n<p><p>and the inner exception is:<br></p>\n\n<pre><code>The specified input does not represent a valid geography instance.\n</code></pre>\n\n<p>That's despite codeShape.IsValid returns true.</p>\n\n<p>When I run this query directly in sql server I get the expected result.</p>\n\n<p>any ideas or solutions?</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","sql","sql-server","port","sqlclient"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":13214174,"title":"Is the port automatically gathered from SQL Server?","body":"<p>I've noticed that if I don't supply a port when I build a connection string I can still connect to SQL Server via a named instance that looks like [SERVER][INSTANCE_NAME].</p>\n\n<p>Is sqlclient automatically gathering the port number for me? Do I have to concern myself with port number even if the instance is the default instance?</p>\n\n<p>I'm sorry if this question seems novice. Google just hasn't turned anything up for me.</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql-server","stored-procedures","jdbc"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":5562,"score":2,"question_id":858631,"title":"What can cause the SQL Server JDBC error 'The value is not set for the parameter number 0' for an output parameter access?","body":"<p>I have some Java code that accesses SQL Server 2005 which looks something like this:</p>\n\n<pre><code>CallableStatement cstmt = ...;\n... // Set input parameters\ncstmt.registerOutParameter(11, Types.INTEGER);\ncstmt.execute();\nint out = cstmt.getInt(11);\n</code></pre>\n\n<p>And the following exception is thrown from the last line:</p>\n\n<pre><code>com.microsoft.sqlserver.jdbc.SQLServerException: The value is not set \n     for the parameter number 0.\n   at com.microsoft.sqlserver.jdbc.SQLServerException.\n     makeFromDriverError(Unknown Source)\n   at com.microsoft.sqlserver.jdbc.SQLServerCallableStatement.\n     skipOutParameters(Unknown Source)\n   at com.microsoft.sqlserver.jdbc.SQLServerCallableStatement.\n     getOutParameter(Unknown Source)\n   at com.microsoft.sqlserver.jdbc.SQLServerCallableStatement.\n     getterGetParam(Unknown Source)\n   at com.microsoft.sqlserver.jdbc.SQLServerCallableStatement.\n     getInt(Unknown Source)\n   at org.jboss.resource.adapter.jdbc.WrappedCallableStatement.\n     getInt(WrappedCallableStatement.java:192)\n</code></pre>\n\n<p>The stored procedure being called looks something like this:</p>\n\n<pre><code>CREATE PROCEDURE dbo.stored_proc ( -- 10 input parameters\n                                 , @out_param INT OUTPUT) AS\n\n-- Variable declarations \n\nSET @out_param = 0\n\n-- Do processing...\n\nSET @out_param = 1\n</code></pre>\n\n<p><strong>Since the output parameter is set to zero on entry to the stored procedure, under what circumstances could the value not be set? Or am I misinterpreting the error message?</strong></p>\n\n<p>This error is reproducible with:</p>\n\n<ul>\n<li>SQL Server JDBC Driver 1.2</li>\n<li>SQL Server 2005 (64-bit) service pack 2</li>\n<li>SQL Server 2005 (64-bit) service pack 3</li>\n</ul>\n\n<p><strong>Update:</strong> It seems to be occuring as a result of the <code>-- Do processing...</code> part of the stored procedure. Removing this eliminates the error. There's too much code to reproduce here, what I'd like is some pointers to possible causes to narrow down likely candidates.</p>\n\n<p><strong>Update:</strong> Injecting errors (e.g. divide by zero) into the <code>-- Do processing...</code> part of the stored procedure <em>does not</em> cause this exception to be thrown (instead, as expected, the <code>execute()</code> call fails with an appropriate error message).</p>\n\n<p><strong>Update:</strong> Decompiling the com.microsoft.sqlserver.jdbc.SQLServerCallableStatement class suggests that 'parameter number 0' is the stored procedure <em>return value</em>.</p>\n\n<p><strong>Update:</strong> I have been unable to reproduce this by calling the stored procedure directly through Management Studio.</p>\n\n<p><strong>Update:</strong> The ultimate cause of this error seems to be a <strong>deadlock in the stored procedure</strong>. Usually, however, deadlocks cause the <code>execute()</code> call to fail with a <code>SQLException</code> wrapping SQL Server error code 1205...</p>\n"},{"tags":["sql-server","visual-studio-2010","mdf"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2494,"score":2,"question_id":3662437,"title":"sql server mdf file database attachment","body":"<p>hello all i'm having a bear of a time getting visual studio 2010 (ultimate i think) to properly attach to my database.  it was moved from original spot to #MYAPP#/#MYAPP#.Web/App_Data/#MDF_FILE#.mdf.  I have three instances of sql server running on this machine.  i have tried to replace the old mdf file with my new one and cannot get the connectionstring right for it.  </p>\n\n<p>what i'm really wanting to do is to just open some DB instance, run a DB create script.  Then I can have a DB that was generated via my edmx (generate database from model) in silverlight business application (c#)</p>\n\n<p>right now, when i go to server explorer in VS, choose add new connection, choose MS SQL Server Database FIle (SqlClient), choose my file location (app_data directory), use windows authentication, and hit the Test Connection button I get the following error:</p>\n\n<p>Unable to open the physical file \"\".  Operating system error 5:  \"5(Access Denied.)\".  An attempt to attach to an auto-named database for file\"\" failed.  A database with the same name exists, or specified file cannot be opened, or it is located on UNC share.</p>\n\n<p>The mdf file was created on the same machine by connecting to (local) on the sql server management studio, getting a new query, pasting in the SQL from the generated ddl file, adding a CREATE DATABASE [NcrCarDatabase]; GO before the pasted SQL, and executing the query.  I then disconnected from the DB in management studio, closed management studio, navigated to the DATA directory for that instance, and copying the mdf and ldf files to my application's app_data folder.  I am then trying to connect to the same file inside visual studio.  </p>\n\n<p>I hope that gives more clarity to my problems :).</p>\n\n<p>Connection string is:</p>\n\n<blockquote>\n  <p>Data\n  Source=.\\SQLEXPRESS;AttachDbFilename=C:\\SourceCode\\NcrCarDatabase\\NcrCarDatabase.Web\\App_Data\\NcrCarDatabase.mdf;Integrated\n  Security=True;Connect Timeout=30;User\n  Instance=True</p>\n</blockquote>\n"},{"tags":["sql","sql-server","stored-procedures"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":291,"score":2,"question_id":7421074,"title":"Is it possible to create a stored procedure with two insert statements where id/primary_key from the first insert statement will be used in second?","body":"<p>I see that there is a very similiar question already answered that discusses this same issue, but i just cannot seem to understand it. Below is a copy of my code that is in a stored procedure.  I need to somehow, have the second insert statement insert the CompanyID generated from the first, into this second Statement.  I appreciate any help i can get.</p>\n\n<p>Thank You!!</p>\n\n<pre><code>@comp_name nvarchar (50),\n@City nvarchar (50),\n@State nvarchar (10),\n@Address ntext,\n@Zip_Code nvarchar (50),\n@Country nvarchar (50),\n@cust_name nvarchar (50),\n@CompanyID int\nAS\nINSERT INTO Company_Listing\n(comp_name, City, State, Address, Zip_Code, Country)\nVALUES (@comp_name, @City, @State, @Address, @Zip_Code, @Country)\n\nINSERT INTO Customer_Listing\n(cust_name, City, State, Address, Zip_Code, Country, CompanyID)\nVALUES (@comp_name,@City,@State,@Address,@Zip_Code,@Country,@CompanyID)\n</code></pre>\n"},{"tags":["c#","sql-server",".net-2.0","sqlclient"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13198979,"title":"Workaround for missing .TypeName of SqlParameter in plain .NET 2","body":"<p>In plain .NET2 Framework (no service packs) there is no property</p>\n\n<pre><code>System.Data.SqlClient.SqlParameter.TypeName\n</code></pre>\n\n<p>My app is built on a machine with .NET2 SP1 installed. It is executed in hundreds of other machines and some of them do not have .NET2 SP1, and probably they won't install them so they get this exception:</p>\n\n<pre><code>Method not found: 'Void System.Data.SqlClient.SqlParameter.set_TypeName(System.String)'\n</code></pre>\n\n<p>From the c# code I execute SQL scripts (NO stored procedure calls, just sql scripts) that use DataTable objects as inputs, and this means you have to define the table-valued parameter's name from c# code (When executing stored procedures, this name is defined on the procedure's declaration, and you don't have to define it again). Apparently, I can't do this when .NET2 SP1 is not installed.</p>\n\n<p>My question is:</p>\n\n<p><strong>Is there a way to define the Table-valued parameter's name from C# code using plain .NET2 framework (No SP1 installed)??\nHow can I execute simple sql scripts that use table-valued inputs from c# code, without having the SP1 of .NET2?</strong></p>\n"},{"tags":["c#","sql-server","sql-server-2008-r2","smo"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":58,"score":0,"question_id":13144631,"title":"Using SMO in C# to backup SQL Server database","body":"<p>I'm developing a simple utility which is going to create a <code>*.bak</code> file from a SQL Server database. </p>\n\n<p>If database has a quite small size, less than 50 Mb, then there is no problem, it's working well. But potentially I'm going to work with big databases of 2-3Gb data size. </p>\n\n<p>Since it's impossible (I guess) to keep such a big data in the memory to create <code>*.bak</code> file, would my utility still work in this case? </p>\n"},{"tags":["sql-server","tsql","case"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":13213055,"title":"Altering a CASE statement to handle NULL values?","body":"<p>I'm in need of help modifying an existing case statement that has to be changed to accommodate the possibility of a null value.</p>\n\n<p>Currently, the statement is as follows:</p>\n\n<pre><code>CASE WHEN \n  DATEDIFF(dd, table.OpenDate, GetDate()) - table.Days_as_Integer) &gt; 0 THEN \n   DATEDIFF(dd, table.OpenDate, GetDate()) - table.Days_as_Integer \n  ELSE NULL END \nAS Days_Past_Due\n</code></pre>\n\n<p>I just want to change the existing CASE statement to be able to handle a null table.OpenDate field, returning a NULL as Days_Past_Due. Is there an easy way to do this?</p>\n\n<p>Thanks!!!</p>\n"},{"tags":["sql","sql-server","tsql","pivot","pivot-without-aggregate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13212883,"title":"How can I PIVOT this data?","body":"<p>First, sorry for the middling title.  Didn't have a ton of success on that front.</p>\n\n<p>So - I have a table of data that has one row for each volunteer shift a person is scheduled for.  Many people, being generous with their time, have signed up for multiple shifts.  What I would like is to PIVOT this data s.t. I end up with one row per <em>person</em>, with sets of columns for each shift.  I've spent about 90 minutes on this so far, but can't figure out how to PIVOT without an aggregation function applied.</p>\n\n<p>What I mean by this is that each person is scheduled for at least one shift, so each person's row would have their unique ID, their name, their phone number, and their region.  Then there would be a set of columns for Shift1 - role/status/start time/end time/etc. - which everyone would have filled out since everyone has signed up for at least one shift.  Then, the Shift2 set of columns would be populated for people who have signed up for 2+ shifts, Shift3 for people who signed up for 3+ shifts, etc.</p>\n\n<p>My current table schema:</p>\n\n<pre><code>CREATE TABLE [dbo].[confirmexport](\n    [PersonID] [int] NULL,\n    [EventType] [varchar](14) NULL,\n    [Shift] [varchar](10) NULL,\n    [StartDate] [datetime] NULL,\n    [StartTime] [datetime] NULL,\n    [EndDate] [datetime] NULL,\n    [EndTime] [datetime] NULL,\n    [Location] [varchar](39) NULL,\n    [Role] [varchar](16) NULL,\n    [Status] [varchar](9) NULL,\n    [FirstName] [varchar](20) NULL,\n    [LastName] [varchar](22) NULL,\n    [Phone] [bigint] NULL,\n    [Region] [varchar](9) NULL\n) ON [PRIMARY]\n</code></pre>\n\n<p>All columns but <code>PersonID</code>, <code>FirstName</code>, <code>LastName</code>, <code>Phone</code>, and <code>Region</code> are shift-specific.</p>\n\n<p>In an ideal world, I'd end up with a table that looked something like so:</p>\n\n<pre><code>CREATE TABLE [dbo].[confirmexportpivoted](\n    [PersonID] [int] NULL,\n    [Phone] [bigint] NULL,\n    [FirstName] [varchar](20) NULL,\n    [LastName] [varchar](22) NULL,\n    [Region] [varchar](9) NULL,\n    [EventType1] [varchar](14) NULL,\n    [Shift1] [varchar](10) NULL,\n    [StartDate1] [datetime] NULL,\n    [StartTime1] [datetime] NULL,\n    [EndDate1] [datetime] NULL,\n    [EndTime1] [datetime] NULL,\n    [Location1] [varchar](39) NULL,\n    [Role1] [varchar](16) NULL,\n    [Status1] [varchar](9) NULL,\n    [EventType2] [varchar](14) NULL,\n    [Shift2] [varchar](10) NULL,\n    [StartDate2] [datetime] NULL,\n    [StartTime2] [datetime] NULL,\n    [EndDate2] [datetime] NULL,\n    [EndTime2] [datetime] NULL,\n    [Location2] [varchar](39) NULL,\n    [Role2] [varchar](16) NULL,\n    [Status2] [varchar](9) NULL\n) ON [PRIMARY]\n</code></pre>\n\n<p>Except with as many sets of columns as necessary for my data.  OR - if that's a deal-breaker, I can definitely make do with 3.  Any suggestions?</p>\n\n<p>Thanks in advance - I am super-confused and would appreciate any and all help.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13213277,"title":"Noob Concern: T-SQL sub-queries","body":"<p>I've got a table <code>bbc</code> with the following columns:</p>\n\n<ul>\n<li><code>name</code> (refers to a name of a country within a particular region of the world)  </li>\n<li><code>region</code> (continent of the world)  </li>\n<li><code>population</code> (population of the country in the name name field)  </li>\n</ul>\n\n<p>The question I'm trying to answer:  </p>\n\n<p><em>Find each country that belongs to a region where all populations are less than 250000000.  Show name, region and population.</em></p>\n\n<p>I was thinking the answer might be something like:  </p>\n\n<pre><code>SELECT name, region, population \nFROM bbc \nGROUP by region \nHAVING MAX(population) &lt; 250000000 \n</code></pre>\n\n<p>I get the feeling I am way off course with this answer... any help would be appreciated!  </p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":24,"score":2,"question_id":13137455,"title":"Amazon MWS - Testing / Sandbox / Production","body":"<p>I am currently developing an application which uses the Amazon MWS. To integrate the API's with my application, I need to carry out testing. Amazon advised that as they do not have a sandbox account that this testing needed to be completed on the production site. Have since been advised that my seller account has been closed due to poor performance (for not despatching the products to myself :-)) and that I will not be able to create another account. Does anyone know of a way around this? </p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":313,"score":3,"question_id":3872173,"title":"Compare when value could be both NULL or text","body":"<p>Now I know you can't directly compare NULL to anything (as null is unknown) so how would I achieve the following:</p>\n\n<pre><code>select  *\n    from    Material as m\n    where   MtrlCode = 826 and\n            Exposlimit &lt;&gt; 'compareMe'\n</code></pre>\n\n<p>Where Exposlimit MAY be NULL or it may not be.\n'compareMe' may also be NULL.</p>\n\n<p>Therefore how do I compare the two?  Both sides could be either text or NULL.</p>\n"},{"tags":["php","sql-server","database"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":557,"score":0,"question_id":2407670,"title":"Store image data type using PHP","body":"<p>I have an SQL Server database with following table.</p>\n\nTable PROMO, column:\n\n<ul>\n<li>code , varchar(10)</li>\n<li>name , varchar(10)</li>\n<li>image_data, image</li>\n<li>desc , text</li>\n</ul>\n\n<p>How do I insert an image file as a binary into SQL&nbsp;Server using PHP <a href=\"http://en.wikipedia.org/wiki/PHP#History\" rel=\"nofollow\">PDO</a>? The image will be stored in column <strong>image_data</strong>.</p>\n\n<p>What type of variable should I pass to the PDO parameter?</p>\n\n<pre><code>$stmt = $conn-&gt;prepare($query, array(\n    ':code'        =&gt; $code,\n    ':name'        =&gt; $name,\n    ':image_data'  =&gt; $imageData,\n    ':desc'        =&gt; $desc\n));\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13211268,"title":"returning total records in cte","body":"<p>With help from <a href=\"http://pratchev.blogspot.com/2008/11/paging-with-ranking-functions.html?m=1\" rel=\"nofollow\">article here</a> and recent answers from SO experts I have arrived with the following which will help me efficiently page through a set of records.</p>\n\n<p>I think my last couple of questions are </p>\n\n<ol>\n<li>See how I include the <code>Total Number of Records</code> in the payload at the end\nof SQL CTE called 'Total'. Is that how you would do this? </li>\n<li>Any other suggestions? Potential areas for being more concise or improvements? <code>Return Total Number of Pages</code></li>\n</ol>\n\n<hr>\n\n<pre><code>DECLARE @page_size INT = 5;\nDECLARE @page_nbr INT = 4;\nDECLARE @search NVARCHAR(MAX) = '';\nDECLARE @sort_order INT = 2;\n\nWITH AllProducts\nAS\n(\nSELECT *, \nCASE @sort_order\n    WHEN 1 THEN ROW_NUMBER() OVER ( ORDER BY ProductID )\n    WHEN 2 THEN ROW_NUMBER() OVER ( ORDER BY ProductName )\nEND AS 'Seq'    \nFROM Products\n),\nFiltered\nAS\n(\nSELECT * FROM AllProducts\nWHERE ProductName like '%'+@search+'%'\nOR\n@search is null\n)\nSELECT (select COUNT(*) from Filtered) as 'Total', * FROM Filtered\nWHERE seq &gt; (@page_nbr - 1) * @page_size\n  AND seq &lt;= @page_nbr * @page_size\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3823,"score":3,"question_id":3702576,"title":"SQL if no rows are returned do this","body":"<p>I have a select statement and I want to say if this select statement does not return any rows then put a '' in every cell. How do I do this?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3803,"score":3,"question_id":1344401,"title":"How can I drop all indexes in a SQL database with one command?","body":"<p>So, how can I drop all indexes in a SQL database with one command?   I have this command that will get me all the 20 or so drop statements, but how can I run all of those drop statements from this \"result set\"?</p>\n\n<pre><code>select * from vw_drop_idnex;\n</code></pre>\n\n<p>Another variation that gives me the same list is:</p>\n\n<pre><code>SELECT  'DROP INDEX ' + ix.Name + ' ON ' + OBJECT_NAME(ID)  AS QUERYLIST\nFROM  sysindexes ix\nWHERE   ix.Name IS NOT null and ix.Name like '%pre_%'\n</code></pre>\n\n<p>I tried to do \"exec(select cmd from vw_drop_idnex)\" and it didn't work.  I am looking for something that works like a for loop and runs the queries one by one.</p>\n\n<h2>-----------------------</h2>\n\n<p>With Rob Farleys help, final draft of the script is:</p>\n\n<pre><code>declare @ltr nvarchar(1024);\nSELECT @ltr = ( select 'alter table '+o.name+' drop constraint '+i.name+';'\n  from sys.indexes i join sys.objects o on  i.object_id=o.object_id\n  where o.type&lt;&gt;'S' and is_primary_key=1\n  FOR xml path('') );\nexec sp_executesql @ltr;\n\ndeclare @qry nvarchar(1024);\nselect @qry = (select 'drop index '+o.name+'.'+i.name+';'\n  from sys.indexes i join sys.objects o on  i.object_id=o.object_id\n  where o.type&lt;&gt;'S' and is_primary_key&lt;&gt;1 and index_id&gt;0\nfor xml path(''));\nexec sp_executesql @qry\n</code></pre>\n"},{"tags":["sql-server","hibernate","sql-server-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13211170,"title":"Hibernate configuration for MS SQL Server 2012 Standard","body":"<p>i am new to hibernate and need to configure it for MS SQL-server 2012 standard.\ni found this deprecated article <a href=\"http://stackoverflow.com/questions/3585544/how-to-configure-hibernate-config-file-for-sql-server\">how to configure hibernate config file for sql server</a> but i need a new one. where i can find the driver for the new database (if there is any)!\nthanks for answers</p>\n"},{"tags":["sql-server","replication","sql-server-2012","amazon-rds"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12788206,"title":"How to replicate(or similar) SQL Server on RDS?","body":"<p>Apparently Amazon RDS does not support replication for SQL Server (using 2012, but 2012 and 2008 both unsupported).</p>\n\n<p>What solutions are available for SQL Server in a case like this if I want a backup running in case amazon goes down?(as they have in the past a few times)</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13210915,"title":"dynamic order by conversion error","body":"<p>I'm trying to do a dynamic order by on pubs database and getting the following error\nwhen I try to use <code>@sort_order = 2</code></p>\n\n<p>Msg 245, Level 16, State 1, Line 6\nConversion failed when converting the nvarchar value 'Pavlova' to data type int.</p>\n\n<p><a href=\"http://www.sqlteam.com/article/dynamic-order-by\" rel=\"nofollow\">This is the article</a></p>\n\n<pre><code>SELECT * FROM Paging\nWHERE seq &gt; (@page_nbr - 1) * @page_size\n  AND seq &lt;= @page_nbr * @page_size\nORDER BY CASE\n    WHEN @sort_order = 1 THEN ProductID\n    WHEN @sort_order = 2 THEN ProductName\n    ELSE CategoryID\nEND\n</code></pre>\n"},{"tags":["sql-server","replication","merge-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13209014,"title":"How to get Merge Push Subscription status?","body":"<p>I have Merge replication setup with Push subscriptions.\nI read the following article: <a href=\"http://www.sqlrepl.com/sql-server/implementing-a-replication-agent-progess-bar/\" rel=\"nofollow\">Implementing a replication agent progress bar</a>\nIt is working fine if I initiate the agent from the subscriber, but the Status event of the MergeSynchronizationAgent Class is showing only status updates for the sessions that the client has initiated!\nIn short: I am looking for the same behavior that the default replication windows shows.</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13210014,"title":"performing a loop operation in SQL server query","body":"<p>I' writing a search function in C# SQL Server, my users can select multiple job groups and this function should check all of the selected group ids in my job table, how can I perform a loop operation in SQL Server? this is my table general schema:</p>\n\n<pre><code>id int, jobname varchar, jobgroup int.....\n</code></pre>\n\n<p>I use following query to select my jobs (based on jobgroup):</p>\n\n<pre><code>select * from tblJobs where jobgroup='\"+userGroups+\"'\n</code></pre>\n\n<p>this can be true only when userGroups contains one value, but my users can select several group ids, for instance my userGroups can be something like this: 5,7,10,20 (userGroups can contain much more values)</p>\n\n<p>how should I perform a loop operation in my query so that I can have all matching jobs?\nshould I concatenate returned values of several queries each selecting one group ID? I think there are better ways</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":58,"score":4,"question_id":13210783,"title":"MS SQL SERVER 2008 R2 Refuses connections after some time","body":"<p>First of all i would like to tell you that the program i'm working with is already compiled and i can't look at the source code.</p>\n\n<p>So, here's my problem:</p>\n\n<p>The applications successfully opens about 31 connections to a specific database.\nWhen it attempts to open connection 32, all connections start to close, including the previous 31 connections.</p>\n\n<p>To be honest, i don't know why this applications needs that many connections open to the same 2-3 tables, but after all connections are closed the application closes too.</p>\n\n<blockquote>\n  <p>17:41:38 004db680 DRIVER={SQL\n  Server};SERVER=192.168.1.8:1433;UID=user;PWD=password;DATABASE=database</p>\n\n<pre><code>17:41:38 004db680 08001 0000000e [Microsoft][ODBC SQL Server Driver][DBNETLIB]Invalid connection. 0x00000000 17:41:38 004db680\n</code></pre>\n  \n  <p>01000 0000000e [Microsoft][ODBC SQL Server\n  Driver][DBNETLIB]ConnectionOpen (ParseConnectParams()). 0x00000000</p>\n</blockquote>\n\n<p>That's the log output from that application.</p>\n\n<p>Some additional info:</p>\n\n<ul>\n<li>Same problem with SYN Attack protections disabled</li>\n<li>Database maximum connections are 30k+</li>\n</ul>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":13162663,"title":"Application vs SQL server 2008 accounts issue","body":"<p>Good day all,</p>\n\n<p>I am studing the following case:</p>\n\n<p><strong>Scenario:</strong> An application connects to the production database(SQL server 2008) using  a generic \"SA\" user instead of the domain user. This is making traces\\logs\\organization harder, because everything is flagged as done by SA user!</p>\n\n<p>NOTE: In the application the domain user/password is used, the generic account is only regarding to the database.</p>\n\n<p><strong>Questions:</strong> What would be the best pratice in this case? every user should have an account to log in the database? (sql using windows authentication) there are +- 500 users is that an issue regarding to database performance? or a generic account is indicated?</p>\n\n<p>Many thanks!</p>\n"},{"tags":["sql","sql-server","performance","sql-server-2008","query"],"answer_count":4,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":35270,"score":7,"question_id":4193705,"title":"SQL Server SELECT LAST N Rows","body":"<p>This is a known question but the best solution I've found is something like:</p>\n\n<pre><code>SELECT TOP N *\nFROM MyTable\nORDER BY Id DESC\n</code></pre>\n\n<p>I've a table with lots of rows. It is not a posibility to use that query because it takes lot of time. So how can I do to select last N rows without using ORDER BY?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Sorry duplicated question of <a href=\"http://stackoverflow.com/questions/311054/how-do-i-select-last-5-rows-in-a-table-without-sorting\">this one</a></p>\n"},{"tags":["sql-server","smo","server-restart"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":405,"score":7,"question_id":3592309,"title":"Restart SQL Server instance using SMO","body":"<p>My C# application uses SMO to do various things with SQL Server instance chosen by a user. Particularly, it changes authentication mode:</p>\n\n<pre><code>ServerConnection conn = new ServerConnection(connection);\nServer server = new Server(conn);\n\nserver.Settings.LoginMode = ServerLoginMode.Mixed;\n</code></pre>\n\n<p>After changing login more instance should be restarted. However, I cannot find any way in SMO to restart selected instance.</p>\n\n<p>I've tried to google this, but only found a bunch of samples enumerating running services and comparing their names with SQL server service name. I did not like this way as it is error prone and relies on the way Microsoft currently names SQL server instances.</p>\n\n<p>Is there any way to restart chosen instance in SMO?</p>\n"},{"tags":["sql-server","windows","sql-server-2008","cluster-computing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13209412,"title":"SQL Server 2008 cluster cannot add possible owner to SQL Server/SQL Server Agent Resources","body":"<p>Setting up SQL Server 2008 failover cluster on Windows Server 2008 R2</p>\n\n<p>Created cluster (added 2 nodes <code>Node1</code>, <code>Node2</code>). Installed SQL Server 2008 on <code>Node 1</code>. It installed successfully and service came up. I am able to connect through management tool using virtual IP.</p>\n\n<p>Now when I want to add <code>Node 2</code>, instance name is not displayed during installation.</p>\n\n<p>When I further analyzed, I could see possible owners for both resources SQL Server, SQL Server Agent are just Node 1. Whereas other resources have both Node 1 and Node 2.</p>\n\n<p>I tried the thing below.</p>\n\n<pre><code>C:\\Users\\administrator.GENNEYS&gt;cluster.exe res \"SQL Server\" /addowner:GEN-C7-181\n\nAdding 'GEN-C7-181' to possible owners of 'SQL Server'...\n</code></pre>\n\n<blockquote>\n  <p><em>System error 5079 has occurred (0x000013d7). The specified node does\n  not support a resource of this type. This may be due to version\n  inconsistencies or due to the absence of the resource DLL on this\n  node.</em></p>\n</blockquote>\n\n<p>How should I add another Node to possible owners of SQL Server?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13208958,"title":"Sql get name and parent in while loop","body":"<p>I have a table called tblmodules which has 3 columns: moduleid,name,parent_id. The column parent_id takes values of other modules. ex:</p>\n\n<pre><code>Moduleid      Name       Parentid\n--------     -----       --------\n1           grandparent    Null\n2            parent         1\n3           child           2\n</code></pre>\n\n<p>I want a stored procedure that takes the parent's Id and Name of a child giving a level. So i develop the following. </p>\n\n<pre><code>        @moduleid bigint,\n    @level int\n\nAS\nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;\n\n    declare @parentid bigint\n    declare @name nvarchar(100)\n    set @parentid = (select parentid from tblModules where ModuleId = @moduleid)\n\n\n    declare @counter int\n    set @counter = 1\n\n    while @counter &lt; @level\n    begin\n\n        set @parentid = (select parentid from tblModules where ModuleId = @parentid)\n        set @name = (select Name from tblModules where ModuleId = @parentid)\n\n        set @counter = @counter + 1\n    end\n\n    select @parentid AS ID\n    select @name as Name\n\nend\n</code></pre>\n\n<p>The procedure works fine and gets the correct Id of the parent, but the name remains the same as the child. For ex i am executing it giving the values @moduleid: 3 and @level:2.\nI am getting result ID: 1 which is correct but Name: child instead of Grandparent. Any help?</p>\n"},{"tags":["sql-server","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13209260,"title":"SQL Server 2008 vs 2012","body":"<p>Locally, when I open SQL Server Management Studio 2012 I connect to my databases by server name of <code>{MyPCName}</code>.</p>\n\n<p>Now and then, always changing after a machine shutdown, this fails. If I change the server name to <code>{MyPCName}/SQLExpress</code>. </p>\n\n<p>It looks as though I have two versions of SQL Server installed. 2010, and 2011.</p>\n\n<p>Looking at the program logs, yesterday for example, when I could logon using <code>{MyPCName}</code> the SQL Server logs seem to have been updating the logs in the folder <code>MSSQL11.MSSQLSERVER</code>. Today the logs seem to be updating the logs in the folder <code>MSSQL10.SQLEXPRESS</code>.</p>\n\n<p>Looking in my installed programs list I appear to have SQL Server 2008 and 2012 installed.</p>\n\n<p>Is there a way to, either, be able to select which you connect to / remove version 2010?</p>\n\n<p>These are all Express versions by the way in case it makes any difference. ;-)</p>\n"},{"tags":["sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13209121,"title":"match if column is part of a value in Where clause","body":"<p>I have a question:</p>\n\n<p>I am trying to match a value (url) against a value in dbtable, column UrlPart.</p>\n\n<p>Let's say a column UrlPart in a row has the value 'id=12345'.</p>\n\n<p>Now I have a query:</p>\n\n<pre><code>select * from products\nwhere UrlPart [is part of] \n'http://www.domain.com/category/?id=12345&amp;referrer=www.google.com&amp;etcetera' \n</code></pre>\n\n<p>I would like to see the match [id=12345 [is part of] 'http://www.domain.com/category/?id=12345&amp; as true, so it will return the product row.</p>\n\n<p>Of course [Is part of] doesn't exist, but what I want to know if it is possible to match the value in the column against the expression of the url which will change for each request.\nLike a normal where statement but then reveresed.</p>\n\n<p>Is something like this possible with <code>SQL 2008 Express Edition</code> ?</p>\n\n<p>[UPDATE]</p>\n\n<p>I have tested the like '%' + UrlPart '%' and the CharIndex and according to MS SQL's exectution plan, they are identical. Seems that SQL does the same thing underwater, so both options are good.</p>\n\n<p>I would think that CharIndex might be a bit more raw then like (like might be converted) so I go for that one now.</p>\n\n<p>Thank you all.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13208411,"title":"Adding Column While Selecting Table in SQl","body":"<p>My First Table is ProjectCustomFields</p>\n\n<pre><code>CustomFieldId   ProjectId   CustomFieldName CustomFieldRequired CustomFieldDataType\n69  1   User Name   1   0\n72  1   City    1   0\n74  1   Email   0   0\n82  1   Salary  1   2\n</code></pre>\n\n<p>My Second Table is ProjectCustomFieldValues</p>\n\n<pre><code>CustomFieldValueId  ProjectId   CustomFieldId   CustomFieldValue    RecordId\n35  1   69  kaliya  1\n36  1   72  Bangalore   1\n37  1   74  mm@gmail.com    1\n41  1   69  Yohesh  2\n42  1   72  Delhi   2\n43  1   74      2\n50  1   69  sss 3\n51  1   72  Delhi   3\n52  1   74  sss@icsportal.in    3\n57  1   69  Sunil   4\n58  1   72  Mumbai  4\n59  1   74  sunil@icsportal.in  4\n60  1   82  20000   4\n</code></pre>\n\n<p>I tried Below Query </p>\n\n<pre><code>Select M.CustomFieldName\n,      N.CustomFieldValue\n,      N.RecordId \nFrom\n(\n    Select G.CustomFieldName\n    ,      H.RecordId \n    From\n    (\n        Select CustomFieldName \n        From ProjectCustomFields \n        Where ProjectId = 1\n    ) G \n    Cross Join\n    (\n        Select Distinct RecordId \n        From ProjectCustomFieldValues\n    ) H\n) M\nLeft Join \n(\n    Select CustFiled.CustomFieldName\n    ,      CustValue.CustomFieldValue\n    ,      CustValue.RecordId \n    From ProjectCustomFieldValues CustValue \n    Left Join ProjectCustomFields CustFiled  \n        On CustValue.CustomFieldId = CustFiled.CustomFieldId \n    Where CustValue.AuctionId = 1\n) N \n    On M.CustomFieldName = N.CustomFieldName \n    And M.RecordId       = N.RecordId\n</code></pre>\n\n<p>But I got the result below</p>\n\n<pre><code>#CustomFieldName#   CustomFieldValue    RecordId\nUser Name   kaliya  1\nCity    Bangalore   1\nEmail   mm@gmail.com    1\nSalary  NULL    **NULL**\nUser Name   Yohesh  2\nCity    Delhi   2\nEmail       2\nSalary  NULL    **NULL**\nUser Name   sss 3\nCity    Delhi   3\nEmail   sss@icsportal.in    3\nSalary  NULL    **NULL**\nUser Name   NULL    **NULL**\nCity    NULL    **NULL**\nEmail   NULL    **NULL**\nSalary  NULL    **NULL**\nUser Name   Sunil   4\nCity    Mumbai  4\nEmail   sunil@icsportal.in  4\nSalary  20000   4\n</code></pre>\n\n<p>But Expected Result is</p>\n\n<pre><code>CustomFieldName CustomFieldValue    RecordId\nUser Name   kaliya  1\nCity    Bangalore   1\nEmail   mm@gmail.com    1\nSalary  NULL    **1**\nUser Name   Yohesh  2\nCity    Delhi   2\nEmail       2\nSalary  NULL    **2**\nUser Name   sss 3\nCity    Delhi   3\nEmail   sss@icsportal.in    3\nSalary  NULL    **3**\nUser Name   Sunil   4\nCity    Mumbai  4\nEmail   sunil@icsportal.in  4\nSalary  20000   4\n</code></pre>\n\n<p>Please guide me some one,I tried so much but i got null value in recordId,So I need same recordId above one..</p>\n"},{"tags":["sql-server","sql-server-2008","visual-studio-2012","constraints","database-project"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13162538,"title":"Include default constraint names in generation of update script","body":"<p>I'm using a <strong>SQL Server Database Project</strong> with Visual Studio 2012 and have the following problem when comparing and generating an update script:</p>\n\n<p>In Visual Studio, I add a column with a default constraint, for example:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>[NewColumn] NVARCHAR(50) CONSTRAINT [DF_ExistingTable_NewColumn] NOT NULL DEFAULT N''\n</code></pre>\n\n<p>Unfortunately, the name of the default constraint does not appear when:</p>\n\n<ul>\n<li>Comparing (<em>Schema Compare</em>) my project with the actual database</li>\n<li>Generating an update script (from within the <em>Schema Compare</em>)</li>\n</ul>\n\n<p>The created update script contains the following script (no constraint name):</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>ALTER TABLE [dbo].[ExistingTable]\n    ADD [NewColumn] NVARCHAR (50) DEFAULT N'' NOT NULL;\n</code></pre>\n\n<p>This seems like a major oversight, so I'm wondering where to find the magic switch to include the names of default constraints in all database operations.</p>\n"},{"tags":["asp.net","sql-server","kendo-ui"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":48,"score":-3,"question_id":13207050,"title":"Dynamically bind data from database","body":"<p>I have a textbox, dropdownlist,textarea,checkbox and kendoui editor. I want to dynamically bind data from database. And on click of save button save data to database, update button to update data, clear to clear the fields. But i dont know how to perform operation from database.Please give me worked out examples.Please help me i want it urgently</p>\n\n<pre><code>My code is\n\n&lt;title&gt;Untitled Page&lt;/title&gt;\n\n&lt;link href=\"CSS/kendo.common.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n&lt;link href=\"CSS/kendo.dataviz.min.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n&lt;link href=\"CSS/kendo.mobile.all.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n\n\n&lt;link href=\"CSS/kendo.default.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n\n\n\n&lt;script src=\"Js/jquery1.7.1.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n\n&lt;script src=\"CSS/kendo.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;script type=\"text/javascript\"&gt;\n$(document).ready(function(){\n$(\"#multi\").kendoDropDownList();\n\n $(\"#editor\").kendoEditor();\n });\nfunction btnClear_onclick() {\n\n}\n\nfunction btnUpdate_onclick() {\n\n}\n\nfunction btnSave_onclick() {\n\n}\n\n&lt;/script&gt;\n&lt;form id=\"form1\" runat=\"server\"&gt;\n&lt;div&gt;\n   Select Template: &lt;select id=\"multi\"  runat=\"server\" &gt;\n &lt;/select&gt;\n&lt;/div&gt;\n&lt;br /&gt;\n&lt;div&gt;\nTemplate Name: &lt;input type=\"text\"  name=\"Name\" runat=\"server\" /&gt;\n&lt;/div&gt;\n&lt;div&gt;\nDescription:&lt;textarea name=\"comments\" cols=\"25\" rows=\"5\" runat=\"server\"&gt;\n\n&lt;/textarea&gt;\n&lt;br /&gt;\n\n&lt;/div&gt;\n&lt;div&gt;\nActive: &lt;input type=\"checkbox\" name=\"vehicle\" runat=\"server\" /&gt;\n&lt;/div&gt;\n&lt;div id=\"example\" class=\"k-content\"&gt;\n&lt;textarea id=\"editor\" rows=\"10\" cols=\"30\" style=\"width:740px;height:440px\"   \nrunat=\"server\"&gt;&lt;/textarea&gt;\n&lt;/div&gt;\n\n&lt;div&gt;\n&lt;button type=\"button\"  id=\"btnSave\" onclick=\"return btnSave_onclick()\"&gt;Save&lt;/button&gt;\n&lt;button type=\"button\" id=\"btnUpdate\" onclick=\"return \nbtnUpdate_onclick()\"&gt;Update&lt;/button&gt;\n&lt;button type=\"button\" id=\"btnClear\" onclick=\"return btnClear_onclick()\"&gt;Clear&lt;/button&gt;\n&lt;/div&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n\n\nMy database table is Templates\nID  int Unchecked\nName    varchar(100)    Checked\nDescription varchar(MAX)    Checked\n</code></pre>\n\n<p>[Content]    nvarchar(MAX)   Checked\n    Active  bit Checked\n        Unchecked</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5787,"score":0,"question_id":5435090,"title":"SQL Server was not found or was not accessible","body":"<p>What is the problem below?</p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)</p>\n  \n  <p>Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </p>\n  \n  <p>Exception Details: System.Data.SqlClient.SqlException: A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)</p>\n</blockquote>\n\n<p>How can this be solved?</p>\n"},{"tags":["sql","sql-server","syntax"],"answer_count":6,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":16403,"score":2,"question_id":1267427,"title":"SQL: Insert all records from one table to another table without specific the columns","body":"<p>I want to insert all the record from the back up table foo_bk into foo table without specific the columns.</p>\n\n<p>if i try this query</p>\n\n<pre><code>INSERT INTO foo \nSELECT *\nFROM foo_bk\n</code></pre>\n\n<p>i'll get error \"Insert Error: Column name or number of supplied values does not match table definition.\"</p>\n\n<p>Is it possible to do bulk insert from one table to another without supply the column name?\nI've google it but can't seem to find an answer. all the answer require specific the columns.</p>\n"},{"tags":["php","sql-server","time","microtime"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13207956,"title":"Get Server time and insert into Mysql table via a Form","body":"<p>I have a form that posts the Date, Title, Message and Image into an SQL table. It all works fine, except the form, it has a field that I have to manually enter the date and time.</p>\n\n<p>What I want to know is how can I get the PHP to get the date &amp; time (GMT time) of when the form button is pressed and post it into the \"time\" section of my sql table instead of me doing it manually, I'm using this as a ultra lightweight CMS blog.</p>\n\n<p>This is my insert.php</p>\n\n<p><code>mysql_query(\"INSERT INTO Blog\n(Date, Title, Message, Image) \nVALUES('$_POST[Date]', '$_POST[Title]' , '$_POST[Message]' , '$_POST[Image]' ) \")\nor die(mysql_error()); </p>\n\n<p>echo \"1 record added\";</code></p>\n\n<p>This is my form\n<code></p>\n\n<pre><code>&lt;form action=\"insert.php\" method=\"post\"&gt;\n&lt;span class=\"label\"&gt;Date:       &lt;/span&gt;     &lt;input type=\"text\" class=\"dateField\" name=\"Date\" /&gt;\n&lt;span class=\"label\"&gt;Title:      &lt;/span&gt;     &lt;input type=\"text\" class=\"titleField\" name=\"Title\" /&gt;\n&lt;span class=\"label\"&gt;Message:    &lt;/span&gt;     &lt;textarea  name=\"Message\" class=\"messageField\" maxlength=\"1000\" cols=\"0\" rows=\"0\"&gt;&lt;/textarea&gt;\n&lt;span class=\"label\"&gt;Image URL:      &lt;/span&gt;     &lt;input type=\"text\" class=\"ImageField\"  name=\"Image\" /&gt;\n&lt;input type=\"submit\" class=\"submitBtn\"/&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p></code></p>\n\n<p>I want the server to add the Time/Date instead of me typing it in manually. Is this easily done?</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2005","gridview"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13207520,"title":"Pagination through Sql query","body":"<p>I am developing an application in which am using grid view. I want to use pagination for that grid view by using sql query.</p>\n\n<p>I want to display records with the help of <code>pagesize</code> and <code>pageindex</code>. </p>\n\n<p>How can I do this with sql query?</p>\n"},{"tags":["asp.net","sql-server","kendo-ui"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":51,"score":-1,"question_id":13207670,"title":"Updating and saving data to database on button click","body":"<p>I have a textbox, dropdownlist,textarea,checkbox and kendoui editor. I want to dynamically bind data from database. And on click of save button save data to database, update button to update data, clear to clear the fields. But i dont know how to perform operation from database.Please give me worked out examples.Please help me i want it urgently</p>\n\n<pre><code>My code is\n\n\n&lt;title&gt;Untitled Page&lt;/title&gt;\n\n&lt;link href=\"CSS/kendo.common.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n&lt;link href=\"CSS/kendo.dataviz.min.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n  &lt;link href=\"CSS/kendo.mobile.all.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n\n\n&lt;link href=\"CSS/kendo.default.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n\n\n\n&lt;script src=\"Js/jquery1.7.1.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n\n&lt;script src=\"CSS/kendo.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;script type=\"text/javascript\"&gt;\n$(document).ready(function(){\n$(\"#multi\").kendoDropDownList();\n\n$(\"#editor\").kendoEditor();\n });\nfunction btnClear_onclick() {\n\n}\n\nfunction btnUpdate_onclick() {\n\n}\n\nfunction btnSave_onclick() {\n\n}\n\n&lt;/script&gt;\n&lt;form id=\"form1\" runat=\"server\"&gt;\n&lt;div&gt;\nSelect Template: &lt;select id=\"multi\"  runat=\"server\" &gt;\n&lt;/select&gt;\n&lt;/div&gt;\n&lt;br /&gt;\n&lt;div&gt;\nTemplate Name: &lt;input type=\"text\"  name=\"Name\" runat=\"server\" /&gt;\n&lt;/div&gt;\n&lt;div&gt;\nDescription:&lt;textarea name=\"comments\" cols=\"25\" rows=\"5\" runat=\"server\"&gt;\n\n&lt;/textarea&gt;\n&lt;br /&gt;\n\n&lt;/div&gt;\n&lt;div&gt;\nActive: &lt;input type=\"checkbox\" name=\"vehicle\" runat=\"server\" /&gt;\n&lt;/div&gt;\n&lt;div id=\"example\" class=\"k-content\"&gt;\n&lt;textarea id=\"editor\" rows=\"10\" cols=\"30\" style=\"width:740px;height:440px\"   \nrunat=\"server\"&gt;&lt;/textarea&gt;\n&lt;/div&gt;\n\n&lt;div&gt;\n&lt;button type=\"button\"  id=\"btnSave\" onclick=\"return btnSave_onclick()\"&gt;Save&lt;/button&gt;\n&lt;button type=\"button\" id=\"btnUpdate\" onclick=\"return \n btnUpdate_onclick()\"&gt;Update&lt;/button&gt;\n&lt;button type=\"button\" id=\"btnClear\" onclick=\"return btnClear_onclick()\"&gt;Clear&lt;/button&gt;\n&lt;/div&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n\n\n My database table is Templates\n ID  int Unchecked\n Name    varchar(100)    Checked\n  Description varchar(MAX)    Checked\n [Content] nvarchar(MAX) Checked \n Active bit Checked Unchecked\n</code></pre>\n"},{"tags":["sql-server","vb.net","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13207479,"title":"Auto Suggestion textbox","body":"<p>I want to have a auto suggestion textbox which will show the name of employee after typing a specific letter. The name is present in the employee table in three columns i.e firstname, middlename, lastname.</p>\n\n<p>I have tried a code for this but it can show only one column of the table i.e the firstname.\nHow to concatenate all the three columns so that they are suggested in the textbox.</p>\n\n<p>My code:</p>\n\n<pre><code>Dim strSql As String = \"select P_Firstname, P_MiddleName, P_LastName from Patient_Registration\"\n        Dim dtb As New DataTable\n        Using cnn As New SqlConnection(conn)\n            cnn.Open()\n            Using dad As New SqlDataAdapter(strSql, cnn)\n                dad.Fill(dtb)\n            End Using\n            cnn.Close()\n        End Using\n        txtsearch.AutoCompleteMode = AutoCompleteMode.SuggestAppend\n        txtsearch.AutoCompleteSource = AutoCompleteSource.CustomSource\n        If dtb.Rows.Count &gt; 0 Then\n            Dim i As Integer = 0\n            For i = 0 To (dtb.Rows.Count - 1)\n                txtsearch.AutoCompleteCustomSource.Add(dtb.Rows(i)(\"P_FirstName\"))\n            Next\n        End If\n</code></pre>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":9,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3616,"score":1,"question_id":1647736,"title":"T-SQL - GROUP BY with LIKE - is this possible?","body":"<p>Is there a way to include a LIKE expression in a GROUP BY query?  For example:  </p>\n\n<pre><code>  SELECT Count(*) \n    from tblWhatever\nGROUP BY column_x [LIKE %Fall-2009%]\n</code></pre>\n\n<p>column_x:</p>\n\n<pre><code>--------\nBIOL-Fall_2009\nHIST Fall_2009\nBIOL Spring_2009\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>------\nFall_2009   2\nSpring_2009 1\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":54,"score":-1,"question_id":13207283,"title":"How to insert values into selected columns from c# coding?","body":"<p>I have a table in SQL Server which has many columns. Now I want to add values only in selected columns, but when I do this it raised the exception like this:</p>\n\n<blockquote>\n  <p>There are fewer columns in the INSERT statement than values specified\n  in the VALUES clause. The number of values in the VALUES clause must\n  match the number of columns specified in the INSERT statement.)</p>\n</blockquote>\n\n<p>How to handle this?</p>\n\n<p>This is my code:</p>\n\n<pre><code>SqlConnection con = getDbConnection();\nSqlCommand cmd = new SqlCommand(\"insert into pi_project_info(control#,pro_name,cust_name,cust_order,order_dt,req_dt,notes) values ('\" + tb_control.Text + \"','\" + tb_project.Text + \"','\" + ddl_customer_name.Text + \"','\" + tb_order_no.Text + \"','\" + dp_order.Text + \"','\" + dp_order.Text + \"','\" + dp_req_del.Text + \"','\" + tb_notes.Text + \"' )\", con);\n\n cmd.ExecuteNonQuery();\n MessageBox.Show(\"Saved successfully\");\n</code></pre>\n"},{"tags":["c#","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":42,"score":0,"question_id":13206784,"title":"Issue: SqlException was unhandled","body":"<p>I'm trying to execute my login form using a SQL Server database.. but I'm getting an error saying</p>\n\n<blockquote>\n  <p><em>Incorrect syntax near '</em>' </p>\n</blockquote>\n\n<p>The line where I am getting the error  is:</p>\n\n<pre><code>objda.Fill(objds, \"adm\");\n</code></pre>\n\n<p>and my code is:</p>\n\n<pre><code>public partial class Form1 : Form\n{\n    int total;\n    SqlConnection objc;\n    string c = \"data source=.; initial catalog=student; integrated security=SSPI\";\n    SqlDataAdapter objda;\n    DataSet objds;\n    SqlCommand objcmd;\n\n    public Form1()\n    {\n        InitializeComponent();\n    }\n\n    private void Form1_Load(object sender, EventArgs e)\n    {\n    }\n\n    private void button1_Click(object sender, EventArgs e)\n    {\n        if (objc != null)\n        {\n            objc.Open();\n        }\n        objcmd = new SqlCommand(\"select * form adm where Name= ' \" + textBox1.Text + \"',pass = ' \" + textBox2.Text + \"'\", objc);\n        if (objc != null)\n        {\n            objc.Close();\n        }\n        objc = new SqlConnection(c);\n        objcmd = new SqlCommand(\"search * from adm\", objc);\n        objda = new SqlDataAdapter(objcmd.CommandText, objc);\n        objds = new DataSet();\n        objda.Fill(objds, \"adm\");\n\n        total = Convert.ToInt32(objds.Tables[\"adm\"].Rows.Count);\n        if (total &gt; 0)\n        {\n            MessageBox.Show(\"welcome\");\n            Class1.login = textBox1.Text;\n            Form2 f2 = new Form2();\n            this.Hide();\n            f2.Show();\n        }\n        else\n        {\n        }\n</code></pre>\n\n<p>What should I do?</p>\n\n<p>Where is the problem?</p>\n"},{"tags":["c#","mysql","sql-server","ado.net"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":9572,"score":2,"question_id":1631054,"title":"Using SqlDataAdapter to insert a row","body":"<p>I want to insert a row into the Database using SqlDataAdapter. I've 2 tables (Custormers &amp; Orders) in CustomerOrders database and has more than thousand records. I want to create a GUI (TextBoxes) for adding new customer &amp; orders into the Database to their respective tables. </p>\n\n<ul>\n<li>How should I do it?</li>\n</ul>\n\n<p>I guess the method that is usually followed is </p>\n\n<pre><code>dataAdapter = new SqlDataAdapter (sqlQuery, conn);\ndataSet = new DataSet();\nda.Fill(dataSet);\n</code></pre>\n\n<p>Now take the values from textboxes (or use DataBinding) to add a new row into the dataSet and call</p>\n\n<pre><code>  da.Update(dataSet);\n</code></pre>\n\n<p>But the Question is Why should I fetch all other records into dataSet using da.Fill(dataSet ) in the first place? I just want to add a single new record.</p>\n\n<p>For this purpose what I'm doing is, Creating the schema of the Database in the DataSet. like this:</p>\n\n<pre><code>  DataSet customerOrders = new DataSet(\"CustomerOrders\");\n\n  DataTable customers = customerOrders.Tables.Add(\"Customers\");\n  DataTable orders = customerOrders.Tables.Add(\"Orders\");\n\n  customers.Columns.Add(\"CustomerID\", Type.GetType(\"System.Int32\"));\n  customers.Columns.Add(\"FirstName\", Type.GetType(\"System.String\"));\n  customers.Columns.Add(\"LastName\", Type.GetType(\"System.String\"));\n  customers.Columns.Add(\"Phone\", Type.GetType(\"System.String\"));\n  customers.Columns.Add(\"Email\", Type.GetType(\"System.String\"));\n\n  orders.Columns.Add(\"CustomerID\", Type.GetType(\"System.Int32\"));\n  orders.Columns.Add(\"OrderID\", Type.GetType(\"System.Int32\"));\n  orders.Columns.Add(\"OrderAmount\", Type.GetType(\"System.Double\"));\n  orders.Columns.Add(\"OrderDate\", Type.GetType(\"System.DateTime\"));\n\n  customerOrders.Relations.Add(\"Cust_Order_Rel\", customerOrders.Tables[\"Customers\"].Columns[\"CustomerID\"], customerOrders.Tables[\"Orders\"].Columns[\"CustomerID\"]);\n</code></pre>\n\n<p>I used DataBinding to bind these columns to respective text boxes.\nNow I'm confused! What should I do next? How to use Insert command? Because I didn't give any dataAdapter.SelectCommand so dataAdapter.Update() wont work I guess. Please suggest a correct approach.</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13204803,"title":"SQL Server : view column datatype does not change when underlying table datatype is changed?","body":"<p>If I have a table <code>MyTable</code> like this:</p>\n\n<pre><code>Value1 decimal\n</code></pre>\n\n<p>Then I have a view <code>MyView</code>:</p>\n\n<pre><code>Select SUM(Value1) as SumValue1 from MyTable\n</code></pre>\n\n<p>When I look at the view's column data type in SSMS under the view's columns section it is a decimal.</p>\n\n<p>Now if I modify the table to: </p>\n\n<pre><code>Value1 real\n</code></pre>\n\n<p>If I refresh the view's column section in SSMS the data type is still a decimal. Now if I open the view and resave it, the datatype becomes a float.</p>\n\n<p>Is this how it is supposed to be? It seems that the view doesn't change until I resave it.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","error-handling"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13205827,"title":"Msg 203, Level 16, State 2, is not a valid identifier","body":"<p>I'm getting the following error:</p>\n\n<blockquote>\n  <p><em>Msg 203, Level 16, State 2, Procedure getQuestion, Line 18</em><br>\n  The name 'select top(1) * from tlb_Question inner join tlb_options on tlb_options.qID=tlb_Question.id and tlb_Question.qNumber=1 and tlb_Question.id not in (0,1)' is not a valid identifier</p>\n</blockquote>\n\n<p>from the following stored procedure:</p>\n\n<pre><code>ALTER proc getQuestion\n    @qNo bigint,\n    @total bigint,\n    @next nvarchar(max)\nas\nbegin \n    declare @hisa bigint\n    set @hisa=@total/3\n\n    if(@qNo&lt;=@total/3)\n    begin\n    declare @query nvarchar(max)\n    set @query=('select top(1) * from tlb_Question \n        inner join tlb_options on tlb_options.qID=tlb_Question.id and tlb_Question.qNumber=1 and tlb_Question.id not in ('+cast(@next as varchar)+')')\n    print @query\n    execute @query\n    end\nend\n</code></pre>\n"},{"tags":["c#","sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":13206302,"title":"The DELETE statement conflicted with the REFERENCE constraint","body":"<p>In my project I am filling two database tables with two DataSets. The method which I am using to fill those database tables is shown  below:</p>\n\n<pre><code>SqlCommand sqlCommand = new SqlCommand();            \nSqlCommand command;\nusing (SqlConnection conn = new SqlConnection(strConn))\n{\n    using (SqlCommand cmd = new SqlCommand(strQuery, conn))\n    {\n        using (SqlCommand cmdReset = new SqlCommand(\"DBCC CHECKIDENT('Doctor', RESEED, 0)\", conn))\n        {\n            using (SqlCommand cmdUnCheck = new SqlCommand(\"alter table [dbo].[Doctor] nocheck constraint all\",conn))\n            {\n                using (SqlCommand cmdCheck = new SqlCommand(\"alter table [dbo].[Doctor] with check check constraint all\",conn))\n                {\n                    SqlDataAdapter da = new SqlDataAdapter(cmd);\n                    conn.Open();\n                    SqlTransaction sqlTransaction = conn.BeginTransaction();\n                    cmd.Transaction = sqlTransaction;\n                    cmdReset.Transaction = sqlTransaction;\n                    cmdUnCheck.Transaction = sqlTransaction;\n                    cmdCheck.Transaction = sqlTransaction;\n                    try\n                    {\n                        cmdUnCheck.ExecuteNonQuery();\n           /*ERROR*/    cmd.ExecuteNonQuery();\n                        cmdReset.ExecuteNonQuery();//deleting database table data\n                        foreach (DataRow dr in ds.Tables[0].Rows) //Inserting new data into the Database table\n                        {\n                            command = new SqlCommand(query.createDoctorRow(\"Doctor\",\n                            dr[1].ToString(), dr[2].ToString(), Convert.ToInt64(dr[3]), Convert.ToInt32(dr[4])), conn, sqlTransaction);\n                            command.ExecuteNonQuery();\n                        }\n                        cmdCheck.ExecuteNonQuery();\n                        sqlTransaction.Commit();\n                        conn.Close();\n                    }\n                    catch (Exception e)\n                    {\n                        sqlTransaction.Rollback();\n                        throw;\n                    }\n                }\n            }\n        }\n    }                \n}\n</code></pre>\n\n<p>The above code was working fine till the second Database table was empty but when I inserted some data in it and then run the code, VS is showing error --> </p>\n\n<blockquote>\n  <p>The DELETE statement conflicted with the REFERENCE constraint \"FK_Dr_ID\". The conflict occurred in database \"Hospital\", table \"dbo.Patient\", column 'Doctor_ID'.\n  The statement has been terminated.</p>\n</blockquote>\n\n<p>This seems clear that the foreign key is restricting the query to take place but as I am a beginner and dont know what to do I am asking your help..</p>\n\n<p>In the above code I made changes referring to this <a href=\"http://stackoverflow.com/a/1566552/1577396\">SO answer</a> but no joy, the error still exists at the same point.</p>\n\n<p><em>Optional</em>: Is there anyway to reduce the <code>using</code> statements in my code?</p>\n"},{"tags":["c#","asp.net","sql-server","json","session"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13206439,"title":"How to transfer big Json object to another page","body":"<p>i have a search page that let the user choose a lot of criteria to search with and a lot of them are client side (created on fly) so i decided to save them in a Json object so i can catch all client data easily .</p>\n\n<p>now i want to use these data to form a sql query so i can search with and display results in another page through a gird how to transfer it to another page with session or there is another suggestions to achieve that.</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":27,"score":3,"question_id":13206134,"title":"Combine multiple SQL queries in 1","body":"<p>I kinda got stuck at trying to combine a few queries.\nWhat I got is the table holding sort of statistics and reference to another table.</p>\n\n<p>to get statistics report I'm running (short version):</p>\n\n<pre><code>SELECT COUNT(id) \nfrom [Actions] \nwhere date between '2012-01-01 00:00:00' AND '2012-01-01 23:59:59' \n  AND [Action]='request'\n</code></pre>\n\n<p>The question is if I want to get every-day statistics during the specified time period, how should this query look like? I understand if I change start and end dates, I'll get statistics for the whole specified period and not grouped by day. What am I missing?</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":13091850,"title":"How to sort data before joining","body":"<p>Trying to do a diff of 2 tables with same data layout and have mismatch records on sameline</p>\n\n<pre><code>Table1                   Table2\n------                   ------\n\nCUSTOMER PART            CUSTOMER  PART\n\nCUSTID1  PART1           CUSTID1  PART1\nCUSTID1  PART2           CUSTID1  PART2\nCUSTID1  PART3           CUSTID1  PART3\nCUSTUD1  PART4\n\n\nSELECT T1.CUSTID, T1.PART, T2.CUSTID, T2.PART FROM TABLE1 AS T1\nLEFT JOIN TABLE2 AS T2 ON T1.CUSTID = T2.CUSTID\nWHERE  T1.PART &lt;&gt;  T2.PaRT\nORDER BY T1.CUSTID \n</code></pre>\n\n<p>Sometimes the output look like below - it shows a mismatch when there isn't one.\nCAn I order the tables before the join to get the data to line up ?</p>\n\n<p>Thanks</p>\n\n<pre><code>CUSTID1  PART1           CUSTID1  PART3\nCUSTID1  PART2           CUSTID1  PART1\nCUSTID1  PART3           CUSTID1  PART2\nCUSTUD1  PART4           NULL     NULL\n</code></pre>\n"},{"tags":["php","sql-server","pdo","doctrine","doctrine2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13205800,"title":"PDO_SQLSRV returns all results as strings","body":"<p>For SQL Server integer data types it seems PDO_SQLSRV returns strings whereas SQLSRV returns integers. My already written app does explicit checking (===) in several places so that means PDO_SQLSRV not a drop in replacement for SQLSRV. Normally I wouldn't be considering PDO - however Doctrine seems to use PDO and I couldn't find a Microsoft SQLSRV driver for it (enlighten me, please!)</p>\n\n<p>Here is the sample code with the responses:</p>\n\n<p><strong>PDO</strong></p>\n\n<pre><code>$sql = \"SELECT Top 1 * FROM Users\";\n$stmt = $conn-&gt;query($sql);\n$things = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);\nvar_dump($things);\n</code></pre>\n\n<p>Data: </p>\n\n<pre><code>'ID' =&gt; string '344' (length=3)\n'UserName' =&gt; string 'admin                 ' (length=30)\n</code></pre>\n\n<p><strong>SQLSRV</strong></p>\n\n<pre><code>$sql = \"SELECT Top 1 * FROM Users\";\n$things = sqlsrv_query($conn, $sql);\n\n$thingsArray = [];\nwhile( $row = sqlsrv_fetch_array($things, SQLSRV_FETCH_ASSOC))\n{\n    $thingsArray[] = $row;\n}\n\nvar_dump($thingsArray);\n</code></pre>\n\n<p>Data:</p>\n\n<pre><code>'ID' =&gt; int 344\n'UserName' =&gt; string 'admin                 ' (length=30)\n</code></pre>\n\n<p>So - right now I think I have two choices: carefully release this and make sure that I'm typecasting integers or loosening my comparisons, or write/find a Doctrine SQLSRV library.</p>\n\n<p>Does anyone know of a setting for PDO_SQLSRV that will return integers as integers? I've checked the docs, but can't seem to find anything.</p>\n\n<p>Also SQLSRV returns dates as native PHP DateTime objects. Kinda cool, but not important.</p>\n"},{"tags":["sql-server","triggers","hierarchy","sqldatatypes"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":162,"score":0,"question_id":8683264,"title":"Sql Server hierarchyid after insert in a trigger","body":"<p>I'm developing a message center in a information system, and today user Eric suggested use hierarchyid datatype to track the message reply, because the objective is to show as a Outlook or Gmail conversation.</p>\n\n<p>To simplify, I've in my database table Messages:</p>\n\n<pre><code>`MessageId int PK\nReplyToId int FK null\nSubject varchar\nBody varchar\nHierarchy hierarchyid`\n</code></pre>\n\n<p>When a new message is inserted, I've a trigger to do the update.</p>\n\n<p>I've inserted a new message, and the hierarchy is null, because is the first message, and isn't a reply.</p>\n\n<p>If a try to insert a reply to that message, the hierarchyid still null... :(</p>\n\n<p>My trigger:</p>\n\n<pre><code>ALTER TRIGGER [dbo].[trg_UpdateHierarchy] \n   ON  [dbo].[Messages]\n   AFTER INSERT\nAS \nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;\n\n    -- Insert statements for trigger here\n\n    DECLARE @replyId int\n    SELECT @replyId = inserted.ReplyId\n    FROM inserted\n    IF(@replyId IS NULL)\n    BEGIN\n        RETURN\n    END\n\n    DECLARE @parent hierarchyid\n    SELECT @parent = Hierarchy\n    FROM   [Messages]\n    WHERE  [Messages].MessageId = @replyId\n\n\n    DECLARE @currentHierarchy hierarchyid = @parent.GetDescendant(null, null).ToString()\n    DECLARE @messageId int\n    SELECT @messageId = inserted.MessageId\n        FROM inserted\n    UPDATE [Messages]\n        SET Hierarchy = @currentHierarchy\n        WHERE [Messages].MessageId = @messageId\nEND\nGO \n</code></pre>\n\n<p>What I'm doing wrong?</p>\n\n<p>Another point, I've read about the index, but depth-first don't fit because have many with null value, because the first message from a conversation has null value, and bread-first is the best index type to has a better performance? Or I can discard this index?</p>\n\n<p>Thanks in advance!</p>\n\n<p>EDIT:</p>\n\n<p>I've updated the trigger, but don't do the <code>hierarchyid</code> in right way.</p>\n\n<p>Now the trigger is:\n`ALTER TRIGGER [dbo].[trg_UpdateHierarchy] \n   ON  [dbo].[Messages]\n   AFTER INSERT\nAS \nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;</p>\n\n<pre><code>-- Insert statements for trigger here\nDECLARE @messageId int\nDECLARE @ParentId int\nSELECT  @messageId = inserted.MessageId,\n        @ParentId = inserted.ParentId\n    FROM inserted\n\nIF(@ParentId IS NULL)\n    BEGIN\n        UPDATE [Messages]\n            SET Hierarchy = hierarchyid::GetRoot()\n            WHERE [Messages].MessageId = @messageId\n        RETURN\n    END\nELSE\n    BEGIN\n        DECLARE @parent hierarchyid\n        SELECT @parent = Hierarchy\n            FROM   [Messages]\n            WHERE  [Messages].MessageId = @ParentId\n\n        DECLARE @lastHierarchy hierarchyid\n        SELECT @lastHierarchy = MAX(Hierarchy) \n            FROM [Messages] \n            WHERE Hierarchy.GetAncestor(1) = @parent\n\n        UPDATE [Messages]\n            SET Hierarchy = @parent.GetDescendant(@lastHierarchy, NULL)\n            WHERE [Messages].MessageId = @messageId\n    END\n</code></pre>\n\n<p>END`  </p>\n\n<p>If I insert messages like <code>id = 2</code> has <code>parentId = 1</code>, and <code>id = 3</code> has <code>parentId = 2</code> have this hierarchy:<br>\n<code>id = 1, hierarchy = \\<br>\nid = 2, hierarchy = \\1\\<br>\nid = 3, hierarchy = \\1\\1\\</code>  </p>\n\n<p>The first and second record has the right hierarchy, but next one no... :(</p>\n\n<p>Any clue?</p>\n"},{"tags":["sql-server","ssms"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13205186,"title":"I installed sql server 2008 r2 on vista 32, but can't find sql server management studio","body":"<p>I first installed visual studio 2010 express edition, and I think it installs sql server 2008 express. But then I went and downloaded sql server 2008 R2 32 bit. Now I'm trying to find sql server management studio and I downloaded the stand-alone one from the ms site and when I launched it, it said that it doesn't support this version of sql server. Then I found a link that someone posted that points to a version of sql server management studio for sql server 2008 r2, but the 32 bit version doesn't have a download button. <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=22985\" rel=\"nofollow\">http://www.microsoft.com/en-us/download/details.aspx?id=22985</a></p>\n\n<p>Why is this so complicated? I just want to run sql server 2008 r2 and manage it with management studio.</p>\n\n<p>Here is my installed packages:</p>\n\n<p><img src=\"http://i.stack.imgur.com/e8P0q.jpg\" alt=\"enter image description here\"></p>\n\n<p>And here is the services that are running (notice it says sqlexpress) But which one is it, the one that came with vs 2010 or the is it the one I downloaded and installed (i.e. sql server 2008 r2)?</p>\n\n<p><img src=\"http://i.stack.imgur.com/pZh65.jpg\" alt=\"enter image description here\"></p>\n\n<p>Any suggestions on what I should do next? Where can I find sql server management studio that will work with my installs?</p>\n"},{"tags":["sql-server","tsql","common-table-expression"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13203513,"title":"CTE Linking on Different ID Fields","body":"<p>I'm trying to create a SQL query that obtains data from 3 different tables.  My thought was to use a CTE to gather the information from 2 tables, and then do a right join to add in the data into the rest of my query.  I need to bring in disparate data from each field but am running into the infamous error <code>multi-part identifier could not be bound</code>  Here's what I've written so far:</p>\n\n<pre><code>with cte1 as\n(\nSELECT          \n[Physician ID] as InternalIdentifier, NPI, [Last Name] as LastName, [First Name]     \nas     \nFirstName,\nPhysician_T1HYCPP.Specialty, DOB, Degree, Department, [State License Number], [UPIN Number],    \n[Physician Status]\nFROM  Physician_T1HYCPP left outer JOIN PhysicianFile \non Physician_T1HYCPP.[Physician ID] = PhysicianFile.[TSI MD Number]\nwhere NPI &lt;&gt; ''\n),\ncteView\nAS\n(\nSelect [Doctor_Number], Address, City, State, Zip, Phone, Fax\nfrom V_PhysicianList\n)\nSelect \nInternalIdentifier, NPI, LastName, FirstName,\nSpecialty, DOB, Degree, Department, [State License Number], [UPIN Number],\n[Physician Status],     \n[Doctor_Number],\nAddress,City, State, Zip, Phone, Fax\nfrom cte1\nright outer join cteView on\nV_PhysicianList.[Doctor_Number] = PhysicianFile.[Doctor Number]\n</code></pre>\n\n<p>Here are the specific errors:</p>\n\n<pre><code>Msg 4104, Level 16, State 1, Line 1\nThe multi-part identifier \"V_PhysicianList.Doctor_Number\" could not be bound.\nMsg 4104, Level 16, State 1, Line 1\nThe multi-part identifier \"PhysicianFile.Doctor Number\" could not be bound.\n</code></pre>\n\n<p>The goal here is to bring in all the fields from the 2 tables in the first CTE and then \"merge\" in the fields from the second CTE so that address etc. get valued in the end result set.  How can I ensure that fields from both cte1 and cteView are merged properly?</p>\n"},{"tags":["sql","sql-server","database"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13203682,"title":"I am stuck on creating constraint on SQL Server","body":"<p>I am totally new to SQL Server management, I tried to add a constraint in a table.</p>\n\n<p>The situation is that I created a column with <strong>only 'Y'or 'N' allowed to be valued</strong>.</p>\n\n<p>So I tried to create a constraint in Management Studio by right clicking \"Constraints\" in the table.</p>\n\n<p>However, I really have no idea about the syntax of creating a constraint. Finally, I tried to input the code into \"Check Constraint Expression\" window by referring the template from the Internet. The SQL Server always tell me \"Error Validating constaint\".</p>\n\n<p>Can you guys just help me to write the first constraint for me? Because I really dont know how to start.</p>\n\n<p>My requirement is:</p>\n\n<pre><code>I have a table called \"Customer\"\nI created a column called \"AllowRefund\"\nThe column \"AllowRefund\" is only allowed to 'Y' or 'N'\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","views","system-views"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13203489,"title":"SQL Server INFORMATION_SCHEMA.VIEW_COLUMN_USAGE not updated on table update","body":"<p>I'm trying to learn more about SQL Server, and I came across something I don't understand.  I have a SQL Server 2008 database (the free version).  I have a view that I defined using a wildcard, like this:</p>\n\n<pre><code>Select * from ApplicantApplications\n</code></pre>\n\n<p>When I checked the system view \"INFORMATION_SCHEMA.VIEW_COLUMN_USAGE\", each of the columns from the view I defined were there.</p>\n\n<p>Later, I updated the ApplicantApplication table and added a field \"TestValue\"</p>\n\n<p>When I looked back at the system view \"INFORMATION_SCHEMA.VIEW_COLUMN_USAGE\", the new column that I added to the table was not there.  The view that I defined has the new column in it.</p>\n\n<p>Do I need to do something special to make that column appear in the system view?  I thought it would get updated automatically.</p>\n\n<p>Thanks!</p>\n"},{"tags":["c#","sql-server","ssis","maintenance"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":140,"score":0,"question_id":11911945,"title":"Convert an SSIS package to a .NET application?","body":"<p>I've been asked to take over ownership of an SSIS package that was written a while ago.  It certainly seems possible to go in and modify, edit, and upgrade this package, but it also seems extremely cumbersome for the amount of work the package does.  </p>\n\n<p>My task is roughly this:  Sift through the package, find any usage of some specific columns in specific tables, change them to match the latest database changeset, and write some additional logging data out to help the team diagnose any particular problems.</p>\n\n<p>This appears daunting to me because the SSIS package contains about 3 megabytes of text, SQL statements, and extremely simple (but lengthy) code pathways.  It's already taken me a while to double click on each SSIS object and skim through its settings to see if I can spot the columns I've been asked to maintain, and SSIS keeps throwing connection errors (rightly so, because my dev environment is blocked off from the production database).</p>\n\n<p>I'd really like to consider converting this SSIS package to a .NET application, however I haven't been able to locate any tools that could help me do so.</p>\n\n<p>Does anyone have suggestions for maintaining this SSIS package or converting it to a proper application?</p>\n"},{"tags":["sql","sql-server","naming-conventions"],"answer_count":36,"favorite_count":51,"up_vote_count":188,"down_vote_count":0,"view_count":38880,"score":188,"question_id":338156,"title":"Table Naming Dilemma: Singular vs. Plural Names","body":"<p>Convention has it that table names should be the singular of the entity that they store attributes of.  </p>\n\n<p>I dislike any T-SQL that requires square brackets around names, but I have renamed a <code>Users</code> table to the singular, forever sentencing those using the table to sometimes have to use brackets.  </p>\n\n<p>My gut feel is that it is more correct to stay with the singular, but my gut feel is also that brackets indicate undesirables like column names with spaces in them etc.</p>\n\n<p>Should I stay, or should I go?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13198812,"title":"SQL Merge with two stage match","body":"<p>I want to merge two tables using SQL Server on the following basis:</p>\n\n<p>IF the primary key (Operation) matches THEN\n    If Source Date Matches Target Date\n        Do nothing\n    Else\n        SET Target Revised_Date to Source Date\nElse\n    Insert Target Row from Source Row</p>\n\n<p>I have built an SQL merge below that does the first stage but can't see how to do the second stage.</p>\n\n<pre><code>MERGE \n    Completed_Operations AS target\nUSING \n    @Completed_Operation_Table AS source ON (target.Operation = source.Operation)\nWHEN MATCHED THEN \n    UPDATE \n    SET target.Revised_Completion_Date  = source.Completion_Date,\n            target.Revised_Pln_Hrs          = source.Pln_Hrs,\n            target.Revised_Pln_Hrs_Capped   = source.Pln_Hrs_Capped,\n            target.Revised_Act_Hrs          = source.Act_Hrs\nWHEN NOT MATCHED THEN   \n    INSERT (Operation, Orig_Completion_Date, Orig_Pln_Hrs, Orig_Act_Hrs, Revised_Completion_Date, Revised_Pln_Hrs, Revised_Act_Hrs)\n    VALUES (source.Operation, source.Completion_Date, source.Pln_Hrs, source.Act_Hrs, NULL, NULL, NULL);\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13201826,"title":"SP_SEND_DBMAIL @QUERY Inserts Line Breaks Into E-mail","body":"<p>I use the @query perimeter in sp_send_dbmail to send out an e-mail with a list of warnings (the warnings are returned by the @query perimeter).  The @query perimeter is listed as text in the e-mail.  All of the records returned from the @query perimeter and displayed in the e-mail has a line break between them.  ie. If I have 4 records, I would have 8 lines because of line breaks.</p>\n\n<p>How do I turn the line breaks off?  I read the the msdn article for sp_send_dbmail, but it didn't mention any attributes that could be changed that would affect the line breaks.</p>\n\n<p>Code:</p>\n\n<pre><code>    BEGIN\n    EXEC MSDB.DBO.sp_send_dbmail \n        @PROFILE_NAME = 'Alerts',\n        @RECIPIENTS = @MAIL,\n        @SUBJECT = @NEWSUBJECT,\n        @BODY = @NEWBODY,\n        @QUERY =\n            'SET NOCOUNT ON\n            DECLARE @HEXSTRING AS VARCHAR(100)\n            SET @HEXSTRING = (SELECT HEXADECIMAL_STRING FROM mydb.dbo.statusupdates\n                WHERE MACHINE_ID = ''1111'' AND DATEDIFF(MI, TIME_DATE_RECEIVED, GETDATE()) &lt;= 60)\n            SELECT [Warning_Description] FROM mydb.DBO.BINARYTOTABLE(mydb.DBO.HEXTOBINARY(@HEXSTRING)) AS ABB1\n            JOIN mydb.DBO.WarningMessages  ON mydb.DBO.WarningMessages.[Bit_Offset] = ABB1.BITPLACE\n            WHERE BITVALUE = 1 AND ALERT_LEVEL = ''WARNING''',\n        @QUERY_RESULT_HEADER = 0,\n        @ATTACH_QUERY_RESULT_AS_FILE = 0;\n    END\n</code></pre>\n"},{"tags":["sql-server","service-broker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13197781,"title":"Service Broker: Designing the communication between two SQL servers","body":"<p><strong>The goal:</strong> Reliable transport of continuously generated records to the central SQL.</p>\n\n<p><strong>Summary:</strong> The satellite needs to ask the central what are the latest data on its side, and then it is going to send continuously newer ones.</p>\n\n<p>The satellite SQL server may be (re)started sometimes (related to physicall production machine), the central SQL machine is likely to run longer, but there also can be some downtime. The lines are mostly reliable, but one never knows... I expect the connection problems be solved <em>naturally</em> by the SQL Server Service Broker. However, I need to solve the problem of the initial handshake and sending the data. I need to design the protocol and my SSB knowledge is still poor.</p>\n\n<p>I hope I understand the basics of communication using SSB that are nicely and briefly described as </p>\n\n<blockquote>\n  <p>You should start with each work item on its own conversation. The producer (initiator) begins a dialog and send the message describing the work item, then commits. The consumer (target) receives the message (or gets activated), inspects the payload to understand the work item details, executes the work, then ends the dialog and commit. The resulting EndDialog message gets sent back to the initiator service queue, and an activated procedure on the initiator queue responds to it by ending the dialog on the initiator side. </p>\n</blockquote>\n\n<p>... by Remus Rusanu (if interested see <a href=\"http://stackoverflow.com/a/1263999/1346705\">more details in his earlier answer</a>).</p>\n\n<p>I would like to send the records as XML messages like this (a multiline string here)</p>\n\n<pre><code>&lt;row a=\"1\" b=\"11\" c=\"111\" /&gt;\n&lt;row a=\"2\" b=\"22\" c=\"222\" /&gt;\n&lt;row a=\"3\" b=\"33\" c=\"333\" /&gt;\n&lt;row a=\"4\" b=\"44\" c=\"444\" /&gt;\n</code></pre>\n\n<p>and I have already learned <a href=\"http://stackoverflow.com/a/11579148/1346705\">how to write the <code>SELECT</code> to obtain the info from the XML message</a>.</p>\n\n<p><strong>The communication:</strong> Say the communication mechanism between the SQL servers was just activated...</p>\n\n<ol>\n<li><p>The satellite SQL obtained new data, and somehow it knows that there is no pending message between the satellite and the central. But it also does not know what data was already sent to the central. Therefore it has to ask the central what is its the last available data.</p></li>\n<li><p>If I understand the <code>END CONVERSATION</code> correctly, the command causes sending only a kind of empty message <code>N'http://schemas.microsoft.com/SQL/ServiceBroker/EndDialog'</code>. Because of this, the central should probably send my type <code>ReplyMessage</code> with the answer back before the <code>END CONVERSATION</code>.</p></li>\n<li><p>Meanwhile, the satellite should probably do nothing to behave asychronously (i.e. waits after sending the <code>RequestMessage</code>). Once the <code>ReplyMessage</code> arrives, it activates a satellite procedure that:</p>\n\n<ul>\n<li>receives the message and get the wanted information,</li>\n<li>receives the EndDialog message and ends the previous dialog at the satellite side, </li>\n<li>prepares the data to be sent to the central (the XML string form),</li>\n<li>opens the new dialog,</li>\n<li>sends the prepared data,</li>\n<li>and makes itself dormant until another <code>ReplyMessage</code> arrives.</li>\n</ul></li>\n<li><p>The central should behave similarly. Once the <code>RequestMessage</code> arrives, it activates the central procedure that:</p>\n\n<ul>\n<li>receives the request message, </li>\n<li>extracts the XML information and updates the central database,</li>\n<li>gets the info about the last available data for the satellite,</li>\n<li>forms and sends the <code>ReplyMessage</code>,</li>\n<li>ends the dialog at the central side.</li>\n</ul></li>\n</ol>\n\n<p>So far, is my view correct?</p>\n\n<p><strong>Now some details that I am not sure about:</strong> As I want to make it robust, working without a human touch, it should start on its own when the mechanism is installed. The communication should always be started by the satellite (the central may not know even if the satellite works or even exists).</p>\n\n<p>The satellite already uses a trigger fired by a raw data that is processed to build the records that are collected at the central. This way, the trigger could initiate somehow the first SSB request of the satellite to the central. But...</p>\n\n<ul>\n<li>How the trigger can check that there is no pending communication between the satellite and the central? As the satellite is always the initiator, the question can also be formulated as... How the trigger can check whether the satellite waits for some <code>ReplyMessage</code>? Or, how to know that there is some open dialog between the satellite and the central?\n<ul>\n<li>If there is no conversation, the trigger forms the data record (stored in a local table), and then it could start the communication proces (see the point 1 above).</li>\n<li>If there is any conversation, the trigger only forms the record that is to be sent later, and nothing else is done. Data will be sent when the <code>ReplyMessage</code> is obtained by the activated procedure (see the point 3 above).</li>\n</ul></li>\n<li>On <em>making the satellite dormant</em> (see the last bullet of the point 3 above) I mean that there should probably be no other message in the message queue (nothing to be processed in the loop) and the activated procedure is to be naturally finished. But I am not sure if I think correctly here. Can you comment on that?</li>\n<li>If nothing is broken, and if the data is produced fast enough, the satellite and the central have always something to exchange. This way, the trigger should never try to start the communication.</li>\n<li>When there is nothing else to be sent to the central by the activated satellite procedure (actually, it is not active), or when the system is restarted somehow (no dialog exists yet), the trigger starts the communication process. But how could I do it? Should the trigger simply send the <code>RequestMessage</code> to the central? (This way the <code>ReplyMessage</code> would activate the satellite procedure and the procedure would continue until there is anything to process.)</li>\n<li>Say, the <code>RequestMessage</code> means <em>here is some data, process them, and reply what is the last</em> (or what next should be send or what next action is recommended from the central -- depends on the bussiness logic, probably not important here). Is it OK to send <em>empty XML</em> in the <code>RequestMessage</code> in the sense <em>I do not know what else you need -- tell me</em>?</li>\n</ul>\n\n<p><strong>First update</strong> -- based on <a href=\"http://stackoverflow.com/a/13198768/1346705\">the Remus Rusanu's answer below</a>.</p>\n\n<p>I have to agree that this would be <em>chatty</em> protocol. Moreover, the records are created as temperature samples from the real environment and the frequency of sampling is rather low. This means that the complicated protocol could be usefull only in the special case of restarting everything or so.</p>\n\n<p>But when the conversation should be left open <em>forever</em>, the unique identifier for the dialog handle or should be stored persistently in some configuration table, or it could even be hardwired to the code. The trigger will send the records on the fly immediately, and the central will simply not send the <code>ReplyMessage</code>. Is it correct? Can that kind of coversation be effectively considered a monolog?</p>\n\n<p><strong>Second update</strong> to make this question reasonably short.</p>\n\n<p>See the continuation <a href=\"http://stackoverflow.com/q/13203389/1346705\">Service Broker: How should a trigger start infinitely opened dialog?</a></p>\n"},{"tags":["sql-server","service-broker"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13203389,"title":"Service Broker: How should a trigger start infinitely opened dialog?","body":"<p>The question is a continuation of the <a href=\"http://stackoverflow.com/q/13197781/1346705\">Service Broker: Designing the communication between two SQL servers</a> (to make the earlier reasonably short).</p>\n\n<p>The answer to the above question suggested the usage of a simpler scenario of sending the regularly generated data via <em>forever</em> opened dialog. A trigger, that is responsible for forming the data at the satellite SQL server and sending it do the central SQL server, will probably use the fixed unique identifier.</p>\n\n<p>Anyway, the conversation must be started at first. Say, the conversation handle is fixed. How can I detect the situation when the conversation was not open yet?</p>\n\n<p>If it is possible to detect the conversation was not started yet, I could combine the two approaches. The special request with empty-string message value could be send to the central, and the central would send back a reply only for that special request. The satellite activated procedure would then send the missing data to the central at once. </p>\n\n<p>Simply said, I have to solve the initial situation when quite a lot of data could be collected at the satellite machine. The satellite activated procedure could sent the data in chunks to give both sides a chance to do also something else than moving the data. Once the reply message from the central arrives in situation when there is nothing else to send, the activated procedure could set some persistent flag for the trigger to start sending the single records in a monolog way. Is it reasonable?</p>\n"},{"tags":["asp.net","mysql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13203198,"title":"web.config changing from SQL Server to MySQL connection","body":"<p>We just completed programming a a VB.NET Web Project connected to a SQL Server Database. The client is now requesting that we support an identical schema in MySQL as well.  I tried making a simple switch of the connection string via but it is still trying to connect to the provider value of (providerName=\"MySql.Data.MySqlClient\")</p>\n\n<p>This did not work.  Can someone tell me if we can do this via the web.config.  I don't want to have to change code to support the different connections.  We are also going to have to support Oracle databases in the future.</p>\n\n<p>Thanks in advance for you help.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13203108,"title":"Conditionally setting variable with case statment","body":"<p>I have the following query. I am trying to only add the values, if the value is not null so the whole variable doesnt end up as a null. Obviously this query below is erroring out, but I do not want to use an ISNULL check on the test column because it puts a comma at the end of the variable text. How would I do this without having the comma at the end of the variable text. Sometimes there will be nulls in the test column, and sometimes there will not be.</p>\n\n<pre><code>DECLARE @Test TABLE\n(\n    test varchar(20)\n)\n\nINSERT INTO @Test\nSELECT 'adfasdfasd'\nUNION ALL\nSELECT NULL\n\n\nDECLARE @DocID varchar(max)\n\nSELECT CASE WHEN test IS NOT NULL THEN @DocID = COALESCE(@DocID + ',' ,'')  + test END\nFROM @Test\n\nSELECT @DocID\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":18,"score":2,"question_id":13203223,"title":"custom query to show records with duplicate count with its duplicate occurance","body":"<p>Please refer below script</p>\n\n<pre><code>            declare @table1 table\n            (\n            col1 int\n            )  \n\n            insert into @table1 values(1)\n            insert into @table1 values(3)\n            insert into @table1 values(3)\n            insert into @table1 values(6)\n            insert into @table1 values(4)\n            insert into @table1 values(4)\n            insert into @table1 values(4) \n</code></pre>\n\n<p>The below query gives </p>\n\n<pre><code>            select col1 ,COUNT(col1) cntCol1 from @table1 group by col1\n</code></pre>\n\n<p>this output</p>\n\n<pre><code>            ----------------\n            col1   | cntCol1\n            -------| -------\n            | 1    | 1    | \n            | 3    | 2    | \n            | 4    | 3    | \n            | 6    | 1    | \n            ---------------\n</code></pre>\n\n<p>is it possible to get the below output</p>\n\n<pre><code>            ----------------\n            col1   | cntCol1\n            -------| -------\n            | 1    | 1    | \n            | 3    | 1    | \n            | 3    | 2    |  \n            | 4    | 1    |  \n            | 4    | 2    |  \n            | 4    | 3    | \n            | 6    | 1    | \n            ---------------\n</code></pre>\n\n<p>If so, could you please help me with the query.</p>\n\n<p>Thanks, \nEsen.</p>\n"},{"tags":["sql-server","ssas","mdx"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":28,"score":2,"question_id":13194942,"title":"MDX DRILLTHROUGH Fails but select can be successfully executed","body":"<p>I have the following MDX query which succesfully returns the measure when executed -</p>\n\n<pre><code>SELECT  \n{[Measures].[Closed Quote OE Retail]} ON COLUMNS \nFROM Sales\nWHERE\n(\n[Posting Date].[Date YQMD].[Month].&amp;[11]&amp;[2012]\n,[Work Provider].[Code].[LV]\n,EXCEPT([Item].[by Item Category by Product Group].[Item Category], [Item].[by Item Category by Product Group].[Item Category].&amp;[OEM])\n,EXCEPT([Lost Sale Reason Code].[Code].[Code], [Lost Sale Reason Code].[Code].[All Lost Sale Reason Code].UNKNOWNMEMBER)\n,EXCEPT([Lost Sale Reason Code].[by MI Type].[MI Type], { [Lost Sale Reason Code].[by MI Type].[MI Type].&amp;[Not Justified] })\n)\n</code></pre>\n\n<p>But if I add 'DRILLTHROUGH' to the start of the query the following error is returned -</p>\n\n<blockquote>\n  <blockquote>\n    <p>Drillthrough failed because the coordinate identified by the SELECT clause is out of range.</p>\n  </blockquote>\n</blockquote>\n\n<p>Can anyone help?</p>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16,"score":1,"question_id":13202383,"title":"Return list of mapped classes - Entity Framework","body":"<p>I have this class that is linked to a View in the SQL Server:</p>\n\n<pre><code>[Table(\"V_Clients\")]\npublic class Client\n{\n    [Key]\n    public int ClientId { get; set; }\n    public short BranchId { get; set; }\n    public string CorporateName { get; set; }\n    public string TIN { get; set; }\n    public string Address { get; set; }\n    public string Phone { get; set; }\n    public string Id { get; set; }//NroCi\n    public short CityId { get; set; }\n    public short ZoneId { get; set; }\n    public short SubZoneId { get; set; }\n    public short VendorId { get; set; }\n    public short PriceListId { get; set; }\n    public short CollectorId { get; set; }\n\n    [ForeignKey(\"BranchId\")]\n    public virtual Branch Branch { get; set; }\n\n    [ForeignKey(\"CityId\")]\n    public virtual City City { get; set; }\n\n    [ForeignKey(\"ZoneId\")]\n    public virtual Zone Zone { get; set; }\n\n    [ForeignKey(\"SubZoneId\")]\n    public virtual SubZone SubZone { get; set; }\n\n    [ForeignKey(\"VendorId\")]\n    public virtual Vendor Vendor { get; set; }\n\n    [ForeignKey(\"PriceListId\")]\n    public virtual PriceList PriceLists {get;set;}\n\n    [ForeignKey(\"CollectorId\")]\n    public virtual Collector Collector { get; set; }\n}\n</code></pre>\n\n<p>but when I try to make a list of it like this:</p>\n\n<pre><code>public ActionResult Index()\n    {\n        var clients = db.Clients.Include(c =&gt; c.Branch).Include(c =&gt; c.City).Include(c =&gt; c.Zone).Include(c =&gt; c.SubZone).Include(c =&gt; c.Vendor).Include(c =&gt; c.PriceLists).Include(c =&gt; c.Collector);\n        return View(clients.ToList());\n    }\n</code></pre>\n\n<p>nothing happens. Could it be because of the relationships?</p>\n\n<p>Note: All classes are linked to views and work fine with the others except my <code>Client</code> class.</p>\n"},{"tags":["sql-server","tsql","powershell-v2.0","cmdlet"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13202474,"title":"how to execute tsql scripts from cmdlet written in c#","body":"<p>I want to execute tsql scripts from custom cmdlet written in c#. Can you recommend me the best practice to do it?</p>\n\n<p>I have a few .sql scripts and in my cmdlet I need to iterate through them in specific order and execute each sql script. I also need to run all scripts in transaction if is it possible.</p>\n\n<p>And I need to execute scripts remotely. It means, that there may not be sql server installed on the machine from which is cmdlet executed.</p>\n\n<p>The target sql servers are 2008, 2008R2, 2012.</p>\n\n<p>I have read some approaches, but i'm still not sure what is the best one. </p>\n\n<p>thanks in advance</p>\n"},{"tags":["sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":31,"score":-1,"question_id":13202413,"title":"Handle bad dates during CAST","body":"<p>How can I gracefully handle bad date integers that are random thorughout my table?  For instance I see some 9999999999 in there at times so consequently this query bombs out. I want to just produce the 1900 date in those cases instead of just stopping like this:</p>\n\n<pre><code>Select convert(date,CAST(trandate as varchar(8))),\n       convert(date,CAST(duedate as varchar(8))), \n        ...\n\nFROM  SomeTable\n</code></pre>\n\n<p>a valid date looks like this in that table for those fields: 20100924 and those work fine when they hit this query.</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13200408,"title":"How to save (upload) files to database after inserting records","body":"<p>What I have seen in some sample use:</p>\n\n<pre><code>string strQuery = \"insert into tblFiles(Name, ContentType, Data)\" + \n                  \" values (@Name, @ContentType, @Data)\" \n</code></pre>\n\n<p>for saving files to the database.</p>\n\n<p>Now if I have an existing table that has some rows and also some different filled columns, and after adding new columns (<code>Name, ContentType, Data</code>) to this existing table, I like to upload or save files. </p>\n\n<p>What is the SQL statement I have to use to do this?   </p>\n"},{"tags":["sql","sql-server","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13197867,"title":"Find duplicate values over multiple databases","body":"<p>I'm trying to find a way to find duplicate email addresses in a table over multiple DB's.  I have 30 DB's, all with a \"Users\" table with identical fields (each DB is a different customer of ours).  I need to go through each DB, get the email address from this table, then search the current, and all other DB's for this email address.  If it exists, write out the record, if not, move on to the next user record and repeat.  Here's what I've got so far, but I'm stuck.  I think I have to create a cursor inside another cursor but don't know if it can be done dynamically:</p>\n\n<pre><code>DECLARE @DBName varchar(20)\nDECLARE @sSQL      varchar(2000)\n\nDECLARE LoopCursor CURSOR FOR\n    SELECT DBName\n    FROM Configuration\n\n    OPEN LoopCursor\n\n    FETCH NEXT FROM LoopCursor\n    INTO @DBName\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        SET @sSQL = '\n            Select EmailAddress\n            FROM ' + @DBName + '.dbo.Users'\n\n        --Not to sure what to do from here??\n\n        EXEC(@sSQL)\n\n        FETCH NEXT FROM LoopCursor\n        INTO @DBName\n    END\n\n    CLOSE LoopCursor\nDEALLOCATE LoopCursor\n\nSELECT 'DONE'\n</code></pre>\n\n<p>We are using SQL Server 2008 R2 btw.</p>\n"},{"tags":["sql","sql-server","int","guid","identifier"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":41,"score":-4,"question_id":13201183,"title":"ints or guids for table identifiers","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4557422/sql-primary-key-int-or-guid-or\">SQL primary key, INT or GUID or..?</a>  </p>\n</blockquote>\n\n\n\n<p>What is the best practise for using unique identifiers in sql server tables?</p>\n\n<p>I have seen articles regarding using guid's or int's with pros and cons for each. </p>\n\n<p>I am looking to go with the following principal, for external identifiers, guid's should be used but for internal identifiers, it best to go with int's. </p>\n\n<p>I am looking for feedback on this principal and guidelines as to the best approach.</p>\n"},{"tags":["sql-server","vb.net","dynamic","drop-down-menu","menu"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13199351,"title":"VB2010 reading menu items in tool strip sub menu","body":"<p>SQL Server/VB2010 newbie.  Fighting the learning curve on two fronts.</p>\n\n<p>I am creating a UI in VB2010 to a SQL Server database that will allow users to edit tables in the database. Since the tables in the database may change (new ones added, or obsolete ones deleted) as the project develops, the table names are dynamically added to the sub menu, as shown in the screen cap below:</p>\n\n<p><img src=\"http://i.stack.imgur.com/Fvbi9.png\" alt=\"Screen Cap\"></p>\n\n<p>Then I use the AddHandler function to run the click event sub. That works fine, but what I need to do is grab the actual text of the submenu item (\"VehicleList\", \"Maintenance\", etc.) to use in the SQL SELECT string to open the selected table in the database, like so:</p>\n\n<pre><code>\"SELECT * from [selected_menu_item] WHERE yada, yada\"\n</code></pre>\n\n<p>I've scoured the internet looking for this, but if it's there, I can't find it. Tried many ways, but I either get the top menu item (\"Table\") or the last item on the list, or sometimes just a blank line.</p>\n\n<p>Preferable would be to get the actual names, but even if there was an index value, I could use that to reference an array of the table names.</p>\n\n<p>Can anyone help?</p>\n\n<p>Thanks!</p>\n"},{"tags":["java","sql","sql-server","regex"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":79,"score":5,"question_id":13195935,"title":"Determine if an sql query modifies the database","body":"<p>I have a list of strings that contain valid <code>SQL</code> expressions.<br>\nI need to execute only those that do not modify the database.<br>\nWhat would be the best way to do this? Just doing something like:  </p>\n\n<pre><code>if(sqlQuery.contains(\"DELETE\")){  \n  //don't execute this\n}\n</code></pre>\n\n<p>seems like a bad hack  </p>\n\n<p><strong>Update:</strong><br>\nI'll make this more specific.<br>\nI already have a list of <code>SQL</code> queries that are allowed. I want to make sure only these are executed.<br>\nWhat would be the best way to match against these?</p>\n"},{"tags":["sql-server","node.js","unixodbc"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":161,"score":1,"question_id":11414302,"title":"Node-odbc unable to connect to mssql","body":"<p>I've spent the last day or two setting up unixODBC and freetds on ubuntu 12 - not a fun process in itself but it does now work using both sqsh and isql. I've installed node-odbc and I'm using the code snippet provided in the <a href=\"https://github.com/w1nk/node-odbc\" rel=\"nofollow\">github readme</a> to test the connection but I always get</p>\n\n<pre><code> S1000:1:0:[unixODBC][FreeTDS][SQL Server]Unable to connect to data source\n WARNING: ev_unref is deprecated, use uv_unref\n [Error: Error opening database]\n</code></pre>\n\n<p>Using isql I run <code>isql -v SERVER user pass</code> (using the correct creds..) and then <code>use DATABASE</code> once connected and it all works and I can run queries fine. My connection string in the js is </p>\n\n<pre><code> \"DRIVER={FreeTDS};SERVER=SERVER;UID=user;PWD=pass;DATABASE=DATABASE\"\n</code></pre>\n\n<p>Which exactly matches the credentials used for connecting with isql but in Node I get the aforementioned error. Any ideas on why this is happening? Is it possible that it's to do the location of my odbc.ini and odbcinst.ini files or something like that?</p>\n\n<p>Just for reference:</p>\n\n<p>/etc/odbc.ini:</p>\n\n<pre><code>[SERVER]\nDriver      = FreeTDS\nTrace       = No\nServer      = SERVER\nPort        = 1433\nDatabase    = DATABASE\nUsageCount  = 1\nTDS_Version = 7.0\n</code></pre>\n\n<p>/etc/odbcinst.ini:</p>\n\n<pre><code>[FreeTDS]\nDescription = FreeTDS\nDriver = /usr/lib/libtdsodbc.so\nSetup = /usr/lib/libtdsS.so\nFileUsage   = 1\nCPTimeout   = 5\nCPReuse     = 20\nThreading   = 1\n</code></pre>\n\n<p>Thanks in advance for any help!</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":120,"score":2,"question_id":11858827,"title":"MS SQL Server 2008 script generation creates invalid scripts when using constraints","body":"<p>On an MS SQL Server 2008 (10.50.2811.0) Developer Edition (64-bit), running under Windows 2008 Server 2008 R2 Standard the script generation from within SQL Server Management Studio creates scripts where the same constraint is dropped multiple times. </p>\n\n<p>A simple example includes two tables, tParent and tChild, where tChild's ParentID references tParent's ID. The script (Database context menu => Tasks => Generate Scripts...) being generated (for DROP AND CREATE) looks like this:</p>\n\n<pre><code>USE [TestDb]\nGO\n/****** Object: ForeignKey [FK_tChild_tParent] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] DROP CONSTRAINT [FK_tChild_tParent]\nGO\n/****** Object: Table [dbo].[tChild] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] DROP CONSTRAINT [FK_tChild_tParent]\nGO\nDROP TABLE [dbo].[tChild]\nGO\n/****** Object: Table [dbo].[tParent] Script Date: 08/08/2012 08:11:52 ******/\nDROP TABLE [dbo].[tParent]\nGO\n/****** Object: Table [dbo].[tParent] Script Date: 08/08/2012 08:11:52 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[tParent](\n[ID] [int] IDENTITY(1,1) NOT NULL,\n[Name] [varchar](50) NOT NULL,\n[Value] [int] NOT NULL,\nCONSTRAINT [PK_tParent] PRIMARY KEY CLUSTERED \n(\n[ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\n/****** Object: Table [dbo].[tChild] Script Date: 08/08/2012 08:11:51 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[tChild](\n[ID] [int] IDENTITY(1,1) NOT NULL,\n[ParentID] [int] NOT NULL,\n[Name] [varchar](50) NOT NULL,\n[Value] [int] NOT NULL,\nCONSTRAINT [PK_tChild] PRIMARY KEY CLUSTERED \n(\n[ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\n/****** Object: ForeignKey [FK_tChild_tParent] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] WITH CHECK ADD CONSTRAINT [FK_tChild_tParent] FOREIGN KEY([ParentID])\nREFERENCES [dbo].[tParent] ([ID])\nGO\nALTER TABLE [dbo].[tChild] CHECK CONSTRAINT [FK_tChild_tParent]\nGO\n</code></pre>\n\n<p>Why are there two identical lines that both try to drop the FK_tChild_tParent constraint? And why is the comment for both lines different?</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":53,"score":-3,"question_id":13200717,"title":"Change Record to Column in Sql","body":"<p>I have table like below</p>\n\n<pre><code>CustomFieldValueId  CustomFieldId   ProjectId   CustomFieldName CustomFieldValue\n35                  69              1           User Name       kaliya\n36                  72              1           City            Bangalore\n37                  74              1           Email           mm@gmail.com\n38                  69              1           User Name       mvkperumal\n39                  72              1           City            Chennai\n40                  74              1           Email           mvkperumal@gmail.com\n41                  69              1           User Name       Yohesh\n42                  72              1           City            Delhi\n43                  74              1           Email   \n</code></pre>\n\n<p>I need the output like below</p>\n\n<pre><code>User Name   City       Email\nkaliya      Bangalore  mm@gmail.com\nmvkperumal  Chennai    mverumal@gmail.com\nYohesh      Delhi   \n</code></pre>\n\n<p>I am taking the value based on CustomFieldValueId and grouping the ProjectId\nSo Please help on this..</p>\n"},{"tags":["sql-server","tsql","union"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13200720,"title":"UNION select sql statement returns duplicate results","body":"<p>My objective is to have one record with both HomeNumber &amp; OfficeNumber and I'm keeping the PersonID to reference the customer table. I'm thinking I shouldn't even be using a UNION but maybe a select query from two nested sub queries.</p>\n\n<p>The results returned look like this.</p>\n\n<pre><code>1A370535-9432-45B9-8F08-004F040EE196    ''          ''\n1A370535-9432-45B9-8F08-004F040EE196    6127319561  ''\nE8FA1667-416C-4639-ADDC-02143D651B4E    ''          6512096719\nE8FA1667-416C-4639-ADDC-02143D651B4E    6515786963  ''\n</code></pre>\n\n<p>Here my query:</p>\n\n<pre><code>    SELECT PhoneNumbers.PersonID, PhoneNumbers.HomeNum, PhoneNumbers.OfficeNum\n    FROM (\n      SELECT PhoneHub.PersonID, ISNULL(PhoneHub.PhoneNbr, '') AS HomeNum, '' AS OfficeNum\n      FROM \n        --PhoneType INNER JOIN \n        PhoneHub --ON PhoneType.ID = PhoneHub.TypeID \n      WHERE \n        (PhoneHub.FranID = @FranID) AND\n        (PhoneHub.TypeID = '28321161-668e-4a56-90be-67a146fa1353') -- Home# ID\n      UNION\n      SELECT PhoneHub.PersonID, '' AS HomeNum, ISNULL(PhoneHub.PhoneNbr, '') AS OffNum\n      FROM \n        --PhoneType AS PhoneType_2 INNER JOIN \n        PhoneHub --AS PhoneHub ON PhoneType_2.ID = PhoneHub.TypeID\n      WHERE \n        (PhoneHub.FranID = @FranID) AND\n        (PhoneHub.TypeID = '02a4125b-b968-4dc6-9734-7f75f45f7635') --Office# ID\n     ) AS PhoneNumbers  \n     ORDER BY PhoneNumbers.PersonID\n</code></pre>\n\n<p>Table Schema - PhoneHub</p>\n\n<pre><code>PK  ID          uniqueidentifier    \nFK  FranID      uniqueidentifier      Franchise.ID\nFK  PersonID    uniqueidentifier      Customer.ID   \nFK  TypeID      uniqueidentifier      PhoneType.ID\nPhoneNbr    nvarchar(20)    \nPhoneExt    nvarchar(10)    \nIsDefault   bit \n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2000"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13200024,"title":"SQL Server 2008 upgrade advisor tool","body":"<p>We upgraded to SQL Server 2008 from SQL Server 2000. But due to some legacy scripts/queries in our health care application, that run only in 2000, we had to run 2008 version on backwards compatibility mode. </p>\n\n<p>My question is what do I need to be aware of if I have to turn it on to full compatibility mode in terms of potential conflicts/issues etc. Is the Upgrade Advisor tool still useful in my case as we already upgraded but running in backwards compatibility mode. Is there value in running that tool? </p>\n\n<p>Any other information any one can share , will be useful. </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":30,"score":3,"question_id":13200609,"title":"How get around the arithmetic overflow error converting expression to data type int?","body":"<p>I have the following query:</p>\n\n<pre><code>-- CTE to remove outliers, e.g. remove the fastest and slowest results\n;WITH MinMaxCTE AS \n(\n  SELECT ServerName, CONVERT(VARCHAR(10), UpdatedOn, 101) AS [Date], Version, \n    MIN(JaguarStartupTime) AS MinStartTime, MAX(JaguarStartupTime) AS MaxStartTime\n  FROM dbo.MachineConfiguration (NOLOCK)\n  WHERE DomainLogin NOT IN (SELECT DomainLogin FROM dbo.SupportGroup)\n  GROUP BY ServerName, CONVERT(VARCHAR(10), UpdatedOn, 101), Version\n)\n\nSELECT  AVG(mc.JaguarStartupTime) AS AverageTime\n    , COUNT(*) AS NumEntries\n    , mc.Version\nFROM    #Eligible mc (NOLOCK)\nJOIN MinMaxCTE cte ON mc.ServerName = cte.ServerName \n  AND CONVERT(VARCHAR(10), mc.UpdatedOn, 101) = cte.[Date] \n  AND mc.Version = cte.Version \n  AND mc.JaguarStartupTime &lt;&gt; cte.MinStartTime \n  AND mc.JaguarStartupTime &lt;&gt; cte.MaxStartTime\nGROUP BY mc.Version\nORDER BY Version DESC, AVG(mc.JaguarStartupTime) ASC\n</code></pre>\n\n<p>The definition of the #Eligible temp table is </p>\n\n<pre><code>create table #Eligible (\n    Version nvarchar(50), JaguarStartupTime int, \n    ServerName nvarchar(50), UpdatedOn datetime )\n</code></pre>\n\n<p>No matter what condition or aggregation I comment out, I always get the following error: <code>Arithmetic overflow error converting expression to data type int</code>.</p>\n\n<p>Where can I go from here?  How do I debug this further?</p>\n\n<p>EDIT: Sample data</p>\n\n<pre><code>Version JaguarStartupTime    ServerName     UpdatedOn\n6.4.6.082      16040         NewOrleansLA   2012-08-08 12:34:12.330\n6.5.1.012      40390         BatonRougeLA   2012-08-08 18:33:17.440\n6.5.1.012      48379         HonoluluHI     2012-08-09 04:42:50.453\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","ssms"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2747,"score":4,"question_id":8917315,"title":"How to get Enterprise Manager installed in SQL Server 2008 Express?","body":"<p>I've installed Microsoft SQL Server 2008 Express twice now, and all the services work and I can create databases from Visual Studio 2010, but I don't have the <strong><em>Enterprise Manager</em></strong> (I learned it is now called <strong><em>Management Studio</em></strong>) available in the SQL Server 2008 program menu-- I do have other menu items like configuration manager, etc. but nothing for <em>Management Studio / Enterprise Manager</em>.</p>\n\n<p>Is there a checkbox I've missed during installation?<br>\nI ran a search for all exes in the SQL Server root folder and nothing jumped out as belonging to the Enterprise Manager, but I'm not 100% sure what the executable would be named.</p>\n\n<p>Primary question:<br>\n&nbsp; &nbsp; What is the procedure required to install the Management Studio client [for/with SQL 2008 Express] ?<br>\nSecondary question:<br>\n&nbsp; &nbsp; What is the name of this client's executable file ?</p>\n"},{"tags":["sql-server","backup","restore"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13200464,"title":"How to stop SQL server restore from overwriting database?","body":"<p>I have a ELMAH database that I want to script the restore of using the following:</p>\n\n<pre><code>RESTORE DATABASE [Elmah] \nFROM DISK = N'E:\\Elmah_backup_2012_11_02_030003_1700702.bak' \nWITH FILE = 1,  \nMOVE N'Elmah' TO N'C:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Elmah.mdf',  \nMOVE N'Elmah_log' TO N'C:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Elmah.ldf',  \nNOUNLOAD, STATS = 10\nGO\n</code></pre>\n\n<p>Even though I am not including <code>WITH REPLACE</code> each time I execute this statement it restores over the existing database.</p>\n\n<p>I will always drop all databases before this operation and I never want this code to accidentally restore a database over one in production.</p>\n\n<p>How do I change this code so that it will never overwrite an existing database?</p>\n\n<p>I am actually doing this through SMO objects but the principle and results are the same so I am hoping to keep this simplified to just the TSQL necessary in the hopes that I can generalize that information to what needs to be set on the appropriate SMO.Restore object.</p>\n"},{"tags":["c#","sql-server","webforms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13179514,"title":"CSV file parsing to a list, make list public to parse against SQL table","body":"<p>Parsed a csv file to a list in a webapp form. </p>\n\n<p>How do I make the list public so that I can call it and use it in other classes? I essentially need to parse through the data in the list against data in a SQL table.</p>\n\n<pre><code>public partial class _Default : System.Web.UI.Page\n{\n    protected void UploadBtn_Click(object sender, EventArgs e)\n    {\n\n        if (FileUpload.HasFile)\n        {\n\n            string filename = Path.GetFileName(FileUpload.FileName);\n\n            using (FileStream stream = new FileStream(ConfigurationManager.AppSettings[\"temp_dir\"].ToString().Trim() + filename, FileMode.Open, FileAccess.Read, FileShare.Read))\n            { \n                using (StreamReader read = new StreamReader(stream))\n                {\n                    List&lt;string[]&gt; members = new List&lt;string[]&gt;();\n                    int j = 0;\n\n                    while (!read.EndOfStream)\n                    {\n\n                        string line = read.ReadLine();\n                        string[] values = line.Split(',');\n\n                        if(j==0)\n                        {\n                            j++;\n                            continue;\n                        }\n\n                        long nbr = Convert.ToInt64(values[0]);\n                        int lnbr = Convert.ToInt32(values[1]);\n                        int value = Convert.ToInt32(values[2]);\n                        members.Add(values);\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13200062,"title":"SQL Server upgrade single instance","body":"<p>I have a server that is running SQL Server 2005 Express.</p>\n\n<p>It currently has 2 instances of SQL Server running.</p>\n\n<ul>\n<li>Instance 1 runs some old legacy software that is not supported by me.</li>\n<li>Instance 2 runs my software. </li>\n</ul>\n\n<p>Is it possible to upgrade instance 2 to SQL Server 2008 R2 Express independently of instance 1, i.e. keeping instance 1 on 2005 while instance 2 is upgraded?</p>\n"},{"tags":["sql","sql-server","pivot","pivot-without-aggregate"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":72,"score":2,"question_id":12516357,"title":"Transposing data into multiple columns","body":"<p>I have numbers of clients and each client has 67 records. </p>\n\n<p>The record contains Activities, Dates, IDs, flags and many other columns. </p>\n\n<p>I would like the Activities names to be the headings and Dates underneath to those Activity headings. </p>\n\n<p>I am trying to explain it more using the tables below. This is the current output:</p>\n\n<pre><code>Client  Activity    Date \n1       A           21/15\n1       B           5/5/2012\n1       C           51/3115\n1       D           54/6/84\n2       A           8/6/99\n2       B           1/1/2011\n2       C           8/4\n2       D           9/81/1\n3       A           6/51/8\n3       B           1/61/8\n3       C           1/31\n3       D           3/2/1\n</code></pre>\n\n<p>And I would like it to be:</p>\n\n<pre><code>Client      A       B         C         D\n1           21/15   5/5/2012  51/31/15  54/6/84\n2           8/6/99  1/1/2011  8/4       9/81/1\n3           6/51/8  1/61/8    1/31      3/2/1\n</code></pre>\n"},{"tags":["sql","sql-server","pivot","sql-server-2012","pivot-without-aggregate"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":114,"score":0,"question_id":12387548,"title":"Query to show customers and their contacts in columns side by side","body":"<p>I am trying to figure it out if it's possible to achieve something having this tables as example...</p>\n\n<pre><code>CustomersTable\n Id  | Name | Address\n  1  | John | Street A\n  2  | Paul | Street B\n  3  | Mary | Street C\n\nContactsTable\n Id  | CustomerId | ContactName | Contact\n  1  |     1      |  Contact A  |   123\n  2  |     1      |  Contact B  |   543\n  3  |     2      |  Contact 1  |   678\n  4  |     3      |  Contact A1 |   980\n  5  |     3      |  Contact B2 |   521\n</code></pre>\n\n<p>And get something like this...</p>\n\n<pre><code> Id  |  Name  |  Address   | ContactId_1 | ContactName_1 | Contact_1 | ContactId_2 | ContactName_2 | Contact_2\n  1  |  John  |  Street A  |      1      |   Contact A   |    123    |      2      |   Contact B   |    543\n  2  |  Paul  |  Street B  |      3      |   Contact 1   |    678    |     NULL    |     NULL      |    NULL\n  3  |  Mary  |  Street C  |      4      |   Contact A1  |    980    |      5      |   Contact B2  |    521\n</code></pre>\n\n<p>The idea is to get a table where the contacts are side by side of each customer where it belongs. And the contact columns contacts will depend of course on the number of contacts of each customer.</p>\n\n<p>This can be done? How?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server","sql-server-2008-r2","pivot","pivot-without-aggregate"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":12514192,"title":"SQL: Turn a row into a column (and include column names in a new column)","body":"<p>I'm busy writing a claims provider class to be used in a Security Token Service.</p>\n\n<p>User permissions are read from a SQL Server 2008 R2 database:</p>\n\n<pre><code>SELECT A, B, C, ..., X FROM Permissions WHERE UserId = @UserId\n</code></pre>\n\n<p>would give me a single row, for example: </p>\n\n<pre><code>A B C ... X\n1 0 1     1\n</code></pre>\n\n<p>it would be much easier to have this data in the form</p>\n\n<pre><code>Permission Value\nA          1\nB          0\nC          1\n...\nX          1\n</code></pre>\n\n<p>Since the actual table contains dozens of columns, I'd prefer to be able to do the transposition \"dynamically\" without really having to type up any column names by hand.</p>\n\n<p>It feels like the PIVOT/UNPIVOT functions and INFORMATION_SCHEMA.COLUMNS view are what I need, but I can't quite figure out what to do.</p>\n\n<p>Any ideas for a query that would do this?</p>\n\n<p>PS. I guess if push comes to shove, I'd just stick the result set in a DataTable and iterate over the columns in code to generate the user claims, but I'd like to find out if the above approach is possible first :)</p>\n"},{"tags":["sql","sql-server","pivot"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12505079,"title":"Write advanced SQL Select","body":"<p>Item table:</p>\n\n<pre><code>|   Item    |   Qnty    |   ProdSched   |\n|    a      |    1      |       1       |\n|    b      |    2      |       1       |\n|    c      |    3      |       1       |\n|    a      |    4      |       2       |\n|    b      |    5      |       2       |\n|    c      |    6      |       2       |\n</code></pre>\n\n<p>Is there a way I can output it like this using SQL <code>SELECT</code>?</p>\n\n<pre><code>|   Item    |   ProdSched(1)(Qnty)  |   ProdSched(2)(Qnty)  |\n|    a      |           1           |       4               |\n|    b      |           2           |       5               |\n|    c      |           3           |       6               |\n</code></pre>\n"},{"tags":["sql-server","linked-server","dbf"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13199864,"title":"Create a linked server with SQL Server 2012 x64","body":"<p>How can I create a linked server to a folder having fox pro dbf files?</p>\n\n<p>I can access the dbfs inside Visual Studio 2010, creating a connection with this properties</p>\n\n<p>Connection string</p>\n\n<pre><code>Dsn=Legacy;dbq=\\\\192.168.48.29\\dbf;defaultdir=\\\\192.168.48.29\\dbf;driverid=533;fil=dBase 5.0;maxbuffersize=2048;pagetimeout=5\n</code></pre>\n\n<p>Provider</p>\n\n<p>.NET Framework Data Provider for ODBC</p>\n\n<p>But I don't know how to use this information with sql server 2012 express x64</p>\n\n<p>I'm trying to use</p>\n\n<pre><code>EXEC master.dbo.sp_addlinkedserver @server = N'LEGACY', @srvproduct=N'Legacy', @provider=N'MSDASQL', @datasrc=N'Dsn=Legacy;dbq=\\\\192.168.48.29\\dbf;defaultdir=\\\\192.168.48.29\\dbf;driverid=533;fil=dBase 5.0;maxbuffersize=2048;pagetimeout=5', @provstr=N'.NET Framework Data Provider for ODBC'\n</code></pre>\n\n<p>in SQL Server Management Studio</p>\n\n<p>Error message about not finding the dsn ...</p>\n"},{"tags":["sql","sql-server","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":13199422,"title":"How can I return several text fields with the same ID number in one row in SQL server?","body":"<p>I have table:</p>\n\n<pre><code>    ID   Note\n1   1    aaa\n2   1    bbb\n3   1    ccc\n4   2    ddd\n5   2    eee\n6   2    fff\n</code></pre>\n\n<p>I need to return it as:</p>\n\n<pre><code>   ID   Note1   Note2   Note3\n1  1    aaa     bbb     ccc\n2  2    ddd     eee     fff\n</code></pre>\n\n<p>Thank you!</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":12,"down_vote_count":0,"view_count":1988,"score":12,"question_id":6376866,"title":"TSQL - How to use GO inside of a BEGIN .. END block?","body":"<p>I am generating a script for automatically migrating changes from multiple development databases to staging/production.  Basically, it takes a bunch of change-scripts, and merges them into a single script, wrapping each script in a <code>IF whatever BEGIN ... END</code> statement.</p>\n\n<p>However, some of the scripts require a <code>GO</code> statement so that, for instance, the SQL parser knows about a new column after it's created.</p>\n\n<pre><code>ALTER TABLE dbo.EMPLOYEE \nADD COLUMN EMP_IS_ADMIN BIT NOT NULL\nGO -- Necessary, or next line will generate \"Unknown column:  EMP_IS_ADMIN\"\nUPDATE dbo.EMPLOYEE SET EMP_IS_ADMIN = whatever\n</code></pre>\n\n<p>However, once I wrap that in an <code>IF</code> block:</p>\n\n<pre><code>IF whatever\nBEGIN\n    ALTER TABLE dbo.EMPLOYEE ADD COLUMN EMP_IS_ADMIN BIT NOT NULL\n    GO\n    UPDATE dbo.EMPLOYEE SET EMP_IS_ADMIN = whatever\nEND\n</code></pre>\n\n<p>It fails because I am sending a <code>BEGIN</code> with no matching <code>END</code>.  However, if I remove the <code>GO</code> it complains again about an unknown column.</p>\n\n<p><strong>Is there any way to create and update the same column within a single <code>IF</code> block?</strong></p>\n"},{"tags":["sql-server","tsql","index"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13199234,"title":"Indexing on a single value only in a column","body":"<p>I have a table in which I use reference counting for removing obsolete rows. In order to do this efficiently, I would like to create an index that only indexes the rows in the table, where the reference count is 0. Is this possible, or am I better off using a view, or something else?</p>\n"}]}
{"total":54451,"page":7,"pagesize":100,"questions":[{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13198571,"title":"Restore Backup Fails - File 'Db' cannot be restored to '{...}.mdf'. Use WITH MOVE to identify a valid location for the file","body":"<p>I am getting the following errors trying to do a restore using the restore command on a backup file I recieved from a customer.</p>\n\n<p>RESTORE DATABASE SFDB FROM DISK = N'C:\\Backup\\Backup.bak' </p>\n\n<p>Any thoughts on what I can do to correct this?  It's looking for the mdf, so can I assume that the backup file I have is an incremental backup and not the full backup and that's why it's looking for the mdf?  </p>\n\n<p>I am not sure if 1) they have given all the data (the entire db) or 2) I have the right data - and I can do the restore with the right T-SQL commands - I just don't know how.</p>\n\n<p>Help is appreciated.</p>\n\n<pre><code>Msg 5133, Level 16, State 1, Line 2\nDirectory lookup for the file \"D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db.mdf\" failed with the operating system error 21(failed to retrieve text for this error. Reason: 15105).\nMsg 3156, Level 16, State 3, Line 2\nFile 'Db' cannot be restored to 'D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db.mdf'. Use WITH MOVE to identify a valid location for the file.\nMsg 5133, Level 16, State 1, Line 2\nDirectory lookup for the file \"D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db_log.LDF\" failed with the operating system error 21(failed to retrieve text for this error. Reason: 15105).\nMsg 3156, Level 16, State 3, Line 2\nFile 'DbDev_log' cannot be restored to 'D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db_log.LDF'. Use WITH MOVE to identify a valid location for the file.\nMsg 3634, Level 16, State 1, Line 2\nThe operating system returned the error '21(failed to retrieve text for this error. Reason: 15105)' while attempting 'GetVolumeInformation' on 'D:\\'.\nMsg 3013, Level 16, State 1, Line 2\nRESTORE DATABASE is terminating abnormally.\n</code></pre>\n\n<p>RESTORE FileListOnly FROM DISK = N'C:\\Backup\\Backup.bak' shows me the following...</p>\n\n<pre><code>LogicalName PhysicalName    Type    FileGroupName   Size    MaxSize FileId  CreateLSN   DropLSN UniqueId    ReadOnlyLSN ReadWriteLSN    BackupSizeInBytes   SourceBlockSize FileGroupId LogGroupGUID    DifferentialBaseLSN DifferentialBaseGUID    IsReadOnly  IsPresent   TDEThumbprint\nDb  D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db.mdf  D   PRIMARY 29622272    35184372080640  1   0   0   02925462-83CC-4222-8966-53229FA25B1C    0   0   29032448    512 1   NULL    269000000146900238  735C7F0E-F63D-4AA1-AC48-505A084AC00B    0   1   NULL\nDb_log  D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db_log.LDF  L   NULL    40239104    2199023255552   2   0   0   71038B04-CBC9-4E4A-93AD-4E1268859CB2    0   0   0   512 0   NULL    0   00000000-0000-0000-0000-000000000000    0   1   NULL\nDbDev_filestream    D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db  S   PRIMARY_FILESTREAM  4691012 0   65537   18000000011800001   0   627C9AAA-97BD-4991-9C8C-90C400226A9F    0   0   4784128 512 2   NULL    269000000146900238  735C7F0E-F63D-4AA1-AC48-505A084AC00B    0   1   NULL\n</code></pre>\n"},{"tags":["sql-server","dbf","visual-foxpro"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":535,"score":1,"question_id":9466630,"title":"Run UPDATE and DELETE statements on VFP DBF files on SQL Server","body":"<p>We're migrating our legacy system based Visual FoxPro to Java, and we need to configure the SQL Server to CRUD the DBF files of the system, because we'll rewrite the system in parts. So the employees will use both interfaces in the same time and we need real-time updates in both systems.</p>\n\n<p>Right now, I'm able to INSERT and SELECT data on SQL Server but I can't UPDATE and DELETE.</p>\n\n<p>I've run the following command to create the linked server:</p>\n\n<pre><code>sp_addlinkedserver @server = 'DEN',\n@srvproduct = 'foxpro',\n@provider = 'VFPOLEDB.1',\n@datasrc = 'D:\\BaseTeste\\denny\\denny_db.dbc'\n</code></pre>\n\n<p>And run the following SQL to update a table:</p>\n\n<pre><code>UPDATE DEN...produtos SET familia=1 WHERE id=35\n</code></pre>\n\n<p>And I've received this error:</p>\n\n<blockquote>\n  <p>OLE DB provider \"VFPOLEDB\" for linked server \"DEN\" returned message \"Multiple-step OLE DB operation generated errors. Check each OLE DB status value, if available. No work was done.\".</p>\n  \n  <p>Msg 7333, Level 16, State 2, Line 1</p>\n  \n  <p>Cannot fetch a row using a bookmark from OLE DB provider \"VFPOLEDB\" for linked server \"DEN\".</p>\n</blockquote>\n\n<p>How to solve that?\nThanks.</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2391,"score":0,"question_id":3033959,"title":"user instance login flag is not supported on this version of sql server","body":"<p>I have created an Asp.net website using VS 2008 and SQL Express 2008 on one PC. with db files in |Data Directory|.<br>\nWhen i copied these website files to another PC ( having same VS 2008 and SQL Express 2008) its giving me error<br>\nuser instance login flag is not supported on this version of sql server</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13198805,"title":"Remove duplicate batches of data","body":"<p>Due to a bug in my application a table that was built to carry daily records of each delivery period, was populated many times.</p>\n\n<p>Lets say I have a delivery from 1st of June to 5 of June. My table should be populated with 5 records, one for each day. Now, I have havoc because I have many \"batches\" of the same content.</p>\n\n<p>The table layout is as:</p>\n\n<pre><code>dummy_id       -- identity column\ndelivery_id    -- id of the delivery\non_date        -- the day\ncharge         -- the daily cost\n</code></pre>\n\n<p>Is there an elegant way to keep only the first batch of records and delete the batches that were inserted by mistake for all the deliveries?</p>\n"},{"tags":["sql-server","sql-server-2008-r2","sql-update"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13198476,"title":"Cannot use UPDATE with OUTPUT clause when a trigger is on the table","body":"<p>i'm performing an <code>UPDATE</code> with <code>OUTPUT</code> query:</p>\n\n<pre><code>UPDATE BatchReports\nSET IsProcessed = 1\nOUTPUT inserted.BatchFileXml, inserted.ResponseFileXml, deleted.ProcessedDate\nWHERE BatchReports.BatchReportGUID = @someGuid\n</code></pre>\n\n<p>This well and fine; until a trigger is defined on the table. Then my <code>UPDATE</code> statement will get the error <a href=\"http://msdn.microsoft.com/en-us/library/aa937592%28v=sql.80%29.aspx\" rel=\"nofollow\">334</a>:</p>\n\n<blockquote>\n  <p>The target table 'BatchReports' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause</p>\n</blockquote>\n\n<p>Now this problem is explained in <a href=\"http://blogs.msdn.com/b/sqlprogrammability/archive/2008/07/11/update-with-output-clause-triggers-and-sqlmoreresults.aspx\" rel=\"nofollow\">a blog post by the SQL Server team</a>:</p>\n\n<blockquote>\n  <p>The error message is self-explanatory</p>\n</blockquote>\n\n<p>And they also give solutions:</p>\n\n<blockquote>\n  <p>The application was changed to utilize the INTO clause</p>\n</blockquote>\n\n<p>Except i cannot make heads or tails of the entirety of the blog post.</p>\n\n<p>So let me ask my question: What should i change my <code>UPDATE</code> to so that it works?</p>\n\n<h2>See also</h2>\n\n<ul>\n<li><a href=\"http://blogs.msdn.com/b/sqlprogrammability/archive/2008/07/11/update-with-output-clause-triggers-and-sqlmoreresults.aspx\" rel=\"nofollow\">UPDATE with OUTPUT clause  Triggers  and SQLMoreResults</a></li>\n<li><a href=\"http://stackoverflow.com/questions/6504173/why-is-the-target-table-of-a-merge-statement-not-allowed-to-have-enabled-rules\">Why is the target table of a MERGE statement not allowed to have enabled rules?</a></li>\n<li><a href=\"http://stackoverflow.com/questions/12537653/statement-contains-an-output-clause-without-into-clause-error\">Statement contains an OUTPUT clause without INTO clause error</a></li>\n</ul>\n"},{"tags":["sql-server","ssas","data-warehouse","olap-cube"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13114338,"title":"Unable to build SQL Server OLAP Cube when there is no rows corresponding to foreign key in a table","body":"<p>I am  new to SQL Server OLAP Cubes.  I am having the following issue  like  </p>\n\n<p>ex  I have  purchase order and invoice tables  which are used in data source view. These two tables are related  by purchase order ID  which have one to many relationship with invoices.</p>\n\n<p>I am getting the following error for the purcahse orders which i dont have invoices </p>\n\n<p>Errors in the OLAP storage engine: The attribute key cannot be found when processing: Table: purchase order </p>\n\n<p>Can anyone throw some light  on this to help me</p>\n"},{"tags":["sql-server","hibernate","hbm2ddl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13174286,"title":"Hibernate hbm2ddl does not create foreign keys on SQLServer 2008","body":"<p>I am trying to generate foreign keys via hibernate hbm2ddl with: </p>\n\n<pre><code>   hibernate.hbm2ddl.auto=update\n</code></pre>\n\n<p>And using the following mapping:</p>\n\n<pre><code>   @OneToOne\n   @ForeignKey(name=\"FK_address_nationality_id\")\n   private Nationality country;\n</code></pre>\n\n<p>It creates the table, with a country column but no foreign key is created.\nWhy might this be?</p>\n"},{"tags":["sql-server","tsql","inner-join"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13198223,"title":"The effect of a select with multiple tables in FROM is the same as INNER JOIN but what is the ON clause then?","body":"<p>I have a query like this:</p>\n\n<pre><code>SELECT\n    *\nFROM\n    table1,\n    table2\n</code></pre>\n\n<p>I know this is somewhat equivalent to:</p>\n\n<pre><code>SELECT\n    *\nFROM\n    table1\nINNER JOIN\n    table2\nON ???\n</code></pre>\n\n<p>However, what would be the resulting ON clause for the join?</p>\n\n<h2>Update</h2>\n\n<p>After some testing in SSMS here are my findings</p>\n\n<pre><code>SELECT * FROM table1,table2\n</code></pre>\n\n<p>gives the same execution plan and the same records as</p>\n\n<pre><code>SELECT * FROM table1 INNER JOIN table2 ON 1=1\n</code></pre>\n\n<p>and the same thing for</p>\n\n<pre><code>SELECT * FROM table1 CROSS JOIN table2\n</code></pre>\n"},{"tags":["c#","sql","sql-server","ado.net"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":677,"score":2,"question_id":4369315,"title":"Datetime has too many decimal places","body":"<p>I have the following code:</p>\n\n<pre><code>SqlConnectionStringBuilder builder = new SqlConnectionStringBuilder();\n// set properties on  builder (omitted for brevity)\n\nusing (SqlConnection connection = new SqlConnection(builder.ToString()))\n{\n    connection.Open();\n    using (SqlCommand command = connection.CreateCommand())\n    {\n        command.CommandType = System.Data.CommandType.Text;\n        command.CommandText = \"SELECT * FROM Employee WHERE WhenHire &lt; @HireDate\";\n        SqlParameter hireDateParameter = new SqlParameter(\"@HireDate\", DateTime.Now);\n        command.Parameters.Add(hireDateParameter);\n        using (SqlDataReader reader = command.ExecuteReader())\n        {\n            while (reader.Read())\n            {\n                // do stuff\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Which shows up in SQL Profiler as:</p>\n\n<pre><code>exec sp_executesql N'SELECT * FROM Employee WHERE WhenHire &lt; @HireDate',\n                   N'@HireDate datetime',\n                   @HireDate='2010-12-06 11:43:23.573'\n</code></pre>\n\n<p>How is the precision of the datetime parameter determined?  I've seen this have 7 digits after the decimal.  </p>\n\n<pre><code>exec sp_executesql N'SELECT * FROM Employee WHERE WhenHire &lt; @HireDate',\n               N'@HireDate datetime',\n               @HireDate='2010-12-06 11:43:23.5733125'\n</code></pre>\n\n<p>In that case, the statement fails to execute with this error:</p>\n\n<blockquote>\n  <p>Msg 8114, Level 16, State 1, Line 1\n  Error converting data type varchar to\n  datetime.</p>\n</blockquote>\n"},{"tags":["php","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13198460,"title":"Connect Php with sqlserver with out install a PDO","body":"<p>I need to know if there is any way to <code>conect php with sqlserver without install a PDO</code> on php,\nThe reason that I want to avoid install a pdo is that I have a production enviroment for application and there are like 100 application already runnig, so request install this, it will be reject it.</p>\n\n<p>If you have any advice It will be usefull to me.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","database","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13198384,"title":"What does &gt; 0 mean in SQL?","body":"<p>I have the following SQL statement. Please tell me if my translation of it is accurate. I'm using MS SQL Server 2008. Thanks</p>\n\n<pre><code>(bld_sqft &amp;gt; 0 OR bld_area &amp;gt; 0)\n</code></pre>\n\n<p>My translation</p>\n\n<pre><code>bld_sqft &gt; 0 OR bld_area &gt; 0\n</code></pre>\n"},{"tags":["sql","sql-server","string-concatenation","sql-server-group-concat"],"answer_count":11,"favorite_count":43,"up_vote_count":52,"down_vote_count":0,"view_count":62889,"score":52,"question_id":273238,"title":"How to use GROUP BY to concatenate strings in SQL Server?","body":"<p>How do I get:</p>\n\n<pre><code>id       Name       Value\n1          A          4\n1          B          8\n2          C          9\n</code></pre>\n\n<p>to</p>\n\n<pre><code>id          Column\n1          A:4, B:8\n2          C:9\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13181245,"title":"What is the default user mapping for a server role in SQL Server 2008","body":"<p>I am learning the relations among authentication-user-role-schema. In my application I am using my Windows authentication which is assigned as sysadmin(as well as public) server role. </p>\n\n<p>After that, when I am executing <code>SELECT CURRENT_USER</code>, I get <code>dbo</code>. However, I can't find the mapping from the server role to the database user. I also tested by creating a login which has the server role as public. Using this login, I got guest when I executed <code>SELECT CURRENT_USER</code>. </p>\n\n<p>So where does this mapping get defined?</p>\n"},{"tags":["sql","sql-server","query","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":47,"score":-2,"question_id":13195515,"title":"How to set a NULL in the first and second record?","body":"<p>I have the following query:  </p>\n\n<pre><code>Declare @t Table(Id int identity,Groep int,[Date] Datetime,MondayMorning      \nInt,MondayEvening Int,TuesdayMorning Int,TuesdayEvening Int ,WednesdayMorning    \nInt,WednesdayEvening Int)\nInsert Into @t Select 2,'2012-01-01',2,0,2,2,2,2\nunion all\nSelect 2,'2012-01-02', 2,2,2,3,2,2\nunion all\nSelect 3,'2012-01-03', 2,2,2,2,2,2\n\n\nselect Id, Groep ,[Date], MondayMorning, MondayEvening, TuesdayMorning,TuesdayEvening, WednesdayMorning, WednesdayEvening\nfrom @t t\nunion all\nselect Id, Groep, [Date], MondayMorning, MondayEvening, TuesdayMorning,TuesdayEvening, WednesdayMorning, WednesdayEvening\nFrom @t tt\n\nWHERE tt.MondayMorning &lt;&gt; tt.MondayEvening\nAND (tt.MondayMorning != 0 and tt.MondayEvening != 0)\nOR tt.TuesdayMorning &lt;&gt; tt.TuesdayEvening\nAND (TuesdayEvening != 0 and TuesdayMorning != 0)\nOR tt.WednesdayMorning &lt;&gt; tt.WednesdayEvening\nAND (tt.WednesdayEvening != 0 and tt.WednesdayMorning != 0)\n</code></pre>\n\n<p>This query gives me a result that is actually correct. I just need to set in TuesdayEvening a Null value in the first record with Id=2. In the second record from that Id=2 set TuesdayMorning = null</p>\n\n<p>To see how this works just run the query.</p>\n\n<p>any ideas?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis","tsqlt"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":13196802,"title":"SQL - Foreign Key Constraint Error with Update Statement","body":"<p>I am Trying to update my table (product) columns - ProductID(FK) and ProductType(FK). These two column has relation with MProduct table's column MProductID(PK) and MProductType(PK).</p>\n\n<p>I am trying to update </p>\n\n<pre><code>ProductID       ProductType\n9999            11\n9999            12\n</code></pre>\n\n<p>But I got the following error </p>\n\n<pre><code>The UPDATE statement conflicted with the FOREIGN KEY constraint \"FKHCR_MProduct\".\nThe conflict occurred in database \"XXXX\", table \"dbo.MProduct\".\n</code></pre>\n\n<p>I checked with MProduct table, It has all the valid records for look up. I can not change my Table Structure.</p>\n\n<p>I tried this Query too</p>\n\n<pre><code>Select ProductID,ProductType\nfrom dbo.Product P\nLeft Join dbo.MProduct M on M.ProductID = P.ProductID\n   and M.ProductType = P.ProductType\nwhere M.ProductType is null\n   and M.ProductID is null\n</code></pre>\n\n<p>and there is No Output, means there is No Null Data Inside the Look up table.</p>\n"},{"tags":["sql-server","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13196804,"title":"How to set collate on database when using EF code-first","body":"<p>I am trying to set collate to Latin1_General_100_CI_AS in a database created by EF code-first. I am using EF 5. To do this I am using a DbInitializer of type DropCreateDatabaseAlways and overriding the Seed method. In it I am executing the following code as the first statement.</p>\n\n<pre><code>context.Database.ExecuteSqlCommand(\"ALTER DATABASE EMR_SA COLLATE Latin1_General_100_CI_AS\");\n</code></pre>\n\n<p>This executes fine and does modify the database correctly, but the problem is that after this statement I seed some database values. When I try to commit these inserts I get the following  error </p>\n\n<pre><code>  InnerException: System.Data.SqlClient.SqlException\n   HResult=-2146232060\n   Message=Resetting the connection results in a different state than the initial login. The login fails.\n   Login failed for user \n</code></pre>\n\n<p>While writing this question it appears that this is a duplicate of <a href=\"http://stackoverflow.com/questions/12054930/set-database-collation-in-entity-framework-code-first-initializer\">this QA</a> but there is no answer for it.  I am hoping by resubmitting this question that someone has had experience since then that may allow them to answer this now. What is the best way to set collate on a database when using EF code-first?</p>\n"},{"tags":["sql-server","sql-server-2008-express"],"answer_count":7,"favorite_count":8,"up_vote_count":28,"down_vote_count":0,"view_count":31249,"score":28,"question_id":1169634,"title":"Limitations of SQL Server Express","body":"<p>My hosting provider (Rackspace) is offering a fully managed dedicated server with SQL Server Web version () installed. My company handles web development, and has about 20+ clients using ASP.Net + SQL Server 2005. </p>\n\n<p>I am thinking of cutting down costs by installing the free SQL Server 2008 Express instead. I am aware of the 1GB RAM and 4GB/database (is that correct?) limitations. What I would like to know is:</p>\n\n<ol>\n<li>Is there any limit to the NUMBER of databases I can install with the express edition?</li>\n<li>Are there any other limitations I should be wary of? I am a bit concerned about having to set up the database backup - with the express edition it might a lot more difficult.</li>\n<li>Any other advise?</li>\n</ol>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c#","sql","sql-server","linq-to-sql","max"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13196085,"title":"How to do one-select linq-to-sql MAX query?","body":"<p>This code</p>\n\n<pre><code>int maxTrackId = dataContext.TicketTracks.Max(T =&gt; T.TrackId);\n</code></pre>\n\n<p>Generates the following <code>SQL</code> code:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT MAX([t0].[TrackId]) AS [value]\nFROM [dbo].[TicketTracks] AS [t0]\n</code></pre>\n\n<p>But if the table is empty, I got an exception saing that nullable value cannot be assigned to non-nullable variable.</p>\n\n<p>Then I write this code, explicitly telling the SQL provider that i need either maximum or null:</p>\n\n<pre><code>int? maxTrackId = dataContext.TicketTracks.Max(T =&gt; (int?)T.TrackId);\n</code></pre>\n\n<p>And it works fine on that non-nullable SQL column, giving me back either <code>null</code> or the number. But the <code>SQL</code> code generated is kind of strange:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT MAX([t1].[value]) AS [value]\nFROM (\n    SELECT [t0].[TrackId] AS [value]\n    FROM [dbo].[TicketTracks] AS [t0]\n    ) AS [t1]\n</code></pre>\n\n<p>So it seems weird, especially with two <code>SELECT</code>s. Is there any way to circumvent this?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13195785,"title":"Is it possible for triggers not to fire?","body":"<p>On three different tables I have separate <code>INSERT</code>, <code>UPDATE</code> and <code>DELETE</code> triggers.</p>\n\n<p>I know positively that they work as expected (tried adding, deleting, updating and confirmed the changes going to log-table). However, it happens that rows are removed or added, without my log tables having any content.</p>\n\n<p>So my question is: Is it possible for instance to add a record without the enabled INSERT trigger being triggered?</p>\n\n<p>This is on SQL Server 2005.</p>\n"},{"tags":["sql","sql-server","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":13193693,"title":"SSIS Eror: insert values list doesnt match column list","body":"<p>In ssis component OLE DB Command:</p>\n\n<pre><code>insert into D_MAPPING_CLIENTS (ID, DIRECTORY_ID, SOURCE_ID, BASE_ID)\n  values (\n\n     case when exists ( select 1 from D_MAPPING_CLIENTS )\n           then ( select MAX(ID) + 1 from D_MAPPING_CLIENTS )\n\n         else 1\n     end\n\n  , ISNULL(?, \n      case when exists ( select 1 from D_MAPPING_CLIENTS )\n             then ( select MAX(DIRECTORY_ID) + 1 from D_MAPPING_CLIENTS )\n\n           else 1\n       end ) \n\n   , ( select ID from D_SOURCES_CLIENTS where SOURCE = 'D:\\load\\1\\clients.txt' )\n\n   , ?)\n</code></pre>\n\n<p>When I try to save it, i get an error: 'Insert value list does not match column list', although when i run this script in Management Studio it works fine. </p>\n\n<p>What's the problem?</p>\n\n<p>UPD: Where i replace last '?' to some value it works fine :o</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":13194630,"title":"SQL Server 2005 : conversion failed when converting the varchar value '0.00' to data type int","body":"<p>When adding this line into my query:</p>\n\n<pre><code>convert(varchar(20), convert(varchar(20),\nsum(case when tsr.other like '%aa%' then tsr.block1 else 0 end) +\nsum(case when tsr.other like '%aa%' then tsr.block2 else 0 end) +\nsum(case when tsr.other like '%aa%' then tsr.block3 else 0 end) +\nsum(case when tsr.other like '%aa%' then tsr.block4 else 0 end)) * 450) \n</code></pre>\n\n<p>I get this error message:</p>\n\n<blockquote>\n  <p><em>Conversion failed when converting the varchar value '0.00' to data\n  type int</em></p>\n</blockquote>\n\n<p>Data in block column is days - e.g. <code>10.0</code></p>\n\n<p>Any ideas?</p>\n\n<p>i've got it fixed, it was just changing the 450 to 450.0.</p>\n\n<p>The reason for the varchars is that this is just 1 line from 1 of multiple unioned select statements. </p>\n"},{"tags":["sql-server","sql-server-2008-r2","cpu-usage","read-only"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":14,"score":1,"question_id":13195537,"title":"Why is my CPU usage increase after setting database to read-only on SQL Server 2008 R2","body":"<p>I administrate a reporting database.</p>\n\n<p>We run all the denormalization process on a DB1 daily then we copy all the data to an another database DB2 on the same server which is queried by web applications and reporting tools.</p>\n\n<p>In order to improve performance I decided to set DB2 as Read-only after copying the data.</p>\n\n<p>Performance increased a lot in my case probably due to some improvement in caching with read-only DB2.</p>\n\n<p>But the next day the denormalization process run really slow from 6 hours usually it went to 15 hours. </p>\n\n<p>The CPU usage top 98-100% during the whole process. </p>\n\n<p>After some testing, it is clear that the CPU usage insanely raise because of the read-only DB2.</p>\n\n<p>I can't figure why.</p>\n\n<p>Can someone help me to understand this please?</p>\n\n<p>Is there a way to control this?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql-server","sql-server-2005","uniqueidentifier","uuid"],"answer_count":3,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":976,"score":6,"question_id":1930917,"title":"How do I identify a blank uniqueidentifier in SQL Server 2005?","body":"<p>I'm getting a <code>uniqueidentifier</code> into a Stored Procedure that looks like this </p>\n\n<p><code>00000000-0000-0000-0000-000000000000</code>.</p>\n\n<p>This seems like a simple thing, but how can identify that this is a blank <code>uniqueidentifier</code>? </p>\n\n<p>If I get a value like this <code>DDB72E0C-FC43-4C34-A924-741445153021</code> I want to do X</p>\n\n<p>If I get a value like this <code>00000000-0000-0000-0000-000000000000</code> I do Y</p>\n\n<p>Is there a more elegant way then counting up the zeros? </p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server","query","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":13191768,"title":"How to make two records from one?","body":"<p>I have records with the following:</p>\n\n<pre><code>Id    Date          MondayMorning  MondayEvening  TuesdayMorning, and so on\n1   2012-01-01          2               3   \n2   2012-01-01          2               2 \n</code></pre>\n\n<p>I want split record 1 in two records because the states of mondaymorning and mondayevening are not the same. If the state is the same then do nothing.  </p>\n\n<p>The result that I expect:</p>\n\n<pre><code>Id    Date          MondayMorning  MondayEvening  TuesdayMorning\n1   2012-01-01          2               NULL          2\n1   2012-01-01          NULL            3             2\n2   2012-01-01          2               2 \n</code></pre>\n\n<p>Please remember that also the other days can vary.</p>\n\n<p>How can I do this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","rollback"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":13188621,"title":"roll back SQL query executed by mistake","body":"<p>I think the question says it all,\nthe following update query has been executed - by mistake - in SQL Server management studio</p>\n\n<pre><code>update kms_students set student_campus='4' where student_campus='KL'\n</code></pre>\n\n<p>The effected rows are more than 1000, and i can't identify it since that table is already have the <code>student_campus='4'</code> for many previous rows.</p>\n\n<p>Is it possible to roll back?</p>\n"},{"tags":["c#","asp.net","sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13194185,"title":"How to display uploaded files in GridView and download them on clicking respective download linkbutton?","body":"<p>I am uploading files using fileupload, the details of the file such as file type, name of file, and complete path is getting stored in a table called exceldetails in database now i want to display the uploaded files and download them by clicking on a link button next to every file in GridView. This is how i am uploading files:</p>\n\n<pre><code>        string[] filePaths;\n    string strFileType = System.IO.Path.GetExtension(FileUpload1.FileName).ToString().ToLower();\n    string strFileName = FileUpload1.PostedFile.FileName.ToString();\n    FileUpload1.SaveAs(Server.MapPath(\"~/Import/\" + strFileName + strFileType));\n    string strNewPath = Server.MapPath(\"~/Import/\" + strFileName + strFileType);\n    string strNewPath1 = Server.MapPath(\"~/Import/\" + strFileName + strFileType).ToString();\n    fileSize = FileUpload1.PostedFile.ContentLength / 1024;\n\n    //EXCEL DETAILS TABLE\n    con.Open();\n    //=========================================\n    DataTable dt8 = new DataTable();\n    SqlCommand cmd8 = new SqlCommand(\"insert into exceldetails (name,type,details,size,path)\" + \"values(@name,@type,@details,@size,@path)\", con);\n    cmd8.Parameters.Add(\"@name\", SqlDbType.VarChar).Value = strFileName;\n    cmd8.Parameters.Add(\"@type\", SqlDbType.VarChar).Value = strFileType;\n    cmd8.Parameters.Add(\"@details\", SqlDbType.VarChar).Value = DateTime.Now;\n    cmd8.Parameters.Add(\"@size\", SqlDbType.Int).Value = fileSize;\n    cmd8.Parameters.Add(\"@path\", SqlDbType.NVarChar).Value = strNewPath;\n    cmd8.ExecuteNonQuery();\n    con.Close();\n    try\n    {\n        SqlDataAdapter da8 = new SqlDataAdapter(cmd8);\n        da8.Fill(dt8);\n    }\n    catch { }\n</code></pre>\n\n<p>I am a beginner as you can judge from the question itself so please tell me where i need to add what in detail</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":13194026,"title":"SQL Dynamic join?","body":"<p>Please see <a href=\"http://sqlfiddle.com/#!3/2506f/2/0\" rel=\"nofollow\">http://sqlfiddle.com/#!3/2506f/2/0</a></p>\n\n<p>I have two tables.  One is a general record, and the other is a table containing related documents that link to that record.</p>\n\n<p>In my example I've created a straightforward query which shows all records and their associated documents.  This is fine, but I want a more complex situation.</p>\n\n<p>In the 'mainrecord' table there is a 'multiple' field.  If this is 0, then I only want the most recent document from the documents table (that is, with the highest ID).  If it is 1, I want to join all linked documents.</p>\n\n<p>So, rather than the result of the query being this:-</p>\n\n<pre><code>ID  NAME    MULTIPLE    DOCUMENTNAME    IDLINK\n1   One     1           first document    1\n1   One     1           second document   1\n2   Two     0           third document    2\n2   Two     0           fourth document   2\n3   Three   1           fifth document    3\n3   Three   1           sixth document    3\n</code></pre>\n\n<p>It should look like this:-</p>\n\n<pre><code>ID  NAME    MULTIPLE    DOCUMENTNAME    IDLINK\n1   One     1           first document    1\n1   One     1           second document   1\n2   Two     0           fourth document   2\n3   Three   1           fifth document    3\n3   Three   1           sixth document    3\n</code></pre>\n\n<p>Is there a way of including this condition into my query to get the results I'm after.  I'm happy to explain further if needed.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13194307,"title":"SQL Server Insert based of additional query","body":"<p>Using SQL server is it possible to to a mass insert based on a sub query, Essentially I'm trying to do this.</p>\n\n<pre><code>Insert into ProductExtra (ProductID,ExtraID) \nVALUES \n(Select ProductID From ProductSKU \nJOIN Product on ProductSKU.ProductID = Product.ID\nWhere ItemType = 'fire grate' ), 10739\n</code></pre>\n"},{"tags":["asp.net","sql-server","caching"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":20,"score":-1,"question_id":13194187,"title":"Query Results not being returned on first call","body":"<p>I am facing a problem while running my application. The nature of problem is while my web application is running successfully, everything is working fine. At once it happens like my asp.net application is bringing some database results from some cache or else. but it dont bring true results. for example database.executenonquery(_command); will return first time null but on second execution it returns the true result.</p>\n\n<p>Can any body tell me whats the problem. Is ASP.NET got some caching system somewhere in it OR Enterprise Library has something to do with it.??????</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server","sql-server-ce","cascade"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":28,"score":3,"question_id":13193935,"title":"Cascade delete on many-to-many between same table","body":"<p>I'm trying to create a many-to-many relation between the same table in SQL Server.</p>\n\n<p>I have one table <code>Object</code> with columns <code>ObjectId</code> and <code>Name</code>.</p>\n\n<p>The relation follows these rules:  </p>\n\n<ul>\n<li>a child can have many parents  </li>\n<li>a parent can have many children  </li>\n<li>ObjectA can be a child of ObjectB and ObjectB can be a child of ObjectA  </li>\n<li>but an object cannot be a direct child of itself</li>\n</ul>\n\n<p>So I create a second table <code>ObjectRelation</code> with columns <code>ParentId</code> and <code>ChildId</code> and of course I want these relations to be deleted by cascade.</p>\n\n<p>But when I try this in SQL Server I get the error </p>\n\n<blockquote>\n  <p>Introducing FOREIGN KEY constraint 'FK_ObjectRelation_Object1' on table 'tblADMembership' may cause cycles or multiple cascade paths. Specify ON DELETE NO ACTION or ON UPDATE NO ACTION, or modify other FOREIGN KEY constraints.</p>\n</blockquote>\n\n<p>In SQL Server Compact I get</p>\n\n<blockquote>\n  <p><em>The referential relationship will result in a cyclical reference that is not allowed.</em></p>\n</blockquote>\n\n<p>I've done some research and I understand why I get these errors, but is there a way around this that will also work on SQL Server Compact (so no stored procedures)? Or is there a better way to model this relationship?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13193852,"title":"Copy from all tables, insert into all tables (sp_MSforeachtable alternative)","body":"<p>I've decided to share my experience in trying to copy data from all tables into the same name tables in a different schema. I'm sure my experience can help others seeking mass table operations without using the unsupported and frankly limited sp_MSforeachtable.</p>\n\n<p><strong>Objective:</strong> Copy data from all tables in my database to identically named tables with different schema</p>\n\n<p><em>One quick note about</em> sp_MSforeachtable. <em>Most of the time when people ask questions here in SO about this stored procedure, there's some reply or another saying that we shouldn't use unsupported features. This is simply not true, what we shouldn't do is have practices and design decisions based on unsupported features, mostly because they might go away.\nBut at some specific point in time, if an unsupported feature exists and does exactly what we need to do right then, one-off style, then just consider yourself lucky and by all means use it, just be careful about unexpected behaviors. When using such features, best to stick with simple operations whose output is quickly and easily verifiable.</em></p>\n\n<p>With that said, and also because there's some real limitations to sp_MSforeachtable, I am presenting a different but not too complicated way of executing statements against all (or specific) tables in our database and I'm using my problem as an example.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13193627,"title":"SQL - Update causing deadlock error","body":"<p>I'm trying to update a row in a table upon someone viewing the page (it increments the viewed count), however now and then I get a deadlock error, I'm guessing this is due to two or more people trying to update the same row?</p>\n\n<p>The error is:</p>\n\n<pre><code>Transaction (Process ID 60) was deadlocked on lock | communication buffer resources with another process and has been chosen as the deadlock victim. Rerun the transaction.\n</code></pre>\n\n<p>And my SQL is:</p>\n\n<pre><code>UPDATE [ProductDescription] \nSET [ViewCount] = ([ViewCount] + 1) \nWHERE ProductCode = @prodCode \n    AND ApplicationID = @AppID\n</code></pre>\n\n<p>I believe I may need a WITH(NOLOCK)?</p>\n"},{"tags":["c#","sql-server","asp.net-mvc","entity-framework","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13192696,"title":"Mapping stored procedures to entities with additional computed column","body":"<p>I am currently stuck with one of my projects and need some help..</p>\n\n<p>I created a table valued function in MSSQL that returns a table and a computed column (Distance) and have mapped it in Entity Framework 5 using the Entity Designer. </p>\n\n<p>The problem is that I can only map the results either as a complex type or an entity that is in my model class. I need to use one of the Navigation Property in the entity and hence, I am stuck with using my entity class. </p>\n\n<p>However, because the column Distance is not a real column in my table, I have no way of getting that value for every entity for the table valued function. </p>\n\n<p>Is there any way of hacking around this? I've tried using a partial class but the function would not map the Distance column as a property for me. </p>\n\n<p>Here's a little code to explain what I'm trying to do here :</p>\n\n<pre><code>IQueryable&lt;Deal&gt; deals = context.GetDealsByTypeLocationSearch(latitude, longitude);\nforeach (var d in deals)\n{\n  Console.Write(d.Distance); \n}\n</code></pre>\n\n<p>The distance value is null when I tried to create a partial class for my entity Deal.</p>\n"},{"tags":["sql","sql-server","query","postgresql","plpgsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13008116,"title":"routing network function issue","body":"<p>Following on from a <a href=\"http://stackoverflow.com/q/12990638/398670\">this question</a>, I have some dynamic SQL I'm running successfully in PL/PgSQL with <code>EXECUTE</code>, but it doesn't seem to have the intended effect.</p>\n\n<p>The following code is part of a plpgsql function that I have created. This intends to go to each point that is lying on the same track and for each point find its nearest point in order to eventually I will create a network between all the tracks. For some reson it is not working properly.</p>\n\n<p>The i represent the number of the current track.</p>\n\n<pre><code> DECLARE\n    _r record;\n    i int := 0;\n    source_geom character varying;\n    target_geom character varying;\n\nBEGIN\n\nWHILE i &lt; 3 --DEPENDS ON THE NUMBER OF TRACKS\nLOOP\n\nFOR _r IN EXECUTE ' SELECT a.'|| quote_ident(gid_cname) || ' AS id,'\n|| ' st_astext( a.'||quote_ident(geo_cname)||') AS source,' \n|| ' st_astext(b.'||quote_ident(geo_cname)||') AS target, ' \n|| ' ST_Distance(a.'||quote_ident(geo_cname) || ' ,  b.'||quote_ident(geo_cname)||') As dist_ft'\n|| ' FROM ' || quote_ident (geom_table) ||' AS a INNER JOIN ' || quote_ident(geom_table) || ' As b ON ST_DWithin(a.'||quote_ident(geo_cname)|| ', b.'||quote_ident(geo_cname)|| ',1000)'\n|| ' WHERE b.'||quote_ident(gid_cname)|| ' &gt; a.'||quote_ident(gid_cname)|| ' AND b.'||quote_ident(tid_cname)|| ' = '||i|| 'AND a.'||quote_ident(tid_cname)|| ' = '||i|| \n   ' ORDER BY dist_ft '\n|| ' Limit 1 '\n\nLOOP\n\nsource_geom := _r.source;\ntarget_geom := _r.target;\n\n\nEXECUTE 'update ' || quote_ident(geom_table) || \n    ' SET source = ''' || source_geom ||''' \n    , target = ''' || target_geom || ''' \n    WHERE ' || quote_ident(gid_cname) || ' =  ' || _r.id;\nEND LOOP;\n\ni = i + 1;\n\nEND LOOP;\n\nRETURN 'OK';\nEND;\n</code></pre>\n\n<p>The thing is that I have tested the query in plain sql and it worked brilliantly. Now for some reason in plpgsql it is not working properly. Below you can find the same query in plain sql. </p>\n\n<pre><code>SELECT a.ogc_fid AS id, st_astext( a.wkb_geometry) AS source, st_astext(b.wkb_geometry) AS target, ST_Distance(a.wkb_geometry, b.wkb_geometry) As dist_ft\nFROM track_points AS a INNER JOIN track_points As b\nON ST_DWithin(a.wkb_geometry , b.wkb_geometry, 1000)\nWHERE b.ogc_fid &gt; a.ogc_fid AND b.track_fid = 0 AND a.track_fid = 0 \norder by dist_ft\n</code></pre>\n"},{"tags":["sql-server","ado.net","sql-server-2000","data-synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13068930,"title":"Synchronising SQL Server data via xml export","body":"<p>I need someone's expertise on the following:</p>\n\n<p>I am building a web-facing system for a client which needs to sync 30-odd tables between it and their .NET 1.1 WinForms application. To minimise interaction between us for the sake of both of our sanity, I suggested using XML, like so</p>\n\n<pre><code>SELECT *\nFROM table1\nFOR XML AUTO, XMLDATA\n</code></pre>\n\n<p>The caveat is that I need the primary keys to remain the same between the source and destination DB's. Is there an elegant way of importing the XML? I don't want to write ugly SQL to drop and recreate tables and relationships each time there is a data sync. Is there a way via ADO.NET or Entity Framework 3 to tell the database \"Look, here's your data, please use it instead of what you currently have\"?</p>\n\n<p>Here's an example of the exported XML:</p>\n\n<pre><code>&lt;taxGroup&gt;\n   &lt;Schema name=\"Schema29\" xmlns=\"urn:schemas-microsoft-com:xml-data\" xmlns:dt=\"urn:schemas-microsoft-com:datatypes\"&gt;\n      &lt;ElementType name=\"taxGroup\" content=\"empty\" model=\"closed\"&gt;\n         &lt;AttributeType name=\"taxGroupId\" dt:type=\"i8\"/&gt;\n         &lt;AttributeType name=\"regionId\" dt:type=\"i8\"/&gt;\n         &lt;AttributeType name=\"description\" dt:type=\"string\"/&gt;\n         &lt;AttributeType name=\"percentage\" dt:type=\"number\"/&gt;\n         &lt;AttributeType name=\"exportNumber\" dt:type=\"string\"/&gt;\n         &lt;attribute type=\"taxGroupId\"/&gt;\n         &lt;attribute type=\"regionId\"/&gt;\n         &lt;attribute type=\"description\"/&gt;\n         &lt;attribute type=\"percentage\"/&gt;\n         &lt;attribute type=\"exportNumber\"/&gt;\n      &lt;/ElementType&gt;\n   &lt;/Schema&gt;\n   &lt;taxGroup xmlns=\"x-schema:#Schema29\" taxGroupId=\"38000001\" regionId=\"1482000001\" description=\"VAT\" percentage=\"0.1400\" exportNumber=\"\"/&gt;\n   &lt;taxGroup xmlns=\"x-schema:#Schema29\" taxGroupId=\"38000002\" regionId=\"1482000001\" description=\"VAT2\" percentage=\"0.1700\" exportNumber=\"\"/&gt;\n&lt;/taxGroup&gt; \n</code></pre>\n\n<p>Note: the two DB's don't have access to one another. The transport is via Secure HTTPRequest.</p>\n\n<p>Update 2: The Winforms app uses SQL2000, which makes using the Synch Framework impossible, apparently...</p>\n\n<p>Update 3: Let's just take it as a given that I am stuck having to do things in this manner. The .NET app is deployed at various 3rd party sites, each having a separate copy of the DB and connecting to a separate instance of the web application. It's a reseller package, for all intents and purposes: a physical storefront component and an online store component. Some third parties refuse to upgrade from SQL2000.</p>\n"},{"tags":["sql-server","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13186948,"title":"SQL Server : how to return several row into one variable","body":"<p>I'm kinda new to using stored procedures, so I have stumbled upon two questions.</p>\n\n<p>First why am I not allowed to do this? Error message says:</p>\n\n<blockquote>\n  <p><em>Operand type clash: date is incompatible with int</em></p>\n</blockquote>\n\n<p>Code : </p>\n\n<pre><code>@time date OUTPUT\n\nSELECT @time = ranking_date \nFROM [dbo].[t_ranking] \nWHERE ranking_date &lt;= DATEDIFF(day, @todaysDateminusthirty, @todaysdate) \n  AND ranking_keyword = @keyword\n  AND ranking_id_doman = @domainID\n</code></pre>\n\n<p>Onwards how can I return my result as a complete dataset? Instead of saving into two variables? Or can they hold more than one row?</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[fetchRankingData]\n-- Add the parameters for the stored procedure here\n@domannamn [varchar](100),\n@keyword [varchar](100),\n@rankingen [decimal](6,2) OUTPUT,\n@time date OUTPUT\n\nAS\nDECLARE @domainID int\nDECLARE @todaysDateminusthirty datetime\nDECLARE @todaysdate datetime\n\nBEGIN\nSET NOCOUNT ON;\n\nIF EXISTS(SELECT 1 FROM [dbo].[t_doman] WHERE doman_namn = @domannamn)\nBEGIN\nset @todaysdate = getdate()\nset @todaysDateminusthirty = DATEADD(day,-30,@todaysdate)\n\nSELECT @domainID = doman_id FROM [dbo].[t_doman] WHERE doman_namn = @domannamn\n\nIF EXISTS(SELECT 1 FROM [dbo].[t_ranking] WHERE ranking_id_doman = @domainID AND ranking_keyword = @keyword)\nBEGIN   \n    SELECT @rankingen = ranking_position FROM \n        [dbo].[t_ranking] WHERE   ranking_keyword = @keyword \n            AND ranking_id_doman = @domainID\n    SELECT @time = ranking_date FROM \n        [dbo].[t_ranking] WHERE ranking_date &lt;= DATEDIFF(day,@todaysDateminusthirty,@todaysdate) AND ranking_keyword = @keyword\n            AND ranking_id_doman = @domainID    \nEND \nEND\nEND\n</code></pre>\n"},{"tags":["sql-server","service-broker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13192824,"title":"SQL Service Broker  one central SQL and more satelite SQL transmission_status \"disabled or not configured\"","body":"<p><strong>Summary:</strong> I do observe the \"The Service Broker protocol transport is disabled or not configured.\" in the <code>transmission_status</code> of the queue. It seems that some more detail should be set. Or what am I missing?</p>\n\n<p>The question is directly related to <a href=\"http://stackoverflow.com/a/11704632/1346705\">the answer to my earlier question</a>.\nI did follow the advice with using special trick <code>GRANT CONNECT ON ENDPOINT::[&lt;brokerendpointname&gt;] TO [public]</code> to simplify the plug-in kind of configuration in the trusted local network:</p>\n\n<pre><code>create message type...\ncreate contract ...\ncreate queue ...\ncreate service [tcp://MACHINE3:4022/Satellite] \n   on ...\n   ([...]);\ngrant send on service::[tcp://MACHINE3:4022/Satellite] to [public];\ncreate route transport with address = 'TRANSPORT';\n</code></pre>\n\n<p>For the case the detail may play the role, here is the extract of the real code:</p>\n\n<pre><code>USE [MySatelliteDB];\n\nCREATE MESSAGE TYPE [//x/y/RequestMessage]\n  VALIDATION = WELL_FORMED_XML;\n\nCREATE MESSAGE TYPE [//x/y/ReplyMessage]\n  VALIDATION = WELL_FORMED_XML;\n\nCREATE CONTRACT [//x/y/SimpleContract]\n  ([//x/y/RequestMessage] SENT BY INITIATOR,\n   [//x/y/ReplyMessage]   SENT BY TARGET);\n\nCREATE QUEUE GenericQueue;\nCREATE SERVICE [tcp://192.168.4.120:4022/GenericService]\n  ON QUEUE GenericQueue ([//x/y/SimpleContract]);\n\nGRANT SEND ON SERVICE::[tcp://192.168.4.120:4022/GenericService] TO [public];\n\nCREATE ROUTE transport WITH ADDRESS = 'TRANSPORT';\n</code></pre>\n\n<p>The central machine uses the same except of the database name, and the IP address (ends with 158 in the case). Then I tried to send the explicit dummy message...</p>\n\n<pre><code>DECLARE @InitDlgHandle UNIQUEIDENTIFIER;\nDECLARE @RequestMsg NVARCHAR(100);\n\nBEGIN TRANSACTION;\n\nBEGIN DIALOG @InitDlgHandle\n     FROM SERVICE [tcp://192.168.4.120:4022/GenericService]\n     TO SERVICE N'tcp://192.168.4.158:4022/GenericService'\n     ON CONTRACT [//x/y/SimpleContract]\n     WITH\n         ENCRYPTION = OFF;\n\nSELECT @RequestMsg = N'&lt;RequestMsg&gt;Message for Target service.&lt;/RequestMsg&gt;';\n\nSEND ON CONVERSATION @InitDlgHandle\n     MESSAGE TYPE [//x/y/RequestMessage]\n     (@RequestMsg);\n\nSELECT @RequestMsg AS SentRequestMsg;\n\nCOMMIT TRANSACTION;\nGO\n</code></pre>\n\n<p>It displayed</p>\n\n<pre><code>SentRequestMsg\n&lt;RequestMsg&gt;Message for Target service.&lt;/RequestMsg&gt;\n</code></pre>\n\n<p>... apparently as the result of the last select. This way I guess the <code>COMMIT TRANSACTION</code> succeeded. (No error message observed.)</p>\n\n<p>Then I opened the SSMS window for the other SQL server and tried to receive...</p>\n\n<pre><code>DECLARE @RecvReqDlgHandle UNIQUEIDENTIFIER;\nDECLARE @RecvReqMsg NVARCHAR(100);\nDECLARE @RecvReqMsgName sysname;\n\nBEGIN TRANSACTION;\n\nWAITFOR\n( RECEIVE TOP(1)\n    @RecvReqDlgHandle = conversation_handle,\n    @RecvReqMsg = message_body,\n    @RecvReqMsgName = message_type_name\n  FROM GenericQueue\n), TIMEOUT 1000;\n\nSELECT @RecvReqMsg AS ReceivedRequestMsg;\n\nIF @RecvReqMsgName =\n   N'//x/y/RequestMessage'\nBEGIN\n     DECLARE @ReplyMsg NVARCHAR(100);\n     SELECT @ReplyMsg =\n        N'&lt;ReplyMsg&gt;Message for Initiator service.&lt;/ReplyMsg&gt;';\n\n     SEND ON CONVERSATION @RecvReqDlgHandle\n          MESSAGE TYPE\n            [//x/y/ReplyMessage] (@ReplyMsg);\n\n     END CONVERSATION @RecvReqDlgHandle;\nEND\n\nSELECT @ReplyMsg AS SentReplyMsg;\n\nCOMMIT TRANSACTION;\nGO\n</code></pre>\n\n<p>It displayed two results with unexpected values</p>\n\n<pre><code>ReceivedRequestMsg\nNULL\n---------------------------------------------\nSentReplyMsg\nNULL\n</code></pre>\n\n<p>No error messages observed.</p>\n\n<p>When running the script...</p>\n\n<pre><code>USE [MySatelliteDB];\n\nSELECT * FROM GenericQueue WITH (NOLOCK);\nSELECT * FROM sys.transmission_queue;\n</code></pre>\n\n<p>I can see that something does not work correctly (was one line, wrapped manually)</p>\n\n<pre><code>conversation_handle                   to_service_name                        \n1A227CA7-6F24-E211-B1EC-004063F5CE90  tcp://192.168.4.158:4022/GenericService  \n------------------------------------------------------------------------------...\nto_broker_instance                    from_service_name\n&lt;empty&gt;                               tcp://192.168.4.120:4022/GenericService\n------------------------------------------------------------------------------...\nservice_contract_name                 enqueue_time\n//x/y/SimpleContract                  2012-11-01 22:01:15.440\n------------------------------------------------------------------------------...\nmessage_sequence_number  message_type_name  \n0                        /x/y/RequestMessage\n------------------------------------------------------------------------------...\nis_conversation_error    is_end_of_dialog    message_body   \n0                        0                   0x3C0052006...snip...3E00\n------------------------------------------------------------------------------...\ntransmission_status                                                    priority\nThe Service Broker protocol transport is disabled or not configured.   5\n</code></pre>\n\n<p>What should I focus on to make it working?</p>\n\n<p>Thanks for your time,\n   Petr</p>\n"},{"tags":["c#","sql-server","winforms","math","expressions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":12278418,"title":"How to store and retrieve mathematical expressions to/from SQL Server database?","body":"<p>How to store and retrieve mathematical expressions from SQL Server database? I am copying these formulas from ms word and using rich textbox in winforms in c# code to store it from where I want to push those in SQL Server database and pull it back to show in ASP.NET web application. Any thoughts???</p>\n"},{"tags":[".net","sql","sql-server","dataset"],"answer_count":7,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":11976,"score":7,"question_id":589976,"title":"How can you name the Dataset's Tables you return in a stored proc?","body":"<p>I've got the following stored procedure</p>\n\n<pre><code>Create procedure psfoo ()\nAS\nselect * from tbA\nselect * from tbB\n</code></pre>\n\n<p>I'm then accessing the data this way :</p>\n\n<pre><code>     Sql Command mySqlCommand = new SqlCommand(\"psfoo\" , DbConnection)\n     DataSet ds = new DataSet();\n     mySqlCommand.CommandType = CommandType.StoredProcedure;\n     SqlDataAdapter mySqlDataAdapter = new SqlDataAdapter();\n     mySqlDataAdapter.SelectCommand = mySqlCommand;\n     mySqlDataAdapter.Fill(ds);\n</code></pre>\n\n<p>Now, when I want to access my tables, I have to do this :</p>\n\n<pre><code>     DataTable datatableA = ds.Tables[0];\n     DataTable datatableB = ds.Tables[1];\n</code></pre>\n\n<p>the dataset Tables property also got an accessor by string (instead of int).</p>\n\n<p><strong>Is it possible so specify the name of the tables in the SQL code, so that I can instead write this :</strong></p>\n\n<pre><code>     DataTable datatableA = ds.Tables[\"NametbA\"];\n     DataTable datatableB = ds.Tables[\"NametbB\"];\n</code></pre>\n\n<p>I'm using SQL server 2008, if that makes a difference.</p>\n"},{"tags":[".net","sql-server","service-broker"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":1,"view_count":1040,"score":3,"question_id":2025166,"title":"SQL Service Broker Success?","body":"<p>I am contemplating converting our internal application from MSMQ and WCF to SSB.  We would like a more feature rich system with regards to our queuing.  </p>\n\n<p>However, I am not seeing a lot of implementations or general information if SSB is in use with .Net.  The SSB blog is not very active and I see few posts in general on implementation successes or advice.</p>\n\n<p>Is SSB used much?  Are there better alternatives for queuing and .Net?  </p>\n"},{"tags":["sql-server","code-generation"],"answer_count":15,"favorite_count":35,"up_vote_count":69,"down_vote_count":0,"view_count":55352,"score":69,"question_id":982568,"title":"What is the best way to auto-generate INSERT statements for a SQL Server table?","body":"<p>We are writing a new application, and while testing, we will need a bunch of dummy data.  I've added that data by using MS Access to dump excel files into the relevant tables.</p>\n\n<p>Every so often, we want to \"refresh\" the relevant tables, which means dropping them all, re-creating them, and running a saved MS Access append query.</p>\n\n<p>The first part (dropping &amp; re-creating) is an easy sql script, but the last part makes me cringe.  I want a single setup script that has a bunch of INSERTs to regenerate the dummy data.</p>\n\n<p>I have the data in the tables now.  What is the best way to automatically generate a big list of INSERT statements from that dataset?</p>\n\n<p>I'm thinking of something like in TOAD (for Oracle) where you can right-click on a grid and click Save As->Insert Statements, and it will just dump a big sql script wherever you want.</p>\n\n<p>The only way I can think of doing it is to save the table to an excel sheet and then write an excel formula to create an INSERT for every row, which is surely not the best way.</p>\n\n<p>I'm using the 2008 Management Studio to connect to a SQL Server 2005 database.</p>\n"},{"tags":["sql-server","tsql","date-range"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13192073,"title":"TSQL DateRange counting day by day","body":"<p>I solve the problem which counts for 1 day but when I split the days into 1 day I got problem.</p>\n\n<pre><code>    declare @Start datetime\n    declare @Finish datetime\n    declare @TimeRange int\n\n    set @Start = N'2012-10-16 00:00:00.000'\n    set @Finish = N'2012-10-19 00:00:00.000'\n    set @TimeRange = 1 \n\n    declare @TimeRanges as TABLE (SessionStart datetime, SessionEnd datetime);\n\n    with TimeRanges as \n    (   select @Start as StartTime, DATEADD(day, @TimeRange, @Start) as EndTime\n        union all\n        select DATEADD(day, @TimeRange, StartTime), DATEADD(day, @TimeRange, EndTime)\n        from TimeRanges\n        where EndTime  &lt; @Finish \n    )\n</code></pre>\n\n<p>timeRanges tables split the @Start and @Finish into days.</p>\n\n<p>Here is the what the problem starts:</p>\n\n<pre><code> select StartTime, EndTime,TMP.NoOfCalls    \n    from (SELECT TOP 1 DATEADD(SECOND, Number, c.SessionStartTime) CallTime, COUNT(C.ScenarioID) NoOfCalls FROM test c\nINNER JOIN Numbers N ON N.Number &lt;= DATEDIFF(SECOND, C.SessionStartTime, C.SessionCloseTime) \nwhere c.SessionStarttime &gt;= @Start and  c.SessionCloseTime &lt;= @Finish\nGROUP BY DATEADD(SECOND, Number, c.SessionStartTime)\nORDER BY NoOfCalls DESC\n)as TMP left outer join TimeRanges as TR on @Start &lt;= TR.StartTime   and   TR.EndTime &lt;= @Finish\n        group by TR.StartTime, TR.EndTime,TMP.NoOfCalls\n        order by TR.StartTime\n</code></pre>\n\n<p>Here is the result I got:</p>\n\n<p><img src=\"http://i.stack.imgur.com/mGLcC.jpg\" alt=\"enter image description here\"></p>\n\n<p>Actually 260 is the result of between N'2012-10-17 00:00:00.000' and N'2012-10-18 00:00:00.000' but I want result seperately. </p>\n\n<p>My sample test table :</p>\n\n<pre><code>SessionID    SessionStartTime              SessionCloseTime\n24       2012-10-16 01:00:06.000           2012-10-16 01:01:22.000\n24       2012-10-16 01:00:08.000           2012-10-16 01:01:10.000\n24       2012-10-16 01:00:16.000           2012-10-16 01:01:12.000\n24       2012-10-16 01:00:30.000           2012-10-16 01:01:48.000\n24       2012-10-16 01:00:41.000           2012-10-16 01:02:08.000\n24       2012-10-16 01:00:48.000           2012-10-16 01:01:34.000\n24       2012-10-16 01:00:56.000           2012-10-16 01:03:09.000\n24       2012-10-16 01:01:02.000           2012-10-16 01:02:13.000\n24       2012-10-16 01:01:05.000           2012-10-16 01:03:16.000\n24       2012-10-16 01:01:09.000           2012-10-16 01:02:42.000\n24       2012-10-16 01:01:15.000           2012-10-16 01:02:48.000\n24       2012-10-16 01:01:18.000           2012-10-16 01:02:14.000\n24       2012-10-16 01:01:18.000           2012-10-16 01:02:06.000\n24       2012-10-16 01:01:42.000           2012-10-16 01:03:16.000\n24       2012-10-16 01:01:45.000           2012-10-16 01:03:04.000\n</code></pre>\n"},{"tags":["sql","sql-server","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13192092,"title":"SQL Server : convert char to float and round it","body":"<p>I have a database with a column of <code>VARCHAR2</code> type keeping a value like: <code>398566,569885</code></p>\n\n<p>What I need is to cast this number to float and then to make it looking like: <code>398566,56</code>\nCasting it to float is <strong>not</strong> so important, if It's possible to trim the numbers it will be also ok.</p>\n\n<p>What I have tried is:</p>\n\n<pre><code>select\ncast (p1.VALUE as float) as Total\nfrom Workflow p\nLEFT JOIN PA_PARAMETER p1 on p1.ID=p.ID AND p1.NAME = 'Total'\nWHERE p.TYPE = 'Marketing'\n</code></pre>\n\n<p>Is there a way to trim these numbers or to round it somehow?</p>\n"},{"tags":["sql","sql-server","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":13191127,"title":"SQL Query for Count value from the latest date","body":"<p>I need to have a query that returns the ff:</p>\n\n<ol>\n<li>Count from the latest Date in each Name</li>\n<li>If the value of Count from the latest Date is -1 then it will return the count of the Date before the latest Date</li>\n<li>If the value of Count from the latest Date is -1 and the other Date is -1. Then return 0</li>\n<li>If the value of Count from the latest Date is -1 and no other Date of that Name. Then return 0</li>\n</ol>\n\n<p>Example Table:</p>\n\n<pre><code>ID  Name  Date         Count\n1   Adj   09/29/2012   2\n2   Adj   09/30/2012   4\n3   Ped   09/29/2012  -1\n4   Ped   09/30/2012   5\n5   Mel   09/29/2012   3\n6   Mel   09/30/2012  -1\n7   Rod   09/30/2012   7\n8   Ney   09/30/2012  -1\n9   Jin   09/29/2012  -1\n10  Jin   09/30/2012  -1\n</code></pre>\n\n<p>Desired Output:</p>\n\n<pre><code>Name   Count\nAdj    4\nPed    5\nMel    3\nRod    7\nNey    0\nJin    0\n</code></pre>\n\n<p>I am very confused on how to approach this in SQL since I only knew simple query.</p>\n\n<p>Any idea on how to make a query for this? Thanks.</p>\n\n<p>Btw, I'm sorry I forgot to include this. I am using SQL Server 2000.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13189760,"title":"Does Sql have any attribute which encrypt while inserting and descrypt while getting data from one column?","body":"<p>I want to know is there any attribute or any way where i want to encrypt one column of my table so whenever i am inserting or updating any row in table the columns encrypt that data automatically and while selecting it decrypt and data and get the value in that column.</p>\n"},{"tags":["sql-server","query"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":37,"score":0,"question_id":13191522,"title":"SQL Server: rows to columns","body":"<p>sample datas</p>\n\n<pre><code> date     | num | name | value\n 01012012 |  1  |    A |  20\n 01012012 |  1  |    B |  30\n 01012012 |  2  |    C |  40\n</code></pre>\n\n<p>wish to  like this</p>\n\n<pre><code> date     | num |  A |  B |  C\n 01012012 |   1 | 20 | 30 | --\n 01012012 |   2 | -- | -- | 40\n</code></pre>\n\n<ul>\n<li>name is not fixed can allow many names</li>\n</ul>\n"},{"tags":["ios","sql-server","image"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13186967,"title":"Save image taken from iPad/iPhone to sql server database base64","body":"<p>I am having trouble saving data from my iPad app to SQL server.  I think it mostly has to do with data types.  Starting from the database I have my Image field as SQL Server data type: image.  I looked for an equivalent data type in .NET and I found from this linkk: <a href=\"http://msdn.microsoft.com/en-us/library/cc716729.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/cc716729.aspx</a> that the best choice is a byte array: Byte[]</p>\n\n<p>In the entity/class I am using in .NET I have the following: public class MyClass { public Byte[] Image { get; set; } } and the parameter I am using to to pass in this data looks like this: </p>\n\n<pre><code>SqlParameter param_image = cmd.Parameters.Add(\"IMAGE\", SqlDbType.Image, item.Image.Length);\nparam_image.Value = System.Convert.FromBase64String(item.Image);\nparam_image.Direction = ParameterDirection.Input;\n</code></pre>\n\n<p>However, I am getting an error from the parameter about trying to convert from a string to a byte array.  Has anyone done this?</p>\n"},{"tags":["sql-server","web-services","excel"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13174587,"title":"Reading data from sql server into excel sheet via Web Service","body":"<p>consider you have an existing excel worksheet, which needs to load data from sqlserver. The data is normalized, so reading from a table is not an option. Btw, it's Excel 2010.</p>\n\n<p>I tried to provide the data via <b>stored procedure</b>, but since I have to do some <b>data transformation</b>, SPs are not an option.</p>\n\n<p>The next idea is to provide the data via <b>web service</b>. I read this <a href=\"http://msdn.microsoft.com/en-us/library/office/dd819156%28v=office.12%29.aspx\" rel=\"nofollow\">article</a> but I don't like the result, because the content of the worksheet is written in the .Net code. The solution I'd prefer would be some kind of <b>data provider</b>, which can be used directly in the excel sheet, similar to reading data directly from a table.</p>\n\n<p>Is there a way to achieve that?</p>\n\n<p><b>Edit</b><br />\nBecause of the first comments and answers. Consider as data transformation e.g. a conversion from ticks (<code>long</code>) to <code>DateTime</code>. I've to do it in .net, because the result depends on the target time zone.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":13071003,"title":"Strange (Caching?) Issue (Bug?) with T-SQL View","body":"<p><strong>This issue was resolved by scripting the view as a create, dropping the view, and then recreating the view using the script, so obviously nothing was <em>wrong</em> with the view, per se.  However, I am very curious as to what the cause could be...</strong></p>\n\n<p>I have a created like this:</p>\n\n<pre><code>CREATE VIEW [dbo].[Employees_V]\nAS\nSELECT  cast(right(EmployeeNo,4) as int) as EmployeeID\n,*\n,cast(0 as bit) AS [IsTerritoryManager]\n,cast(0 as bit) AS [IsCoordinator]\nFROM    AD.dbo.ADEmployees_V\n</code></pre>\n\n<p>The <code>AD.dbo.ADEmployees_V</code> has a lot of different fields, but the relevant fields are <code>Status</code> and <code>ISStatus</code>, defined in the creation of the view as:</p>\n\n<pre><code>,CASE WHEN c.[Status] = 'Active' THEN 'Active' ELSE 'Terminated' END AS [Status]\n,CASE WHEN c.[Status] = 'Active' OR ad.[AccountStatus] LIKE '%Enabled%' THEN 'Active' ELSE 'Terminated' END AS [ISStatus]\n</code></pre>\n\n<p>Today, I added the <code>ISStatus</code> column to <code>AD.dbo.ADEmployees_V</code> (<code>Status</code> was there previously).</p>\n\n<p>After making that change, I did a:</p>\n\n<pre><code>SELECT * FROM [Employees_V]\n</code></pre>\n\n<p>Surprisingly, this did not return the proper results.  <code>ISStatus</code> did not appear as a column header, and instead of being populated with 0s, <code>IsTerritoryManager</code> was populated with the new <code>ISStatus</code> values!</p>\n\n<p>I am guessing that this is some sort of caching issue, but I would <em>love</em> an explanation of what is going on under the covers.  Thanks!</p>\n"},{"tags":["sql-server","database","foreign-keys"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2959,"score":0,"question_id":9565939,"title":"Cannot truncate table because it is being referenced by a FOREIGN KEY constraint","body":"<p>I get the following message even when the table that references it is empty: \"Cannot truncate table 'dbo.Link' because it is being referenced by a FOREIGN KEY constraint\" Doesn't seem to make much sense why this is occurring. Any suggestions?</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":13184246,"title":"Can't connect to SQL Server database in asp.net","body":"<p>I am using the <code>configurationmanager.appsetting</code> and I'm getting an error in the <code>cn.Open</code> line.</p>\n\n<p>The web form code is as follows:</p>\n\n<pre><code>public partial class admin_CheckDocuments : System.Web.UI.Page\n{\n    SqlConnection cn = new SqlConnection(ConfigurationManager.AppSettings[\"con\"]);\n    string sql;\n    string str;\n\n    protected void Page_Load(object sender, EventArgs e)\n    {\n        cn.Open();\n        str = Request.QueryString[\"taxid\"];\n\n        if (!IsPostBack)\n        {\n            filldata();\n        }\n    }\n</code></pre>\n\n<p><code>web.config</code> is:</p>\n\n<pre><code>&lt;configuration&gt;\n    &lt;connectionStrings/&gt;\n    &lt;appSettings&gt;\n       &lt;add key=\"con\" \n            value=\"Data Source=EGGG\\SKDB;Initial Catalog=tax;Integrated Security=true\"/&gt;\n    &lt;/appSettings&gt;\n</code></pre>\n\n<p>The error is </p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while\n  establishing a  connection to SQL Server. The server was not found or\n  was not accessible.  Verify that the instance name is correct and that\n  SQL Server is configured to  allow remote connections.  (provider: SQL\n  Network Interfaces, error: 26 - Error Locating Server/Instance\n  Specified)</em></p>\n</blockquote>\n"},{"tags":["sql","sql-server","performance","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":11724333,"title":"SQL Server - joining 4 fast queries gives me one slow query","body":"<p>I have 4 views in my MS Sql Server Database which are all quite fast (less than 2 seconds) and return all less than 50 rows.</p>\n\n<p>BUT when I create a query where I join those 4 views (left outer joins) I get a query which takes almost one minute to finish.</p>\n\n<p>I think the query optimizer is doing a bad job here, is there any way to speed this up. I am tempted to copy each of the 4 views into a table and join them together but this seems like too much of a workaround to me.</p>\n\n<p>(Sidenote: I can't set any indexes on any tables because the views come from a different database and I am not allowed to change anything there, so this is not an option)</p>\n\n<p><strong>EDIT:</strong> I am sorry, but I don't think posting the sql queries will help. They are quite complex and use around 50 different tables. I cannot post an execution plan either because I don't have enought access rights to generate an execution plan on some of the databases.</p>\n\n<p>I guess my best solution right now is to generate temporary tables to store the results of each query.</p>\n"},{"tags":["sql","sql-server","postgresql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13190654,"title":"dateadd() and datename() in postgresql","body":"<p>I am porting from SQLServer to PostgreSQL. I have just started PostgreSQL. I have to convert <code>dateadd()</code> functions. I have converted, but not sure if it is correct. Can you confirm it ?</p>\n\n<p>SQLServer :</p>\n\n<pre><code>dateadd(day,0,wkv.start_date)\n</code></pre>\n\n<p>PostgreSQL:</p>\n\n<pre><code>\"START_DATE\"::date+cast('0 days' as interval)\n</code></pre>\n\n<p>Is it correct ?</p>\n"},{"tags":["c#","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":13185981,"title":"SQL Server timeout for large data of type varbinary(MAX)","body":"<p>I keep around 12 MB of binary data in a SQL Server table. The column that holds this data is of type <code>varbinary(MAX)</code>.</p>\n\n<p>When I download this binary data from the server it is OK if I am in the LAN. However I get SQL Server timeout error in my C# application that is trying to get the data.</p>\n\n<p>What could be the reason of getting this error? Remote query timeout property of the database instance is 600 seconds as default. Changing this to zero did not helped.</p>\n\n<p>It is OK to connect and get some other values from the server. For example I first check a <code>DateTime</code> value in the same table to determine if the ~12 MB of data should be downloaded. If content is new then I start execution of downloading the large data.</p>\n"},{"tags":["sql-server","excel","select"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":13186656,"title":"SELECT * INTO -> Excel worksheet using SQL Server 2008","body":"<p>I want to select from a SQL Server table directly into an empty Excel spreadsheet.  </p>\n\n<p>I can select FROM a spreadsheet into another SQL Server table (see example below).  </p>\n\n<p>I can select directly from ACCESS to an empty spreadsheet (see example below).  </p>\n\n<p>But I cannot find a way select from SQL Server directly into an empty spreadsheet.  </p>\n\n<p>(I manipulate a ton of legacy data by importing spreadsheets, manipulating the data several times, then I need to export it for consumption by other programs that require csv files.  Right now I have to create an intermediate step of pulling it into ACCESS to get it back out to Excel. I leverage the <code>SELECT * INTO</code> to format the tables because I format the source table as I work on the data.)  </p>\n\n<p>Thanks for the help.</p>\n\n<p>I can <code>SELECT * INTO</code> a SQL Server table from Excel via the following code:</p>\n\n<pre><code>string query = \"SELECT * INTO \" + tableName + \" \" +\n               \"FROM OPENROWSET('Microsoft.ACE.OLEDB.12.0',\" +\n               \"'Excel 12.0;Database=\" + EXCELfilpath + \";IMEX=1',\" +\n               \"'SELECT * FROM [\"+sheetName+\"$]')\";\n</code></pre>\n\n<p>Also I can select from ACCESS table directly into Excel</p>\n\n<pre><code> //Select the ACCESS Table INTO an Excel Spreadsheet\n            try\n            {\n                //SELECT INTO command                \n                string cnStr = \"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=\" + AccfilePath +\n                   \";Persist Security Info=False\";\n\n                ConnOpen(cnStr);\n\n                using (connectionToDatabase)\n                {\n                    //Give the Export Table (destination) a Name\n                    //baseTblName = dt.TableName;\n\n                    //Generate the SQL string to SELECT * INTO the NEW table in destination\n                    string selectcmd = \"SELECT * INTO [Excel 12.0;Database=\"+ExfilePath+\"].\" + tblName + \" FROM \" + tblName;\n\n\n                    using (OleDbCommand createCmd = new OleDbCommand(selectcmd, connectionToDatabase))\n                    {\n                        createCmd.ExecuteNonQuery();\n                    }\n\n                    ConnClose();\n                }\n            }\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13189706,"title":"SQL Server, how to display (square) ^2 as in column heading?","body":"<p>Please guide me how to display m2 (m with 2 as square small on top of m) in column heading ?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","time","intervals"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13189458,"title":"Finding records within a 5 min time interval in SQL","body":"<p>I have a table with over 100,000 rows that contain the following columns: ID, Time, and Boolean.<br>\nThe time column tracks time down to the second.<br>\nI need a query that will find all instances of Boolean = 1 for every 5 minute interval of time from the start of the table to the end, then group the count by time interval.</p>\n\n<p>The table represents 4 hours of data, so I should get 48 rows of results.<br>\nI'm using MS SQL Server.</p>\n\n<p>I've tried a few approaches, but the time interval logic is giving me a hard time.   </p>\n"},{"tags":["sql-server","index","normalization"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13189225,"title":"Normalize a database - optimization","body":"<p>I have some kind of project in the university, about sql.</p>\n\n<p>We need to normalize a database, migrating all data.</p>\n\n<p>The original db is a \"master\" table, with about 50 fields. We need to create all tables, and then scanning this master table (about 700.000 rows) inserting the data where it belongs.</p>\n\n<p>I have a problem of performance. In new machines, it runs fast, but in my case (having ubuntu, using a vm of windows xp, so I have fewer resourses than the machines of my team partners) runs much slower.</p>\n\n<p>So, we want to improve performance.</p>\n\n<p>We think on indexing master table, but the problem is that almost all fields are nvarchar(255) or numeric(18,2).</p>\n\n<p>Is good to index that fields? We must do inserts in almost 15 tables, so each insert is scanning all master table, getting the information.</p>\n\n<p>Is there any other thing useful instead of index ? We thought also in create different views, for optimize the selects.</p>\n\n<p>Any orientation will be apreciated</p>\n"},{"tags":["sql","sql-server","tsql","group-by"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13188610,"title":"Sql group by working not properly","body":"<p>This is my query</p>\n\n<pre><code>select  \n (sum(case when offer1_delivered is not null then 1 else null end) ) as PenetrationRate1\n,(sum(case when offer2_delivered is not null then 1 else null end)) as PenetrationRate2\n,count(TargetMkgListID) as TargetMkgListID from tablename\n</code></pre>\n\n<h1>output</h1>\n\n<pre><code>PenetrationRate1    PenetrationRate2    TargetMkgListID \n1                   2                3\n</code></pre>\n\n<p>I need to include customername column in this query</p>\n\n<pre><code>select  customername,\n (sum(case when offer1_delivered is not null then 1 else null end) ) as PenetrationRate1\n,(sum(case when offer2_delivered is not null then 1 else null end)) as PenetrationRate2\n,count(TargetMkgListID) as TargetMkgListID from tablename\ngroup by customername\n</code></pre>\n\n<p>If I include customername in my query, groupby is not working properly.</p>\n"},{"tags":["sql","sql-server","ssas","mdx"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":37,"score":0,"question_id":13074781,"title":"Access system tables in calculation","body":"<p>Is there a way to access system tables in a SSAS cube calcuation? </p>\n\n<p>For example the following query can be executed on a SSAS cube to return a last processed date:</p>\n\n<pre><code>SELECT LAST_DATA_UPDATE FROM $System.MDSCHEMA_CUBES WHERE CUBE_NAME = 'Cube'\n</code></pre>\n\n<p>How would one access this information in a calculation?</p>\n\n<p><strong>Background:</strong> We were using ASSP before (a third party sproc) to get the last cube processed date. Recently, this sproc threw an exception on one of our cubes and caused SSAS to go down. Using the above line of MDX did not have this behavior. I would rather not have our cube depend on third party code so I am looking for a way to access LAST_DATA_UPDATE in a calc for a specific cube name.</p>\n"},{"tags":["sql","sql-server","pivot"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13188158,"title":"Transpose / Pivot distinct row attribute as column and group another attribute?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10404348/sql-server-dynamic-pivot-query\">SQL Server dynamic PIVOT query?</a>  </p>\n</blockquote>\n\n\n\n<p>Is it possible to execute a query on the following table:</p>\n\n<pre><code>Game    Player  Goals\n-----   ------  ------\nGame1   John    1\nGame1   Paul    0\nGame1   Mark    2\nGame1   Luke    1\nGame2   John    3\nGame2   Paul    1   \nGame2   Luke    1\nGame3   John    0\nGame3   Mark    2\n</code></pre>\n\n<p>which gives a result like this:</p>\n\n<pre><code>Game    John    Paul    Mark    Luke\n-----   ----    ----    ----    ----\nGame1   1       0       2       1\nGame2   3       1       -       1\nGame3   0       -       2       -\n</code></pre>\n\n<p>It turns each distinct player into a column and groups the games gives goals per game per player.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13186879,"title":"Querying data groups with total row before starting next group?","body":"<p>I need to query some data in the below format in SQL Server:</p>\n\n<ul>\n<li>Id   Group   Price </li>\n<li>1    A   10</li>\n<li>2    A   20 </li>\n<li><p><strong>Sum    30</strong> </p></li>\n<li><p>1    B   6</p></li>\n<li>2    B   4 </li>\n<li><p><strong>Sum    10</strong> </p></li>\n<li><p>1    C   100</p></li>\n<li>2    C   200 </li>\n<li><strong>Sum    300</strong> </li>\n</ul>\n\n<p>I was thinking to do it in the follwoing steps:</p>\n\n<ol>\n<li>Query one group</li>\n<li>In other query do sum</li>\n<li>Use Union operator to combine this result set</li>\n<li>Do step 1-3 for all groups and finally return all sub sets of data using union.</li>\n</ol>\n\n<p>Is there a better way to do this ? May be using some out of box feature ? Please advise.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>As per suggestions and code sample I tried this code:</p>\n\n<pre><code>Select \nCase \nwhen id is null then 'SUM' \nelse CAST(id as Varchar(10)) end as ID,\n\nCase when [group] is null then 'ALL' else CAST([group] as Varchar(50)) end as [group]\n,Price from\n(\nSELECT Id,  [Group],BGAApplicationID,Section, SUM(PrimaryTotalArea) AS price   \nFROM vwFacilityDetails\nwhere bgaapplicationid=1102\nGROUP BY Id,  [Group],BGAApplicationID,Section  WITH ROLLUP\n) a\n</code></pre>\n\n<p>And Even this code as well:</p>\n\n<pre><code>Select Id,  [Group],BGAApplicationID,Section, SUM(PrimaryTotalArea) AS price           \nFrom   vwFacilityDetails\nWhere  Not ([group] Is Null And id Is Null And BGAApplicationId is null and section is null) and BGAApplicationId=1102\nGroup By Id,  [Group],BGAApplicationID,Section \n    With Rollup\n</code></pre>\n\n<p>In results it groups up the data but for every record it shows it 3 times (in both above codes) like:</p>\n\n<ul>\n<li>2879 Existing Facilities Whole School    25.00</li>\n<li>2879 Existing Facilities Whole School    25.00 </li>\n<li>2879 Existing Facilities    Whole School 25.00 </li>\n<li>2879 ALL 25.00</li>\n</ul>\n\n<p>I guess there is some issue in my query, please guide me here as well.\nThanks</p>\n"},{"tags":["sql","sql-server","ssas","olap"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13169055,"title":"Is it more efficient to build a cube off of tables or views?","body":"<p>I began to ponder this question after I noticed a system that I had been asked to work on had a cube based entirely off of views. I noticed that those views all joined in other tables/views and the views also had logic coded into them (if, case statements aswell as convert statements, concatation etc.). This all seemed horrible to me, but it made me wonder if one should ever base their datasource for a cube off of views?</p>\n\n<p>To me tables make more sense. It prevents expensive joins in the datasource, and also isn't prone to errors that could occur due to conversions performed by a view. However, I still see many people using views as datasources for cubes. Is there a best practice here? Am I perhaps missing some advantages that views give when used as a datasource?</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":13188023,"title":"What's the purpose of distinct in this query?","body":"<p>Today, I came across a query on W3Schools here : <a href=\"http://www.w3schools.com/sql/sql_view.asp\" rel=\"nofollow\">http://www.w3schools.com/sql/sql_view.asp</a> which was written as below:</p>\n\n<pre><code>CREATE VIEW [Category Sales For 1997] AS\nSELECT DISTINCT CategoryName,Sum(ProductSales) AS CategorySales\nFROM [Product Sales for 1997]\nGROUP BY CategoryName\n</code></pre>\n\n<p>I am wondering what's the purpose of using <code>DISTINCT</code> in this query? The query has already <code>GROUPed BY</code> the result set, so there is no chances of same <code>CategoryName</code> after doing <code>GROUP BY</code> and before doing <code>SELECT</code>. Would this query behave differently if it did not use <code>DISTINCT</code>? I mean what would happen if it was written simply as this:</p>\n\n<pre><code>CREATE VIEW [Category Sales For 1997] AS\nSELECT CategoryName,Sum(ProductSales) AS CategorySales\nFROM [Product Sales for 1997]\nGROUP BY CategoryName\n</code></pre>\n\n<p>Thank you!</p>\n"},{"tags":["sql-server","authentication","ssis","ssdt","sql-server-2012-datatools"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13182308,"title":"Logon Fail Integration Services 2012","body":"<p>I have a SSIS Project deployed in SQL Server. The connection manager in the project are linked to a server name that is not the one where the SSIS project is deployed. After i execute the master package in sql server errors pop ups in the report screen: Login Failed for NT Authority\\Anonymous Logon. <br><br></p>\n\n<p>Is this a double hop attempt?</p>\n\n<p>Can anyone help me with this?</p>\n"},{"tags":["sql-server","iis"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":851,"score":2,"question_id":5396,"title":"SQL Server 2008 FileStream on a Web Server","body":"\n\n<p>I've been developing a site using ASP.NET MVC, and have decided to use the new SQL Server 2008 <code>FILESTREAM</code> facility to store files 'within' the database rather than as separate entities.  While initially working within VS2008 (using a trusted connection to the database), everything was fine and dandy.  Issues arose, however, when I shifted the site to IIS7 and changed over to SQL authentication on the database.</p>\n\n<p>It seems that streaming a <code>FILESTREAM</code> doesn't work with SQL authentication, only with Windows authentication.  Given this, what is the best practice to follow?</p>\n\n<ol>\n<li>Is there a way to force this sort of thing to work under SQL authentication?</li>\n<li>Should I add <code>NETWORK SERVICE</code> as a database user and then use Trusted authentication?</li>\n<li>Should I create another user, and run both the IIS site and the database connection under this?</li>\n<li>Any other suggestions?</li>\n</ol>\n"},{"tags":["sql","sql-server"],"answer_count":9,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":13179603,"title":"Computed columns with null","body":"<p>I am creating a view (using MS sql 2008) with creates a calculated field as a <code>COLUMN1 + COLUMN2</code>. Everything is fine and dandy but: Both <code>COLUMN1</code> and <code>COLUMN2</code> can be NULL.</p>\n\n<p>I want to follow the following rule:</p>\n\n<ul>\n<li>2 + 2 = 4</li>\n<li>2 + NULL = 2</li>\n<li>NULL + 2 = 2</li>\n<li>0 + 0 =  0</li>\n<li>NULL + NULL = NULL</li>\n</ul>\n\n<p>If I use ISNULL(column2, 0), then all the rules will be followed but not the last one.</p>\n\n<p>How do I need to create the view </p>\n\n<pre><code>CREATE VIEW dbo.test\nAS\nSELECT COLUMN1, COLUMN2, (????????) AS CALCULATEDCOL FROM dbo.TabTest;\nGO\n</code></pre>\n"},{"tags":["sql-server","database-comparison"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":28,"score":2,"question_id":13181030,"title":"DB Comparison tool that I can schedule","body":"<p>I'm after a DB Comparison tool for SQL Server that allows me to do the following:</p>\n\n<ul>\n<li>Schedule a comparison to happen on a recurring schedule</li>\n<li>Email me the results (in a nice readable format and not the generated script)</li>\n<li>Allow me to exclude/include certain object names (for example exclude table names containing %test%. That's not a real example but there is a good reason why that would come in useful.)</li>\n</ul>\n\n<p>As well as the obvious:</p>\n\n<ul>\n<li>Have the usual options for ignoring things like comments, identity seeds etc</li>\n<li>Options for selecting different types of objects</li>\n</ul>\n\n<p>If it was free or at least didn't cost a forture that would be an extra bonus of course.</p>\n\n<p>I have tried out RedGate's SQL Compare and also the built-in DB Comparison in Visual Studio but neither seem able to do the first 3 points above. I also looked at other tools recommended in various threads on here but again they don't mention in their features the 3 points above.</p>\n\n<p>One option I found is RedGate's SQL Comparison SDK with which I think I could write something to do what I want.</p>\n\n<p>I just wanted to investigate tools that might do all of the above out of the box.</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql-server","sharepoint","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12744203,"title":"No Sharepoint Integrated Mode option in Report Server Database Configuration wizard","body":"<p>I am trying to set up my report server in Sharepoint Integrated mode (http://technet.microsoft.com/en-us/library/hh833726.aspx) but I do not get the option to select the mode in the wizard (see image).  Can anybody help?  I am running Sharepoint 2010 with SQL Server 2012 and I selected the option to install in Sharepoint Integrated mode when installing SQL Server.<img src=\"http://i.stack.imgur.com/1Q7yx.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","schema","connection-string"],"answer_count":4,"favorite_count":0,"up_vote_count":8,"down_vote_count":0,"view_count":5732,"score":8,"question_id":3282665,"title":"Possible to set default schema from connection string?","body":"<p>With SQL Server 2005 and 2008 is it possible to set the default schema from the connection string? It'd be a lot easier if we didn't have to manually set the schema with SQL code. </p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":6,"favorite_count":1,"up_vote_count":25,"down_vote_count":0,"view_count":39087,"score":25,"question_id":482885,"title":"How do I drop a foreign key constraint only if it exists in sql server?","body":"<p>I can drop a table if it exists using the following code but do not know how to do the same with a constraint:</p>\n\n<pre><code>IF EXISTS(SELECT 1 FROM sys.objects WHERE OBJECT_ID = OBJECT_ID(N'TableName') AND type = (N'U')) DROP TABLE TableName\ngo\n</code></pre>\n\n<p>I also add the constraint using this code:</p>\n\n<pre><code>ALTER TABLE [dbo].[TableName] \n  WITH CHECK ADD CONSTRAINT [FK_TableName_TableName2] FOREIGN KEY([FK_Name])\n    REFERENCES [dbo].[TableName2] ([ID])\ngo\n</code></pre>\n"},{"tags":["sql-server","stored-procedures","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13152329,"title":"Finding stored procedures having execute permission","body":"<p>I am using SQL Server 2008 R2. I need to list out all the stored procedures that a database user (MYUSER)  has execute permission. </p>\n\n<p>Also, I need to list out which are the stored procedures that the user does NOT have EXECUTE permission - but can read the script of the stored procedure</p>\n\n<p>Is there any SQL statement or helper function for these purpose?</p>\n\n<p>REFERENCE:</p>\n\n<ol>\n<li><a href=\"http://stackoverflow.com/questions/5109581/granting-execute-permission-on-all-stored-procedures-in-a-certain-database\">Granting execute permission on all stored procedures in a certain database</a></li>\n</ol>\n"},{"tags":["sql","sql-server","query","datediff"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":68,"score":3,"question_id":13185869,"title":"SQL query to get DateDiff of the last two records","body":"<p>I have a table called Event with eventNum as the primary key and date as a datetime2(7) in SQL Server 2008 R2.  I am trying to get the date of the last two rows in the table and get the difference in minutes. This is what I currently have:</p>\n\n<pre><code>Select DATEDIFF(MI, e.date,(Select e2.date from Event e2 where eventNum = (Select MAX(e2.eventNum))))\n    From Event e\n    Where eventNum = (Select MAX(e.eventNum)-1 from e)\n</code></pre>\n\n<p>and I get this error:</p>\n\n<blockquote>\n  <p>Invalid column name 'Select eventNum from Event Where eventNum =\n  Select MAX(eventNum) from Event'.</p>\n</blockquote>\n\n<p>I've changed this 100 times and can't get it to work. Any help? </p>\n"},{"tags":["asp.net","sql-server","asp.net-mvc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":735,"score":0,"question_id":12135081,"title":"asp.net mvc Invalid value for key 'attachdbfilename'","body":"<p>I build a simple model and views and import \"sql server compact\" using NuGet.\n(Following \"Manning ASP.NET MVC 4 in Action\" ebook first example)\nwhen I finally try to run it I get the following error </p>\n\n<pre><code>Invalid value for key 'attachdbfilename'.\n</code></pre>\n\n<p>On every select or CRUD I am trying to execute.<br>\nany ideas? </p>\n"},{"tags":["php","sql-server","query"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":215,"score":1,"question_id":586031,"title":"mssql_query accent","body":"<p>I hava  a problem with this mssql_query in PHP :</p>\n\n<pre><code>$query = 'SELECT Ville FROM tblLstManufacturiers where province = \"Qubec\"';\n</code></pre>\n\n<p>The result is empty because I have an accent in Qubec</p>\n\n<p>How can I do this?</p>\n"},{"tags":["ios","sql-server","database","push-notification","push"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13180325,"title":"Server check every minute","body":"<p>I am creating an iOS app that lets users store a favored time within the settings that would be added to a database.  I am trying to set up a server that will match the database times to the server times and when it matches, send a push notification. Could use a little guidance as to how to set up the server-side check and how to address potentially having 10,000-100,000 entries.</p>\n"},{"tags":["sql-server","oracle","linked-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13185137,"title":"SQL Server linked to Oracle","body":"<p>I have a linked server connection from SQL Server to Oracle.</p>\n\n<p>I am executing this statement in SQL Server Management Studio.</p>\n\n<pre><code>select * from OPENQUERY(LINKEDSERVER,'select * from ORACLE_VIEW')\n</code></pre>\n\n<p>I am getting an error </p>\n\n<blockquote>\n  <p><em>OLE DB provider \"OraOLEDB.Oracle\" for linked server \"LINKEDSERVER\"\n  returned message \"ORA-01858: a non-numeric character was found where a\n  numeric was expected.\"</em></p>\n</blockquote>\n\n<p>Note: when I am executing </p>\n\n<pre><code>select * from ORACLE_VIEW\n</code></pre>\n\n<p>in the Oracle editor it is working fine.</p>\n\n<p>Please advise me on this!!</p>\n\n<p>Thanks for your time!!</p>\n"},{"tags":["sql-server","database","sql-server-2005-express"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13185583,"title":"SQL Server 2005 Management Studio Express not showing new added data","body":"<p>I recently installed and have been using Microsoft SQL Server Management Studio Express 9.00.4035.00 to manage a remote database on my hosts' SQL Server 2005. The database continual getting data from other program which i created. When i'm trying to see the new data from SQL Server 2005 Management Studio Express, i couldn't find any new data. but when I opened the program which i created, i could see the new data. \nIs there a setting on SQL Server 2005 Management Studio Express or something obvious I am missing? Why can't I see the new added record? I am on a Windows 7 desktop machine. </p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13185517,"title":"logging of emails","body":"<p>Is it possible in sql server, to log the emails in the table sent but not actually sent to the reciepents.</p>\n\n<p>i.e I can see the emails details in the log table but the emails will not be sent.</p>\n"},{"tags":["sql-server","authentication","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13185128,"title":"How to use Windows Authentication with SSMS without using RunAs?","body":"<p>I have SQL Server 2012 installed as a standalone instance in Windows 8 Enterprise edition.  It is running in Mixed-mode.  The currently logged in account is a member of local MACHINE\\Administrators and the local BUILTIN\\Administrators group is in the sysadmin role.  For good measure, the current user is also in a MACHINE\\SQLAdmins group which is also in the sysadmin role.</p>\n\n<p>When I launch SQL Server Management Studio (SSMS) from the shortcut, I can't use Windows Authentication.  I get the following error:</p>\n\n<pre><code>TITLE: Connect to Server\nCannot connect to INSTANCENAME.\nADDITIONAL INFORMATION:\nLogin failed for user 'MACHINE\\user'. (Microsoft SQL Server, Error: 18456)\nFor help, click: http://go.microsoft.com/fwlink?ProdName=Microsoft%20SQL%20Server&amp;EvtSrc=MSSQLServer&amp;EvtID=18456&amp;LinkId=20476\n</code></pre>\n\n<p>In fact, if I launch LinqPad from a shortcut, I can't connect to the server using a connection string which relies on Windows Authentication.</p>\n\n<p>However, if I run SSMS or LinqPad with elevated privileges using RunAs Administrator, I can use Windows Authentication and the experience is as expected.</p>\n\n<p>Alternatively, I can include the RunAs command into the SSMS shortcut like so.</p>\n\n<pre><code>C:\\Windows\\System32\\runas.exe /USER:MACHINE\\user \"C:\\Program Files (x86)\\Microsoft SQL Server\\110\\Tools\\Binn\\ManagementStudio\\Ssms.exe\"\n</code></pre>\n\n<p>Surprisingly, double-clicking the shortcut will prompt for me to enter the password of the current user.  However, once that re-authentication occurs, SSMS will allow Windows Authentication of the current user.</p>\n\n<p>The question is, what user is SSMS running under when I double click the shortcut and ultimately, how can I just run LinqPad or SSMS or any other app that connects to the database with Windows Authentication without first elevating my privileges?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","jobs"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":175,"score":2,"question_id":12249056,"title":"Executing SQL Server Agent Job from a stored procedure and returning job result","body":"<p>Need to have a stored procedure that calls a SQL Server Agent Job and returns whether or not the job ran successfully or not.</p>\n\n<p>So far I have<br></p>\n\n<pre><code>CREATE PROCEDURE MonthlyData\nAS\nEXEC msdb.dbo.sp_start_job N'MonthlyData'\n\nWAITFOR DELAY '000:04:00'\n\nEXEC msdb.dbo.sp_help_jobhistory @job_name = 'MonthlyData'\nGO\n</code></pre>\n\n<p>Which starts the job, whats the best way to get back if the job ran successfully or not?</p>\n\n<p>Ok made an edit and used WAITFOR DELAY as the job normally runs between 3-4 mins never longer than 4. Does the job but is there a more efficient way to do it?</p>\n"},{"tags":["ruby-on-rails","sql-server","windows","activerecord"],"answer_count":3,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":1175,"score":5,"question_id":7655312,"title":"How to use activerecord-sqlserver-adapter with TinyTDS *and* an Integrated Security connection on Windows *without* saving a password in plain text","body":"<p>I'm trying to use Rails 3.1. with the activerecord-sqlserver-adapter (3.1.1) and tiny_tds (0.4.5) on a Windows machine.  In reading about TinyTDS and it's use of FreeTDS it looks like I can use Integrated Security (aka Windows Integrated security/NTLM) by putting a domain-qualified name as the user name (e.g. DOMAIN\\userbob).  <em>But</em> the docs still want me to type my domain user's password in the database.yml file.  That's bad practice because it's insecure and doesn't take advantage of single-sign on, which is part of the point for Integrated Security.</p>\n\n<p>Can I connect without saving a password in plain text in a file?  e.g.</p>\n\n<pre><code>developement:\n    adapter: sqlserver\n    mode: dblib\n    dataserver: localhost\n    database: dev_db\n    username: DOMAIN\\userbob\n#    password: no_no_please_dont_make_me_type_it_here\n</code></pre>\n\n<p>But, even if I put a password I get the following error:</p>\n\n<pre><code>TinyTds::Error: Unable to connect: Adaptive Server is unavailable or does not exist\n    from C:/Ruby192/lib/ruby/gems/1.9.1/gems/tiny_tds-0.4.5-x86-mingw32/lib/tiny_tds/client.rb:60:in `connect'\n    from C:/Ruby192/lib/ruby/gems/1.9.1/gems/tiny_tds-0.4.5-x86-mingw32/lib/tiny_tds/client.rb:60:in `initialize'\n</code></pre>\n\n<p>I know my server is running and the current user context can connect because this works:</p>\n\n<pre><code>sqlcmd -S localhost -d dev_db -E\n</code></pre>\n\n<p>Any insights?  Is it possible?  If not, it <em>should</em> be.</p>\n"},{"tags":["sql-server","sql-server-2005","stored-procedures","ssis","parameters"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":22822,"score":5,"question_id":745207,"title":"How do you call a Stored Procedure in SSIS?","body":"<p>I am trying to create an SSIS package that queries data from a table, and calls a stored procedure in another database with each row.</p>\n\n<p>In my old DTS package, I was doing this:</p>\n\n<pre><code>EXEC myStoredProcedure ?, ?, ?\n</code></pre>\n\n<p>...and then I mapped the parameters.  However, in SSIS, I can't figure out how to make this work.</p>\n\n<p>I have a Data Flow task, which first runs a query for the data.  It passes the data to an OLE DB Destination.  I set the Data access mode to \"SQL command\", but when I try to put in the SQL above, I get \"Invalid Parameter Count\" when it parses the SQL.  I can't get to the Mappings screen.  Any ideas?</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13184253,"title":"Ensure correct sql server instance db in script before executing?","body":"<p>How can I specify in my .sql script that that it only executes against my localhost sql server db instance and not on another open connection to say my integration or test environment?</p>\n\n<p>dbsetupscript.sql</p>\n\n<pre><code>use myDB\n\n--WHAT SAFE GAURD CAN i PUT HERE TO ENSURE THAT THIS SCRIPT CAN ONLY BE EXECUTED VIA MY   \n-- LOCAL ENVIRONMENT BEFORE I START DELETING TABLES, ETC?\n\ndelete MotherTable\n-- delete other tables and insert simulated production data \n</code></pre>\n"},{"tags":["sql","sql-server","tsql","pivot","unpivot"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13184637,"title":"pivoting rows to columns in tsql","body":"<p>I have the following table with the following sample data</p>\n\n<pre><code>ID  Language       Question       SubQuestion     SubSubQuestion    TotalCount  TotalPercent\n3      E               9               0                1             88527            73%\n3      E               9               0                2             19684            16%\n3      E               9               0                3             12960            11%\n3      E               9               0                9              933              1%\n</code></pre>\n\n<p>I want all in one row like this</p>\n\n<pre><code>    ID  Language        TotalCount901   TotalPercent901     TotalCount902   TotalPercent902 TotalCount903   TotalPercent903\n     3       E            88527           73%                 19684             16%              12960              11%\n</code></pre>\n\n<p>I've tired using the pivot command, but it dosnt to work for me.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","sql-agent-job"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":690,"score":4,"question_id":10088427,"title":"How to pass a parameter to a SQL Job that will execute a stored procedure","body":"<p>I have the below code (only the portion that is needed)</p>\n\n<pre><code>EXEC @ReturnCode = msdb.dbo.sp_add_jobstep @job_id=@jobId, @step_name=N'SomeStep', \n        @step_id=1, \n        @cmdexec_success_code=0, \n        @on_success_action=1, \n        @on_success_step_id=0, \n        @on_fail_action=2, \n        @on_fail_step_id=0, \n        @retry_attempts=0, \n        @retry_interval=0, \n        @os_run_priority=0, @subsystem=N'TSQL', \n        @command=N'exec [dbo].[PORT_Insert_Record] ''https://localhost''',  \n        @database_name=N'MyDatabase', \n        @flags=0\n</code></pre>\n\n<p>Now, I want to pass the <code>https://localhost</code> value into a variable and pass to the stored procedure (for some reason I cannot pass it inside the SP).</p>\n\n<p>So I tried </p>\n\n<pre><code>DECLARE @domainName varchar(max)\nDECLARE @sp varchar(max)\nSET @domainName ='https://localhost:'\nSET @sp ='exec [dbo].[PORT_Insert_Record]' + @domainName\n\nEXEC @ReturnCode = msdb.dbo.sp_add_jobstep @job_id=@jobId, @step_name=N'InsertRecordIntoResellerOpportunities', \n        @step_id=1, \n        @cmdexec_success_code=0, \n        @on_success_action=1, \n        @on_success_step_id=0, \n        @on_fail_action=2, \n        @on_fail_step_id=0, \n        @retry_attempts=0, \n        @retry_interval=0, \n        @os_run_priority=0, @subsystem=N'TSQL', \n        @command=@sp,  \n        @database_name=N'MyDatabase',  \n        @flags=0\n</code></pre>\n\n<p>but it is not working. I also search in the net for any idea/syntax etc.. but no luck as of now.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql","sql-server","view","predicates"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13184439,"title":"SQL How to extract a predicate from a left join","body":"<p>I have 2 tables: user and licenseduser. The first one contains <em>all</em> the users and the second one contains only those users with a licenses (2 columns: useruid and subscriptionid).</p>\n\n<p>Given a subscriptionId I have to display in a grid <em>all</em> the users and a boolean flag column indicating for each user if he/she has the subscription or not.</p>\n\n<p>Example: The following query gives me that for the subscriptionId = 7.</p>\n\n<pre><code>select firstname, lastname, emailaddress, subscriptionid \nfrom dbo.[user]\nleft join (select * from dbo.licensedUser where subscriptionid = 7) lu on dbo.[user].[Uid] = lu.useruid \n</code></pre>\n\n<p>However, this query is not useful for me because the executor program uses an ORM. I want to create a view (called myView) such that I can (or the ORM can) do this: </p>\n\n<p>select firstname, lastname, emailaddress, subscriptionid<br>\nfrom myView\nwhere  subscriptionid  = 7 or subscriptionid is null</p>\n\n<p>Could you help me, please?\nThank you in advance.</p>\n"},{"tags":["sql-server","database","sql-server-2008","schema"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":37,"score":1,"question_id":13184518,"title":"How to implement a schema with primary and foreign keys","body":"<p>I am trying to create relationships for my database tables, I developed a simple airline reservation system but I'm getting confused on how to get it right. My aim is to come up with a schema that shows primary keys and foreign keys.</p>\n\n<p>This is my database below</p>\n\n<p><img src=\"http://i.stack.imgur.com/YhOF6.png\" alt=\"enter image description here\"></p>\n\n<p>What am I missing it seems I do not have many foreign keys and a relationship diagram seems not to have connection because of that</p>\n\n<ul>\n<li>the Plist is a passenger list tables </li>\n<li>canreq is a cancel request table</li>\n<li>reg is the registration table</li>\n<li>fares is the fares table</li>\n<li>pid is a passenger id table</li>\n<li>schedule is a schedule table</li>\n</ul>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13184230,"title":"SQL Server using AND with IF?","body":"<p>I'm writing a stored procedure, but I can't figure out what's wrong the compiler wont give me any error specification at all. Just that it says query completed with errors. I cant see the error..?!</p>\n\n<p>This is to be used as a stored procedure that updates two tables, the code itself is pretty self-explanatory.</p>\n\n<pre><code>SET ANSI_NULLS ON\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROCEDURE [dbo].[insertRankingData]\n@domannamn [varchar](100),\n@keyword [varchar](100),\n@dagensdatum [Date],\n@rankingposition [Decimal]\nAS\nDECLARE @domanID int \nDECLARE @datumen date \n\nIF(SELECT COUNT(*) FROM [dbo].[t_doman] WHERE doman_namn = @domannamn) = 0\nBEGIN\nINSERT INTO [dbo].[t_doman] (doman_namn) \n    VALUES(@domannamn)\n\n    SELECT @domanID = SCOPE_IDENTITY()\nSELECT @todaysdate = GETDATE()\nEND\nELSE\nBEGIN\nSELECT @domanID = [doman_id] \n    FROM [dbo].[t_doman] \n    WHERE doman_namn = @domannamn\n\nSELECT @todaysdate = GETDATE()\nEND\n\nIF NOT @domanID IS NULL\nBEGIN \nIF NOT EXISTS (SELECT (ranking_date, ranking_keyword, ranking_id_doman) \n                    FROM [dbo].[t_ranking] \n                    WHERE ranking_id_doman = @domanID\n                    AND ranking_keyword = @keyword\n                    AND ranking_date = @datumen)\nBEGIN\n\n       INSERT INTO [dbo].[t_ranking] (ranking_id_doman, ranking_date, ranking_position, ranking_keyword) \n       VALUES(@domanID, @todaysdate, @rankingposition, @keyword)    \nEND\nELSE\nBEGIN \n       UPDATE [dbo].[t_ranking] \n       SET ranking_position = @rankingposition\n       WHERE ranking_date = @todaysdate\n       AND ranking_keyword = @keyword\n       AND ranking_id_doman = @domanID \nEND\n  END\n</code></pre>\n"},{"tags":["sql","sql-server","logging","select","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13184120,"title":"SQL - Selecting a field from another table using a primary key in a trigger","body":"<p>I have two tables in my database, one is Transactions and the other is TransactionHistories. The latter is essentially an auditing table, whereby a trigger executes on insert, update and delete on Transactions to capture a screenshot of the data.</p>\n\n<p>I am successfully retrieving all of the data stored in the Transactions table where the columns match, but the difficulty comes where I am trying to retrieve data from another table using a foreign key. For instance:</p>\n\n<p>The transaction table has a field \"TransactionType_TransactionTypeId\", but in the audit table we wish to store its 'name' equivalent as \"TransactionTypeName\". This needs to be populated from the \"TransactionTypes\" table, which has the fields \"TransactionTypeId\" and \"Name\".</p>\n\n<p>I am struggling to write a query to retrieve this as we wish. I am trying something similar to the following but having little success:</p>\n\n<pre><code>SELECT @TransactionTypeName=Name\nFROM TransactionTypes\nWHERE inserted.TransactionType_TransactionTypeId=TransactionTypes.TransactionTypeId;\n</code></pre>\n\n<p>I'm assuming that is a syntactic nightmare. If someone could point me in the right direction I would be extremely grateful!</p>\n"},{"tags":["sql","sql-server","visual-studio-2010","visual-studio"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13178758,"title":"How can i return error messages as select statement SQL server 2008?","body":"<p>In SQL SERVER 2008 how can i return error messages as select statement </p>\n\n<p><em>LIKE</em></p>\n\n<pre><code>SELECT ** FROM emp \n</code></pre>\n\n<p><em>Will return the following error</em></p>\n\n<pre><code>    Msg 102, Level 15, State 1, Line 1\n    Incorrect syntax near '*'.\n</code></pre>\n\n<p>i just need the 2nd line to be returned as <code>SELECT</code> statement </p>\n\n<p>I've tried @@ERROR but looks like it return just the error code </p>\n\n<p>What i'm doing is validating sql statements from the client side, so if there is a way of doing this with out hitting the server this will be good too i'm using VB </p>\n\n<p>Thanks </p>\n"},{"tags":["sql","sql-server","tsql","foreign-keys"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13179188,"title":"SQL Query to get table names by foreign key dependency","body":"<p>How could I frame a query to get table names in SQL Server by order of Foreign Key dependency?</p>\n\n<p>If there is a Table XYZ, which is the Primary table on which 2 other tables have a Foreign Key constraint, then I would want the Table XYZ to appear first.</p>\n\n<p>This is to enable the creation of tables in the correct order.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13176954,"title":"Sql Server union with If condition","body":"<p>I have a query like:</p>\n\n<pre><code>DECLARE @tmpValue\nSET @tmpValue = 0 -- it will be change \n\nSELECT * FROM Animal WHERE AniActive = 1\nUNION \nIF @tmpValue &gt; 0 \nSELECT * FROM Animal WHERE.Active = 0\n</code></pre>\n\n<p>When I use like this it is giving error because of if condition. I have to use UNION because of our structure. </p>\n\n<p>How can I use it with if condition?</p>\n\n<p>Thanks, <br/>\nJohn</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13182559,"title":"Selecting values based on value in another column with one being NULL","body":"<p>I have the following table setup</p>\n\n<pre><code>Acc  Currency  Alias\n1    NULL      A\n1    USD       B\n1    EUR       C\n</code></pre>\n\n<p>I want to extract the alias by giving the input as <code>Acc</code>. The <code>Currency</code> and <code>Acc</code> are joined to another table.</p>\n\n<p>It should work as follows -</p>\n\n<pre><code>If acc = 1 and currency is USD then B, if EUR then C, if null then A\n</code></pre>\n\n<p>Can someone help with this please ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13181575,"title":"What is wrong with this SQL statement for inserting concatenated IDS from a table into a field?","body":"<pre><code>INSERT INTO Activity_Feed (userID,Type,DataIDs,PodID) \nVALUES ( 1437\n      , 'eventattend'\n      , (SELECT LEFT(EventID, LEN(eventID) - 1 as nvarchar) \n         FROM ( \n            SELECT EventiD + ', ' \n            FROM   events \n            FOR XML PATH ('')) c (EventID))\n      , 5)\n</code></pre>\n\n<p>Basically I want to take a bunch of IDs from a table and insert them as a comma delimited string into a varchar field.</p>\n\n<p>E.g.</p>\n\n<pre><code>Activity_Feed (table)\n\nactivityID   1\nuserID       2\nDataIDs      1,3,4,56,367 // This would be the (Select Ids FROM bit)\n</code></pre>\n\n<p>I want to take a bunch of RSVP IDs from a table and stick their IDs in the field...</p>\n\n<p>To further explain I wanted to avoid normalizing the query because of the nature of this query. Let me know if I should still separate out the data...</p>\n\n<p>The activity feed works like this...</p>\n\n<p>I create a new entry in activity with a type of <code>event_attending</code> (which is an event I am attending. </p>\n\n<p>I timestamp it, I enter the ID for the event in the <code>dataIDs</code> field any new activity matching <code>event_attending</code> in a 6 hour period fires an <code>update</code> record rather than <code>insert</code> </p>\n\n<p>I keep the timestamp the same but update the ID's that are associated with that time period so basically update the IDs with the latest event attendance within that time period.</p>\n\n<p>I thought normalizing seemed like overkill :D is there such thing as overkill with normalization?</p>\n"},{"tags":["sql-server","tsql"],"answer_count":3,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":62,"score":5,"question_id":13182102,"title":"WHERE on View Alias Causes Error","body":"<p>I have a view like this:</p>\n\n<pre><code>SELECT location, CAST(SUBSTRING(location, 9, 4) AS int) AS ProcessCode\nFROM   dbo.asset\nWHERE  (status NOT IN ('INACTIVE', 'NOT READY', 'LIMITEDUSE'))\nAND (location LIKE '[1-6]-[12]-[0-9][0-9][0-9]-[0-9][0-9][0-9][0-9]-_')\n</code></pre>\n\n<p>If I call it like this, it works:</p>\n\n<pre><code>SELECT * FROM FooView\n</code></pre>\n\n<p>However, if I add a WHERE clause:</p>\n\n<pre><code>SELECT * FROM FooView WHERE ProcessCode &gt; 0\n</code></pre>\n\n<p>I get this error:</p>\n\n<blockquote>\n  <p>Conversion failed when converting the varchar value '-01-' to data\n  type int.</p>\n</blockquote>\n\n<p>Why? Since location must be in the format <code>1-2-100-0800-A</code>, I don't see how there can be a conversion error. Is it possible that the <code>CAST</code> fails before the <code>WHERE</code> has a chance to filter the results? If so, then why does the first query work?</p>\n\n<p><strong>EDIT - WORK-AROUND</strong></p>\n\n<p>I just had a co-worker suggest a good work-around. It works, but it still doesn't explain why the initial problem.</p>\n\n<p>This is in the SELECT for ProcessCode:</p>\n\n<pre><code>CASE WHEN location LIKE '[1-6]-[12]-[0-9][0-9][0-9]-[0-9][0-9][0-9][0-9]-_'\nTHEN CAST(SUBSTRING(location, 9, 4) AS int) ELSE 0 END AS ProcessCode, \n</code></pre>\n"},{"tags":["sql-server","excel","excel-vba","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13182671,"title":"SQL Server 2000 : return a value when no record is returned","body":"<p>I have a list of about 1500 part numbers in an Excel document. I want to insert these part numbers in a query to pull descriptions from my database and then copy/paste the results back into the Excel document. </p>\n\n<p>The problem is some of the part numbers in my list aren't in my database, so when I go to copy/paste the results of my query into Excel they aren't going to match up because some of the part numbers in the query do not return a result.</p>\n\n<pre><code>SELECT ITEM.ITEMNO, ITEM.DESCRIPTION \nFROM ITEMS \nWHERE ITEM.ITEMNO IN ('1500','Part','Numbers')\n</code></pre>\n\n<p>It seems like a simple concept and my google searches have returned a lot of results, but they usually involve multiple tables and unions/joins. I just can't translate the examples I have seen to my query. If VBA is a better option then I am all ears.</p>\n"},{"tags":["php","sql-server","freetds"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13180746,"title":"mssql_connect(): Unable to connect to server (without freetds.conf)","body":"<p>I have 2 servers: one is OpenSUSE, another one is SLES 11 sp2 Suse Linux Enterprise Server.</p>\n\n<p>In order to have connection to MSSQL I have to install mssql.so for php.</p>\n\n<p>OpenSUSE permits to install mssql from rpm.\nSLES - does not have mssql rpm, and this is why need to compile it.</p>\n\n<p>OpenSUSE: mssql rpm installed =></p>\n\n<pre><code>$server=\"172.x.x.x:49888\";\n$username=\"username\";\n$password=\"password\";\n$link = mssql_connect($server, $username, $password);\n</code></pre>\n\n<p>here successfully connected to MSSQL!</p>\n\n<p>SLES: with mssql.so compiled =></p>\n\n<pre><code>$server=\"172.x.x.x:49888\";\n$username=\"username\";\n$password=\"password\";\n$link = mssql_connect($server, $username, $password);\n</code></pre>\n\n<p>error: Warning: mssql_connect(): Unable to connect to server: 172.x.x.x:49888</p>\n\n<p>and if I edit freetds.conf</p>\n\n<pre><code>#A typical Microsoft server\n[Dovico]\n    host = 172.x.x.x\n    port = 49888\n    tds version = 7.0\n</code></pre>\n\n<p>and change php like this:</p>\n\n<pre><code>$server=\"Dovico\";\n$username=\"username\";\n$password=\"password\";\n$link = mssql_connect($server, $username, $password);\n</code></pre>\n\n<p>=> successfully connected to MSSQL!</p>\n\n<p>So my question is how can I have MSSQL connection on SLES (with mssql.so compiled) using this </p>\n\n<pre><code>mssql_connect(\"172.x.x.x:49888\", \"username\", \"password\");\n</code></pre>\n\n<p>and not using freetds.conf ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13182402,"title":"Move a table from one database to another server","body":"<p>I have a table <code>tbl_Question</code> in <code>MyDatabase</code> on <code>MySqlServer</code>. I want to move that table to <code>MyDB_2</code> on <code>MyLocalSqlServer</code>. </p>\n\n<p>How can I do that?</p>\n\n<p>I am using SQL Server 2008 R2 and Microsoft SQL Server Management Studio 10.50.1617.0</p>\n"},{"tags":["sql","sql-server","performance","application","architecture"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13173984,"title":"Is having a copy of SQL data in an application a good idea to save SQL SELECTS?","body":"<p>I am working on a multithreading .NET 4 application which acquires data continuously and writes them into a SQL database (MySQL or SQL Server - not yet sure).</p>\n\n<p>Everytime when a <code>INSERT</code> is executed, at leat one prior <code>SELECT</code> is necessary in order so synchronize with the databaes. This means the applications gets a block which contains new and old data and then has to check which data sets are new and which are already in the database.</p>\n\n<p>This means a lot of <code>SELECTS</code> which result everytime in more or less the same data.</p>\n\n<p>Would it be a good idea to have a copy of the last x entries per table within the application?\nThis way the synchronization could be done on the copy instead of the database.</p>\n\n<p>Pro: </p>\n\n<ul>\n<li>Faster</li>\n</ul>\n\n<p>Contra:</p>\n\n<ul>\n<li>Uses a lot of memory</li>\n<li>Risk of becomming unsynchronized with the database</li>\n</ul>\n\n<p>What do you think? What is the best practice for such a use case?\nAny other pros and cons?</p>\n"}]}
{"total":54451,"page":8,"pagesize":100,"questions":[{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13181966,"title":"SQL: Comparing MAX Dates from Two different Tables","body":"<p>I have 3 Tables</p>\n\n<h2>User</h2>\n\n<p><img src=\"http://i.stack.imgur.com/OvUMc.jpg\" alt=\"enter image description here\"></p>\n\n<h2>Attendence</h2>\n\n<p><img src=\"http://i.stack.imgur.com/7hpGz.jpg\" alt=\"enter image description here\"></p>\n\n<h2>Payment</h2>\n\n<p><img src=\"http://i.stack.imgur.com/hHwEh.jpg\" alt=\"enter image description here\"></p>\n\n<p>Now I like to get    </p>\n\n<p>GroupID, UserName, MAX(PaymetDate), MAX(AttendenceDate)</p>\n\n<p>Where MAX(PaymetDate) IS LESS THAN MAX(AttendenceDate)</p>\n\n<h3>This what I have Tried</h3>\n\n<pre><code>    SELECT  MAX(PaymetDate) AS Paied_Upto\n    FROM Payment\n    Group by GroupID   \n\n    SELECT  MAX(AttendenceDate) AS Last_ AttendenceDate\n    FROM Attendence FULL OUTER JOIN Users ON Attendence.Username = Users.Username\n    Group by Users.GroupID\n</code></pre>\n\n<p>But how do get them to work together?</p>\n\n<h3>Thank</h3>\n"},{"tags":["sql-server","cdc"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":281,"score":2,"question_id":5226998,"title":"Change Data Capture - Microsoft Best Practice for capturing data changes?","body":"<p>We have some debate on our development team regarding the best way to capture changes in data in some of our tables. I am very impressed with Change Data Capture and believe it is the best way to capture this sort of data, and that this is what Microsoft designed CDC to do.</p>\n\n<p>For those of you who've had to deal with this sort of thing, have you found CDC to be the Microsoft best practice way of capturing data changes in tables?</p>\n\n<p>Thanks very much.</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13181782,"title":"Why the table sys.sql_modules is empty?","body":"<p>In SSMS, I create a database using the following script. When the script execution completes, I would expect to see the CREATE TABLE statement in the <a href=\"http://technet.microsoft.com/en-us/library/ms175081.aspx\" rel=\"nofollow\">sql_modules</a> table. However I can't find it.</p>\n\n<pre><code>CREATE DATABASE [MyDb]\nGO \nUSE [MyDb]\nGO\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[MyTable] (\n    [UID] [uniqueidentifier] NOT NULL,\n    [DateTime] [datetime] NOT NULL\n)\n</code></pre>\n\n<p>Here's the query I run the get the table definition. However, I get three empty result sets. Any idea why I am getting those three empty results set?</p>\n\n<pre><code>USE MyDb\nGO\n\nSELECT * \nFROM sys.sql_modules\n\nSELECT * \nFROM sys.triggers\n\nSELECT sm.object_id, OBJECT_NAME(sm.object_id) AS object_name, o.type, o.type_desc, sm.definition\nFROM sys.sql_modules AS sm\nJOIN sys.objects AS o ON sm.object_id = o.object_id\nORDER BY o.type;\n</code></pre>\n"},{"tags":["ios","sql-server","image"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13181865,"title":"Save image taken from iPad/iPhone to sql server database","body":"<p>I have an iPad application that takes a picture.  I have the image data and a reference to that data on the device and I am planning on creating a stored procedure that will take in my data via POST through a WebAPI.  Any issues or considerations I should take into account?</p>\n\n<p>Here is my table</p>\n\n<pre><code>CREATE TABLE [dbo].[productQuality](\n[ProductQualityID] [int] IDENTITY(1,1) NOT NULL,\n[ProductID] [int] NOT NULL,\n[PackageCondition] [varchar](50) NOT NULL,\n[ProductCondition] [varchar](50) NOT NULL,\n[CodeDate] [date] NOT NULL,\n[Notes] [varchar](1000) NOT NULL,\n[Image] [image] NOT NULL,\n[LastUpdateDateTime] [datetime] NOT NULL\n)\n</code></pre>\n\n<p>Here is my image metadata</p>\n\n<pre><code>Image Metadata = {\nDPIHeight = 72;\nDPIWidth = 72;\nOrientation = 6;\n\"{Exif}\" =     {\n    ApertureValue = \"2.526068811667588\";\n    BrightnessValue = \"-1.135538146750534\";\n    ColorSpace = 1;\n    DateTimeDigitized = \"2012:11:01 09:52:00\";\n    DateTimeOriginal = \"2012:11:01 09:52:00\";\n    ExposureMode = 0;\n    ExposureProgram = 2;\n    ExposureTime = \"0.06666666666666667\";\n    FNumber = \"2.4\";\n    Flash = 32;\n    FocalLenIn35mmFilm = 35;\n    FocalLength = \"4.28\";\n    ISOSpeedRatings =         (\n        800\n    );\n    MeteringMode = 5;\n    PixelXDimension = 2592;\n    PixelYDimension = 1936;\n    SceneType = 1;\n    SensingMethod = 2;\n    ShutterSpeedValue = \"3.906905022631062\";\n    SubjectArea =         (\n        1295,\n        967,\n        699,\n        696\n    );\n    WhiteBalance = 0;\n};\n\"{TIFF}\" =     {\n    DateTime = \"2012:11:01 09:52:00\";\n    Make = Apple;\n    Model = iPad;\n    Software = \"6.0\";\n    XResolution = 72;\n    YResolution = 72;\n};\n}\n\n2012-11-01 09:52:21.526 TabAndSplitApp[5465:907] Image = &lt;UIImage: 0x1e88fa80&gt;\n</code></pre>\n\n<p>I don't need help on the WebAPI or the procedure or even the POST, I am wondering if there is anything special you have to do to POST an image \"over the air\" to the server.</p>\n"},{"tags":["asp.net","sql-server","asp.net-mvc-3","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3316,"score":0,"question_id":5308309,"title":"How to connect to remotely SQL Server 2008 using MVC3 EF4","body":"<p>I'm trying to connect remotely and I have the following connection string on my MVC3 using EF4 ctp5 code first</p>\n\n<pre><code>&lt;add name=\"ApplicationServicesX\"\n     connectionString=\"provider=System.Data.SqlClient;provider connection string='Data Source=asc-svr2;\n     Initial Catalog=AdventureWorks;Integrated Security=True;Connection Timeout=60;\n     multipleactiveresultsets=true'\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>and it gives an error </p>\n\n<pre><code>[ProviderIncompatibleException: The provider did not return a ProviderManifestToken string.]\n</code></pre>\n\n<p>and</p>\n\n<pre><code>Login failed. The login is from an untrusted domain and cannot be used with Windows authentication.\n</code></pre>\n\n<p>my controller looks like this </p>\n\n<pre><code> public ActionResult Index()\n {\n     var post = cmsDB.Posts.ToList();\n             return View(post);\n}\n</code></pre>\n\n<p>When I run the code on my local machine no problem at all but when I get into \nremotely connecting into SQL Server 2008 the problem arises.</p>\n\n<p>Thanks a lot for any help.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":13180517,"title":"Casting as float vs int returning different results","body":"<p>Mathematically, these results are similar, I'm just curious about their behavior.  The first version when my local variable is declared as a float, the rounding function stops the decimals displayed at the second decimal. In the second version with the local variable declared as an int the <code>round</code> function rounds to two decimal places, and then adds a bunch of zeroes.  Why would the variable type cause the <code>round</code> function to behave differently?</p>\n\n<pre><code>declare @totalpop float \nset @totalpop = (select count(distinct patid) from members)\nselect @totalpop\nselect edutext\n,COUNT(*) as educationCounts\n,round(100.0*COUNT(*)/@totalpop,2)\nfrom\n(\nselect distinct m.patid, e.eduText\n    from members as m\n    inner join EducationTable as e on e.eduID = m.education\n)x\ngroup by x.eduText\n</code></pre>\n\n<p>--doesn't round to two decimal places</p>\n\n<pre><code>declare @totalpop int\nset @totalpop = (select count(distinct patid) from members)\nselect @totalpop\nselect edutext\n,COUNT(*) as educationCounts\n,round(100.0*COUNT(*)/@totalpop,2)\nfrom\n(\nselect distinct m.patid, e.eduText\n    from members as m\n    inner join EducationTable as e on e.eduID = m.education\n)x\ngroup by x.eduText\n</code></pre>\n"},{"tags":["sql-server","asp.net-mvc","sql-server-express","database-migration"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13180464,"title":"Migrate MVC4 JQuery Mobile App Database to Hosting Provider Questions","body":"<p>I am new to MVC4 &amp; SQL server and don't understand some things. I've asked\nquestions at my web hosting provider, but I can't seem to get an answer.</p>\n\n<p>I have developed an application on my PC it uses VS2012 MVC4 4.5 JQuery Mobile\ntemplate with an SQL Express database</p>\n\n<p>I have uploaded the project to the hosting environment and I need to get the\ndatabase portion of the project working. Everything works in the project except\nfor when I try to access the database (this happens when I try to log in and\nthe authentication process fails - because the DD has not been connected). I.e.,\nI have no idea how to do this part.</p>\n\n<p>I have done some research, and here is what I have found out:</p>\n\n<p>1) I need to \"back-up\" my SQL express mdf and ldf files.</p>\n\n<hr>\n\n<p>Is this true? And, how do I do this? </p>\n\n<p>2) I need to then restore the SQL Express .mdf &amp; .ldf files on the webserver.</p>\n\n<hr>\n\n<p>Is this correct? Any help on this question would be great.</p>\n\n<p>3) I understand I have to change my connection string. I'm sure what it's supposed to be.</p>\n\n<hr>\n\n<pre><code>&lt;connectionStrings&gt;\n &lt;add name=\"DefaultConnection\" providerName=\"System.Data.SqlClient\"  \n    connectionString=\"Data Source=(LocalDb)\\v11.0;Initial Catalog=aspnet-MvcDealerConn-\n    20121005200308;Integrated Security=SSPI;AttachDBFilename=|DataDirectory|\\aspnet-\n     MvcDealerConn-20121005200308.mdf\" /&gt;\n</code></pre>\n\n<p></p>\n\n<p>4) What version of SQL Server should I use? v11.0? I.e., what will work?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":237,"score":5,"question_id":12867597,"title":"SQL Server insert statement runs successfully but values are not added to table even though row is created","body":"<p>I have an insert statement as below. I am able to debug my stored procedure and step through my code to verify that my code runs, but a funny thing happens. </p>\n\n<p>The values that I expect to be saved in the database are not saved. Instead a row is created in the table and the <code>RecordCreatedField</code> is correctly created, even a primary key is included but the actual columns I expect to be inserted are not. All the columns are <code>nvarchar/varchar</code>, except for the date columns and the ID, but only those columns are populated.  However the following <strong>@PRCUPC ,@PRCEAN ,@PRCGTIN,@PRCatalogNumber</strong> are somehow omitted. </p>\n\n<pre><code>EXEC spinsertprodcode \n                  @pid out, \n                  @ProdID, \n                  @UPC, \n                  @EAN, \n                  @TIN, \n                  @CNumber, \n                  0, \n                  0, \n                  1, \n                  @staid, \n                  @counter out\n\n\n\nINSERT INTO dbo.ProdCodes\n(PRProductID\n,PRCUPC\n,PRCEAN\n,PRCGTIN\n,PRCatalogNumber\n,PRIsReplacement \n,PRIsReplaced \n,PRCRecordCreatedDate \n,PRCIsActive\n,PRStatusFlag)\n\nOUTPUT INSERTED.PRCID INTO @opID\n\nVALUES\n(@PRProductID, \n@PRCUPC, \n@PRCEAN, \n@PRCGTIN, \n@PRCatalogNumber,\n@PRIsReplacement ,\n@PRIsReplaced,\nGETDATE(), \n@PRCIsActive, \n@PRStatusFlag)\n\nSELECT @PRCID = O.ID FROm @opID O\n</code></pre>\n\n<p>Would appreciate any suggestion on how I can fix this  or understand what is going on. </p>\n\n<p><img src=\"http://i.stack.imgur.com/9cJ6p.png\" alt=\"Image of the Debug Screen where I confirm the right values are passed\"></p>\n\n<p>Here is an SQl fiddle of the main Stored proc that calls my insert code. \n<a href=\"http://sqlfiddle.com/#!6/d41d8/9\" rel=\"nofollow\"><strong>SQL Fiddle of my code</strong> </a></p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13180231,"title":"Migrating DB from SQL 2005 Enterprise to SQL 2008 Standard","body":"<p>I'm attemtping to migrate a DB from SQL 2005 Enterprise to SQL 2008 Standard.  I've run into an issue because there is a Partition Function defined in the DB of the Enterprise edition.  I know Standard edtiions do not support Partition Functions. Upgrading the version of SQL im migrating to Enterprise isn't an option.</p>\n\n<p>I'm looking for a way to remove the partition function without causing any negative effects to the DB currently so I can migrate it to the 2008 Standard Edition.</p>\n\n<p>Any help would be greatly appreciated. Thanks!</p>\n\n<p>MOVED to dba.stackexchange.com. </p>\n"},{"tags":["sql-server","tsql","sql-server-2008","sqlcompare"],"answer_count":9,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1182,"score":3,"question_id":3012544,"title":"T-SQL - Is there a (free) way to compare data in two tables?","body":"<p>I have <code>table a</code> and <code>table b</code>. (SQL Server 2008)</p>\n\n<p>Both tables have the exact same schema.</p>\n\n<p>For the purposes of this question, consider <code>table a</code> = my local dev table, <code>table b</code> = the live table.</p>\n\n<p>I need to create a SQL script (containing <code>UPDATE/DELETE/INSERT</code> statements) that will update table b to be the same as table a. This script will then be deployed to the live database.</p>\n\n<p>Any free tools out there that can do this, or better yet a way I can do it myself?</p>\n\n<p>I'm thinking I probably need to do some type of a join on all the fields in the tables, then generate dynamic SQL based on that.</p>\n\n<p>Anyone have any ideas?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Okay, thought I'd clarify this question a little.</p>\n\n<p>The table I need to synchronize is a simple look-up table. The data is very simple and straightforward.</p>\n\n<p>Here's an idea of what <code>TABLE A</code> might look like:</p>\n\n<pre><code>IdFoo          Activity      IsFoo\n1              Foo           1\n2              Bar           0\n</code></pre>\n\n<p>Here's an idea of what <code>TABLE B</code> might look like:</p>\n\n<pre><code>IdFoo          Activity      IsFoo\n1              Foo           1\n2              Bar           1\n</code></pre>\n\n<p>Basically, all I want to do is update that <code>BIT</code> column (<code>IsFoo</code>) in <code>TABLE B</code> to match the corresponding value in <code>TABLE A</code> for the same IdFoo.</p>\n\n<p>Keep in mind:</p>\n\n<ul>\n<li><code>TABLE A</code> is on my local machine</li>\n<li><code>TABLE B</code> is on the live server</li>\n</ul>\n\n<p>Obviously I have a (reliable) backup of <code>TABLE B</code> on my local machine which i need to script against, then run the script on the live server.</p>\n\n<p>The table also has referential integrity (other columns I didn't show). Which means I can't just delete everything in <code>TABLE B</code> and do an insert from <code>TABLE A</code>.</p>\n\n<p>This script will be a once off. So no need to do things like linked server, replication, etc. Appreciate the answers though guys. =)</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Ok - so I've gone with Oleg's answer (VS2010 Data Compare). Quick, easy, and works a charm.</p>\n\n<p>Not to say the other answers are incorrect. I appreciate all the answers!</p>\n"},{"tags":["sql-server","reporting-services","ssrs-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13180160,"title":"SSRS 2005 Number formating int and double within one field","body":"<p>I am using <code>SSRS 2005</code>. The issue is I would like to place , in numbers so if number is 23455 it should be displayed as 23,455 I know how to do this I have two data types in this field int and double. What I did to accommodate it is changed the numbers to strings but if I extract them to Excel they show green triangle.</p>\n\n<p>To eliminate green triangle in Excel I used <code>CDEC()</code> function which converts the string to number by doing this I loose , in the numbers.</p>\n\n<p>I was wondering if it is even possible to place a comma within the field which has two different datatypes i.e. double and int.</p>\n"},{"tags":["sql-server","sql-server-ce"],"answer_count":5,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":21155,"score":7,"question_id":1953248,"title":"how to open sdf (sql server compact edition) file?","body":"<p>I have an SDF file and I would like to retrieve its schema and query it with some UI. How can I do this? I have no Visual Studio installed on the machine and I would like to install as little software as possible.</p>\n"},{"tags":["sql","sql-server","pivot","dynamic-sql","temp-table"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":13180175,"title":"Trying to put a dynamic SQL subquery result into SQL-Server 2008 temp table without pre define the temp table","body":"<p>Im trying to get my result into a temp table but cant get it to work.</p>\n\n<pre><code>DECLARE @query nvarchar(max)\nSET @query = N'SELECT * INTO ##TmpTbl FROM (SELECT * FROM Tbl1)'\nEXEC(@query)\n</code></pre>\n\n<p>What am i doing wrong?</p>\n\n<blockquote>\n  <p>NOTE: I can NOT pre define temp table/table variable because of the actual\n  question being run is a pivot question without pre defined columns in\n  its result.</p>\n</blockquote>\n"},{"tags":["sql","sql-server","alter-table","alter-column"],"answer_count":4,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":7591,"score":7,"question_id":3186760,"title":"SQL Server - Change a Nullable column to NOT NULL with Default Value","body":"<p>I came across an old table today with a datetime column called 'Created' which allows nulls.  Now, I'd want to change this so that it is NOT NULL, and also include a constraint to add in a default value (getdate()).</p>\n\n<p>So far I've got the following script, which works fine provided that i've cleaned up all the nulls beforehand:</p>\n\n<pre><code>ALTER TABLE dbo.MyTable ALTER COLUMN Created DATETIME NOT NULL \n</code></pre>\n\n<p>Is there any way to also specify the default value as well on the ALTER statement?</p>\n"},{"tags":["sql","sql-server","query","ide","formatting"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":207,"score":1,"question_id":11061642,"title":"SQL server 2012 SP_HELPTEXT extra lines issue","body":"<p>I am using SQL server 2012, &amp; always use <code>SP_HELPTEXT</code> to get my previously created Stored Procedures, In previous versions of SQL server there were no issues in this process but in 2012, My Stored Procedures come with extra lines, for example this is the procedure that I wrote</p>\n\n<pre><code>Create proc SP_Test\nas\nbegin\n Select * \n from table_ABC\nend\n</code></pre>\n\n<p>Now after using <code>SP_HELPTEXT</code> with this procedure (or any other procedure), I am getting this output</p>\n\n<pre><code>Create proc SP_Test\n\nas\n\nbegin\n\n Select * \n\n from table_ABC\n\nend\n</code></pre>\n\n<p>Do any one else also facing this problem or I am the only one on this planet to struggle with this issue ??\nDoes any body know how to solve this issue ??</p>\n\n<p>Configuration of my SQL server is as follows (copied from <strong>Help -> About</strong> )</p>\n\n<pre><code>Microsoft SQL Server Management Studio          11.0.2100.60\nMicrosoft Analysis Services Client Tools        11.0.2100.60\nMicrosoft Data Access Components (MDAC)         6.1.7601.17514\nMicrosoft MSXML                     3.0 6.0 \nMicrosoft Internet Explorer             9.0.8112.16421\nMicrosoft .NET Framework                4.0.30319.269\nOperating System                    6.1.7601\n</code></pre>\n\n<p>Thanx in advance.</p>\n"},{"tags":["asp.net","sql-server","enterprise-library","data-access-layer"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13179793,"title":"Is My Data Access Leaking Connections?","body":"<p>Folks</p>\n\n<p>I have an N-Tiered ASP.Net Web Forms application which uses Enterprise Library 5.0 for data persistence. Recently I have noticed my application has been spitting out the following error</p>\n\n<blockquote>\n  <p>Timeout expired. The timeout period elapsed prior to obtaining a\n  connection from the pool</p>\n</blockquote>\n\n<p>This would point to leaking connections or connections not being closed. Please can someone look at my Data Access class and let me know if they see any issues where connections are not being closed properly</p>\n\n<pre><code>Public Class DataAccess\n\n    Private db As Database = DatabaseFactory.CreateDatabase()\n\n    Public Function ExecuteNonQuery(ByVal params() As SqlParameter, ByVal strSproc As String) As Integer\n\n        Dim intReturnValue As Integer = 0\n        Dim i As Integer\n\n        Using cmd As DbCommand = db.GetStoredProcCommand(strSproc)\n\n            cmd.CommandTimeout = 120\n\n            For i = 0 To params.Length - 1\n                db.AddInParameter(cmd, params(i).ParameterName.ToString, params(i).DbType, params(i).Value)\n            Next\n\n            db.AddParameter(cmd, \"return_value\", DbType.Int32, ParameterDirection.ReturnValue, \"\", DataRowVersion.Default, 0)\n\n            db.ExecuteNonQuery(cmd)\n            intReturnValue = Int32.Parse(db.GetParameterValue(cmd, \"@return_value\"))\n\n        End Using\n\n        Return intReturnValue\n\n    End Function\n\n    Public Function ExecuteDataReader(ByVal params() As SqlParameter, ByVal SProc As String) As SqlDataReader\n\n        Dim i As Integer\n\n        Dim dr As SqlDataReader\n\n        Using cmd As DbCommand = db.GetStoredProcCommand(SProc)\n\n            cmd.CommandTimeout = 120\n\n            For i = 0 To params.Length - 1\n                db.AddInParameter(cmd, params(i).ParameterName.ToString, params(i).DbType, params(i).Value)\n            Next\n\n            dr = TryCast(DirectCast(db.ExecuteReader(cmd), RefCountingDataReader).InnerReader, SqlDataReader)\n\n        End Using\n\n        Return dr\n\n    End Function\n\n    Public Function ExecuteDataSet(ByVal Sproc As String, ByVal params() As SqlParameter) As DataSet\n        Dim db As Database = DatabaseFactory.CreateDatabase()\n        Dim ds As New DataSet\n        Dim i As Integer\n\n        Using cmd As DbCommand = db.GetStoredProcCommand(Sproc)\n            cmd.CommandTimeout = 120\n\n            For i = 0 To params.Length - 1\n                db.AddInParameter(cmd, params(i).ParameterName.ToString, params(i).DbType, params(i).Value)\n            Next\n\n            db.LoadDataSet(cmd, ds, \"table\")\n        End Using\n\n\n        Return ds\n    End Function\n</code></pre>\n\n<p>Could this error also mean that it is taking too long to possibly execute some queries? Some tables in my database have alot of data in them.</p>\n\n<p>Any feedback or help would be greatly appreciated with this folks as it is really affecting my application.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","raiserror"],"answer_count":1,"favorite_count":6,"up_vote_count":20,"down_vote_count":0,"view_count":7891,"score":20,"question_id":1122925,"title":"What do the different RAISERROR severity levels mean?","body":"<p>My best google result was <a href=\"http://www.xaprb.com/blog/2005/11/23/be-consistent-with-raiserror-severitites/\" rel=\"nofollow\">this</a>:</p>\n\n<ul>\n<li>below 11 are warnings, not errors</li>\n<li>11-16 are available for use</li>\n<li>above 16 are system errors</li>\n<li>there is no behavioral difference among 11-16</li>\n</ul>\n\n<p>But, from BOL, \"Severity levels from 0 through 18 can be specified by any user.\"</p>\n\n<p>In my particular stored procedure, I want the error returned to a .Net client application, so it looks like any severity level between 11-18 would do the trick.  Does anyone have any authoritative information about what each of the levels mean, and how they should be used?</p>\n"},{"tags":["asp.net","sql-server","iis-7.5","session-variables","session-state"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":149,"score":3,"question_id":13130239,"title":"Sharing SQL Server Session State across Web Applications","body":"<p>I'm setting up a very basic demo of SQL Server Session State, but am having some trouble getting it working. I'm trying to test this out locally running Windows 7 with IIS 7.5 and SQL Server 2008 R2. </p>\n\n<p><strong>Ultimately, I need a way to track the number of users logged into a system that is load-balanced between a few different web servers. So I need to update a session variable (stored in SQL) every time a user logs in or out. So the session ID could always be different. Is this possible?</strong></p>\n\n<p>Here's what I've done so far:</p>\n\n<ol>\n<li>Created two new sites in IIS (Site1 and Site2)</li>\n<li>Created two new Web Application projects in VS 2010 (Site1 and Site2)</li>\n<li>In both sites, on the Default.aspx page, I created a button that when clicked will save either \"Site1\" or \"Site2\" (depending on the site) into a session variable called \"LastSiteUsed\". There's another button, that when clicked, will read the value from the \"LastSiteUsed\" session variable and display it in a label.</li>\n<li>In SQL, I created a new Database called dbSessionTest. Then I followed the instructions on <a href=\"http://msdn.microsoft.com/en-us/library/ms178586.aspx\" rel=\"nofollow\">MSDN to install the Session State Database using the aspnet_regsql tool</a>.</li>\n<li>In both of my Web Application's Web.config file, I've added the following under <code>&lt;System.Web&gt;</code>: </li>\n</ol>\n\n<p><code>&lt;sessionState mode=\"SQLServer\" sqlConnectionString=\"server=.\\sqlexpress;database=dbSessionTest;uid=myUsername;pwd=myPassword\" cookieless=\"false\" timeout=\"20\" allowCustomSqlDatabase=\"true\"/&gt;</code></p>\n\n<p>Both sites function normally, but they don't seem to be <em>sharing</em> the session. For example, when I click my button to save my session variable from Site1, I'd expect to be able to read that value from Site2, but it doesn't work. Site2 will only return \"Site2\" and Site1 will only return \"Site1\". </p>\n\n<p>Does anyone have any ideas on what I could be doing wrong? Am I wrong in thinking that I should be able to read a value set by Site1 from Site2?</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>I can see that session data is getting stored in the <code>ASPStateTempSessions</code> table in SQL Management Studio, but each site can still only see the value which it wrote. Both sites are setting the session variable like this:</p>\n\n<pre><code>Session(\"LastSiteUsed\") = \"Site2\"\n</code></pre>\n\n<p>And both sites are retrieving the value like:</p>\n\n<pre><code>lblValue.Text = \"Value from Session: \" &amp; Session(\"LastSiteUsed\").ToString\n</code></pre>\n\n<p>Do I need to do this differently for accessing session variables stored in SQL Server?</p>\n\n<p><strong>UPDATE 2:</strong></p>\n\n<p>I've tried using the default database, ASPState, which is created by running this command:</p>\n\n<pre><code>aspnet_regsql.exe -S MyServerName -E -ssadd -sstype p\n</code></pre>\n\n<p>Then simplified each of my Web.config files like:</p>\n\n<pre><code>&lt;sessionState mode=\"SQLServer\" sqlConnectionString=\"Data Source=.\\sqlexpress;User ID=myUsername;Password=myPassword\" cookieless=\"false\" timeout=\"20\"/&gt;\n</code></pre>\n\n<p>But again, no luck. I want to be able to set a session variable from Site1 and then read the value from Site2, but it's not working. Again, I'm able to see entries showing up in the <code>ASPStateTempSessions</code> table so I know they're getting entered correctly. One thing I noticed is they have different session IDs? </p>\n\n<p>Is there something I need to be doing differently to ensure the same session ID is used between my sites when setting/reading the same session variable?</p>\n\n<p><strong>UPDATE 3:</strong></p>\n\n<p>I've followed the instructions from <strong><a href=\"http://www.stionasoftware.com/Blogs/post/2010/10/27/Sharing-NET-Session-across-multiple-applications.aspx\" rel=\"nofollow\">this article</a></strong> which modifies an SP and adds a column for grouping to the <code>ASPStateTempApplications</code> table. This <em>kind of</em> worked, but only if both of my sites were open in the same browser (using tabs). I need to be able to open Site1 in IE, save a value to my session variable, close the browser, open Site2 in Chrome, and read the value. From everything I've read with SQL Server Session State... this should be possible.</p>\n\n<p><strong>UPDATE 4 - SOLUTION:</strong></p>\n\n<p>I followed the answer on <strong><a href=\"http://stackoverflow.com/questions/2868316/sharing-sessions-across-applications-using-the-asp-net-session-state-service/3151315#3151315\">this article</a></strong> provided by @SilverNinja. I re-created the <code>ASPState</code> database via the command prompt (to undo my SP changes in Update #3) and then modified the <code>TempGetAppID</code> SP as per the answer from the link. I've also updated both of my Web.config files to match the answer from that article as well:</p>\n\n<pre><code>&lt;sessionState mode=\"SQLServer\"\n              sqlConnectionString=\"Data Source=.\\sqlexpress;User ID=myUsername;Password=myPassword;Application Name=CacheTest\"/&gt;\n</code></pre>\n\n<p>I've also included identical Machine Keys in both Web.config files:</p>\n\n<pre><code>&lt;machineKey validationKey=\"59C42C5AB0988049AB0555E3F2128061AE9B75E3A522F25B34A21A46B51F188A5C0C1C74F918DFB44C33406B6E874A54167DFA06AC3BE1C3FEE8506E710015DB\" decryptionKey=\"3C98C7E33D6BC8A8C4B7D966F42F2818D33AAB84A81C594AF8F4A533ADB23B97\" validation=\"SHA1\" decryption=\"AES\" /&gt;\n</code></pre>\n\n<p>Now I am able to (using IE) open up both of my sites, set a value from Site1, and read it from Site2 (and vice versa). When I check the table, only one SessionID exists (both sites are using the same session correctly). I was wrong in my thinking before that opening a new browser (for example, with Chrome), would use the same session - a new browser will start it's own session. On a load-balanced scenario though, this shouldn't cause any issues.</p>\n"},{"tags":["sql-server","vb.net","insert","sql-update"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13178360,"title":"SQL Server command in vb.net not working cause all in one sentence","body":"<p>This is propably a very easy question.</p>\n\n<p>But i cant fix it.\nI try an update if @ID = column id, else insert all.</p>\n\n<p>Only this one doesn't work if i put it all in one sentence</p>\n\n<pre><code>Cmd.CommandText = \"UPDATE Locatie SET (Longitude = @Longitude, Latitude = @Latitude, Timestamp = @Timestamp) WHERE ID=@ID IF @@ROWCOUNT=0 INSERT INTO Locatie VALUES (@ID, @Longitude, @Latitude, @Timestamp)\"\n</code></pre>\n"},{"tags":["sql-server","stored-procedures","insert","record","insert-update"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13178962,"title":"How to insert some record in Sql?","body":"<p>i'm want insert some record in sql server. i try query but insert all record and value duplicate.</p>\n\n<p><strong>i need don't duplicate value and insert some record.</strong></p>\n\n<p><strong>Table filesTA</strong></p>\n\n<pre><code>runNo   cDate           cIn         cOut    \n00001   2012-10-09 00:00:00.000 2012-10-09 07:21:00.000 2012-10-09 20:34:00.000 \n00005   2012-10-09 00:00:00.000 2012-10-09 07:36:00.000 2012-10-09 17:04:00.000 \n00006   2012-10-09 00:00:00.000 2012-10-09 07:55:00.000 2012-10-09 20:34:00.000 \n00007   2012-10-09 00:00:00.000 2012-10-09 07:50:00.000 2012-10-09 00:00:00.000 \n00008   2012-10-09 00:00:00.000 2012-10-09 07:56:00.000 2012-10-09 20:35:00.000 \n00009   2012-10-09 00:00:00.000 2012-10-09 07:57:00.000 2012-10-09 20:32:00.000 \n00010   2012-10-09 00:00:00.000 2012-10-09 07:58:00.000 2012-10-09 19:03:00.000\n</code></pre>\n\n<p><strong>this code Stored Procedure</strong></p>\n\n<pre><code>SELECT \n     em.empNo,\n     ISNULL(tf.cDate, '2012-10-09'),\n     tf.cIn,tf.cOut\nFROM \n     filesTA tf Full Outer join \n     Emp em On tf.runNo = em.empNo AND tf.cDate = '2012-10-09'\n</code></pre>\n\n<p><strong>result from code Stored Procedure (On Datagridview display)</strong></p>\n\n<pre><code>empNo   cDate           cIn         cOut\n00001   2012-10-09 00:00:00.000 2012-10-09 07:21:00.000 2012-10-09 20:34:00.000\n00002   2012-10-09 00:00:00.000 NULL                    NULL\n00003   2012-10-09 00:00:00.000 NULL                    NULL\n00004   2012-10-09 00:00:00.000 NULL                    NULL\n00005   2012-10-09 00:00:00.000 2012-10-09 07:36:00.000 2012-10-09 17:04:00.000\n00006   2012-10-09 00:00:00.000 2012-10-09 07:55:00.000 2012-10-09 20:34:00.000\n00007   2012-10-09 00:00:00.000 2012-10-09 07:50:00.000 2012-10-09 00:00:00.000\n00008   2012-10-09 00:00:00.000 2012-10-09 07:56:00.000 2012-10-09 20:35:00.000\n00009   2012-10-09 00:00:00.000 2012-10-09 07:57:00.000 2012-10-09 20:32:00.000\n00010   2012-10-09 00:00:00.000 2012-10-09 07:58:00.000 2012-10-09 19:03:00.000\n</code></pre>\n\n<p>result from code Stored Procedure. it's not insert to sql. But show display on datagridview.</p>\n\n<p>next Step. i need insert record '00002','00003','00003' <strong>or cIn and cOut = null</strong>\nbut i try insert that's all record and duplicate value.</p>\n\n<p><strong>this code new.</strong></p>\n\n<pre><code>    Insert INTO \n    filesTA (runNo,cDate,cIn,cOut)\n    VALUES \n   (SELECT \n        em.empNo,\n        ISNULL(tf.cDate, '2012-10-09'),\n        tf.cIn,tf.cOut\n    FROM \n        filesTA tf Full Outer join Emp em \n        On tf.runNo = em.empNo AND tf.cDate = '2012-10-09')\n</code></pre>\n\n<p>i need result from code Stored Procedure (On Datagridview display)</p>\n\n<p>Thanks you for your time. :)</p>\n"},{"tags":["sql-server","sql-server-2008-r2","mediawiki"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13177979,"title":"Is there any info about using MS SQL Server with MediaWiki?","body":"<p>I wonder if it possible to use mediawiki 1.18 with MS SQL server(particullary, MS SQL server 2008 r2), and, if possible, where to find some info about them working together. I know that mysql is much better solution, but our client insist on oracle DB or MS SQL. And i'd prefer MS SQL because i nether worked with oracle db and we still would have to buy it. Can somebody give me any help?<br/>\nCurrent version of my mediawiki is 1.18</p>\n"},{"tags":["sql-server","management-studio"],"answer_count":8,"favorite_count":2,"up_vote_count":12,"down_vote_count":0,"view_count":10821,"score":12,"question_id":651535,"title":"Management Studio default file save location","body":"<p>Open a new query window.  Write some SQL.  Save the script, the Save File As\ndialog box opens - but always to the same default location in the Profiles\ndirectory.  Is there any way to set my default file location?  ...Like I used\nto do with apps from the 1980s?</p>\n\n<p>Under Tools|Options a default location can be specified for query results.\nI need the same thing for new queries (the text editor).  Tried changing\nlocations in the Registry but SSMS just overwrote my changes.  Any\nsuggestions?</p>\n\n<p>(I saw this unanswered question at <a href=\"http://www.eggheadcafe.com/software/aspnet/30098335/management-studio-default.aspx\" rel=\"nofollow\">http://www.eggheadcafe.com/software/aspnet/30098335/management-studio-default.aspx</a>\n and I had same exact question so I just reposted it here)</p>\n"},{"tags":["c#","sql-server","design-patterns"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":13160219,"title":"What design pattern can be applied to build an object that requires data from two datareaders?","body":"<p>I'm a novice programmer interested in learning about \"Design Patterns\".  I've read a lot of information regarding design patterns from multiple sites but most utilize very basic applications of a particular pattern.</p>\n\n<p>My goal is to compose an object that has data from multiple tables. I'm using the repository pattern to extract the required data from one table in my db.  But I also need additional data from a second table. (Using Joins in my opinion would complicate this unnecessarily) This is where I'm not sure what to do next.  Would the Factory Patterns be best? Etc...</p>\n\n<p>For the most part at least some guidance as to how to do this would be helpful and not necessarily actual \"code\".</p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":54,"score":4,"question_id":13177765,"title":"Regarding get automatic columns in sql`","body":"<p>I have basically 50 fields in a table and I want to select this fields from table on a regular basis.</p>\n\n<p><strong>Problem is</strong>: I have to write all this 50 fields manually.</p>\n\n<p>Is there any shortcut in intellisence or any other tool where I can get all fields. automatically by pressing tool.</p>\n\n<p>Also guys if anyone knows here extra addons on sql..then please post it here.</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1066,"score":1,"question_id":9877920,"title":"SQL Server 2008 - date format issue while inserting","body":"<p>I am trying to insert date into a table but the date and format of inserted date is messed up. The datatype in the table is <code>Date</code>. My insert script is as below.</p>\n\n<pre><code>insert into Trans(ID, TDate, Description)\nvalues(1, CONVERT(datetime, 25-02-2012, 101), 'Opening')\n</code></pre>\n\n<p>I am trying to insert in <code>dd/MM/yyyy</code> format and I want it in the same format in my table. But in my table the date is <code>1894-07-22</code> !!</p>\n\n<p>I want the date to be inserted exactly as the format I wish and I want to see the inserted date as <code>25-02-2012</code> in the table.</p>\n\n<p>What is wrong here ? Can somebody help ?</p>\n"},{"tags":["sql-server","sql-server-2008","powershell","powershell-v2.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13152809,"title":"Invoke-SqlCmd QueryTimeout","body":"<p>Does anyone know how to set Invoke-SqlCmd QueryTimeout more than 65535? </p>\n\n<p>Microsoft said that they have fixed it in Denali but we are still using SQL 2008 R2 with latest service packs.</p>\n\n<p><a href=\"http://connect.microsoft.com/SQLServer/feedback/details/551799/invoke-sqlcmd-querytimeout-0-still-times-out\" rel=\"nofollow\">http://connect.microsoft.com/SQLServer/feedback/details/551799/invoke-sqlcmd-querytimeout-0-still-times-out</a></p>\n\n<p>Basically, we are trying to backup or restore the database using powershell. Some of our databases are very large so it takes more than 65535 to complete the job. </p>\n\n<p>Some suggested that we should use ADO.NET with timeout in powershell. But I wonder if we have any workaround for Invoke-SqlCmd...</p>\n"},{"tags":["sql","sql-server","pivot"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":13177591,"title":"Select matching rows as columns","body":"<p>I think it would be quickest to show by example, so here goes a simplified version of my problem. I am using SQL Server.</p>\n\n<p>This is the data model</p>\n\n<pre><code>SURVEY       QUESTION        ANSWER\n------       --------        -------\nsurveyId     questionId      answerId\n             questionText    surveyId\n                             questionId\n                             answerText\n</code></pre>\n\n<p>Here's some sample data</p>\n\n<pre><code>SURVEY          QUESTION\n ----------      ------------ --------------\n| surveyId |    | questionId | questionText |\n ----------      ------------ --------------\n| 1        |    | 1          | Name         |\n| 2        |    | 2          | E-Mail       |\n ----------     | 3          | Address      |\n                | 4          | Phone        |\n                 ------------ --------------\nANSWER\n -----------------------------------------------\n| answerId | surveyId | questionId | answerText |\n -----------------------------------------------\n| 1        | 1        | 1          | John       |\n| 2        | 1        | 2          | john@aa.bb |\n| 3        | 1        | 3          | New York   |\n| 4        | 1        | 4          | 1112223344 |\n| 5        | 2        | 1          | Pete       |\n| 6        | 2        | 2          | pete@cc.dd |\n| 7        | 2        | 3          | Boston     |\n| 8        | 2        | 4          | 5556667788 |\n -----------------------------------------------\n</code></pre>\n\n<p>Finally, here's what I'd like to select</p>\n\n<pre><code>RESULT\n ------------------------------\n| surveyId | name | email      |\n ------------------------------\n| 1        | John | john@aa.bb |\n| 2        | Pete | pete@dd.cc |\n ------------------------------\n</code></pre>\n\n<p>I'd like to be able to specify at run time which columns I need in my final table. Right now I can get this result by doing the following</p>\n\n<pre><code>SELECT rName.surveyId, rName.requestor, rEmail.email \nFROM (SELECT a.answerText AS name, a.surveyId\n      FROM answer a INNER JOIN question q ON a.questionId = q.questionId \n      WHERE a.surveyId = @surveyId AND q.questionText = 'Name') AS rName\nINNER JOIN \n     (SELECT a.answerText AS name, a.surveyId\n      FROM answer a INNER JOIN question q ON a.questionId = q.questionId \n      WHERE a.surveyId = @surveyId AND q.questionText = 'E-Mail') AS rEmail\nON rName.questionnaireId = rEmail.questionnaireId\n</code></pre>\n\n<p>As you can see, it's ugly, and contains duplicate code. Is there a way to do this cleaner? </p>\n"},{"tags":["sql","sql-server","query","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13177901,"title":"How to find if a date is from a Odd or Even week?","body":"<p>In my table I have for each day:</p>\n\n<pre><code>Id_______Startdate _______ EndDate __________MondayMorning _____MondayEvening ___TuMorning  ....  \n121 _____2012-01-01________2012-12-31 ________2 ___________________2______________2   \n122 _____2012-02-01________2012-08-05 ________1 ___________________2______________3   \n</code></pre>\n\n<p>I already generated a list of dates using the Startdate and EndDate. </p>\n\n<p>I want to know if this dates belongs to a odd week or a even week so that I can filter days from my output that have number 3 Or 1 (see second record).</p>\n\n<p>how can I filter the days that belongs to  odd weeks and even weeks that have number 1 and 3?</p>\n"},{"tags":["sql-server","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13177143,"title":"Is SSIS the way to achieve this functionality?","body":"<p>I have a manual process that needs to be automated. Below are the steps outlined. Is SSIS the correct way to achieve all the below mentioned steps? Especially the result to CSV, zip and email steps? Can this be done using inbuilt sql server scheduler?</p>\n\n<ol>\n<li><p>Connect to SQL Server: DARVIN,51401</p></li>\n<li><p>Open SQL Query:  o:\\Status Report.sql</p></li>\n<li><p>Chose database: AdventureWorks </p></li>\n<li><p>In the menu bar above choose Tools, then Options.</p></li>\n<li><p>When the pop-up appears, choose the tab named Results and choose Results output format of Comma Delimited (CSV).  Clikd the Apply then the OK button. </p></li>\n<li><p>Execute the query</p></li>\n<li><p>Instruct where to save the file, You can save these in O:\\Reports       File name format is: day^_^Report TSP MM-DD-YY </p></li>\n<li><p>Let the query run 15-25 minutes. </p></li>\n<li><p>When the query is complete, open the folder that you save the report in, right click on the report title and compress to a zip file. (right click, Send To Compressed (zipped) Folder) When this has been completed.</p></li>\n<li><p>Copy the saved file and put into: O:\\zippedFiles\\</p></li>\n<li><p>Email:  support@adventureworks.com to let them know that you \nhave placed a zip file at: O:\\zippedFiles\\</p></li>\n</ol>\n"},{"tags":["php","sql","sql-server","codeigniter"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13176624,"title":"SQL Comment in CodeIgniter Active Record?","body":"<p>I'm moving a project to CodeIgniter and want to take advantage of Active Record.  However, I haven't found a way to append a SQL comment to the queries.  In the existing code the query looks something like this:</p>\n\n<pre><code>UPDATE table\nSET column = 'value'\nWHERE  ID = passed value;\n-- Transacted by ' .$_SESSION['Name']\n</code></pre>\n\n<p>I've search Google and SO and not found the answer to how to add that last \"Transacted by\" comment without coding the whole thing directly and using <code>$this-&gt;db-&gt;query('.....')</code></p>\n"},{"tags":["sql","sql-server","query"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13176788,"title":"ms sql 2005 can't compare dates","body":"<p>I have a huge database in ms sql. I have a date stored into a field of type: <code>VARCHAR2</code>\nI have the code, but it can't compare dates. What I mean? There is an input with a launch date. What I need is to get the launchdate inputs where the launchdate is bigger than a date and smaller than another. The problem is that when I change the year from 2012 to 2013 there are no results. Also when I have dates with 0 (like 01.01.2012) it can't compire them.</p>\n\n<p>What I have so far is:</p>\n\n<pre><code>edited\n</code></pre>\n\n<p>Can someone help me to get the correct results?</p>\n\n<p><strong>EDIT1</strong></p>\n\n<p>The date is stored as string in this format: yyyy-mm-dd</p>\n"},{"tags":["c#","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13177096,"title":"how to convert dictionary into object and save via sql database","body":"<p>In c# language using dictionary to store and that dictionary converted to object at finally that object stored to SQL server.. </p>\n"},{"tags":["sql","sql-server","tsql","variables","select"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":70,"score":-2,"question_id":13165594,"title":"In SQL Server, is there a way to get a single value from an identity column and repeatedly use it in the same scope?","body":"<p>It's kind of hard to word the question in the title.  Let's say you have a table called Users, and let's say it has an identity / primary key column called \"Id\".  Let's say you want to, in the same transaction, get what you know will only be one instance of Id that falls within a fairly specific WHERE clause or something, then recycle it repeatedly in a very lengthy SELECT statement that's executed immediately afterwards.  Can this be done in SQL Server?  Basically what I'm trying to avoid is something like the following:</p>\n\n<pre><code>Dim id As Int32 = DBA.OneTimeQuery(\"SELECT Id FROM users &lt;where clause&gt;\").Rows(0)(0)\nReturn DBA.OneTimeQuery(\"SELECT &lt;a lot of different things, involving multiple sub\n    -selects that have to pull from the variable id&gt;\")\n'DBA.OneTimeQuery returns a DataTable\n</code></pre>\n\n<p>I know I can avoid using two different connections or whatever by recycling the first where clause, but it's pretty wasteful to have even the same connection and transaction keep re-finding the same exact piece of information.</p>\n\n<p>I want to avoid having Sql Server search for that single value from the Id column more than once, and I also want to be able to put it in the same Sql transaction and connection.  How can this be done?  Thanks!</p>\n"},{"tags":["sql-server","database","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13174627,"title":"Searching some text from SQL-Server DB","body":"<p>This Query can search any string value (table name, table data etc) from all the tables/views of any SQL-Server DB, when you will place any string at \"<strong>your text here</strong>\" it will search your given string from all the tables/views exist in that DB,    </p>\n\n<pre><code>DECLARE @SearchStr nvarchar(100) \n    SET @SearchStr = 'your text here'\n\nDECLARE @Results TABLE(ColumnName nvarchar(370), ColumnValue nvarchar(3630))\n\nSET NOCOUNT ON\n\nDECLARE @TableName nvarchar(256), @ColumnName nvarchar(128), @SearchStr2 nvarchar(110)\nSET  @TableName = ''\nSET @SearchStr2 = QUOTENAME('%' + @SearchStr + '%','''')\n\nWHILE @TableName IS NOT NULL\nBEGIN\n    SET @ColumnName = ''\n    SET @TableName = \n    (\n        SELECT MIN(QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME))\n        FROM    INFORMATION_SCHEMA.TABLES\n        WHERE       TABLE_TYPE = 'BASE TABLE'\n            AND QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME) &gt; @TableName\n            AND OBJECTPROPERTY(\n                    OBJECT_ID(\n                        QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME)\n                         ), 'IsMSShipped'\n                           ) = 0\n    )\n\n    WHILE (@TableName IS NOT NULL) AND (@ColumnName IS NOT NULL)\n    BEGIN\n        SET @ColumnName =\n        (\n            SELECT MIN(QUOTENAME(COLUMN_NAME))\n            FROM    INFORMATION_SCHEMA.COLUMNS\n            WHERE       TABLE_SCHEMA    = PARSENAME(@TableName, 2)\n                AND TABLE_NAME  = PARSENAME(@TableName, 1)\n                AND DATA_TYPE IN ('char', 'varchar', 'nchar', 'nvarchar')\n                AND QUOTENAME(COLUMN_NAME) &gt; @ColumnName\n        )\n\n        IF @ColumnName IS NOT NULL\n        BEGIN\n            INSERT INTO @Results\n            EXEC\n            (\n                'SELECT ''' + @TableName + '.' + @ColumnName + ''', LEFT(' + @ColumnName + ', 3630) \n                FROM ' + @TableName + ' (NOLOCK) ' +\n                ' WHERE ' + @ColumnName + ' LIKE ' + @SearchStr2\n            )\n        END\n    END \nEND\n\nSELECT ColumnName, ColumnValue FROM @Results\n</code></pre>\n\n<p><strong>But i like to search</strong> given string in the <code>procedures/functions/triggers</code> as well is there any query exist for SQL server 2005. As this query does not search in these areas.</p>\n"},{"tags":["sql","sql-server","like-operator"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":13175861,"title":"Same LIKE condition applied to many columns","body":"<p>I have an SQL query that joins few tables and I want to filter records using same LIKE condition for many columns of result set. \nFor example, I have columns t1.Name, t1.FullName, t1.Comment, t2.Name, t3.Description, etc in my query (t1, t2 and t3 are joined tables names) and I want to check whether t1.Name or t1.FullName or t1.Comment or t2.Name or t3.Description is LIKE '%sometext%'.\nI'm just interested what SQL will be faster?</p>\n\n<pre><code>WHERE t1.FullName LIKE '%sometext%' OR t1.Comment LIKE '%sometext%' OR\n      t2.Name LIKE '%sometext%' OR t3.Description  LIKE '%sometext%'\n</code></pre>\n\n<p>or </p>\n\n<pre><code>WHERE ISNULL(t1.Name,'') + '|' + ISNULL(t1.FullName,'') + '|' + ISNULL(t1.Comment,'') + '|' + ISNULL(t2.Name,'') + '|' + ISNULL(t3.Description,'') LIKE '%sometext%'\n</code></pre>\n\n<p>Or may be there is some even faster way?\nI'm using MS SQL Server 2008 R2.</p>\n\n<p><strong>UPD:</strong> I've edited my second query to handle situations when some fields are NULL and when concatenation may contain pattern but fields separately don't.</p>\n"},{"tags":["c#","asp.net",".net","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":13175784,"title":"Transfer data from Excel sheet into SQL Server database","body":"<p>I have an Excel sheet that contains some data. I want to store that data into a SQL Server  database from that aspx page.</p>\n\n<p>I am trying to store data but get error as below:</p>\n\n<blockquote>\n  <p><em>The Microsoft Office Access database engine cannot open or write to the file.\n  It is already opened exclusively by another user, or you need permission to view and write its data.</em></p>\n</blockquote>\n\n<p>This is my code:</p>\n\n<pre><code>string excelConnectionString = @\"provider=Microsoft.ACE.OLEDB.12.0;data source=\" + path + \";extended properties='Excel 12.0;HDR=YES;'\";\n\n//Create Connection to Excel work book\nOleDbConnection excelConnection =new OleDbConnection(excelConnectionString);\n//Create OleDbCommand to fetch data from Excel\nOleDbCommand cmd = new OleDbCommand(\"Select [ID],[Name],[Designation] from [Sheet1$]\",excelConnection);\nexcelConnection.Open();\nOleDbDataReader dReader;\ndReader = cmd.ExecuteReader();\nSqlBulkCopy sqlBulk = new SqlBulkCopy(strConnection);\n//Give your Destination table name\nsqlBulk.DestinationTableName = \"Excel_table\";\nsqlBulk.WriteToServer(dReader);\nexcelConnection.Close();\n</code></pre>\n\n<p>and thanks in advance ...</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":13175703,"title":"SQL : How to Delete Rows; when defending WHERE from another table with Multiply Returns","body":"<h2>Query</h2>\n\n<pre><code>    DELETE FROM TEMPSchedules \n           WHERE StudentID = ( Select StudentID \n                               From Students \n                               Where Ref = 'H1007')\n</code></pre>\n\n<h2>Error Message</h2>\n\n<blockquote>\n  <p>Subquery returned more than 1 value. This is not permitted when the\n  subquery follows =, !=, &lt;, &lt;= , >, >= or when the subquery is used as\n  an expression.</p>\n</blockquote>\n\n<h2>Problem</h2>\n\n<p>Now the problem is that each Ref Group has more than 1 Student attached to it. So how should I deal with this.\nThanks</p>\n"},{"tags":["sql","sql-server","recursion","performance"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1469,"score":1,"question_id":1224623,"title":"WITH Common Table Expression vs. CREATE VIEW performance","body":"<p>I have several queries that use a WITH clause, or Common Table Expression, with a UNION ALL statement to recur through a table with a tree like structure in SQL server as described <a href=\"http://www.webinade.com/web-development/creating-recursive-sql-calls-for-tables-with-parent-child-relationships\" rel=\"nofollow\">here</a>.  Would I see a difference in performance if I were to CREATE that same VIEW instead of including it with the WITH clause and having it generated every time I run the query?  Would it generally be considered good practice to actually CREATE the view since it is used in several queries?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":13173372,"title":"How to select one record at a time without using cursor?","body":"<p>I have two tables in SQL SERVER.</p>\n\n<p>DBO.VitalPatientDetails=></p>\n\n<p>| PatientDetailsId | PatientId | PatientName | UnitName | BedName | PatientDOB | LastAlarmReceivedAt |</p>\n\n<p>DBO.VitalAlarmDetails=></p>\n\n<p>| Id | PatientDetailsId (Refers VitalPatientDetails.PatientDetailsId) | VitalGenerationTime | FileName | </p>\n\n<p>I need to retrive all fields of DBO.VitalAlarmDetails grouped by PatientDetailsId ordered by VitalGenerationTime in ascending order.\nI have written cursor for this as below and it is returning multiple result sets. I need to get it in single set without using cursor. I just want to know whether I can do this without cursor.</p>\n\n<pre><code>DECLARE @PatientDetailsId BIGINT\nDECLARE @getAlarmDetails CURSOR\n\nSET @getAlarmDetails = CURSOR FOR SELECT PatientDetailsId FROM VitalPatientDetails\n\nOPEN @getAlarmDetails\n    FETCH NEXT FROM @getAlarmDetails INTO @PatientDetailsId\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        SELECT * FROM VitalAlarmDetails\n        WHERE PatientDetailsId = @PatientDetailsId\n        ORDER BY VitalGenerationTime ASC\n\n        FETCH NEXT FROM @getAlarmDetails INTO @PatientDetailsId\n    END\nCLOSE @getAlarmDetails\nDEALLOCATE @getAlarmDetails\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","command-line","installation"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3437,"score":1,"question_id":696846,"title":"sql server 2005 command line install error ADD_LOCAL property already installed","body":"<p>I have a silent installation of SQL Server 2005 that works great when installing SQL Server on a machine that does not have it already installed.  I use the following parameters when I perform the installation:</p>\n\n<pre><code>#define SQL_SILENT                    \"/passive /qb\"\n#define SQL_USERNAME                  \"username=MyUserName\"\n#define SQL_COMPANYNAME               \"companyname=MyCompanyName\"\n#define SQL_ADDLOCAL                  \"ADDLOCAL=SQL_Engine\"\n#define SQL_UPGRADE                   \"\"\n#define SQL_DISABLENETWORKPROTOCOLS   \"disablenetworkprotocols=0\"\n#define SQL_INSTANCENAME              \"instancename=MYSQLINSTANCE\"\n#define SQL_SQLAUTOSTART              \"SQLAUTOSTART=1\"\n#define SQL_SECURITYMODE              \"SECURITYMODE=SQL\"\n#define SQL_SAPWD                     \"SAPWD=StrongPassword\"\n#define SQL_SQLACCOUNT                \"SQLACCOUNT=\"\"\"\"\"\n#define SQL_SQLPASSWORD               \"SQLPASSWORD=\"\"\"\"\"\n</code></pre>\n\n<p>It installs the instance of SQL Server Express without a problem.  However, when I attempt to install SQL Server on a machine that already has another instance with components I get the following error:</p>\n\n<p>*\"A component that you have specified in the ADD_LOCAL property is already installed.  To upgrade the existing component, refer to the template.ini and set the UPGRADE property to the name of the component.\"*</p>\n\n<p>I have also tried using the UPGRADE method as per the error message </p>\n\n<pre><code>#define SQL_UPGRADE       \"UPGRADE=SQL_Engine INSTANCENAME=MYSQLINSTANCE\"\n</code></pre>\n\n<p>but get the following error:</p>\n\n<p><em>\"SQL Server Setup cannot perform the upgrade because the component is not installed on the computer.  To proceed, verify the component to be upgraded in currently installed, and that the component to be upgraded is specified in the ADDLOCAL property.\"</em></p>\n\n<p>Does anyone have any suggestions?</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server","sql-server-2008","sql-management-studio"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13175025,"title":"Closing Management Studio Query - Sleeping Process","body":"<p>When I close a query (after running it) in Management Studio SQL2008 R2, the processes remain as \"sleeping\", \"AWAITING COMMAND\". I have to manually kill them to get exclusive access. This is on my dev machine. Any idea why closing the window isn't closing the connection?</p>\n"},{"tags":["c#","sql-server","stored-procedures","guid","optional-parameters"],"answer_count":6,"favorite_count":1,"up_vote_count":9,"down_vote_count":0,"view_count":225,"score":9,"question_id":12585675,"title":"How to declare a nullable guid as an optional parameter for a C# CLR stored procedure with SQL Server","body":"<p>I'm writing a C# stored procedure which is deployed on SQL Server 2008 R2 (so .Net 3.5) and want to declare an optional parameter as a nullable guid.  Here's what I tried first:</p>\n\n<pre><code>[Microsoft.SqlServer.Server.SqlProcedure]\npublic static void spCalcPerc(\n     SqlGuid pID\n    , SqlGuid sID = DBNull.Value\n    )\n</code></pre>\n\n<p>This failed with the compile time error: </p>\n\n<blockquote>\n  <p><em>Default parameter value for 'sID' must be a compile-time constant</em></p>\n</blockquote>\n\n<p>which is because <code>DBNull.Value</code> is not a constant, which is a pain.</p>\n\n<p>So I tried changing the declaration to:</p>\n\n<pre><code>[Microsoft.SqlServer.Server.SqlProcedure]\npublic static void spCalcPerc(\n     SqlGuid pID\n    , Guid? sID = null\n    )\n</code></pre>\n\n<p>This compiles but now I get this deployment error: </p>\n\n<blockquote>\n  <p><em>Deploy error : Could not create a type for parameter System.Nullable</em></p>\n</blockquote>\n\n<p>Trying:</p>\n\n<pre><code>, SqlGuid sID = null\n</code></pre>\n\n<p>Gives this compile time error: </p>\n\n<blockquote>\n  <p><em>A value of type '&lt; null >' cannot be used as a default parameter because there are no standard conversions to type\n  'System.Data.SqlTypes.SqlGuid'</em></p>\n</blockquote>\n\n<p>So feeling rather stuck I resorted to this:</p>\n\n<pre><code>, SqlGuid sID = \"00000000-0000-0000-0000-000000000000\"\n</code></pre>\n\n<p>Which I didn't want to do as testing for that string in the code feels like a kludge.  However that doesn't work either as I get this compile error: </p>\n\n<blockquote>\n  <p><em>A value of type 'string' cannot be used as a default parameter because there are no standard conversions to type 'System.Guid'</em></p>\n</blockquote>\n\n<p>Gah, 4 different approaches and none of them work.  <em>sigh</em></p>\n\n<p>Would appreciate your thoughts or a push in the right direction please.  </p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":12002,"score":5,"question_id":5856073,"title":"for each in MS SQL SERVER?","body":"<p>I have two tables:</p>\n\n<p><code>Employees(EmployeeID, EmployeeName, EmployeeStatus, BasicSalary)</code> and </p>\n\n<p><code>EmployeePayroll (PayrollID, EmployeeID, VoucherNo, BasicSalary, SalaryMonth)</code></p>\n\n<p>I want to make a <code>for each</code> loop for every employee in the first table so that I can insert dummy data like <code>(0, EmployeeID,0 ,0 ,0)</code> into the second table.</p>\n\n<p>I tried to make it with a <code>for</code> loop but I could not make it, so is there a <code>for each</code> loop in MS SQL Server??</p>\n"},{"tags":["sql","sql-server","ssis","lookup","data-warehouse"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":92,"score":5,"question_id":13169613,"title":"SQL/SSIS DataWareHouse Fact table loading, best practices?","body":"<p>I am building my first datawarehouse in SQL 2008/SSIS and I am looking for some best practices around loading the fact tables.</p>\n\n<p>Currently in my DW I have about 20 Dimensions (Offices, Employees, Products, Customer, etc.) that are of Type 1 SCD. In my dw structure, there are a few things I have already applied:</p>\n\n<ul>\n<li>No Nulls (replaced with blank for text or 0 for numeric during staging)</li>\n<li>unknown key members populated in each dimension (SK ID 0)</li>\n<li>UPSERT for SCD Type 1 loading from stage to production table</li>\n<li>SELECT DISTINCT for my loading of dimensions</li>\n</ul>\n\n<p>In my Fact loading SSIS project, the current method I have for loading dimensions is having multiple lookups (20+) to each of the DIMs, then populating the FACT table with the data.</p>\n\n<p>For my lookups I set:</p>\n\n<ul>\n<li>Full Cache</li>\n<li>Ignore Failures for \"no matching entries\"</li>\n<li>Derived Transformation with \"ISNULL(surrogate_idkey) ? 0 : surrogate_idkey\" for each SK so that if lookups fail they will default to the SK ID 0 (unknown member).</li>\n<li>Some of my dimension lookups have more than one business key</li>\n</ul>\n\n<p>Is this the best approach? Pictures attached to help with my description above.</p>\n\n<p><img src=\"http://i.stack.imgur.com/6NHSQ.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/JWjyc.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/3QQ71.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","search","full-text-search"],"answer_count":5,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":1333,"score":6,"question_id":17056,"title":"SQL Server Full Text Searching","body":"<p>I'm currently working on an application where we have a SQL-Server database and I need to get a full text search working that allows us to search people's names.</p>\n\n<p>Currently the user can enter a into a name field that searches 3 different varchar cols. First, Last, Middle names</p>\n\n<p>So say I have 3 rows with the following info.</p>\n\n<p>1 - Phillip - J - Fry</p>\n\n<p>2 - Amy - NULL - Wong</p>\n\n<p>3 - Leo - NULL - Wong</p>\n\n<p>If the user enters a name such as 'Fry' it will return row 1. However if they enter Phillip Fry, or Fr, or Phil they get nothing.. and I don't understand why its doing this. If they search for Wong they get rows 2 and 3 if they search for Amy Wong they again get nothing.</p>\n\n<p>Currently the query is using CONTAINSTABLE but I have switched that with FREETEXTTABLE, CONTAINS, and FREETEXT without any noticeable differences in the results. The table methods are be preferred because they return the same results but with ranking.</p>\n\n<p>Here is the query.</p>\n\n<pre><code>....\n@Name nvarchar(100),\n....\n--\"\"s added to prevent crash if searching on more then one word.\nDECLARE @SearchString varchar(100)\nSET @SearchString = '\"'+@Name+'\"'\nSELECT Per.Lastname, Per.Firstname, Per.MiddleName\nFROM Person as Per\nINNER JOIN CONTAINSTABLE(Person, (LastName, Firstname, MiddleName), @SearchString) \nAS KEYTBL\nON Per.Person_ID = KEYTBL.[KEY]\nWHERE KEY_TBL.RANK &gt; 2\nORDER BY KEYTBL.RANK DESC;  \n....\n</code></pre>\n\n<p>Any Ideas...? Why this full text search is not working correctly ?</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":165,"score":0,"question_id":11077162,"title":"SQL Server stored procedure avoid cursor","body":"<p>I have the following SQL Server stored procedure :</p>\n\n<pre><code>BEGIN TRAN\nCREATE TABLE #TempTable (\n                            SampleOrderID int,\n                            SampleOrderNo varchar(512),\n                            ChallanNoAndChallanDate varchar(MAX)\n                        )\nCREATE NONCLUSTERED INDEX #IX_Temp2_1 ON #TempTable(SampleOrderID)\n\nDECLARE \n@SQL as varchar(MAX)\nSET @SQL='      SELECT  SampleOrderID,  SampleOrderNo FROM SampleOrder WHERE SampleOrderID IN (37808,37805,37767,37571,37745,37772,37843,37394,37909,37905,37903) '\nINSERT INTO #TempTable  (SampleOrderID, SampleOrderNo)\nEXEC (@SQL)\n\nDECLARE \n@SampleOrderID as int,\n@ChallanNoAndChallanDate as varchar(max)\n\nDECLARE Cur_AB1 CURSOR GLOBAL FORWARD_ONLY KEYSET FOR           \nSELECT  SampleOrderID FROM #TempTable\nOPEN Cur_AB1\nFETCH NEXT FROM Cur_AB1 INTO @SampleOrderID\nWHILE(@@Fetch_Status &lt;&gt; -1)\n    BEGIN--2\n        SET @ChallanNoAndChallanDate=''\n        SELECT @ChallanNoAndChallanDate= COALESCE(@ChallanNoAndChallanDate+ ',', '') + CONVERT(VARCHAR(12),ChallanDate,106)+':'+ChallanNo  FROM Challan WHERE OrderID =@SampleOrderID AND OrderType=2\n\n        UPDATE #TempTable SET ChallanNoAndChallanDate=@ChallanNoAndChallanDate WHERE SampleOrderID=@SampleOrderID   \n        FETCH NEXT FROM Cur_AB1 INTO @SampleOrderID\n    END--2\nCLOSE Cur_AB1\nDEALLOCATE Cur_AB1\n\nSELECT * FROM #TempTable\nDROP TABLE #TempTable\nCOMMIT TRAN \n</code></pre>\n\n<p>Output :</p>\n\n<pre><code>SamID       SamNo    ChallanNoAndDaet\n37394   37394   ,31 May 2012:151592\n37571   37571   ,31 May 2012:151580\n37745   37745   ,31 May 2012:151582\n37767   37767   ,30 May 2012:151507,31 May 2012:151576\n37772   37772   ,31 May 2012:151587\n37805   37805   ,31 May 2012:151574\n37808   37808   ,31 May 2012:151573\n37843   37843   ,31 May 2012:151588\n37903   37903   ,31 May 2012:151597\n37905   37905   ,31 May 2012:151596\n37909   37909   ,31 May 2012:151593\n</code></pre>\n\n<p>It works successfully for small volume of data but When i try to execute it on a Large volume (i.e. more then 500,000 record) my C# interface throws the time out exception.</p>\n\n<p>Can anyone help me edit my stored procedure to avoid the cursor? </p>\n\n<p>Thanks for response. </p>\n"},{"tags":["sql-server","entity-framework","entity-framework-4","nopcommerce"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":12057458,"title":"Is it possible to limit number of connections used by Entity Framework?","body":"<p>I've noticed that on a NopCommerce site we host (which uses Entity Framework) that if I run a crawler on the site (to check for broken links) it knocks the entire webserver offline for a few minutes and no other hosted sites respond. This seems to be because Entity Framework is opening 30-odd database connections and runs hundreds of queries per second (about 20-40 per page view).</p>\n\n<p>I cannot change how EF is used by NopCommerce (it would take weeks) or change the version of EF being used, so can I mitigate the effects it has on SQL Server by limiting how many concurrent connections it uses, to give other sites hosted on the same server a fairer chance at database access?</p>\n\n<p>What I'm ideally looking to do, is limit the number of concurrent DB connections to about 10, for a particular application.</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":76,"score":0,"question_id":13174129,"title":"sum function using subquery","body":"<p>I have three tables:</p>\n\n<p><strong>Customer</strong></p>\n\n<pre><code>customer_id   first_name\n1              kapil\n2              rajesh\n</code></pre>\n\n<p><strong>Account</strong></p>\n\n<pre><code>Customer_id     Account_id\n1                   S1\n2                   s2\n</code></pre>\n\n<p><strong>Receipt</strong></p>\n\n<pre><code>Recipt_id   customer_id   Account_id   Transaction_type   Amount\nR1            1              s1         Deposit           40000\nR2            2              s2         Deposit             300\nR3            1              s1         withdrawal         2000\n</code></pre>\n\n<p>now i am putting query as follow </p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>select   \n    c.customer_id,c.first_name,s.current_balance,s.account_id,\n    (select sum(amount) \n    from receipt as r ,\n        saving_account as s \n    where r.transaction_type='deposit'\n        and r.account_no = s.account_id\n    ) as debit,\n    (select sum(amount) \n    from receipt as r ,\n        saving_account as s\n    where r.transaction_type='withdrawl'\n        and r.account_no = s.account_id  \n    )as credit \nfrom customer as c \nleft outer join saving_account as s \ninner join receipt as r on r.customer_id = s.customer_id \non s.customer_id = c.customer_id \ngroup by c.customer_id\n</code></pre>\n\n<p>but it is giving me debit a single value for whole row and credit tooo\ni am not understanding why it is showing like that ....</p>\n\n<p>My desired result is:</p>\n\n<pre><code>customer_id customer_name account_id debit credit balance\n1           kapil         s1         40000   2000  200\n2           rajesh        s2         300     null  500\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13173615,"title":"Normalizing values in SQL query","body":"<p>I have an data table I wish to perform some numeric analysis on for that I need all the values to be in the same range. 0..1.</p>\n\n<p>I have a somewhat slow and longhanded way of accomplishing this but would like a more straigt forward performant solution to my problem</p>\n\n<p>What I need to do is:</p>\n\n<p>group by projectid\nwith in each project take the average of each of the values and divide by the largest average for the entire set.</p>\n\n<p>currently I have</p>\n\n<pre><code>select avg(foo * 1.0)/ (Select MAX(IL) FROM (select avg(foo * 1.0) as IL from table group by     \n                                             ProjectID) tbl)\nfrom table\n</code></pre>\n\n<p>so if the list is</p>\n\n<pre><code>projectid  | foo\n-----------------\n1          | 1\n1          | 2\n2          | 4\n2          | 2\n</code></pre>\n\n<p>the largest average is 3 and the result should therefor be</p>\n\n<p>0.5,1</p>\n\n<p>where the first is the average for projectId 1 divided by 3 and the second is the average for projectId 2 divided by 3</p>\n"},{"tags":["sql-server","sql-server-2008","unique-constraint"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":25,"score":2,"question_id":13173787,"title":"SQL Server : Unique constraint to verify that data does not exist in another table","body":"<p>Given that I have a table structure where I have a parent that can have \"Roles\" and that parent have children that can have the same \"Roles\", how can I create a constraint on the child table that verifies that the parent does not have the Role that is about to be inserted?</p>\n\n<p>Like this:</p>\n\n<pre><code>Parent\n |\n \\- ParentRoles\n |\n \\- Child\n    |\n    \\- ChildRoles\n</code></pre>\n\n<p>I want the union of the Child and Parent roles to be a list of unique roles (no duplicates).</p>\n\n<p>I have checked <a href=\"http://stackoverflow.com/questions/3200795/sql-server-check-constraint-on-a-column-where-values-come-from-another-table\">Constraint by UserFunction</a> (not recommended but would work) and tried creating a view with an unique index but ran into trouble because I have to use Union in the view and then I cannot index it.</p>\n\n<p>An answer on the <a href=\"http://stackoverflow.com/questions/3200795/sql-server-check-constraint-on-a-column-where-values-come-from-another-table\">Constraint by UserFunction</a> question suggests using Foreign Keys but I do not understand how I could make that work given my table structure.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":38,"score":4,"question_id":13173921,"title":"Why is T-SQL EXEC not returning decimals?","body":"<p>I have a simple query that I've turned into a stored proc:</p>\n\n<pre><code>create procedure GetAmount as\ndeclare @amnt decimal(25,2)\n\nselect @amnt=66666.67 \nset @amnt = @amnt/3.00\n\nprint @amnt\nreturn @amnt\n</code></pre>\n\n<p>If I print @amnt, it returns 22222.22</p>\n\n<p>But if I use EXEC and assign it to a variable:</p>\n\n<pre><code>declare @x numeric(25,2)\nexec @x=SP_GetAmount()\nprint @x\n</code></pre>\n\n<p>it returns 22222.00</p>\n\n<p>Anyone know why? </p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13169764,"title":"Trigger on Audit Table failing due to update conflict","body":"<p>I have a number of tables that get updated through my app which return a lot of data or are difficult to query for changes. To get around this problem, I have created a \"LastUpdated\" table with a single row and have a trigger on these complex tables which just sets GetDate() against the appropriate column in the LastUpdated table:</p>\n\n<pre><code>CREATE TRIGGER [dbo].[trg_ListItem_LastUpdated] ON [dbo].[tblListItem] \nFOR INSERT, UPDATE, DELETE \nAS\nUPDATE LastUpdated SET ListItems = GetDate()\nGO\n</code></pre>\n\n<p>This way, the clients only have to query this table for the last updated value and then can decided whether or not they need to refresh their data from the complex tables. The complex tables are using snapshot isolation to prevent dirty reads.</p>\n\n<p>In busy systems, around once a day we are getting errors writing or updating data in the complex tables due to update conflicts in \"LastUpdated\". Because this occurs in the statement executed by the trigger, the affected complex table fails to save data. The following error is logged:</p>\n\n<blockquote>\n  <p>Snapshot isolation transaction aborted due to update conflict. You\n  cannot use snapshot isolation to access table 'dbo.tblLastUpdated'\n  directly or indirectly in database 'devDB' to update, delete, or\n  insert the row that has been modified or deleted by another\n  transaction. Retry the transaction or change the isolation level for\n  the update/delete statement.</p>\n</blockquote>\n\n<p>What should I be doing here in the trigger to prevent this failure? Can I use some kind of query hints on the trigger to avoid this  - or can I just ignore errors in the trigger? Updating the data in LastUpdated is not critical, but saving the data correctly into the complex tables is.</p>\n\n<p>This is probably something very simple that I have overlooked or am not aware of. As always, thanks for any info.</p>\n"},{"tags":["sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":183,"score":1,"question_id":12213271,"title":"SQL query to find out third highest salary involving multiple tables","body":"<p>I have two tables..</p>\n\n<p>Persons:</p>\n\n<pre><code>empid(primary key)\nfirstname\nlastname\nemail\n</code></pre>\n\n<p>Details:</p>\n\n<pre><code>Did(primary key)\nsalary\ndesignation\nempid\n</code></pre>\n\n<p>Now I want to select <code>firstname</code>, <code>lastname</code>, <code>salary</code> of the employee with the 3rd highest salary. </p>\n\n<p>Also it would be great if you can suggest me a site where I can find SQL query exercises with solutions (I do not need an online interpreter, I have SQL Server 2008 to practice on ), I have completed w3schools (which was awesome) but I need exercises now, I tried sql.ex.ru but it was not that helpful. </p>\n"},{"tags":["sql","sql-server","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13173585,"title":"How to check if a field is updated when inserting from table to table?","body":"<p>I have the following data inserted from TableA to TableB. I'm inserting the data from TableA to TableB using a query that automatically runs every 4 hours. The query contains a insert, update and a delete.</p>\n\n<blockquote>\n  <p>Date_<strong><em>_</em>__<em>_</em>_</strong><em>Group  <strong></em>____</strong><em>State  <strong></em>___</strong><em>BeginTime  <strong></em>___</strong><em>EndTime<br>\n  2012-11-1 <strong></em>_</strong><em>A  <strong></em>__<em>_</em>__<em>_</em>__</strong><em>1     <strong></em>__<em>_</em>____</strong><em>08:00   <strong></em>__<em>_</em>___</strong>_16:00</p>\n</blockquote>\n\n<p>The application that uses TableB can also change the field State but I need to check if this is changed by the application. There is no any attribute how I can check this.</p>\n\n<p>I tried to create a new column 'FromTableA' (bit) into TableB to hold a state that means, this data coming from TableA. But when the application changes the state, the attribute FromTableA stays TRUE so I can't check this.</p>\n\n<p>Any ideas to solve the problem, using just a query? Changes in the application are not allowed.</p>\n"},{"tags":["sql-server","database","sqlite","synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":160,"score":0,"question_id":11619945,"title":"Microsoft Sync Framework Toolkit non MS synchronization","body":"<p>I am thinking about using the MS Sync Framework Toolkit to sync mobile database subsets of data to the cloud.  I will be using Android and iOS, and I only need to sync their individual local copies of the SQLite DB to the cloud.</p>\n\n<p>How well does MS Sync Framework handle filtering and data subsets, and how well does it run on non-windows based platforms, mainly Java/Android and iOS?  The mobile environments use SQLLite and the cloud is Microsoft based.  Thanks for the insight.</p>\n"},{"tags":["sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13173258,"title":"How do I build a query that crosses multiple tables?","body":"<p>Here are my tables:</p>\n\n<p><strong>CUSTOMER</strong></p>\n\n<pre><code>Cust_ID (PK)\nName\n</code></pre>\n\n<p><strong>ORDERS</strong></p>\n\n<pre><code>Order_ID (PK)\nCust_ID (FK)\n</code></pre>\n\n<p><strong>ORDER_LINE</strong></p>\n\n<pre><code>Order_ID (pk)\nPart_ID (FK)\n</code></pre>\n\n<p><strong>PART</strong></p>\n\n<pre><code>Part_ID (PK)\nPart_Description\n</code></pre>\n\n<p>Now I want to list the customer details, the part number and the description of the parts that each customer ordered.</p>\n\n<p>How do i do this?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":9,"favorite_count":2,"up_vote_count":6,"down_vote_count":1,"view_count":19041,"score":5,"question_id":358542,"title":"How to find fifth highest salary in a single query in SQL Server","body":"<p>How to find fifth highest salary in a single query in SQL Server</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13171931,"title":"family tree sql query","body":"<p>I am working on Family tree application in asp.net with sql server 2008.</p>\n\n<p>My main table is like this:-</p>\n\n<pre><code>ID int PK\nName Varchar(50)\nMotherID int\nFatherID int\n\nID  MotherID FatherID   Name\n\n1   NULL    NULL    My Grand Father\n\n2   NULL    NULL    My Grand Mother\n\n3   someid  someid  My Mother\n\n4   2   1   My Father\n\n5   3   4   Me\n\n6   someid  someid  My wife\n\n7   3   4   My Brother\n\n8   6   5   My son.\n</code></pre>\n\n<p>I am looking for output like this</p>\n\n<pre><code>ID  MotherID    FatherID    Name        Level\n\n1   someid  someid  grandfather 0\n\n\n2   someid  someid  Father      1\n\n3   someid  someid  Me      2\n\n\n4   someid  someid  Brother     2\n\n5   someid  someid  My Son      3\n</code></pre>\n\n<p>Thanks in advance.\nKashmir.</p>\n"},{"tags":["sql-server","switch-statement"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13172905,"title":"Getting a Error in Switch Statement in SQL","body":"<p>I am using SWITCH Statement in SP under Where Clause.Query Seems to be fine but i am unable to understand why it is giving me the error.\nQuery is:</p>\n\n<pre><code>Select * from Customer\nWHERE  (I.IsClose=@ISClose OR @ISClose is NULL)  \nAND    \n(C.FirstName like '%'+@ClientName+'%' or @ClientName is NULL )    \nAND \n CASE @abc\n         WHEN 2 THEN I.RecurringCharge=@Total or @Total is NULL\n         WHEN 3 THEN I.RecurringCharge like \n                               '%'+cast(@Total as varchar(50))+'%' \n                     or @Total is NULL \n     END\n</code></pre>\n\n<p>The code is incomplete but sufficient to understand the problem.I am getting Below Error Message when trying to compile it.</p>\n\n<pre><code>Incorrect syntax near '='.\n</code></pre>\n\n<p>The Error is on following line.</p>\n\n<pre><code>WHEN 2 THEN I.RecurringCharge=@Total or @Total is NULL\n</code></pre>\n\n<p>Please help me experts.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":185,"score":2,"question_id":11225491,"title":"Select one row from multiple row in sql depands on condition","body":"<p>I have a table in sql 2008 named tblEmployeeAttendance like \n<img src=\"http://i.stack.imgur.com/cw9SU.jpg\" alt=\"enter image description here\"></p>\n\n<p>Here is some dummy data for a employee's one days attendance like</p>\n\n<p><img src=\"http://i.stack.imgur.com/P6puo.jpg\" alt=\"enter image description here\"></p>\n\n<p>Here AI refers AttendanceIn,AO refers AttendanceOut,BO refers BreakIn and BI refers BreakOut.There can multiple row in a day for a employee.First row should be AI,last row should be AO and others rows will be BreakIn,BreakOut Sequentially(that means BreakIn-BreakOut-BreakIn.....).</p>\n\n<p>My expected output would be like this</p>\n\n<p><img src=\"http://i.stack.imgur.com/SfrKP.jpg\" alt=\"enter image description here\"></p>\n\n<p>I need a sql query that will return one row per date and return data that must contain AttendanceIn and AttendanceOut Time depands on strRemark(AI &amp; AO). Please help me.</p>\n"},{"tags":["c#","asp.net","sql","sql-server","ado.net"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13172423,"title":"How to compare excel value using asp.net SqlBulkCopy?","body":"<p>I am importing an Excel sheet into a SQL Server database. The Excel sheet contains 3 columns </p>\n\n<pre><code>id|data|passport\n</code></pre>\n\n<p>I am using <code>SqlBulkCopy</code> </p>\n\n<pre><code>SqlConnection con = new SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings[\"constr\"].ConnectionString);\n\n    string[] filePaths = null;\n    string strFileType = null;\n    string strFileName = null;\n    string strNewPath = null;\n    int fileSize;\n    int flag=0;\n\n    protected void Page_Load(object sender, EventArgs e)\n    {\n    }\n\n    protected void Button1_Click1(object sender, EventArgs e)\n    {\n        strFileType = System.IO.Path.GetExtension(FileUpload1.FileName).ToString().ToLower();\n        strFileName = FileUpload1.PostedFile.FileName.ToString();\n        FileUpload1.SaveAs(Server.MapPath(\"~/Import/\" + strFileName + strFileType));\n        strNewPath = Server.MapPath(\"~/Import/\" + strFileName + strFileType);\n        fileSize = FileUpload1.PostedFile.ContentLength / 1024;\n\n        //EXCEL DETAILS TABLE\n        con.Open();\n        //=========================================\n        DataTable dt8 = new DataTable();\n        SqlCommand cmd8 = new SqlCommand(\"insert into exceldetails (name,type,details,size)\" + \"values(@name,@type,@details,@size)\", con);\n        cmd8.Parameters.Add(\"@name\", SqlDbType.VarChar).Value = strFileName;\n        cmd8.Parameters.Add(\"@type\", SqlDbType.VarChar).Value = strFileType;\n        cmd8.Parameters.Add(\"@details\", SqlDbType.VarChar).Value = DateTime.Now;\n        cmd8.Parameters.Add(\"@size\", SqlDbType.Int).Value = fileSize;\n        cmd8.ExecuteNonQuery();\n        con.Close();\n        try\n        {\n            SqlDataAdapter da8 = new SqlDataAdapter(cmd8);\n            da8.Fill(dt8);\n        }\n        catch { }\n        //=========================================\n\n        //CHOOSING EXCEL CONNECTIONSTRING\n\n        string excelConnectionString = \"\";\n        switch (strFileType)\n        {\n            case \".xls\":\n\n                excelConnectionString = String.Format(@\"Provider=Microsoft.Jet.OLEDB.4.0;\" + \"Data Source=\" + strNewPath + \"; Extended Properties=Excel 8.0;\");\n                break;\n            case \".xlsx\":\n                {\n                    excelConnectionString = String.Format(@\"Provider=Microsoft.ACE.OLEDB.12.0;\" + \"Data Source=\" + strNewPath + \"; Extended Properties=Excel 12.0 Xml;\");\n\n                    break;\n                }\n        }\n\n        //===================================\n        //PRE EXCEL COUNT\n\n        // Create Connection to Excel Workbook\n        using (OleDbConnection connection = new OleDbConnection(excelConnectionString))\n        {\n            connection.Open();\n            OleDbCommand command = new OleDbCommand(\"Select ID,Data,passport FROM [Sheet1$]\", connection);\n            OleDbCommand command1 = new OleDbCommand(\"select count(*) from [Sheet1$]\", connection);\n\n            //Sql Server Table DataTable\n            DataTable dt4 = new DataTable();\n            SqlCommand cmd4 = new SqlCommand(\"select * from excelsheet\", con);\n            try\n            {\n                SqlDataAdapter da4 = new SqlDataAdapter(cmd4);\n                da4.Fill(dt4);//sql table datatable\n            }\n            catch { }\n\n            //===============================\n\n            //excelsheet datatable\n            DataTable oltlb = new DataTable();\n            OleDbCommand olcmd = new OleDbCommand(\"select * from [Sheet1$]\", connection);\n            try\n            {\n                OleDbDataAdapter olda = new OleDbDataAdapter(olcmd);\n                olda.Fill(oltlb); //excel table datatable\n            }\n            catch { }\n\n            //==============================\n\n\n            using (DbDataReader dr = command.ExecuteReader())\n            {\n                // SQL Server Connection String\n                string sqlConnectionString = \"Data Source=DITSEC3;Initial Catalog=test;Integrated Security=True\";\n\n                con.Open();\n                DataTable dt7 = new DataTable();\n                dt7.Load(dr);\n                DataRow[] ExcelRows = new DataRow[dt7.Rows.Count];\n                DataColumn[] ExcelColumn = new DataColumn[dt7.Columns.Count];\n\n                //=================================================\n                for (int i1 = 0; i1 &lt; ExcelRows.Length; i1++)\n                {\n                    string a = ExcelRows[i1][\"passport\"].ToString();\n                    char a1 = a[0];\n\n                    if (a1 &gt;= 'A' || a1 &lt;= 'Z')\n                    {\n                        Label12.Text = \"CAPITAL\";\n                        break;\n                    }\n                    else\n                    {\n                        Label12.Text = \"notgood\";\n\n\n                        flag = flag + 1;\n\n\n\n                    }\n\n                }\n                //=========================================================\n\n                if (flag == 0)\n                {\n                    using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n                    {\n                        bulkCopy.DestinationTableName = \"ExcelTable\";\n                        dt7.Rows.CopyTo(ExcelRows, 0);\n\n                        //==========================================================================================\n                        for (int i = 0; i &lt; ExcelRows.Length; i++)\n                        {\n                            if (ExcelRows[i][\"passport\"] == DBNull.Value)\n                            {\n                                ExcelRows[i][\"passport\"] = 0;\n                            }\n\n                        }\n                        bulkCopy.WriteToServer(ExcelRows);\n                        //==========================================================================================\n                        for (int i = 0; i &lt; ExcelRows.Length; i++)\n                        {\n                            if (ExcelRows[i][\"data\"] == DBNull.Value)\n                            {\n                                // Include any actions to perform if there is no date\n                                //ExcelRows[i][\"data\"] = Convert.ToDateTime(\"0\");\n                            }\n                            else\n                            {\n                                DateTime oldDate = Convert.ToDateTime(ExcelRows[i][\"data\"]).Date;\n                                DateTime newDate = Convert.ToDateTime(oldDate).Date;\n                                ExcelRows[i][\"data\"] = newDate.ToString(\"yyyy/MM/dd\");\n                            }\n\n                        }\n\n                        //==========================================================================================\n                    }\n                    //======\n\n                }\n                else\n                {\n                    Label13.Text = \"Wrong Format\";\n                }\n            }\n\n        }\n    }\n}\n</code></pre>\n\n<p>ERROR AT : </p>\n\n<pre><code>string a = ExcelRows[i1][\"passport\"].ToString();\n</code></pre>\n\n<p>ERROR: </p>\n\n<blockquote>\n  <p><em>Object reference not set to an instance of an object.</em></p>\n</blockquote>\n"},{"tags":["c#","asp.net","sql-server","excel"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13154009,"title":"How can i compare the values of excel cell values while using SqlBulkCopy?","body":"<p>I am importing Excelsheet into sql server database i need to check certain things before importing the sheet, such as  i have a column called passport which must have values starting with alphabet only and must have rest of the characters as numbers (only). </p>\n\n<pre><code>   DataTable dt7 = new DataTable();\n            dt7.Load(dr);\n            DataRow[] ExcelRows = new DataRow[dt7.Rows.Count];\n            // Bulk Copy to SQL Server\n\n            using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n            {\n                bulkCopy.DestinationTableName = \"ExcelTable\";\n                dt7.Rows.CopyTo(ExcelRows, 0);\n\n                for (int i = 0; i &lt; ExcelRows.Length; i++)\n                {\n                    if (ExcelRows[i][\"data\"] == DBNull.Value)\n                    {\n                        // Include any actions to perform if there is no date\n                        //ExcelRows[i][\"data\"] = Convert.ToString(0);\n                    }\n                    else\n                    {\n                        DateTime oldDate = Convert.ToDateTime(ExcelRows[i][\"data\"]).Date;\n                        DateTime newDate = Convert.ToDateTime(oldDate).Date;\n                        ExcelRows[i][\"data\"] = newDate.ToString(\"yyyy/MM/dd\");\n                    }\n\n\n\n                }\n                bulkCopy.WriteToServer(ExcelRows);\n</code></pre>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":100,"score":5,"question_id":13158944,"title":"\"Incorrect syntax\" error using OVER()","body":"<p>I have a sales budget for every trading day of the month.  So for day 1 the budget is 300, for day 2 the budget is 400, and then month to date budget is 700.  I get this error in my query:  <code>Incorrect syntax near 'ROWS'.</code></p>\n\n<pre><code>select \nTradingDate\n,Budget\n,sum(Budget) over (PARTITION BY TradingDate\norder by TradingDate asc\nROWS BETWEEN CURRENT ROW AND 1 FOLLOWING),1) AS BudgetMTD\nfrom #4\n</code></pre>\n"},{"tags":["sql","sql-server","vb.net"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12767125,"title":"Fail to run sp_prepare over ADODB from Visual Basic","body":"<p>I can't get the handle value to pass to sp_execute. If I use the SQL code directly with Management Studio I succeed:</p>\n\n<pre><code>Declare @handle Integer\nexec sp_prepare @handle OUTPUT, N'@year int', N'SELECT * from Sales.CreditCard where ExpYear=@year';\n\nselect @handle\n\nexec sp_execute @handle, 2007\nexec sp_unprepare @handle\n</code></pre>\n\n<p>but when I try the following code on VB, \"param3.Value\" is \"nothing\" after the command is executed.</p>\n\n<pre><code>    ConnString = \"DRIVER={SQL Server};SERVER=192.168.100.41,1433;UID=sa;PWD=&lt;password&gt;;DATABASE=AdventureWorks\"\n    'create an instance of the ADO connection\n    Connection = CreateObject(\"ADODB.Connection\")\n\n    'Open the connection to the database\n    Connection.Open(ConnString)\n    Dim cmd As ADODB.Command\n    Dim param1 As ADODB.Parameter\n    Dim param2 As ADODB.Parameter\n    Dim param3 As ADODB.Parameter\n\n    cmd = CreateObject(\"ADODB.Command\")\n    cmd.ActiveConnection = Connection\n    cmd.CommandText = \"sp_prepare\"\n\n    param1 = cmd.CreateParameter(\"@handle\", 3, 2, 4, 0)\n    param2 = cmd.CreateParameter(\"@params\", 202, 1, 200, \"@year Integer\")\n    param3 = cmd.CreateParameter(\"stmt\", 202, 1, 200, \"SELECT TOP 4 [CreditCardID],[CardType],[CardNumber],[ModifiedDate]  FROM [AdventureWorks].[Sales].[CreditCard] where [ExpYear] in (@year)\")\n\n    cmd.Parameters.Append(param1)\n    cmd.Parameters.Append(param2)\n    cmd.Parameters.Append(param3)\n\n    cmd.Execute()\n\n    Debug.WriteLine(\"handle:\" &amp; param1.Value)\n</code></pre>\n\n<p>Do you know how to make it work on VB?\nThe reason I run this from VB is that I need the command to be run over RPC.</p>\n"},{"tags":["c#","sql-server","stored-procedures","sqlparameter"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":230,"score":4,"question_id":5873731,"title":"Is there a way to determine if a parameter in a stored proc has a default value (and thus not required) in code - .Net?","body":"<p>I am already pulling the parameters from the stored proc sent in like this:</p>\n\n<pre><code> foreach (SqlParameter param in cmd.Parameters)\n            {\n               if ((param.Direction == ParameterDirection.Input) || (param.Direction == ParameterDirection.InputOutput))\n                {\n                    jsonReturn += \"{\\\"paramName\\\":\\\"\" + param.ParameterName + \"\\\", \\\"paramType\\\":\\\"\" + param.SqlDbType.ToString() + \"\\\"},\";\n                }\n            }\n</code></pre>\n\n<p>I looked into the SqlParameter object and could not find a way to see if it could tell me whether the Parameter had a default value... (although my debugger is acting weird, so who knows).</p>\n\n<p>What I am doing is building a sort of Stored Proc helper for users..  I currently tell them all the parameters that belong to the Stored Proc they pick.... I WOULD REALLY like to be able to tell whether they are required.  </p>\n"},{"tags":["sql-server","stored-procedures","if-statement","where-clause"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":68,"score":4,"question_id":13171748,"title":"How to use If Statement in Where Clause in SQL?","body":"<p>I need to use if statement inside where clause in sql.</p>\n\n<pre><code>Select * from Customer\nWHERE  (I.IsClose=@ISClose OR @ISClose is NULL)  \nAND    \n(C.FirstName like '%'+@ClientName+'%' or @ClientName is NULL )    \nAND \n if (@Value=2)\n  begin\n  (I.RecurringCharge=@Total  or @Total is NULL )    \n  end\n else if(@Value=3)\nbegin\n(I.RecurringCharge like '%'+cast(@Total as varchar(50))+'%' or @Total is NULL )  \nend\n</code></pre>\n\n<p>Note:This is not the complete code.Everything is defined in SP.I Just written the code that was needed to understand the issue.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13171335,"title":"Computer Column with Current DateTime?","body":"<p>I am trying to create a SQL Server 2008R2 Table column with automatically calculated current datetime for every row I insert.</p>\n\n<p>I set Computed Column Specification value for this column equals to GetDate(). My table had some old data in it. After adding GetDate() function, the column get updated with current datetime. But my problem is, When i insert new row in this table, my datetime column never get updated with current date time and this column have same value for each row.</p>\n\n<p>Which function should I use to insert current datetime value for column when I insert a new record?</p>\n\n<p>Thanks,</p>\n"},{"tags":["sql-server","stored-procedures","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":201,"score":1,"question_id":11531352,"title":"How to rollback a transaction in a stored procedure?","body":"<p>Looking at the SQL Server Books Online, Microsoft seems to have an (incorrect) <a href=\"http://msdn.microsoft.com/en-us/library/ms189336%28v=sql.105%29.aspx\" rel=\"nofollow\">method of handling nested transactions in a stored procedure</a>:</p>\n\n<blockquote>\n  <h2>Nesting Transactions</h2>\n  \n  <p>Explicit transactions can be nested. This is primarily intended to support transactions in stored procedures that can be called either from a process already in a transaction or from processes that have no active transaction.</p>\n</blockquote>\n\n<p>The example goes on to show a stored procedure that starts its own transaction <em>(\"The procedure enforces its transaction regardless of the transaction mode of any process that executes it.\")</em>:</p>\n\n<pre><code>CREATE PROCEDURE TransProc @PriKey INT, @CharCol CHAR(3) AS\n   BEGIN TRANSACTION InProc\n      ...\n   COMMIT TRANSACTION InProc;\n</code></pre>\n\n<p>This procedure can then either be called without a transaction running:</p>\n\n<pre><code>EXECUTE TransProc 3,'bbb';\n</code></pre>\n\n<p>Or <strong>with</strong> an explicit transaction:</p>\n\n<pre><code>BEGIN TRANSACTION OutOfProc;\n\nEXEC TransProc 1, 'aaa';\n\nCOMMIT TRANSACTION OutOfProc\n</code></pre>\n\n<p>What they don't address is what happens when the stored produre:</p>\n\n<ul>\n<li>fails with an error, but leaves the transaction running</li>\n<li>fails with an error, but doesn't leave the transaction running</li>\n<li>encounters an error, but continues executing with the transaction open</li>\n<li>encounters an error, but continues executing with the transaction rolled back</li>\n</ul>\n\n<p>There is no:</p>\n\n<ul>\n<li><code>SET XACT_ABORT ON</code></li>\n<li>@@TRANCOUNT</li>\n</ul>\n\n<p>anywhere in the canonical example. </p>\n\n<p>If i didn't know any better, i would have thought that the line:</p>\n\n<blockquote>\n  <p>The following example shows the intended use of nested transactions. </p>\n</blockquote>\n\n<p>should actually read</p>\n\n<blockquote>\n  <p>The following example shows the how not to use nested transactions.</p>\n</blockquote>\n\n<p>Unless someone can make heads or tails of this BOL example?</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":13167018,"title":"getting data from one table to another in asp.net","body":"<p>I have two tables called registration and user.</p>\n\n<p>Registration table:</p>\n\n<pre><code>PID(primary key,autoincrement)\nemail\npassword\nname\netc\n</code></pre>\n\n<p>User:</p>\n\n<pre><code>UserID\nAddress\netc\n</code></pre>\n\n<p>If any person gets registered then data is stored in registration table.</p>\n\n<p>Now if I want to insert data in user table then how can I insert data for that particular person which has just registered himself?</p>\n\n<p>Ex: registration table</p>\n\n<pre><code>PID  email        name\n1    abc@ab.com   xyz\n</code></pre>\n\n<p>I want to insert data into user table which has <code>PID=1</code></p>\n\n<p>And after login (which is done with the help of email and password) only person can insert data in USER table.</p>\n\n<p>What is the query for this?</p>\n\n<p>Should I add some common columns in <code>User</code> table?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13170371,"title":"Easier way to compare a DATE field to the date value of GETDATE?","body":"<p>I have a field in a table <code>Event.EventDate</code> and it's of the data type <code>DATE</code> rather than <code>DATETIME</code> and then I have a view that has the following <code>WHERE</code> clause:</p>\n\n<pre><code>WHERE e.EventDate &gt;= CAST(CONVERT(VARCHAR(MAX), GETDATE(), 101) AS DATETIME)\n</code></pre>\n\n<p>As you can see, I'm just trying to get all events <code>&gt;=</code> today's <strong>date</strong>. The above code works, but it's ugly. I tried this ...</p>\n\n<pre><code>WHERE e.EventDate &gt;= CONVERT(VARCHAR(MAX), GETDATE(), 101)\n</code></pre>\n\n<p>... and this ...</p>\n\n<pre><code>WHERE e.EventDate &gt;= CONVERT(DATETIME, GETDATE(), 101)\n</code></pre>\n\n<p>... but those didn't work, they gave me every event <code>&gt;</code> today's <strong>date</strong>. However, even if the above worked, it's still ugly.</p>\n\n<p>Isn't there a better way?</p>\n"},{"tags":["c#","sql-server"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":13161280,"title":"Evaluate SQL where clause in c# without SQL Server","body":"<p>I have a large set of conditions (I don't know them ahead of time) that I need count against a relatively small SQL Server table (&lt; 10,000 rows). Each condition is in the form of a SQL where clause. Currently, I build a complete sql statement in the form of \"select count(*) from some_table where \" + Where_Clause; and I let SQL Server return the count to me. I do this in a loop to get all the counts I need for all the various conditions. </p>\n\n<p>I'm looking for ways to speed this up when I have dozens or hundreds of counts I need to run. I don't know the statements ahead of time. Some will select the whole table, some may not select any rows. I've tried the following solutions:</p>\n\n<ol>\n<li>Issuing the queries in parallel - saw minimal improvement even when not doing any locking </li>\n<li>Writing them as complex counts on case statements so I can run multiple where clauses in one statement</li>\n<li>Passing many queries together as UNIONs and getting the results back as one result set</li>\n</ol>\n\n<p>None of these options have had a fantastic improvement in runtime (sometimes it would run more slowly) and with the added complexity, I don't feel any of them are worth it. </p>\n\n<p>My question is: I can very quickly load the entire table into a DataTable object just by running one \"select *\" against it. If I had the whole table in memory, is there a way to run counts against it without going back and forth to SQL Server? I'm hoping to cut out the overhead of the: network, I/O, locking, etc.</p>\n\n<p>The most complex where clause would be something like:</p>\n\n<pre><code>a=1 or b in (2,3) or c&lt;4 or d like '%5' or substring(e,2,1)='z'\n</code></pre>\n\n<p>So it's not trivial and supporting as much as possible of T-SQL would be ideal, but I don't think DataTable's .Select() method supports this OR is it very fast. So given a table of data in memory, can I could rows using T-SQL syntax very fast (or in parallel)?</p>\n"},{"tags":["sql-server","osx","microsoft","navicat"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13170242,"title":"Microsoft SQL Server Client for Mac OS X","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3452/sql-client-for-mac-os-x-that-works-with-ms-sql-server\">SQL Client for Mac OS X that works with MS SQL Server</a>  </p>\n</blockquote>\n\n\n\n<p>I am looking for a SQL Server client that has comfortable GUI and works with Mac OS X.</p>\n\n<p>I have tried Navicat, but it crashes all too frequently and has a great problem connecting to SQL Server when the latter is under load.Note: we are using SQL Server 2012.</p>\n\n<p>Any Recommendations?</p>\n"},{"tags":["sql-server","networking","jdbc","tcp","wireshark"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13169982,"title":"How to capture & analyze network traffic for jdbc mssql \"connection recv failed\" error","body":"<p>One of our customers has intermittent database connection problems. The error logs periodically show messages like this:</p>\n\n<pre><code> A database error occurred. : Software caused connection abort: recv failed\n</code></pre>\n\n<p>at which point someone must restart the application. (Connection pooling doesn't recover from the error)</p>\n\n<p>This <a href=\"http://stackoverflow.com/questions/135919/java-net-socketexception-software-caused-connection-abort-recv-failed\">post</a> describes a problem; one of the answers points to wireshark. </p>\n\n<p><strong>Suspicions</strong></p>\n\n<p>I suspect the problem is either:</p>\n\n<ol>\n<li>someone wrote a database script that runs on the server that closes \nsleeping connections </li>\n<li>an error in their network</li>\n</ol>\n\n<p>As I can't find anyone owning up to #1, I need to hunt down #2.</p>\n\n<p><strong>My question</strong></p>\n\n<ul>\n<li>Once I have captured the data, what do I look for in the captured data to point to a root cause?</li>\n</ul>\n\n<p><strong>Example</strong></p>\n\n<p>For example, I assume based on past experience that the server logs will show everything \"runs fine\" until an error like this occurs:</p>\n\n<pre><code>2012-11-01 04:02:14 A database error occurred. : Software caused connection abort: recv failed\n</code></pre>\n\n<p>Then I'd like to look at the traffic the seconds/minutes before 04:02:14 for any \"smoking gun\".</p>\n\n<p><strong>Pointers?</strong></p>\n\n<p>Additionally, I ask for pointers on these items:</p>\n\n<ul>\n<li>setting up the traffic capture. (is capturing on the jdbc server's port 1433 enough?) </li>\n<li>port-mirroring tips. I assume I can ask their \"network guy\" to set up port mirroring to a windows box running wireshark and he can do it easily (\"Port mirroring\" copies all network traffic for a particular connection off to another port for later analysis)</li>\n<li>any wireshark 'scalability issues'--will the data overload wireshark ?</li>\n<li>filtering through the data for \"interesting events\"</li>\n<li>\"smoking guns\"--what to look for prior to that 'connection recv error'</li>\n</ul>\n\n<p><strong>Environment</strong></p>\n\n<ul>\n<li>MSSQL (2005 or later. It's on the customer site and I don't know the details) </li>\n<li>Jboss 4.2.2 </li>\n<li>Microsoft jdbc driver</li>\n<li>jdk 1.6 (not sure the exact version)</li>\n</ul>\n"},{"tags":["sql","sql-server","common-table-expression"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13164308,"title":"CTE and row_number() to fix join on unnormalized table","body":"<p>There's a table on which I can't perform any updates.  There are a dozen or so fields and of them, <code>bus_typ_cd</code> changes.  This lead to me getting double the expected results for a given patient who had two different <code>bus_typ_cd</code>s.  I'm unable to drop this column.  While I found a workaround solution, I was wondering if there is a more extensible/efficient way to do this.  Pic of the incorrect results:<img src=\"http://i.stack.imgur.com/mRbda.jpg\" alt=\"enter image description here\"></p>\n\n<p><strong>EDIT</strong>  what I thought was a fix actually wasn't.  If I use a <code>where</code> clause to restrict only a single <code>bus_typ_cd</code> I can't catch all of the expected results.  </p>\n\n<p>the working version:</p>\n\n<pre><code>   with cte as\n    (\n    select c.patid\n        ,c.CHARGE\n        ,c.pos\n        ,m.sex\n        ,e.eduText\n\n        from claims c\n        inner join icdClm as ic on ic.clmid=c.clmid\n        --instead of selecting the table, a derived table with distinct values was selected\n        inner join\n        (\n            select distinct m.patid, m.sex,m.education\n                from members as m \n        ) as m on m.PATID=c.patid\n        inner join EducationTable as e on e.eduID=m.education\n        where ic.icd like '707%'\n    ) \n</code></pre>\n\n<p>non working</p>\n\n<pre><code>    ;with cte as\n    (\n    select c.patid\n        ,c.CHARGE\n        ,c.pos\n        ,m.sex\n        --,e.eduText\n        ,ROW_NUMBER() over(partition by c.patid,bus_typ_cd order by c.patid)  as rn\n        ,m.BUS_TYP_CD\n        ,m.STATE_CD\n        from claims c\n        inner join icdClm as ic on ic.clmid=c.clmid\n        inner join members as m on m.PATID=c.patid\n        inner join EducationTable as e on e.eduID=m.education\n        where ic.icd like '707%'\n    ) \n\n\n    select  cte.*\n        from cte\n        inner join cte as cte2 on cte.patid=cte2.patid \n        and cte.POS=cte2.POS and cte.sex=cte2.sex \n        --tried to make the below line a logical unit of equal charge and one rn less than the other\n        and (cte.CHARGE=cte2.CHARGE and cte.rn &lt; cte2.rn) \n        and cte.BUS_TYP_CD=cte2.BUS_TYP_CD \n        and cte.STATE_CD=cte2.STATE_CD\n        where cte.patid =1161569271\n        order by cte.CHARGE\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","windowsdomainaccount"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":4623,"score":1,"question_id":4268100,"title":"How to find loginname, database username, or roles of sqlserver domain user who doesn't have their own login?","body":"<p>I have created a login and database user called \"MYDOMAIN\\Domain Users\". I need to find what roles a logged on domain user has but all the calls to get the current user return the domain username eg. \"MYDOMAIN\\username\" not the database username eg. \"MYDOMAIN\\Domain Users\".</p>\n\n<p>For example, this query returns \"MYDOMAIN\\username\"</p>\n\n<pre><code>select original_login(),suser_name(), suser_sname(), system_user, session_user,  current_user, user_name()\n</code></pre>\n\n<p>And this query returns 0</p>\n\n<pre><code>select USER_ID()\n</code></pre>\n\n<p>I want the username to query database_role_members is there any fuction that will return it or any other way I can get the current users roles?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","login"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13168175,"title":"SQL Script to Create Auto-Expiring Login","body":"<p>How can I script the creation of a new SQL Login (whether by Windows\nAuthentication or with SQL password) and have it automatically expire after some\ntime, e.g. 8 hours, 24 hours</p>\n\n<p>I've tried searching here in stackoverflow but I haven't found a solution. If you guys know of one that exists here, please let me know too. Thank you.</p>\n\n<p>I am using SQL Server 2005 and 2008</p>\n"},{"tags":["sql-server","clrstoredprocedure","tsqlt"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":240,"score":1,"question_id":12389656,"title":"The database owner SID recorded in the master database differs from the database owner SID","body":"<p>When I try to install tSQLt onto an existing database i get the following error:</p>\n\n<blockquote>\n  <p>The database owner SID recorded in the master database differs from\n  the database owner SID recorded in database ''. You should correct\n  this situation by resetting the owner of database '' using the ALTER\n  AUTHORIZATION statement.</p>\n</blockquote>\n"},{"tags":["sql","sql-server","query"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":84,"score":2,"question_id":13166647,"title":"Trouble Joining 3 Tables","body":"<p>I am new to writing SQL queries and have been trying to pull information from 3 different tables and link it together.  </p>\n\n<p>Data resides in Microsoft SQL Server.  </p>\n\n<p>This is my current query (which is not working the way I intend it to):  </p>\n\n<pre><code>SELECT h.jhhold, h.jhjob, h.jhpart, h.jhrev, h.jhcust, h.jhextd, o.jadesc, h.jhpqty, o.jaoqty, o.jacqty, o.japo, o.javend \nFROM Jhead AS h\nLEFT JOIN jjops AS o ON h.jhjob = o.jajob \nLEFT JOIN hpodt AS p ON h.jhjob = p.hdjob \nWHERE h.jhpcmp = 0 AND o.jatype = 2 AND o.jacqty &lt; o.jaoqty AND japcmp = 0 \nORDER BY h.jhjob\n</code></pre>\n\n<p>To explain what I am trying to do.  I have a job header table <strong>Jhead</strong>, a job detail table <strong>jjops</strong> and a purchase order detail table <strong>hpodt</strong>.  I believe the job number is the primary key in the jhead table.</p>\n\n<p>Here is my problem:  As soon as I add the second left join I end up with a lot of extra lines of duplicated information. </p>\n\n<p>I have tried using the GROUP BY jhead.jhjob but get the following error: </p>\n\n<p>Column jhead.jhhold is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.</p>\n\n<p>So I researched the error with one of the solutions being to make my GROUP BY look like this:\nGROUP BY jhead.jhjob, jhead.jhhold, jhead.jhpart, jhead.jhrev, jhead.jhcust, jhead.jhextd</p>\n\n<p>But then as soon as I put in jhead.jhextd I get this error:\nThe text, ntext, and image data types cannot be compared or sorted, except when using IS NULL or LIKE operator.</p>\n\n<p>And have now hit a brick wall.  I did see that you can change the type to NVARCHAR.  I dont really want to be sorting by the description field because it is unique and may be very taxing on the server.  Is there a better way to do this?  </p>\n\n<p><strong>Edit With Sample Data:</strong>\nI removed extra fields to simplify the query and have filtered the results for 1 job number.</p>\n\n<p>With only 1 left join:\n<img src=\"http://i.imgur.com/Gd3J5.jpg\" alt=\"With only 1 Left Join\"></p>\n\n<p>With both left joins:\n<img src=\"http://i.imgur.com/Woaog.jpg\" alt=\"Second\"></p>\n\n<p>ERP software as you can see has multiple jobs under 1 PO# and I am only interested in displaying lines with a job number that matches.\n<img src=\"http://i.imgur.com/nZzXx.jpg\" alt=\"Third\"></p>\n\n<p><strong>QUERY UPDATED</strong> </p>\n\n<pre><code>SELECT h.jhhold, h.jhjob, h.jhrev, o.jadesc, h.jhpqty, o.jaoqty, o.jacqty, o.japo, o.javend, p.hdprcd, p.hdrecd\nFROM Jhead AS h\nLEFT JOIN jjops AS o ON h.jhjob = o.jajob \nLEFT JOIN hpodt AS p ON h.jhjob = p.hdjob \nWHERE h.jhpcmp = 0 AND o.jatype = 2 AND o.jacqty &lt; o.jaoqty AND japcmp = 0 AND p.hdjob = h.jhjob AND p.hdpo = o.japo\nORDER BY h.jhjob\n</code></pre>\n\n<p>This is getting close to what I want.  The problem is now that my jadesc field is duplicating the first result when it should actually be different for each line.</p>\n\n<p><img src=\"http://i.imgur.com/9o7du.jpg\" alt=\"4\"></p>\n\n<p>I filtered to just display one job.  Their should only be one column.</p>\n\n<p><strong>Getting extra lines but have all the data I need</strong>  </p>\n\n<pre><code>SELECT h.jhhold, h.jhjob, h.jhrev, o.jadesc, h.jhpqty, o.jaoqty, o.jacqty, o.japo, o.javend, p.hdprcd, p.hdrecd, p.hdseq \nFROM Jhead AS h \nLEFT JOIN jjops AS o ON h.jhjob = o.jajob \nLEFT JOIN hpodt AS p ON h.jhjob = p.hdjob \nWHERE (h.jhpcmp = 0 AND o.jatype = 2 AND o.jacqty &lt; o.jaoqty AND japcmp = 0 AND p.hdjob = h.jhjob AND p.hdpo = o.japo AND p.hdseq = o.jaseq AND o.jaopr != 'PT') \n  OR (h.jhpcmp = 0 AND o.jatype = 2 AND o.jacqty &lt; o.jaoqty AND japcmp = 0 AND o.japo = 0 AND o.jaopr != 'PT')\nORDER BY h.jhjob, o.jaseq\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":34,"score":4,"question_id":13168965,"title":"Group by query is not returning what I expected","body":"<p>I am attempting to find all records that have the same <code>groupCol</code> but more than one non 0 <code>infoCol</code>. Here is a complete example of what I am trying to do.</p>\n\n<pre><code>CREATE TABLE #t\n    (\n    groupCol varchar(14) NOT NULL,\n    infoCol int NOT NULL,\n    indexCol int NOT NULL IDENTITY (1, 1)\n    )\nGO\n\ninsert into #t (groupCol, infoCol) \nvalues ('NoRows',1),      ('NoRows',1),      ('NoRows',1),       --Not in output due to having only 1 disticnt infoCol\n       ('TwoResults',1),  ('TwoResults',1),  ('TwoResults',2),   --In the output with \"'TwoResults', 2\"\n       ('ThreeResults',1),('ThreeResults',2),('ThreeResults',3), --In the output with \"'ThreeResults', 3\"\n       ('ExcludedZero',1),('ExcludedZero',1),('ExcludedZero',0)  --Not in the output due to 0 being excluded for finding distinct infoCol's\n       ('TwoAndZero',1),  ('TwoAndZero',2),  ('TwoAndZero',0)    --In the output but returns 2 not 3.\n\nselect * from #t\n\nselect groupCol, count(groupCol) as distinctInfoCol \nfrom #t \nwhere infoCol &lt;&gt; 0\ngroup by groupCol, infoCol\nhaving count(groupCol) &gt; 1\n\ndrop table #t\n</code></pre>\n\n<p>However the result from my query is </p>\n\n<pre>\ngroupCol       distinctInfoCol\n-------------- ---------------\nExcludedZero   2\nNoRows         3\nTwoResults     2\n</pre>\n\n<p>When I expected my output to be</p>\n\n<pre>\ngroupCol       distinctInfoCol\n-------------- ---------------\nTwoResults     2\nThreeResults   3\nTwoAndZero     2\n</pre>\n\n<p>What am I doing wrong, and how do I correct this to get the results I need?</p>\n"},{"tags":["sql","sql-server","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13166882,"title":"Cannot get login to work for ODBC driver","body":"<p>I am trying to set up an ODBC driver to SQL Server 2000 and cannot what I am doing wrong. The error I get is <code>sqlstate 28000</code> and <code>error 18456 failed login</code>. </p>\n\n<p>Here are the steps I took: </p>\n\n<ul>\n<li>create a username under computer management</li>\n<li>then in enterprise manager I create login by going to <code>security-&gt;login new login</code> </li>\n<li>From there I browse to the user I created in computer management and windows nt is selected as well as grant access</li>\n<li>then went to database and rolls and gave it read and write permissions for a few databases. The default database is set to master. Everything seems to work just fine up to this point.</li>\n</ul>\n\n<p>Then I go to the ODBC manager and then SysDSN then add and I pick SQL Server. From here I name the DSN, pick the server that has both the windows username and the SQL Server on it and click next. </p>\n\n<p>Then I click SQL Server authentication and enter the username and password, and checked to make sure it was right at least 20 times, and then I get the <code>18456 error</code>.</p>\n\n<p>Am I missing a step, what happened?</p>\n\n<p>Any help is appreciated.</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13148011,"title":"Can I create a dummy INSTEAD OF UPDATE, INSERT trigger so I can use MERGE with INSTEAD OF DELETE?","body":"<p>I'm trying to utilize the SQL Server 2008R MERGE functionality to manage parent child relationship records in a join table.</p>\n\n<p>The join table represents many-to-many relationships, so it has two foreign keys for the same primary key. Accordingly, <code>ON DELETE CASCADE</code> cannot be used. In it's place I am using a trigger on <code>INSTEAD OF DELETE</code> and deleting the join records, thus removing the constraint so I can complete the originally intended delete operation.</p>\n\n<p>Unfortunately, when I try to use MERGE in this scenario I get the following error.</p>\n\n<pre><code>The target 'Content' of the MERGE statement has an INSTEAD OF trigger on some,\nbut not all, of the actions specified in the MERGE statement. In a MERGE statement,\nif any action has an enabled INSTEAD OF trigger on the target, then all actions\nmust have enabled INSTEAD OF triggers.\n</code></pre>\n\n<p>Here's the T-SQL for reproducing this problem. I have included commented out drop and select statements for convenience.</p>\n\n<pre><code>CREATE DATABASE [TestDatabase]\nGO\n\nUSE [TestDatabase]\nGO\n\nCREATE TABLE dbo.[Content] (\n    ContentID int NOT NULL IDENTITY (1, 1),\n    Title varchar(255)\n)\nALTER TABLE dbo.[Content]\n    ADD CONSTRAINT PK_Content\n    PRIMARY KEY CLUSTERED (ContentID)\n\nCREATE TABLE dbo.[Attachment] (\n    ParentContentID int NOT NULL,\n    ChildContentID int NOT NULL\n)\n\nALTER TABLE [dbo].[Attachment]\n    ADD CONSTRAINT [PK_Attachment]\n    PRIMARY KEY CLUSTERED (\n        [ParentContentID] ASC,\n        [ChildContentID] ASC\n    )\n\nALTER TABLE dbo.Attachment\n    ADD CONSTRAINT FK_Attachment_ParentContent\n    FOREIGN KEY (ParentContentID)\n    REFERENCES dbo.[Content] (ContentID)\n    ON UPDATE NO ACTION\n    ON DELETE NO ACTION \n\nALTER TABLE dbo.Attachment\n    ADD CONSTRAINT FK_Attachment_ChildContent\n    FOREIGN KEY (ChildContentID)\n    REFERENCES dbo.[Content] (ContentID)\n    ON UPDATE NO ACTION\n    ON DELETE NO ACTION\nGO\n\nCREATE TRIGGER trContentInsteadOfDelete\n    ON dbo.[Content]\n    INSTEAD OF DELETE\nAS\n\n    SET NOCOUNT ON;\n\n    DELETE FROM dbo.[Attachment]\n    WHERE [ParentContentID] IN (SELECT [ContentID] FROM deleted)\n    OR [ChildContentID] IN (SELECT [ContentID] FROM deleted)\n\n    DELETE FROM dbo.[Content]\n    WHERE [ContentID] IN (SELECT [ContentID] FROM deleted)\nGO\n\nINSERT INTO [Content] ([Title]) VALUES ('a'), ('a'), ('a'), ('b')\nGO\n\nINSERT INTO [Attachment] ([ParentContentID], [ChildContentID])\n    VALUES (1, 2), (1, 4), (3, 4)\nGO\n\nMERGE [Content] AS target\nUSING (VALUES (1, 'a'), (2, 'b'), (NULL, 'b')) AS source ([ContentID], [Title])\nON target.[ContentID] = source.[ContentID]\nWHEN MATCHED AND target.[Title] != source.[Title] THEN\n    UPDATE SET target.[Title] = source.[Title]\nWHEN NOT MATCHED BY TARGET THEN\n    INSERT ([Title]) VALUES (source.[Title])\nWHEN NOT MATCHED BY source THEN\n    DELETE;\n\n/*\nUSE master\nDROP DATABASE [TestDatabase]\n\nSELECT * FROM [Content]\nSELECT * FROM [Attachment]\n*/;\n</code></pre>\n\n<p><strike>Is there any alternative to adding triggers to <code>INSTEAD OF INSERT</code> and <code>INSTEAD OF UPDATE</code> without having to explicitly delete any constraining records in the Attachment table before deleting records from the Content table?</p>\n\n<p>I could temporarily disable the trigger, but then I'd have to explicitly delete the constraining records in the Attachment table.</p>\n\n<p>I'm concerned that adding additional triggers just to accommodate the MERGE statement defeats the purpose of using the MERGE statement.</strike></p>\n\n<p>Update: Is there a way to create a dummy INSTEAD OF INSERT, UPDATE trigger to enable me to continue to use the MERGE?</p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13161401,"title":"calculating age from sysdate and birthdate using SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/57599/how-to-calculate-age-in-t-sql-with-years-months-and-days\">How to calculate age in T-SQL with years, months, and days</a>  </p>\n</blockquote>\n\n\n\n<p>I'm simply trying to calc age (in years) using a birthdate variable </p>\n\n<pre><code>1932-04-29 00:00:00.000\n</code></pre>\n\n<p>and SYSDATETIME( ) in SQL Server, where by</p>\n\n<pre><code>SELECT year(Sysdatetime() - Birthdate) as Age\n</code></pre>\n\n<p>produces (surprisingly) : 1980</p>\n\n<p>What did I miss? I expected to get 80!</p>\n"},{"tags":["sql-server","ssis","expression"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13167562,"title":"How do I capture the single row value from Execute SQL Task that uses an expression?","body":"<p>I have an Execute SQL Task using this expression:</p>\n\n<pre><code>@[User::SQLExportError] + (DT_WSTR,30)@[User::Id]\n</code></pre>\n\n<p>The expression evaluates correctly to:</p>\n\n<pre><code>  select count(*) as ErrorTableCount from [myschema].Error \n    where SPName in ('export/INSERT','export/DELETE') and Id = 1000\n</code></pre>\n\n<p>In this same sql task I want to capture the <strong><code>as ErrorTableCount</code></strong> into a single row result set with the ResultName called: <em>ErrorTableCount</em> Variable Name called: <code>User::ErrorTableCount</code></p>\n\n<p>I am getting the red circle/x cross telling me: </p>\n\n<pre><code>There were errors during task validation.\n</code></pre>\n\n<p>There seems to be some conflict between using an expression for the sql source and within that expression containing the the dubbed count name defined under the result set. Any advice/ideas?</p>\n"},{"tags":["sql-server","tsql","escaping","character","like-operator"],"answer_count":5,"favorite_count":0,"up_vote_count":10,"down_vote_count":0,"view_count":6062,"score":10,"question_id":439495,"title":"How can I escape square brackets in a LIKE clause?","body":"<p>I am trying to filter items with a stored procedure using like. The column is a varchar(15). The items I am trying to filter have square brackets in the name.</p>\n\n<p>For example:  <code>WC[R]S123456</code>.</p>\n\n<p>If I do a <code>LIKE 'WC[R]S123456'</code> it will not return anything.</p>\n\n<p>I found some information on using the <code>ESCAPE</code> keyword with <code>LIKE</code> but I do not understand how to use it to treat the square brackets as a regular string.</p>\n"},{"tags":["sql-server","asp.net-mvc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":13167499,"title":"How safe is MVC 4 Default Database?","body":"<p>Im kinda new at MVC 4 and im trying to learn it. I wanted to ask how safe is mvc 4 defaul databases.</p>\n\n<p>When i configure the project and enable role authorization it creates an ASPNETDB.mdf. Can i trust it and its default database in a big project?</p>\n"},{"tags":["sql-server","configuration"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13166772,"title":"How to control which SQL Server instance localhost points to","body":"<p>I have 2 instances of SQL Server on my PC, one is SQL Server 2008 R2, the other SQL Server 2012.</p>\n\n<p>If I use <code>LOCALHOST</code> when connecting to SQL Server, it goes to the SQL Server 2008 R2 instance.</p>\n\n<p>I want it to point to the SQL Server 2012 instance.</p>\n\n<p>Does anyone know how I can achieve this?</p>\n"},{"tags":["sql","sql-server","index"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":1,"view_count":48,"score":3,"question_id":13166071,"title":"Index structure to maximize speed across any combination of index columns","body":"<p>I have a database with about five possible index columns, all of which are useful in different ways.  Let's call them System, Source, Heat, Time, and Row.  Using System and Row together will make a unique key, and if sorted by System-Row the database will also be sorted for any combination of the five index variables (in the order I listed them above).</p>\n\n<p>My problem is that I use all combinations of these columns: sometimes I want to JOIN each System-Row to the next System-(Row+1), sometimes I want to GROUP or WHERE by System-Source-Heat, sometimes I want to look at all entries of System-Source WHERE Time is in a specific window, etc.</p>\n\n<p>Basically, I want an index structure that functions similarly to every possible permutation of those five indexes (in the correct order, of course), without actually making every permutation (although I am willing to do so if necessary).  I'm doing statistics / analytics, not traditional database work, so the size of the index and speed of creating / updating it is not a concern; I only care about speeding my improvised queries as I tend to think them up, run them, wait 5-10 minutes, and then never use them again.  Thus my main concern is reducing the \"wait 5-10 minutes\" to something more like \"wait 1-2 minutes.\"</p>\n\n<p>My sorted data would look something like this:</p>\n\n<pre><code>Sys So H Ti R\n1   1  0 .1 1\n1   1  1 .2 2\n1   1  1 .3 3\n1   1  2 .3 4\n1   2  0 .5 5\n1   2  0 .6 6\n1   2  1 .8 7\n1   2  2 .8 8\n</code></pre>\n\n<p>EDIT: It may simplify things a bit that System virtually always needs to be included as the first column to make any of the other 4 columns in sorted order.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":13156038,"title":"Speed up dividing date intervals by minutes in Sql Server","body":"<p>I need to divide some date intervals by minutes. (For example, 2012-01-01 10:00 - 2012-01-01 10:00 interval should be divided into 2012-01-01 10:01, 2012-01-01 10:02, ... 2012-01-01 10:10).\nFor example, there is a table</p>\n\n<pre><code>CREATE TABLE [dbo].[Events](\n    [ID] [int] IDENTITY(1,1) NOT NULL,\n    [EventStart] [datetime] NOT NULL,\n    [EventEnd] [datetime] NOT NULL,\n    [Amount] [float] NOT NULL,\n CONSTRAINT [PK_Events] PRIMARY KEY CLUSTERED \n(\n    [ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\n\nGO\n</code></pre>\n\n<p>This table is filled like</p>\n\n<pre><code>DECLARE @i integer = 0;\nDECLARE @initial_date datetime = '2012-01-01';\n\nWHILE @i &lt; 50000\nBEGIN\n    INSERT INTO [Events] (EventStart, EventEnd, Amount) VALUES (DATEADD(MINUTE, 10*@i, @initial_date), DATEADD(MINUTE, 10*(@i + 1), @initial_date), @i);\n    SET @i = @i + 1;\nEND\n</code></pre>\n\n<p>As a result we have many 10 minutes intervals.</p>\n\n<p>To divide it by minutes I use the following recursive CTE:</p>\n\n<pre><code>DECLARE @start_date datetime = '2012-01-01';\nDECLARE @end_date datetime = '2013-01-02';\n\n\nWITH Date_Ranges (StatDate, Amount, IntervalStart, CurrentMinute) AS (\n  SELECT \n    DATEADD(MINUTE, 0,  ev.EventStart) AS StatDate, ev.Amount, ev.EventStart AS IntervalStart, 1 AS CurrentMinute\n  FROM [Events] ev\n  WHERE ev.EventStart BETWEEN @start_date AND @end_date\n  UNION ALL\n  SELECT \n    DATEADD(MINUTE, CurrentMinute, ev.EventStart), ev.Amount, ev.EventStart AS IntervalStart, CurrentMinute + 1\n  FROM [Events] ev\n  INNER JOIN Date_Ranges ranges ON (ranges.IntervalStart = ev.EventStart AND \n    ranges.StatDate &gt;= ev.EventStart AND \n    ranges.StatDate &lt; ev.EventEnd)\n    WHERE DATEADD(MINUTE, CurrentMinute, ev.EventStart) BETWEEN @start_date AND @end_date AND\n        ev.EventStart BETWEEN @start_date AND @end_date\n) \n\nSELECT *\nFROM Date_Ranges --ORDER BY StatDate\n</code></pre>\n\n<p>The main problem is too slow execution of this recursive CTE on a large data amount.</p>\n\n<p>So, how can I speed up this?</p>\n"},{"tags":["sql-server","regex","tsql"],"answer_count":4,"favorite_count":4,"up_vote_count":30,"down_vote_count":2,"view_count":20551,"score":28,"question_id":194652,"title":"SQL Server Regular expressions in T-SQL","body":"<p>Is there any regular expression library written in <em>T-SQL</em> (no CLR, no extended sp, pure t-sql) for SQL Server?</p>\n\n<p>(should work with shared hosting)</p>\n\n<p>Edit:</p>\n\n<ul>\n<li><p>thanks I know about PATINDEX, LIKE, xp_ sps and CLR solutions</p></li>\n<li><p>I also know it is not the best place for regex, the question is theoretical:)</p></li>\n<li><p>reduced functionality is also accepted</p></li>\n</ul>\n"},{"tags":["sql-server","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13165754,"title":"Detach SQL DB accessed in multiple processes","body":"<p>I have a set of programs (consider parent and child processes) that access the same SQL database.  It is attached and detached during the course of the program(s).  I am having trouble only when I try and detach it when both processes have accessed it.  The connections are all closed, but if I try to execute the sp_detach stored procedure, I get an error message that it is in use and cannot be detached.  Is there something about the multi-process access that I need to address?</p>\n"},{"tags":["c#","sql-server"],"answer_count":7,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":268,"score":1,"question_id":10660261,"title":"datetime value in database","body":"<p>I updated the datetime to the datebase. It's 5/2/2012. But when I want to show this value from that database into a textbox it will show me : 05/02/2012.</p>\n\n<p>Please help me to solve this problem. I want to show it's value into the textbox like the format has been updated : 5/2/2010</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["c#","asp.net","html","sql-server","connection-string"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13166704,"title":"updating database from host using asp.net error 26","body":"<p>So Basically i have a POS system with its own database and my website which is hosted on a shared 1and1.com hosting company server which also contains a database with a database design needed. \nMy aim is to only upload those products that are active- true.</p>\n\n<p>My solution to update the website database from the POS database is to have a special admin page on the website that a connection string of the POS database is entered. The admin.aspx.cs calls a stored procedure that gets all the specific data from the POS database and insert them into the website database.</p>\n\n<p>This all works perfectly when testing on a colleagues machine acting as the website+ db.\nBut when it comes to loading on the 1and1.com host it returns an error 26.</p>\n\n<p>SqlException was unhandled A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified)</p>\n\n<p>The connection string is the following\nServer=IP_ADDRESS_OF_POS\\SQLEXPRESS;Database=CentricDatabase;User ID=centric;Password=XXXXXXXXX</p>\n\n<p>Does anyone have an idea why this isn't working on the host? but works on a colleagues machine?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13165703,"title":"SQL update table data query","body":"<p>I want to run update query to update PercentAvailability column value 0 to 100 between specified date period in my case <code>2012-10-28 03:31:01 to 2012-10-28 08:31:01</code>. see following picture.</p>\n\n<p><img src=\"http://i.stack.imgur.com/HQdGV.png\" alt=\"enter image description here\"></p>\n\n<p>How do i run query to update above data between specified date?</p>\n\n<p>Note: I have many ApplicationID which has this issue so how could i run query against all ApplicationID, I believe we need to run JOIN syntax but it would be good if you give some short of hint. </p>\n"},{"tags":["sql-server","sql-server-2008","matlab"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4405,"score":1,"question_id":6593485,"title":"How to connect to Microsoft SQL Server 2008 (MSSQL) from Matlab?","body":"<p>This is probably a simple question:</p>\n\n<ul>\n<li>How do I connect to Microsoft SQL Server 2008 R2 from Matlab?</li>\n<li>How do I read a table into a matrix given some SQL query?</li>\n</ul>\n\n<p><strong>Update</strong></p>\n\n<p>I'd prefer a method that doesn't require use of manual setup using ODBC.</p>\n"},{"tags":["sql-server","tsql","function"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":42,"score":3,"question_id":13166048,"title":"Execute WITH statement inside a function","body":"<p>I have the following code:</p>\n\n<pre><code>WITH OrderedOrders AS\n(\n\nSELECT *,  ROW_NUMBER() OVER (ORDER BY item) AS RowNumber\n from  dbo.fnSplit('1:2:3:5', ':')  \n)\n\n select * from OrderedOrders where rownumber =2\n</code></pre>\n\n<p>I need to run this code inside a function, however I just can't make the syntax right. Here's how it is right now:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[FN_INDICE_SPLIT]\n    (@sInputList VARCHAR(8000),@sDelimiter VARCHAR(8000),@INDICE INT)\n\nRETURN TABLE \n\n\n;WITH OrderedOrders AS\n( \nSELECT *,  ROW_NUMBER() OVER (ORDER BY item) AS RowNumber\n from  dbo.fnSplit(@sDelimiter, @INDICE)  \n)\nselect ITEM from OrderedOrders where RowNumber=@INDICE\n</code></pre>\n\n<p>If I try to execute this, it gives me this error:</p>\n\n<pre><code>Msg 156, Level 15, State 1, Procedure FN_INDICE_SPLIT, Line 4\nIncorrect syntax near the keyword 'RETURN'.\n</code></pre>\n\n<p>I've tried to do this in many ways, but I keep getting syntax errors and I don't know what's wrong.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":282,"score":1,"question_id":9846148,"title":"Pivot Multiple Rows","body":"<p>I have a table similar to the following:</p>\n\n<pre><code>id    key    str_val    date_val      num_val\n1     A      a\n1     B      b\n1     C                 2012-01-01\n1     D                               1\n2     A      c\n2     E      d\n2     C                 2012-01-02\n2     D                                2\n</code></pre>\n\n<p>I need it to look like:</p>\n\n<pre><code>id    A      B      C             D       E\n1     a      b      2012-01-01    1\n2     c             2012-01-02    2       d\n</code></pre>\n\n<p>Basically, each key needs to become it's own column</p>\n\n<p>I tried and failed to use the PIVOT command usefully, and I'm currently trying to accomplish this with a case statement. i.e.</p>\n\n<pre><code>select\n    id,\n    case key\n        when 'A'\n        then str_val\n    end as A,\n    case key\n        when 'C'\n        then date_val\n    end as C\n    --etc.\nfrom test_table\n</code></pre>\n\n<p>However I can't figure out how to combine the table rows after this runs. I'm stuck with:</p>\n\n<pre><code>id    A      B      C             D       E\n1     a\n1            b\n1                   2012-01-01\n1                                 1\n</code></pre>\n\n<p>Any thoughts or input that could help me out? Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","string-to-datetime"],"answer_count":10,"favorite_count":4,"up_vote_count":16,"down_vote_count":0,"view_count":81423,"score":16,"question_id":207190,"title":"Sql Server string to date conversion","body":"<p>I want to convert a string like this:</p>\n\n<pre><code>'10/15/2008 10:06:32 PM'\n</code></pre>\n\n<p>into the equivalent DATETIME value in Sql Server.</p>\n\n<p>In Oracle, I would say this:</p>\n\n<pre><code>TO_DATE('10/15/2008 10:06:32 PM','MM/DD/YYYY HH:MI:SS AM')\n</code></pre>\n\n<p><a href=\"http://stackoverflow.com/questions/202243/custom-datetime-formatting-in-sql-server\">This question</a> implies that I must parse the string into one of the <a href=\"http://msdn.microsoft.com/en-us/library/aa226054(SQL.80).aspx\" rel=\"nofollow\">standard formats</a>, and then convert using one of those codes.  That seems ludicrous for such a mundane operation.  Is there an easier way?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","cdc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13162619,"title":"Unable to restart CDC after making table changes","body":"<p>I need to add a couple of columns to CDC for a table that is already being tracked. My approach is as follows:</p>\n\n<pre><code>EXEC sys.sp_cdc_drop_job 'capture'\n\nBEGIN TRANSACTION\n\nBEGIN TRY\n    -- Copy existing data of the tracked table into a temporary table\n    SELECT * INTO CDC.dbo_MyTable_Temp FROM CDC.dbo_MyTable_CT\n\n    -- Add the new column to the temp table. This allows us to just use INSERT..SELECT * later\n    ALTER TABLE CDC.dbo_MyTable_Temp ADD MyColumn INT NULL\n\n    -- Disable CDC for the source table temporarily. This will drop the CDC table\n    EXEC sys.sp_cdc_disable_table @source_schema = 'dbo', @source_name = 'MyTable', @capture_instance = 'dbo_MyTable'\n\n    -- Reenable CDC for the source table. This will recreate the table with the new columns\n    EXEC sys.sp_cdc_enable_table @source_schema = 'dbo', @source_name = 'MyTable', @capture_instance = 'dbo_MyTable', @supports_net_changes = 1, @role_name = NULL, @filegroup_name = 'CDCGROUP'\n\n    -- Insert the old values into the CDC table\n    INSERT INTO cdc.dbo_MyTable_CT SELECT * FROM cdc.dbo_MyTable_Temp\n\n    -- Correct the start_lsn in CDC.change_tables. Otherwise all of the CDC stored procedures will be confused\n    -- and although the old data will exist in the table the functions won't return it\n    UPDATE cdc.change_tables SET start_lsn = (SELECT MIN(__$start_lsn) FROM cdc.dbo_MyTable_Temp) WHERE capture_instance = 'dbo_MyTable'\n\n    -- Drop the temp table\n    DROP TABLE cdc.dbo_MyTable_Temp\n\n    COMMIT TRANSACTION\nEND TRY\nBEGIN CATCH\n    ROLLBACK TRANSACTION\n    RAISERROR('Error!', 16, 1)\nEND CATCH\n\nEXEC sys.sp_cdc_add_job 'capture'\n</code></pre>\n\n<p>However, when the job runs again after being re-added it generates an error that there is a violation of the primary key constraint on <code>CDC.lsn_time_mapping</code>.</p>\n\n<p>Any suggestions?</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server","query","insert","where-in"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13165550,"title":"where in sql server query update number list one field to another","body":"<p>I am using SQL Server, and in the query below, I have a concern.  I am not sure if the field on the left will update with the field on the right (coming from the same table) when I do a where in list.</p>\n\n<pre><code>update loc \nset locShortName = locName \nwhere locid in (3,4,11,13,14,15,16,18,19,20,21,24,32,41,45,68,69,77,82,85)\n\nupdate loc set locShortName = locName where locid = 3 (move to next record in the list)      \nupdate loc set locShortName = locName where locid = 4 (move to next record in the list)\nupdate loc set locShortName = locName where locid = 11(move to next record in the list)\n</code></pre>\n\n<p>and so on...</p>\n\n<p>I would think it would take the fist number in the list and address the field value setting, then move to the next in the list.</p>\n\n<p>Are my expectations correct?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":[".net","asp.net","sql-server","nhibernate","distinct"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":6935,"score":1,"question_id":558974,"title":"NHibernate - SELECT DISTINCT equivalent for a page filter - Northwind","body":"<p>Lets say you are working in SQL 2005 with a copy of Northwind database installed.\nYour working on an ASP.NET application with an Employees \"browse\" page.\nAt the top of the page you have a \"Title\" filter where you would like to display these 5 choices in a dropdown:</p>\n\n<blockquote>\n  <p>[ALL]<br />\n  Vice President, Sales<br />\n  Sales Representative<br />\n  Sales Manager<br />\n  Inside Sales Coordinator  </p>\n</blockquote>\n\n<p>In T-SQL you would use something like the statement below to get your list.</p>\n\n<pre><code>SELECT DISTINCT Title FROM Employees ORDER BY Title\n</code></pre>\n\n<p>What is the best way of doing this in NHibernate? Assume that the initial database design is somewhat out of your control (just like Northwind)... Meaning that you won't be creating a Titles or Positions table for normalization. </p>\n\n<p>Thanks.</p>\n"}]}
{"total":54451,"page":9,"pagesize":100,"questions":[{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13165512,"title":"Cannot create new user in sql server 2000 with same name as deleted username","body":"<p>We had to delete an old username from all our databases, however now when we try to add it back we are getting Error 15023 user already exists. I have checked all the databases to make sure that it does not and I have run </p>\n\n<pre><code>EXEC sp_change_users_login 'Auto_Fix', 'my_example_username'\n</code></pre>\n\n<p>However this fixed 0 and I am still getting the same error. I also tried putting the domain in front of my_example_username when running auto_fix, but still no luck.</p>\n\n<p>I create the user in the enterprise manager by going to logins and adding a new user.</p>\n\n<p>I am running windows server 2000, iis 6 and sql server 2003.</p>\n"},{"tags":["c#","sql-server","ms-office","office-interop"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13163805,"title":"Can i create a Microsoft Excel file without using Microsoft Interop Assembly?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1369361/how-can-i-programatically-create-read-write-an-excel-without-having-office-ins\">How can I programatically create, read, write an excel without having office installed?</a>  </p>\n</blockquote>\n\n\n\n<p>Can i create a Microsoft Excel file without using Microsoft Office Interop Assembly? \nI need to export all the values in a sql server table to an Excel file. Total number of rows can vary between 50000 to 1200000 rows.\nI need to generate the Excel file from my C#.net code where i will read the values of the table. The only restriction i have is I cannot use Microsoft Office Interop Assembly.</p>\n\n<p>I can't use CSV, or use the HTML table trick, because some of the files will contain multiple tabs, where each tabs will contain data from different tables.</p>\n"},{"tags":["c#","asp.net","sql-server","crystal-reports"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4556,"score":0,"question_id":5145044,"title":"passing multiple Parameter to crystal report in asp.net","body":"<p>I'm working on Visual Studio 2008 and SQL Server 2008, language C#</p>\n\n<p>Multiple parameter passing in crystal report in asp.net.\nI have two parameter @accountnumber and @customerid at time.\nI can only pass one parameter to my.</p>\n\n<p>Code is below.</p>\n\n<p>CrystalReportViewer1.LogOnInfo[0].ConnectionInfo.ServerName = \"CJ-PC\";</p>\n\n<pre><code>   CrystalReportViewer1.LogOnInfo[0].ConnectionInfo.UserID = \"sa\";\n\n   CrystalReportViewer1.LogOnInfo[0].ConnectionInfo.Password = \"***\";\n\n   CrystalReportViewer1.LogOnInfo[0].ConnectionInfo.DatabaseName = \"Online\";\n   string accountnumber = \"acc001\";\n   string customerID = \"cus001\";\n   ParameterField paramField = new ParameterField();\n   ParameterFields paramFields = new ParameterFields();\n   ParameterDiscreteValue paramDiscreteValue = new ParameterDiscreteValue();\n\n   paramField.Name = \"@account_number\";\n   paramDiscreteValue.Value = accountnumber;\n   paramField.CurrentValues.Add(paramDiscreteValue);\n   paramFields.Add(paramField);\n\n\n\n   CrystalReportViewer1.ParameterFieldInfo = paramFields;\n\n\n   ParameterField paramField1 = new ParameterField();\n   ParameterFields paramFields1 = new ParameterFields();\n   ParameterDiscreteValue paramDiscreteValue1 = new ParameterDiscreteValue();\n\n   paramField1.Name = \"@account_number\";\n   paramDiscreteValue1.Value = accountnumber;\n   paramField1.CurrentValues.Add(paramDiscreteValue1);\n   paramFields1.Add(paramField1);\n\n\n       paramField1.Name = \"@customer_id\";\n   paramDiscreteValue1.Value = customerID;\n   paramField1.CurrentValues.Add(paramDiscreteValue1);\n   paramFields1.Add(paramField1);\n\n   CrystalReportViewer1.ParameterFieldInfo = paramFields1;\n</code></pre>\n\n<p>Help me out.</p>\n"},{"tags":["sql","sql-server","sum","divide"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13163395,"title":"SQL division giving wrong answer","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/11112462/what-is-wrong-with-this-sql-server-query-division-calculation\">What is wrong with this SQL Server query division calculation?</a>  </p>\n</blockquote>\n\n\n\n<p>I am dividing two values in SQL like </p>\n\n<pre><code>SELECT SUM(totalCalls), \n    SUM(EnteredBTN), \n    SUM(EnteredBTN) * 100 / SUM(totalCalls),\n    SUM(EnteredACC), \n    SUM(EnteredACC) / SUM(totalCalls), \n    SUM(SentToTrans),\n    SUM(SentToTrans) * 100 / SUM(totalCalls),\n    SUM(Complete_Information), \n    SUM(Complete_Information) * 100 / SUM(SentToTrans) \n</code></pre>\n\n<p>Now when I do <code>SUM(EnteredACC)/SUM(totalCalls)</code> i.e <strong>7/48</strong>, it should give me <strong>.14</strong> but it gives <strong>0</strong> instead.</p>\n\n<p>When I do <code>SUM(EnteredACC)*100/SUM(totalCalls)</code> it should give <strong>14.58</strong> (or <strong>15</strong> when rounded off) but it gives <strong>14</strong> as the result. Can anyone help please?</p>\n"},{"tags":["sql-server","tsql","comparison","null"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":1098,"score":6,"question_id":3110980,"title":"Efficient way to compare for a NULL or value for a column in SQL","body":"<p>What's the efficient way to check for a null or value for a column in SQL query. Consider a sql table <code>table</code> with integer column <code>column</code> which has an index. <code>@value</code> can be some integer or null ex: 16 or null. </p>\n\n<p>Query 1: Not sure, but it seems one should not rely on the short-circuit in SQL. However, below query always works correctly when <code>@value</code> is some integer or null. </p>\n\n<pre><code>select * from\ntable\nwhere (@value is null or column = @value)\n</code></pre>\n\n<p>The below query is an expanded version of the above query. It works correctly too. </p>\n\n<pre><code>select * from \ntable \nwhere ((@value is null) \n    or (@value is not null and column = @value))\n</code></pre>\n\n<p>Would the above 2 queries would take the advantage of the index?</p>\n\n<p>Query 2: The below query compares the column with non-null <code>@value</code> else compares the column <code>column</code> with itself which will always be true and returns everything. It works correctly too. Would this query take advantage of the index?</p>\n\n<pre><code>select * from\ntable\nwhere (column = isnull(@value, column))\n</code></pre>\n\n<p>What's the best way? </p>\n\n<p>Note: If the answer varies with databases, I'm interested in MS-SQL. </p>\n"},{"tags":["c#","sql-server","stored-procedures","sqlparameters"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":1,"question_id":13162848,"title":"SqlCommand stored procedure without a named parameter","body":"<p>I've written a query parser that should create a SqlCommand and execute a stored procedure.  The query for the stored procedure can come in many forms, including this one:</p>\n\n<pre><code>exec dbo.sp_StoredProcedureName 1599800\n</code></pre>\n\n<p>In this case, I create the SqlParameter this way:</p>\n\n<pre><code>var param = new SqlParameter() { Value = paramValue };\n</code></pre>\n\n<p>I get an error stating that '@Parameter1' is not a parameter for procedure sp_StoredProcedureName.</p>\n\n<p>Is there a way I can do this without running it as a standard query?  I'd like to keep it consistent and build the SqlCommand as a StoredProcedure type if possible.   </p>\n\n<p>I was thinking maybe I could reflect the parameter names of the stored proc first,  but wondering if there's another approach.</p>\n"},{"tags":["sql-server","database","query","table","select"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":13159879,"title":"SQL Select Data","body":"<p>I have a table set up, it is a customers' repayment schedule for a product.</p>\n\n<p>My table consists of the following fields:</p>\n\n<blockquote>\n  <p>SaleID | PaymentDueDate | AmountDue</p>\n</blockquote>\n\n<p>What I need for each Sale is:</p>\n\n<blockquote>\n  <p>SaleID | FirstPaymentDate | FirstPaymentValue | RegularPaymentValue | FinalPaymentvalue</p>\n</blockquote>\n\n<p>Each repayment schedule has the following characteristics:</p>\n\n<p>First payment amount is defined by the customer.\nRegular and final payments are dictated by the balance remaining.</p>\n\n<p>e.g</p>\n\n<p>Sale = 200\nTerm = 14 Weeks (14 Payments)</p>\n\n<p>First Payment = 50 (x1)</p>\n\n<p>Regular Payment = 12 (x12)</p>\n\n<p>Final Payment = 6 (x1)</p>\n\n<p>Please can you advise how I can retrieve what I need.</p>\n\n<p>ADDITION:\nCode So Far:</p>\n\n<p>This is what I have achieved so far, but this only gets me the First Payment and First Payment Date for each Sale:</p>\n\n<pre><code>SELECT      \nFP.SaleID, FP.FirstPaymentDate, RS.AmountDue AS FirstPayment \nFROM    \n(       \nSELECT SaleID, MIN(PaymentDueDate)AS FirstPaymentDate       \nFROM RepaymentSchedule          \nGROUP BY SaleID     \n) AS FP \nLEFT OUTER JOIN\nRepaymentSchedule AS RS ON FP.SaleID = RS.SaleID AND FP.FirstPaymentDate =   RS.PaymentDueDate ORDER BY RS.SaleID\n</code></pre>\n\n<p>ADDITION:\nData Sample:\n280 over 14 Weeks</p>\n\n<pre><code>SaleID  PaymentDueDate            AmountDue\n41      2012-08-29 00:00:00.000   120.00\n41      2012-09-05 00:00:00.000   12.30\n41      2012-09-12 00:00:00.000   12.30\n41      2012-09-19 00:00:00.000   12.30\n41      2012-09-26 00:00:00.000   12.30\n41      2012-10-03 00:00:00.000   12.30\n41      2012-10-10 00:00:00.000   12.30\n41      2012-10-17 00:00:00.000   12.30\n41      2012-10-24 00:00:00.000   12.30\n41      2012-10-31 00:00:00.000   12.30\n41      2012-11-07 00:00:00.000   12.30\n41      2012-11-14 00:00:00.000   12.30\n41      2012-11-21 00:00:00.000   12.30\n41      2012-11-28 00:00:00.000   12.40\n</code></pre>\n\n<p>I guess the FinalPaymentValue is not too crucial.</p>\n\n<p>Really I just need to know how to work out what the regular payment is.</p>\n"},{"tags":["php","sql-server","linux","apache","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13161698,"title":"MSSQL Field alias (AS) has stopped working","body":"<p>We are trying to move a Linux machine with PHP 5.2.1 to a virtual machine with PHP 5.3.3. Using Apache web server.</p>\n\n<p>All the scripts that have:</p>\n\n<pre><code>Select real_column as alias_column from some_table\n</code></pre>\n\n<p>return null for alias_column. \nIf we remove the \"as alias_column\" everything works correctly.</p>\n\n<p>We are using the LibTDS ODBC driver, connecting to MS-SQL 2008.</p>\n\n<p>Any ideas?\nThanks</p>\n"},{"tags":["asp.net","sql-server","datatable","dataset","datasource"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":32,"score":-1,"question_id":13162817,"title":"insert data from a DataTable into a dropdown","body":"<p>i want to fill a <code>dropdown</code> by a <code>datatable</code><br>\nbcoz i'v already a method <code>GetCate()</code> in bal, which returns <code>datatable</code> and now want to dynamically fill the data into a <code>ddl</code> with some <code>datasource</code> and <code>databind</code> script, could it b possible ???  </p>\n\n<p>why does not possible to assign a datatable into a dropdownlist???</p>\n\n<pre><code>public void BindCateDDL()\n{\n\n    DataTable dt = new BALCate().GetCate();        \n    ddl_filter_category_id.DataSource = dt;\n    ddl_filter_category_id.DataBind();\n}\n</code></pre>\n\n<p><strong>is this a right way to do this ???</strong></p>\n"},{"tags":["sql","sql-server","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13162397,"title":"SQL - Execute stored procedure for all values in a table","body":"<p>I have a SQL stored procedure <strong>'A'</strong> which validates certain bank account information for a given account and it accepts the account number as an argument <strong>'arg1'</strong></p>\n\n<p>I want to execute the procedure for all values present in <strong>Column X</strong> of another table <strong>XXX</strong> (all bank Accounts present in the Accounts table)</p>\n\n<p>I am not sure if something like this would work</p>\n\n<pre><code>exec A @arg1 = X from XXX\n</code></pre>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server","index"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13161795,"title":"Is it redundant to define an index on the first column of a multi column primary key?","body":"<p>Is it redundant to add a separate, single-column index on the first field of a multicolumn primary key? Does it depend on the relative quantitiy of unique values in that first column compared to the size of the table?</p>\n\n<p>My specific scenario is that I'm building several moderately sized tables (20k - 500k rows) with two- and three-column primary keys. The first column in these tables is an integer which corresponds to a certain business activity (I'll just call it an \"activity\" here) and the second column is either a product ID (a UPC actually) or a business location identifier:</p>\n\n<pre><code>-- Activity - upc table: entire table is a two-column primary key\nCREATE TABLE activity_upc (\n    activity_id int NOT NULL,\n    upc_id dec(18,0) NOT NULL,\n    CONSTRAINT PRIMARY KEY PK_activity_upc CLUSTERED ( activity_id, upc_id )\n) \n\n-- One of several transaction tables, unique by activity, location, and date\n-- (date in SQL server is a 3-byte integer)\nCREATE TABLE activity_stuff (\n    activity_id int NOT NULL,\n    location_id smallint NOT NULL,\n    transaction_date date NOT NULL,\n    [ other columns ],\n    CONSTRAINT PRIMARY KEY PK_activity_stuff CLUSTERED ( \n        activity_id, location_id, transaction_date )\n)\n</code></pre>\n\n<p>There are several hundred unique locaton IDs, several thousand unique activity IDs, and over a million unique UPCs. I have an index on the <code>location_id</code> because it is very frequent to query just by <code>location_id</code>. <strong>Would it help, or be silly and redundant, to add a separate index on activity_id, which is also used frequently as a single-column filter?</strong></p>\n"},{"tags":["sql","sql-server","database","email","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":42,"score":-5,"question_id":13161237,"title":"Need advice on triggers in SQL Server","body":"<p>I am not much into SQL Server triggers etc and I have a question which may be very basic/simple.</p>\n\n<p>Questions</p>\n\n<ol>\n<li><p>I have a table in the SQL Server database which I want to send out emails to me whenever any records gets added/modified/deleted from that table (including if anyone truncates the table). </p></li>\n<li><p>I would also like to receive an email whenever any table or database restore takes place. </p></li>\n</ol>\n\n<p>Please suggest how to complete the above. I know I have to write triggers etc but I need some advice/assistance here.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":3,"up_vote_count":2,"down_vote_count":0,"view_count":85,"score":2,"question_id":13159526,"title":"Split values over multiple rows","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/5493510/turning-a-comma-separated-string-into-individual-rows\">Turning a Comma Separated string into individual rows</a>  </p>\n</blockquote>\n\n\n\n<p>I have the following output from a stored procedure and was wondering the best way to split the values into multiple rows.</p>\n\n<pre><code>reference   name                            subjects       subjectstitle\nLL9X81MT    Making and Decorating Pottery   F06,F27,F38       NULL\n</code></pre>\n\n<p>I need to trim the subjects field at the comma's and duplicate the information over three rows so the data would be as follows.</p>\n\n<pre><code>reference   name                            subjects       subjectstitle\nLL9X81MT    Making and Decorating Pottery   F06       NULL\nLL9X81MT    Making and Decorating Pottery   F27       NULL\nLL9X81MT    Making and Decorating Pottery   F38       NULL\n</code></pre>\n\n<p>I'm using MS SQL Server 2008 to setup these SP's and just need some help on how to split the subjects field up.</p>\n\n<p>Thanks,</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":37,"score":2,"question_id":13161044,"title":"Checking if a given date fits between a range of dates","body":"<p>If I have 2 date columns in a table, <code>startDate</code> and <code>endDate</code>.  How do I return rows where a given date fits between those 2 dates?  For example:</p>\n\n<p>If the given date is <code>2012-10-25</code></p>\n\n<p>It should return the following rows</p>\n\n<pre><code>startDate   -   endDate\n2012-10-25  -   2012-10-25\n2011-09-10  -   2013-11-15\n2012-10-20  -   2012-10-25\n2012-10-23  -   2012-10-28\n2012-09-14  -   2012-10-28\n</code></pre>\n\n<p>from the following rows:</p>\n\n<pre><code>startDate   -   endDate\n2012-10-25  -   2012-10-25\n2011-09-10  -   2013-11-15\n2012-01-11  -   2012-10-11\n2012-10-20  -   2012-10-25\n2012-04-15  -   2012-04-16\n2012-05-20  -   2012-05-25\n2012-12-01  -   2012-12-10\n2012-10-23  -   2012-10-28\n2012-09-14  -   2012-10-28\n2012-11-13  -   2012-12-15\n</code></pre>\n\n<p>Is this possible with sql?</p>\n\n<p>I am using sql server 2008.</p>\n"},{"tags":["sql-server","networking","connection"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13160625,"title":"Connection to SQL Server 2008/2012 with dynamic ports","body":"<p>My problem is that I can't connect to any SQL Server instance installed on our server (it has both 2008 and 2012) using dynamic ports. Static ports works well. Also, if you mention dynamic port number in connection string, you can connect. But connection failed (regular error \"Network or instance-specific...\") with named instance without port number.</p>\n\n<p>I found the solution - run <code>sqlbrowser.exe -c</code> on the server. After that everything works until server restarts. How to solve or diagnose it?</p>\n\n<p>P.S. Firewall is OFF.</p>\n\n<p><strong>EDIT:</strong>\nAlso, when I'm closing this tool, it becomes inavaliable again. I'm not always connected to server with remote desktop. Now it works only when I connected and started this tool. Looks not OK for me.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sqlperformance"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":19,"score":2,"question_id":13161170,"title":"MSSQL Server 2008 Performance issue with very strange resolution","body":"<p>I'm a long time DBA (12 years in SQL). I'm running sql2008 enterprise in a win 2008 clustered environment. 128gb memory and 32cpu in each cluster node. Not wimpy.</p>\n\n<p>I've got the wierdest performance issue I've seen to date, and its baffling me why it would occur...looking for ideas.</p>\n\n<p>Occasionally, maybe 2-3 times per week, the performance of queries made by the application to the database will come to a crawl. SPs that normally execute in 500ms, suddenly are up arond 50 seconds. Forget about saving data...application .net code will time out before the data even makes the trip.</p>\n\n<p>First time this happened was about 4 weeks ago. I kicked off a profiler so I could see if there were excessive queries or something, and didnt see anything strange. So, I copied one of the batches from the profile and executed it in SSMS. From that moment, the performance was perfect again. Application was snappy and no issues.</p>\n\n<p>Next time it happened, I remembered that just running a batch in ssms seemed to \"fix\" the issue. So I took some benchmarks first and did it again. Same thing. Running ANY batch in SSMS relieves whatever is happening. I have reproduced this about 15-18 times over the past 4 weeks: The application comes to a crawl, and then I run any query in ssms, and all is well.</p>\n\n<p>This is obviously a problem. In order to find out what is running or going on, I have to run a batch--which makes the problem stop. SO the act of trying to observe the issue resolves it. GAH!</p>\n\n<p>Note: There are two clustered instances running on the same node. Only one of the two experiences this issue. And they are roughly the same size in terms of disk space and activity.</p>\n\n<p>Anyone ever seen this?</p>\n"},{"tags":["sql-server","tsql","stored-procedures"],"answer_count":5,"favorite_count":21,"up_vote_count":38,"down_vote_count":0,"view_count":29940,"score":38,"question_id":43249,"title":"T-SQL stored procedure that accepts multiple Id values","body":"<p>Is there a graceful way to handle passing a list of ids as a parameter to a stored procedure.  For instance, I want departments 1, 2, 5, 7, 20 returned by my stored procedure.  In the past, I have passed in a comma delimited list of ids, like the below code, but feel really dirty doing it.  SQL Server 2005 is my only applicable limitation I think.</p>\n\n<pre><code>create procedure getDepartments\n        @DepartmentIds varchar(max)\nas\n    \tdeclare @Sql varchar(max)\n\n    \tselect @Sql = 'select [Name] from Department where DepartmentId in (' + @DepartmentIds + ')'\n\n    \texec(@Sql)\n</code></pre>\n"},{"tags":["sql-server","running-total"],"answer_count":9,"favorite_count":9,"up_vote_count":28,"down_vote_count":0,"view_count":23392,"score":28,"question_id":860966,"title":"Calculate a Running Total in SqlServer","body":"<p>Imagine the following table (called TestTable):</p>\n\n<pre>\nid     somedate    somevalue\n--     --------    ---------\n45     01/Jan/09   3\n23     08/Jan/09   5\n12     02/Feb/09   0\n77     14/Feb/09   7\n39     20/Feb/09   34\n33     02/Mar/09   6\n</pre>\n\n<p>I would like a query that returns a running total in date order, like:</p>\n\n<pre>\nid     somedate    somevalue  runningtotal\n--     --------    ---------  ------------\n45     01/Jan/09   3          3\n23     08/Jan/09   5          8\n12     02/Feb/09   0          8\n77     14/Feb/09   7          15  \n39     20/Feb/09   34         49\n33     02/Mar/09   6          55\n</pre>\n\n<p>I know there are <a href=\"http://geekswithblogs.net/Rhames/archive/2008/10/28/calculating-running-totals-in-sql-server-2005---the-optimal.aspx\" rel=\"nofollow\">various ways of doing this</a> in SQL 2000/2005/2008.</p>\n\n<p>I am particularly interested in this sort of method that uses the aggregating-set-statement trick:</p>\n\n<pre><code>INSERT INTO @AnotherTbl(id, somedate, somevalue, runningtotal) \nSELECT id, somedate, somevalue, null\nFROM TestTable\nORDER BY somedate\n\nDECLARE @RunningTotal int\nSET @RunningTotal = 0\n\nUPDATE @AnotherTbl\nSET @RunningTotal = runningtotal = @RunningTotal + somevalue\nFROM @AnotherTbl\n</code></pre>\n\n<p>... this is very efficient but I have heard there are issues around this because you can't necessarily guarantee that the UPDATE statement will process the rows in the correct order. Maybe we can get some definitive answers about that issue.</p>\n\n<p>But maybe there are other ways that people can suggest?</p>\n\n<p>edit: Now with a <a href=\"http://sqlfiddle.com/#!3/c8880/4\" rel=\"nofollow\">SqlFiddle</a> with the setup and the 'update trick' example above</p>\n"},{"tags":["sql-server","tsql","triggers"],"answer_count":7,"favorite_count":10,"up_vote_count":26,"down_vote_count":0,"view_count":54216,"score":26,"question_id":741414,"title":"Insert Update trigger how to determine if insert or update","body":"<p>I need to write an Insert, Update Trigger on table A which will delete all rows from table B whose one column (say Desc) has values like the value inserted/updated in the table A's column (say Col1). How would I go around writing it so that I can handle both Update and Insert cases. How would I determine if the trigger is executed for an update or insert.</p>\n"},{"tags":["sql-server","phonegap","csv","gps","couchdb"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13160189,"title":"Post data from PhoneGap App to Server","body":"<p>I'm working on a PhoneGap app by following this guide here: \n<a href=\"http://mobile.tutsplus.com/tutorials/phonegap/build-an-exercise-tracking-app-geolocation-tracking/\" rel=\"nofollow\">http://mobile.tutsplus.com/tutorials/phonegap/build-an-exercise-tracking-app-geolocation-tracking/</a></p>\n\n<p>However, the change I am looking to make is to have the data saved to a server automatically every 24hr period to a server. So I've been looking for the best way to do this, the data will basically just be a csv file containing gps coordinates and some uid information. </p>\n\n<p>The best lead I've found I believe is the suggestion in the second answer to this question:\n<a href=\"http://stackoverflow.com/questions/8343086/how-to-save-data-on-a-remote-server-from-an-app-jqmphonegap\">how to save data on a remote server from an app (jqm+phonegap)?</a></p>\n\n<p>Is there are more effective and simpler way to do this? Since all I am looking to do is store data to a server in raw format.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","hierarchy"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13158857,"title":"How to query and parse adjacent list hierarchy using cte?","body":"<p>How can I query this parent-child hierarchy to produce a result set in which the levels are in their own columns? Sample data:</p>\n\n<pre><code>SET NOCOUNT ON;\nUSE Tempdb;\n\nIF OBJECT_ID('dbo.Employees', 'U') IS NOT NULL DROP TABLE dbo.Employees;\n\nCREATE TABLE dbo.Employees\n(\n  empid   INT         NOT NULL PRIMARY KEY,\n  mgrid   INT         NULL     REFERENCES dbo.Employees,\n  empname VARCHAR(25) NOT NULL,\n  salary  MONEY       NOT NULL,\n  CHECK (empid &lt;&gt; mgrid),\n  CHECK (empid &gt; 0)\n);\n\nCREATE UNIQUE INDEX idx_unc_mgrid_empid ON dbo.Employees(mgrid, empid);\n\nINSERT INTO dbo.Employees(empid, mgrid, empname, salary) VALUES\n  (1,  NULL, 'David'  , $10000.00),\n  (2,  1,    'Eitan'  ,  $7000.00),\n  (3,  1,    'Ina'    ,  $7500.00),\n  (4,  2,    'Seraph' ,  $5000.00),\n  (5,  2,    'Jiru'   ,  $5500.00),\n  (6,  2,    'Steve'  ,  $4500.00),\n  (7,  3,    'Aaron'  ,  $5000.00),\n  (8,  5,    'Lilach' ,  $3500.00),\n  (9,  7,    'Rita'   ,  $3000.00),\n  (10, 5,    'Sean'   ,  $3000.00),\n  (11, 7,    'Gabriel',  $3000.00),\n  (12, 9,    'Emilia' ,  $2000.00),\n  (13, 9,    'Michael',  $2000.00),\n  (14, 9,    'Didi'   ,  $1500.00);\n\nselect * from dbo.Employees\ngo     \n\n;WITH Tree (empid, mgrid, lv)\nAS (\n\nSELECT empid, mgrid, 1\nFROM Employees\nWHERE mgrid IS NULL \n\nUNION ALL\n\nSELECT E.empid, E.mgrid, lv + 1\nFROM Employees AS E\nJOIN Tree\nON E.mgrid= Tree.empid\n)\nSELECT empid, mgrid, lv\nFROM Tree\nORDER BY Lv, empid\n</code></pre>\n\n<p>The resulting table should have a structure like</p>\n\n<pre><code>+-------+-----+--------+--------+--------+--------+--------+\n| empid | lvl | level1 | level2 | level3 | level4 | level5 |\n+-------+-----+--------+--------+--------+--------+--------+\n|     1 |   1 |      1 | NULL   | NULL   | NULL   | NULL   |\n|     2 |   2 |      1 | 2      | NULL   | NULL   | NULL   |\n|     3 |   2 |      1 | 3      | NULL   | NULL   | NULL   |\n|     4 |   3 |      1 | 2      | 4      | NULL   | NULL   |\n|     5 |   3 |      1 | 2      | 5      | NULL   | NULL   |\n|     6 |   3 |      1 | 2      | 6      | NULL   | NULL   |\n|     7 |   3 |      1 | 3      | 7      | NULL   | NULL   |\n|     8 |   4 |      1 | 2      | 5      | 8      | NULL   |\n|     9 |   4 |      1 | 3      | 7      | 9      | NULL   |\n|    10 |   4 |      1 | 2      | 5      | 10     | NULL   |\n|    11 |   4 |      1 | 3      | 7      | 11     | NULL   |\n|    12 |   5 |      1 | 3      | 7      | 9      | 12     |\n|    13 |   5 |      1 | 3      | 7      | 9      | 13     |\n|    14 |   5 |      1 | 3      | 7      | 9      | 14     |\n+-------+-----+--------+--------+--------+--------+--------+\n</code></pre>\n"},{"tags":["sql","sql-server","join","aggregate","coalesce"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13157109,"title":"SQL query to display aggregated data when result is zero","body":"<p>I have a table with fields like this:</p>\n\n<pre><code>Item\nCategory\nYear \nMonth\nValue\n</code></pre>\n\n<p>I want to aggregate the result from this table to display sum(value) for each category, year and month. So I have this query:</p>\n\n<pre><code>SELECT Category, Year, Month, SUM(Value) \nFROM Table\nGROUP BY Category, Year, Month;\n</code></pre>\n\n<p>This works fine, but for months in which the sum is zero, the month is not displayed. I want all months to be displayed with zero for the total value where applicable.</p>\n\n<p>Ive tried doing <code>COALESCE(SUM(Value),0)</code>, but this didnt work.</p>\n\n<p>Ive tried creating a separate table (Table2) with the year and month values and then joining this with the first table:</p>\n\n<pre><code>SELECT Category, Year, Month, SUM(Value) \nFROM Table\nRIGHT JOIN Table2\nON Table2.Year + Table2.Month = Table.Year + Table.Month\nGROUP BY Category, Year, Month;\n</code></pre>\n\n<p>This doesnt work either. What am I doing wrong?</p>\n\n<p>Edit:</p>\n\n<p>I have tried Dems's solution, using the following query:</p>\n\n<pre><code>SELECT\n  Category.name,\n  Dates.Year,\n  Dates.Month,\n  SUM(Data.Value) AS Value\nFROM\n  Category\nCROSS JOIN\n  Dates\nLEFT JOIN\n  Data\n    ON  data.CategoryID = Category.ID\n    AND data.Year       = Dates.Year\n    AND data.Month      = Dates.Month\nWHERE data.Year BETWEEN #### and ####\n  AND data.Month BETWEEN # AND #\n  AND data.Property IN (A1,B1) \n  AND data.Property2 IN (C1,D1)\nGROUP BY\n  Category.name,\n  Dates.Year,\n  Dates.Month\n</code></pre>\n\n<p>The only differences as far as can see are that I'm using a where clause on data, and have missed of the ORDER BY, which shouldn't make a difference. But I'm still having no joy.</p>\n"},{"tags":["sql-server","scripting","dynamic-sql"],"answer_count":10,"favorite_count":22,"up_vote_count":22,"down_vote_count":0,"view_count":24350,"score":22,"question_id":21547,"title":"In SQL Server, how do I generate a CREATE TABLE statement for a given table?","body":"<p>I've spent a good amount of time coming up with solution to this problem, so in the spirit of <a href=\"http://stackoverflow.com/questions/21245/questions-vs-conveying-information\" rel=\"nofollow\">this post</a>, I'm posting it here, since I think it might be useful to others. </p>\n\n<p>If anyone has a better script, or anything to add, please post it.</p>\n\n<p>Edit: Yes guys, I know how to do it in Management Studio - but I needed to be able to do it from within another application.</p>\n"},{"tags":["sql-server","reporting-services","ssrs-2008","ssrs-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":11745610,"title":"Show Hidden Datasets in ssrs 2008","body":"<p>I am trying to show all hidden datasets created in SSRS report. I don't see the option \"Show Hidden dataset\" when I right click the Datasets folder. I tried the microsoft link too. How to show all hidden datasets please.</p>\n\n<p><a href=\"http://technet.microsoft.com/en-us/library/cc627463(v=sql.100).aspx\" rel=\"nofollow\">http://technet.microsoft.com/en-us/library/cc627463(v=sql.100).aspx</a></p>\n"},{"tags":["sql-server","intellisense","ssms","sql-server-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":103,"score":6,"question_id":12660746,"title":"Intellisense for JOINs in SQL Server Management Studio","body":"<p>In SQL Server Management Studio (SSMS) is there an option to enable intellisense auto-completion for JOINs?</p>\n\n<p>For example, if I type: </p>\n\n<pre><code>SELECT * FROM Employee INNER JOIN _\n</code></pre>\n\n<p>at this point I would like intellisense to give me the tables related to Employee, and when I pick one to fill in the appropriate join condition, based on the foreign key relationships.</p>\n\n<p>LinqPad does this for LINQ queries, which is great. I would like the same in SSMS. I am using SqlServer 2012.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","query-optimization"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13158956,"title":"UDF performance suddenly degraded","body":"<p>SQL Server 2008 R2</p>\n\n<p>I know this is a common problem (eg: <a href=\"http://connect.microsoft.com/SQLServer/feedback/details/524983/user-defined-function-performance-is-unacceptable\" rel=\"nofollow\">http://connect.microsoft.com/SQLServer/feedback/details/524983/user-defined-function-performance-is-unacceptable</a>) - but ive only just learned of it.</p>\n\n<p>We have a live production database that has performed fine for months, specifically a stored procedure that contains a large CTE that selects into a table variable. Then, based on a parameter on the procedure - data is selected from the table variable in various ways (column sequence, order by clause etc).</p>\n\n<p>This temporary table only has a few hundred rows inserted into it from the CTE - the source data is huge, but the resulting rows are always low in number)</p>\n\n<p>The select satements used on the table variable use 2 very simple UDF's:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[format_timeV2] ( @Time INT )\nRETURNS VARCHAR(20)\nAS \n    BEGIN\n        DECLARE @Time_Varchar VARCHAR(20)\n        SET @Time_Varchar = CONVERT(VARCHAR, @Time / 3600) + 'h ' + CONVERT(VARCHAR, ROUND(( ( CONVERT(FLOAT, ( @Time % 3600 )) ) / 3600 ) * 60, 0)) + 'm'\n        RETURN @Time_Varchar\n    END\nGO\n</code></pre>\n\n<p>And</p>\n\n<pre><code>CREATE FUNCTION [dbo].[udf_WeekEndDate] ( @Date DATETIME )\nRETURNS DATETIME\nAS \n    BEGIN\n        RETURN DATEADD(DAY, 7, CONVERT(DATETIME, CONVERT(VARCHAR(10), DATEADD(day, -1 - ( DATEPART(dw, @Date) + @@DATEFIRST - 2 ) % 7, @Date), 103) + ' 23:59:59', 103))\n    END\nGO\n</code></pre>\n\n<p>These UDF's have been working fine for months, if not years, the stored procedure in question has ALWAYS ran in under 6 seconds - but as soon as the UDF's above are included on the SELECT statement of the table variable the procedure takes MINUTES!</p>\n\n<p>As soon as we comment out the usage of these functions it returns to executing in 3-6 seconds.</p>\n\n<p>These functions are only being used on the <code>SELECT</code> from <code>@TableVar</code> statement (few hundred rows) - so i dont see why the query optimiser if struggling here?!?!</p>\n\n<p>If we run the following - the UDF's and procedure start to work normally again:</p>\n\n<pre><code>DBCC FreeProcCache\nDBCC DropCleanbuffers\n</code></pre>\n\n<p>So i can only assume the query optimiser is doing something stupid in the background - but it's not clear on the execution plan as to what it is.</p>\n\n<p>I have tried recreating the proc with <code>RECOMPILE</code> - this didnt help, only <code>FreeProcCache</code> &amp; <code>DropCleanbuffers</code> helped.</p>\n\n<p>Any ideas what the root cause of this? we dont really want to go re-writing all the UDFs as table valued function (which i understand is a work around for this problem) as this is a live production database which has been working fine for years.</p>\n\n<p><strong>EDIT 1:</strong> Blam requested detail of the actual query that hangs:</p>\n\n<pre><code>    IF @ModeInt = 2 \n        SELECT  [DET_NUMBERA] ,\n                [Name] ,\n                [Branch] ,\n                COUNT(*) OVER ( PARTITION BY [DET_NUMBERA] ) AS RowsForThisEmployee ,\n                CONVERT(VARCHAR(10), dbo.udf_WeekEndDate([Date]), 103) AS [WeekEnding] ,\n                [Date] ,\n                [Start Time] ,\n                [End Time] ,\n                [Duration] ,\n                dbo.format_timeV2([Duration] * 60) AS [DurationF] ,\n                [EntryCount] ,\n                [EntryColour] ,\n                [DurationColour] ,\n                [DurationComment]\n        FROM    @CompletedData\n        WHERE   [EntryCount] = 0\n        ORDER BY [DET_NUMBERA] ,\n                [Date] ,\n                [Start Time]\n\n    IF @ModeInt = 3 \n        SELECT  [DET_NUMBERA] ,\n                [Name] ,\n                [Branch] ,\n                COUNT(*) OVER ( PARTITION BY [DET_NUMBERA] ) AS RowsForThisEmployee ,\n                CONVERT(VARCHAR(10), dbo.udf_WeekEndDate([Date]), 103) AS [WeekEnding] ,\n                [Date] ,\n                [Start Time] ,\n                [End Time] ,\n                [Duration] ,\n                dbo.format_timeV2([Duration] * 60) AS [DurationF] ,\n                [EntryCount] ,\n                [EntryColour] ,\n                [DurationColour] ,\n                [DurationComment]\n        FROM    @CompletedData\n        WHERE   [EntryCount] &gt; 1\n        ORDER BY [DET_NUMBERA] ,\n                [Date] ,\n                [Start Time]\n</code></pre>\n\n<p>The temp table doesnt have an index (didnt think it was needed as it only ever contains 100 - 200 rows:</p>\n\n<pre><code>    DECLARE @CompletedData TABLE\n        (\n          [DET_NUMBERA] VARCHAR(7) ,\n          [Name] VARCHAR(255) ,\n          [Branch] VARCHAR(3) ,\n          [Date] DATE ,\n          [Start Time] TIME(0) ,\n          [End Time] TIME(0) ,\n          [Duration] INT ,\n          [EntryCount] INT ,\n          [EntryColour] VARCHAR(15) ,\n          [DurationColour] VARCHAR(15) ,\n          [DurationComment] VARCHAR(65)\n        )\n</code></pre>\n\n<p>The CTE populates the table in 3 seconds, its only the above SELETS that make use of UDF's that hang, if i remove the UDF's from the SELECT it works instantly.</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13158834,"title":"Instead of trigger behavior with CDC Tables","body":"<p>We're having an insted of trigger on view ( for DML operations ) .\nwe are trying to monitor the Activity on the view with CDC Tables and we've defined the base table (the one the view is based on ) as a CDC table . </p>\n\n<p>When we run an update command on the view ( the instead of trigger is fired ) the output in the cdc tables is one row for delete and one row for update ( operation code 1 and then operation code 2 ) , we expected to find one row with the value bedore ( operation code 3 ) and one row with the value after ( operation code 4).</p>\n\n<p>Do you know if this the normal behavior when update occures when instead of trigger is fired behind the scene (delete old record and insert new record ) ? </p>\n\n<p>Thx for the help . </p>\n"},{"tags":["sql-server","partitioning","indexes"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13158425,"title":"Partitions and Indexes, in which cases should be used","body":"<p>I know some knowledges:</p>\n\n<ul>\n<li><p>Partitions used to achieve better performance (like described in <a href=\"http://blogs.msdn.com/b/manisblog/archive/2009/01/18/easy-table-partitions-with-sql-server-2008.aspx\" rel=\"nofollow\">this</a> article)</p></li>\n<li><p>And indexes used to increase performance in selection operations.</p></li>\n</ul>\n\n<p>And as result my question: in which cases i should use indexes and in which cases i should use partitioned tables. </p>\n\n<p>In other words what should be better in different operations(selections,deletions,updates) indexes or partitioning of table, and why.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":61,"score":0,"question_id":13157750,"title":"Meaning of ; in queries","body":"<p>What is the meaning of ; at the end of queries?</p>\n\n<p>For example; what is the difference between:</p>\n\n<pre><code>select 1\nselect 2\n</code></pre>\n\n<p>and </p>\n\n<pre><code>select 1;\nselect 2\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13155383,"title":"How to use Group By with dynamic SQL query in Sql Server","body":"<p>I have a procedure which gets certain information. I have added a field to it which gets number of accounts. For this I have used the \"Count\" aggregate function to it. Now since Count has been added to it, it should have a group by function too. I am tryin to add Group By to it but cant find the exact syntax to use Group By with Dynamic SQL. Below is the query that is used with the procedure:</p>\n\n<pre><code>DECLARE @SQL  nvarchar(max),@paramlist nvarchar(max) \nSELECT @SQL = 'SELECT awt.AcctID, MIN(CAST(awt.autoEnter AS SMALLINT)) AS AutoApproved                \nFROM dbo.AccountWorkflowTask awt JOIN dbo.WorkflowTask wt ON awt.WorkflowTaskID = wt.WorkflowTaskID                \nWHERE (wt.TaskID IN (9, 17) AND ReasonIDExit = 1)'\n\nSELECT @SQL=@SQL+')) '                                    \nSELECT @SQL=@SQL+'SELECT a.ApplID, acct.AcctID, acct.dtApplication, ai.FName, ai.MName, ai.LName, ai.SSN, a.Email, ao.CompanyName,'                \nSELECT @SQL=@SQL+'ao.DBAName, ao.TaxID, acct.AcctNum, acct.AcctAffinityNum, luA.AffinityNum, luA.AffinityName, t.TaskDesc, awt.dtEnter, \nCount(DMA.AcctNum) As NoOfAccounts   FROM   dbo.Applicant a JOIN dbo.APPLICANTACCOUNT aa ON a.ApplID = aa.ApplID'\n\nJOIN 'TO SOME TABLE'\n\nWHERE 'Some Condition'\n</code></pre>\n\n<p>Now I want to use to Group By clause in order to get the count for NoOfAccounts. I am not able to get the syntax for it. Any help will be appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2008-r2","sql-server-2008-express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13156336,"title":"How to connect to SQL Server 2008 R2 using SQL Server 2008 Express via stored procedures","body":"<p>I need to know how to connect access the data from SQL Server 2008 R2 database using SQL Server 2008 Express through stored procedure.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","tsql","select","views"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13053668,"title":"Top results from multiple elections in T-SQL","body":"<p>I have a table with votes from multiple sectors (think of each sector as a state or similar) on multiple candidates. Each sector has multiple candidates, each with a different vote count.</p>\n\n<p>Here is my table (simplified)</p>\n\n<pre><code>CREATE TABLE [Results]\n(\n    [SectorID] BIGINT,\n    [CanditateID] BIGINT, \n    [VoteCount] BIGINT,\n    [Newness] DATETIME\n)\n</code></pre>\n\n<p>I obviously keep sector and candidate meta data in another table, but I need to find the highest voted candidate for each sector, so I can join those tables into a view.</p>\n\n<p>The best candidate in each sector, is determined by <code>[VoteCount]</code>, and if there are two with the same number of votes, it is determined by <code>[Newness]</code>. There must remain exactly one line per sector, and I have to be able to use it in a view, joined together with the meta data.</p>\n\n<p>How do I obtain the highest voted candidate from each sector?</p>\n"},{"tags":["c#","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":3,"question_id":13106351,"title":"Issue related to Searching Data in SQL Server","body":"<p>I have SQL datatable StudetnMaster having FirstName nvarchar(100) and contains Data Entry Gujarati Lanuage (Unicode Chracters )</p>\n\n<pre><code>   StudentId   FirstName\n     1           \n     2              \n</code></pre>\n\n<p>now i have following query for searching :</p>\n\n<pre><code>Select * from StudetnMaster where FirstName like N'\" + textBox1.Text.Trim() + \"%' \n</code></pre>\n\n<p>its working fine:</p>\n\n<p>but in stiored procedure i have to pass parameter for FirstName as Follows:</p>\n\n<pre><code>ALTER PROCEDURE dbo.StoredProcedure1\n        @FirstName nvarchar(100)\n\nAS\n\n    select * from StudentNew where FirstName like N@FirstName+'%' \n</code></pre>\n\n<p>but it throws an Error saying : Invalid Column Name N@FirstName</p>\n\n<p>how can i use <code>'N'</code>  in storedProcedure for parameter because without using <code>N'</code> Unicode Text is not searchable: </p>\n\n<p>For inline query as mentioned above i got resut: but for stored procedure i got error: so how can we use     <code>'N'</code>  in storedprocedure?</p>\n\n<p>is there any other solution for searching unicode characters in storedrocedure?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","index","primary-key"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13147504,"title":"Is there a way to create a unique constraint on a column larger than 900 bytes?","body":"<p>I'm fairly new to SQL Server, so if anything I say doesn't make sense, there's a good chance I'm just confused by something. Anyway...</p>\n\n<p>I have a simple mapping table. It has two columns, <code>Before</code> and <code>After</code>. All I want is a constraint that the <code>Before</code> column is unique. Originally it was set to be a primary key, but this created errors when the value was too large. I tried adding an <code>ID</code> column as a primary key and then adding <code>UNIQUE</code> to the <code>Before</code> column, but I have the same problem with the max length exceeding 900 bytes (I guess the constraint creates an index).</p>\n\n<p>The only option I can think of is too change the <code>id</code> column to a checksum column and make that the primary key, but I dislike this option. Is there a different way to do this? I just need two simple columns.</p>\n"},{"tags":["sql-server","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":38,"score":-1,"question_id":13157277,"title":"Query in SQL Server (machines that are now in specific project)","body":"<p>I have a table including 3 fields which are <code>Machine Name</code>, <code>Project Name</code>, <code>Date Time</code>\nwhere <code>Date Time</code> indicates the exact time when machine was assigned to a project.</p>\n\n<p>Now I want to find machines which are now in a specific project (in fact it may be that one machine in different times be allocated to different projects).</p>\n\n<p>I want lasted specific project be latest project that machine assigned to it.</p>\n"},{"tags":["sql","sql-server","query","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13156493,"title":"How to create a list of dates from a daterange without using a CTE","body":"<p>The following link explains how to turn a date range into a list of dates.\nI used this approach and it works fine but the query is not performing (I used Maxrecursion 0 to unlimit).</p>\n\n<p><a href=\"http://blog.justinstolle.com/sql-turn-a-date-range-into-a-list-of-dates/\" rel=\"nofollow\">http://blog.justinstolle.com/sql-turn-a-date-range-into-a-list-of-dates/</a></p>\n\n<p>Is there any other solution to get this done? (using subquery or declare table?)</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","database-backups"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13137815,"title":"SQL Server backup devices","body":"<p>I'm trying to find out how to detect if a backup device exists using T-SQL.</p>\n\n<p>This is how I create my backup device:</p>\n\n<blockquote>\n  <p>EXEC master.dbo.sp_addumpdevice @devtype = N'disk', @logicalname =\n  N'TestTest', @physicalname = N'C:\\Program Files\\Microsoft SQL\n  Server\\MSSQL10_50.PTC_SQLPROD\\MSSQL\\Backup\\TestTest.bak'</p>\n</blockquote>\n\n<p>but I can't find how to detect if it already exists first.</p>\n"},{"tags":["c#","sql-server","winforms","tsql","smo"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":3,"question_id":13090319,"title":"Could not load file or assembly 'Microsoft.SqlServer.Smo, Version=10.0.0","body":"<ul>\n<li>OS : Microsoft Windows NT 5.2.3790 Service Pack 2 Version: 2.0.50727.42 </li>\n</ul>\n\n<p>Doing: creating Tables... </p>\n\n<blockquote>\n  <p>Rec: system.m.FileNotFoundexception: could not load file or assembly\n  'microsoft.sqlserver.smo, version=10.0.0.0, culture=neutral File name:\n  'microsoft.sqlserver.smo, version=10.0.0.0, culture=neutral,\n  PublicKeyToken=89845dcd8080cc91' at\n  claimsure.Forml.Runsqlscript(string connstring, streamReader sr) at\n  myapp.Forml.bw_Dowork(object sender, DoworkeventArgs e) 'MN: Assembly\n  binding logging is turned OFF. To enable assembly bind failure\n  logging, set the registry value\n  (NKLm\\software\\microsoft\\Fusion!enableLog] (DwoRD) to 1. Note: There\n  is some performance penalty associated with assembly bind failure\n  logging. To turn this feature off, remove the registry value\n  (NKLm\\software\\microsoft\\Fusion!enableLog).</p>\n</blockquote>\n\n<p>I get the above error when running my application on a Windows 2003 server with SQL Server 2005.</p>\n\n<p>I know there is a solution to download SQLServer2005_XMO from <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=24793\" rel=\"nofollow\">http://www.microsoft.com/en-us/download/details.aspx?id=24793</a></p>\n\n<p>I have done this, but after the install a server reboot is required, which is not feasible for the time being. </p>\n\n<p>I need to make use of the server object.</p>\n\n<pre><code> using Microsoft.SqlServer.Management.Smo;\n using Microsoft.SqlServer.Management.Common;  \n\n        using (SqlConnection connection = new SqlConnection(connString))\n        {\n            Server server = new Server(new ServerConnection(connection));\n            server.ConnectionContext.StatementTimeout = 2400;\n            server.ConnectionContext.ExecuteNonQuery(sqlString);\n\n        }\n</code></pre>\n\n<p>Is is possible to load the dll in the same directory as my app and reference it from within the code? </p>\n\n<p>Thanks.    </p>\n\n<p>edit: added full error</p>\n"},{"tags":["sql-server","error-handling","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":69,"score":0,"question_id":13053240,"title":"How to convert blank into null in ssis","body":"<p>I am extracting data from excel in <code>ssis</code>. One of the excel column contain <code>blank</code> values. so i need to replace <code>blank</code> value with null otherwise my package is going to fail. \nAny suggessions?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13156202,"title":"can we pass alias name in reference on join condition in sqlserver","body":"<p>i have following query but when i pass reference name of this alias column name it is showing invalid column name how can i do this</p>\n\n<pre><code>select OM.*,\n       convert(int,Replace(Ltrim(Replace(left(OM.mstrefc,6), '0', ' ')), ' ', '0')) as partycode,\n       OI.*,\n       Ac.AcctName,\n       Ac.acctaddr,\n       UN.UnitName\nfrom ordemst OM\n  join ordeitd OI\n    on OM.mstCode = OI.ItdCode\n  join Account Ac \n    on OM.partycode = Ac.acctcode\n  left join unitdet UN\n    on OI.ItdUnit = UN.unitcode and \n       OI.CompCode = UN.CompCode \nwhere OM.MstCode = 47 and \n      OM.MstType =79 and \n      OM.CompCode =117 and \n      AC.compcode =117 and \n      OI.Compcode=117\n</code></pre>\n"},{"tags":["sql-server","parsing","text-parsing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":34,"score":-2,"question_id":13155750,"title":"SQL Server key value pair convert varchar to numeric without exceptions","body":"<p>I'm looking for tips on putting together a user defined function to convert a varchar to numeric.  The trick is i'm after one that converts common text representations of strings to numeric.  Also, if it can't be parsed as a numeric, i'd like it to return NULL rather than throwing an error and stopping the query.</p>\n\n<p>Examples:</p>\n\n<ul>\n<li>varchar '10%' should parse as numeric 0.1 (No remove % sign and divide by 100)</li>\n<li>varchar '$1,00.1234' should parse as numeric 100.1234 (remove $ sign and ,)</li>\n<li>varchar '$1k' should parse as numeric 1000  (k converts to multiply by 1 thousand)</li>\n<li>varchar '$1M' should parse as numeric 1000000  (m converts to multiply by 1 Million)</li>\n<li>varchar '$1B' should parse as numeric 1000000000 (b converts to multiply by 1 Billion)</li>\n<li>varchar '100   ' should parse as numeric 1000  (LTrim &amp; RTrim)</li>\n<li>varchar 'Random Text' should parse as numeric NULL  (Null won't thrown an error)</li>\n</ul>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13155171,"title":"Run code when page ends","body":"<p>hey hope someone can help me with this problem...</p>\n\n<p>I have a page that loads when a student logs in, and at the top there's a label that's represents the last time he/she has logged in... This date is stored in an table</p>\n\n<p>I tried using code that will update the date to todays date in the global.asax under </p>\n\n<pre><code>void Application_End(object sender, EventArgs e)\n{\n\n}\n</code></pre>\n\n<p>But seems like I cant use SQL connections there</p>\n\n<p>How do I change the date stored in the table to the (todays.date) once the user closes the site by exiting?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13155310,"title":"Can FORCE SCAN improve performance of query","body":"<p>I think FORCE SEEK can improve the performance of SELECT query, but wondering if FORCE SCAN can also improve performance of query.</p>\n\n<p>Can someone explain with example?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13155104,"title":"Select persons which have overlap with other table","body":"<p>I didn't even know how to come up with a good title, so i hope i can describe my problem oin a right way :)</p>\n\n<p>So i have a person table, and it has a N:N relationship with keywords via the table PersonKeywords.</p>\n\n<p>Then i also have a Search table, and it also has a N:N relationship with keywords via the table SearchKeywords.</p>\n\n<p>Now the person can have a relationship with keyword A and B, and the search record can have a relationship with the keywords A and C.</p>\n\n<p>Now i want the person in my resultset, because it has at least one (in this 'A') of the keywords the search record has.</p>\n\n<p>I also want the person who has 'A', the one with 'C', the one with 'A' and 'C', but not the one with only B.</p>\n\n<p>So it's a match on two lists, but i don't know where to start to create such a statement...</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13155123,"title":"How skip id's from parent table on base of child table values","body":"<p>I have two tables</p>\n\n<pre><code>table1  \n\nides    name\n\n1001    AA\n1002    BB\n1003    CC\n\n\ntable2      \n\nides    posi    cwawr\n\n1001    2   xyz\n1001    4   lmn\n1001    6   abc\n1002    2   ijk\n1002    4   lmo\n1002    6   pqr\n1003    2   xyz\n1003    4   sfs\n</code></pre>\n\n<p>in both above table i want to select the all ides of table1 where the posi not equal to 2 and cwawr not equal to xyz. for example 1001 posi has 2 and cwawr has xyz so this id should be skip. same 1003 also have posi value 2 and cwawr has xyz so it also should be skip.</p>\n\n<p>so in result it should be </p>\n\n<pre><code>1002 \n</code></pre>\n\n<p>only.</p>\n\n<p>Thanks in advance,\nEshwer</p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13084693,"title":"Query to display rows having duplicate values in 2 columns","body":"<p>I have Table1:</p>\n\n<pre><code>id|name|city\n-------------\n1 | bat|nyc\n2 | cat|del\n2 | rat|bom\n3 | mat|xyz\n</code></pre>\n\n<p>Table2</p>\n\n<pre><code>id|name|city\n--------------\n1 |bat|dsada\n2 |cat|sadasd\n3 |rat|sdasdas\n2 |rat|asdas\n</code></pre>\n\n<p>I need a query to display rows where BOTH id and name are same among two tables in above example the query must return \ni need a query to display the rows </p>\n\n<pre><code>1|bat|nyc\n2|cat|del \n</code></pre>\n\n<p>from first table</p>\n"},{"tags":["sql-server","wcf"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13155014,"title":"WCF: The provider did not return a ProviderManifestToken string","body":"<p>I just got this error and I thought I'd share it so that someone else doesn't spend an hour trying to figure out what's gone wrong.  I have SQL Server 2008 Express and a WCF service that was working fine.  All of a sudden it stopped working.  This was the error message</p>\n\n<blockquote>\n  <p>The server encountered an error processing the request. The exception\n  message is 'The provider did not return a ProviderManifestToken\n  string.'. See server logs for more details. The exception stack trace\n  is:</p>\n  \n  <p>at\n  System.Data.Common.DbProviderServices.GetProviderManifestToken(DbConnection\n  connection) at\n  System.Data.Entity.ModelConfiguration.Utilities.DbConnectionExtensions.GetProviderInfo(DbConnection\n  connection, DbProviderManifest&amp; providerManifest) at\n  System.Data.Entity.DbModelBuilder.Build(DbConnection\n  providerConnection) at\n  System.Data.Entity.Internal.LazyInternalContext.CreateModel(LazyInternalContext\n  internalContext) at\n  System.Data.Entity.Internal.RetryLazy<code>2.GetValue(TInput input) at\n  System.Data.Entity.Internal.LazyInternalContext.InitializeContext() at\n  System.Data.Entity.Internal.InternalContext.Initialize() at\n  System.Data.Entity.Internal.LazyInternalContext.get_ObjectContext() at\n  System.Data.Entity.DbContext.System.Data.Entity.Infrastructure.IObjectContextAdapter.get_ObjectContext()\n  at lambda_method(Closure , Object ) at\n  System.Data.Services.Providers.DbContextHelper.GetObjectContext(Object\n  o) at System.Data.Services.Caching.MetadataCache</code>1.TryLookup(Type\n  serviceType, Object dataContextInstance) at\n  System.Data.Services.Providers.BaseServiceProvider.LoadMetadata() at\n  System.Data.Services.DataService<code>1.CreateMetadataAndQueryProviders(IDataServiceMetadataProvider&amp;\n  metadataProviderInstance, IDataServiceQueryProvider&amp;\n  queryProviderInstance, BaseServiceProvider&amp; builtInProvider, Object&amp;\n  dataSourceInstance) at\n  System.Data.Services.DataService</code>1.CreateProvider() at\n  System.Data.Services.DataService<code>1.EnsureProviderAndConfigForRequest()\n  at System.Data.Services.DataService</code>1.HandleRequest() at\n  System.Data.Services.DataService`1.ProcessRequestForMessage(Stream\n  messageBody) at SyncInvokeProcessRequestForMessage(Object , Object[] ,\n  Object[] ) at\n  System.ServiceModel.Dispatcher.SyncMethodInvoker.Invoke(Object\n  instance, Object[] inputs, Object[]&amp; outputs) at\n  System.ServiceModel.Dispatcher.DispatchOperationRuntime.InvokeBegin(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage5(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage41(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage4(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage31(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage3(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage2(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage11(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage1(MessageRpc&amp;\n  rpc) at System.ServiceModel.Dispatcher.MessageRpc.Process(Boolean\n  isOperationContextSet)</p>\n</blockquote>\n"},{"tags":["sql-server","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13141241,"title":"create a statistics table using datetime MSSQL Query","body":"<p>I have little table which gives me a very hard time:</p>\n\n<pre><code>Person    datetime1                   datetime2\nEric      2012-10-01 09:00:05.000     2012-10-01 22:00:00.000\nAnna      2012-10-02 06:00:05.000     2012-10-03 12:00:05.000\nRichard   2012-10-03 09:00:05.000     2012-10-04 02:00:05.000\nChuck     2012-10-01 12:00:05.000     2012-10-01 23:00:05.000\n</code></pre>\n\n<p>I am trying to write a query, which gives me statistics table. This table contains information about when a user logged in and out (daily granularity):</p>\n\n<pre><code>Date        logged_in  logged_off\n2012-10-01  2          2\n2012-10-02  1          0\n2012-10-03  1          1\n2012-10-04  0          1\n</code></pre>\n\n<p>According to my research, a pivot command could solve the problem?</p>\n\n<pre><code>select Person,\nSUM(case when datetime1 = '2012-10-01' then 1 else 0 end) as [loggeed_in],\nSUM(case when datetime2 = '2012-10-01'  then 1 else 0 end) as [logged_of]\nfrom table\ngroup by Person\n</code></pre>\n\n<p>This is not working... Do you have any ideas?</p>\n"},{"tags":["sql","sql-server","xml","xquery"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13136311,"title":"How To retrieve value of an element from same name multiple elements in XML through xQuery?","body":"<p>I have and xml field like this in sql server</p>\n\n<pre><code>&lt;propertyDetail&gt;\n  &lt;importID&gt;1735532&lt;/importID&gt;\n  &lt;pincode /&gt;\n  &lt;landmarks /&gt;\n  &lt;features&gt;\n    &lt;feature&gt;Society  Name: sec-87 srs peral  floor faridabad&lt;/feature&gt;\n    &lt;feature&gt;Transaction: Resale Property&lt;/feature&gt;\n    &lt;feature&gt;Possession: Dec,2011&lt;/feature&gt;\n    &lt;feature&gt;*Ownership: Freehold*&lt;/feature&gt;\n    &lt;feature&gt;Age of Property: Under Construction&lt;/feature&gt;\n  &lt;/features&gt;\n&lt;/propertyDetail&gt;\n</code></pre>\n\n<p>I want to retrieve the feature which has value \"<strong>Ownership: Freehold</strong>\" through xQuery and sequence of features may vary.</p>\n\n<p>Welcome any suggestion.</p>\n"},{"tags":["c#","sql-server","transactions","entity-framework-4.1","dbcontext"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13154383,"title":"Why there is no BEGIN TRANSACTION statment in SQL Profiler","body":"<p>I have two POCO objects, Customer and CustomerAddress as follows. </p>\n\n<pre><code>public partial class Customer\n    {\n        public Customer()\n        {\n            this.CustomerAddresses = new HashSet&lt;CustomerAddress&gt;();\n            this.Orders = new HashSet&lt;Order&gt;();\n        }\n\n        public int ID { get; set; }\n        public string LastName { get; set; }\n        public string FirstName { get; set; }\n        public string MiddleName { get; set; }\n        public System.DateTime DateOfBirth { get; set; }\n        public byte Gender { get; set; }\n\n        public virtual ICollection&lt;CustomerAddress&gt; CustomerAddresses { get; set; }\n        public virtual ICollection&lt;Order&gt; Orders { get; set; }\n    }\n\npublic partial class CustomerAddress\n    {\n        public int ID { get; set; }\n        public int CustomerID { get; set; }\n        public byte AddressType { get; set; }\n        public string Street { get; set; }\n        public string City { get; set; }\n        public string State { get; set; }\n        public string Country { get; set; }\n\n        public virtual Customer Customer { get; set; }\n    }\n</code></pre>\n\n<p>I am creating a new Customer object as follows.</p>\n\n<pre><code>Customer cust = new Customer();\n            cust.ID = 9;\n            cust.LastName = \"Ross\";\n            cust.FirstName = \"Taylor\";\n            cust.DateOfBirth = DateTime.Now;\n            cust.Gender = 0;\n\n            CustomerAddress custAdd = new CustomerAddress();\n            custAdd.ID = 9;\n            custAdd.Customer = cust;\n            custAdd.AddressType = 0;\n            custAdd.Street = \"1 Main Street\";\n            custAdd.City = \"Princeton\";\n            custAdd.State = \"CA\";\n            custAdd.Country = \"USA\";\n\n            DbConnection MyContext = new DbConnection(); ;\n            MyContext.Customers.Add(cust);\n            MyContext.CustomerAddresses.Add(custAdd);\n            MyContext.SaveChanges();\n</code></pre>\n\n<p>I launch SQL Profiler.  When this data is been saved, there are two insert script run against database, one for Customer and other for CustomerAddress. But my confusion is that I don't see any BEGIN TRANSACTION and COMMIT statements in SQL Profiler. If for some reason insert script for CustomerAddress fail, I would like whole transaction to fail and I am not sure if I will get it without a BEGIN TRANSACTION. Is there something I am doing wrong here? </p>\n"},{"tags":["sql","sql-server","insert","temptables"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13153420,"title":"Create temp table from provided variable column names","body":"<p>I want to create a temporary table, in which the columns will be those which I provide as parameter, separated by a delimiter. </p>\n\n<p>For example, if the column names are: id, name, address..the respective table should contain the same amount and header names of the columns. Similarly, next time the column number and names could vary. </p>\n\n<p>Any help in this regard?</p>\n"},{"tags":["c#",".net","sql-server"],"answer_count":8,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4567,"score":0,"question_id":1559493,"title":"SqlConnection throws an exception","body":"<p>Dear professionals please help me with the following problem.\nIn my .NET C# application a have this code:</p>\n\n<pre><code>SqlConnection connection = new SqlConnection( SQLCONNECTION_STRING );\n</code></pre>\n\n<p>It works marvelous on my development machine but throws an exception on Windows 2003 server. The application runs through CGI and has Full trust level.\nI've tried several connections strings and I think the string doesn't cause the issue because even this code gets an exception:</p>\n\n<pre><code>SqlConnection connection = new SqlConnection();\n</code></pre>\n\n<p>Thanks.</p>\n\n<hr>\n\n<p>I found two weird facts:\n1) It works if I connect debugger to process and simple trace the code.\n2) It works if I run the application from command line (not through CGI as required).</p>\n\n<p>So I guess something wrong with CGI and SqlConnection interaction. Does someone know about that?</p>\n\n<p>Thanks everybody for responses.</p>\n"},{"tags":["sql-server","tsql","stored-procedures","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":139,"score":0,"question_id":13143386,"title":"How to automate the execution of a stored procedure with an SSIS package?","body":"<p>I have a stored procedure that gets executed through SQL SSIS using a Execute SQL Task.</p>\n\n<p>The task has the following:</p>\n\n<pre><code>USE [OPPY_DWUSD]\nGO\nDECLARE @return_value int\nEXEC    @return_value = [dbo].[generate_merge_scdbk]\n    @Schema = N'dim',\n    @Dimension = N'VARIETY',\n    @ETLSchema = N'stg',\n    @ETLTable = N'vw_VARIETY',\n    @Execute = 1\n\nSELECT  'Return Value' = @return_value\nGO\n</code></pre>\n\n<p>Right now the way I have this setup, I have multiple Execute SQL Tasks with the same code but different values, about 20 Execute SQL Tasks.</p>\n\n<p>Is there a more cleaner way to pull this off?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13148625,"title":"PROBLEMA SQL SERVER ROLLBACK trigger","body":"<p>good afternoon,\nI have a problem with the rollback ... Treger initially was using to call the procedure and the procedure is triggered rollback but it is ...\nNow I'm trying to do the rollback from trigger nor ...</p>\n\n<p>attached the code and the error</p>\n\n<p>Thanks for your help</p>\n\n<pre><code>USE [Desarrollo_Pruebas]\nGO\n/****** Object:  Trigger [dbo].[Prueba_tre]    Script Date: 10/30/2012 17:02:53 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER TRIGGER [dbo].[Prueba_tre] \n   ON  [dbo].[Cliente]\n    FOR INSERT\nAS \nBEGIN\n\n SET NOCOUNT ON;\n\nbegin try\n    BEGIN TRAN t1\n    SAVE TRAN t1\n    INSERT INTO Articulo (Articulo_Codigo, Articulo_Descripcion, Valor_unitario, Categoria_id, msg) VALUES (1040,'EURECA',15000,5,'')\n    COMMIT \n    --raiserror ('Test error',16,1)\nend try\n\nbegin catch\n    ROLLBACK TRAN t1\n    SELECT    ERROR_NUMBER() AS ERROR_NUMBER, ERROR_MESSAGE() AS ERROR_MESSAGE;\nend catch\n\n--SET NOCOUNT ON;\n--exec Prueba CLIENTE_ID;\n\nEND\n</code></pre>\n\n<p>Msg 3931, Level 16, State 1, Procedure Prueba_tre, Line 21\nThe current transaction cannot be committed and cannot be rolled back to a savepoint. Roll back the entire transaction.</p>\n\n<p>THE TABLE IS </p>\n\n<p>the idea is that when I insert into customers products with an insert update ..\nat the end of this transaction need to return from the console</p>\n\n<pre><code>CREATE TABLE Articulo\n(\n   Articulo_Codigo int not null primary key\n   , Articulo_Descripcion varchar (100)\n   , Valor_unitario int\n   , Categoria_Id int not null constraint fk_Categoria references Categoria (CATEGORIA_ID)\n)\n\nCREATE TABLE Cliente\n(\n   CLIENTE_ID int not null primary key\n   , CLIENTE_PRIMER_NOMBRE varchar(50)\n   , CLIENTE_SEGUNDO_NOMBRE varchar(50)\n   , CLIENTE_PRIMER_APELLI varchar(50)\n   , CLIENTE_SEGUNDO_APELLI varchar(50)\n   , CLIENTE_DIRECCION varchar(90)\n   , CLIENTE_TELEFONO int\n   , CLIENTE_CIUDAD varchar(50)\n)\n</code></pre>\n"},{"tags":["sql","sql-server","metadata"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4542,"score":0,"question_id":2903262,"title":"Sql Query to list all views in an SQL Server 2005 database","body":"<p>I need an sql query to enumerate all views (I only need the view names) of a specific database in SQL Server 2005. Thanks in advance!</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13153255,"title":"How to do mutual comparison after group by in a SQL query?","body":"<p>I have a table <code>Information</code> which is something like this:</p>\n\n<pre><code>ID    From     To        Product          Date  \n1         A         B          ProdA         2012-10-01  \n2         A         B          ProdA         2012-10-13  \n3         A         B          ProdB         2012-10-17  \n4         A         B          ProdC         2012-10-18  \n5         A         C          ProdB         2012-10-02  \n6         A         C          ProdC         2012-10-04  \n7         A         C          ProdD         2012-10-12  \n8         A         C          ProdE         2012-10-14  \n9         A         D          ProdA         2012-10-11  \n10       A         D          ProdA         2012-10-14  \n</code></pre>\n\n<p>Let's call the combination of From and To a relationship. So (A,B) and (A, C) are relationships.<br>\nWhat I need to do is to find those relationships sending/receiving <strong>different</strong> products within a week time period. So in the above example the query is supposed to return:</p>\n\n<pre><code>A    B\nA    C\n</code></pre>\n\n<p>since these rows match:</p>\n\n<pre><code>2         A         B          ProdA         2012-10-13  \n3         A         B          ProdB         2012-10-17  \n4         A         B          ProdC         2012-10-18  \n\n5         A         C          ProdB         2012-10-02  \n6         A         C          ProdC         2012-10-04  \n\n7         A         C          ProdD         2012-10-12  \n8         A         C          ProdE         2012-10-14  \n</code></pre>\n\n<p>I know I should start from <code>SELECT ID, From, To, Product, Date FROM Information GROUP BY From, To</code> but I have no idea what's next. Any help please?</p>\n"},{"tags":["c#","sql-server","ef-code-first","entity-framework-5","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13141710,"title":"How can I perform additional DB initialization when using EF (5) Code First Migrations","body":"<p>I'm moving my ef-code-first application to the code-first-migrations model, and switching my database initializer from <code>DropCreateDatabaseIfModelChanges</code> to <code>MigrateDatabaseToLatestVersion</code>.</p>\n\n<p>In my original initializer, I was creating some user-defined functions, etc. and making changes to the database configuration (e.g. <code>SET AUTO_CLOSE OFF</code>). All of that stuff was achieved by executing SQL directly against the DB, since it's not supported via EF.</p>\n\n<p>Now that I've moved over to the migrations model, I'm attempting to do much the same, by adding code to the <code>Up</code> method of the generated <code>DbMigration</code> class. This code uses the <code>Sql</code> method to inject SQL. </p>\n\n<p>However, I'm getting various errors as a result, such as:</p>\n\n<ul>\n<li><p>My SQL to create the user-defined functions cause an error saying that the <code>CREATE FUNCTION</code> statement must be at the start of a batch.</p></li>\n<li><p>My <code>ALTER DATABASE</code> statement causes an error saying that it cannot be used inside a user transaction. (I don't create a transaction, but presumably there is one already started).</p></li>\n</ul>\n\n<p>How can I overcome this? In the <code>DbMigration</code>-derived class, I don't seem to have access to a DbContext, so I can't get at the database directly.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13153648,"title":"MSSQL - Return Select","body":"<p>I would like to prepare procedure which will take 2 arguments (Int, string) If some row will exist in table I will get @dane = 1; and in the end I would like to select @dane but my procedure is not good. I can not use return @dane. </p>\n\n<pre><code>    USE [SS]\n    GO\n\n    SET ANSI_NULLS ON\n    GO\n    SET QUOTED_IDENTIFIER ON\n    GO\n\n    CREATE PROCEDURE [permission].[CheckSkill] \n(\n    @SkillId INT, -- Identyfikator uytkownika \n    @Description NVARCHAR(100) = NULL\n)\nAS\nBEGIN\n    SET NOCOUNT ON;\n    DECLARE @dana as int\n    SET @dana = 0\n\n    -- this is redundant:\n    --SET @Description = RTRIM(LTRIM(ISNULL(@Description,'')))\n\n    IF EXISTS (SELECT * FROM permission.UserXSkill Where permission.UserXSkill.SkillId = @SkillId)\n    BEGIN\n      SET @dana = 1;\n    END\n\n    SELECT @dana AS ID;\nEND\nGO\n</code></pre>\n\n<p>Topic [closed] Thanks for help.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13153235,"title":"Dynamic backup file name","body":"<p>I use <code>SQL Server 2008 R2</code> and want to use <code>Backup Devices</code> for create backup of my database in each day. How can I create dynamic file name in `Backup Devices'.</p>\n\n<p>In below code I Create a Backup Devices but want to have Current Date (YYYY-MM-DD) in my backup file.</p>\n\n<pre><code>EXEC master.dbo.sp_addumpdevice  @devtype = N'disk', @logicalname = N'My Database Backup Location', @physicalname = N'D:\\Backup\\Backup YYYY-MM-DD.bak'\n</code></pre>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","iis6","telnet","database-administration"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13153485,"title":"Telnet failed from App server to sql server DB server intermittently","body":"<p>recently I noticed one interesting issue in production server. We have 1 app server IIS asp .net framework and 1 sql server 2008 installed DB server.</p>\n\n<p>During peak time when I try to telnet my db server on 1433 its keep getting failed but sometimes its get connected. Both these servers are blade server and are in same chassis. No network firewall is in between all the two servers.</p>\n\n<p>Also in application logs its shows error like </p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occurred while\n  establishing a connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote ... Provider, error: 40 -\n  Could not open a connection to SQL Server)</p>\n</blockquote>\n\n<p>I checked number of connection on my db using command </p>\n\n<pre><code>SELECT  COUNT(dbid) as TotalConnections \nFROM sys.sysprocesses \nWHERE  \ndbid &gt; 0 \n</code></pre>\n\n<p>its approximately to 140-150 connections we have multiple databases (~100) on it.</p>\n\n<p>I will appreciate if any body can help me in troubleshooting this issue.</p>\n"},{"tags":["sql-server","stored-procedures","permissions"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1681,"score":3,"question_id":5109581,"title":"Granting execute permission on all stored procedures in a certain database","body":"<p>As the title suggests, I need to grant the execute permission on every stored procedure in a database. We've moved from test to production and have less control over the production database.. and all of the imported stored procedures got zero permissions right now. An interesting thing to know is if there is any way to make sure all of the imported stored procedures get execute permissions from the beginning?</p>\n\n<p>Thanks for any help.</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13152815,"title":"How to insert numbers in words for the numeric value using triggers in sql?","body":"<p>I need to get the amount in words automatically after I enter the amount in numeric.</p>\n\n<p>eg: If I enter 2500, It should be automatically insert in the next field as Two thousand five hundred. </p>\n\n<p>Is it possible in sql server pls guide with explanation. Thanks.</p>\n"},{"tags":["sql-server","pagination","paging"],"answer_count":9,"favorite_count":32,"up_vote_count":42,"down_vote_count":0,"view_count":19764,"score":42,"question_id":109232,"title":"What is the best way to paginate results in SQL Server","body":"<p>What is the best way (performance wise) to paginate results in SQL Server 2000, 2005, 2008 if you also want to get the total number of results (before paginating)?</p>\n"},{"tags":["sql","sql-server","performance","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":13140520,"title":"Simple SQL Server query across databases runs extremely slow R2","body":"<p>I have two databases on a local machine, connected to <code>localhost</code>.  They both have roughly two million rows a piece.  I was doing the following very simple join and it took over a minute to complete.  </p>\n\n<pre><code>select distinct x.patid\n    from [i 3 sci study].dbo.clm_extract as x\n    left join [i 3 study].dbo.claims as y on y.patid=x.patid\n    where y.patid is null\n</code></pre>\n\n<p>When I looked at the execution plan I saw that the join showplan operator had this to say\n<img src=\"http://i.stack.imgur.com/eQAu6.jpg\" alt=\"enter image description here\"></p>\n\n<p>Why is the actual number of rows so exorbitantly high compared to the actual number of rows in both tables?</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":13152887,"title":"Inserting a Row in a Table from Select Query","body":"<p>I'm using two Stored Procedures and two Table in My Sql Server.</p>\n\n<p>First Table Structure.</p>\n\n<p><img src=\"http://i.stack.imgur.com/kdhvO.jpg\" alt=\"enter image description here\"></p>\n\n<p>Second Table Structure.</p>\n\n<p><img src=\"http://i.stack.imgur.com/6C43X.jpg\" alt=\"enter image description here\"></p>\n\n<p>When a Customer books a Order then the Data will be Inserted in Table 1.</p>\n\n<p>I'm using a Select Query in another Page Which Selects the Details from the Second Table.</p>\n\n<p>If a row with a billno from first table is not Present in Second Table I want to Insert into the Second Table with some Default Values in the Select Query. How can I do this\n??</p>\n"},{"tags":["sql-server","asp.net-mvc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13146288,"title":"Month and Year Part from GetDate","body":"<p>I am using a gridview in my asp.net application in which i want to limit the dataset to requests that are submitted in the current month and year</p>\n\n<p>Iam new to application development and thinking in the below way</p>\n\n<p>to get the month and year part from the getdate() function and then compare it with the month and year of the receiveddate column in our table in the where condition</p>\n\n<p>My select statement would be like below</p>\n\n<p>select requestno,receiveddate,businessneed from customerrequests\nwhere receiveddate = getdate()</p>\n\n<p>in the above sql statement how do i acheive </p>\n"},{"tags":["asp.net","sql-server","iis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13152623,"title":"DB Connection ERROR after publishing the web application in IIS 6","body":"<p>After publishing web application in IIS 6 I am getting follwoing error</p>\n\n<pre><code>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server) \n</code></pre>\n\n<p>It runs fine in development server with same DB connection</p>\n\n<p>Please help me</p>\n"},{"tags":["c#","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":56,"score":5,"question_id":13047940,"title":"Issue Related to where clause in SQL Server","body":"<p>I have a table name Students having (studentId, StudentName,Address,PhoneNo)</p>\n\n<p>i have provided a filter for user to select only StudentId from Combobox to get the details of Students... and generate Report.</p>\n\n<p>I have written following Query to get student Detail :</p>\n\n<pre><code>(select * from Students where StudentId = stdId)\n</code></pre>\n\n<p>Here stdId is a Parameter that i pass from code</p>\n\n<p>It works fine if i select single studentId.... But in user selection Comobobox i have also provided <code>\"ALL\"</code>  if user Select <code>All</code> from combobox i want to display details of all student</p>\n\n<p>So what should I pass in <code>stdId</code> if user selects <code>All</code>  ?</p>\n\n<p>I used inline Query in C# (not using SQL Stored Procedure)</p>\n"},{"tags":["sql-server","performance"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":423,"score":0,"question_id":2042484,"title":"Ways to improve sql server query optimizer results","body":"<p>The question is quite simple: <b>What can I do to make sure that the SQL Server query optimizer has all the information it needs to choose the \"best\" query plan?</b></p>\n\n<p>The background of this question is that recently we've run into more and more cases where SQL Server chooses a bad query plan, i.e., cases, where adding query hints, join hints or explicitly using temporary tables instead of \"one big SQL\" drastically improved performance. I'm actually quite surprised that the query optimizer delivers such a lot of bad results, so I'm wondering whether we did something wrong. No indexes are missing (according to query analyzer and common sense), and statistics are updated frequently by a maintainance task.</p>\n\n<p>Let me emphasize that I am not talking about missing indexes here! I'm talking about the situation where there is a \"good\" and a \"bad\" query plan (given the current state of the DB), and SQL Server chooses a \"bad\" plan although the indexes present would allow it to use a \"good\" plan. I'm wondering whether there is some possibility to <em>improve</em> the results of the query optimizer without having to optimize all queries manually (with query hints or USE PLAN).</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13149601,"title":"How can I update by one UPDATE statement in SQL server for the following scenario?","body":"<p>How can I update by one UPDATE statement for the following scenario?\nI have 2 tables. The TableA contains the following fields:\nTestNumber, CO, CO2, N20, CH4\nand the value of TestNumber column is 1, 2, 3</p>\n\n<pre><code>TableA\n\nTestNumber      CO      CO2     N2O     CH4  \n 1                                                              \n 2                                                              \n 3  \n</code></pre>\n\n<p>The second table named TableB contains the following fields:\nTestNumber, TestIdentifier, TestValue\nand the values are the below:</p>\n\n<pre><code>TableB\n\nTestNumber      TestIdentifier  TestValue      \n 1                 CO           12.3   \n 1                 CO2          10     \n 2                 CO           9.8    \n 2                 N20          45     \n 3                 CO           12.5   \n 3                 CO2          13.0  \n</code></pre>\n\n<p>IM EXPECTING THE RESULT AS:</p>\n\n<pre><code>TestNumber      CO      CO2     N2O     CH4   \n 1              12.3    10                                             \n 2              9.8             45                                     \n 3              12.5    13.0        \n</code></pre>\n\n<p>I did it using a chunk of code like, declare table variable. Then store data from TableB to the table variable. Then SET rowCount =1 then looping and deleting one row and update the TableA which work perfect. I got my expected result. But I believe I can do direct UPDATE command without too many table variables declaration and looping. Im updating though but not directly.</p>\n\n<p>I want to learn how I can update directly without looping.</p>\n\n<p>Reply to: </p>\n"},{"tags":["c#","sql-server","petapoco"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13152185,"title":"PetaPoco transaction isolation level","body":"<p>I have a c# windows service which updates data in my database using <a href=\"http://www.toptensoftware.com/petapoco/\" rel=\"nofollow\">PetaPoco</a>, all wrapped into a transaction. However, I need the database to be available for queries while the transaction runs (web app, running queries through an ODBC connection), but if queried while the transaction is being committed, I get a \"Catastrophic failure\" error from my database. Currently testing against MS SQL Server, but also need this working against Oracle databases. </p>\n\n<p>Is there any way to set the transaction isolation level for PetaPoco transactions, and could this be the solution in this case? </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13137052,"title":"Error in running scheduled Job. Where to find error details","body":"<p>I want to delete row in SQL database when a column value matches with current date.\nI have created a scheduled job for deletion of data using SQL Server Management Studio. I have followed step as shown in <a href=\"http://www.youtube.com/watch?v=De_GOwnTDjo\" rel=\"nofollow\">Video</a> \nHere Type of script is T-SQL and command I have given is:</p>\n\n<pre><code>Delete from NewDB.dbo.Datetabel where Date=getDate();\nCOMMIT\n</code></pre>\n\n<p>I want to schedule this job on daily basis. But now for testing purpose I have given on hourly basis. But this job is failed.</p>\n\n<p>Where will I get the details of Error. I am working on sql2008 r2</p>\n\n<p>What should be reason for failure?\nEdited:\nNow job is getting success when code is  changed as:</p>\n\n<pre><code>BEGIN TRAN \nDelete from NewDB.dbo.Datetabel where Date=getDate();\nCOMMIT;\n</code></pre>\n\n<p>But Data is not deleted from the tabel.\nWhat may be issue now?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":13150356,"title":"How to display the first row, depending on a value","body":"<p>I am supposed to build a query that displays if a product passed quality test the first time. for example if product# 1234 fails the first test then don't display the value. I am running SQL Server 2005. I am thinking maybe using a <code>COALESCE</code> statement, or case when statement, any help would be appreciated. here is some sample data:</p>\n\n<pre><code>product#  test result   datetime\n1102494    Fail         20111129:07:57:50.203\n1102494    pass         20111130:16:48:28.140\n1102496    pass         20111129:11:09:32.140\n1102498    pass         20111129:08:21:10.218\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13151782,"title":"A network-related or instance-specific error occurred while establishing a connection to SQL Server","body":"<p>I have 2 applications, one is using Enterprise Library and second is using <code>asp:SqlDataSource</code> control to connect to the database. In the second application I am able to connect to the database. However in the first application where I am using Enterprise Library I am not able to connect to the database and I keep getting the following error</p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while establishing a   connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: Named\n  Pipes Provider, error: 40 - Could not open a connection to SQL Server)</em></p>\n</blockquote>\n\n<p>Also I am able to connect to the database using SQL Server 2008 client</p>\n\n<p>Connection string</p>\n\n<pre><code>&lt;add name=\"Connection String\" \n     connectionString=\"Data Source=inblrgescintra\\intranet;Initial Catalog=Intranet1.0;Persist Security Info=True;uid=***;pwd=*****;Integrated Security=False;\" \n     providerName=\"System.Data.SqlClient\"/&gt;\n</code></pre>\n\n<p>Please help me</p>\n"},{"tags":["c#","sql-server","webforms","controls","custom-controls"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13136511,"title":"How to control create from db information","body":"<p>My project have more than one pages. Suppose in one page user  need to add new control it may be any controls <strong>like: DDL/ TextBox /Button</strong> , User has this <strong>flexibility</strong> to  configure this control.My project has one <strong>configuration</strong> page ,there user create this custom control for specific page.In configuration page User defined bellow information</p>\n\n<pre><code>1)Control type.\n2)control datasource\n3)ControlDisplay properties\n4)Control  transaction stored tables and  columns(table and columns are  already created).\n5)In UI ,Store  custom control view position related information.\n6)Custom control action method(suppose user set textbox ,its show sum of two column of any \n</code></pre>\n\n<p>specific table ,user must define the action procedure)</p>\n\n<p>To serve  above information I use bellow tables but those tables stored information failed to fulfill my requirement</p>\n\n<p><img src=\"http://i.stack.imgur.com/wT1OG.png\" alt=\"enter image description here\"></p>\n\n<p>Please don't show me syntax like bellow,i know how to add dynamic controls in ui,I need to store control related information in db ,then base on those information need to create control.Help me to store  control related information's like action/method procedure, view position on ui,control view information ,control datasource etc,in a word control related all information </p>\n\n<pre><code>Button button1=new Button();\nbutton1.Text=\"dynamic button\";\nbutton1.Left=10; button1.Top=10;  //the button's location\nthis.Controls.Add(button1);\n</code></pre>\n\n<p>Need help to set custom control and control related information ,if anybody have better idea or any type of suggestion to solve this issue ,I will be thank full to him for his valuable information ,any type of information will be acceptable .If have any query please ask ,thanks in advanced.</p>\n"},{"tags":["sql-server","netbeans","database-connection"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2574,"score":1,"question_id":8230095,"title":"NetBeans 7 to MS Sql Server 2008R2 Connection","body":"<p>I'm looking for an easy way to connect my NetBeans application to an SQLServer 2008 R2 database...\nI tried with JDBC:ODBC but this doesn't work... I tried other ways but appears to be deprecated or too old for the jre 1.7...</p>\n\n<p>Does anybody have any suggestion? I'm googlig for hours but nobody talks about it, the only things i found are about SQL Server 2000 an other ancient systems!</p>\n\n<p>Thank you very much!</p>\n"},{"tags":["c#","sql-server","sql-server-2012","sqldatatypes","sqlclient"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13151280,"title":"Dealing with spatial datatypes in SQL Server 2012 tables","body":"<p>Some background:</p>\n\n<p>I'm running two different installations of SQL Server on two different VMs. I'm attempting to connect to them from my code (which was written for SQL Server 2008 R2). My current .NET framework version is 4.0. My Microsoft SQL Server 2008 R2 installation is running the AdventureWorks designed for it, and my SQL Server 2012 Express installation is running the newer AdventureWorks2012 database. I'm querying Person.Address.</p>\n\n<p>Currently I'm running into an exception saying \"DataType cannot be null\". I've deduced from looking at the returned schemas that the problem comes from SQL Server 2012 returning a </p>\n\n<p>Microsoft.SqlServer.Types.SqlGeography</p>\n\n<p>datatype. It seems that Type.GetType cannot convert this to something usable and throws an exception. I'm relieved that it's nothing that I've done, but I'm also puzzled because this code should work universally. Keep in mind this code runs flawlessly on SQL Server 2008 R2 (because it lacks the spatial datatype). </p>\n\n<p>I could think of 100 bad ways to handle this. However I wanted to come to you guys for suggestions on what to do. Will upgrading .NET to 4.5 remedy the situation? Do I have to change my code at all to accommodate the new datatype? Should I worry about the spatial datatypes if my application doesn't deal with them? How do I handle this, because obviously SqlClient and Type.GetType don't do a good job at it.</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13151274,"title":"How to achieve Customized replication function?","body":"<p>This is my issue. </p>\n\n<p>I have a server DB and a local SQL Express DB installed on few clients. For every 2 hours I need to pull records from server DB to local DB. But the catch is I want values from the server DB to start from a specific number and then till the end of the records that are available.</p>\n\n<p>Say for example:</p>\n\n<p>Server DB has following data.</p>\n\n<p>10\n20</p>\n\n<p>On the Local DB I have </p>\n\n<p>10\n20</p>\n\n<p>After 2 hours I the Server DB will have</p>\n\n<p>10\n20\n30\n40\n50</p>\n\n<p>My local DB after 2 hours should copy the value from 30 - 50.</p>\n\n<p>I have seen this link <a href=\"http://stackoverflow.com/questions/11075905/how-do-i-achieve-this-sort-of-replication\">How do I achieve this sort of replication?</a> but it I haven't yet given a full thought as my architecture is different to use Transactional replication at this point of time.</p>\n\n<p>At present I plan to get the data from Server DB to a DATASET and then dump it on to my local DB.</p>\n\n<p>Any suggestions on this is highly appreciated.</p>\n"},{"tags":["sql","sql-server","algorithm"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":13132270,"title":"How to select similar sets in SQL","body":"<p>I have the following tables:</p>\n\n<pre><code>Order\n----\nID (pk)\n\nOrderItem\n----\nOrderID (fk -&gt; Order.ID)\nItemID (fk -&gt; Item.ID)\nQuantity\n\nItem\n----\nID (pk)\n</code></pre>\n\n<p>How can I write a query that can select all <code>Orders</code> that are at least 85% similar to a specific <code>Order</code>?</p>\n\n<p>I considered using the <a href=\"http://en.wikipedia.org/wiki/Jaccard_index\" rel=\"nofollow\">Jaccard Index</a> statistic to calculate the similarity of two <code>Orders</code>. (By taking the intersection of each set of <code>OrderItems</code> divided by the union of each set of <code>OrderItems</code>)  </p>\n\n<p>However, I can't think of a way to do so without storing the computed Jaccard Index for each possible combination of two <code>Orders</code>.  <strong>Is there another way?</strong></p>\n\n<p>Also, is there a way to include the difference in <code>Quantity</code> of each matched <code>OrderItem</code> into account?</p>\n\n<p><strong>Additional Info:</strong></p>\n\n<hr>\n\n<p>Total <code>Orders</code>: ~79k<br>\nTotal <code>OrderItems</code>: ~1.76m<br>\nAvg. <code>OrderItems</code> per <code>Order</code>: 21.5<br>\nTotal <code>Items</code>: ~13k</p>\n"},{"tags":["sql","sql-server","iis","web-applications","iis7"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13149683,"title":"Connecting to SQL Database from IIS","body":"<p>This is my connection string, which the web service (hosted in IIS, running under ApplicationPoolIdentity) uses to connect to database</p>\n\n<pre><code>&lt;add name=\"AdventureWorksEntities\"connectionString=\"metadata=.\\AdventureWorks.csdl|.\\AdventureWorks.ssdl|.\\AdventureWorks.msl;\nprovider=System.Data.SqlClient;provider connection string='Data Source=TestMachine;Initial Catalog=AdventureWorks;\nIntegrated Security=True;Connection Timeout=60;multipleactiveresultsets=true'\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>When I try to access the site I am getting an exception: Login Failed for user MyDomain\\TestMachine$.</p>\n\n<p>Why is IIS trying to use TestMachine to connect and not my user account (e.g MyDomain\\TestUser) ?\nThe reason I believe could be because its hosted under ApplicationPoolIdentity which uses machine creds. </p>\n\n<p>How do I specify it to use the context of the user that made the request without having to run the application under custom identity (i.e I want it to continue running under ApplicationPoolIdentity)?</p>\n\n<p>If  I set <code>&lt;identity impersonate = true/&gt;'</code> in my web.config file then I am able to access the site locally from IIS server machine and access to database works but then accessing the site remotely fails. My Webservice is using Windows Authentication. Any thoughts on this ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":44,"score":0,"question_id":13149232,"title":"How do I extract a substring from a random position in a string using built-in functions?","body":"<p>I have a series of data stored in the following fashion:</p>\n\n<pre><code>Word of various kinds (ANT\\username1) and even more words\nThis is another row, the words are random (ANT\\username2)\nThankfully the username only ever shows once (ANT\\username1)\n</code></pre>\n\n<p>Above represents three seperate rows. </p>\n\n<p>The general flow of this data is:</p>\n\n<ul>\n<li>Parenthesis can appear anywhere in the text</li>\n<li>The username portion of each string (ANT\\usernamex) will only ever appear once</li>\n<li>The text preceeding and proceeding the username portion is always different lengths.</li>\n<li>The username text may not always be present</li>\n</ul>\n\n<p>As you probably already guessed what I need to do is take the username from each row and where it isn't present return null. Unfortunately I have no idea how to approach this - I've played around with left() and right() functions but don't really know how else to tackle this. Would appreciate if any answers that use a number of functions to accomplish the task have a quick blurb explaining the flow of logic (so I can then read the documentation for the functions to learn).</p>\n"},{"tags":["sql","sql-server","sql-server-2005","replication"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":56,"score":0,"question_id":13082881,"title":"sql table with identity in merge replication","body":"<p>I have a table in SQL Server 2005 and I have an IDENTITY(1,1) property set for an ID column.  Records are inserted in a table at a local server as well as a remote server.  I am using Merge Replication to match the data from local server and remote server.</p>\n\n<p>What happens if I insert the same ID at the local server and the remote server?</p>\n\n<p>Please suggest what am I doing wrong here.</p>\n"},{"tags":["sql-server","sql-server-2008","reporting-services","ssrs-2008","ssrs-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13148997,"title":"SQL Reporting Services Express Edition very slow even with no data","body":"<p>Am trying to figure out why our SSRS execution is so slow.  The home page takes about 10 seconds to load/refresh and reports take 12-15 seconds just to render to the 'Enter Parameter Settings' stage.  </p>\n\n<p>I have created a report with a single text box - no data connections - no data-set - so ZERO database access and yet it still consistently takes 12 seconds to render - A SINGLE TEXT BOX WITH NO DATABASE ACCESS!  Every single click in the report engine takes 12-15 seconds to respond to - which makes it quite painful to work with real data.</p>\n\n<p>The database and an IIS installation is also included on the same machine - but they are only accessed by a couple of users (nothing public) - so the machine isn't under a lot of load.  All other services on this box are responding quickly: The IIS installation is serving up web-service requests quickly and responsively - within a split-second.  And all database queries are running at a very speedy rate - consistent with the generous hardware on this box.</p>\n\n<p>It doesn't seem to be related to 'First Request' spooling up - this is happening on all requests.</p>\n\n<p>All the other answers relating to SSRS speed issues seem to be related to database query tuning and parameter handling - but this 'no-data' test report seems to be pointing to something wrong within the SSRS installation/execution itself.  </p>\n\n<p>Any help?</p>\n"},{"tags":["sql-server","authentication","iis-7.5"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13105747,"title":"Web site access to SQL Server inside and outside of a domain","body":"<p>This time I have a very strange problem. Already spent 3 nights on the problem and it keeps going. Not sure if Stack is the best place for this question, also can be actual on DBA or Serverfault. If it should be moved, please move.</p>\n\n<p>I am migrating all company applications to the new servers. Now we are getting Windows 2008 servers with SQL Server 2008 R2. </p>\n\n<p>There is a web application based on classic ASP (full of wtf's) that is using SQl Server as a storage. \nIn the new set-up ASP web-site is on Web-server, SQL Server 2008 is on another machine. All the servers are in the domain. \nI had a big trouble connecting that web-site to SQL Server. Got it done by using a domain user  as user to run the application pool. \nSo whenever I use that web-site within domain, I get everything working fine.</p>\n\n<p>The problem starts whenever I go to outside of the domain (from my home computer). The web-application is rejected the connection to the SQL Server. Application pool is not configured to use pass-through authentication, AppPool is using the same user as the web-site. </p>\n\n<p><img src=\"http://i.stack.imgur.com/seEKN.png\" alt=\"Application Pool configuration\"></p>\n\n<p><img src=\"http://i.stack.imgur.com/PE8aB.png\" alt=\"Process Monitor shows denied access to the named pipes when connecting from the outside of the domain\"></p>\n\n<p>I have used ProcMon (from sysinternals) to figure out what happens. And it shows that connection to the SQL Server (via named pipe) is just denied when request to the web-site comes from outside of the domain. </p>\n\n<p>I have used fiddler to compare the HTTP requests and both requests are the same, no domain authorisation or any information is passed to IIS from within of the domain. </p>\n\n<p><strong>The questions are: WHY this happens and how to make it stop??</strong></p>\n\n<p>Any ideas are appreciated. I'm stuck as never been before.</p>\n\n<p><strong>UPDATE</strong>: Figured it out today. Firewall was forcing to use Named Pipes connection instead of TCP. And Named Pipes are just not the same as usual TCP connection. </p>\n"},{"tags":["sql-server","sql-server-2008","tsql","pivot","pivot-without-aggregate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":63,"score":-1,"question_id":13142554,"title":"X number of Rows into X number of Columns","body":"<p>I need your help again for the following. Please note that I am using SQL SERVER 2008.\nI have a table (below) where we got Number of jobs done from the \"Pickup\" to the \"Dropoff\".\nThe requirements are (output format mentioned below).\n1) Get all the unique postcodes regardless of them being dropoffs or pickups. This will give us all the postcodes.\n2) Present the count of jobs done from PICKUP to the corresponding DROPOFF. For example, we pick passengers up from SE18 postcode twice and took them to SE18 once and SE19 once. It will be cleared from the REQUIRED OUTPUT table.</p>\n\n<pre><code>TABLE:\nJobID        Pickup       Dropoff\n====================================\n1            SE18         SE18\n2            SE18         SE19\n3            SE2          SE18\n4            SE28         SE2\n5            AL1          SE7\n6            BR1          SE10\n7            NW1          TW16\n8            AL1          SE18\n9            BR6          AL1\n10           E6           BR1\n.            .            .\n.            .            .\n.            .            .\n</code></pre>\n\n<p>The require output is as the following:</p>\n\n<pre><code>REQUIRED OUTPUT\n\n     SE18   SE2   SE28   AL1   BR1   NW1   BR6   E6   SE19  SE7  SE10  TW16 ..\n     =========================================================================\nSE18   1     -      -     -     -     -     -     -     1    0    0     0\nSE2    1     -      -     -     -     -     -     -     -    -    -     -         \nSE28   -     1      -     -     -     -     -     -     -    -    -     -          \nAL1    1     -      -     -     -     -     -     -     -    1    -     -       \nBR1    -     -      -     -     -     -     -     -     -    -    1     -        \nNW1    -     -      -     -     -     -     -     -     -    -    -     1      \nBR6    -     -      -     1     -     -     -     -     -    -    -     -       \nE6     -     -      -     -     1     -     -     -     -    -    -     -       \nSE19   -     -      -     -     -     -     -     -     -    -    -     -        \nSE7    -     -      -     -     -     -     -     -     -    -    -     -       \nSE10   -     -      -     -     -     -     -     -     -    -    -     -      \nTW16   -     -      -     -     -     -     -     -     -    -    -     -      \n.\n.\n.\n</code></pre>\n\n<p>Many thanks in advance.\nKind regards</p>\n"},{"tags":["sql-server","primary-key","index"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2028,"score":1,"question_id":3292067,"title":"Default Index on Primary Key","body":"<p>Does the SQL Server build an index on primary keys by default?\nIf yes what kind of index? If no what kind of index is appropriate for selections by primary key?</p>\n\n<p>I use SQL Server 2008 R2</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":13148106,"title":"SQL Server Instead of Update Trigger Using Update 'Where' Clause Values","body":"<p>I think I'm close on this one, I just can't seem to get it right.  I've also looked through a lot of questions and answers and either I can't find the answer or I don't understand the questions of others so, please forgive if this is a re-post.</p>\n\n<p>What I want to do seems pretty basic as far as the idea of an \"Instead Of\" trigger goes.  I'm working in SQL Server 2008.  I have a view that can't be updated directly so I need an Instead Of Update trigger to update one of the underlying tables.  The primary key of the table in questions will not be included as part of the Update statement so I have to select using a foreign key.  </p>\n\n<p>I'm trying to get the foreign key supplied in the Where clause of the Update statement but I must be using the wrong syntax.  I'm pretty sure that I must be able to get 'Where' values since they seem likely to be used as keys to underlying tables.  So, given the statement...</p>\n\n<pre><code>UPDATE table1 SET field1 = 'value1' WHERE key_field = 'key_value'\n</code></pre>\n\n<p>How do I access get the 'key_value' inside my trigger definition?  I've tried the following...</p>\n\n<pre><code>DECLARE @pk INT\nSELECT @pk = p_key\n  FROM dbo.ptable p, UPDATED u\n WHERE p.f_key = u.key_field\n</code></pre>\n\n<p>And this as well...</p>\n\n<pre><code>DECLARE @pk INT\n SELECT @pk = p_key\n   FROM dbo.ptable\n  WHERE f_key = (SELECT key_field\n                   FROM UPDATED)\n</code></pre>\n\n<p>But neither of these seem to work for me.  I'm pretty sure I'm getting the update value correctly using...</p>\n\n<pre><code>DECLARE @uValue VARCHAR\nSELECT @uValue = field1\n  FROM UPDATED\n</code></pre>\n\n<p>I want to be able to use the derived primary key for an insert or update like this...</p>\n\n<pre><code>INSERT INTO dbo.xtable (fieldx) VALUES (@uValue) WHERE p_key = @pk;\n</code></pre>\n\n<p>or</p>\n\n<pre><code>UPDATE dbo.xtable SET fieldx = @uValue WHERE p_key = @pk;\n</code></pre>\n\n<p>Hopefully, I'm making sense and I'm not too far off.  Thanks for your help.</p>\n"},{"tags":["sql","sql-server","aggregate-functions","median"],"answer_count":15,"favorite_count":13,"up_vote_count":37,"down_vote_count":0,"view_count":37331,"score":37,"question_id":1342898,"title":"Function to Calculate Median in Sql Server","body":"<p>According to <a href=\"http://msdn.microsoft.com/en-us/library/ms173454.aspx\" rel=\"nofollow\">MSDN</a>, Median is not available as an aggregate function in Transact-Sql. However, I would like to find out whether it is possible to create this functionality (using the <a href=\"http://msdn.microsoft.com/en-us/library/ms182741.aspx\" rel=\"nofollow\">Create Aggregate</a> function, user defined function, or some other method). </p>\n\n<p>What would be the best way (if possible) to do this - allow for the calculation of a median value (assuming a numeric data type) in an aggregate query?</p>\n"},{"tags":["sql-server","sql-server-2005","dbo"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":18,"score":2,"question_id":13147695,"title":"SQL Server dbo permissions for specified databases","body":"<p>Can I assign SQL Server dbo permissions to a user, so it applies only for specified databases on a server?  Currently using SQL Server 2005.</p>\n"},{"tags":[".net","sql-server","c#-4.0","windows-services","google-bigquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":13133693,"title":"Inserting a record in BigQuery table via windows service","body":"<p>I've created a windows service that communicates with the Google BigQuery API perfectly using Service Account authorization. For testing purposes, I'm able to fetch data from a BigQuery table to check communication between my Windows service and the BigQuery API. But this service will basically fetch records from MSSQL server and then one by one will insert or append a record to the target table in BigQuery. I don't want to use CSV or JSON files as a data source. Is there any way of doing so?</p>\n"},{"tags":["sql","sql-server","identity"],"answer_count":8,"favorite_count":6,"up_vote_count":10,"down_vote_count":0,"view_count":3546,"score":10,"question_id":1920558,"title":"What is the difference between Scope_Identity(), Identity(), @@Identity, and Ident_Current?","body":"<p>I know Scope_Identity(), Identity(), @@Identity, and Ident_Current all get the value of the identity column, but i would love to know the difference.</p>\n\n<p>Part of the controversy i'm having is what do they mean by scope as applied to these functions above?</p>\n\n<p>I would also love a simple example of different scenarios of using them?</p>\n"},{"tags":["sql-server","sql-server-2008","deprecated"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":625,"score":3,"question_id":5076791,"title":"How to replace REVOKE ALL in SQL Server 2008 R2","body":"<p>How do I replace the <strong>ALL</strong> permission now that it has been revoked: </p>\n\n<pre><code>REVOKE ALL ON dbo.MyObject TO MyUser\n</code></pre>\n\n<p>I'm looping through all the objects in a database and revoking all permissions for a specific user. So if I had to be specific about which permission to revoke, it would be a real hassle because I would have to find out what object I have and then revoke every possible permission for that type of object. Instead of just REVOKE ALL.</p>\n"},{"tags":["java","php","javascript","css","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":70,"score":-5,"question_id":13147460,"title":"Best Java Based technologies for searching huge Intranet Log data in my Company","body":"<p>Our company has huge log data of our employees. we have built the application to search for this employee activity in vpn, e-mail and other activities to track any misuse of our network.</p>\n\n<p>Existing application is using PHP html css and java script. We are looking to develop the next gen version of this application and evaluating frameworks we are <strong>thinking of replacing php with java</strong>. We have very huge data because our system logs every event occurring on our net work. Right now we are using Microsoft SQL Server, Tomcat web server for our application.</p>\n\n<p>we want o build very powerful application which can search terabytes of log event data in seconds we need advanced servers and front end technologies.</p>\n\n<p>we want this next gen application to be better in performance, maintainability, extend-ability, ease of use and scalability.</p>\n\n<p>I would appreciate any good suggestion or recommendation of any new technologies for back-end and front-end development for the above requirement.</p>\n"},{"tags":["sql-server","powershell","scripting"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":13146121,"title":"SQL Server : find and update column in Table 1 with Information from Table 2","body":"<p>I am new to all of this and have just began scripting/programming in general. I have searched high and low and tried several things, but I have had no success. What I am trying to do</p>\n\n<ul>\n<li><code>Table1</code> has <code>Column1</code></li>\n<li><code>Table2</code> has <code>Column2</code></li>\n</ul>\n\n<p>Within these columns are file paths. <code>Column1</code> file path will be <code>\\\\\\server1\\folder\\video1.avi</code>,\n<code>Column2</code> file path will be <code>http://server2/folder/video1.mpg</code></p>\n\n<p>What I am trying to do is query <code>Table1</code> with <code>Table2</code> and match the name of the file, in this case <code>video1</code>. This file name will always be different, thus will need something so it finds part of the string by itself. Once the match is made I need <code>Table1</code> to update <code>Column1</code> so that it matches exactly what is in <code>Table2.Column2</code>. When the change has been made and the rest of my program has finished running, all the data in <code>Table2</code> will be deleted, but I still need <code>Table1.Column1</code> to be changed permanently and not revert back to the old file path.</p>\n\n<p>Thanks in advance for any help!</p>\n\n<p>EDIT:</p>\n\n<p>Here is the filename for our database:</p>\n\n<p>5149__20121030_120839.avi which will be converted to 5149__20121030_120839.mpg\nAt any given point in time the beginning of the filename will range from 5100 to 5999 the rest of it will change randomly. How I currently have things setup:</p>\n\n<p>I am grabbing file names and saving them to a csv file. From there I am uploading this csv file into <code>Table2.Column2</code>. It is at this point in time where I am stuck on querying part of the file path to find a match in <code>Table1.Column1</code>. One a match is found I am trying to update the whole string in <code>Table1.Column1</code> to match what I have in <code>Table2.Column2</code>. After it is all said and done with I will delete <code>Table2.Column2</code>, any files that were moved, and start over the next day.</p>\n\n<p>I have been searching all over and found a few things to try, but no luck as of yet. The closest I have come is this:</p>\n\n<p><code>UPDATE Table1\nSET Table1.Column1 = Table2.Column2\nFROM Table1\nFULL JOIN Table2 ON Table2.Column2 like '%' + Table1.Column1 + '%'</code></p>\n\n<p>Whenever I run this though, it takes <code>Table1.Column1</code> and sets everything to NULL instead of replacing what is in <code>Table2.Column2</code>. This was just a test in my lab to see if it would work, I had not even begun researching on how to match part of a string yet between two different tables.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13146304,"title":"How to Select Every Row Where Column Value is NOT Distinct","body":"<p>I need to run a select statement that returns all rows where the value of a column (i.e. EmailAddress) is not distinct.</p>\n\n<p>For example, if the table looks like below:</p>\n\n<pre><code>CustomerName     EmailAddress\nAaron            aaron@gmail.com\nChristy          aaron@gmail.com\nJason            jason@gmail.com\nEric             eric@gmail.com\nJohn             aaron@gmail.com\n</code></pre>\n\n<p>I need the query to return:</p>\n\n<pre><code>Aaron            aaron@gmail.com\nChristy          aaron@gmail.com\nJohn             aaron@gmail.com (peer edited from john@gmail.com)\n</code></pre>\n\n<p>I have read many posts and tried different queries to no avail.  The query that I believe should work is below.  Can someone suggest an alternative or tell me what may be wrong with my query?</p>\n\n<pre><code>select EmailAddress, CustomerName from Customers\ngroup by EmailAddress, CustomerName\nhaving COUNT(distinct(EmailAddress)) &gt; 1\n</code></pre>\n"},{"tags":["sql-server","dynamics-crm-2011"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12979617,"title":"CRM 2011 EmailHashBase","body":"<p>I have just upgraded to CRM 2011 from 4.0, and I'm seeing a lot of errors in the application log, I think owing to the email router. The error text is \"Query execution time of 30.0 seconds exceeded the threshold of 10 seconds\".  </p>\n\n<p>Here's the query it's executing:</p>\n\n<pre><code>WITH Candidates\n        (\n            ActivityId\n        ) AS\n        (SELECT  ActivityId\n        FROM     EmailHashBase WITH (NOLOCK)\n        WHERE    ActivityId IN\n                (SELECT  ActivityId\n                FROM     EmailHashBase WITH (NOLOCK)\n                WHERE    HashType = 0\n                    AND Hash IN (111682,1892164739,45,1824023892,54,3805,125879)\n                GROUP BY ActivityId\n                HAVING   COUNT(ActivityId) &gt;= 7\n                )\n            AND HashType = 1\n            AND Hash IN (969105075,1418975348,547970098,1044570065,-1578559672,1137188287,-1492206818,1365121987,1893861533,-1313312639,-1829169632,-1685403462,-518982188,1123523219,284291011,-981044541,1790111815,-808308608,-599769785,971845046)\n        GROUP BY ActivityId\n        HAVING   COUNT(ActivityId) &gt;= 2\n        )\nSELECT   TOP 1 a.ActivityId\nFROM     ActivityPointerBase AS a WITH (NOLOCK)\nWHERE    a.ActivityId IN\n            (SELECT ActivityId\n            FROM    Candidates AS c\n            WHERE(\n                    (SELECT COUNT(*)\n                            FROM    EmailHashBase AS h\n                            WHERE   h.ActivityId = c.ActivityId\n                                AND h.HashType   = 0\n                    )\n                    &lt;= 7\n                ) \n            )\nORDER BY a.ModifiedOn DESC\n</code></pre>\n\n<p>Running this query directly against the database takes up to a minute.  I've run it using \"Set Statistics IO ON\" and have following results:</p>\n\n<pre><code>Table 'Worktable'. Scan count 0, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'EmailHashBase'. Scan count 17696074, logical reads 53155625, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'ActivityPointerBase'. Scan count 1, logical reads 5060, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\n\nSQL Server Execution Times:\nCPU time = 36567 ms,  elapsed time = 36562 ms.\n</code></pre>\n\n<p>Obviously there's a problem with EmailHashBase.  I've added a non-clustered index on the Hash column and rebuilt the indexes, but I'm still getting a high scan and logical read count.</p>\n\n<p>I cannot change the query.  </p>\n\n<p>Any suggestions on what I can do to the table to fix this? </p>\n"},{"tags":["sql","sql-server","replication"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":536,"score":1,"question_id":3211340,"title":"Sql Server replication over wan","body":"<p>Im looking at developing a simple ecommerce platform and need to replicate product and customer data to the web host over the internet so the website can run disconnected.  The two options i can think of at present are using enterprise messaging and database replication.</p>\n\n<p>Im leaning towards database replication over enterprise messaging as enterprise messaging would require additional developer resource to write all the plumbing code.  Anyone have any success using sql server one way replication over unreliable wan links through the internet?  </p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13144458,"title":"improving performance of a view that is heavily dependent on dates","body":"<p><strong>This view is taking me HOURS to execute:</strong></p>\n\n<pre><code>USE [SalesDWH]\nGO\n\n/****** Object:  View [dbo].[FirstLastEstablished]    Script Date: 10/29/2012 15:12:47 ******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER view [dbo].[FirstLastEstablished] as\n\n\nwith cte_min as(\n\nselect \n      a.client_id\n      ,a.specimen_source\n      ,a.received_date\nfrom\n      millennium_dw_dev..F_ACCESSION_DAILY a\njoin\n            (select distinct\n                  f.client_id\n                  ,f.received_date\n                  ,f.accession_daily_key\n            from \n                  millennium_dw_dev..F_ACCESSION_DAILY f\n            join \n                  (select CLIENT_ID, MIN(received_date) MinRecDate\n                  from millennium_dw_dev..F_ACCESSION_DAILY\n                  group by CLIENT_ID) i\n            on f.CLIENT_ID=i.CLIENT_ID\n            and f.RECEIVED_DATE=i.MinRecDate) b\non    \n      a.ACCESSION_DAILY_KEY=b.ACCESSION_DAILY_KEY \n\n)\n\n,\ncte_max as \n(\n\nselect \n      a.client_id\n      ,a.specimen_source\n      ,a.received_date\nfrom\n      millennium_dw_dev..F_ACCESSION_DAILY a\njoin\n            (select distinct\n                  f.client_id\n                  ,f.received_date\n                  ,f.accession_daily_key\n            from \n                  millennium_dw_dev..F_ACCESSION_DAILY f\n            join \n                  (select CLIENT_ID, max(received_date) MaxRecDate\n                  from millennium_dw_dev..F_ACCESSION_DAILY\n                  group by CLIENT_ID) i\n            on f.CLIENT_ID=i.CLIENT_ID\n            and f.RECEIVED_DATE=i.MaxRecDate) b\non    \n      a.ACCESSION_DAILY_KEY=b.ACCESSION_DAILY_KEY \n\n)\n,\n\n\ncte_est as\n\n(\n\nselect distinct client_id, MLIS_DATE_ESTABLISHED\nfrom millennium_dw_dev..D_CLIENT\nwhere REC_ACTIVE_FLG=1\nand MLIS_DATE_ESTABLISHED is not null\n)\n\n,\n\nmainQuery as(\nselect distinct\n      f.client_id\n      ,cmin.specimen_source first_specimen_source\n      ,cmin.received_date first_received\n      ,cmax.specimen_source last_specimen_source\n      ,cmax.received_date last_received\n      ,cest.MLIS_DATE_ESTABLISHED MLIS_DATE_ESTABLISHED\nfrom millennium_dw_dev..F_ACCESSION_DAILY f\nleft join cte_max cmax\non cmax.CLIENT_ID=f.CLIENT_ID\nleft join cte_min cmin\non cmin.CLIENT_ID=f.CLIENT_ID\nleft join cte_est cest\non cest.CLIENT_ID=f.CLIENT_ID\n)\n,\nDateDifferences\nas\n\n(\nSELECT\nclient_id,\n   (DATEDIFF(dd, MLIS_DATE_ESTABLISHED,first_received) + 1)\n  -(DATEDIFF(wk, MLIS_DATE_ESTABLISHED,first_received) * 2)\n  -(CASE WHEN DATENAME(dw, first_received) = 'Sunday' THEN 1 ELSE 0 END)\n  -(CASE WHEN DATENAME(dw, MLIS_DATE_ESTABLISHED) = 'Saturday' THEN 1 ELSE 0 END)\n -(case when cast('01/01/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/26/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/04/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/01/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/27/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/25/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/01/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/25/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/03/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/07/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/26/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/25/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/01/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/31/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/05/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/06/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/25/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/24/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/03/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/30/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/04/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/05/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/24/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/26/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/02/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/28/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/04/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/03/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/22/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/25/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n\n\n   DifferenceExcludingWeekends\n  from\n  mainQuery\n)\n,\nTerritory \nas\n(\nselect distinct c.client_id,c.MLIS_TERRITORY,s.REGION_NAME\nfrom millennium_dw_dev..D_CLIENT c\nleft join millennium_dw_dev..D_SALES_HIERARCHY s\non s.TERRITORY_NAME=c.MLIS_TERRITORY\nwhere c.REC_ACTIVE_FLG=1\nand s.REC_ACTIVE_FLG=1\n\n)\n\nselect mainQuery.*,d.DifferenceExcludingWeekends,Territory.MLIS_TERRITORY,Territory.REGION_NAME\nfrom mainQuery\nleft join DateDifferences d\non mainQuery.CLIENT_ID=d.CLIENT_ID\nleft join Territory\non mainQuery.CLIENT_ID=Territory.CLIENT_ID\n\nGO\n</code></pre>\n\n<p>I did the sql server database tuning on this, and created all the recommended indexes. After 15min of executing the view again, I stopped it. </p>\n\n<p><strong>Are there obvious things that you could kindly point out to me about my query to optimize it more and improve execution time?</strong></p>\n"},{"tags":["sql-server","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13144591,"title":"Insert update delete trigger","body":"<p>Dear all Im having trouble with my trigger. </p>\n\n<p>Am I doing this at all right, right now it only works for Insert. I think Im pretty close tho please help me if you have the time.  Im trying to store all the inserts, updates and deletes into the table customers_changelog via trigger. There is something wrong with the code I cant delete or update customers I can only insert new ones. Please help my I have been spending plenty of hours on this and just cant get this to work! :)</p>\n\n<pre><code>create table customers (\ncustomerid int identity primary key,\nname varchar(100) not null,\naddress varchar(100)\n)\ngo\n\ncreate table customers_changelog (\ncustomerid int,\nname varchar(100) not null,\naddress varchar(100),\nchange_user varchar(32),\nchange_time datetime,\nchange_action char(1) default 'I',\ncheck (change_action = 'I' or change_action = 'D')\n)\ngo\n\n\nCREATE TRIGGER log_changes\nON customers\nAFTER INSERT, UPDATE, DELETE\nAS \nBEGIN\n    SET NOCOUNT ON;\n\n--\n-- Check if this is an INSERT, UPDATE or DELETE Action.\n-- \nDECLARE @customerid1 as int;\nDEClARE @name1 as varchar(32);\nDECLARE @address1 as varchar(100);\nDECLARE @change_action1 as char(1);\nDECLARE @change_time1 as datetime;\nDECLARE @change_user1 as varchar(32);\n\nselect  @customerid1 = c.customerid, @name1 = c.name, @address1 = c.address\nfrom customers c, inserted i\nwhere c.customerid = i.customerid \n\nSET @change_time1 = CURRENT_TIMESTAMP;\nSET @change_user1 = CURRENT_USER;\nINSERT INTO customers_changelog(customerid,name,address,change_action,change_time,change_user)\n    VALUES(@customerid1,@name1,@address1,'I',@change_time1,@change_user1)\nIF EXISTS(SELECT * FROM DELETED)\nBEGIN    \n            IF EXISTS(SELECT * FROM INSERTED) \n            INSERT INTO customers_changelog VALUES(@customerid1,@name1,@address1,'U',@change_time1,@change_user1)\n            ELSE \n            INSERT INTO customers_changelog VALUES(@customerid1,@name1,@address1,'D',@change_time1,@change_user1)\n\nEND\nELSE \n    IF NOT EXISTS(SELECT * FROM INSERTED) RETURN;\nEND\n</code></pre>\n"},{"tags":["sql-server","visual-studio-2008","reporting-services","reportviewer","rdlc"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":431,"score":1,"question_id":7194539,"title":"How do I repeat page header on every page except the first page of a report?","body":"<p>I have a client report (.rdlc) that I am editing in Visual Studio.  I need a way to display an empty page header on every page, except the first page of the report.</p>\n\n<p>The reason for this is because the client has paper with their logo that needs space at the top to display on subsequent pages.</p>\n"}]}
{"total":54451,"page":10,"pagesize":100,"questions":[{"tags":["sql-server","ssis"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":89,"score":2,"question_id":13142631,"title":"Why would the custom SSIS log provider not show up on the providers dropdown list?","body":"<p>I am trying to create a custom logging provider for SSIS, but when deploying the dll, it doesn't show up in the list of providers.</p>\n\n<p>The SSIS version is 11.0.2100.60. I tried .NET Framework 2.0 and 3.5. I installed in the GAC, and also copied to both folders below:</p>\n\n<pre><code>C:\\Program Files\\Microsoft SQL Server\\110\\DTS\\LogProviders\nC:\\Program Files (x86)\\Microsoft SQL Server\\110\\DTS\\LogProviders\n</code></pre>\n\n<p>After doing this, I opened Visual Studio [Shell], and created a simple SSIS package. When opening the <code>SSIS\\Logging...</code> menu, the new custom log provider is not there.</p>\n\n<p>The code that I am using now is the sample package provided by Microsoft (<em>HTMLLogProviderCS</em>) from Codeplex, and no luck.</p>\n\n<p>Any ideas where I could have missed something?</p>\n"},{"tags":["sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":57,"score":4,"question_id":13144970,"title":"Procedure to get dates in between","body":"<p>I have a SQL Server database that contains a <code>timesheet</code> table. This table is used to store roles for employees. Before I perform an insert I check to see of an employee has any preexisting roles in the selected days.</p>\n\n<p>Heres a stored procedure that returns the count of pre-existing roles </p>\n\n<pre><code>set @retVal=(select count(fk_RoleID) from dbo.TimesheetTable where \n(@startdate &gt;=  CAST((\nSTR( YEAR( StartDate ) ) + '/' +\nSTR( MONTH( StartDate ) ) + '/' +\nSTR( DAY( StartDate ) )\n)\nAS DATE\n))-- AND EndDate &lt;= '2012-08-30')\nand\n(@enddate  &lt;  CAST(\n(\nSTR( YEAR( EndDate ) ) + '/' +\nSTR( MONTH( EndDate ) ) + '/' +\nSTR( DAY( EndDate ) )\n)\nAS DATE\n))\nand fk_PersonnelID=@personnelID)\n\nreturn @retVal\n</code></pre>\n\n<p>The following are the records for one employee..</p>\n\n<pre><code>pk_ID  fk_PersonnelID  fk_RoleID  StartDate   EndDate     dateCreated\n62     1               26         2012-10-01  2012-10-02  2012-10-25 15:55:12.940\n81     1               20         2012-10-04  2012-10-06  2012-10-30 14:50:28.300\n</code></pre>\n\n<p>If I try to do an insert of where the start date is <code>2012-10-05</code> and end date is <code>2012-10-11</code>, the query fails to trap the <code>startdate</code> ..and the insert occurs</p>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["sql-server","delphi","stored-procedures","ado"],"answer_count":4,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":2253,"score":9,"question_id":254486,"title":"View output of 'print' statements using ADOConnection in Delphi","body":"<p>Some of my MS SQL stored procedures produce messages using the 'print' command.  In my Delphi 2007 application, which connects to MS SQL using TADOConnection, how can I view the output of those 'print' commands?</p>\n\n<p>Key requirements:\n1) I can't run the query more than once; it might be updating things.\n2) I need to see the 'print' results even if datasets are returned.</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":51,"score":-5,"question_id":13145051,"title":"t sql union vs join order (efficiency)","body":"<p>I have a relatively simple question.</p>\n\n<p>I have dataset A and dataset B, both identical in structure.</p>\n\n<p>The end result is going to be a union all of dataset A and dataset B, we'll call it dataset C.</p>\n\n<p>But before the final version, the end dataset needs to be filtered by joining on dataset X.</p>\n\n<p>The question is should I join dataset A on dataset X, join dataset B on dataset X, and THEN union ALL A and B, or should I UNION ALL A and B into C, then join C on X.</p>\n\n<p>What is faster, more memory efficient, etc?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server","inner-join"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":13145275,"title":"Where clause versus inner join statement checks, are they the same?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1018952/condition-within-join-or-where\">Condition within JOIN or WHERE</a>  </p>\n</blockquote>\n\n\n\n<p>Are the below 2 queries the same?</p>\n\n<pre><code>SELECT u.*\nFROM User u\n    INNER JOIN Sales s ON (u.userId = s.userId)\nWHERE\nu.active = 1 AND\ns.amount &gt; 0 AND\ns.status = 1 \n</code></pre>\n\n<p>versus:</p>\n\n<pre><code>SELECT u.*\nFROM User u\n    INNER JOIN Sales s ON \n        (u.userId = s.userId AND s.amount &gt; 0 and s.status=1)\nWHERE\nu.active = 1\n</code></pre>\n\n<p>Are these 2 queries the same in terms of result set always?\nPerformance considerations?</p>\n"},{"tags":["sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13141507,"title":"Check if user is member of dbo role in SQL Server","body":"<p>I need a T-SQL statement to check if a user is member of a database role in SQL Server. Specifically I need to know if the user is member of the dbo role, because then I don't have to grant additional authority to that user.</p>\n\n<p>If I try to add additional authority when the user is dbo it fails, and my script fails...</p>\n"},{"tags":["sql","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13144820,"title":"SQL Error: The parameterized query..expects the parameter","body":"<p>I was having issues converting a log file section to a SQL <code>DateTime</code> and found a better solution was to have my date field generated by the database instead of code (using <code>GETDATE()</code>). </p>\n\n<p>I removed the date field from my insert but now I get this error:</p>\n\n<blockquote>\n  <p>Error: The parameterized query '(@station int, @indoor_temp float, @outdoor_temp float, @dewpoint f' expects the parameter '@wind_direction_text', which was not supplied.</p>\n</blockquote>\n\n<p>That value it complains about is supplied, and what's stranger the insert still succeeds and the database record is inserted!</p>\n\n<p>I'd like to figure out why I'm getting these exceptions though!</p>\n\n<p>Here's my code:</p>\n\n<pre><code>var dataCommand = new SqlCommand();\ndataCommand.Connection = dataConnection;\n\ndataCommand.Parameters.AddWithValue(\"@station\", _stationId);\ndataCommand.Parameters.AddWithValue(\"@indoor_temp\", _indoorTemp);\ndataCommand.Parameters.AddWithValue(\"@outdoor_temp\", _outdoorTemp);\ndataCommand.Parameters.AddWithValue(\"@dewpoint\", _dewPoint);\ndataCommand.Parameters.AddWithValue(\"@rel_humidity_indoor\", _relHumidityIndoor);\ndataCommand.Parameters.AddWithValue(\"@rel_humidity_outdoor\", _relHumidityOutdoor);\ndataCommand.Parameters.AddWithValue(\"@wind_speed\", _windSpeed);\ndataCommand.Parameters.AddWithValue(\"@wind_direction_degrees\", _windDirectionDegrees);\ndataCommand.Parameters.AddWithValue(\"@wind_direction_text\", _windDirectionText);\ndataCommand.Parameters.AddWithValue(\"@wind_chill\", _windChill);\ndataCommand.Parameters.AddWithValue(\"@rain1h\", _rain1H);\ndataCommand.Parameters.AddWithValue(\"@rain24h\", _rain24H);\ndataCommand.Parameters.AddWithValue(\"@rain_total\", _totalRain);\ndataCommand.Parameters.AddWithValue(\"@relative_pressure\", _relativePressure);\ndataCommand.Parameters.AddWithValue(\"@tendency\", _tendency);\ndataCommand.Parameters.AddWithValue(\"@forecast\", _forecast);\n\ndataCommand.CommandType = CommandType.Text;\ndataCommand.CommandText =\n                         \"INSERT INTO\"\n                         + \" dbo.WeatherData(station_id, indoor_temp, outdoor_temp, dewpoint,\" +\n                            \"rel_humidity_indoor, rel_humidity_outdoor, wind_speed, wind_direction_degrees,\" +\n                            \"wind_direction_text, wind_chill, rain1h, rain24h, rain_total, relative_pressure,\" +\n                            \"tendency, forecast)\"\n                            + \"VALUES \" +\n                            \"(@station, @indoor_temp, @outdoor_temp, @dewpoint, @rel_humidity_indoor,\" +\n                            \"@rel_humidity_outdoor, @wind_speed, @wind_direction_degrees,\" +\n                            \"@wind_direction_text, @wind_chill, @rain1h, @rain24h, @rain_total,\" +\n                            \"@relative_pressure, @tendency, @forecast)\";\n\n// execute the insert command\ndataCommand.ExecuteNonQuery();\n</code></pre>\n\n<p>Thanks for your help!</p>\n"},{"tags":["sql","sql-server","database","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13142433,"title":"Tables for recursive hierarchial data in SQL","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1757260/simplest-way-to-do-a-recursive-self-join-in-sql-server\">Simplest way to do a recursive self-join in SQL Server?</a>  </p>\n</blockquote>\n\n\n\n<p>I have to create a table in SQL that will comprise of groups of items/products. Each new group made will be made under one of the <strong>pre-defined</strong> groups or the groups previously formed. I want to keep all this data in a SQL Table. So far, I have though of creating a table like this:</p>\n\n<ul>\n<li>Group ID</li>\n<li>Group Name</li>\n<li>Group Under (This will store the ID of the group under which this group is from</li>\n</ul>\n\n<p>But this can only refer to just the next level, how will I get to know who is the super-parent of this group.</p>\n\n<p>For example:</p>\n\n<ul>\n<li>I have groups <code>A, B, C</code>. </li>\n<li><code>A</code> has further subgroups <code>A1, A2, A3</code>. </li>\n<li><code>A1</code> has further subgroups, <code>A11, A12, A13</code>. </li>\n</ul>\n\n<p>I will I have the information about super-parent group i.e <code>A</code> from <code>A11</code> or <code>A22</code> or <code>A33</code>? </p>\n\n<p>Let me know if the problem is not clear..</p>\n"},{"tags":["sql","sql-server","sql-server-2000","parameter-sniffing"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13144556,"title":"How can I cure parameter sniffing on SQL Server 2000?","body":"<p>I am having an issue where an update query with about 70 parameters times-out on occasion. Based on some research, I believe this is due to packet sniffing. I saw that in newer versions of SQL Server, I can use the <code>Option(recompile)</code> clause, but that does not work in my case, since I am using server 2000.</p>\n\n<p>I am using <code>sqlhelper.executeNonQuery</code> and not a stored procedure.</p>\n"},{"tags":["sql-server","vb.net","sql-server-2008-r2","smo"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13143942,"title":"Programmatically determine max size of SQL Server Express database","body":"<p>Is there a way to determine the max size of a SQL Server Express database using SMO? </p>\n\n<p>Or will I have to add code to say </p>\n\n<pre><code>if express then\n  if sql2005 then \n    limit = 4gb \n  else \n    limit = 10gb\nelse\n  limit = unlimited\nend\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":24,"score":2,"question_id":13143883,"title":"Date Specific Criteria for Query","body":"<p>I have a query that is gathering data from the 20th of last month to the 19th of this month and it seems to be working.</p>\n\n<pre><code>(DateTime &gt;= 19+dateadd(mm,datediff(mm,0,getdate())-1,0)   \nAND  DateTime &lt;  18+dateadd(mm,datediff(mm,0,getdate()),0)) \n</code></pre>\n\n<p>I now need to somehow modify it to meet the following...</p>\n\n<p>Always show the current report no matter when it is run.</p>\n\n<p>Currently what happens is.....it works great if run anytime between the 20th of last month and the 19th of this month.....but as soon as it hits the 20th of this month through the 31th of this month....it keeps showing the last period....which technically i am asking it to do.</p>\n\n<p>What I need is.....When it becomes the 20th of this month....it starts a new report.</p>\n\n<p>As I said.....the problem period is between the 20th and the end of the month.  Once the new month starts....everything is fine.</p>\n\n<p>It somehow has to take into account when the report is being run.</p>\n\n<p>Thanks.</p>\n\n<p>Dave</p>\n"},{"tags":["c#","javascript",".net","sql-server","json"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13143936,"title":"The best way to pass rows of an SQL Database to Javascript?","body":"<p>So, recently I've been looking into the HTML5 Indexeddb feature which is controlled with Javascript, and how to incorporate this with an SQL Server database to share and copy information across so that a version of the database is available offline.</p>\n\n<p>The conundrum that I have is finding the best way to pass a set of objects from an SQL Server database through to the javascript of a browser, using C# to get the values from the database. </p>\n\n<p>Though there are many little \"hacks\" that can be done (e.g Putting data into labels and then having the Javascript just pick it up document.getElementById(\"DataHere\").value;) I was wondering if there were more efficient ways of passing the contents of a database across? </p>\n\n<p>At the moment I have a method that generates an array of strings (all in the JSON format, using the JSON.Net package) as an example of what would be returned from the database.</p>\n\n<pre><code>    public string[] GenerateEmployeeSample() {\n    List&lt;Employee&gt; listEmps = new List&lt;Employee&gt;();\n    string[] listJSON = new string[64];\n    string[] FirstNames = {\"Alonso\", \"Alfred\", \"Angus\", \"Alfresco\" };\n    string[] LastNames = {\"Johnson\",\"Williams\", \"Zelwegger\", \"Jones\" };\n    string[] Departments = {\"Finance\", \"Cleaning\", \"Pusher\", \"Stairs\" };\n    string emailEnd = \"@email.com\";\n\n    for (int i = 0; i &lt; 4; i++) {\n        for (int j = 0; j &lt; 4; j++) {\n            for (int k = 0; k &lt; 4; k++) {\n                Employee tempEmp = new Employee();\n                tempEmp.FirstName = FirstNames[i];\n                tempEmp.LastName = LastNames[j];\n                tempEmp.Department = Departments[k];\n                tempEmp.Email = FirstNames[i] + \".\" + LastNames[j] + emailEnd;\n                listEmps.Add(tempEmp);\n            }\n        }\n    }\n    int count = 0;\n    foreach(Employee emp in listEmps){\n        string tempString = JsonConvert.SerializeObject(emp);\n        listJSON[count] = tempString;\n        count++;\n    }\n\n    return listJSON;\n}\n</code></pre>\n\n<p>So now I have a set of data, how would I be able to pass this array through to Javascript?\nI apologise if this is a trivial question but Javascript is still rather new to me, and after reading through quite a few examples that either didn't do what I wanted or just outright didn't work I am at a bit of a loss.</p>\n\n<p>Thanks very much for reading!</p>\n"},{"tags":["sql-server","ms-access","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2675,"score":1,"question_id":5583256,"title":"ODBC Connection Failed #3151 MS Access --> SQL Server 2008","body":"<p>I have an MS Access application that links to a SQL Server 2008 db for all of its data.  For years, it has worked fine when the SQL Server was on Win2008 Standard 64-bit SP2 and SQL Server 2008 v10.0.4.  I recently moved the back-end SQL db to a newer server (Win2008 R2 Standard 64-bit and SQL v10.50.1600).  After the move, everything on the application worked just fine as expected, no issues.  However, we have a month-end process that generates relatively large reports (300-500 pages) which uncovered an issue that we don't normally see in our day-to-day processing.</p>\n\n<p>My report is based on a pass-through query.  The query runs almost instantaneously and produces 8000 rows.  I can preview the query and quickly navigate to the end of the RS to see the 8000'th row.  No problem.  If I pull up the report that's based on that query, I can see that there are 350 pages and I can navigate page-by-page through the report with no problem.  I can even type in a page number and jump to page 50, 100, 150, etc. with no problem. Note, there is no processing/code/logic happening on any fired events on the report - just displaying and formatting the data.  </p>\n\n<p>HERE IS WHERE THE PROBLEM OCCURS:  If I preview the report and try to jump to the last page from the first page, it'll sit and think for a while (38 seconds to be exact) and then throw <strong>Error #3151 ODBC Connection to [DNS Name] Failed.</strong>  </p>\n\n<p>If I simply update the connect string on the pass-through query to point it back to the \"older\" SQL Server and run the same thing, it works just fine.  I've tried adjusting the connect string to use IP address instead of DNS name, no luck.  This is a process that's worked for years with no problem so I know the client-side logic is sound.</p>\n\n<p>Any thoughts or suggestions?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":16,"score":-1,"question_id":13143930,"title":"Checking Specific Row's Value and Merge Values","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/194852/concatenate-many-rows-into-a-single-text-string\">Concatenate many rows into a single text string?</a><br>\n  <a href=\"http://stackoverflow.com/questions/10298805/mimic-group-concat-combined-with-group\">Mimic group_concat() combined with group</a>  </p>\n</blockquote>\n\n\n\n<p>this is the source table that I am currently working on:</p>\n\n<p><img src=\"http://i.stack.imgur.com/HSSbF.png\" alt=\"enter image description here\"></p>\n\n<p>And this is the desired output:</p>\n\n<p><img src=\"http://i.stack.imgur.com/xcnAB.png\" alt=\"enter image description here\"></p>\n\n<p>Can I achieve this by simple MSSQL query? Like just using <strong>GROUP BY or JOIN?</strong></p>\n"},{"tags":["sql-server","if-statement","where-clause"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":31,"score":-1,"question_id":13143832,"title":"If in where SQL Server","body":"<p>i have an stored procedure which recives 10 parameters type Date...\nbut i can show the information when the consult have null, because a have to show the flow of information of all the clients on this consult...sometimes the client have orders with creditnotes but in occasions only have an order but not have Credit notes.. \ni do this for the Where Clause :</p>\n\n<pre><code>        WHERE \n                (Customer.cd_CustomerID = ISNULL(@customer, Customer.cd_CustomerID))\n                AND (@orderID IS NULL OR Orders.cd_OrderID = @orderID)\n                AND (@Location IS NULL OR CustomerSL.cd_LocID = @Location)      \n                and (Convert(date,Orders.fh_Date,111) BETWEEN coalesce (@FechaPedido1,'1900-01-01') AND  coalesce (@FechaPedido2,'3000-12-31' ))\n                and (Convert(date,Receipt.fh_Date,111) BETWEEN coalesce (@FechaRemision1,'1900-01-01') AND  coalesce (@FechaRemision2,'3000-12-31' )) \n                and (Convert(date,Invoice.fh_Date,111) BETWEEN coalesce (@FechaFactura1,'1900-01-01') AND  coalesce (@FechaFactura2,'3000-12-31' )) \n                and (Convert(date,CreditNote.fh_Date,111) BETWEEN coalesce (@FechaNotaCredito1,'1900-01-01') AND  coalesce (@FechaNotaCredito2,'3000-12-31' ))\n                and (Convert(date,Dispersion.fc_CreatedDate,111) BETWEEN coalesce (@FechaDispersion1,'1900-01-01') AND  coalesce (@FechaDispersion2,'3000-12-31' ))\n</code></pre>\n\n<p>But on this case..only show the information which have all the flow for the client...the consult doesnt show me the flow of information who doesnt have An order without remissions or Dispersion o whatever is the case...  allready try with IF in Where.. but i have some problems with the sintaxis...</p>\n\n<blockquote>\n  <p>if (@fechapedido1 is  null)\n    begin\n  (Convert(date,Orders.fh_Date,111) BETWEEN  @FechaPedido1 and @FechaPedido2)<br>\n    end</p>\n</blockquote>\n\n<p>the sql server showme this message 'Incorrect syntax near the keyword 'Convert'.'\nbut...that line is correct.. :S Please Help Me :D\nthanks\n:D</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":176,"score":0,"question_id":9919278,"title":"SQL multiple replace","body":"<p>I want to read the company table and take out all possible suffixes from the name. Here's what I have so far:</p>\n\n<pre><code>declare @badStrings table (item varchar(50))\n\nINSERT INTO @badStrings(item)\nSELECT 'company' UNION ALL\nSELECT 'co.' UNION ALL\nSELECT 'incorporated' UNION ALL\nSELECT 'inc.' UNION ALL\nSELECT 'llc' UNION ALL\nSELECT 'llp' UNION ALL\nSELECT 'ltd'\n\nselect id, (companyname = Replace(name, item, '') FROM @badStrings)\nfrom companies\nwhere name != ''\n</code></pre>\n"},{"tags":["c#",".net","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13142114,"title":"Roles needed for executing Stored Procedure in SQL Server Authentication","body":"<p>I need to connect to SQL Server 2008 R2 database from a C# application. I need to use SQL Server authentication for the connection. </p>\n\n<p>What are the <strong>roles</strong> and schemas needed for the user so that the user will be able to create/execute stored procedures ? </p>\n\n<p>Note: The stored procedures will be in dbo schema.</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13143396,"title":"SQL Server 2008 unable to backup due to Failed to flush the commit table to disk in dbid 11 due to error 2601","body":"<p>I tried to backup the SQL Server 2008 database \nusing the following code: </p>\n\n<pre><code>BACKUP DATABASE [DataStore] TO  DISK ='E:\\SQLServerDatabase\\DataBasebackUpOct302012.bak'\n</code></pre>\n\n<p>and I get the following error:</p>\n\n<blockquote>\n  <p>Msg 2601, Level 14, State 1, Procedure sp_flush_commit_table, Line 15\n  Cannot insert duplicate key row in object 'sys.syscommittab' with\n  unique index 'si_xdes_id'.</p>\n  \n  <p>Msg 3013, Level 16, State 1, Line 1 BACKUP DATABASE is terminating\n  abnormally. The statement has been terminated.</p>\n  \n  <p>Msg 3999, Level 17, State 1, Line 1 Failed to flush the commit table\n  to disk in dbid 11 due to error 2601. Check the errorlog for more\n  information.</p>\n</blockquote>\n\n<p>Could somebody suggest a solution to this problem.\nThanks.</p>\n"},{"tags":["asp.net","sql-server","c#-4.0","iis6"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13143322,"title":"Message:The parameter is incorrect","body":"<p>I have a web site/app developed on my local machine.  A customer does an order.  Data they enter during the order is saved to a SQL Server DB duing each step in the order.</p>\n\n<p>If they naviagte away from the current order there is an option to resume orders - where the info is pulled back from the Table in the DB and displayed on screen.  Now this works 100% on my own Dev machine.</p>\n\n<p>Howvere I have deployed it to another server and it is not working as epxected - I can see the info gets stored to teh DB table ok.  However when I hit the page to resume - no data is returned.  I looked at SQL Profiler and it never hits the DB I am interested in (yet I can see from SQL Profiler that it hits the DB earlier (on logon to the site)</p>\n\n<p>I have they opened Dev Tools in chrome - on the network tab - on my own Dev machine - I can see the data in there (in a page called JSONService.aspx - which is how I get the data back)</p>\n\n<p>However in my other server environment I get the below:</p>\n\n<pre><code>ListOfErrors: [{CompletionCode:null, Message:The parameter is incorrect.\n }]\n0: {CompletionCode:null, Message:The parameter is incorrect.\n }\nCompletionCode: null\nMessage: \"The parameter is incorrect.\n\"\nObjects: null\nRequestStatus: \"Failure\"\n</code></pre>\n\n<p>I will be investigating this myself and if I get a resolution I will update my answer with it - does anyone possibly have any ideas of things I could try in the meantime - cannot think what I am missing at the minute?</p>\n"},{"tags":["sql-server","security","sql-server-2008","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2921,"score":3,"question_id":6212598,"title":"Server Role to execute SQL Server Agent Jobs in SQL SERVER 2008","body":"<p>The users from other departments ask me to grant them to execute Schedule Jobs / SSIS in SQL Server Agent.  At present, they cannot see SQL Server Agent tree in their ManagmentStudio.  I think, it's because they don't have the rights to execute them.</p>\n\n<p>So, I would like to know which server role should I give to them.  I only want to give them minimum privileges.  When I check the existing roles in my server, I could only see the following server roles</p>\n\n<ol>\n<li>bulkadmin</li>\n<li>dbcreator</li>\n<li>diskadmin</li>\n<li>processadmin</li>\n<li>public</li>\n<li>securityadmin</li>\n<li>serveradmin</li>\n<li>setupadmin</li>\n<li>sysadmin</li>\n</ol>\n\n<p>Please advise me.</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13142930,"title":"how to transpose in sql","body":"<p>Suppose I have</p>\n\n<pre><code>select *\nfrom A a\n     left outer join B b on b.ID in (1,2,3/*and possibly any numbers*/)\n</code></pre>\n\n<p>and so I get (<code>Ax - A's xth row, Bx - B's xth row</code>):</p>\n\n<pre><code>A1 B1\nA1 B2\nA1 B3\nA2 B1\n...\n</code></pre>\n\n<p>And what I want is this:</p>\n\n<pre><code>A1 B1 B2 B3\nA2 B1 B2 B3\n</code></pre>\n\n<p>So that there is dynamic number of columns. What is the best way of achieving this?</p>\n"},{"tags":["sql-server","visual-studio-2010","ssdt"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13142868,"title":"SQL Server Data Tools and Visual Studio Issue","body":"<p>I have just installed vs2010 sp1 ultimate, sqlserver 2012 and the latest version of sqlserver data tools.  I have opened up a solution from source control and receive a bunch of error like the following when trying the build the database project.</p>\n\n<p>SQL71566: Microsoft.Data.Tools.Schema.Sql.SchemaModel.SqlFilegroup cannot not be set on both the Microsoft.Data.Tools.Schema.Sql.SchemaModel.SqlTable and the clustered Microsoft.Data.Tools.Schema.Sql.SchemaModel.SqlPrimaryKeyConstraint.</p>\n\n<p>Running on Windows 7 professional, 64 bit</p>\n\n<p>This is working fine for other members of the team and they all seem to have the same setup as me.</p>\n\n<p>I have tried uninstalling and reinstalling vs2010 and ssdt</p>\n\n<p>Any ideas anyone?</p>\n"},{"tags":["c#","sql-server","search","architecture"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":13142415,"title":"What architecture to use for an extensive search","body":"<p>one of the things we're building right now is a search functionality to look for people.</p>\n\n<p>When starting simple, we've used Linq to entities to search, like this: <code>Entities.People.Where(z=&gt;z.Birthdate &lt; birthdate).ToList()</code></p>\n\n<p>Then, when new searchcriteria were added, the linq statement grew and grew, and now we have to refactor it because nobody understands it anymore.</p>\n\n<p>At this point, we must facilitate search for 8 related items, like 'did you work here', 'do you speak this language', 'from these 6 skills, which ones do you master' etc.</p>\n\n<p>All these items are 1:N or N:N relations in SqlServer, and we are searching for multiple items AND we want to know 'how much match' you have.</p>\n\n<p>For example: we look for people who speak french and or English and or German, and we want to get all people who have at least 1 match, and for those people, we want to know how many matches (ie 1 out of 3 or 2 out of 3) every person has.</p>\n\n<p>At this point the question is: what is a smart thing to do (approx 10.000 people in the database).</p>\n\n<p>Brainstorming has lead us to the following options:</p>\n\n<ol>\n<li>Do the quickest search in the database (so you retrieve limited\namount of records) and sort the rest in code </li>\n<li>Keep on building with Linq </li>\n<li>Perform the whole action in SqlServer</li>\n</ol>\n\n<p>Any tips to get us started?</p>\n"},{"tags":["sql-server","reporting-services","ssrs-2008","ssrs-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13135827,"title":"Passing Non-Null Parameter returns NULL records in SQL Server","body":"<p>I had recently posted a question about how to handle NULL values in SQL Server Reporting Services. The question is located at <a href=\"http://stackoverflow.com/questions/13087095/handle-null-values-in-sql-server-reporting-services\">Handle NULL values in SQL Server Reporting Services</a>.</p>\n\n<p>Applying <code>WHERE @MyParam=MyCol OR @MyParam IS NULL</code> faces a problem, which is if I select single NON-NULL value (from the dropdownlist and pass this as in SQL Server), this also brings the NULL value records. It should only bring the Non NULL value's records.</p>\n\n<p>What should be done to avoid NULL records, if NON-NULL records are selected?</p>\n"},{"tags":["sql-server","triggers","information-schema"],"answer_count":4,"favorite_count":4,"up_vote_count":12,"down_vote_count":0,"view_count":17468,"score":12,"question_id":636452,"title":"What is the best way to check whether a trigger exists in SQL Server?","body":"<p>I'm looking for the <strong>most portable</strong> method to check for existance of a trigger in MS SQL Server. It needs to work on at least SQL Server 2000, 2005 and preferably 2008.</p>\n\n<p>The information does not appear to be in INFORMATION_SCHEMA, but if it is in there somewhere, I would prefer to use it from there.</p>\n\n<p>I do know of this method:</p>\n\n<pre><code>if exists (\n    select * from dbo.sysobjects \n    where name = 'MyTrigger' \n    and OBJECTPROPERTY(id, 'IsTrigger') = 1\n) \nbegin\n\nend\n</code></pre>\n\n<p>But I'm not sure whether it works on all SQL Server versions.</p>\n\n<p>So my questions are: </p>\n\n<ul>\n<li>Is the above the \"best\" way? </li>\n<li>Are there any alternative methods?</li>\n<li>What are their pros and cons?</li>\n</ul>\n"},{"tags":["sql-server","transactional-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13135748,"title":"Strategy to check if Transactional Replication succeeded","body":"<p>We would like to use Transactional Replication to replicate data from one source database to recipient databases. If replication succeed it is necessary to notify some other systems in workflow. Is there any way to check, based on some attribute, if replication succeded? What for strategy would you choose to notify, for example cache, that some data are available? </p>\n\n<p><strong>Update:</strong>\nI think I wasn't clear enough. What we want to know is, if entity is already an all subscribers. For example: I insert a new  <em>Car</em> and some <em>Cars</em> details into two tables in master DB. I want to know if a new <em>Car</em> and his details are replicated to all subscribers to able to say: <em>\"Car is online\"</em></p>\n"},{"tags":["sql-server","sql-server-2008-r2","service-broker"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13141595,"title":"How many connections reads queue","body":"<p>Is there a way to get to know how many external tasks (console applications) is reading queue?</p>\n\n<p>I am using Service Broker external activator.</p>\n\n<p>What i want is something similar to information i get from <a href=\"http://msdn.microsoft.com/en-us/library/ms175029.aspx\" rel=\"nofollow\">sys.dm_broker_activated_tasks</a>, just for external queue readers.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","exists"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13141461,"title":"What can I do to speed up this SQL Query?","body":"<p>I've created this SQL query with the help of @Dems :-)</p>\n\n<p>Here is some detail, I tried to make a SQLFiddle but I kept getting errors with my variables... This works in Sql Server 2008...  My question is, how can I make my query faster? I know I'm doing a number of things wrong here (repeated nester queries), I'm hoping to get one of you SQL gurus to take a look and help me get this down from it's 30 minute execution time! :-S</p>\n\n<p>I'm not sure exactly how much information you need to be able to help me on this one, please fire away with any questions and I'll reply ASAP.  Sorry if the level of detail is lacking a little, I just don't know what you want/need to know!</p>\n\n<p>The basic idea behind the query is that in the game I want to find all players which haven't moved 5 units for a period of time, who have fired whilst stood still and did not fire for 60 minutes before they stopped moving.  The query works, but it's the <code>AND NOT EXISTS</code> clause which is slowing things down to a crawl, before I added that it took 16 seconds to run!  16 seconds is still a looong time, so any other improvements would be appreciated, but for now with this being my own POC game (just throwing bits and pieces together), 16 seconds is acceptable... </p>\n\n<pre><code>DECLARE @n INT , @DistanceLimit INT\nSELECT  @n = 2 , @DistanceLimit = 5;\n\nWITH    partitioned\n          AS ( SELECT   * ,\n                        CASE WHEN Distance &lt; @DistanceLimit THEN 1\n                             ELSE 0\n                        END AS PartitionID\n               FROM     EntityStateEvent\n               WHERE    ExerciseID = '8B50D860-6C4E-11E1-8E70-0025648E65EC'\n             ),\n        sequenced\n          AS ( SELECT   ROW_NUMBER() OVER ( PARTITION BY PlayerID ORDER BY EventTime ) AS MasterSeqID ,\n                        ROW_NUMBER() OVER ( PARTITION BY PlayerID, PartitionID ORDER BY EventTime ) AS PartIDSeqID ,\n                        *\n               FROM     partitioned\n             ),\n        filter\n          AS ( SELECT   MasterSeqID - PartIDSeqID AS GroupID ,\n                        MIN(MasterSeqID) AS GroupFirstMastSeqID ,\n                        MAX(MasterSeqID) AS GroupFinalMastSeqID ,\n                        PlayerID\n               FROM     sequenced\n               WHERE    PartitionID = 1\n               GROUP BY PlayerID ,\n                        MasterSeqID - PartIDSeqID\n               HAVING   COUNT(*) &gt;= @n\n             )\n    SELECT\nDISTINCT    ( sequenced.PlayerID ) ,\n            MIN(sequenced.EventTime) AS StartTime ,\n            MAX(sequenced.EventTime) AS EndTime ,\n            DATEDIFF(minute, MIN(sequenced.EventTime),\n                     MAX(sequenced.EventTime)) AS StaticTime ,\n            Player.Designation AS 'Player'\n    FROM    filter\n            INNER JOIN sequenced ON sequenced.PlayerID = filter.PlayerID\n                                    AND sequenced.MasterSeqID &gt;= filter.GroupFirstMastSeqID\n                                    AND sequenced.MasterSeqID &lt;= filter.GroupFinalMastSeqID\n            INNER JOIN Events ON Events.FiringPlayerID = sequenced.PlayerID \n            INNER JOIN Player ON Player.PlayerID = sequenced.PlayerID\n                                 AND Player.Force = 'FR'\n                                 AND NOT EXISTS ( SELECT    *\n                                                  FROM      Events\n                                                  WHERE     Events.FiringPlayerID = Player.PlayerID\n                                                  GROUP BY  Events.FiringTime\n                                                  HAVING    Events.FiringTime BETWEEN DATEADD(minute,\n                                                              -60,\n                                                              ( SELECT\n                                                              MIN(s.EventTime)\n                                                              FROM\n                                                              sequenced s\n                                                              WHERE\n                                                              s.PlayerID = filter.PlayerID\n                                                              AND s.MasterSeqID &gt;= filter.GroupFirstMastSeqID\n                                                              AND s.MasterSeqID &lt;= filter.GroupFinalMastSeqID\n                                                              ))\n                                                              AND\n                                                              ( SELECT\n                                                              MIN(s.EventTime)\n                                                              FROM\n                                                              sequenced s\n                                                              WHERE\n                                                              s.PlayerID = filter.PlayerID\n                                                              AND s.MasterSeqID &gt;= filter.GroupFirstMastSeqID\n                                                              AND s.MasterSeqID &lt;= filter.GroupFinalMastSeqID\n                                                              ) )\n            INNER JOIN Player HitPlayer ON HitPlayer.PlayerID = Events.HitPlayerID\n    WHERE   HitPlayer.[FORCE] = 'HO'\n    GROUP BY GroupID ,\n            sequenced.PlayerID ,\n            Events.FiringPlayerID ,\n            Events.FiringTime ,\n            Player.Designation\n    HAVING  DATEDIFF(minute, MIN(sequenced.EventTime),\n                     MAX(sequenced.EventTime)) &gt; 5\n            AND Events.FiringTime BETWEEN MIN(sequenced.EventTime)\n                                  AND     MAX(sequenced.EventTime)\n    ORDER BY StartTime\n</code></pre>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13141369,"title":"is it possible to set column value to a concatenation of string and iteration value?","body":"<p>Is it possible to set value of a varchar column to a concatenation of a string and the result set iteration.    </p>\n\n<p>for example:</p>\n\n<pre><code>update TB_USER set LOGIN_NAME = 'BOB'+index where LOGIN_NAME = 'BOB'\n</code></pre>\n\n<p>results in the following: </p>\n\n<blockquote>\n  <p>LOGIN_NAME</p>\n  \n  <p>BOB0</p>\n  \n  <p>BOB1</p>\n  \n  <p>BOB2</p>\n</blockquote>\n"},{"tags":["sql-server","vb.net","azure"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":13141205,"title":"Simple VB/SQL app and AZURE","body":"<p>I have a simple ms sql 2012 express database &amp; a simple VB Express 2010 application as its front end.</p>\n\n<p>Can I simply host my MS SQL database on Azure &amp; update the application to interrogate the hosted database? This would mean, the application would still be local, but the DB would be hosted. My offices are distributed &amp; if we could do this it would save quite a bit of hassle.</p>\n\n<p>Do I need to use a virtual machine, cloud services or straight hosting? Its difficult for me to understand the subtleties each service.</p>\n\n<p>I've had a look at the azure services information and the documentation is pitched a little high for me. I just wanted to know if this is relatively simple thing to do &amp; if anyone has has any pointers to How To's or Noob guides to azure.</p>\n"},{"tags":["sql","sql-server","count","aggregate-functions","select-case"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":92,"score":3,"question_id":13140545,"title":"How can you use a COUNT() in a comparison in a SELECT CASE clause in Sql Server?","body":"<p>Let's say you want do something along the following lines:</p>\n\n<pre><code>SELECT CASE \n    WHEN (SELECT COUNT(id) FROM table WHERE column2 = 4) &gt; 0\n    THEN 1 ELSE 0 END\n</code></pre>\n\n<p>Basically just return 1 when there's one or more rows in the table, 0 otherwise.  There has to be a grammatically correct way to do this.  What might it be?  Thanks!</p>\n"},{"tags":["c#","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":493,"score":0,"question_id":3226571,"title":"how i can generate programmatically \"insert into\" data script file from a database table?","body":"<p>is there an elegant object-orient based framework?</p>\n"},{"tags":["sql","sql-server","reporting-services"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13093910,"title":"SSRS Parameter doesn't display even though the query works","body":"<p>I have a query to fill a report parameter:</p>\n\n<pre><code>select distinct [Source No_] from _report_sales_master\nwhere [Industry] = @Industries\nand [posting date] &gt;= dateadd(year,datediff(year,'01/06/2000',@year)-1,'01/06/2000') \nand  [posting date] &lt; dateadd(year,datediff(year,'01/06/2000',@year),'01/06/2000')\norder by [Source No_]\n</code></pre>\n\n<p>The query results in a list that I use to fill a multi-value report parameter.</p>\n\n<p>When I run the query, it generates the right results.</p>\n\n<p>When I run the report, the \"Source No_\" parameter stays empty, no matter which @year or @industries i choose</p>\n\n<p>When I  remove the \"posting date\" clauses from the query, the parameter list populates and works properly. </p>\n\n<p>What am I missing?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13140149,"title":"Return Query Based on Tree Structure","body":"<p>I am looking to return a query that shows exactly like this:</p>\n\n<p>Root 1<br/>\n--> Child 2 <br/>\n----->Child 3 <br/>\nRoot 2 <br/>\n--> Child 4 <br/>\n---->Child 5 <br/></p>\n\n<p>So the query should return Root 1 as One row, ---> Child 2 as another row. Assume n Levels, and \"--->\" format is placed for each child. Level is higher then \"---->\" increases.</p>\n\n<p>My Table definition is <br/></p>\n\n<p><strong>[NodeId, ParentId, Name, Level]</strong></p>\n"},{"tags":["sql-server","database","design","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":49,"score":1,"question_id":13140360,"title":"Design Database - Best Practice","body":"<p>I need to implement an SQL server db, that will contain information about products as follow:</p>\n\n<p>There will be the following properties:</p>\n\n<pre><code>**ProductName\nProductTitle\nProductPrice\nCreatedDate\nCreatedBy**\n</code></pre>\n\n<p>(now it get's complicated)</p>\n\n<pre><code>**Property1 (MIN value, MAX value)\nProperty2 (MIN value, MAX value)\nProperty3 (MIN value, MAX value)\nProperty4 (MIN value, MAX value)\nProperty5 (MIN value, MAX value)\nProperty6 (MIN value, MAX value)\n...........\nProperty40 (MIN value, MAX value)**\n</code></pre>\n\n<p>All products will have the same structure, how can I implement the properties that will contain the values min and max? So, each product will have a min and max value for each of the Property from 1 - 40. The value in the min and max is decimal.</p>\n\n<p>Should I create one Products table where I have the basic details (name, title, price, date ..) and than for each property create one table Property1 for example with foreign key to Products table?</p>\n\n<p>Is there a better way? What do you recommend ?</p>\n"},{"tags":["sql-server","debugging"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13138774,"title":"Executing a SQL query during debugging in SQL Server Management Studio on locked table","body":"<p>Is it possible to somehow execute a query against a table during debugging of T-SQL statement? It's locked for another connections at the time, so using another windows doesn't help.</p>\n\n<p>I'm trying to debug an <code>INSTEAD OF UPDATE</code> trigger, something isn't working as expected and I'd like to evaluate another SQL expression to investigate. </p>\n\n<p>I think that I maybe could write a cursor that will loop the table and <code>print</code> the information I need, but I'd rather avoid that and use something simpler.</p>\n"},{"tags":["sql","sql-server","triggers","merge-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12931756,"title":"Trigger does not work because of deprecated datatype in replicated table","body":"<p>I have a table in my SQL Server 2005 database, which has a field with the datatype NTEXT. This table is replicated in a merge-replication with a lot of SQLCE-subscriptions.</p>\n\n<p>I have tried to add an <code>ON INSERT</code> trigger to this table to process the NTEXT-field. But I got this error:</p>\n\n<pre><code>Cannot use text, ntext, or image columns in the 'inserted' and 'deleted' tables.\n</code></pre>\n\n<p>On my researches I found several postings that NTEXT is deprecated and I should change to NVARCHAR(MAX). But I can't do this without recreating the snapshot, which is quite a problem for the people working with the devices (because of dataamount and time).</p>\n\n<p>Is there a workaround for the insert-trigger to handle the datatypes?</p>\n\n<p>This is where the error is thrown:</p>\n\n<pre><code>DECLARE c1 CURSOR FOR SELECT ControlValue FROM INSERTED\n</code></pre>\n"},{"tags":["sql-server","tsql","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13139725,"title":"SELECT query on large table","body":"<p>I need to review / refactor an existing stored procedure that targets a table (10+ millons of rows). The stored procedure signature can not be changed easily and it looks like below.</p>\n\n<p>The stored procedure takes two strings delimited by pipes and uses a SQL function (<code>SplitDelimitedVarChar</code>) to split the string into a temp table which is then used in the actual select. The number of strings in the <em>array</em> string ranges from 1 to thousands. </p>\n\n<p>The <code>DateValue</code> and <code>TimeValue</code> columns contains <code>int</code> representations of the timestamp in the row.</p>\n\n<p>My question is if any one has any ides if this is a good (best?) solution or if it could be done better. The main question is if it could be optimized for speed?</p>\n\n<p>Since the table is only accessed through this stored procedure the index is a non clustered with the <code>WHERE</code> columns and includes all the <code>SELECT</code> columns.</p>\n\n<p>Thanks for any suggestions or pointers.</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[spdata_Get_Ana]\n@beginTime INT,\n@endTime INT,\n@subscribers VARCHAR(MAX),\n@exchanges VARCHAR(MAX) = '1:',\n@beginDateValue int, \n@endDateValue int,\n@target int = 1\nAS  \nBEGIN\nSET NOCOUNT ON;\n\nCREATE TABLE #exch (Item Varchar(20) COLLATE database_default)\nINSERT INTO #exch\nSELECT Item FROM [SplitDelimitedVarChar] (@exchanges, '|') ORDER BY Item\nCREATE CLUSTERED INDEX idx ON #exch (Item)\n\nCREATE TABLE #subs (Item Varchar(20) COLLATE database_default)\nINSERT INTO #subs\nSELECT Item FROM [SplitDelimitedVarChar] (@subscribers, '|') ORDER BY Item\nCREATE CLUSTERED INDEX idx ON #subs (Item)\n\nSELECT \n   [Id]\n  ,'' AS 'Name'\n  ,[NameId]\n  ,[Level]\n  ,[Ne]\n  ,[CallId]\n  ,[Bg]\n  ,[DateTime]\n  ,[TimeStamp]\n  ,[LogOwnerSnb]\n  ,[TypeOfLog]\n  ,[AbsenceCode]\n  ,[AnswerTime]\n  ,[CallForwardingReason]\n  ,[CallForwardingToNumber]\n  ,[CallTransferTime]\n  ,[CallTransferReason]\n  ,[SeizedSubscriberType]\n  ,[SeizedSubscriberTime]\n  ,[SeizedSubscriberNumber]\n  ,[CalledSubscriberService]\n  ,[InSubscriberType]\n  ,[InSubscriberNumber]\n  ,[CallDirection]\n  ,[SubscriberService]\n  ,[ClearingCause]\n  ,[ClearingCauseTime]\n  ,[OnHookTime]\n  ,[OutAnswerSubType]\n  ,[OutAnswerTime]\n  ,[OutAnswerSubNum]\n  ,[RingingStartedTime]\n  ,[ReroutedToNumber]\n  ,[InitiatedService]\n  ,[B26]\nFROM [dbo].[data_centrex_Ana] AS A\nWHERE\n    (A.[DateValue] BETWEEN @beginDateValue AND @endDateValue)\nAND\n    EXISTS(SELECT [Item] FROM #exch WHERE [Item] = A.[Level])\nAND\n    (A.[TimeValue] BETWEEN @beginTime AND @endTime)\nAND\n(\n   (@target = 1 AND EXISTS(SELECT [Item] FROM #subs WHERE [Item] = A.[LogOwnerSnb]))\n   OR\n   (@target = 2 AND EXISTS(SELECT [Item] FROM #subs WHERE [Item] = A.[Bg]))\n)\nEND\n</code></pre>\n"},{"tags":[".net","sql-server","wcf","active-directory","identity-delegation"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":13108419,"title":"WCF Delegation, Service couldn't access SQL Server","body":"<p>I have the following infrastructure:</p>\n\n<ul>\n<li><p>Computer #1, Microsoft SQL Server 2008, started under System account. There is login <code>Master\\MyLogin</code> (with Windows Authintification), server roles = <code>sysadm</code>, database role = <code>db_owner</code>.</p></li>\n<li><p>Computer # 2, WCF service on IIS 7.0. Application and site run under account <code>Master\\IISLogin</code> (IISLogin@myDomain.ru)</p></li>\n</ul>\n\n<p>Configuration:</p>\n\n<pre><code>&lt;configuration&gt;\n  &lt;system.web&gt;\n    &lt;compilation debug=\"true\" /&gt;\n  &lt;/system.web&gt;\n  &lt;system.serviceModel&gt;\n    &lt;bindings&gt;\n      &lt;netTcpBinding&gt;\n        &lt;binding name=\"CommonWindowsBinding\" maxReceivedMessageSize=\"40000000\"&gt;\n          &lt;security mode=\"TransportWithMessageCredential\"&gt;\n            &lt;transport clientCredentialType=\"Windows\" /&gt;\n          &lt;/security&gt;\n        &lt;/binding&gt;\n      &lt;/netTcpBinding&gt;\n    &lt;/bindings&gt;\n    &lt;serviceHostingEnvironment multipleSiteBindingsEnabled=\"true\" /&gt;\n    &lt;services&gt;\n      &lt;service behaviorConfiguration=\"CommonBehavior\" name=\"MyNameSpace.AdminService\"&gt;\n        &lt;endpoint address=\"Windows\" binding=\"netTcpBinding\" bindingConfiguration=\"CommonWindowsBinding\" name=\"IAdminServiceWindows\" contract=\"MyNameSpace.IAdminService\"&gt;\n          &lt;identity&gt;\n            &lt;dns value=\"WCFServer\" /&gt;\n            &lt;userPrincipalName value=\"IISLogin@myDomain.ru\"/&gt;\n          &lt;/identity&gt;\n        &lt;/endpoint&gt;\n      &lt;/service&gt;\n    &lt;/services&gt;\n    &lt;behaviors&gt;\n  &lt;serviceBehaviors&gt;\n    &lt;behavior name=\"CommonBehavior\"&gt;\n      &lt;dataContractSerializer maxItemsInObjectGraph=\"10000000\" /&gt;\n      &lt;serviceMetadata httpGetEnabled=\"true\" policyVersion=\"Policy15\" /&gt;\n      &lt;serviceDebug includeExceptionDetailInFaults=\"true\" /&gt;\n      &lt;serviceCredentials&gt;\n        &lt;clientCertificate&gt;\n          &lt;authentication certificateValidationMode=\"PeerTrust\" /&gt;\n        &lt;/clientCertificate&gt;\n        &lt;serviceCertificate findValue=\"WCFServer\" storeLocation=\"LocalMachine\" storeName=\"My\" x509FindType=\"FindBySubjectName\" /&gt;\n        &lt;userNameAuthentication userNamePasswordValidationMode=\"Custom\" customUserNamePasswordValidatorType=\"MyClassFullName, MyDllFullName\" /&gt;\n      &lt;/serviceCredentials&gt;\n    &lt;/behavior&gt;\n  &lt;/serviceBehaviors&gt;\n&lt;/behaviors&gt;\n&lt;/system.serviceModel&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>Service has method</p>\n\n<pre><code>[OperationBehavior(Impersonation = ImpersonationOption.Allowed)]\npublic bool HasRole(string roleName)\n{\n     //work with database\n}\n</code></pre>\n\n<p>It uses EF 5.0 database first. Connection string</p>\n\n<pre><code>\"Data Source=Computer1; Initial Catalog=myDB; Integrated Security=True; Multipleactiveresultsets=True; Persist Security Info=True;\"\n</code></pre>\n\n<ul>\n<li><p>Computer # 3, the client. It has the following config</p>\n\n<pre><code>&lt;configuration&gt;\n&lt;system.serviceModel&gt;\n  &lt;bindings&gt;\n    &lt;netTcpBinding&gt;\n        &lt;binding name=\"CommonWindowsBinding\" closeTimeout=\"00:01:00\"\n            openTimeout=\"00:01:00\" receiveTimeout=\"00:10:00\" sendTimeout=\"00:01:00\"\n            transactionFlow=\"false\" transferMode=\"Buffered\" transactionProtocol=\"OleTransactions\"\n            hostNameComparisonMode=\"StrongWildcard\" listenBacklog=\"10\"\n            maxBufferPoolSize=\"524288\" maxBufferSize=\"65536\" maxConnections=\"10\"\n            maxReceivedMessageSize=\"40000000\"&gt;\n            &lt;readerQuotas maxDepth=\"32\" maxStringContentLength=\"8192\" maxArrayLength=\"16384\"\n                maxBytesPerRead=\"4096\" maxNameTableCharCount=\"16384\" /&gt;\n            &lt;reliableSession ordered=\"true\" inactivityTimeout=\"00:10:00\"\n                enabled=\"false\" /&gt;\n          &lt;security mode=\"TransportWithMessageCredential\"&gt;\n            &lt;transport clientCredentialType=\"Windows\" /&gt;\n          &lt;/security&gt;\n        &lt;/binding&gt;\n     &lt;/netTcpBinding&gt;\n&lt;/bindings&gt;\n&lt;client&gt;\n    &lt;endpoint  name=\"Megatec.MasterTourService.Contracts.IAdminServiceWindows\"\n        address=\"net.tcp://Computer2:5012/IISTest/AdminService.svc/Windows\"\n        behaviorConfiguration=\"CustomBehavior\"\n        binding=\"netTcpBinding\"\n        bindingConfiguration=\"CommonWindowsBinding\"\n        contract=\"Megatec.MasterTourService.Contracts.IAdminService\"&gt;\n       &lt;identity&gt;\n            &lt;dns value=\"WCFServer\" /&gt;\n       &lt;/identity&gt;\n    &lt;/endpoint&gt;        \n&lt;/client&gt;\n&lt;behaviors&gt;         \n  &lt;behavior name=\"CustomBehavior\"&gt;\n    &lt;dataContractSerializer maxItemsInObjectGraph=\"10000000\"/&gt;\n    &lt;clientCredentials&gt;\n      &lt;clientCertificate findValue=\"WCFClient\" x509FindType=\"FindBySubjectName\"\n          storeLocation=\"LocalMachine\" storeName=\"My\" /&gt;\n           &lt;serviceCertificate&gt;\n               &lt;defaultCertificate findValue=\"WCFServer\" storeLocation=\"LocalMachine\"\n                                   x509FindType=\"FindBySubjectName\" /&gt;\n               &lt;authentication certificateValidationMode=\"PeerTrust\" \n                               revocationMode=\"NoCheck\"\n                               trustedStoreLocation=\"LocalMachine\"/&gt;\n            &lt;/serviceCertificate&gt;\n          &lt;/clientCredentials&gt;\n        &lt;/behavior&gt;\n      &lt;/endpointBehaviors&gt;\n    &lt;/behaviors&gt;\n  &lt;/system.serviceModel&gt;\n&lt;/configuration&gt;\n</code></pre></li>\n</ul>\n\n<p>Channel has the following credentials</p>\n\n<pre><code>channelFactory.Credentials.Windows.AllowedImpersonationLevel =\n    System.Security.Principal.TokenImpersonationLevel.Delegation;\nchannelFactory.Credentials.Windows.ClientCredential =\n    System.Net.CredentialCache.DefaultNetworkCredentials;\n</code></pre>\n\n<p>It falls with db error </p>\n\n<blockquote>\n  <p><em>Login failed for user 'NT AUTHORITY\\Anonymous'</em></p>\n</blockquote>\n\n<p>So, there is some problem with WCF delegation. When I tried to use simple <code>username/password</code> authentication, it worked fine - so, certificates and so on are fine. </p>\n\n<p>I did Step 4 on <a href=\"http://msdn.microsoft.com/en-us/library/ff650896.aspx\" rel=\"nofollow\">this instruction</a>, but it doesn't work. </p>\n\n<p>Maybe something is wrong with my code or configs? How can I fix it?</p>\n\n<p><strong>UPDATE</strong>. </p>\n\n<ol>\n<li><p>Tried (no result)</p>\n\n<p>[OperationBehavior(Impersonation = ImpersonationOption.Allowed)] => [OperationBehavior(Impersonation = ImpersonationOption.Required)]</p></li>\n<li><p>Tried  (no result)</p>\n\n<p></p></li>\n<li><p>On the service side </p>\n\n<p>ServiceSecurityContext.Current.WindowsIdentity.ImpersonationLevel = Impersonation (not Delegation!)</p></li>\n<li><p>When I tried to change identity for IIS pool from ApplicationPoolIdentity to IISLogin@myDomain.ru, the client on the computer 3 crashed.</p></li>\n</ol>\n"},{"tags":["sql-server","sharepoint","iis"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":19,"score":3,"question_id":13139532,"title":"Sql server login name not working properly in .net roles","body":"<p>I created one new sql login for configuring the forms based authentication in sharepoint. I created login with name <strong>FBAUser</strong>, but If I add that user to .net roles of IIS manager, it is showing login failed.\n<img src=\"http://i.stack.imgur.com/QmECP.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/Aj56N.png\" alt=\"enter image description here\"></p>\n\n<p>Why this problem occurring. After creating the new login in sql server, if I try to login with that credentials login also not happening. I checked the properties of the server as <strong>\"Sql and windows authentication mode\"</strong> as below.\n<img src=\"http://i.stack.imgur.com/CJoH3.png\" alt=\"enter image description here\"></p>\n\n<p>Can any one provide me the solution for this one!!</p>\n"},{"tags":["sql-server","math","overflow"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13121154,"title":"Arithmetic overflow error converting nvarchar to data type numeric","body":"<p>I have a stored procedure which works fine in my local environment as well as the QA environment. </p>\n\n<p>However at the UAT environment at the client it gives the error </p>\n\n<blockquote>\n  <p><em>System.Data.SqlClient.SqlException:</em><br>\n   <em>Message number=\"8115\" severity=\"16\" state=\"8\">Arithmetic overflow error\n   converting nvarchar to data type numeric.</em></p>\n</blockquote>\n\n<p>It also works fine in one of the local instances installed in the client location. \nI found out the line of code which gives an error by commenting/umcommenting lines of code and zeroed it down to</p>\n\n<pre><code>(\n        @TotalHHInternalTo IS NULL\n        OR\n        (\n            IsNumeric(E.[Xml].value(\n                                    'declare default element namespace \"http://www.xyz/1.0\";\n                                    (/Event/Data/CustomData/DataXML/ProductData/ProductParty/ProductCategory[@code != ''Protection'']/Product/FundValue)[1]',\n                                    'nvarchar(50)'\n                                    ) ) = 1\n            AND\n            EXISTS\n            (\n                SELECT \n                    1\n                FROM E.[Xml].nodes(\n                    'declare default element namespace \"http://www.xyz/1.0\";\n                    /Event/Data/CustomData/DataXML/ProductData/ProductParty/ProductCategory[@code != ''Protection'']/Product') as P(E)\n                HAVING SUM(P.E.value(\n                                        'declare default element namespace \"http://www.xyz/1.0\";\n                                        (FundValue)[1]',\n                                        'decimal'\n                                        )) &lt;= @TotalHHInternalTo\n            )   \n        )\n     )\n</code></pre>\n\n<p>The variable <code>@TotalHHInternalTo</code> is a parameter of type decimal which is part of search criteria passed to the stored procedure as an xml. Under Product party I have 4 product category and I need to total up all Fund value except of type Protection. If the sum of these 3 types is less than  <code>@TotalHHInternalTo</code> I would like to display it in the search result.</p>\n\n<p>I added the <code>isNumeric</code> condition to check if the value picked up from the xml is a numeric value. </p>\n\n<p>However I still get an overflow error. </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13139140,"title":"SQL Server 2008 Calculation Bug","body":"<p>Here is the query i am running</p>\n\n<pre><code>Select (100/18)*18\n</code></pre>\n\n<p>The answer i get is 90. I have tried declaring each of the numbers as decimals also, and i get the value <code>100.0008</code>, but when i calculate with variables as floats the answer is correct at '100' so does anyone have any idea why SQL calculates like this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13138194,"title":"Dependency on master and child in SQL","body":"<p>I have a master table like this</p>\n\n<pre><code>Product    Status  Product id\nA          True     1\nB          True     2\nC          true     3\nD          True     4\nE          false    5\nF          True     6\n</code></pre>\n\n<p>Now I have other table which is giving me the dependency of the product</p>\n\n<pre><code>Product    DependencyId\nC             2\nC             5\nE             1\nB             4\nB             6\n</code></pre>\n\n<p>Now when I searching for C, I can see that two products are dependent upon C now these two product is dependent upon other products.</p>\n\n<p>And let say I am searching for E, then I there are only one dependency of the product.</p>\n\n<p>Now, I need to check for a product that if any dependency is false or not. If any of the dependency is false then I have to return some text/value.</p>\n\n<p><strong>Result</strong></p>\n\n<pre><code>When product is C then output will be E (because the grand children of C (i.e. E) has false)\n\nWhen product is B then output will be NULL (becuase none of the child of B or their sub childrens has false)\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13137246,"title":"Column in table is of a type that is invalid for use as a key column in an index","body":"<p>I have a table where I am storing employee details. I want to alter the table and set one of the column <code>emp_code</code> as primary key. Its datatype is <code>nvarchar(max)</code>, but I am not able to set it as primary key.</p>\n\n<p>I run the following query : </p>\n\n<pre><code>ALTER TABLE user_master\nADD PRIMARY KEY (emp_code)\n</code></pre>\n\n<p>but it gives me an error :</p>\n\n<blockquote>\n  <p><em>Msg 1919, Level 16, State 1, Line 1</em><br>\n  <em>Column <code>emp_code</code> in table <code>user_master</code> is of a type that is invalid for use as a key column in an index.</em><br>\n  <em>Msg 1750, Level 16, State 0, Line 1</em><br>\n  <em>Could not create constraint. See previous errors.</em></p>\n</blockquote>\n\n<p>How can I overcome this?</p>\n"},{"tags":["sql-server","sql-server-2008","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13132526,"title":"Selecting Change_Tracking_Current_Version() in SQL Server 2008 table trigger","body":"<p>I am using SQL Server 2008 and Change tracking is enabled on my Database.\nOn one of my tables in the database, I have created the following Trigger.</p>\n\n<pre><code>CREATE TRIGGER [dbo].[tr_student]\n   ON [dbo].[Student]\n   FOR UPDATE,DELETE\nAS \nBEGIN\n   SET NOCOUNT ON;\n   SELECT CHANGE_TRACKING_CURRENT_VERSION()\nEND\n</code></pre>\n\n<p>The purpose of this Trigger is - when I update or delete a record in table dbo.Student I should get the the Current change Tracking Version Id.</p>\n\n<p>But when I update/delete a record in the table, CHANGE_TRACKING_CURRENT_VERSION() is not giving the current version_id but the previous version_id. After the trigger is fired,if I execute \n    select CHANGE_TRACKING_CURRENT_VERSION()\nI am getting the correct current version id.</p>\n\n<p>So does the Change_Tracking_Current_Version() id change only after the trigger? Is there any method to get correct Change_Tracking_Current_Version() in the Trigger?</p>\n"},{"tags":["c#","asp.net","sql-server","session-variables"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13137997,"title":"Retrieve field from session","body":"<p>I have a form where company can register, in this registration a user code is generated randomly... The CompCode is saved with all the other information in a database table as the primary key...</p>\n\n<p>When a user is registered, they can log in... when they successfully log in, their compName is saved as a session variable</p>\n\n<pre><code>Session[\"CompName\"] = TextBox1.Text;\n</code></pre>\n\n<p>Now once logged in, they have the opportunity to post a job, this job details is saved in another table called job... but in order for the job details to be related to the company i need the CompID</p>\n\n<p>How do I retrieve the CompID using the session CompName</p>\n\n<pre><code> protected void Save_Click(object sender, EventArgs e)\n{\n    string answer = \"NO\";\n    string strcon = \"Data Source=.\\\\SQLEXPRESS;AttachDbFilename=|DataDirectory|\\\\VC_temps.mdf;Integrated Security=True;Connect Timeout=30;User Instance=True\";\n    SqlConnection con = new SqlConnection(strcon);\n\n    SqlCommand com = new SqlCommand(\"Store-Jobs\", con);\n    com.CommandType = CommandType.StoredProcedure;\n    com.Parameters.AddWithValue(\"Job\", TextBox1.Text);\n    com.Parameters.AddWithValue(\"JobType\", DropDownList1.Text);\n    com.Parameters.AddWithValue(\"StartDate\", Calendar1.SelectedDate);\n    com.Parameters.AddWithValue(\"Time\", TextBox2.Text);\n    com.Parameters.AddWithValue(\"JobID\", TextBox1.Text.Substring(3).ToUpper());\n    com.Parameters.AddWithValue(\"CompanyID\", ?);\n    com.Parameters.AddWithValue(\"PoistionFilled\", answer);\n    com.Parameters.AddWithValue(\"Description\", TextBox4.Text);\n\n    con.Open();\n    com.ExecuteNonQuery();\n    Labelinfo.Text = \"Post successful.\";\n}\n</code></pre>\n"},{"tags":["c#","sql","sql-server","ado.net"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13138615,"title":"SqlDataAdapter does not fill DataSet","body":"<p>I'm using VS2012 and SQL Server Express 2008.  I've boiled down my connection/query to try and find out why my <code>DataSet</code> is not being filled.  The connection is completed successfully, and no exceptions are thrown, but the adapter does not fill the <code>DataSet</code>. The database that this is pulling from is on the same PC and using <code>localhost\\SQLEXPRESS</code> does not change the result.  Thanks for any input!</p>\n\n<pre><code>SqlConnection questionConnection = new SqlConnection(ConfigurationManager.ConnectionStrings[\"DefaultConnection\"].ConnectionString);\nquestionConnection.Open();\nString sql = \"SELECT * FROM HRA.dbo.Questions\";\nSqlDataAdapter adapter = new SqlDataAdapter();\nDataSet ds = new DataSet();\nSqlCommand command = new SqlCommand(sql, questionConnection);\nadapter.SelectCommand = command;\nadapter.Fill(ds);\nadapter.Dispose();\ncommand.Dispose();\nquestionConnection.Close();\n</code></pre>\n\n<p>Connection String:</p>\n\n<pre><code>&lt;add name=\"DefaultConnection\" providerName=\"System.Data.SqlClient\" connectionString=\"Data Source=CODING-PC\\SQLEXPRESS;Initial Catalog=HRA;User ID=sa; Password= TEST\" /&gt;\n</code></pre>\n"},{"tags":["sql-server","accounting"],"answer_count":9,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":4894,"score":3,"question_id":1771995,"title":"Calculate fiscal year in SQL Server","body":"<p>How would you calculate the fiscal year from a date field in a view in SQL Server?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4715,"score":2,"question_id":4655981,"title":"SQL Server - use Exists clause in Where and Select","body":"<p>I have a view that's something like</p>\n\n<pre><code>CREATE VIEW OrdersView WITH SCHEMABINDING AS\nSELECT o.Id, o.OrderDate, o.LastName, o.TotalPrice, s.Status\nFROM dbo.Orders o INNER JOIN dbo.OrderStatus s on o.Id = s.OrderId\nWHERE NOT EXISTS (SELECT NULL from dbo.OrderStatus where OrderId = s.OrderId and StatusDate &gt; s.StatusDate\nAND EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderId = o.Id)\n</code></pre>\n\n<p>The intent is to fetch all orders that have at least one line item of type 1 along with their current status.</p>\n\n<p>We're in the process of adding a second type of line item, and I have modified the view such that it will include orders that have at least one line item of type 1 or type 2:</p>\n\n<pre><code>CREATE VIEW OrdersView WITH SCHEMABINDING AS\nSELECT o.Id, o.OrderDate, o.LastName, o.TotalPrice, s.Status\nFROM dbo.Orders o INNER JOIN dbo.OrderStatus s on o.Id = s.OrderId\nWHERE NOT EXISTS (SELECT NULL from dbo.OrderStatus where OrderId = s.OrderId and StatusDate &gt; s.StatusDate\nAND (EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderId = o.Id)\n  OR EXISTS (SELECT NULL FROM dbo.OrderLineItemType2 WHERE OrderId = o.Id))\n</code></pre>\n\n<p>Easy enough, but I've just had a requirement added to show whether an order contains line items of type 1 or type 2 (or both) in the grid where these results are displayed:</p>\n\n<pre>\nOrder ID | T1 | T2 | Last name | Price    | Status\n============================================================\n12345    | x  |    | Smith     | $100.00  | In Production\n12346    | x  | x  | Jones     | $147.23  | Part Dispatched\n12347    |    | x  | Atwood    | $12.50   | Dispatched\n</pre>\n\n<p>The only way I can think of is to do:</p>\n\n<pre><code>CREATE VIEW OrdersView WITH SCHEMABINDING AS\nSELECT o.Id, \n       CASE WHEN EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderID = o.Id) THEN 1 ELSE 0 END AS HasType1,\n       CASE WHEN EXISTS (SELECT NULL FROM dbo.OrderLineItemType2 WHERE OrderId = o.ID) THEN 1 ELSE 0 END AS HasType2,\n       o.OrderDate, o.LastName, o.TotalPrice, s.Status\nFROM dbo.Orders o INNER JOIN dbo.OrderStatus s on o.Id = s.OrderId\nWHERE NOT EXISTS (SELECT NULL from dbo.OrderStatus where OrderId = s.OrderId and StatusDate &gt; s.StatusDate\nAND (EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderId = o.Id)\n  OR EXISTS (SELECT NULL FROM dbo.OrderLineItemType2 WHERE OrderId = o.Id))\n</code></pre>\n\n<p>But this smells wrong with the duplication of the <code>EXISTS</code> clauses.  Is there a better qway to write it?  Can I make it perform better?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":503,"score":1,"question_id":10604275,"title":"Fiscal Year To-Date in Where Clause (T-SQL)","body":"<p>Company's Fiscal Year: July 1 - June 30</p>\n\n<p>I have a query where I am trying to capture aggregate # of units and $ revenue by product and cost center for the fiscal year-to-date.  It will run on the 1st of the month and look through the last day of the previous month.  Fiscal year does not appear in the report - it is criteria.</p>\n\n<pre><code>    Mix of pseudocode and SQL:\n    Where\n      If datepart(mm,getdate()) - 1 &lt; 7\n        THEN \n           transaction_post_date BETWEEN 7/1/ previous year AND dateadd(day,-(day(getdate()),getdate())          \n        Else \n           transaction_post_date BETWEEN 7/1/current year AND dateadd(day,-(day(getdate()),getdate())          \n</code></pre>\n\n<p>Am I on the write track?  How do I write the SQL for a specific date on a year that depends on SQL - 7/1/current year?  </p>\n\n<p>I am weak using variables and do not even know if I have access to create them on the SQL Server DB, which is rather locked down.  Definitely can't create a function.  (I'm a business analyst.)</p>\n\n<p>UPDATE, Fiscal year goes forward, so July 1, 2010, is Fiscal Year 2011.</p>\n\n<p>I think this works:</p>\n\n<pre><code>    Year(dateadd(month,6,htx.tx_post_date)) = Year(DateAdd(Month, 5, GetDate()))\n</code></pre>\n\n<p>Feeback?</p>\n\n<p>And now I've been asked to add Fiscal Year-To-Date fields for quantity and revenue to the following query which gave me totals for </p>\n\n<pre><code>    Select \n      inv.ITEM_CODE \n    , inventory.ITEM_NAME \n    , cc.COST_CENTER_CODE \n    , tx.REV_CODE_ID \n    , tx.PRICE \n    , tx.ITEM_SALE_ID\n    , sum(tx.quantity)\n    , sum(tx.amount)\n\n    from\n    transactions tx\n    inner join inventory inv on inv.item_id = tx.item_id\n    left outer join cost_center cc on cc.cost_center_id = tx.cost_center_id\n\n    where \n    DATEPART(mm, tx.tx_date) = DATEPART(mm,dateadd(m,-1,getdate()))\nand DATEPART(yyyy, tx.tx_date) = DATEPART(yyyy,dateadd(m,-1,getdate()))\n\n    group by \n      inv.ITEM_CODE \n    , inventory.ITEM_NAME \n    , cc.COST_CENTER_CODE \n    , tx.REV_CODE_ID \n    , tx.PRICE \n    , tx.ITEM_SALE_ID\n</code></pre>\n\n<p>I need to add the fiscal year-to-date quantity and and amount columns to this report.  Would a correlated subquery by the way to go?  Would the joins be tricky?  I've never used a subquery with an aggregation/grouping query.  </p>\n\n<p>Thanks for all the previous help.  </p>\n"},{"tags":["sql-server","query","sql-update","division","multiple-columns"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13137975,"title":"Divide by from selected columns","body":"<p>Sorry if the question was asked before i try search but not found. I'm still new on mssql so\nmaybe the answer are obvious just i cant find.</p>\n\n<p>My current query is:</p>\n\n<pre><code>SELECT gold_min, gold_max, gold_min_2, gold_max_2\nFROM m_rdb\n</code></pre>\n\n<p>I want to divide the values on current columns by 20 and then update, just not sure how to do.\nAny help are welcome. </p>\n"},{"tags":["sql","sql-server","datetime"],"answer_count":5,"favorite_count":7,"up_vote_count":20,"down_vote_count":0,"view_count":48713,"score":20,"question_id":1110998,"title":"Get Day of Week in SQL 2005/2008","body":"<p>Say I have a date 01/01/2009, I want to find out what day it was e.g. Monday, Tuesday, etc...</p>\n\n<p>Is there a built in function for this in Sql2005/2008? Or do I need to use an auxiliary table?</p>\n"},{"tags":["sql-server","sql-server-2005","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":524,"score":2,"question_id":3843256,"title":"Where does a Server trigger save in SQL Server?","body":"<p>A couple of days ago , I was practicing and I wrote some triggers like these :</p>\n\n<pre><code>create trigger trg_preventionDrop\non all server \nfor drop_database\nas\nprint 'Can not Drop Database'\nrollback tran\n\ngo \n\ncreate trigger trg_preventDeleteTable\non database\nfor drop_table\nas \nprint 'you can not delete any table'\nrollback tran\n</code></pre>\n\n<p>But the problem is I don't know where it has saved and How can I delete or edit those.</p>\n\n<p>Thank you </p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13137397,"title":"sql server select query","body":"<p>When I run a <code>SELECT</code> query in SQL Server Management Studio that has a <code>WHERE</code> clause and the database is located on the network, is the query 'run' on the Server or my Desktop PC, eg. will the entire table be brought back from the server and then filtered on my PC or will the filtering be done on the Server?</p>\n\n<p>Does this behaviour differ if I'm using MS Access to run the query against the (remote) database?</p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":118,"score":1,"question_id":13136204,"title":"Generate sequence number in SQL on every insert","body":"<p>I need to enter primary key in table as in below format </p>\n\n<pre><code>YYYY/MMM/NNNNNN\n</code></pre>\n\n<p>Where, <code>YYYY</code> is the current year, <code>MMM</code> is Month , and <code>NNNNNN</code> is a sequence no from <code>000001, 000002, 000003, .... 999999</code>.</p>\n\n<p>So my primary key will look like <code>2012/Oct/000001</code> or <code>2012/Oct/000010</code> ....</p>\n\n<p>How can I generate this type of code..</p>\n\n<p>I can get Year and Month from <code>Getdate()</code> function. But how can I manage sequence number on every insert. can you please give me logic for that?</p>\n"},{"tags":["sql-server","text","asp-classic","procedure","nvarchar"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13136395,"title":"What is the biggest data type to use as a local variable in a stored procedure?","body":"<p>I have the next issue:</p>\n\n<pre><code>--DECLARE @TEST NVARCHAR(MAX)\n--DECLARE @TEST2 NVARCHAR(MAX)\n\nDECLARE @TEST NTEXT\nDECLARE @TEST2 NTEXT\n</code></pre>\n\n<p>NVARCHAR(MAX) is to small for the amount of text in need to put when executing a stored procedure, also, TEXT, NTEXT and IMAGE data types are invalid for local variables, what can I do to sidestep this issue and store the oversized text like.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["php","sql-server","performance","apache","debugging"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":13135087,"title":"Apache Server and SQL Server 2008 Express Performance. Isolate, method or suggestions","body":"<p>I was wondering if some tips or guidance can be provided for the following issue. </p>\n\n<p>Environment type: Small office, approx 20 users.\nNetwork: All server, workstation belong to a single subnet\nInfrastructure: Virtualised webserver and virtualised database server.</p>\n\n<p>Currently I have a web server (Win7SP1 x64) running Apache 2.2.22 (Win32) and PHP 5.3.10. I have built some pages that connects to our database (SQL2k8 Express) and calls procedures, the procedures are basically just basic select statements with joins and conditions. Once the result set are returned, PHP loop through the result set, row by row and display the rows as it flow through. </p>\n\n<p>What happens is that from time to time, the result page can take a extremely long to load,where no results set are displayed but the web browser loading bar/icon flashes. Some times it will just give a blank screen at the end of the load, which typically means the query connection has timed-out or some times it will return the result set. For example, under normal behaviour, a page will take approx 1-3s to load, while at odd times, it may take up to 20-30s.</p>\n\n<p>I have noticed that if I run queries in SQLSVR Mgmt Studio, queries that may take ~5s to return a result set may take approx ~15s to load on my web server. </p>\n\n<p>I know poor PHP coding can cause slow downs but the odd performance behaviour has me bit baffled, as Im sure my coding isnt that bad.</p>\n\n<p>So if people could offer some tips in how I can go about diagnosting or isolating the problem, or advise areas that I could look at, it will be great. I know there are Apache logs, SQL SVR logs and performance indicators, but Im still fairly new to this area and am really lost in the approach /methodology I should take. </p>\n\n<p>Example, any specific mods I should enable in Apache etc. or the type of Apache server I should use, connection sockets in web server etc?</p>\n\n<p>Example of my PHP query/procedure calls</p>\n\n<pre><code>$queryStatement = \"exec myProc @para1='asd'\";\n$prepare = $dbConnect-&gt;prepare($queryStatement);\n$result = $prepare-&gt;execute();\nWHILE($result = $prepare-&gt;fetch(PDO::FETCH_ASSOC)){\nset_time_limit(180);\necho $result\n}\n</code></pre>\n\n<p>Cheers everyone :)</p>\n"},{"tags":["sql-server","security","bcp","xp-cmdshell","sql-server-administration"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13127013,"title":"What is the most secure way to allow users to execute BCP export command from SQL?","body":"<p>I am currently working in an environment where the ability to <strong>export</strong> a table <strong>programatically</strong> from within a hand-run SQL script would be of great help.  </p>\n\n<p>Performing the exports from script will be the first step towards running the entire process from within a stored procedure, therefore I have to be able to initiate the export from SQL.</p>\n\n<p>The organisation currently has the following configuration on most servers - </p>\n\n<ul>\n<li>SQL Server 2005 or 2008</li>\n<li>xp_cmdshell - <strong>disabled</strong></li>\n<li>CLR - <strong>enabled</strong></li>\n</ul>\n\n<p>Ultimately, I would like to be able to call a procedure passing the following parameters and have it perform the export.</p>\n\n<ul>\n<li>table name</li>\n<li>file path/name (on a network share)</li>\n<li>file format </li>\n</ul>\n\n<p>Currently BCP seems like a perfect option in terms of functionality but I am unable to invoke it via the command line due to xp_cmdshell being disabled.</p>\n\n<p>The organisation is quite small and happy work towards a secure solution and my impression so far is that they have a good level of control over their security.  They have made a blanket decision to disable xp_cmdshell but if I could present a safe way to allow use of it I think they would be pretty receptive. </p>\n\n<p>In my research I've come across both the <strong>'EXECUTE AS'</strong> functionality as well as signing procedures with <strong>certificates</strong>, but still cant work out if either approach can help me achieve what I want.</p>\n\n<p>Also, if you have another solution that allows me to achieve the same end-result I'm all ears!</p>\n"},{"tags":["sql","sql-server"],"answer_count":7,"favorite_count":2,"up_vote_count":11,"down_vote_count":0,"view_count":38657,"score":11,"question_id":177323,"title":"how to read the last row with SQL Server","body":"<p>What is the most efficient way to read the last row with SQL? The table is indexed on a unique key--the \"bottom\" key values represent the last row. </p>\n\n<p>Edit: This is for SQL Server.</p>\n\n<p>Thank you</p>\n\n<p>rp</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13134649,"title":"How can i join sys.columns of view to sys.columns of the table it is referencing in T-SQL?","body":"<p>I am trying to join records in <strong>sys.columns</strong> for a view, to the records in <strong>sys.columns</strong> for the table it is referencing, because i need the values of <strong>is_nullable</strong>, <strong>is_computed</strong> and <strong>default_object_id</strong> columns for the columns that are selected in the view.</p>\n\n<p>The <strong>sys.columns</strong> records for the view have \"incorrect\" values, which you can observe by running the example queries below:</p>\n\n<pre><code>CREATE TABLE TestTable (\n    FieldA int NOT NULL,\n    FieldB int DEFAULT (1),\n    FieldC as CONVERT(INT, FieldA + FieldB),\n    FieldD int NOT NULL\n)\nGO\n\nCREATE VIEW TestView WITH SCHEMABINDING AS\nSELECT  FieldA, FieldC as TestC, FieldB + FieldC as TestD\nFROM dbo.TestTable WHERE FieldD = 1\nGO\n\nSELECT  OBJECT_NAME(c.object_id) as ViewName, c.name as ColumnName,\n        c.is_nullable as Nullable, c.is_computed as Computed,\n   cast(CASE WHEN c.default_object_id &gt; 0 THEN 1 ELSE 0 END as bit) as HasDefault\nFROM sys.columns c\nWHERE object_id = OBJECT_ID('TestTable')\nGO\n\nSELECT  OBJECT_NAME(c.object_id) as ViewName, c.name as ColumnName,\n        c.is_nullable as Nullable, c.is_computed as Computed,\n   cast(CASE WHEN c.default_object_id &gt; 0 THEN 1 ELSE 0 END as bit) as HasDefault\nFROM sys.columns c\nWHERE object_id = OBJECT_ID('TestView')\nGO\n</code></pre>\n\n<p>I have tried using system views to join on dependencies, but they do not give us information about which column in the view refers to which column in the table:</p>\n\n<pre><code>-- dm_sql_referenced_entities gives us all columns referenced, but all records\n-- have referencing_minor_id 0, so we do not know which column refers to what\nSELECT * FROM sys.dm_sql_referenced_entities('dbo.TestView', 'OBJECT')\nGO\n\n-- sql_dependencies gives us all columns referenced, but all records has\n-- column_id 0 so we can not use this either of joining the columns\nSELECT * FROM sys.sql_dependencies WHERE object_id = OBJECT_ID('TestView')\nGO\n\n-- sql_expression_dependencies just tells us what table we are referencing \n-- if view is not created WITH SCHEMABINDING. If it is, it will return columns,\n-- but with referencing_minor_id 0 for all records, so not able use this either\nSELECT * FROM sys.sql_expression_dependencies\n    WHERE referencing_id = OBJECT_ID('TestView')\nGO\n</code></pre>\n\n<p>This unanswered post on social.msdn submitted by someone seems to be the same issue:\n<a href=\"http://social.msdn.microsoft.com/Forums/en-US/transactsql/thread/4ae5869f-bf64-4eef-a952-9ac40c932cd4\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/transactsql/thread/4ae5869f-bf64-4eef-a952-9ac40c932cd4</a></p>\n"},{"tags":["c#",".net","sql-server","synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13135714,"title":"Sync SQL Server Database using .net","body":"<p>I have a Central (Server) Database and there are multiple client Databases.</p>\n\n<p>I want to synchronize them with the Server Database. Also the clients can use the database offline.</p>\n\n<p>What will be the project approach or what architecture in .NET I should follow?</p>\n\n<p>Can Microsoft Sync framework be helpful?</p>\n\n<p>It should not affect the performance.</p>\n"},{"tags":["sql-server","excel","excel-vba","adodb"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":101,"score":1,"question_id":13129090,"title":"Excel Automation Error Importing DB into Worksheets","body":"<p>I have a workbook with 192 worksheets that correspond to the 192 tables in our mssql database. If I set up a given table in Data Connections Wizard, all of the data is properly dumped into the worksheet. However, when I run my code below, I get:</p>\n\n<p>Run-Time Error '214767259 (80004005)' Automation Error Unspecified Error</p>\n\n<p>About half of the tables populate just fine. I've noticed that I get the error once it reaches a field that has a large amount of data (rtf text). The fields that have that text aren't important to me, so if excel could leave those blank and continue on I would be happy. That large field is in a different column (sometimes multiple columns) depending on each table, so it'd be time consuming to have to go through all 192 tables to weed out an individual column to not import. </p>\n\n<p>Why am I getting this error when I run it in vba, but the data connection wizard has no problems?</p>\n\n<pre><code>Sub GetData()\n\nDim cnDump As ADODB.Connection\nSet cnDump = New ADODB.Connection\n\n' Provide the connection string.\nDim strConn As String\n\n'Use the SQL Server OLE DB Provider.\nstrConn = \"Provider=SQLOLEDB.1;Integrated Security=SSPI;Persist Security Info=True;Initial Catalog=XXXX;Data Source=XXXX\\XXXX;Use Procedure for Prepare=1;Auto Translate=True;Packet Size=4096;Workstation ID=XXXX;Use Encryption for Data=False;Tag with column collation when possible=False;\"\n\n'Now open the connection.\ncnDump.Open strConn\n\n\n' GET DATA\nDim ws As Worksheet\nDim tbl_name As String\n\nDim rsDump As ADODB.Recordset\nSet rsDump = New ADODB.Recordset\n\nFor Each ws In Worksheets\n\ntbl_name = ws.Name\nws.Rows.ClearContents\n\nWith rsDump\n\n    .ActiveConnection = cnDump\n    .Open \"SELECT * FROM \" &amp; tbl_name\n\n    For i = 1 To .Fields.Count\n     ws.Cells(1, i) = .Fields(i - 1).Name\n    Next i\n\n\n    ws.Range(\"A2\").CopyFromRecordset rsDump\n\nEnd With\n\n\nws.Rows(1).Font.Bold = True\n\n\nNext ws\n\ncnDump.Close\nSet rsDump = Nothing\nSet cnDump = Nothing\n\n\n\nEnd Sub\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":54,"score":-3,"question_id":13135107,"title":"SUM function in SQL","body":"<p>There are three tables,we have to select data from these table using one primary key and foreign key. But in the one table there is lot of data in the third table. We have to sum the data on the base of the primary key.</p>\n\n<p><img src=\"http://i.stack.imgur.com/SW9TB.png\" alt=\"Table1\">  <img src=\"http://i.stack.imgur.com/PqGVS.png\" alt=\"Table2\"> <img src=\"http://i.stack.imgur.com/m7V5a.png\" alt=\"table3\"></p>\n\n<pre><code>BAl = Balance, met = Method, amo = amount, cst_id, cut_id, cut_i = customer_id\n</code></pre>\n\n<p>Now we have to sum the on the basis of method and sum for 10 cust id in the same query. Can anyone help me on this?</p>\n"},{"tags":["sql-server","logging","elmah","nlog"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13134815,"title":"Separate database to store logs and exceptions","body":"<p>In an enterprise project I need to log high amount of data (original values of modified data and new values, user who modified data, etc)\nWe're using NLog to log such data and ELMAH to log exceptions.\nI'm not sure to use separate database for logging or use the main database which all data are stored.\nAdvantages of using separate database are:</p>\n\n<ul>\n<li>Logs and exceptions are not part of business, so they don't need to\nbe in main database. </li>\n<li>Load on main database will be reduced and performance will be better.</li>\n</ul>\n\n<p>Disadvantages are:</p>\n\n<ul>\n<li>If the log database stops, we will miss logs which are very important\nin this project. (although we can prevent saving if logging was not\nsuccessful)</li>\n<li>Handling transactions will be hard. (What if log saved, but the data\nare not)</li>\n</ul>\n\n<p>There are more advantages and disadvantages of course, but all in all, I need to know in enterprise projects which method is recommended? \nOr maybe it is varies from project to project based on some factors?</p>\n"},{"tags":["sql","sql-server","full-text-search"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13130551,"title":"Optimizing function that returns phrases present in given text","body":"<p>I need to implement a function that takes a text (some longer document) as a parameter and returns list of phrases that are present in it. Phrases are stored in a table <code>Phrases (id int primary key, phrase text)</code> and there can be as many as 10 millions of them.</p>\n\n<p>My question is: How can I take the advantages of SQL Server's full-text indexes to keep execution time at fairly low level. Searching for documents containing given phrases is obvious but what about this inverted situation?</p>\n"},{"tags":["c#","sql-server","search","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":13128493,"title":"SQL database search -> calling multiple stored procedures / functions","body":"<p><strong>Background</strong></p>\n\n<p>I am currently re-writing a search engine...which I originally wrote a couple years ago in a hurry :)</p>\n\n<p>Today, the search encompasses ~5 different internal business objects/tables: Users, Organizations, News Headlines, etc. So when the user types in <code>\"The Quick Brown Fox\"</code> into the search box, he/she will get results of each type of business object.</p>\n\n<p>Each business object has an associated stored procedure: <code>spSearchUsers</code>, <code>spSearchOrganizations</code>, etc.</p>\n\n<p><strong>The problem</strong></p>\n\n<p>Now, for each search, I am calling each stored procedure (via a BL -> Data Access Layer) multiple times for each business object type. For example, when the user searches for <code>\"The Quick Brown Fox\"</code>, I send down the entire string unaltered, but also split the string on each single space, and search each word individually.</p>\n\n<p>In this case, each stored procedure is called 5 times...a total of 25 separate database calls for a single search. I don't feel like this typical...but it still runs pretty quick. It takes roughly 4-5 seconds per search.</p>\n\n<p><strong>What I'd like to create</strong></p>\n\n<p>A single \"master\" stored procedure that takes the entire search string <code>\"The Quick Brown Fox\"</code> that in turn calls each individual business object stored procedure (<code>spSearchUsers</code>, <code>spSearchOrganizations</code>, etc), performs a little bit of logic, and returns 1 result set.</p>\n\n<p>So 1 search... 1 result.</p>\n\n<p>Can this be achieved using stored procedures, functions, and/or user-defined table types? </p>\n"},{"tags":["sql-server","ssas","security-roles"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13124481,"title":"(Null) Values in SSAS cube when selecting a role","body":"<p>I have the following problem:</p>\n\n<p>When I process a cube in SSAS and view the data as a normal user without restrictions all is well and the aggregated results show their normal values.</p>\n\n<p>When I choose inside Data Tools (MsSQL 2012) to view the data as a specific role then all the security constraints work normally (For example I view only the Specific country data and no other) but all the corresponding values are (null). </p>\n\n<p>I have tried Visual Totals = true and I have imposed those restrictions on both the dimension and the cube. The CALCULATE in calculation script is still there (everything works ok when I choose to use a normal user). </p>\n\n<p>This is happening on both the measures and the calculated values!!!</p>\n\n<p>Any ideas what could be happening?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":13132222,"title":"Why does Sql Sum of multiple columns containing nulls return incorrect result?","body":"<p>Table containing the following values:</p>\n\n<pre><code>Column1  Column2\n1        NULL\nNULL     4\n2        NULL\nNULL     5\n3        6\n</code></pre>\n\n<p>The following query:</p>\n\n<pre><code>SELECT \n    SUM([Column1] + [Column2] ) \nFROM [myTable]\n</code></pre>\n\n<p>returns a value of <code>9</code> when it should be returning <code>21</code>. Why? How does it arrive at the value?</p>\n\n<p>I know the SUM can be corrected by adding <code>ISNULL</code> like so:</p>\n\n<pre><code>SELECT \n    SUM(ISNULL([Column1], 0) + ISNULL([Column2], 0)) \nFROM [myTable]\n</code></pre>\n\n<p>but I would like to know the logic behind the value <code>9</code></p>\n"},{"tags":["asp.net","sql","sql-server","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13134602,"title":"Creating connection string of database created on different PC","body":"<p>I am trying to use the database send by my friend. He has created it using <em>Sql Server Management Studio</em>. While including the <em><code>.mdf</code></em> file, I am getting an  error message (I have mentioned the error at the end of the answer).\nI think it is because of the difference in the connection strings. I am new to .NET so I just changed the name in the connection string,</p>\n\n<p><strong>From,</strong></p>\n\n<pre><code> &lt;add name=\"ApplicationServices\" connectionString=\"Data Source=sheroz;Initial Catalog=FLEXIFORMDB;integrated security=SSPI\"/&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p><strong>To,</strong></p>\n\n<pre><code> &lt;add name=\"ApplicationServices\" connectionString=\"Data Source=Fahad-PC\\Fahad;Initial Catalog=FLEXIFORMDB;integrated security=SSPI\"/&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>Please help me out to make it work. Thanks in advance.</p>\n\n<h2>Error</h2>\n\n<pre><code>An exception occurred while executing a Transact-SQL statement or batch. (Microsoft.SqlServer.ConnectionInfo)\n\n------------------------------\nProgram Location:\n\n   at Microsoft.SqlServer.Management.Common.ServerConnection.ExecuteNonQuery(String sqlCommand, ExecutionTypes executionType)\n   at Microsoft.SqlServer.Management.Common.ServerConnection.ExecuteNonQuery(StringCollection sqlCommands, ExecutionTypes executionType)\n   at Microsoft.SqlServer.Management.Smo.ExecutionManager.ExecuteNonQuery(StringCollection queries)\n   at Microsoft.SqlServer.Management.Smo.Server.AttachDatabaseWorker(String name, StringCollection files, String owner, AttachOptions attachOptions)\n   at Microsoft.SqlServer.Management.Smo.Server.AttachDatabase(String name, StringCollection files)\n\n===================================\n\nUnable to open the physical file \"D:\\FlexiFormWF\\FlexiFormWF\\FlexiFormDB.mdf\". Operating system error 5: \"5(Access is denied.)\". (.Net SqlClient Data Provider)\n\n------------------------------\nFor help, click: http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=10.00.1600&amp;EvtSrc=MSSQLServer&amp;EvtID=5120&amp;LinkId=20476\n\n------------------------------\nServer Name: FAHAD-PC\\MSSQL\nError Number: 5120\n</code></pre>\n"},{"tags":["sql","sql-server","notin"],"answer_count":8,"favorite_count":6,"up_vote_count":19,"down_vote_count":0,"view_count":22624,"score":19,"question_id":173041,"title":"NOT IN vs NOT EXISTS","body":"<p>Which of these queries is the faster?</p>\n\n<p>NOT EXISTS:</p>\n\n<pre><code>SELECT ProductID, ProductName \nFROM Northwind..Products p\nWHERE NOT EXISTS (SELECT 1 FROM Northwind..[Order Details] od WHERE p.ProductId = od.ProductId)\n</code></pre>\n\n<p>Or NOT IN:</p>\n\n<pre><code>SELECT ProductID, ProductName \nFROM Northwind..Products p\nWHERE p.ProductID NOT IN (SELECT ProductID FROM Northwind..[Order Details])\n</code></pre>\n\n<p>The query execution plan says they both do the same thing.  If that is the case, which is the recommended form?</p>\n\n<p>This is based on the NorthWind database.</p>\n\n<p>[Edit]</p>\n\n<p>Just found this helpful article: \n<a href=\"http://weblogs.sqlteam.com/mladenp/archive/2007/05/18/60210.aspx\">http://weblogs.sqlteam.com/mladenp/archive/2007/05/18/60210.aspx</a></p>\n\n<p>I think I'll stick with NOT EXISTS.</p>\n"},{"tags":["sql","sql-server","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13132616,"title":"Retrieving unique names and based on that fetching the dates","body":"<p>I have two stored procedures like below:</p>\n\n<pre><code>Select distinct TempName from History_Table \n\nSelect TempName,RunDate from History_Table  where TempName=@tempname\n</code></pre>\n\n<p>How do I use a single stored procedure to get a result set of distinct <code>tempname</code>'s and their associated <code>RunDate</code>?</p>\n\n<pre><code>  TempName     RunDate                       RunBy\n\n1   test    2012-10-11 00:00:00.000 chandu\n2   testing 2012-12-15 00:00:00.000 kumar\n3   asdsad  2012-08-09 00:00:00.000 asdsad\n4   test    2012-12-12 00:00:00.000 asdasds\n15  test    2012-10-01 00:00:00.000 asdaddf\n15  test    2012-09-12 00:00:00.000 bghgh\n\nI have to display like\n\nTempName   RunDate                   RunBy\ntest       dates(in a dropdown)      lastrun name(i.e asdasds)\n</code></pre>\n"},{"tags":["c#","asp.net","sql","sql-server","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13133614,"title":"Fetching data using last Datetime","body":"<p>I have to show these details in a gridview as Tempname as unique and associated datetime in drodown and the last run by name in a label. Unable to upload the Table picture as i dont have enough reputation.</p>\n\n<pre>\n    private void GridLoading()\n    {\n        DataSet ds = new DataSet();\n        ds = Common.LoadingGrid();\n        GridView1.DataSource = ds;\n        GridView1.DataBind();\n    }\n\n    protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)\n    {\n        if (e.Row.RowType == DataControlRowType.DataRow)\n        {\n            DataSet ds = new DataSet();\n            Label lblName = e.Row.FindControl(\"Label1\") as Label;\n            ds = Common.RunByDate(lblName.Text);\n            DropDownList ddl = e.Row.FindControl(\"DropDownList1\") as DropDownList;\n\n            ddl.DataTextField = \"RunDate\";\n            ddl.DataValueField = \"RunDate\";\n            ddl.DataSource = ds;\n            ddl.DataBind();\n            var items = ddl.Items;\n          }           \n    }\n</pre>\n\n<p>But i am unable to get the Runby name in the label.How can i display it?Below are my stored procedures</p>\n\n<pre>\n    Select distinct TempName from SV_JobHistoryTable \n\n    SELECT TempName,RunDate\n    FROM SV_JobHistoryTable  where TempName=@tempname \n</pre>\n"},{"tags":["sql","sql-server","tsql","dynamic-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13132253,"title":"OpenQuery in SQL Server","body":"<p>I don't know how to config the <code>OpenQuery</code> function.</p>\n\n<p>I want to use <code>OpenQuery</code> to query database in test project. But I don't know how config the servername param </p>\n\n<pre><code>DECLARE @Sql varchar(max)\nDECLARE @SQLExcuteSentence varchar(max)\n\nSET @Sql = 'declare @UserID INT \nselect @UserID = 1\n\ndeclare @TotalGroupByFields nvarchar(2000)\nselect @TotalGroupByFields = ''Media''\n\ndeclare @CostDataFileds nvarchar(2000)\nselect @CostDataFileds = ''''\n\ndeclare @OtherDataFields nvarchar(max)\nselect @OtherDataFields = ''MonitoringSpotNumber,MonitoringTotalSeconds,BaseCost,ColourLoading,PositionLoading,WeekendLoading,Discount''\n\ndeclare @MasterFilterId nvarchar(max)\nselect @MasterFilterId =''DateRange=20060601-20121231''+char(13)+''IncludeGuests=0''\n\ndeclare @RatingTargetId nvarchar(2000)\nselect @RatingTargetId =''''\n\ndeclare @IsEnableFinancialCloseDate INT\nselect @IsEnableFinancialCloseDate = 0\n\ndeclare @MasterDisplayFormat nvarchar(2000)\nselect @MasterDisplayFormat = ''5''\n\nexec [dbo].[USP_MatrixReport] @UserID, @TotalGroupByFields, @CostDataFileds, @OtherDataFields,  @MasterFilterId, @RatingTargetId, @IsEnableFinancialCloseDate, @MasterDisplayFormat, 0'\n\nSET @SQLExcuteSentence = 'SELECT * FROM OPENQUERY(SQLConn,' + '''' + @Sql + '''' + ')'\nEXEC (@SQLExcuteSentence);\n</code></pre>\n\n<p>the SQLConn is what?? </p>\n"},{"tags":["sql-server","copy","bulkinsert","bulk","bcp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13133669,"title":"sql bulk insert using bcp between servers through script without using linked server","body":"<p>sql bulk insert using bcp between servers through script without using linked server </p>\n\n<p>Im trying to use below queries</p>\n\n<p>bcp AdventureWorks.dbo.BuildVersion out Currency.dat -U sa -P 123456 -c -[cespl-pc130]</p>\n\n<p>bcp AdventureWorks.dbo.BuildVersion in Currency.dat -U sa -P 123456 -c -[cespl-pc83]</p>\n\n<p>I am getting the below error</p>\n\n<p>Msg 102, Level 15, State 1, Line 1\nIncorrect syntax near '.'.</p>\n\n<p>Is it the right way to do.</p>\n\n<p>explain the possibilities to do the bulk data transfer between servers.</p>\n\n<p>thanks in advance</p>\n"},{"tags":["c#","asp.net","sql","sql-server","datetime"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":39,"score":-1,"question_id":13133816,"title":"Removing time which is automatically appended in database","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13119847/formatting-date-in-date-which-is-being-read-from-excel\">Formatting date in date which is being read from excel?</a>  </p>\n</blockquote>\n\n\n\n<p>I am importing excel sheet into sql server database the excel sheet has two columns:\nid|data(which is date in mm/dd/yyyy)\ni want this to get converted to yyyy/mm/dd before sending it to the database:</p>\n\n<pre><code>     DataTable dt7 = new DataTable();\n            dt7.Load(dr);\n            DataRow[] ExcelRows = new DataRow[dt7.Rows.Count];\n            // Bulk Copy to SQL Server\n            using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n            {\n                bulkCopy.DestinationTableName = \"ExcelTable\";\n                dt7.Rows.CopyTo(ExcelRows, 0);\n\n                for (int i = 0; i &lt; ExcelRows.Length; i++)\n                {\n                    if (ExcelRows[i][\"data\"] == DBNull.Value)\n                    {\n                        // Include any actions to perform if there is no date\n                    }\n                    else\n                    {\n                        DateTime oldDate = Convert.ToDateTime(ExcelRows[i][\"data\"]).Date;\n                        DateTime newDate = Convert.ToDateTime(oldDate).Date;\n                        ExcelRows[i][\"data\"] = newDate.ToString(\"yyyy/MM/dd\");\n                    }\n\n\n\n                }\n                bulkCopy.WriteToServer(ExcelRows);\n</code></pre>\n\n<p>There is no error as such but :\nExcel Sheet Value:  6/25/1999\nDatabase value:    6/25/1999 12:00:00 AM</p>\n\n<p>there are three things that need to be taken care of:\n1) the first row is always NULL in db for some unknown reason.\n2) the format is not changing from mm/dd/yyyy to yyyy/mm/dd\n3) the Time which is appended automatically needs to be taken care of.</p>\n"},{"tags":["c#","asp.net","sql","sql-server","date"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":114,"score":0,"question_id":13133159,"title":"Converting date from mm/dd/yyyy which is read from excel to yyyy/mm/dd before sending it to database","body":"<p>I am importing an Excel sheet into a SQL Server database. I am able to upload the data but there is a column in Excel which consists of dates in format <code>mm/dd/yyyy</code>. I want this to be converted to <code>yyyy/mm/dd</code> before sending it to database :</p>\n\n<pre><code>DataTable dt7 = new DataTable();\ndt7.Load(dr);\nDataRow[] ExcelRows = new DataRow[dt7.Rows.Count];\n\n// Bulk Copy to SQL Server\nusing (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n{\n  bulkCopy.DestinationTableName = \"ExcelTable\";\n  dt7.Rows.CopyTo(ExcelRows, 0);\n\n  for (int i = 0; i &lt; ExcelRows.Length; i++)\n  {\n    DateTime oldDate =Convert.ToDateTime(ExcelRows[i][\"data\"]).Date;\n    DateTime newDate = Convert.ToDateTime(oldDate).Date;\n    ExcelRows[i][\"data\"] = newDate.ToString(\"yyyy/MM/dd\");\n  }\n  bulkCopy.WriteToServer(ExcelRows);\n</code></pre>\n\n<blockquote>\n  <p>Error at: DateTime oldDate = Convert.ToDateTime(ExcelRows[i][\"data\"]).Date;<br>\n  Error: Object cannot be cast from DBNull to other types.</p>\n</blockquote>\n\n<p>It seems to me that it is reading wrong column or something since it says <code>cannot be cast from DBnull</code>. The Excel sheet has two columns:</p>\n\n<pre><code>id | data (which is date)\n</code></pre>\n\n<p>I have tried replacing <code>ExcelRows[i][\"data\"]</code> with <code>ExcelRows[i][1]</code> but I got the same error.</p>\n"},{"tags":["sql-server","oracle","sql-server-2008","sql-server-2005","oracle11g"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13133378,"title":"Data Migration From Oracle To SQL Server","body":"<p>I have Oracle database in that in one or more table I have blob data also, i.e. images are stored, now I would like to move that data to sql server database, what is the best way to do this ?</p>\n\n<p>I would like to test for one table migration which contains image data in the Oracle database and move into SQL Server table.</p>\n\n<p>How do I test for migrating data from one table from Oracle to SQL Server ?</p>\n\n<p>but first thing I would like to confirm is that whether Image data moving from Oracle DB to SQL Server DB is possible, is there anything has to be taken care while migrating ?</p>\n\n<p>Thanks in advance.</p>\n\n<p>With Best Regards</p>\n"},{"tags":["sql","sql-server","tsql","date"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2368,"score":1,"question_id":5611570,"title":"how i can retrieve rows by specific date in sql server?","body":"<p>I'm working in project for by PHP and SQL Server.</p>\n\n<p>The owner want from me  design page show only users who register in same day</p>\n\n<p>i.e., if today 11-3-2011 i want show only all users who register in 11-3-2011</p>\n\n<p>The table is:</p>\n\n<pre><code>id  username  date\n\n1   john      11\\3\\2011\n2   sara      11\\3\\2011\n3   john      5\\1\\2011\n4   kreem     1\\2\\2011\n</code></pre>\n\n<p>i make it by mysql </p>\n\n<pre><code>where DATE_ADD( items.created_date, INTERVAL 1 DAY ) &gt; NOW() \n</code></pre>\n\n<p>this cable of code show data which only insert in same day thats mean if today 10-4-2011 it will show only data which insert in 10-4-2011 if i today 15-4-2011 and im dose not insert any thing it will not show any thing, how i can build code like this in sql server? hope to be my question clear and understand </p>\n"},{"tags":["sql-server","performance","ado.net","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":13132903,"title":"SQL Server performance - schema vs multiple databases","body":"<p>This is purely from performance standpoint and only for SQL Server. I am using SQL Server 2012. I am migrating from a different database server (Ctree). The databases are from less than 100mbs to about 2-3GBs, five in total. There are a lot of tables - over 400 tables in all. </p>\n\n<p>Would it be better in terms of performance only to use a single database and multiple schema or multiple databases as is? The existing logic is that there are multiple databases and there are 7 different applications (C# - ADO.NET) that use these. </p>\n"},{"tags":["c#",".net","sql-server","backup","smo"],"answer_count":3,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":8044,"score":6,"question_id":1466651,"title":"How to restore a database from C#","body":"<p>I have a SQL 2008 DB. I am running a form that backs that DB up, then tries to update it. If the update fails the idea is to restore that backup. Here is the code I am using to restore the backup. </p>\n\n<pre><code>public void RestoreDatabase(String databaseName, String backUpFile, String serverName, String userName, String password)\n{\n    Restore sqlRestore = new Restore();\n    BackupDeviceItem deviceItem = new BackupDeviceItem(backUpFile, DeviceType.File);\n    sqlRestore.Devices.Add(deviceItem);\n    sqlRestore.Database = databaseName;\n    ServerConnection connection = new ServerConnection(serverName, userName, password);\n    Server sqlServer = new Server(connection);\n    sqlRestore.Action = RestoreActionType.Database;\n\n    string logFile = System.IO.Path.GetDirectoryName(backUpFile);\n    logFile = System.IO.Path.Combine(logFile, databaseName + \"_Log.ldf\");\n\n    string dataFile = System.IO.Path.GetDirectoryName(backUpFile);\n    dataFile = System.IO.Path.Combine(dataFile, databaseName + \".mdf\");\n\n    Database db = sqlServer.Databases[databaseName];\n    RelocateFile rf = new RelocateFile(databaseName, dataFile);\n    sqlRestore.RelocateFiles.Add(new RelocateFile(databaseName, dataFile));\n    sqlRestore.RelocateFiles.Add(new RelocateFile(databaseName + \"_log\", logFile));\n    sqlRestore.SqlRestore(sqlServer);\n    db = sqlServer.Databases[databaseName];\n    db.SetOnline();\n    sqlServer.Refresh();\n}\n</code></pre>\n\n<p>The issue seems to be that the file names I pick are different from the online DB. I basically want to replace the database on the server with the backup. I get an exception when I call SqlRestore.</p>\n\n<p>The main exception says </p>\n\n<blockquote>\n  <p>{\"Restore failed for Server\n  'localhost'. \"}</p>\n</blockquote>\n\n<p>Digging into the inner exceptions shows these errors </p>\n\n<blockquote>\n  <p>An exception occurred while executing\n  a Transact-SQL statement or batch.</p>\n</blockquote>\n\n<p>and then </p>\n\n<blockquote>\n  <p>Logical file 'DB' is not part of\n  database 'DB'. Use RESTORE\n  FILELISTONLY to list the logical file\n  names.\\r\\nRESTORE DATABASE is\n  terminating abnormally.</p>\n</blockquote>\n\n<p>I assume there is some way to tell this to just use replace the existing DB as is.</p>\n\n<p>I use this bit of code to get the file path of the DB to have a directory to dump the backup. Maybe this could be used to get the file names to recreate.</p>\n\n<pre><code>public string GetDBFilePath(String databaseName, String userName, String password, String serverName)\n{\n    ServerConnection connection = new ServerConnection(serverName, userName, password);\n    Server sqlServer = new Server(connection);\n    Database db = sqlServer.Databases[databaseName];\n    return sqlServer.Databases[databaseName].PrimaryFilePath;\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1880,"score":2,"question_id":4875513,"title":"error in Multiple Select statements in Insert statement","body":"<p>I am writing a query which has multiple select statements in an insert statement</p>\n\n<pre><code>    INSERT INTO dbo.Products \n    (ProductName, \n     SupplierID, \n     CategoryID, \n     UnitsInStock, \n     UnitsOnOrder, \n     ReorderLevel, \n     Discontinued)\nVALUES  \n    ('Twinkies' , \n     (SELECT SupplierID FROM dbo.Suppliers WHERE CompanyName = 'Lyngbysild'),\n     (SELECT CategoryID FROM dbo.Categories WHERE CategoryName = 'Confections'), \n     0, \n     0, \n     10, \n     0)\n</code></pre>\n\n<p>Actually it gives error</p>\n\n<pre><code>Msg 1046, Level 15, State 1, Line 4\nSubqueries are not allowed in this context. Only scalar expressions are allowed.\nMsg 102, Level 15, State 1, Line 4\nIncorrect syntax near ','.\n</code></pre>\n\n<p>Where these two select statements returns only one value.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12539681,"title":"Renaming all constraint names with user defined names","body":"<p>How do I query the database for all types of constraints such as Primary Key,Foreign Key, Unique Key, and Default Constraint, and rename its system generate name to a name in following format:</p>\n\n<ul>\n<li>PK_ColumnName1_ColumnName2</li>\n<li>FK_ColumnName1</li>\n<li>UK_ColumnName1_ColumnName2</li>\n<li>DF_ColumnName1</li>\n</ul>\n"},{"tags":["sql","sql-server","grouping","group-concat"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":30,"score":3,"question_id":13132571,"title":"Group Employee for each Department","body":"<p>I have a table <code>Details</code></p>\n\n<pre><code>DeptId        EmpID\n-------      ---------\n1             1\n1             5\n1             3\n2             8\n2             9\n</code></pre>\n\n<p>I want to group them like this:</p>\n\n<pre><code>DeptId      EmpIDs\n-------    -------\n 1          1,5,3\n 2          8,9\n</code></pre>\n\n<p>I want this in SQL Server. I know this can be done in MySQL using <code>Group_Concat</code> function. e.g. </p>\n\n<pre><code>SELECT DeptId, GROUP_CONCAT(EmpId SEPARATOR ',') EmpIDS\nFROM Details GROUP BY DeptId\n</code></pre>\n\n<p><a href=\"http://sqlfiddle.com/#!2/89baa/1\" rel=\"nofollow\">(SQL Fiddle here)</a></p>\n\n<p>But how to do this with SQL Server? I don't know any function.</p>\n"},{"tags":["sql-server","sql-server-2008","replication"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":125,"score":1,"question_id":5820706,"title":"Adding foreign key constrain fails on subcriber","body":"<p>I have a replicated database using SQL Server 2008. Here is what I am trying to do.</p>\n\n<ol>\n<li>Create a new table  (MyNewTable)</li>\n<li>Create a column in an existing Table (MyExistingTable)</li>\n<li>Create a FK constraint on this column (in #2) as it points to PK to new table from #1.</li>\n</ol>\n\n<p>However when data get replicated to subscriber, i get following error in replication monitor.</p>\n\n<blockquote>\n  <p>The schema script \"script for adding foreign key constraint\" could not be propagated to the subscriber. (Source: MSSQL_REPL, Error number: MSSQL_REPL-2147201001)\n  Get help: <a href=\"http://help/MSSQL_REPL-2147201001\" rel=\"nofollow\">http://help/MSSQL_REPL-2147201001</a>\n  Foreign key \"MyFKConstraint\" references invalid table \"MyNewTable\" (Source: MSSQLServer, Error number: 1767)</p>\n</blockquote>\n\n<p>This script runs fine on publisher though. Some people seem to suggest that adding foreign key constraint cannot be done in a replicated environment when its created between an existing table and a new table. This is kind of hard to buy for me although I am kind of new to SQL Server replication. Any thoughts?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":89,"score":3,"question_id":13048811,"title":"CTE parent-child showing siblings","body":"<p>I have a CTE-query that displays a tree using recursion. This works great when displaying the whole tree. But I want to pass in ID as a variable and include the siblings for each current node.</p>\n\n<p>Testcode:</p>\n\n<pre><code>DECLARE @TT TABLE \n(\nID int,\nName varchar(25),\nParentID int,\nSortIndex int\n)\n\nINSERT @TT \nSELECT 1, 'A', NULL, 1 UNION ALL\nSELECT 2, 'B_1', 3, 1 UNION ALL\nSELECT 3, 'B', 1, 2 UNION ALL\nSELECT 4, 'B_2', 3, 2 UNION ALL\nSELECT 5, 'C', 1, 3 UNION ALL\nSELECT 6, 'C_2', 5, 2  UNION ALL\nSELECT 7, 'A_1', 1, 1 UNION ALL\nSELECT 8, 'A_2', 1, 2 UNION ALL\nSELECT 9, 'C_1', 5, 1 \n\n\n;WITH CTETree\nAS\n(\n    SELECT *, CAST(NULL AS VARCHAR(25)) AS ParentName, 1 AS Lev,\n    CAST(ROW_NUMBER() OVER(ORDER BY SortIndex) AS VARBINARY(MAX)) AS SortPath\n    FROM @TT\n    WHERE ParentID IS NULL\n\n    UNION ALL\n\n    SELECT F.*, CTETree.Name AS ParentName, Lev + 1,\n    SortPath + CAST(ROW_NUMBER() OVER(ORDER BY F.SortIndex) AS BINARY(32))\n    FROM @TT AS F\n    INNER JOIN CTETree\n    ON F.ParentID = CTETree.ID \n)\n\nSELECT * FROM CTETree\n    ORDER BY SortPath\n\n/*\nDESIRED RESULT:\n\nWHEN ID = 3 PASSED IN:\n\n1   A   NULL    1   NULL    1\n3   B   1   2   A   2\n2   B_1 3   1   B   3\n4   B_2 3   2   B   3\n5   C   1   3   A   2\n\nWHEN ID = 1 PASSED IN:\n\n1   A   NULL    1   NULL    1\n3   B   1   2   A   2\n5   C   1   3   A   2\n\nWHEN ID = 9 PASSED IN:\n\n1   A   NULL    1   NULL    1\n3   B   1   2   A   2\n5   C   1   3   A   2\n9   C_1 5   1   C   3\n6   C_2 5   2   C   3\n\n*/\n</code></pre>\n\n<p>SQL-Fiddle: <a href=\"http://sqlfiddle.com/#!3/d41d8/5526\" rel=\"nofollow\">http://sqlfiddle.com/#!3/d41d8/5526</a></p>\n"},{"tags":["sql","sql-server","join"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":45,"score":0,"question_id":13131496,"title":"How to do join on multiple criteria, returning all combinations of both criteria","body":"<p>I am willing to bet that this is a really simple answer as I am a noob to SQL.</p>\n\n<p>table 1 has column 1 (criteria 1) column 2 (criteria 2) column 3 (metric 1)</p>\n\n<p>table 2 has column 1 (criteria 1) column 2 (criteria 2) column 3 (metric 2 specific to table2.criteria2)</p>\n\n<p>There can be anywhere from 1 - 5 values of criteria 2 for each criteria 1 on the table.</p>\n\n<p>when I use the join statement here (assuming I identify table 1 as One prior to this):</p>\n\n<pre><code>Select WeddingTable, TableSeat, TableSeatID, Name, Two.Meal\nFROM table1 as One\ninner join table2 as Two\non One.WeddingTable = Two.WeddingTable and One.TableSeat = Two.TableSeat\n</code></pre>\n\n<p>I only get one of the criteria 1/criteria 2 combinations even when I know for a fact that there are 3 or 4.  How do I get all combinations?</p>\n\n<p>Take the situation where there is a wedding where table 1 is basically a seating chart, and table 2 is the meal option that each table/seat has chosen. Table 1 has the convenient TableSeatID, but Table 2 does not have a comparable ID.</p>\n\n<p><strong>Sample Data:</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/I5IRy.jpg\" alt=\"enter image description here\"></p>\n\n<p>The results needs to show all 4 lines, being all 3 seats at WeddingTable 001 and the one seat at WeddingTable 002.</p>\n\n<p><strong>Desired Results:</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/c1dr2.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":57,"score":3,"question_id":13131045,"title":"\"IN\" keyword sql file path","body":"<p>While moving an app from access to sql server I have come across a keyword that is causing errors.  The keyword within the query is \"IN\".  INSERT INTO Table IN 'file path of sql server database'.  Does sql server allow you to insert data using the file path within the query? I have been researching this for a few days and have come up with nothing. </p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","reporting-services","reportbuilder3.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13117532,"title":"Report Builder 3.0 - Adding textboxes together","body":"<p>I'm currently creating a report in Report Builder 3.0. I have two textboxes containing SUMs. I want to add the values of these two textboxes together in a third textbox. How is this doable?</p>\n\n<p>I need to add that I'm not working in tables or tablix.</p>\n"},{"tags":["sql-server","visual-studio-2008","cube","olap-cube"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13131653,"title":"trying to explore olap cube for ms sql but have a product file for multiple branches that may have the same key across all branches any ideas?","body":"<p>i need to create a cube based on sales for multiple branches but im not sure how to approach the fact that each branch may use the same product code. in vs 2008 it wont process the cube because it sees that this code is duplicated in my master product file which also ha a branch id field to differentiate for standard queries</p>\n\n<p>anyone any idea how to go about setting up a cube in this scenario?</p>\n\n<p>tables (only some for illustration)</p>\n\n<p> transactions (all branches - has branch id and product id)\n products (master file - has branch id and product id)\n users (links to transactions)\n branch table (links to transactions)</p>\n\n<p>basically there are four dimensions to this cube users, products, branch and a time dimenension based on a field in transactions. </p>\n\n<p>The products field is the main issue though. DB design is restricted due to the application</p>\n\n<p>thanks for any help in advance!</p>\n"},{"tags":["sql","sql-server","tsql","stored-procedures","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":13131046,"title":"TSQL Insert the column default value from Case Statement","body":"<p>I'd like to use the column's default value in an stored procedure insert, so that I don't have to repeat the default value in multiple places (it could change... DRY principle).</p>\n\n<p>The T-SQL INSERT operation has a handy 'default' keyword that I can use as follows:</p>\n\n<pre><code>Declare @newA varchar(10)\nSet @newA = 'Foo2'\n\n-- I can use \"default\" like so...\nInsert into Table_1 (\n    A, \n    B) \nValues (\n    @newA, \n    default)\n</code></pre>\n\n<p>However, If I need to do something conditional,  I can't seem to get the case statement to return 'default'.</p>\n\n<pre><code>-- How do I use 'default' in a case statement? \nINSERT INTO Table_1 (\n    A,\n    B )\nVALUES (\n    @newA,\n    CASE WHEN (@newA &lt;&gt; 'Foo2') THEN 'bar' ELSE default END)\n-- &gt; yeilds \"Incorrect syntax near the keyword 'default'.\"\n</code></pre>\n\n<p>I <em>could</em> insert the default, and then update as needed like so:</p>\n\n<pre><code>INSERT INTO Table_1 (\n    A,\n    B )\nVALUES (\n    @newA,\n    default)\nUPDATE Table_1 \nSET B = CASE WHEN (A &lt;&gt; 'Foo2') THEN 'bar' ELSE B END\nWHERE ID = SCOPE_IDENTITY()\n</code></pre>\n\n<p>But I'd really like somebody to tell me \"There's a better way...\"</p>\n\n<p>Here's a table definition for this example if it helps...</p>\n\n<pre><code>CREATE TABLE dbo.Table_1 (\n    ID int NOT NULL IDENTITY (1, 1),\n    A varchar(10) NULL,\n    B varchar(10) NULL  )  \nGO\nALTER TABLE dbo.Table_1 ADD CONSTRAINT DF_Table_1_A DEFAULT 'A-Def' FOR A\nGO\nALTER TABLE dbo.Table_1 ADD CONSTRAINT DF_Table_1_B DEFAULT 'B-Def' FOR B\nGO\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008-r2","linked-server","advantage-database-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13131066,"title":"MS SQL: Is it possible to have a linked server link to another linked server?","body":"<p>Hello to all and thanks ahead of time for taking the time to look at my question!<br>\n<br>\nI'm trying to do a work-around to access a 32bit Advantage Database Server 8.1 database with 64bit MSSQL Server 2008R2.<br>\n<br>\n<strong>Setup:</strong><br>\n-Windows Server SBS2012<br>\n-MS SQL Server 2008R2 64bit<br>\n-MS SQL Server 2012 Express 32bit<br>\n-Sybase Advantage Database Server (ADS) 8.1 32bit (Can't change)<br>\n<br>\nWhat I've done so far is to install a 32bit SQL Express on the same machine.  I have setup a linked server to the Advantage database on that instance and successfully accessed data.  So, I know that much is working fine.</p>\n\n<p>Problem is, when I try to setup a linked server on the 64bit 2008R2 server, it errors out with the following...</p>\n\n<blockquote>\n  <p>OLE DB provider \"SQLNCLI10\" for linked server \"<em>[--MyLinkedServerName--]</em>\" returned message \"Login timeout expired\". <br>\n  OLE DB provider \"SQLNCLI10\" for linked server \"<em>[--MyLinkedServerName--]</em>\"\n  returned message \"A network-related or instance-specific error has\n  occurred while establishing a connection to SQL Server. Server is not\n  found or not accessible. Check if instance name is correct and if SQL\n  Server is configured to allow remote connections. For more information see SQL Server Books Online.\".<br>\n  Msg 65535, Level 16, State 1, Line 0<br>\n  SQL Server Network Interfaces: Error Locating Server/Instance Specified [xFFFFFFFF].<br></p>\n</blockquote>\n\n<p>Like I said, I can access the data using the 32bit SQL Express, so I know that much of it works.  I just can't seem to access it from within the 64bit 2008R2.  I know the login info is correct.</p>\n\n<p>So, Is it not possible to do?</p>\n"},{"tags":["asp.net","sql-server","charts","drilldown"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13051476,"title":"How to change a charts axis labels from month number (int) to month abbreviation?","body":"<p>I am doing a chart drill down using ASP and SQL Server 2012. After clicking on the quarter I will get the drill down to months. The months appear as numbers and I need them as month abbreviations. I think I have to do a conversion since the months are currently integers. </p>\n"},{"tags":["c#","sql-server","asp.net-mvc","caching","bottleneck"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":292,"score":0,"question_id":4986372,"title":"How can I cache private data in a webfarm for ASP MVC","body":"<p>I am making a member based web app in ASP MVC3 and I am trying to plan ahead, at first our user base will not be huge, but as with any software the potential for a sudden volume spike is always a possibility. </p>\n\n<p>Thinking ahead to this scenario, I know that the database is the bottleneck area on most web apps. We are using MSSQL 2008RS we will have dedicated servers with several client databases each client has there own database so if one server begins to bottle neck we can scale vertically or move some of the databases to a new server and begin filling it up.</p>\n\n<p>To access the databases we use primarily LINQ 2 SQL and are currently re-factoring some of our code to make use of the IQueryable mechanisms to do a lazy load of content. but each page contains quite a bit of content from various parts of the database. </p>\n\n<p>We also have a few large databases that are used for widgets in the program that rarely change but have millions of rows. the goal with those is to somehow sync them to the primary source and distribute them across several machines and then load balance those servers. </p>\n\n<p>With this layout should I even worry about caching, or will the built-in caching mechanisms in MSSQL be sufficient? </p>\n\n<p>If so where should I begin. I have looked briefly at app fabric but it looks as tho it is for Azure only?</p>\n\n<p>Resources:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/343899/how-to-cache-data-in-a-mvc-application\">How to cache data in a MVC application</a></p>\n\n<p><a href=\"http://stephenwalther.com/blog/archive/2008/08/28/asp-net-mvc-tip-39-use-the-velocity-distributed-cache.aspx\" rel=\"nofollow\">http://stephenwalther.com/blog/archive/2008/08/28/asp-net-mvc-tip-39-use-the-velocity-distributed-cache.aspx</a></p>\n\n<p><a href=\"http://stephenwalther.com/blog/archive/2008/08/29/asp-net-mvc-tip-40-don-t-cache-pages-that-require-authentication.aspx\" rel=\"nofollow\">http://stephenwalther.com/blog/archive/2008/08/29/asp-net-mvc-tip-40-don-t-cache-pages-that-require-authentication.aspx</a></p>\n"},{"tags":["sql-server","ssms"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13130509,"title":"SQL Server Management Studio (SSMS) 2012: Unusually high memory usage (leaking?)","body":"<p><img src=\"http://i.stack.imgur.com/0FmYC.png\" alt=\"Task Manager\"></p>\n\n<p>1.3GB memory usage. I'm running Windows 7 Ultimate 64-bit.\nI don't do much - just editing a stored proc (no query running in the background, nor any query result).</p>\n\n<p>I do notice though, it only happens occasionally - as if some kind of a garbage collection is kicking in then it'll return to its normal (around 100MB).</p>\n\n<p>Any ideas / workaround / updates ?</p>\n"},{"tags":["mysql","sql-server","regex","vb.net","parsing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13130205,"title":"Replace all varchar column declarations with a size greater than 8000","body":"<p>I have a sql dump file from MySQL that I use to create SQL Server (2005) tables out of.</p>\n\n<p>I need to change the column declarations that are greater than varchar(8000), the max for sql server 2005, to varchar(max).</p>\n\n<p>I am using a Visual Basic script to parse through the dump file and make these changes. It just looks at the whole file as a string. I only want to change if the number is greater than 8000, but I don't know how to do this. Is there a way to check what that number is inside of the declaration and change it? I've made a regular expression to find the number inside the declaration. But I don't know of a way to say:</p>\n\n<p>For all strings that match varchar(int>8000), change to varchar(max).</p>\n"},{"tags":["sql-server","windows-ce","sqlconnection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":479,"score":0,"question_id":9085251,"title":"Trouble connecting to SQL Server from Windows CE 6 device","body":"<p>I am writing code for a Windows CE 6 app that is supposed to open a connection to a SQL Server 2005 Express instance. </p>\n\n<p>When I debug the code on a development computer (Windows 7) to the SQL Server instance, the process is successful.</p>\n\n<p>The CE device can successfully ping the SQL Server instance. Running the application with the same connection string from a Windows CE 6.0 device, I get a error message:</p>\n\n<blockquote>\n  <p>Specified SQL server not found: ServerName\\SQLEXPRESS.</p>\n</blockquote>\n\n<p>How can this be solved?</p>\n\n<p>this is my connection String: <code>ConnectionString = \"Server='Servername\\\\SqlExpress';Database=databasename;Trusted_Connection=true;\";\n</code>\nand I am using SqlClient\nI think I should also mention that the device with windows ce 6.0 is connected wirelessly to the network and the laptop running windows 7 is wired. </p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":893,"score":5,"question_id":5735551,"title":"ORDER/SORT Column mixed number and number prefixed by char","body":"<p>I have a varchar column conteining a code, this code could by only numbers, or number prefixed by a char for example i have a column containing this data : </p>\n\n<pre><code>+------+\n| Code |\n+------+\n|  1   |\n|  C1  |\n|  2   |\n|  3   |\n|  C3  |\n|  F3  |\n|  F1  |\n|  F17 |\n|  C9  |\n|  C10 |\n|  C47 |\n| C100 |\n| C134 |\n| A234 |\n|C1245 |\n|   10 |\n|  100 |\n+------+\n</code></pre>\n\n<p>And so on ...</p>\n\n<p>I want to sort this column by this rules :</p>\n\n<ol>\n<li>Only numeric code</li>\n<li>Prefixed code with the letter part order alfanumerically and numeric part ordered as a number </li>\n</ol>\n\n<p>I want to achieve a resultset ordered like this :</p>\n\n<pre><code>+------+\n| Code |\n+------+\n|  1   |\n|  2   |\n|  3   |\n| 10   |\n| 100  |\n| A234 |\n|  C1  |\n|  C3  |\n|  C9  |\n|  C10 |\n|  C47 |\n| C100 |\n| C134 |\n|C1245 |\n|  F1  |\n|  F3  |\n|  F17 |\n+------+\n</code></pre>\n\n<p>How can i get a resultset ordered with this criteria ? \nI've tried with a query like this : </p>\n\n<pre><code>SELECT Code FROM Code_List ORDER BY case when Code like '%[a-z]%' then 99999999999999999999999999999999 else convert(decimal, Code) end\n</code></pre>\n\n<p>But i get a result that order first the number and then the prefixed number but the alpha prefixed number is ordered like char and not in the manner i want it...</p>\n\n<p>The only numeric record should be ordered following the rules of the numeric order and no the character order so if the only numeric record are : </p>\n\n<pre><code>+------+\n| Code |\n+------+\n|  1   |\n|  47  |\n|  2   |\n|  3   |\n|  6   |\n|  100 |\n|  112 |\n|  10  |\n</code></pre>\n\n<p>I want to get : </p>\n\n<pre><code>+------+\n| Code |\n+------+\n|  1   |\n|  2   |\n|  3   |\n|  6   |\n|  10  |\n|  47  |\n|  100 |\n|  112 |\n</code></pre>\n\n<p>The Database is Microsoft SQL Server.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13102493,"title":"tsql: Delete behavior","body":"<p>I want to delete an order that has a header, subheader and line item details, before writing out the same order with whatever the replacement subheader, line item details might now be. I'm getting a pk violation error when I try to write back the newer version with the changes. After analysis, I see that even though my DELETE statements appear to work, after issuing them (e.g. x rows affected) --the target table remains unchanged. So, that would explain the pk vio issue. What am I missing?</p>\n\n<p>Here's one of the statements:</p>\n\n<pre><code>       -- detail level (drop products)\n       DELETE dprods FROM [SQLsever].[WIP].[order].DropProducts as dprods\n        INNER JOIN #dropprods t on t.OrderId = dprods.OrderId\n          AND t.OrderDropId = dprods.OrderDropId\n          AND t.DropProdId = dprods.DropProdId;\n</code></pre>\n\n<p>after issuing the statement, I still have all 200+ rows in the target table AND I have the 200+ ids in the #dropprods temp table. Why?</p>\n\n<p><em><strong></em>**<em></strong>  EDITED TO BETTER DEFINE PROBLEM <strong></em>**<em>*</em>**<em>*</em>**<em>*</em>**<em>*</em>*</strong>\nThe DELETE statements were NOT the issue. The issue is tied to a set of nested/named transactions. The DELETE statements are under one, the INSERT statements under another. Here's what I have. It's obviously wrong. What I am trying to do is assure that I don't commit a DELETE before I know I'll have a good replacement INSERT.  Here's what I've done:\n<strong>*<em></strong> EDITED T-SQL WITH SAVE TRANSACTION FIX *</em>** \nThis TSQL will work now.</p>\n\n<pre><code>   -- CHANGED\n   BEGIN TRANSACTION\n   SAVE TRANSACTION process_orders\n    BEGIN TRY\n    -- detail level \n    DELETE lprods FROM [SQLServer].[WIP].[order].LiftProducts as lprods\n     INNER JOIN #liftprods t on t.OrderId = lprods.OrderId\n      AND t.OrderLiftId = lprods.OrderLiftId\n      AND t.LiftProdId = lprods.LiftProdId;\n           -- the rest of the deletes \n            --NOTE: No commit transaction here; saving it to the end\n     END TRY\n     BEGIN CATCH\n        SELECT \n          ERROR_NUMBER() AS ErrorNumber, \n          ERROR_SEVERITY() AS ErrorSeverity,\n          ERROR_MESSAGE() AS ErrorMessage;\n         IF @@TRANCOUNT &gt; 0\n           ROLLBACK TRANSACTION process_orders;\n       END CATCH\n\n       BEGIN TRANSACTION \n        -- CHANGED\n        SAVE TRANSACTION process_orders\n       BEGIN TRY     \n             -- CHANGED\n                COMMIT TRANSACTION process_orders;     \n       END TRY\n       BEGIN CATCH\n          SELECT \n            ERROR_NUMBER() AS ErrorNumber, \n            ERROR_SEVERITY() AS ErrorSeverity,\n            ERROR_MESSAGE() AS ErrorMessage;\n            IF @@TRANCOUNT &gt; 0\n              ROLLBACK TRANSACTION process_orders ;\n       END CATCH \n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":56,"score":3,"question_id":13128635,"title":"Using a left join and checking if the row existed along with another check in where clause","body":"<p>I have the following tables:</p>\n\n<pre><code>Users\nBanned\n\nSELECT u.*\nFROM Users\nWHERE u.isActive = 1\n    AND\n      u.status &lt;&gt; 'disabled'\n</code></pre>\n\n<p>I don't want to include any rows where the user may also be in the Banned table.</p>\n\n<p>What's the best way to do this?</p>\n\n<p>I could do this put a subquery in the where clause so it does something like:</p>\n\n<pre><code>u.status &lt;&gt; 'disabled' and not exist (SELECT 1 FORM Banned where userId = @userId)\n</code></pre>\n\n<p><strong>I think the best way would be to do a LEFT JOIN, how could I do that?</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2008","bulkinsert"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1368,"score":3,"question_id":10507162,"title":"Determine ROW that caused \"unexpected end of file\" error in BULK INSERT?","body":"<p>i am doing a bulk insert:</p>\n\n<pre><code>DECLARE @row_terminator CHAR;\nSET @row_terminator = CHAR(10); -- or char(10)\n\nDECLARE @stmt NVARCHAR(2000);\nSET @stmt = '\n  BULK INSERT accn_errors\n   FROM ''F:\\FullUnzipped\\accn_errors_201205080105.txt''\n   WITH \n      (\n        firstrow=2,\nFIELDTERMINATOR = ''|''  ,\nROWS_PER_BATCH=10000\n   ,ROWTERMINATOR='''+@row_terminator+'''\n   )'\nexec sp_executesql @stmt;\n</code></pre>\n\n<p>and am getting the following error:</p>\n\n<pre><code>Msg 4832, Level 16, State 1, Line 2\nBulk load: An unexpected end of file was encountered in the data file.\nMsg 7399, Level 16, State 1, Line 2\nThe OLE DB provider \"BULK\" for linked server \"(null)\" reported an error. The provider did not give any information about the error.\nMsg 7330, Level 16, State 2, Line 2\nCannot fetch a row from OLE DB provider \"BULK\" for linked server \"(null)\".\n</code></pre>\n\n<p>is there a way to know on which ROW this error occurred?</p>\n\n<p>i am able to import 10,000,000 rows without a problem and error occurs after that</p>\n"}]}
{"total":54452,"page":11,"pagesize":100,"questions":[{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":56,"score":3,"question_id":13128635,"title":"Using a left join and checking if the row existed along with another check in where clause","body":"<p>I have the following tables:</p>\n\n<pre><code>Users\nBanned\n\nSELECT u.*\nFROM Users\nWHERE u.isActive = 1\n    AND\n      u.status &lt;&gt; 'disabled'\n</code></pre>\n\n<p>I don't want to include any rows where the user may also be in the Banned table.</p>\n\n<p>What's the best way to do this?</p>\n\n<p>I could do this put a subquery in the where clause so it does something like:</p>\n\n<pre><code>u.status &lt;&gt; 'disabled' and not exist (SELECT 1 FORM Banned where userId = @userId)\n</code></pre>\n\n<p><strong>I think the best way would be to do a LEFT JOIN, how could I do that?</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2008","bulkinsert"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1368,"score":3,"question_id":10507162,"title":"Determine ROW that caused \"unexpected end of file\" error in BULK INSERT?","body":"<p>i am doing a bulk insert:</p>\n\n<pre><code>DECLARE @row_terminator CHAR;\nSET @row_terminator = CHAR(10); -- or char(10)\n\nDECLARE @stmt NVARCHAR(2000);\nSET @stmt = '\n  BULK INSERT accn_errors\n   FROM ''F:\\FullUnzipped\\accn_errors_201205080105.txt''\n   WITH \n      (\n        firstrow=2,\nFIELDTERMINATOR = ''|''  ,\nROWS_PER_BATCH=10000\n   ,ROWTERMINATOR='''+@row_terminator+'''\n   )'\nexec sp_executesql @stmt;\n</code></pre>\n\n<p>and am getting the following error:</p>\n\n<pre><code>Msg 4832, Level 16, State 1, Line 2\nBulk load: An unexpected end of file was encountered in the data file.\nMsg 7399, Level 16, State 1, Line 2\nThe OLE DB provider \"BULK\" for linked server \"(null)\" reported an error. The provider did not give any information about the error.\nMsg 7330, Level 16, State 2, Line 2\nCannot fetch a row from OLE DB provider \"BULK\" for linked server \"(null)\".\n</code></pre>\n\n<p>is there a way to know on which ROW this error occurred?</p>\n\n<p>i am able to import 10,000,000 rows without a problem and error occurs after that</p>\n"},{"tags":["sql","sql-server","stored-procedures","procedure"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13126643,"title":"fetch data from other server in create procedure","body":"<p>I have to create a procedure to fetch few values from database but I don't have access to write procedure on that server. So, I wanted to create that procedure on another server and fetch the values. I wanted to know if is it possible to create procedure to fetch values from any other server?.</p>\n"},{"tags":["sql-server","reporting-services","webforms","reportviewer"],"answer_count":0,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":163,"score":5,"question_id":12847671,"title":"Report Viewer Control (Web) Shows Blank Report","body":"<p>I have a web form containing a ReportViewer control, a DIV element so I can see that the page actually renders.  I see that my page properly loads, I see the report service being accessed in Fiddler, but there is never anything displayed.</p>\n\n<p>At present, I'm using a report with static text, no queries on it, in order to ensure that I isolate the issue.</p>\n\n<p>My page is as follows:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;%@ Page Language=\"C#\" AutoEventWireup=\"true\" CodeBehind=\"ReportViewer.aspx.cs\" Inherits=\"PeopleNet.Web.Views.Reports.ReportViewer\" %&gt;\n\n&lt;%@ Register Assembly=\"Microsoft.ReportViewer.WebForms, Version=11.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91\"\n    Namespace=\"Microsoft.Reporting.WebForms\" TagPrefix=\"rsweb\" %&gt;\n\n&lt;!DOCTYPE html&gt;\n&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n&lt;head runat=\"server\"&gt;\n    &lt;title&gt;&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;form id=\"form1\" runat=\"server\"&gt;\n        &lt;asp:ScriptManager ID=\"ScriptManager1\" runat=\"server\"&gt;\n            &lt;Scripts&gt;\n                &lt;asp:ScriptReference Path=\"~/scripts/jquery-1.7.2.js\" /&gt;\n                &lt;asp:ScriptReference Path=\"~/scripts/fixReportViewer.js\" /&gt;\n            &lt;/Scripts&gt;\n        &lt;/asp:ScriptManager&gt;\n\n        &lt;div&gt;\n            This is the report viewer page...\n        &lt;/div&gt;\n        &lt;rsweb:ReportViewer ID=\"ReportViewer1\" runat=\"server\"&gt;&lt;/rsweb:ReportViewer&gt;\n    &lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>The code to display the report is:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>protected void Page_Load(object sender, EventArgs e)\n{\n    this.ReportViewer1.ServerReport.ReportServerUrl = ConfigurationFacade.ReportServerUri;\n    this.ReportViewer1.ServerReport.ReportPath = { path to report name };\n    this.ReportViewer1.ServerReport.ReportServerCredentials = new ReportServerCredentials(); // custom class implementing IReportServerCredentials as described in various places around the web, including SO\n    this.ReportViewer1.ServerReport.Refresh();\n}\n</code></pre>\n\n<p>My web.config file is configured with the HttpHandlers as required:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;system.web&gt;\n    &lt;!-- abbreviated... --&gt;\n    &lt;httpHandlers&gt;\n        &lt;add path=\"Reserved.ReportViewerWebControl.axd\" verb=\"*\" type=\"Microsoft.Reporting.WebForms.HttpHandler, Microsoft.ReportViewer.WebForms, Version=11.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91\" validate=\"false\" /&gt;\n    &lt;/httpHandlers&gt;\n&lt;/system.web&gt;\n</code></pre>\n\n<p>And :</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;system.webServer&gt;\n    &lt;!-- abbreviated... --&gt;\n    &lt;handlers&gt;\n        &lt;add name=\"ReportViewerWebControlHandler\" preCondition=\"integratedMode\" verb=\"*\" path=\"Reserved.ReportViewerWebControl.axd\" type=\"Microsoft.Reporting.WebForms.HttpHandler, Microsoft.ReportViewer.WebForms, Version=11.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91\" /&gt;\n    &lt;/handlers&gt;\n&lt;/system.webServer&gt;\n</code></pre>\n\n<p>The server runs Windows 2008 and SQL Server 2008 R2.</p>\n\n<p>I am using the SQL Server 2012 version of the viewer, as we are in the process of updating our environments to 2012.</p>\n\n<p>I have repeatedly verified that the report is accessible from the ReportManager, with no issues whatsoever.</p>\n\n<p>I have been attempting to access this in IE9, having seen various issues stated with other browsers.</p>\n\n<p>I am presently (for testing only) passing my credentials as the report server credentials.  I am a Reporting Services Administrator, as well as a member of the server administrators group on the server.</p>\n\n<p>I have checked both the event log and the ReportServerService log, and have found nothing amiss.</p>\n\n<p><strong>UPDATE:</strong> Looks like when change the AsyncRendering to false, and ensure that I don't try to \"SetParameters\" with an empty collection, this gets mostly cleared up:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>this.ReportViewer1.AsyncRendering = false;\n</code></pre>\n\n<p>What am I missing in the configuration/code here?</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13128365,"title":"Update procedure","body":"<p>I'm working on a procedure in SQL server:</p>\n\n<p>I'm new on SQL server &amp; I get this error: </p>\n\n<blockquote>\n  <p>Must declare the scalar variable \"@Course_Name\"</p>\n</blockquote>\n\n<p>My procedure is:</p>\n\n<pre><code>USE [Hyaline management System]\nGO\n\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE PROCEDURE [dbo].[GetUpdateCourseID] \n@CourseID int\nAS\nBEGIN\n\nSET NOCOUNT ON;\nUpdate Course SET\n    Course_Name = @Course_Name,\n    Course_Duration = @Course_Duration\nwhere CourseID = @CourseID;\n\nEND\n</code></pre>\n\n<p>Can someone please point me where I'm going wrong? and the solution? </p>\n"},{"tags":["sql","sql-server","tsql","temporary-tables"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":37,"score":2,"question_id":13126578,"title":"SQL Server 2008 - #tmp table throws error when run within an exec command","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/688161/tsql-writing-into-a-temporary-table-from-dynamic-sql\">TSQL Writing into a Temporary Table from Dynamic SQL</a>  </p>\n</blockquote>\n\n\n\n<pre><code> ALTER PROCEDURE [dbo].[usp_ServicesStats1](@PERIOD VARCHAR(30) )\n\n AS\n BEGIN\n-- SET NOCOUNT ON added to prevent extra result SETs FROM\n-- interfering with SELECT statements.\nSET NOCOUNT ON;\n\n\n DELETE FROM servicesstats1;\n DECLARE @QUERY  NVARCHAR(MAX);\n\n DECLARE @mainTable VARCHAR(50)\n\n SET @mainTable = '[ServicesStats' + @PERIOD + ']';\n\n\n\n SET @QUERY = 'INSERT INTO servicesstats1(Department,StudentUsers) \n SELECT department,COUNT(*) FROM ' +  @mainTable + \n 'GROUP BY department';\n\n EXEC(@QUERY); -- runs okay!\n\n\n IF OBJECT_ID('tempdb..[##tmp5]') is not null \nBEGIN \n    drop table [##tmp5] \nEND\n\n SET @QUERY = ' SELECT studentid\n INTO [##tmp5]\n FROM ' + @mainTable + '\n GROUP BY studentid\n having COUNT(*)=1; select * from [##tmp5];';\n PRINT @QUERY;\n\n\n EXEC sp_executesql @QUERY;\n\n IF OBJECT_ID('tempdb..[#tmp3]') is not null \nBEGIN \n    drop table [#tmp3] \nEND\n\n SELECT S.department,COUNT(*) AS No INTO #TMP3 --  ONLY THIS SERVICE \n FROM servicesstats_0511_0412 s, #TMP5 T    -- this is not being replaced yet by the @mainTable\n WHERE S.STUDENTID = T.STUDENTID\n GROUP BY S.department\n</code></pre>\n\n<p>Error : </p>\n\n<blockquote>\n  <p><em>Invalid object name '#TMP5'.</em></p>\n</blockquote>\n\n<p>The problem is temporary table <code>#tmp5</code>, now if I were to run this it would work but it's not dynamic.</p>\n\n<pre><code>SELECT studentid\nINTO [#tmp5]\nFROM tableName\nGROUP BY studentid\nhaving COUNT(*)=1;\n</code></pre>\n\n<p>Basically I'm doing this because of the dynamic table name. But <code>#tmp</code> is throwing that error.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":57,"score":-1,"question_id":13127166,"title":"how to get median for every record?","body":"<p>There's no median function in sql server, so I'm using this wonderful suggestion:</p>\n\n<p><a href=\"http://stackoverflow.com/a/2026609/117700\">http://stackoverflow.com/a/2026609/117700</a></p>\n\n<p>this computes the median over an entire dataset, but I need the median per record.</p>\n\n<p>My dataset is:</p>\n\n<pre><code>+-----------+-------------+\n| client_id | TimesTested |\n+-----------+-------------+\n|    214220 |           1 |\n|    215425 |           1 |\n|    212839 |           4 |\n|    215249 |           1 |\n|    210498 |           3 |\n|    110655 |           1 |\n|    110655 |           1 |\n|    110655 |          12 |\n|    215425 |           4 |\n|    100196 |           1 |\n|    110032 |           1 |\n|    110032 |           1 |\n|    101944 |           3 |\n|    101232 |           2 |\n|    101232 |           1 |\n+-----------+-------------+\n</code></pre>\n\n<p>here's the query I am using:</p>\n\n<pre><code>select client_id,  \n    (\n    SELECT\n    (\n     (SELECT MAX(TimesTested ) FROM\n       (SELECT TOP 50 PERCENT t.TimesTested \n       FROM counted3 t \n       where t.timestested&gt;1 \n       and CLIENT_ID=t.CLIENT_ID \n       ORDER BY t.TimesTested ) AS BottomHalf)\n     +\n     (SELECT MIN(TimesTested ) FROM\n       (SELECT TOP 50 PERCENT t.TimesTested \n       FROM counted3 t \n       where t.timestested&gt;1 \n       and CLIENT_ID=t.CLIENT_ID \n       ORDER BY t.TimesTested DESC) AS TopHalf)\n    ) / 2 AS Median\n    ) TotalAvgTestFreq\nfrom counted3 \n\ngroup by client_id\n</code></pre>\n\n<p>but it is giving my funny data:</p>\n\n<pre><code>+-----------+------------------+\n| client_id | median???????????|\n+-----------+------------------+\n|    100007 |               84 |\n|    100008 |               84 |\n|    100011 |               84 |\n|    100014 |               84 |\n|    100026 |               84 |\n|    100027 |               84 |\n|    100028 |               84 |\n|    100029 |               84 |\n|    100042 |               84 |\n|    100043 |               84 |\n|    100071 |               84 |\n|    100072 |               84 |\n|    100074 |               84 |\n+-----------+------------------+\n</code></pre>\n\n<p><strong>i can i get the median for every client_id ?</strong></p>\n\n<p>I am currently trying to use this <strong>awesome</strong> query from Aaron's site:</p>\n\n<pre><code>select c3.client_id,(\n    SELECT AVG(1.0 * TimesTested ) median\n    FROM\n    (\n        SELECT o.TimesTested , \n        rn = ROW_NUMBER() OVER (ORDER BY o.TimesTested ), c.c\n        FROM counted3 AS o\n        CROSS JOIN (SELECT c = COUNT(*) FROM counted3) AS c\n        where count&gt;1\n    ) AS x\n    WHERE rn IN ((c + 1)/2, (c + 2)/2)\n    ) a\n    from counted3 c3\n    group by c3.client_id\n</code></pre>\n\n<p>unfortunately, as Richardthekiwi points out:</p>\n\n<blockquote>\n  <p>it's for a single median whereas this question is about a median\n  per-partition</p>\n</blockquote>\n\n<p>i would like to know how i can join it on <code>counted3</code> to get the median per partition?></p>\n"},{"tags":["sql-server","ssas"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":3116,"score":2,"question_id":1994004,"title":"SQL Server Analysis Services - Do I have it?","body":"<p>Hi I have access to SQL Server at work and I've heard some interesting things that can be done with SQL Server Analysis Services. How do I know whether analysis services is running? Is it installed by default on the server? Would it be installed locally on my machine? Forgive what probably seems like a pretty dumb question, but I couldn't find any concrete details on Microsoft's website. Thanks!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":13034169,"title":"how to aggregate values from a pivot?","body":"<p>my query returns a dataset that looks like this:</p>\n\n<pre><code>+-----------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+--------+---------+------------+---------+---------+------------+--------+\n| CLIENT_ID | count1 | TestFreq1 | stdv1 | count2 | TestFreq2 |  stdv2  | count3 | TestFreq3 |  stdv3  | count4 | TestFreq4 |  stdv4  | count5 | TestFreq5 |  stdv5  | count6 | TestFreq6 |  stdv6  | count7 | TestFreq7 |  stdv7  | count8 | TestFreq8 |  stdv8  | count9 | TestFreq9 |  stdv9  | count10 | TestFreq10 | stdv10 | count11 | TestFreq11 | stdv11  | count12 | TestFreq12 | stdv12 |\n+-----------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+--------+---------+------------+---------+---------+------------+--------+\n|    210893 |    136 |         0 |     0 |     81 |        41 | 79.2685 |     19 |        63 | 58.321  |     24 |        21 | 20.4896 |      5 |        25 | 8.228   |      6 |        24 | 24.0638 |      4 |        25 | 24.6103 | 2      | 25        | 2.12132 |      2 |        23 | 21.9203 | 1       | 33         | NULL   |       2 |         29 | 7.77817 | 1       | 38         | NULL   |\n|    123321 |     50 |         0 |     0 |      5 |        26 | 7.87401 |     14 |        45 | 51.8002 |      3 |        25 | 14.7422 |      2 |        22 | 17.6777 |      4 |        36 | 21.4942 |      3 |        36 | 22.2711 | NULL   | NULL      | NULL    |      4 |        35 | 9.30949 | NULL    | NULL       | NULL   |       1 |         31 | NULL    | NULL    | NULL       | NULL   |\n|    454322 |    232 |         0 |     0 |    173 |        10 | 33.8487 |     36 |        36 | 36.6602 |     32 |        15 | 17.485  |     10 |        38 | 22.4809 |     13 |        23 | 20.0477 |      7 |        18 | 11.4143 | 3      | 32        | 24.5425 |      6 |        25 | 16.8602 | 3       | 28         | 21.166 |       2 |         25 | 4.94975 | 1       | 34         | NULL   |\n+-----------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+--------+---------+------------+---------+---------+------------+--------+\n</code></pre>\n\n<p><strong>instead of forcing the data to go out to <code>count13, stdv13, testfreq13, ..14..14..14, 15.15.15</code> how can i aggregate all the values 12 and over in the same field?</strong></p>\n\n<p>here's my query, and thank you so much for your guidance:</p>\n\n<pre><code>;WITH counted AS (\n  SELECT\n    client_id,\n    COUNT(*) AS TimesTested,\n    (datediff(day,MIN(received_date),max(received_date)))\n  /COUNT(*) as TestFreq\n  FROM f_accession_daily\n  GROUP BY\n    client_id,\n    patient_id\n),\ncounted2 as (\n  SELECT\n    client_id,\n    TimesTested,\n    CAST(COUNT(*) AS varchar(30)) AS count,\n    CAST(AVG(testfreq) as varchar(30)) as TestFreq,\n    CAST(STDEV(TestFreq) as varchar(30)) Stdv\n  FROM counted\n  GROUP BY\n    client_id,\n    TimesTested\n    )\n    ,\nunpivoted AS (\n  SELECT\n    client_id,\n    ColumnName + CAST(TimesTested AS varchar(10)) AS ColumnName,\n    ColumnValue\n  FROM counted2\n  UNPIVOT (\n    ColumnValue FOR ColumnName IN (count, TestFreq,stdv)\n  ) u\n),\npivoted AS (\n  SELECT\n    client_id clientid,\n    count1, TestFreq1,stdv1,\n    count2, TestFreq2,stdv2,\n    count3, TestFreq3,stdv3,\n    count4, TestFreq4,stdv4,\n    count5, TestFreq5,stdv5,\n    count6, TestFreq6,stdv6,\n    count7, TestFreq7,stdv7,\n    count8, TestFreq8,stdv8,\n    count9, TestFreq9,stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n  FROM unpivoted\n  PIVOT (\n    MAX(ColumnValue) FOR ColumnName IN (\n      count1,TestFreq1,stdv1,\n      count2,TestFreq2,stdv2,\n      count3,TestFreq3,stdv3,\n      count4,TestFreq4,stdv4,\n      count5,TestFreq5,stdv5,\n      count6,TestFreq6,stdv6,\n      count7,TestFreq7,stdv7,\n    count8, TestFreq8,   stdv8,\n    count9, TestFreq9,   stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n    )\n  ) p\n)\nselect * from pivoted\n</code></pre>\n\n<p>just to clarify i want to return the same exact results, it's just that for the last column i want to aggregate all values that fall into the <code>12+ bucket</code>. all the fields are going to be the same except the last three, which are going to be:</p>\n\n<pre><code>+----------+-------------+---------+\n| count12+ | TestFreq12+ | stdv12+ |\n+----------+-------------+---------+\n| 353      | 32423       | NULL    |\n| NULL     | NULL        | NULL    |\n| 342      | 25324       | NULL    |\n+----------+-------------+---------+\n</code></pre>\n\n<p>please note the much greater numbers above compared to the rest because the <strong>12+</strong> have been aggregated.</p>\n\n<p>thank you so much for your guidance!</p>\n"},{"tags":["sql-server","datetime","type-conversion","sql-server-2012","data-type-conversion"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13124944,"title":"Converting NVARCHAR(255) to DATE","body":"<p>I'm trying to transfer some old SQL Server data using Excel into SQL Server. It seems that <code>Import/Export Data</code> application automatically sets most data columns to <code>NVARCHAR(255)</code>. Problem I have, is one of my columns is supposed to be a <code>DATE</code> type, but all data in it looks like this <code>18.08.2000 14:48:15</code>. </p>\n\n<p>So, when I try to use this query:</p>\n\n<pre><code>SELECT CONVERT(Date, DATE_TIME,  113)\nFROM someTable\n</code></pre>\n\n<p>I get this error:</p>\n\n<blockquote>\n  <p>Msg 9807, Level 16, State 0, Line 1<br>\n  The input character string does not follow style 113, either change the input character string or use a different style.</p>\n</blockquote>\n\n<p>None of the <code>[styles]</code> from <a href=\"http://msdn.microsoft.com/en-us/library/ms187928.aspx\" rel=\"nofollow\">CAST and CONVERT (Transact-SQL)</a> are working in my case.</p>\n\n<p>Any advise or help is greatly appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2012","localdb"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":13126726,"title":"How do I copy SQL Server 2012 database to localdb instance?","body":"<p>I'm looking to copy a SQL Server 2012 Standard database to my localdb instance. I've tried the wizard which complains that localdb isn't a <em>SQL Server 2005 or later express instance</em>. I also did a backup/restore but upon the restore in my localdb I get the following error...</p>\n\n<p>Running this...</p>\n\n<pre><code>RESTORE DATABASE CSODev\nFROM DISK = 'C:\\MyBckDir\\CSODev.bak'\nWITH MOVE 'CSOdev_Data' TO 'C:\\Users\\cblair\\CSOdev_Data.mdf',\nMOVE 'CSOdev_Log' TO 'C:\\Users\\cblair\\CSOdev_Log.ldf',\nREPLACE\n</code></pre>\n\n<p>Error message I get...</p>\n\n<blockquote>\n  <p>Processed 8752 pages for database 'CSODev', file 'CSOdev_Data' on file 1.<br>\n  Processed 5 pages for database 'CSODev', file 'CSOdev_Log' on file 1.  </p>\n  \n  <p><em>Msg 1853, Level 16, State 1, Line 1</em><br>\n  The logical database file 'CSOdev_Log' cannot be found. Specify the full path for the file.<br>\n  <em>Msg 3167, Level 16, State 1, Line 1</em><br>\n  RESTORE could not start database 'CSODev'.<br>\n  <em>Msg 3013, Level 16, State 1, Line 1</em><br>\n  RESTORE DATABASE is terminating abnormally.</p>\n</blockquote>\n\n<p>The database ends up in \"Recovery Pending\" mode.  It seems like it has issues with the log file.  I have tried 2 different backups in case one was just corrupted.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13122395,"title":"Removing quotes added to column names from Excel import SQL Server 2008","body":"<p>I've noticed that when I use SSMS to import an Excel spreadsheet into SQL Server quotation marks are added.  I've read somewhere that for whatever reason it's necessary for Excel to do this.  Once in SQL Server, these quotes around the column names are useless and I'd like to have a programmatic way to remove them.  The closest thing, which doesn't work, that I have tried to make is <code>EXEC sp_rename 'Table.[\"withquotes\"]', NewColumnName, 'replace(Table.[\"withquotes\",'\"','']</code>.  I'd like to loop through all of the column names in a table and use the <code>replace</code> function wherever a those column names contain quotation marks.  Is there a typical, idiomatic way to do this?</p>\n"},{"tags":["mysql","sql","sql-server","database","database-design"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13115691,"title":"how to design table for accessing the different places","body":"<p>The tables are for users to access different places</p>\n\n<p>The design as below:</p>\n\n<p>user table:</p>\n\n<pre><code>&lt;user&gt;\nuserid\nusername\nplace          (the row define access rights)\n</code></pre>\n\n<p>place table:</p>\n\n<pre><code>&lt;place&gt;\nplaceid\nplacename\nfloor\n</code></pre>\n\n<p>My thoughts:</p>\n\n<p>three places and placeid are 001,002,003\none user and  userid is 001 to aceess these three places</p>\n\n<pre><code>&lt;user&gt;\nuserid     username       place\n001        john           001,002,003\n\n\n&lt;place&gt;\nplaceid    placename   floor\n001        A           1 \n002        B           2 \n003        C           3\n004        D           4 \n</code></pre>\n\n<p>My question is,</p>\n\n<p>in \"user\" table, the attribute \"place\" contains many placeids, \nand separate by a comma, this design is fine or bad ?\nIt needs to separate the place values from \"user\" table ?</p>\n"},{"tags":["asp.net","sql","sql-server","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":193,"score":0,"question_id":3520597,"title":"get ssis package output from SP","body":"<p>I have a SP that runs a SSIS package.</p>\n\n<pre><code>xp_cmdshell 'dtexec /f \"F:\\SSIS Package\\test.dtsx\" /Rep E'\n</code></pre>\n\n<p>When I run the SP in VS I get an Output window where I can see if it was successful.\nIs there a way to get the output from this into my asp.net application ?</p>\n"},{"tags":["sql-server","parent-child"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13084959,"title":"one to one parent child relationship sql server","body":"<p>I have a table with fields <code>TransactionID</code>, <code>Amount</code> and <code>ParentTransactionID</code>\nThe transactions can be cancelled so a new entry posted with <code>amount</code> and <code>ParentTransactionID</code> as cancelled <code>TransactionID</code>.</p>\n\n<p>Lets say a transaction  </p>\n\n<blockquote>\n  <p>1 100 NULL</p>\n</blockquote>\n\n<p>I cancelled the above entry, it will like  </p>\n\n<blockquote>\n  <p>2 -100 1</p>\n</blockquote>\n\n<p>Again cancelled the above transaction, so it should like  </p>\n\n<blockquote>\n  <p>3 100 2</p>\n</blockquote>\n\n<p>When I fetch  I should get the record 3 as ID 1 and 2 got cancelled.\nresult should be  </p>\n\n<blockquote>\n  <p>3 100 2</p>\n</blockquote>\n\n<p>If I cancelled the 3rd entry no records should return.</p>\n\n<pre><code>SELECT * FROM Transaction t\nWHERE NOT EXISTS (SELECT TOP 1 NULL FROM Transaction pt\nWHERE (pt.ParentTransactionID = t.TransactionID OR t.ParentTransactionID = pt.TransactionID)\nAND ABS(t.Amount) = ABS(pt.Amount))\n</code></pre>\n\n<p>This works if only one level of cancel is made.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13125550,"title":"Drop tables that starts with specific characters","body":"<p>I have multiple table names like g_str_a , g_str_ab , g_str_abc . I would like to drop all those tables that start with g_str on SQL Server 2008.</p>\n\n<p>Will <code>DROP Tables like 'g_str'</code> help?</p>\n\n<p>Please help me with the script. </p>\n"},{"tags":["c++","sql-server","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13123161,"title":"connect to mssql on linux via odbc","body":"<p>I connected MSSQL (on windows) via odbc on linux redhat 64bit.<br>\nBelow is odbc and freetds configuration files.</p>\n\n<p><code>freetds.conf</code>:</p>\n\n<pre><code>[FreeTDS]  \nhost=172.21.32.20  \nport=1433  \ntds version=7.2  \nclient charset = GB2312   \n</code></pre>\n\n<p><code>odbcinst.ini</code>:</p>\n\n<pre><code>[TDS]  \nDescription = TDS  \nDriver = /usr/local/lib/libtdsodbc.so  \nTrace = Yes  \nTraceFile=/tmp/odbcinst.log  \nUsageCount = 1  \n</code></pre>\n\n<p><code>odbc.ini</code>:</p>\n\n<pre><code>[SQLSERVER]  \nDriver = TDS  \nDescription = sql server dsn  \nTrace = NO  \nServer = 172.21.32.20  \nDatabase = Live  \nPort = 1433  \nTDS_Version = 7.2  \nTraceFile=/tmp/sqlserver.log  \n</code></pre>\n\n<p>Snippets:</p>\n\n<pre><code>QString f3ErpDsn = QString::fromLocal8Bit(\"Driver={SQLSERVER};server=172.21.32.20;database=Live;uid=inp;pwd=inp;\");\nQSqlDatabase f3ErpDb= QSqlDatabase::addDatabase(\"QODBC\");\nf3ErpDb.setDatabaseName(f3ErpDsn);\n// f3ErpDb.setDatabaseName(\"SQLSERVER\");\nf3ErpDb.setUserName(\"inp\");\nf3ErpDb.setPassword(\"inp\");\nQString sqlCmdStr = \"select * from dbo.Table_Drilling_Data01 where status=1\";\nif ( ! f3ErpDb.open() )\n{\n        qDebug() &lt;&lt; f3ErpDb.lastError().text();\n        return 1;\n}\nQSqlTableModel model;\nmodel.setTable(\"dbo.Table_Drilling_Data01\");\nmodel.setFilter(\"status=3\");\nmodel.select();\nqDebug() &lt;&lt; model.lastError().text();\n</code></pre>\n\n<p>Error messages:</p>\n\n<ol>\n<li><p><code>f3ErpDb.setDatabaseName(f3ErpDsn);</code><br>\nIf <code>setDatabaseName</code> is <code>f3ErpDsn</code> error message is:</p>\n\n<blockquote>\n  <p>\"QODBC3: Unable to connect\", \"[unixODBC][Driver Manager]Data source name not found, and no default driver specified\")  </p>\n</blockquote>\n\n<p>I had defined SQLSERVER in odbc.ini. Why it can not find it?</p></li>\n<li><p>But if I changed <code>f3ErpDb.setDatabaseName(\"SQLSERVER\");</code>, error message is:</p>\n\n<blockquote>\n  <p>\"[FreeTDS][SQL Server]The incoming tabular data stream (TDS) remote procedure call (RPC) protocol stream is incorrect. Parameter 1 (\"\"): Data type 0x00 is unknown. QODBC3: Unable to execute statement\"   </p>\n</blockquote></li>\n</ol>\n\n<p>It makes me confounded, could anybody help me?</p>\n"},{"tags":["sql-server","index"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":13072505,"title":"Performance in SQL Server when there is PK and UQ index on the same column","body":"<p>In SQL Server 2005 I have encountered a table with unique ID column (with unique index on it) and primary key clustered index on it too (so there are explicitly 2 indexes on this column). Is this a major performance factor on insert/update/delete on this table? </p>\n\n<p>I'm trying to boost performance on a database created long ago and I wonder if removing such reduntant unique indexes could help. Does the database check/rebuild both of these indexes on every content modification? Or would the performance gain be too small to even bother with this?</p>\n\n<p>Here is a sample index usage output:</p>\n\n<pre><code>INDEX   UserSeeks    UserScans  UserLookups UserUpdates\n--------------------------------------------------------\n1_PK    45517046      42911     245353       0\n1_UQ    45517046      42911     245353       0\n1_Other 45517046      42911     245353       0   \n--------------------------------------------------------\n2_PK    21538111      5685      231030      1121\n2_UQ    21538111      5685      231030      1121\n3_other 21538111      5685      231030      1121\n</code></pre>\n\n<p>And here is the query I used to get that data:</p>\n\n<pre><code>SELECT OBJECT_NAME(I.OBJECT_ID) AS ObjectName,\n   I.NAME AS IndexName,\n   S.user_seeks AS UserSeeks,\n   S.user_scans AS UserScans,\n   S.user_lookups AS UserLookups,\n   S.user_updates AS UserUpdates\nFROM sys.indexes I \nJOIN sys.dm_db_index_usage_stats S\n  ON (S.OBJECT_ID = I.OBJECT_ID)\nWHERE(database_id = DB_ID())\n</code></pre>\n\n<p>And fixed join condition:</p>\n\n<pre><code>SELECT OBJECT_NAME(I.OBJECT_ID) AS ObjectName,\n   I.NAME AS IndexName,\n   S.user_seeks AS UserSeeks,\n   S.user_scans AS UserScans,\n   S.user_lookups AS UserLookups,\n   S.user_updates AS UserUpdates\nFROM sys.indexes I \nJOIN sys.dm_db_index_usage_stats S\n  ON (S.OBJECT_ID = I.OBJECT_ID)\n  AND(S.index_id = I.index_id)\nWHERE(database_id = DB_ID())\n</code></pre>\n"},{"tags":["sql-server","visual-studio"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":609,"score":1,"question_id":427697,"title":"Failed to remove package protection with error 0x80131940","body":"<p>I'm trying to open a password protected package in SQL Server BIDs and I keep getting the following error message each time I pu in the correct password: </p>\n\n<p><code>Failed to remove package protection with error 0x80131940 \"(null)\"</code></p>\n\n<p>This occurs in the <code>CPaqckage::LoadFromXML</code> method.</p>\n\n<p>Any Ideas?</p>\n"},{"tags":["sql-server","database","import","networking","bulk"],"answer_count":5,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":4838,"score":2,"question_id":440289,"title":"MS SQL Server - Bulk Insert Across a Network","body":"<p>I have an application that uses MS SQL Server for which I'll need to do a bulk insert from a file.  The sticking point is that the database and my application will be hosted on separate servers.  What is the best way to do a bulk insert across a network?  Two ideas I'd come up with so far:</p>\n\n<ol>\n<li><p>From the app server, share a directory that the db server can find, and do the import using a bulk insert statement from the remote file</p></li>\n<li><p>Run an FTP server from the db server - when the import is performed, simply ftp the file to the db server and do the import using a bulk insert from the local file (I am leaning towards this option).</p></li>\n</ol>\n\n<p>Can anyone else tell me if there is a better way to do this, or if not, which one makes the most sense, and why?</p>\n"},{"tags":["sql-server","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":303,"score":0,"question_id":5260500,"title":"Catch conditional parameters in SQL Server select trigger","body":"<p>I want to know that, when I write a select trigger (instead of select), how catch conditional parameters in this trigger? </p>\n\n<p>I am using SQL Server.</p>\n"},{"tags":["sql-server","excel","formatting","openrowset"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1207,"score":0,"question_id":9349946,"title":"SQL Server 2005 OPENROWSET insert into Excel - text to number formatting","body":"<p>So it's not a huge deal, but with Google not returning anything more recent (mostly 2007 or so) about it possibly being an Excel driver issue...I came here to ask the question as what I found as an \"answer\" was not acceptable without further research.</p>\n\n<p>My problem:</p>\n\n<p>Writing a dynamic OPENROWSET query clear and insert new data to send off a report to specific users - the base excel report contains some formulas in which it calculates off and sums based off the inserted data and the multiplication formulas seem to work fine, but unless the totals are formatted properly in Excel as \"numbers\" instead of text the sum will not function...</p>\n\n<p>Solution must be free-form based (if there is a solution at all), I don't want to transfer all my code to SSIS...</p>\n\n<p>Update/Insert code:</p>\n\n<pre><code>    SELECT @sqlu = 'UPDATE OPENROWSET(' +\n    '''Microsoft.ACE.OLEDB.12.0'', ' +\n    '''Excel 12.0;Database=' + @File + ';HDR=YES'', ' +\n    '''SELECT * FROM [Base$B1:G601]'')\n    SET \n    col1 = '''', col2 = '''', col3 = '''', col4 = '''', col5 = '''', col6 = '''' '\n\n\n    EXEC (@sqlu)\n\n\n    SELECT @sqli = 'INSERT INTO OPENROWSET(' +\n    '''Microsoft.ACE.OLEDB.12.0'', ' +\n    '''Excel 12.0;Database=' + @File + ';HDR=NO'', ' +\n    '''SELECT * FROM [Base$B1:G2]'')\n\n    SELECT col1, col2, col3, col4, col5, col6\n    FROM [DATABASE].[dbo].tbl_CIM\n    WHERE col1 IN(''' + @area + ''')'\n\n\n    EXEC (@sqli)\n</code></pre>\n\n<p>The second problem and it may not be a problem for now but later - after the insert, it seems to create borders around the results. Is there also a potential way to remove those during the result transfer?</p>\n\n<p>Any help or sources to research if it is a driver issue is appreciated as I could find none.</p>\n"},{"tags":["sql","sql-server","performance","sql-server-2008","ssis"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":497,"score":4,"question_id":9290291,"title":"SQL Script in VM taking long time for execution","body":"<p>I have the Execute SQL Script package that contains the script to insert about 150K records.</p>\n\n<p>Problem in here is when I execute the package in the Virtual machine its taking 25 min's approx and the same package in physical machine its taking 2 min's</p>\n\n<p>Question 1? Why its taking that much time to load the same data in VM.\nQuestion 2? How to solve this performance issue.</p>\n\n<p>Physical machine configuration has 4GB Ram and 250GB HD + Windows server 2008 R2 + SQL server 2008 R2 Standard Edition.\nVirtual machine has the same Configuration</p>\n\n<p><strong>Update: The Problem is with the SQL Server in VM.</strong></p>\n\n<p><strong>Question 1? Why its taking that much time to Run the same script in VM.</strong></p>\n\n<p><strong>Question 2? How to solve this performance issue.</strong></p>\n\n<p>Both the batabases schema in Physical Machine and VM are identical. Other databases are also same. There was no indexing applied for that tables in both machines. Datatypes are same. harddisk as I said has the same configuration.</p>\n\n<p>No RAID is done on both the machines.</p>\n\n<blockquote>\n  <p>Physical machine has the 2.67GHz RAM Quad Core and in the virtual machine has the\n  2.00GHz RAM Quad Core</p>\n</blockquote>\n\n<p>Version of SQL PM:</p>\n\n<p>Microsoft SQL Server 2008 R2 (RTM) - 10.50.1600.1 (X64) Apr  2 2010 15:48:46    Copyright (c) Microsoft Corporation Standard Edition (64-bit) on Windows NT 6.1  (Build 7601: Service Pack 1)</p>\n\n<p>Version of SQL PM:</p>\n\n<p>Microsoft SQL Server 2008 R2 (RTM) - 10.50.1600.1 (X64) Apr  2 2010 15:48:46    Copyright (c) Microsoft Corporation Standard Edition (64-bit) on Windows NT 6.1  (Build 7601: Service Pack 1) (Hypervisor)</p>\n\n<p>I executed the script Execution plan for both are the same as there is no difference in plan.</p>\n\n<p>Vendor is HP ML350 Machine.</p>\n\n<p>There are almost 20 VM's on the same physical server out of which 7 servers are active.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":5,"favorite_count":5,"up_vote_count":7,"down_vote_count":0,"view_count":16090,"score":7,"question_id":947281,"title":"Multiple Column Pivot in T-SQL","body":"<p>I am working with a table where there are multiple rows that I need pivoted into columns.  So the pivot is the perfect solution for this, and works well when all I need is one field.  I am needing to return several fields based upon the pivot.  Here is the pseudo code with specifics stripped out:</p>\n\n<pre><code>SELECT \n  field1,\n  [1], [2], [3], [4]\nFROM\n  (\n  SELECT \n    field1, \n    field2, \n    (ROW_NUMBER() OVER(PARTITION BY field1 ORDER BY field2)) RowID\n  FROM tblname\n  ) AS SourceTable\nPIVOT\n  (\n  MAX(field2)\n  FOR RowID IN ([1], [2], [3], [4])\n  ) AS PivotTable;\n</code></pre>\n\n<p>The above syntax works brilliantly, but what do I do when I need to get additional information found in field3, field4....?</p>\n"},{"tags":["sql-server","tsql","ssis"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3127,"score":1,"question_id":1236505,"title":"isdate function in ssis derived component","body":"<p>Hi\n  Is there any way to check Date(like isDate function in TSQL)  column in SSIS package derived column expression after extraction from Sourcefile before loading to target dtabase?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":306,"score":1,"question_id":3616454,"title":"SQL Server: COLLATE CS->CI performance vs UPPER","body":"<p>What's better to use when comparing columns that could contains values with different cases? \nIs Collate faster?\nJust trying to figure this out because in our project with tons of data comparisons.\nwe use:</p>\n\n<pre><code>select * from table t1, table t2 where \nt1.col1 collate SQL_Latin1_General_CP1_CI_AS = t2.colb collate SQL_Latin1_General_CP1_CI_AS \n</code></pre>\n\n<p>why we can't rewrite as:</p>\n\n<pre><code>select * from table t1, table t2 where \nUPPER(t1.col1)  = UPPER(t2.colb)\n</code></pre>\n"},{"tags":["sql-server","bulkinsert","xlsx"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":49,"score":-1,"question_id":13124680,"title":"How to Bulk Insert from XLSX file extension?","body":"<p>Can anyone advise how to bulk insert from xlsx file? I have something like below but does not work. I tried the FIELDDEMINATOR like \"<strong>\\t</strong>\",   \"<strong>,</strong>\",   \"<strong>;</strong>\",   \"<strong>|</strong>\", but failed to retrieve the contents from xlsx file. However it doesn't have any error.</p>\n\n<pre><code>BULK INSERT #EVB FROM 'C:\\Users\\summer\\Desktop\\Sample\\premise.xlsx' \nWITH (FIELDTERMINATOR = '\\t', ROWTERMINATOR = '\\n', FIRSTROW = 2);\n\nSELECT * FROM #EVB\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13124165,"title":"Separating column into two separate columns","body":"<p>I have a column <code>name</code>.  There are entries such-as:</p>\n\n<pre><code>Smith, John\nSmith, Joe\nOne whole entry\n</code></pre>\n\n<p>I need them separated into two columns as this:</p>\n\n<pre><code>LastName        | FirstName\n---------------------------\nSmith           | John\nSmith           | Joe\nOne whole entry | \n</code></pre>\n\n<p>I'm using this query:</p>\n\n<pre><code>SELECT left(name, CHARINDEX(', ', name)) as LastName FROM LookUps\n</code></pre>\n\n<p>I've tried the following above, but it's displaying the following comma (e.g. <em>Smith,</em>). I need it to remove this following comma, but also display the full information for those entries without a comma.</p>\n\n<p>Any help would be appreciated.  Thanks..</p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":11850515,"title":"how to join top 1 quickly","body":"<p>I have a table with devices, and a second table with performance counters.  So I have device A  which has lets say 1000 entries in the performance counters table.  I am trying to get all the devices, 2500 of them, and their most recent performance counter.  I have used an Outer Apply,  which does accomplish the desired results, but the query takes 5 minutes to execute.</p>\n\n<p>Is this the best way to get the info I am looking for or is there a better way?  Is the performance of this query normal, and I am just asking too much?  I am thinking of creating a third 'temp' table nightly that will hold this data so I can display and query the info quickly.  What are the best practices for something like this?  </p>\n\n<p>Here is my current query:</p>\n\n<pre><code>   select * from Device D\n      OUTER APPLY\n          ( select top 1 *\n              FROM PerformanceCounterValues\n              where instance_id = D.pkid\n              order by collection_time desc\n           ) as tbl2\n</code></pre>\n\n<p>----- Solved ----</p>\n\n<p>Here is my final actual query, and it works in 0 seconds.  </p>\n\n<pre><code>SELECT pkid, D.IDDevice, D.IDHardware, H.IDRecorder, D.Name, D.Description, H.Name as HardwareName, H.URI, R.HostName, R.Name as RecorderInstance, tbl2.collection_time, tbl2.raw_value, tbl2.calculated_value\n  FROM [Surveillance].[dbo].[PerformanceCounterInstance] PCI\n  JOIN [Surveillance].[dbo].[Devices] D on D.IDDevice = (SELECT REPLACE(STUFF([instance_name],1,CHARINDEX('[',[instance_name]),''),']',''))\n  JOIN [Surveillance].[dbo].[Hardware] H on H.IDHardware = D.IDHardware\n  JOIN [Surveillance].[dbo].[Recorders] R on R.IDRecorder = H.IDRecorder\n    OUTER APPLY\n    ( select top 1 *\n        FROM [Surveillance].[dbo].[PerformanceCounterValue]\n        where instance_id = PCI.pkid\n        order by collection_time desc\n        ) as tbl2\n  where category_name = 'VideoOS Recording Server Device Storage'\n  and D.Enabled = 1\n</code></pre>\n\n<p>It was just setting up the index that made the speed increase.</p>\n"},{"tags":["sql-server","replace","sql-update"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":29,"score":-1,"question_id":13124220,"title":"Using replace in update","body":"<p>I have a table with Projects, in the description field I want to replace Char(10) with '' in a lot of records.</p>\n\n<p>I can replace it record by record manually like this:</p>\n\n<pre><code>UPDATE tblProjects\nSET    Description = (SELECT Replace(Description, Char(10), ' ')\n                      FROM   tblProjects\n                      WHERE  ( Description LIKE '%' + Char(10) + '%' )\n                             AND ProjectID = XAXD)\nWHERE  ( Description LIKE '%' + Char(10) + '%' )\n       AND ProjectID = XAXD\n</code></pre>\n\n<p>but would like a more generic solution like for foreach project and then have ProjectID as a variable.</p>\n"},{"tags":["sql-server","query","stored-procedures","join","outer-join"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13124004,"title":"How show datetime select only in Sql Server?","body":"<p>I need show <code>datetime</code> when I select datetime only. Because I try to run SQL but show all <code>datetime</code>.</p>\n\n<p>Table <code>Emp</code>:</p>\n\n<pre><code>EmpNo   fullName\n00001   Midna\n00002   Klog\n00003   Porla\n00004   Seka\n00005   Mila\n</code></pre>\n\n<p>Table <code>tFile</code>:</p>\n\n<pre><code>EmpNo   cDate                     cTime\n00001   2012-10-29 00:00:00.000   2012-10-29 07:52:00.000\n00001   2012-10-29 00:00:00.000   2012-10-29 19:00:00.000\n00002   2012-10-29 00:00:00.000   2012-10-29 07:40:00.000\n00002   2012-10-29 00:00:00.000   2012-10-29 19:32:00.000\n00005   2012-10-29 00:00:00.000   2012-10-29 07:58:00.000\n00005   2012-10-29 00:00:00.000   2012-10-29 18:35:00.000\n</code></pre>\n\n<p>This code</p>\n\n<pre><code>SELECT \n   em.EmpNo as 'EmpNo', \n   case \n       when tf.cDate &lt;&gt; null then tf.cDate \n            else coalesce(tf.cDate, '2012-10-29') \n   end as 'cDate', \n   Min(tf.cTime) as 'timeIn', \n   Max(tf.cTime) as 'timeOut'\nFROM \n   tFile tf \nFull Outer join \n   Emp em On tf.EmpNo = em.EmpNo\nGroup By \n   em.EmpNo,tf.cDate\nOrder By \n   'EmpNo'\n</code></pre>\n\n<p>returns this result:</p>\n\n<pre><code>EmpNo   cDate                     timeIn                     timeOut\n-------------------------------------------------------------------------------------\n00001   2012-10-21 00:00:00.000   2012-10-21 07:22:00.000    2012-10-21 17:35:00.000\n00001   2012-10-24 00:00:00.000   2012-10-24 07:30:00.000    2012-10-24 19:00:00.000\n00001   2012-10-29 00:00:00.000   2012-10-29 07:52:00.000    2012-10-29 19:00:00.000\n00002   2012-10-25 00:00:00.000   2012-10-25 07:58:00.000    2012-10-25 18:35:00.000\n00002   2012-10-22 00:00:00.000   2012-10-22 08:04:00.000    2012-10-22 17:55:00.000\n00002   2012-10-24 00:00:00.000   2012-10-24 08:00:00.000    2012-10-24 18:45:00.000\n00002   2012-10-29 00:00:00.000   2012-10-29 07:40:00.000    2012-10-29 19:32:00.000\n00003   2012-10-29 00:00:00.000   NULL                       NULL\n00004   2012-10-29 00:00:00.000   NULL                       NULL\n00005   2012-10-28 00:00:00.000   2012-10-28 07:30:00.000    2012-10-28 19:20:00.000\n00005   2012-10-27 00:00:00.000   2012-10-27 07:38:00.000    2012-10-27 19:30:00.000\n00005   2012-10-29 00:00:00.000   2012-10-29 07:58:00.000    2012-10-29 18:35:00.000\n</code></pre>\n\n<p>But I need this result:</p>\n\n<p>I select date ex. <code>2012-10-29</code> then I need to show all rows with <code>2012-10-29</code> only.</p>\n\n<p>But some <code>Empno</code> don't have data in <code>2012-10-29</code> it's set NULL.</p>\n\n<pre><code>EmpNo   cDate                     timeIn                     timeOut\n---------------------------------------------------------------------------------------\n00001   2012-10-29 00:00:00.000   2012-10-29 07:52:00.000    2012-10-29 19:00:00.000\n00002   2012-10-29 00:00:00.000   2012-10-29 07:40:00.000    2012-10-29 19:32:00.000\n00003   2012-10-29 00:00:00.000   NULL                       NULL\n00004   2012-10-29 00:00:00.000   NULL                       NULL\n00005   2012-10-29 00:00:00.000   2012-10-29 07:58:00.000    2012-10-29 18:35:00.000\n</code></pre>\n\n<p>Thanks for your time. :)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","select"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":57,"score":3,"question_id":13121094,"title":"Doing a comparison using the previous row?","body":"<p>I'm trying to work out an efficient way of comparing two rows in SQL Server 2008.  I need to write a query which finds all rows in the <code>Movement</code> table which have <code>Speed &lt; 10</code> N consecutive times.</p>\n\n<p>The structure of the table is:</p>\n\n<p>EventTime\nSpeed </p>\n\n<p>If the data were:</p>\n\n<pre><code>2012-02-05 13:56:36.980, 2\n2012-02-05 13:57:36.980, 11\n2012-02-05 13:57:46.980, 2\n2012-02-05 13:59:36.980, 2\n2012-02-05 14:06:36.980, 22\n2012-02-05 15:56:36.980, 2\n</code></pre>\n\n<p>Then it would return rows 3/4 (13:57:46.980 / 13:59:36.980) if I looked for 2 consecutive rows, and would return nothing if I looked for three consecutive rows.  The order of the data is EventTime/DateTime only.</p>\n\n<p>Any help you could give me would be great.  I'm considering using cursors but they're usually pretty inefficient.  Also, this table is approximately 10m rows in size, so the more efficient the better! :)</p>\n\n<p>Thanks!</p>\n"},{"tags":["c#",".net","sql-server","deployment","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":79,"score":2,"question_id":13046867,"title":"Setup and deployment .NET application with SQL Server Express database in Microsoft Visual Studio 2010?","body":"<p>I have searched a lot before posting my question here, but I could not find real answer which works for me.</p>\n\n<p>I have developed a WPF (C#) project which uses SQL Server Express database on my machine. I created my database in SQL Server Management Studio. Now I am connecting to my database using this string in my code.</p>\n\n<pre><code>public static SqlConnection conn = new SqlConnection(\"Server=\" + @\".\\\" +\n  \";Initial Catalog=Store;\" +\n  \"MultipleActiveResultSets=True;\" +\n  \"Integrated Security=False;\" +\n  \"User ID=\" + Login.login + \";\" +\n  \"Password=\" + Login.password + \";\"\n);\n</code></pre>\n\n<p>On first execution, a login window appears where users inputs their login and password saved in the <code>user</code> table of my database. If authentication is succesful , it connects to the MainWindow of my Project. My database is located in \n<code>C:\\Program Files (x86)\\Microsoft SQL Server\\MSSQL.1\\MSSQL\\Data</code></p>\n\n<p>How should I create a setup project in order to get users to install my project with a single click? I mean when they click to setup, it should deploy my project with my database. It should work on other machines like it is working in my machine. </p>\n\n<p>What are the steps? What should I do. Please bear in mind I am using Visual Studio 2010, and that my database is created in Sql Server Express 2008 using Management Studio. Should I show SQL Express 2008 in the prerequisites and what about instances? I am very confused now. </p>\n\n<p>Please do not provide me with reference which you did not check by yourself. I have tried many of them, they are not working for me.</p>\n"},{"tags":["sql-server","math"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13111191,"title":"distribute list to buckets by window or cycle for processing","body":"<p>In SQL Server I have a source list of id's that I want to re-order in a specific way for processing. My original table has a list of ids like 10,10,10,10,10,20,20,20,20,30,40,40,50,50,60 and a unique key associated with each one. They can be in any order. I want to distribute them to buckets by window or cycle so that they won't conflict. I'm familiar with the aggregate functions, I'm having trouble with the math to get it distributed. I could do it with a loop but for performance reasons I would like to do it in a single query if possible.</p>\n\n<p>I have a query to get a count and priority like</p>\n\n<pre><code>Count   Id  Priority\n5       10  1\n4       20  2\n2       40  3\n2       50  4\n1       30  5\n1       60  6\n</code></pre>\n\n<p>The # of buckets is arbitrary although decided ahead of time. If it was 3 I want id's 10,20,40 in the first cycle then 10,20,50 in the second cycle. If the bucket was 4 then 10,20,40,50 in first and 10,20,40,50 again in second. </p>\n\n<p>Another way for me to express the problem is I want to grab the first x from the new table by count, decrement the count and then grab the next x until exhausted.</p>\n\n<p>Took the solution suggested and re-wrote it but I'm still looking for a single sql query solution if possible.</p>\n\n<p>I've updated the suggested loop a bit which should be a little more optimized haven't yet updated it to my real workload</p>\n\n<pre><code>declare @bucket int, @b int, @maxrows int  \ndeclare @buckets table (fstrEntityHash varchar(100), bucket int)\ndeclare @count table (flngCount int, fstrEntityHash varchar(100))\ndeclare @bucketTemp table (fstrEntityHash varchar(100), bucket int)\n\nselect @bucket = 3, @maxrows = 20\n\ninsert into @count\nselect  COUNT(1) as flngCount, \n    fstrEntityHash\nfrom tblTest\ngroup by fstrEntityHash\norder by COUNT(1) desc\n\nset @b = 1\nwhile (1 = 1)\nbegin\ninsert into @bucketTemp\nselect top (@bucket) fstrEntityHash, @b\nfrom @count\nwhere   flngCount &gt; 0\norder by flngCount desc;\n\nif @@rowcount = 0\n   break\n\n update C\n set    C.flngCount -= 1\n from   @count C, @bucketTemp I\n where  C.fstrEntityHash = I.fstrEntityHash\n\ninsert into @buckets\nselect  * \nfrom        @bucketTemp\n\nif (select count(1) from @buckets) &gt;= @maxrows\n   break\n\n select @b = @b + 1\n delete from @bucketTemp\n\nend\n\nselect * from @buckets\n</code></pre>\n"},{"tags":["c#","sql","sql-server","sql-server-2008","sqlbulkcopy"],"answer_count":6,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":4508,"score":6,"question_id":2593689,"title":"How to prevent duplicate records being inserted with SqlBulkCopy when there is no primary key","body":"<p>I receive a daily XML file that contains thousands of records, each being a business transaction that I need to store in an internal database for use in reporting and billing.\nI was under the impression that each day's file contained only unique records, but have discovered that my definition of unique is not exactly the same as the provider's. </p>\n\n<p>The current application that imports this data is a C#.Net 3.5 console application, it does so using SqlBulkCopy into a MS SQL Server 2008 database table where the columns exactly match the structure of the XML records. Each record has just over 100 fields, and there is no natural key in the data, or rather the fields I can come up with making sense as a composite key end up also having to allow nulls. Currently the table has several indexes, but no primary key.</p>\n\n<p>Basically the entire row needs to be unique. If one field is different, it is valid enough to be inserted. I looked at creating an MD5 hash of the entire row, inserting that into the database and using a constraint to prevent SqlBulkCopy from inserting the row,but I don't see how to get the MD5 Hash into the BulkCopy operation and I'm not sure if the whole operation would fail and roll back if any one record failed, or if it would continue.</p>\n\n<p>The file contains a very large number of records, going row by row in the XML, querying the database for a record that matches all fields, and then deciding to insert is really the only way I can see being able to do this. I was just hoping not to have to rewrite the application entirely, and the bulk copy operation is so much faster.</p>\n\n<p>Does anyone know of a way to use SqlBulkCopy while preventing duplicate rows, without a primary key? Or any suggestion for a different way to do this?</p>\n"},{"tags":[".net","sql-server","setup-project"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13123184,"title":"sql server installation during running setup","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4890970/free-installer-that-can-install-prequisites-net-framework-sql-server\">Free installer that can install prequisites (.net framework, sql server)</a>  </p>\n</blockquote>\n\n\n\n<p>My project is in visual studio 2010.</p>\n\n<p>I am going to create custom action based setup project.</p>\n\n<p>But i want that in custom action SQl server installation will be done only when i say yes to sql server installation.and also to be installed silently. Also i should get the status whether it is successfully installed or not, because i have to restore database on that installed instance. </p>\n\n<p>In windows two msi installer not works together.so please let me know how can i achieve this.</p>\n"},{"tags":["sql-server","synchronization","free","compare"],"answer_count":11,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":6098,"score":8,"question_id":3422771,"title":"SQL Server database compare and sync tool (Free)","body":"<p>Looking for a free and best tool to compare and sync two SQL Server databases. I've searched in stackoverflow for the compare tools but most of them are buy only. Basically this tool will be used for non-commercial use and for developer only. </p>\n\n<p>Can anybody suggest tool used by them and it is free?</p>\n"},{"tags":["c#","sql-server","multithreading","sockets","client"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":1,"view_count":77,"score":3,"question_id":13121531,"title":"Multi Client Server - common way for 2 way connection in","body":"<p>I just want to know how the proper way of doing 2 way connection with one socket is (C#).</p>\n\n<p>I need the client sending and also receiving data from the server without to open the port on the client-pc / router.</p>\n\n<p>The server will be a multiplayer game server and the clients should not extra open a port to play the game.</p>\n\n<p>So does a simple socket connection work in 2 ways (server has a socket listener, and client connects to the server socket)?</p>\n\n<p>Hope that text pretty much explains my question.</p>\n"},{"tags":["sql","sql-server","sqlprofiler"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13122202,"title":"SQL Server Profiler, ObjectName column, 'Split'","body":"<p>What is the meaning of <code>ObjectName</code> column in SQL Server Profiler?</p>\n\n<p>This <a href=\"http://msdn.microsoft.com/en-us/library/aa173882(v=sql.80).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/aa173882(v=sql.80).aspx</a> gives rather concise definition.</p>\n\n<p>For the records that are interesting to me it's either blank -- when executing statement -- or it contains a stored procedure name. But I just recently noticed that it might also contain 'Split' as a value.</p>\n\n<p>What is the meaning of such a record (entry in Profiler) then?</p>\n"},{"tags":["sql-server","ssas"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13122496,"title":"Tabular mode disabled during SSAS installation","body":"<p>I am trying to install SSAS in Tabular Mode. However, i find that the radio button is disabled. I am installing it on a separate instance as well. The regular Multidimensional SSAS  had been installed first.I am installing Standard SQL server .<img src=\"http://i.stack.imgur.com/k6VVn.png\" alt=\"enter image description here\"> . </p>\n"},{"tags":["sql","sql-server","netezza"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":13086194,"title":"Grouping and Dividing Netezza","body":"<p>I have the following query that divides each row in the sum(rev) column by the sum of the column.</p>\n\n<p>For the following example the sum of sum(rev) column is 23193.The Divide column is derived by : row in sum(rev)/sum(rev)</p>\n\n<pre><code>select date,id,sum(rev), \nNULLIF(rev,0) / sum(rev) over() as Divide\nfrom test \nwhere month(date) = 11\nand year(date) = 2012\nand day(date) = 02\nand id = 'Client1'\ngroup by date,id,rev\nhaving sum(rev) &lt;&gt; 0\norder by date\n\n\ndate                  id      sum(rev)      Divide\n\n2012-11-02 00:00:00 Client1     1562.00     0.067348\n2012-11-02 00:00:00 Client1     1.00        0.000043\n2012-11-02 00:00:00 Client1     4689.00     0.202173\n2012-11-02 00:00:00 Client1     267.00      0.011512\n2012-11-02 00:00:00 Client1     16674.00    0.718924\n</code></pre>\n\n<p>There are 2 problems </p>\n\n<p>1.) When the day(date) condition is commented the values retrieved are wrong.It does not give the correct value in the Divide Computation</p>\n\n<pre><code>    date               sum(rev)         Divide\n    2012-11-02 00:00:00 1.00            0.000002\n    2012-11-02 00:00:00 267.00          0.000412\n    2012-11-02 00:00:00 1562.00         0.002412\n    2012-11-02 00:00:00 4689.00         0.007241\n    2012-11-02 00:00:00 16674.00        0.025749\n</code></pre>\n\n<p>2.) I want to group by date.So since we have records only for 2-11-2012 there must be only one line of record for each day</p>\n\n<p>Please help fix these two errors</p>\n\n<p>Ref: <a href=\"http://stackoverflow.com/questions/12939227/find-column-value-by-dividing-with-sum-of-a-column\">Find column Value by dividing with sum of a column</a></p>\n"},{"tags":["sql-server"],"answer_count":4,"favorite_count":4,"up_vote_count":17,"down_vote_count":0,"view_count":48545,"score":17,"question_id":1589466,"title":"SQL Server - Execute Stored Procedure with Output Parameter?","body":"<p>I have a stored procedure that I am trying to test. I am trying to test it through SQL Management Studio. In order to run this test I enter</p>\n\n<p>exec my_stored_procedure 'param1Value', 'param2Value'</p>\n\n<p>The final parameter is an output parameter. However, I do not know how to test a stored procedure with output parameters. How do I run a stored procedure with an output parameter?</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13122318,"title":"How to store complex records for referencing historical revisions?","body":"<p>I have a table on my database that outlines complex processes in a <a href=\"http://en.wikipedia.org/wiki/Work_breakdown_structure\" rel=\"nofollow\">work breakdown structure</a> (similar to what's used to create Gantt charts).  There are multiple rows for a particular process, each row outlining a hierarchical step of a particular process.  </p>\n\n<p>I then have a table with some product types, each being linked to a particular process.  When an order for a particular product is placed - it is to be manufactured with the associated process.  </p>\n\n<p>In my situation, the processes can be dynamic (steps added or removed, for example).  </p>\n\n<p>I'm curious as to what the best way to capture current and historical revisions of each process is, such that even though a process may have evolved over time - I can historically go back to a particular order and determine what the process looked like at that time.  </p>\n\n<p>I'm sure there are multiple ways to go about this, using logging or triggers with a new history table - but I've had no experience doing something like this and I'd like to know what worked well for others.  </p>\n"},{"tags":["sql-server","sql-server-2005","sorting","natural-sort"],"answer_count":15,"favorite_count":10,"up_vote_count":19,"down_vote_count":0,"view_count":13098,"score":19,"question_id":34509,"title":"Natural (human alpha-numeric) sort in Microsoft SQL 2005","body":"<p>We have a large database on which we have DB side pagination. This is quick, returning a page of 50 rows from millions of records in a small fraction of a second.</p>\n\n<p>Users can define their own sort, basically choosing what column to sort by.  Columns are dynamic - some have numeric values, some dates and some text.</p>\n\n<p>While most sort as expected text sorts in a dumb way. Well, I say dumb, it makes sense to computers, but frustrates users.</p>\n\n<p>For instance, sorting by a string record id gives something like:</p>\n\n<pre><code>rec1\nrec10\nrec14\nrec2\nrec20\nrec3\nrec4\n</code></pre>\n\n<p>...and so on.</p>\n\n<p>I want this to take account of the number, so:</p>\n\n<pre><code>rec1\nrec2\nrec3\nrec4\nrec10\nrec14\nrec20\n</code></pre>\n\n<p>I can't control the input (otherwise I'd just format in leading 000s) and I can't rely on a single format - some are things like \"{alpha code}-{dept code}-{rec id}\".</p>\n\n<p>I know a few ways to do this in C#, but can't pull down all the records to sort them, as that would be to slow.</p>\n\n<p>Does anyone know a way to quickly apply a natural sort in Sql server?</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13121831,"title":"Foreign Key Constraint 5","body":"<p>I have two tables in my database. <code>TableOne</code> has <code>theKey</code> primary key. <code>TableTwo</code> has a foreign key <code>theKey</code> that refers to the corresponding column in the <code>TableOne</code>. Now I am trying to update <code>theKey</code> in <code>TableTwo</code>:</p>\n\n<pre><code>  UPDATE TableTwo\n  SET theKey = NewIk\n  FROM TableTwo W\n  JOIN TableThree D ON W.theKey_backup = D.OldIk\n  WHERE dt &gt;= '2012-05-01'\n</code></pre>\n\n<p>But I receive the following error:</p>\n\n<blockquote>\n  <p>The UPDATE statement conflicted with the FOREIGN KEY constraint\n  \"FK_TableTwo_TableOne\". The conflict occurred in database \"MyDB\",\n  table \"dbo.TableOne\", column 'theKey'.</p>\n</blockquote>\n\n<p>Could you please explain why I get this error if I don't touch the <code>TableOne</code>?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","stored-procedures","insert-update","column-store-index"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13117478,"title":"SQL Server columnstore index update/insert in stored procedure","body":"<p>I was having fun testing out the columnstore index feature of sql server 2012. Because you can't update/insert tables with such indices I read on some options: keep a separate table and use a new partition for every bulk insert or disable the index, perform updates/inserts and then rebuild the index.</p>\n\n<p>For my test I chose the latter option and ended up with this stored procedure:</p>\n\n<pre><code>-- Disable the columnstore index.\nALTER INDEX [All_Columns_Columnstore_Index] ON [dbo].[Tick] DISABLE\n\n-- Insert data into tick table from staging table.\ninsert into Tick\nselect [Date],\n       SymbolID,\n       Price\nfrom TickTemporary\n\n-- Delete data from staging table.\ndelete from TickTemporary\n\n-- Enable (rebuild) the columnstore index.\nALTER INDEX [All_Columns_Columnstore_Index] ON [dbo].[Tick] REBUILD\n</code></pre>\n\n<p>If I execute these lines manually everything works fine. But if I run the procedure, I get the error that updates/inserts can't be performed on a table that has a columnstore index. </p>\n\n<p>Why is this?</p>\n\n<p>Update:</p>\n\n<p>I followed the advice in the answer I previously accepted but I still get the same thing.</p>\n\n<pre><code>-- SET NOCOUNT ON added to prevent extra result sets from\n-- interfering with SELECT statements.\nSET NOCOUNT ON;\n\n-- Disable the columnstore index.\nEXEC DisableColumnStoreIndex\n\n-- Insert data into tick table from staging table.\ninsert into Tick\nselect [Date],\n       SymbolID,\n       Price\nfrom TickTemporary\n\n-- Delete data from staging table.\ndelete from TickTemporary\n\n-- Enable (rebuild) the columnstore index.\nEXEC RebuildColumnStoreIndex\n</code></pre>\n\n<p>Even tried placing \"begin tran\" and \"commit tran\" around the sproc calls.</p>\n\n<p>Using dynamic sql like:</p>\n\n<pre><code>declare @sql nvarchar(max)\nset @sql =\n    'insert into Tick\n     select [Date],\n            SymbolID,\n            Price\n     from TickTemporary'\nexec(@sql)\n</code></pre>\n\n<p>works, but really, I want to get by without dynamic sql. Isn't it possible in this case?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":11,"score":-3,"question_id":13121453,"title":"How to use log shipping in database","body":"<p>we want to take backup of database from one server and restore on other for this we want to use log shipping.\nI don't know how to use it and what access rights user need on the server to do log shipping.\nCould you please let me know what step by step procedure involved to do the same.\nThanks in advance</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13121088,"title":"SQL sub query select doubts","body":"<p>LogTable in SQL Server</p>\n\n<pre><code>timestamp                  user_name     session_id\n2012-10-17 06:30:10        Sanjay        034A955F\n2012-10-17 06:30:20        Sanjay        034A955F\n2012-08-20 13:20:59        John          0547961A \n2012-08-20 13:21:05        John          0547961A \n2012-08-20 13:22:10        John          0547961A \n2012-10-17 04:02:10        John          0977661B \n</code></pre>\n\n<p>Desired output</p>\n\n<pre><code>user       Total_login      This_Month_Login   Recent_Login  \nSanjay     2                2                  2012-10-17 06:30:10 \nJohn       4                1                  2012-10-17 04:02:10 \n</code></pre>\n\n<p>I tried to write SQL SELECT query to get above output but I am not good in SQL so couldn't take it ahead and wrote only for 2 columns. Can you please help me to get above select output?</p>\n\n<pre><code>select user_name as 'User', count (distinct session_id) as 'Total_Login' \nfrom \"LogTable\" \ngroup by user_name\n</code></pre>\n"},{"tags":["sql-server","ruby","linux","freetds","isql"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":2350,"score":1,"question_id":8010361,"title":"FreeTDS - tsql connects, isql fails","body":"<p>I'm trying to connect to a database on my host machine (windows xp, sql server 05).  My guest machine is Ubuntu 10.04.  I can connect and execute commands with tsql, but isql fails. Below are my config files and error messages.</p>\n\n<p>freetds.conf</p>\n\n<pre><code>text size = 64512\n\n[SQLEXPRESS]\nhost = 192.168.163.1\nport = 1433\ntds version = 7.0\n</code></pre>\n\n<p>odbcinst.ini</p>\n\n<pre><code>[FreeTDS]\nDescription     = TDS driver (Sybase/MS SQL)\nDriver          = /usr/lib/odbc/libtdsodbc.so\nSetup           = /usr/lib/odbc/libtdsS.so\nCPTimeout       =\nCPReuse         =\nFileUsage       = 1\n</code></pre>\n\n<p>odbc.ini</p>\n\n<pre><code>[SQLEXPRESS]\nDriver          = FreeTDS\nDescription     = ODBC connection via FreeTDS\nTrace           = No\nServername  = 192.168.163.1\nDatabase        = SCOPE_Peel\nPort        = 1433\nUID         = sa\nPWD         = test1234\nReadOnly    = No\n</code></pre>\n\n<p>tsql:</p>\n\n<pre><code>tsql -S SQLEXPRESS  -U sa\n#success\n</code></pre>\n\n<p>isql:</p>\n\n<pre><code>isql SQLEXPRESS sa test1234 -v\n[S1000][unixODBC][FreeTDS][SQL Server]Unable to connect to data source\n[ISQL]ERROR: Could not SQLConnect\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2000"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":64,"score":1,"question_id":13111668,"title":"How to order the numbers?","body":"<p>Table1</p>\n\n<pre><code>id value\n---------    \n 1  100\n2A  200\n 2  300\n10  500\n 8  200\n....\n\nSelect * \nfrom table1 \norder by id\n</code></pre>\n\n<p>Showing output as</p>\n\n<pre><code>id value\n------------    \n 1 100\n10 500\n2A 200\n 2 300\n 8 200\n....\n</code></pre>\n\n<p>How to make a proper order?</p>\n\n<p>Expected output</p>\n\n<pre><code>id value\n----------\n 1 100\n 2 300\n2A 200\n 8 200\n10 500\n....\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":13119925,"title":"Find out the number of Days and nights using sql query","body":"<p>I have a situation like find out the number of days and nights in a given Date range in sql can anyone help me..\nthanks in advance </p>\n"},{"tags":["c++","c","sql-server","middleware"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13121107,"title":"getting mssql queries by writing a middleware","body":"<p>Can anyone please show me the right direction for writing a middleware for mssql server. What I want to do is setup a listener on the mssql 1433 tcp port which will accepts db connections, extract the query and write it on file and forward the connection to a real mssql server on another IP or the same for processing.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server","tsql","header"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":8365,"score":1,"question_id":4964162,"title":"How to add table column headings to sql select statement","body":"<p>I have a SQL select statement like this:</p>\n\n<pre><code>select FirstName, LastName, Age from People\n</code></pre>\n\n<p>This will return me something like a table:</p>\n\n<pre><code>Peter  Smith    34\nJohn   Walker   46\nPat    Benetar  57\n</code></pre>\n\n<p>What I want is to insert the column headings into the first row like:</p>\n\n<pre><code>First Name  Last Name  Age\n=========== ========== ====\nPeter       Smith      34\nJohn        Walker     46\nPat         Benetar    57\n</code></pre>\n\n<p>Can someone suggest how this could be achieved?</p>\n\n<p>Could you maybe create a temporary table with the headings and append the data one to this?</p>\n"},{"tags":["sql-server","sql-server-2005","query"],"answer_count":7,"favorite_count":5,"up_vote_count":10,"down_vote_count":0,"view_count":8058,"score":10,"question_id":235515,"title":"Hierarchical Queries in SQL Server 2005","body":"<p>Way back when I was working in an Oracle shop I took the CONNECT_BY for granted.  Now I'm stuck working with SQL Server 2005 and have some nasty object hierarchies.  Specifically, we have a self referencing table where all child records have a column with their parent's id.  Currently we have a view that maps children to levels in the hierarchy and a nasty query that does the heavy lifting to connect parents with their children.  While this method works, it is far from elegant and reeks of taint.  I'm just curious how other people retrieve hierarchical data from SQL Server 2005.</p>\n"},{"tags":["sql-server","editor","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":41,"score":3,"question_id":13118589,"title":"Can I define #regions in the visual studio 2012 t-sql editor?","body":"<p>I would like to know if there is an extension that allows me to define regions inside the visual studio 2012 editor while editing user defined functions or plain t-sql queries.</p>\n\n<p>I've tried the following but it doesn't seem to do much:</p>\n\n<pre><code>-- #region This is a region with t-sql code\n   ...\n-- #endregion\n</code></pre>\n"},{"tags":["android","sql-server","json"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13120461,"title":"Android JSON Communication","body":"<p>I had developed a android project which get data from MS-SQL.I used ksop and gson jar files to send and revise data from sql.The project is working fine.\n              But i want to know that  Is there any single jar file which help the communication more easier and help to avoid the usage of this two jar files\n                Any one with ideas please share.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13072021,"title":"Slow running query on my machine only","body":"<p>I'm running a simple <strong><code>select * from table</code></strong> query against Microsoft SQL Server 2005. The table has about 41000 records with a PK clustered index and I'm using windows integrated authentication.</p>\n\n<ul>\n<li><p>When I run this on my machine using Microsoft SQL Server Management Studio the query completes in about 1h45m. I have tried swithing from grid to text output, running it from command line using <code>SQLCMD</code> also tried ececuting <code>DBCC USEROPTIONS</code>, <code>DBCC DROPCLEANBUFFERS</code>, <code>DBCC FREEPROCCACHE</code> prior the query... nothing changed the speed of the query.</p></li>\n<li><p>When I run it from coleague workstation using my credentials the query completes normaly in no time. If a coleague runs the query on my workstation using their credentials the query is very slow as described above.</p></li>\n</ul>\n\n<p>I'm running out of ideas how to troubleshoot this problem. Somehow the problem seem to be linked to my machine, but I can not make sense out of it. Please also consider the following:</p>\n\n<ul>\n<li>I checked and made sure ODBC tracing is not enabled on my machine (Win7-64bit). I have installed SQL Server client tools with Microsoft Management Studio 2008 R2 and this is what I'm using to query the database.</li>\n<li>I also used VS2010 to run the same sql query and the result is identical.</li>\n<li>I run the query against copy of the same table/database but on a different server and the issue persists.</li>\n<li>When I run <strong><code>select count(*) from table</code></strong> - the query completes normaly with no delay.</li>\n<li>When I run a trace with SQL Server Profiler the query is just a long running query - I can not see anything abnormal.</li>\n<li>When I run the query in MS SQL Server Management Studio using text out put I can see after the initial buffer of about 85 records the subsequent records arrive in bulk of about 400 records at a time. For example 85 -> 407 -> 804 -> 1210 -> 1605 -> 1897 -> 2161 -> 2753 -> 3051 -> 3342 -> 3676 -> 4002 etc. In comparison of the coleagues workstation where you can see the records painted as continuous stream as the data arrives!???</li>\n<li>I also compared the actual Query Execution Plans on my machine and the other where the query is running normally - they appear to be identical.</li>\n</ul>\n\n<p>Could anyone make sense what could be going wrong here? Why running this from my machine is very slow but it executes normally from another workstation?... \nAny suggested actions steps to troubleshoot this problem?</p>\n\n<p>Thanks to everyone in advance!</p>\n"},{"tags":["c#","asp.net","sql","sql-server","duplicates"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":129,"score":1,"question_id":13052403,"title":"How duplicate entries be prevented while using SqlBulkCopy?","body":"<p>I am importing excel data into sql server using SqlbulkCopy, but the problem is i want to prevent any duplicate records being entered. Is there a way  by which duplicate can be ignored or deleted automatically?</p>\n\n<pre><code>protected void Button1_Click(object sender, EventArgs e)\n{\n    string strFileType = System.IO.Path.GetExtension(FileUpload1.FileName).ToString().ToLower();\n    string strFileName = FileUpload1.PostedFile.FileName.ToString();\n\n    FileUpload1.SaveAs(Server.MapPath(\"~/Import/\" + strFileName + strFileType));\n    string strNewPath = Server.MapPath(\"~/Import/\" + strFileName + strFileType);\n\n    string excelConnectionString = String.Format(@\"Provider=Microsoft.Jet.OLEDB.4.0;\" + \"Data Source=\" + strNewPath + \"; Extended Properties=Excel 8.0;\");\n\n    // Create Connection to Excel Workbook\n    using (OleDbConnection connection = new OleDbConnection(excelConnectionString))\n    {\n        var command = new OleDbCommand(\"Select ID,Data FROM [Sheet1$]\", connection);\n\n        connection.Open();\n\n        // Create DbDataReader to Data Worksheet\n        using (DbDataReader dr = command.ExecuteReader())\n        {\n            // SQL Server Connection String\n            string sqlConnectionString = \"Data Source=ARBAAZ-1B14C081;Initial Catalog=abc;Integrated Security=True\";\n\n            con.Open();\n            DataTable dt1 = new DataTable();\n            string s = \"select count(*) from ExcelTable\";\n            string r = \"\";\n            SqlCommand cmd1 = new SqlCommand(s, con);\n\n            try\n            {\n                SqlDataAdapter da1 = new SqlDataAdapter(cmd1);\n                da1.Fill(dt1);\n            }\n            catch\n            {\n            }\n\n            int RecordCount;\n            RecordCount = Convert.ToInt32(cmd1.ExecuteScalar());\n            r = RecordCount.ToString();\n            Label1.Text = r;\n            con.Close();\n            int prv = Convert.ToInt32(r);\n\n            // Bulk Copy to SQL Server\n            using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n            {\n                bulkCopy.DestinationTableName = \"ExcelTable\";\n\n                SqlBulkCopyColumnMapping mapping1 = new SqlBulkCopyColumnMapping(\"excelid\", \"id\");\n                SqlBulkCopyColumnMapping mapping2 = new SqlBulkCopyColumnMapping(\"exceldata\", \"data\");\n\n                bulkCopy.ColumnMappings.Add(mapping1);\n                bulkCopy.ColumnMappings.Add(mapping2);\n\n                bulkCopy.WriteToServer(dr);\n            }\n\n            con.Open();\n\n            DataTable dt = new DataTable();\n            s = \"select count(*) from ExcelTable\";\n            r = \"\";\n            SqlCommand cmd = new SqlCommand(s, con);\n\n            try\n            {\n                SqlDataAdapter da = new SqlDataAdapter(cmd);\n                da.Fill(dt);\n            }\n            catch\n            {\n            }\n\n            RecordCount = Convert.ToInt32(cmd.ExecuteScalar());\n            r = RecordCount.ToString();\n            Label1.Text = r;\n            con.Close();\n            int ltr = Convert.ToInt32(r);\n\n            if (prv == ltr)\n            {\n                Label1.Text = \"No records Added\";\n            }\n            else\n            {\n                Label1.Text = \"Records Added Successfully !\";\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Can this problem be fixed by creating a trigger to delete duplicates? if yes how? i am a newbie i have never created a trigger.</p>\n\n<p>Another problem is no matter what i try i am unable to get column mapping to work. I am unable to upload data when column names in excel sheet and database are different.</p>\n"},{"tags":["c#","asp.net","sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":76,"score":-1,"question_id":13119847,"title":"Formatting date in date which is being read from excel?","body":"<p>I am importing excel sheet into sql server db table the excelsheet has :\nid|data(which is date in mm/dd/yyyy)\ni am able to upload the data into db table but i want the date to be covnerted into yyyy/mm/dd before sending it to database. I tried a piece of code but it did not work</p>\n\n<pre><code>        DataTable dt7 = new DataTable();\n        dt7.Load(dr);\n        DataRow[] ExcelRows = new DataRow[dt7.Rows.Count];\n        // Bulk Copy to SQL Server\n        using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n        {\n            bulkCopy.DestinationTableName = \"ExcelTable\";\n\n            dt7.Rows.CopyTo(ExcelRows, 0);\n\n            for (int i = 0; i &lt; ExcelRows.Length; i++)//i represents the row\n            {\n                var oldDate = ExcelRows[i][\"data\"].ToString();\n                var newDate = Convert.ToDateTime(oldDate);\n\n                ExcelRows[i][\"data\"] = newDate.ToString(\"yyyy/MM/dd\");\n            }\n\n            bulkCopy.WriteToServer(ExcelRows);\n</code></pre>\n\n<p>ERROR:String was not recognized as a valid DateTime.\ni have tried all 3 datatypes in database nvarchar,varchar,datetime. Same error</p>\n"},{"tags":["sql","sql-server","restore"],"answer_count":7,"favorite_count":1,"up_vote_count":12,"down_vote_count":0,"view_count":31449,"score":12,"question_id":3037682,"title":"Restore DB  Error RESTORE HEADERONLY is terminating abnormally. ","body":"<p>I have taken backup of SQL Server 2008 DB on server, and download them to local environment.</p>\n\n<p>I am trying to restore that database and it is keep on giving me following error.</p>\n\n<blockquote>\n  <hr>\n  \n  <p>An exception occurred while executing\n  a Transact-SQL statement or batch.\n  (Microsoft.SqlServer.ConnectionInfo)</p>\n  \n  <p>------------------------------ ADDITIONAL INFORMATION:</p>\n  \n  <p>The media family on device\n  'C:\\go4sharepoint_1384_8481.bak' is\n  incorrectly formed. SQL Server cannot\n  process this media family. RESTORE\n  HEADERONLY is terminating abnormally.\n  (Microsoft SQL Server, Error: 3241)</p>\n  \n  <p>For help, click:\n  <a href=\"http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=09.00.4053&amp;EvtSrc=MSSQLServer&amp;EvtID=3241&amp;LinkId=20476\" rel=\"nofollow\">http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=09.00.4053&amp;EvtSrc=MSSQLServer&amp;EvtID=3241&amp;LinkId=20476</a></p>\n</blockquote>\n\n<p>I have tried to create a temp DB on server and tried to restore the same backup file and that works.  I have also tried no. of times downloading file from server to local pc using different options on Filezila (Auto, Binary)</p>\n\n<p>But its not working.  After that I tried to execute following command on server.</p>\n\n<pre><code>BACKUP DATABASE go4sharepoint_1384_8481 \nTO DISK=' C:\\HostingSpaces\\dbname_jun14_2010_new.bak' with FORMAT\n</code></pre>\n\n<p>It is giving me following error:</p>\n\n<blockquote>\n  <p>Msg 3201, Level 16, State 1, Line 1 Cannot open backup device\n  'c:\\Program Files\\Microsoft SQL\n  Server\\MSSQL10.SQLEXPRESS\\MSSQL\\Backup\\\n  C:\\HostingSpaces\\dbname_jun14_2010_new.bak'. Operating system error\n  123(The filename, directory name, or volume label syntax is\n  incorrect.). Msg 3013, Level 16, State 1, Line 1 BACKUP DATABASE is\n  terminating abnormally.</p>\n</blockquote>\n\n<p>After researching I found the following 2 useful links: </p>\n\n<ol>\n<li><a href=\"http://support.microsoft.com/kb/290787\" rel=\"nofollow\">http://support.microsoft.com/kb/290787</a></li>\n<li><a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlsetupandupgrade/thread/4d5836f6-be65-47a1-ad5d-c81caaf1044f\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/sqlsetupandupgrade/thread/4d5836f6-be65-47a1-ad5d-c81caaf1044f</a></li>\n</ol>\n\n<p>But I am still not able to restore Database correctly.</p>\n\n<p>Any help would be much appreciated.  Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":485,"score":2,"question_id":2732356,"title":"List of all tables with a relationship to a given table or view","body":"<p>In SQL Server is there a command to return a list of all tables with a relationship to a given table or view?</p>\n\n<p>EDIT: SQL SERVER 2008</p>\n"},{"tags":["c#","asp.net","sql-server","authorization","windows-authentication"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":128,"score":0,"question_id":13119692,"title":"ASP.NET C# Authentication Autorization","body":"<p>I am as a study project developed a website in ASP.net. In my web.config file i have autheticaion mode as windows. and i am using an <code>appsettings</code> connection string to connect to my SQL2005 database.\nNow i want to know what kind of authentication is this?\nIs this windows? forms? or anonymous authentication?</p>\n\n<p>I have user table in sql 2005 and my first screen is login page. Obviously this user table has login details like username and password which will be matched to user input.</p>\n\n<p>I dont understand i have read so many post on authorization and authienticaion but please clear me on this. Thanks in advance. </p>\n"},{"tags":["sql","sql-server"],"answer_count":9,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":6894,"score":1,"question_id":116888,"title":"Like in CASE statement not evaluating as expected","body":"<p>Given this data:</p>\n\n<pre><code>CREATE TABLE tmpTable(\nfldField varchar(10) null);\n\nINSERT INTO tmpTable\nSELECT 'XXX'\nUNION ALL \nSELECT 'XXX'\nUNION  ALL\nSELECT 'ZZZ'\nUNION  ALL\nSELECT 'ZZZ'\nUNION  ALL\nSELECT 'YYY'\n\nSELECT\nCASE WHEN fldField like 'YYY' THEN 'OTH' ELSE 'XXX' END AS newField\nFROM tmpTable\n</code></pre>\n\n<p>The expected resultset is:<br />\nXXX<br />\nXXX<br />\nXXX<br />\nXXX<br />\nOTH  </p>\n\n<p>What situation would casue SQL server 2000 to NOT find 'YYY'?  And return the following as the resultset:<br />\nXXX<br />\nXXX<br />\nXXX<br />\nXXX<br />\nXXX  </p>\n\n<p>The problem is with the like 'YYY', I have found other ways to write this to get it to work, but I want to know why this exact method doesn't work.  Another difficulty is that it works in most of my SQL Server 2000 environments.  I need to find out what is different between them to cause this.  Thanks for your help.</p>\n"},{"tags":["sql-server","bulkinsert","trim"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13117692,"title":"Trim Empty Space Before Bulk Insert","body":"<p>How to I trim empty space when doing bulk insert? I have the sample data as below:</p>\n\n<pre><code>| |100  |4000009|1000 |01    |                                   |201004471|          |28.01.1972|10.04.2012|300485|ABC 307.07B            |01   |                         |          |SSC |SSC  |CA02      |00   |      |0       |SESC    |COM  |01      |01   |00.00.0000|00.00.0000|FR1  |\n</code></pre>\n"},{"tags":["sql-server","ssas","xmla"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":13,"score":1,"question_id":13119574,"title":"Finding Microsoft.AnalysisServices.Xmla dll in SQL Server 2008 R2","body":"<p>I'm not able to find <strong>Microsoft.AnalysisServices.XMLA.dll</strong> that I need to import</p>\n\n<pre><code>using Microsoft.AnalysisServices.Xmla;\n</code></pre>\n\n<p>I have found some articles and answered questions for SQL Server 2005 and 2012. But nothing works for me in the 2008 R2 version. My SQL Server/Analysis services is installed with all features enabled as far as I can tell and still there is no dll with the name I want anywhere on my computer. I don't need a redistributable solution because all computers using this product will have a full SSAS installation on them.</p>\n\n<p>This thread adresses the same problem but without any useable answer: <a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlanalysisservices/thread/84f06276-208a-48e8-be88-b6bdc24406d6\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/sqlanalysisservices/thread/84f06276-208a-48e8-be88-b6bdc24406d6</a></p>\n\n<p>Do I need to install something extra or did I miss it in some way? No it is not in \\windows\\assembly\\gac_msil\\microsoft.analysisservices.xmla.dll as the reply in the above forum post suggests.</p>\n\n<p>Any help will be greatly appreciated.</p>\n"},{"tags":["c#","sql-server","linq-to-sql","composite-primary-key"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":13107129,"title":"Table name as part of primary key","body":"<p>I have an audit trailing system in my project from <a href=\"http://doddleaudit.codeplex.com/\" rel=\"nofollow\">http://doddleaudit.codeplex.com/</a>. \nAs you can see on this image it records the <strong>EntityTable</strong> - which is the table name, and the <strong>EntityTableKey</strong> - which is the primary key <img src=\"http://i.stack.imgur.com/vfvrI.png\" alt=\"enter image description here\"></p>\n\n<p>I would like to associate the audit records with the tables it had recorder, then query the result in linq to sql. But the problem is if the audit table has record for <strong>orders</strong> and record for <strong>products</strong> it will never know just by the primary key, where does the record belong, thus i need to use the table name as part of the key. </p>\n\n<p>So the question is: Is it possible to create a relation that will have a composite primary key that contains the table name in it?</p>\n\n<pre><code>AuditRecord to Orders\nAuditRecord to Products\n</code></pre>\n"},{"tags":["c#",".net","sql","sql-server","null"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":88,"score":1,"question_id":13118997,"title":"Checking if column allows null values, C#?","body":"<p>How do I check if a specified column allows null values or not?</p>\n\n<p>I'm using the following code to print all the columns, but I also want to print if the column allows null values:</p>\n\n<pre><code>cnn = new SqlConnection(connetionString);\ncnn.Open();\n\nSqlCommand myCommand = new SqlCommand(\"select * from \" + tableName, cnn);\nSqlDataAdapter da = new SqlDataAdapter(myCommand);\nDataSet ds = new DataSet();\n\nda.Fill(ds, tableName);\n\nforeach (DataColumn dc in ds.Tables[0].Columns)\n{\n     // Print stuff here, dc.ColumnName is the column name\n}\n</code></pre>\n\n<p>The DataColumn.allowDBnull property doesn't seem to work when getting a predefined table, it's always set to true, even in columns that doesn't allow nulls.</p>\n\n<p>Thanks for your time!</p>\n"},{"tags":["mysql","sql-server","ms-access"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13118854,"title":"MySQL or MSSQL as backend for Access database?","body":"<p>A client wants me to migrate his (very big) Microsoft Access database to a SQL server, keeping Access as the frontend. They have many users already and performance issues are getting worse.</p>\n\n<p>Now, which SQL server would be most appropriate?</p>\n\n<p><code>MySql</code>: I have many years experience with MySQL and consider myself an expert, although not in connection with Access. Being free, MySQL is also attractive to my client.</p>\n\n<p><code>MSSQL</code>: I was once very experienced with MSSQL but it was 12 years ago or more. Much has happened since. But being a Microsoft product, I figure that data migration to the SQL server and use with Access in general might be somewhat more streamlined, which could perhaps compensate for the lack of (recent) experience with the product.</p>\n\n<p>So, how is it working with MySQL as a backend for Access as opposed to MSSQL? Should I count on major obstacles that would work increase the time needed for the migration considerably or would my great experience with MySQL more than compensate for such obstacles?</p>\n"},{"tags":["sql","sql-server","query","stored-procedures","full-outer-join"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13118578,"title":"How can I use full outer join?","body":"<p>I need use join 2 table show all data.</p>\n\n<p><strong>Exam</strong></p>\n\n<p><strong>Table Contact</strong></p>\n\n<pre><code>numCode | fullName\n00001   | Midna \n00002   | Klog\n00003   | Porla\n00004   | Seka\n00005   | Mila\n</code></pre>\n\n<p><strong>Table dateFile</strong></p>\n\n<pre><code>numCode | dateCurr\n00001   | 2012-10-29 00:00:00.000\n00002   | 2012-10-29 00:00:00.000\n00005   | 2012-10-29 00:00:00.000\n</code></pre>\n\n<p><strong>Code Sql Server</strong></p>\n\n<pre><code>SELECT df.numCode as 'numCode', tf.dateCurr as 'dateCurr'\nFROM dateFile df Full Outer join Contact ct On ct.numCode = df.numCode\nWHERE df.dateCurr = '2012-10-29'\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre><code>numCode | dateCurr\n00001   | 2012-10-29 00:00:00.000\n00002   | 2012-10-29 00:00:00.000\n00005   | 2012-10-29 00:00:00.000\n</code></pre>\n\n<p><strong>But I need output get:</strong></p>\n\n<pre><code>numCode | dateCurr\n00001   | 2012-10-29 00:00:00.000\n00002   | 2012-10-29 00:00:00.000\n00003   | 2012-10-29 00:00:00.000  (Insert Date from choose datetime)\n00004   | 2012-10-29 00:00:00.000  (Insert Date from choose datetime)\n00005   | 2012-10-29 00:00:00.000\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5491,"score":0,"question_id":388497,"title":"How to switch sql-2005 Select Case When T-sql Naming?","body":"<pre><code>select \n(Case Remark01\nWhen 'l1' then type1\nwhen 'l2' then type2\nend) AS [?] --Remark .....want to switch name in here\nfrom mytable\n</code></pre>\n\n<p>Example ....</p>\n\n<pre><code>select \n(Case level\nWhen 'l1' then type1 ('l1' mean check constant string)\nwhen 'l2' then type2(('l2' mean check constant string))\nend) AS <b>(Case when 'l1' then [type01] Else [type02])</b>\nfrom mytable\n</pre>\n\n<pre>select level,type1,type2 from mytable\n</code></pre>\n\n<p>I using two program this mytable<br>\none program is want to show menu only type1 only<br>\none program is want to show menu only  type2 only<br>\nI using one view using two program..</p>\n"},{"tags":["sql-server","batch","zip","compress"],"answer_count":7,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":4877,"score":4,"question_id":2375448,"title":"SQL Server 2008 - how to zip backup files and move to remote server","body":"<p>I have the non-enterprise edition of SQL Server 2008. I do nightly backups, manually zip the files and then manually copy to a remote server.</p>\n\n<p>I need to automate this using batch files. Copying files from server to server is easy but how do I automate the zipping of the backup first?</p>\n\n<p>The full process I need is:</p>\n\n<ol>\n<li>Run the backup nightly</li>\n<li>Zip the backup to reduce size (with a unique zip filename)</li>\n<li>Move the zip file to a remote server which is setup as a network drive on the database server</li>\n</ol>\n\n<p>I confess the compression part has thrown me off. Any advice would be very much welcomed.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":12,"favorite_count":2,"up_vote_count":14,"down_vote_count":0,"view_count":50231,"score":14,"question_id":889629,"title":"How to get a date in YYYY-MM-DD format from a TSQL datetime field?","body":"<p>How do I retrieve a date from SQL Server in YYYY-MM-DD format? I need this to work with SQL Server 2000 and up. Is there a simple way to perform this in SQL Server or would it be easier to convert it programatically after I retrieve the result set?</p>\n\n<p>I've read the <a href=\"http://technet.microsoft.com/en-us/library/ms187928.aspx\">CAST and CONVERT</a> on Microsoft Technet, but the format I want isn't listed and changing the date format isn't an option. </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13118273,"title":"Is there a way to restore sql server to default settings?","body":"<p>Basically i want all constraints, rules, keys , databases everything removed i want it as it was on the day i installed it . I do not want to re install it. Simply deleting database might not fix the problem i have</p>\n"},{"tags":["sql-server","database","migration","firebird"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13118350,"title":"Migrating a database with modifiable primary keys to MSSQL","body":"<p>I have to migrate a Firebird database to MS SQL, and the original author designed the database in the way that it has mutable primary keys. For example, we have a tables</p>\n\n<pre><code>PRODUCTS with primary key (NAME,CATEGORY,SHORTNAME) and some data\nPRICE_LISTING (NAME,CATEGORY,SHORTNAME) - foreign key to PRODUCT, and some data like price\nPRODUCT_ALTERNATIVES (ORIGINAL_NAME,ORIGINAL_CATEGORY,ORIGINAL_SHORTNAME; REPLACEMENT_NAME,REPLACEMENT_CATEGORY,REPLACEMENT_SHORTNAME) - foreign keys to PRODUCTS\n</code></pre>\n\n<p>as you can see, whenever product name changes, lot of data in other tables has to change. The original author solved this with cascading update on the foreign keys. For some reasons, MS SQL doesn't allow me to use cascading update on the foreign key, so the database cannot be migrated so easily. </p>\n\n<p>What makes things worse is that the software has a lot of editing screens, that use DataSets, DataGridViews and binding in Windows Forms, so the editor works pretty much automagically. For example, editor for <code>PRODUCTS</code> is a simple windows form, and whenever user renames a product (changes its <code>NAME</code>), the changes are propagated through database (via cascading update) to <code>PRICE_LISTING</code> and <code>PRODUCT_ALTERNATIVES</code> tables. And also, if the app wants to show price listings, it does simple <code>SELECT * FROM PRICE_LISTING</code> that includes product names and price.</p>\n\n<p>One approach might be to add surrogate keys - <code>ID</code> identity columns to each table, then modify for example <code>PRICE_LISTING</code> table to (<code>PRODUCT_ID, price</code>) etc. But then, to show price, I'd have to define view that will </p>\n\n<pre><code>SELECT *,PRODUCT.NAME,PRODUCT.CATEGORY,PRODUCT.SHORTNAME FROM PRICE_LISTING join PRODUCT on ...\n</code></pre>\n\n<p>then, the automatically generated DataSets etc. will have to be modified to select from view, update the view.</p>\n\n<p>In a nutshell and from the original author's perspective, we are breaking the program and making it more complicated. The only single thing that does not work when ported in a straightforward manner is the cascading update, but I see that the database design is very flawed and it will be a maintenance nightmare if not fixed.</p>\n\n<p>What to do?</p>\n"},{"tags":["mysql","sql","sql-server","database","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":13117710,"title":"How to export all words from sql table or sql database","body":"<p>Let's say we have following table.</p>\n\n<pre>\nUserId | Message\n-------|-------------\n1      | Hi, have a nice day\n2      | Hi, I had a nice day\n\n</pre>\n\n<p>I need to have all { Hi,-have-a-nice-day-I-had } words separately.\nIs there any way to do that ? What if I want to export words from whole database tables ?</p>\n\n<p>Similar results would be also good.</p>\n"},{"tags":["sql-server","sql-server-express"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13118164,"title":"SQL express with 20000 databases won't start","body":"<p>I have a SQL Server express instance with 20,000 databases (twenty thousand databases).. and the service won't start.\nI get error message 1053: The service did not respond to the start or control request in a timely fashion.</p>\n\n<p>I'm just doing some testing of sharding, trying out some ideas.  Apparently, I shouldn't leave this many databases attached at the same time... I can work around this... I just wish I knew more how to predict / forecast regarding the real limits of SQL Server 2012 Express.</p>\n\n<hr>\n\n<p>Error 1</p>\n\n<blockquote>\n  <p>There is insufficient system memory in resource pool 'internal' to run this query.</p>\n</blockquote>\n\n<p>Error 2</p>\n\n<blockquote>\n  <p>Script level upgrade for database 'master' failed because upgrade step 'msdb110_upgrade.sql' encountered error 701, state 123, severity 25. This is a serious error condition which might interfere with regular operation and the database will be taken offline. If the error happened during upgrade of the 'master' database, it will prevent the entire SQL Server instance from starting. Examine the previous errorlog entries for errors, take the appropriate corrective actions and re-start the database so that the script upgrade steps run to completion.</p>\n</blockquote>\n\n<p>Error 3</p>\n\n<blockquote>\n  <p>Cannot recover the master database. SQL Server is unable to run. Restore master from a full backup, repair it, or rebuild it. For more information about how to rebuild the master database, see SQL Server Books Online.</p>\n</blockquote>\n\n<p>I assume I should uninstall and reinstall, and then attach half as many databases and split the load between two database servers?</p>\n"},{"tags":["sql","c","sql-server","windows","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13117841,"title":"Get instance name from data source name","body":"<p>I'm using <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms715433%28v=vs.85%29.aspx\" rel=\"nofollow\">SQLDriverConnect</a> function to connect to database. In connection string I can specify ODBC pre-configured data source name (DSN), function resolves necessary attributes and all works fine. But after successful connection I need to get instance name to which I have connected or connection port (because there can be several instances of mssql running on server). How can I implement this?</p>\n"},{"tags":["sql-server","subquery","sql-update","multiple-tables"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":12363047,"title":"How to update column in a table from another table based on condition?","body":"<p>I am having two tables </p>\n\n<ol>\n<li>student table it contains (Student_id,school_code,name,year,...)</li>\n<li>school table it contains (school_id,School_code,School_name,year\netc.....)</li>\n</ol>\n\n<p>I want to update the school_code column in the student table with the school_id column in the school code table based on school code and year. i m having five years data. so school_id varies for every year. </p>\n\n<p>My query was </p>\n\n<pre><code>UPDATE Master.Student\n   SET school_code=( select school_id from Master.school as sc\n  JOIN master.student as st\n    ON st.school_code=sc.school_code\n WHERE sc.year=x)\n WHERE st.year=x;\n</code></pre>\n\n<p>But its not updating. I am getting error of <code>subquery returns more than one value</code>.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":51,"score":1,"question_id":13116036,"title":"Insert Trigger , Help Please","body":"<p>I have 'Employee Registration' form (Windows Application). When the employee registration is done, at the same time i want to create an user. Taking the 'EmpCode' value from 'Employee Registration' and making it the value of 'UserName'. Please help me to write a trigger for it. </p>\n\n<p>Employee Registration Table\nColumns are</p>\n\n<pre><code>EMPCODE, \nEMPNAME, \nDESIGNATION, \nDEPARTMENT, \nDOJ,  \nEMAILID, \nCATEGORY, \nEMPSTATUS, \nEMPMANAGER etc etc\n</code></pre>\n\n<p>UserCreation Table\nColumns are</p>\n\n<pre><code>USERNAME, \nUSERPASSWORD, \nUSERMAPPINGCODE, \nUSERTYPE, \nUSERACTIVE, \nUSEREMAIL\n</code></pre>\n\n<p>When the insertion for 'employee regstratn' happens, same time the following thngs shud happen in 'UserCreation ' table....,</p>\n\n<p><code>EMPCODE</code>'s value should be saved as <code>USERNAME</code>'s value. \n<code>EMPNAME</code>'s value should be saved as <code>USERPASSWORD</code>'s value.\n<code>USERMAPPINGCODE</code>'s value optional \n<code>CATEGORY</code>'s value should be saved as <code>USERTYPE</code>'s value. \n<code>USERACTIVE</code>'s value is 1\n<code>EMAILID</code>'s value should be saved as <code>USEREMAIL</code>'s value</p>\n\n<p>Please help....</p>\n"},{"tags":["sql-server","if-statement","subquery"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13117463,"title":"IF ELSE in subquery SQL Server","body":"<p>I have 2 tables as below, and insert data into <code>ftable</code> from <code>f_table</code> accordingly. I want to insert <code>field_3</code> into <code>field3</code> if <code>field_3</code> exists, else insert <code>field_4</code> into <code>field3</code>. </p>\n\n<p>How do I do that? Much appreciate for any reply.</p>\n\n<pre><code>CREATE TABLE ftable\n(\nfield1 int null,\nfield2 int null,\nfield3 char(1)\n);\n\nCREATE TABLE f_table\n(\nfield_1 int null,\nfield_2 int null,\nfield_3 char(1),\nfield_4 char(1)\n);\n\nINSERT INTO ftable (field1, field2, field3) \n    SELECT (field_1, field_2, field_3) \n    FROM f_table;\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","case"],"answer_count":13,"favorite_count":25,"up_vote_count":168,"down_vote_count":0,"view_count":411989,"score":168,"question_id":63447,"title":"How do you perform an IF...THEN in an SQL SELECT?","body":"<p>How do I perform an IF...THEN in an SQL SELECT statement?</p>\n\n<p>For example;</p>\n\n<pre><code>SELECT IF(Obsolete = 'N' or InStock = 'Y';1;0) as Salable, * FROM Product\n</code></pre>\n"},{"tags":["sql","sql-server","full-text-search","sql-server-2008-r2","wordbreaker"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":83,"score":2,"question_id":12395465,"title":"SQL2008 fulltext index search without word breakers","body":"<p>I are trying to search an FTI using <code>CONTAINS</code> for Twitter-style usernames, e.g. @username, but word breakers will ignore the @ symbol. Is there any way to disable word breakers? From research, there is a way to create a custom word breaker DLL and install it and assign it but that all seems a bit intensive and, frankly, over my head. I disabled stop words so that dashes are not ignored but I need that @ symbol. Any ideas?</p>\n"},{"tags":["sql-server","sql-server-2008","fulltext","fulltext-index"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":316,"score":2,"question_id":3914798,"title":"Can I define which word breakers to use when building a mssql fulltext index?","body":"<p>I have created a fulltext catalog that stores the data from some of the columns in a table, but the contents seem to have been split apart by characters that I don't really want to be considered word delimiters. (\"/\", \"-\", \"_\" etc..)</p>\n\n<p>I know that I can set the language for word breaker, and <a href=\"http://msdn.microsoft.com/en-us/library/ms345188.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms345188.aspx</a> gives som idea on how to install new languages - but I need more direct control than that, because all of those languages still break on the characters I want to not break on.</p>\n\n<p>Is there a way to define my own language to use for finding word breakers?</p>\n"},{"tags":["sql","sql-server","tsql","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":13114627,"title":"SQL Server / T-SQL need to modify dynamic stored procedure?","body":"<p>I have a stored procedure that dynamically generates <code>MERGE</code> TSQL statements to handle SCD Type 1 updates between the given Dimension / Staging table dump.</p>\n\n<p>Here is the T-SQL code (modified from the original code by Alex Whittles):</p>\n\n<pre><code>USE [OPPY_DWUSD]\nGO\n\nALTER PROCEDURE [dbo].[GenerateMerge]\n/***************************************************************\n*                                                              *\n*   Script for use with blog post                              *\n*     \"Automating T-SQL Merge to load Dimensions (SCD)\"        *\n*     http://www.purplefrogsystems.com/blog/2012/04/automating-t-sql-merge-to-load-dimensions-scd\n*                                                              *   \n*   Posted: 6th April 2012                                     *\n*                                                              *\n*   By: Alex Whittles - Purple Frog Business Intelligence      *\n*       www.PurpleFrogSystems.com                              *\n*                                                              *\n*   All code samples are provided AS IS without warranty of  *\n*   any kind, either express or implied, including but not     *\n*   limited to the implied warranties of merchantability       *\n*   and/or fitness for a particular purpose.                   *\n*                                                              *\n***************************************************************/\n\n@Dimension  varchar(50),\n@Schema     varchar(50),\n@ETLTable   varchar(50),\n@ETLSchema  varchar(50),\n@Execute    bit=0  --Should the resulting merge be returned or executed\nAS\nBEGIN\nSET NOCOUNT ON;\n\n--Create Carriage return variable to format the resulting query\nDECLARE @crlf char(2)\nSET @crlf = CHAR(13)\n\n\n--Find out which Audit fields are used\nDECLARE @UseIsInferred bit\nDECLARE @UseFirstCreated bit\nDECLARE @UseValidTo bit\nDECLARE @UseIsRowCurrent bit\nDECLARE @UseLastUpdated bit\n\nSET @UseIsInferred = ISNULL((SELECT MAX(1) \nFROM sys.columns c\n        INNER JOIN sys.tables t on c.object_id = t.object_id\n        INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\nWHERE       s.name = @Schema\n        AND t.name = @Dimension\n        AND c.name = 'IsInferred'\n),0)\n\nSET @UseFirstCreated= ISNULL((SELECT MAX(1) \nFROM sys.columns c\n        INNER JOIN sys.tables t on c.object_id = t.object_id\n        INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\nWHERE       s.name = @Schema\n        AND t.name = @Dimension\n        AND c.name = 'FirstCreated'\n),0)\n\nSET @UseValidTo = ISNULL((SELECT MAX(1) \nFROM sys.columns c\n        INNER JOIN sys.tables t on c.object_id = t.object_id\n        INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\nWHERE       s.name = @Schema\n        AND t.name = @Dimension\n        AND c.name = 'ValidTo'\n),0)\n\nSET @UseIsRowCurrent = ISNULL((SELECT MAX(1) \nFROM sys.columns c\n        INNER JOIN sys.tables t on c.object_id = t.object_id\n        INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\nWHERE       s.name = @Schema\n        AND t.name = @Dimension\n        AND c.name = 'IsRowCurrent'\n),0)\n\nSET @UseLastUpdated = ISNULL((SELECT MAX(1) \nFROM sys.columns c\n        INNER JOIN sys.tables t on c.object_id = t.object_id\n        INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\nWHERE       s.name = @Schema\n        AND t.name = @Dimension\n        AND c.name = 'LastUpdated'\n),0)\n\n\n--Identify the business key column(s)\n--Also define what the null replacement should be\nDECLARE myCurBK Cursor FOR \nSELECT c.name\n    , CASE WHEN ty.name IN ('text', 'ntext', 'varchar', 'char', 'nvarchar', 'nchar') THEN ''''''\n        WHEN ty.name IN ('tinyint', 'smallint', 'int', 'real', 'money', 'float', 'bit', 'decimal', 'numeric','smallmoney','bigint') THEN '0'\n        WHEN ty.name IN ('date', 'datetime') THEN '''19000101'''\n        ELSE 'NULL' END AS NullRep\nFROM sys.columns c\n    INNER JOIN sys.tables t on c.object_id = t.object_id\n    INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\n    INNER JOIN sys.types ty ON c.user_type_id = ty.user_type_id\n    INNER JOIN sys.extended_properties ep \n         ON t.object_id=ep.major_id\n        AND c.column_id=ep.minor_id\n        AND ep.class=1\n        AND ep.name='SCD'\nWHERE s.name = @Schema\n    AND t.name = @Dimension\n    AND ep.value = 'BK'\nORDER BY c.column_id\n\n--Identify all fields to be merged (Exclude Type 0)\nDECLARE myCurType1 Cursor\nFOR SELECT c.name\n    , CASE WHEN ty.name IN ('text', 'ntext', 'varchar', 'char', 'nvarchar', 'nchar') THEN ''''''\n        WHEN ty.name IN ('tinyint', 'smallint', 'int', 'real', 'money', 'float', 'bit', 'decimal', 'numeric','smallmoney','bigint') THEN '0'\n        WHEN ty.name IN ('date', 'datetime') THEN '''19000101'''\n        ELSE 'NULL' END AS NullRep\n    FROM sys.columns c\n        INNER JOIN sys.tables t on c.object_id = t.object_id\n        INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\n        INNER JOIN sys.types ty ON c.user_type_id = ty.user_type_id\n        LEFT JOIN sys.extended_properties ep \n             ON t.object_id=ep.major_id\n            AND c.column_id=ep.minor_id\n            AND ep.class=1\n            AND ep.name='SCD'\n    WHERE s.name = @Schema\n        AND t.name = @Dimension\n        AND c.is_identity=0\n        AND ISNULL(ep.value,'1') NOT IN ('0', 'Audit', 'BK')\n    ORDER BY c.column_id ASC\n\n--Identify all fields for insert\nDECLARE myCurAll Cursor\nFOR SELECT c.name\n    , CASE WHEN ty.name IN ('text', 'ntext', 'varchar', 'char', 'nvarchar', 'nchar') THEN ''''''\n        WHEN ty.name IN ('tinyint', 'smallint', 'int', 'real', 'money', 'float', 'bit', 'decimal', 'numeric','smallmoney','bigint') THEN '0'\n        WHEN ty.name IN ('date', 'datetime') THEN '''19000101'''\n        ELSE 'NULL' END AS NullRep\n    FROM sys.columns c\n        INNER JOIN sys.tables t on c.object_id = t.object_id\n        INNER JOIN sys.schemas s ON t.schema_id = s.schema_id\n        INNER JOIN sys.types ty ON c.user_type_id = ty.user_type_id\n    WHERE s.name = @Schema\n        AND t.name = @Dimension\n        AND c.name NOT IN ('LastUpdated', 'IsInferred', 'FirstCreated', 'ValidTo', 'IsRowCurrent')\n        AND c.is_identity=0\n    ORDER BY c.column_id ASC\n\nDECLARE @Field varchar(255)\nDECLARE @NullRep varchar(20)\nDECLARE @SQL varchar(max)\nDECLARE @SQL2 varchar(max)\nDECLARE @SQL3 varchar(max)\n\n--Now start building up the dynamic SQL\n\nSET @SQL ='MERGE [' + @Schema + '].[' + @Dimension + '] AS Target'\nSET @SQL = @SQL + @crlf + 'USING [' + @ETLSchema + '].[' + @ETLTable + '] AS Source'\n\nOPEN myCurBK\nFETCH NEXT FROM myCurBK INTO @Field, @NullRep\nIF (@@FETCH_STATUS&gt;=0)\n    BEGIN\n        SET @SQL = @SQL + @crlf + '       ON Target.' + '[' + @Field + ']' +  ' = Source.' + '[' + @Field + ']'\n        FETCH NEXT FROM myCurBK INTO @Field, @NullRep\n    END\nWHILE (@@FETCH_STATUS&lt;&gt;-1)\nBEGIN\n    IF (@@FETCH_STATUS&lt;&gt;-2)\n        SET @SQL = @SQL + @crlf + '       AND Target.' + '[' + @Field + ']' +  ' = Source.' + '[' + @Field + ']'\n    FETCH NEXT FROM myCurBK INTO @Field, @NullRep\nEND\nCLOSE myCurBK\n\nIF @UseIsRowCurrent&gt;0   SET @SQL = @SQL + @crlf + '       AND Target.IsRowCurrent=1'\n\nSET @SQL = @SQL + @crlf + '    WHEN MATCHED'\n\nOPEN myCurType1\nFETCH NEXT FROM myCurType1 INTO @Field, @NullRep\n\nIF (@@FETCH_STATUS&gt;=0)\n    BEGIN\n        SET @SQL = @SQL + @crlf + '       AND (ISNULL(Target.' + '[' + @Field + ']' + ',' + @NullRep + ') &lt;&gt; ISNULL(Source.' + '[' + @Field + ']' + ',' + @NullRep + ')'\n        FETCH NEXT FROM myCurType1 INTO @Field, @NullRep\n    END\nWHILE (@@FETCH_STATUS&lt;&gt;-1)\nBEGIN\n    IF (@@FETCH_STATUS&lt;&gt;-2)\n        SET @SQL = @SQL + @crlf + '       OR ISNULL(Target.' + '[' + @Field + ']' + ',' + @NullRep + ') &lt;&gt; ISNULL(Source.' + '[' + @Field + ']' + ',' + @NullRep + ')'\n    FETCH NEXT FROM myCurType1 INTO @Field, @NullRep\nEND\nCLOSE myCurType1\n\nSET @SQL = @SQL + @crlf + '      )'\nSET @SQL2 = '    THEN UPDATE SET'\n\nOPEN myCurType1\nFETCH NEXT FROM myCurType1 INTO @Field, @NullRep\nIF (@@FETCH_STATUS&gt;=0)\n    BEGIN\n        SET @SQL2 = @SQL2 + @crlf + '       ' + '[' + @Field + ']' + ' = Source.' + '[' + @Field + ']'\n        FETCH NEXT FROM myCurType1 INTO @Field, @NullRep\n    END\nWHILE (@@FETCH_STATUS&lt;&gt;-1)\nBEGIN\n    IF (@@FETCH_STATUS&lt;&gt;-2)\n        SET @SQL2 = @SQL2 + @crlf + '      ,' + '[' + @Field + ']' + ' = Source.' + '[' + @Field + ']'\n    FETCH NEXT FROM myCurType1 INTO @Field, @NullRep\nEND\nCLOSE myCurType1\n\nIF @UseLastUpdated&gt;0   SET @SQL2 = @SQL2 + @crlf + '      ,LastUpdated = GetDate()'\n\nSET @SQL3 = '    WHEN NOT MATCHED THEN'\nSET @SQL3 = @SQL3 + @crlf + '         INSERT ('\n\nOPEN myCurAll\nFETCH NEXT FROM myCurAll INTO @Field, @NullRep\nIF (@@FETCH_STATUS&gt;=0)\n    BEGIN\n        SET @SQL3 = @SQL3 + @crlf + '           ' + '[' + @Field + ']'\n        FETCH NEXT FROM myCurAll INTO @Field, @NullRep\n    END\nWHILE (@@FETCH_STATUS&lt;&gt;-1)\nBEGIN\n    IF (@@FETCH_STATUS&lt;&gt;-2)\n        SET @SQL3 = @SQL3 + @crlf + '           ,' + '[' + @Field + ']'\n    FETCH NEXT FROM myCurAll INTO @Field, @NullRep\nEND\nCLOSE myCurAll\n\n\nIF @UseIsInferred&gt;0     SET @SQL3 = @SQL3 + @crlf + '           ,IsInferred'\nIF @UseFirstCreated&gt;0   SET @SQL3 = @SQL3 + @crlf + '           ,FirstCreated'\nIF @UseValidTo&gt;0        SET @SQL3 = @SQL3 + @crlf + '           ,ValidTo'\nIF @UseIsRowCurrent&gt;0   SET @SQL3 = @SQL3 + @crlf + '           ,IsRowCurrent'\nIF @UseLastUpdated&gt;0    SET @SQL3 = @SQL3 + @crlf + '           ,LastUpdated'\nSET @SQL3 = @SQL3 + @crlf + '         ) VALUES ('\n\nOPEN myCurAll\nFETCH NEXT FROM myCurAll INTO @Field, @NullRep\nIF (@@FETCH_STATUS&gt;=0)\n    BEGIN\n        SET @SQL3 = @SQL3 + @crlf + '            Source.' + '[' + @Field + ']'\n        FETCH NEXT FROM myCurAll INTO @Field, @NullRep\n    END\nWHILE (@@FETCH_STATUS&lt;&gt;-1)\nBEGIN\n    IF (@@FETCH_STATUS&lt;&gt;-2)\n        SET @SQL3 = @SQL3 + @crlf + '           ,Source.' + '[' + @Field + ']'\n    FETCH NEXT FROM myCurAll INTO @Field, @NullRep\nEND\nCLOSE myCurAll    \n\nIF @UseIsInferred&gt;0     SET @SQL3 = @SQL3 + @crlf + '           ,0'\nIF @UseFirstCreated&gt;0   SET @SQL3 = @SQL3 + @crlf + '           ,GetDate()'\nIF @UseValidTo&gt;0        SET @SQL3 = @SQL3 + @crlf + '           ,NULL'\nIF @UseIsRowCurrent&gt;0   SET @SQL3 = @SQL3 + @crlf + '           ,1'\nIF @UseLastUpdated&gt;0    SET @SQL3 = @SQL3 + @crlf + '           ,GetDate()'\nSET @SQL3 = @SQL3 + @crlf + '         );'\n\n--clean up\nDEALLOCATE myCurType1\nDEALLOCATE myCurAll\nDEALLOCATE myCurBK\n\nIF @Execute = 1\nBEGIN\n    EXEC(@SQL + @SQL2 + @SQL3)           \nEND\nELSE\nBEGIN    \n    PRINT @SQL\n    PRINT @SQL2\n    PRINT @SQL3\nEND\n\nEND\n</code></pre>\n\n<p>In the stored procedure above, when I pass in the variables, it produces this code:</p>\n\n<pre><code>MERGE [DIM].[COMPANY] AS Target\nUSING [DBO].[DWUSD_LIVE] AS Source\n    ON Target.[comp] = Source.[comp]\n WHEN MATCHED\n    AND (ISNULL(Target.[comp name],'') &lt;&gt; ISNULL(Source.[comp name],'')\n    OR ISNULL(Target.[comp description],'') &lt;&gt; ISNULL(Source.[comp description],'')\n   )\nTHEN UPDATE SET\n    [comp name] = Source.[comp name]\n   ,[comp description] = Source.[comp description]\n   ,LastUpdated = GetDate()\nWHEN NOT MATCHED THEN\n      INSERT (\n        [comp]\n        ,[comp name]\n        ,[comp description]\n        ,FirstCreated\n        ,LastUpdated\n      ) VALUES (\n         Source.[comp]\n        ,Source.[comp name]\n        ,Source.[comp description]\n        ,GetDate()\n        ,GetDate()\n      );\n</code></pre>\n\n<p>What I need to be able to do is add a <code>DISTINCT</code> <code>SELECT</code> subquery at the beginning...</p>\n\n<pre><code>MERGE [dim].[Company] AS Target\nUSING (\nSELECT DISTINCT \n[COMP NAME],\n[COMP DESCRIPTION],\n[COMP]\nFROM [dbo].[DWUSD_LIVE]\n) AS Source\n</code></pre>\n\n<p>So that when it looks at the source (staging table) it does a <code>SELECT DISTINCT</code> on the same columns found in the dimension but not including the audit columns (<code>FirstCreated</code> / <code>LastUpdated</code>).</p>\n\n<p>My staging table has duplicate records, thus I only need to <code>SELECT DISTINCT</code> otherwise I end up with multiple records in my dimension.</p>\n"},{"tags":["sql-server","xml","sql-server-2008-r2","xquery"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13114959,"title":"Querying XML column in SQL Server","body":"<p>I'm running SQL Server 2008 R2, and have a table that I audit update statements.</p>\n\n<pre><code>create table STG_Participant_16_Month\n(\nSerial                  int,\nID                      varchar(10),\nStartTime               datetime, \nFinishTime              datetime, \nChildID                 varchar(10),\nchildIndex              int,\nRecord_State            varchar(15),\nDuplicate_flag          varchar(1)\n);\n</code></pre>\n\n<p>When table X is updated, it inserts a record into an audit table:</p>\n\n<pre><code>select * \ninto STG_Participant_16_Month_AUDIT \nfrom STG_Participant_16_Month;\n\nalter table STG_Participant_16_Month_AUDIT\nadd audit_user                       varchar(30),\n    audit_action                     varchar(1),\n    audit_date                       datetime,\n    columns_updated                  xml;\n</code></pre>\n\n<p>I create a record and do an update:</p>\n\n<pre><code>insert into STG_Participant_16_Month\n( Serial, ID, StartTime, FinishTime, ChildID, childIndex,\n  Record_State, Duplicate_flag )\nvalues\n(  90, 'ID', getdate(), getdate(), 'ChildID', 1,\n  'LOADED', 'N');\n\nupdate STG_Participant_16_Month set serial=99, ID='xx', childIndex=99  where serial=90;\n</code></pre>\n\n<p>I see output as follows:</p>\n\n<pre><code>&lt;Fields&gt;\n  &lt;Field Name=\"Serial\" /&gt;\n  &lt;Field Name=\"ID\" /&gt;\n  &lt;Field Name=\"childIndex\" /&gt;\n&lt;/Fields&gt;\n</code></pre>\n\n<p>How do I create a query which just shows the text values?</p>\n\n<pre><code>Serial\nID\nchildIndex\n</code></pre>\n"},{"tags":["c#","asp.net","sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":120,"score":0,"question_id":13116292,"title":"Converting a date column in DataTable to desired format before importing it in sql server","body":"<p>I am importing an excel sheet into sql server db table the table consists of \nid | data(which is actually date in mm/dd/yyyy)\nI am able to import the data into database table BUT i want the data(date) column of excel sheet to be converted in to yyyy/mm/dd format before importing it into sql server. Here is my code to import excel sheet:</p>\n\n<pre><code>      DataTable dt7 = new DataTable();\n      dt7.Load(dr);\n\n                // Bulk Copy to SQL Server\n     using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n     {                       \n\n\n     bulkCopy.DestinationTableName = \"ExcelTable\";\n\n\n     bulkCopy.WriteToServer(dt7);\n\n\n     }\n     dr.Close();\n</code></pre>\n\n<p>I have found a piece of code to convert mm/dd/yyyy into yyyy/mm/dd:</p>\n\n<pre><code>    string a = \"12/20/2012\";\n    DateTime dt = Convert.ToDateTime(a);\n    string st = dt.ToString(\"yyyy/MM/dd\");\n    Label1.Text = a;\n    Label2.Text = st;\n</code></pre>\n\n<p>but i have no idea how to implement it in my code. I am a complete newbie so you might have to explain with code :(</p>\n"},{"tags":["c#","asp.net","sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13115655,"title":"How to manipulate the excel data in SqlBulkCopy?","body":"<p>I am importing excel sheet into sql server db table, for eg:\nid | Data(which is date)\nthe format of date in excel is mm/dd/yyyy i want it to get stored in database as yyyy/mm/dd i have no idea how to do it the following is my code to upload the excel:</p>\n\n<pre><code>   using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n                {\n                   bulkCopy.DestinationTableName = \"ExcelTable\";\n                   bulkCopy.WriteToServer(dr);\n\n               }\n                dr.Close();\n</code></pre>\n\n<p>and i found a code to convert date but i dont know how to integrate this code with the above: </p>\n\n<pre><code>    string a = \"12/20/2012\";\n    DateTime dt = Convert.ToDateTime(a);\n    string st = dt.ToString(\"yyyy/MM/dd\");\n    Label1.Text = a;\n    Label2.Text = st;\n</code></pre>\n"},{"tags":["sql-server","linq","stored-procedures"],"answer_count":11,"favorite_count":5,"up_vote_count":4,"down_vote_count":0,"view_count":10676,"score":4,"question_id":752064,"title":"Performance Difference between LINQ and Stored Procedures","body":"<h3>Related</h3>\n\n<blockquote>\n  <p><a href=\"http://stackoverflow.com/questions/14530/linq-to-sql-vs-stored-procedures\">LINQ-to-SQL vs stored procedures?</a></p>\n</blockquote>\n\n<p>I have heard a lot of talk back and forth about the advantages of stored procedures being pre compiled. But what are the actual performance difference between LINQ and Stored procedures on Selects, Inserts, Updates, Deletes? Has anyone run any tests at all to see if there is any major difference. I'm also curious if a greater number of transactions makes a difference.</p>\n\n<p>My guess is that LINQ statements get cached after the first transaction and performance is probably going to be nearly identical. Thoughts?</p>\n"},{"tags":["sql-server","geocoding","geospatial"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":13112899,"title":"How to get the bounding coordinates for a US postal(zip) code?","body":"<p>Is there a service/API that will take a postal/zip code and return the bounding(perimeter) coordinates so I can build a Geometry object in a MS SQL database?</p>\n\n<p>By bounding coordinates, I mean I would like to retrieve a list of GPS coordinates that construct a  polygon that defines the US zip code. </p>\n"},{"tags":["sql-server","hibernate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13115314,"title":"Hibernate SQLServerException for username","body":"<p>I'm trying to run a java app that uses Hibernate and MS SQL Server Express.</p>\n\n<p>SQL Server is configured with windows authentication as the login methond. I've also enabled TCP/IP port 1433(default), but I still keep getting the following error.</p>\n\n<pre><code>...// more output\nat test.models.TestHibernate.main(TestHibernate.java:11)\nCaused by: com.microsoft.sqlserver.jdbc.SQLServerException: Login failed for user 'not required'. ClientConnectionId:de7daf69-2619-4906-b063-459a5b614bdb\n...// more output\n</code></pre>\n\n<p>The line throwing the exception:</p>\n\n<pre><code>session.beginTransaction();\n</code></pre>\n\n<p>hibernate.cfg.xml:</p>\n\n<pre><code>&lt;property name=\"connection.driver_class\"&gt;com.microsoft.sqlserver.jdbc.SQLServerDriver&lt;/property&gt;\n        &lt;property name=\"connection.url\"&gt;jdbc:sqlserver://localhost;databaseName=hibernatexml;integratedSecurity=false;&lt;/property&gt;\n        &lt;property name=\"connection.username\"&gt;not required&lt;/property&gt;\n        &lt;property name=\"connection.password\"/&gt;\n</code></pre>\n\n<p>I removed other configuration errors but with this I'm out of ideas. If you need more info just let me know</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","sql-server","regex","select"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13115251,"title":"Use regular expression for naming unnamed columns in query","body":"<p>Here is my code:</p>\n\n<pre><code>--INSERT INTO #TempTable\n    --(\n    --  coverageID,\n    --  coverageName,\n    --  coverageDesc,\n    --  clausesID,\n    --  clausesCode,\n    --  clausesDesc,\n    --  LastModBy,\n    --  UpdatedOn,\n    --  FullName,\n    --  LastModOn,\n    --  IsCompulsory\n    --)\n\n    SELECT\n        maCoverage.coverageID,\n        maCoverage.coverageName,\n        maCoverage.cd,\n        maClauses.cID,\n        maClauses.IOiusa * maClauses.Precode +             dbo.getcodety(maClauses.tim1,mClauses.cID),\nclausesCode,\n        maClauses.clausesDesc,\n        siUser.UserID AS LastModBy,\n         maClauses.UpdatedOn,\n            siUserProfile.FullName,\n        maClauses.LastModOn,\n        maClauses.IsCompulsory\n    ...\n</code></pre>\n\n<p></p>\n\n<p>Now, as you can see temp table has been commented out, the problem is after execution some columns have different name and some of them are unnamed...\nI wonder is there anyway to get the column names from Insert definition just before select query and one by one name columns in select query...\nlike following:</p>\n\n<pre><code>SELECT\n        maCoverage.coverageID,\n        maCoverage.coverageName,\n        maCoverage.cd As CoverageDesc,\n        maClauses.cID As ClausesID,\n        maClauses.IOiusa * maClauses.Precode +dbo.getcodety(maClauses.tim1,mClauses.cID) As ClausesCode,\n        maClauses.clausesDesc,\n        siUser.UserID AS LastModBy,\n         maClauses.UpdatedOn,\n            siUserProfile.FullName,\n        maClauses.LastModOn,\n        maClauses.IsCompulsory\n</code></pre>\n\n<p>I hope someone help me soon...</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server","tsql","dynamic-sql"],"answer_count":6,"favorite_count":0,"up_vote_count":8,"down_vote_count":0,"view_count":34636,"score":8,"question_id":662049,"title":"Dynamic SQL results into temp table in SQL Stored procedure","body":"<p>The code is as follows: </p>\n\n<pre><code>ALTER PROCEDURE dbo.pdpd_DynamicCall \n@SQLString varchar(4096) = null\n\nAS\n\nBegin\n\n    create TABLE #T1 ( column_1 varchar(10) , column_2 varchar(100) )\n\n    insert into #T1 \n        execute ('execute ' + @SQLString )\n\n    select * from #T1 \n\nEnd\n</code></pre>\n\n<p>The problem is that I want to call different procedures that can give back different columns.\nTherefore I would have to define the table #T1 generically.\nBut I don't know how.</p>\n\n<p>Can anyone help me on this problem?</p>\n"},{"tags":["asp.net","sql-server","ado.net","insert","bulkinsert"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":5232,"score":1,"question_id":2472184,"title":"Insert ADO.Net DataTable into an SQL table","body":"<p>The current solution i implemented is awful!</p>\n\n<p>I use a <code>for... loop</code> for inserting records from an ADO.NET data-table into an SQL table.</p>\n\n<p>I would like to insert at once the data-table into the SQL table, without iterating...</p>\n\n<p>Is that possible, or am i asking too much?</p>\n"},{"tags":["php","sql-server","odbc"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13115039,"title":"How to display 'text' data correctly with Microsoft ODBC driver for Linux? Currently displaying as random characters","body":"<p>I am trying to display the contents of a field in a MS SQL database, the data type of which is 'text'. When I connect to the database with MS Excel on a PC the value looks something like:</p>\n\n<blockquote>\n  <p>Shipped on the: 18/10/12 Toll IPEC Connote Number: XXX XXX XXXX</p>\n</blockquote>\n\n<p>When I connect to the database with PHP using the Microsoft ODBC driver for Linux, the output of the text field will display random characters, which are slightly different each time I run the exact same script. Here is what it output the last four times:</p>\n\n<blockquote>\n  <p>Xisep)!wXment.class.php))</p>\n  \n  <p>5isep)!ment.class.php))</p>\n  \n  <p>}isep)!}ment.class.php))</p>\n  \n  <p>t)!!Owner_IDt)8</p>\n</blockquote>\n\n<p>Not sure where it's getting the 'ment.class.php' bit from. That looks like the end of the name of one of my classes, but not one that is included in this particular script. Is the driver broken or what? All other data types (int, varchar, datetime etc) seem to display correctly, the problem only seems to happen with this one text field.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>&lt;?php\n\nrequire('ConnectWise.inc.php');\n\n$config = new CW_Config;\n\n// Connect to database\n$dbcnx = odbc_connect(\"ConnectWise\", $config-&gt;db_username, $config-&gt;db_password);\n\n// Query database\n$query = \"select * from Billing_Log where Invoice_Number = '24011'\";\n$result = odbc_exec($dbcnx, $query);\nwhile ($row = odbc_fetch_array($result)) {\n    echo $row['Top_Comment'] . \"\\n\";\n}\n\nodbc_close($dbcnx);\n</code></pre>\n\n<p>Here is the output of my last few attempts:</p>\n\n<blockquote>\n  <p>\\3!!Y!</p>\n  \n  <p>!!Y!</p>\n  \n  <p>&amp;!!Y!</p>\n</blockquote>\n"},{"tags":["php","sql-server","character-encoding"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2501,"score":3,"question_id":4663325,"title":"Why do I get invalid characters when converting MS SQL Data to MYSQL?","body":"<p>I'm writing a PHP script to import data into a MYSQL database from a Microsoft SQL Server 2008 database.</p>\n\n<p>The MSSQL Server is set with a collation of \"SQL_Latin1_General_CP1_CI_AS\" and the data in question is being stored in a column of the type \"nchar\".</p>\n\n<p>My PHP web pages use</p>\n\n<pre><code>&lt;meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\"&gt;\n</code></pre>\n\n<p>to indicate that they should be displayed with UTF-8 Character encoding.</p>\n\n<p>I'm pulling the data from the MSSQL database using the sqlsrv PHP extension.</p>\n\n<pre><code>$sql = 'SELECT * FROM [tArticle] WHERE [ID] = 6429';\n$stmt = &amp;sqlsrv_query($dbHandler, $sql);\n\nwhile ($row = sqlsrv_fetch_object($stmt)) {\n  // examples of what I've tried simply to display the data\n  echo $row-&gt;Text1;\n  echo utf8_encode($row-&gt;Text1);\n  echo iconv(\"ISO-8859-1\", \"UTF-8\", $row-&gt;Text1);\n  echo iconv(\"ISO-8859-1\", \"UTF-8//TRANSLIT\", $row-&gt;Text1);\n}\n</code></pre>\n\n<p>Forget about inserting the data into the MYSQL database for now.  I can't get the string to display properly in my PHP page.  From the examples in my listing:</p>\n\n<pre><code>echo $row-&gt;Text1\n</code></pre>\n\n<p>is rendered by my browser as an obviously invalid character:  \"Lucys\"</p>\n\n<p>all of the examples following that one are rendered as blanks:  \"Lucys\"</p>\n\n<p>It looks like a character set mismatch problem to me but how can I get this data to display properly from the MS SQL database (without changing my web-page encoding)?  If I can figure that out I can probably work out the storing it in the MYSQL database part.</p>\n"},{"tags":["sql-server","ssis"],"answer_count":4,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":3611,"score":3,"question_id":1800119,"title":"How do you get an SSIS package to only insert new records when copying data between servers","body":"<p>I am copying some user data from one SqlServer to another.  Call them Alpha and Beta.  The SSIS package runs on Beta and it gets the rows on Alpha that meet a certain condition.  The package then adds the rows to Beta's table.  Pretty simple and that works great.</p>\n\n<p>The problem is that I only want to add new rows into Beta.  Normally I would just do something simple like....</p>\n\n<pre><code>INSERT INTO BetaPeople\n SELECT * From AlphaPeople\n where ID NOT IN (SELECT ID FROM BetaPeople)\n</code></pre>\n\n<p>But this doesn't work in an SSIS package.  At least I don't know how and that is the point of this question.  How would one go about doing this across servers?</p>\n"},{"tags":["sql-server","dax"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13114702,"title":"MDX equation convert to DAX equation","body":"<p>I'm studying SQL Server Tabular model.<br/>I'm struggle to transfer a MDX equation to DAX equation.</p>\n\n<p>I want to show every month's PC count changing(incremental or decremental) rate using following calculation.<br/>(current month PC count - previous month PC count) / previous month PC Count</p>\n\n<p>This is MDX equation and it is working well in multi-dimensional model.<br/>\n[PC Count] is Last non-empty value.</p>\n\n<pre><code>(([Date].[Fiscal QTR].CURRENTMEMBER, [Measures].[PC Count])\n-\n([Date].[Fiscal QTR].PREVMEMBER, [Measures].[PC Count]))\n/\n([Date].[Fiscal QTR].PREVMEMBER, [Measures].[PC Count])\n</code></pre>\n\n<p>I made a DAX equation for current month PC count</p>\n\n<pre><code>PC Count:=\nCALCULATE(\n    SUM([PC Count]),\n    FILTER(Time, Time[DateKey] = MAX(vwFact_PCCount[DateKey]))\n)\n</code></pre>\n\n<p>This is working well in Grid view(SSDT) and Performance Point.\nbut the following MDX equation for previous month PC Count is working well in grid view(SSDT) but this equation shows error in Performance Point when I bottom axis(month).</p>\n\n<pre><code>Previous Month Count:=CALCULATE(\n    SUM([PC Count]),\n    FILTER(Time, Time[DateKey] = FORMAT(DATE(LEFT(Max(vwFact_PCCount[DateKey]),4),\n                                             RIGHT(LEFT(Max(vwFact_PCCount[DateKey]),6),2)\n                                             ,1)-1\n                                        , \"yyyyMMdd\") *1)\n)\n</code></pre>\n\n<p>I don't know what is wrong my Previous Month Count equation.\nHow can I get this result using DAX?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13114198,"title":"SQL Server tuning - index vs. statistics","body":"<p>We ran the SQL tuning advisor and it produced a list of possible indexes and statistics. What the index is clear, but are those \"statistics\" also important to create? What do they precisely (I assume they collect data, but who uses it)?</p>\n"},{"tags":["c#","sql-server","winforms","radio-button","global-variables"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13105887,"title":"Passing a value to a global variable for reference with WinForms (C#) and SQL Connection","body":"<p>I need two global variables to be accessed by multiple winforms at various stages.</p>\n\n<p>The first is in regards to a distinct user, after logging in to the app,\nother winforms need to get data from sql server tables based on the user who logged in.</p>\n\n<pre><code>SqlCommand cmd = new SqlCommand(\"SELECT * FROM regClient WHERE client_ID = **[GLOBAL VARIABLE]**\", con);\n</code></pre>\n\n<hr>\n\n<p>The second follows this in that the user can log in as either a <strong>Client</strong> or <strong>Student</strong>. Different statements need to be called based on this. This value is set by radiobutton on the login window.</p>\n\n<p>So if radClient is checked set global to 'client', if radStudent is checked set global to 'student'\nthen with other winforms can call select statements or enable/visible based on what the global is.</p>\n\n<hr>\n\n<p>I believe I can store variables in <strong>Programs.cs</strong> but I'm not sure.</p>\n"},{"tags":["sql-server","triggers","updatable-views","merge-statement"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13113909,"title":"Instead of Trigger on View using Merge doesn't apply table default values","body":"<p>I have an updateable view using an instead of trigger for insert/update. That trigger uses Merge. I'm finding that the Merge statement isn't applying the default constraints from the underlying physical table, although the merge documentation suggests it should.</p>\n\n<p>The following example demonstrates:</p>\n\n<pre><code>create table tblTest\n(\n    id uniqueidentifier not null primary key default newid(),\n    forename varchar(20),\n    surname varchar(20) not null default 'xxyyzz'\n)\ngo\n\ncreate view vwTest as select * from tblTest\ngo\n\ncreate Trigger vwTest_trigger_insteadof_insert_update On vwTest\nInstead of Insert, Update As\nbegin\nset nocount on\nMerge tblTest t\n\nUsing\n    inserted i On (t.id = i.id)\n\nWhen Matched Then\n    Update\n        Set\n        t.forename = i.forename,\n        t.surname = i.surname\n\nWhen Not Matched By Target Then\n    Insert\n    (\n        id,\n        forename,\n        surname\n\n    )\n    Values\n    (\n        i.id,\n        i.forename,\n        i.surname\n\n    )\nOUTPUT $action, Inserted.*, Deleted.*\n;\nend\ngo\n\n--Inserts to physical table work as expected\ninsert into tblTest (id) values (newid())\ninsert into tblTest (surname) values ('smith')\n\n--Inserts into updateable view fail as no defaults are set\n--from the underlying physical table\ninsert into vwTest (id) values (newid())\ninsert into vwTest (surname) values ('jones')\n</code></pre>\n\n<p>I see someone had something similar in <a href=\"http://stackoverflow.com/questions/2200731/using-default-values-in-an-instead-of-insert-trigger\">Using default values in an INSTEAD OF INSERT trigger</a> and solved it by copying the rows in inserted into a temporary and then altering the temp table to add in the default constraints from the physical table. I'm not sure I could tolerate the performance issues of these additional steps.</p>\n"}]}
{"total":54452,"page":12,"pagesize":100,"questions":[{"tags":["sql","sql-server","query","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":65,"score":-1,"question_id":13112759,"title":"How to select a record that is between two dateranges and two input parameters StartDate and EndDate in SQL server?","body":"<p>In my database I have a group which can be active in a week with opening hours.<br>\nGroup A Startdate: 22-10-2012 EndDate: 28-10-2012 (Startdate is always beginning of the week)<br>\nGroup A Startdate: 29-10-2012 EndDate: 04-11-2012 (Always end of the week)</p>\n\n<p>Group A has two different opening hours in this two weeks. </p>\n\n<p>Now I have a stored procedure that returns the active group by looking the input parameters StartDate and EndDate. If this two parameters are between the startdate and end date of ONE week then I'm getting the right opening hours.</p>\n\n<p>But when the input parameters are about TWO weeks (Begindate: 22-10-2012 and EndDate: 30-10-2012) then I get the opening hours of two weeks.  </p>\n\n<pre><code>declare @Begindate datetime    \nset @Begindate = '2012-10-22'\n\ndeclare @Enddate datetime   \nset @Enddate = '2012-11-02'\n\n\nSELECT Id, Date, ..., ...   \nFROM Table1 t1  \nINNER JOIN Combinations c ON t1.Id=c.Table1Id\nINNER JOIN Group g ON c.GroupId=g.Id  \nWHERE t1.Date&lt;= @Enddate) AND (t1.Date&gt;= @Begindate  (gets dates I need)   \nAND g.BeginDate &lt;=@Enddate and g.Enddate &gt;= @Begindate (Gets active groups)\n\n\nSome table data:\n\nTable1:\n\nId    Date         GroupId\n1     2012-10-23   10\n1     2012-10-29   10\n\n\n\nCombinations: (holds the relation between Table1 and Group)\n\nID  Table1Id    GroupId\n1   10          1\n\n\nGroup Table:\n\nID    Name     StartDate   EndDate     MondayOpen   MondayClose ...\n1     Group A  2012-10-22  2012-10-28  08:00        18:00\n1     Group A  2012-10-29  2012-11-04  13:00        18:00\n</code></pre>\n\n<p>With this query I am getting a group two times because both the inputparametes are over two weeks. </p>\n\n<p>How can I get for the dates (from t1) the correct opening dates looking the group Begin and End date?</p>\n"},{"tags":["sql-server","windows-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":390,"score":0,"question_id":10552467,"title":"Cannot Open Microsoft SQL Server Management Studio","body":"<p>I have a big problem. While am opening Microsoft SQL Server Management Studio it appears me an error: </p>\n\n<p>\"Cannot find one or more components. Please reinstall the application\"</p>\n\n<p>I was searching solutions in Internet but I didn't found anything helpful.</p>\n\n<p>I have SQL Server 2012 and Windows Server 2008 R2.</p>\n\n<p>Some suggestion?</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","asp.net","sql-server","visual-studio-2010","asp.net-mvc-3"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":204,"score":1,"question_id":7776437,"title":"Visual Studio 2010 SQL Developement Server stopped working","body":"<p>I was making minor modifications to a view in my ASP.NET MVC3 C# appication when all of a sudden the application would no longer run.  The error message is as follows:  </p>\n\n<p>System.Data.SqlClient.SqlException: A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Shared Memory Provider, error: 40 - Could not open a connection to SQL Server)</p>\n\n<p>Upon close inspection of the server explorer I noticed that all database connections are no longer working.  I cannot expand any of the connections to view the tables and data I previously generated within.  When I attempt to, there is a pop-up window that is generated that repeats the exact same error as above.  </p>\n\n<p>It is important to note that I was not making any modifications to any portion of the aplication that pertains to a database.  I was rearangeing some of the visual components of a view in my application when all of this occurred.  I had just recently restarted my computer and had made no other modificatins since that time.  </p>\n\n<p>At first I thought that somehow SQL Express had overwritten my developement envirnments verson of sql server and began to reinstall sql express.  The installation fails every time now.  There is no specific error.  Windows generates an error message saying that the setup application \"stoped working\" and hangs until closed.  I have tried several different versions of the sql express installation package and they all result in the same error happeneing at different points in the installation process.  To be clear, I'm not even sure sql express is the problem.  I don't know why it would be since I'm using the sql server that is built into visual studio 2010.  </p>\n\n<p>I am at an impass and cannot continue with my work until this is resolved.  If I can't resolve it I don't get to continue to work so any input you can give me will be greatly appreciated.  I won't be sleeping until I can get this working again.</p>\n\n<p>D.A.P.</p>\n"},{"tags":["sql-server","stored-procedures"],"answer_count":5,"favorite_count":0,"up_vote_count":10,"down_vote_count":0,"view_count":17417,"score":10,"question_id":2397161,"title":"How to convert int to char with leading zeros?","body":"<p>I need to convert int data table field to char leading zeros</p>\n\n<p>example:</p>\n\n<p>1 convert to '001'</p>\n\n<p>867 convert to '000867'</p>\n\n<p>thx.</p>\n\n<hr>\n\n<p>This is my response 4 Hours later ...</p>\n\n<p>I tested this T-SQL Script and work fine for me !</p>\n\n<pre><code>DECLARE @number1 INT, @number2 INT\n\nSET @number1 = 1\n\nSET @number2 = 867\n\nSELECT RIGHT('000' + CAST(@number1 AS NCHAR(3)), 3 ) AS NUMBER_CONVERTED\n\nSELECT RIGHT('000000' + CAST(@number2 AS NCHAR(6)), 6 ) AS NUMBER_CONVERTED\n</code></pre>\n\n<hr>\n\n<p>I created this user function</p>\n\n<p>T-SQL Code :</p>\n\n<pre><code>CREATE FUNCTION CIntToChar(@intVal BIGINT, @intLen Int) RETURNS nvarchar(20)\nAS\nBEGIN\n\n    -- BIGINT = 2^63-1 (9,223,372,036,854,775,807) Max size number\n\n    -- @intlen contains the string size to return\n    IF @intlen &gt; 20\n       SET @intlen = 20\n\n    RETURN REPLICATE('0',@intLen-LEN(RTRIM(CONVERT(nvarchar(20),@intVal)))) \n        + CONVERT(nvarchar(20),@intVal)\n\nEND\n</code></pre>\n\n<p>Example :</p>\n\n<p>SELECT dbo.CIntToChar(  867,  6  ) AS COD_ID</p>\n\n<p>OUTPUT</p>\n\n<p>000867</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":19,"score":-1,"question_id":13110662,"title":"Searching for various numbers from a given list inside a table","body":"<p>I have a simple question that i could not find any reference to and i would appreciate any help.\ni have a list of user_ids sent from the client to the server - for example - (1,2,3,4)\nand i want to search in a table of groups how many time each group got the those users inside.\nthe groups table's columns are : group_id,group_name,user_id</p>\n\n<p>and i want the result to show each group name and the number of times number from the searched list's numbers appear inside.</p>\n\n<p>i also want to show if it doesn't as 0.</p>\n\n<p>example:</p>\n\n<pre><code>groupName     NumOfCustomersFromTheSentListThatAreAttachedToTheGroup\n  A                   0\n  B                   3\n</code></pre>\n\n<p>i was thinking something like:\nselect group_id,COUNT(userID) FROM userByGroup where userID in (1,2,3,4) group by group_id;</p>\n\n<p>but then i have 2 problems:</p>\n\n<ol>\n<li>i don't see that ones with no appearance (because of the WHERE)</li>\n<li>i get a record for each appearance and i want a record for each group</li>\n</ol>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13110592,"title":"Store table in separate filegroup in SQL Server","body":"<p>I have big SQL Server database, with a lot of blob data in some tables.</p>\n\n<p>For performance optimization, I want to move one table to separate hard drive.</p>\n\n<p>I created new filegroup, and \"row data\" file.</p>\n\n<p>But, I can't change any parameters in table properties: they are all disabled.</p>\n\n<p>And I don't know a way to enable it.</p>\n\n<p>Can anybody help me?</p>\n\n<p><img src=\"http://i.stack.imgur.com/KTyAu.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server","common-table-expression"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":13094576,"title":"Finding the next result when none is found?","body":"<p>I am attempting to traverse a hierarchy with a CTE and it works fine in one scenario but not another and that is where I am stuck. </p>\n\n<p>Given the query;</p>\n\n<pre><code>;WITH BOMcte (ID, Code, BomName , ProductID, ProductCode, ProductName , ParentAssemblyID )\nAS\n(\n    SELECT   b.id,\n             b.code,\n             b.name,\n             p.id,\n             p.default_code,\n             p.name_template,\n             b.bom_id\n    FROM mrp_bom AS b\n    INNER JOIN product_product p on b .product_id = p.id    \n    WHERE b. bom_id IS NULL \n    and b.id = @AssemblyID \n    UNION ALL\n    SELECT   b.id,\n             b.code,\n             b.name,\n             p.id,\n             p.default_code,\n             p.name_template,\n             b.bom_id\n    FROM mrp_bom AS b\n    INNER JOIN product_product p on b .product_id = p.ID    \n    INNER JOIN BOMcte AS cte ON b.bom_id = cte.ID    \n)\nSELECT BoM.* FROM BOMcte BoM\n</code></pre>\n\n<p>The query works just as I expected because the BoM drills down to the child boms on the column bom_id. </p>\n\n<p>In code (from OpenERP) when a child BoM isn't found, (no bom_id) a child product is searched for based on the product_id:</p>\n\n<pre><code>sids = bom_obj.search(cr, uid, [('bom_id','=',False),('product_id','=',bom.product_id.id)])\n</code></pre>\n\n<p>I am wondering if there is a method I can use to accomplish the same thing in SQL. Once the CTE doesn't return rows, check with the product_id and a null bom_id. I had thought about another recursive member but I don't think that's what I am looking for.</p>\n\n<p>I know my question probably isn't very clear but, any suggestions?</p>\n\n<p>SQL Fiddle example data here: <a href=\"http://sqlfiddle.com/#!3/b9052/1\" rel=\"nofollow\">http://sqlfiddle.com/#!3/b9052/1</a></p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":57,"score":0,"question_id":13109370,"title":"Match two Columns in SQL Join","body":"<p>I have following Table Structure :</p>\n\n<p>Table: CashStatus (Can have duplicate entries for \"ATM\")</p>\n\n<pre><code>ATM  Cash   Device\nA01  55     BASE\nA01  1      IST\nA02  1      BASE\nA02  78     IST\n</code></pre>\n\n<p>Table : ATM (Unique Entry for ATM Column)</p>\n\n<pre><code>ATM   DEVICE\nA01   BASE\nA02   IST\n</code></pre>\n\n<p>I want to retreive only those rows from <code>CashStatus</code> table who's <code>ATM &amp; Device</code> Column matches with as with <code>ATM</code> Table</p>\n\n<p>I did some research and tried the following query:-</p>\n\n<pre><code>SELECT *\n  FROM CashStatus \n WHERE EXISTS (SELECT 'X'\n                 FROM ATM\n                WHERE ATM = TermId collate SQL_Latin1_General_CP1_CI_AS\n               AND DeviceName = Devicetype collate SQL_Latin1_General_CP1_CI_AS);\n</code></pre>\n\n<p>But it gives error : <code>Expression type int is invalid for COLLATE clause.</code></p>\n"},{"tags":["sql","sql-server","replication"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1812,"score":4,"question_id":4744282,"title":"SQL Server : subscription : how to know if a table is under replication/subscription","body":"<p>In SQL Server, on the \"Subscription side\", how can you know if a table is under replication/subscription?</p>\n\n<p>Any idea?</p>\n"},{"tags":["sql","sql-server","tsql","pivot"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":13103114,"title":"T:SQL: select values from rows as columns","body":"<p>I have a table for Profiles stores profile properties values in row style, ex:</p>\n\n<pre><code>[ProfileID]     [PropertyDefinitionID]      [PropertyValue]\n1               6                           Jone\n1               7                           Smith\n1               8                           Mr\n1               3                           50000\n</code></pre>\n\n<p>and another table for property definitions :</p>\n\n<pre><code>[PropertyDefinitionID]  [PropertyName]\n6                       FirstName\n7                       LastName\n8                       Prefix\n3                       Salary\n</code></pre>\n\n<p>How to use <code>PIVOT</code> or any other way to show it in this way:</p>\n\n<pre><code>[ProfileID] [FirstName] [LastName]  [Salary]\n1           Jone        Smith       5000\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13090398,"title":"Avoid duplicate names in a dataset","body":"<p>I am fetching data from a table and binding to a label and Drop down in a gridview but i want to filter the duplicate names from the table and assign the corresponding dates to the DDL how can do this? or else is there any other alternative?</p>\n\n<pre><code> private DataSet get()\n    {\n        string sql = \"select Id,Name,RunDate from Historytable\";\n        SqlDataAdapter da=new SqlDataAdapter(sql,con);\n        DataSet ds=new DataSet();\n        da.Fill(ds);\n        return ds;\n    }\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/NZuWG.png\" alt=\"enter image description here\"></p>\n\n<pre><code> protected void GridView1_RowDataBound1(object sender, GridViewRowEventArgs e)\n    { \n\n        //what to code here?\n\n\n        }\n</code></pre>\n"},{"tags":["c#","sql-server","date","datetime","insert"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":57,"score":0,"question_id":13110170,"title":"How can I run auto datetime in SQL Server?","body":"<p>I use C# .NET</p>\n\n<p>I need run auto <code>datetime</code> in my project and save in SQL Server</p>\n\n<p><strong>Exam.</strong></p>\n\n<p>In SQL Server</p>\n\n<pre><code>Datetime    | workDate\n-------------------------\n25-10-2012  | work\n26-10-2012  | work\n28-10-2012  | work\n</code></pre>\n\n<p>In my project, I'm searching datetime between 25-28</p>\n\n<p>I need program output</p>\n\n<pre><code>25-10-2012  work\n26-10-2012  work\n27-10-2012  null\n28-10-2012  work\n</code></pre>\n\n<p>But now I get:</p>\n\n<pre><code>25-10-2012  work\n26-10-2012  work\n28-10-2012  work\n</code></pre>\n\n<p>Because my data save status work only when status don't work it's not save in database.</p>\n\n<p>How can I use insert value null, show data to my project and save in SQL Server?</p>\n\n<p>Thanks For your Time :).</p>\n"},{"tags":["sql","sql-server","stored-procedures","group-by","informix"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":13093683,"title":"MS SQL To Informix 11 - Group By converted datetime","body":"<p>I am attempting to move a stored proceedure from Microsoft SQL Server 2000 to Informix 11. The original SP contains a final select statement with a GROUP BY statement that includes a converted datetime:</p>\n\n<pre><code>group by convert(varchar(8), c.startDateTime, 1)\n</code></pre>\n\n<p>When i convert this to Infomrix syntax the get a syntax error at run time:</p>\n\n<pre><code>GROUP BY (c.startDateTime::DATETIME YEAR TO DAY)::VARCHAR(10)\n</code></pre>\n\n<p>Can someone please point me to how, if possible, this can be done in Informix?  If this is not possible, which I suspect, how would you typically handle this in the overall query?</p>\n"},{"tags":["php","sql-server","database"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13109012,"title":"From PDO to SQLSRV","body":"<p>I used PDO for MYSql before but now i need to use Microsoft SQL Server Driver for PHP.</p>\n\n<p>I found the manual.\n<a href=\"http://php.net/manual/en/book.sqlsrv.php\" rel=\"nofollow\">http://php.net/manual/en/book.sqlsrv.php</a></p>\n\n<p>I use Example #2 to connect to the new SQL database:\n<a href=\"http://www.php.net/manual/en/function.sqlsrv-connect.php\" rel=\"nofollow\">http://www.php.net/manual/en/function.sqlsrv-connect.php</a></p>\n\n<p>How do I 'convert' the following (PDO mysql) to work with sqlsrv: </p>\n\n<pre><code>$username = 'test';\n\ntry {\n$conn = new PDO('mysql:host=$host;dbname=$database', $username, password);\n$stmt = $conn-&gt;prepare('SELECT username users WHERE username = :username LIMIT 1');\n$stmt-&gt;execute(array('username' =&gt; $username));\n\nif ($stmt-&gt;rowCount() &gt; 0) {\n$result = $stmt-&gt;fetch();\n\n    echo $result['username'];\n\n} else {\n    echo 'Nothing found.';\ndie();\n}\n} catch(PDOException $e) {\necho 'ERROR: ' . $e-&gt;getMessage();\n}\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13109526,"title":"SQL Counting (More than)","body":"<pre><code>distrikt = district\n\nSELECT POST.distrikt, COUNT(PERSON.personnr)\n  FROM [dbo].POST join [dbo].PERSON on POST.postnr = PERSON.postnr\n  WHERE ?\n  GROUP BY POST.distrikt\nGO\n</code></pre>\n\n<p>I need to view the districts showing the number of persons associated with each, but it should only show the districts which contain 2 or more persons. I tried using <code>COUNT(PERSON.personnr) &gt; 2</code>, but that didn't work. Apart from that, it shows the districts and associated persons just fine. </p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":5,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":456,"score":0,"question_id":9788599,"title":"SQL: Join with substrings","body":"<p>I have a table <strong>A</strong> with the string-column <strong>a</strong> and a table <strong>B</strong> with the string-column <strong>b</strong>. a is a substring of b. Now I want to <strong>join</strong> the the to tables via <strong>a and b</strong>. Is this possible?</p>\n\n<p>I want something like this:</p>\n\n<p><strong><code>Select * from A,B where A.a *\"is substring of\"* B.b</code></strong></p>\n\n<p>How can I write this in <strong>SQL</strong> (Transact-SQL)?</p>\n"},{"tags":["sql","sql-server","visual-studio"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13108956,"title":"Get first table count which has been unioned into multiple tables","body":"<p>Here is a pseudo code what I want.\nI need to get count of fist union in following statement.</p>\n\n<pre><code>SELECT *  \nFROM Table1 \nUNION \nSELECT Cats.Id + (SELECT COUNT(*) FROM Fist_Union_Result), \n       Cats.Name \nFROM Table2\n</code></pre>\n\n<p>Any idea ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":3,"view_count":58,"score":-1,"question_id":13099038,"title":"Get max of column using sum","body":"<p>I have one table with following data..</p>\n\n<pre><code>saleId amount date\n-------------------------\n  1     2000  10/10/2012\n  2     3000  12/10/2012\n  3     2000  11/12/2012\n  2     3000  12/10/2012\n  1     4000  11/10/2012\n  4     6000  10/10/2012\n</code></pre>\n\n<p>From my table I want result with max of sum amount between dates 10/10/2012 and 12/10/2012 which for the data above will be:</p>\n\n<pre><code>saleId  amount \n---------------\n1       6000\n2       6000\n4       6000\n</code></pre>\n\n<p>Here 6000 is the max of the sums (by saleId) so I want ids 1, 2 and 4.</p>\n"},{"tags":["sql-server","visual-studio","linq-to-entities"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":445,"score":2,"question_id":7947959,"title":"How do I add a database diagram in visual studio 2010?","body":"<p>I created a database in App_Data, but when I try to generate a diagram for it by right clicking on  \"Database Diagrams\" and then adding a new diagram I get the error: \"Could not obtain information about Windows NT group/user\"</p>\n\n<p>with the error code 0x534</p>\n\n<p>Does anyone know how I can create database diagrams?</p>\n\n<p>I tried googling but no obvious answers came up.</p>\n"},{"tags":["sql-server","xml","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":13109025,"title":"Quering XML in SQL Server without a schema","body":"<p>I have a database that stores a large chunk of XML containing information about installations our companies products. There is no schema defined for the XML and no one has a list of all potential tags.</p>\n\n<p>Each record has hundreds of structures like this: </p>\n\n<pre><code>&lt;array type=\"DWORD\" name=\"m_somesetting.SMTPPorts\" size=\"5\"&gt; \n   &lt;set&gt;19&lt;/set&gt; \n   &lt;set&gt;1D0&lt;/set&gt; \n   &lt;set&gt;14B&lt;/set&gt; \n&lt;/array&gt;\n</code></pre>\n\n<p>I have been asked to create a table showing each possible tag a value and a count of how many of our tens of thousands of records have that particular setting.</p>\n\n<p>Does anyone know how I might automate this? I have a reasonable understanding of how to do queries against XML but I need some way to first get each tag that exists and then get each unique value that exists and finally a count of records that contain that value.</p>\n\n<p>Any ideas of how to do this short of hand coding each possible tag into a query?</p>\n"},{"tags":["sql","sql-server","visual-studio","ado.net","entitydatasource"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":23,"score":-1,"question_id":13108810,"title":"ADO.NET EntityDataSource Error >> The right expression must be of numeric or string type","body":"<p>I have two tables which I want to merge them into one as a view or query.</p>\n\n<pre><code>(SELECT \n     MainCats.Id, MainCats.Name AS Title, CAST(NULL AS System.String) AS PID \n FROM MainCats) \n\nUNION \n\n(SELECT \n     Cats.Id +  (SELECT COUNT(MainCats.Id) FROM MainCats), Cats.Name, Cats.CatID \n FROM Cats)\n</code></pre>\n\n<p>The error is about third <code>Select</code> which contains <code>Count</code> .</p>\n\n<p>All I need is to get a scalar value.</p>\n\n<p>Also I have tried to CAST whole select to numeric type with no luck.</p>\n\n<p>Any idea ?</p>\n"},{"tags":["sql-server","datetime","order"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":34,"score":-3,"question_id":13108962,"title":"SQL Server ORDER BY by datetime","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13108785/order-by-sql-timestamp\">Order by SQL timestamp</a>  </p>\n</blockquote>\n\n\n\n<p>I have a column added to every row which is filled with the <code>NOW()</code> function. This column is of datatype <code>DATETIME</code> and looks like this: <code>2012-10-28 13:50:40</code>. </p>\n\n<p>Can I just use the SQL <code>ORDER BY DESC</code>, to show the latest entries first? </p>\n\n<p>Thanks!\nSander</p>\n"},{"tags":["sql-server","entity-framework","ef-code-first","data-migration","code-first-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":13103349,"title":"How to add a new code-first migration with a newly-generated database?","body":"<p>I've enabled code-first migrations on my entity framework project, and have added several migrations which do things like rename tables.  However, I have now deleted the database and caused entity framework to generate a brand new database based on my latest data model.  If I try to run:</p>\n\n<pre><code>PM&gt; Add-Migration TestMigration\n</code></pre>\n\n<p>... it tells me that I need to apply the existing migrations first.  So I run:</p>\n\n<pre><code>PM&gt; Update-Database\n</code></pre>\n\n<p>... but the trouble is that it's trying to update a database that doesn't need updating; it's already based on the latest data model.  So I get an error when it tries to rename a table that now doesn't exist.</p>\n\n<p>Is there some way I can indicate to data migrations that my database is up-to-date and doesn't need any migrations running on it?  What should I do?</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":48,"score":4,"question_id":13108590,"title":"SELECT COUNT within date range","body":"<p>I'm trying to get a count of emails received during a date range using MSSQL Express 2005. I've managed that much, but now I want to split out the data into what was done with it. </p>\n\n<p>Here's what I've got so far: </p>\n\n<pre><code>SELECT EmailAddress, COUNT(EmailAddress) \n  FROM mails \n  WHERE ReceivedTime &gt;= DATEADD(DAY, -7, GETDATE()) \n  GROUP BY EmailAddress\n    HAVING COUNT(EmailAddress) &gt; 10\n</code></pre>\n\n<p>That gives me a list of addresses who mailed more than 10 times in the last week, but we have another column that tells us what happened with the mail. I'm trying to achieve something like this: </p>\n\n<pre><code>SELECT EmailAddress, \n  COUNT(ActionTaken WHERE ActionTaken=\"Deleted\") AS Deleted,\n  COUNT(ActionTaken WHERE ActionTaken=\"Replied\") AS Replied,\n  COUNT(ActionTaken WHERE ActionTaken=\"Read\") AS Read,\n  COUNT(EmailAddress) AS Total\n  FROM mails \n  WHERE ReceivedTime &gt;= DATEADD(DAY, -7, GETDATE()) \n  GROUP BY EmailAddress\n    HAVING COUNT(EmailAddress) &gt; 10\n</code></pre>\n\n<p>I'm looking for a result set along these lines: </p>\n\n<pre><code> EmailAddress     | Deleted | Replied | Read | Total\n ---------------------------------------------------\n user1@domain.com | 4       | 5       | 3    | 12\n user2@domain.com | 2       | 6       | 3    | 11\n</code></pre>\n\n<p>I'm pretty sure it has something to do with using OVER(PARTITION BY) clauses, but I've hit a wall. I realise the ActionTaken field isn't ideal, but I didn't build it!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","delete","delete-row"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":13108778,"title":"Fast deletion of many rows in data warehouse data","body":"<p>In SQL Server 2008 I have some million rows of data which needs be deleted. They are scattered across a handful of tables. Deletion takes up to 20 seconds which I think is way to slow! The data to be deleted is identified by a <code>timestamp</code> column. Here is what I have done so far in order to optimize:</p>\n\n<ul>\n<li>Using isolation level <code>read uncommitted</code>. I don't care about transactions. If we fail the user will issue the delete operation again. And new data is ensured not to have the <code>timestamp</code> we are deleting.</li>\n<li>Deleting leaf tables before parent tables.</li>\n<li>The <code>timestamp</code> column is part of the PK clustered index, in fact its the first position of the PK/index.</li>\n<li>Each table is emptied using a loop which deletes top 200000 entries in order to reduce the transaction log overhead.</li>\n<li>Neither I/O nor CPU is maxed out on the server</li>\n</ul>\n\n<p>What have I overlooked? </p>\n\n<p>Also I am in doubt of the effect of moving the timestamp column to  the first position in the PK. After doing so, must I reorganize the tables or is SQL Server smart enough to do this itself. My understanding of clustered index is that since it defines the physical layout of the rows, it is force into reorganizing the data. But we have no complaints from the customer that the changing clustered index operation took a long time to perform.</p>\n"},{"tags":["sql-server","sql-server-2008","ssms","ssms2008"],"answer_count":4,"favorite_count":3,"up_vote_count":15,"down_vote_count":0,"view_count":6863,"score":15,"question_id":2004789,"title":"How to alter SQL in \"Edit Top 200 Rows\" in SSMS 2008","body":"<p>In SQL Server 2008 Management Studio, when I right click on a database table and choose \"<strong>Select Top 100 Rows</strong>\", I can then e.g. easily add a \"ORDER BY \" statement to the SQL. That works <strong>fine</strong>.</p>\n\n<p>But when I do choose \"<strong>Edit Top 200 Rows</strong>\", I don't have the ability to <strong>alter</strong> the SQL (which makes it hard to find and edit a record just added in the 10,000 that are there.</p>\n\n<p>I am quite sure I was able to do this in <strong>SQL Server 2000</strong>.</p>\n\n<p><strong>Is there any way in SMSS 2008 to alter the way the records are displayed when editing records?</strong></p>\n"},{"tags":["asp.net","sql-server","vb.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13106142,"title":"Move from VB executeScalar to dynamic selection","body":"<p>I have a menu that has image buttons selected with VB using a method that selects the first image of the list of items shown if you click on that menu item. What I'm trying to do is to display a random image instead. Currently there is this method in VB controlling the image shown.</p>\n\n<pre><code>    Dim conn As New SqlConnection()\n        Dim cmd As New SqlCommand()\n\n        conn.ConnectionString = FlashDB.ConnectionString\n        cmd.Connection = conn\n        cmd.CommandType = CommandType.StoredProcedure\n        cmd.CommandText = \"get_first_flash\"\n\n        Dim idParam As New SqlParameter(\"@collectionID\", CollectionID)\n        cmd.Parameters.Add(idParam)\n\n\n        Dim result As Object\n        Dim previousConnectionState As ConnectionState = conn.State\n        Try\n            If conn.State = ConnectionState.Closed Then\n                conn.Open()\n            End If\n            result = cmd.ExecuteScalar()\n\n        Finally\n            If previousConnectionState = ConnectionState.Closed Then\n                conn.Close()\n            End If\n        End Try\n\n        Return \"images/thumbnails/\" &amp; result\n\n   //In the html\n   &lt;a href='viewproject.aspx?swfID=&lt;%# Eval(\"swfID\") %&gt;' &gt;\n         &lt;img src=\"images/thumbnails/&lt;%# Eval(\"thumbnail\") %&gt;\"\n              height=\"150\" width=\"180\" /&gt;&lt;/a&gt;\n</code></pre>\n\n<p>Is there a different method I can use to skip using executeScalar to give me that dynaimic response as apposed to a image in the first row.</p>\n\n<p>Thanks</p>\n"},{"tags":["mysql","sql","sql-server","visual-studio-2010","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":661,"score":0,"question_id":6311124,"title":"error 26 on sql server","body":"<p>I have prepared a program with Visual Basic 2010 and am using SQL database. (service based database) it works properly. But sometimes (when i dont use computer for a period like 2 hours) I try to start my program on VB (F5), it waits, and then gives this error:</p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occured while establishing a connection to SQL Server. The server was not found or is not accesible. Verify that the instance name is correct and that SQL Server name is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified.)</p>\n</blockquote>\n\n<p>However, after restarting my computer one or two times, there is no error: it works well. I have googled it, but nothing helps. I'm afraid this error will be a problem when the user uses the program. How might I solve this?</p>\n"},{"tags":["java","sql-server","netbeans"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":885,"score":1,"question_id":6892783,"title":"connecting to SQL Server from Netbeans","body":"<p>I am trying to connect to a server instance of SQL Server 2010 that I installed recently using NetBeans. I have downloaded the latest JDBC driver for MS SQL Server, but I cannot get the right connection string to connect to this database. I think I am missing the following values in the connection:</p>\n\n<ul>\n<li>Port</li>\n<li>Instance Name</li>\n<li>and I am not sure if my username should be <strong><em></strong>/</em>*** or only the name that appears after the /</li>\n</ul>\n\n<p>'jdbc:sqlserver://'</p>\n\n<p>Any help appreciated,</p>\n\n<p>Ted</p>\n"},{"tags":["c#","sql-server","view","entity-framework-4.1"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13107723,"title":"SQL text cannot be represented in the grid pane and diagram pane","body":"<p>I am working on entity Model.  I updated the view to entity model, but this view not showing the correct data.  I searched on Google, and a few members suggested that add one more column to the view. So, I just added one column to the View.</p>\n\n<p><code>row_number()</code> over (order by <code>Employee.EmployeeID</code>) as PK,</p>\n\n<p>In the Employee table the <code>EmployeeId</code> column is identity column.</p>\n\n<p>I run the entity model. Now, the view is showing correct data. The problem is when I see the view design in SQL, it is not showing.  When I remove the <code>row_number()</code> from the view, it is showing in the design of the view.</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13099101,"title":"SSIS Package Login failed while executing as Scheduled Job","body":"<p>I Have Created SSIS package which selects data from Source DB and Inserts it in my Destination DB. All the Connections string are Working fine as the Test Connection  is Succeeded when i debug the package.</p>\n\n<p><strong>My package Executes well when i run it in Visual Studio. But If i try to run it as Scheduled Job in SQL Server . It gives me error as</strong> <code>Data Flow Task ADO NET Source [1]  \"Login Failed for user 'ags' for Source Database\"</code> </p>\n\n<p>My Source DB is remotely Located.  </p>\n\n<p>Package Settings :</p>\n\n<pre><code>EncryptAllWithPassword\n</code></pre>\n\n<p>SQL Agent Settings</p>\n\n<pre><code>Owner : uagsrep (My SQL Server User)\nType : SQL Server Integration Service Package\nRun AS : SQL Server Agent Service Account\n</code></pre>\n\n<p>Database is SQL Server 2008</p>\n"},{"tags":["sql-server"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":7471,"score":0,"question_id":312576,"title":"How to simply generate the CREATE SQL script for a table and data?","body":"<p>So i'm used to PHPMySQL where if I want to transfer a table from one database to another, I:</p>\n\n<ul>\n<li>go to the table</li>\n<li>click \"export\"</li>\n<li>CTRL-C</li>\n<li>go to the other database, insert SQL, CTRL-V</li>\n</ul>\n\n<p>In MS SQL Server 2008 Express, I try:</p>\n\n<ul>\n<li>right-click, script table as, CREATE TO\n<ul>\n<li>but this only gives me the CREATE TABLE sql, not the INSERT INTO sql</li>\n</ul></li>\n<li>right-click, script table as, INSERT TO\n<ul>\n<li>this gives me INSERT TO sql but assumes that I am going to fill in the data (!)</li>\n</ul></li>\n<li>so I fire up the SQL Server 2008 Express Import/Export Data Wizard, but it doesn't seem to give me the simple CREATE/INSERT INTO script that I want either. :-(</li>\n</ul>\n\n<p>So how can I get a simple SQL dump of a table in MS SQL Server 2008 Express, the kind that PHPMySQL gives me:</p>\n\n<pre><code>-- phpMyAdmin SQL Dump\n-- version 2.11.9.2\n-- http://www.phpmyadmin.net\n--\n-- Host: localhost\n-- Generation Time: Nov 23, 2008 at 03:34 PM\n-- Server version: 5.0.67\n-- PHP Version: 5.2.6\n\nSET SQL_MODE=\"NO_AUTO_VALUE_ON_ZERO\";\n\n--\n-- Database: `test`\n--\n\n-- --------------------------------------------------------\n\n--\n-- Table structure for table `members`\n--\n\nCREATE TABLE IF NOT EXISTS `members` (\n  `id` int(11) NOT NULL auto_increment,\n  `firstName` varchar(50) collate latin1_general_ci NOT NULL,\n  `lastName` varchar(50) collate latin1_general_ci NOT NULL,\n  `age` int(11) NOT NULL,\n  PRIMARY KEY  (`id`)\n) ENGINE=MyISAM  DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci AUTO_INCREMENT=4 ;\n\n--\n-- Dumping data for table `members`\n--\n\nINSERT INTO `members` (`id`, `firstName`, `lastName`, `age`) VALUES\n(1, 'Jim', 'Taylor', 34),\n(2, 'John', 'McGregor', 23),\n(3, 'Alice', 'Anderson', 33);\n</code></pre>\n"},{"tags":["c#",".net","sql-server","ado.net",".net-3.0"],"answer_count":6,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":838,"score":0,"question_id":6889041,"title":"Parameterised DataTable Split","body":"<p>I wrote a method for splitting a DataTable into multiple small data tables; however I am getting exception. How do I correct it? Please share the code.</p>\n\n<p>Exception message:</p>\n\n<blockquote>\n  <p>This row already belongs to another table.</p>\n</blockquote>\n\n<p>Framework: .Net 3.0</p>\n\n<pre><code>private static List&lt;DataTable&gt; SplitDataTable(DataTable dt, int size)\n{\n    List&lt;DataTable&gt; split = new List&lt;DataTable&gt;();\n    DataTable current = dt.Clone();\n    int iterator = 0;\n    foreach (DataRow dr in dt.Rows)\n    {\n        iterator = iterator + 1;\n        if (iterator == size)\n        {\n            current = dt.Clone();\n            split.Add(current);\n            iterator = 0;\n        }\n        current.Rows.Add(dr);\n        //Exception: This row already belongs to another table.\n    }\n    return split;\n}\n</code></pre>\n\n<p>Client:</p>\n\n<pre><code>static void Main(string[] args)\n{\n    DataTable dt = new DataTable();\n    dt.Columns.Add(\"TEST\", typeof(int));\n    dt.Columns.Add(\"VAL\", typeof(string));\n    dt.Rows.Add(0,\"a\");\n    dt.Rows.Add(1,\"b\");\n    dt.Rows.Add(2,\"c\");\n    dt.Rows.Add(3,\"d\");\n\n    List&lt;DataTable&gt; split = SplitDataTable(dt, 2);\n}\n</code></pre>\n"},{"tags":["sql","sql-server","ms-access"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1415,"score":1,"question_id":3145270,"title":"select from access database file and insert to sql Database","body":"<p>I have an access database file (test.mdb) and I need to write a stored procedure which will select some records from tblTest in test.mdb and insert them into tbsqlTest in my sql database .\n==> I need a SP like this :</p>\n\n<pre><code>BEGIN\n    select * into tblTest from [test.mdb].[tblTest]\n    where (my condition)\nEND\n</code></pre>\n"},{"tags":["sql-server","tsql","sql-server-2008","ssms2008"],"answer_count":3,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":693,"score":5,"question_id":7207779,"title":"Scripts all Sprocs at once with DROP and CREATE","body":"<p>SQL Server 2008</p>\n\n<p><strong>Goal:</strong> To generate scripts for creating sprocs that are already in the DB. Must be one script per file.</p>\n\n<p>I know I can simply right click the database and 'Tasks>Generate Scripts', but that doesn't script the sproc in the template I want.</p>\n\n<p>I need the sproc to be scripted in the same template you get when you right click the sproc from the object explorer and 'Script Stored Procedure As>DROP and CREATE'.</p>\n\n<p>It's true you get a similar version of this through 'Tasks>Generate Scripts' but the main difference is the 'Tasks>Generate Scripts' method creates the script via the <code>dbo.sp_executesql</code> command because you cannot nest a <code>CREATE PROCEDURE</code> inside of an <code>IF</code> block</p>\n\n<p>Tasks>Generate produces this:</p>\n\n<pre><code>USE someDB\nGO\n\nIF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'somesproc') AND type in (N'P', N'PC'))\nDROP PROCEDURE someSproc\nGO\n\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nIF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'someSproc') AND type in (N'P', N'PC'))\nBEGIN\nEXEC dbo.sp_executesql @statement = N'-- =============================================\nCREATE PROCEDURE \nAS\nBEGIN\n\nEND\n' \nEND\nGO\n</code></pre>\n\n<p>But I require this (as found from right clicking the sproc):</p>\n\n<pre><code>USE someDB\nGO\n\nIF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'someSproc') AND type in (N'P', N'PC'))\nDROP PROCEDURE someSproc\nGO\n\nUSE someDB\nGO\n\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE PROCEDURE someSproc\n\nAS\nBEGIN\n    SET NOCOUNT ON;\n\nEND\n\nGO\n</code></pre>\n\n<p>Any ideas?</p>\n"},{"tags":["sql-server","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":2441,"score":6,"question_id":2429434,"title":"TSQL: grouping customer orders by week","body":"<p>I have a table with a collection of orders. The fields are:</p>\n\n<ul>\n<li><code>customerName</code> (text) </li>\n<li><code>DateOfOrder</code> (datetime).</li>\n</ul>\n\n<p>I would like to show totals of orders per week per customer. I would like to have it arranged for the Friday of each week so that it looks like this:</p>\n\n<pre><code>all dates follow mm/dd/yyyy\n\n\"bobs pizza\", 3/5/2010, 10\n\"the phone co\",3/5/2010,5\n\"bobs pizza\", 3/12/2010, 3\n\"the phone co\",3/12/2010,11\n</code></pre>\n\n<p>Could somebody please show me how to do this?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","database","microsoft"],"answer_count":7,"favorite_count":1,"up_vote_count":16,"down_vote_count":0,"view_count":2764,"score":16,"question_id":681282,"title":"How come the message \"Table is marked for deletion\" keeps appearing?","body":"<p>Using SQL Server 2008 and I'm doing some schema construction in the Management Studio designer.</p>\n\n<p>I created a table early in the process called \"Animal\", but then decided to delete shortly after. I deleted it via the tree view in Management Studio (right-click delete).</p>\n\n<p>Now I'm late in the process, I would like to recreate the table \"Animal\" but with different fields.</p>\n\n<p>The second time round with Animal gets created fine, but when I try to add the table to my diagram I get the message \"Table 'Animal' is marked for deletion, can't be added to the diagram or opened in the table designer\".</p>\n\n<p>What's the deal? How can I use this table normally again and not suffer from older table naming conflicts?</p>\n\n<p>Alternatively, if the table is marked for deletion, can I actually invoke deletion somehow? Then recreate another table with the same name.</p>\n\n<p>This is a little annoying. Would appreciate any help.</p>\n"},{"tags":["sql-server","xml","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":56,"score":4,"question_id":13096203,"title":"SQL Server .nodes() XML parent nodes by name","body":"<pre><code>    declare @xmlsample xml =\n'&lt;root&gt;\n    &lt;solution&gt;\n        &lt;solutionnumber&gt;1&lt;/solutionnumber&gt;\n            &lt;productgroup&gt;\n                &lt;productcategory&gt;\n                    &lt;price&gt;100&lt;/price&gt;\n                    &lt;title&gt;Some product&lt;/title&gt;\n                    &lt;tax&gt;1&lt;/tax&gt;\n                &lt;/productcategory&gt;\n            &lt;/productgroup&gt;\n            &lt;productcategory2&gt;\n                    &lt;price&gt;200&lt;/price&gt;\n                    &lt;title&gt;Some other product&lt;/title&gt;\n                    &lt;tax&gt;2&lt;/tax&gt;\n            &lt;/productcategory2&gt;\n    &lt;/solution&gt;\n    &lt;solution&gt;\n        &lt;solutionnumber&gt;2&lt;/solutionnumber&gt;\n            &lt;productcategory2&gt;\n                    &lt;price&gt;200&lt;/price&gt;\n                    &lt;title&gt;Some other product&lt;/title&gt;\n                    &lt;tax&gt;2&lt;/tax&gt;\n            &lt;/productcategory2&gt;\n    &lt;/solution&gt;\n&lt;/root&gt;'\n\nSELECT \n    --T.C.value('(./ancestor::ns1:solutionNumber)[1]', 'varchar(50)') AS solutionnumber ?? no clue\n    T.C.value('(price)[1]', 'numeric(18,2)') AS price\n    ,T.C.value('(title)[1]', 'varchar(50)') AS title\n    ,T.C.value('(tax)[1]', 'numeric(18,2)') AS tax\nFROM @xmlsample.nodes('//node()[title]') AS T(C)\n</code></pre>\n\n<p>A representation of the XML I am attempting to shred in SQL Server 2008 r2. I find the \"title\" node and grab the values I need that are in the product category. Now I would like to get the \"solution number\" however this could be one or more parent nodes above the product as there are certain product \"groups.\"</p>\n\n<p>How would I go about check the parent nodes by name (\"solutionnumber\") until I find it? Thanks for any assistance.</p>\n"},{"tags":["sql-server","vb.net","loops"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2666,"score":0,"question_id":5402934,"title":"Loading data from SQL Server row by row to textboxes","body":"<p>I am trying to retrieve data row by row from my SQL Server and load them into my respective textboxes, I was doing the below code but of course it doesn't work as the For Each loop will load every single textboxes with each data retrieved, ran out of ideas. Appreciate if someone can give me a boost here. Thanks.</p>\n\n<pre><code>Private Sub retrieve_Data()\n        Dim con As New SqlConnection\n        Dim cmd As New SqlCommand\n\n        Try\n            con.ConnectionString = \"Data Source=HPEnvy-HP; Initial Catalog=Cinema; User Id=&lt;id&gt;; Password=&lt;password&gt;;\"\n            con.Open()\n            cmd.Connection = con\n\n            cmd.CommandText = \"SELECT [movie_ID], [movie_Title] FROM [Movie_Table] ORDER BY [MOVIE_ID] \"\n\n            Dim lrd As SqlDataReader = cmd.ExecuteReader()\n\n            While lrd.Read()\n\n                Dim reader As String = lrd(1).ToString\n                Dim arrLoad As New ArrayList\n\n\n                arrLoad.Add(lrd(1).ToString)\n                For i = 0 To arrLoad.Count - 1\n                    For Each cCtrl As Control In Panel1.Controls\n                        If TypeOf cCtrl Is TextBox Then\n                            Dim txtBox As New TextBox\n                            txtBox = cCtrl\n                            txtBox.Text = arrLoad.Item(i)\n                        End If\n                    Next\n                Next\n    End While\n\n        Catch ex As Exception\n            MessageBox.Show(\"Error while retrieving records on table...\" &amp; ex.Message, \"Load Records\")\n        Finally\n            con.Close()\n        End Try\n    End Sub\n</code></pre>\n"},{"tags":[".net","sql","sql-server","debugging","sqlclr"],"answer_count":1,"favorite_count":0,"up_vote_count":10,"down_vote_count":1,"view_count":464,"score":9,"question_id":8449161,"title":"SQL CLR Debugging getting \"Canceled by user\"","body":"<p>When I'm trying to debug a SQL CLR via a SQL Test script in VS2010 (with MSSQL 2008) I get \"Canceled by user\" in the Debug output window as soon the deployment finish (which is successful.)</p>\n\n<p>I have been up and down the Internet and tried all found solutions and still no go.</p>\n\n<p>System:</p>\n\n<blockquote>\n  <p>Windows Server 2008 R2 Standard SP 1<br>\n  64 bit Visual Studio 2010<br>\n  Ultimate SQL Server 2008 R2 (Both running on the same computer)</p>\n</blockquote>\n\n<p>Steps taken:</p>\n\n<ul>\n<li>VS 2010 is run as administrator.</li>\n<li>SQL Connection User has sysadmin rights on SQL 2008</li>\n<li>Firewall is set up to allow inbound on the required ports for both VS 2010 and SQL 2008</li>\n</ul>\n\n<p>Been through: <a href=\"http://msdn.microsoft.com/en-us/library/ms165051.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms165051.aspx</a></p>\n\n<p>And: <a href=\"http://msdn.microsoft.com/en-us/library/ee828498.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ee828498.aspx</a></p>\n\n<p>Tried set set Target Framework to 2.0 (from 3.5)</p>\n\n<p>Tried unchecked \"Deploy code\" in Project Properties under \"Deploy\" section.</p>\n\n<p>Under Database in Project Properties is set to \"Unsafe\" and Assembly owner to \"dbo\".</p>\n"},{"tags":["c#","sql-server","database","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":215,"score":3,"question_id":12292644,"title":"Speed up update of 185k rows in SQL Server 2008?","body":"<p>I have a binary file with about <strong>185k</strong> rows in it. <code>C#</code> parses file in seconds. What would be the best way to update <code>MSSQL</code> table with that data?</p>\n\n<p>What I've tried:</p>\n\n<ol>\n<li>Easiest way - read binary row, parse, update table. The whole process takes around 2 days to update all the data.</li>\n<li>Combine 200 update queries and send them at once to the MSSQL. In this case, update takes 8 to 10 hrs.</li>\n<li>Combine 500+ queries into single one. Works faster, but drops timeout exceptions time to time, so some updates are not going through.</li>\n</ol>\n\n<p>Any advice on how to speed up the update process?</p>\n"},{"tags":["sql-server","nhibernate","caching","common-table-expression"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13092464,"title":"Caching Common Table Expressions (CTE) queries in NHibernate","body":"<p>I have a table holding hierarchical data that I am querying for from my web app using NHibernate. It's pretty straight forward</p>\n\n<pre><code>CREATE TABLE [dbo].[Relationships](\n    [RelationshipId] [uniqueidentifier] NOT NULL,\n    [ParentId] [uniqueidentifier] NULL,\n    [ParentTypeId] [uniqueidentifier] NULL,\n    [ChildId] [uniqueidentifier] NOT NULL,\n    [ChildTypeId] [uniqueidentifier] NOT NULL\n)\n</code></pre>\n\n<p>Now to query information from this table I'm using a feature of SQL Server (since 2005) called Common Table Expressions, or CTE for short. It lets me write recursive queries which are extremely useful for table like the one above.</p>\n\n<pre><code>WITH Ancestors(RelationshipId, ParentId, ChildId) \nAS \n(\n    SELECT r.RelationshipId, r.ParentId, r.ChildId \n        FROM Relationships r \n        WHERE ChildId = :objectId \n    UNION ALL \n    SELECT r.RelationshipId, r.ParentId, r.ChildId \n        FROM Relationships r \n            INNER JOIN Ancestors \n                ON Ancestors.ParentId = r.ChildId \n) \nSELECT RelationshipId, ParentId, ChildId FROM Ancestors\n</code></pre>\n\n<p>Now, this is great and the performance isn't that bad but it can be taxing when I try to use this to determine ancestors going up the tree, or worse, using a similar query to determine decendants.</p>\n\n<p>Now I'd like to simply cache the results from this query but I'm getting an error from nHibernate <code>Index was outside the bounds of the array.</code> if I have <code>.SetCacheable(true)</code>. If I remove the cache support the query works fine.</p>\n\n<p>The query works fine if I remove the caching support from my call to <code>Session.CreateSQLQuery()</code> Now I've looked online to try and find a cause but I haven't found a consensus amongst the results I found.</p>\n\n<p>So while I am curios <strong>why</strong> it doesn't work, I'm more interested in finding a workaround to get caching to work with my CTE in nHibernate?</p>\n"},{"tags":["sql-server","tsql","indexing","reverse-engineering"],"answer_count":16,"favorite_count":27,"up_vote_count":45,"down_vote_count":0,"view_count":90233,"score":45,"question_id":765867,"title":"List of all index & index columns in SQL Server DB","body":"<p>How do I get a list of all index &amp; index columns in SQL Server 2005+? The closest I could get is:</p>\n\n<pre><code>select s.name, t.name, i.name, c.name\n from sys.tables t\ninner join sys.schemas s on t.schema_id = s.schema_id\ninner join sys.indexes i on i.object_id = t.object_id\ninner join sys.index_columns ic on ic.object_id = t.object_id\n\tinner join sys.columns c on c.object_id = t.object_id and\n\t\tic.column_id = c.column_id\n\nwhere i.index_id &gt; 0    \nand i.type in (1, 2) -- clustered &amp; nonclustered only\nand i.is_primary_key = 0 -- do not include PK indexes\nand i.is_unique_constraint = 0 -- do not include UQ\nand i.is_disabled = 0\nand i.is_hypothetical = 0\nand ic.key_ordinal &gt; 0\n\norder by ic.key_ordinal\n</code></pre>\n\n<p>which is not exactly what I want. What I want is to list all user-defined indexes (which means no indexes which support unique constraints &amp; primary keys) with all columns (ordered by how do they apper in index definition) plus as much metadata as possible.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","csv"],"answer_count":7,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":7821,"score":3,"question_id":5611715,"title":"Where value in column containing comma delimited values","body":"<p>Hi I am wondering how to write an SQL statement for SQL Server 2008 that Selects entry's where a column contains a value, now the value within the column is a comma delimited list (usually - there could only be one entry (and no leading comma)) so what In checking for is \"is this value contained somewhere within the list?\", for instance:</p>\n\n<pre><code>COLUMN = Cat, Dog, Sparrow, Trout, Cow, Seahorse\nDoes COLUMN contain Cat? YES\nDoes COLUMN contain horse? NO\nDoes COLUMN contain Sheep? NO\n</code></pre>\n\n<p>or</p>\n\n<pre><code>COLUMN = Mouse\nDoes COLUMN contain Hare? NO\nDoes COLUMN contain Mouse? YES\n</code></pre>\n\n<p>etc</p>\n\n<p>I was thinking I could use the 'IN' keyword as such</p>\n\n<pre><code>SELECT id_column FROM table_name WHERE 'Cat' IN COLUMN\n</code></pre>\n\n<p>but this does not work as it seems that you can only use that to check if a column contains one of a series of comma delimited values.</p>\n\n<p>I also cannot use CONTAINS() OR 'LIKE' as this, in the above example would return values for 'horse' as the whole string contains horse in 'Seahorse', and I can't search for the needle plus a comma (if I'm looking for 'horse' the search would be 'horse,') as what if the entry is at the end of a the list?  And I can't search for a comma plus a needle (if I'm looking for 'horse' the search would be ',horse')\nas what if the entry is the first in the list? And I can't use both as what if the entry is the only (single) entry?</p>\n\n<p>Thanks for any help anyone can give.</p>\n\n<p>Cheers.</p>\n"},{"tags":["sql","sql-server","database-design","view"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13104586,"title":"SQLServer - Error when trying to update view - Cannot as would update base tables","body":"<p>Can someone help in regards to this SQL problem. I have a database I have constructed. it tracks sporting events and so in it has a table for seasons(years), rounds(1 to 26) a draw tables which aims to show how many teams play each round in each season. I separated the seasons and rounds from draws to reduce the replication of having 8 round 1, 2...</p>\n\n<p>So now I created a view to attempt to add a season of draws in. However I receive this error that I cannot update as it affects base tables. </p>\n\n<p><img src=\"http://i.stack.imgur.com/ZiYi3.png\" alt=\"SQLServer Round View\"></p>\n\n<p>this is my view</p>\n\n<pre><code>USE [NRL_DataMartDesign]\nGO\n\n/****** Object:  View [dbo].[RoundGames]    Script Date: 10/28/2012 08:58:02 ******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE VIEW [dbo].[RoundGames]\nAS\nSELECT     dbo.Draw.Date, dbo.Draw.HomeTeam, dbo.Draw.AwayTeam, dbo.Venue.VenueName, dbo.SeasonRound.RoundID, dbo.Round.RoundNumber\nFROM         dbo.Draw INNER JOIN\n                      dbo.Venue ON dbo.Draw.VenueFk = dbo.Venue.VenueID INNER JOIN\n                      dbo.Round ON dbo.Draw.RoundNumberFk = dbo.Round.RoundID INNER JOIN\n                      dbo.SeasonRound ON dbo.Round.RoundID = dbo.SeasonRound.RoundID\n\nGO\n</code></pre>\n\n<p>This is my tables\n<strong>Draw</strong></p>\n\n<pre><code>CREATE TABLE [dbo].[Draw](\n    [DrawId] [int] IDENTITY(1,1) NOT NULL,\n    [RoundNumberFk] [int] NULL,\n    [HomeTeam] [nchar](20) NULL,\n    [AwayTeam] [nchar](20) NULL,\n    [VenueFk] [int] NULL,\n    [Date] [datetime] NULL,\n    [TeamListFk] [int] NULL,\n CONSTRAINT [PK_Draw] PRIMARY KEY CLUSTERED \n(\n</code></pre>\n\n<p><strong>Round</strong></p>\n\n<pre><code>CREATE TABLE [dbo].[Round](\n    [RoundID] [int] IDENTITY(1,1) NOT NULL,\n    [RoundNumber] [smallint] NULL,\n CONSTRAINT [PK_Round] PRIMARY KEY CLUSTERED \n(\n</code></pre>\n\n<p><strong>SeasonRound</strong></p>\n\n<pre><code>CREATE TABLE [dbo].[SeasonRound](\n    [SeasonID] [int] NOT NULL,\n    [RoundID] [int] NOT NULL\n) ON [PRIMARY]\n\nGO\n\nALTER TABLE [dbo].[SeasonRound]  WITH CHECK ADD  CONSTRAINT [FK_SeasonRound_Round] FOREIGN KEY([RoundID])\nREFERENCES [dbo].[Round] ([RoundID])\nGO\n\nALTER TABLE [dbo].[SeasonRound] CHECK CONSTRAINT [FK_SeasonRound_Round]\nGO\n\nALTER TABLE [dbo].[SeasonRound]  WITH CHECK ADD  CONSTRAINT [FK_SeasonRound_Season] FOREIGN KEY([SeasonID])\nREFERENCES [dbo].[Season] ([SeasonId])\nGO\n\nALTER TABLE [dbo].[SeasonRound] CHECK CONSTRAINT [FK_SeasonRound_Season]\nGO\n</code></pre>\n\n<p><strong>Venue</strong></p>\n\n<pre><code>CREATE TABLE [dbo].[Venue](\n    [VenueID] [int] IDENTITY(1,1) NOT NULL,\n    [VenueName] [varchar](50) NULL,\n    [State] [varchar](25) NULL,\n    [Capacity] [int] NULL,\n    [HomeTeam] [int] NULL,\n CONSTRAINT [PK_Venue] PRIMARY KEY CLUSTERED \n(\n</code></pre>\n\n<p>Can anyone provide any assistance as to what I am doing wrong here?</p>\n\n<p>Edit: it appears from the comments the better question would be\" What is the best way to add data to the database using these tables\" As this is what I am trying to achieve .</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","common-table-expression","nearest-neighbor"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13103097,"title":"SQL Server : generating nearest neighbour routes","body":"<p>Having a little trouble with generating routes using a nearest neighbour methodology with SQL Server in T-SQL. </p>\n\n<p><strong>Note:</strong> Using SQL Server 2008, I do not have access to spatial extensions.</p>\n\n<p><strong>Background:</strong></p>\n\n<p>I have a query, which through a series of loops and loops within loops builds routes, however, this query can take in excess of 10 minutes to traverse over 100+ visits.</p>\n\n<p>I have a working system, but I would like to bring the execution time down. Trying to minimise loops as they seem to kill performance. I recently stumbled on CTEs and they have been wonderful for my optimisation so far.</p>\n\n<p>I have the following table populated with all the visits that I have over a given period:</p>\n\n<pre><code>DECLARE @Visits TABLE \n(\n    Unique_ID int identity(1,1), \n    Location_ID int, \n    Day_ID int, \n    Lat float, \n    Long float\n)\n</code></pre>\n\n<p>And I have built a legend of all possible paths per day using:</p>\n\n<pre><code>DECLARE @VisitLegend TABLE  \n(\n    Day_ID int, \n    locationFromId int, \n    locationToId int, \n    distance float\n)\n\nINSERT INTO @VisitLegend (dayId, locationFromId , locationToId , distance)\nSELECT \nv1.Day_ID,\nv1.Unique_ID, \nv2.Unique_ID, \n[dbo].[udf_Distance_Between] (v1.Lat, v1.Long, v2.Lat, v2.Long)\nFROM @Visits v1\nJOIN @Visits v2 on v1.Unique_ID &lt;&gt; v2.Unique_ID \n         AND v1.Current_Day_ID = v2.Current_Day_ID \n         AND NOT (v1.Unique_ID = v2.Unique_ID and v2.Unique_ID = v1.Unique_ID)\n</code></pre>\n\n<p><strong>Question:</strong></p>\n\n<p>Is there a way where I can step through each visit in the <code>@Visits</code> table, traverse the <code>@Visit</code> Legend table by the shortest distance without going to the same visit twice ?</p>\n\n<p>I did make a stab at using a CTE with recursion, however my problem is that I cannot prevent it from selecting a visit again further up the tree, nor can I limit the recursive subset to the smallest distance without trying to use an aggregate or a joined subquery which would only work with references to the parent query.</p>\n\n<p>My current attempt was:</p>\n\n<pre><code>;WITH pathBuilder(dayId, nodeId, distance) AS\n(\n    SELECT Day_ID, Unique_ID, CAST(0.0 as float)\n    FROM @Visits \n        UNION ALL\n    SELECT pb.dayId, vl.locationToId, vl.distance\n    FROM pathBuilder pb\n    JOIN @VisitLegend vl on vl.dayId = pb.dayId \n        and vl.locationFromId = pb.locationId \n)\nSELECT * FROM pathBuilder\n</code></pre>\n\n<p>However I cannot seem to get this to select the locations from the visits table, then step through each in the legend following the shortest and never going back to a <code>visitLocationId</code> that it has already visited.</p>\n\n<p><strong>Intended result:</strong></p>\n\n<p><code>@VisitLegend</code> has the following:</p>\n\n<pre><code>dayId       locationFromId locationToId distance\n----------- -------------- ------------ -----------\n1           1              2            5\n1           1              3            4\n1           2              1            5\n1           2              3            7\n1           3              1            4\n1           3              2            7\n</code></pre>\n\n<p>Which would produce the sequences: </p>\n\n<pre><code>1, 3, 2\n2, 1, 3\n3, 1, 2\n</code></pre>\n\n<p>Any ideas ? Been banging my head against the wall for quite some time on this.</p>\n\n<p>Otherwise is it a case of just using loops and bearing with the execution time?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13104356,"title":"Display varbinary as a downloadable link","body":"<p>Fairly straightforward question, I have images stored in my database as varbinary and would like to provide a link to these images rather than displaying them on the website. When a user clicks the link he/she should be able to download the image.  </p>\n"},{"tags":["sql-server","sql-server-2005","encryption","symmetric-key"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3408,"score":3,"question_id":209927,"title":"SQL Server 2005 - Restoring an encrypted DB on a different server","body":"<p>I have backed up an encrypted DB (symmetric key/certificate) and \nrestored it on a different server. </p>\n\n<p>Unfortuantely we're having problems with the decryption... hoping \nsomeone can help. </p>\n\n<p>In the restored db, I can see the Symmetric Key and the Certificate in \nSSMS, but when I try to Open the key using the cert ( open symmetric \nkey KeyA decryption by certificate CertB )I get the \nfollowing <em>very descriptive</em> error: </p>\n\n<p>Msg 15466, Level 16, State 1, Line 1 \nAn error occurred during decryption. </p>\n\n<p>Any ideas?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["asp.net","sql-server","vb.net","web-config"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13104267,"title":"MSDataShape SQL Provider connection string in ASP.net web.config file","body":"<p>My application requires the use of the MSDataShape SQL Provider and I want to store the connection string in my web.config file.</p>\n\n<p>My DataShape connection string works when I hardcode the connection string as follows:</p>\n\n<blockquote>\n  <p><code>Dim _sqlConnection As OleDbConnection = New OleDbConnection(\"Provider=MSDataShape;Data Provider=SQLOLEDB;Data Source=.;Initial Catalog=XXX;Password=XXX;PASSWORD=XXX;Persist Security Info=True;User ID=XXX;User Id=XXX;\")</code></p>\n</blockquote>\n\n<p>However, the \"connectionString\" attribute in the web.config \"add\" tag does not accept the keyword \"provider\", where MSDataShape is specified, and I do not know what to put in the \"providerName\" attribute (e.g System.Data.OleDb).</p>\n\n<p>Any help would be appreciated.</p>\n"},{"tags":["sql-server"],"answer_count":8,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1593,"score":2,"question_id":481954,"title":"SQL server DB restored.Login failed error","body":"<p>Dear TEchies,\nI have restored one db back up to my SQL server. I have an ASP program which is accessing the db.When i am running this ,i am getting an error login failed for this user.What exactly i have to do for this ??</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1373,"score":0,"question_id":10918142,"title":"Could not load file or assembly 'Microsoft.SqlServer.DTSRuntimeWrap'","body":"<p>I can't figure out why I'm getting this error when I run my application (MVC 3).  The project has a reference to Microsoft.SQLServer.ManagedDTS.  I have both SQL Server 2008 R2 and SQL Server 2012 (both Express) installed.  I'm using 2012 with this application.</p>\n\n<pre><code>Server Error in '/' Application.\n\nCould not load file or assembly 'Microsoft.SqlServer.DTSRuntimeWrap' or one of its dependencies. An attempt was made to load a program with an incorrect format.\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \n\nException Details: System.BadImageFormatException: Could not load file or assembly 'Microsoft.SqlServer.DTSRuntimeWrap' or one of its dependencies. An attempt was made to load a program with an incorrect format.\n\nSource Error: \n\nAn unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.\n\nAssembly Load Trace: The following information can be helpful to determine why the assembly 'Microsoft.SqlServer.DTSRuntimeWrap' could not be loaded.\n\n\nWRN: Assembly binding logging is turned OFF.\nTo enable assembly bind failure logging, set the registry value [HKLM\\Software\\Microsoft\\Fusion!EnableLog] (DWORD) to 1.\nNote: There is some performance penalty associated with assembly bind failure logging.\nTo turn this feature off, remove the registry value [HKLM\\Software\\Microsoft\\Fusion!EnableLog].\n\nStack Trace: \n\n\n[BadImageFormatException: Could not load file or assembly 'Microsoft.SqlServer.DTSRuntimeWrap' or one of its dependencies. An attempt was made to load a program with an incorrect format.]\n   System.Reflection.RuntimeAssembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks) +0\n   System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection, Boolean suppressSecurityChecks) +567\n   System.Reflection.RuntimeAssembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection) +192\n   System.Reflection.Assembly.Load(String assemblyString) +35\n   System.Web.Configuration.CompilationSection.LoadAssemblyHelper(String assemblyName, Boolean starDirective) +123\n\n[ConfigurationErrorsException: Could not load file or assembly 'Microsoft.SqlServer.DTSRuntimeWrap' or one of its dependencies. An attempt was made to load a program with an incorrect format.]\n   System.Web.Configuration.CompilationSection.LoadAssemblyHelper(String assemblyName, Boolean starDirective) +11568160\n   System.Web.Configuration.CompilationSection.LoadAllAssembliesFromAppDomainBinDirectory() +485\n   System.Web.Configuration.AssemblyInfo.get_AssemblyInternal() +79\n   System.Web.Compilation.BuildManager.GetReferencedAssemblies(CompilationSection compConfig) +337\n   System.Web.Compilation.BuildManager.CallPreStartInitMethods() +280\n   System.Web.Hosting.HostingEnvironment.Initialize(ApplicationManager appManager, IApplicationHost appHost, IConfigMapPathFactory configMapPathFactory, HostingEnvironmentParameters hostingParameters, PolicyLevel policyLevel, Exception appDomainCreationException) +1167\n\n[HttpException (0x80004005): Could not load file or assembly 'Microsoft.SqlServer.DTSRuntimeWrap' or one of its dependencies. An attempt was made to load a program with an incorrect format.]\n   System.Web.HttpRuntime.FirstRequestInit(HttpContext context) +11700896\n   System.Web.HttpRuntime.EnsureFirstRequestInit(HttpContext context) +141\n   System.Web.HttpRuntime.ProcessRequestNotificationPrivate(IIS7WorkerRequest wr, HttpContext context) +4869125\n</code></pre>\n"},{"tags":["sql-server","visual-studio","iis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":13094128,"title":"Local IIS Web server cannot connect to SQL Server","body":"<p>When I use the local IIS Web server, my ASP.NET MVC application is unable to connect to SQL Server. The database is on another server. However, if I use the Visual Studio Development Server, it works just fine.</p>\n\n<p>Anyone know what settings I'm missing? Should something change in my Web.config?\nYes, TCP/IP is enabled on SQL Server.</p>\n\n<p>Here is the error I get -</p>\n\n<pre><code>A network-related or instance-specific error occurred while establishing a \nconnection to SQL Server. The server was not found or was not accessible. \nVerify that the instance name is correct and that SQL Server is configured \nto allow remote connections. (provider: Named Pipes Provider, error: 40 - Could \nnot open a connection to SQL Server)\n</code></pre>\n\n<p>Here is my connection string - </p>\n\n<pre><code>connectionString=\"SERVER=servername;Initial Catalog=dbname;User ID=userid;Password=passwd\" providerName=\"System.Data.SqlClient\"\n</code></pre>\n"},{"tags":["c#","sql-server","linq"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13099329,"title":"Filling Drop down list based on name","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13090398/avoid-duplicate-names-in-a-dataset\">Avoid duplicate names in a dataset</a>  </p>\n</blockquote>\n\n\n\n<p>I am fetching data from a table and binding to a label and Drop down in a gridview but i want to filter the duplicate names from the table and assign the corresponding dates to the DDL how can do this? or else is there any other alternative?</p>\n\n<p>How to bind the DDL based on label name??</p>\n\n<p><img src=\"http://i.stack.imgur.com/kExj4.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","datetime","date-range"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":13099364,"title":"SQL Server : fetching records between two dates?","body":"<p>In SQL I write a <code>SELECT</code> statement to fetch data between two dates, using <code>between and</code> </p>\n\n<p>Ex:</p>\n\n<pre><code>select * \nfrom xxx \nwhere dates between '2012-10-26' and '2012-10-27'\n</code></pre>\n\n<p>But the rows returned are for 26th only, not 26th and 27th.</p>\n\n<p>Can you help me? Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","query-optimization"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13099463,"title":"Query Optimizing Request","body":"<p>I am very sorry if this question is structured in not a very helpful manner or the question itself is not a very good one!</p>\n\n<p>I need to <code>update</code> a <code>MSSQL</code> <code>table</code> call <code>component</code> every 10 minutes based on information from another <code>table</code> call <code>materials_progress</code></p>\n\n<p>I have nearly 60000 records in <code>component</code> and more than 10000 records in <code>materials_progress</code></p>\n\n<p>I wrote an <code>update query</code> to do the job, but it takes longer than 4 minutes to complete execution!\nHere is the <code>query</code> : </p>\n\n<pre><code>UPDATE component \nSET stage_id = \nCASE \n    WHEN t.required_quantity &lt;= t.total_received THEN 27\n    WHEN t.total_ordered &lt; t.total_received THEN 18\n    ELSE 18\nEND\nFROM\n    (\n    SELECT \n        mp.job_id,  \n        mp.line_no,  \n        mp.component,  \n        l.quantity AS line_quantity, \n        CASE WHEN mp.component_name_id = 2 THEN l.quantity*2\n            ELSE l.quantity\n        END AS required_quantity,\n        SUM(ordered) AS total_ordered, SUM(received) AS total_received ,\n        c.component_id \n    FROM line l \n    LEFT JOIN component c ON c.line_id = l.line_id\n    LEFT JOIN materials_progress mp ON l.job_id = mp.job_id AND l.line_no = mp.line_no AND c.component_name_id = mp.component_name_id \n    WHERE \n        mp.job_id IS NOT NULL  \n        AND (mp.cancelled IS NULL OR mp.cancelled = 0)\n        AND (mp.manual_override IS NULL OR mp.manual_override = 0)\n        AND c.stage_id = 18\n    GROUP BY  mp.job_id,  mp.line_no,  mp.component, l.quantity, mp.component_name_id, component_id\n    ) AS t\n\nWHERE \n    component.component_id = t.component_id\n</code></pre>\n\n<p>I am not going to explain the scenario as it too complex.. could somebody please please tell me what makes this query this much expensive and a way to get around it?</p>\n\n<p>Thank you very very much in advance!!!</p>\n\n<p>Edit 1:\nHere is the execution plan;\n<img src=\"http://i.stack.imgur.com/xNgxe.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","query","sql-server-2008-r2","sql-function"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13103353,"title":"How to create a nullable record in SQL Server 2008 R2?","body":"<p>I create a <code>Inline table function</code> in SQL Server 2008 R2, and I realized some queries return any record. So I'd like when that happens, returns a record with all the empty columns.</p>\n\n<p>By example:</p>\n\n<pre><code>Col1   Col2   Col3\nNULL   NULL   NULL\n</code></pre>\n\n<p>UPDATE: Here is the function</p>\n\n<pre><code>ALTER FUNCTION [dbo].[GetWorksheetSummaryByObjective](@objectiveId [smallint], @testTemplateId [smallint])\nRETURNS @resultTable TABLE (\n    [AnsweredWorksheetId] [smallint] NOT NULL,\n    [LastDate] [date] NULL,\n    [BestScore] [smallint] NULL,\n    [ShouldBeMakeUp] [tinyint] NOT NULL\n)\nAS \nBEGIN\n\n    INSERT @resultTable\n    SELECT TOP 1 B.Id AS AnsweredWorksheetId, A.Date, CONVERT(smallint, B.Score * 100),\n        CASE\n        WHEN B.Score &gt;= 0.7 THEN 0\n        ELSE 1\n        END AS ShouldBeMakeUp\n    FROM AnsweredTest AS A\n    RIGHT JOIN AnsweredWorksheet AS B ON (A.Id = B.AnsweredTestId)\n    WHERE B.ObjectiveId = @objectiveId AND A.ExamTemplateId = @testTemplateId\n    ORDER BY B.Score DESC\n\n    RETURN\nEND\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","view","primary-key"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13100088,"title":"How to add a new column (as a primary key column ) to view","body":"<p>Is it possible to add the column (PK) to view. if yes..How can we?</p>\n\n<p>This is my view :</p>\n\n<pre><code>CREATE VIEW [dbo].[SalesDetailView]\nAS\nSELECT\n    DATENAME(yyyy, SH.CreatedDateTime) AS Year,\n    DATENAME(mm, SH.CreatedDateTime) AS Month, SH.CreatedDateTime AS Date,\n    SH.TransactionName AS Type, SH.SalesHeaderID AS No,\n    Customer.CustomerName AS Customer,\n    CustomerGroup.CustomerGroupName AS Customer_Group, SH.Reference AS Memo,\n    Item.ItemName AS Item, SD.LineDescription AS Item_Description,\n    Item.ItemType AS Item_Type, Item.UOM,\n    ItemGroup.ItemGroupName AS Item_Group,\n    CAST (SD.Quantity AS INT) AS Quantity, CAST(SD.Amount AS MONEY) AS Amount,\n    SD.Price, SD.Discount, SH.ExchangeRate AS Exchange_Rate,\n    Currency.CurrencyDescription AS Currency, SD.ClassID AS Class_ID,\n    SD.SalesTaxID AS SalesTax_ID, SalesTaxGroup.SalesTaxGroupName AS Tax_Group,\n    Employee.EmployeeName AS Salesperson,\n    ShippingMethod.ShippingMethodName AS Shipping_Method,\n    PaymentTerm.PaymentTermName AS Payment_Term,\n    PaymentMethod.PaymentMethodName AS Payment_Method\nFROM\n    SalesHeader SH, Customer\nLEFT OUTER JOIN \n    SalesDetail SD ON SH.SalesHeaderID = SD.SalesHeaderID\nLEFT OUTER JOIN \n    Item ON SD.ItemID = Item.ItemID\nLEFT OUTER JOIN \n    ItemGroup ON Item.ItemGroupId = ItemGroup.ItemGroupID\nLEFT OUTER JOIN \n    CustomerGroup ON Customer.CustomerGroupId = CustomerGroup.CustomerGroupID\nLEFT OUTER JOIN \n    Employee ON Customer.EmployeeID = Employee.EmployeeID\nLEFT OUTER JOIN \n    Currency ON Customer.CurrencyID = Currency.CurrencyID\nLEFT OUTER JOIN \n    SalesTaxGroup ON Customer.SalesTaxGroupID = SalesTaxGroup.SalesTaxGroupID\nLEFT OUTER JOIN \n    PaymentTerm ON Customer.PaymentTermID = PaymentTerm.PaymentTermID\nLEFT OUTER JOIN \n    ShippingMethod ON Customer.ShippingMethodID = ShippingMethod.ShippingMethodID\nLEFT OUTER JOIN \n    PaymentMethod ON Customer.PaymentMethodID = PaymentMethod.PaymentMethodID\nWHERE\n    SH.CustomerID = Customer.CustomerID\n    AND SH.TransactionName &lt;&gt; 'SalesOrder'\n    AND Sh.TransactionName &lt;&gt; 'Quote'\n</code></pre>\n"},{"tags":["php","sql-server","database","linux"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13103480,"title":"How to connect to a remote MSSQL database with PHP on Linux?","body":"<p>I've got a problem and there doesn't seem to be a strait forward solution.</p>\n\n<p>I'm running a Linux server with PHP and need to connect to a MSSQL database on a remote server (I don't have control over this server). Speaking to my host, they say that it's not possible eto install the MSSQL extensions on a linux box as they are only available on Windows Servers. So, I'm looking to see what other options i have.</p>\n\n<p>Any ideas how I can do this on a linux box?!</p>\n"},{"tags":["sql-server","tsql","variables"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":13103264,"title":"TSQL: Find declared length of a variable","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/9686525/data-type-size-of-variable-in-sql\">Data type size of variable in sql</a>  </p>\n</blockquote>\n\n\n\n<p>Can you find the declared max length of a variable using <code>T-SQL</code>?</p>\n\n<p>For example: </p>\n\n<pre><code>DECLARE @myVar varchar(123) \n</code></pre>\n\n<p>-- How can I find the max length of <code>@myVar</code> would be 123?</p>\n"},{"tags":["java","sql","sql-server","jdbc","resultset"],"answer_count":5,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":8148,"score":5,"question_id":7886462,"title":"Get row count of a resultset in java","body":"<p>I'm trying to create a simple method that excepts a ResultSet as a parameter and sends back an int that contains the row count of the ResultSet. Is this a valid way of doing this or not so much?</p>\n\n<pre><code>int size = 0;\n    try {\n        while(rs.next()){\n            size++;\n        }\n    }\n    catch(Exception ex) {\n        System.out.println(\"------------------Tablerize.getRowCount-----------------\");\n        System.out.println(\"Cannot get resultSet row count: \" + ex);\n        System.out.println(\"--------------------------------------------------------\");\n    }\n</code></pre>\n\n<p>I tried this:</p>\n\n<pre><code>int size = 0;\ntry {\n    resultSet.last();\n    size = resultSet.getRow();\n    resultSet.beforeFirst();\n}\ncatch(Exception ex) {\n    return 0;\n}\nreturn size;\n</code></pre>\n\n<p>But I got an error saying <strong>\"com.microsoft.sqlserver.jdbc.SQLServerException: The requested operation is not supported on forward only result sets.\"</strong></p>\n\n<p>Thanks in advance for the pointers!</p>\n"},{"tags":["php","sql-server"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":840,"score":1,"question_id":6846052,"title":"Problem printing MSSQL datetime to html using PHP (sqlsrv extension)","body":"<p>I've got a flexible block of code that allows me to print the results of a query to a simple html table.  However, when that table contains a field of type 'datetime', the print() function doesn't work and my loop ends.</p>\n\n<p>In the past, using PHP and MySQL (as opposed to Microsoft SQL Server, which is what I'm using now) printing the date was no problem, so I'm not sure what I'm missing now.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>// $row is the current row.\n// $nkeys is the array of (String) keys that correspond to columns in the table.\ndo {\n    print (\"&lt;tr&gt;\\n\");\n    foreach($nkeys as $k) {\n        echo (\"&lt;td&gt;$row[$k]&lt;/td&gt;\");\n    } \n    print (\"&lt;/tr&gt;\\n\");\n} while ($row = sqlsrv_fetch_array($stmt));\n</code></pre>\n\n<p>Is there a special function other than print() or echo that will properly print the date?</p>\n"},{"tags":["asp.net","sql-server","database","entity-framework","ef-code-first"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":13086006,"title":"How can I force entity framework to insert identity columns?","body":"<p>I want to write some C# code to initialize my database with some seed data.  Clearly, this is going to require the ability to be able to set the values of various Identity columns when inserting.  I'm using a code-first approach.  By default, <code>DbContext</code> handles the database connection and so you can't <code>SET IDENTITY_INSERT [dbo].[MyTable] ON</code>.  So, what I've done so far is use the <code>DbContext</code> constructor that lets me specify a DB connection to be used.  Then, I set <code>IDENTITY_INSERT</code> to <code>ON</code> in that DB connection, and then try to insert my records using entity framework.  Here's an example of what I've got so far:</p>\n\n<pre><code>public class MyUserSeeder : IEntitySeeder {\n    public void InitializeEntities(AssessmentSystemContext context, SqlConnection connection) {\n        context.MyUsers.Add(new MyUser { MyUserId = 106, ConceptPersonId = 520476, Salutation = \"Mrs\", Firstname = \"Novelette\", Surname = \"Aldred\", Email = null, LoginId = \"520476\", Password=\"28c923d21b68fdf129b46de949b9f7e0d03f6ced8e9404066f4f3a75e115147489c9f68195c2128e320ca9018cd711df\", IsEnabled = true, SpecialRequirements = null });\n        try {\n            connection.Open();\n            SqlCommand cmd = new SqlCommand(\"SET IDENTITY_INSERT [dbo].[MyUser] ON\", connection);\n            int retVal = cmd.ExecuteNonQuery();\n            context.SaveChanges();\n        }\n        finally {\n            connection.Close();\n        }\n    }\n}\n</code></pre>\n\n<p>So close and yet so far - because, although <code>cmd.ExecuteNonQuery()</code> works fine, when I then run <code>context.SaveChanges()</code>, I'm informed that \"Explicit value must be specified for identity column in table 'MyUser' either when IDENTITY_INSERT is set to ON or when a replication user is inserting into a NOT FOR REPLICATION identity column.\"</p>\n\n<p>Presumably, because MyUserId (which is the Identity column in the MyUser table) is the primary key, entity framework doesn't try to set it when I call <code>context.SaveChanges()</code>, even though I gave the <code>MyUser</code> entity a value for the <code>MyUserId</code> property.</p>\n\n<p>Is there a way to force entity framework to try and insert even primary key values for an entity, then?  Or maybe a way to temporarily mark <code>MyUserId</code> as not being a primary key value, so EF tries to insert it?</p>\n"},{"tags":["sql-server","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13101414,"title":"Identity column and using order by in query","body":"<p>I use SQL Server 2008 R2 and have a table with an <code>id</code> column as <code>identity(1,1)</code>. If I want to get query ordered by id column, do must use <code>Order By ID</code> or not necessary. </p>\n\n<p><strong>EDIT :</strong>\nI have a unique clustered index on ID column. do this index guaranteed that my query sorted by id by default.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1393,"score":3,"question_id":2136336,"title":"Sql Server 2008 Cross-database table linking (relationships)","body":"<p>I have a bit of an issue, and to be honest I don't think there's an answer, but I'll give it a try anyway.</p>\n\n<p>So I have two databases [A]->Company and [B]->Product. Both databases have a Country table which is then linked to other tables in each individual database. The problem is that the data between the two Country tables is a complete duplicate. So, I essentially have to duplicate some of the relationships in each database, and maintenance on top of that is just difficult...</p>\n\n<p>So, I'm curious is there a way to create a cross-database relationship between tables so I can have only one set of Country+Helper tables that govern both databases?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server","vbscript","sql-agent"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":6444551,"title":"SQL Agent and Running SSIS Across Network Not Working","body":"<p>I have a vb script which moves files from one server to another and it works successfully when run manually but when a job is created in SQL Agent to automate the process it doesn't perform the task.  SQL Agent doesn't fail it simply does not perform the move.  </p>\n\n<p>I granted local admin rights to the account performing the task and still nothing. I copied the files manually to the local SQL Server but I still get the same outcome when attempting to run the job in SQL Agent.  </p>\n\n<p>I also tried using FQDN but it still doesn't perform the process.  Any suggestions?  Please help and thanks in advance.</p>\n"},{"tags":["mysql","sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13097817,"title":"How to create table inside an another table column?","body":"<p>Given a scenario, I have one table lets say Table(Id,name,Question)..I wanted to create another table inside Question Column...Can anybody help me out regarding above mentioned query</p>\n"},{"tags":["sql-server","xml","bulkinsert","bcp"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1474,"score":2,"question_id":8530353,"title":"Sql Bulk insert XML format file with double quotes in terminator","body":"<p>I'm trying to insert some data into a table from a csv document which has all of the fields delimited with \"\"</p>\n\n<p>ie.</p>\n\n<pre><code> APPLICANTID,NAME,CONTACT,PHONENO,MOBILENO,FAXNO,EMAIL,ADDR1,ADDR2,ADDR3,STATE,POSTCODE\n \"3\",\"Snoop Dogg\",\"Snoop Dogg\",\"411\",\"\",\"\",\"\",\"411 High Street\",\"USA \n \",\"\",\"USA\", \"1111\" \"4\",\"LL Cool J\",\"LL Cool J\",\"\",\"\",\"\",\"\",\"5 King\n Street\",\"\",\"\",\"USA\",\"1111\"\n</code></pre>\n\n<p>I am using an xml format file to try and overcome the \"\" delimiters as I believe I would have to update the data again after importing to remove the inital \" if it did not.</p>\n\n<p>My format file looks like the following:</p>\n\n<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;BCPFORMAT xmlns=\"http://schemas.microsoft.com/sqlserver/2004/bulkload/format\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n &lt;RECORD&gt;\n  &lt;FIELD ID=\"1\" xsi:type=\"NCharTerm\" TERMINATOR='\",' MAX_LENGTH=\"12\"/&gt;\n  &lt;FIELD ID=\"2\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"3\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"4\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"5\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"6\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"7\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"8\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"9\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"10\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"11\" xsi:type=\"CharTerm\" TERMINATOR=',\"' COLLATION=\"Latin1_General_CI_AS\"/&gt;\n  &lt;FIELD ID=\"12\" xsi:type=\"CharTerm\" TERMINATOR=\"\\r\\n\" COLLATION=\"Latin1_General_CI_AS\"/&gt;\n &lt;/RECORD&gt;\n &lt;ROW&gt;\n  &lt;COLUMN SOURCE=\"1\" NAME=\"APPLICANTID\" xsi:type=\"SQLINT\"/&gt;\n  &lt;COLUMN SOURCE=\"2\" NAME=\"NAME\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"3\" NAME=\"CONTACT\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"4\" NAME=\"PHONENO\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"5\" NAME=\"MOBILENO\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"6\" NAME=\"FAXNO\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"7\" NAME=\"EMAIL\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"8\" NAME=\"ADDR1\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"9\" NAME=\"ADDR2\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"10\" NAME=\"ADDR3\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"11\" NAME=\"STATE\" xsi:type=\"SQLNVARCHAR\"/&gt;\n  &lt;COLUMN SOURCE=\"12\" NAME=\"POSTCODE\" xsi:type=\"SQLCHAR\"/&gt;\n &lt;/ROW&gt;\n&lt;/BCPFORMAT&gt;\n</code></pre>\n\n<p>and I am running the import with the following:</p>\n\n<pre><code>BULK INSERT [PracticalDB].dbo.applicant \nFROM 'C:\\temp.csv'\nWITH (KEEPIDENTITY, FORMATFILE='C:\\temp.xml', FIRSTROW = 2)\n</code></pre>\n\n<p>I am getting the error:</p>\n\n<blockquote>\n  <p>Msg 4864, Level 16, State 1, Line 1 Bulk load data conversion error\n  (type mismatch or invalid character for the specified codepage) for\n  row 2, column 1 (APPLICANTID).</p>\n</blockquote>\n\n<p>for all of the rows.</p>\n\n<p>I have tried various different combinations for the terminator including using:</p>\n\n<pre><code>TERMINATOR=\"&amp;quot;,\"\nTERMINATOR=\"\\\",\"\nTERMINATOR='\",\"\nTERMINATOR='\\\",\"\n</code></pre>\n\n<p>and none of them seem to work.</p>\n\n<p>Is there a correct way to escape the \" so that it will be parsed correctly, assuming that that is my problem here.</p>\n"},{"tags":["sql-server","visual-studio","sql-server-express"],"answer_count":5,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":4012,"score":1,"question_id":6535532,"title":"How to import .sql file into SQL Server Express","body":"<p>I have a plain sql file with some SQL INSERT statements.   </p>\n\n<p>Is it possible to import it in my local SQL Server Express instance?</p>\n"},{"tags":["sql-server","silverlight","entity-framework","table","big"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":112,"score":0,"question_id":9748830,"title":"How to load silverlight Entities with a large number of records?","body":"<p>I have a big table in my SQL Server database with 38000 records! When loading this table in my Silverlight application, it shows 0 records loaded. When i load the same table with less records (1000 for example ) the entity is loaded with all records! </p>\n\n<p>Can anyone help me please? </p>\n\n<pre><code>      loadhabitaion = this.friendsContext.Load(this.friendsContext.GetHyd_poliQuery());\n      loadhabitaion.Completed += new EventHandler(loadhabitaion_Completed);\n      void loadhabitaion_Completed(object sender, EventArgs e)\n\n         {\n\n        MessageBox.Show(loadhabitaion.Entities.Count().ToString());\n          //it returns 0\n         }\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-ce"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1045,"score":1,"question_id":2159508,"title":"SQL Compact - Error executing multiple insert statements","body":"<p>I'm using management studio to connect to my sql mobile/compact database.</p>\n\n<p>I'm trying to insert some dummy data into some tables, for example:</p>\n\n<pre><code>INSERT INTO FlooringTypes (FlooringType) VALUES ('Carpet')  \nINSERT INTO FlooringTypes (FlooringType) VALUES ('Smooth')\n</code></pre>\n\n<p>However it returns the error:</p>\n\n<blockquote>\n  <p>Major Error 0x80040E14, Minor Error 25501</p>\n</blockquote>\n\n<p>If I run them seperately it works fine.</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":29,"score":-1,"question_id":13100843,"title":"Avoid repeating name in gridview with a unique name?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13090398/avoid-duplicate-names-in-a-dataset\">Avoid duplicate names in a dataset</a>  </p>\n</blockquote>\n\n\n\n<p><img src=\"http://i.stack.imgur.com/pMclb.png\" alt=\"enter image description here\"></p>\n\n<p>I am populating some data from DB and i have some duplicate template names and when i want to show in the front end i have to display only unique template name i.e \"test\" only once how can i achieve this??</p>\n\n<pre><code> private DataSet GridLoading()\n{\n    // DataTable dt = new DataTable();\n    DataSet ds = new DataSet();\n    ds = Common.LoadingGrid();\n    GridView1.DataSource = ds;\n    GridView1.DataBind();\n    return ds;\n}\n\n  public static DataSet LoadingGrid()\n    {\n        DBAccess objDBAccess = new DBAccess();\n       DataSet ds = new DataSet();\n\n\n        try\n        {\n\n           objDBAccess.AddParameter(\"@tempname\", SqlDbType.VarChar);\n           objDBAccess.AddParameter(\"@runby\", SqlDbType.VarChar);\n            ds = objDBAccess.ExecuteDataSet(\"load\");\n\n\n            return ds;\n</code></pre>\n"},{"tags":["sql-server","nocount"],"answer_count":6,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":1883,"score":4,"question_id":26552,"title":"What are the advantages and disadvantages of turning NOCOUNT off in SQL Server queries?","body":"<p>What are the advantages and disadvantages of turning NOCOUNT off in SQL Server queries?</p>\n"},{"tags":["c#","sql-server","methods"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13100218,"title":"How to get a method to work in all forms in my project in c#","body":"<p>I wrote code(connection string) to open sql database in form1  then i need to open the same database in form2 .\nso i think to write method to do this ?\nHow to get this method to work in all forms in my project in c#, where i neet to plse it to work in all project forms????\nplz help</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":255,"score":0,"question_id":6825199,"title":"SQL server suspect/Off line mode and Data lost","body":"<p>Suddenly I saw my SQL Server is in suspect/OFF Line mode. That's why I am not able to do any any operation in my db. For this reason I restarted my server (Windows Server 2003) .</p>\n\n<p>But when I get ready I found that some of my data has been lost.  I have no any back up of my db.</p>\n\n<p>Is there any way to get back the data that I have lost.</p>\n\n<p>the error log:</p>\n\n<blockquote>\n  <p>Could not redo log record (5108:10151:5), for transaction ID\n  (0:1552370), on page (1:3679), database '??'</p>\n</blockquote>\n"},{"tags":[".net","sql-server","transactions","transactionscope"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":7051,"score":6,"question_id":2858750,"title":"What is the reason of \"Transaction context in use by another session\"","body":"<p>I'm looking for a description of the root of this error: \"Transaction context in use by another session\".</p>\n\n<p>I get it sometimes in one of my unittests so I can't provider repro code. But I wonder what is \"by design\" reason for the error.</p>\n\n<p>UPDATE: the error returns as SqlException from SQL Server 2008. A place where I get the error seems to be single-threaded. But probably I have unittests interaction as I get the error where run several tests at once (MSTest in VS2008sp1).\nBut the failing test looks like:</p>\n\n<ul>\n<li>create an object and save it inside DB-transaction (commit)</li>\n<li>create TransactionScope</li>\n<li>trying to open a connection - here I get SqlException with such stacktrace:</li>\n</ul>\n\n<p>.</p>\n\n<pre><code>System.Data.SqlClient.SqlException: Transaction context in use by another session.\n   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj)\n   at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)\n   at System.Data.SqlClient.TdsParser.TdsExecuteTransactionManagerRequest(Byte[] buffer, TransactionManagerRequestType request, String transactionName, TransactionManagerIsolationLevel isoLevel, Int32 timeout, SqlInternalTransaction transaction, TdsParserStateObject stateObj, Boolean isDelegateControlRequest)\n   at System.Data.SqlClient.SqlInternalConnectionTds.PropagateTransactionCookie(Byte[] cookie)\n   at System.Data.SqlClient.SqlInternalConnection.EnlistNonNull(Transaction tx)\n   at System.Data.SqlClient.SqlInternalConnection.Enlist(Transaction tx)\n   at System.Data.SqlClient.SqlInternalConnectionTds.Activate(Transaction transaction)\n   at System.Data.ProviderBase.DbConnectionInternal.ActivateConnection(Transaction transaction)\n   at System.Data.ProviderBase.DbConnectionPool.GetConnection(DbConnection owningObject)\n   at System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection)\n   at System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory)\n   at System.Data.SqlClient.SqlConnection.Open()\n</code></pre>\n\n<p>I've found these posts:</p>\n\n<ul>\n<li><a href=\"http://blogs.msdn.com/asiatech/archive/2009/08/10/system-transaction-may-fail-in-multiple-thread-environment.aspx\" rel=\"nofollow\">http://blogs.msdn.com/asiatech/archive/2009/08/10/system-transaction-may-fail-in-multiple-thread-environment.aspx</a></li>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/ff649002.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ff649002.aspx</a></li>\n</ul>\n\n<p>But I can't understand what <em>\"Multiple threads sharing the same transaction in a transaction scope will cause the following exception: 'Transaction context in use by another session.'\"</em> means. All words are understandable but not the point. </p>\n\n<p>I actually can share a system transaction between threads. And there is even special mechanism for this - DependentTransaction class and Transaction.DependentClone method.</p>\n\n<p>I'm trying to reproduce a usecase from the first post:</p>\n\n<ol>\n<li>Main thread creates DTC transaction, receives DependentTransaction (created using Transaction.Current.DependentClone on the main thread</li>\n<li>Child thread 1 enlists in this DTC transaction by creating a transaction scope based on the dependent transaction (passed via constructor)</li>\n<li>Child thread 1 opens a connection</li>\n<li>Child thread 2 enlists in DTC transaction by creating a transaction scope based on the dependent transaction (passed via constructor)</li>\n<li>Child thread 2 opens a connection</li>\n</ol>\n\n<p>with such code:</p>\n\n<pre><code>using System;\nusing System.Threading;\nusing System.Transactions;\nusing System.Data;\nusing System.Data.SqlClient;\n\npublic class Program\n{\n    private static string ConnectionString = \"Initial Catalog=DB;Data Source=.;User ID=user;PWD=pwd;\";\n\n    public static void Main()\n    {\n        int MAX = 100;\n        for(int i =0; i&lt; MAX;i++)\n        {\n            using(var ctx = new TransactionScope())\n            {\n                var tx = Transaction.Current;\n                // make the transaction distributed\n                using (SqlConnection con1 = new SqlConnection(ConnectionString))\n                using (SqlConnection con2 = new SqlConnection(ConnectionString))\n                {\n                    con1.Open();\n                    con2.Open();\n                }\n                showSysTranStatus();\n\n                DependentTransaction dtx = Transaction.Current.DependentClone(DependentCloneOption.BlockCommitUntilComplete);\n                Thread t1 = new Thread(o =&gt; workCallback(dtx));\n                Thread t2 = new Thread(o =&gt; workCallback(dtx));\n                t1.Start();\n                t2.Start();\n                t1.Join();\n                t2.Join();\n\n                ctx.Complete();\n            }\n            trace(\"root transaction completes\");\n        }\n    }\n    private static void workCallback(DependentTransaction dtx)\n    {\n        using(var txScope1 = new TransactionScope(dtx))\n        {\n            using (SqlConnection con2 = new SqlConnection(ConnectionString))\n            {\n                con2.Open();\n                trace(\"connection opened\");\n                showDbTranStatus(con2);\n            }\n            txScope1.Complete();\n        }   \n        trace(\"dependant tran completes\");\n    }\n    private static void trace(string msg)\n    {\n        Console.WriteLine(Thread.CurrentThread.ManagedThreadId + \" : \" + msg);\n    }\n    private static void showSysTranStatus()\n    {\n        string msg;\n        if (Transaction.Current != null)\n            msg = Transaction.Current.TransactionInformation.DistributedIdentifier.ToString();\n        else\n            msg = \"no sys tran\";\n        trace( msg );\n    }\n\n    private static void showDbTranStatus(SqlConnection con)\n    {\n        var cmd = con.CreateCommand();\n        cmd.CommandText = \"SELECT 1\";\n        var c = cmd.ExecuteScalar();\n        trace(\"@@TRANCOUNT = \" + c);\n    }\n}\n</code></pre>\n\n<p>It fails on Complete's call of root TransactionScope. But error is different:\nUnhandled Exception: System.Transactions.TransactionInDoubtException: The transaction is in doubt. --->\npired.  The timeout period elapsed prior to completion of the operation or the server is not responding.</p>\n\n<p>To sum up: I want to understand what \"Transaction context in use by another session\" means and how to reproduce it.</p>\n"},{"tags":["sql-server","business-intelligence","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":197,"score":0,"question_id":11177567,"title":"No selection to install SSIS, SSRS and SSAS","body":"<p>Goal:<br>\nInstall Developer SQL Server 2012+ Business intelligence and its SSIS, SSRS and SSAS in my computer.  </p>\n\n<p>Problem:<br>\nCan't find the settings or something similar in the install selection  to install SSIS, SSRS and SSAS in my computer.</p>\n\n<p>Before doing the installation, a screen was displayed with selection of feature. Look at the picture.</p>\n\n<p><img src=\"http://i.stack.imgur.com/MRDuf.gif\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":1,"view_count":168,"score":5,"question_id":12842251,"title":"Update the same table in SQL Server","body":"<p>I was trying to update the same table data from same table data.</p>\n\n<p>My SP is as shown below :</p>\n\n<pre><code>UPDATE T1\nSET T1.Name = T2.Name\n   , T1.Age = T2.Age\n   , T1.Subject = T2.Subject\nFROM Student T1\n   , Student T2\nWHERE T1.StudentID = @OldID\n   AND T2.StudentID = @NewID\n</code></pre>\n\n<p>When I am executing this query, there is no error. But the update is not working.</p>\n\n<p>[here NO Common column values to compare like T1.StudentID = T2.StudentID]</p>\n"},{"tags":["sql","sql-server","decimal","number-formatting"],"answer_count":6,"favorite_count":0,"up_vote_count":18,"down_vote_count":0,"view_count":115192,"score":18,"question_id":441600,"title":"Write a number with two decimal places SQL server","body":"<p>How do you write number in two decimal place for sql server?</p>\n"},{"tags":["sql-server","delphi","ado"],"answer_count":1,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":128,"score":7,"question_id":13074765,"title":"TADOQuery Join tables - Insert \\ Delete records from result","body":"<p>Using a single <code>TADOQuery</code> i pull records from two different tables using a left outer join:  </p>\n\n<pre><code>Select M*, D.* from Courier M Left outer join Courier_VT D on M.Courier_Identifier = D.FK_Courier_Identifier\n</code></pre>\n\n<p>I use a <code>TDBGrid</code> to successfully post field updates to my MSSQL DB.</p>\n\n<p>Since there is foreign key reference (<code>FK_Courier_Identifier</code> with <code>Courier_Identifier</code>) I get a error when I insert a record, </p>\n\n<blockquote>\n  <p>Cannot Insert the value Null in to column 'FK_Courier_Identifier', table Courier_VT; column does not allow null</p>\n</blockquote>\n\n<p>but a record is posted in Courier table, i do know that i need to assign the <code>Courier_Identifier</code> to <code>FK_Courier_Identifier</code> before posting but don't how and where to do it</p>\n\n<p>How do we Insert \\ Delete records in this scenario ? Is it possible to achieve using a single <code>TADOQuery</code> ? </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":66,"score":4,"question_id":13093642,"title":"Select rows with same column A but different column B","body":"<pre><code>ID          Zip        Room\n----------- ---------- ------\n317         94087      S105\n318         94087      L603\n1739        94404-1801 L603\n1823        94401-2129 L603\n1824        94401-2129 L603\n2135        94404-1801 L603\n2268        95136-1459 S604\n2269        95136-1459 S604\n3704        92673-6417 L402\n4479        93454-9670 L402\n4480        93454-9670 L402\n4782        92395-4681 L402\n4783        92395-4681 L402\n4852        92886-4411 L402\n4853        92886-4411 L402\n4959        92673-6417 L402\n5153        91773-4028 L402\n5202        91773-4028 L402\n5211        91765-2959 L402\n5212        91765-2959 L402\n5388        92336-0605 L402\n5392        92336-0605 L402\n5727        92870      L402\n5728        92870      L402\n5831        92557      L402\n5916        92557      L402\n</code></pre>\n\n<p>How do I select ID's that has THE SAME zip but different Room ?</p>\n\n<p>In the table above, I want the result to be:</p>\n\n<pre><code>ID          Zip        Room\n----------- ---------- ------\n317         94087      S105\n318         94087      L603\n</code></pre>\n\n<p>Using SQL Server 2008</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","join"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13098731,"title":"SQL Join Issue return DISTINCT Names","body":"<p>I have the following two tables with data like so:</p>\n\n<pre><code>Table Values\n var_label\n 1\n 2\n 2\n 1\n 3\n\nTable Codes\nvar_code\n1\n2\n4\n2\n</code></pre>\n\n<p>I need to join these tables and get the distinct result.  The var_label and var_code are equal pieces of data.  I want to have the joined output like so:</p>\n\n<pre><code> MyColumn\n1\n2\n3\n4\n</code></pre>\n\n<p>Wht's the best way to do this?</p>\n"},{"tags":["sql-server","tsql","sql-server-2012","common-table-expression","materialized"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":13090037,"title":"T-SQL CTE materializing techniques not working on SQL Server 2012","body":"<p>I have to use the following techniques to materialized my CTEs and increase the view performance:</p>\n\n<pre><code>WITH CTE AS(\n    SELECT TOP 100 PERCENT\n    ORDER BY ...\n)\n\nWITH CTE AS(\n    SELECT TOP 2147483647\n    ORDER BY ...\n)\n</code></pre>\n\n<p>Now, neither of this ways works. Has anyone face the same issue or know if in SQL Server 2012 this things are not valid?</p>\n"},{"tags":["sql-server","sql-server-2000"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":15755,"score":4,"question_id":2729126,"title":"How to find column names for all tables in all databases in SQL Server","body":"<p>I want to find all column names in all tables <strong>in all databases</strong>. Is there a query that can do that for me? The database is Microsoft SQL Server 2000.</p>\n"},{"tags":["sql","sql-server","vba","ms-access-2007"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1253,"score":1,"question_id":5530465,"title":"Switching Access 2007 accdb backend to SQL server express / Best frontend options?","body":"<p>After reading many posts on this site, I am considering replacing my accdb be (2007) with SQL Server or SQL Server Express?  My fe is currently accdb (accde upon deployment). Is there any advantage to connecting to SQL using .adp as opposed to .accde?  I currently link to tables in SQL using ocdb and it seams to work fine. </p>\n\n<p>The only other question I have is, how much effort is it to create my fe forms using Visual Basic in Visual Studio Express?  The idea of having a standalone exe makes it tempting.  Am i looking at a big learning curve to go from vba to vb?  I'm assuming the funtionality of my code can be replicated in vb with some changes required. </p>\n\n<p>Just seems like a good time to make this decision, while I'm still in the design stage. </p>\n\n<p>Thanks.  </p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13097884,"title":"Data not inserting in c# but same data is inserted in SQL Server query browser","body":"<p>I have a link button in my gridview at which I have some to insert value in table but it is not inserting but query data on debug mode when I tested on SQL Server it is inserted so whats the problem</p>\n\n<pre><code>protected void gvPO_RowCommand(object sender, GridViewCommandEventArgs e)\n{\n        if (e.CommandName == \"Select\")\n        {\n            c.GetConection();\n            SqlCommand cmd = new SqlCommand(\"delete from tmpMateIN\", c.con);\n            cmd.ExecuteNonQuery();\n            DataTable dt;\n\n            int index = Convert.ToInt32(e.CommandArgument);\n            gvPO.SelectedIndex = index;\n\n            if (Convert.ToInt16(gvPO.SelectedIndex) &lt; 0)\n            {\n                lblMsg.Text = \"Please Select Code !\";\n                return;\n            }\n\n            dt = oAccount.GetPO((int)Session[\"CompCode\"], 79, Convert.ToInt16(((LinkButton)gvPO.Rows[gvPO.SelectedIndex].Cells[0].FindControl(\"lnkCode\")).Text.ToString()));\n\n            for (int i = 0; i &lt; dt.Rows.Count; i++)\n            {\n                String s6 = \"insert into tmpMateIN(compcode ,msttype ,mstcode,mstdate ,mstchno ,mstblno ,mstbldt ,mstcust ,itdsrno , itditem ,itdquan ,itdrema ,itemname  ,acctname ,ItmSize , unitname ,itemsize ,chno , chdt  ,godown, packsize ,itdRate , itdDisc , itdAmou  , mstInvNo , mstOrdNo,mstInvDt ,mstOrdDt ,mstrema , mstexcDes , msttaxDes ,msttaxper , mstfrghtDes , mstfrghtper , mstdeliDes ,mstpayDes , mstvaliDes, mstqno, mstqdt , itdthickness , itdlength ,itdwidth ,itdweight, itdtowt , acctaddr , custemail , mstpayMode , mstdepa,itdrefq,itdorgq)values(\" + (int)Session[\"CompCode\"] + \",79,'\" + dt.Rows[i][\"mstcode\"] + \"','\" + dt.Rows[i][\"mstdate\"] + \"',\" + dt.Rows[i][\"mstchno\"] + \",'\" + dt.Rows[i][\"mstchno\"] + \"','\" + dt.Rows[i][\"mstdate\"] + \"','\" + dt.Rows[i][\"mstptcode\"] + \"','\" + (i + 1) + \"','\" + dt.Rows[i][\"itditem\"] + \"','\" + dt.Rows[i][\"itdquan\"] + \"','\" + dt.Rows[i][\"itdrema\"] + \"','\" + dt.Rows[i][\"itdnarr\"] + \"','\" + dt.Rows[i][\"AcctName\"] + \"','\" + dt.Rows[i][\"itdnarr\"] + \"','\" + dt.Rows[i][\"UnitName\"] + \"' ,'\" + dt.Rows[i][\"itdunit\"] + \"','','\" + dt.Rows[i][\"mstdate\"] + \"','','',\" + dt.Rows[i][\"itdRate\"] + \",\" + dt.Rows[i][\"itdamou\"] + \" ,\" + dt.Rows[i][\"itdAmou\"] + \",'\" + dt.Rows[i][\"mstInvNo\"] + \"','\" + dt.Rows[i][\"mstindno\"] + \"','\" + dt.Rows[i][\"mstdate\"] + \"','\" + dt.Rows[i][\"mstdate\"] + \"','\" + dt.Rows[i][\"mstrema\"] + \"','','','\" + dt.Rows[i][\"mstTaxPer\"] + \"','\" + dt.Rows[i][\"mstfrghtDes\"] + \"','\" + dt.Rows[i][\"mstfrghtper\"] + \"','\" + dt.Rows[i][\"mstdeliDes\"] + \"','\" + dt.Rows[i][\"mstpayDes\"] + \"','\" + dt.Rows[i][\"mstvaliDes\"] + \"','\" + dt.Rows[i][\"mstqno\"] + \"','\" + dt.Rows[i][\"mstpodate\"] + \"','\" + dt.Rows[i][\"itdthickness\"] + \"','\" + dt.Rows[i][\"itdsource\"] + \"','\" + dt.Rows[i][\"itddestin\"] + \"','\" + dt.Rows[i][\"itdweight\"] + \"','\" + dt.Rows[i][\"itdtowt\"] + \"','','\" + dt.Rows[i][\"acctaddr\"] + \"','\" + dt.Rows[i][\"mstpayMode\"] + \"','\" + dt.Rows[i][\"mstContactPerson\"] + \"','\" + dt.Rows[i][\"mstlotno\"] + \"','\" + dt.Rows[i][\"mstsection\"] + \"' )\";\n\n                SqlCommand cmd1 = new SqlCommand(s6, c.con);\n                cmd1.ExecuteNonQuery();\n            }\n\n            c.CloseConnection();\n            Response.Redirect(\"Poreport.aspx\");\n    }\n}    \n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13098008,"title":"have to get data from VISIT_Table filter with only date no time","body":"<pre><code>\"SELECT * FROM VISIT_Table WHERE ID='\" + ID + \"' AND DATE ='\" + DateTime.Now.ToString(\"yyyy-MM-dd\") + @\"'\";\n</code></pre>\n\n<p>Above is my query I have to get data from <code>VISIT_Table</code> filter with only date no datetime..</p>\n\n<p>In database <code>visit_date</code> stores <code>2012-10-27 11:10:35</code> I have to get data with only date no time</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":33,"score":2,"question_id":13095216,"title":"SQL no primary or candidate keys in the referenced table","body":"<p>Here's my problem when I write my SQLSever expressions:</p>\n\n<blockquote>\n  <p>There are no primary or candidate keys in the referenced table 'Room'<br>\n  that match the referencing column list in the foreign key 'FK_<em>Booking</em>_RoomNo__4E298478'.</p>\n</blockquote>\n\n<p>And some snapshots to my program:</p>\n\n<pre><code>CREATE TABLE Booking(\n   HotelNo  NVARCHAR(4)     not null,\n   GuestNo      SMALLINT,  \n   DateFrom DATETIME    not null,\n   DateTo       DATETIME,\n   RoomNo       SMALLINT    not null,\n\n   PRIMARY KEY (HotelNo,DateFrom,RoomNo), \n   FOREIGN KEY (HotelNo) REFERENCES Hotel(HotelNo),\n   FOREIGN KEY (GuestNo) REFERENCES Guest(GuestNo),\n   FOREIGN KEY (RoomNo) REFERENCES Room(RoomNo));  &lt;---trouble on this line\n\nCREATE TABLE Room(\n   RoomNo       SMALLINT    not null, \n   HotelNo  NVARCHAR(4)     not null, \n   RoomType     NVARCHAR(25),\n   Price        DECIMAL(5,2),\n\n   PRIMARY KEY (RoomNo,HotelNo), \n   CONSTRAINT fk_Room FOREIGN KEY (HotelNo) REFERENCES Hotel(HotelNo));\n</code></pre>\n\n<p>and here is the Hotel table</p>\n\n<pre><code>CREATE TABLE Hotel(\n   HotelNo  NVARCHAR(4)     not null,\n   HotelName    NVARCHAR(25),\n   City     NVARCHAR(25),\n\n   PRIMARY KEY (HotelNo) );\n</code></pre>\n\n<p>I tried to do some search on this problem, and it says this might be caused when there's no primary key defined in the table Room, but as above, it is defined.</p>\n\n<p>Can someone please help me with this problem? </p>\n\n<p>Thank you in advance.</p>\n"},{"tags":["sql-server","zero","truncation"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13098355,"title":"How should I insert values into table with out truncation of zeros in SQL Server","body":"<p>I got a table EMPLOYEE1 and i'm trying to insert values into it</p>\n\n<pre><code>INSERT INTO EMPLOYEE1 values(00001, 00004566)\n</code></pre>\n\n<p>But it inserts the values as 1 and 4566 truncating zero's why does this happen. can some one help me out</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":32076,"score":8,"question_id":2474839,"title":"Unable to login to SQL Server + SQL Server Authentication + Error: 18456","body":"<p>I have created login account on my localhost\\sql2008 Server (Eg. User123)</p>\n\n<p>Mapped to Database (default)</p>\n\n<p>Authentication Mode on SQL Server is set to both (Windows and SQL)</p>\n\n<p>But login to SQL Server fails with following message (for User123)</p>\n\n<p>Note:  Have checked multiple time that UserName / Password are typed in correctly</p>\n\n<p>Error Details:</p>\n\n<blockquote>\n  <p>Login failed for user 'User123'\n  (Net.SqlClient Data Provider)</p>\n  \n  <p>Server Name : localhost\\sql2008 Error\n  Number: 18456 Severity : 14 State : 1\n  Line Number : 65536</p>\n</blockquote>\n\n<p>any help on this please.</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":19,"score":-6,"question_id":13098270,"title":"Datagridview dynamic editing in c#","body":"<p>I am trying to add data to datagridview dynamically in a winform.How can I do that ?</p>\n\n<p>Please help me.Thanks in advance.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13096707,"title":"Passing data into nested cursors in TSQL","body":"<p>I have a cursor that gets data and fetches it into @data_table.  Then in the while loop I want to pass that @data_table into another cursor (as the table name) to run some more processing. I keep getting a declare @data_table error. How do I fix this?</p>\n\n<pre><code>DECLARE @var_name varchar(50)\nDECLARE @data_table varchar(50)\nDECLARE @data_value varchar(50)\n\nDECLARE curDiscreteVars CURSOR LOCAL\n\nFOR SELECT DISTINCT v.var_name, v.data_table \n    FROM dbo.vars v\n    GROUP BY v.var_name, v.data_table\n\n-- Loop through cursor, translating variable values as needed, and generate counts for each val_code for a variable\nOPEN curDiscreteVars\nFETCH NEXT FROM curDiscreteVars \n    INTO @var_name, @data_table\n\nWHILE @@FETCH_STATUS  = 0\nBEGIN\n    --loop through all possible data values\n\n    DECLARE curValues CURSOR LOCAL\n\n    FOR SELECT DISTINCT @var_name  \n        FROM @data_table\n\n    OPEN curValues\n    FETCH NEXT FROM curValues \n        INTO @data_value\n\n    WHILE @@FETCH_STATUS  = 0\n    BEGIN\n        print @var_name\n\n\n\n        FETCH NEXT FROM curValues \n        INTO @data_value\n    END\n\n    CLOSE curValues\n    DEALLOCATE curValues\n\n    FETCH NEXT FROM curDiscreteVars \n    INTO @var_name, @data_table\nEND\n\nCLOSE curDiscreteVars\nDEALLOCATE curDiscreteVars\n</code></pre>\n"},{"tags":["sql-server","identity"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":41,"score":0,"question_id":13097727,"title":"Identity reseed in sql server not behaving as expected, inside turn constrain off and on block","body":"<pre><code>--drop table table_1;\ncreate table table_1 (a int identity(1,1) PRIMARY KEY,b int);\nALTER TABLE table_1 NOCHECK CONSTRAINT all;\nDBCC CHECKIDENT (table_1, RESEED,100);\nset IDENTITY_INSERT table_1 ON;\ninsert into table_1 (a,b) values (33,300);\ninsert into table_1 (a,b) values (34,400);\nset IDENTITY_INSERT table_1 OFF;\nALTER TABLE table_1  WITH CHECK CHECK CONSTRAINT all;\nselect IDENT_SEED('table_1') as [seed], IDENT_CURRENT('table_1') as [current], IDENT_INCR('table_1') as [Increment];\n-- seed: 1, current_identity: 33,increment: 1 [surprise]\n-- insert into table_1 (b) values (500); [fails]\n--      fails as indentity is 33 \n--      tries to insert 34 and 34 already present\n</code></pre>\n\n<p>why is the indentity starting from 33, and starting NOT from 100 as expected ? </p>\n\n<pre><code>-- drop table table_2;\ncreate table table_2 (a int identity(1,1) PRIMARY KEY,b int);\nALTER TABLE table_2 NOCHECK CONSTRAINT all;\nDBCC CHECKIDENT (table_2, RESEED,100);\nset IDENTITY_INSERT table_2 ON;\ninsert into table_2 (a,b) values (33,300);\ninsert into table_2 (a,b) values (35,300);\nset IDENTITY_INSERT table_2 OFF;\ninsert into table_2 (b) values (9999); -- inserting a row before turning on all constraints\nALTER TABLE table_2  WITH CHECK CHECK CONSTRAINT all;\nselect IDENT_SEED('table_2') as [seed], IDENT_CURRENT('table_2') as [current], IDENT_INCR('table_2') as [Increment];\n-- seed:  1, current_identity: 101,increment: 1 [excpected]\ninsert into table_2 (b) values (500)\n</code></pre>\n\n<p>This is working as expected.</p>\n\n<p>Why is the reseed done inside the constraint turn OFF, turn All block; not honored when row[s] without identity check on are not inserted within the block ?</p>\n"},{"tags":["php","sql-server","arabic"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":897,"score":1,"question_id":3253214,"title":"PHP get Arabic Content from SQL SERVER","body":"<p>how can i get Arabic content when i run MSSQL_QUERY?\nit appears as ????\ni tried to do this\n$res=mssql_query($q);\n$row=mssql_fetch_row($res)\necho iconv(\"unicode\",\"utf-8\",$row[0])\nbut in this case it shows the value as Chinese letters as \nany suggestion is highly appreciated </p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":6,"favorite_count":5,"up_vote_count":13,"down_vote_count":0,"view_count":3367,"score":13,"question_id":2759756,"title":"is it possible to select EXISTS directly as a bit?","body":"<p>I was wondering if it's possible to do something like this (which doesn't work): </p>\n\n<p><code>select cast( (exists(select * from theTable where theColumn like 'theValue%') as bit)</code></p>\n\n<p>Seems like it should be doable, but lots of things that should work in SQL don't ;) I've seen workarounds for this (SELECT 1 where... Exists...) but it seems like I should be able to just cast the result of the exists function as a bit and be done with it.</p>\n"},{"tags":["php","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3419,"score":1,"question_id":6674320,"title":"Fatal error: Call to undefined function mssql_connect() in php","body":"<p>I'm running Windows Server, MS Sql and IIS6.  I am trying to connect php to ms sql database, and I keep getting the following error from the script</p>\n\n<blockquote>\n  <p>Fatal error: Call to undefined function mssql_connect() in .... on line x</p>\n</blockquote>\n\n<p>I have install zend studio in <code>C:\\Program Files\\Zend\\ZendStudio-5.5.0</code> directory.  Configure IIS server and set the path variable to <code>;C:\\Program Files\\Zend\\ZendStudio-5.5.0\\bin\\php5</code> also.\nThe zend studio folder contains php4 and php5 inside the bin dir. I have added <code>extension=php_mssql.dll</code> in the <code>php.ini</code> file which is inside the <code>C:\\Program Files\\Zend\\ZendStudio-5.5.0\\bin\\php5</code> folder. And added <code>php_mssql.dll</code> in the ext dir. <code>php.ini</code> file is placed in windows path <code>C:\\WINDOWS</code> also.</p>\n\n<p>I'm new to PHP, I searched but nobody ever seems fixed this issue. I'll be greatful for any help.</p>\n"},{"tags":["sql","sql-server","dynamic"],"answer_count":3,"favorite_count":4,"up_vote_count":16,"down_vote_count":0,"view_count":16750,"score":16,"question_id":548090,"title":"Dynamic SQL - EXEC(@SQL) versus EXEC SP_EXECUTESQL(@SQL)","body":"<p>What are the real world pros and cons of executing a dynamic SQL command in a stored procedure in SQL Server with</p>\n\n<pre><code>EXEC(@SQL)\n</code></pre>\n\n<p>versus</p>\n\n<pre><code>EXEC SP_EXECUTESQL(@SQL)\n</code></pre>\n\n<p>?</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13074273,"title":"Unable to Auto-Create ASPNETDB.MDF - Visual Web Developer Express 2008 / SQL Express 2008","body":"<p>I Recently began learning ASP.net / SQL. I Installed Sql Server 2008R2 Express Edition; and Visual Web Designer 2008 Express Edition. I recently tried to create a login page and was unsuccessful; any help would be appreciated. I tried by taking the following steps:\n<br/>-Create New WebSite<br/>-Go to design view<br/> -Drag \"login status\" into design view; Drag \"Login\" control onto design view as well; <br/> -In Web.config I changed the authentication to \"forms\" (didnt add anything else) <br/> -Run the page without debug / Type in any information in the login to have a \"ASPNETDB.MDF\" file automatically created into my \"app_data\" folder; \nand i receive the error below.</p>\n\n<p>Note: Sql Server has \"allow Remote connections\" enabled, In configuration manager i enabled tcp/ip and \"pipes\" (these were measures i took after the fact that i couldnt get the DB auto created.) I Have tried \"connecting databases\" to my visual web designer program. Also worth noting that When connecting databases i use .\\ or localhost\\   no istance name because this is the only way V.W.Designer detects my databases. </p>\n\n<p><img src=\"http://i.stack.imgur.com/nAvcs.png\" alt=\"Error I get\"></p>\n\n<p>The stack trace you cant see in the picture is as follow:</p>\n\n<blockquote>\n  <p>[SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified)]\n     System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection) +4849015\n     System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj) +194\n     System.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, Boolean ignoreSniOpenTimeout, Int64 timerExpire, Boolean encrypt, Boolean trustServerCert, Boolean integratedSecurity, SqlConnection owningObject) +4862333\n     System.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, Boolean ignoreSniOpenTimeout, Int64 timerExpire, SqlConnection owningObject) +90\n     System.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(String host, String newPassword, Boolean redirectedUserInstance, SqlConnection owningObject, SqlConnectionString connectionOptions, Int64 timerStart) +376\n     System.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(SqlConnection owningObject, SqlConnectionString connectionOptions, String newPassword, Boolean redirectedUserInstance) +221\n     System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, Object providerInfo, String newPassword, SqlConnection owningObject, Boolean redirectedUserInstance) +189\n     System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection) +4863459\n     System.Data.ProviderBase.DbConnectionFactory.CreateNonPooledConnection(DbConnection owningConnection, DbConnectionPoolGroup poolGroup) +29\n     System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection) +4865788\n     System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory) +117\n     System.Data.SqlClient.SqlConnection.Open() +122\n     System.Web.Management.SqlServices.GetSqlConnection(String server, String user, String password, Boolean trusted, String connectionString) +82</p>\n  \n  <p>[HttpException (0x80004005): Unable to connect to SQL Server database.]\n     System.Web.Management.SqlServices.GetSqlConnection(String server, String user, String password, Boolean trusted, String connectionString) +137\n     System.Web.Management.SqlServices.SetupApplicationServices(String server, String user, String password, Boolean trusted, String connectionString, String database, String dbFileName, SqlFeatures features, Boolean install) +94\n     System.Web.Management.SqlServices.Install(String database, String dbFileName, String connectionString) +25\n     System.Web.DataAccess.SqlConnectionHelper.CreateMdfFile(String fullFileName, String dataDir, String connectionString) +395</p>\n</blockquote>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":158,"score":0,"question_id":4002961,"title":"Trigger on Select","body":"<p>I want to return different results to user when using Select because it returns wrong value and i cant use view or something else because its third party appliction. </p>\n\n<p>I want to make instead of his select perform another select trigger or any thing else.</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":106,"score":2,"question_id":13075854,"title":"Displaying multiple images in one datalist template cell","body":"<p>I know there's a lot of questions about the subject, but my situation is sort of different.\nI'm trying to display 3 images in one datalist cell, for example I have a product table in SQL server that can have multiple images.</p>\n\n<pre><code> Image Mapping table \n ID     URL_Mapping_ID ProductID  \n 1      image 1.png    1\n 2      image 2.png    1\n 3      image 3.png    1   \n\n Product Table \n ProductID   Product\n 1           Chips\n</code></pre>\n\n<p>Upon selecting it from SQL, the result is multiple rows but with different Images.</p>\n\n<p>Now on my asp datalist I have to show 1 product with all the images, so that the user can enlarge the thumbnails.    </p>\n\n<p>What will the best way be to implement this scenario?</p>\n"},{"tags":["sql-server","vb6","ado"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13095621,"title":"\"Class not registered\" error when opening recordset using VB6","body":"<p>I started getting this problem recently. Don't know how it started but I know I disabled some windows services that startup, and deleted some odbc, probably a mysql odbc data source but I'm using MS SQL 2000 for the following.</p>\n\n<p>I get the error when trying to populate the recordset, and the error details are:\n<em>\"Run-time error '-2147221164 (80040154)': Class not registered.\"</em></p>\n\n<pre><code>Private Sub cmdTestConnection_Click()\nDim conn As ADODB.Connection\nSet conn = New ADODB.Connection\nconn.ConnectionString = \"Provider=SQLOLEDB.1;Initial Catalog=dbname;Data Source=mrtestpc2\\sql2000pwd;Extended Properties=uid=sa;pwd=passwordhere;\"\nDim rs As ADODB.Recordset\nSet rs = New ADODB.Recordset\nconn.Open\nrs.Open \"select * from tablename\", conn 'ERROR here\nMsgBox CStr(rs.RecordCount)\nEnd Sub\n</code></pre>\n\n<p>The references that might be relevant to this issue which I have ticked is:\nMicrosoft ActiveX Data Objects 2.8 Library </p>\n\n<p>I've tried with different versions with the above reference, from 2.8 to 2.5 but still get the same problem.</p>\n\n<p>EDIT: I'm trying to figure out whether it's an MDAC issue.\nEDIT: I'm running windows xp sp3.</p>\n"}]}
{"total":54452,"page":13,"pagesize":100,"questions":[{"tags":["java","sql-server","jdbc","schema"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1154,"score":0,"question_id":3669352,"title":"JDBC Change Default Schema","body":"<p>I'm trying to connect to a sql server 2005 database via JDBC.  </p>\n\n<p>I get the error:</p>\n\n<blockquote>\n  <p>com.microsoft.sqlserver.jdbc.SQLServerException: The SELECT permission\n  was denied on the object 'MyTable', database 'MyDatabase', schema\n  'dbo'.</p>\n</blockquote>\n\n<p>The schema I use to connect is \"MyUser\".  How do I connect using MyUser as opposed to dbo?</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":801,"score":2,"question_id":1570995,"title":"How to embed images in e-mails sent by msdb.dbo.sp_send_dbmail?","body":"<p>I'm trying to send e-mails to contacts stored in SQL Server database. The e-mails contain images. </p>\n\n<p>I tried the code below,</p>\n\n<p>EXEC msdb.dbo.sp&#95;send&#95;dbmail<br/>\n   @recipients = 'name@address.com;',<br/>\n   @subject = 'Sending Mail from SQL Server Test',<br/>\n   @file_attachments = 'C:\\inetpub\\wwwroot\\pagerror.gif',<br/>\n   @body=N'&lt;img src=\"pagerror.gif\" /&gt;',<br/> \n   @body_format = 'HTML';</p>\n\n<p>but some e-mail providers (like Yahoo) assume the sent mail as spam. What i need is to create the &lt;img&gt; tag like the ones generated by Outlook:</p>\n\n<p>&lt;img width=482 height=675 id=\"_x0000_i1025\" src=\"cid:image002.png@01CA4B5E.28AE48C0\"&gt;</p>\n\n<p>With this tag, Yahoo doesn't assume it as spam. How to process the image so I can refer it like above?</p>\n\n<p>I'm not an advanced SQL Server programmer. I really need a step-by-step tutorial. Please help...</p>\n\n<p>Many thanks in advance</p>\n\n<p>Haris</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13095183,"title":"getting cumulative average per client_ID","body":"<p>I have a table called:</p>\n\n<p><strong>F_Accession_Daily</strong></p>\n\n<pre><code>test_id varchar\nreceived_date date\npatient_id varchar\nclient_id varchar\n</code></pre>\n\n<p>There can be multiple test_id's per patient. Every test_id has only one received_date. every client_id can have multiple patient_id's. </p>\n\n<p>right now I am returning the average test frequency of times tested (<strong>TestFreq</strong>) per <code>client_id</code>. I have a column that will return </p>\n\n<blockquote>\n  <p>[test frequency of patients that had 2 and only 2 tests], [test\n  frequency for patients that had 3 and only 3 tests], [test frequency\n  for patients that had 4 and only 4].....[12 and only 12]. (these are labeled below as testfreq1, testfreq2, testfreq3....testfreq12</p>\n</blockquote>\n\n<p>These are only a client_id basis. </p>\n\n<p>example of the returned data:</p>\n\n<pre><code>+-----------+----------------+---------------+-----------------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+---------+---------+------------+---------+---------+------------+---------+\n| client_id | MonthsCustomer | TotalPatients | Totalaccessions | count1 | TestFreq1 | stdv1 | count2 | TestFreq2 |  stdv2  | count3 | TestFreq3 |  stdv3  | count4 | TestFreq4 |  stdv4  | count5 | TestFreq5 |  stdv5  | count6 | TestFreq6 |  stdv6  | count7 | TestFreq7 |  stdv7  | count8 | TestFreq8 |  stdv8  | count9 | TestFreq9 |  stdv9  | count10 | TestFreq10 | stdv10  | count11 | TestFreq11 | stdv11  | count12 | TestFreq12 | stdv12  |\n+-----------+----------------+---------------+-----------------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+---------+---------+------------+---------+---------+------------+---------+\n|    100001 |             42 |          4289 |           15393 |   1976 |         0 |     0 |    719 |       152 | 202.793 |    385 |       140 | 136.356 |    262 |       130 | 99.5561 |    183 |       117 | 81.273  |    136 |       111 | 71.8437 |    112 |       104 | 62.8288 | 87     | 98        | 51.9194 |     75 |        89 | 49.9136 |      63 |         96 | 40.0267 |      57 |         94 | 37.497  | 45      | 102        | 32.6785 |\n|    100003 |             34 |          2098 |           16026 |    509 |         0 |     0 |    303 |        68 | 97.9581 |    190 |        62 | 55.5366 |    137 |        61 | 50.9664 |    101 |        61 | 48.5921 |     89 |        46 | 27.7256 |     62 |        55 | 38.2849 | 77     | 46        | 27.995  |     60 |        49 | 27.8421 |      51 |         47 | 22.2794 |      48 |         42 | 21.0575 | 40      | 46         | 19.9365 |\n|    100004 |             36 |          5841 |           10693 |   3712 |         0 |     0 |   1122 |       223 | 256.033 |    468 |       236 | 157.251 |    211 |       181 | 103.755 |    165 |       175 | 76.5761 |     86 |       161 | 67.6254 |     46 |       151 | 55.4122 | 13     | 121       | 31.1677 |     12 |       104 | 45.7847 |       2 |         88 | 7.77817 |       3 |         92 | 36.2261 | NULL    | NULL       | NULL    |\n|    100008 |             37 |           581 |            1276 |    249 |         0 |     0 |    174 |        96 | 63.7575 |     91 |        72 | 35.5402 |     38 |        60 | 19.4539 |      9 |        59 | 10.2402 |      5 |        25 | 12.6372 |      1 |        43 | NULL    | NULL   | NULL      | NULL    |      2 |        27 | 4.94975 |       3 |         17 | 12.2202 |       1 |         28 | NULL    | 3       | 21         | 4.04145 |\n+-----------+----------------+---------------+-----------------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+---------+---------+------------+---------+---------+------------+---------+\n</code></pre>\n\n<p>I need to add another column that gives the <code>TOTAL AVERAGE TEST FREQUENCY</code> per client_id. </p>\n\n<p>Another words, I would like to get the average of all the patients per client. </p>\n\n<p>the formula to get the average test frequency is:</p>\n\n<pre><code>(max(received_date) - min(received_date) )/ (count(distinct test_id)-1)\n</code></pre>\n\n<p>I need to get the average of above per patient per client, how do I do it?</p>\n\n<p>Thank you so much for your guidance.</p>\n\n<p>here's my current query that returned the above dataset:</p>\n\n<pre><code>with counted as(\n SELECT\n    client_id,\n    --case when COUNT(*)&gt;=12 then 12 else COUNT(*) end  TimesTested, \n    COUNT(*) as timestested,\n    case when count(*)&gt;1 then\n    (datediff(day,MIN(received_date),max(received_date)))\n  /(COUNT(*)-1) \n else\n 0\n end as testfreq\n  FROM f_accession_daily\n  GROUP BY\n    client_id,\n    patient_id    \n\n),counted2 as (\n  SELECT\n    client_id,\n   TimesTested,\n    CAST(COUNT(*) AS varchar(30)) AS count,\n    CAST(AVG(testfreq) as varchar(30)) as TestFreq,\n    CAST(STDEV(TestFreq) as varchar(30)) Stdv\n  FROM counted\n  GROUP BY\n    client_id,\n    TimesTested\n    )\n    ,\nunpivoted AS (\n  SELECT\n    client_id,\n    ColumnName + CAST(TimesTested AS varchar(10)) AS ColumnName,\n    ColumnValue\n  FROM counted2\n  UNPIVOT (\n    ColumnValue FOR ColumnName IN (count, TestFreq,stdv)\n  ) u\n),\npivoted AS (\n  SELECT\n    client_id clientid,\n    count1, TestFreq1,stdv1,\n    count2, TestFreq2,stdv2,\n    count3, TestFreq3,stdv3,\n    count4, TestFreq4,stdv4,\n    count5, TestFreq5,stdv5,\n    count6, TestFreq6,stdv6,\n    count7, TestFreq7,stdv7,\n    count8, TestFreq8,stdv8,\n    count9, TestFreq9,stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n  FROM unpivoted\n  PIVOT (\n    MAX(ColumnValue) FOR ColumnName IN (\n      count1,TestFreq1,stdv1,\n      count2,TestFreq2,stdv2,\n      count3,TestFreq3,stdv3,\n      count4,TestFreq4,stdv4,\n      count5,TestFreq5,stdv5,\n      count6,TestFreq6,stdv6,\n      count7,TestFreq7,stdv7,\n    count8, TestFreq8,   stdv8,\n    count9, TestFreq9,   stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n    )\n  ) p\n)\n,\nPatientStats as\n(\n select \n distinct\n f.client_id\n ,datediff(MM,c.mlis_date_established,GETDATE()) MonthsCustomer\n ,count(distinct patient_id) TotalPatients\n ,count(distinct accession_id) Totalaccessions\n from F_ACCESSION_DAILY f\n left join D_CLIENT c\n on f.CLIENT_ID=c.CLIENT_ID\n group by f.client_id,c.mlis_date_established\n)\n,\nOver12\nas\n(\nselect client_id,SUM(c) sumcount from\n(\nselect CLIENT_ID,COUNT(*) c\nfrom F_ACCESSION_DAILY\ngroup by CLIENT_ID,PATIENT_ID\nhaving count(*)&gt;12\n) a\ngroup by client_id\n)\n, final as (\nSELECT p.*,pivoted.*,Over12.sumcount SumofGreaterThan12\nFROM pivoted\nleft join PatientStats p\non p.CLIENT_ID=pivoted.CLIENTID\nleft join Over12\non over12.CLIENT_ID=p.CLIENT_ID\nwhere p.CLIENT_ID not in (select CLIENTid from SalesDWH..TestPractices)\n)\n/* Get the data into a temp table */\nSELECT * INTO #TempTable\nFROM final\n/* Drop the cloumns that are not needed */\nALTER TABLE #TempTable\nDROP COLUMN clientid\n/* Get results and drop temp table */\nSELECT * FROM #TempTable\norder by 1 \nDROP TABLE #TempTable\n</code></pre>\n"},{"tags":["sql-server","activex","dts"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13095081,"title":"How stop a DTS from ActiveX Task?","body":"<p><img src=\"http://subir.cc/images/ros.png\" alt=\"a busy cat](![a busy cat\">\n!\n)</p>\n\n<p>That sentence does not work. I want my dts abort when a one packed get failed. </p>\n\n<pre><code>'**********************************************************************\n'  Visual Basic ActiveX Script\n'************************************************************************\n\nFunction Main()\n    Main = DTSTaskExecResult_Failure\nEnd Function\n</code></pre>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13091505,"title":"SQL Server - Reference a column by name in agrregate function","body":"<p>Our application uses a series of tables with many varchar(1000) columns in them. During development of the system, that was considered to be more than enough space for the users to enter text. However, now we're encountering problems with text being cut off, so it seems like some users are entering more text that it can hold. However, I believe that there's rampant misuse of these fields, and I want to see which columns are being used.</p>\n\n<p>From a different question that was answered here on SO, I've come up with the following query to extract the names of the varchar columns in a table:</p>\n\n<pre><code>select\n   syscolumns.name as [Column],\n   syscolumns.length as [MaxLength]\nfrom \n   sysobjects, syscolumns \nwhere sysobjects.id = syscolumns.id\nand   sysobjects.xtype = 'u'\nand   sysobjects.name = 'TableWithTooManyVarcharColumns'\nand syscolumns.xusertype = 167\n</code></pre>\n\n<p>but now I want to use the names of these columns in a new query, and calculate </p>\n\n<pre><code>SELECT \n[Column] as [Name],\n[MaxLength],\nMAX(LEN([Column])) as [MaxUsedLength],\nAVG(LEN([Column])) as [AvgUsedLength],\nSTDEV(LEN([Column])) as [StdDev]\nFROM TableWithTooManyVarcharColumns\nINNER JOIN **{{ reference to table from query above }}**\n</code></pre>\n\n<p>Of course, the first query returns the name of the column, while the second one needs a reference to the column, so I'm not sure how to combine them properly. Any SQL Server gurus able to help?</p>\n"},{"tags":["sql-server","sql-server-agent"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1913,"score":3,"question_id":5407817,"title":"The proper way to disable/enable SQLServer Agent Jobs","body":"<p>I have a number of SQLServer agent scheduled jobs, one of them performs a full database backup. I want to disable some other jobs when backup begins and re-enable them once backup is done. What is the right way to do so?  I was thinking about adding one of the following tsql commands to the first step of the backup task (and respective enable commands to the last step), but I cannot find which one is better (or maybe there is another way).</p>\n\n<pre><code>UPDATE MSDB.dbo.sysjobs\nSET Enabled = 0\nWHERE [Name] IN (....)\n</code></pre>\n\n<p>Or a number of <code>EXEC dbo.sp_update_job</code> ?<br>\nThanks.</p>\n"},{"tags":["sql-server","sql-server-2008","indexed-view"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2410,"score":3,"question_id":3501825,"title":"SQL Server Create View Index which contains distinct or group by","body":"<p>I have a table of address data in my SQL server database. This table is not normalized so it contain many addresses the are repeated. Each unique address can be identified by an Id field (these ids repeat often in the table).</p>\n\n<p>So i created a view on the table to extract all the unique addresses, using Select Distinct(AddressId) from the original table.</p>\n\n<p>Now i would like to create an index on this view to increase the speed of searching, but SQL server is not allowing me to create an index on the view as it contains a distinct or group by (i have tried both to see if it would allow me create index)</p>\n\n<p>Has anyone got any solution around this? or any views to an alternate way to do this.</p>\n\n<p>I need to query this view based on address keywords and return the ones based on the matching count, i have this query in place i'm trying to speed it up by indexing fields in the view.</p>\n\n<p>SQL Server 2008</p>\n\n<pre><code>SELECT      \n    AddressId,  \n    AddressNumber,  \n    AddressName, \n    Town, \n        City,\n        Country,\n    COUNT_BIG(*) As AddCount--,\n    --TRIM(AddressNumber + ' ') + LTRIM(AddressName + ' ')  + LTRIM(Town + ' ') + RTRIM(City + ' ') AS AddressLookup\nFROM\n    [Address] A\nGROUP BY\n    AddressId,\n    AddressNumber, \n    AddressName, \n    Town, \n    City, \n    Country\n</code></pre>\n\n<p>is my query....</p>\n\n<p>if i take out the column with AddressLookup i can add the indexes</p>\n\n<p>Cheers</p>\n"},{"tags":["sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3080,"score":1,"question_id":3127554,"title":"can we write update and delete queries in views?","body":"<pre><code>i have a doubt, in sql server 2005 views. views created by using select statement.\n</code></pre>\n\n<p>can we write update and delete statements in views .</p>\n"},{"tags":["sql-server","output-clause"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13094099,"title":"SQL Server: Multiple Output Clauses","body":"<p>I have two tables, <code>Table_1</code> and <code>Table_2</code>. </p>\n\n<p><code>Table_1</code> has columns <code>PK</code> (autoincrementing <code>int</code>) and <code>Value</code> (<code>nchar(10)</code>). </p>\n\n<p><code>Table_2</code> has <code>FK</code> (<code>int</code>), <code>Key</code> (<code>nchar(10)</code>) and <code>Value</code> (<code>nchar(10)</code>). </p>\n\n<p>That is to say, <code>Table_1</code> is a table of data and <code>Table_2</code> is a key-value store where one row in <code>Table_1</code> may correspond to 0, 1 or more keys and values in <code>Table_2</code>.</p>\n\n<p>I'd like to write code that programmatically builds up a query that inserts one row into <code>Table_1</code> and a variable number of rows into <code>Table_2</code> using the primary key from <code>Table_1</code>.</p>\n\n<p>I can do it easy with one row:</p>\n\n<pre><code>INSERT INTO Table_1 ([Value])\nOUTPUT INSERTED.PK, 'Test1Key', 'Test1Val' INTO Table_2 (FK, [Key], [Value])\nVALUES ('Test')\n</code></pre>\n\n<p>But SQL doesn't seem to like the idea of having multiple rows. This fails:</p>\n\n<pre><code>INSERT INTO Table_1 ([Value])\nOUTPUT INSERTED.PK, 'Test1Key', 'Test1Val' INTO Table_2 (FK, [Key], [Value])\nOUTPUT INSERTED.PK, 'Test2Key', 'Test2Val' INTO Table_2 (FK, [Key], [Value])\nOUTPUT INSERTED.PK, 'Test3Key', 'Test3Val' INTO Table_2 (FK, [Key], [Value])\nVALUES ('Test')\n</code></pre>\n\n<p>Is there any way to make this work?</p>\n"},{"tags":["sql","sql-server","database","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1922,"score":2,"question_id":2561280,"title":"SQL left join with multiple rows into one row","body":"<p>Basically, I have two tables, Table A contains the actual items that I care to get out, and Table B is used for language translations.</p>\n\n<p>So, for example, Table A contains the actual content. Anytime text is used within the table, instead of storing actual varchar values, ids are stored that relate back to text stored in Table B. This allows me to by adding a languageID column to Table B, have multiple translations for the same row in the database.</p>\n\n<p>Example:</p>\n\n<h2>Table A</h2>\n\n<ul>\n<li>Title (int) </li>\n<li>Description (int)</li>\n<li>Other Data....</li>\n</ul>\n\n<h2>Table B</h2>\n\n<ul>\n<li>TextID (int) - This is the column\nwhose value is stored in other tables</li>\n<li>LanguageID (int)</li>\n<li>Text (varchar)</li>\n</ul>\n\n<p>My question is more a call for suggestions on how to best handle this. Ideally I want a query that I can use to select from the table, and get the text as opposed to the ids of the text out of the table. Currently when I have two text items in the table this is what I do:</p>\n\n<pre><code>SELECT C.ID, C.Title, D.Text AS Description\nFROM\n(SELECT A.ID, A.Description, B.Text AS Title\nFROM TableA A, TranslationsTable B\nWHERE A.Title = B.TextID AND B.LanguaugeID = 1) C\nLEFT JOIN TranslationsTable D\nON C.Description = D.TextID AND D.LanguaugeID = 1\n</code></pre>\n\n<p>This query gives me the row from Table A I am looking for (using where statements in the inner select statement) with the actual text based on the language ID used instead of the text ids.</p>\n\n<p>This works fine when I am only using one or two text items that need to be translated, but adding a third item or more, it starts to get really messy - essentially another left join on top of the example.</p>\n\n<p>Any suggestions on a better query, or at least a good way to handle 3 or more text items in a single row?</p>\n\n<p>Per suggestions, I've added an example of the two tables:</p>\n\n<pre><code>    Table A  \n    ---------------------------\n    ID    |Title    |Description  \n    ---------------------------  \n    1     |1        |2  \n    ---------------------------  \n    2     |3        |4  \n    --------------------------- \n\n    Table B (Translations Table) \n    ---------------------------\n    ID    |LanguaugeID|Text  \n    ---------------------------  \n    1     |1        |Here is title one\n    ---------------------------  \n    1     |2        |Here is a title one in espanol\n    ---------------------------\n    2     |1        |Here is description one\n    ---------------------------  \n    2     |2        |Here is description one in espanol\n    ---------------------------\n    3     |1        |Title 2\n    ---------------------------  \n    4     |1        |Description 2\n    ---------------------------   \n</code></pre>\n\n<p>What I want is to be able to pull a row out of table A that already has the text from table B, not just the ids - and to be able to do this for several columns that need translations.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","null"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":74,"score":-4,"question_id":13092010,"title":"Alter every column in the database to disallow nulls in a SQL Server database","body":"<p>I've been struggling with the following problem;</p>\n\n<p>We have a large database with 2000+ columns and we have allowed nulls in the majority of them.\nNow I need a script that goes through all the columns and sets all the null values to a default value and alters the column to disallow nulls while setting the default.</p>\n\n<p>I need a script to do this for all the different datatypes (<code>nvarchar</code>, <code>int</code>, <code>smallint</code>, <code>datetime</code> etc).</p>\n\n<p>The reason I'm doing this is that I'm migrating the code to .net and it's a pain to handle all the null values that shouldn't be nulls.</p>\n\n<p>Also: <a href=\"http://www.bennadel.com/blog/85-Why-NULL-Values-Should-Not-Be-Used-in-a-Database-Unless-Required.htm\" rel=\"nofollow\">http://www.bennadel.com/blog/85-Why-NULL-Values-Should-Not-Be-Used-in-a-Database-Unless-Required.htm</a>\nand: <a href=\"http://msdn.microsoft.com/en-us/library/ms189265(v=sql.105).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms189265(v=sql.105).aspx</a></p>\n\n<p>Thanks for your time. :)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":13092682,"title":"SSIS package - loop through different connections for Execute SQL task","body":"<p>I am creating an MSSQL2008 SSIS package to generate and email reports from database tables. It works perfectly on a single database.  The client is running 3 different databases used by 3 different divisions.  The database structure is exactly the same. All three databases are located on the same server, same security / credentials are used.</p>\n\n<p>I created a \"For Each Loop Container\" in my SSIS package that loops through the list of 3 items and populates it into a variable.  How do I now take that and pass it to the \"Execute SQL Task\" to run three times (once for each database)?</p>\n\n<p>Thank you for your time!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13088856,"title":"SQL Server : add CSV programmable","body":"<p>I have the following code to insert a CSV file into a temp table:</p>\n\n<pre><code>USE [websitehere.com].[dbo]\nGO\nCREATE TABLE [websitehere.com].[dbo].[tmpTable]\n(ID INT,\n    Caller_Number VARCHAR(100),\n    Caller_Name VARCHAR(100),\n    GroupBy VARCHAR(100),\n    Campaign_Name VARCHAR(100),\n    DateAndTime VARCHAR(100),\n    Duration VARCHAR(100),\n    Call_Status VARCHAR(100))\nGO;\n\nBULK\nINSERT tmpTable \nFROM 'C:\\Users\\namehere\\Documents\\CallLog.csv' \nWITH\n(\n    FIELDTERMINATOR = ',',\n    ROWTERMINATOR = '\\n'\n)\nGO\n</code></pre>\n\n<p>But...</p>\n\n<ol>\n<li><p>It does not seem to add the <code>tmpTable</code>. It gives me an error </p>\n\n<blockquote>\n  <p><em>Msg 102, Level 15, State 1, Line 1<br>\n  Incorrect syntax near '.'.</em></p>\n</blockquote></li>\n<li><p>It won't add the insert command saying that</p>\n\n<blockquote>\n  <p><em>Msg 4834, Level 16, State 4, Line 8<br>\n  You do not have permission to use the bulk load statement.</em></p>\n</blockquote></li>\n</ol>\n\n<p>Any help would be great to take care of these 2 errors!</p>\n\n<p><strong>Update</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/Hxv6A.png\" alt=\"db user secutirys\"></p>\n"},{"tags":["asp.net","sql-server","parsing","localization","decimal"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":13092666,"title":"Decimal conversion from vb.net to store in SQL Server","body":"<p>I have this piece of code</p>\n\n<pre><code>Dim lt As Decimal\nDim lg As Decimal\nDecimal.TryParse(tbLat.Value.Replace(\".\", \",\"), lt)\nDecimal.TryParse(tbLng.Value.Replace(\".\", \",\"), lg)\ncom.Parameters.AddWithValue(\"latitude\", lt)\ncom.Parameters.AddWithValue(\"longtitude\", lg)\n</code></pre>\n\n<p>in which I am trying to store the <code>lt</code> and <code>lg</code> parameters in column <code>decimal(9,6)</code>.</p>\n\n<p>In the local SQL Server it worked fine, but when I deployed in to my web server it gave me this error  </p>\n\n<blockquote>\n  <p><em>Arithmetic overflow error converting numeric to data type numeric. The statement has been terminated.</em></p>\n</blockquote>\n\n<p>I decided to increase the precision to 16 so the column became <code>decimal(16,6)</code>. Now it stores the whole number like that 25252525.000000!</p>\n\n<p>Probably is matter of localize, but my question is how to avoid localization and store the number safely?</p>\n"},{"tags":["sql","sql-server","temptables"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13093678,"title":"Dropping indexes of global temp table in SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/91856/tsql-are-indexes-on-temporary-tables-deleted-when-the-table-is-deleted\">TSQL: Are indexes on temporary tables deleted when the table is deleted?</a>  </p>\n</blockquote>\n\n\n\n<p>How do you manually drop an index of a global temp table in SQL Server?</p>\n\n<p>EDIT: Do you even need to if you manually drop the table?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13093585,"title":"When selecting function list from SQL Server 2008, Routine_body=External but all other data NULL","body":"<p>I'm attempting to get a list and definition of user defined functions within 3 different databases to combine into a single database.  </p>\n\n<p>I have the select statement that lists the 3 user defined functions but when I run it the <code>ROUTINE_BODY</code> column shows <code>'EXTERNAL'</code> but <code>EXTERNAL_NAME</code> and <code>EXTERNAL_LANGUAGE</code> is <code>NULL</code> (as well as <code>ROUTINE_DEFINITION</code> which it should be for an <code>EXTERNAL</code> routine).</p>\n\n<pre><code>SELECT * \nFROM INFORMATION_SCHEMA.ROUTINES \nWHERE ROUTINE_TYPE = 'FUNCTION'  \n</code></pre>\n\n<p>This gives me back the database, routine name, everything I need except for the actual definition of the function.  Can anyone help me with where SQL Server may be storing the SQL for the functions?</p>\n"},{"tags":["sql","sql-server","xml","xpath","xquery"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":96,"score":1,"question_id":12624798,"title":"Finding related XML elements filtering on attribute from current element in XPath","body":"<p>How can the following statement best be modified so that I receive a list of Contact.Name with Address.Location (I'd like to use XPath and not subqueries/WHERE-conditions if possible)? I've tried all sorts of syntax at @@@Name but no luck :( - I want to reference the original node there.</p>\n\n<pre><code>DECLARE @data AS XML\nSELECT @data = '\n    &lt;Data&gt;\n        &lt;Contact Name=\"John\"/&gt;\n        &lt;Contact Name=\"Bob\"/&gt;\n        &lt;Address ContactName=\"John\" Location=\"JohnStreet1\"/&gt;\n        &lt;Address ContactName=\"John\" Location=\"JohnStreet2\"/&gt;\n        &lt;Address ContactName=\"Bob\" Location=\"BobStreet1\"/&gt;\n    &lt;/Data&gt; \n'\n\nSELECT \n    x.v.value('@Name','VARCHAR(255)') [Contact.Name],   \n    y.v.value('@Location','VARCHAR(255)') [Address.Location]\nFROM \n    @data.nodes('/Data[1]/Contact') AS x(v)\nCROSS APPLY\n    x.v.nodes('/Data[1]/Address[@ContactName=@@@Name]') AS y(v)\nORDER BY\n    x.v.value('@Name','VARCHAR(255)')\n</code></pre>\n\n<p>PS. This won't work since the parameter needs to be a literal :(</p>\n\n<pre><code>x.v.nodes('/Data[1]/Address[@ContactName=' + x.v.value('@Name','VARCHAR(255)') + ']') AS y(v)\n</code></pre>\n\n<p>Please note: Currently I'm doing the following to get the desired resultset (but not in a <em>clean XPath way</em>):</p>\n\n<pre><code>SELECT \n    x.v.value('@Name','VARCHAR(255)') [Contact.Name],   \n    y.v.value('@Location','VARCHAR(255)') [Address.Location]\nFROM \n    @data.nodes('/Data[1]/Contact') AS x(v)\nCROSS APPLY\n    x.v.nodes('/Data[1]/Address') AS y(v)\nWHERE\n    y.v.value('@ContactName','VARCHAR(255)')=x.v.value('@Name','VARCHAR(255)')\nORDER BY\n    x.v.value('@Name','VARCHAR(255)')\n</code></pre>\n"},{"tags":["sql-server","monitor"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13093962,"title":"Monitoring Cluster failover Through SCOM","body":"<p>I want to monitor a whenever my cluster failsover via SCOM.\nThe problem is as a DBA I just want to be notified when the current failover cluster is a SQL server and should not be notified for other casses. Currently an e-mail is generated whenever any cluster failsover and is sent to particular group. I want to add another rule which would notify DBA team when the failover cluster is an SQL server.\nI am also open to any other way not using SCOM.\nI have ruled out the option of monitoring server agent restart status as it accurately doesnot identify Failover.\nAs always all the help is greatly appreciated.</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":13093913,"title":"Significance of 8% character sequence in SQL Server","body":"<p>Is there something special about the character sequence of 8% in SQL Server?</p>\n\n<p>I can't for the life of me figure out how the following query returns %H539 instead of %H5398%</p>\n\n<pre><code>DECLARE @contractnumber AS VARCHAR(5) = 'H5398'\nif(@contractNumber is not null) set @contractNumber = '%' + @contractNumber + '%'\nPRINT @contractnumber\n</code></pre>\n"},{"tags":["sql-server","xml","tsql","xpath","xquery"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2039,"score":1,"question_id":711025,"title":"SQL Server XML Query Advice","body":"<p>I'm writing a user-defined function to extract values from an XML column in SQL Server which represents a simple dictionary of string key-value pairs.  The only way I've made it work so far seems overly complex.  Do you have any simplifying suggestions or tips for the <code>DictValue</code> function below?</p>\n\n<pre><code>IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[DictValue]') AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))\nDROP FUNCTION [dbo].[DictValue]\ngo\n\nIF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[TableWithXmlColumn]') AND type in (N'U'))\nDROP TABLE [dbo].[TableWithXmlColumn]\ngo\n\ncreate table TableWithXmlColumn (\n\tId int identity primary key\n\t,Dict xml\n\t)\ngo\n\ncreate function DictValue(\n\t@id int\n\t,@key nvarchar(max)\n\t) returns nvarchar(max) as begin\n\n\tdeclare @d xml -- string Dictionary\n\tselect @d = Dict from TableWithXmlColumn where Id = @id\n\tdeclare @value xml\n\tselect \n\t\t\t@value = d.Pair.value('data(.)', 'nvarchar(max)')\n\t\tfrom \n\t\t\t@d.nodes('/StringDictionary/Pair') as d(Pair)\n\t\twhere \n\t\t\t@key = d.Pair.value('./@Key', 'nvarchar(max)')\n\n\treturn convert(nvarchar(max), @value)\n\tend\ngo\n\ndeclare @xmlId int\ninsert TableWithXmlColumn (Dict) values (\n\tN'&lt;?xml version=\"1.0\" encoding=\"utf-16\"?&gt;\n\t&lt;StringDictionary&gt;\n\t  &lt;Pair Key=\"color\"&gt;red&lt;/Pair&gt;\n\t  &lt;Pair Key=\"count\"&gt;123&lt;/Pair&gt;\n\t&lt;/StringDictionary&gt;')\nset @xmlId = scope_identity()\n\nselect \n\tdbo.DictValue(@xmlId, 'color') as color\n\t,dbo.DictValue(@xmlId, 'count') as [count]\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13093773,"title":"Add clients with same name and add it to a different table","body":"<p>I have one table with the following data:</p>\n\n<p>Table 1:</p>\n\n<pre><code>CUSIP DESC QUANTITY\n\n1     ABC    300\n\n1     ABC    400\n\n1     ABC    500\n</code></pre>\n\n<p>I want to move this data into Table 2 but add the quantity if the cusip, and desc are the same</p>\n\n<p>Table 2:</p>\n\n<pre><code>CUSIP DESC QUANTITY\n\n1     ABC    1200\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13080543,"title":"SQL Server select for update empty value","body":"<p>Hi I tried to update an image in a <code>varbinary</code> column with the following example <a href=\"http://stackoverflow.com/questions/1643627/how-to-insert-a-blob-into-a-database-using-sql-server-management-studio\">How to insert a blob into a database using sql server management studio</a>  </p>\n\n<p>Yet to do a select after doing update the <code>varbinary</code> column is blank, any idea why this happens? </p>\n\n<pre><code>UPDATE digital_files\n   SET digital_file = (\n        SELECT *\n          FROM OPENROWSET( BULK N'C:\\Program Files (x86)\\Apache Software Foundation\\Apache Tomcat 6.0.26\\bin\\celebrity-pictures-spongebob-patrick-meth-that.jpg',\n                           SINGLE_BLOB) AS IMAGE)\nWHERE digital_id = 1\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","query","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13092702,"title":"How to iterate this SQL Query?","body":"<p>I've got this query: </p>\n\n<pre><code>SELECT TOP 1 A.ExamTemplateId, A.Id AS AnsweredTestId, AVG(B.Score) AS AvgScore, A.[Date]\nFROM AnsweredTest AS A\nINNER JOIN AnsweredWorksheet AS B ON (A.Id = B.AnsweredTestId)\nWHERE A.StudentId = 'OPA-3DKCL2' AND A.ExamTemplateId = 1\nGROUP BY A.Id, A.ExamTemplateId, A.[Date]\nORDER BY AvgScore DESC\n</code></pre>\n\n<p>Please check that I have a <code>WHERE</code> condition which receives a static number. The query result is:</p>\n\n<p>EXAMPLE 1\n<img src=\"http://i.stack.imgur.com/EZqHP.png\" alt=\"\"></p>\n\n<p>EXAMPLE 2\n<img src=\"http://i.stack.imgur.com/mAdO8.png\" alt=\"enter image description here\"></p>\n\n<p>And it is correct! But now, I'd like to show all the records from a ExamTemplate table. But now I don't know how can I accomplish that. I was thinking creating a function but I'm not sure, it's just an idea.</p>\n\n<p>The final output which I'd like to receive is the union of last records:</p>\n\n<pre><code>1   1   0.7 2012-10-21 19:50:11.697\n2   10  0.555555555555556   2012-10-22 18:58:24.163\n</code></pre>\n\n<p>Thanks in advance.</p>\n\n<p>UPDATE:</p>\n\n<p>I've got highlighted with yellow color the rows which I'm interested. I set in the last query <code>TOP 1</code> because I want to get the highest average score by <code>ExamTemplateId</code>. And that's will be all.</p>\n\n<p><img src=\"http://i.stack.imgur.com/VUALu.png\" alt=\"enter image description here\"></p>\n"},{"tags":["mysql","sql-server","mysqldump"],"answer_count":4,"favorite_count":3,"up_vote_count":7,"down_vote_count":0,"view_count":10029,"score":7,"question_id":2621682,"title":"Import MySQL database into a MS SQL Server","body":"<p>I have a .sql file from a MySQL dump containing tables definitions and the data to be inserted in this tables. How can I convert this database represented in the dump file into a MS SQL server database?</p>\n"},{"tags":["sql","sql-server","unpivot"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":13092867,"title":"SQL Server 2008 : Convert column value to row","body":"<p>I have a table in the following format</p>\n\n<pre>\nCountry_Code | 1960 | 1961 | 1962 | ..... | 2011\n------------------------------------------------\nIND          | va11 | va12 | va13 | ..... | va1x\nAUS          | va21 | va22 | va23 | ..... | va2x\nENG          | va31 | va32 | va33 | ..... | va3x\n</pre>\n\n<p>I want to convert it into the below format</p>\n\n<pre>\nCountry_Code | Year | Value\n---------------------------\nIND          | 1960 | va11\nIND          | 1961 | va12\nIND          | 1962 | va13\n.\n.\nIND          | 2011 | va1x\nAUS          | 1960 | va21\nAUS          | 1961 | va22\nAUS          | 1962 | va23\n.\n.\nAUS          | 2011 | va2x\nENG          | 1960 | va31\nENG          | 1961 | va32\nENG          | 1962 | va33\n.\n.\nENG          | 2011 | va3x\n\n</pre>\n\n<p>How can this be achieved by sql query or sql server assembly ?</p>\n"},{"tags":["sql-server","sql-server-2005","temporary-tables","alter-table"],"answer_count":5,"favorite_count":4,"up_vote_count":40,"down_vote_count":0,"view_count":72889,"score":40,"question_id":659051,"title":"check if temp table exist and delete if it exists before creating a temp table","body":"<p>I am using the following code to check if the temp table exists and drop the table if it exists before creating again. It works fine as long as I don't change the columns. If I add a column later, it will give an error saying \"invalid column\". Please let me know what I am doing wrong.</p>\n\n<pre><code>IF OBJECT_ID('tempdb..#Results') IS NOT NULL\n    DROP TABLE #Results\n\nCREATE TABLE #Results\n(\n    Company             CHAR(3),\n    StepId              TINYINT,    \n    FieldId             TINYINT,\n)\n\nselect company, stepid, fieldid from #Results\n</code></pre>\n\n<p>If I run the above code, it works fine. Now let's say I add a column fieldname and use that field in the select statement, it gives an error. </p>\n"},{"tags":["sql-server","sql-server-2008","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12936672,"title":"Table design with joining tables or separate ID in main table","body":"<p>I'm designing a database that has a couple of tables; FAQ's, Bulletins, and Attachments.  Bulletins and FAQ's could have an attachment associated with them, so my initial thought was to create a joining table with the two primary keys as a composite key:</p>\n\n<pre><code>Bulletin\n--------\nBulletinID\nSubject\nDescription\nNotes\n\nAttachment\n-----------\nAttachmentID\nFileName\nFilePath\netc.\n</code></pre>\n\n<p>Joining table:</p>\n\n<pre><code>BulletinAttachments\n-------------------\nBulletinID\nAttachmentID\n</code></pre>\n\n<p>As I design this, I also thought, what if other entities are introduced later (say Newsletter, Email, etc.) that need Attachments as well.  I would have to create a joining table for each of these entities.  Not awful, but it made me think, what if I got rid of the joining tables and put an AttachmentType in the Attachment table and then assigned the type accordingly:</p>\n\n<pre><code>AttachmentType\n--------------\nAttachmentTypeID\nAttachmentType\nDescription\n</code></pre>\n\n<p>The data in that table would be:<br>\n1-Bulletin<br>\n2-FAQ<br>\n3-Newsletter<br>\n4-Email</p>\n\n<p>Then the Attachment table would hold the AttachmentTypeID to identify it:</p>\n\n<pre><code>Attachments\n-----------\nAttachmentID\nAttachmentTypeID\nFileName\nFilePath\netc.\n</code></pre>\n\n<p>So my question is, for performance wise (using SQL 2008 R2), is there a better choice between the two?  Is there a better way to design this?  My concern with using individual joining tables is that we may have more entities come along and to accommodate Attachments, we would have to create a joining table and on our front-end software, we would have to write logic for it whereas the AttachmentTypeID would allow the front-end to insert a new AttachmentType and no db interaction would be needed.</p>\n"},{"tags":["sql-server","ssis","export-to-excel"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":88,"score":1,"question_id":13088974,"title":"Running an SSIS Package using dtexec","body":"<p>I'm running an SSIS package using dtexec. The package runs fine in BIDS on my system. When I create an SQL server agent job to run the package on a schedule. The package running step is scheduled as a T-SQL task, not an SSIS package one). The job reports no error, but it's not even creating the output excel file @ my desired destination on the server.</p>\n\n<p>Furthermore, when I separately run the command in command shell, it's returning me the errors shown below. Intermittently, it'll also return errors on the FileSystem Task that I use to copy files, saying that either the source or destination doesn't exist!! When the same variable values work for me in BIDS, why is the SQL job failing?</p>\n\n<pre><code>Started:  7:33:27 PM\nError: 2012-10-26 19:33:27.60\n   Code: 0xC0016016\n   Source:\n   Description: Failed to decrypt protected XML node \"DTS:Password\" with error 0\nx8009000B \"Key not valid for use in specified state.\". You may not be authorized\nto access this information. This error occurs when there is a cryptographic err\nor. Verify that the correct key is available.\nEnd Error\nError: 2012-10-26 19:33:27.78\n   Code: 0xC00F9304\n   Source: GICSReport Connection manager \"Excel Connection Manager\"\n   Description: SSIS Error Code DTS_E_OLEDB_EXCEL_NOT_SUPPORTED: The Excel Conne\nction Manager is not supported in the 64-bit version of SSIS, as no OLE DB provi\nder is available.\nEnd Error\nError: 2012-10-26 19:33:27.78\n   Code: 0xC020801C\n   Source: Data Flow Task Excel Destination [22]\n   Description: SSIS Error Code DTS_E_CANNOTACQUIRECONNECTIONFROMCONNECTIONMANAG\nER.  The AcquireConnection method call to the connection manager \"Excel Connecti\non Manager\" failed with error code 0xC00F9304.  There may be error messages post\ned before this with more information on why the AcquireConnection method call fa\niled.\nEnd Error\nError: 2012-10-26 19:33:27.78\n   Code: 0xC0047017\n   Source: Data Flow Task SSIS.Pipeline\n   Description: component \"Excel Destination\" (22) failed validation and returne\nd error code 0xC020801C.\nEnd Error\nError: 2012-10-26 19:33:27.78\n   Code: 0xC004700C\n   Source: Data Flow Task SSIS.Pipeline\n   Description: One or more component failed validation.\nEnd Error\nError: 2012-10-26 19:33:27.79\n   Code: 0xC0024107\n   Source: Data Flow Task\n   Description: There were errors during task validation.\nEnd Error\nDTExec: The package execution returned DTSER_FAILURE (1).\nStarted:  7:33:27 PM\nFinished: 7:33:27 PM\nElapsed:  0.343 seconds\n</code></pre>\n\n<p>Pls help! :) .... Should i be adding all the variables, connection managers, and everything to my config file? currently i've only added some ppty values of the variables and connection managers, but no combo seems to work effectively.</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":129,"score":1,"question_id":10388041,"title":"How to close existing connections to a DB","body":"<p>I want to close the existing connections to an MS SQL Server so that I can do a restore on that database programatically.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13091072,"title":"How to find the SUM of the Calculated Percentage Column in SQL","body":"<p>I have a Column which calculates the Percentage , like this</p>\n\n<pre><code>Convert(decimal(5,2),(PatCount*100)/@PatientCount) as Per\n</code></pre>\n\n<p>Now i want the Total Sum of the above calculated Percentage. So i tried doing this,</p>\n\n<pre><code>,SUM(Convert(decimal(5,2),(PatCount*100)/@PatientCount)) as pa\n</code></pre>\n\n<p>But i am not geting the Desired Result . For ex </p>\n\n<pre><code>Per %    Total %\n6.00     6.00\n7.00     7.00\n85.00    85.00\n</code></pre>\n\n<p>I want the total Col to print as 98%.  Please can Somebody help me with this.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13090690,"title":"MS SQL REPLACE not showing results","body":"<p>Hey all i have the following query:</p>\n\n<pre><code>SELECT REPLACE(REPLACE(REPLACE(REPLACE(tmpTable.Caller_Number,'-',''),'(',''),')',''),' ','') \nFROM tmpTable \nWHERE EXISTS \n(SELECT REPLACE(REPLACE(REPLACE(REPLACE(OnlineAppDetails.addPhone,'-',''),'(',''),')',''),' ','') \nFROM OnlineAppDetails \nWHERE OnlineAppDetails.addPhone = tmpTable.Caller_Number)\nORDER BY GroupsBy ASC;\n</code></pre>\n\n<p>It returns no records... However, when i do this query:</p>\n\n<pre><code>SELECT * \nFROM tmpTable \nWHERE EXISTS \n(SELECT * FROM OnlineAppDetails \nWHERE SUBSTRING(OnlineAppDetails.addPhone,2,3)+'-'+SUBSTRING(OnlineAppDetails.addPhone,7,4)+SUBSTRING(OnlineAppDetails.addPhone,11,4) = tmpTable.Caller_Number)\nORDER BY GroupsBy ASC;\n</code></pre>\n\n<p>It returns records..</p>\n\n<p>The phome number is formatted like:</p>\n\n<pre><code>for OnlineAppDetails: (xxx) xxx-xxxx\nfor         tmpTable: xxx-xxx-xxxx\n</code></pre>\n\n<p>All i am doing is taking out the <strong>- ( ) and [space]</strong> in the phone number just to be sure i am being returned all the records i should be. I know there are matches in both tables so taking out <strong>- ( ) and [space]</strong> should still result in records returned.</p>\n\n<p><strong>update</strong></p>\n\n<p>Duh.... knew it was going to be simple.</p>\n\n<pre><code>SELECT * \nFROM tmpTable \nWHERE EXISTS \n(SELECT * \nFROM OnlineAppDetails \nWHERE  REPLACE(REPLACE(REPLACE(REPLACE(OnlineAppDetails.addPhone,'-',''),'(',''),')',''),' ','') = REPLACE(REPLACE(REPLACE(REPLACE(tmpTable.Caller_Number,'-',''),'(',''),')',''),' ',''))\nORDER BY GroupsBy ASC;\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13091196,"title":"Filtering a dataset and fetch the records","body":"<p>I am fetching all the rows from a table and storing them in a dataset now i want to filter the dataset for duplicate names and i want to fetch the corresponding records associated with them and i have to populate them in a dropdown.</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":5085,"score":2,"question_id":2465296,"title":"t-SQL grant permission for table drop and create","body":"<p>How can I Grant some users permission to drop and create a single table only in the SQL 2005 database accessed by our VB.net 2005 Win app?</p>\n\n<p>Some articles suggest Granting Control rights to the table but I cannot make this work. If you think this is teh way to go, can you show me the correct syntax?</p>\n"},{"tags":["sql","sql-server","concurrency","background","sql-server-express"],"answer_count":7,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":3687,"score":1,"question_id":1681906,"title":"Launch multiple stored procedures to run 'in the background' on SQL Server Express Edition","body":"<p>Is it possible to run multiple stored procedures that run 'in the background'?</p>\n\n<p>The stored procedures <strong>must be launched from a single, master stored procedure</strong>, in the same way that multiple worker threads are spawned.  For example:</p>\n\n<pre><code>CREATE PROCEDURE MyLauncher\nAS\nBEGIN\n    BEGIN\n      @EXEC MyBackgroundSP01 -- Runs in parallel to the other 2\n      @EXEC MyBackgroundSP02 -- Runs in parallel to the other 2\n      @EXEC MyBackgroundSP03 -- Runs in parallel to the other 2\n    END\nEND\n</code></pre>\n"},{"tags":["c#","sql-server","entity-framework","foreign-keys"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13090735,"title":"inserting data into tables with foreign keys","body":"<p>I have 2 tables in ms sql server 2008 R2, one of which has foreign key relation to the other</p>\n\n<p>pretty simple:</p>\n\n<pre><code>tableA\nprefix nchar(10)\nvalue  nchar(50)\n\ntableB\nprefix nchar(10)\nvalue  nchar(50)\n\nALTER TABLE [dbo].[tableB]  \nWITH CHECK ADD  CONSTRAINT [FK_TableA_TableB] FOREIGN KEY([prefix])\nREFERENCES [dbo].[TableA] ([prefix])\n</code></pre>\n\n<p>I fill in data in the tables using the management studio edit table. ensuring each prefix in <code>tableB</code> has a matching prefix in <code>tableA</code>.</p>\n\n<p>Then I import the tables into visual studio C# to create an entity framework model.\nEverything seem to work fine until I start to reference data in <code>tableA</code> from <code>tableB</code> using the navigation handle, it comes up empty handed.</p>\n\n<p>i.e. <code>tableB.tableA</code>s come out as null.</p>\n\n<p>Is there a step that needs to be done to update foreign key relations in entity framework and/or ms sql server?</p>\n"},{"tags":["sql-server","reporting-services","reporting","rdlc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":269,"score":0,"question_id":9724812,"title":"How can I change the column order of a SQL Server Report Services report at runtime?","body":"<p>I would like to change the sequence of the headers/columns of an <code>*.rdlc</code> report at runtime based on e.g. user preference settings. I found that you can make some columns invisible, but I haven't found a way to change the order of the columns. I am using the ReportViewer control in an ASP.NET web page. And at runtime in this case would mean that the layout can change during two page requests. I read somewhere that you could configure the rdlc xml dynamically or use the rdl object model to create the report definition dynamically as part of the request handling.</p>\n\n<p>The following example should will hopefully explain better what I am trying to do:</p>\n\n<p>Default report column layout of a table or matrix:</p>\n\n<pre><code>Date   Item   Price\n</code></pre>\n\n<p>Dynamically changed order of columns at runtime:</p>\n\n<pre><code>Item   Price   Date\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":13090935,"title":"Update Multiple records in single query MS SQL","body":"<p>I am trying to update multiple records in the table using the temporary table using the below query, but doesn't working. Please tell me the proper way to update multiple records.</p>\n\n<pre><code>UPDATE sarufoo \nSET sarufoo.mobile = (SELECT mobile_no FROM logan) \nWHERE sarufoo.homep IN (SELECT homep FROM logan);\n</code></pre>\n"},{"tags":["sql-server","database","qt"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":160,"score":1,"question_id":7792293,"title":"Retrieving SCOPE_IDENTITY() with QSqlQuery","body":"<pre><code>bool ok = query.exec(\"CREATE TABLE person ( IdTable INTEGER IDENTITY(1,1) NOT NULL PRIMARY KEY, LastName varchar(255), FirstName varchar(255)  )\");            \nbool ok1 = query.exec(\"INSERT INTO person VALUES ('Wijethilake','Tharanga')\");            \nQSqlQuery scope_Identity(\"SELECT SCOPE_IDENTITY() AS Current_Identity;\");\nQSqlRecord rec = scope_Identity.record();\nqDebug() &lt;&lt; scope_Identity.isValid();\n</code></pre>\n\n<p>This returns false. IS it that something wrong with qt or is my scope Identity statement wrong. I really appreciate someone's help on this.</p>\n\n<p>Thank you. </p>\n"},{"tags":["c#","sql-server","asp.net-mvc","charts"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":246,"score":0,"question_id":8489730,"title":"chart.GetHtmlImageMap not working as expected","body":"<p>Gents,</p>\n\n<p>I need help to create an imagemap to my web app's charts. After reading many resources, here and on the web, I end up with the following problem:</p>\n\n<p>The Problem:\n   On my view I' am calling @Html.Action(RenderMyMap), that renders an &lt;map&gt; tag, with an atribute coords=0,0,0,0. </p>\n\n<p>What Am I doing:\nMy project is organized this way:</p>\n\n<p>-Core.cs: Class responsable to create the System.Web.UI.DataVisualization.Charting.Chart objects;\n   -ClientController: With an existing Chart object, I'm saving it with Chat.SaveImage(memoryStream,format), storing it in a session variable as a byte array, and returning a ContentResult object, like in return Content(chart.GetHtmlImageMap());\n   -ClientController: After that, I'am using the session variable to actually render the chart, like in return File(chartByteArray,\"image/png\");\n   -Index.cshtml: Finally in my view I'am calling method on the ClientController to render the map and the chart.</p>\n\n<p>My setup:\n.NET 4.0, MVC3, SQL Server 2008.</p>\n\n<p>Bellw goes the code of one of my methods, on the ClientController, to generate and return n ImageMap.</p>\n\n<pre><code>    public ActionResult ChartMapGetClientsByType()\n    {\n        System.Web.UI.DataVisualization.Charting.Chart chart = null;\n        if (Session[\"GraficoClientePorTipo\"] != null)\n        {\n            chart = (System.Web.UI.DataVisualization.Charting.Chart)Session[\"GraficoClientePorTipo\"];\n            Session.Remove(\"GraficoClientePorTipo\");\n        }\n        else\n        {\n            chart = MeuMRP.Core.Chart.CreateChartImageMap(\"GraficoClientePorTipo\", SeriesChartType.Pie);\n            chart.IsMapEnabled = true;\n            System.IO.MemoryStream ms = new System.IO.MemoryStream();\n            chart.SaveImage(ms, ChartImageFormat.Png);\n            Session[\"GraficoClientePorTipo\"] = ms.ToArray();\n        }\n        return Content(chart.GetHtmlImageMap(\"GraficoClientePorTipo\"));\n    }\n</code></pre>\n\n<p>What Am I doing wrong?</p>\n"},{"tags":["c#","sql-server","database","entity-framework","sql-server-ce"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13085764,"title":"Generating both SQL Server CE database and entity model at runtime","body":"<p>I am developing a desktop application where different users can use the application on the same machine, the application should generate a different SQL Server CE database file for each user where the databases have the same schema (structure), and then generate an entity model from that database, how should I go about doing this ? </p>\n\n<p>I am new to both the Entity Framework and the SQL Server CE engine, so I am willing to consider any solution.</p>\n"},{"tags":["sql-server","tsql","stored-procedures","sql-server-2008-r2"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13071984,"title":"Using a variable for the table name in an INSERT statement","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6877624/is-there-a-way-to-specify-table-name-as-a-string\">Is there a way to specify table name as a string?</a>  </p>\n</blockquote>\n\n\n\n<p>The following script will be executed without error:</p>\n\n<pre><code>DECLARE @SourceDB sysname, @SourceTable sysname, \n        @UserID NVARCHAR(500), @DMLType CHAR(1), @SourceIdent uniqueidentifier, @ChangedData XML,\n        @SQL as NVARCHAR(MAX)\n\n-- xml datatype and its capabilities rock\nSELECT  @SourceDB = T.c.query('/AuditMsg/SourceDb').value('.[1]', 'sysname'),\n        @SourceTable = T.c.query('/AuditMsg/SourceTable').value('.[1]', 'sysname'),\n        @SourceIdent = T.c.query('/AuditMsg/SourceIdent').value('.[1]', 'uniqueidentifier'),\n        @UserID = T.c.query('/AuditMsg/UserId').value('.[1]', 'NVARCHAR(50)'),\n        @DMLType = T.c.query('/AuditMsg/DMLType').value('.[1]', 'CHAR(1)'),\n        @ChangedData = T.c.query('*')\nFROM    @msgBody.nodes('/AuditMsg/ChangedData') T(c)\n\nINSERT INTO dbo.AVE_Stamm(SourceDB, SourceIdent, UserID, DMLType, ChangedData)\nSELECT @SourceDB, @SourceIdent, @UserID, @DMLType, @ChangedData\n</code></pre>\n\n<p>But when I change the <code>INSERT</code> statement to</p>\n\n<pre><code>SET @sql = 'INSERT INTO @SourceTable (SELECT @SourceDB, @SourceIdent, @DMLType, @ChangedData, @UserID)';\nEXEC (@sql);\n</code></pre>\n\n<p>it isn't working anymore. Can please someone help me, what's wrong here?</p>\n\n<p>I use this script in a stored procedure of a SQL Server 2008 R2.</p>\n"},{"tags":["sql-server","visual-studio","visual-studio-2008","linq","types"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1782,"score":1,"question_id":188242,"title":"Data Types supported in visual studio 2008","body":"<p>I just downloaded and installed the latest Adventure Works database from <a href=\"http://www.codeplex.com/MSFTDBProdSamples/Release/ProjectReleases.aspx?ReleaseId=16040\" rel=\"nofollow\">http://www.codeplex.com/MSFTDBProdSamples/Release/ProjectReleases.aspx?ReleaseId=16040</a> to do some more playing around with LINQ and found that there are some data types that are not natively supported within Visual Studio 2008. I get the \"One or more selected items contain a data type that is not supported by the designer.\" error message. </p>\n\n<p>I found that the spatial data type is the issue in this case. </p>\n\n<p>My questions are:</p>\n\n<ul>\n<li>What other data types are not\ninherently supported by Visual\nStudio that is in SQL Serve 2008?</li>\n<li>Why are these types not supported?</li>\n</ul>\n\n<p>The second question is I guess the most puzzling to me. I can understand why not all data types would be supported from MySQL, Oracle, Postgre SQL and so forth. I would think that the SQLServer development group, might give a heads up to the Visual Studio development group, you know yell down the hall or something. </p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":829,"score":1,"question_id":4299152,"title":"Can you use the free AnjLab Profiler for SQL Server Express to view the actually SQL command used to access the dababase?","body":"<p>It seems the trace can only tell you something accessed the database, but not the SQL command.</p>\n"},{"tags":["c#","sql-server","wpf","linq","view"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":1,"question_id":13089863,"title":"Is SQL View faster than Table while using Linq?","body":"<p>My WPF application has a lookup screen for selecting customers. The customer table contain nearly 10,000 records. Its very slow when loading and filtering records using my Linq query(I am not doing any ordering of records). Is there a way to increase speed? Heard about using indexed views. Can someone please give some ideas?</p>\n\n<pre><code>lstCustomerData = dbContext.customers.Where(c =&gt; c.Status == \"Activated\").ToList();\n            dgCustomers.ItemsSource = lstCustomerData;\n</code></pre>\n\n<p>filtering:</p>\n\n<pre><code> string searchKey = TxtCustName.Text.Trim();\n\n            var list = (from c in lstCustomerData\n                        where (c.LastName == null ? \"\" : c.LastName.ToUpper()).Contains(searchKey.ToUpper())\n                        select c).ToList();\n            if (list != null)\n                dgCustomers.ItemsSource = list;\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":6143,"score":1,"question_id":5722700,"title":"How Do I Split a Delimited String in SQL Server Without Creating a Function?","body":"<p>I'm working with a SQL Server database. I have a column which contains a delimited list, and I need to write a query which splits the values of the list into rows. From browsing StackOverflow and the rest of the web, I know this is a common problem. In fact, I found an extensive analysis here:</p>\n\n<p><a href=\"http://www.sommarskog.se/arrays-in-sql.html\" rel=\"nofollow\">http://www.sommarskog.se/arrays-in-sql.html</a></p>\n\n<p>Unfortunately, every solution I've seen on that site and elsewhere requires me to create a function. That isn't an option for me -- I lack the privileges required to use the CREATE command.</p>\n\n<p>Without CREATE, I know I can use the PARSENAME function, something like this (Thanks to Nathan Bedford at <a href=\"http://stackoverflow.com/questions/2647\">Split String in SQL</a>.):</p>\n\n<pre><code>SELECT PARSENAME(REPLACE('Hello John Smith', ' ', '.'), 2) \n</code></pre>\n\n<p>However, PARSENAME works only for lists of 4 items or fewer. My question, therefore, is this: How do I write a query to split a delimited string of more than 4 items without creating new objects in the database?</p>\n\n<p>EDIT:</p>\n\n<p>Thanks to everyone for the quick answers. I may have left out some important information -- I'm interacting with the database through an ODBC connection. In addition to CREATE statements, there seem to be other statements that don't work. For instance, I can't seem to use DECLARE in one statement to define a variable that will be used in another statement. As near as I can figure, I have to put everything into a single SELECT statement (although WITH also seems to work for declaring common tables). Unfortunately, all of the solutions suggested so far seem to require variable declarations outside the SELECT statement, and that isn't working. Please bear with me -- I'm learning as I go.</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":1,"question_id":13089792,"title":"SQL Server - Execute statements using WHILE Loop Issues","body":"<p>I'm trying to write a script that can be used to restore permissions to stored procedures after our merge replication snapshot agent completes applying snapshot to subscribers. This SQL needs to be somewhat dynamic.</p>\n\n<p>Currently, I'm selecting a list of all our stored procedures and inserting them into a temporary table along with string statements for \"Granting\" permissions. I'm attempting to loop through all the rows on that table, executing the statements one by one using EXEC() command. I keep getting the error </p>\n\n<blockquote>\n  <p><em>Only one expression can be specified in the select list when the subquery is not introduced with EXISTS</em> </p>\n</blockquote>\n\n<p>but my SQL statements look like they should be fine. Maybe I'm not understanding how WHILE works in SQL Server.</p>\n\n<p>Here is my code: </p>\n\n<pre><code>BEGIN\nCREATE TABLE sqltemp (id int IDENTITY(1, 1) , Stmt1 varchar(max), Stmt2 varchar(max),  Stmt3 varchar(max))\n\nINSERT INTO sqltemp \n   SELECT \n      'GRANT EXECUTE ON OBJECT::' as Stmt1, name as Stmt2, 'TO edoc_only_execute' as Stmt3\n   FROM sys.sysobjects\n   WHERE \n      type = 'P' AND name NOT LIKE 'MSMerge%'\n\nDECLARE @counter int = 1\nWHILE (@counter &lt; (SELECT COUNT(*) FROM sqltemp))\nBEGIN\n    DECLARE @sqlrun varchar(max)\n    SET @sqlrun = (SELECT Stmt1, Stmt2, Stmt3 FROM sqltemp WHERE id = @counter)\n    EXEC(@sqlrun)\n    SET @counter = @counter + 1\nEND\nEND\nGO\nDROP TABLE sqltemp\n</code></pre>\n\n<p>Two questions: </p>\n\n<ol>\n<li><p>How can I accomplish executing the above script for each item in my temporary table?</p></li>\n<li><p>Is there a better way of writing a script to restore permissions for each stored procedure in my database after the snapshot is applied (Note: I must be able use SQL system tables to pull stored procedure names)?</p></li>\n</ol>\n"},{"tags":["sql-server"],"answer_count":5,"favorite_count":15,"up_vote_count":19,"down_vote_count":0,"view_count":28533,"score":19,"question_id":436351,"title":"How do I find a value anywhere in a SQL Server Database?","body":"<p>Given a #, how do I discover in what table and column it could be found within?</p>\n\n<p>I don't care if it's fast, it just needs to work.</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":1,"question_id":13088921,"title":"SQL Nested Replace","body":"<p>I have a complex nested replace which I am using to join two tables in MSSQL.</p>\n\n<pre><code>select * from A\n  left outer join \nselect * from B\non\n  replace(\n     replace(\n        replace(\n           replace(\n              replace(A.Column1, '1114', ''),\n             '1160', ''), \n          '1162', ''),\n        '1167', ''),\n      '1176', ''),\n    '1177', '')  = B.Column1\n</code></pre>\n\n<p>The whole reason I am doing this is because data in Table1 contains of some <em>noise</em> - numbers like <em>1160</em>, <em>1162</em> etc wheres Table2 is clean characters.</p>\n\n<pre><code>Eg. - Table 1 - 'HELLO1160WORLD'\n      Table 2 - 'HELLOWORLD'\n</code></pre>\n\n<p>Now in my situation I should be able to <strong>match</strong> them as one entry.</p>\n\n<p>My current approach of nested replace does work but I am not convinced that this is an elegant way to do this. Any help will be much appreciated. Thanks</p>\n"},{"tags":["c#","asp.net","sql-server","iis","web-services"],"answer_count":7,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":13134,"score":4,"question_id":2575907,"title":"Cannot open database \"test\" requested by the login. The login failed. Login failed for user 'xyz\\ASPNET'","body":"<p>I have created a webservice which is saving some data into to db. But i am getting this error    </p>\n\n<blockquote>\n  <p>Cannot open database \"test\" requested\n  by the login. The login failed. Login\n  failed for user 'xyz\\ASPNET'.</p>\n</blockquote>\n\n<p>my connection string is<br>\n<code>\nadd name=\"ConnectionString1\" connectionString=\"Data Source=.\\SQLExpress;Initial Catalog=IFItest;Integrated Security=True\" providerName=\"System.Data.SqlClient\"\n</code></p>\n"},{"tags":["sql-server","vb.net","visual-studio","rest","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":37,"score":2,"question_id":13082539,"title":"From stored procedures to REST services","body":"<p>I have a 6 year ago VB.NET project in Visual Studio 2005 and SQL server 2005. This project gets the data using stored procedures and I'm planning to do a mobile project but can't get the data from the database because I haven't got webservices or REST services.\nHow should I start to transform the stored procedures to services that can be called outside? Is there a tool that does it directly?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13088621,"title":"sql server updating new column based on another column from same table","body":"<p>I have a table with composite primary key based on three columns.</p>\n\n<p><code>(Unit, Account, service)</code></p>\n\n<p>I have another two columns: <code>DOB</code> (this holds date of birth) &amp; <code>Age</code> (this is a new int column which needs to be updated based on DOB and the result will be integer value of years)</p>\n\n<p>I know how to retrieve the reslt for Age</p>\n\n<pre><code>select datediff(Year,DOB,GETDATE()) as AGE\n</code></pre>\n\n<p>But not sure how to update entire table based on the rows DOB data.</p>\n\n<p>Columns are <code>Unit, Account, Service, DOB, Age</code></p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":863,"score":1,"question_id":5813621,"title":"How to join two tables if they are in different schemas","body":"<p>I have two different schemas in SQL Server (say S1, S2). And two tables in those schemas(say S1.Table1, S2.Table2). I want to query these two tables from schema S1.</p>\n\n<p>Both S1 and S2 are in SQL Server 2005 databases. I want to do something like this:</p>\n\n<pre><code>select T1.Id\n  from S1.Table1 T1\n     , S2.Table2 T2 \n Where T1.Id = T2.refId\n</code></pre>\n"},{"tags":["sql-server","diagram"],"answer_count":2,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":4523,"score":10,"question_id":4019560,"title":"How to export a SQL Server 2008 Database Diagram to another DB?","body":"<p>I use the handy Database Diagramming tool in SQL Server 2008 for creating and managing relationships.  I have exported the sourceDB to the destinationDB but the diagram doesn't come across.</p>\n\n<p>I am looking around trying to figure out how to export just the diagram I have in one database to another... This <a href=\"http://support.microsoft.com/kb/320125\">online KB article</a>  fails since <code>select * from dtproperties</code> doesn't exist anymore. </p>\n"},{"tags":["sql-server","sqldatasource","datasourcecontrol"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13077537,"title":"How to make SQLDataSource insert into view instead of the underlying table?","body":"<p>We have replaced 20 tables with a consolidated table, that separates each set of data via a \"set id\" (all the records for table \"A\" have a set_id of 1, table \"B\" is 2, etc.).  </p>\n\n<p>We then built views on the table, and renamed each so they had the views had the same names as the original 20 tables, with a WHERE to add the set_id.   Net result - inserts/updates/selects of the views still work</p>\n\n<p>We did this so our web page, which uses a sqldatasource with \"sql command builder\", wouldn't have to change.  We added an INSTEAD OF INSERT trigger on each view, so that when you insert into the view, it adds the set_id and inserts into the consolidated table.  So far, so good.  </p>\n\n<p>It partially works: UPDATEs and DELETEs work, because they know the actual ID for the record.  </p>\n\n<p>However INSERTs don't - when the command actually executes, we see \"exec sp_executesql insert into consolidatedtable\" - rather than hitting the view, the data source control finds the underlying table, then inserts directly into it.  If we try adding fields to the views, they then show up in the data source control, but the web page then shows a configurable field. </p>\n\n<p>Is there a way to change things on the database side to force it to use the view?  My only other option at this point is to replace the views with tables, add an AFTER INSERT, UPDATE, DELETE trigger so that the consolidated gets updated, and then a process to make sure they're in sync and there are no issues.</p>\n\n<p>MANY thanks in advance.</p>\n"},{"tags":["sql-server","tsql","hierarchyid"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":1850,"score":3,"question_id":3564272,"title":"Cannot insert duplicate key in object (GetReparentedValue / hierarchyid)","body":"<p>Using examples I found on the web I have created a function which reparents children using the GetReparentedValue.</p>\n\n<p>However when I have ran the code I get the following error: Cannot insert duplicate key in object.</p>\n\n<p>I understand why (because I am trying to reparent the children and the new parent already has children so I need to know the MAX path (hierarchyid) of the child within the new parent structure, but I don't understand how I'm actually going to do that.</p>\n\n<p>path 0x58</p>\n\n<p>oldPath 0x</p>\n\n<p>new path 0x68</p>\n\n<pre><code>SqlCommand command = new SqlCommand(\"UPDATE Structure SET \" +\n                                    \"Path = \" + path + \".GetReparentedValue\" +\n                                    \"(\" +\n                                      oldPath + \", \" + newPath +\n                                    \")\" +\n                                    \"ParentID = @id \" +\n                                    \"WHERE Path = \" + path, _connection);\n</code></pre>\n\n<p>I have to do this when adding a child so I thought it would need to add this somewhere to the query above but I dont know where <code>path + \".GetDescendant(\" + lastChildPath + \", NULL)</code></p>\n\n<p><strong>Database Table</strong></p>\n\n<pre><code>StructureID   int                         Unchecked  \nPath          hierarchyid                 Unchecked  \nPathLevel     ([Path].[GetLevel]())       Checked  \nDescription   nvarchar(50)                Checked  \nParentID      int                         Checked  \nParentPath    ([Path].[GetAncestor]((1))) Checked  \n</code></pre>\n\n<p>Anyone have any suggestion?</p>\n\n<p>Thanks in advance for any help :-)</p>\n\n<p>Clare</p>\n"},{"tags":["sql-server","ssas","mdx"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13087320,"title":"Using calculated member as parameter in MDX function","body":"<p>I'm new to MDX but want to keep my code as clean as possible.</p>\n\n<p>I have a query that looks at todays sales and compares them against LY and LY-1 using the ParallelPeriod function. It looks something like this..</p>\n\n<pre><code>With Member [Date].[SalesCalendar].[DateToday] as [Date].[SalesCalendar].[Date].&amp;[2012-10-26T00:00:00]\n\nSELECT \n\n    {[Date].[SalesCalendar].[DateToday],\n\n    ParallelPeriod([Date].[SalesCalendar].[Year],1,[Date].[SalesCalendar].[Date].&amp;[2012-10-26T00:00:00]),\n\n    ParallelPeriod([Date].[SalesCalendar].[Year],2,[Date].[SalesCalendar].[DateToday]}\n\n    *  \n\n    {[Measures].[Total Sales],[Measures].[Units],[Measures].[Sales Target]}\n    ON Columns,\n\n    [Locations].[Location PK].[Location PK]\n    on Rows\n\nFrom MyCube\n</code></pre>\n\n<p>I start by defining a member that points to today's date. I want to define it once and use it throughout this query (and other queries I write), the theory being I can change it in once place and the underlying query reacts.</p>\n\n<p>The problem I have is that if I try and use this calculated member within the ParallelPeriod function I get no results. With the query above I get results for the first column and the first call to ParallelPeriod (for LY) works but the second call for LY-1, which uses the declared member, fails. </p>\n\n<p>I'm guessing this is down to my lack of knowledge with MDX and so I guess I am missing something fundamental. However, banging my head against the wall isn't working so I need some help!</p>\n\n<p>Any ideas what I am doing wrong? </p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","visual-studio-2010"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16,"score":2,"question_id":13088886,"title":"I cannot load database project to visual studio","body":"<p>I am unable to load database project to visual studio.\nI have installed sql server management tools but still visual studio doenot load the project.</p>\n\n<p><img src=\"http://i.stack.imgur.com/Weztc.png\" alt=\"enter image description here\"></p>\n\n<p><img src=\"http://i.stack.imgur.com/Msk6N.png\" alt=\"enter image description here\"></p>\n\n<p><img src=\"http://i.stack.imgur.com/15jpi.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","nhibernate","queryover"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13060517,"title":"Taking the Top X results of a complex NHibernate query (QueryOver syntax)","body":"<p>I'm working with an Nhibernate Query where I have to do some complex queryover join aliases to eagerly load the children of my root entity. When loading, I want to filter the root entity results returned by a number of properties, including some which are on the children. </p>\n\n<p>I've got this all working fine using joinaliases, but <strong>where I'm stumped is filtering the results returned down to the top \"X\" instances of the root entity when ordered by a property other than the root entities Id</strong>. Since I'm grabbing children, there are a number of duplicate rows returned by the SQL. If I try to filter the number of results with a .Take, the take executes before NHibernate collapses the result set down to the distinct root entities. For reference here's my domain model.</p>\n\n<pre><code>public class Project{\n    public int Id {get;set;}\n    public double Value {get;set;}\n    public IList&lt;ProjectRole&gt; Team {get;set;}\n\n}\n\npublic class ProjectRole{\n   public User User {get;set;}\n   public Role Role {get;set;}\n}\n\npublic class User{\n   public string LoginName {get;set;}\n}\n</code></pre>\n\n<p>So I'm trying to grab all the projects where a User with the given LoginName is on the Project's Team. Then I want to order by the Project's value. I want to do this as efficiently as possible, without select n+1's etc.</p>\n\n<p><strong>What does this community recommend?</strong></p>\n\n<p>Additional Information:\nAs a stopgap, I'm currently returning all the results and then taking the top X in memory, but I don't want that to be permanent, because the query can return close to 10,0000 items, and I only want to top 7 or so. If I was writing straight SQL I'd just do something like this.</p>\n\n<pre><code>SELECT *\nFROM Projects as p1\nINNER JOIN (\n    SELECT distinct TOP (7)  \n        topProjects.PGISourceItem_id as topsId, \n        topProjects.Value as topsValue\n    FROM Projects topProjects            \n        left outer join ProjectRoles roles on topProjects.Id=roles.Project_id \n        left outer join PGUsers users on roles.User_id=users.Id             \n    WHERE \n        (users.LoginName like 'DEV\\APPROVER' or this_0_1_.IsPrivate = 0)\n    ORDER BY topProjects.Value desc\n) as p2 on p1.Id = p2.topsId\n</code></pre>\n\n<p>But I can't figure out how to do this with NHibernate. The only subqueries I can create are either WHERE EXISTS or WHERE IN. And since I'm doing an ORDER BY Value I can't use WHERE IN because my select returns multiple properties.</p>\n"},{"tags":["sql","sql-server","sql-management-studio"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13083712,"title":"Using @startdate and @enddate in sql","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4125238/prompt-for-parameters-with-sql-management-studio\">Prompt for parameters with SQL Management Studio</a>  </p>\n</blockquote>\n\n\n\n<p>I have a query where i use @startdate and @enddate in the sql and if I run this on a colleagues PC he gets prompted to choose values for each field, I do not however on mine.</p>\n\n<p>Is there a setting in sql management studio that I need to turn on to get it to show the pop up window when I run this sql?</p>\n\n<p>Thanks </p>\n"},{"tags":["sql-server","ssas"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13088573,"title":"Microsoft Project REAL - SSAS connection","body":"<p>I am setting up Microsoft Project REAL with SQL Server 2008 R2. </p>\n\n<p>After attaching the relational database and creating the olap cube, I am unable to process it because it is reporting an OLE DB connection faliure. </p>\n\n<p>I am able to connect my own user to both, but processing under my user yields the same result. </p>\n\n<p>Which users need to be running the Analysis Services service and is there an impersanation mode I should be using?</p>\n\n<p>SQL Server Agent under local service\nAnalysis services under local service</p>\n"},{"tags":["sql-server","tsql","stored-procedures","management-studio"],"answer_count":7,"favorite_count":7,"up_vote_count":23,"down_vote_count":0,"view_count":57116,"score":23,"question_id":125457,"title":"What is the T-SQL syntax to connect to another SQL Server?","body":"<p>If I need to copy a stored procedure (SP) from one SQL Server to another I right click on the SP in SSMS and select Script Stored Procedure as > CREATE to > New Query Editor Window. I then change the connection by right clicking on that window and selecting Connection > Change Connection... and then selecting the new server and F5 to run the create on the new server.</p>\n\n<p>So my question is \"What is the T-SQL syntax to connect to another SQL Server?\" so that I can just paste that in the top of the create script and F5 to run it and it would switch to the new server and run the create script.</p>\n\n<p>While typing the question I realized that if I gave you the back ground to what I'm trying to do that you might come up with a faster and better way from me to accomplish this.</p>\n"},{"tags":["sql-server","nhibernate","nhibernate-mapping","mapping-by-code"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":985,"score":1,"question_id":7279473,"title":"Using NHibernate mapping by code: Cannot insert explicit value for identity column in table 'DietUser' when IDENTITY_INSERT is set to OFF","body":"<p>Took me a while to find an answer for this so thought I'd share the love.</p>\n\n<hr>\n\n<p>When using NHibernate's new mapping by code with SQL Server I'm unable to save an entity. When saving an entity a System.Data.SqlClient.SqlException is thrown with the following message (minus the table name):</p>\n\n<blockquote>\n  <p>\"Cannot insert explicit value for identity column in table 'DietUser' when IDENTITY_INSERT is set to OFF.\"</p>\n</blockquote>\n\n<p>My table uses an identity ID and the entity &amp; mappings look like this:</p>\n\n<pre><code>public class User\n{\n    public virtual int Id { get; set; }\n    public virtual string Name { get; set; }\n    public virtual string Username { get; set; }\n    public virtual string Password { get; set; }\n    public virtual short DailyPoints { get; set; }\n}\n\npublic class UserMapping : ClassMapping&lt;User&gt;\n{\n    public UserMapping()\n    {\n        Id(x =&gt; x.Id);\n        Property(x =&gt; x.Name);\n        Property(x =&gt; x.Username);\n        Property(x =&gt; x.Password);\n        Property(x =&gt; x.DailyPoints);\n    }\n}\n</code></pre>\n\n<p>I know how I'd map this using XML mapping but I want to use the built-in mapping by code if at all possible.</p>\n"},{"tags":["sql-server","sql-server-2005","permissions","login","user"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":9526,"score":0,"question_id":372834,"title":"Permissions required for 'CREATE USER' in SQL Server 2005?","body":"<p>I am trying to create a SQL server login and database user from within my application, along with a custom application user row. I want these users to be able to create other users - i.e. the application will control who can/can't create users but I need all users to have permissions for creating SQL server logins and database users.</p>\n\n<p>I have got the server login permissions working - i.e. an existing user/login can create a new login - by adding the logins to the 'securityadmin' server role - which grants the 'ALTER ANY LOGIN' privilege. </p>\n\n<p>I tried to do the same with the database users - adding them to the 'db_accessadmin' database role - which supposedly grants the ALTER ANY USER privilege, which is required for CREATE USER. </p>\n\n<p>However any time I try to create a new database user using a user with the above privileges I get a permissions exception.</p>\n\n<p>I have tried manually granting the ALTER ANY USER permission to a particular user (GRANT ALTER ANY USER TO demouser) but this doesn't work either.</p>\n\n<p>Any ideas about what I am missing here? </p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server","stored-procedures","return-value","sql-server-agent"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1010,"score":0,"question_id":7285311,"title":"Stored Procedure Return Value to Fail SQL Job","body":"<p>I have a stored procedure which is the first step in an SQL Job. The SP compares dates in 2 tables, if they equal then the SQL job can continue, but if they are not I need to return value from the SP that causes the SQL Job to trigger it's on failure action.</p>\n\n<p>What is the best way to do this? Is it with an RAISERROR statement or just return a value like -99?</p>\n\n<p>Seems such an obvious question, but I've never thought about it before until now.</p>\n"},{"tags":["sql-server","xml","cursor"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13087787,"title":"SQL Server : when querying against a XML column can I return a XML column?","body":"<p>I have XML in the following format:</p>\n\n<pre><code>&lt;filters&gt;\n  &lt;filter name=\"filterByOperatingSystem\"&gt;\n   &lt;parameters operatingSystem=\"Windows\" /&gt;\n  &lt;/filter&gt;\n  &lt;filter name=\"filterBySoftware\"&gt;\n   &lt;parameter software=\"Office\" /&gt;\n  &lt;/filter&gt;\n&lt;/filters&gt;\n</code></pre>\n\n<p>stored in <code>@XML</code>.</p>\n\n<p>What I would like to do is loop though each of the filters so that I can do some processing. </p>\n\n<p>My thought was that I could grab each filter name along with the parameters element in a cursor, but the closest I can get so far is:</p>\n\n<pre><code>DECLARE crsDTO cursor static forward_only read_only for \nSELECT  \n  tab.col.value('@name','NVARCHAR(64)')\nFROM\n  @XML.nodes('//filter') tab(col)\n</code></pre>\n\n<p>I tried the following query to see if I could get the parameter xml out:</p>\n\n<pre><code>DECLARE crsDTO cursor static forward_only read_only for \nSELECT  \n  tab.col.value('@name','NVARCHAR(64)'),\n  tab.col.value('parameter[1]' 'XML')\nFROM\n  @XML.nodes('//filter') tab(col)\n</code></pre>\n\n<p>But I got the error:</p>\n\n<blockquote>\n  <p><em>The datatype XML used in the value type is invalid</em></p>\n</blockquote>\n\n<p>Because my filters can have different attributes I do not want to attempt to grab the attributes directly with the first query (my thought was to do the cursor, then depending on the filter name, I could get the specific parameters from the node), but without being able to get the xml node out, i'm not sure how to go about doing this.</p>\n\n<p>Any suggestions as to how I could go about resolving this?</p>\n"},{"tags":["c#","asp.net","sql","sql-server","stored-procedures"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":48,"score":1,"question_id":13087634,"title":"Bind datetime to drop down based on Name in a table","body":"<p><img src=\"http://i.stack.imgur.com/Uo1S5.png\" alt=\"enter image description here\"></p>\n\n<p>I have a table like this and in the code behind i have to show like tempname in a label and rundate in a dropdownlist i have to show like last 10 rundates in the drop down without duplicate name i mean i have to show unique tempname and associated rundates in DDL.how can i achieve this??I need a stored procedure for the same.</p>\n\n<pre><code>  protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)\n{\n    if (e.Row.RowType == DataControlRowType.DataRow)\n    {\n        DataTable dt = new DataTable();\n        dt = Common.rundate();\n        DropDownList ddl = e.Row.FindControl(\"DropDownList1\") as DropDownList;\n\n        ddl.DataTextField = \"RunDate\";\n        ddl.DataValueField = \"TempID\";\n        ddl.DataSource = dt;\n        ddl.DataBind();\n\n\n    }\n\n}\n\n   public static DataTable rundate()\n    {\n        DBAccess objDBAccess = new DBAccess();\n        DataTable dt = new DataTable();\n\n        try\n        {\n            objDBAccess.AddParameter(\"@tempname\", SqlDbType.VarChar);\n            objDBAccess.AddParameter(\"@tempid\", SqlDbType.Int);\n            objDBAccess.AddParameter(\"@rundate\", SqlDbType.DateTime);\n            dt = objDBAccess.ExecuteDataTable(\"display_rundates\");\n            return dt;\n        }\n        catch\n        {\n            return null;\n        }\n    }\n</code></pre>\n"},{"tags":["sql-server","lazy"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":583,"score":0,"question_id":1109653,"title":"Comparing database structures: how to create an SQL patch?","body":"<p>I have two SQL Server (2000) databases. Both are used for the same project, but different versions. Basically, the old database is from our TEST environment. The new database is from the DEVELOPMENT environment. We also have an ACCEPTANCE, PRODUCTION and MAINTENANCE environment and they all contain the same project. (It's our development street, moving versions from D to T to A to P and finally M.)</p>\n\n<p>Now, the development database structure has changed. A few tables have been added, indices are added or removed, fields have changed in type and nullable fields have become non-nullable, things like that. The test database needs to be upgraded with the new structure but without any loss of data. Right now, I'm doing this with a lot of manual labor. I keep a list of structural changes and once everything is ready, I write an update script to patch the old test database.</p>\n\n<p>But as a software engineer, I'm just lazy by design. So, is there some easy tool somewhere which will compare the two database structures and generate an update script by itself?</p>\n\n<p>(Only to change the structure, btw. No data manipulation!)</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":243,"score":0,"question_id":11877438,"title":"Error occurred while connecting to SQL Server 2012: Cannot open user database. Login failed. (Microsoft SQL Server, Error: 4064)","body":"<p>I unknowingly deleted SA user from the SQL Server 2012. Now i cannot be able to connect to the sever. It shows an error : </p>\n\n<p>Cannot open user database. Login failed. Login failed for the user 'username'.(Microsoft SQL Server, Error: 4064)</p>\n\n<p>Now i don't know what to do?</p>\n\n<p>Help me please</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","sql","sql-server","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":13086153,"title":"Binding dates to dropdownlist inside gridview","body":"<p>I have to bind a label and a drop down in a gridview,the DDL contains rundates that is datetime format i have to show all the different dates in the DDL associated with the name.</p>\n\n<pre><code>  protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)\n{\n    if (e.Row.RowType == DataControlRowType.DataRow)\n    {\n        DataTable dt = new DataTable();\n        dt = Common.rundate();\n        DropDownList ddl = e.Row.FindControl(\"DropDownList1\") as DropDownList;\n\n        ddl.DataTextField = \"RunDate\";\n        ddl.DataValueField = \"TempID\";\n        ddl.DataSource = dt;\n        ddl.DataBind();\n    }\n\n}\n\nStore Proc::  \n\n    alter PROC display_rundates\n@rundate datetime,@tempid int\nAS\n  SELECT RunDate,TempID\n    FROM History_Table\n\nORDER BY Rundate DESC\nGO\n</code></pre>\n\n<p>But i have to show the specific rundates associated with each Name.Any help can be appreciated.</p>\n\n<pre><code>Name   rundate\nTest   datetime(DDL)\nTest1   datetime\n</code></pre>\n"},{"tags":["c#","sql-server","winforms"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":672,"score":1,"question_id":6292697,"title":"Connections to SQL Server Files (*.mdf) require SQL Server Express 2005 to function properly","body":"<p>I am trying to add new existing item .mdf database file created in SQL Server Express 2008 R2.</p>\n\n<p>When I try that i got error \"Connections to SQL Server Files (*.mdf) require SQL Server Express 2005 to function properly.\"</p>\n\n<p>What I have to do?</p>\n"},{"tags":["sql-server","database","backup","restore"],"answer_count":5,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":5734,"score":5,"question_id":16491,"title":"Restore database backup over the network","body":"<p>How do you restore a database backup using SQL Server 2005 over the network? I recall doing this before but there was something odd about the way you had to do it.</p>\n"},{"tags":["sql","sql-server","linked-server","temporary-tables"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1621,"score":2,"question_id":2209556,"title":"Is it possible to create a temp table on a linked server?","body":"<p>I'm doing some fairly complex queries against a remote linked server, and it would be useful to be able to store some information in temp tables and then perform joins against it - all with the remote data. Creating the temp tables locally and joining against them over the wire is prohibitively slow.</p>\n\n<p>Is it possible to force the temp table to be created on the remote server? Assume I don't have sufficient privileges to create my own real (permanent) tables. </p>\n"},{"tags":["sql","sql-server","sql-server-2008","reporting-services"],"answer_count":3,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":3992,"score":6,"question_id":947379,"title":"Reporting Services Subscriptions won't allow modification of the To: Field","body":"<p>I have a little issue that is causing me a headache.  Our Report Server is SQL Ent 2008 on a Win 2008 server.  When users that have Report Browser permissions try to set up a report subscription the To: field is grayed out and pre-populated with their username.  They cannot change this and it won't deliver to their email address which would be username@domain.com.  Any leads would be greatly appreciated.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4157,"score":0,"question_id":3011782,"title":"How to solve the sql server 2008 restore error 3203","body":"<p>I am trying to restore the database in SQL Server 2008. The backup file is  SQL Server 2008 from another PC <strong>. When i want to restore show me the error</strong> </p>\n\n<p>TITLE: Microsoft SQL Server Management Studio</p>\n\n<pre><code>------------------------------\n\nAn exception occurred while executing a Transact-SQL statement or batch. (Microsoft.SqlServer.ConnectionInfo)\n\n------------------------------\nADDITIONAL INFORMATION:\n\nRead on \"D:\\New Folder (2)\\mihirreliance.bak\" failed: 38(Reached the end of the file.) (Microsoft SQL Server, Error: 3203)\n\nFor help, click: http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=10.00.1600&amp;EvtSrc=MSSQLServer&amp;EvtID=3203&amp;LinkId=20476\n\n------------------------------\nBUTTONS:\n\nOK\n------------------------------\n</code></pre>\n\n<p>Why this problem aries .How to solve this error.</p>\n"},{"tags":["sql-server"],"answer_count":4,"favorite_count":3,"up_vote_count":23,"down_vote_count":0,"view_count":20742,"score":23,"question_id":1272670,"title":"What service accounts to use when installing SQL Server 2008 on a Dev Box","body":"<p>I am installing SQL Server 2008 on my development machine and during the install I am asked to assign accounts to the different services. What account should I use for the services where no user has been assigned if this is a simple development machine?</p>\n\n<ul>\n<li>Can I use the account I am logged in with (I am the only user on this machine)?</li>\n<li>Should I use the NT AUTHORITY/SYSTEM account?</li>\n<li>Can I user either or of the above or is there a downside to one or the other or should I use something totally different?</li>\n</ul>\n"},{"tags":["c#","sql-server","visual-studio","msbuild","clrstoredprocedure"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2244,"score":1,"question_id":4737686,"title":"How to generate SQL CLR stored procedure installation script w/o Visual Studio","body":"<p>I am working on CLR stored procedure using VS2010. I need to generate standalone deployment script to install this procedure at customer servers. Now I am using Visual Studio which generate such script when I press F5 and try to debug SP on DB server. This script is placed at <code>bin\\Debug\\MyStoredProcedure.sql</code> file. It looks like this:</p>\n\n<pre><code>USE [$(DatabaseName)]\n\nGO\nIF EXISTS (SELECT * FROM tempdb..sysobjects WHERE id=OBJECT_ID('tempdb..#tmpErrors')) DROP TABLE #tmpErrors\nGO\nCREATE TABLE #tmpErrors (Error int)\nGO\nSET XACT_ABORT ON\nGO\nSET TRANSACTION ISOLATION LEVEL READ COMMITTED\nGO\nBEGIN TRANSACTION\nGO\nPRINT N'Dropping [dbo].[spMyStoredProcedure]...';\n\n\nGO\nDROP PROCEDURE [dbo].[spMyStoredProcedure];\n\n\nGO\nIF @@ERROR &lt;&gt; 0\n   AND @@TRANCOUNT &gt; 0\n    BEGIN\n        ROLLBACK;\n    END\n\nIF @@TRANCOUNT = 0\n    BEGIN\n        INSERT  INTO #tmpErrors (Error)\n        VALUES                 (1);\n        BEGIN TRANSACTION;\n    END\n\n\nGO\nPRINT N'Dropping [MyStoredProcedure]...';\n\n\nGO\nDROP ASSEMBLY [MyStoredProcedure];\n\n\nGO\nIF @@ERROR &lt;&gt; 0\n   AND @@TRANCOUNT &gt; 0\n    BEGIN\n        ROLLBACK;\n    END\n\nIF @@TRANCOUNT = 0\n    BEGIN\n        INSERT  INTO #tmpErrors (Error)\n        VALUES                 (1);\n        BEGIN TRANSACTION;\n    END\n\n\nGO\nPRINT N'Creating [MyStoredProcedure]...';\n\n\nGO\nCREATE ASSEMBLY [MyStoredProcedure]\n    AUTHORIZATION [dbo]\n-- here should be long hex string with assembly binary\n    FROM 0x4D5A90000300000004000000FFFCD21546869732070726F6772616D...000000000000000000 \n    WITH PERMISSION_SET = SAFE;\n\n\nGO\nIF @@ERROR &lt;&gt; 0\n   AND @@TRANCOUNT &gt; 0\n    BEGIN\n        ROLLBACK;\n    END\n\nIF @@TRANCOUNT = 0\n    BEGIN\n        INSERT  INTO #tmpErrors (Error)\n        VALUES                 (1);\n        BEGIN TRANSACTION;\n    END\n\n\nGO\nPRINT N'Creating [dbo].[spMyStoredProcedure]...';\n\n\nGO\nCREATE PROCEDURE [dbo].[spMyStoredProcedure]\n@reference UNIQUEIDENTIFIER, @results INT OUTPUT, @errormessage NVARCHAR (4000) OUTPUT\nAS EXTERNAL NAME [MyStoredProcedure].[MyCompany.MyProduct.MyStoredProcedureClass].[MyStoredProcedureMethod]\n\n\nGO\nIF @@ERROR &lt;&gt; 0\n   AND @@TRANCOUNT &gt; 0\n    BEGIN\n        ROLLBACK;\n    END\n\nIF @@TRANCOUNT = 0\n    BEGIN\n        INSERT  INTO #tmpErrors (Error)\n        VALUES                 (1);\n        BEGIN TRANSACTION;\n    END\n\n\nGO\nIF EXISTS (SELECT * FROM #tmpErrors) ROLLBACK TRANSACTION\nGO\nIF @@TRANCOUNT&gt;0 BEGIN\nPRINT N'The transacted portion of the database update succeeded.'\nCOMMIT TRANSACTION\nEND\nELSE PRINT N'The transacted portion of the database update failed.'\nGO\nDROP TABLE #tmpErrors\nGO\n</code></pre>\n\n<p>I am wondering, is it possible to generate such script without Visual Studio? For example, what if I build solution with MSBuild and then generate this script with some tool? I believe, that if I read assembly as byte array and then serialize it to hex string and insert into script template - it could work, but maybe there is some easier standard solution?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework","stored-procedures","ado.net"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":103,"score":3,"question_id":12710455,"title":"Why is my broken stored procedure being dropped?","body":"<p>I have an ASP.NET MVC 4 project configured to use Entity Framework 5, backed by a SQL Server database.</p>\n\n<p>One of the stored procedures in my DB performs an illegal operation: it tries to insert a <code>NULL</code> value into a <code>NOT NULL</code> column. Understandably, this fails.</p>\n\n<p>Inexplicably, Entity Framework (or some other component of my ASP.NET MVC stack, or perhaps my SQL Server database) then <strong>drops the stored procedure</strong> from the database!</p>\n\n<p>A screenshot of the error message I receive when I attempt to call my stored procedure is below:</p>\n\n<p><img src=\"http://i.stack.imgur.com/3Nt2M.jpg\" alt=\"The error page displayed\"></p>\n\n<p>I can't seem to find any documentation on this behaviour. </p>\n\n<p><strong>Why is this happening, and what can I do to prevent stored procedures from being dropped?</strong></p>\n"},{"tags":["sql-server","tsql","sql-server-2005","count"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13080925,"title":"Counting frequency of values assigned to different types","body":"<p>I apologize in advance for my poor description, I couldn't think of a way to word it better, but I'll try to explain it thoroughly.</p>\n\n<p>Let's say that I have a table setup in this manner:</p>\n\n<h2>Input Table</h2>\n\n<pre><code>Itm Type\nA   Apple\nB   Orange\nC   Apple\nB   Grape\nD   Peaches\nB   Apple\nC   Grapes\nE   Apple\nA   Apple\n</code></pre>\n\n<p>The goal is to produce a table showing each item (A, B, C, D, and E) with the total number of each type that was assigned to that item.</p>\n\n<h2>Goal Output Table</h2>\n\n<pre><code>Itm    Apple  Orange  Grape  Peaches    \nA       2       0       0       0   \nB       1       1       1       0\nC       1       0       1       0\nD       0       0       0       1\nE       1       0       0       0\n</code></pre>\n\n<p>The query I'm using now displays a table where it seems to be summing up all of the types for all of the items and placing that value on each row.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c#","mysql","sql-server","datetime","data"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13086048,"title":"sqlserver - mysql transfert datetime issue","body":"<p>I am implementing an app to migrate data from <code>sqlserver</code> to <code>mysql</code> and experiencing a problem.</p>\n\n<p>When it comes to <code>SQLSERVER DATETIME (e.g 1999-08-01 00:00:00.000)</code> to be transfered to MYSQL.\nMYSQL returns a <strong><em>synstax error near 00:00:00.000</em></strong>. </p>\n"},{"tags":["sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":89,"score":1,"question_id":13061390,"title":"TSQL calculate percentage","body":"<p>I have a list of customers in a SQL Server database for a health club.\nThe customers are listed with the date they joined and the number of times they have renewed \nI want to be able to calculate the percentage rate of customers that renewed. Any ideas on how I can do this? Thanks.</p>\n"},{"tags":["sql","sql-server"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":13084607,"title":"sql - How to select so that the row can be column?","body":"<p>I have a table like this:</p>\n\n<pre><code>   Item      Name             Name_location   Price\n\n    1      item1_london        london         10\n    1      item1_beijing       bejing         10\n    2      item2_london        london         20\n    2      item2_beijing       bejing         20\n</code></pre>\n\n<p>Basically, this table means I have lots of items, <code>each item will have a different name in different location (two locations: london and beijing)</code>.</p>\n\n<p><strong>How can I query</strong> so that I can get the table like this:</p>\n\n<pre><code>  Item     london             bejing          Price\n    1      item1_london       item1_beijing    10\n    2      item2_london       item2_beijing    20\n</code></pre>\n\n<p>I am using MS SQL Server.</p>\n\n<p><strong>Edit: updated the two tables, add another column</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13085655,"title":"Search through table names","body":"<p>I use the following to search for strings in my stored procedures:</p>\n\n<pre><code>use DBname\nSELECT Name\nFROM sys.procedures\nWHERE OBJECT_DEFINITION(OBJECT_ID) LIKE '%xxx%'\n</code></pre>\n\n<p>Is it easy to amend the above so that it searches Table names in a specific db \"DBname\" ?</p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13081363,"title":"Load MySQL \".SQL Dump File\" into SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1770795/convert-mysql-script-to-mssql\">Convert MySQL script to MSSQL</a>  </p>\n</blockquote>\n\n\n\n<p>I have *.sql dump file that generated from the MySQL Server using the SQL Yog tool.Please anyone tell me how to convert the MySQL *.sql dump file in to SQL Script file.</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13083933,"title":"SQL multiple REPLACE cases","body":"<p>I have a transaction reference table with <em>varchar</em> Transaction Identifiers in a MSSQL DB.</p>\n\n<pre><code>eg. 20121018A436712SF2CPMQ7177\n</code></pre>\n\n<p>But in some transactions, there is some noise in the form of <strong>special identifiers</strong> such as</p>\n\n<pre><code>1114\n1160\nH600\n....\n....\netc\n</code></pre>\n\n<p>I was thinking of using <em>REPLACE</em> statement to replace them like</p>\n\n<pre><code>select REPLACE (identifier, '%1114%', '') from Transactions\n</code></pre>\n\n<p>but I don't know how to do <em>REPLACE</em> using all these conditions.</p>\n\n<p>Any help will be much appreciated. Thanks </p>\n"},{"tags":["sql-server","sql-server-2008","powershell","smo"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13072207,"title":"Can't get powershell to handle a SQL Server connection failure","body":"<p>I am deliberately trying to log in to a SQL Server where I do not have a login to test some error handling with PowerShell 2.0 and SMO using SQL Server 2008 R2.</p>\n\n<p>Here's my script:</p>\n\n<pre><code>param ([String]$instanceName);\n[System.Reflection.Assembly]::LoadWithPartialName('Microsoft.SqlServer.SMO') | out-null;\n\n$conn = new-object Microsoft.SqlServer.Management.Common.ServerConnection ; \n$conn.LoginSecure = $true; \n$conn.ServerInstance = $instanceName ; \n$conn.NonPooledConnection = $true ;  \n\ntry {\n    $serverInstance = New-Object Microsoft.SqlServer.Management.Smo.Server ($conn) ; \n}\n\ncatch { \n    $err = $Error[0].Exception ; \n    write-host \"Error caught: \"  $err.Message ; \n    continue ; \n} ; \n\nWrite-Output $serverInstance.Version;\n</code></pre>\n\n<p>the catch block does not get executed. Any ideas? I also tried to trap it using the <code>trap</code> function, but got the same result.</p>\n\n<p><strong>UPDATE 1</strong></p>\n\n<p>I have changed my script to the following and have got it to catch an exception on line</p>\n\n<pre><code>foreach($j in $serverInstance.Databases) {\n</code></pre>\n\n<p>If I comment out the foreach loop, <strong>the line below the foreach loop does not raise an exception</strong>, although it should (IMO).</p>\n\n<pre><code>param ([String]$instanceName);\n\n[System.Reflection.Assembly]::LoadWithPartialName('Microsoft.SqlServer.SMO') | out-null; # load the SMO assembly\nclear\n\n $ErrorActionPreference = \"Stop\";\n    $conn = new-object Microsoft.SqlServer.Management.Common.ServerConnection ; \n    $conn.LoginSecure = $false; \n    $conn.Login = \"sa\" ; \n    $conn.Password = \"password\" ; \n    $conn.ServerInstance = $instanceName ; \n    $conn.NonPooledConnection = $true ;  \n\ntry {\n    $serverInstance = New-Object Microsoft.SqlServer.Management.Smo.Server ($conn) ; \n    foreach($j in $serverInstance.Databases) { \n        write-host $j.name ; \n    } ; \n    Write-Output $serverInstance.Databases.Count;\n}\n\ncatch [Microsoft.SqlServer.Management.Common.ConnectionFailureException] {\n    $err = $Error[0].Exception ; \n    write-host \"Error caught: \"  $err.Message ; \n    while ( $err.InnerException )    {\n        $err = $err.InnerException;\n        Write-Host \"Inner exception:\" $err.InnerException.Message;\n        };      \n    return;\n} ; \n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":53,"score":-4,"question_id":13084988,"title":"Selecting a Distinct value","body":"<p>How to select a distinct value in a query when there are more than one column when i am doing like this i am getting an error</p>\n\n<pre><code> select distinct tempname,rundate from History_Table ORDER BY RunDate DESC\n</code></pre>\n\n<p>EDIT::</p>\n\n<p>i have to show like this in my gridview</p>\n\n<pre><code>Name   Rundate \nTest   DDL(to show all the rundates)\nTest1  rundate\n</code></pre>\n"},{"tags":["c#","sql-server","query","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":155,"score":0,"question_id":5648444,"title":"Error While passing long query","body":"<p>I have a query.</p>\n\n<pre><code>DECLARE  @fromDate AS DATETIME = '01/28/2009';\nDECLARE  @ToDate AS DATETIME = '01/28/2011';\nDECLARE  @IsMonthWise AS BIT = 1\nDECLARE  @temp AS TABLE(   userId BIGINT\n                         , Visits INT\n                         , DownLoads INT )\nDECLARE  @tempmonth AS TABLE(   userId BIGINT\n                              , Visits INT\n                              , DownLoads INT\n                              , MonthYear NVARCHAR( 50 ) )\n\nIF @IsMonthWise = 0\nBEGIN\n    INSERT INTO @temp(   UserId\n                       , Visits\n                       , DownLoads )\n    SELECT  Main.user_id             AS UserId\n          , COUNT( Main.user_id )    AS Visits\n          , ( SELECT  COUNT( user_id )\n              FROM  content_hits_tbl AS Sub\n              WHERE  content_id &lt;&gt; 0 AND\n                     Main.user_id = Sub.user_id AND\n                     visit_type = 2 AND\n                     CAST( CONVERT( VARCHAR, hit_date, 101 ) AS DATETIME ) BETWEEN CAST( CONVERT( VARCHAR, @fromDate, 101 ) AS DATETIME ) AND CAST( CONVERT( VARCHAR, @ToDate, 101 ) AS DATETIME )\n              GROUP BY  USER_ID )\n    FROM  content_hits_tbl AS Main\n    INNER JOIN users\n    ON  Main.user_id = users.user_id\n    WHERE  content_id = 0 AND\n           visit_type = 1 AND\n           users.user_deleted = 0 AND\n           CAST( CONVERT( VARCHAR, hit_date, 101 ) AS DATETIME ) BETWEEN CAST( CONVERT( VARCHAR, @fromDate, 101 ) AS DATETIME ) AND CAST( CONVERT( VARCHAR, @ToDate, 101 ) AS DATETIME )\n    GROUP BY  Main.user_id\n\n    SELECT  Users.last_name + ',' + Users.first_name AS User_Name\n          , REPLACE( REPLACE( REPLACE( REPLACE( region.value_string, '1', 'APR' ), '2', 'LAR' ), '3', 'EAMER' ), '4', 'US&amp;C' ) AS User_Region\n          , CASE\n                WHEN Users.membership_user = 0 THEN 'Internal'\n                ELSE 'External'\n            END AS User_Type\n          , Visits                   AS No_of_Visits\n          , ISNULL( DownLoads, 0 )   AS No_of_DownLoads\n          , Users.user_id            AS UserId\n          , ( SELECT  userData.value_string\n              FROM  dynamic_data_tbl AS userData\n              WHERE  userData.object_id = user_id AND\n                     definition_id = 2147483649 ) AS [Organizational Group]\n    FROM  users AS Users\n    INNER JOIN @temp AS temp\n    ON  temp.UserId = Users.user_id\n    INNER JOIN dynamic_data_tbl AS region\n    ON  region.object_id = Users.user_id\n    WHERE  region.definition_id = 43\n    ORDER BY  No_of_Visits DESC\nEND\nELSE\nBEGIN\n    INSERT INTO @tempmonth(   UserId\n                            , Visits\n                            , DownLoads\n                            , MonthYear )\n    SELECT  Main.user_id             AS UserId\n          , COUNT( Main.user_id )    AS Visits\n          , ( SELECT  COUNT( user_id )\n              FROM  content_hits_tbl AS Sub\n              WHERE  content_id &lt;&gt; 0 AND\n                     Main.user_id = Sub.user_id AND\n                     DATENAME( mm, Main.hit_date ) + '-' + DATENAME( yyyy, Main.hit_date ) = DATENAME( mm, Sub.hit_date ) + '-' + DATENAME( yyyy, Sub.hit_date ) AND\n                     visit_type = 2 AND\n                     CAST( CONVERT( VARCHAR, hit_date, 101 ) AS DATETIME ) BETWEEN CAST( CONVERT( VARCHAR, @fromDate, 101 ) AS DATETIME ) AND CAST( CONVERT( VARCHAR, @ToDate, 101 ) AS DATETIME )\n              GROUP BY  USER_ID\n                      , DATENAME( mm, hit_date ) + '-' + DATENAME( yyyy, hit_date ) )\n          , DATENAME( mm, hit_date ) + '-' + DATENAME( yyyy, hit_date ) AS MonthYear\n    FROM  content_hits_tbl AS Main\n    INNER JOIN users\n    ON  Main.user_id = users.user_id\n    WHERE  content_id = 0 AND\n           visit_type = 1 AND\n           users.user_deleted = 0 AND\n           CAST( CONVERT( VARCHAR, hit_date, 101 ) AS DATETIME ) BETWEEN CAST( CONVERT( VARCHAR, @fromDate, 101 ) AS DATETIME ) AND CAST( CONVERT( VARCHAR, @ToDate, 101 ) AS DATETIME )\n    GROUP BY  Main.user_id\n            , DATENAME( mm, hit_date ) + '-' + DATENAME( yyyy, hit_date )\n\n    SELECT  Users.last_name + ',' + Users.first_name AS User_Name\n          , REPLACE( REPLACE( REPLACE( REPLACE( region.value_string, '1', 'APR' ), '2', 'LAR' ), '3', 'EAMER' ), '4', 'US&amp;C' ) AS User_Region\n          , CASE\n                WHEN Users.membership_user = 0 THEN 'Internal'\n                ELSE 'External'\n            END AS User_Type\n          , Visits                   AS No_of_Visits\n          , ISNULL( DownLoads, 0 )   AS No_of_DownLoads\n          , Users.user_id            AS UserId\n          , temp.MonthYear           AS MonthYear\n          , ( SELECT  userData.value_string\n              FROM  dynamic_data_tbl AS userData\n              WHERE  userData.object_id = user_id AND\n                     definition_id = 2147483649 ) AS [Organizational Group]\n    FROM  users AS Users\n    INNER JOIN @tempmonth AS temp\n    ON  temp.UserId = Users.user_id\n    INNER JOIN dynamic_data_tbl AS region\n    ON  region.object_id = Users.user_id\n    WHERE  region.definition_id = 43\n    ORDER BY  User_Name ASC\n            , MonthYear DESC\nEND\n\nDELETE FROM @temp\n\nDELETE FROM @tempmonth\n</code></pre>\n\n<p>IT Works fine if in run in SQL server. But if i pass the same as string from C# code(ExecuteReader).It is Not executing.</p>\n\n<p>If i copy the query from code behind and paste in sql server it is coming in single row.I think it is the reason why my query is not executing.</p>\n\n<p>Please let me know the way how to pass execute long query from my Application (C#)</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","visual-studio","sql-server-2008","visual-studio-2010"],"answer_count":3,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":2713,"score":3,"question_id":2419828,"title":"DB Designer in Visual Studio 2010","body":"<p>I need to create an entirely new Sql Server 2008 database and want to use a Database Project in Visual Studio 2010 (Ultimate). I've created the project and added a table under the <em>dbo</em> schema. </p>\n\n<p>The table <em>.sql</em> is shown only as plain text, though with colors. It has no designer, no <em>Add Column</em>, and no autocomplete. Existing column's properties are grayed out. </p>\n\n<p>Usually, I use DB Project for nothing more than storing <em>.sql</em> files for source control purposes, but I'm assuming it can help me with designing the DB. Currently, it offers no such help and I think it's because I'm doing something wrong. Perhaps I need to deploy the DB to server first, or something of the such. I've looked for a Getting Started guide, but all guides I found start from importing an existing database.</p>\n\n<p><strong>Please help my understand what a DB Project can do for me and how.</strong></p>\n\n<p>Thanks,<br>\nAsaf</p>\n"},{"tags":["sql","sql-server","tsql","date"],"answer_count":12,"favorite_count":30,"up_vote_count":90,"down_vote_count":0,"view_count":142213,"score":90,"question_id":113045,"title":"How to return the date part only from a SQL Server datetime datatype","body":"<pre><code>SELECT GETDATE()\n</code></pre>\n\n<p>Returns: <code>2008-09-22 15:24:13.790</code></p>\n\n<p>I want that date part without the time part: <code>2008-09-22 00:00:00.000</code></p>\n"},{"tags":["sql-server","c#-4.0","stored-procedures"],"answer_count":5,"favorite_count":4,"up_vote_count":7,"down_vote_count":0,"view_count":182,"score":7,"question_id":12948312,"title":"Why Stored Procedure is faster than Query?","body":"<p>If I want to write simple single line query , query to select only one value from database so if I write stored procedures for this simple query rather to write select query in c# code than I am sure that stored procedure for this simple select query will be fast but why ???\nI am confused with stored procedure vs writing simple query in my code ?\nI am confused that why stored procedure are faster than simple one query written directly in code?</p>\n"},{"tags":["sql-server","select","insert"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13085291,"title":"Inserting data into table using Select","body":"<p>I have a table employee1 and employee2 where I would like to insert data from one table to another using select based on a condition such as</p>\n\n<blockquote>\n  <p>INSERT INTO EMPNO, EMPNAME, EMPAGE, EMPSALARY, EMPDESIGNATION SELECT\n  EMPNO, EMPNAME, 0, '', EMPDESIGNATION WHERE EMPID=25</p>\n</blockquote>\n\n<p>This is what I want to achieve as there are some values which i don't want to supply because they are default or for some other reason but this is not allowed.</p>\n\n<p>Can you tell me how can I achieve this</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13084902,"title":"SQL: Convert String of MMMDD to Datetime","body":"<p>I have a nvarchar(5) column of data that is formatted MMMDD (for example, OCT26). With my select statement, I'd like to convert it to a datetime data type with the current year, and then save that datetime value as an alias, say, UsefulDate. So something like 10-26-2012.</p>\n\n<p>Something like: SELECT (whatever SQL gets the job done) AS UsefulDate</p>\n\n<p>The exact formatting doesn't matter; I just need to be able to compare two dates together with greater than and less than operators. Also, sometimes the column will be blank. In that case, I'd like to set the alias to blank as well. Is this possible?</p>\n\n<p>Thanks for your help!</p>\n"},{"tags":["sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":732,"score":3,"question_id":7297609,"title":"cannot use alias in ROW_NUMBER() over in SQL Server?","body":"<p>I have to create a row_number column ordered by a grouped sum, when using sql:</p>\n\n<pre><code>select Sales.Name, SUM(Sales.Bill) as billsum, ROW_NUMBER() over (order by billsum DESC) as rn\nfrom Sales group by Sales.Name\n</code></pre>\n\n<p>It reports error because row_number over cannot parse the \"billsum\" alias, I have to write:</p>\n\n<pre><code>select Sales.Name, SUM(Sales.Bill) as billsum, ROW_NUMBER() over (order by SUM(Sales.Bill) DESC) as rn\nfrom Sales group by Sales.Name\n</code></pre>\n\n<p>so here I write SUM(Sales.Bill) twice, is there anyway to use the alias here?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":13082595,"title":"T-SQL: How to deny update on one column of a table via trigger?","body":"<p>Question: <br />\nIn our SQL-Server 2005 database, we have a table T_Groups.<br />\nT_Groups has, amongst other things, the fields ID (PK) and Name.</p>\n\n<p>Now some idiot in our company used the name as key in a mapping table...<br />\nWhich means now one may not alter a group name, because if one does, the mapping is gone...\n<br />\nNow, until this is resolved, I need to add a restriction to T_Groups, so one can't update the group's name. <br />\nNote that insert should still be possible, and an update that doesn't change the groupname should also be possible.<br /></p>\n\n<p>Also note that the user of the application &amp; the developers have both dbo and sysadmin rights, so REVOKE/DENY won't work.\n<br /><br />\nHow can I do this with a trigger ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","foreign-keys"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13084217,"title":"Sql Server 2008 Create Foreign Key Manually","body":"<p>I have inherited an old database which wasn't designed very well. It is a Sql Server 2008 database which is missing quite a lot of Foreign Key relationships. Below shows two of the tables, and I am trying to manually create a FK relationship between <strong>dbo.app_status.status_id</strong> and <strong>dbo.app_additional_info.application_id</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/NNaF4.png\" alt=\"enter image description here\"></p>\n\n<p>I am using SQL Server Management Studio when trying to create the relationship using the query below</p>\n\n<pre><code>USE myDatabase; \nGO ALTER TABLE dbo.app_additional_info \nADD CONSTRAINT FK_AddInfo_AppStatus FOREIGN KEY (application_id) \n    REFERENCES dbo.app_status (status_id) \n    ON DELETE CASCADE\n    ON UPDATE CASCADE ; \nGO\n</code></pre>\n\n<p>However, I receive this error when I run the query</p>\n\n<blockquote>\n  <p>The ALTER TABLE statement conflicted with the FOREIGN KEY constraint\n  \"FK_AddInfo_AppStatus\". The conflict occurred in database\n  \"myDatabase\", table \"dbo.app_status\", column 'status_id'.</p>\n</blockquote>\n\n<p>I am wondering if the query is failing because each table already contains approximately 130,000 records?</p>\n\n<p>Please help.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13084216,"title":"Fetch the rundates using ID","body":"<p>I have a table where i have ID,Name and Rundate and the templates going to run everyday multiple times so i have to fetch the name of the template(only single name how many times it may run) and the number of rundates using a store procedure .Please help me with this,thanks.</p>\n\n<pre><code> ID    name      Rundate \n  1    Test       timeformat\n  2    Test        \n  3    Test 1\n</code></pre>\n\n<p>but when i want to show in the gridview i have to avoid the duplicate name and i have to show only single Test and the rundates associated with it in a dropdownlist.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":544,"score":1,"question_id":4934034,"title":"select specific records with specific ordering without using a common condition","body":"<p>My purpose the following:</p>\n\n<p>I have a list of \"StudentID\"... Let's say: 4, 2, 3, 5, 7 (stored in an array for example),\nand I want to make a select statement that returns StudentID and StudentName of the specified studentID in the list, <strong><em>with the same order of the list</em></strong>.</p>\n\n<p>So the result should be:</p>\n\n<pre><code>StudentID StudentName\n4         Philip\n2         Mary\n3         Tima\n5         Lara\n7         Michel\n</code></pre>\n\n<p>How can I achieve this?</p>\n"},{"tags":["c#","sql-server","types","entity-framework-4","sqldatatypes"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":565,"score":3,"question_id":8656102,"title":"What's the correct data type I should use in this case?","body":"<p>I have to represent numbers in my database, which are amounts of chemical substances in food, like fats, energy, magnesium and others. These values are decimals in format 12345.67.</p>\n\n<p>If I use <code>decimal (5,2)</code> as data type in SQL Server, it maps to <code>Decimal</code> type in Entity Framework. If I use float as data type in SQL Server, it maps to <code>Double</code> in Entity Framework.</p>\n\n<p>I'm not sure what the best data type in SQL Server would have to be, or doesn't it really matter a lot? </p>\n\n<p>EDIT - in my case it should be <code>decimal(7,2)</code>, as mentioned in some of the remarks!</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","system-tables"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13083492,"title":"SQL Server: cannot access system tables","body":"<p>I have an MSSQL database and a \"normal\" user accessing it. When I try to use tables like sys.objects, I become a permission error:</p>\n\n<pre><code>select name from sys.objects\nMsg 229, Level 14, State 5, Line 1\nThe SELECT permission was denied on the object 'objects', database 'mssqlsystemresource', schema 'sys'.\n</code></pre>\n\n<p>Why? The documentation says</p>\n\n<blockquote>\n  <p>In SQL Server 2005 and later versions, the visibility of the metadata\n  in catalog views is limited to securables that a user either owns or\n  on which the user has been granted some permission.</p>\n</blockquote>\n\n<p>so I think I should be allowed to use sys.objects, even if it will list only the for me visible objects...</p>\n\n<p>My user have been created with</p>\n\n<pre><code>CREATE LOGIN [factoryFX20_K_user] WITH PASSWORD=N'...', DEFAULT_DATABASE=[ff20121025], DEFAULT_LANGUAGE=[English], CHECK_EXPIRATION=OFF, CHECK_POLICY=ON\nEXEC sys.sp_addsrvrolemember @loginame = N'factoryFX20_K_user', @rolename = N'serveradmin'\n\nUSE [ff20121025]\nCREATE USER [factoryFX20_K_user] FOR LOGIN [factoryFX20_K_user] WITH DEFAULT_SCHEMA=[factoryFX20_K_user]\n</code></pre>\n"},{"tags":["sql-server","database"],"answer_count":11,"favorite_count":12,"up_vote_count":41,"down_vote_count":0,"view_count":91605,"score":41,"question_id":168724,"title":"Generate table relationship diagram from existing schema (SQL Server)","body":"<p>Is there a tool around that would produce a diagram showing existing tables and their relationships given a connection to a database or by any other means?</p>\n\n<p>This is for SQL Server 2008 Express Edition.</p>\n"}]}
{"total":54452,"page":14,"pagesize":100,"questions":[{"tags":["sql","sql-server","naming-conventions"],"answer_count":15,"favorite_count":5,"up_vote_count":16,"down_vote_count":0,"view_count":2908,"score":16,"question_id":1764483,"title":"SQL Join Table Naming Convention","body":"<p>I have 2 tables: Users and Roles, and I have a table that joins these together. The only thing in the join table is Ids that link the 2 tables.</p>\n\n<p>What should I call this table? I've never really seen a good naming convention for this.</p>\n\n<p>Conventions I've seen before:</p>\n\n<ul>\n<li>UsersToRolesJoin</li>\n<li>UsersToRolesLink</li>\n<li>UsersToRolesMembership</li>\n<li>UsersRoles</li>\n</ul>\n\n<p>Ex:</p>\n\n<pre><code>Users:  \nId  \nName\n\nRoles:  \nId  \nName  \n\nTableThatJoinsTheTwo:  \nId  \nUserId  \nRoleId\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","ssis","csv","import"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":8100,"score":4,"question_id":89372,"title":"How to import variable record length CSV file using SSIS?","body":"<p>Has anyone been able to get a variable record length text file (CSV) into SQL Server via SSIS?</p>\n\n<p>I have tried time and again to get a CSV file into a SQL Server table, using SSIS, where the input file has varying record lengths.  For this question, the two different record lengths are 63 and 326 bytes.   All record lengths will be imported into the same 326 byte width table.</p>\n\n<p>There are over 1 million records to import.<br />\nI have no control of the creation of the import file.<br />\nI must use SSIS.<br />\nI have confirmed with MS that this has been reported as a bug.\nI have tried several workarounds.  Most have been where I try to write custom code to intercept the record and I cant seem to get that to work as I want.</p>\n"},{"tags":["sql-server","sql-server-2008","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13083302,"title":"pivot table w/out function","body":"<p>I am trying to write a sql statement that creates a pivot table.</p>\n\n<p>The data is a list of survey responses and is made from a join query involving tables respondent, response and answer.  The answer table is structured as below:</p>\n\n<pre><code>______________________________________________________________\n|AnswerID|ResponseID|QuestionID|AnswerComment                |\n|      1 |        1 |        1 |This is answer 1             |\n|      2 |        1 |        2 |This is answer 2             |\n|      3 |        1 |        3 |This is answer 3             |\n|      4 |        2 |        1 |Answer 1 Respondent 2        |\n|      5 |        2 |        3 |Resp 2, No Q.2               |\n|      6 |        3 |        2 |I answered Q.2 only          |\n|____________________________________________________________|\n</code></pre>\n\n<p>Respondent looks like:</p>\n\n<pre><code>______________________________________________________________\n|RespondentID|GivenName|Surname|age, gender, blah blah       |\n|____________________________________________________________|\n</code></pre>\n\n<p>Response:</p>\n\n<pre><code>______________________________________________________________\n|ResponseID|ResponseDate|RespondentID|Attachment             |\n|____________________________________________________________|\n</code></pre>\n\n<p>and Question:</p>\n\n<pre><code>_____________________________________________________\n|QuestionID|QuestionNumber|QuestionText|            |\n|___________________________________________________|\n</code></pre>\n\n<p>I want my output in the form of:</p>\n\n<pre><code>________________________________________________________________________________________\n|RespondentInfo|ResponseDate|1                     |2                  |3               |\n|Respondent 1  |15/10/2012  |This is answer 1      |This is answer 2   |This is answer 3|\n|Respondent 2  |17/10/2012  |Answer 1 Respondent 2 |                   |Resp 2, No Q.2  |\n|Respondent 3  |19/10/2012  |                      |I answered Q.2 only|                |\n|______________________________________________________________________________________|\n</code></pre>\n\n<p>I want to get one line per respondent with each answer in the corresponding column.  The query I have created - although it pivots the answers to the correct columns - provides a new row for each answer with nulls in all the blank columns.</p>\n\n<p>My sql:</p>\n\n<pre><code>SELECT Respondent, ResponseDate, \n         [1], [2], [3]\nFROM  (\n       SELECT  Respondent.Surname + ', ' + FirstName as RespondentInfo, \n               Response.ResponseDate, \n               isnull(Answer.AnswerComment, '') as Answer, \n               Qustion.QuestionNumber\n       FROM    Answer INNER JOIN\n                Question ON Answer.QuestionID = Question.QuestionID INNER JOIN\n                   Response ON Answer.ResponseID = Response.ResponseID INNER JOIN\n                   Respondent ON Response.RespondentID = Respondent.RespondentID\n       ) as ResponseQuery\nPIVOT (\n    max(Answer)\nFOR ResponseQuery.QuestionNumber in ([1], [2], [3])\n       ) AS OutputTable\n</code></pre>\n\n<p>I think the issue is because I am not using an aggregate function so have defaulted to max().  Can anyone point me in the right direction.  </p>\n\n<p>Apologies if my question is too verbose.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13083191,"title":"WHERE clause not working, uses ISNULL","body":"<p>Not sure where the problem is, but I've got a function that is returning the wrong total.  I've put the same criteria into a view and it again returns the wrong records.</p>\n\n<pre><code>    FieldsA&lt;&gt;'XYZ' \nAND CustAcc=345 \nAND Supplier&lt;&gt;'FG67FG' \nAND Category='XYZ' \nAND isnull(STATUS,'ZZZ')='READY' \nAND isnull(DESPATCHSTATUS,\"ZZZ\")='APPROVED'\n</code></pre>\n\n<p>It works for most of the records, but one I'm looking at, is coming back and the DESPATCHSTATUS is 'REJECTED'.</p>\n\n<p>Any ideas why this, particularly ISNULL might misbehave?</p>\n"},{"tags":["c#","sql-server"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":13083229,"title":"return exception when run one stored procedure","body":"<p>I have this stored procedure</p>\n\n<pre><code>create PROCEDURE spgetoutpatientidbyinpatientid\n@pinpatientid int\nAS\n\nBEGIN\n\nselect  Patient_ID \n    from tblPatientAdmissionDetails \n    where ID=@pinpatientid and Status=1\nEND\nGO\n</code></pre>\n\n<p>if this condition is wrong i got null exception.I want to return at least null value or anything.how can i avoid this error. In my code I use </p>\n\n<pre><code>&lt;pre lang=\"c#\"&gt;string  ds = UserDataBase.ExecuteScalar(Command).ToString();&lt;/pre&gt;\n</code></pre>\n\n<p>How can I change my sql query..? or how can I avoid this exception</p>\n"},{"tags":["sql-server","sql-server-2005","ddl"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":635,"score":2,"question_id":7956620,"title":"Do statistics referencing a column prevent that column from being dropped?","body":"<p>I'm trying a very simple <code>drop column</code> statement:</p>\n\n<pre><code>alter table MyTable drop column MyColumn\n</code></pre>\n\n<p>and receiving several errors along the lines of</p>\n\n<blockquote>\n  <p>Msg 5074, Level 16, State 1, Line 1<br>\n  The statistics '_dta_stat_1268251623_3_2' is dependent on column 'MyColumn'.</p>\n</blockquote>\n\n<p>followed ultimately by</p>\n\n<blockquote>\n  <p>Msg 4922, Level 16, State 9, Line 1<br>\n  ALTER TABLE DROP COLUMN MyColumn failed because one or more objects access this column.</p>\n</blockquote>\n\n<p>I didn't think statistics prevent a column from being dropped. Do they? If so, since these are apparently auto-created statistics I can't depend on the names being the same across multiple copies of the same database, so how could I drop all such statistics in an upgrade script to be executed on a different database?</p>\n"},{"tags":["sql-server","ssms","management-studio"],"answer_count":5,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":4813,"score":5,"question_id":1726577,"title":"SQL Management Studio won't open scripts on double-click","body":"<p>I'm used to double-clicking *.sql script files to open them in SQL Server Management Studio. I recently upgraded to Win7, and now when I double-click a script file, SSMS opens with an empty environment. I can then use File/Open or File/Recent Files to open my script, but I would much prefer for it to just open whatever I double-clicked on like a normal application would. </p>\n\n<p>Any ideas what's going on?</p>\n\n<p>BTW when I double-click a script from the Solution Explorer in Visual Studio, it does open it automatically just like you would expect. </p>\n"},{"tags":["sql-server","inner-join"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13083122,"title":"Selecting fields with same name inside join","body":"<p>I`ve got a sql query like this:</p>\n\n<pre><code>    SELECT com.*\nfrom VE_COMMAND_SITE_BIND bnd INNER JOIN [dbo].[VE_COMMAND] com ON bnd.COMMAND_ID = com.ID\n</code></pre>\n\n<p>There is field named 'ON' in both tables. I want to select all the fields from the first table com as I do with com.<em>,\nbut the field 'ON' from the second table bnd. I also don<code>t want to mention all the com</code>s fields - I like com.</em>! </p>\n\n<p>Is there any proper way in MSSQL to do such things?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2783,"score":0,"question_id":5483702,"title":"Truncate all tables of a database in SQL Server 2005","body":"<p>How can I truncate all tables of a database?</p>\n"},{"tags":["sql","sql-server","permissions","dotnetnuke","sysobjects"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":10468,"score":6,"question_id":1473315,"title":"The SELECT permission was denied on the object 'sysobjects', database 'mssqlsystemresource', schema 'sys'","body":"<p>SETUP: SQL Server 2005 &amp; DotNetNuke 05.01.02. </p>\n\n<p>This started with me trying to install a DNN Module that had \"select * from dbo.sysobjects\" in it's SQL scripts. That failed with the following error: </p>\n\n<blockquote>\n  <p>The SELECT permission was denied on\n  the object 'sysobjects', database\n  'mssqlsystemresource', schema 'sys'.</p>\n</blockquote>\n\n<p>I logged into the database via SQL Server Management Studio as the DNN user account, and I get the same error when I try and perform a SELECT on the sysobjects view. </p>\n\n<p>I tried to grant the DNN user account explicit SELECT permission to that view. When I check it by going to Security -> Users -> DNNUserLogin-> right-click -> Properties -> Securables and scroll down to find the sys.sysobjects view, it says this user account has explicit permissions for dbo: And the SELECT checkbox is checked. But I still cannot perform a select on the sysobjects view as that DNN user account. </p>\n\n<p>What am I doing wrong? How can I make this work?</p>\n"},{"tags":["sql-server","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13082124,"title":"mssql - one stored procedure vs multiple storedprocedures","body":"<p>I have a situation where server side function (c#) should return different selects from different tables (t1,t2, ...) database but number and type of params are always the same.</p>\n\n<p>There is a param <code>@Type</code> which determine a type of select should be returned.</p>\n\n<p>Is it better to write a different stored procedure for each <code>@type</code> or write one stored procedure with <code>switch(@type)</code> in it ?</p>\n\n<p>edit:\neach select may be large about 2000 - 3000 characters</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13082573,"title":"Need help in building query","body":"<p>I am trying to fetch data from three tables on the basis of most comment received to a person, below is my table structure</p>\n\n<pre><code>&gt; Table A\nID | Follower | Comment | PLACE\n-------------------------------\n1  | ABC      | TEXT1   | LA\n3  | ABC      | TEXT1   | NY\n1  | ABC      | TEXT2   | LA\n2  | ABC      | TEXT1   | IL\n1  | ABC      | TEXT2   | LA\n\nTable B\nID | NAME     | PLACE\n-----------------------\n1  | Name1    | LA\n2  | Name2    | IL\n3  | Name3    | NY\n\nTable C\nPLACE | COUNTRY \n-----------------------\nLA    | US      \nIL    | US      \nNY    | US  \n</code></pre>\n\n<p>What I am trying to do is something like this :-</p>\n\n<pre><code>    SELECT        \na.PLACE, a.ID, a.NAME, b.PLACE, Count(b.ID) AS CT, c.PLACE, c.COUNTRY\nFROM            \nTableB AS a INNER JOIN\nTableA AS b ON a.ID = b.ID INNER JOIN\nTableC AS c ON b.PLACE = c.PLACE\nGROUP by b.ID\nORDER BY (CT) DESC\n</code></pre>\n\n<p>Thanks in advance for any helpful suggestions.</p>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework-4.1","query-by-example"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12855990,"title":"ASP.NET MVC4 Query By Example Open Source Suggestions","body":"<p>We're currently building a new application and part of the functionality we want to include for users is the ability to build ad-hoc querys through the web UI for reporting purposes.</p>\n\n<p>e.g. The user may select the Entity1 report.</p>\n\n<p>They are then able to select the criteria through the UI</p>\n\n<p>pseudo example:\n((Entity1.Type = 'this' OR Entity1.Type = 'something else') AND Entity1.CreatedDate > '01-01'2012')</p>\n\n<p>Does anyone know if there is a good solution available (open source or paid) as this seems like it might be a lot of work to implement a bespoke solution.</p>\n\n<p>Further to this we are using Entity Framework v4.1 magical unicorn edition.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":9,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":17887,"score":6,"question_id":878833,"title":"Passing a varchar full of comma delimited values to a SQL Server IN function","body":"<p><strong>Duplicate of</strong></p>\n\n<p><a href=\"http://stackoverflow.com/questions/517028/dynamic-sql-comma-delimited-value-query\">Dynamic SQL Comma Delimited Value Query</a><br>\n<a href=\"http://stackoverflow.com/questions/303149/parameterized-queries-with-like-and-in-conditions\">Parameterized Queries with Like and In</a> </p>\n\n<p>I have a SQL Server Stored procedure where I would like to pass a varchar full of comma delimited values to an in function. Example</p>\n\n<pre><code>Declare @Ids varchar(50)\n    Set @Ids = 1,2,3,5,4,6,7,98,234\n\nSelect * from sometable where tableid in(@Ids)\n</code></pre>\n\n<p>This does not work of course. I get the error:</p>\n\n<p>Conversion failed when converting the varchar value '1,2,3,5,4,6,7,98,234' to data type int.</p>\n\n<p>How can I accomplish this (or something relatively similar) without resorting to building dynamic sql?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13082341,"title":"freetext search with full string in sql server","body":"<p>When I provide a two word string like <em>hello world</em> in freetext search, it fetching data with <strong>hello</strong> string and then with <strong>world</strong> but not with <em>hello world</em>.</p>\n\n<p>But i cant go for like operator.</p>\n\n<pre><code>DECLARE @var VARCHAR(50)\n    SET @var = 'hello world'\n select * from helloTable where freetext(ColumnName, @var)\n</code></pre>\n\n<p>Result:</p>\n\n<p>first set of rows are fetched on 'hello' and second set on 'world', <strong>but i need with full string</strong>.</p>\n"},{"tags":["sql","mysql","sql-server","postgresql"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":472,"score":0,"question_id":1374638,"title":"Why is PostgreSQL Harder to Manage/Maintain then other Databases","body":"<p>I am very interested in postgesql because they have a uuid data type. I have done searches around SO and many people say that Postgres is harder to maintain and manage. Why is this? Is it because postgres needs more configuration, is it because postgres does not have a GUI?</p>\n"},{"tags":["sql","sql-server","database","constraints"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":13077710,"title":"Constraint on multiple columns with specific values","body":"<p>My schema has 3 columns: <code>ID1</code>, <code>ID2</code>, <code>Status</code></p>\n\n<p>Each of the above columns is a string.</p>\n\n<p>I would like to create a constraint which is the following:</p>\n\n<p>There cannot be multiple records which have the same <code>ID1</code> and <code>ID2</code> which are in the 'UNPROCESSED' state. It is ok if there are multiple records which have the same <code>ID1</code> and <code>ID2</code> which are not in the UNPROCESSED state.</p>\n\n<p>Is it possible to do this in SQL Server?</p>\n"},{"tags":["java","sql-server","jdbc"],"answer_count":4,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":38429,"score":6,"question_id":540489,"title":"How can I use the MS JDBC driver with MS SQL Server 2008 Express?","body":"<p>My configuration:  </p>\n\n<ul>\n<li>windows XP SP3</li>\n<li>JDBC 2005</li>\n<li>MS SQL Server 2008 Express, exposed via tcp/ip on port 1433</li>\n<li>sqljdbc.jar in class path </li>\n</ul>\n\n<p>I tried:</p>\n\n<pre><code>try {\n    Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\").newInstance();\n    con = DriverManager.getConnection(\"jdbc:microsoft:sqlserver://localhost:1433/SQLEXPRESS2008;databaseName=Test;selectMethod=cursor\", \"sa\", \"\");\n}\ncatch (Exception e) {\n    e.printStackTrace();\n}\n</code></pre>\n\n<p>But it always throws an exception:</p>\n\n<pre><code>java.sql.SQLException: No suitable driver\n</code></pre>\n\n<p>I also tried the following urls:</p>\n\n<pre><code>localhost:1433/SQLEXPRESS2008\n\nlocalhost/SQLEXPRESS2008\n\nlocalhost\n</code></pre>\n\n<p>Same results. \nAny help?</p>\n"},{"tags":["sql-server","reporting-services","formatting"],"answer_count":8,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":5390,"score":3,"question_id":611735,"title":"What is the correct expression to use in order to format a date from \"yyyyMMdd\" to \"M/d/yyyy\" in SQL Server Reporting Services?","body":"<p>I get dates in my dataset in the form \"yyyyMMdd\" (ie 20080228 means Feb 28, 2008)</p>\n\n<p>I need to convert these to \"M/d/yyyy\"</p>\n\n<p>Examples:</p>\n\n<pre><code>20080228 = 2/28/2008\n20080101 = 1/1/2008\n20081001 = 10/1/2008\n20081212 = 12/12/2008\n</code></pre>\n\n<p>what is the correct expression to handle this?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>The expression that I used (ORDDTE is in the \"yyyyMMdd\" format and I have a switch for spanish or english date format):</p>\n\n<pre><code>=CDate(Mid(First(Fields!ORDDTE.Value, \"ReturnTagHeader\").ToString(), 5, 2) + \"/\" + Right(First(Fields!ORDDTE.Value, \"ReturnTagHeader\").ToString(), 2) + \"/\" + Left(First(Fields!ORDDTE.Value, \"ReturnTagHeader\").ToString(), 4)).ToString(IIf(Parameters!Language.Value = \"ES\", \"d/M/yyyy\", \"M/d/yyyy\"))\n</code></pre>\n"},{"tags":["sql-server","internet-explorer","website"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":17,"score":-2,"question_id":13082170,"title":"I cannot add records to my database (MS SQL) from IE8","body":"<p>I am able to add records from IE9 from my website, but however, I am not able to add records from a computer that runs IE8. What can be the problem? Somebody help me!! :(</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13081654,"title":"Issue Related to inner Query in SQL Server","body":"<p>I have Following Tables in SQL Server Database:</p>\n\n<pre><code>(1) StudentMaster (StudentId, StudentName)\n\n(2) SubjectMaster (SubjectId, SubjectName)\n\n(3) AttendanceMaster (AttendanceId,StudentId,SubjectId,Attendance,Date)\n\n\nData in AttendanceMaster can be in Following format :\n\nAttendanceMaster :\n           AttendanceId   StudentId   SubjectId    Attendance   Date\n              3001          33          1            P           1/1/2011 \n              3001          57          2            P1          1/2/2011 \n              3001          33          1            P           1/3/2011 \n              3001          57          2            P2          1/4/2011 \n              3001          33          1            P1          1/5/2011  \n</code></pre>\n\n<p>I want to get SubjectWise Individual Attendance Details in Following Format:</p>\n\n<pre><code>StudentName  SubjectName   Total(P)  Total(P1)  Total(P2)\n Ghanshyam     Maths         90        10          5\n John          Maths         85        15          5\n Ghanshyam     Science       70        20          15\n John          Science       80        30          5  \n</code></pre>\n\n<p>i tried following Query  :</p>\n\n<pre><code>select StudentName, SubjectName,\n(select count(*) from AttendanceMaster innerAM where innerAM.StudentId = StdM.StudentId and innerAM.SubjectId=SubM.SubjectId and innerAM.Attendance = 'P') as Total(P),\n(select count(*) from AttendanceMaster innerAM where innerAM.StudentId = StdM.StudentId and innerAM.SubjectId=SubM.SubjectId and innerAM.Attendance = 'P1') as Total(P1),\n(select count(*) from AttendanceMaster innerAM where innerAM.StudentId = StdM.StudentId and innerAM.SubjectId=SubM.SubjectId and innerAM.Attendance = 'P1') as Total(P2)\nfrom AttendanceMaster AM inner join StudentMaster StdM on AM.StudentId = StdM.StudentId\ninner join SubjectMaster SubM on AM.SubjectId = SubM.SubjectId\n</code></pre>\n\n<p>I got result but it gets too much time to execute..( about 5 to 6 minut )</p>\n\n<pre><code>so what can i do to decrease execution time...\n</code></pre>\n\n<p>and also  is it right way to write a query to get  Total(P),Toal(P1),Total(P2)  ??\nplease specify other SQL Syntax </p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","visual-studio-lightswitch"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2236,"score":2,"question_id":3534611,"title":"LightSwitch Beta 1 looking for SQL Express instead of full SQL instance","body":"<p>After resolving issues with RIA installation <a href=\"http://stackoverflow.com/questions/3518051/missing-references-in-lightswitch-beta-1-autogen-code\">here</a>, I'm still getting this following error.  Not much special - I tried to create a new screen based off of data sources from an existing database in a full SQL 2005 instance</p>\n\n<blockquote>\n  <p>An error occurred while establishing a\n  connection to SQL Server instance\n  '.\\SQLEXPRESS'. A network-related or\n  instance-specific error occurred while\n  establishing a connection to SQL\n  Server. The server was not found or\n  was not accessible. Verify that the\n  instance name is correct and that SQL\n  Server is configured to allow remote\n  connections. (provider: SQL Network\n  Interfaces, error: 26 - Error Locating\n  Server/Instance Specified)</p>\n</blockquote>\n\n<p>I've tried to correct the connection string in the, I guess, autogen'd config file.  Even though Visual Studio doesn't seem to think that the file is overwritten on rebuild, the error continues to appear.</p>\n\n<p>How can I use LightSwitch with full SQL 2005 rather than SQL Express?</p>\n"},{"tags":["sql-server","asp.net-mvc","asp.net-web-api","web-api"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":469,"score":0,"question_id":11769279,"title":"ASP.NET MVC 4/Web API - How to configure SQL Server to allow access to API calls from a URL in browser?","body":"<p>I have a server with a SQL Server 2012 Express database. I am authenticated to connect to it and am using it as the backend for an ASP.NET MVC 4 application. </p>\n\n<p>With this application I'm also developing an API. Calling the API programmatically using jQuery within my own application works fine. Querying the database to get the information works as well. </p>\n\n<p>However, when I run the application from VS2010 and try accessing the API by using a URL that would access the database, I get an HTTP 500 Error. </p>\n\n<p>Just to make sure this issue isn't on my application's end, I then modified the API resource so it gets a local array (instead of information from the database) and when I hit the same URL, it returned the information in XML form on the localhost page.</p>\n\n<p>The problem seems to be that the URL call to the API attempts to connect to the database not as the authenticated user (me), but from the browser. </p>\n\n<p>How can I configure SQL Server to allow a URL call to the API in the browser to access the database and return the data in JSON/XML form? (eg. like you can do with the Twitter REST API)</p>\n\n<p><strong>UPDATE:</strong>\nDebugging output on HTTP Request:</p>\n\n<p>Request URL:http://localhost:5555/api/Performance/ShowMachines</p>\n\n<p>Request Method:GET</p>\n\n<p>Status Code:500 Internal Server Error</p>\n\n<p>Request Headersview source</p>\n\n<p>Accept:text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8</p>\n\n<p>Accept-Charset:ISO-8859-1,utf-8;q=0.7,*;q=0.3</p>\n\n<p>Accept-Encoding:gzip,deflate,sdch</p>\n\n<p>Accept-Language:en-US,en;q=0.8</p>\n\n<p>Connection:keep-alive</p>\n\n<p>Host:localhost:5555</p>\n\n<p>User-Agent:Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.47 Safari/536.11</p>\n\n<p>Response Headersview source</p>\n\n<p>Cache-Control:private</p>\n\n<p>Connection:Close</p>\n\n<p>Content-Length:0</p>\n\n<p>Date:Thu, 02 Aug 2012 16:40:11 GMT</p>\n\n<p>Server:ASP.NET Development Server/10.0.0.0</p>\n\n<p>X-AspNet-Version:4.0.30319</p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13081347,"title":"Stored procedure to call a different stored procedure based on parameter","body":"<p>I would like to create a stored procedure in Sql Server that calls one of a number of different stored procedures and chooses which one based on the parameter supplied to it, but I can't seem to get the choosing syntax right.</p>\n\n<p>Currently attempting:</p>\n\n<pre><code>Begin\n  Set nocount on;\n  exec iif(param='individual', sp_FindIndividualRespondents, \n      iif(param='org', sp_FindOrgRespondents, sp_FindGroupRespondents))\nEnd\n</code></pre>\n\n<p>This is currently telling me: Incorect syntax near 'param'.</p>\n\n<p>I have looked here: <a href=\"http://stackoverflow.com/questions/4159528/conditional-where-clause-based-on-a-stored-procedure-parameter\">conditional where clause based on a stored procedure parameter?</a>, but I can't work out how to change that code to suit my situation.</p>\n\n<p>How do i provide a parameter to a stored procedure and then use it to choose and run a different stored procedure?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13081309,"title":"Converting Date to String in SQL Server 2005","body":"<p>I am working on SQL server 2005. While inserting specified date in the database by this format:<br>\n(<code>10/11/2012 00:00:0:00</code>)(<code>MM/dd/yyyy HH:mm:s:ms</code>).</p>\n\n<pre><code>select CAST(day(column name) AS CHAR(2)) + ' '\n   + CONVERT(CHAR(4), column name, 100) + ', '\n   + CONVERT(CHAR(4), column name, 120) as Coupon_expire\nfrom Admin\n</code></pre>\n\n<p>I can't convert this date to this type (<code>Wednesday, October 11, 2012</code>), please help me.</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13081125,"title":"update using cursor","body":"<p>hope all you are fine. i have some problem  in sql server query. </p>\n\n<p>i want to update recorde in a table which have 534,000 rows. if i create a while loop for update all record then it takes time.</p>\n\n<p>then i should create a cursor for update record. after this i create a cursor for update using Fetch. this cursor complete updating process quickly in 10,000 rows but when i use table which have more than 30,000 rows it takes 5 minuts to execute Query. i don't know what is the problem.</p>\n\n<p>its my code</p>\n\n<pre><code>DECLARE @RNo INT --Declaring the Variable @id\nDECLARE @id INT --Declaring the Variable @id\nset @RNo=1\n\nDECLARE @MyCursor CURSOR -- Declaring the Cursor\nSET @MyCursor = CURSOR --Assigning the cursor\nFOR\nSELECT Col1 FROM MyTable  --Query related to Cursor\nfor update of Col2\n\nOPEN @MyCursor -- Opening the Created cursor\nFETCH NEXT FROM @MyCursor --Retrieving the record one by one\nINTO @id --Assigning the value in declared Variable\n    WHILE @@FETCH_STATUS = 0 \n    BEGIN\n\n        update MyTable\n        set Col2=@RNo\n         where current of @MyCursor\n\n        set @RNo=@rno+1\n        print @id\nFETCH NEXT\n    FROM @MyCursor INTO @id\nEND\nCLOSE @MyCursor -- Closing the Cursor\nDEALLOCATE @MyCursor -- Deallocating the Cursor Memory\n</code></pre>\n\n<p>Note: My Query execute with correct data but problem is it takes 5 minuts i only want to execute this query within 10 seconds. </p>\n\n<p>Thanks in Advance</p>\n"},{"tags":["asp.net","sql","sql-server"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":823,"score":1,"question_id":5480338,"title":"Not able to set is Identity key as Yes in SQL Server","body":"<p>I just not created a new database with 2 tables in it. In a table, I have set a column as a primary key and trying to change its properties i.e. setting is Identity to YES, but am not able to do so.</p>\n\n<p>Any ideas/suggestions?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":91,"score":1,"question_id":13075465,"title":"Is there any alternative of 'like' operators in sql - for searching data","body":"<p>I need some help here, I am fetching data dependent upon the conditions</p>\n\n<p>Here I am using like operators, where client may use search with any word thus I have the below logic but here retrieval time is too high (it's taking 4mins) to get the data which is too slow.</p>\n\n<p>I did all indexing to table but still can't optimize the query.</p>\n\n<p>select * from authors \nwhere (address like '% Walmart %' OR address like 'Walmart %' OR address like '% Walmart' OR address like '% Walmart.com %' OR address like 'Walmart.com %' OR address like '% Walmart.com' OR address like '% Walmarts %' OR address like 'Walmarts %' OR address like '% Walmarts' OR address like '% Walmarts.com %' OR address like 'Walmarts.com %' OR address like '% Walmarts.com') </p>\n\n<p>-- Result is 1 Rows </p>\n\n<p>if i follow this logic</p>\n\n<p>select * from authors \n    where address like '%Walmart%'</p>\n\n<p>-- Result is 44 rows - it is fetching all rows</p>\n\n<p>But I need to get only that one row</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13080866,"title":"Convert DateTime to character string?","body":"<p>I am working on SQL Server 2005. While inserting specified date into the database in this format\n(Wednesday, October 17, 2012), I want to convert that format to this type (<code>MM/dd/yyyy</code>)</p>\n\n<p>Otherwise if I am inserting the date like this format (<code>MM/dd/yyyy</code>), I want to convert that format  to this type (Wednesday, October 17, 2012) or (17 oct,2012).</p>\n\n<p>I can't get the clear idea. if any one knows please help me. </p>\n\n<p>Advance thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":13076890,"title":"Update table with random record in update statment in SQL Server?","body":"<p>I have two tables. <code>Table 1</code> has about 80 rows and <code>Table 2</code> has about 10 million. </p>\n\n<p>I would like to update all the rows in <code>Table 2</code> with a random row from <code>Table 1</code>. I don't want the same row for all the rows. Is it possible to update <code>Table 2</code> and have it randomly select a value for each row it is updating?</p>\n\n<p>This is what I have tried, but it puts the same value in each row.</p>\n\n<pre><code>update member_info_test\nset hostessid = (SELECT TOP 1 hostessId FROM hostess_test ORDER BY NEWID())\n</code></pre>\n\n<p>**Edited</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":35,"score":0,"question_id":13077746,"title":"SQL Server : copy data from one table to another","body":"<p>I want to update <code>Table2</code> names with names from <code>Table1</code> with matching Ids </p>\n\n<p>I have around 100 rows in each table.</p>\n\n<p>Here is my sample tables.</p>\n\n<p><strong>Table1</strong></p>\n\n<ul>\n<li>ID</li>\n<li>Name</li>\n</ul>\n\n<p><strong>Table2</strong></p>\n\n<ul>\n<li>ID</li>\n<li>Name</li>\n</ul>\n\n<p>Sample data</p>\n\n<p><strong>Table1</strong></p>\n\n<pre><code>    ID |Name\n    --------\n     1 |abc\n     2 |bcd\n</code></pre>\n\n<p><strong>Table2</strong></p>\n\n<pre><code>    ID |Name\n    --------\n     1 |xyz\n     2 |OOS\n</code></pre>\n\n<p>Expected result</p>\n\n<p><strong>Table2</strong></p>\n\n<pre><code>    ID |Name\n    --------        \n     1 |abc\n     2 |bcd\n</code></pre>\n\n<p>How can I do this?</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":89,"score":3,"question_id":13050905,"title":"Trying to construct a SQL query trouble","body":"<p>Hi all Im having trouble with creating my desired output with an SQL query. Im quite new to this and Im trying to practice. The SQL query first builds the tables for handball matches. </p>\n\n<p><strong>How could I achive this output with a SQL query:</strong></p>\n\n<pre><code>Winner       | GoalsFor | GoalsAgainst | Loser       | GroupID | Venue\n---------------------------------------------------------------------------\nAustria      | 22       | 22           | South Korea | A       | South Korea\nCuba         | 22       | 22           | Norway      | B       | Norway\nCuba         | 22       | 22           | Norway      | D       | Norway\nFrance       | 19       | 17           | Austria     | A       | Austria\nFrance       | 19       | 17           | Cuba        | D       | Cuba\nIceland      | 23       | 19           | South Korea | A       | Iceland\nIceland      | 30       | 28           | Austria     | A       | Iceland\nIceland      | 37       | 18           | France      | A       | France\nNorway       | 23       | 19           | France      | D       | Norway\nRussia       | 23       | 19           | Norway      | D       | Russia\nRussia       | 30       | 28           | Cuba        | D       | Russia\nRussia       | 37       | 18           | France      | D       | France\nSouth Korea  | 23       | 19           | France      | A       | South Korea\n</code></pre>\n\n<p><strong>With this code:</strong></p>\n\n<pre><code> create table Teams (\n    teamid int primary key,\n    country varchar(30) unique not null,\n    continent varchar(20) not null,\n    strength int not null\n)\ngo\n\ncreate table Groups (\n    groupid char(1) primary key,\n    numteams int\n)\ngo\n\ncreate table GroupsTeams (\n    groupid char(1) foreign key references Groups,\n    teamid int foreign key references Teams,\n    primary key (groupid, teamid)\n)\ngo\n\ncreate table Games (\n   gameid int primary key identity,\n   hometeam int not null foreign key references Teams,\n   awayteam int not null foreign key references Teams,\n   groupid char(1) not null foreign key references Groups,\n   homescore int,\n   awayscore int,\n   unique (hometeam, awayteam, groupid)\n)\ngo\n\ninsert into Teams values (1, 'Iceland', 'Europe', 1)\ngo\ninsert into Teams values (2, 'South Korea', 'Asia', 2)\ngo\ninsert into Teams values (3, 'Austria', 'Europe', 3)\ngo\ninsert into Teams values (4, 'France', 'Europe', 4)\ngo\ninsert into Teams values (5, 'U.S.', 'America', 5)\ngo\ninsert into Teams values (6, 'Norway', 'Europe', 6)\ngo\ninsert into Teams values (7, 'Cuba', 'America', 7)\ngo\ninsert into Teams values (8, 'Russia', 'Europe', 8)\ngo \ninsert into Teams values (9, 'Egypt', 'Africa', 9)\ngo\n\ninsert into Groups values ('A', 4)\ngo\ninsert into Groups values ('B', 4)\ngo\ninsert into Groups values ('C', 2)\ngo\ninsert into Groups values ('D', 2)\ngo\n\ninsert into GroupsTeams values ('A', 1)\ngo\ninsert into GroupsTeams values ('A', 2)\ngo\ninsert into GroupsTeams values ('A', 3)\ngo\ninsert into GroupsTeams values ('A', 4)\ngo\ninsert into GroupsTeams values ('B', 5)\ngo\ninsert into GroupsTeams values ('B', 6)\ngo\ninsert into GroupsTeams values ('B', 7)\ngo\ninsert into GroupsTeams values ('B', 8)\ngo\ninsert into GroupsTeams values ('C', 1)\ngo\ninsert into GroupsTeams values ('C', 3)\ngo\ninsert into GroupsTeams values ('D', 2)\ngo\ninsert into GroupsTeams values ('D', 4)\ngo\n\ninsert into Games values (1, 2, 'A', 23, 19)\ngo\ninsert into Games values (3, 4, 'A', 17, 19)\ngo\ninsert into Games values (1, 3, 'A', 30, 28)\ngo\ninsert into Games values (2, 4, 'A', 23, 19)\ngo\ninsert into Games values (4, 1, 'A', 18, 37)\ngo\ninsert into Games values (2, 3, 'A', 22, 22)\ngo\ninsert into Games values (8, 6, 'D', 23, 19)\ngo\ninsert into Games values (7, 4, 'D', 17, 19)\ngo\ninsert into Games values (8, 7, 'D', 30, 28)\ngo\ninsert into Games values (6, 4, 'D', 23, 19)\ngo\ninsert into Games values (4, 8, 'D', 18, 37)\ngo\ninsert into Games values (6, 7, 'D', 22, 22)\ngo\ninsert into Games values (6, 7, 'B', 22, 22)\ngo\n</code></pre>\n"},{"tags":["sql-server","scripting","dynamic-sql"],"answer_count":7,"favorite_count":7,"up_vote_count":21,"down_vote_count":0,"view_count":28483,"score":21,"question_id":4393,"title":"SQL Server : drop all tables whose names begin with a certain string","body":"<p>I'd like a script to drop all tables whose name begins with a given string. I'm sure this can be done with some dynamic sql and the <code>INFORMATION_SCHEMA</code> tables.</p>\n\n<p>If anyone has a script, or can knock one up quickly, please post it.</p>\n\n<p>If no-one posts an answer before I figure it out myself, I'll post my solution.</p>\n"},{"tags":["c#","java","sql-server","jdbc","weka"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":146,"score":0,"question_id":7450591,"title":"IKVM + DatabaseLoader = Classpath issue","body":"<p>Weka in .net through IKVM works great.  The tutorial in Wiki is lots of\nhelp. However, I think the way that weka loads the jdbc jar file is causing\nsome problems in .net. I wonder if anyone has encountered this problem\nbefore and knows what I am doing wrong?</p>\n\n<ul>\n<li>I have compiled the sql jar using ikvmc: ikvmc -target:library\nsqljdbc4.jar</li>\n<li>I have included it in the .net project, and put DatabaseUtils.props\nin the proper directory.</li>\n<li>The jar that I'm referencing works great as a stand alone, but fails to find the JDBC once it is loaded through Visual Studio.</li>\n</ul>\n\n<p>Thanks in advanced.</p>\n\n<p>Here is the error output:</p>\n\n<pre><code>Trying to add database driver (JDBC): com.microsoft.sqlserver.jdbc.SQLServerDriver - Warning, not in CLASSPATH?\njava.sql.SQLException: No suitable driver found for jdbc:sqlserver://172.30.157.250;DatabaseName=Bidding;integratedSecurity=false;\nssword=expedia1\n        at java.sql.DriverManager.getConnection(DriverManager.java:647)\n        at java.sql.DriverManager.getConnection(DriverManager.java:226)\n        at weka.experiment.DatabaseUtils.connectToDatabase(DatabaseUtils.java:505)\n        at weka.experiment.InstanceQuery.retrieveInstances(InstanceQuery.java:287)\n        at weka.experiment.InstanceQuery.retrieveInstances(InstanceQuery.java:272)\n        at clusterer.InstanceBuilder.getInstances(InstanceBuilder.java:29)\n        at clusterer.Clusterer.getTripAdvisorClassified(Clusterer.java:85)\n        at clusterer.Clusterer.main(Clusterer.java:39)\n        at cli.ConsoleApplication1.Program.Main(Program.cs:14)\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2804,"score":3,"question_id":1500290,"title":"How to Script Automatically, the securables assigned to a SQL account","body":"<p>I want to generate script to assign an user account to some securables, e.g. Table:Select.</p>\n\n<p>How to do this?</p>\n"},{"tags":["sql","sql-server","tsql","datetime","date"],"answer_count":12,"favorite_count":43,"up_vote_count":84,"down_vote_count":1,"view_count":96539,"score":83,"question_id":1177449,"title":"Best approach to remove time part of datetime in SQL Server","body":"<p>Which method provides the best performance when removing the time portion from a datetime field in SQL Server?</p>\n\n<pre><code>a) select DATEADD(dd, DATEDIFF(dd, 0, getdate()), 0)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>b) select cast(convert(char(11), getdate(), 113) as datetime)\n</code></pre>\n\n<p>The second method does send a few more bytes either way but that might not be as important as the speed of the conversion.</p>\n\n<p>Both also appear to be very fast, but there might be a difference in speed when dealing with hundreds-of-thousands or more rows?</p>\n\n<p>Also, is it possible that there are even better methods to get rid of the time portion of a datetime in SQL?</p>\n"},{"tags":["c#","asp.net","sql","sql-server","linq"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":121,"score":0,"question_id":13080744,"title":"Unable to cast object of type 'System.Double' to type 'System.String'.","body":"<p>I am importing excel data into sql table at the same time i want to show the duplicate rows among excel sheet and sql table in a grid view the following is my attempt:</p>\n\n<pre><code>  protected void Button1_Click(object sender, EventArgs e)\n{\n    string strFileType = System.IO.Path.GetExtension(FileUpload1.FileName).ToString().ToLower();\n    string strFileName = FileUpload1.PostedFile.FileName.ToString();\n\n    FileUpload1.SaveAs(Server.MapPath(\"~/Import/\" + strFileName + strFileType));\n    string strNewPath = Server.MapPath(\"~/Import/\" + strFileName + strFileType);\n\n\n\n\n\n\n        string excelConnectionString = String.Format(@\"Provider=Microsoft.Jet.OLEDB.4.0;\" + \"Data Source=\"+strNewPath +\"; Extended Properties=Excel 8.0;\");\n\n    //string excelConnectionString = String.Format(@\"Provider=Microsoft.Jet.OLEDB.4.0;\" + \"Data Source=C:\\\\myFolder\\\\Book1.xls;\" + \"Extended Properties=Excel 8.0;\"); \n\n\n        // Create Connection to Excel Workbook\n        using (OleDbConnection connection = new OleDbConnection(excelConnectionString))\n        {\n            connection.Open();\n            OleDbCommand command = new OleDbCommand(\"Select ID,Data FROM [Sheet1$]\", connection);\n            OleDbCommand command1 = new OleDbCommand(\"select count(*) from [Sheet1$]\", connection);\n\n            //Sql Server Table DataTable\n            DataTable dt4 = new DataTable();\n            SqlCommand cmd4 = new SqlCommand(\"select id,data from ExcelTable\", con);\n            try\n            {\n                SqlDataAdapter da4 = new SqlDataAdapter(cmd4);\n                da4.Fill(dt4);//sql table datatable\n            }\n            catch { }\n\n\n            //excelsheet datatable\n            DataTable oltlb = new DataTable();\n            OleDbCommand olcmd = new OleDbCommand(\"select id,data from [Sheet1$]\", connection);\n            try\n            {\n                OleDbDataAdapter olda = new OleDbDataAdapter(olcmd);\n                olda.Fill(oltlb); //excel table datatable\n            }\n            catch { }\n\n            var matched = (from table1 in dt4.AsEnumerable()\n                           join table2 in oltlb.AsEnumerable() on\n                         table1.Field&lt;int&gt;(\"ID\") equals Convert.ToInt32(table2.Field&lt;string&gt;(\"ID\"))\n                           where table1.Field&lt;string&gt;(\"Data\") == table2.Field&lt;string&gt;(\"Data\")\n                           select table1);\n            DataTable dthi5 = new DataTable();\n            dthi5 = matched.CopyToDataTable();\n\n            GridView1.DataSource = dthi5;\n            GridView1.DataBind();\n            GridView1.DataSource = matched.ToList();\n</code></pre>\n\n<p>Id is int(allow nulls), data(nvarchar) in sql server database</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":42,"score":2,"question_id":13068502,"title":"Sql server Zip-Up results?","body":"<p>I created this <a href=\"http://data.stackexchange.com/stackoverflow/query/edit/83198\" rel=\"nofollow\">sql DEMO</a> : </p>\n\n<p>I have  #tbl1  :</p>\n\n<pre><code>___cola__\n  1\n  2\n  3\n  4\n</code></pre>\n\n<p>and  #tbl2  :</p>\n\n<pre><code>_colb_\n  a\n  b\n  c\n  d\n</code></pre>\n\n<p>I want this : </p>\n\n<pre><code>_colb____|__cola____\n  a           1\n  b           2\n  c           3\n  d           4\n</code></pre>\n\n<p>I have found a solution ( bad IMHO)</p>\n\n<pre><code>SELECT table1.cola, table2.colb FROM\n(SELECT cola, ROW_NUMBER() OVER (ORDER BY cola) AS rn1 FROM #tbl1) table1,\n(SELECT colb, ROW_NUMBER() OVER (ORDER BY colb) AS rn2 FROM #tbl2) table2\nWHERE table1.rn1 = table2.rn2\n</code></pre>\n\n<p>For knowledge , \n How <strong>ELSE</strong> can I do it ? </p>\n\n<p>I started with : </p>\n\n<p><code>SELECT cola , s.f FROM #tbl1 cross apply(select   colb as f from #tbl2) s</code></p>\n\n<p>But there is a problem at the right section.</p>\n"},{"tags":["sql-server","xp-cmdshell"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":118,"score":0,"question_id":12948059,"title":"xp_cmdshell error \"The filename, directory name, or volume label syntax is incorrect.\"","body":"<p>I am just in the midst of deploying some code to production, which is an upgrade of a system from SQL 2000 to SQL 2008.</p>\n\n<p>I'm having a mysterious problem in one of my stored procedures that fetches some data from the database, then creates some files via bcp (successfull), then it tries to execute a couple of move commands, and they both fail even though the folders definitely exist and the service is running as sysadmin.</p>\n\n<p>This is the code it is trying to execute:</p>\n\n<pre><code>set @cmd_string = 'move '+ @OutPath_AllCards + '*.* '+ @ArchivePath_AllCards\ndelete from @tbl_xp_cmdshell_output\nInsert @tbl_xp_cmdshell_output exec @error_temp = master.dbo.xp_cmdshell @cmd_string\n</code></pre>\n\n<p>and this is the error message that I get back</p>\n\n<pre><code>xp_cmdshell Error Executing \"move H:\\Transfer\\CHAD\\Outbound\\AllCards\\*.* H:\\Transfer\\CHAD\\Outbound\\AllCards\\Archive\\\" \n</code></pre>\n\n<p>The Returned command line error is </p>\n\n<pre><code>\"The filename, directory name, or volume label syntax is incorrect.\"\n</code></pre>\n\n<p>This works fine in the identically setup UAT version of the database</p>\n\n<p>Any suggestions?</p>\n\n<p><strong>Update:</strong></p>\n\n<p>I can reproduce the error if there are no files in the source directory. I think there probably should be files in the source directory, but I wonder if there is a lag before they are created by bcp , and when it goes to execute the move they don't exist yet? Any ideas?</p>\n"},{"tags":["sql","sql-server","tsql","foreign-keys"],"answer_count":5,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1520,"score":2,"question_id":4452132,"title":"Add Foreign Key relationship between two Databases","body":"<p>I have two tables in two different databases. In table1(It is in database1) there is a column called column1 and it is a primary key. Now in table2(It is in databse2) there is a column called coulmn2 and I want to add it as a foreign key.</p>\n\n<p>I Tried to add it and it gave me the following error:</p>\n\n<blockquote>\n  <p>Msg 1763, Level 16, State 0, Line 1</p>\n  \n  <p>Cross-database foreign key references\n  are not supported.</p>\n  \n  <p>Foreign key Database2.table2.</p>\n  \n  <p>Msg 1750, Level 16, State 0, Line 1\n  Could not create constraint. See\n  previous errors.</p>\n</blockquote>\n\n<p>How do I do that Since The tables are in different databases.</p>\n"},{"tags":["sql","sql-server","foreign-keys"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13079872,"title":"Add Foreign Key Contraint between Tables in different Databases","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4452132/add-foreign-key-relationship-between-two-databases\">Add Foreign Key relationship between two Databases</a>  </p>\n</blockquote>\n\n\n\n<p>What i know is that i can add a foregin key constraint, so that one column in table A can reference to another column in table B using :</p>\n\n<pre><code>CONSTRAINT fk FOREIGN KEY (column) REFERENCES toTable(toColumn)\n</code></pre>\n\n<p>but here both tables are in the same database. I want to know if i can reference to  table in another database. For instance , i have two databases: databaseA and databaseB, when i want to associate them, i prefer adding some table in databaseA reference to another table in databaseB. But i don't know how. Something like :</p>\n\n<pre><code>CONSTRAINT fk FOREIGN KEY (column) REFERENCES [databaseB].[toTable](toColumn)\n</code></pre>\n\n<p>doesn't work.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":86,"score":2,"question_id":12954086,"title":"SQL FORCE SORT Columns generated from rows by values contained","body":"<p>I have a requirement to order the output of a dynamic query, that turns columns into rows, to ensure that only columns with values are generated before the rows with no values. How do I force order on the generation of the columns so the first columns are columns that contain values for particular fields while those with no values for the particular fields are generated at the end of my row? </p>\n\n<pre><code>             insert into #PriceSheet\n      select  ID, ProductID,SheetNumber ,SheetDesc ,MfgPriceCode,PriceZone\n\n  FROM  ProductPrice\n  left join UNITS On SUOM = UOMID\n\n  select @colsUnpivot = stuff((select ','+quotename(C.name)\n         from tempdb.sys.columns as C\n         where C.object_id = object_id('tempdb..#PricingSheet') and\n               C.name LIKE '%%' \n         for xml path('')), 1, 1, '')\n\n select @colsPivot = STUFF((SELECT  ',' \n                      + quotename(c.name \n                         + cast(t.rn as varchar(10)))\n                    from\n                    (\n                      select row_number() over(partition by ProductID \n                                               order by ProductID) rn\n                      from #PriceSheet\n                    ) t\n                     cross apply \n                      tempdb.sys.columns  as C\n                   where C.object_id = object_id('tempdb..#PricingSheet') \n                     and C.name Not in ('CreateDate', 'LastModifiedDate')\n                   group by c.name, t.rn\n                   order by t.rn\n            FOR XML PATH(''), TYPE\n            ).value('.', 'NVARCHAR(MAX)') \n        ,1,1,'')\n\n\n       set @query = 'select *\n      from\n      (\n        select ProductID, col + cast(rn as varchar(10)) new_col, val\n        from \n        (\n          select  \n       cast(ProductID              as varchar(50))ProductID\n      ,cast(SheetNumber              as varchar(50))SheetNumber\n      ,cast(SheetDesc              as varchar(50))SheetDesc\n      ,cast(MfgPriceCode              as varchar(50))MfgPriceCode\n      ,cast(PriceZone              as varchar(50))PriceZone \n       row_number() over(partition by productid order by productid) rn\n\n          from #PriceSheet\n        ) x\n        unpivot\n        (\n          val\n          for col in ('+ @colsunpivot +')\n        ) u\n      ) x1\n      pivot\n      (\n        max(val)\n        for new_col in\n          ('+ @colspivot +')\n      ) p'\n</code></pre>\n\n<p>Say for instance, to generate the columns first for rows that have SheetNumber not equal to NULL and then the NULLS afterward. </p>\n"},{"tags":["sql","sql-server","nested","maximum","composite"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13067047,"title":"How to get max of composite data in SQL?","body":"<pre><code>SELECT \"Name\"\"Month\",\"Year\",\"Value\" \nfrom Table\nWHERE \n    \"Name\" LIKE '%JERRY%'\nAND \"Year\" = \n    (SELECT MAX(\"Year\") FROM Table where \"Name\" LIKE '%JERRY%')\nAND \"Month\"= \n    (SELECT MAX(\"Month\") FROM Table \n     where \n        \"Name\" LIKE '%JERRY%' \n    AND \"Year\"= (SELECT MAX(\"Year\") FROM Table where \"Name\" LIKE '%JERRY%'))\n</code></pre>\n\n<p>Table --></p>\n\n<pre><code>Name  | Year | Month | Value\n-----------------------------\nJERRY   2012    9        100           \nJERRY   2012    9        120         \nJERRY   2012    9        130           \nJERRY   2012    8         20        \nJERRY   2011    12        50           \n</code></pre>\n\n<p>So i want the first three rows as output. As for the latest month for the latest year i need all the values. \nCan someone suggest a better cleaner query?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","pivot"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":1939,"score":0,"question_id":390238,"title":"Display a single record (row) as a single column","body":"<p>I'm looking for ways to display a single row of data as a single column (with multiple rows).  For example,</p>\n\n<pre>\nFieldA  FieldB\n------- ---------\n1       Some Text [row]\n\n\nHeader Value [col]\n------ ------\nFieldA 1          [row1]\nFieldB SomeText   [row2]\n\n</pre>\n\n<p>Is there a way to do this with SQL Server 2005?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","duplicates","phonetics"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":13073532,"title":"Please help fix and optimize this query","body":"<p>I am working on a system to find potential duplicates in our customers table (SQL 2005). I am using the built-in SOUNDEX value that our software computes when customers are added/updated, but I also implemented the double metaphone algorithm for better matching. This is the most-nested query I have created, and I can't help but think there is a better way to do it and I'd like to learn.</p>\n\n<p>In the inner-most query I am joining the customer table to the metaphone table I created, then finding customers that have identical pKey (primary phonetic key). I take that, union that with customers that have matching soundex values, and then proceed to score those matches with various text similarity functions.</p>\n\n<p>This is currently working, but I would also like to add a union of customers whose aKey (alternate phonetic key) match. This would be identical to \"QUERY A\" except to substitute <code>on (c1Akey = c2Akey)</code> for the join. However, when I attempt to include that, I get errors when I try to execute my query.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>    --Create aggregate ranking\nselect c1Name, c2Name, nDiff, c1Addr, c2Addr, aDiff, c1SSN, c2SSN, sDiff, c1DOB, c2DOB, dDiff, nDiff+aDiff+dDiff+sDiff as Score\n        ,(sDiff+dDiff)*1.5 + (nDiff+dDiff)*1.5 + (nDiff+sDiff)*1.5 + aDiff *.5 + nDiff *.5 as [Rank]\n    FROM\n    (\n    --Create match scores for different fields\n    SELECT     c1Name, c2Name, c1Addr, c2Addr, c1SSN, c2SSN, c1LTD, \n                      c2LTD, c1DOB, c2DOB, dbo.Jaro(c1name, c2name) AS nDiff, dbo.JaroWinkler(c1addr, c2addr) AS aDiff, \n                      CASE WHEN c1dob = '1901-01-01' OR\n                      c2dob = '1901-01-01' OR\n                      c1dob = '1800-01-01' OR\n                      c2dob = '1800-01-01' THEN .5 ELSE dbo.SmithWaterman(c1dob, c2dob) END AS dDiff, CASE WHEN c1ssn = '000-00-0000' OR\n                      c2ssn = '000-00-0000' THEN .5 ELSE dbo.Jaro(c1ssn, c2ssn) END AS sDiff\nFROM    \n-- Generate list of possible matches based on multiple phonetic matching fields\n( select * from \n    -- List of similar names from pKey field of ##Metaphone table\n    --QUERY A BEGIN\n    (select customers.custno as c1Custno, name as c1Name, haddr as c1Addr, ssn as c1SSN, lasttripdate as c1LTD, dob as c1DOB, soundex as c1Soundex, pkey as c1Pkey, akey as c1Akey from Customers WITH (nolock) join ##Metaphone on customers.custno = ##Metaphone.custno) as c1\n        JOIN\n    (select customers.custno as c2Custno, name as c2Name, haddr as c2Addr, ssn as c2SSN, lasttripdate as c2LTD, dob as c2DOB, soundex as c2Soundex, pkey as c2Pkey, akey as c2Akey from Customers with (nolock) join ##Metaphone on customers.custno = ##Metaphone.custno) as c2\n        on (c1Pkey = c2Pkey) and (c1Custno &lt; c2Custno)\n    WHERE (c1Name &lt;&gt; 'PARENT, GUARDIAN') and c1soundex != c2soundex\n    --QUERY A END\n\n    union\n        --List of similar names from pregenerated SOUNDEX field\n        (select t1.custno, t1.name, t1.haddr, t1.ssn, t1.lasttripdate, t1.dob, t1.[soundex], 0, 0, t2.custno, t2.name, t2.haddr, t2.ssn, t2.lasttripdate, t2.dob, t2.[soundex], 0, 0 from Customers t1 WITH (nolock) \n            join customers t2 with (nolock) on t1.[soundex] = t2.[soundex]  and t1.custno &lt; t2.custno\n                where (t1.name &lt;&gt; 'PARENT, GUARDIAN'))\n\n) as a\n) as b\nwhere (sDiff+dDiff)*1.5 + (nDiff+dDiff)*1.5 + (nDiff+sDiff)*1.5 + aDiff *.5 + nDiff *.5   &gt;= 7.5\norder by [rank] desc, score desc\n</code></pre>\n\n<p>Previously, I was using joins such as <code>on c1.pkey = c2.pkey or c1.akey = c2.akey or c1.soundex = c2.soundex</code> but the performance was horrendous, and using unions seems to be working a lot better. Out of 103K customers, tt is currently generating a list of 8.5M potential matches (based on the phonetic codes) in 2.25 minutes, and then taking another 2 to score, rank and filter those down to about 3000. So I am happy with the performance, I just can't help but think there is a better way to structure this, and I need help adding the extra union condition.</p>\n\n<p>Thanks!</p>\n\n<p>EDIT: I seem to have the additional union working. I must have just had a typo or a parenthesis issue. I struggled with it for over 30 minutes and never got it working. A few hours later I tried another copy/paste and it worked fine. However, with my repeated joins between my customer and ##Metaphone tables (tables c1 and c2), is there a way to join that once and use that result set repeatedly? Could I create it as a temp table and alias it multiple times to find duplicate phonetic matches?</p>\n"},{"tags":["sql-server","web-services","sap"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":13071068,"title":"Export data from SAP to SQL Server","body":"<p>I have an application which uses SQL Server 2008 to store data that needs to be feed a bunch of financial information from SAP (which in this company uses Oracle 11 as backend).</p>\n\n<p>I asked the SAP guys access to the read the tables, they said no way.\nI asked them to connect to my database directly to fill my tables, they said no way.\n(I have a feed from an Oracle database, other application different than SAP, using the transparent gateway with no problem, so that's why asked this)</p>\n\n<p>They say the only need to interact with SAP is through the use of Web services. But due the enormous amount of data, I don't think that's the path.</p>\n\n<p>Does anybody has experience in creating an interface between SAP and a SQL Server?</p>\n\n<p>I'm going to extend my explanation. My current application is already being feed by other 3 applications (this is a big enterprise) and all goes to the same tables where I receive the data to further process. All the other applications (1 oracle, 2 sql server) performs either a direct update or stored procedures that save the data. Those other 3 applications are managed by different teams with no relation to each other. All they complained at the beginning but at the end all accepted to export their data to this application.</p>\n\n<p>So, the ideal would be to convice the SAP guys to do the same: Open a connection to SQL Server and perform some inserts or run sp's.</p>\n"},{"tags":["sql-server"],"answer_count":8,"favorite_count":2,"up_vote_count":12,"down_vote_count":0,"view_count":7852,"score":12,"question_id":147362,"title":"What is the best way to test a stored procedure?","body":"<p>Like many companies that require all access be through stored procedures, we seem to have a lot of business logic locked away in sprocs.  These things are just plain hard to test, and some of them have become silly long.  Does anyone out there have a set of best practices that can make it a little easier to confidently test these things?</p>\n\n<p>At present we maintain 30 or so \"Problem\" databases that we run against.  This isn't always particularly well documented and it sure isn't automated.</p>\n"},{"tags":["sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":13072990,"title":"Date Format In SSIS Derived Column","body":"<p>I have 2 questions, I have a text file with all my data, in the text file I have for example <code>Sply_DT</code> and <code>Imprt_DT</code>.</p>\n\n<p>For <code>Sply_Dt</code> I have to create <code>getdate()</code> and I have it formatted as <code>2012-10-25 12:04:16.09900000</code> using <code>(DT_DBTIMESTAMP)(DT_DBDATE)GETDATE()</code> but I want it formatted as <code>MM-DD-YY</code>.</p>\n\n<p>And for <code>Impt_DT</code>, it's in the <code>5/16/2011</code> format in dataviewer but when I placed it into a table it looks like <code>2011-05-16 00:00:00.000</code> and I want it in <code>MM-DD-YY</code> format.</p>\n"},{"tags":["sql","sql-server","sas","pivot-table"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":13077645,"title":"How would I use SELECT statements to transform this data from two columns into three columns?","body":"<p>I inherited a horribly-designed table where data is stored like this:</p>\n\n<pre><code>Period |  Identifier |   Value\n----------------------------------\n1      | AB1         | some number\n1      | AB2         | some number\n1      | AB3         | some number\n1      | AB4         | some number\n1      | AB5         | some number\n1      | A1          | some number\n1      | A2          | some number\n1      | A3          | some number\n1      | A4          | some number\n1      | A5          | some number\n2      | AB1         | some number\n2      | AB2         | some number\n2      | AB3         | some number\n2      | AB4         | some number\n2      | AB5         | some number\n2      | A1          | some number\n2      | A2          | some number\n2      | A3          | some number\n2      | A4          | some number\n2      | A5          | some number\n</code></pre>\n\n<p>I'm trying to use SELECT statements that will get data into this format:</p>\n\n<pre><code>Row # | First value | Second value\n1     | A1's number | AB1's number     // The next 5 rows are data from period 1\n2     | A2's number | AB2's number\n3     | A3's number | AB3's number\n4     | A4's number | AB4's number\n5     | A5's number | AB5's number\n6     | A1's number | AB1's number     // These 5 rows are from period 2\n7     | A2's number | AB2's number\n8     | A3's number | AB3's number\n9     | A4's number | AB4's number\n10    | A5's number | AB5's number\n</code></pre>\n\n<p><code>AB%</code> and <code>A%</code> are two separate ID's of that format, which mildly frustrates <code>WHERE LIKE ...</code> clauses, I think. I'm not entirely sure the data can be forced into the desired format, but my supervisor asked me to look into it. </p>\n\n<p>My initial attempt, for which I don't know the SQL code for, would be to look at the row number itself and work with, but as I said, I'm unsure how to progress down that route. </p>\n\n<p>Right now, the data is in SQL Server, but it will be accessed from SAS using <code>proc sql</code>. I think those standards conform to SQL Server for the most part, even though <code>DECLARE</code> isn't supported. </p>\n\n<p>And no, I don't know whose idea it was to store the data in this fashion...</p>\n"},{"tags":["sql","sql-server","unique-constraint"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13077685,"title":"Unique constraint over two tables","body":"<p>I have two tables:<br>\n<code>Country</code> : has ID, Name<br>\n<code>State</code>   : has ID, Name, CountryID  </p>\n\n<p>I defined <code>Country.Name</code> as unique.</p>\n\n<p>I also want to define <code>State.Name</code> as unique <em>per country</em> - i.e. I can't just define it as unique because two countries may have the same state. But for one country, every state is unique.</p>\n\n<p>How can I do this?</p>\n"},{"tags":["sql-server","tsql","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13076962,"title":"T-SQL SUM Total","body":"<p>Below I have a T-SQL query that brings back amount of purchased items, less discounts and the total - grouped by month/year of purchase.  How can I update the Query to return a Grand Total Row\nwhere I would can add up the amounts in the Total Column?\nIt would be good to be able to add up all the rows but my\nmain item is I need to be able to get a grand total. Thanks.</p>\n\n<pre><code>    Select DATENAME(month, [OrderDate]) + ' ' + CAST(YEAR(OrderDate) AS CHAR(4)) \n    AS [Month],\n    SUM(Amount) AS [Amount],\n    SUM(Discount1) AS [Discount 1],\n    SUM(Discount2) AS [Discount 2],\n    SUM(Amount - Discount1 - Discount2) AS [Total]\n    From \n    Orders\n    JOIN Customer on orders.cust_ky=customer.cust_ky\n    GROUP BY DATENAME(month, [OrderDate]) + ' ' + CAST(YEAR(OrderDate) AS CHAR(4))\n    ORDER BY MAX(OrderDate)\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2","geometry","geospatial"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13077666,"title":"STContains() on Two table to find where my Region lies in Country","body":"<p>I have Two table. 1st Table with column \"Point\" and 2nd Table with column \"NZTM\". Now I want to check where my Point lies in NZTM. Both the columns are converted into geometry. I got 15 million points and 2000 NZTM rows. 1 Point can belong to 0 or 1 or more NZTM.</p>\n\n<p>So for this operation I am using STContains. But this seem to be giving an issue as I am using cross join it joins all the columns in 1st table to all the columns of 2nd table and takes ages to complete this operation. I am using the following query</p>\n\n<pre><code>         Select case when A.points.STContains(B.NZTM) &gt;0\n            then \n                A.MeshBlockIdentifier\n            end val,\n            B.SeqID sid     \n        from dbo.EventConversion B\n        cross join\n        [dbo].[REGC12] A\n</code></pre>\n\n<p>Any one please help me on how do I check or use ST_Contains on my two columns?\nP.S I am using SQL Server 2008 R2</p>\n"},{"tags":[".net","sql-server","sqlite"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13076923,"title":"Copying data from sqlite to SQL Server","body":"<p>Is there a way in C# without reading into a datatable to copy a sqlite table to SQL Server?</p>\n\n<p>The sqlite database is in memory and contains millions of rows so I don't want to copy it to a datatable unless absolutely necessary.</p>\n\n<p>thanks\nKevCri</p>\n"},{"tags":["sql-server","json"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":158,"score":1,"question_id":4606961,"title":"Is there a sql only way to turn a hierarchical table into a set of json strings?","body":"<p>I have a hierarchical table a simplified version of which might look like this:</p>\n\n<pre><code>id parentid text\n-- -------- ----\n1  null     A\n2  1        Ax\n3  1        Ay\n4  3        Ay2\n5  null     B\n6  5        Bx\n</code></pre>\n\n<p>I want to migrate all the data from this table in json form. The result of the table above should end up looking like:</p>\n\n<pre><code>{\n  \"text\":\"A\",\n  \"children\":\n  [\n    {\n      \"text\":\"Ax\",\n      \"children\":[]\n    },\n    {\n      \"text\":\"Ay\",\n      \"children\":\n      [\n        {\n          \"text\":\"Ay2\",\n          \"children\":[]\n        }\n      ]\n    }\n  ]\n}\n</code></pre>\n\n<p>(next record)</p>\n\n<pre><code>{\n  \"text\":\"B\",\n  \"children\":\n  [\n    {\n      \"text\":\"Bx\",\n      \"children\":[]\n    }\n  ]\n}\n</code></pre>\n\n<p>The table has several hundred thousand records and I can't really make an assumption as to how deep it recurses as this might change before I finally run it. I'd looked into using WITH to try to concatenate the child records but I'm really struggling. Can this be done with WITH or is there another way?</p>\n"},{"tags":["sql","sql-server","stored-procedures"],"answer_count":9,"favorite_count":6,"up_vote_count":20,"down_vote_count":0,"view_count":32510,"score":20,"question_id":219434,"title":"Query that returns list of all Stored Procedures in an MS SQL database","body":"<p>Is there a query that returns the names of all the stored procedures in an MS SQL database (excluding \"System Stored Procedures\" would be a nice touch)?</p>\n"},{"tags":["php","sql","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13076514,"title":"PHP MSSQL VARCHAR 255 character issue","body":"<p><strong>Issue</strong>: MSSQL queries against a VARCHAR(256+) field returns only 255 characters in PHP, regardless of the VARCHAR size being greater than 255.</p>\n\n<p>I've seen references to a workaround <a href=\"http://stackoverflow.com/questions/609386/can-php-and-mssql-library-select-more-than-256-characters-from-a-varchar-column\">here</a> and <a href=\"https://bugs.php.net/bug.php?id=25544\" rel=\"nofollow\">here</a> where the workaround is basically to cast the VARCHAR to TEXT:</p>\n\n<pre><code>SELECT CAST(myField AS TEXT) AS myField FROM myTable\n</code></pre>\n\n<p>But this doesn't help if I have a bunch of queries like:</p>\n\n<pre><code>SELECT * FROM myTable\n</code></pre>\n\n<p>I mean, sure, I could look for all queries like that and do:</p>\n\n<pre><code>SELECT CAST(myField AS TEXT) AS 'myField2', * FROM myTable\n</code></pre>\n\n<p>And update the subsequent PHP variable from myField to myField2, but that is a pretty big task for the application I have.  Not to mention I'd have to do a lookup of all fields in all tables that have VARCHAR(256+) and then look in my PHP app for all queries affected.</p>\n\n<p>We're running PHP 5.2.17 and I understand MSSQL isn't supported/developed on anymore.  I have seen the Microsoft-supported SQL Server driver <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=20098\" rel=\"nofollow\">here</a>, but I would have to update my PHP version to 5.3.6 or 5.4.  I'm not entirely sure what that would entail if I did the upgrade.  Plus, we would have to change all mssql_connect() to sqlsrv_connect() and other functions from mssql to sqlsvr's version within our PHP app.</p>\n\n<p>Does anyone know of any other workaround (like a newer DbLib C API that I can download from a trustworthy source) so I don't have to go modifying everything peppered throughout my PHP app?</p>\n"},{"tags":["sql-server","sql-server-2008","security","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13074704,"title":"SQL Server Activity Monitor Ports","body":"<p>I'm trying to convince my IT department to grant me necessary <a href=\"http://msdn.microsoft.com/en-us/library/ms175518.aspx#Security\" rel=\"nofollow\">permissions</a> on our SQL Server 2012 instance in order to use the Activity Monitor in the Management Studio.  Our lead IT administrator is concerned about granting them because he is unsure what, if any, ports Activity Monitor listens on.  I'd like to add that I currently have access to this SQL Server instance on port 1433.</p>\n\n<p>I'm not very familiar with Activity Monitor's inner workings, are there any specific ports Activity Monitor listens on that should be a security concern?  Does anyone know any resources that may provide this information?  I want to make sure I give an accurate response.</p>\n"},{"tags":["c#","sql-server","linq","entity-framework","date"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13076094,"title":"How to query a date range from a varchar column using LINQ","body":"<p>I have inherited a large SQL Server database that has a certain table that has a certain date column that is a varchar(8) datatype in the <strong>yyyyMMdd</strong> date string format. Why it isn't a datetime datatype or something similar is beyond me. (maybe to save space? Legacy db ported to SQL Server long ago?)</p>\n\n<p>Withouting getting too flustered over the date wanna-be field, grabbing rows using a single date from this column is pretty straight forward using the Entity Framework (DBContext w/LINQ) as shown below:</p>\n\n<pre><code>var rows = cxt.TableOfRandomDateColumn.Where(x =&gt; x.Date == myDateStr).ToList();\n</code></pre>\n\n<p>That's about as easy as it gets. However, what if I wanted to grab a range of dates from this column? What would be the best way to go about doing something like that?</p>\n"},{"tags":["sql-server","installation","xampp"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":676,"score":0,"question_id":10414735,"title":"running mssql on xampp - Unable to load dynamic library","body":"<p>I have installed the latest version of XAMPP on Windows 7.  All seemed to be working fine apart from the mssql functions not working.  </p>\n\n<p>I downloaded the extension <code>php_mssql.dll</code> and placed in the <code>C:\\xampp\\php\\ext\\</code> folder and uncommented the line in the <code>php.ini</code> file.  I restarted the apache and got error, </p>\n\n<p><strong>\"Unable to load dynamic library C:\\xampp\\php\\ext\\php_mssql.dll. The specified module cannot be found\"</strong>  </p>\n\n<p>After a bit of research I found out this for this to run <code>ntwdblib.dll</code> needed to be installed in the php folder.  I have done this and still get the error message.  Am I missing something.  Any suggestions most welcome.</p>\n"},{"tags":["sql","sql-server","null","sql-server-2000","empty-string"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":61,"score":3,"question_id":13074730,"title":"SQL why use isnull(field, '') <> ''?","body":"<p>I'm reviewing some code I've inherited, and I found a line like this:</p>\n\n<pre><code>And isnull(IH.CustomerItemNumber, '') &lt;&gt; ''\n</code></pre>\n\n<p>Which one of my predecessors seems to have used in a ton of where clause or join clauses.  It looks to me like this is an unnecessary calling of a function, and therefor a performance hog, because NULL will never equal the empty string '', right?</p>\n\n<p>Specifically I took this out of a join clause in a particular query and performance increased dramatically (from 46-49 secs to between 1-3).  </p>\n\n<p>Replaced it with <code>AND IH.CustomerItemNumber &lt;&gt; ''</code></p>\n\n<p>Is my assessment correct here?  This is redundant and slow and can be removed?  In what situation might this code be beneficial?</p>\n\n<p>EDIT:  So, can NULL ever equal the empty string?  </p>\n"},{"tags":["sql-server","tsql","date","weekend"],"answer_count":6,"favorite_count":4,"up_vote_count":13,"down_vote_count":0,"view_count":12761,"score":13,"question_id":1803987,"title":"How do I exclude Weekend days in a SQL Server query?","body":"<p>How do I exclude values in a <code>DateTime</code> column that are Saturdays or Sundays?</p>\n\n<p>For example, given the following data:</p>\n\n<pre><code>date_created\n'2009-11-26 09:00:00'  -- Thursday\n'2009-11-27 09:00:00'  -- Friday\n'2009-11-28 09:00:00'  -- Saturday\n'2009-11-29 09:00:00'  -- Sunday\n'2009-11-30 09:00:00'  -- Monday\n</code></pre>\n\n<p>this is the result I'm looking for:</p>\n\n<pre><code>date_created\n'2009-11-26 09:00:00'  -- Thursday\n'2009-11-27 09:00:00'  -- Friday\n'2009-11-30 09:00:00'  -- Monday\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13075066,"title":"SQL Query results pagination with random Order by in SQL Server 2008","body":"<p>I am trying to implement pagination to a page on my website that returns results from a database table.</p>\n\n<p>Currently, it returns all rows in a random order. However, as my database is growing, I want to paginate these results instead of displaying them all on one page. However, I don't want to return all results just to display 20 records for instance. Depending on the page, I want take just the 20 records from the database that are relevant.</p>\n\n<p>I'm following this tutorial: <a href=\"http://www.mikesdotnetting.com/Article/150/Web-Pages-Efficient-Paging-Without-The-WebGrid\" rel=\"nofollow\" title=\"Tutorial\">Tutorial</a></p>\n\n<p>However, the I cannot use the query with the <code>OFFSET</code> clause, because the hosting uses SQL SERVER 2008. (It is introduced in 2012 i believe).</p>\n\n<p>I tried following the answer to this <a href=\"http://stackoverflow.com/questions/187998/row-offset-in-sql-server\" title=\"Question\">Question</a>, but I want the results in a random order, and I cannot do an <code>ORDER BY</code> on a derived table... so I'm a bit stuck for ideas!</p>\n\n<p>Any help? Thanks!</p>\n\n<p>This is what I currently have:</p>\n\n<pre><code>    SELECT Title, Filename, PhotoURL, Orientation, FolderName, SetURL, RowNum\n      FROM (\n            SELECT  p.Title, p.Filename, p.URL AS PhotoURL, p.Orientation, s.FolderName, s.URL AS SetURL, ROW_NUMBER() OVER (ORDER BY p.PhotoID) AS RowNum\n          FROM  Photos p\n                LEFT OUTER JOIN SetPhotos sp\n                    ON sp.PhotoID = p.PhotoID\n                LEFT OUTER JOIN [Sets] s\n                    ON s.SetID = sp.SetID\n         WHERE  p.Hide = 0\n      ORDER BY  NEWID()\n        ) AS PaginatedPhotos\n WHERE  PaginatedPhotos.RowNum BETWEEN 0 AND 10\n</code></pre>\n"},{"tags":["sql-server","login","ssms"],"answer_count":4,"favorite_count":2,"up_vote_count":37,"down_vote_count":0,"view_count":10034,"score":37,"question_id":1719399,"title":"SQL Server 2008 can't login with newly created user","body":"<p>Using Vista...<br/>\n1) I open SQL Server Management Studio.<br/>\n2) I create a new Login by right-clicking on Security->Logins. <br/>\nCheck: SQL Server Authentication<br/>\nLogin name: tester <br/>\nPassword: test <br/>\nClick OK<br/>\n3) Click File -> Connect Object Explorer, select SQL Server Authentication and enter tester/test and click Connect.\n4) Get \"Login failed for user 'tester'. (Microsoft SQL Server, Error: 18456\" with Severity = 14 and State = 1.</p>\n\n<p>Any ideas?</p>\n\n<p>EDIT: I forgot to mention that I added this user to User Mapping to my database of choice.</p>\n"},{"tags":["sql-server","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":85,"score":3,"question_id":13035353,"title":"Using SQL Server named parameters with ExecuteStoreQuery and ExecuteStoreCommand","body":"<p>I am trying to use SQL Server named parameters with <code>ObjectContext.ExecuteStoreQuery</code> and <code>ObjectContext.ExecuteStoreCommand</code> when calling a stored procedure or a function directly.</p>\n\n<p>SQL Server named parameters are not the same with the Entity Framework named parameters - they allow me to execute a query similar with this one:</p>\n\n<pre><code>EXEC sp_GetData @firstParameter = 1, @thirdParameter = 2, @secondParameter = 1\n</code></pre>\n\n<p>The order of the parameters in this query does not matter as opposed with Entity Framework named parameters that are evaluated in order.</p>\n\n<p>I want to use SQL Server named parameters with Entity Framework so that if the order of the parameters is changed in the stored procedure the Entity Framework code calling it is not affected.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":48,"score":0,"question_id":13075079,"title":"Finding a line break in a text string in a SQL table?","body":"<p>I was trying to find line breaks and carriage returns in a column in a SQL table and I am not sure about the syntax.</p>\n\n<p>I tried:</p>\n\n<pre><code>SELECT foo FROM test\nWHERE foo LIKE CHAR(10)\n</code></pre>\n\n<p>I didn't get any results even though I know that the table should return results.  What am I doing wrong?</p>\n"},{"tags":["sql","sql-server","ms-access"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13074996,"title":"How can I parameterize an update using an \"anonymous table\"?","body":"<p>I'm fairly sure that a big part of the reason I'm failing to find answers with Google is because I don't know the correct terminology to describe my problem.</p>\n\n<p>I know the following form well:</p>\n\n<pre><code>UPDATE Table t\nSET t.description = Concat(ot.text, ' text')\nFROM Table\nINNER JOIN Other_Table ot ON t.id = ot.id\nWHERE conditions;\n</code></pre>\n\n<p>What I'm trying to accomplish is more like:</p>\n\n<pre><code>UPDATE Table t\nSET t.description = Concat(item, ' text')\nFROM t\nINNER JOIN (SELECT item FROM ('list', 'of', 'items'))\nWHERE conditions;\n</code></pre>\n\n<p>In other words I have an \"anonymous table\", or a list of explicit strings specified in the query, rather than stored in a table, and I want them to be picked one at a time and concatenated with some string literal and to update a row.</p>\n\n<p>So imagine I have a table of product information.  I want to update this table so the \"description\" column contains \"This product is <em>color</em>!\".  I'm looking for something like:</p>\n\n<pre><code>UPDATE Products p\nSET p.desc = Concat('This product is ', color, '!')\nFROM p\nINNER JOIN (SELECT color FROM ('blue', 'red', 'green'))\nWHERE p.sku in (111, 112, 113);\n</code></pre>\n\n<p>I'm using Access 2010 and connecting to a SQL Server 2008 DB.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":53,"score":2,"question_id":13070519,"title":"Should I avoid using sp_getAppLock?","body":"<p>I have a stored procedure, and I want to ensure it cannot be executed concurrently.</p>\n\n<p>My (multi-threaded) application does all necessary work on the underlying table via this stored procedure.</p>\n\n<p>imo, locking the table itself is an unnecessarily drastic action to take, and so when I found out about <code>sp_GetAppLock</code>, which essentially enforces a critical section, this sounded ideal.</p>\n\n<p>My plan was to encase the stored procedure in a transaction and to set up <code>spGetAppLock</code> with transaction scope. The code was written and tested successfully.</p>\n\n<p>The code has now been put forward for review and I have been told that I should not call this function. However when asking the obvious question \"why not?\", the only reasons I am getting are highly subjective, to do with any form of locking being complicated.</p>\n\n<p>I don't necessarily buy this, but I was wondering whether anyone had any <em>objective</em> reasons why I should avoid this constuct. Like I say, given my circumstances a critical section sounds an ideal approach to me.</p>\n\n<p>TIA,\nPete</p>\n"},{"tags":["sql-server","ms-access","sql-server-2008-r2","linked-tables"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":26,"score":2,"question_id":13070202,"title":"Concurrency error with MS-Access Linked Tables","body":"<p>I am linking tables to a SQL 2008R2 DB via MS Access Linked Tables.</p>\n\n<p>I am getting this warning when I want to change the data in an Access linked table where the underlying SQL table has more than one bit field in it: </p>\n\n<blockquote>\n  <p>The record has been changed by another user since you started editing\n  it. If you save the record, you will overwrite the changes the other\n  user made</p>\n</blockquote>\n\n<p>I don't have any problems when there is only one bit field in the table. It's really a strange error imho. Has any one else encountered this before and found a work around for it by any chance?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":4297,"score":4,"question_id":1426487,"title":"Format phone number","body":"<p>I have table in the db with phone number column the numbers look like this:</p>\n\n<blockquote>\n  <p>123456789</p>\n</blockquote>\n\n<p>I want to format that to:</p>\n\n<blockquote>\n  <p>123-456-789</p>\n</blockquote>\n\n<p>thanks!!!</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13074566,"title":"select for update, Sql Server 2008","body":"<p>I have a Java code for Oracle with which I keep a file in the database, the file is stored in a Blob field, for this purpose I use a \"select for update\" and put the connection in \"autocommit (false ) \"to keep the channel open to that record, after that I keep that result in a Blob and then write content to an OutputStream, then do\" commit \"and put the connection back to\" autocommit (true) \".</p>\n\n<p>The question is, how I can do a \"select for update\" for SQL Server 2008? I've been reading that possibly with a \"WITH (ROWLOCK)\" in my select, but if I do so, after you commit to writing the OutputStream object is unlocked automatically? or what is the procedure?</p>\n\n<p>Thanks for listening.</p>\n"},{"tags":["sql-server","cmd","mkdir","dts","createprocess"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":12,"score":2,"question_id":13073974,"title":"Proper format to invoke Process Task in DTS 2000","body":"<p>now Im creating a dts 2000 package in SQL 2005 IDE.\nIm learning to use an \"Execute Process Task\". So, I want to create a new folder using this tool.\nThese are my steps:</p>\n\n<ol>\n<li>Click \"Execute Process Task\"</li>\n<li>Description: New PT</li>\n<li>Win32 process: %ComSpec%</li>\n<li>Parameters: ?</li>\n<li>Return code: 0</li>\n<li>Timeout: 2</li>\n</ol>\n\n<p>As you can see, I need the proper format to put my commands. </p>\n\n<p>thanks in advance</p>\n\n<p>Command like a \"D:\\ mkdir hello\"</p>\n"},{"tags":["android","sql-server","classnotfoundexception"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13073945,"title":"ClassNotFoundException - connectiong to MSSQL Database","body":"<p>I want to connect my android application to my MSSQL Database.\nUnfortunately, there is a problem :/</p>\n\n<blockquote>\n  <p>10-25 19:17:00.536: W/System.err(18961): java.lang.ClassNotFoundException: net.sourceforge.jtds.jdbc.Driver\n  10-25 19:17:00.546: W/System.err(18961):    at java.lang.Class.classForName(Native Method)\n  10-25 19:17:00.556: W/System.err(18961):    at java.lang.Class.forName(Class.java:217)\n  10-25 19:17:00.556: W/System.err(18961):    at java.lang.Class.forName(Class.java:172)\n  10-25 19:17:00.556: W/System.err(18961):    at com.example.mssqlcon.MainActivity.onCreate(MainActivity.java:21)\n  10-25 19:17:00.556: W/System.err(18961):    at android.app.Activity.performCreate(Activity.java:4465)\n  10-25 19:17:00.556: W/System.err(18961):    at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1049)\n  10-25 19:17:00.556: W/System.err(18961):    at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2033)\n  10-25 19:17:00.556: W/System.err(18961):    at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2104)\n  10-25 19:17:00.556: W/System.err(18961):    at android.app.ActivityThread.access$600(ActivityThread.java:132)\n  10-25 19:17:00.556: W/System.err(18961):    at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1157)\n  10-25 19:17:00.556: W/System.err(18961):    at android.os.Handler.dispatchMessage(Handler.java:99)\n  10-25 19:17:00.556: W/System.err(18961):    at android.os.Looper.loop(Looper.java:137)\n  10-25 19:17:00.566: W/System.err(18961):    at android.app.ActivityThread.main(ActivityThread.java:4575)\n  10-25 19:17:00.566: W/System.err(18961):    at java.lang.reflect.Method.invokeNative(Native Method)\n  10-25 19:17:00.566: W/System.err(18961):    at java.lang.reflect.Method.invoke(Method.java:511)\n  10-25 19:17:00.566: W/System.err(18961):    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:789)\n  10-25 19:17:00.566: W/System.err(18961):    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:556)\n  10-25 19:17:00.566: W/System.err(18961):    at dalvik.system.NativeStart.main(Native Method)\n  10-25 19:17:00.566: W/System.err(18961): Caused by: java.lang.NoClassDefFoundError: net/sourceforge/jtds/jdbc/Driver\n  10-25 19:17:00.566: W/System.err(18961):    ... 18 more\n  10-25 19:17:00.566: W/System.err(18961): Caused by: java.lang.ClassNotFoundException: net.sourceforge.jtds.jdbc.Driver\n  10-25 19:17:00.576: W/System.err(18961):    at dalvik.system.BaseDexClassLoader.findClass(BaseDexClassLoader.java:61)\n  10-25 19:17:00.576: W/System.err(18961):    at java.lang.ClassLoader.loadClass(ClassLoader.java:501)\n  10-25 19:17:00.576: W/System.err(18961):    at java.lang.ClassLoader.loadClass(ClassLoader.java:461)\n  10-25 19:17:00.576: W/System.err(18961):    ... 18 more</p>\n</blockquote>\n\n<p>My code:</p>\n\n<pre><code>public class MainActivity extends Activity {\n\n@Override\npublic void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main);\n    try {\n        Class.forName(\"net.sourceforge.jtds.jdbc.Driver\").newInstance();\n\n        Connection connection = DriverManager.getConnection(\n                \"jdbc:jtds:sqlserver://ip_of_my_database\", \"*****\", \"*******\");\n        Statement statement = connection.createStatement();\n        //ResultSet result = statement\n        //      .executeQuery(\"SELECT * FROM nazwatabeli\");\n        ResultSet result = statement.executeQuery(\"SELECT * FROM name\");\n        if(result.first()){\n            do{\n                Log.v(\"MainActivity\", \"Name: \"+result.getString(result.getRow()));\n            } while(result.next());\n\n        }\n    } catch (Exception e){\n        e.printStackTrace();\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>What I do wrong?</p>\n"},{"tags":["sql","sql-server","sql-server-2008-r2","sql-azure"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13074003,"title":"How to perform the same tasks in SQL SERVER IN SQL AZURE?","body":"<p>I connect my <code>SQL AZURE</code> to <code>SQL SERVER 2008 R2</code>.I realized that I can't use the GUI to create my tables, edit the design of the tables, insert.. update.. remove data, etc.</p>\n\n<p>Is it possible that using SQL SERVER 2008R2 I can perform the last tasks using the GUI?</p>\n\n<p>Another day I saw something about data synchronization with local database and azure, but I'm not sure what was that. I mention it if that is important for what I'm looking for.</p>\n\n<p><img src=\"http://i.stack.imgur.com/6sjYp.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server","database","sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":108,"score":1,"question_id":13072992,"title":"Avoid \"SELECT TOP 1\" and \"ORDER BY\" in Queries","body":"<p>I have the very table in sql server 2008 with lot of data</p>\n\n<pre><code>|ID|Name|Column_1|Column_2|\n|..|....|........|........|\n</code></pre>\n\n<p>more than 18,000 records. So i need to the the row with the lowest value of <code>Column_1</code> that is date but could by any data type (that is unsorted) so I use these sentence</p>\n\n<pre><code>SELECT TOP 1 ID, Name from table ORDER BY Column_1 ASC\n</code></pre>\n\n<p>But this is very very slow. And i think that i don't need to to sort the whole table. My question es how to get the same date with out using <code>TOP 1</code> and <code>ORDER BY</code></p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13073322,"title":"Get sum by criteria in JOIN tables","body":"<p>My database has a structure like this:\n<img src=\"http://i.stack.imgur.com/VrlO8.png\" alt=\"enter image description here\"></p>\n\n<p>'Movimientos' table keeps records of all charges and payments of my system.\n'Cargos' table keeps some metadata of each charge on 'Movimientos' and 'Abonos' table keeps some metadata of each payment on 'Movimientos'.</p>\n\n<p>How do I write a query which sum all records in 'Movimientos' where 'Abonos.tipo_abono' and 'Cargos.tipo_cargo' have some criteria?</p>\n\n<p>I have a query that already sum 'Movimientos' but I can't add the part where 'Abonos' and 'Cargos' tables add more criteria.</p>\n\n<pre><code>SELECT SUM(M.monto) as monto, SUM(M.interes) as interes, SUM(M.iva) as iva, SUM(M.capital) as capital\n                FROM movimientos AS M\n                JOIN acreditados AS A ON A.id_acreditado = M.id_acreditado\n                JOIN creditos AS C ON C.id_credito = A.id_credito\n                WHERE  C.id_credito = 29\n</code></pre>\n\n<p>Let's say I want modify the last query to just sum records where 'Abono.tipo_abono'=1 and 'Cargos.tipo_cargo'=1, how do I do it?</p>\n"},{"tags":["c#","asp.net","sql-server","linq"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13072770,"title":"Query on two DataTable to find duplicate rows","body":"<p>I have an excel sheet which i am uploading to sqlserver table using sqlbulkcopy, i have applied an index on database table so that duplicate entries are ignored but i also want to display the duplicate entries which were ignored in a grid view.</p>\n\n<pre><code>  protected void Button1_Click(object sender, EventArgs e)\n{\n    string strFileType = System.IO.Path.GetExtension(FileUpload1.FileName).ToString().ToLower();\n    string strFileName = FileUpload1.PostedFile.FileName.ToString();\n\n    FileUpload1.SaveAs(Server.MapPath(\"~/Import/\" + strFileName + strFileType));\n    string strNewPath = Server.MapPath(\"~/Import/\" + strFileName + strFileType);\n\n\n\n\n\n\n        string excelConnectionString = String.Format(@\"Provider=Microsoft.Jet.OLEDB.4.0;\" + \"Data Source=\"+strNewPath +\"; Extended Properties=Excel 8.0;\");\n\n    //string excelConnectionString = String.Format(@\"Provider=Microsoft.Jet.OLEDB.4.0;\" + \"Data Source=C:\\\\myFolder\\\\Book1.xls;\" + \"Extended Properties=Excel 8.0;\"); \n\n\n        // Create Connection to Excel Workbook\n        using (OleDbConnection connection = new OleDbConnection(excelConnectionString))\n        {\n            connection.Open();\n            OleDbCommand command = new OleDbCommand(\"Select ID,Data FROM [Sheet1$]\", connection);\n            OleDbCommand command1 = new OleDbCommand(\"select count(*) from [Sheet1$]\",connection);\n\n            //Sql Server Table DataTable\n            DataTable dt4=new DataTable();\n            SqlCommand cmd4 = new SqlCommand(\"select id,data from ExcelTable\", con);\n            try \n                { \n                    SqlDataAdapter da4 = new SqlDataAdapter(cmd4); \n                    da4.Fill(dt4);//sql table datatable\n                 }\n                catch { }\n\n\n            //excelsheet datatable\n            DataTable oltlb = new DataTable();\n          OleDbCommand olcmd = new OleDbCommand(\"select id,data from [Sheet1$]\", connection);\n          try\n          {\n              OleDbDataAdapter olda = new OleDbDataAdapter(olcmd);\n              olda.Fill(oltlb); //excel table datatable\n          }\n          catch { }\n\n    var matched = (from table1 in dt4.AsEnumerable()\n                         join table2 in oltlb.AsEnumerable() on\n                       table1.Field&lt;int&gt;(\"ID\") equals table2.Field&lt;int&gt;(\"ID\")\n                         where table1.Field&lt;string&gt;(\"Data\") == table2.Field&lt;string&gt;(\"Data\")\n                         select table1);\n          DataTable dthi5 = new DataTable();\n          dthi5 = matched.CopyToDataTable();\n\n          GridView1.DataSource = dthi5;\n          GridView1.DataBind();\n            GridView1.DataSource = matched.ToList();\n</code></pre>\n\n<p>ERROR:\nSpecified cast is not valid.\ntable1.Field(\"ID\") equals table2.Field(\"ID\")</p>\n"},{"tags":["c#","sql-server","c#-4.0","zedgraph"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13073676,"title":"A rolling chart of data with ZedGraph, where the data is stored in sql server","body":"<p>I have a large amount of data in sql server (too much to load into memory all at once in my pc). I was planning to use paging in sql server to retrieve predefined blocks of data. What im wondering is, is it possible to setup Zedgraph such that once a user scrolls to the right (newest data), a new chunk of data is retrieved from the sql server, displayed and the oldest chunk of data is removed from the charts memory?</p>\n\n<p>If this isnt possible, is there a free alternative to ZedGraph which would be able to do the following?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","ms-access","ms-access-2010"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":82,"score":4,"question_id":13070244,"title":"Get the missing value in a sequence of numbers","body":"<p>I made the following query for the SQL Server backend</p>\n\n<pre><code>SELECT TOP(1) (v.rownum + 99)\nFROM\n    (\n        SELECT incrementNo-99 as id, ROW_NUMBER() OVER (ORDER BY incrementNo) as rownum\n        FROM proposals\n        WHERE [year] = '12'\n    )  as v\nWHERE v.rownum &lt;&gt; v.id\nORDER BY v.rownum\n</code></pre>\n\n<p>to find the first unused proposal number.\n(It's not about the lastrecord +1)</p>\n\n<p>But I realized <code>ROW_NUMBER</code> is not supported in access.\nI looked and I can't find something similar.</p>\n\n<p>Does anyone know how to get the same result as a <code>ROW_NUMBER</code> in access?</p>\n\n<p>Maybe there's a better way of doing this.</p>\n\n<p>Actually people insert their proposal No (incrementID) with no constraint. This number looks like this 13-152. xx- is for the current year and the -xxx is the proposal number. The last 3 digits are supposed to be incremental but in some case maybe 10 times a year they have to skip some numbers. That's why I can't have the auto increment.</p>\n\n<p>So I do this query so when they open the form, the default number <strong>is the first unused</strong>.</p>\n\n<p>How it works:</p>\n\n<p>Because the number starts at 100, I do -99 so it starts at 1.</p>\n\n<p>Then I compare the row number with the id so it looks like this</p>\n\n<pre><code>ROW NUMBER      |       ID\n1                        1                 (100)\n2                        2                 (101)\n3                        3                 (102)\n4                        5                 (104)&lt;--------- WRONG  \n5                        6                 (105)\n</code></pre>\n\n<p>So now I know that we skip 4. So I return (4 - 99) = 103</p>\n\n<p>If there's a better way, I don't mind changing but I really like this query.</p>\n\n<p>If there's really no other way and I can't simulate a row number in access, i will use the pass through query.</p>\n\n<p>Thank you </p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","pivot"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":76,"score":3,"question_id":13072744,"title":"SQL Server PIVOT with multiple X-axis columns","body":"<p>Take the following example data:</p>\n\n<pre><code>Payroll Forname Surname Month   Year    Amount\n0000001 James   Bond    3       2011    144.00\n0000001 James   Bond    6       2012    672.00\n0000001 James   Bond    7       2012    240.00\n0000001 James   Bond    8       2012    1744.50\n0000002 Elvis   Presley 3       2011    1491.00\n0000002 Elvis   Presley 6       2012    189.00\n0000002 Elvis   Presley 7       2012    1816.50\n0000002 Elvis   Presley 8       2012    1383.00\n</code></pre>\n\n<p>How would i PIVOT this on the Year + Month (eg: 201210) but preserve Payroll, Forename &amp; Surname as seperate columns, for example, the above would become:</p>\n\n<pre><code>Payroll Forename    Surname 201103  201206  201207  201208\n0000001 James       Bond    144.00  672.00  240.00  1744.50\n0000002 Elvis       Presley 1491.00 189.00  1816.50 1383.00\n</code></pre>\n\n<p>I'm assuming that because the Year + Month names can change then i will need to employ dynamic SQL + PIVOT - i had a go but couldnt even get the code to parse, nevermind run - any help would be most appreciated!</p>\n\n<p>Edit: What i have so far:</p>\n\n<pre><code>    INSERT  INTO #tbl_RawDateBuffer\n            ( PayrollNumber ,\n              Surname ,\n              Forename ,\n              [Month] ,\n              [Year] ,\n              AmountPayable\n            )\n            SELECT  PayrollNumber ,\n                    Surname ,\n                    Forename ,\n                    [Month] ,\n                    [Year] ,\n                    AmountPayable\n            FROM    RawData\n            WHERE   [Max] &gt; 1500\n\n\nDECLARE @Columns AS NVARCHAR(MAX)\nDECLARE @StrSQL AS NVARCHAR(MAX) \n\nSET @Columns = STUFF((SELECT DISTINCT\n                                ',' + QUOTENAME(CONVERT(VARCHAR(4), c.[Year]) + RIGHT('00' + CONVERT(VARCHAR(2), c.[Month]), 2))\n                      FROM      #tbl_RawDateBuffer c\n    FOR              XML PATH('') ,\n                         TYPE \n            ).value('.', 'NVARCHAR(MAX)'), 1, 1, '') \n\nSET @StrSQL = 'SELECT PayrollNumber, ' + @Columns + ' from \n            (\n                select PayrollNumber\n                    , CONVERT(VARCHAR(4), [Year]) + RIGHT(''00'' + CONVERT(VARCHAR(2), [Month]), 2) dt\n                from #tbl_RawDateBuffer\n           ) x\n            pivot \n            (\n                sum(AmountPayable)\n                for dt in (' + @Columns + ')\n            ) p '\n\n\nEXECUTE(@StrSQL)\n\nDROP TABLE #tbl_RawDateBuffer\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13073105,"title":"Case statement with 'OR' statement","body":"<pre><code>SELECT   ProductNumber, Category =\n      CASE ProductLine\n         WHEN 'R' or 'r' THEN 'Road'\n         WHEN 'M' or 'm' THEN 'Mountain'\n         WHEN 'T' or 't' THEN 'Touring'\n         WHEN 'S' or 's' THEN 'Other sale items'\n         ELSE 'Not for sale'\n</code></pre>\n\n<p>My basic requirement is to use 'OR' with CASE (if possible) , Please suggest if i am doing anything wrong.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13071566,"title":"Derived Tables vs. Correlated subquery in HAVING clause SQL Server 2008","body":"<p>In this example I've only got two tables with which I'm working.  I was checking to see which might run faster and the execution plans were identical.  The purpose of these queries is to find the minimum date associated with one record that's larger than the maximum date of another.  The first query is more concise (although it doesn't allow the <code>DATEDIFF</code> column the second one does).  I feel like writing a query the second way will, in the long run, be more costly performance wise, perhaps when I have many joins.  Are there any general rules about which method, or is it a case by case scenario and you let the optimizer work it out?  </p>\n\n<p>first</p>\n\n<pre><code>select c.patid,min(c.admitDate) as minDiabetesDate\n    from clm_extract as c\n    inner join icdClm as ic on ic.clmid=c.clmid\n    where ic.icd like '250%' \n    group by c.patid\n    having min(c.admitdate) &gt; \n    (\n        select MAX(c2.admitDate) as maxPreDiabetesDate\n            from clm_extract as c2\n            inner join icdClm as ic2 on ic2.clmid = c2.clmid\n            where ic2.icd ='79029' and c2.patid=c.patid\n            group by c2.patid\n    )\n</code></pre>\n\n<p>second </p>\n\n<pre><code>select distinct x.patid,x.minDiabetesDate,y.maxPreDiabetesDate \nfrom\n(   \n\nselect c.patid, min(c.admitdate) as minDiabetesDate\n    from clm_extract as c \n    inner join icdClm as ic on ic.clmid=c.clmid\n    where ic.icd like '250%'\n    group by c.patid\n)x\ninner join \n(\nselect c2.patid, MAX(c2.admitdate) as maxPreDiabetesDate\n    from clm_extract as c2\n    inner join icdClm as ic2 on ic2.clmid=c2.clmid\n    where ic2.icd ='79029'\n    group by c2.patid\n)y on x.patid=y.patid\ngroup by x.minDiabetesDate,y.maxPreDiabetesDate,x.patid\nhaving DATEDIFF(dd,y.MaxPreDiabetesDate,x.minDiabetesDate) &gt; 0\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","full-text-search"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":246,"score":3,"question_id":8011044,"title":"Contains() function falters with strings of numbers?","body":"<p>For some background information, I'm creating an application that searches against a couple of indexed tables to retrieve some records. It isn't overtly complex to the point of say Google, but it's good enough for the purpose it serves, barring this strange issue. </p>\n\n<p>I'm using the <code>Contains()</code> function, and it's going very well, except when the search contains strings of numbers. Now, I'm only passing in a string -- nowhere numerical datatypes being passed in -- only characters. We're searching against a collection of emails, each appended with a custom ID when shot off from a workflow. So while testing, we decided to search via number strings. </p>\n\n<p>In our test, we isolated a number <code>0042600006</code>, which belongs to one and only one email subject. However, when using our query we are getting results for <code>0042600001</code>, <code>0042600002</code>, etc. The query is this as follows (with some generic columns standing in):</p>\n\n<p><code>SELECT description, subject FROM tableA WHERE CONTAINS((subject), '0042600006')</code></p>\n\n<p>We've tried every possible combination: <code>'0042600006*'</code>, <code>'\"0042600006\"'</code> and <code>'\"0042600006*\"'</code>. </p>\n\n<p>I think it's just a limitation of the function, but I thought this would probably be the best place for answers. Thanks in advance. </p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13072365,"title":"SQL query advice","body":"<p>I've been having trouble coming up with a proper query to handle this situation in SQL Server.</p>\n\n<p>There are two tables, Warehouse and Transfer:</p>\n\n<p>Warehouse</p>\n\n<ul>\n<li>wh_id(PK)</li>\n<li>wh_name</li>\n</ul>\n\n<p>Transfer</p>\n\n<ul>\n<li>transfer_id(PK)</li>\n<li>transfer_from(FK)</li>\n<li>transfer_to (FK)</li>\n</ul>\n\n<p>I need a query to return:</p>\n\n<ul>\n<li>transfer_id</li>\n<li>transfer_from - Name, not id</li>\n<li>transfer_to - Name, not id</li>\n</ul>\n\n<p>What I've tried so far:</p>\n\n<pre><code>SELECT T.transfer_id, WH.wh_name, T.transfer_to\nFROM transfer AS T INNER JOIN warehouse AS WH\nON T.transfer_from = WH.wh_id\n</code></pre>\n\n<p>This only gives the name for the transfer_from not the transfer_to. I've had a need for a similar query but my level of SQL expertise is low and I just don't know how to approach this problem. Any guidance is greatly appreciated.</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13071625,"title":"How to Order BY without having Column in SELECT","body":"<p>I am using MS-SQL and I have a table like this:</p>\n\n<pre><code>Count  Code\n1      A\n2      C\n3      A\n4      B\n5      C\n6      B\n</code></pre>\n\n<p>I need to only to get Distinct Row of the Code Column but I need to keep the Order of the Column to create a Comma Delimited String like this:</p>\n\n<pre><code>    A, C, B\n</code></pre>\n\n<p>I have tried the following code to not get an SQL Error of Msg 145, Level 15 - ORDER BY items must appear in the select list if SELECT DISTINCT is specified.</p>\n\n<pre><code>SELECT @tlist = ISNULL(@tlist+', ','') + Code \nFROM (SELECT DISTINCT t.Code  \n     FROM @Table t) \n</code></pre>\n\n<p>but I get an output of A, B, C</p>\n"},{"tags":["sql","sql-server"],"answer_count":10,"favorite_count":36,"up_vote_count":42,"down_vote_count":0,"view_count":49090,"score":42,"question_id":187998,"title":"Row Offset in SQL Server","body":"<p>Is there any way in SQL Server to get the results starting at a given offset? For example, in another SQL server, it's possible to do:</p>\n\n<pre><code>SELECT * FROM MyTable OFFSET 50 LIMIT 25\n</code></pre>\n\n<p>to get results 50-74. This construct does not appear to exist in SQL Server.  </p>\n\n<p>How can I accomplish this without loading all the rows I don't care about?  Thanks! </p>\n"},{"tags":["sql-server","for-loop","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13071725,"title":"Foreach Loop Container in SSIS","body":"<p>I am using for each loop container in ssis. I need to extrat excel file from my folder. \nexample file names:- january 2012, march 2012 etc. My problem is i need to extract only current month file (which is October 2012). Any idea?</p>\n"},{"tags":["c#","asp.net","sql-server","excel","import"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":270,"score":-1,"question_id":13015818,"title":"Unable to import Excel file into SQL Server through asp.net","body":"<p>I am trying to import Excel file's data into SQL Server table.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>protected void Button1_Click(object sender, EventArgs e)\n{\n    String connectionString = string.Format(\"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=c:\\\\myFolder\\\\myExcel2007file.xlsx;Extended Properties=Excel 12.0;HDR=YES\");\n    String destinationConnectionString = \"Data Source=ARBAAZ-1B14C081;Initial Catalog=haj;Integrated Security=True\";\n\n    DataTable data = SelectDataFromSource(connectionString);\n\n    CopyDataToDestination(destinationConnectionString, data);\n}\n\nprivate DataTable SelectDataFromSource(String connectionString)\n{\n     DataTable data = new DataTable();\n\n     using (SqlConnection connection = new SqlConnection(connectionString))\n     {\n         SqlCommand command = new SqlCommand(\"SelectOrders\", connection);\n         command.CommandType = CommandType.StoredProcedure;\n         connection.Open();\n\n         SqlDataReader reader = command.ExecuteReader();\n         data.Load(reader);\n     }\n\n     return data;\n}\n\nprivate void CopyDataToDestination(String connectionString, DataTable table)\n{\n     SqlBulkCopyColumnMapping mapping1 = new SqlBulkCopyColumnMapping(\"ID\", \"IDa\");\n     SqlBulkCopyColumnMapping mapping2 = new SqlBulkCopyColumnMapping(\"Name\", \"Namea\");\n     SqlBulkCopyColumnMapping mapping3 = new SqlBulkCopyColumnMapping(\"Address\", \"Addressa\");\n     SqlBulkCopyColumnMapping mapping4 = new SqlBulkCopyColumnMapping(\"City\", \"Citya\");\n\n     SqlBulkCopy bulkCopy = new SqlBulkCopy(connectionString);\n     bulkCopy.BatchSize = 100;\n     bulkCopy.BulkCopyTimeout = 5;\n     bulkCopy.ColumnMappings.Add(mapping1);\n     bulkCopy.ColumnMappings.Add(mapping2);\n     bulkCopy.ColumnMappings.Add(mapping3);\n     bulkCopy.ColumnMappings.Add(mapping4);\n     bulkCopy.DestinationTableName = \"orders\";\n     bulkCopy.SqlRowsCopied += new SqlRowsCopiedEventHandler(bulkCopy_SqlRowsCopied);\n     bulkCopy.NotifyAfter = 200;\n\n     bulkCopy.WriteToServer(table);\n}\n\nvoid bulkCopy_SqlRowsCopied(object sender, SqlRowsCopiedEventArgs e)\n{\n    Response.Write(String.Format(\"{0} Rows have been copied.\", e.RowsCopied.ToString()));\n}\n</code></pre>\n\n<p>error: </p>\n\n<pre><code>Exception Details: System.ArgumentException: Keyword not supported: 'provider'. \nSource Error: \nLine 33: { \nLine 34: DataTable data = new DataTable(); \nLine 35: using (SqlConnection connection = new SqlConnection(connectionString)) \nLine 36: { \nLine 37: SqlCommand command = new SqlCommand(\"SelectOrders\", connection); \n</code></pre>\n"},{"tags":["sql","sql-server","query"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":37,"score":2,"question_id":13071766,"title":"SQL Server - Get highest values when previous date not blank","body":"<p>I have a table that contains information for player's steps taken for any given day, I want to get the 3 highest totals from the database, when the day before the day of the high total has a value added to it for that player. Since some players are not logging everyday, but rather lumping multiple days into one update.</p>\n\n<p>Data Structure:</p>\n\n<pre><code>|---------------------------------------------------------------|\n| id | player_id | steps | date       | submitted               |\n|----|-----------|-------|------------|-------------------------|\n| 1  | 16        | 5718  | 2012-09-06 | 2012-09-10 08:31:35.000 |\n| 2  | 16        | 9837  | 2012-09-07 | 2012-09-10 08:31:17.000 |\n| 3  | 16        | 10432 | 2012-09-09 | 2012-09-10 08:30:54.000 |\n| 4  | 30        | 3973  | 2012-09-07 | 2012-09-10 09:34:42.000 |\n| 5  | 30        | 7104  | 2012-09-08 | 2012-09-10 09:35:05.000 |\n| 6  | 30        | 10916 | 2012-09-09 | 2012-09-10 09:35:29.000 |\n| 7  | 9         | 6437  | 2012-09-07 | 2012-09-10 09:39:15.000 |\n| 8  | 9         | 9032  | 2012-09-08 | 2012-09-10 09:40:02.000 |\n|---------------------------------------------------------------|\n</code></pre>\n\n<p>So what I want to return are the rows:</p>\n\n<pre><code>|---------------------------------------------------------------|\n| 6  | 30        | 10916 | 2012-09-09 | 2012-09-10 09:35:29.000 |\n| 2  | 16        | 9837  | 2012-09-07 | 2012-09-10 08:31:17.000 |\n| 8  | 9         | 9032  | 2012-09-08 | 2012-09-10 09:40:02.000 |\n|---------------------------------------------------------------|\n</code></pre>\n\n<p>My query is currently:</p>\n\n<pre><code>SELECT TOP 3 p.name,\n             player_id,\n             steps,\n             date\nFROM   steppers_step_log\n       JOIN steppers_players P\n         ON player_id = P.id\nORDER  BY steps DESC \n</code></pre>\n\n<p>Which does not take into account whether there is an entry for the date prior on the top 3 from steps, which with my query in its current form will return 10432, 10916, and 9837 as the top steps.</p>\n\n<p>I am having trouble working out how to do the WHERE command to make sure that the previous day has an entry for that player_id and would appreciate any help in getting it working.</p>\n"},{"tags":["mysql","sql-server","sql-server-2005","stored-procedures","udf"],"answer_count":8,"favorite_count":31,"up_vote_count":54,"down_vote_count":0,"view_count":34271,"score":54,"question_id":451415,"title":"Simulating group_concat MySQL function in Microsoft SQL Server 2005?","body":"<p>I'm trying to migrate a MySQL-based app over to Microsoft SQL Server 2005 (not by choice, but that's life).</p>\n\n<p>In the original app, we used <em>almost</em> entirely ANSI-SQL compliant statements, with one significant exception -- we used MySQL's <code>group_concat</code> function fairly frequently.</p>\n\n<p><code>group_concat</code>, by the way, does this: given a table of, say, employee names and projects...</p>\n\n<pre><code>SELECT empName, projID FROM project_members;\n</code></pre>\n\n<p>returns:</p>\n\n<pre><code>ANDY   |  A100\nANDY   |  B391\nANDY   |  X010\nTOM    |  A100\nTOM    |  A510\n</code></pre>\n\n<p>... and here's what you get with group_concat:</p>\n\n<pre><code>SELECT \n    empName, group_concat(projID SEPARATOR ' / ') \nFROM \n    project_members \nGROUP BY \n    empName;\n</code></pre>\n\n<p>returns:</p>\n\n<pre><code>ANDY   |  A100 / B391 / X010\nTOM    |  A100 / A510\n</code></pre>\n\n<p>...So what I'd like to know is: Is it possible to write, say, a user-defined function in SQL Server which emulates the functionality of <code>group_concat</code>? I have almost no experience using UDFs, stored procedures, or anything like that -- just straight-up SQL -- so please err on the side of too much explanation :)</p>\n"},{"tags":["sql","sql-server","database","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":32,"score":3,"question_id":13070992,"title":"inserting into A errors because of a foreign key contraint issue","body":"<p>Can someone help explain this to me and resolve it?</p>\n\n<p><a href=\"http://sqlfiddle.com/#!6/2adc7/9\" rel=\"nofollow\">http://sqlfiddle.com/#!6/2adc7/9</a></p>\n\n<p><strong>The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_tblMobileForms_tblForms\". The conflict occurred in database \"db_6_2adc7\", table \"dbo.tblForms\", column 'fm_id'.: insert into tblMobileForms(fm_name) values ('lol')</strong></p>\n\n<p>My schema has the ID from tblMobileForms be a foreign key to tblForms.fm_id</p>\n"},{"tags":["c#","asp.net","sql-server","web-services","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13009362,"title":"Dynamic stored procedures not working in webservice","body":"<p>I have a dynamic select stored procedure. And I'm using it in my web application perfectly.\nBut I needed a web service and when I code and debug it, it gives me an error.</p>\n\n<p>I'm sending the exact same parameters, but while the web application is working perfectly, the web service is giving a syntax error like <code>incorrect syntax near and.</code>.</p>\n\n<p>Why is it acting like that?</p>\n\n<pre><code>try\n{\n    SqlParameter[] sp = new SqlParameter[8];\n    sp[0] = new SqlParameter(\"@tarih\", DateTime.Now);\n    sp[1] = new SqlParameter(\"@aractipkamyon\", true);\n    sp[2] = new SqlParameter(\"@aractipkamyonet\", true);\n    sp[3] = new SqlParameter(\"@aractiptir\", true);\n    sp[4] = new SqlParameter(\"@nereden\", 0);\n    sp[5] = new SqlParameter(\"@nereye\", 0);\n    sp[6] = new SqlParameter(\"@yuktipadi\", null);\n    sp[7] = new SqlParameter(\"@odemetipadi\", \"Pesin-Teslimde\");\n    DataTable dtProc = dbHelper.runQueryWithParams(\"prIlanHizliArama2\", sp);\n    if (dtProc.Rows.Count &gt; 0)\n    { }\n}\ncatch (Exception)\n{\n    throw;\n}\n</code></pre>\n\n<p>This is my class for the db.</p>\n\n<pre><code>public static DataTable runQueryWithParams(string storedProcedureName, params SqlParameter[] arrParam)\n{\n    DataTable dt = new DataTable();\n    //SqlConnection conn = new SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings[\"localhost\"].ConnectionString);\n    SqlConnection conn = new SqlConnection(ConfigurationManager.ConnectionStrings[\"ApplicationServices\"].ConnectionString);\n    SqlCommand cmd = new SqlCommand(storedProcedureName, conn);\n    cmd.CommandType = CommandType.StoredProcedure;\n    cmd.Parameters.Clear();\n    if (conn.State == ConnectionState.Closed || conn.State == ConnectionState.Broken)\n        conn.Open();\n\n    try\n    {\n        if (arrParam != null)\n        {\n            foreach (SqlParameter param in arrParam)\n                cmd.Parameters.Add(param);\n        }\n\n        SqlDataAdapter da = new SqlDataAdapter(cmd);\n        SqlDataReader dr = cmd.ExecuteReader();\n        dt.Load(dr);\n        return dt;\n    }\n    catch (Exception ex)\n    {\n        throw new Exception(\"Error: \" + ex.Message);\n    }\n    finally\n    {\n        cmd.Dispose();\n        conn.Close();\n    }\n}\n</code></pre>\n\n<p>SQL:</p>\n\n<pre><code>ALTER proc [dbo].[prIlanHizliArama2]\n@tarih nvarchar(MAX) = NULL,\n@aractipkamyon bit= NULL,\n@aractipkamyonet bit= NULL,\n@aractiptir bit= NULL,\n@nereden int = NULL,\n@nereye int = NULL,\n@yuktipadi nvarchar(10) = NULL,\n@odemetipadi nvarchar(25) = NULL\nas\nbegin\ndeclare @sqlQuery as nvarchar(4000);\n\nselect @sqlQuery = 'select tbAracTip.tipadi as tip1, tip2.tipadi as tip2,\ntbIlan.ilanId, tbYukTipi.tipadi as yuktipi, tbIlan.plaka, tbIlan.nereden, tbIlan.nereye,\ntbIlan.fiyat, tbIlan.tarih, tbOdemeTipi.tipadi as odemetipi, tbIlce.lats, tbIlce.lngs\nfrom tbIlan left join tbYukTipi on tbIlan.yuktipiId = tbYukTipi.yuktipiId\nleft join tbOdemeTipi on tbIlan.odemetipiId = tbOdemeTipi.odemeId\nleft join tbArac on tbArac.plaka = tbIlan.plaka\nleft join tbAracTip on tbArac.aractipId = tbAracTip.aractipId\nleft join tbAracTip as tip2 on tip2.aractipId = tbArac.usttipId\nleft join tbIlce on tbIlan.nereden = tbIlce.ilceId WHERE 1=1';\n\nif (@nereden is not null and @nereden &lt;&gt; 0)\nselect @sqlQuery = @sqlQuery + ' and (tbIlan.nereden = ' + CONVERT(nvarchar(5),@nereden+') ');\nif (@nereye is not null and @nereye &lt;&gt; 0)\nselect @sqlQuery = @sqlQuery + ' and (tbIlan.nereye = ' + convert(nvarchar(5), @nereye) + ') ';\nif (@yuktipadi is not null)\nselect @sqlQuery = @sqlQuery + ' and (tbYuktipi.tipadi = ' + convert(nvarchar(500),@yuktipadi)+ ') ';\nif (@odemetipadi is not null)\nselect @sqlQuery = @sqlQuery + ' and (tbOdemetipi.tipadi like ' +'''%'+ convert(nvarchar(500),@odemetipadi)+ '%''' + ')';\nif (@tarih is not null)\nselect @sqlQuery = @sqlQuery + ' and (DATEDIFF(DD,tbIlan.tarih,convert(date, '''+@tarih+''' ,103)) = 0) ';\nif (@aractipkamyon = 0 and @aractipkamyonet = 0 and @aractiptir = 1)\nselect @sqlQuery = @sqlQuery + ' and (tbArac.aracId in (select arac1Id from tbTir)) ';\n\nif (@aractipkamyon = 0 and @aractipkamyonet = 1 and @aractiptir = 0)\nselect @sqlQuery = @sqlQuery + ' and (tip2.tipadi = ' + '''Kamyonet'') ';\n\nif (@aractipkamyon =0 and @aractipkamyonet =1 and @aractiptir = 1)\nselect @sqlQuery = @sqlQuery + ' and ((tip2.tipadi = ' + '''Kamyonet'')' + ' or (tbArac.aracId in (select arac1Id from tbTir))) ';\n\nif (@aractipkamyon =1 and @aractipkamyonet =0 and @aractiptir = 0)\nselect @sqlQuery = @sqlQuery + ' and (tip2.tipadi = ' + '''Kamyon'') ' ;\n\nif (@aractipkamyon =1 and @aractipkamyonet = 0 and @aractiptir = 1)\nselect @sqlQuery = @sqlQuery + ' and ((tip2.tipadi = ' + '''Kamyon'')' + ' or (tbArac.aracId in (select arac1Id from tbTir))) ';\n\nif (@aractipkamyon =1 and @aractipkamyonet =1 and @aractiptir = 0)\nselect @sqlQuery = @sqlQuery + ' and ((tip2.tipadi = ' + '''Kamyon'')' + ' or (tip2.tipadi = ' + '''Kamyonet'')) ' ;\n\nif (@aractipkamyon =1 and @aractipkamyonet =1 and @aractiptir = 1)\nselect @sqlQuery = @sqlQuery + ' and ((tip2.tipadi = ' + '''Kamyon'')' + ' or (tip2.tipadi = ' + '''Kamyonet'')' + ' or (tbArac.aracId in (select arac1Id from tbTir))) ';\n\nprint (@sqlQuery)\nexec (@sqlQuery)\nend\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008-r2","common-table-expression"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":75,"score":2,"question_id":13070418,"title":"Using CTE in a DELETE is not executing","body":"<p>Here is the original query that runs and runs:</p>\n\n<pre><code>;WITH includedCs_cte\n    AS\n    (\n    SELECT \n            x.PKey, \n            x.OKey,\n            y.CKey \n    FROM  \n            #Permissions x\n            JOIN WHDATA.dbo.tb_DimC y\n                    ON \n                    x.PKey = y.PKey AND\n                    x.OKey = y.OKey\n        )\n, b_cte\n    AS\n    (\n    SELECT\n            i.OKey,\n            i.PKey\n    FROM \n                WHData.dbo.vw_FactCX b\n                INNER JOIN includedCs_cte i\n                        ON \n                        b.PKey = i.PKey AND\n                        b.PlayCKey = i.CKey\n    WHERE b.DateKey &gt;= @myLAST28DAYS\n    GROUP BY\n            i.OKey,\n            i.PKey\n    )\n, POK_cte\n    AS\n    (\n    SELECT\n            i.OKey,\n            i.PKey\n    FROM \n                WHData.dbo.vw_FactCY b\n                INNER JOIN includedCs_cte i\n                        ON \n                        b.PKey = i.PKey AND\n                        b.PlayCKey = i.CKey\n    WHERE b.DateKey &gt;= @myLAST28DAYS\n    GROUP BY\n            i.OKey,\n            i.PKey\n    )\n, includedOKeys\n    AS\n    (\n    SELECT *\n    FROM b_cte\n    UNION\n    SELECT * FROM POK_cte\n    )\nDELETE FROM #Permissions\nFROM #Permissions p\nWHERE NOT EXISTS\n                    (\n                    SELECT 1\n                    FROM includedOKeys x\n                    WHERE \n                            p.PKey = x.PKey AND\n                            p.OKey = x.OKey     \n                    )   \n</code></pre>\n\n<p>If I change the above to the below then it runs in less than 10 seconds. Why are these executing so differently?</p>\n\n<pre><code>;WITH includedCs_cte\n    AS\n    (\n    SELECT \n            x.PKey, \n            x.OKey,\n            y.CKey \n    FROM  \n            #Permissions x\n            JOIN WHDATA.dbo.tb_DimC y\n                    ON \n                    x.PKey = y.PKey AND\n                    x.OKey = y.OKey\n        )\n, b_cte\n    AS\n    (\n    SELECT\n            i.OKey,\n            i.PKey\n    FROM \n                WHData.dbo.vw_FactCX b\n                INNER JOIN includedCs_cte i\n                        ON \n                        b.PKey = i.PKey AND\n                        b.PlayCKey = i.CKey\n    WHERE b.DateKey &gt;= @myLAST28DAYS\n    GROUP BY\n            i.OKey,\n            i.PKey\n    )\n, POK_cte\n    AS\n    (\n    SELECT\n            i.OKey,\n            i.PKey\n    FROM \n                WHData.dbo.vw_FactCY b\n                INNER JOIN includedCs_cte i\n                        ON \n                        b.PKey = i.PKey AND\n                        b.PlayCKey = i.CKey\n    WHERE b.DateKey &gt;= @myLAST28DAYS\n    GROUP BY\n            i.OKey,\n            i.PKey\n    )\n, includedOKeys\n    AS\n    (\n    SELECT *\n    FROM b_cte\n    UNION\n    SELECT * FROM POK_cte\n    )\nSELECT *\nINTO #includedOKeys\nFROM includedOKeys\nCREATE CLUSTERED INDEX ix_inclProdOper ON #includedOKeys(OKey, PKey)\n\nDELETE FROM #Permissions\nFROM #Permissions p\nWHERE NOT EXISTS\n        (\n        SELECT 1\n        FROM #includedOKeys x\n        WHERE \n            p.PKey = x.PKey AND\n            p.OKey = x.OKey     \n        )   \n</code></pre>\n"},{"tags":["c#","sql-server","multithreading","parallel-processing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":13030082,"title":"Parallel reading from SQL Server","body":"<p>I was looking through dozens of articles, but couldn't find a solution.</p>\n\n<p>Here is the logic :</p>\n\n<p>I have a Winform (VS2010) application, that needs to read data from SQL Server 2008 R2 Express table <code>A</code>, process some calculations and store in a different table <code>B</code>.</p>\n\n<p>I want to use parallel <code>ForEach</code> in order to shorten execution time (otherwise the calculation + SQL process takes days.....)</p>\n\n<p>I have to read from SQL, because the database has over 5 million rows, each read returns a few hundreds rows.</p>\n\n<p>Lists are defined as :</p>\n\n<pre><code>BindingList&lt;ItemsClass&gt; etqM = new BindingList&lt;ItemsClass&gt;();\nBindingList&lt;ItemsClass&gt; etqC = new BindingList&lt;ItemsClass&gt;();\n</code></pre>\n\n<p>The parallel execution :</p>\n\n<pre><code>Parallel.ForEach(etqC, cv =&gt; {\n            readData(ref etqM, \"tableA\", \"WHERE ID LIKE '\" + cv.Name + \"%'\");\n            IList&lt;ItemsClass&gt; eResults = etqM.OrderBy(f =&gt; f.ID).ToList();\n\n            foreach (ItemsClass R in eResults)\n            {\n                //calculations comes here\n\n                etqM[rID] = R;\n            }\n\n            Parallel.ForEach(etqM, r =&gt; {\n                // part 2 of calculations comes here\n                }\n            });\n            exportList(etqM, \"tableB\", true);\n        });\n</code></pre>\n\n<p>The SQL Read function :\nThe function gets a List, Table name + conditions for the SQL\nread from SQL the records, and transform them to the List format.</p>\n\n<pre><code>public void readData&lt;T&gt;(ref BindingList&lt;T&gt; etqList, string tableName, string conditions)\n    {\n        SqlConnection myConnection = new SqlConnection();\n        SqlCommand myCommand = new SqlCommand();\n        myCommand.CommandTimeout = 0;\n        myCommand.Connection = myConnection;\n\n        etqList.Clear();            \n        openConn(myConnection);\n        SqlDataReader myReader = null;\n\n        try\n        {\n            int totalResults;\n            myCommand.CommandText = \"SELECT COUNT (*) FROM \" + tableName + \" \" + conditions;\n            totalResults = (int)myCommand.ExecuteScalar();\n\n            if (totalResults &gt; 0)\n            {\n                myCommand.CommandText = \"SELECT * FROM \" + tableName + \" \" + conditions;\n                myReader = myCommand.ExecuteReader();\n                etqList = ConvertTo&lt;T&gt;(convertReaderToDT(myReader));\n            }\n        }\n        catch (Exception ex) { }\n        finally\n        {\n            try { myReader.Close(); }\n            catch { }\n        }\n        closeConn(myConnection);\n    }\n</code></pre>\n\n<p>The SQL export function : this function exports the given list to the table name.</p>\n\n<pre><code>private void exportListToSql&lt;T&gt;(IEnumerable&lt;T&gt; etqList, string tableName)\n{\n        SqlConnection myConnection = new SqlConnection();\n        SqlCommand myCommand = new SqlCommand();\n        myCommand.CommandTimeout = 0;\n        myCommand.Connection = myConnection;\n        openConn(myConnection);\n\n        try\n        {\n            actionTotalCount++;\n            DataTable dt = new DataTable(tableName);\n            dt = ToDataTable(etqList);//List Name\n            var bulkCopy = new SqlBulkCopy(myConnection,\n                SqlBulkCopyOptions.TableLock |\n                SqlBulkCopyOptions.FireTriggers |\n                SqlBulkCopyOptions.UseInternalTransaction,\n                null\n                );\n            bulkCopy.DestinationTableName = tableName;\n            bulkCopy.BatchSize = BATCH_SIZE;\n            bulkCopy.WriteToServer(dt);\n        }\n        catch (Exception ex) {  }\n        finally { closeConn(myConnection); }\n    }\n</code></pre>\n\n<p>SQL <code>openConn</code> and <code>closeConn</code> :</p>\n\n<pre><code>void openConn(SqlConnection myConnection)\n{\n        if (myConnection.State == ConnectionState.Open) return;\n        myConnection.ConnectionString = \"Data Source=\" + DB_NAME + \";Initial Catalog=APPDB;Integrated Security=True;Connect Timeout=120;Asynchronous Processing=true;\";\n\n        try { myConnection.Open(); actionTotalCount++; }\n        catch (System.Exception ex) { MessageBox.Show(ex.Message); }\n}\n\nvoid closeConn(SqlConnection myConnection)\n{\n        if (myConnection.State == ConnectionState.Fetching || myConnection.State == ConnectionState.Executing || myConnection.State == ConnectionState.Connecting) return;\n        try { myConnection.Dispose(); }\n        catch (System.Exception ex) { MessageBox.Show(ex.Message); }\n}\n</code></pre>\n\n<p>The problem is : once I execute, I get this message :</p>\n\n<blockquote>\n  <p><em>ExecuteScalar requires an open and available connection. The connection's current state is closed.</em></p>\n</blockquote>\n\n<p>This message arrives for all threads, except the first one.</p>\n\n<p>Any ideas ?</p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":109,"score":3,"question_id":13067447,"title":"sql same name but different value","body":"<p>How can you retrieve all the lines that have the same name, but they have different values? For example, I have this table:</p>\n\n<pre><code>Name|Value|Description\nRob |Val1 |Text1\nAlex|Val1 |Text2\nAlan|Val2 |Text3\nAlex|Val2 |Text4\nAlex|Val2 |Text5  \nAlan|Val2 |Text6\n</code></pre>\n\n<p>I want the query to return just the persons that appear more than once, but have different values. So the results would be: </p>\n\n<pre><code>Alex|Val1 |Text2 \nAlex|Val2 |Text4 \nAlex|Val2 |Text5\n</code></pre>\n\n<p><strong>Edit:</strong> I added another row to the initial table. Some of the quesries will return Alan as part of the result too. I don't want that, since clearly it has the same value. How can this be achieved?</p>\n"},{"tags":["sql-server","tsql","join"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":44,"score":0,"question_id":13070809,"title":"TSQL Massive Join with multi rows","body":"<p>Is there a easy way to join like this? Table A and B have huge number of rows.</p>\n\n<p>Table A</p>\n\n<pre><code>Column 1    Column 2    \n1           AA  \n2           BB  \n3           CC  \n</code></pre>\n\n<p>Table B</p>\n\n<pre><code>Column 3        \nXXX     \nYYY     \nZZZ \n</code></pre>\n\n<p>Result      </p>\n\n<pre><code>Column 1    Column 2    Column 3\n1           AA          XXX\n1           AA          YYY\n1           AA          ZZZ\n2           BB          XXX\n2           BB          YYY\n2           BB          ZZZ\n3           CC          XXX\n3           CC          YYY\n3           CC          ZZZ\n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":12391618,"title":"selecting rows with near identical data, apart from 1 field","body":"<p>If I have several rows in a SQL db (access front end) with near exact data apart from one field (i know about normalization but Im happy to say this wasn't my doing!), is there an easy way to select one row with the common data and show all values for the other field together?  I can write a function do it programatically but Im wodndering of there's an easier way?</p>\n\n<p>eg</p>\n\n<pre><code>animal   brown   dog\n\nanimal   brown   cat\n\nanimal   brown   horse\n</code></pre>\n\n<p>as</p>\n\n<pre><code>animal   brown   dog, cat, horse\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008-r2"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":12395761,"title":"Union select statements horizontally","body":"<p>let's say result of my select statements as follows (I have 5 of those):  </p>\n\n<pre><code>   Id  Animal AnimalId\n    1   Dog     Dog1\n    1   Cat     Cat57\n\n   Id  Transport TransportId\n    2   Car        Car100\n    2   Plane      Plane500\n</code></pre>\n\n<p>I'd like to get a result as follows:</p>\n\n<pre><code>   Id  Animal AnimalId    Transport    TransportId\n    1   Dog     Dog1\n    1   Cat     Cat57\n    2                        Car          Car100\n    2                       Plane         Plane500 \n</code></pre>\n\n<p>What I can do is I can crate a tablevariable and specify all possible columns and insert records from each select statement into it. But maybe better solution like PIVOT?<br>\n      <strong>Edit</strong></p>\n\n<p>queries: 1st: <code>Select CategoryId as Id, Animal, AnimalId from Animal</code><br>\n2nd: <code>Select CategoryId as Id, Transport, TransportId from Transport</code></p>\n"},{"tags":["sql-server","tsql","string-concatenation"],"answer_count":6,"favorite_count":1,"up_vote_count":4,"down_vote_count":1,"view_count":1905,"score":3,"question_id":11351076,"title":"SQL: Concatenate column values in a single row into a string separated by comma","body":"<p>Let's say I have a table like this in SQL Server:</p>\n\n<pre><code>Id    City           Province             Country\n1     Vancouver      British Columbia     Canada\n2     New York       null                 null\n3     null           Adama                null\n4     null           null                 France\n5     Winnepeg       Manitoba             null\n6     null           Quebec               Canada\n7     Seattle        null                 USA \n</code></pre>\n\n<p>How can I get a query result so that the location is a concatenation of the City, Province, and Country separated by \", \", with nulls omitted.  I'd like to ensure that there aren't any trailing comma, preceding commas, or empty strings.  For example:</p>\n\n<pre><code>Id    Location\n1     Vancouver, British Columbia, Canada\n2     New York\n3     Adama\n4     France\n5     Winnepeg, Manitoba\n6     Quebec, Canada\n7     Seattle, USA\n</code></pre>\n"},{"tags":["sql","sql-server","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13056688,"title":"Can't figure out how to pivot and merge these results","body":"<p>I have a query that returns data that looks like.</p>\n\n<pre>PackageName  SiteLocation  Visible\nPackage1     SiteOne       1\nPackage1     SiteTwo       0\nPackage1     SiteFour      1\nPackage2     SiteThree     1</pre>\n\n<p>What I am wanting is the data to look like</p>\n\n<pre>PackageName  SiteOne  SiteTwo  SiteThree  SiteFour\nPackage1     1        0        NULL       1\nPackage2     Null     Null     1          NULL</pre>\n\n<p>I did a pivot on Site but the results I get look like</p>\n\n<pre>PackageName  SiteOne  SiteTwo  SiteThree  SiteFour\nPackage1     1        NULL     NULL       NULL\nPackage1     NULL     0        NULL       NULL\nPackage1     NULL     NULL     NULL       1\nPackage2     Null     Null     1          NULL</pre>\n\n<p>Is there a way to merge pivot on site then merge the results of PackageName?</p>\n\n<p>The query that returns this data is a simple query that just joins together foreign keys to turn SiteLocation into something meaningful instead of a FK_Id</p>\n"},{"tags":["java","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":86,"score":2,"question_id":13047132,"title":"JAVA sql NOT IN list statment","body":"<p>Good-day Everybody,</p>\n\n<p>Am trying to select record from database where record id NOT IN list.</p>\n\n<p>take a look @ my problem below.</p>\n\n<pre><code>String Sqlids = \"2,6,3,9\"; // this is dynamic so the number of element is unknown\n\nString str= \"SELECT TOP 1 * FROM student WHERE ID NOT IN (2,6,3,9) ORDER BY NEWID()\";\nPreparedStatement stat = con.prepareStatement(str);\nResultSet rs = stat.executeQuery();\n</code></pre>\n\n<p>The above statement work FINE, but if i change it to</p>\n\n<pre><code>String Sqlids = \"2,6,3,9\";\nString str= \"SELECT TOP 1 * FROM student WHERE ID NOT IN (Sqlids) ORDER BY NEWID()\";\nPreparedStatement stat = con.prepareStatement(str);\nResultSet rs = stat.executeQuery();\n\n//i also try this\nString Sqlids = \"2,6,3,9\";\nString str= \"SELECT TOP 1 * FROM student WHERE ID NOT IN (?) ORDER BY NEWID()\";\nPreparedStatement stat = con.prepareStatement(str);\nstat.setString(1,Sqlids );\n\nResultSet rs = stat.executeQuery();\n</code></pre>\n\n<p>THE ABOVE STATEMENT DOESN'T FILTER\nSince Sqlids is one string is seeing it as one parameter so it return repeated rows, is there an integer format for storing values like 2,6,3,9 ?\nsince the Sqlids is from an arraylist called SqlidList\ni try somtin like this</p>\n\n<pre><code>Iterator iTr = SqlidList.iterator();\nwhile(iTr.hasNext()){\n    stat.setString(1,iTr.next().toString()+\",\");\n}\n</code></pre>\n\n<p>but the setString(1,--) is not available since is in a while loop</p>\n"}]}
{"total":54452,"page":15,"pagesize":100,"questions":[{"tags":["sql-server","csv","bulkinsert"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":91,"score":2,"question_id":13068125,"title":"I am trying to BULK Insert CSV","body":"<p>I am getting a CSV from a client, I need to import that file to the database. I've been through countless iterations, part of the solution tests infinitum. My problem comes when I need the full solution.</p>\n\n<p>The CSV has 14 fields, the tempdb database has 15 fields (last one is the identity column). The data arrives without an identity and I need a row unique number as per the db design.</p>\n\n<p>I've obscured the test data shown, but it mimics the data ok.</p>\n\n<pre>T2012-DAT;09-01-2012;09-01-2012;1;910,91;12;TST;4,55;200,2;6;;;;7,5\nT2012-DAT;10-01-2012;10-01-2012;1;910,91;12;TST;4,55;200,2;6;;;;7,5\nT2012-DAT;11-01-2012;11-01-2012;1;910,91;12;TST;4,55;200,2;6;;;;7,5\nT2012-DAT;12-01-2012;12-01-2012;1;910,91;12;TST;4,55;200,2;6;;;;7,5\nT2012-DAT;13-01-2012;13-01-2012;1;910,91;12;TST;4,55;200,2;6;;;;7\nT2012-DAT;16-01-2012;16-01-2012;1;910,91;12;TST;4,55;200,2;6;;;;7,5</pre>\n\n<p>The temporary table I create in the tempdb. You will notice it has 15 fields, last one being the needed identity.  </p>\n\n<pre>CREATE TABLE BudgetImport(\n    sBudgetName varchar(20) COLLATE Danish_Norwegian_CI_AS  \n    , dStartDate varchar(12) COLLATE Danish_Norwegian_CI_AS  \n    , dEndDate varchar(12) COLLATE Danish_Norwegian_CI_AS   \n    , prCode int   \n    , decTotal varchar(20) COLLATE Danish_Norwegian_CI_AS\n    , sRefTimeTypeID varchar(10) COLLATE Danish_Norwegian_CI_AS  \n    , sRefEmployeeID varchar(10) COLLATE Danish_Norwegian_CI_AS  \n    , decHours varchar(20) COLLATE Danish_Norwegian_CI_AS  \n    , decRate varchar(20) COLLATE Danish_Norwegian_CI_AS\n    , sDepartmentID varchar(10) COLLATE Danish_Norwegian_CI_AS NULL  \n    , sCentre varchar(10) COLLATE Danish_Norwegian_CI_AS NULL  \n    , sPurpose varchar(10) COLLATE Danish_Norwegian_CI_AS NULL  \n    , sProjectID varchar(10) COLLATE Danish_Norwegian_CI_AS NULL  \n    , decNormHours varchar(20) COLLATE Danish_Norwegian_CI_AS  \n    --, iRowNumber int identity(500000,1)  \n)</pre>\n\n<p>GO</p>\n\n<pre>\n -- import data by csv\n BULK INSERT BudgetImport\n FROM 'D:\\budgetposter.csv'\n WITH\n (\n    fieldterminator = ';'\n    , rowterminator = '\\r\\n'\n    , codepage = '1252'\n )</pre>\n\n<p>When I incl the identity I get this error:</p>\n\n<pre>Msg 4866, Level 16, State 1, Line 3\nThe bulk load failed. The column is too long in the data file for row 1, column 15. Verify that the field terminator and row terminator are specified correctly.</pre>\n\n<p>If I exclude it, the error changes to:</p>\n\n<pre>Msg 4866, Level 16, State 1, Line 3\nThe bulk load failed. The column is too long in the data file for row 1, column 14. Verify that the field terminator and row terminator are specified correctly.</pre>\n\n<p>If I changes the <code>rowterminator = '\\n'</code> <strong>it comes through</strong>, but I am missing the identity.</p>\n\n<p>If I then incl the identity the error becomes:</p>\n\n<pre>Msg 4864, Level 16, State 1, Line 3\nBulk load data conversion error (type mismatch or invalid character for the specified codepage) for row 1, column 15 (iRowNumber).</pre>\n\n<p>When I'm testing I'm excluding the <code>INSERT INTO dbo.\"the-real-datatable\"</code> and just doing the <code>SELECT FROM BudgetImport</code> alone. Hence I avoid inserting another 16000 rows into the real-datatable.</p>\n\n<p>If you pay attention and know the hungarian notation, you will notice I am using varchars even though datatime or decimal might be the correct form. I am doing this after about 4-6 hours testing and endless supply of headaches and torn hair. Varchar is the KISS solution, I do a <code>CONVERT()</code> later.</p>\n\n<p>My whole problem resolves around the last field in the row.\n- I've tried adding 1 and 2 ; after the decNormHours, I've tried adding empty values (; ; or ;1; or ;n;).\n- I've tried with a formatfile.xml - again no cake. I had more success without a formatfile than with it.\n- I've tried changing to UK number notation , to . = more success with the DK notation.\n- I have tried every single trick I can come up with to no avail.</p>\n\n<p>Yes there is no identity field in the CSV, that is ok. You just use the default auto <code>identity(500000,1)</code> I have described in the table creation. Oh the 500000 is an approx row id I've reached now, it will increase over time.</p>\n\n<p>Please, what need I try next to make this good?</p>\n\n<p>EDIT:<br>\nUsing the format file    </p>\n\n<pre>\n$lt;? xml version=\"1.0 \" ? $gt;\n$lt;BCPFORMAT xmlns=\"http://schemas.microsoft.com/sqlserver/2004/bulkload/format\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"$gt;\n $lt;RECORD$gt;\n  FIELD ID=\"1\" xsi:type=\"NCharTerm\" TERMINATOR=\";\" COLLATION=\"SQL_Latin1_General_CP1_CI_AS\"/\n  FIELD ID=\"2\" xsi:type=\"CharFixed\" LENGTH=\"9\" COLLATION=\"SQL_Latin1_General_CP1_CI_AS\"/\n  FIELD ID=\"3\" xsi:type=\"CharFixed\" LENGTH=\"9\" COLLATION=\"SQL_Latin1_General_CP1_CI_AS\"/\n  FIELD ID=\"4\" xsi:type=\"NCharTerm\" TERMINATOR=\";\"/\n  FIELD ID=\"5\" xsi:type=\"NCharTerm\" TERMINATOR=\";\"/\n  FIELD ID=\"6\" xsi:type=\"NCharTerm\" TERMINATOR=\";\" MAX_LENGTH=\"20\" COLLATION=\"SQL_Latin1_General_CP1_CI_AS\"/\n  FIELD ID=\"7\" xsi:type=\"NCharTerm\" TERMINATOR=\";\" MAX_LENGTH=\"20\" COLLATION=\"SQL_Latin1_General_CP1_CI_AS\"/\n  FIELD ID=\"8\" xsi:type=\"NCharTerm\" TERMINATOR=\";\"/\n  FIELD ID=\"9\" xsi:type=\"NCharTerm\" TERMINATOR=\";\"/\n  FIELD ID=\"10\" xsi:type=\"NCharTerm\" TERMINATOR=\";\" MAX_LENGTH=\"20\" COLLATION=\"SQL_Latin1_General_CP1_CI_AS\"/\n  FIELD ID=\"11\" xsi:type=\"NCharTerm\" TERMINATOR=\";\" MAX_LENGTH=\"50\" COLLATION=\"SQL_Latin1_General_CP1_CI_AS\"/\n  FIELD ID=\"12\" xsi:type=\"NCharTerm\" TERMINATOR=\";\" MAX_LENGTH=\"50\" COLLATION=\"SQL_Latin1_General_CP1_CI_AS\"/\n  FIELD ID=\"13\" xsi:type=\"NCharTerm\" TERMINATOR=\";\" MAX_LENGTH=\"20\" COLLATION=\"SQL_Latin1_General_CP1_CI_AS\"/\n  FIELD ID=\"14\" xsi:type=\"NCharTerm\" TERMINATOR=\";\"/\n /RECORD\n ROW\n  COLUMN SOURCE=\"1\" NAME=\"sBudgetName\" xsi:type=\"SQLNVARCHAR\" LENGTH=\"20\" /\n  COLUMN SOURCE=\"2\" NAME=\"dStartDate\" xsi:type=\"SQLDATETIME\"/\n  COLUMN SOURCE=\"3\" NAME=\"dEndDate\" xsi:type=\"SQLDATETIME\"/\n  COLUMN SOURCE=\"4\" NAME=\"prCode\" xsi:type=\"SQLSMALLINT\"/\n  COLUMN SOURCE=\"5\" NAME=\"decTotal\" xsi:type=\"SQLDECIMAL\"/\n  COLUMN SOURCE=\"6\" NAME=\"sRefTimeTypeID\" xsi:type=\"SQLNVARCHAR\" LENGTH=\"10\"/\n  COLUMN SOURCE=\"7\" NAME=\"sRefEmployeeID\" xsi:type=\"SQLNVARCHAR\" LENGTH=\"10\"/\n  COLUMN SOURCE=\"8\" NAME=\"decHours\" xsi:type=\"SQLDECIMAL\"/\n  COLUMN SOURCE=\"9\" NAME=\"decRate\" xsi:type=\"SQLDECIMAL\"/\n  COLUMN SOURCE=\"10\" NAME=\"sDepartmentID\" xsi:type=\"SQLNVARCHAR\" LENGTH=\"10\"/\n  COLUMN SOURCE=\"11\" NAME=\"Centre\" xsi:type=\"SQLNVARCHAR\" LENGTH=\"10\"/\n  COLUMN SOURCE=\"12\" NAME=\"Purpose\" xsi:type=\"SQLNVARCHAR\" LENGTH=\"10\"/\n  COLUMN SOURCE=\"13\" NAME=\"sRefProjectID\" xsi:type=\"SQLNVARCHAR\" LENGTH=\"10\"/\n  COLUMN SOURCE=\"14\" NAME=\"decNormHours\" xsi:type=\"SQLDECIMAL\"/\n/ROW\n</pre>\n\n<p>Puts me back at making the first field work out right. So from fighting getting the final detail right, I end up at fighting for making it work in the first place / at doing anything at all.\nError:</p>\n\n<pre>\nMsg 4863, Level 16, State 1, Line 3\nBulk load data conversion error (truncation) for row 1, column 1 (sBudgetName).\n</pre>\n\n<p>note: hmm seems SO doesn't like xml. How odd.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":77,"score":2,"question_id":13069649,"title":"Select 50 random files per day","body":"<p>I am trying to select 50 random files per day since October 1st, 2012.\nFor example: </p>\n\n<ul>\n<li>October 1st = 50 files</li>\n<li>October 2nd = 50 files</li>\n<li>October 3rd = 50 files</li>\n<li>Etc.....today</li>\n</ul>\n\n<p>So far I can select 1 file per day, but I need 50. And I needed them to be random</p>\n\n<pre><code>DECLARE @DaysBack AS INT\nSET @DaysBack = -25\n\n\n    SET NOCOUNT ON;\n\n    SELECT FileDate, MAX(FileName)  FROM (\n    SELECT \n    CONVERT(VARCHAR(10),DATEADD(second,actiondate, CAST('1970-01-01 00:00:00' AS datetime)), 101) AS FileDate\n\n    ,'\\\\directory\\' + filename AS FileName\n    FROM   Tableq q\n    JOIN tablec c\n    on  q.projectid = c.projectid\n           AND actiondate &gt;= Datediff(s, '19700101 00:00:00:000',\n                             Dateadd(DAY, @DaysBack, Getutcdate()))\n\n\n    ) x\n\n    GROUP BY FileDate\n    ORDER  BY FileDate \n</code></pre>\n"},{"tags":["sql-server","ado.net","sybase","sqlanywhere"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13070066,"title":"how to connect to Sybase anywhere server remotely using adonet","body":"<p>i have an application using a sybase database server 6.0\ni have the server name, database name, username, password.\ni'm using visual studio 2010 always ms sql server or access mdb files\ni'm supposed to create a report from some tables in the database</p>\n\n<p>i have some solutions</p>\n\n<p>1- to connect directly to sybase and collect my data but i don't know the way and how to get the data provider?? please if anyone know tell me.</p>\n\n<p>2- to move the data to another database on ms sql server. but can i import database directly to ms sql server from sybase??</p>\n\n<p>i have downloaded the sybase anywhere developer edition SA12  just in case i needed it , i also want to know the limitations of developer editionn</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":43,"score":-6,"question_id":13058057,"title":"SQL Query Issue, filtering rows based on result","body":"<p>I Have following result set from a query</p>\n\n<pre>\n\nTeam    User  \nPBC     BEI02 \nZTeam   BEI02 \nPBC     HPP02 \n\n</pre>\n\n<p>I need to extend the query so that outputs user <b>HPP02 only</b>.  Anyone that belong to ZTeam shouldn't be listed.  </p>\n\n<p>I guess, my issue is there are 1000's of records.  HPP02 is one of the results there are many users like HPP02, need to list them all.  Can't use where user = 'HPP02'.</p>\n\n<p>Any idea how this can be achieved.</p>\n\n<p>Thanks :)</p>\n"},{"tags":["sql","sql-server","database"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":2,"view_count":107,"score":0,"question_id":13060046,"title":"Updating a large table and minimizing user impact","body":"<p>I have a question on general database/sql server designing:</p>\n\n<p>There is a table with 3 million rows that is being accessed 24x7. I need to update all the records in the table. Can you give me some methods to do this so that the user impact is minimized while I update my table?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","linux","ubuntu-10.04","freetds"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":13066716,"title":"freeTDS not using its config","body":"<p>I've decided to use FreeTDS driver and unixODBC to manage the PDO connection between my LAMP-based app with a remote MsSQL database.\nunfortunately it appears that the driver doesn't read the freetds.conf file, nor the environmental variables set either directly via server's CLI or specified in php file by putenv() function.</p>\n\n<p>now some data:</p>\n\n<ol>\n<li>as I ping the server - no packets are lost.</li>\n<li>as I telnet the server on 1433 port - the connection is established</li>\n<li><p>as I use the command </p>\n\n<pre><code>TDSVER=7.0 tsql -H &gt;IP&lt; -p 1433 -U username\n</code></pre>\n\n<p>I am prompted to enter password and connection is established.</p></li>\n<li><p>without the TDSVER preceding the command - the connection fails with such a message:</p>\n\n<pre><code>Error 20017 (severity 9):\n    Unexpected EOF from the server\n    OS error 115, \"Operation now in progress\"\nError 20002 (severity 9):\n    Adaptive Server connection failed\nThere was a problem connecting to the server\n</code></pre></li>\n<li><p>the tsql -C commands echos such an output:</p>\n\n<pre><code>Compile-time settings (established with the \"configure\" script)\n                       Version: freetds v0.91\n        freetds.conf directory: /usr/local/etc\nMS db-lib source compatibility: yes\n   Sybase binary compatibility: no\n                 Thread safety: yes\n                 iconv library: yes\n                   TDS version: 5.0\n                         iODBC: no\n                      unixodbc: yes\n         SSPI \"trusted\" logins: no\n                      Kerberos: no\n</code></pre></li>\n<li><p>freetds.conf in the location given above has this entry:</p>\n\n<pre><code>[MSSQL]\nhost = &gt;IP&lt;\nport = 1433\ntds version = 7.0\n</code></pre></li>\n<li><p>the ISQL also fails:</p>\n\n<pre><code>isql -v MSSQL\n[S1000][unixODBC][FreeTDS][SQL Server]Unable to connect to data source\n[01000][unixODBC][FreeTDS][SQL Server]Adaptive Server connection failed\n[ISQL]ERROR: Could not SQLConnect\n</code></pre></li>\n<li><p>my odbc.ini :</p>\n\n<pre><code>[MSSQL]\nDescription = MS SQL Server\nDriver = FreeTDS\nTDS_Version = 7.0\nServer = 10.2.201.2\nUID = sa\nPWD = okes\nReadOnly = No\nPort = 1433\n</code></pre></li>\n</ol>\n\n<p>I suppose the solution is really simple, but i'm just too stupid to find it...</p>\n"},{"tags":["sql","sql-server","query","backup"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13069025,"title":"SQL backup loop","body":"<p>I've built a backup query in SSMSE 2005 and saved as a text query.</p>\n\n<p>Is there a way to loop through DB and write each as a unique file?</p>\n\n<p>What I've done is copy/paste and find/replace database_name and run both in a single pass.  That works, but would like either:</p>\n\n<p>Run a single loop script which backs up each DB individually OR \nBatch backup from the SSMSE GUI</p>\n\n<pre><code>BACKUP DATABASE [ION_Data_Nov08] TO DISK =\nN'C:\\Documents and Settings\\DB.control\\Desktop\\ION Database Backups\\121025_0700\\ION_Data_Nov08'\nWITH noformat, init, name = N'ION_Data_Nov08-Full Database Backup', skip,\nnorewind, nounload, stats = 10 \n\ngo\n\nDECLARE @backupSetId AS INT \n\nSELECT @backupSetId = position\nFROM   msdb..backupset\nWHERE  database_name = N'ION_Data_Nov08' \n        AND backup_set_id = (SELECT Max(backup_set_id)\n                             FROM   msdb..backupset\n                            WHERE  database_name = N'ION_Data_Nov08')\n\n IF @backupSetId IS NULL\n   BEGIN\n       RAISERROR(\nN'Verify failed. Backup information for database ''ION_Data_Nov08'' not found.',\n 16,1)\nEND\n\n RESTORE verifyonly FROM DISK =\n  N'C:\\Documents and Settings\\DB.control\\Desktop\\ION Database Backups\\121025_0700\\ION_Data_Nov08'\n WITH FILE = @backupSetId, nounload, norewind\n\ngo\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13067276,"title":"Databases are not getting displayed in SSMS","body":"<p>I'm using SQL Server 2012 and I'm stuck with a strange problem. </p>\n\n<p>I tried to restore a database snapshot to a database. Usually it doesn't take much time to restore, but now it took 5 minutes and is still restoring, so I stopped query execution. It was trying to stop the query execution for more that 5 minutes, so i closed SSMS using task manager.</p>\n\n<p>Then I tried to kill the restore process using <code>KILL</code>.</p>\n\n<p><img src=\"http://i.stack.imgur.com/bX7Rs.png\" alt=\"enter image description here\"></p>\n\n<p>Now I am able to can connect to that server, but the list of databases is not opening. I mean: whoever is connected to this server, they are not able to get the databases. When I checked the <code>sysprocesses</code> table, it is showing <code>lastwaittype</code> as <code>LCK_M_S</code>.</p>\n\n<p>None of my users can see databases. Looks like I kind of messed up. I cannot restart SQL Server as others are connected to the server.</p>\n\n<p>How do I solve this? Please help.</p>\n\n<p><strong>EDIT:</strong>\ni tried <a href=\"http://blog.sqlauthority.com/2011/02/15/sql-server-lck_m_xxx-wait-type-day-15-of-28/\" rel=\"nofollow\">this approach</a> and when i checked with</p>\n\n<pre><code>select db_name(dbid), * from sysprocesses where blocked &lt;&gt; 0\n</code></pre>\n\n<p>i got two records,</p>\n\n<p><img src=\"http://i.stack.imgur.com/vbZBw.png\" alt=\"enter image description here\"></p>\n\n<p>do you think because of these two rest of the process are getting locked up.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":13069084,"title":"How to configure alert and kill longrunning queries in SQL Profiler","body":"<p>is there anyway i can configure alert and kill long running queries using SQL Profiler or someithing in Management Studios ? </p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13068329,"title":"Need help in stored procedure for select query","body":"<p>I am trying to fetch data on the basis of first name and last name. I have two DB replica of one another except for few extra data in one DB. Below is the stored procedure for the same. The problem is that I want data fetched first part of the(ie is if I search for ar it should show names starting with ar like arron but not in the middle like Sharon). The query is working fine with one db &amp; not with the other one.</p>\n\n<pre><code>   ALTER PROCEDURE [dbo].[SEARCH]\n(\n@firstName nvarchar(50),\n@lastName nvarchar(50),\n@state nvarchar(50),\n@county nvarchar(50),\n@searchspan nvarchar(5)\n)\nAS\n\nBEGIN \ndeclare @queryString nvarchar(max)\ndeclare @countyId nvarchar(50)\nSET QUOTED_IDENTIFIER OFF \n\nCreate table #temp1(\ncounty nvarchar(50) NULL,\nID nvarchar(50) NULL,\nname nvarchar(200) NULL,\nstate nvarchar(50) NULL,\nFirstName nvarchar(50) NULL,\nLastName nvarchar(50) NULL,\ncounty nvarchar(50) NULL,\n)\nset @queryString = 'insert into #temp1 select  distinct a.Source as county, a.ID as ID, a.FirstName +'' ''+ a.LastName as name, ''' +\n @state +''' as state,a.FirstName,a.LastName,b.county, from Person a, CountySite b where 1=1 and a.Source=b.sourcecounty '\n\n if(@searchspan&lt;&gt;'')\n BEGIN\n set @queryString = @queryString  = 1'\n END\n  EXECUTE  sp_executesql  @queryString\n  set @queryString ='select county, ID, name, state,col_FirstName,col_LastName,col_county, from #temp1 where 1=1 '\n if(@firstName &lt;&gt; '')\nBEGIN \n set @queryString = @queryString+ ' and UPPER(col_FirstName) like ''' +@firstName +'%'''\nEND\nif(@lastName &lt;&gt; '')\nBEGIN \n set @queryString = @queryString + ' and UPPER(col_LastName) like ''' +@lastName +'%'''\ndrop table #temp1\nEND\n</code></pre>\n"},{"tags":["sql","sql-server","join"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":55,"score":0,"question_id":13067646,"title":"SQL join one column with another table column","body":"<p>I am creating a table and i have a field like NAME and i want to join this NAME with another table column name how can i do it??</p>\n\n<pre><code> create table History_Table\n(\n  TempID int FOREIGN KEY REFERENCES SV_templates(TemplateID),\n  Name varchar(50) ????\n  RunDate datetime,\n  RunBy varchar(50)\n)\n</code></pre>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13068001,"title":"update each row with different values in temp table","body":"<p>I have a column that I need to update with codes in a temp table.There is +/- 5 codes in the temp table. Each row in the table must be updated with one of the values in the temp table.</p>\n\n<pre><code>Example\nid  code\n1   200\n2   400\n3   600\n4   9000\n5   800\n6   200\n7   400\n8   600\n9   9000\n10  800\n</code></pre>\n"},{"tags":[".net","sql-server","vb.net","dataset"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13068499,"title":"Dynamic SQL statement will not update in dataset designer","body":"<p>I have a legacy .Net3.0 system that uses datasets to transfer the data from the server to the client which I need to make a change to. This source Stored Procedure has a static return schema but the WHERE clause is created dynamically before execution with <code>sp_executesql</code>.</p>\n\n<p>This query executes fine when I run the Stored Prodedure from Enterprise Manager returning the data as expected but when I try to update the dataset CommandText I get an error as below.</p>\n\n<p>Is there a limit on the size of the Stored Procedure that can be executed from the dataset designer? Are there any limitations in the code generation for the dataset? Are there anyways to find out further information why the dataset designer is having issues?</p>\n\n<p><strong>SQL Server 2005 Stored Procedure</strong></p>\n\n<pre><code>USE [JCB_QSmart]\nGO\n/****** Object:  StoredProcedure [dbo].[spQSmartRawFailureDataV4]    Script Date: 10/25/2012 10:42:54 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n-- =============================================\n-- Author:      &lt;Phil Murray&gt;\n-- Create date: &lt;24/11/2011&gt;\n-- Description: &lt;Filters the QSmart Fault by criteria&gt;\n-- =============================================\nALTER PROCEDURE [dbo].[spQSmartRawFailureDataV5]\n    @BUIDs as nvarchar(255)=NULL,\n    @ModelCats as nvarchar(255)=NULL,\n    @Models as nvarchar(255)=NULL,\n    @BuildNumbers as nvarchar(255)=NULL,\n    @SerialNumbers as nvarchar(255)=NULL,\n    @ProdLines as nvarchar(255)=NULL,\n    @Zones as nvarchar(255)=NULL,\n    @ZoneTypes as nvarchar(255)=NULL,\n    @MajorAssemblies as nvarchar(255)=NULL,\n    @SubAssemblies as nvarchar(255)=NULL,\n    @ComponentAssemblies as nvarchar(255)=NULL,\n    @UserDefinedTests as nvarchar(255)=NULL,\n    @Faults as nvarchar(255)=NULL,\n    @FaultCodes as nvarchar(255)=NULL,\n    @FaultCodeDetails as nvarchar(255)=NULL,\n    @FaultAreas as nvarchar(255)=NULL,\n    @FoundBy as nvarchar(255)=NULL,\n    @FixedBy as nvarchar(255)=NULL,\n    @DateFrom as smalldatetime,\n    @DateTo as smalldatetime,\n    @PartNo as nvarchar(255)=NULL,\n    @TypeOfFault as tinyint = 0,\n    @FaultRectificationID as nvarchar(255)=NULL \nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    DECLARE @SQL nvarchar(MAX)\n    DECLARE @SQLWhere nvarchar(MAX) \n    DECLARE @ShowAdhocOnly as bit\n\n    SET @ShowAdhocOnly = 0\n\n    SET @SQL = 'SELECT vwBusinessUnit.Name AS [Business Unit], vwModelCategories.Description AS [Model Category], \n                    vwModels.Description AS Model, vwBuilds.BuildNo AS [Build Number], vwBuilds.SerialNumber AS [Serial Number], \n                    vwProductionLine.Description AS [Production Line], tblZone.Description AS Zone, tblZoneType.Description AS [Zone Type], \n                    tblMachineMajorAssembly.Description AS [Major Assembly], tblMachineSubAssembly.Description AS [Sub Assembly], \n                    tblMachineSubComponentAssembly.Description AS [Component Sub Assembly], tblMachineUserDefined.Description AS [User Defined Test], \n                    tblFault.Description AS Fault, tblFaultsCodes.Description AS [Fault Code], tblFaultsCodesDetail.Description AS [Fault Code Detail], \n                    tblFaultArea.Description AS [Fault Area], vwUsers.DisplayName AS [Created By], vwUsers_1.DisplayName AS [Fixed By], \n                    tblInspectionFailures.Comment, tblInspectionFailures.ShortagePart, tblFaultCode_AuditScores.Description AS [Audit Score], \n                    tblInspection.UpdatedDate AS [Created Date],tblInspectionFailures.FixedByComment AS [Fixed By Comment],tblFaultRectification.Description AS [Fault Rectification]\n                    FROM vwBuilds INNER JOIN vwModelCategories \n                                    INNER JOIN vwBusinessUnit ON vwModelCategories.BUID = vwBusinessUnit.ID \n                                    INNER JOIN vwModels ON vwModelCategories.ID = vwModels.ModelCategoryID ON vwBuilds.ModelID = vwModels.ID \n                                    INNER JOIN tblInspection ON vwBuilds.ID = tblInspection.BuildID \n                                    INNER JOIN tblZone ON tblInspection.ZoneID = tblZone.ID \n                                    INNER JOIN vwProductionLine ON tblZone.ProductionLineID = vwProductionLine.ID \n                                    INNER JOIN tblZoneType ON tblZone.ZoneTypeID = tblZoneType.ID \n                                    INNER JOIN tblInspectionFailures ON tblInspection.ID = tblInspectionFailures.InspectionID \n                                    INNER JOIN tblMachineUserDefined ON tblInspectionFailures.MachineUserDefinedID = tblMachineUserDefined.ID \n                                    INNER JOIN tblMachineSubComponentAssembly ON tblMachineUserDefined.ComponentAssemblyID = tblMachineSubComponentAssembly.ID \n                                    INNER JOIN tblMachineSubAssembly ON tblMachineSubComponentAssembly.MachineSubAssemblyID = tblMachineSubAssembly.ID \n                                    INNER JOIN tblMachineMajorAssembly ON tblMachineSubAssembly.MajorAssemblyID = tblMachineMajorAssembly.ID \n                                    INNER JOIN tblFault ON tblInspectionFailures.FaultID = tblFault.ID \n                                    INNER JOIN tblFaultsCodes ON tblInspectionFailures.FaultCodeID = tblFaultsCodes.ID \n                                    INNER JOIN tblFaultArea ON tblInspectionFailures.FaultAreaID = tblFaultArea.ID \n                                    INNER JOIN vwUsers ON tblInspectionFailures.CreatedBy = vwUsers.ID \n                                    LEFT OUTER JOIN tblFaultCode_AuditScores ON tblInspectionFailures.AuditScoreID = tblFaultCode_AuditScores.ID \n                                    LEFT OUTER JOIN tblFaultsCodesDetail ON tblInspectionFailures.FaultCodeDetailID = tblFaultsCodesDetail.ID \n                                    LEFT OUTER JOIN vwUsers AS vwUsers_1 ON tblInspectionFailures.FixedBy = vwUsers_1.ID\n                                    LEFT OUTER JOIN tblFaultRectification ON tblInspectionFailures.FixedByFaultRectificationID = tblFaultRectification.ID'\n    SET @SQLWhere = ' WHERE ((tblInspection.CompletedDate BETWEEN @_DateFrom AND @_DateTo) AND '\n\n    IF LEN(@BUIDs) &gt; 0 AND NOT @BUIDs = '27'\n        SET @SQLWhere = @SQLWhere + 'vwBusinessUnit.ID IN (SELECT value FROM dbo.Split(''' + ',' + ''',@_BUIDs)) AND '\n    IF @ProdLines IS NOT NULL AND LEN(@ProdLines) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'vwProductionLine.ID IN (SELECT value FROM Split(''' + ',' + ''',@_ProdLines)) AND '\n    IF @ModelCats IS NOT NULL AND LEN(@ModelCats) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'vwModelCategories.ID IN (SELECT value FROM Split(''' + ',' + ''',@_ModelCats)) AND '\n    IF @Models IS NOT NULL AND LEN(@Models) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'vwModels.ID IN (SELECT value FROM Split(''' + ',' + ''',@_Models)) AND '\n    IF @Zones IS NOT NULL AND LEN(@Zones) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'tblZone.ID IN (SELECT value FROM Split(''' + ',' + ''',@_Zones)) AND '\n    IF @ZoneTypes IS NOT NULL AND LEN(@ZoneTypes) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'tblZoneType.ID IN (SELECT value FROM Split(''' + ',' + ''',@_ZoneTypes)) AND '\n    IF @MajorAssemblies IS NOT NULL AND LEN(@MajorAssemblies) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'tblMachineMajorAssembly.ID IN (SELECT value FROM Split(''' + ',' + ''',@_MajorAssemblies)) AND '\n    IF @SubAssemblies IS NOT NULL AND LEN(@SubAssemblies) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'tblMachineSubAssembly.ID IN (SELECT value FROM Split(''' + ',' + ''',@_SubAssemblies)) AND '\n    IF @ComponentAssemblies IS NOT NULL AND LEN(@ComponentAssemblies) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'tblMachineSubComponentAssembly.ID IN (SELECT value FROM Split(''' + ',' + ''',@_ComponentAssemblies)) AND '\n    IF @UserDefinedTests IS NOT NULL AND LEN(@UserDefinedTests) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'tblMachineUserDefined.ID IN (SELECT value FROM Split(''' + ',' + ''',@_UserDefinedTests)) AND '\n    IF @Faults IS NOT NULL AND LEN(@Faults) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'tblFault.ID IN (SELECT value FROM Split(''' + ',' + ''',@_Faults)) AND '\n    IF @FaultCodes IS NOT NULL AND LEN(@FaultCodes) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'tblFaultsCodes.ID IN (SELECT value FROM Split(''' + ',' + ''',@_FaultCodes)) AND '\n    IF @FaultCodeDetails IS NOT NULL AND LEN(@FaultCodeDetails) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'tblFaultsCodesDetail.ID IN (SELECT value FROM Split(''' + ',' + ''',@_FaultCodeDetails)) AND '\n    IF @FaultAreas IS NOT NULL AND LEN(@FaultAreas) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'tblFaultArea.ID IN (SELECT value FROM Split(''' + ',' + ''',@_FaultAreas)) AND '\n    IF @FoundBy IS NOT NULL AND LEN(@FoundBy) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'vwUsers.ID IN (SELECT value FROM Split(''' + ',' + ''',@_FoundBy)) AND '\n    IF @FixedBy IS NOT NULL AND LEN(@FixedBy) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'vwUsers_1.ID IN (SELECT value FROM Split(''' + ',' + ''',@_FixedBy)) AND '\n    IF @PartNo IS NOT NULL AND LEN(@PartNo) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'tblInspectionFailures.ShortagePart IN (SELECT value FROM Split(''' + ',' + ''',@_PartNo) AND '\n    IF @TypeOfFault &lt;&gt; 2\n        BEGIN\n            SET @SQLWhere = @SQLWhere + 'tblInspectionFailures.IsAdhocTest = @_TypeOfFault AND '    \n            SET @ShowAdhocOnly = @TypeOfFault\n        END\n    IF @FaultRectificationID IS NOT NULL AND LEN(@FaultRectificationID) &gt; 0\n        SET @SQLWhere = @SQLWhere + 'tblInspectionFailures.FixedByFaultRectificationID IN (SELECT value FROM Split(''' + ',' + ''',@_FaultRectificationID)) AND '       \n\n    IF LEN(@SQLWhere) &gt; 0\n        SET @SQL = @SQL + LEFT(@SQLWhere, LEN(@SQLWhere)-4) + ')' \n\n    EXEC sp_executesql @SQL,\n        N'@_BUIDs nvarchar(255), @_ProdLines nvarchar(255), @_ModelCats nvarchar(255), @_Models nvarchar(255), @_Zones nvarchar(255), \n            @_ZoneTypes nvarchar(255), @_MajorAssemblies nvarchar(255), @_SubAssemblies nvarchar(255), @_ComponentAssemblies nvarchar(255), \n            @_UserDefinedTests nvarchar(255), @_Faults nvarchar(255), @_FaultCodes nvarchar(255), @_FaultCodeDetails nvarchar(255), \n            @_FaultAreas nvarchar(255), @_FoundBy nvarchar(255), @_FixedBy nvarchar(255), @_PartNo nvarchar(255),\n            @_DateFrom smalldatetime, @_DateTo smalldatetime, @_TypeOfFault bit, @_FaultRectificationID nvarchar(255)',\n        @_BUIDs = @BUIDs, @_ProdLines = @ProdLines, @_ModelCats = @ModelCats, @_Models = @Models, @_Zones = @Zones,\n            @_ZoneTypes = @ZoneTypes, @_MajorAssemblies = @MajorAssemblies, @_SubAssemblies = @SubAssemblies, @_ComponentAssemblies = @ComponentAssemblies, \n            @_UserDefinedTests = @UserDefinedTests, @_Faults = @Faults, @_FaultCodes = @FaultCodes, @_FaultCodeDetails = @FaultCodeDetails, \n            @_FaultAreas = @FaultAreas, @_FoundBy = @FoundBy, @_FixedBy = @FixedBy, @_PartNo = @PartNo,\n            @_DateFrom = @DateFrom, @_DateTo = @DateTo, @_TypeOfFault = @ShowAdhocOnly, @_FaultRectificationID = @FaultRectificationID\n\nEND\n</code></pre>\n\n<p><strong>Dataset Error</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/2O2ig.png\" alt=\"enter image description here\"></p>\n"},{"tags":["c#","asp.net","sql-server","database-design","aspmenu-control"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":293,"score":6,"question_id":12912342,"title":"Database design for Magazine website with flexible horizontal menus","body":"<p>I need to design a CMS based website using asp.net web form (c#) and MS SQL Server as backend database for a magazine website which will have monthly issue.</p>\n\n<p>I am finding it hard to design a database that can help me fetch menus from different table for example as show in image below\n<img src=\"http://i.stack.imgur.com/PjYvv.png\" alt=\"enter image description here\"></p>\n\n<p>Example of Database <img src=\"http://i.stack.imgur.com/PMOdp.png\" alt=\"enter image description here\"></p>\n\n<p>Sample Data</p>\n\n<pre><code>MagazinePages Table\nPageID  PageName    LangID  PagePositionNo  PageURL     PageInheritance //PageID \n1           Home        1         10        Default.aspx    0\n2           About Us    1         20        Page.aspx       0\n3           PageOne     1         10        Page.aspx       2\n4           PageTwo     1         20        Page.aspx       2\n5           Multimedia  1         30        Page.aspx       0\n6           Video       1         10        Videos.aspx     5\n7           PhotoGallery 1        20        Gallery.aspx    5\n8           News        1         40        News.aspx        0\n9           Issues      1         50        #               0\n10          Publication 1         60        Page.aspx       0\n11          SpanishHome 2         10        Default.aspx        0\n12          SpanisAboutUs 2       20        Page.aspx   0\n------------------------------------------------------------------------------\nMagazine\nMagazineID  MagazineIssueCode   LangID  MagazineTitle   MagazineLiveIssue(CurrentIssue)\n1       101         1   Mag Title       0\n2       102         1   Mag Title       1\n3       101         2   SpanisgMag Title    0\n4       102         2   Mag Title       1\n------------------------------------------------------------------------------\n\nNews Table\nNewsID  NewsTitle   NewsCatID   MagazineID  Language    \n1   News one    100     1       1\n2   News two    100     1       1\n3   news three  200     1       1\n4   News four   300     1       1\n5   News Five   100     2       1\n6   News Six    300     2       1\n7   News seven  200     2       2\n------------------------------------------------------------------------------\n</code></pre>\n\n<p>Problem with above approach is that I can create sub menus only if all the records are in <strong>MagazinePages</strong> based on above example I can create sub menus for  About Us &amp; Multimedia how can i design my database so that i can pull data from different table such as <strong>news</strong> by category (Politics, Culture...) &amp; Issue from <strong>Magazine</strong> Table (Issue 101, Issue 102, Issue 103....)</p>\n\n<p>I am planning to use ASP Menu control for this which may not be very flexible, since i will have over 100 issue of magazine how or which multi column menu i can use with asp.net </p>\n\n<p>My database may have many flows, I would appreciate help in this regard so that i can use this database for this CMS system . Please feel free to ask question if any regarding this.</p>\n\n<p><strong>Added</strong>:\nIf i need to pull all the menu name from <code>MagazinePages</code> Table then it is easy but i have been asked to have a menu structure as shown in the example. Problem with this is i can generate menus for <code>AboutUs</code> &amp; <code>Multimedia</code> from <code>MagazinePages</code> Table but i dont have any pages like Politics, Economic, ... Issue 101, 102, 103.. in this Table as that information is stored in different table like <code>News Category</code> in News Table &amp; Issue in <code>Magazine</code> table.  I would rather change my table design &amp; make it flexible to read menu information from separate table but i am not sure how</p>\n\n<p><strong>Schema Updated</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/mvbwq.png\" alt=\"enter image description here\"></p>\n\n<p>News Table is not show in this Schema.</p>\n\n<p>What i have done is that i have created ps_Pages Table for CMS Pages like, Home, Aboutus, Contact, MediaCentre .....</p>\n\n<p>I store Pages related to Magazine (Which actually are article with different category or tags like culture, politics, sports, people ...) in <code>art_Article</code> table</p>\n"},{"tags":["c#","sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13067018,"title":"Comparing date range quarters sql server","body":"<p>I have a policies in a system</p>\n\n<pre><code>PolRef       Start            End\nPOL123     22/11/2012      23/12/2014\nPOL212     24/09/2012      23/10/2012\nPOL214     23/08/2012      29/09/2012\n</code></pre>\n\n<p>I am asking a user for a reporting date, the user enters 24/10/2012 this becomes <code>@StartDate</code></p>\n\n<p>From this I derive what the quarter is by the month:</p>\n\n<pre><code>set @currentMonth = Month(@StartDate)\n\nif @currentMonth = 1 or @currentMonth = 2 or @currentMonth = 3 begin set @startmonth = 1 set @endmonth = 3 end\n\nif @currentMonth = 4 or @currentMonth = 5 or @currentMonth = 6 begin set @startmonth = 4 set @endmonth = 6 end\n\nif @currentMonth = 7 or @currentMonth = 8 or @currentMonth = 9 begin set @startmonth = 7 set @endmonth = 9 end\n\nif @currentMonth = 10 or @currentMonth = 11 or @currentMonth = 12 begin set @startmonth = 10 set @endmonth = 12 end\n</code></pre>\n\n<p>I then get a date range:</p>\n\n<pre><code>@quarterStartDate = CAST(CAST(YEAR(@StartDate) AS varchar) + '-' + CAST(@startMonth AS varchar) + '-' + '01') AS Date)\n\n@quarterEndDate = CAST(CAST(YEAR(@EcdDate) AS varchar) + '-' + CAST(@endMonth AS varchar) + '-' + '31') AS Date)\n</code></pre>\n\n<p>This will give me 01-10-2012 and 31-12-2012. Basically I need a script to only bring back the policies that are in this quarter. The policy doesn't have to span the entire quarter date range, just exist in the quarter date range.</p>\n\n<p>The results expected would be </p>\n\n<pre><code>PolRef       Start            End\nPOL123     22/11/2012      23/12/2014\nPOL212     24/09/2012      23/10/2012\n</code></pre>\n\n<p>Pol123 appears because it spans over the quarterly date range. Pol212 is there because it expires in that quarter date range. Pol214 does not appear because it neither spans, expires or starts in this quarter.</p>\n\n<p>Any help would be greatly appreciated</p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":42,"score":-1,"question_id":13066802,"title":"Rename a column in each table","body":"<p>I have a DB with 3 tables (<code>Table1</code>, <code>Table2</code> and <code>Table3</code>). The <code>Table1 and 3</code> have a column named \"MyColumn\" how (if possible) rename all \"MyColumn\" to the new name \"MyNewName\" ?</p>\n\n<p>In my project, it's much more table (not only 3)</p>\n\n<p>Thanks,</p>\n"},{"tags":["sql-server","excel","import","sqldatatypes"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13066774,"title":"Import SQL Server data into Excel with user-defined data types","body":"<p>I have a SQL Server and I want to import data from a view into Excel via Microsoft Query. </p>\n\n<p>Sounds easy right? Well it isn't as some of the columns are of a user-defined data type.</p>\n\n<p><strong>tblSeller</strong>:</p>\n\n<ul>\n<li>ID: <code>int</code></li>\n<li>Name: <code>nvarchar(50)</code></li>\n<li>Country: <code>CountryName:nvarchar(50)</code></li>\n</ul>\n\n<p><strong>tblBuyer</strong>:</p>\n\n<ul>\n<li>ID: <code>int</code></li>\n<li>Name: <code>nvarchar(50)</code></li>\n<li>Country: <code>CountryName:nvarchar(50)</code></li>\n</ul>\n\n<p><strong>tblSale</strong>:</p>\n\n<ul>\n<li>ID: <code>int</code></li>\n<li>SellerId: <code>int</code></li>\n<li>BuyerId: <code>int</code></li>\n</ul>\n\n<p><strong>vSales</strong>:</p>\n\n<pre><code>SellerName, SellerCountry, BuyerName, BuyerCountry\n</code></pre>\n\n<p>(I think you get the idea that I have joined <code>tblSale</code> with <code>tblSeller</code> and <code>tblBuyer</code> and want to get names and countries - and since this is just an example I have left out all other stuff which would make it a useful view!!!)</p>\n\n<p>The view <code>vSales</code> works like a charm on my server: It shows me all my information. The problem occurs when I want to import it into Excel 2010 via \"From Microsoft Query\" (Data => From Other Sources => From Microsoft Query). All columns with a user-defined data type are not available!</p>\n\n<p>Only if I import data directly via \"From SQL Server\" (Data => From Other Sources => From SQL Server) I get my data. But as my real view contains hundreds of columns and nearly 200.000 rows that is not and option as I need to specify which columns I want to import.</p>\n\n<p>So to put it short: how to import data from a SQL Server view into Excel using a Microsoft Query in order to be able to limit number of columns?</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":69,"score":3,"question_id":13065519,"title":"SqlException was unhandled by user code","body":"<p>i am working on an airline reservation system everything compiled nicely...a user is supposed to register to the site then check available flights after that the user can book a flight,but i am having problems when it comes to booking a flight the values can not be inserted in the database and there is an error popping up saying</p>\n\n<pre><code>SqlException was unhandled by user code\nViolation of PRIMARY KEY constraint 'PK_Plist'. Cannot insert duplicate key in object 'dbo.Plist'.\nThe statement has been terminated.\n</code></pre>\n\n<p>what is wrong or what am i doing that is not right\n this is my code and an exception is flashing on this code</p>\n\n<p>int i = cmd.ExecuteNonQuery();</p>\n\n<p>the full code </p>\n\n<pre><code>protected void Button1_Click1(object sender, EventArgs e)\n    {\n        SqlConnection con = new SqlConnection(constring);\n        SqlCommand cmd = new SqlCommand();\n        cmd.CommandType = CommandType.Text;\n        cmd.Connection = con;\n        con.Open();\n        cmd.CommandText = \"select flightid from schedule where flightid='\" + DropDownList1.Text + \"' and Flightname='\" + DropDownList2.Text + \"' and Fromstation='\" + DropDownList3.Text + \"' and Tostation='\" + DropDownList4.Text + \"' and dateandtimings='\" + DropDownList6.Text + \"'\";\n        SqlDataAdapter da = new SqlDataAdapter();\n        da.SelectCommand = cmd;\n        DataSet ds = new DataSet();\n        da.Fill(ds, \"emp\");\n        if (ds.Tables[\"emp\"].Rows.Count &gt; 0)\n        {\n\n            cmd.CommandText = \"insert into Plist(Pid,passengername,flightid,Flightname,Fromstation,Tostation,category,Dateandtimings) values('\" + Autonumber() + \"','\" + TextBox1.Text + \"','\" + DropDownList1.Text + \"','\" + DropDownList2.Text + \"','\" + DropDownList3.Text + \"','\" + DropDownList4.Text + \"','\" + DropDownList5.Text + \"','\" + DropDownList6.Text + \"')\";\n            int i = cmd.ExecuteNonQuery();\n            cmd.CommandText = \"update pid set pid='\" + Autonumber() + \"'\";\n            int k = cmd.ExecuteNonQuery();\n            if (DropDownList5.Text == \"Firstclass\")\n            {\n                cmd.CommandText = \"update schedule set Firstclass=Firstclass-1 where flightid='\" + DropDownList1.SelectedValue + \"'\";\n                int j = cmd.ExecuteNonQuery();\n            }\n            else if (DropDownList5.Text == \"Bussinessclass\")\n            {\n                cmd.CommandText = \"update schedule set Bussinessclass=Bussinessclass-1 where flightid='\" + DropDownList1.SelectedValue + \"'\";\n                int j = cmd.ExecuteNonQuery();\n\n\n            }\n            else\n            {\n                cmd.CommandText = \"update schedule set Economicclass=Economicclass-1 where flightid='\" + DropDownList1.SelectedValue + \"'\";\n                int j = cmd.ExecuteNonQuery();\n            }\n            if (i &gt; 0)\n            {\n                Label.Visible = true;\n                Label.Text = \"success\";\n            }\n\n            else\n            {\n                Label.Visible = true;\n                Label.Text = \"error\";\n            }\n\n            Label16.Visible = true;\n            Label16.Text = \"Your Ticket ID is \" + a;\n            con.Close();\n        }\n        else\n        {\n            Label16.Visible = true;\n            Label16.Text = \"There is no flight with these details so please check flight schedule and submit your request\";\n        }\n\n    }\n    protected void SqlDataSource4_Selecting(object sender, SqlDataSourceSelectingEventArgs e)\n    {\n\n    }\n    protected void SqlDataSource5_Selecting(object sender, SqlDataSourceSelectingEventArgs e)\n    {\n\n    }\n}\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008-r2","ssas"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13049922,"title":"SSAS - should I use views or underlying tables?","body":"<p>I have a set of views set up in SQL Server which output exactly the results that I would like to include in a SQL Server Analysis Services cube, including the calculation of a number of dimensions (such as Age using DATEDIFF, business quarter using DATENAME etc.). What I would like to know is whether it makes sense to use these views as the data source for a cube, or whether I should use the underlying tables to reproduce the logic in SSAS. What are the implications of going either route?</p>\n\n<p>My concerns are:  </p>\n\n<ul>\n<li>the datasets are massive, but we need quick access to the results, so I would like to have as much of the calculations that are done in the views persisted within the SSAS data warehouse</li>\n<li>Again, because the datasets are massive I want the recalculation of any cubes to be a fast as possible</li>\n</ul>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13066141,"title":"sql - How to select two different counts from different level of join?","body":"<p>I am not sure the title is correct for my problem and I'd better to give an example.</p>\n\n<p>I have three tables: <code>Publication</code>, <code>Journal</code>, <code>Published</code>. Their columns are like followings:</p>\n\n<pre><code>    **Publication table**\n\n       pub_id,     journal_id\n\n    **Journal table**\n\n       journal_id,   article_id\n\n    **Published table**\n\n       article_id\n</code></pre>\n\n<p>So if I do</p>\n\n<pre><code>    select pub.pub_id, count(j.article_id) \n\n    from publication pub\n\n    inner join journal j on pub.journal_id=j.journal_id\n\n    group by pub.pub_id\n</code></pre>\n\n<p>I get the <code>total number of articles</code> of a journal which need to be published for each <code>pub_id</code>, right?</p>\n\n<p>If I do</p>\n\n<pre><code>    select pub.pub_id, count(p.article_id) \n\n    from publication pub\n\n    inner join journal j on pub.journal_id=j.journal_id\n\n    inner join published p on j.article_id=p.article_id\n\n    group by pub.pub_id\n</code></pre>\n\n<p>I get the <code>total number of published articles</code> of a journal which need to be published for each <code>pub_id</code>, right?</p>\n\n<p>so through the above two queries, I can get <code>the number of articles that need to be published</code> and <code>the number of articles that have been published</code>. </p>\n\n<p>My question is that how to write a single query to get these two numbers at the same time?</p>\n\n<p>I need to show these two number in the same table. </p>\n\n<p>P.S: I am using Microsoft SQL Server</p>\n"},{"tags":["sql-server","schema"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13065884,"title":"Get the table name using schema","body":"<p>I have seen some query like this in a stored procedure </p>\n\n<pre><code>SELECT ORDINAL_POSITION 'column_id', column_name 'column_name', \n         column_name + ' : ' + data_type 'column_nametype',\n         data_type 'data_type',\n         CHARacter_maximum_length 'SIZE'\n     FROM information_schema.columns\n     WHERE table_name = @TableName\n</code></pre>\n\n<p>but i found that information_schema.columns is not a table name and it is a schema, but how it is retrieving the data?? and how can i know the actual table name?What is the use of a schema??</p>\n"},{"tags":["sql-server","tsql","search"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":242,"score":1,"question_id":11335879,"title":"Change stored procedure based on input parameters","body":"<p>I'm writing an 'advanced search' page for a web application. It basically has a form that goes:</p>\n\n<blockquote>\n  <p>Search for <strong>query</strong> in the forum <strong>forum name</strong> posted by\n  <strong>username</strong> in the last <strong>date</strong></p>\n</blockquote>\n\n<p>The idea is that users can leave fields blank if they wish and the search won't include it.</p>\n\n<p>I'd rather not write a stored procedure for searching based on every possible combination of leaving values blank. Is there a way I can write a stored procedure so that the search changes based on which parameters passed in are blank?</p>\n\n<p>Something like (pseudo code)</p>\n\n<pre><code>SELECT * FROM Table WHERE Message = @query\n\n(if @username isn't null)\nAND Username = @Username\n\n(if @forum isn't null)\nAND Forum = @forum\n</code></pre>\n\n<p>..and so on.</p>\n\n<p>Thanks for any help you can provide!</p>\n"},{"tags":["sql","sql-server","temporary-tables","tempdb"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1763,"score":1,"question_id":6623846,"title":"Why are temporary tables not removed from tempdb in SQL Server?","body":"<p>I have created one stored procedure with 7 temporary tables and each temp table is dropped at the end of their own work.</p>\n\n<p>I am calling the SP from one web service and same web service we are used for different instance. </p>\n\n<p>I have dropped every temp table forcefully but when SP executes it will not delete any of the temporary table which are located in \"tempdb/Temporary Table\". And, when I open new instance of my application and try to execute same SP it will modify same temp tables. </p>\n\n<p>This creates problem for me. it will lock the tables when SP execute simultaneously it will lock the table and my sp is not able to produce result and throw exception.</p>\n\n<p>So I want to drop my temporary tables at the end of my operation. please help.</p>\n"},{"tags":["sql","sql-server","ssis"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13064867,"title":"Logging of incorrect rown in MS Integration Services","body":"<p>I newbie in Microsoft intergration services and i have a problem:</p>\n\n<p>Data loaded from file looks like this:</p>\n\n<pre><code>1 'a' 'b'\n2 'a' 'b'\n1 'c' 'd'\n</code></pre>\n\n<p>And this rows would be loaded in table like this:</p>\n\n<pre><code>CREATE TABLE T (\n   ID NOT NULL PRIMARY KEY,\n    A nvarchar NOT NULL,\n    B nvarchar NOT NULL\n); \n</code></pre>\n\n<p>Cause of ID is primary key third row in input data could not be loaded, and i want to load correct rows (first and second or third and second) and send to log incorrect row.</p>\n"},{"tags":["sql-server","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":13048056,"title":"SSIS change datetime variable to other format","body":"<p>I have an ADO.NET Source in my SSIS package, and im trying to make the following query:</p>\n\n<p>\"SELECT * FROM Table WHERE DateAdded >  '@[User::InputDateV]'\"</p>\n\n<p>For other hand i have a DateTime variable called InputDateV.</p>\n\n<p>My issue is that in the variable value i can use the following date: 24/10/2012 but my Sql server this date is not valid and should be 10/24/2012.</p>\n\n<p>How i can i change the datetime  format of my variable to be (mm/dd/yyyy)?</p>\n\n<p>Thanks.</p>\n\n<p>Regards.</p>\n\n<p>Jose.</p>\n"},{"tags":["sql-server","vmware"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13065533,"title":"Connect to SQL Server on VMWare","body":"<p>I'm trying to <strong>connect to SQL Server on VMWare</strong> for 3 days, been searching all over, but still not working. It's SQL Server 2008 R2 and all SQL Server Services are running.</p>\n\n<p>I put the screenshots of my setting on the link below. Would you please advise if there's anything wrong on the configuration? Thank you,</p>\n\n<p><a href=\"http://i.stack.imgur.com/1C2Ba.jpg\" rel=\"nofollow\">Screenshots of the settings</a></p>\n"},{"tags":["c#",".net","sql-server","sql-server-ce"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":41,"score":0,"question_id":13065388,"title":"SQL Server CE database not Affected for insert and update","body":"<p>I am writing C# Forms application and using normal SQL Server CE database (<code>.sdf</code>). </p>\n\n<p>What happened is that no changes are written to the database. For example when trying to add a row, it will never show up in the database table. But when do the selection, it seems that it does exist !</p>\n\n<p>What is the problem here ?</p>\n"},{"tags":["sql-server","licensing","ssas","license-key","software-protection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13065556,"title":"Protecting SQL Server database with a custom license check","body":"<p>We have a product that consists of two components: an SQL Server database and an SSAS cube that gets data from that SQL database.</p>\n\n<p>Is there a way to set up a (robust) license check on at least one of those components? I would like the cube to stop working after the license expires.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":21,"score":2,"question_id":13065264,"title":"sp_dropuser stored procedure vs drop user statement in tsql","body":"<p>As the title suggest, which choice is preferable (in what conditions if any) for removing a user from the database: <code>sp_dropuser</code> stored procedure or <code>DROP USER</code> command ?</p>\n"},{"tags":["c#","asp.net","sql-server","linq"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":13065065,"title":"Can GridView be filled with var?","body":"<p>I am trying to display duplicate rows between an excel sheet and a sql server datatable in a GridView\nthis is me code:</p>\n\n<pre><code> var matched =( from table1 in dt4.AsEnumerable()\n                      join table2 in oltlb.AsEnumerable() on\n                    table1.Field&lt;int&gt;(\"ID\") equals table2.Field&lt;int&gt;(\"ID\")\n                      where table1.Field&lt;string&gt;(\"Data\") == table2.Field&lt;string&gt;(\"Data\")\n                      select table1);\n          DataTable dthi5 = new DataTable();\n          dthi5 = matched.CopyToDataTable();\n</code></pre>\n\n<p>can i display the values of var in a GridView?</p>\n"},{"tags":["c#","sql","sql-server","service-broker","sqldependency"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":13033362,"title":"SQLDependency + Service Broker","body":"<p>I'm using SqlDependency to get notification when data in some table are changed.</p>\n\n<pre><code>    private void subscribeBroker()\n    {\n        using (var conn = new SqlConnection(connString))\n        {\n            conn.Open();\n\n            var cmd = new SqlCommand(\"SELECT text FROM dbo.Test\");\n            cmd.Connection = conn;\n\n            var dependency = new SqlDependency(cmd);\n            dependency.OnChange += dependency_OnChange;\n            SqlDependency.Start(connString);\n\n            cmd.ExecuteNonQuery();\n        }\n    }\n\n    void dependency_OnChange(object sender, SqlNotificationEventArgs e)\n    {\n        //Do something...\n        subscribeBroker();\n    }\n</code></pre>\n\n<p>It is working but I have some questions.</p>\n\n<p>1) I didn't find a way how to get information which row was changed. I need to read all data from entire table to see what is different. Is there a way how to get this information? (primary ID, or something) Maybe to use different approach than SqlDependency?</p>\n\n<p>2) What if \"somebody\" changing data very fast. It is possible that some changes will not being notified? (I'm concerned about time between notification and time when I subscribe it again.</p>\n\n<p>Thank you.</p>\n"},{"tags":["c#","sql-server","sqlclr"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":133,"score":4,"question_id":6524322,"title":"SQLCLR - Wrapping a COM call","body":"<p>i'm trying to call a .net assembly that wraps a few COM calls (to a third party dll) from Sql Server. The assembly registers fine (i tried registering with unsafe and external access), but when i run the procedure i get this error:</p>\n\n<blockquote>\n  <p>A .NET Framework error occurred during execution of user-defined routine or aggregate \"ManagedCodeCallTest\": \n  System.UriFormatException: Invalid URI: The URI is empty.\n  System.UriFormatException: \n     at System.Uri.CreateThis(String uri, Boolean dontEscape, UriKind uriKind)\n     at System.Uri..ctor(String uriString)\n     at System.ComponentModel.Design.RuntimeLicenseContext.GetLocalPath(String fileName)\n     at System.ComponentModel.Design.RuntimeLicenseContext.GetSavedLicenseKey(Type type, Assembly resourceAssembly)\n     at System.ComponentModel.LicenseManager.LicenseInteropHelper.GetCurrentContextInfo(Int32&amp; fDesignTime, IntPtr&amp; bstrKey, RuntimeTypeHandle rth)\n     at ManagedCode.MyClass.ArielComponentCall()</p>\n</blockquote>\n\n<p>Any ideas? Is what i'm trying to do even possible? I read something about licensed dlls but the information was very vague.</p>\n\n<p>EDIT: CLR code in case it helps:</p>\n\n<pre><code>[SqlProcedure]\npublic static void ArielComponentCall()\n{\n    Ariel.ApplicationClass application = new Ariel.ApplicationClass();\n\n    object arielDoc = application.OpenDocument(@\"P:\\Projects\\COAT\\Ariel1.run\");\n}\n</code></pre>\n\n<p>The project that contains this class has the reference to the com object. </p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13063248,"title":"Search as many of the conditions as possible on an entity in SQL Server","body":"<p>Assume I have a SQL Server table with the following columns:</p>\n\n<pre><code>ID_PK uniqueidentifier NOT NULL PRIMARY KEY,\nID uniqueidentifier NOT NULL,\nTYPE int NOT NULL,\nVALUE nvarchar(MAX) NOT NULL\n</code></pre>\n\n<p>Further assume ID-TYPE combination and ID-TYPE-VALUE combination are unique across the database. TYPE can be 1, 2, or 3. Assume my data looks like this:</p>\n\n<pre><code>UI1 1 'A' \nUI1 2 'B'\nUI2 1 'X'\nUI2 3 'C'\nUI3 2 'Y'\nUI4 2 'B'\n</code></pre>\n\n<p>I need to search all of the TYPEs if they exist and where type 1 is 'A', type 2 is 'B', and type 3 is 'C'. If a type doesn't exist for a specific ID, then I don't need to search it. If a type has an incorrect value, then don't select the ID.</p>\n\n<p>So, my result set should be like so:</p>\n\n<pre><code>UI1 1 'A'\nUI1 2 'B'\nUI4 2 'B'\n</code></pre>\n\n<p>UI2's type 1 is not 'A', so don't return UI2. UI3's type 2 is not 'B', so ignore this as well.</p>\n\n<p>I then need the unique IDs:</p>\n\n<pre><code>UI1\nUI4\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13064362,"title":"SQL Server INSERT  SELECT Statement won't parse","body":"<p>I get the following error message with SQL Server 2005</p>\n\n<blockquote>\n  <p><em>Msg 120, Level 15, State 1, Procedure EPIN, Line 37</em><br>\n  <em>The select list for the INSERT statement contains fewer items than the insert list. The  number of SELECT values must match the\n  number of INSERT columns.</em></p>\n</blockquote>\n\n<p>I have copy and pasted the select list and insert list into excel and verified there are the same number of items in each list. Both tables an additional primary key field with is not listed in either the insert statement or select list. I am not sure if that is relevant, but suspicious it may be. </p>\n\n<p>Here is the source for my stored procedure:</p>\n\n<pre><code> set ANSI_NULLS ON\n set QUOTED_IDENTIFIER ON\n go\n\n -- =============================================\n -- Author:     Kristian Manuel\n -- Create date: 10/3/2012\n -- Description:    \n -- =============================================\n ALTER PROCEDURE [dbo].[EPIN] \n-- Add the parameters for the stored procedure here\n     @PLUCODE varchar(30),      --Table tblPolicy\n     @ECPAYFEES numeric(18,2),\n     @COSTPAYABLE numeric(18,2),\n     @RETAILPRICE numeric(18,2),\n     @DENOMINATION varchar(50),\n     @CARDNAME varchar(50),\n     @DistributorID varchar(8),\n     @AccntID decimal(18,0)\n\n --PO1  \n AS\n BEGIN\n     -- SET NOCOUNT ON added to prevent extra result sets from\n     -- interfering with SELECT statements.\n     SET NOCOUNT ON;\n\n     INSERT INTO [ECPAY-PC].[GENESIS].[dbo].[tblPolicy]\n     ( \n       PolicyID                 ,\n       AccountTID               ,\n       DistributorID            ,\n       CARDNAME                 ,\n       DENOMINATION             ,\n       RETAILPRICE              ,\n       COSTPAYABLE              ,\n       ECPAYFEES                ,\n       PLUCODE \n     ) \n     SELECT \n         t.* \n     FROM\n        (SELECT \n            AccountTID = @AccntID, \n            DistributorID = @DistributorID, \n            CARDNAME = @CARDNAME,      \n            DENOMINATION = @DENOMINATION, \n            RETAILPRICE = @RETAILPRICE, \n            COSTPAYABLE = @COSTPAYABLE,      \n            ECPAYFEES = @ECPAYFEES, \n            PLUCODE = @PLUCODE) t,\n        [ECPAY-PC].[ECPNWEB].[dbo].[account] a\n     WHERE\n        a.AccntID = t.AccountTID --for account\n END\n</code></pre>\n"},{"tags":["asp.net","sql-server","sqlcachedependency"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":93,"score":4,"question_id":12705454,"title":"SqlCacheDependency/SqlDependency and columns","body":"<p>I am using the following code to cache with dependency on change of \"People\" table's, \"Name\" column. However, in a row if some other column such as Address column changes then also dependency fires and purges the cache. (ASP.NET 4.0 with SQL Server 2008.)</p>\n\n<pre><code>public string GetTheVals()\n{\n    string vals = HttpContext.Current.Cache[\"TheCacheKey__X\"] as string;\n    if (vals == null)\n    {\n        con = GetConnection();\n        SqlCommand cmd = new SqlCommand(@\"\nSELECT Name\nFROM dbo.People\n\", con);            \n        con.Open();\n        SqlCacheDependency sqlDependency = new SqlCacheDependency(cmd);\n        SqlDataReader rdr = null;\n\n        StringBuilder builder = new StringBuilder(\"\");\n        rdr = cmd.ExecuteReader();\n        while (rdr.Read())\n        {\n            builder.Append(rdr[0].ToString());\n        }\n        vals = builder.ToString();\n\n        HttpContext.Current.Cache.Insert(\"TheCacheKey__X\", vals, sqlDependency, System.Web.Caching.Cache.NoAbsoluteExpiration, TimeSpan.FromMinutes(20));\n        CloseConnection(con);\n    }\n    return vals;\n}\n</code></pre>\n\n<p>Why does it fire when a value of a column which is not in the query of the command changed although it is said to be fired when results changed?</p>\n\n<blockquote>\n  <p>You can also assign a delegate to the OnChange event, which will fire\n  when the results change for an associated command.</p>\n  \n  <p><a href=\"http://msdn.microsoft.com/en-us/library/62xk7953.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/62xk7953.aspx</a></p>\n</blockquote>\n\n<p>It is also required to state columns explicitly so we understand that it will filter out other columns of the table and will not fire.</p>\n\n<ul>\n<li>So, why does it require to explicitly state column names? </li>\n<li>Is it just for making developers aware of what they are doing (such as when using inner joins) and avoid creating dependencies that will cause worst performance?</li>\n</ul>\n\n<blockquote>\n  <p>The <strong>projected columns in the SELECT statement must be explicitly\n  stated</strong>, and table names must be qualified with two-part names. Notice\n  that this means that all tables referenced in the statement must be in\n  the same database.</p>\n  \n  <p>The statement may not use the asterisk (*) or table_name.* syntax to\n  specify columns.</p>\n  \n  <p>The statement must not contain subqueries, outer joins, or self-joins. </p>\n  \n  <p><a href=\"http://msdn.microsoft.com/en-us/library/ms181122(v=sql.105).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms181122(v=sql.105).aspx</a></p>\n</blockquote>\n"},{"tags":["sql-server","sql-server-2008","maintenance"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13063887,"title":"how to disconnect all logged users in sql server except sa?","body":"<p>speI would like to disconnect all users from sql server except sa.</p>\n\n<p>THe need for this is:</p>\n\n<p>I wrote a dB maintenance utility for my ERP. Before running it I need to ask all users to logoff.\nSo somehow I would like to give them a message (through ERP) \"disconnecting in 5 minutes, please save your work and logoff or you'll be kicked out\" and then after 5 minutes run the command on the server that disconnects all people.\nI want \"sa\" or anyway \"1 specific user\" not to be disconnected, since th dbmaintenance utilty will user that user for db connection.</p>\n\n<p>I found this:</p>\n\n<pre><code>use master\nalter database MyDatabase set offline with rollback immediate\n</code></pre>\n\n<p>but how to say \"one specific user is an exception\"?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","window-functions"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":61,"score":2,"question_id":13061336,"title":"How to calculate the mode for each value in another column in TSQL","body":"<p>I have a table like this:</p>\n\n<pre><code>ID   Group  Gender\n------------------\n1    A      M\n2    A      M\n3    A      F\n4    A      M\n5    A      U\n6    B      F\n7    B      F\n8    B      M\n9    C      U\n10   C      F\n11   C      U\n</code></pre>\n\n<p>I am trying to calculate the <strong>mode group</strong> for each gender. In other words, for each gender, tell me which is the most popular group.  So the results I want would be as follows:</p>\n\n<pre><code>Gender  ModeGroup\n-----------------\nM       A          (because 3 males in group A, 1 in B and 0 in C)\nF       B          (because 2 females in group B, 1 in A and 1 in C)\nU       C          (because 2 unknown in group C, 0 in B and 1 in C)\n</code></pre>\n\n<p>In the case of a tie, I need a record returned for each of the tied groups.</p>\n\n<p>How can I do this elegantly in TSQL?  I think I need to use a window function, but I've  been struggling with how to go about it.</p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13054864,"title":"How to update multiple rows using a sub query","body":"<p>when I am executing the sub query everything is fine as expected and Now I am using the same query to update a column based on the sub query results but it says sub query returned more than 1 row which make sense..How should I solve this ..</p>\n\n<pre><code>begin transaction\nupdate trn_RatingAuto                                                        \nset Rate  = 0 \nwhere rate = (\nSELECT ar.Rate\nFROM trn_account ta\nINNER JOIN trn_risk tr  ON ta.AccountId=tr.AccountId\ninner join trn_option ot on tr.riskid = ot.riskid\nINNER JOIN trn_Rating ra ON ot.RatingId = ra.RatingId\nINNER JOIN trn_RatingAuto ar on ra.RatingId = ar.RatingId\nwhere  ar.Rate is null \n)\n</code></pre>\n"},{"tags":["sql","sql-server","database"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":194,"score":1,"question_id":8356760,"title":"SQL Server IN (maximum,params,allowed,in,here)?","body":"<p>How many params can I pass to SQL Servers IN() function?</p>\n\n<pre><code>SELECT * FROM TABLE where ID IN ( 1,2,3,4,5,..,.,....) \n</code></pre>\n\n<p>Thanks in advance,</p>\n\n<p>Harry</p>\n"},{"tags":["c#","asp.net","sql-server","datatables","match"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":94,"score":2,"question_id":13062720,"title":"Query to find out the duplicate rows among two DataTable?","body":"<p>I have an excel sheet with columns:</p>\n\n<pre><code>Id,Data\n</code></pre>\n\n<p>I have a table in sql server database:</p>\n\n<pre><code>Id,Data\n</code></pre>\n\n<p>I have derived rows of both in two different <code>DataTables</code>, now I want to detect rows which are common in both excel and database table and store the duplicates in another <code>DataTable</code>.\nSomething like this:</p>\n\n<pre><code>OleDbCommand command1 = new OleDbCommand(\"select * from [Sheet1$]\",connection);\nDataTable dt2 = new DataTable();\ntry\n{\n    OleDbDataAdapter da2 = new OleDbDataAdapter(command1);\n    da2.Fill(dt2);\n}\ncatch { }\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":11869727,"title":"Inner Join Delete in SQL Server 2008?","body":"<p>I am trying to join 2 tables together and do a delete on it.</p>\n\n<pre><code>DELETE TableA \nFROM TableA a\nINNER JOIN\nTableB b on b.Id = a.Id\nwhere title like 'test' \n</code></pre>\n\n<p>The above is what I come up with however I keep getting </p>\n\n<blockquote>\n  <p><em>The DELETE statement conflicted with the REFERENCE constraint</em></p>\n</blockquote>\n\n<p>I thought if I merge the 2 tables together then I will delete both at the same time and no constraints would be conflicted. </p>\n\n<p>Am I missing something in my query?</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13062749,"title":"SQL Server 2012 to 2008 connection","body":"<p>I have installed SQL Server 2012.</p>\n\n<p>I am trying to connect connect to a SQL Server 2008 instance using SQL Server Management Studio 2012, but when I try to connect I get error</p>\n\n<blockquote>\n  <p><em>Cannot connect to PC221327\\SQLSERVER.</em></p>\n  \n  <p><em>A network-related or instance-specific error occurred while\n  establishing a connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: SQL\n  Network Interfaces, error: 26 - Error Locating Server/Instance\n  Specified) (.Net SqlClient Data Provider)</em></p>\n</blockquote>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13063139,"title":"SQL Server two lines in one","body":"<p>Hello and thanks for your attention</p>\n\n<p>I need to convert data from two different lines into one line. </p>\n\n<p>Let s imagine </p>\n\n<p><code>ORDERS</code> table:</p>\n\n<pre><code>ID    Name    adress   \n-------------------- \n01    AA      adr1\n02    BB      adr2\n03    CC      adr3\n</code></pre>\n\n<p><code>LINEORDERS</code> table:</p>\n\n<pre><code>ID    IDorder    IDprofileType     ProfileType      idPers   \n------------------------------------------------------------- \n01    01         01                Organizer        0045\n01    01         02                Present          0085\n01    01         02                Present          0032\n01    01         03                Manager          0018\n</code></pre>\n\n<p>Lets imagine we want as result ></p>\n\n<p>Desired result:</p>\n\n<pre><code>IDorder   NameOrder     OrganizerID           PresentID           ManagerID       Diff\n------------------------------------------------------------- \n01        AA            0045                  0085                0018            yes\n01        AA            0045                  0032                0018            yes\n</code></pre>\n\n<p><code>Diff</code> is yes if <code>managerID</code> and <code>organizerID</code> are different.</p>\n\n<p>How can I get such a result?</p>\n\n<p>Do I need to create  T-SQL temporary tables? What would be the lighter?</p>\n\n<p>I have a lot of lines in the table.</p>\n\n<p>Thanks for your help</p>\n"},{"tags":["c#","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":13062044,"title":"Insert large volume data into SQL Server via c# in a single database call","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12292644/speed-up-update-of-185k-rows-in-sql-server-2008\">Speed up update of 185k rows in SQL Server 2008?</a>  </p>\n</blockquote>\n\n\n\n<p>I have more than 700.000 contact mails and I want to insert them into SQL Server using C#, in a few minutes, not hours, in a single database call.</p>\n\n<p>I know that pre is impossible but, I know there's way to do it</p>\n\n<p>how can I achieve this?</p>\n"},{"tags":["sql-server","reporting-services","formatting"],"answer_count":10,"favorite_count":31,"up_vote_count":59,"down_vote_count":0,"view_count":82071,"score":59,"question_id":44376,"title":"Add alternating row color to SQL Server Reporting services report","body":"<p>How do you shade alternating rows in a SQL Server Reporting Services report?</p>\n\n<p><hr /></p>\n\n<p><strong>Edit:</strong> There are a bunch of good answers listed below--from <a href=\"http://stackoverflow.com/questions/44376/add-alternating-row-color-to-sql-server-reporting-services-report#44378\">quick</a> and <a href=\"http://stackoverflow.com/questions/44376/add-alternating-row-color-to-sql-server-reporting-services-report#345935\">simple</a> to <a href=\"http://stackoverflow.com/questions/44376/add-alternating-row-color-to-sql-server-reporting-services-report#83832\">complex and comprehensive</a>. Alas, I can choose only one...</p>\n"},{"tags":["c#","sql-server","connection-string"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":13058155,"title":"SQL Server conn string. w/ remote machine requires IP:PORT and SQLPORT","body":"<p>My problem is trying to create a connection string in C# which connects to a SQL Server 2012 database remotely. I can successfully do this if the machine hosting the SQL Server does not require a port number to navigate to. Now that we have re-routed our ip's a little, the ip to the machine hosting SQL Server is XXX.XXX.XXX.XXX:16500, where SQL Server is still listening on default port 1433.</p>\n\n<p>I understand you can specify the port number that the SQL Server instance is using like so;</p>\n\n<pre><code>data source=XXX.XXX.XXX.XXX,1433;Network Library=DBMSSOCN;initial catalog=Order;User ID=test1;Password=test1;\");\n</code></pre>\n\n<p>Our problem is, that our remote machine is not just an IP. It is an IP and a port.</p>\n\n<p><code>XXX.XXX.XXX.XXX:16500</code> would manually navigate to the desired PC, ignoring the port number would take you to another machine. We are trying to accomplish something like this;</p>\n\n<pre><code>data source=XXX.XXX.XXX.XXX:16500,1433;Network Library=DBMSSOCN;initial catalog=Order;User ID=test1;Password=test1;\");\n</code></pre>\n\n<p>I cannot find for the life of me how to do this. I want to set my data source to a remote IP:PORT, as well as set the port SQL Server will be listening on (I understand 1433 is the default, but in some cases we may have to change it, so it needs to be there for the future)</p>\n\n<p>I have tried;</p>\n\n<pre><code>data source=XXX.XXX.XXX.XXX:16500,1433;Network Library=DBMSSOCN;initial catalog=Order;User ID=test1;Password=test1;\");\n</code></pre>\n\n<p>ERROR: </p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occured while\n  establishing a connection to the SQL Server...</em></p>\n</blockquote>\n\n<pre><code>data source=XXX.XXX.XXX.XXX:16500;Network Library=DBMSSOCN;initial catalog=Order;User ID=test1;Password=test1;\");\n</code></pre>\n\n<p>ERROR: </p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occured while\n  establishing a connection to the SQL Server...</em></p>\n</blockquote>\n\n<pre><code>data source=XXX.XXX.XXX.XXX,16500;Network Library=DBMSSOCN;initial catalog=Order;User ID=test1;Password=test1;\");\n</code></pre>\n\n<p>ERROR: </p>\n\n<blockquote>\n  <p><em>A connection was successfully established with the server, but then\n  an error occurred durring the pre-login handshake. (Provider: TCP\n  Provider, error:0 - An existing connection was forcibly closed by the\n  remote host.)</em></p>\n</blockquote>\n\n<p>Here it seems I am just connecting to the wrong server, trying to use port 16500 for SQL Server, which is not correct.</p>\n\n<p>Can anyone please shine some light, is this possible?</p>\n"},{"tags":["sql-server","iteration"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13058227,"title":"SQL Server : select a substring from every row in a table","body":"<p>I have a table in a database (that I am not allowed to modify) that is setup in the following manner:</p>\n\n<pre><code>ID  Value                                                                 Column x...\n0   Apple: GDGolden Delicious, Date Picked: 5/5/2012, Color: Yellow\n1   Apple: GSGranny Smith, Date Picked: 3/24/2010, Color: Green\n2   Apple: RDRed Delicious, Date Picked: 1/15/2012, Color: Red\n3   Random Data, Apple: BRBrayburn, Date Picked: 2/15/2012, Color: Mixed\n</code></pre>\n\n<p><code>ID</code> is an <code>INT</code> and <code>Value</code> is a <code>VarChar</code>, delimited by commas between data.</p>\n\n<p>For every row in the table, I need to pull out a substring of what is listed, in this case, the abbreviation for each fruit variety (i.e. GD, GS, RD, BR) and place it into a temporary table that contains all of the other columns from that table, along with the substring but no other data from the <code>Value</code> column. Each substring abbreviation in the table is exactly two characters, although as you see on the last row, it does not always appear at the beginning of the column.</p>\n\n<p>In my reading, it sounds like I'd have to use a cursor to do this -- but I'd like to avoid that if at all possible. Is there anyway to accomplish this without using a cursor, through a case statement or subquery perhaps?</p>\n\n<p>The end result would look like this:</p>\n\n<pre><code>ID  Value  Column x  Column y...\n0   GD     \n1   GS     \n2   RD     \n3   BR     \n</code></pre>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","tsql","stored-procedures","optional-parameters"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":96,"score":1,"question_id":13058891,"title":"SQL Server stored procedure with optional parameters updates wrong columns","body":"<p>I have a (legacy) VB6 program that needs some work. I have a stored procedure that updates a table of vendors. In this particular form, I don't need to update the entire row, just 10 or so columns out of the 20ish.</p>\n\n<p>Here is some pseudo code that works fine if I want to update the entire row:</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[spUpdateVendor](\n    @pID INT,\n    @pVendorID varchar(254), \n    @pVendorName varchar(255),\n    @pContact varchar(255),\n    @pEmail varchar(255),\n    ...)\nAS\nBEGIN\nSET NOCOUNT ON;\nSET XACT_ABORT ON\n\nDECLARE @ErrorMessage nvarchar(4000);\n\nBEGIN TRY\n-- Start the transaction\n    BEGIN TRANSACTION\n        UPDATE tblVendor\n            SET\n                [Vendor ID] = @pVendorID,\n                [Vendor Name] = @pVendorName,\n                [Contact] = @pContact,\n                [email] = @pEmail\n                ...\n            WHERE\n                [ID] = @pID\n    COMMIT TRANSACTION;\nEND TRY\n</code></pre>\n\n<p>If I want to only update some of the columns with data here is the (pseudo) code I have been trying (attempt at using optional parameters):</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[spUpdateVendor2](\n    @pID INT,\n    @pVendorID varchar(254) = NULL, \n    @pVendorName varchar(255) = NULL,\n    @pContact varchar(255) = NULL,\n    @pEmail varchar(255) = NULL,\n    ...)\nAS\nBEGIN\nSET NOCOUNT ON;\nSET XACT_ABORT ON\n\nDECLARE @ErrorMessage nvarchar(4000);\n\nBEGIN TRY\n-- Start the transaction\n    BEGIN TRANSACTION\n        UPDATE tblVendor\n            SET\n                [Vendor ID] = ISNULL(@pVendorID,[Vendor ID]),\n                [Vendor Name] = ISNULL(@pVendorName,[Vendor Name]),\n                [Contact] = ISNULL(@pContact,[Contact]),\n                [Email] = ISNULL(@pEmail,[email]),\n                ...\n            WHERE\n                [ID] = @pID \n    COMMIT TRANSACTION;\nEND TRY\n</code></pre>\n\n<p>and it all runs w/o errors but it will update the wrong column if I update one optional column, skip a few, then update another optional column.</p>\n\n<p>Example of update using normal parameters:</p>\n\n<pre><code>tblVendor\nID: 2924\nVendor ID: Company1\nVendor Name: Company Name\nContact: Bob\nemail: bob@company.com\n</code></pre>\n\n<p>Example of updating via the optional parameters when I don't supply 'contact':</p>\n\n<pre><code>tblVendor\nID: 2924\nVendor ID: Company1\nVendor Name: Company Name\nContact: bob@company.com\nemail: bob@company.com\n</code></pre>\n\n<p>SO it updates the row, but it updates the wrong column. What am I doing incorrectly?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":83,"score":6,"question_id":13048856,"title":"Convert DD-Mon-YYYY to DD/MM/YYYY","body":"<p>I need to convert dt_of_birth <code>[varchar] (15)</code> which is in the format <code>DD-Mon-YYYY</code> to <code>DD/MM/YYYY</code>.</p>\n\n<p><code>dt_of _birth</code> is specified in different table and the conversion had to be done and stored in another table which has the same column name as <code>dt_of_birth</code>.</p>\n"},{"tags":["sql","sql-server","database"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13061409,"title":"Creating a stored procedure with many parameters from the website","body":"<p>I have a general question on designing a stored procedure in SQL Server:</p>\n\n<p>I have a website and a user can do a search for something using up to say 30 attributes (meaning he may use all 30 criteria or he may use only 5). </p>\n\n<p>How would you design a stored procedure for this? What would you keep in mind while designing this procedure?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","sql-server","asp.net-mvc","lucene.net"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":61,"score":1,"question_id":13060798,"title":"asp.net mvc - searching","body":"<p>I have a requirement where a user can type in a keyword and the search should look at 4 columns to match against (name, city, state, zip) and return the search results. I'm wondering if I should use a LIKE clause, Free Text Search, Lucene .net, etc. also, I am using sql server.</p>\n\n<p>Pros/Cons?</p>\n\n<p>Any suggestions would be greatly appreciated.</p>\n"},{"tags":["sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":3,"view_count":1772,"score":2,"question_id":411864,"title":"ANSI NULLS","body":"<p>Can anybody let me know that what does SET ANSI NULLS ON do .</p>\n\n<p>Thanks,\nChris</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1376,"score":3,"question_id":5180256,"title":"Create assembly from System.Web in SQL Server","body":"<p>Hi I have following problem:</p>\n\n<p>I need to create an assembly in SQL Server database from <code>system.web.dll</code> with following script:</p>\n\n<pre><code>CREATE ASSEMBLY SystemWeb \nFROM 'C:\\WINDOWS\\MICROSOFT.NET\\FRAMEWORK\\V2.0.50727\\SYSTEM.WEB.DLL' \nWITH PERMISSION_SET = UNSAFE\n</code></pre>\n\n<p>At fist cannot create because I retrieve some error because don't find some dependencies dll.</p>\n\n<p>I start to install first the dependencies like system.drawing.dll an so on without problem but when I'm trying to install <code>system.web.dll</code> it require <code>System.EnterpriseServices.dll</code> that require <code>System.Runtime.Remoting.dll</code> that require <code>System.Web</code> and here I'm inside a circle and cannot go OUT.</p>\n\n<p>Somebody can help to resolve it?</p>\n\n<p>Windows Server 2008 / SQL Server 2008 Enterprise</p>\n\n<p>Thank you a lot in advance</p>\n"},{"tags":["sql-server","sqlclr"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1003,"score":2,"question_id":4097820,"title":"Why can I not register System.Web in SQL Server 2008?","body":"<p>Running this command:</p>\n\n<pre><code>CREATE ASSEMBLY \n[System.Web] from\n'C:\\Windows\\Microsoft.NET\\Framework\\v2.0.50727\\system.web.dll'\nwith permission_set = UNSAFE\n</code></pre>\n\n<p>Gives me this error:</p>\n\n<blockquote>\n  <p>Msg 10300, Level 16, State 2, Line 1</p>\n  \n  <p>Assembly 'System.Web' references assembly 'system.web, version=2.0.0.0, culture=neutral, publickeytoken=b03f5f7f11d50a3a.', which is not present in the current database. SQL Server attempted to locate and automatically load the referenced assembly from the same location where referring assembly came from, but that operation has failed (reason: version, culture or public key mismatch). Please load the referenced assembly into the current database and retry your request.</p>\n</blockquote>\n\n<p>... this sounds a little silly. It seems like SQL Server thinks that the System.Web assembly is referencing it's self. How can I fix this?</p>\n"},{"tags":["sql-server","sql-server-2008","memory-consumption"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":16762,"score":2,"question_id":856575,"title":"SQL Server 2008 takes up a lot of memory?","body":"<p>I am conducting stress tests on my database, which is hosted on SQL Server 2008 64-bit running on a 64-bit machine with 10 GB of RAM.</p>\n\n<p>I have 400 threads. Each thread queries the database every second, but the query time does not take time, as the SQL profiler says that, but after 18 hours SQL Server uses up 7.2 GB of RAM and 7.2 GB of virtual memory.</p>\n\n<p>Is this normal behavior? How can I adjust SQL Server to clean up unused memory?</p>\n"},{"tags":["sql","sql-server","case","where"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5050,"score":0,"question_id":4880410,"title":"SQL Case Statement in Where Clause","body":"<p>I have a table with accounting_period in the form of 201101 for Jan 2011, 201102 for Feb 2011, etc.\n<br>\nI am trying to sum a column (eff_cc) for the quarter. That is, I want to get the sum the data for Jan, Feb &amp; Mar 2011 for a date in the 1st quarter, etc.</p>\n\n<p>So, I used a Case statement in the where clause.  Basically I said (in the where clause) that:</p>\n\n<ul>\n<li>if the current month is 1,4,7 or 10, then get data from that month; </li>\n<li>if the current month is 2,5,8 or 11, then get the data from the curent month &amp; the previous month; and </li>\n<li>if the current month is 3,6,9, or 12 then get data from the current and the previous two months</li>\n</ul>\n\n<p>Doesn't want to work.  The code is below.</p>\n\n<pre><code>select phase_code, accounting_period, sum(eff_cc) as BD_Eff_QTD, \nfrom prj_detail\nwhere \n    case month(getdate()) % 3\n        when  1 then    -- current month is 1,4,7,10\n            accounting_period = right(Year(getDate()),4) + Right('0' + rtrim(month(getDate())),2)\n        when 2 then     -- current month is 2, 5, 8, 11\n            (accounting_period = right(Year(getDate()),4) + Right('0' + rtrim(month(getDate())),2) or \n            accounting_period = right(Year(getDate()),4) + Right('0' + rtrim(month(getDate())-1),2))\n        when 3 then     -- current month is 3, 6, 9, 12\n            (accounting_period = right(Year(getDate()),4) + Right('0' + rtrim(month(getDate())),2) or \n            accounting_period = right(Year(getDate()),4) + Right('0' + rtrim(month(getDate())-1),2) or\n            accounting_period = right(Year(getDate()),4) + Right('0' + rtrim(month(getDate())-2),2))\n    end\ngroup by phase_code, accounting_period\n</code></pre>\n"},{"tags":["sql-server","deprecated","sql-server-2012","benefits"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13059118,"title":"Reasons for sticking with TEXT, NTEXT and IMAGE instead of (N)VARCHAR(max) and VARBINARY(max)","body":"<p>TEXT, NTEXT and IMAGE have been deprecated a long time ago and will, eventually, be removed from SQL Server.</p>\n\n<p>However, they are not going to be discontinued right away, not even in the next version of SQL Server, so it's not convenient for my enterprise to transform thousands of columns right away, even if it is using SQL Server 2012.</p>\n\n<p>What arguments can I use to postpone this migration?</p>\n\n<p>I know there are some advantages in using the new types. But I'm strictly looking for reasons not to migrate my data that is already functioning pretty well in the old types.</p>\n"},{"tags":["sql-server","monitoring"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13056620,"title":"Monitoring SQL Servers Centrally","body":"<p>This may seem general question but please take out to the time to answer. \nWhat is the best way to continuosly monitor 400+ SQL servers for parameters like agent status, CPU, Avail Memory etc. ? The method should be able to do itfrom a central location though that is not a hard rule and can be modified.\nI have looked into perfmon counters , wmi etc. but I still dont have a clear picture.\nAs always, all the help is greatly appreciated.</p>\n"},{"tags":["c#","sql-server","stored-procedures","transactions","master-detail"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":96,"score":2,"question_id":13058109,"title":"SQL Server and C# Master / Detail Insert","body":"<p>I am creating stored procedures that will be called from my C# application and will enter master/detail information into SQL Server. On the Header table I have <code>TransactionId</code> as an Identity column so that I get a unique ID every time I insert. When I call my stored procedure for the detail table, I would like to use the PK ID from the Header and insert it into the FK of the detail. What is the best way to ensure that I get back the ID that was just created in the Header table?</p>\n\n<pre><code>CREATE TABLE [dbo].[Header835]\n(\n   [TRANSACTIONID] [int] IDENTITY(1, 1) NOT NULL\n   , [FILENAME] [varchar](80) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL\n   , [TRADINGPARTNERNAME] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL\n   , [ISACRTL] [numeric](18, 0) NOT NULL\n   , [STCRTL] [numeric](18, 0) NOT NULL\n   , CONSTRAINT [PK_Header835] PRIMARY KEY CLUSTERED\n   (\n      [TRANSACTIONID] ASC\n   ) WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]\n) ON [PRIMARY]\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","distinct"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13057630,"title":"Select data from a table where only the first two columns are distinct","body":"<p><strong>Background</strong></p>\n\n<p>I have a table which has six columns. The first three columns create the pk. I'm tasked with removing one of the pk columns.</p>\n\n<p>I selected (using distinct) the data into a temp table (excluding the third column), and tried inserting all of that data back into the original table with the third column being '11' for every row as this is what I was instructed to do. (this column is going to be removed by a DBA after I do this)</p>\n\n<p>However, when I went to insert this data back into the original table I get a pk constraint error. (shocking, I know)</p>\n\n<p>The other three columns are just date columns, so the distinct select didn't create a unique pk for each record. What I'm trying to achieve is just calling a distinct on the first two columns, and then just arbitrarily selecting the three other columns as it doesn't matter which dates I choose (at least not on dev). </p>\n\n<p><strong>What I've tried</strong></p>\n\n<p>I found the following post which seems to achieve what I want:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/54418/how-do-i-or-can-i-select-distinct-on-multiple-columns-postgresql\">How do I (or can I) SELECT DISTINCT on multiple columns (postgresql)?</a></p>\n\n<p>I tried the answers from both Joel,and Erwin.</p>\n\n<p><strong>Attempt 1:</strong></p>\n\n<p>However, with Joels answer the set returned is too large - the inner join isn't doing what I thought it would do. Selecting distinct col1 and col2 there are 400 columns returned, however when I use his solution 600 rows are returned. I checked the data and in fact there were duplicate pk's. Here is my attempt at duplicating Joels answer:</p>\n\n<pre><code>select a.emp_no, \n        a.eec_planning_unit_cde, \n        '11' as area, create_dte, \n        create_by_emp_no, modify_dte,\n        modify_by_emp_no\nfrom tempdb.guest.temp_part_time_evaluator b\ninner join\n(\n    select emp_no, eec_planning_unit_cde\n    from tempdb.guest.temp_part_time_evaluator\n    group by emp_no, eec_planning_unit_cde\n) a\nON b.emp_no = a.emp_no AND b.eec_planning_unit_cde = a.eec_planning_unit_cde\n</code></pre>\n\n<p>Now, if I execute just the inner select statement 400 rows are returned. If I select the whole query 600 rows are returned? Isn't inner join supposed to only show the intersection of the two sets?</p>\n\n<p><strong>Attempt 2:</strong></p>\n\n<p>I also tried the answer from Erwin. This one has a syntax error and I'm having trouble googling the spec on the where clause (specifically, the trick he is using with <code>(emp_no, eec_planning_unit_cde)</code>)</p>\n\n<p>Here is the attempt:</p>\n\n<pre><code>select emp_no, \n    eec_planning_unit_cde, \n    '11' as area, create_dte, \n    create_by_emp_no, \n    modify_dte,\n    modify_by_emp_no\nwhere (emp_no, eec_planning_unit_cde) IN\n(\n    select emp_no, eec_planning_unit_cde\n    from tempdb.guest.temp_part_time_evaluator\n    group by emp_no, eec_planning_unit_cde\n)\n</code></pre>\n\n<p>Now, I realize that the post I referenced is for postgresql. Doesn't T-SQL have something similar? Trying to google parenthesis isn't working too well. </p>\n\n<p><strong>Overview of Questions:</strong></p>\n\n<ol>\n<li>Why doesn't inner join return an intersection of two sets? From googling this is what I thought it was supposed to do</li>\n<li>Is there another way to achieve the same method that I was trying in attempt 2 in t-sql?</li>\n<li>It doesn't matter to me which one of these I use, or if I use another solution... how should I go about this? </li>\n</ol>\n"},{"tags":["sql-server","sql-server-2008-r2","sql-server-2012","sql-management-studio"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13057083,"title":"SQL Server 2012 SSMS with SQL Server 2008 R2 database engine","body":"<p>I use SQL Server 2008 R2 as the database engine. With my MSDN subscription, I can get SQL Server 2012 for development use. Since I noticed some cool things in 2012 SSMS, my question is that if I only use 2012 SSMS and keep 2008 R2 as the database engine, will there be any difference in scripts' generation or any other effects?</p>\n\n<p>Thanks.</p>\n\n<p>UPDATE 1:\nOh yes, I saw this page: <a href=\"http://msdn.microsoft.com/en-us/library/ms143532.aspx\" rel=\"nofollow\">SQL Server Database Engine Backward Compatibility</a>, but it is not exactly what I am looking for.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":98,"score":1,"question_id":13056929,"title":"Bulk load data conversion error (type mismatch or invalid character for the specified codepage) for row 1, column 4 (Year)","body":"<p>I'm getting the conversion error when I try to import a text file to my database. Below is the error message I received:</p>\n\n<p>Bulk load data conversion error (type mismatch or invalid character for the specified codepage) for row 1, column 4 (Year).</p>\n\n<p>Here is my query code:</p>\n\n<pre><code>CREATE TABLE Students\n(\n    StudentNo    Integer NOT NULL Primary Key,\n    FirstName    VARCHAR(40) NOT NULL,\n    LastName     VARCHAR(40) NOT NULL,\n    Year         Integer,\n    GPA          Float NULL\n);\n</code></pre>\n\n<p>Here is the sample data from text file:</p>\n\n<pre><code>100,Christoph,Van Gerwen,2011\n101,Anar,Cooke,2011\n102,Douglis,Rudinow,2008\n</code></pre>\n\n<p>I think I know what the problem is..Below is my bulk insert code:</p>\n\n<pre><code>use xta9354\nbulk insert xta9354.dbo.Students\nfrom 'd:\\userdata\\xta9_Students.txt' \nwith (fieldterminator = ',',rowterminator = '\\n') \n</code></pre>\n\n<p>With the sample data, there is no ',' after the Year attribute even tho there is still another attribute Grade after the Year which is NULL</p>\n\n<p>Can someone please tell me how to fix this?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","append"],"answer_count":4,"favorite_count":1,"up_vote_count":11,"down_vote_count":0,"view_count":11651,"score":11,"question_id":466323,"title":"How to append to a text field in t-sql SQL Server 2005","body":"<p>What is the best way to append to a text field using t-sql in Sql Server 2005?</p>\n\n<p>With a varchar I would do this.</p>\n\n<pre><code>update tablename set fieldname = fieldname + 'appended string'\n</code></pre>\n\n<p>But this doesn't work with a text field.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13057281,"title":"Grouping and Total Issue","body":"<p>I have a table called Phone_Details and the data looks like:</p>\n\n<pre><code>Name            DeviceType  InvoiceDate TotalCharges\nAguilera, Alex  Smart Phone 8/3/2012    606.55\nAguilera, Alex  Data Card   8/3/2012    26.17\n</code></pre>\n\n<p>I want Output as:</p>\n\n<pre><code>Name            Total Spend    # of devices    Avg Spend    # of Bills &gt;300\nAguilera, Alex  632.72              2            316.36            1\n</code></pre>\n\n<p>I tried doing this:</p>\n\n<pre><code>Select Name,Sum(Totalcharges), Count(DeviceType),Sum(Totalcharges)/Count(DeviceType)\nfrom dbo.Phone_Details\ngroup by Name\n</code></pre>\n\n<p>But How can i get the last column this?</p>\n"},{"tags":["sql-server","tsql","view"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13056899,"title":"Breaking down/reusing complex calculations in a Transact SQL view","body":"<p>In a SQL view, what is the best way to handle the problem of reusing previous calculations such that they do not become complex/unreadable. </p>\n\n<p>In a stored proc, we could store/output @variables and do the calcs using them as we went along, but my problem is that this must be done in a view. </p>\n\n<p>What's the best way to go about this? (bearing in mind there are a few thousand rows of data).</p>\n\n<pre><code>SELECT  \n        /* CALC 1 output to view row */\n        (SELECT Act.ValueInContractCurrency/dbo.[Contract].Value * \n            (SELECT ISNULL(SUM(dbo.Invoice.ValueInContractCurrency),0)\n             FROM dbo.Invoice \n             WHERE dbo.Invoice.StageId = Act.StageId)) AS InvoicedValueInContractCurrency, \n\n        /* CALC 2 wraps CALC1 inside it and outputs to view row */\n        (SELECT Act.ValueInContractCurrency - \n            (SELECT Act.ValueInContractCurrency/dbo.[Contract].Value * \n                (SELECT ISNULL(SUM(dbo.Invoice.ValueInContractCurrency),0)\n                 FROM dbo.Invoice \n                 WHERE dbo.Invoice.StageId = Act.StageId))) AS RemainingValueInContractCurrency,        \n\n        /* CALC 3 wraps CALC2 inside it (which in turn wraps CALC1) and outputs to view row */\n        (SELECT ConCurrency.CurrentExchangeRate / dbo.[Contract].CostedExchangeRate *\n            (SELECT Act.ValueInContractCurrency - \n                (SELECT Act.ValueInContractCurrency/dbo.[Contract].Value * \n                    (SELECT ISNULL(SUM(dbo.Invoice.ValueInContractCurrency),0)\n                     FROM dbo.Invoice \n                     WHERE dbo.Invoice.StageId = Act.StageId)))) AS RemainingValueInFacilityCurrency\n\n        /* etc... for 10 more calcs that get increasingly long and unreadable via wrapping */\n\n        FROM dbo.Activity AS Act\n        JOIN dbo.Stage ON Act.StageId = dbo.Stage.Id       \n        JOIN dbo.[Contract] ON dbo.Stage.ContractId = dbo.[Contract].Id\n        JOIN dbo.Facility  ON dbo.[Contract].FacilityId = Facility.Id\n        JOIN dbo.Currency AS FacCurrency ON dbo.Facility.CurrencyId = FacCurrency.Id\n        JOIN dbo.Currency AS ConCurrency ON dbo.[Contract].CurrencyId = ConCurrency.Id\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2012"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":42,"score":2,"question_id":13056673,"title":"Creating a new table from two existing tables with every combination possibility","body":"<p>I have two temporary tables #a and #b both filled with integer values. Let's say they both contain 10 rows with values 1-10.</p>\n\n<p>I want to create a third temporary table #c that contains every possible combination of a and b. So it would have 100 rows total with (1,1), (1,2) ... (10, 10). How would I go about doing this in SQL. The implementation I'm using is SQL Server 2012.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2000"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":5974,"score":4,"question_id":272254,"title":"Alternative to BACKUP LOG WITH TRUNCATE_ONLY","body":"<p>This piece of T-SQL is deprecated in 2005:</p>\n\n<pre><code>BACKUP LOG [DB_NAME] WITH TRUNCATE_ONLY\n</code></pre>\n\n<p>I don't need to keep a backup the log for my db - but I do not want the piece of code to stop working if we port to SQL2008 or successive versions in future.</p>\n\n<p>Cheers</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":83,"score":-2,"question_id":13043557,"title":"Populate dropdownlist inside a gridview","body":"<p>I have a Dropdownlist in a Gridview and i have to show the records associated with every id.And the ID contains more than 10 records so how can i show them??</p>\n\n<pre><code> protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)\n        {\n            if (e.Row.RowType == DataControlRowType.DataRow)\n            {\n                con.Open();\n                var ddl = (DropDownList)e.Row.FindControl(\"DropDownList1\");\n                //int CountryId = Convert.ToInt32(e.Row.Cells[0].Text);\n                SqlCommand cmd = new SqlCommand(\"select LastName from Profile_Master\",        con);\n                SqlDataAdapter da = new SqlDataAdapter(cmd);\n                DataSet ds = new DataSet();\n                da.Fill(ds);\n                con.Close();\n                ddl.DataSource = ds;\n                ddl.DataTextField = \"LastName\";\n                ddl.DataBind();\n\n            }\n        }\n</code></pre>\n"},{"tags":["sql-server","regex","tsql","like","union"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13054871,"title":"Using Regular expression on SQL Server instead of of combining two LIKE statements","body":"<p>Is there a way I can use regular expression to avoid a UNION of two LIKE statements?\nfor eg: i have the following</p>\n\n<pre><code>SELECT NAME FROM EMPLOYEE WHERE NAME LIKE 'Adam%'\nUNION\nSELECT NAME FROM EMPLOYEE WHERE NAME LIKE 'Bob%' \n</code></pre>\n\n<p>I don't want to use a UNION and combine the two select statements into one using regular expression. Please help with regex solution or an alternate solution. thanks in advance</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13055605,"title":"How to rotate a table's column items to columns","body":"<p>I have a table and it needs to change</p>\n\n<pre><code>Key                  Value\nCapacityColdBTU      2000\nPowerLevelCold       B\nInverter/Standard    Standard\nCapacityColdBTU      1500\nPowerLevelCold       B\nInverter/Standard    Inverter\n</code></pre>\n\n<p>The table should look like below before I use it. I cannot use the table in searching with more than 1 criteria. How do I change it? </p>\n\n<pre><code>CapacityColdBTU   PowerLevelCold    Inverter/Standard\n2000              B                 Inverter\n</code></pre>\n\n<p>Thank you</p>\n"},{"tags":["sql","sql-server","tsql","ddl"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":203,"score":1,"question_id":12535405,"title":"Invalid column name on sql server update after column create","body":"<p>Does anyone see what's wrong with this code for SQL Server?</p>\n\n<pre><code>IF NOT EXISTS(SELECT *\n              FROM   sys.columns\n              WHERE  Name = 'OPT_LOCK'\n                     AND object_ID = Object_id('REP_DSGN_SEC_GRP_LNK'))\n  BEGIN\n      ALTER TABLE REP_DSGN_SEC_GRP_LNK\n        ADD OPT_LOCK NUMERIC(10, 0)\n\n      UPDATE REP_DSGN_SEC_GRP_LNK\n      SET    OPT_LOCK = 0\n\n      ALTER TABLE REP_DSGN_SEC_GRP_LNK\n        ALTER COLUMN OPT_LOCK NUMERIC(10, 0) NOT NULL\n  END; \n</code></pre>\n\n<p>When I run this, I get:</p>\n\n<blockquote>\n  <p>Msg 207, Level 16, State 1, Line 3<br>\n  Invalid column name 'OPT_LOCK'.</p>\n</blockquote>\n\n<p>on the update command.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13055378,"title":"What do the different colored bars in the query editor menu mean in SSMS?","body":"<p>What's the significance of the color change in this picture?\n<img src=\"http://i.stack.imgur.com/LZnDe.jpg\" alt=\"enter image description here\"></p>\n\n<p>EDIT: I was referring to the yellow and green areas of the scroll bar.</p>\n"},{"tags":["sql-server","ms-access","ms-access-2010"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13053453,"title":"Get Connection string for Pass through queries","body":"<p>I have just learned about the pass through queries in <code>MS-ACCESS</code>.</p>\n\n<p>I have a <code>SQL SERVER</code> backend and\nif I'm right, for a query access loads all records before to do the where clause... so what would be the point of having a <code>SQL SERVER</code> backend?</p>\n\n<p>That's why I want to try using pass through queries as much as possible but is there a way I can get the connection string from my linked tables for my pass through queries?</p>\n\n<p>I tried <code>CurrentDb.TableDefs(\"One of my table name\").Connect</code> in the <code>ODBC Connect Str</code> property but I got the error saying it's an invalid connection string. </p>\n\n<p>It would be nice because I know I will have to change the connection soon so I wouldn't have to edit the connection string at many places. </p>\n\n<p>Thank you. </p>\n"},{"tags":["sql-server","reporting-services"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12947474,"title":"Dynamic scheduling of data driven subscription","body":"<p>I have a data driven subscription which delivers a report to an email alias at specific time.\nIn a subscription query:</p>\n\n<pre><code>select WorkProjectionReportTime,WorkProjectionReportToMailAlias,\n'Work Projection Report for the period ' + CONVERT(varchar(10),GETDATE()-31,101)+ ' to '+CONVERT(varchar(10),GETDATE()-1,101) as Subject,\nCONVERT(varchar(10),GETDATE()-31,101) as FromDate,CONVERT(varchar(10),GETDATE()-1,101) as ToDate, 60 as WO, \n'Please see the attachment for the details' as body\nfrom tblConfig\nPivot ( MAX(cValue) for cKey in (WorkProjectionReportTime,WorkProjectionReportToMailAlias) ) as xyz\n</code></pre>\n\n<p>So by query I get all the required fields, Email To, Time, report parameters.</p>\n\n<p>I want to use the time parameter to schedule report.\ne.g. if time is 9:30 the report should be mailed at 9:30 AM etc.\nI want to achieve this from SQL or database front and not from C#. How to achieve this? </p>\n"},{"tags":["sql","sql-server","transactions","try-catch-finally","sqltransaction"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13054101,"title":"Finally Clause in SQL Server Transaction? Something that will execute irrespective of success or failure?","body":"<p>In SQL Server, is there something similar to <code>finally</code> clause in <code>try..catch...</code> block of c# ?</p>\n\n<p>I mean, I am using <code>BEGIN TRAN, END TRAN, COMMIT TRAN, ROLLBACK TRAN</code> etc in a SQL Server transaction and want a section or some set of actions that needs to fire irrespective of success or failure or transaction. </p>\n\n<p>Is there a solution for that? (similar to finally block on try/catch of OOPS languages). </p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","tsql","sql-server-2008","stored-procedures"],"answer_count":6,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":3526,"score":3,"question_id":3292531,"title":"t-sql stored procedure create scripts","body":"<p>I have a bunch of stored procedure names. I want to export the create script for each of the stored procedure. What is the best way to do it? </p>\n\n<p>Right now I am manually selecting the stored proc in SSMS and selecting <code>\"Script stored procedure as -&gt; Drop and Create to\"</code>. This seems tedious. I am hoping there is a better way to deal with this. Thanks.</p>\n"},{"tags":["sql-server","event-log","database-mirroring"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13054246,"title":"tempdb thrashing and mirroring permissions (SQL Server)","body":"<p>We have a client site that uses SQL Server. The site this morning was slow, and we realised that the primary database server was responsible for a lot of disk activity on tempdb (Server 2008, SQL Server 2008 R2, looking in the resource monitor), which was the reason for the slowness.</p>\n\n<p>In the event log we saw this message every couple of seconds or so:</p>\n\n<p>\"Database Mirroring login attempt by user xxxxx failed with 'Connection handshake failed. The login xxxxx does not have connect permission on the endpoint. State 84\"</p>\n\n<p>The IT guys say these two things (tempdb being thrashed and a connection failure for the mirroring login) are unrelated - we're not so sure. Anybody say for definite?</p>\n\n<p>P.S. we failed over the db server and the slowness went away, though the amount of disk IO on tempdb continues to rise, and the event log is still getting those error messages every couple of seconds</p>\n"},{"tags":["php","sql-server","codeigniter","odbc"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":68,"score":0,"question_id":13054094,"title":"Codeigniter not escaping single quotes in ODBC-mssql using ActiveRecord","body":"<p>I have a form with a bunch of fields. Sometimes users provides information and descriptions with single quotes in it.</p>\n\n<p>I'm validating the data with Jquery and CI, the problem is that apparently ActiveRecord isn't escaping single quotes, leading to an error inserting/updating data.</p>\n\n<p>Isn't ActiveRecord supposed to escape these characters automatically?  If it doesn't, what is the usual way for handing single quotes in user input?</p>\n\n<p>Example code of my model function that handles the insert:</p>\n\n<pre><code>public function setLicense($dataArray, $data_id=\"\")\n{\n    $iRows  = 0; // Rows found.\n    $DB = $this-&gt;load-&gt;database('some_database',TRUE,TRUE);\n\n    //var_dump($dataArray);\n    if(empty($dataArray))\n        return(FALSE);\n\n    if(!empty($data_id))\n    {\n        $DB-&gt;where('idx',$data_id);\n        $iRows=$DB-&gt;count_all_results('some_table');\n    }\n    else\n    {\n        if(isset($LicenseData['idx']))\n        {\n            $license = $LicenseData['idx'];\n            $DB-&gt;where('idx',$license);\n            $iRows=$DB-&gt;count_all_results('some_table');\n        }\n    }\n    if(!$iRows)\n        $DB-&gt;insert('some_table',$dataArray);\n    else\n    {   \n        $DB-&gt;where('idx',$data_id);\n        $DB-&gt;update('some_table',$dataArray);\n    }\n    return(TRUE);\n}\n</code></pre>\n"},{"tags":["asp.net","sql","sql-server","visual-studio-2010"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13053772,"title":"Unable to connect local database server from visual studio","body":"<p>Everything was working fine before. but after couple of days when i start working today on vs 10, i tried to connect to database and got the following error.. here is the image describing whole situation while creating a new database<img src=\"http://i.stack.imgur.com/HUF46.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server","oracle"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":56,"score":-2,"question_id":13053885,"title":"How to add ^ Caret in sql database?","body":"<p>I have a value in string which contain the caret synbol in it (Example: It is^ awsome). I would like to insert this string in database but it didn't throw the error but didn't insert this string in it..If i remove caret (^) from the string it works fine.</p>\n\n<p>Anybody have any idea how could i achieve my goal?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":87,"score":2,"question_id":13053196,"title":"Incorrect syntax error on select statement from SQL Server using table variables","body":"<p>I have a stored procedure where I create a table variable and then try to execute a <code>select</code> against that table variable, but the output throws an incorrect syntax error.</p>\n\n<p>I have my stored procedure (simplified) below :</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[spGetLog] \nAS\n  SET NOCOUNT ON;\n\n  Declare @Table table (ID int identity(1,1), \n                        Node varchar(100)\n                       )\n\n  insert into @Table(Node) values ('employee')\n\n  Declare @sqlquery AS NVARCHAR(1000)\n\n  SET @sqlquery = 'select * from @Table;'\n  EXEC (@sqlquery)\n</code></pre>\n\n<p>Gives an error -- </p>\n\n<blockquote>\n  <p><em>Incorrect syntax near '@Table'</em></p>\n</blockquote>\n\n<p>In reality the <code>@sqlquery</code> variable I have is complex and I need to use a variable and \nexecute the query.</p>\n\n<p>Is there a way I can still execute my stored procedure using a variable? Any other\nsuggestions are welcome.</p>\n"},{"tags":["sql-server","ssms"],"answer_count":6,"favorite_count":5,"up_vote_count":21,"down_vote_count":0,"view_count":7675,"score":21,"question_id":1039774,"title":"Printing SQL Server Diagrams (from SQL Server Management Studio Express)","body":"<p>I am having trouble printing my diagrams, I seem to be getting portions of the diagram blocked out, etc.  I've tried several different computers, printers, and databases, so it seems to be a problem with SSMS Express itself.</p>\n\n<p>Is this just the way it is?</p>\n\n<p>Are there any decent workarounds, or does anyone use a 3rd party product (preferably free or cheap) that can cleanly integrate with SQL Server?</p>\n"},{"tags":["sql-server","linq","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":43,"score":3,"question_id":13053321,"title":"Convert sql query with multiple inner joins to LINQ","body":"<p>I have this query which I retrieve from 6 tables which gets the dates, rated, rater, classname, scores, subject. </p>\n\n<pre><code>SELECT r.date, u1.username as rated, u2.username as rater, c.name as classname, s.ratings, sbj.name\nFROM Ratings r\n INNER JOIN Users u1 ON u1.userid = r.rated \n INNER JOIN Users u2 ON u2.userid = r.rater \n INNER JOIN ClassMembers cm ON u1.userid  = cm.userid\n INNER JOIN Class c ON cm.teamid = c.teamid\n INNER JOIN Scores s ON s.ratingsid = r.ratingsid \n INNER JOIN Subjects sbj ON sbj.subjectid = s.subjectid\n</code></pre>\n\n<p>this results in</p>\n\n<pre><code>date         | rated | rater | teamname | score |  subject\n10/12/2012    john     mike     teamA      9        Math\n10/09/2012    john     mike     teamA      9        Science\n10/09/2012    john     abra     teamA      5        Math\n10/09/2012    john     abra     teamA      5        Science\n</code></pre>\n\n<p>I have to convert this query to a LINQ expression.\nI'm having a hard time converting my sql query into LINQ. Any help would be appreciated.</p>\n"},{"tags":["sql-server","encoding","character-encoding","sybase","linked-server"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":12972460,"title":"Strange character issue","body":"<p>We have a linked server (in SQL Server) that connects to Sybase database. We have also a job that transfer data from Sybase via the linked server and writes to a SQL Server database. </p>\n\n<p>The problem is while transferring data from Sybase to SQL Server, it converts <code></code> to <code></code>. The SQL Server collation being used is <code>SQL_Latin1_General_CP1_CI_AS</code>. </p>\n\n<p>I tried all possible server options in linked server properties such as <code>Use Remote Collation</code>, <code>Collation Compatible</code> etc. but no joy. </p>\n\n<p>When I fetch the data through the Interactive SQL (that is Sybase tool), data is displayed properly. </p>\n\n<p>I do not know what else I can do, please help.</p>\n"},{"tags":["sql-server","bulkinsert","tail","logfiles"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":25,"score":3,"question_id":13052494,"title":"How can have SQL Server tail a log file and write new rows to a table?","body":"<p>I have an application that creates a text log file and I have a daily SQL Server job that truncates a log table and uses bulk insert to load the current days logs. The log file is written to by many threads and it's hard to read without manually sorting out the lines by thread.  </p>\n\n<p>Is there a way to have SQL Server 'tail' a given file and keep the table up to date without waiting for the end-of-day batch? I'd rather not run the batch multiple times during the day as this table will be monitored/searched/displayed by a web service. Logging directly to the table from the application is not currently an option either.</p>\n"},{"tags":["c#","asp.net","sql-server","ms-access-2003"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13053148,"title":"SQL Server query to *.mdb","body":"<p>I need to create a file in Access 2003 running an ASP.NET application (c#) using a SQL query.</p>\n\n<p>Actually I can create an empty file.. but I want to create a file using a query from a table on SQL Server. Can anyone help me?</p>\n\n<pre><code>    public partial class copyAbout : System.Web.UI.Page\n    {\n        protected void Page_Load(object sender, EventArgs e)\n        {\n            createdb(\"c:\\\\temp\\\\my1.mdb\");\n        }\n        protected void createdb(string path)\n        {\n            try\n            {\n                string connString;\n                string fileName = path;\n\n                ADODB.Connection myconn = new Connection();\n                connString = \"Provider=Microsoft.Jet.OLEDB.4.0; Data Source=\" + fileName + \"; Jet OLEDB:Engine Type=5\";\n                ADOX.Catalog myCatalog = new Catalog();\n\n                SqlConnection conn = new SqlConnection(ConfigurationManager.ConnectionStrings[\"SqlServer\"].ConnectionString);\n                string sql = (\"SELECT * FROM dbo.exetable\");\n\n                SqlCommand com = new SqlCommand();\n                com.CommandText = sql;\n                com.Connection = conn;\n                conn.Open();\n\n                if (!(File.Exists(fileName)))\n                {\n                    myCatalog.Create(connString);\n                    myCatalog = null;\n                }\n\n                myconn.Open(connString, \"\", \"\", 0);\n                myCatalog.ActiveConnection = myconn;\n            }\n            catch (Exception e)\n            {\n                Console.Write(\"\\n\" + e.ToString() + \"\\n\");\n            }\n        }\n</code></pre>\n\n<p>This moment the code only creates a new empty <code>mdb</code> file :( </p>\n\n<p>I want use a <code>select</code> to create a new database (mdb) from a table in SQL Server..</p>\n"},{"tags":["sql-server","csv"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13052994,"title":"Output a comma-separated list in a column in SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/451415/simulating-group-concat-mysql-function-in-sql-server-2005\">Simulating group_concat MySQL function in SQL Server 2005?</a>  </p>\n</blockquote>\n\n\n\n<p>What's the best way to achieve this?  Edit: in MSSQL 2005</p>\n\n<p><strong>Table</strong></p>\n\n<pre><code>a   |  b\n------------\nx   |  1\nx   |  4\ny   |  6\ny   |  1\n</code></pre>\n\n<p>Query:</p>\n\n<pre><code>SELECT ? FROM Table\n</code></pre>\n\n<p>so that output is :</p>\n\n<pre><code>a   | ListOfB\n------------\nx   | 1, 4\ny   | 6, 1\n</code></pre>\n"},{"tags":["sql-server","database","index"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13052103,"title":"Joining on a non-PK field, does length of varchar datatype determine query speed? SQL Server 2008","body":"<p>I was given a ragtag assortment of data to analyze and am running into a predicament.  I've got a ~2 million row table with a non-unique identifier of datatype <code>varchar(50)</code>.  This identifier is unique to a <code>personID</code>.  Until I figure out exactly how I need to normalize this junk I've got another question that might help me right now: If I change the datatype to a <code>varchar(25)</code> for instance, will that help queries run faster when they're joined on a non-PK field?  All of the characters in the string are integers, but trying to convert them to an int would cause overflow.  Or could I possibly somehow index the column for the time being to get some of the queries to run faster?</p>\n\n<p>EDIT: The <code>personID</code> will be a foreign key to another table with demographic information about a person.</p>\n"},{"tags":["sql","sql-server","tsql","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":13051888,"title":"SQL query returns multiple rows when trying to find specific value","body":"<p>I have 2 tables. One is called \"Tasks\" and the other one is called \"TaskDescription\"\nin my \"Task\" the setup looks like this:\n\"taskID(primary)\",\"FileID\",\"TaskTypeID\" and a bunch of other columns irrelevant.</p>\n\n<p>Then in my \"TaskDescription\", the setup looks like:\n\"TaskTypeID\", \"TaskTypeDesc\"</p>\n\n<p>so for example if TaskTypeID is 1 , then the description would be\"admin\"\nor if TaskTypeID is 2, then TaskTypeDesc would be \"Employee\" etc.</p>\n\n<p>The two tables have a relationship on the primary/foreign key \"TaskTypeID\".</p>\n\n<p>What I am trying to do is get a task id, and the TaskDesc where the FileID matches the @fileID(which I pass in as a param). However in my query I get multiple rows returned instead of a single row when trying to obtain the description.</p>\n\n<p>this is my query:</p>\n\n<pre><code>SELECT taskid,\n       ( 'Task ID: '\n         + Cast(cf.taskid AS NVARCHAR(15)) + ' - '\n         + Cast((SELECT DISTINCT td.tasktypedesc FROM casefiletaskdescriptions\n         td JOIN\n         casefiletasks cft ON td.tasktypeid=cft.tasktypeid WHERE cft.taskid =\n         1841 )AS\n         NVARCHAR(100))\n         + ' - Investigator : ' + ( Cast(i.fname AS NVARCHAR(20)) + ' '\n                                    + Cast(i.lname AS NVARCHAR(20)) ) ) AS\n       'Display'\nFROM   casefiletasks [cf]\n       JOIN investigators i\n         ON CF.taskasgnto = i.investigatorid\nWHERE  cf.fileid = 2011630988\n       AND cf.concluded = 0\n       AND cf.progressflag != 'Conclude' \n</code></pre>\n\n<p>I am trying to get the output to look like \"Task ID: 1234 - Admin - Investigator : John Doe\". However I am having trouble on this part:</p>\n\n<pre><code>CAST((select DISTINCT td.TaskTypeDesc from CaseFileTaskDescriptions td \nJOIN CaseFileTasks cft ON td.TaskTypeID=cft.TaskTypeID \nwhere cft.TaskID =1841 )as nvarchar(100))\n</code></pre>\n\n<p>This seems to work but the problem is I have to hard code the value \"1841\" to make it work. Is there a way to assign a \"taskID\" variable with the values being returned from the TaskID select query, or will it not work since I think sql runs everything at once instead of line by line.</p>\n\n<p>EDIT-this is in Microsoft SQL Server Management Studio 2008</p>\n"},{"tags":["sql-server","hadoop","export","sqoop"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13052255,"title":"sqoop export from hive table created by sqoop import","body":"<p>I've successfully imported a simple 2 column SQL Server data into HIVE using SQOOP on Cloudera CDH4.1.\n - id (int)\n - description (varchar(50))</p>\n\n<p>When I try get the same HIVE table to go back to SQL Server it lumps the two columns together and therefore creates an NumberFormatException.</p>\n\n<p>I've tried the --fields-terminated by \\t --lines-terminated-by \\n and this doesn't make any difference.</p>\n\n<p>I've also tried to export the sample_08 Hive table as supplied by Cloudera but get a NoSuchElement exception.  Wish it would give a clue as to which element it thinks doesn't exist!</p>\n\n<p>I've ensured that the table structures and field names are both the same on both sides including the case and underscores.</p>\n\n<p>I can export a single column table but am absolutely stumped as to how to resolve the issue. </p>\n\n<p>Any help would be gratefully received.</p>\n"},{"tags":["sql-server","orm","ado.net"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13052226,"title":"Do any .NET ORM's or ADO.NET frameworks support connection retries?","body":"<p>I have started using SQL Server 2012's Always On feature and during a failure, the server database connection is down for about 15 seconds during the failover transition.</p>\n\n<p>During that period, all queries in the middle of executing and all new connections will fail... so the client applicaiton would ideally support retrying the connection if it detects that the failover is occuring.</p>\n\n<p>Are there any frameworks or ORMs that can handle this situation automatically?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":64,"score":3,"question_id":13049031,"title":"Wanted to add two more column , in existing select statement","body":"<p>I have a sample query </p>\n\n<pre><code>select \n    x as 1, y as 2 , z as 3 \nfrom \n    table abc, xyz\nwhere \n    a = x and x = 123\n</code></pre>\n\n<p>Now I want to add two more columns in this <code>SELECT</code> statement like this:</p>\n\n<ol>\n<li>column 4 which will show the row sequence no.</li>\n<li>column 5: this column will depend on the row - it will show <code>start</code> in first row, <code>Last</code> in the last row and <code>Middle</code> in any rows in between.</li>\n</ol>\n\n<p>Please suggest the best possible optimize way to do this.</p>\n\n<p>Thanks </p>\n"},{"tags":["sql-server","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":90,"score":0,"question_id":13050961,"title":"Cannot use LIKE so what can I use instead","body":"<p>Here's the issue I am having.  I want to return rows that are similiar from my table in my database.\nConsider two rows with the following text:</p>\n\n<pre><code>'Cisco phones cannot dial out'\n'Phones are not working for outgoing calls'\n</code></pre>\n\n<p>These are two different rows...I tried to do something like this:</p>\n\n<pre><code>DECLARE @TheTest varchar(1000)\nDECLARE @TheResult varchar(1000)\n\nSET @TheTest = ('Cisco phones cannot dial out')\nSET @TheResult = ('Phones are not working for outgoing calls')\n\nCREATE TABLE #Test\n(\nMyCol varchar(1000)\n)\n\nINSERT INTO #Test(MyCol)\nSELECT @TheResult\n\nSELECT * FROM #Test WHERE LOWER(MyCol) LIKE '%' + LOWER(@TheTest) + '%'\n\nDROP TABLE #Test\n</code></pre>\n\n<p>But the result is 0 rows were returned, well I understand that because the string TheTest is not close enough to the string @TheResult...But I need a solution that would actually return this row because the word phones appear in both texts.</p>\n\n<p>Would I have to build something much more elaborate to seperate words and get rid of common words for something like this?  I'd like to mimic functionality that I see on a specific website:</p>\n\n<p><img src=\"http://i.stack.imgur.com/Hw8nn.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":39,"score":0,"question_id":13050895,"title":"displays a list of students who have the maximum average score","body":"<p>1) There are two tables that were created by scripts below; you are tasked to write the SQL query that displays a list of students who have the maximum average score. Please, provide two solutions with the following limitations \n a)  You can use neither subqueries nor cursors nor additional tables\n b)  You can use neither subqueries nor cursors nor additional tables nor GROUP BY clause</p>\n\n<pre><code>create table Students\n(ID int identity(1,1) primary key not null,\n StudentName varchar(200) not null,\n );\n\ncreate table StudentMarks\n(ID int identity (1,1) primary key not null,\n Student_ID int not null references Students (ID),\n Mark int not null check (mark between 1 and 5));\n\n insert into Students \n (StudentName)\n values \n ('Ivanov'),\n ('Petrov'),\n ('Sydorov'),\n ('Semenov');\n\n\n insert into StudentMarks\n (Student_ID,Mark)\n values\n (1,3), (1,4), (1,3), (1,5),\n (2,3), (2,4), (2,3), (2,5),\n (3,3), (3,3), (3,5), (3,3)\n</code></pre>\n\n<p>Here is what I tried so far:</p>\n\n<pre><code>select Student_ID \nfrom StudentMarks \nwhere MAX(AVG(Mark))=AVG(Mark) \nGROUP BY Student_ID\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":8,"favorite_count":7,"up_vote_count":46,"down_vote_count":0,"view_count":42752,"score":46,"question_id":266924,"title":"Create a date with T-SQL","body":"<p>I am trying to convert a date with individual parts such as 12, 1, 2007 into a datetime in SQL Server 2005. I have tried the following:</p>\n\n<pre><code>CAST(DATEPART(year, DATE)+'-'+ DATEPART(month, DATE) +'-'+ DATEPART(day, DATE) AS DATETIME)\n</code></pre>\n\n<p>but this results in the wrong date. What is the correct way to turn the three date values into a proper datetime format.</p>\n"},{"tags":["sql-server","reporting-services","reportviewer","multiple-browsers"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":97,"score":3,"question_id":12918593,"title":"Show entire report in SSRS Report Viewer Web Control?","body":"<p>So I have the SSRS Report Viewer Web control on a WebForm in my project, and it is working as expected now.  </p>\n\n<p>Since the print button does not naturally render in browsers other than IE, I've implemented this solution <a href=\"http://stackoverflow.com/q/4208457/97879\">SSRS print button in Chrome and Firefox</a> to give users in those browsers some ability to still print.</p>\n\n<p>However, several of my reports are multi-page reports.  It would be useful to show the entirety of the report at one time so the user only has to click the print button one time.</p>\n\n<p>I've looked for a setting in the control, and simply do not see one.  As I'm using server reports, it would not be possible to modify the RDL to make the page \"larger\".</p>\n\n<p>What other approach could I take to display the whole multiple page report at one time?</p>\n"},{"tags":["php","sql-server","ldap"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13051426,"title":"Authenthicate bd sql server with ldap php","body":"<p>May sound confusing but whats the code to authenthicate users from a bd in a server using ldap? </p>\n"},{"tags":["sql-server","tsql","dynamic-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13051311,"title":"Is it possible to have dynamic sql based on a subquery without using variables?","body":"<p>I'd like to do the following in T-SQL:</p>\n\n<pre><code>EXEC('... ' + (SELECT ...))\n</code></pre>\n\n<p>A simple concrete example would be</p>\n\n<pre><code>EXEC('DROP TABLE ' + (SELECT name FROM sys.tables WHERE ...))\n</code></pre>\n\n<p>(Obviously, the WHERE clause is chosen such that the subquery always returns exactly one value.) When I try this, I get an error:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Line 1\nIncorrect syntax near '('.\nMsg 102, Level 15, State 1, Line 1\nIncorrect syntax near ')'.\n</code></pre>\n\n<p>I know that I can work around this by using variables, e.g.:</p>\n\n<pre><code>DECLARE @sql varchar(MAX)\nSELECT @sql = 'DROP TABLE ' + name FROM sys.tables WHERE ...\nEXEC(@sql)\n</code></pre>\n\n<p>but for various reasons I'd like to have only one statement. Is that possible?</p>\n\n<hr>\n\n<p>PS: In case it's relevant, that's the dynamic SQL code I'm trying to squeeze into one statement:</p>\n\n<ul>\n<li><a href=\"http://stackoverflow.com/a/1433384/87698\">How to drop SQL default constraint without knowing its name?</a></li>\n</ul>\n"},{"tags":["asp.net","sql-server"],"answer_count":1,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":61,"score":4,"question_id":13019821,"title":"How to maintain SQL Server DB with lots of branches","body":"<p>I have an ASP.NET project under git where we follow the convention of using a branch for a feature. We just started using SQL Server Data Tools to manage schema changes (quite new to it, so I suspect it may have features that get me to what I need).</p>\n\n<p>I am looking for some strategies that have worked for other teams that manage switching between branches that have different DB schemas and then successfully merging branches together. Ideally, after merging all the features, I would have implicitly created a change script(s) to deploy for the release to production. </p>\n\n<p>Note I am using SQL Server 2008 R2</p>\n"},{"tags":["sql-server","bulkinsert"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":42,"score":2,"question_id":13049373,"title":"SQL - Bulk Insert and Data Types","body":"<p>Today I have a bulk insert from fixed width file like this:</p>\n\n<pre><code>BULK INSERT #TBF8DPR501\nFROM 'C:\\File.txt' WITH (\n        FORMATFILE = 'C:\\File.txt.xml'\n        ,ROWTERMINATOR = '\\n'\n        )\n</code></pre>\n\n<p>The format file is just to set the width of each field, and after the bulk insert into the temp table, I crated an <code>INSERT INTO X SELECT FROM temp</code> to convert some columns that the bulk cannot convert.</p>\n\n<p>My question is, is it possible to make the bulk insert be able to convert values such as:</p>\n\n<ul>\n<li>Date in format <code>dd.MM.yyyy</code> OR <code>ddMMyyyy</code> </li>\n<li>Decimal values like this <code>0000000000010022</code> (where it is <code>100.22</code>)</li>\n</ul>\n\n<p>Without the need to make the bulk insert into a temp table to convert the values?</p>\n"}]}
{"total":54452,"page":16,"pagesize":100,"questions":[{"tags":["sql-server","triggers","auditing"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":249,"score":2,"question_id":6169932,"title":"ORIGINAL_LOGIN and SYSTEM_USER functions for auditing?","body":"<p>I am implementing an inserted trigger and am considering using ORIGINAL_LOGIN function to capture the current executing user. I would like to know the pros and cons of using ORIGINAL_LOGIN for auditing. Under what scenario does SYSTEM_USER provide a better alternative to ORIGINAL_LOGIN?</p>\n"},{"tags":[".net","sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13050665,"title":"Determine whether SqlException is due to network issue","body":"<p>I need to be able to test whether a System.Data.SqlClient.SqlException is due to a network error or not (.NET environment connecting to MS SQL Server).  If it is, I can tell the user that there is a problem with his connection, whereas if it is not, it is most likely a bug in my code which is to be treated differently.  Obviously, it is crucial not to have false positives (declare somehting a network problem when it is a bug).</p>\n\n<p>In a related question <a href=\"http://stackoverflow.com/questions/7481076/identifying-sqlexception-due-to-network-problem\">over here</a> it was suggested to extract the information from the exception text.  This is ugly and difficult in my case, since the text is localized, and might be different depending on the environment.</p>\n\n<p>For the time being, I examine the call stack for certain function calls, which (by experience) are associated with network problems:</p>\n\n<pre><code>System.Data.SqlClient.TdsParserStateObject.WritePacket\nSystem.Data.SqlClient.TdsParserStateObject.ReadNetworkPacket\nSystem.Net.Sockets.SocketException\n</code></pre>\n\n<p>However, none of these pops up if there is a timeout while executing, for instance, a SELECT query.  So there, I would have to revert to checking whether \"Timeout\" appears in the exception message, which is ugly.</p>\n\n<p>Does anyone out there have a better idea?</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13050965,"title":"How can I query a record where a varchar(MAX) column contains a specific hex value?","body":"<p>When trying to convert records to xml in sql, I get the following error message:</p>\n\n<blockquote>\n  <p>Msg 6841, Level 16, State 1, Procedure trg_missacct_upd_del, Line 58<br>\n  FOR XML could not serialize the data for node 'AltAddr' because it contains a character (0x0002)which is not allowed in XML. To retrieve\n  this data using FOR XML, convert it to binary, varbinary or image data\n  type and use the BINARY BASE64 directive.</p>\n</blockquote>\n\n<p>I want to write a query to find which record has this hex value (0x0002).  I've tried something like this:</p>\n\n<pre><code>select * from missacct where altaddr like '%' + 0x0002 + '%'\n</code></pre>\n\n<p>Is there a way to query out this record?</p>\n"},{"tags":["c#","asp.net","sql-server","sqlbulkcopy"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13050556,"title":"SqlBulkCopy ColumnMappings not working","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13044772/unable-to-compare-the-columns-in-sqlbulkcopy\">Unable to compare the columns in SqlBulkCopy</a>  </p>\n</blockquote>\n\n\n\n<p>I have an excel sheet with columns :</p>\n\n<pre><code>excelid | exceldata\n1       | cat\n2       | bat\n3       | rat\n</code></pre>\n\n<p>My database table:</p>\n\n<pre><code>id (int) | varchar(50)\n</code></pre>\n\n<p>following is my code: </p>\n\n<pre><code>protected void Button1_Click(object sender, EventArgs e)\n{\n    string strFileType = System.IO.Path.GetExtension(FileUpload1.FileName).ToString().ToLower();\n    string strFileName = FileUpload1.PostedFile.FileName.ToString();\n\n    FileUpload1.SaveAs(Server.MapPath(\"~/Import/\" + strFileName + strFileType));\n    string strNewPath = Server.MapPath(\"~/Import/\" + strFileName + strFileType);\n\n    string excelConnectionString = String.Format(@\"Provider=Microsoft.Jet.OLEDB.4.0;\" + \"Data Source=\"+strNewPath +\"; Extended Properties=Excel 8.0;\");\n\n    //string excelConnectionString = String.Format(@\"Provider=Microsoft.Jet.OLEDB.4.0;\" + \"Data Source=C:\\\\myFolder\\\\Book1.xls;\" + \"Extended Properties=Excel 8.0;\"); \n\n\n        // Create Connection to Excel Workbook\n        using (OleDbConnection connection = new OleDbConnection(excelConnectionString))\n        {\n            OleDbCommand command = new OleDbCommand(\"Select ID,Data FROM [Sheet1$]\", connection);\n\n            connection.Open();\n\n            // Create DbDataReader to Data Worksheet\n            using (DbDataReader dr = command.ExecuteReader())\n            {\n                // SQL Server Connection String\n                string sqlConnectionString = \"Data Source=ARBAAZ-1B14C081;Initial Catalog=abc;Integrated Security=True\";\n\n                con.Open();\n                DataTable dt1 = new DataTable();\n                string s = \"select count(*) from ExcelTable\"; \n                string r = \"\"; \n                SqlCommand cmd1 = new SqlCommand(s, con);\n                try \n                { \n                    SqlDataAdapter da1 = new SqlDataAdapter(cmd1); \n                    da1.Fill(dt1);\n                }\n                catch { } \n                int RecordCount; \n                RecordCount = Convert.ToInt32(cmd1.ExecuteScalar());\n                r = RecordCount.ToString(); \n                Label1.Text = r;\n                con.Close();\n                int prv = Convert.ToInt32(r);\n\n\n\n\n\n                // Bulk Copy to SQL Server\n                using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n                {\n\n\n\n                    bulkCopy.DestinationTableName = \"ExcelTable\";\n\n\n                    SqlBulkCopyColumnMapping mapping1 = new SqlBulkCopyColumnMapping(\"id\", \"id\");\n                    SqlBulkCopyColumnMapping mapping2 = new SqlBulkCopyColumnMapping(\"data\", \"data\");\n\n                    bulkCopy.ColumnMappings.Add(mapping1);\n                    bulkCopy.ColumnMappings.Add(mapping2);\n\n\n                    bulkCopy.WriteToServer(dr);\n\n                }\n                con.Open();\n\n\n\n                DataTable dt = new DataTable(); \n                s = \"select count(*) from ExcelTable\";  r = \"\"; \n                SqlCommand cmd = new SqlCommand(s, con); \n                try { SqlDataAdapter da = new SqlDataAdapter(cmd);\n                    da.Fill(dt); \n                }\n                catch { } \n                RecordCount = Convert.ToInt32(cmd.ExecuteScalar()); \n                r = RecordCount.ToString(); Label1.Text = r;\n                con.Close();\n                int ltr = Convert.ToInt32(r);\n                if (prv == ltr)\n                {\n                    Label1.Text = \"No records Added\";\n                }\n                else\n                {\n                    Label1.Text = \"Records Added Successfully !\";\n                }\n\n            }\n        }\n\n    }\n//protected void Button2_Click(object sender, EventArgs e)\n//{\n//    string fileName = FileUpload1.PostedFile.FileName.ToString();\n//    Response.Write(fileName);\n//}\nprotected void Button2_Click(object sender, EventArgs e)\n{\n\n}\n</code></pre>\n"},{"tags":["sql-server","join","distinct","case"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":54,"score":3,"question_id":13050536,"title":"Display Distinct data from Join query","body":"<p>Basically I have 2 tables. Lets say A and B.</p>\n\n<p>A has columns like id(PK), pin, name, address</p>\n\n<pre><code>id(PK)  pin             name    address\n1        aaa-111-aaa    AAA ------\n2        bbb-222-bbb    BBB ------\n3        ccc-333-ccc    CCC --------\n</code></pre>\n\n<p>B has columns like appName, apprequestTime, appAccectTime, id(FK).</p>\n\n<pre><code>appName apprequestTime  appAccectTime    id(FK).\nLLL          2012-4-01  2012-4-01    1\nNNN          2012-4-08  2012-5-01    2\nQQQ          2012-4-05  2012-4-01    1\nMMM          2012-4-02  2012-4-02    2\nPPP          2012-5-01  2012-5-01    1\n</code></pre>\n\n<p>There can be multiple id rows in the B table as it is Foreign Key.</p>\n\n<p>Now, the problem is I am trying to get all the records of one pin of a certain apprequestTime.</p>\n\n<p>I am trying inner join but it shows  the pin because of the id in table B.</p>\n\n<pre><code>pin         apprequestTime\naaa-111-aaa     2012-4-01\naaa-111-aaa     2012-4-05\nbbb-222-bbb     2012-4-08\nbbb-222-bbb     2012-4-02\n</code></pre>\n\n<p>but the result I am expecting should be:</p>\n\n<pre><code>pin            apprequestTime\naaa-111-aaa    2012-4-01\n               2012-4-05\nbbb-222-bbb    2012-4-08\n               2012-4-02\n</code></pre>\n\n<p>Can any one help:)</p>\n"},{"tags":["sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":13030257,"title":"SQL Server : getting \"invalid column name\"","body":"<p>I am working on writing a query but there are problems which I couldn't find. Here is my code</p>\n\n<pre><code>begin\n    declare @v_max int\n    declare @v_count int\n    declare @sessionID int\n    declare @sessionStart datetime\n    declare @sessionEnd datetime\n\n    declare my_cursor cursor local for\n        select * from Test;\n\n    open my_cursor\n    fetch next from my_cursor INTO @sessionID, @sessionStart, @sessionEnd\n\n    while @@FETCH_STATUS = 0\n    begin\n        select *  into **@v_count**\n        from [dbo].[Test]\n        WHERE **[dbo].[Test].[SessionStartTime]** &gt; @sessionStart\n        OR **[dbo].[Test].[SessionCloseTime]** &lt; @sessionEnd\n\n        if @v_count &gt; @v_max \n            set @v_max = @v_count\n\n\n        fetch next from my_cursor INTO @sessionID, @sessionStart, @sessionEnd\n    end\n\n    print @v_max;\n\n    close my_cursor\n    deallocate my_cursor\nend \n</code></pre>\n\n<p>Bolded areas have problems:</p>\n\n<blockquote>\n  <p>Msg 207, Level 16, State 1, Line 18<br>\n  Invalid column name 'SessionStartTime'.<br>\n  Msg 207, Level 16, State 1, Line 19<br>\n  Invalid column name 'SessionCloseTime'.<br>\n  Msg 102, Level 15, State 1, Line 16<br>\n  Incorrect syntax near '@v_count'.</p>\n</blockquote>\n\n<p>Here is my Table</p>\n\n<pre><code>CREATE TABLE [dbo].[Test]( \n    [ScenarioID] [bigint] NULL, \n    [SessionStartTime] [datetime] NOT NULL, \n    [SessionCloseTime] [datetime] NULL \n) ON [PRIMARY] \n</code></pre>\n\n<hr>\n\n<p>Here is my Table</p>\n\n<pre><code>CREATE TABLE [dbo].[Test](\n    [ScenarioID] [bigint] NULL,\n    [SessionStartTime] [datetime] NOT NULL,\n    [SessionCloseTime] [datetime] NULL\n) ON [PRIMARY]\n\nGO\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","triggers","datatrigger"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13049724,"title":"MS Sql Server Triggers (2) executing at the same time: How do I catch what's causing it?","body":"<p>So I have 2 triggers on a table in my dbase. It's purpose is to log any data manipulation activities done by the user or by a third party import/export. The table where it saves it to have a datestamp which obviously marks when it was executed. For some reason, when this third party SSIS package writes a record to it it would trigger the triggers (as expected) but will have the exact same time. 1 record for inserting the record, and another record for updating the record. The problem is the datestamp is exactly the same up to the millisecond.</p>\n\n<p>Any ideas on how I can track the cause of this? Should I be looking at the SSIS package? I dont think that would cause the 2 triggers tho.</p>\n\n<p>Thanks for your time!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","database-tuning","sql-tuning"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13049452,"title":"SQL Server audit logout creates huge number of reads","body":"<p>I'm using SQL Server Profiler to figure out what process are consuming SQL process and I found that the event class <code>Audit Logout</code> is causing a huge number of reads and consume cpu process.</p>\n\n<p>Is it normal? Or do I have something wrong in the SQL Server configuration?</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2008","sql-execution-plan"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13047903,"title":"SQL Server : delay before output (a print statement) is produced","body":"<p>I may have a slight feeling as to what is going on, but I thought I'd ask to get confirmation, and potentially look at an alternative.</p>\n\n<p>As a slight background, I've written a C# application that is providing a small front end to a stored procedure. The procedure contains a number of temporary table inserts from other stored procedures (and one table valued udf), and some xml processing.</p>\n\n<p>In order to get a sense of how far along I am in the stored procedure, I'm subscribing to the <code>InfoMessage</code> (using an <code>SqlInfoMessageEventHandler</code>) from an <code>SqlConnection</code>. I've put some informative print statements in various places throughout the SP, so I can get a sense of the processing which has completed and update a status bar accordingly).</p>\n\n<p>The rough structure of the SP is along these lines:</p>\n\n<pre><code>Print 'Beginning processing'\n\nCreate Temp Table\nInsert into Temp Table from Table Valued UDF\n\nPrint 'Creating working Tables'\nCreate more Temp Tables\nInsert into Temp Tables from SPs (each SP contains a print statement e.g 'Starting SP1').\n</code></pre>\n\n<p>All the messages are received and processed successfully, but there is a delay of a few seconds before any messages are returned from the server, then the first few arrive all at once (as though they were all processed but the output was held back for a while).</p>\n\n<p>I had naively assumed (I still have a lot to learn about DB mechanics) that my initial print statement would be returned before any of the other processing instructions within the SP took place.</p>\n\n<p>I assume that the server is doing something regarding fetching execution plans an/or potentially recalculating plans, or is it the case that query optimiser is doing some preprocessing before any results at all are returned?</p>\n\n<p>Hopefully my question is reasonably understandable from that mess of text. Essentially, would the query optimiser make the server perform some of the selects/inserts before the procedure actually begins sequentially encountering my print statements?</p>\n\n<p>I also tried doing some small temp table manipulation before my initial print statement, so some rows would be returned before the slow operations began but the result was much the same.</p>\n\n<p>Thanks for any responses.</p>\n"},{"tags":["sql","sql-server","rownumber","row-number"],"answer_count":6,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":54239,"score":8,"question_id":961007,"title":"How do I use ROW_NUMBER() in SQL?","body":"<p>I want to use the <code>ROW_NUMBER()</code> to get...</p>\n\n<ol>\n<li>To get the <code>max(ROW_NUMBER())</code> --> Or i guess this would also be the count of all rows</li>\n</ol>\n\n<p>I tried doing:</p>\n\n<pre><code>SELECT max(ROW_NUMBER() OVER(ORDER BY UserId)) FROM Users\n</code></pre>\n\n<p>but it didn't seem to work...</p>\n\n<ol>\n<li>To get <code>ROW_NUMBER()</code> using a given piece of information, ie. if I have a name and I want to know what row the name came from.</li>\n</ol>\n\n<p>I assume it would be something similar to what I tried for #1</p>\n\n<pre><code>SELECT ROW_NUMBER() OVER(ORDER BY UserId) From Users WHERE UserName='Joe'\n</code></pre>\n\n<p>but this didn't work either...</p>\n\n<p>Any Ideas?</p>\n"},{"tags":["sql-server"],"answer_count":11,"favorite_count":9,"up_vote_count":23,"down_vote_count":0,"view_count":52213,"score":23,"question_id":941763,"title":"List the queries running on SQL Server","body":"<p>Is there a way to list the queries that are currently running on MS SQL Server (either through the Enterprise Manager or SQL) and/or who's connected?</p>\n\n<p>I think I've got a very long running query is being execute on one of my database servers and I'd like to track it down and stop it (or the person who keeps starting it).</p>\n"},{"tags":["sql-server","tsql","stored-procedures","sqlparameters"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":47,"score":0,"question_id":13048641,"title":"Dynamic parameters for sql query with \"IN\" operator","body":"<p>I have an ASP.NET website (c#) and in the code-behind I want to use the <code>IN</code> operator in SQL <a href=\"http://www.w3schools.com/sql/sql_in.asp\" rel=\"nofollow\">http://www.w3schools.com/sql/sql_in.asp</a> to get data from my database. </p>\n\n<p>The syntax is:</p>\n\n<pre><code>SELECT column_name(s)\nFROM table_name\nWHERE column_name IN (value1,value2,...)\n</code></pre>\n\n<p>I use a stored procedure to get data, inside this procedure I run, in the end, the select. </p>\n\n<p>My question is how to build dynamically the (<code>value1, value2, ...</code>) part of the query? How do I send as <code>SqlParameter</code>(s) the values that appear in the <code>IN</code> operator?</p>\n\n<p>The stored procedure is defined like this:</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[GetAllUsers]\n    @ORGANIZATION_ID int = null\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    begin\n       SELECT * \n       from USERS\n       where ORGANIZATION_ID = @ORGANIZATION_ID\n    end\nEND\n</code></pre>\n\n<p>I'd like to replace the <code>WHERE</code> clause with something like: </p>\n\n<pre><code>WHERE ORGANIZATION in (xxxxxxxxxxxxx)\n</code></pre>\n\n<p>How to do this?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10802,"score":0,"question_id":4985448,"title":"SQL Server 2008 - Login failed for user 'user1' The user is not associated with a trusted SQL Server connection","body":"<p>I have installed SQL Server 2008 R2 on Windows XP.</p>\n\n<p>In installation process I selected 'SQL Server and Windows Authentication Mode'</p>\n\n<p>When I click right button of the mouse in SQL Server Management Studio on Server -> Security tab 'SQL server and Windows Authentication Mode' is selected.</p>\n\n<p>But when I click on my Database -> Properties - View connection properties Authentication Method is set on Windows Authentication.</p>\n\n<p>To my database was added one <code>user1</code> with password <code>user1</code>.</p>\n\n<p>But I can't log in to my database from C# (Visual Studio 2008) because error occurs:</p>\n\n<blockquote>\n  <p>Login failed for user 'user1'  The\n  user is not associated with a trusted\n  SQL Server connection</p>\n</blockquote>\n\n<p>What isn't right ?</p>\n\n<hr>\n\n<p>When I get:</p>\n\n<pre><code>string connectionStr = @\"Data Source=rmzcmp\\SQLExpress;Initial Catalog=ResourcesTmp;Integrated Security=True\";\n</code></pre>\n\n<p>I have following error:</p>\n\n<p>{\"Cannot open database \\\"ResourcesTmp\\\" requested by the login. The login failed.\\r\\nLogin failed for user 'RMZCMP\\rm'.\"}</p>\n\n<p>rm is my original user name on which I log in to my computer.\nWhen I get rm I have error:</p>\n\n<pre><code>{\"Login failed for user 'rm'. The user is not associated with a trusted SQL Server connection.\"}\n</code></pre>\n\n<p>again.</p>\n\n<p>Regards</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","set-based"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":84,"score":6,"question_id":13030723,"title":"Trying to avoid RBAR! How to correlate an insert on a related table as a set based operation?","body":"<p>Assume a schema that consists of the following tables:</p>\n\n<p><strong>Baz</strong></p>\n\n<pre><code>BazID (PK, Identity)\nDescription\n</code></pre>\n\n<p><strong>FooTemplate</strong> (A Baz may have zero to many FooTemplates)</p>\n\n<pre><code>FooTemplateID (PK, Identity)\nBazID (FK)\nDescription\nNextGenerationDate\n</code></pre>\n\n<p><strong>BarTemplate</strong> (A FooTemplate may have zero to many BarTemplates)</p>\n\n<pre><code>BarTemplateID (PK, Identity)\nFooTemplateID (FK)\nDescription\n</code></pre>\n\n<p><strong>Foo</strong> (A Baz may have zero to many Foos)</p>\n\n<pre><code>FooID (PK, Identity) \nBazID (FK)\nDescription\n</code></pre>\n\n<p><strong>Bar</strong> (A Foo may have zero to many Bars)</p>\n\n<pre><code>BarID (PK, Identity)\nFooID (FK)\nDescription\n</code></pre>\n\n<p>Each day a stored procedure will execute to generate <code>Foo</code> and <code>Bar</code> entities for an associated <code>Baz</code> entity which have passed their next generation date.</p>\n\n<p>The first part of this procedure looks a little like this:</p>\n\n<pre><code>DECLARE @GeneratedFooIDList TABLE (INT FooID);\nINSERT Foo (BazID, Description)\nOUTPUT inserted.FooID INTO @GeneratedFooIDList\nSELECT\n  BazID\n  Description\nFROM\n  FooTemplate\nWHERE\n  NextGenerationDate &lt; GETDATE()\n</code></pre>\n\n<p>My question is what statement can I now execute to generate the proper <code>Bar</code> entities and have them properly associated with the newly created <code>Foo</code> entities?</p>\n\n<p><strong>EDIT:</strong> The procedure will be executing on a server running SQL Server 2005.</p>\n\n<p><strong>EDIT2:</strong> Thanks to everybody for the help.  After considering the information carefully, I have opted for another solution.  I have changed the primary key in the Foo table to no longer be an automatically generated identity column, this way an intermediary insert into a temporary table could be executed to capture the relevant FooTemplateID along with the FooID</p>\n"},{"tags":["sql-server","security"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":36,"score":0,"question_id":13048885,"title":"Login failed for user 'my-PC\\my'","body":"<p>Why I have this error:</p>\n\n<p><b>  Cannot open database \"source\" requested by the login. The login failed.</p>\n\n<p>Login failed for user 'my-PC\\my' </b> ?.</p>\n\n<p>I use \"windows\" mode. From visual I can access data, but when I run it (asp project) I get an error.I get this eror when replaced database in project with modified version from Management Studio (I modified only stored procedure that's not invoking in project). I read some articles and in security option allowed 'my-PC\\my' all operations.No effect.</p>\n\n<p><b>EDIT:</b></p>\n\n<p>here is my connection string:</p>\n\n<pre><code>    \"Server=(local);Database=source;Integrated Security=SSPI;\"\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":67,"score":1,"question_id":12997059,"title":"How to connect to SQL Server from inside virtual machine","body":"<p>I have Windows 7 (host) along with SQL Server 2012 installed on it, I am running Windows server 2008 R2 in (guest) virtual machine using Oracle Virtual Box.</p>\n\n<p>I want to connect to my host SQL Server from inside guest, so far I have enable network protocol for both my server &amp; browser service.</p>\n\n<p>I also enable bridge adapter and NAT adapter for virtual box.</p>\n\n<p>After I browse network server from inside guest I can see my host SQL Server.</p>\n\n<p>I have created an user say x which uses SQL Server authentication for connection.</p>\n\n<p>When I tried to connect using x in host it works but not from guest.</p>\n\n<p>I get this error:</p>\n\n<blockquote>\n  <p><em>Cannot connect to <code>VIVEK-PC\\SQLEXPRESS</code>.</em></p>\n  \n  <p><em>A network-related or instance-specific error occurred while\n  establishing a connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: SQL\n  Network Interfaces, error: 26 - Error Locating Server/Instance\n  Specified) (Microsoft SQL Server, Error: -1)</em></p>\n</blockquote>\n\n<p>Can someone help ? , thanks in advance.</p>\n"},{"tags":["sql-server","function"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13030666,"title":"SQL Server variable return datatype (function)","body":"<p>Is it possible to create a function in SQL Server which returns different data types back (depending on the variable you got)?</p>\n\n<p>I have searched the web and msdn, but did not found anything useful.</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13048674,"title":"Best practice for insert and select data from two different databases","body":"<p>Which one is the best practice for insert and select data from two different databases that are on two different servers in SQL Server and how can i handle the situation like server-1 down time ?</p>\n"},{"tags":["sql-server","ssis"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1543,"score":1,"question_id":3437600,"title":"Looping RecordSet Destination in SSIS Script Task","body":"<p>How to loop through / access values of RecordSet Destination in SSIS Script Task.</p>\n"},{"tags":["sql-server","database","ms-access-2010"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":245,"score":2,"question_id":3467100,"title":"convert an MSAccess DataBase to an SQL Server database","body":"<p>I want to know if there is a way to convert an MSAccess DataBase to a SQL Server database without starting from the beginning.</p>\n"},{"tags":["sql-server","data-mining","cluster-analysis","crm","k-means"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":38,"score":-1,"question_id":13048330,"title":"applying K means for customer segmentation profiling","body":"<p>how to perform k means clustering in c#. My thought is to implement this in following way on students :\n-collect data using asp.net website\n-storing it on server \n-analysing data\n-representing dashboard in asp</p>\n\n<p>what is Microsoft business intelligence.what do i need to study to implement this project..\nany tools/architecture/algorithm</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13046619,"title":"Query to get list active queries in my SQL Server","body":"<p>I want to get a list of information of active queries that are running in my SQL Server (in order to kill a few of those queries).</p>\n\n<p>I want a query to get this required information:</p>\n\n<pre><code>| query_id (if possible) | query_text | query_start_time | time_elapsed | host_name | user_group | query_status |\n</code></pre>\n\n<p>I am new to SQL Server please suggest....</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":34,"score":2,"question_id":13043947,"title":"Is it possible to insert wrong info in the MsSql database when we use transactions","body":"<p>So Theoretically is it possible to insert information partially in the database when we use transactions. For example the insert happens and suddenly we lose electricity. Will there be a case when one record will be written to tableA and it wouldn't be written to tableB?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12979367,"title":"Date data from Text file to date time in SQL Server","body":"<p>I am using one flat file as source which have couple of columns belong to Date format and I have placed all the data into the SQL Server table which predefined.</p>\n\n<p>Example:-</p>\n\n<p>Flat file</p>\n\n<pre>CaseNO|CaseType|CDate\n1     |ORG     |1\\12\\2012\n2     |PGD     |3\\3\\2011\n</pre>\n\n<p>here when I check it with data viewer, Its looks like 2012-12-1 00:00:00.0000000. but the OLE DB connection creates the following errors.</p>\n\n<pre><code>[OLE DB Destination [7546]] Error: There was an error with input column \n\"CDate\" (8799) on input \"OLE DB Destination Input\" (7559). The column status\nreturned was: \"The value could not be converted because of a potential loss of data.\".\n</code></pre>\n\n<p>Please guide me...Appreciated your help.</p>\n\n<p>343</p>\n"},{"tags":["sql","sql-server","sqlcommand"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13047374,"title":"SQL 'ONCREATE' command","body":"<p>I am using DeZign for Databased v6 to design my sql database.</p>\n\n<p>It has worked perfectly, up until this current view SQL code:</p>\n\n<pre><code>CREATE VIEW %viewname%\nAS\nSELECT     dbo.tblSiteChallengeMember.id, tblSiteMemberDetail_2.memberNickname AS mediator, dbo.tblSiteGame.name AS gameName,\n                      tblSiteMemberDetail_1.memberNickname AS teamMemberName, dbo.tblSiteChallengeMemberTeam.accepted, dbo.tblSiteChallengeMemberTeam.teamNumber,\n                      dbo.tblSiteChallengeMember.matchDate, dbo.tblSiteChallengeMember.dateAdded, dbo.tblSiteChallengeMember.completed,\n                      dbo.tblSiteMemberDetail.memberNickname AS creatorName, dbo.tblSiteChallengeMediator.refferalCount,\n                      dbo.tblSiteChallengeMediator.dateAdded AS mediatorJoinDate\nFROM         dbo.tblSiteChallengeMemberWin RIGHT OUTER JOIN\n                      dbo.tblSiteChallengeMember INNER JOIN\n                      dbo.tblSiteMemberDetail ON dbo.tblSiteChallengeMember.creatorId = dbo.tblSiteMemberDetail.id ON\n                      dbo.tblSiteChallengeMemberWin.challengeId = dbo.tblSiteChallengeMember.id LEFT OUTER JOIN\n                      dbo.tblSiteMemberDetail AS tblSiteMemberDetail_1 INNER JOIN\n                      dbo.tblSiteChallengeMemberTeam ON tblSiteMemberDetail_1.id = dbo.tblSiteChallengeMemberTeam.memberId ON\n                      dbo.tblSiteChallengeMember.id = dbo.tblSiteChallengeMemberTeam.challengeId RIGHT OUTER JOIN\n                      dbo.tblSiteGame ON dbo.tblSiteChallengeMember.gameId = dbo.tblSiteGame.id LEFT OUTER JOIN\n                      dbo.tblSiteMemberDetail AS tblSiteMemberDetail_2 INNER JOIN\n                      dbo.tblSiteChallengeMediator ON tblSiteMemberDetail_2.id = dbo.tblSiteChallengeMediator.memberId ONCREATE VIEW %viewname%\nAS\nSELECT     dbo.tblSiteChallengeMember.id, tblSiteMemberDetail_2.memberNickname AS mediator, dbo.tblSiteGame.name AS gameName,\n                      tblSiteMemberDetail_1.memberNickname AS teamMemberName, dbo.tblSiteChallengeMemberTeam.accepted, dbo.tblSiteChallengeMemberTeam.teamNumber,\n                      dbo.tblSiteChallengeMember.matchDate, dbo.tblSiteChallengeMember.dateAdded, dbo.tblSiteChallengeMember.completed,\n                      dbo.tblSiteMemberDetail.memberNickname AS creatorName, dbo.tblSiteChallengeMediator.refferalCount,\n                      dbo.tblSiteChallengeMediator.dateAdded AS mediatorJoinDate\nFROM         dbo.tblSiteChallengeMemberWin RIGHT OUTER JOIN\n                      dbo.tblSiteChallengeMember INNER JOIN\n                      dbo.tblSiteMemberDetail ON dbo.tblSiteChallengeMember.creatorId = dbo.tblSiteMemberDetail.id ON\n                      dbo.tblSiteChallengeMemberWin.challengeId = dbo.tblSiteChallengeMember.id LEFT OUTER JOIN\n                      dbo.tblSiteMemberDetail AS tblSiteMemberDetail_1 INNER JOIN\n                      dbo.tblSiteChallengeMemberTeam ON tblSiteMemberDetail_1.id = dbo.tblSiteChallengeMemberTeam.memberId ON\n                      dbo.tblSiteChallengeMember.id = dbo.tblSiteChallengeMemberTeam.challengeId RIGHT OUTER JOIN\n                      dbo.tblSiteGame ON dbo.tblSiteChallengeMember.gameId = dbo.tblSiteGame.id LEFT OUTER JOIN\n                      dbo.tblSiteMemberDetail AS tblSiteMemberDetail_2 INNER JOIN\n                      dbo.tblSiteChallengeMediator ON tblSiteMemberDetail_2.id = dbo.tblSiteChallengeMediator.memberId ON\n                      dbo.tblSiteChallengeMember.mediatorId = dbo.tblSiteChallengeMediator.id\n</code></pre>\n\n<p>Which throws a SQL error:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Procedure vwGetChallengeDetails, Line 19\nIncorrect syntax near 'ONCREATE'.\n</code></pre>\n\n<p>I am still fairly new to databasing, but I have never seen the ONCREATE command (<strong>above AS in the code</strong>). Could someone please check this and tell me what's wrong?</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":55,"score":3,"question_id":13047035,"title":"sql - How can I count the differences of two rows?","body":"<p>I have a table like this:</p>\n\n<pre><code>Item    ProviderId\n\nItem1   1\n\nItem1   2\n\nItem2   1\n\nItem3   1\n</code></pre>\n\n<p>I wish to get a new table. In the new table, it only lists the <code>item</code>s who has at least two different <code>ProviderId</code>s.</p>\n\n<p>So in the above example, since only <code>item1</code> has two different <code>ProviderId</code> I wish to get table like this:</p>\n\n<pre><code>Item\n\nItem1\n</code></pre>\n\n<p>How can I write the statement to do this?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13047490,"title":"SQL Server Criteria not working when values are NULL","body":"<p>Is there a way to capture all values that are <code>FieldName &lt;&gt; 'Value'</code>, that will return records where FieldName is NULL, without saying <code>(FieldName &lt;&gt; 'Value' OR FieldName IS NULL</code>) for every criteria field?</p>\n"},{"tags":["sql-server","sql-server-2008","delphi","delphi-xe2","ado"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":140,"score":4,"question_id":13028162,"title":"How to insert a string containing #0 in a NVARCHAR() column in MSSQL?","body":"<p>I'm sure this has a very simple solution, but I've exhausted my resources. I need to insert a bunch of <code>WideString</code> variables which may contain <code>#0</code> into a <code>NVARCHAR(1024)</code> column in MSSQL2k8. <code>#0</code> is treated as the string terminator somewhere in the transition... So, when I store <code>#6'r'#0'abc'</code>, only <code>#6'r'</code> is stored. I'm using <code>TADOQuery</code>. What can I do about this?</p>\n\n<hr>\n\n<p>Here's the code I use:</p>\n\n<pre><code>var\n  S: string;\nbegin\n  S := #6'r'#0'abc';\n  ADOQuery1.Append;\n  ADOQuery1S.Value := S;\n  { At this point, S = #6'r'#0'abc' and ADOQuery1S.Value = #6'r';}\n  ADOQuery1.Post;\nend;\n</code></pre>\n"},{"tags":["java","sql-server","netbeans-6.9"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13046920,"title":"Error : [Microsoft][ODBC SQL Server Driverr][SQL Server]Insert Error: Column name or number of supplied values does not match table definition","body":"<p>I am using MS SQL Server 2005 with Netbeans 6.9 for my Java Project.</p>\n\n<p>Here's my Table structure (inside SSMS 2005) :</p>\n\n<p><a href=\"http://i.stack.imgur.com/bwTuH.png\" rel=\"nofollow\">http://i.stack.imgur.com/bwTuH.png</a></p>\n\n<p>Now, in Netbeans, I am using this code snippet to save an entered name into the 'name' column :</p>\n\n<pre><code> if(e.getSource().equals(submit))\n    {\n        try\n        {\n            String str=\"insert into TETRISUSERS values(?,'0')\";\n            Class.forName(\"sun.jdbc.odbc.JdbcOdbcDriver\");\n            Connection con=DriverManager.getConnection(\"jdbc:odbc:java\",\"sa\", \"123456\");\n            PreparedStatement stmt=con.prepareStatement(str);\n            stmt.setString(1,username.getText());\n\n            stmt.executeUpdate();\n        }\n        catch(Exception ex)\n        {\n            JOptionPane.showMessageDialog(name1,\"Error : \"+ex.getMessage());\n        }\n</code></pre>\n\n<p>Now when I run the project and enter a name, I get the following error :</p>\n\n<p><strong>Error : [Microsoft][ODBC SQL Server Driverr][SQL Server]Insert Error: Column name or number of supplied values does not match table definition.</strong></p>\n\n<p>I also tried using using direct column names in the insert into command like below :</p>\n\n<pre><code>   try\n        {\n            String str=\"insert into TETRISUSERS(ID,name,highscore) values(?,'0',?)\";\n            Class.forName(\"sun.jdbc.odbc.JdbcOdbcDriver\");\n            Connection con=DriverManager.getConnection(\"jdbc:odbc:java\",\"sa\", \"007007\");\n            PreparedStatement stmt=con.prepareStatement(str);\n            stmt.setString(1,username.getText());\n\n            stmt.executeUpdate();\n        }\n</code></pre>\n\n<p>But that way I get this error :</p>\n\n<p><strong>Error : [Microsoft][ODBC SQL Serever Driver]COUNT field incorrect or syntax error</strong></p>\n\n<p>Lastly, I tried using this :</p>\n\n<pre><code>try\n        {\n            String str=\"insert into TETRISUSERS(ID,name) values(?,'0')\";\n            Class.forName(\"sun.jdbc.odbc.JdbcOdbcDriver\");\n            Connection con=DriverManager.getConnection(\"jdbc:odbc:java\",\"sa\", \"007007\");\n            PreparedStatement stmt=con.prepareStatement(str);\n            stmt.setString(1,username.getText());\n\n            stmt.executeUpdate();\n        }\n</code></pre>\n\n<p>And I got this Error :</p>\n\n<p><strong>Error: General Error</strong></p>\n\n<p>Can Anyone please guide me where I am wrong ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":70,"score":1,"question_id":13036520,"title":"Why is cross apply making the query slow?","body":"<p>I have a query which is taking about 11 seconds to run for a single date. I want to run the same query for more multiple days. In other words, I want to be able to return snapshots for multiple days. Here is my original query:</p>\n\n<pre><code>SELECT \n    COUNT(*) AS 'Number of Cars',\n    d.ManufacturerName AS 'Make',\n    d.Name AS 'Model', \n    c.name AS 'Car Class'\nFROM CarRating a \n    INNER JOIN OwnedCar b ON a.OwnedCarID = b.OwnedCarID\n    INNER JOIN CarClass c ON a.CarClassID = c.CarClassID\n    INNER JOIN BaseCar d ON b.BaseCarID = d.BaseCarID\n\nWHERE \n    @myDate &lt; a.ExpiredWhen AND @myDate  &gt;= a.EffectiveWhen \nGROUP BY \n    d.Name, c.name,d.ManufacturerName\n</code></pre>\n\n<p>Like I mentioned the query about takes 11 sec. In order to run this query for multiple dates, I am using a date table and cross applying it to the above query:</p>\n\n<pre><code>SELECT [DATE], b.* FROM DimDate \nCROSS APPLY\n    (SELECT \n        COUNT(*) AS 'Number of Cars',\n        d.ManufacturerName AS 'Make',\n        d.Name AS 'Model', \n        c.name AS 'Car Class'\n    FROM CarRating a \n        INNER JOIN OwnedCar b ON a.OwnedCarID = b.OwnedCarID\n        INNER JOIN CarClass c ON a.CarClassID = c.CarClassID\n        INNER JOIN BaseCar d ON b.BaseCarID = d.BaseCarID\n\n    WHERE \n    dimDate.Date &lt; a.ExpiredWhen AND dimDate.Date &gt;= a.EffectiveWhen    \n    GROUP BY \n    d.Name, c.name,d.ManufacturerName) b\n\n WHERE DimDate.Date between @StartDate and @EndDate\n</code></pre>\n\n<p>This query takes 49 sec even for one day. Why is this slow? Is there a better way of doing this?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13045069,"title":"What happens first: calculated persisted fields or ON INSERT TRIGGER updates","body":"<p>I have a table with persisted calculated fields.  It has a trigger that updates some fields based upon a number of fields including the persisted fields.</p>\n\n<p>Which is updated first, the persisted fields or the trigger'd update?</p>\n"},{"tags":[".net","sql","sql-server","service-broker"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":637,"score":4,"question_id":2857250,"title":"What is Service Broker?","body":"<p>What is Service Broker in SQL Server and is it meaningful to enable it in a simple database, not in a distributed database?</p>\n\n<p>(Please do not close this question, I saw other similar questions but none of them answered my question.)</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":10,"favorite_count":2,"up_vote_count":11,"down_vote_count":0,"view_count":9317,"score":11,"question_id":916414,"title":"How can a LEFT OUTER JOIN return more records than exist in the left table?","body":"<p>I have a very basic LEFT OUTER JOIN to return all results from the left table and some additional information from a much bigger table. The left table contains 4935 records yet when I LEFT OUTER JOIN it to an additional table the record count is significatnly larger.</p>\n\n<p>As far as I'm aware it is absolute gospel that a LEFT OUTER JOIN will return all records from the left table with matched records from the right table and null values for any rows which cannot be matched, as such it's my understanding that it should be impossible to return more rows than exist in the left table, but it's happening all the same!</p>\n\n<p>SQL Query follows:</p>\n\n<pre><code>SELECT     SUSP.Susp_Visits.SuspReason, SUSP.Susp_Visits.SiteID\nFROM         SUSP.Susp_Visits LEFT OUTER JOIN\n                      DATA.Dim_Member ON SUSP.Susp_Visits.MemID = DATA.Dim_Member.MembershipNum\n</code></pre>\n\n<p>Perhaps I have made a mistake in the syntax or my understanding of LEFT OUTER JOIN is incomplete, whatever the reason I'm going mad here, hopefully someone can explain how this could be occuring?</p>\n\n<p>Postscript</p>\n\n<p>Thanks for the grea answers, my understanding of LEFT OUTER JOINS is now much better, could anyone however suggest a way this query could be modified so that I only get as many records returned as exist in the left table? </p>\n\n<p>This query is purely to generate a report and the duplicate matches simply confuse matters.</p>\n\n<p>/Postscript</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":13043717,"title":"Determine value/column that caused constraint violation in TSQL?","body":"<pre><code>DECLARE @temp AS TABLE (id INT NOT NULL PRIMARY KEY CLUSTERED, name VARCHAR(10))\nBEGIN TRY\ndeclare @Source table (id int not null, name varchar(10))\ninsert @Source\n    SELECT 11,'ABC' union all\n    SELECT 12,'CDE' union all\n    SELECT 13,'FGH' union all\n    SELECT 11,'IJK'\n\nINSERT INTO @temp\nSELECT * from @Source\nSELECT * FROM @temp\n\nEND TRY\nBEGIN CATCH\n EXEC msdb.dbo.sp_send_dbmail\n @profile_name = 'Profile Name', \n @recipients = 'email@email.com', \n @body = Error_Message, \n @subject = Error_Message ; \nEND CATCH;\nGO\n</code></pre>\n\n<p>This is my code working fine .. But what i want to include in the mail is ID which is causing the error as a reminder to some email id in This case it is \"11\".\nHow i can do this in some smart way ..?</p>\n"},{"tags":["sql","sql-server","sql-server-2000"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13045717,"title":"How to make a inner join with condition...?","body":"<p>SQL Server 2000</p>\n\n<p>Using More than 20 views, all the views are inner join with table1 (id and value1 and value2)</p>\n\n<p>Table1</p>\n\n<pre><code>ID Value1 Value2\n\n001 100 null\n001 200 null\n001 300 null\n001 400 null\n001 200 null\n</code></pre>\n\n<p>or</p>\n\n<pre><code>ID Value1 Value2\n\n001 null 100 \n001 null 200 \n001 null 300 \n001 null 400 \n001 null 200 \n</code></pre>\n\n<p>Table2</p>\n\n<pre><code>ID value1 value2\n\n....\n....\n\nsome data's\n</code></pre>\n\n<p>from the table1, either value1 or value2 should always be null. now the problem is if the\nvalue1 or value2 column is null, then output is showing null because all the views are inner join with id, value1, value2</p>\n\n<p>I want to make a inner join with condition, if the value1 is not null then inner join with\nvalue1 or if the value2 is not null then inner join with value2</p>\n\n<p>Query like this</p>\n\n<pre><code>Select * from table2 inner join with table1 on tabel2.id = table1.id and if table1.value1 is null then table2.value2 = table1.value2 or\nelse table2.value1 = table1= value1 end if\n</code></pre>\n\n<p>How to make a query for the above condition</p>\n\n<p>Need SQL Query Help</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13045338,"title":"Error with SqlBulkCopyColumnMapping","body":"<p>I am able to import excel sheet data into sql server table but i am unable to implement column mapping. please help.    </p>\n\n<pre><code>protected void Button1_Click(object sender, EventArgs e)\n{\n    string strFileType = System.IO.Path.GetExtension(FileUpload1.FileName).ToString().ToLower();\n    string strFileName = FileUpload1.PostedFile.FileName.ToString();\n\n    FileUpload1.SaveAs(Server.MapPath(\"~/Import/\" + strFileName + strFileType));\n    string strNewPath = Server.MapPath(\"~/Import/\" + strFileName + strFileType);\n\n\n\n\n\n\n        string excelConnectionString = String.Format(@\"Provider=Microsoft.Jet.OLEDB.4.0;\" + \"Data Source=\"+strNewPath +\"; Extended Properties=Excel 8.0;\");\n\n    //string excelConnectionString = String.Format(@\"Provider=Microsoft.Jet.OLEDB.4.0;\" + \"Data Source=C:\\\\myFolder\\\\Book1.xls;\" + \"Extended Properties=Excel 8.0;\"); \n\n\n        // Create Connection to Excel Workbook\n        using (OleDbConnection connection = new OleDbConnection(excelConnectionString))\n        {\n            OleDbCommand command = new OleDbCommand(\"Select ID,Data FROM [Sheet1$]\", connection);\n\n            connection.Open();\n\n            // Create DbDataReader to Data Worksheet\n            using (DbDataReader dr = command.ExecuteReader())\n            {\n                // SQL Server Connection String\n                string sqlConnectionString = \"Data Source=DITSEC3;Initial Catalog=test;Integrated Security=True\";\n\n                con.Open();\n                DataTable dt1 = new DataTable();\n                string s = \"select count(*) from ExcelTable\"; \n                string r = \"\"; \n                SqlCommand cmd1 = new SqlCommand(s, con);\n                try \n                { \n                    SqlDataAdapter da1 = new SqlDataAdapter(cmd1); \n                    da1.Fill(dt1);\n                }\n                catch { } \n                int RecordCount; \n                RecordCount = Convert.ToInt32(cmd1.ExecuteScalar());\n                r = RecordCount.ToString(); \n                Label1.Text = r;\n                con.Close();\n                int prv = Convert.ToInt32(r);\n\n\n\n\n\n                // Bulk Copy to SQL Server\n                using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n                {\n\n\n\n                    bulkCopy.DestinationTableName = \"ExcelTable\";\n                    bulkCopy.WriteToServer(dr);\n\n                    con.Open();\n                    SqlBulkCopyColumnMapping mapping1 = new SqlBulkCopyColumnMapping(\"id\", \"ida\");\n                    SqlBulkCopyColumnMapping mapping2 = new SqlBulkCopyColumnMapping(\"data\", \"dataa\");\n                    con.Close();\n\n                }\n                con.Open();\n\n\n\n                DataTable dt = new DataTable(); \n                s = \"select count(*) from ExcelTable\";  r = \"\"; \n                SqlCommand cmd = new SqlCommand(s, con); \n                try { SqlDataAdapter da = new SqlDataAdapter(cmd);\n                    da.Fill(dt); \n                }\n                catch { } \n                RecordCount = Convert.ToInt32(cmd.ExecuteScalar()); \n                r = RecordCount.ToString(); Label1.Text = r;\n                con.Close();\n                int ltr = Convert.ToInt32(r);\n                if (prv == ltr)\n                {\n                    Label1.Text = \"No records Added\";\n                }\n                else\n                {\n                    Label1.Text = \"Records Added Successfully !\";\n                }\n\n            }\n        }\n</code></pre>\n\n<p>Error:\nNo value given for one or more required parameters.</p>\n"},{"tags":["c#",".net","sql-server","sql-server-2008","oledb"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":12974119,"title":"SSL Connection to database","body":"<p>My application need to establish secure connection with SQL Server 2008. Having enabled 'Force Encryption' in server side, following is my connection string from my C# application.</p>\n\n<pre><code>Initial Catalog=emp_test;Persist Security Info=True;User ID=sa;Password=***;Data Source=172.21.70.94;Provider=SQLOLEDB;Use Encryption for Data=True;Trust Server Certificate=True;\n</code></pre>\n\n<p>I did not provision any certificate in server - Hence I gave Trust Server Certificate=True, so that self signed server certificate is not validated.</p>\n\n<p>But the connection is not established with following error. </p>\n\n<blockquote>\n  <p><em>Database error: [DBNETLIB][ConnectionOpen (SECDoClientHandshake()).]SSL Security error.</em></p>\n</blockquote>\n\n<p>Without the two attributes related to security, it works fine.</p>\n\n<p>What do I need to change to get this to work?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2","database-administration"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13045496,"title":"Unable to start SQL Server Instance 2008 R2 - DB file corrupt","body":"<p>I was not able to start the SQL Server 2008 R2 production DB instance. After reading the log file error message is</p>\n\n<p>\" The log scan number passed to log scan in database master is not valid. This error may indicate data corruption or that the log file (.ldf) does not match the data file (.mdf). If this error occurred during replication, re-create the publication.\"</p>\n\n<p>After reading several post i realize that my MASTER DB file is corrupted. I have followed the below setup</p>\n\n<pre><code>Copy the Master.mdf and Masterlog.ldf file from Template location to My Database Data folder.\n\nC:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\Binn\\Templates to D:\\MSSQL\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\n</code></pre>\n\n<p>Note: Same error occur when i copy the all DB file like Master, MasterLog, MSDBData, MSDBlog, Model and ModelLog</p>\n\n<pre><code>When i run my MSSQLSEVER instance different problem occur.\n</code></pre>\n\n<p>In My server i had only C, D- Drive i dont have the E drive. How can i override these below error path.</p>\n\n<p>Error LOG</p>\n\n<pre><code>2012-10-24 02:51:12.79 spid5s Error: 17204, Severity: 16, State: 1.\n\n2012-10-24 02:51:12.79 spid5s FCB::Open failed: Could not open file e:\\sql10_main_t.obj.x86fre\\sql\\mkmastr\\databases\\objfre\\i386\\MSDBData.mdf for file number 1. OS error: 3(The system cannot find the path specified.).\n\n2012-10-24 02:51:12.79 spid5s Error: 5120, Severity: 16, State: 101.\n\n2012-10-24 02:51:12.79 spid5s Unable to open the physical file\n\n\"e:\\sql10_main_t.obj.x86fre\\sql\\mkmastr\\databases\\objfre\\i386\\MSDBData.mdf\". Operating system error 3: \"3(The system cannot find the path specified.)\".\n\n2012-10-24 02:51:12.79 spid5s Error: 17207, Severity: 16, State: 1.\n\n2012-10-24 02:51:12.79 spid5s FileMgr::StartLogFiles: Operating system error 2(The system cannot find the file specified.) occurred while creating or opening file 'e:\\sql10_main_t.obj.x86fre\\sql\\mkmastr\\databases\\objfre\\i386\\MSDBLog.ldf'. Diagnose and correct the operating system error, and retry the operation.\n\n2012-10-24 02:51:12.79 spid5s File activation failure. The physical file name \"e:\\sql10_main_t.obj.x86fre\\sql\\mkmastr\\databases\\objfre\\i386\\MSDBLog.ldf\" may be incorrect.\n</code></pre>\n"},{"tags":["sql-server","tsql","table","data"],"answer_count":11,"favorite_count":56,"up_vote_count":57,"down_vote_count":0,"view_count":48485,"score":57,"question_id":155246,"title":"How do you truncate all tables in a database using TSQL?","body":"<p>I have a test environment for a database that I want to reload with new data at the start of a testing cycle. I am not interested in rebuilding the entire database- just simply \"re-setting\" the data. </p>\n\n<p>What is the best way to remove all the data from all the tables using TSQL? Are there system stored procedures, views, etc. that can be used? I do not want to manually create and maintain truncate table statements for each table- I would prefer it to be dynamic.</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13044772,"title":"Unable to compare the columns in SqlBulkCopy","body":"<p>Here is my code:</p>\n\n<pre><code> protected void Button1_Click(object sender, EventArgs e)\n {\n    string strFileType = System.IO.Path.GetExtension(FileUpload1.FileName).ToString().ToLower();\n    string strFileName = FileUpload1.PostedFile.FileName.ToString();\n\n    FileUpload1.SaveAs(Server.MapPath(\"~/Import/\" + strFileName + strFileType));\n    string strNewPath = Server.MapPath(\"~/Import/\" + strFileName + strFileType);\n\n    string excelConnectionString = String.Format(@\"Provider=Microsoft.Jet.OLEDB.4.0;\" + \"Data Source=\"+strNewPath +\"; Extended Properties=Excel 8.0;\");\n\n    //string excelConnectionString = String.Format(@\"Provider=Microsoft.Jet.OLEDB.4.0;\" + \"Data Source=C:\\\\myFolder\\\\Book1.xls;\" + \"Extended Properties=Excel 8.0;\"); \n\n   // Create Connection to Excel Workbook\n   using (OleDbConnection connection = new OleDbConnection(excelConnectionString))\n   {\n       OleDbCommand command = new OleDbCommand(\"Select ID,Data FROM [Sheet1$]\", connection);\n\n       connection.Open();\n\n       // Create DbDataReader to Data Worksheet\n       using (DbDataReader dr = command.ExecuteReader())\n       {\n          // SQL Server Connection String\n          string sqlConnectionString = \"Data Source=DITSEC3;Initial Catalog=test;Integrated Security=True\";\n\n          con.Open();\n          DataTable dt1 = new DataTable();\n          string s = \"select count(*) from ExcelTable\"; \n          string r = \"\"; \n          SqlCommand cmd1 = new SqlCommand(s, con);\n\n          try \n          { \n              SqlDataAdapter da1 = new SqlDataAdapter(cmd1); \n              da1.Fill(dt1);\n          }\n          catch { } \n\n          int RecordCount; \n          RecordCount = Convert.ToInt32(cmd1.ExecuteScalar());\n\n          r = RecordCount.ToString(); \n          Label1.Text = r;\n          con.Close();\n          int prv = Convert.ToInt32(r);\n\n          //matching columns\n          //SqlBulkCopyColumnMapping mapping1 = new SqlBulkCopyColumnMapping(\"id\", \"ida\");\n          //SqlBulkCopyColumnMapping mapping2 = new SqlBulkCopyColumnMapping(\"data\", \"dataa\");\n\n          // Bulk Copy to SQL Server\n          using (SqlBulkCopy bulkCopy = new SqlBulkCopy(sqlConnectionString))\n          {\n              bulkCopy.DestinationTableName = \"ExcelTable\";\n              bulkCopy.WriteToServer(dr);\n          }\n\n          con.Open();\n          DataTable dt = new DataTable(); \n          s = \"select count(*) from ExcelTable\";  r = \"\"; \n\n          SqlCommand cmd = new SqlCommand(s, con); \n\n          try \n          { \n               SqlDataAdapter da = new SqlDataAdapter(cmd);\n               da.Fill(dt); \n          }\n          catch { } \n\n          RecordCount = Convert.ToInt32(cmd.ExecuteScalar()); \n          r = RecordCount.ToString(); Label1.Text = r;\n\n          con.Close();\n\n          int ltr = Convert.ToInt32(r);\n          if (prv == ltr)\n          {\n             Label1.Text = \"No records Added\";\n          }\n          else\n          {\n             Label1.Text = \"Records Added Successfully !\";\n          }\n       }\n    }\n</code></pre>\n\n<p>I know I need to add something like:</p>\n\n<pre><code> SqlBulkCopyColumnMapping mapping1 = new SqlBulkCopyColumnMapping(\"id\", \"ida\");\n SqlBulkCopyColumnMapping mapping2 = new SqlBulkCopyColumnMapping(\"data\", \"dataa\");\n</code></pre>\n\n<p>but I am not sure where I am supposed to add it in the above code</p>\n"},{"tags":["c#","sql-server","winforms","ado.net"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":93,"score":1,"question_id":13044808,"title":"Error converting data type nvarchar to numeric","body":"<p>I used the following statement for a parameter.</p>\n\n<pre><code>comm.Parameters.Add(\"@name\", SqlDbType.NVarChar, 50).Value = txtname.Text;\n</code></pre>\n\n<p><code>Name</code> is a SQL Server <code>nvarchar</code> column but I get this error:</p>\n\n<blockquote>\n  <p><em>Error converting data type nvarchar to numeric.</em></p>\n</blockquote>\n\n<p>My sql: </p>\n\n<pre><code>SqlCommand comm = conn.CreateCommand();\ncomm.CommandText = \"execute addName @name\";\ncomm.Parameters.Add(\"@name\", SqlDbType.NVarChar, 50).Value = txtname.Text;\n\nconn.Open();\ncomm.ExecuteNonQuery();\nconn.Close();\n</code></pre>\n\n<p>Can help my to fix this problem?\nMy store procedure:</p>\n\n<pre><code>USE [info]\nGO\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nALTER procedure [dbo].[addName]\n            @id numeric(18,0) = 0,\n            @name nchar(50)\nas\nif (select name from TName where name = @name) is null\nbegin\nselect @id =  MAX(id)+1 from TName\ninsert into TName\nvalues (@id, @name)\nprint @id\nend\nelse\nbegin\nprint 'Eroare'\nend\n</code></pre>\n"},{"tags":["sql","sql-server","ssis"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4105,"score":1,"question_id":626047,"title":"SSIS Analysis Services Connection Error In The Transport Layer of initializing provider","body":"<p>I'm trying to connect to an analysis services database in SSIS using a specific user name and password.</p>\n\n<p>I'm getting the message</p>\n\n<p>error in initializing provider. AN error was encountered in the transport layer.</p>\n\n<p>The peer prematurely closed the connection. </p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":5,"favorite_count":2,"up_vote_count":20,"down_vote_count":0,"view_count":12899,"score":20,"question_id":975286,"title":"SqlServer is in script upgrade mode","body":"<p>Vista just finished one of its many updates. After restarting my computer I try connecting to SqlServer2008 instance with Sql Server Management Studio and I get this error:</p>\n\n<p>Error connecting to '...\\MSSQLSERVER2008'.\nAdditional information:\nLogin failed for user '...'. Reason: Server is in script upgrade mode. Only administrator can connect at this time. (Microsoft SQL Server, Error: 18401).</p>\n\n<p>Pressing help gets me to an internet page saying there's no additional information.</p>\n\n<p>Thx Vista &amp; Updates. Anyone an idea because on the internet I can't find anything about this issue.</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":81,"score":2,"question_id":13043002,"title":"How to sort varchar type column that contain both string and numeric values","body":"<p>I have a table that has column name \"BatchNo\" and it contain both string and numeric values together. when i typed a select query i got following results.</p>\n\n<p><img src=\"http://i.stack.imgur.com/VRWHf.jpg\" alt=\"enter image description here\"></p>\n\n<p>i want to sort \"BatchNo\" column in following format</p>\n\n<p><img src=\"http://i.stack.imgur.com/f5Zwo.jpg\" alt=\"enter image description here\"></p>\n\n<p>In my problem future batches may be have a,b,c .... letters with numeric values or only numeric values. how can i sort this column ? Hope you guys can help me to get some solution.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":9,"favorite_count":4,"up_vote_count":8,"down_vote_count":0,"view_count":6695,"score":8,"question_id":95967,"title":"How do you list the primary key of a SQL Server table?","body":"<p>Simple question, how do you list the primary key of a table with T-SQL? I know how to get indexes on a table, but can't remember how to get the PK.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":125,"score":2,"question_id":13039931,"title":"Stored procedure not as defensive as it looks","body":"<p>I have several stored procedures structured like the following:</p>\n\n<pre><code>USE [WHouse]\nGO\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE PROCEDURE [dbo].[pr_Alert_Dly]\nAS\n    IF (SELECT LastRunDate FROM WHouse.dbo.AlertRunDates WHERE NameDescription = 'X' ) &lt; (SELECT CONVERT(DATE, GETDATE()))\n    BEGIN\n       --================\n       --need to comment the following out if trying to re-run\n       UPDATE x \n       SET  x.LastRunDate = CONVERT(DATE,GETDATE())\n       FROM WHouse.dbo.AlertRunDates x\n       WHERE [NameDescription] = 'X' \n       --================\n\n       --===============\n       --DO A LOAD OF STUFF IN HERE \n       --INCLUDING USING DB_SENDMAIL TO EMAIL 20 PEOPLE\n       --===============\n\n    END\n</code></pre>\n\n<p>My colleague has set up a reporting system (using procedures / SSIS) that loops every 10 minutes and as long as a stored procedure completes without an error then it is marked as complete in a control table.</p>\n\n<p>What I don't understand is even if the above throws an error why would it ever repeat the section between <code>BEGIN / END</code> more than once in the same batch ?</p>\n\n<p>If it is not defensive enough how do defend against my colleagues system causing the same emails to get distributed every 10 minutes?!</p>\n"},{"tags":["sql-server","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13040002,"title":"add some data to sql server every month","body":"<p>I want automatic insertion of the data into table every month. </p>\n\n<p>For example there is a table <code>Cost</code>. If there wasn't new data this month(before for example some day of the month) then script should insert data from previous month. I mean</p>\n\n<pre><code> 1234 1.10.1992\n 1334 1.11.1992\n *no data 1.12 was added*\n 1334 1.12.1992\n</code></pre>\n\n<p>I decided to use sql server jobs. I've created a job</p>\n\n<pre><code>exec sp_add_job\n     @job_name = 'Add land cost automatic'\n</code></pre>\n\n<p>then I've created a schedule and attached it to the job</p>\n\n<pre><code>use msdb;\ngo\n\nexec sp_add_schedule\n    @schedule_name = 'Add',\n    @freq_type = 16,\n    @freq_interval = 2,\n    @freq_recurrence_factor = 1;\ngo\n\nexec sp_attach_schedule\n    @job_name = 'Add land cost automatic',\n    @schedule_name = 'Add';\ngo\n</code></pre>\n\n<p>But how to add job step and what to write as a command?</p>\n"},{"tags":["sql-server","import"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13040019,"title":"importing quoted csv data into sql server","body":"<p>I have data in a CSV file that looks like:</p>\n\n<pre><code>\"2745\",\"00\",\"8824\",\"02/15/99\",\"-850.00\",\"-144.20\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"-994.20\",\"0.00\",\"\"\n</code></pre>\n\n<p>I'm trying to import it into a table in SQL Server using SSMS's Import Wizard and I think I'm getting conversion errors.</p>\n\n<p>For example, column 2 (third one) is setup as a numeric in the table, Col 3 is setup as a date, and the import wizard is complaining about losing data in the conversion.  I can understand it's trying to convert from string to numeric or string to date, but how do I tell it to convert the data?  Is that possible with the import wizard?</p>\n\n<p>If not, what's the recommended way?  Let it import into it's own table then copy the data over to the destination table doing the conversion during the copy?</p>\n"},{"tags":["sql","sql-server","tsql","date","datediff"],"answer_count":4,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":66,"score":7,"question_id":13038116,"title":"SQL DateDiff without enddate","body":"<p>I'm using SQL Server\nI need to know the number of days that a patient was receiving a treatment.\nThe problem is that I can only get a startDate but not an endDate\nWhen I run a query and order it by StartDate I get something like this:</p>\n\n<pre><code>StartDate\n2012-10-11 22:00:00.000\n2012-10-11 23:10:31.000\n2012-10-12 00:28:31.000\n2012-10-12 01:39:01.000\n2012-10-12 02:09:01.000\n2012-10-12 03:39:01.000\n2012-10-12 04:38:50.000\n2012-10-20 06:00:00.000\n2012-10-20 08:06:05.000\n2012-10-20 10:21:55.000\n2012-10-21 14:13:01.000\n2012-10-21 15:13:01.000\n</code></pre>\n\n<p>The answer I should get is 4 days (Days 11, 12, 20 and 21)\nThe treatment stopped on 2012-10-12 and a new treatment started on 2012-10-20\nHow can I sum up the days the patient was getting the treatment despite not having an endDate?</p>\n\n<p>Thank you,</p>\n\n<p>Loperam</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":53,"score":3,"question_id":13041675,"title":"Select value based on role","body":"<p>The following results from a temp table.<br> \nPlease Note : The data below is just a sample so I don't need a hardcoded query, I need a query which works for all kinds of data.</p>\n\n<p>Value = 1 means the User has the role and 0 means the user has no role.\nLike row one Testing 1 has Role A but not Role D.</p>\n\n<p>I need a query for the below cases.</p>\n\n<p>Case # 1  when <code>Role ID = ( A,B,C,D )</code> \nI only need the user/s which have atleast one role assigned.\nI should get back User Testing 1, Testing 2 and Testing 3. Testing 4 wont be coming as no role has been assigned to it.</p>\n\n<p>Case # 2 When <code>Role ID = ( A,B,C,D )</code> .\nI only need the user/s which have all the roles assigned to a it.\nI should get User Testing2 with 4 rows.</p>\n\n<blockquote>\n  <p>username  Value   Role ID<br>\n  Testing1    1 A<br>\n  Testing1    1 B<br>\n  Testing1    1 C<br>\n  Testing1    0 D<br>\n  Testing2    1     A<br>\n  Testing2    1 B<br>\n  Testing2    1 C<br>\n  Testing2    1 D<br>\n  Testing3    1 A<br>\n  Testing3    1 B<br>\n  Testing3    1 C<br>\n  Testing3    0 D<br>\n  Testing4    0 A<br>\n  Testing4    0 B<br>\n  Testing4    0 C<br>\n  Testing4    0 D</p>\n</blockquote>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":74,"score":2,"question_id":13033645,"title":"Archiving Large Table (SQL Server 2008)","body":"<p>I have a very large table being filled with about 100s of million records each quarter.</p>\n\n<p>I manually move data from the existing table to another database using <a href=\"http://sqlserverperformance.wordpress.com/2011/08/13/gradually-deleting-data-in-sql-server/\" rel=\"nofollow\">this script</a>, to minimize the backup size, and to off load the production database when performing queries.</p>\n\n<p>Is there any better way, for example, some scheduled script that will move data from the production database to some other database and then delete the records from the source database every day or week efficiently? </p>\n\n<p>Note that my log file is growing rapidly due to the high number of INSERTs into this table, also when I move data to the archive database, DELETEs will be logged.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","performance","sql-server-2000","time-series"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":13037557,"title":"SQL Server : time-series data performance","body":"<p>I have a table of a little over 1 billion rows of time-series data with fantastic insert performance but (sometimes) awful select performance.</p>\n\n<p>Table <code>tblTrendDetails</code> (PK is ordered as shown):</p>\n\n<pre><code>PK  TrendTime    datetime\nPK  CavityId     int\nPK  TrendValueId int\n    TrendValue   real\n</code></pre>\n\n<p>The table is continuously pulling in new data and purging old data, so insert and delete performance needs to remain snappy.</p>\n\n<p>When executing a query such as the following, performance is poor (30 sec):</p>\n\n<pre><code>SELECT * \nFROM tblTrendDetails\nWHERE TrendTime BETWEEN @inMinTime AND @inMaxTime\n  AND CavityId = @inCavityId\n  AND TrendValueId = @inTrendId\n</code></pre>\n\n<p>If I execute the same query again (with similar times, but any <code>@inCavityId</code> or <code>@inTrendId</code>), performance is very good (1 sec). Performance counters show that disk access is the culprit the first time the query is run.  </p>\n\n<p>Any recommendations regarding how to improve performance without (significantly) adversely affecting the insert or delete performance?  Any suggestions (including completely changing the underlying database) are welcome.</p>\n"},{"tags":["sql-server","sql-server-2008","database-restore"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13039345,"title":"SQL Server 2008 R2: Restore a single filegroup","body":"<p>Not sure if this is a duplicate of <a href=\"http://stackoverflow.com/questions/2951016/sql-server-2005-partial-filegroup-restore-on-qa-database\">SQL Server 2005: Partial Filegroup restore on QA database</a>, but if so then I apologise (even though it was not answered).</p>\n\n<p>I have a database on SQL2008R2 with multiple (3) filegroups. There are production and development copies of this database on separate servers.</p>\n\n<p>I have created a filegroup backup of the PRIMARY filegroup from production and wish to restore it on the development server. I do not want to try and backup/restore the entire database as one of the filegroups contains nearly 1TB of data and the servers are geographically distant.</p>\n\n<p>I have tried restoring the filegroup backup using \"with partial, recovery\" and I now have access to the data in that filegroup, but I have lost access to the data in the other filegroups (I am testing this on a 3rd server for now so I have not really lost anything as such).</p>\n\n<p>I am not even sure that what I am trying to do is possible (and it is starting to look as if it is not), can anybody shed any light on what else I might to to acheive my goal.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","query"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13041437,"title":"Alternative to INTERSECT Given Arbitrary Number of conditions","body":"<p>If I have a table similar to the following:</p>\n\n<pre><code>MyIds MyValues\n----- --------\n  1    Meat\n  1    Fruit\n  1    Veggies\n  2    Fruit\n  2    Meat\n  3    Meat\n</code></pre>\n\n<p>How do I create a query  such that if I am given an arbitrary list of distinct <code>MyValues</code>, it will give me all the <code>MyIds</code> that match <strong>all</strong> of <code>MyValues</code>.</p>\n\n<p>Example: If list of <code>MyValues</code> contained [Meat, Fruit, Veggies], I'd like to get <code>MyIds</code> of <code>1</code> back because <code>1</code> has an entry in the table for each value in MyValues.</p>\n\n<p>I know that this can be done with an INTERSECT if I'm given a specific list of <code>MyValues</code>. But I don't know how it can be done with an arbitrary number of <code>MyValues</code> </p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13040414,"title":"Pagination for a SQL Query Template","body":"<p>For my application I created a <strong>SQL query builder</strong> which has got <strong>Where</strong> and <strong>Order By</strong> clauses. I would like to know how to paginate through the results i.e. I would like to get a template on how to paginate through the results of a SQL query. This description may be a bit confusing, so it may be easier with an example: </p>\n\n<p>Consider the <strong>Test Table</strong></p>\n\n<pre><code>CREATE TABLE [dbo].[TestTable](\n    [RecordID] [int] NOT NULL,\n    [ID] [nvarchar](1000) NULL,\n    [Name] [nvarchar](1000) NULL,\n    [Dept] [nvarchar](1000) NULL\n)\nINSERT [dbo].[TestTable] \n    SELECT 1, N'1', N'Andy', N'IT'\nUNION ALL\n    SELECT 2, N'2', N'Bob', N'IT'\nUNION ALL\n    SELECT 3, N'3', N'Camila', N'Sales'\nUNION ALL\n    SELECT 4, N'4', N'Drew', N'IT'\nUNION ALL\n    SELECT 5, N'5', N'Elsie', N'Sales'\nUNION ALL\n    SELECT 6, N'6', N'Frank', N'IT'\nUNION ALL\n    SELECT 7, N'7', N'Gaby', N'Sales'\nUNION ALL\n    SELECT 8, N'8', N'Hank', N'IT'\nUNION ALL\n    SELECT 9, N'9', N'Iris', N'Sales'\nUNION ALL\n    SELECT 10, N'8', N'John', N'IT'\n</code></pre>\n\n<p>Let us say that I have a <strong>Where</strong> Clause as:</p>\n\n<pre><code>WHERE  ([Dept] = 'IT')\n</code></pre>\n\n<p>And an <strong>Order By</strong> Clause as:</p>\n\n<pre><code>ORDER BY [Name] DESC\n</code></pre>\n\n<p>I am attempting to do the pagination by using something like: </p>\n\n<pre><code>SELECT [RECORDID], [ID], [Name], [Dept], RowNum  \n    FROM (\n            SELECT [RECORDID], [ID], [Name], [Dept], \n                    ROW_NUMBER() OVER (ORDER BY [RecordID]) AS RowNum \n            FROM [TestTable] WHERE  ([Dept] = 'IT') \n        ) AS [TestTable_DerivedTable] \nWHERE [TestTable_DerivedTable].RowNum BETWEEN 3 AND 6 ORDER BY [Name] DESC\n</code></pre>\n\n<p>This does not work because I cannot get the <code>ORDER BY [Name] DESC</code> into <code>[TestTable_DerivedTable]</code>. \nIf I just had the <strong>WHERE</strong> clause, it would return the names: </p>\n\n<blockquote>\n  <p>Andy, Bob, Drew, Frank, Hank, and John.</p>\n</blockquote>\n\n<p>If I put in the pagination i.e. <strong>BETWEEN 3 AND 6</strong>, I correctly get: </p>\n\n<blockquote>\n  <p>Drew, Frank, Hank, and John</p>\n</blockquote>\n\n<p>How do I add the <code>ORDER BY [Name] DESC</code> so that I get <em>(first the reversal, then the pagination)</em>:</p>\n\n<blockquote>\n  <p>Frank, Drew, Bob, and Andy</p>\n</blockquote>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":13039735,"title":"How to simplify/optimize this union statement","body":"<p>I have this code that I wrote for for a query that the client needed. The results gives me exactly what we need, however i am getting some really long response times. The first part of thequery takes longer than the second, when the query itself its not very much different. Basically they are two different queries that I combined into one using UNION ALL.</p>\n\n<p>Any feedback would be great to simplify this.\nthanks</p>\n\n<pre><code>Select * from\n(\n\nSelect b.Storage_Loc_Nbr as locNbr, b.CurrentLoadCount,b.MMM_Id_Nbr,\n(SELECT count(Load_ID) as LoadCount \n    FROM t_load c\n    WHERE b.MMM_Id_Nbr=c.MMM_Id_Nbr\n    and\n    QC_Status_Code like 'R%' and mmm_Facility_Code ='MC' and     Active_Status_Ind='A'\n    and\n    b.Storage_Loc_Nbr &lt;&gt; c.Storage_Loc_Nbr)as OtherLocCount\n\n    FROM\n(\n\nSELECT * FROM\n\n(\n\n    SELECT t_load.Storage_Loc_Nbr, \n    Count(t_Load.Load_Id) AS CurrentLoadCount,\n    t_load.MMM_Id_Nbr,\n    t_Storage_Location.Storage_Loc_Type_Code\n\n    FROM t_Load LEFT JOIN t_Storage_Location ON t_Load.Storage_Loc_Nbr = t_Storage_Location.Storage_Loc_Nbr\n    WHERE (\n\n    ((t_load.MMM_Id_Nbr) between '702004%' and '702011%')\n    AND ((t_Load.Active_Status_Ind)='A')\n    AND ((t_Load.QC_Status_Code) Like 'R%') \n    AND ((t_Load.MMM_Facility_Code)='MC')\n    AND  ((t_Storage_Location.Storage_Loc_Type_Code)='CD')\n)\n\n    GROUP BY t_load.MMM_Id_Nbr,\n    t_load.Storage_Loc_Nbr,\n    t_Storage_Location.Storage_Loc_Type_Code\n\n HAVING\n    Count(t_Load.Load_Id)&lt;=1\n\n\n\n\n    )\n    as a\n\n)  \nas b\n\n\n)\nas c\nGroup By\nlocNbr,CurrentLoadCount, MMM_Id_Nbr, OtherLocCount\nhaving OtherLocCount&gt;0\n\nUNION ALL\n\nSelect * from\n(\n\nSelect b.Storage_Loc_Nbr as locNbr, b.CurrentLoadCount,b.MMM_Id_Nbr,\n(SELECT count(Load_ID) as LoadCount \n    FROM t_load c\n    WHERE b.MMM_Id_Nbr=c.MMM_Id_Nbr\n    and\n    QC_Status_Code like 'R%' and mmm_Facility_Code ='MC' and Active_Status_Ind='A'\n    and\n    b.Storage_Loc_Nbr &lt;&gt; c.Storage_Loc_Nbr)as OtherLocCount\n\n FROM\n(\n\nSELECT * FROM\n\n(\n\n    SELECT t_load.Storage_Loc_Nbr, \n    Count(t_Load.Load_Id) AS CurrentLoadCount,\n    t_load.MMM_Id_Nbr,\n    t_Storage_Location.Storage_Loc_Type_Code\n\n    FROM t_Load LEFT JOIN t_Storage_Location ON t_Load.Storage_Loc_Nbr = t_Storage_Location.Storage_Loc_Nbr\n    WHERE (\n\n    ((t_load.MMM_Id_Nbr) between '702004%' and '702011%')\n    AND ((t_Load.Active_Status_Ind)='A')\n    AND ((t_Load.QC_Status_Code) Like 'R%') \n    AND ((t_Load.MMM_Facility_Code)='MC')\n    AND  ((t_Storage_Location.Storage_Loc_Type_Code)&lt;&gt;'CD') AND\n    ((t_load.Storage_Loc_Nbr)&lt;&gt;'clc' AND (t_load.Storage_Loc_Nbr)&lt;&gt;'WHLEAD')    AND\n(\n((t_load.Storage_Loc_Nbr) Like '%A') \nOR((t_load.Storage_Loc_Nbr) Like '%B')\nOR ((t_load.Storage_Loc_Nbr) Like '%C') \nOR ((t_load.Storage_Loc_Nbr) Like '%D') \nOR ((t_load.Storage_Loc_Nbr) Like '%E'))\n)\n\n    GROUP BY t_load.MMM_Id_Nbr,\n    t_load.Storage_Loc_Nbr,\n    t_Storage_Location.Storage_Loc_Type_Code\n\n\n\n    HAVING\n    Count(t_Load.Load_Id)&lt;=1\n\n\n\n    )\n    as a\n\n)  \nas b\n\n\n)\nas c\nGroup By\nlocNbr,CurrentLoadCount, MMM_Id_Nbr, OtherLocCount\nhaving OtherLocCount&gt;0\nOrder by\nLocNbr\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":13039742,"title":"Create a user with permissions for only 1 database","body":"<p>What is the way via a script to add a user to a database with permissions of select, insert, update and delete but only have access to that one database?</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2799,"score":0,"question_id":6620042,"title":"How do I create Insert Update trigger on SQL Server 2008","body":"<p>Hi I have 2 tables name say <code>EmpOne</code> and <code>NotificationEmp1</code> both table having same structure with same column name, I want to insert update record in <code>NotificationEmp1</code> table using trigger when I insert update records into <code>EmpOne</code></p>\n"},{"tags":["sql-server","sql-server-2005","tsql","schema"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":4230,"score":5,"question_id":3806245,"title":"SQL server schema and default schema","body":"<p>I have a schema define in my database. Except now everytime I do a sql statement I have to provide the schema ... \n<code>SELECT * FROM [myschema].table</code></p>\n\n<p>I set the default schema for my user using management studio and also ran the \n<code>ALTER USER myUser WITH DEFAULT_SCHEMA [myschema]</code> \nand I still get the invalid object 'table' when writing a query without the schema (SELECT * FROM table)</p>\n\n<p>Is there a way to write <code>SELECT * FROM table</code> without having to specify the schema name all the time?</p>\n\n<p>It's on SQL 2005 using SQL Management Studio.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":68,"score":3,"question_id":13038444,"title":"Dynamic Update a created temp table? basics?","body":"<p>I have <strong>Table-A</strong> that has \"x\" number of rows. (For this example there are 8 rows)</p>\n\n<p>I create <strong>Table-C</strong> with \"x\" number of columns via use of a cursor. (Making this dynamic; should more rows be added to <strong>Table-A</strong>, then more columns are created in <strong>Table-C</strong>)  </p>\n\n<pre>\nTable-C (x = 1 thru 8)\n   UserID  1     2     3     4     5     6     7     8\n</pre>\n\n<p>After creating <strong>Table-C</strong>, rows are inserted into <strong>Table-C</strong> based on userIDs passed back from the webpage input box. (this is done dynamic)</p>\n\n<pre>\nTable-C after inserts:\n   UserID  1     2     3     4     5     6     7     8  \n   57      null  null  null  null  null  null  null  null  \n   74      null  null  null  null  null  null  null  null  \n</pre>\n\n<p>Now I wish to perform an UPDATE<br>\n<strong>Table-B</strong> contains data where column \"x-column\" is associating a UserID to a column in the created <strong>Table-C</strong></p>\n\n<pre>\nTable-B:  \nUserID  x-column  \n34      2  \n34      3  \n57      2  \n57      3  \n57      8  \n74      2  \n74      4  \n74      5  \n74      7  \n74      8  \n93      2  \n93      4  \n</pre>\n\n<p>So end result is to dynamically UPDATE <strong>Table-C</strong> with a 1 where Table-B.UserID = Table-C.column_heading</p>\n\n<pre>\nTable-C after update should look like this:  \n   UserID  1     2     3     4     5     6     7     8  \n   57      null  1     1     null  null  null  null  1  \n   74      null  1     null  1     1     null  1     1  \n</pre>\n\n<p>I am hard pressed on figuring out the syntax for building an UPDATE loop that will take care of this.\nDo I need to use a cursor?  </p>\n\n<p>I am pretty sure this isn't rocket science, I'm still learning!</p>\n"},{"tags":["php","sql-server","database","query"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":13038942,"title":"Invalid column name in mysql PHP query","body":"<p>I had the following form working properly and populating MySQL DB.  I had since added on a new field 'type' to my database and also added it to the form.  However now when I try to add a new entry it says \"Invalid column name 'type'\".  Any help would be greatly appreciated.</p>\n\n<pre><code>&lt;script&gt;\n      $(document).ready(function() {\n        $(\"#datepicker\").datepicker();\n      });\n      &lt;/script&gt;\n\n  &lt;script&gt;\n$(document).ready(function() {\n$(\"#datepicker2\").datepicker();\n});\n&lt;/script&gt;\n\n &lt;/head&gt;\n &lt;body&gt;\n &lt;?php \n // if there are any errors, display them\n if ($error != '')\n {\n echo '&lt;div style=\"padding:4px; border:1px solid red; color:red;\"&gt;'.$error.'&lt;/div&gt;';\n }\n ?&gt; \n\n  &lt;form action=\"\" method=\"post\"&gt;\n &lt;div&gt;\n &lt;label for=\"Posted\"&gt;&lt;strong&gt;Posted: &lt;/strong&gt; &lt;/label&gt;\n &lt;input id=\"datepicker\"  name=\"posted\" value=\"&lt;?php echo $Posted; ?&gt;\" /&gt;&lt;br/&gt;&lt;br/&gt;\n\n &lt;label for=\"Ends\"&gt;&lt;strong&gt;Ends: &lt;/strong&gt; &lt;/label&gt;\n &lt;input id=\"datepicker2\"  name=\"ends\" value=\"&lt;?php echo $Ends; ?&gt;\" /&gt;&lt;br/&gt;&lt;br/&gt;\n\n &lt;label for=\"Position\"&gt;&lt;strong&gt;Position: &lt;/strong&gt;&lt;/label&gt;\n  &lt;input type=\"text\" name=\"position\" value=\"&lt;?php echo $Position; ?&gt;\" /&gt;&lt;br/&gt;&lt;br/&gt;\n\n  &lt;label for=\"Location\"&gt;&lt;strong&gt;Location: &lt;/strong&gt; &lt;/label&gt;\n &lt;select name=\"location\"&gt;\n  &lt;option value=\" \"&gt;Select...&lt;?php echo $Location; ?&gt;&lt;/option&gt;\n  &lt;option value=\"Fargo\"&gt;Fargo&lt;/option&gt;\n  &lt;option value=\"Grand Forks\"&gt;Grand Forks&lt;/option&gt;\n&lt;/select&gt;&lt;br/&gt;&lt;br/&gt;\n\n&lt;label for=\"Application Type\"&gt;&lt;strong&gt;Application Type: &lt;/strong&gt; &lt;/label&gt;\n  &lt;select name=\"type\"&gt;\n  &lt;option value=\" \"&gt;Select...&lt;?php echo $Type; ?&gt;&lt;/option&gt;\n  &lt;option value=\"Driver\"&gt;Driver&lt;/option&gt;\n  &lt;option value=\"Employee\"&gt;Employee&lt;/option&gt;\n&lt;/select&gt;&lt;br/&gt;&lt;br/&gt;\n\n &lt;label for=\"Hours\"&gt;&lt;strong&gt;Hours: &lt;/strong&gt; &lt;/label&gt;\n &lt;input type=\"text\" name=\"hours\" value=\"&lt;?php echo $Hours; ?&gt;\" /&gt;&lt;br/&gt;&lt;br/&gt;\n\n &lt;label for=\"Pay\"&gt;&lt;strong&gt;Pay: &lt;/strong&gt; &lt;/label&gt;\n &lt;input type=\"text\" name=\"pay\" value=\"&lt;?php echo $Pay; ?&gt;\" /&gt;&lt;br/&gt;&lt;br/&gt;\n\n &lt;label for=\"Benefits\"&gt;&lt;strong&gt;Benefits: &lt;/strong&gt; &lt;/label&gt;\n &lt;textarea cols=\"60\" rows=\"2\" name=\"benefits\" value=\"&lt;?php echo $Benefits; ?&gt;\" &gt;&lt;?php echo $Benefits; ?&gt;&lt;/textarea&gt;&lt;br/&gt;&lt;br/&gt;\n\n &lt;label for=\"Description\"&gt;&lt;strong&gt;Description: &lt;/strong&gt; &lt;/label&gt;\n &lt;textarea cols=\"60\" rows=\"3\" name=\"description\" value=\"&lt;?php echo $Description; ?&gt;\" &gt;&lt;?php echo $Description; ?&gt;&lt;/textarea&gt;&lt;br/&gt;&lt;br/&gt;\n\n\n &lt;input type=\"submit\" name=\"submit\" value=\"Submit\"&gt;\n &lt;/div&gt;\n &lt;/form&gt; \n &lt;/body&gt;\n &lt;/html&gt;\n &lt;?php \n }\n\n\n\n\n // connect to the database\n include('connect-db.php');\n\n // check if the form has been submitted. If it has, start to process the form and save it to the database\n if (isset($_POST['submit']))\n { \n // get form data, making sure it is valid\n\n function ms_escape_string($data) {\n        if ( !isset($data) or empty($data) ) return '';\n        if ( is_numeric($data) ) return $data;\n\n        $non_displayables = array(\n            '/%0[0-8bcef]/',            // url encoded 00-08, 11, 12, 14, 15\n            '/%1[0-9a-f]/',             // url encoded 16-31\n            '/[\\x00-\\x08]/',            // 00-08\n            '/\\x0b/',                   // 11\n            '/\\x0c/',                   // 12\n            '/[\\x0e-\\x1f]/'             // 14-31\n        );\n        foreach ( $non_displayables as $regex )\n            $data = preg_replace( $regex, '', $data );\n        $data = str_replace(\"'\", \"''\", $data );\n        return $data;\n    }\n\n    ms_escape_string($_POST);\n\n\n     $posted=$_POST['posted'];\n     $ends=$_POST['ends'];\n     $type=$_POST['type'];\n     $position=$_POST['position'];\n     $location=$_POST['location'];\n     $hours=$_POST['hours'];\n     $pay=$_POST['pay'];\n     $benefits=$_POST['benefits'];\n     $description=$_POST['description'];\n\n // check to make sure all fields are entered\n if ($posted == '' || $ends == '' || $type == '' || $position == '' || $location == '' || $hours == '' || $pay == '' || $benefits == '' || $description == '')\n {\n // generate error message\n $error = 'ERROR: Please fill in all required fields!';\n\n // if any fields are blank, display the form again\n renderForm($posted, $ends, $type, $position, $location, $hours, $pay, $benefits, $description, $error);\n }\n else\n {\n // save the data to the database\n    $SQL = \"INSERT INTO JobPosting (posted, ends, type, position, location, hours, pay, benefits, description) VALUES ('$posted', '$ends', '$type', '$position', '$location', '$hours', '$pay', '$benefits', '$description')\";\n\n     $result = mssql_query($SQL) \n        or die (mssql_get_last_message());  \n\n // once saved, redirect back to the view page\n header(\"Location: view.php\"); \n }\n }\n else\n // if the form hasn't been submitted, display the form\n {\n renderForm('','','','','','','','','','');\n }\n</code></pre>\n"},{"tags":["sql-server","pipe","named-pipes"],"answer_count":9,"favorite_count":16,"up_vote_count":36,"down_vote_count":1,"view_count":39546,"score":35,"question_id":175579,"title":"What are named pipes?","body":"<p>What are they and how do they work?</p>\n\n<p>Context happens to be SQL Server</p>\n"},{"tags":["sql-server","vb.net","sql-server-2008","query"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13038389,"title":"Proper way to execute a large SQL query in vb.net","body":"<p>I have a SQL query that I used my vb.net application to run it, but i have a problem when It exceeds to its command timeout property. I set it to 300, any tips or suggestions?</p>\n\n<p>here is the snippet of my code in vb.net</p>\n\n<pre><code>  .ExecuteQuery(\"exec spCentrIX_PracticeSet '\" &amp; oCompany &amp; \"','\" &amp; .SecDatabaseName &amp; \"'\", sDataSet)\n  Application.DoEvents()\n  .ExecuteQuery(\"exec spCentrIX_PracticeSet '\" &amp; oCompany &amp; \"','\" &amp; .SetDatabaseName &amp; \"'\", sDataSet)\n  Application.DoEvents()\n  .ExecuteQuery(\"exec spCentrIX_PracticeSet '\" &amp; oCompany &amp; \"','\" &amp; .TranDatabaseName &amp; \"'\", sDataSet)\n  Application.DoEvents()\n</code></pre>\n\n<p>same script that run three times. this script gets all the data from the 3 databases which runs okie. however, when it is running...it exceeds the connection timeout of my code.</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":13037668,"title":"What does it mean to have jobs with a null stop date?","body":"<p>I had used the following SQL to list out all jobs without a stop date. I thought that I could use this to find all active jobs. What I noticed is that I have a number of jobs  in this table with a null stop_execution_date. Some identical jobs (same job_id) are repeated multiple times in this table. </p>\n\n<pre><code>select job.*, activity.*\nfrom msdb.dbo.sysjobs_view job\ninner join msdb.dbo.sysjobactivity activity\non (job.job_id = activity.job_id)\nwhere run_Requested_date is not null and stop_execution_date is null\n</code></pre>\n\n<p>When I run <code>EXEC msdb.dbo.sp_help_job</code> on these jobs, I see that they the current execution status is idle. </p>\n\n<p>What do these jobs represent? Is this the behavior when the jobs are not killed properly?</p>\n"},{"tags":["sql","sql-server","ssas","mdx"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":13037446,"title":"How to find long running queries?","body":"<p>We are using SSAS and MOLAP. In SQL land, I know ways to query to get the longest running queries (see <a href=\"http://stackoverflow.com/q/941763/301816\">this SO question</a>). It would be nice if we could do the same for our cube, get a list of long running MDX queries. Is this possible and what would this query look like?</p>\n"},{"tags":["sql-server","stored-procedures","transactions","try-catch"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":13016556,"title":"Using Transaction","body":"<p>How do I alter the following procedure in such a way that if insert statement is not successfully executed because of PrimaryKey or something the Delete Statement must also not be executed and further more it should generate an error message that I would Write myself.</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[ReAdmissionInsert]\n@GRNo varchar(4),\n@ClassId numeric(2),\n@FacultyId numeric(1),\n@Section varchar(1),\n@SessionId numeric(1)\nAS\nbegin\ninsert into ReAdmissionDtl(GRNo,ClassId,FacultyId,Section,SessionId) values(@GRNo,@ClassId,@FacultyId,@Section,@SessionId)\ndelete from Discharge where GRNo = @GRNo\nend\n</code></pre>\n"},{"tags":["sql","sql-server","stored-procedures","csv","import"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":745,"score":1,"question_id":3229445,"title":"CSV Import with Validation","body":"<p>I have a need to import a number of CSV files into corresponding tables in SQL. I am trying to write a stored procedure that will import any of these CSV files, using a number of parameters to set things like file name, destination name etc.</p>\n\n<p>Simple so far. The problem comes because of the structure of this DB. Each data table has a number of (usually 5) columns that are of a set format, and then however many data columns you want. There are then a set of data validation tables that contain specific sets of values that these 5 columns can contain. So the problem is, is that when I do the import from CSV, I need to validate that each row that is imported meets the criteria in these validation tables, essentially that there is a row in the validation table that has data that matches the 5 columns in the imported data.</p>\n\n<p>If it does not, then it needs to write an error to the log and not import it, if it does then it should import it.</p>\n\n<p>Here is an example of what I mean:</p>\n\n<p><strong>Data Table (where the imported data will go)</strong></p>\n\n<pre><code>|datatype|country|currency| datacolumn1 | datacolumn|\n|1       | 2     |  GBP   | 10000       | 400       |\n|3       | 4     |  USD   | 10000       | 400       |\n</code></pre>\n\n<p><strong>Validation table</strong></p>\n\n<pre><code>|datatype|country|currency|\n|1       |2      |GBP     |\n|2       |3      |USD     |\n</code></pre>\n\n<p>So the first line is valid, it has a matching record in the validation table for the first 3 columns, but the second is not and should be rejected.</p>\n\n<p>The added problem is that each table can reference a different validation table (although many reference the same one) so the columns that have to be checked often vary in amount and name.</p>\n\n<p>My first problem is really how to do a row by row check when importing from CSV, is there any way to do so without importing into a temporary table first?\nAfter that, what is the best way to check that the columns match, in a generic way despite that fact that the name and number of columns change depending on what table is being imported.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2008-r2","sql-management-studio"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13037863,"title":"Clarification as to why EXECUTE AS USER/LOGIN is not returning the expected results?","body":"<p>I am running the following query against a database:</p>\n\n<pre><code>execute as user = 'domain\\username'\nselect * from fn_my_permissions(null, 'DATABASE')\norder by subentity_name, permission_name\nrevert;\n</code></pre>\n\n<p>But the following error gets thrown:</p>\n\n<p><code>Cannot execute as the database principal because the principal \"dev\\spadmin\" does not exist, this type of principal cannot be impersonated, or you do not have permission.</code></p>\n\n<p>The user is the dbo of the database, and when I open up the properties in management studio, I can see that it is associated with that login.  Running <code>EXECUTE AS LOGIN = 'domain\\username'</code> does return results, on the other hand.  And if I explicitly run <code>EXECUTE AS USER = 'dbo'</code>, I get results.  I also have a different database where this same scenario returns results with both <code>EXECUTE AS USER</code> and <code>EXECUTE AS LOGIN</code>.</p>\n\n<p>In another scenario with a different user, I have ran <code>EXECUTE AS LOGIN = 'domain\\username'</code> and I do not get results, but I do get results with <code>EXECUTE AS USER = 'domain\\username'</code>.</p>\n\n<p>Both users in these scenarios are associated with logins that are members of <code>db_owner</code> for the database.</p>\n\n<p>Can anybody tell me why these queries are not returning the results that I expect?  And let me know if I am missing any important information.  Thanks!</p>\n"},{"tags":["sql-server","backup","restore","database-restore"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1077,"score":1,"question_id":10214546,"title":"Restore Backup Access Denied","body":"<p>I'm trying to restore a backup from a <code>.bak</code> file to a local database server and keep getting the error message.</p>\n\n<blockquote>\n  <p>An exception occurred while executing a Transact-SQL statement or batch.(Microsoft.SqlServer.ConnectionInfo)<br>\n  Cannot open backup device 'C:\\Clients\\SQLitis\\jMKZ.bak'. Operating system error 5(Access is denied.).<br>\n  RESTORE HEADERONLY is terminating abnormally. (Microsoft SQL Server, Error: 3201)</p>\n</blockquote>\n\n<p>No idea where to even start troubleshooting this. I'm on an administrator account and have full privileges so there shouldn't be anything to deny me doing this but I'm still getting the error message.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":77,"score":2,"question_id":13037575,"title":"T-SQL CASE / Subquery","body":"<p>I have a T-SQL query below that returns results based on date</p>\n\n<pre><code>SELECT\n    SUM(CASE WHEN date ='2012-10-31' then Amount ELSE 0 END) AS [Amount],\n    SUM(CASE WHEN date ='2012-10-31' then Discount1  ELSE 0 END) AS [Discount 1],\n    SUM(CASE WHEN date ='2012-10-31' then Discount2  ELSE 0 END) AS [Discount 2]\n    SUM(CASE WHEN date ='2012-10-31' then Amount - Discount1 - Discount2 ELSE 0 END) AS   \n[Total Amount]\nFROM\n    Orders\n</code></pre>\n\n<p>Current results:</p>\n\n<pre><code>Amount   Discount1   Discount2   Total\n--------------------------------------  \n100.00   5.00        5.00        90.00\n</code></pre>\n\n<p>I would like to have this run and display/group by month. Any ideas?</p>\n\n<pre><code>                         Amount    Discount1  Discount2   Total\n                       -------------------------------------------\n  October                100.00     5.00        5.00       90.00\n  November               100.00    10.00        5.00       85.00\n  December               200.00    20.00       10.00      170.00 \n</code></pre>\n"},{"tags":["sql-server","database","design","database-design"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":40,"score":-1,"question_id":13037372,"title":"defining a database structure for business rules and policies","body":"<p>I have rules and policies as follows:</p>\n\n<p>Rule 1 : When customer buys $100 worth of stuff, notify sales executive.</p>\n\n<p>Rule 2 : When customer purchases $2000 worth of stuff, notify sales head.This trumps rule1.</p>\n\n<p>Rule 3 : When sales rep does less than $1000 in sales per day, notify their manager.</p>\n\n<p>Rule 4: When sales rep does less than $100 in sales per week, notify the division manager.</p>\n\n<p>..and so on..\nThese rules are grouped into policies ( e.g: min-sales policy, customer retention policy, etc..)</p>\n\n<p>Executing one rule can trigger another rule. </p>\n\n<p>I'm trying to represent these rules and policies in the database, but cannot find the right table(s) structure, since the conditional statement can be dynamic, and sometimes calculated ( e.g: sales in a week, sales in a day by particular person), etc.</p>\n\n<p>I'm using sql server 2008.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":13037205,"title":"SQL to List Common Values of One Column Based on an Input List of Values From Another?","body":"<p>We have an ASP.NET application with SQL Server 2008 back end.\nWe have the following setup in our SpecimenEvents table:</p>\n\n<pre>EventID SpecimenID  EventType\n      1        101        A       \n      2        102        A\n      3        103        A\n      4        101        B\n      5        103        B\n      6        101        C</pre>\n\n<p>Given a list of SpecimenIDs as input -- how would you write a query to return just those EventType(s) COMMON to all SpecimenIDs in the input list?\nFor example: </p>\n\n<p>a SpecimenID input list of (101,102,103) should return 'A'</p>\n\n<p>a SpecimenID input list of (101) should return 'A','B','C'</p>\n\n<p>a SpecimenID input list of (101,103) should return 'A', 'B' ...</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":13036717,"title":"multiple keyword search in sql","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2474229/keyword-to-sql-search\">Keyword to SQL search</a>  </p>\n</blockquote>\n\n\n\n<p>I am using SQL SERVER 2008 &amp; I am given to task to search for specific keywords( close to 100) relating to technical support notes. There are 20 columns and 1 million rows. The keywords I am looking is in 3 specific columns. How can I do it?</p>\n\n<p>Column header : date, week, Qtr, Agent, Manager, Customer,Problem, Description, Solution,Order #, </p>\n\n<p>I have to search for the keywords from Problem, Description, Solution columns. \nProblem : nvarchar\nDescription: nvarchar \nSolution : ntext </p>\n\n<p>Keywords : bluetooth, cd, dvd, hard drive, motherboard, power supply, battery, ac adapter, windows, blue screen. </p>\n\n<p>Sample data:\nProblem :noise from fan Description : noise from fan Solution: noise from fan and system heating up. has A20 BIOS. checked support site and BIOS update available. customer to try that and get back to us with results</p>\n"},{"tags":["c#","sql-server","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":13036635,"title":"Mapping 1 to 0-1 In Entity Framework","body":"<p>Doing Entity Framework (5) code first, although we are not generating our data model from the code--we just keep them in sync manually (less of a pain than it sounds).</p>\n\n<p>Trying to create a 1 to 0-1 relationship.  Here is the setup using a made-up example of a customer that could have 0 or 1 address:</p>\n\n<p><strong>Edit: original example was not right.  Customer can have 0-1 Addresses, Address has exactly 1 customer.  Table design and code both updated.</strong></p>\n\n<pre>\nAddress\n--------------\nAddressId (identity)\nAddressText\nCustomerId (Edit: this employs a unique constraint)\n</pre>\n\n<pre>\nCustomer\n--------------\nCustomerId (identity)\nCustomerName\n</pre>\n\n<p>Relevant part of Address mapping:</p>\n\n<pre><code>   this.HasKey(t =&gt; t.AddressId);\n   //SEE NOTE ON THIS BELOW\n   //this.Property(t =&gt;t.AddressId).\n                   HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n   this.HasRequired(t =&gt; t.Customer)\n       .WithOptional();\n</code></pre>\n\n<p>Relevant part of Customer mapping:</p>\n\n<pre><code>  this.HasKey(t =&gt; t.CustomerId);\n   this.HasOptional(b =&gt; b.Address)\n            .WithRequired(); \n</code></pre>\n\n<p>Note the line commented out in Customer.  If I include this, I get the following error:</p>\n\n<blockquote>\n  <p>A dependent property in a ReferentialConstraint is mapped to a\n  store-generated column. Column: 'CustomerId'.</p>\n</blockquote>\n\n<p>If I don't include it, I get:</p>\n\n<blockquote>\n  <p>Cannot insert explicit value for identity column in table 'Customer'\n  when IDENTITY_INSERT is set to OFF.</p>\n</blockquote>\n\n<p>I have searched high and low, and the code above seems to be the recommended approach.  I have also seen some vague mention that 1:1 relationships can't be modeled unless the two tables share a key of the same name?</p>\n\n<p>Can this sort of relationship be modeled in code, and if so, what is the correct syntax?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":32,"score":3,"question_id":13036917,"title":"SQL Server Views - Index Usage","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/8700126/index-is-not-getting-applied-on-indexed-view\">Index is not getting applied on Indexed View</a>  </p>\n</blockquote>\n\n\n\n<p>Is there a way to make the views to use only the index that I created on them, and not the ones on the base tables?</p>\n"},{"tags":["c#","asp.net","sql-server","ajax","excel"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":87,"score":2,"question_id":13036569,"title":"Export SQL Server data to Excel in a web app","body":"<p>I would like to export data from a SQL Server pull (usually I use <code>SqlDataReader</code>, but am open to suggestions) into an Excel/CSV file and have the user of the web app get it as a download. </p>\n\n<p>I'd like to do this AJAX style, so that the click on download won't cause a reload/postback. </p>\n\n<p>Anyone done this before or have an idea on how?</p>\n"},{"tags":["sql-server","entity-framework","temporary-tables"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":427,"score":1,"question_id":9760323,"title":"Entity Framework and stored procedure returning temp table Issues","body":"<p>(Disclaimer - I'm not the database designer. I'm just the poor developer what has to make this work.)</p>\n\n<p>There are 17 (at the moment) tables with identical structure - name, address, phone number.</p>\n\n<p>Given a phone number, I have to check to see if there's a matching entry in any of the tables, then return that address.</p>\n\n<p>So, I created a view to get the list of tables (there's a ref table that holds that info), then I created a stored procedure to </p>\n\n<ol>\n<li>create a temp table, </li>\n<li>using cursors, check each table in the view for the phone number, using sql concatenation. If a record is found, insert it into the temp table. </li>\n<li>return the rows from the temp table. </li>\n</ol>\n\n<p>This all works in straight T-SQL. </p>\n\n<p>Now, I'm trying to use Entity Framework 4+ to call the stored procedure. But the function import interface won't generate columns. It says return type = none, and the LINQ code expects an int and won't compile. </p>\n\n<p>Any ideas on how to make this work? </p>\n\n<p>I know I can move the check tables part to code, if I absolutely have to, but I'd rather have the above method work. </p>\n"},{"tags":["sql-server","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":71,"score":2,"question_id":13035872,"title":"SQL Query to Entity Framework (ExecuteStoreQuery)","body":"<p>I have a SQL query that works fine and returns proper results</p>\n\n<pre><code> declare @memberId decimal\nset @memberId=100\n\nselect s.Id, s.StatusDate, s.StatusText, p.FirstName, p.LastName, p.Photo\n from MemberStatus s join Profile p on s.SenderId = p.MemberID\n where s.SenderId IN\n (\nselect f.MemberID as id from Member_FriendRequest f where (f.FriendID = @memberId ) and f.Status=2\nunion\nselect f.FriendID as id from Member_FriendRequest f where (f.MemberID=@memberId) and f.Status=2\nunion \nselect @memberId\n)\n</code></pre>\n\n<p>But when I try to use it in ASP.NET it never returns any result</p>\n\n<pre><code>     using (var db = new ExerciseProgramManagerEntities())\n            {\n                var pMmemberId = new SqlParameter(\"@memberId\", senderId);                                    \n\n                var result  = db.ExecuteStoreQuery&lt;DynamicObject&gt;(\"select s.Id, s.StatusDate, s.StatusText, p.FirstName, p.LastName, p.Photo \"+\n \"from MemberStatus s join Profile p on s.SenderId = p.MemberID \" +\n \"where s.SenderId IN \"+\n \"(\"+\n\"select f.MemberID as id from Member_FriendRequest f where (f.FriendID = @memberId ) and f.Status=2 \"+\n\"union \"+\n\"select f.FriendID as id from Member_FriendRequest f where (f.MemberID=@memberId) and f.Status=2 \" +\n\"union \"+\n\"select @memberId)\", pMmemberId);\n</code></pre>\n\n<p>What's wrong in my query?</p>\n"},{"tags":["sql-server","stored-procedures","powershell"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":13035091,"title":"Checking needed parameters of stored procedure with PowerShell","body":"<p>I have a stored procedure in SQL Server 2008 R2 that requires some parameters to be run. </p>\n\n<p>Is there a way I can dynamically check the stored procedure to see which parameters are needed? It is being called via <code>invoke-sqlcmd</code> in powershell</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":75,"score":-1,"question_id":13035224,"title":"How can I store sql table row count in a string variable?","body":"<p>I am trying to store the result of query string </p>\n\n<pre><code>q = \"select count(*) from test\" (asp.net c#)\n</code></pre>\n\n<p>in a string variable so that I can display the count on a label on button click.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":2,"question_id":13034007,"title":"SQL split a result properly","body":"<p>I have a result from a request that gives me thousands of lines, and i want to split it into little temporary tables of 10k rows each, with an incremental number from 1 up to 10 000. Lets say i have a big query of 25 000 rows, what i want is to split it in 2 tables of 10k and a third table of 5k. Of course I dont know that exact number of pages i will have to split into.</p>\n\n<blockquote>\n  <p>My first query with all the rows is named [#DECLARATION] and have a number NumeroDeclaration that is 0 for page 1, 1 for page 2, etc. to 9. Each 10 000 of rows it is incremented from 0 to 10 000.</p>\n</blockquote>\n\n<p>at this time my request looks like this:</p>\n\n<pre><code>    --Page 1\n    SELECT * INTO [#PAGE1] FROM [#DECLARATION] WHERE NumeroDeclaration =0 ORDER BY NumeroTransaction;\n        --Numerotation\n        WITH upd AS (SELECT NumeroDeclaration, ROW_NUMBER() OVER (ORDER BY NumeroTransaction) AS Numtemp FROM [#PAGE1])\n        UPDATE upd SET NumeroDeclaration = Numtemp\n    --Page 2\n    SELECT * INTO [#PAGE2] FROM [#DECLARATION] WHERE NumeroDeclaration =1 ORDER BY NumeroTransaction;\n        --Numerotation\n        WITH upd AS (SELECT NumeroDeclaration, ROW_NUMBER() OVER (ORDER BY NumeroTransaction) AS Numtemp FROM [#PAGE2])\n        UPDATE upd SET NumeroDeclaration = Numtemp\n    --Page 3\n    --etc.... to Page 10...\n</code></pre>\n\n<p><strong>I have to do this over 10 pages, and it works, but is there another <em>shorter</em>/classier way to do it?</strong></p>\n\n<p>Im using SQL SERVER 2008 Thanks for reading</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":5,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":2599,"score":4,"question_id":283764,"title":"Finding someone's age in SQL","body":"<p>In a SQL Server database, I record people's date of birth. Is there an straight-forward method of working out the person's age on a given date using SQL only? </p>\n\n<p>Using <strong>DATEDIFF(YEAR, DateOfBirth, GETDATE())</strong> does not work as this only looks at the year part of the date. For example <strong>DATEDIFF(YEAR, '31 December 2007', '01 January 2008')</strong> returns 1.</p>\n"},{"tags":["sql","sql-server","ssms2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12747693,"title":"SQL Server Management Studio  error \"Saved settings file cannot be found\"","body":"<p>Here is my problem:\nEvery time I start the \"Microsoft SQL Server Management Studio\", I get a warning</p>\n\n<pre><code>The automatically saved settings file \"\\\\Settings\\CurrentSettings-2012-02-13.vssettings' cannot be found.\n</code></pre>\n\n<p>The message goes on to say :</p>\n\n<pre><code>\"You can change this file on the 'Import and Export Settings' Tools Options page\". The IDE will use your most recent settings for this session.\n</code></pre>\n\n<p>Where is this setting? How to fix this?</p>\n\n<p>thanks!</p>\n"},{"tags":["sql-server","winforms","named-pipes","tcp-ip","sqlbrowser"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13035500,"title":"How to enable named pipes and sqlbrowser on a remotely hosted database sever","body":"<p>I have a WinForms application that is giving some of my customers fits with regard to connection issues. (The infamous \"network-related or instance-specific error occurred while establishing a connection to SQL Server\" problem). The database that I am using is hosted by winhost.com and I do not have access to turn on named pipes, sqlbrowser, and TCP/IP. I know for sure that this will solve my problem, however, how do I go about doing this with only SQL Server Management Studio installed and the database server actually residing on a remote server? Is there a way to enable these configurations with Management Studio instead of using Configuration Manager?</p>\n\n<p>Thank you in advance.</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":13035007,"title":"another Conversion failed when converting datetime from character string","body":"<pre><code>SELECT Asset.AssetID, AnsMaint.Answer, Convert(datetime, AnsMaint.Answer) as maintasdate\nFROM Asset INNER JOIN \nAssetAnswer AnsMaint ON AnsMaint.AssetID = Asset.AssetID INNER JOIN  \nAssetField FldMaint ON FldMaint.AssetFieldID = AnsMaint.AssetFieldID \nWHERE FldMaint.FieldText = 'Maint. Agreement Term' \nAND ISDATE(AnsMaint.Answer) = 1 \nAND Convert(datetime, AnsMaint.Answer) &lt; DateAdd(d, 145, GetDate())\n</code></pre>\n\n<p>I get the error on the last part of the AND.  If I comment the AND out, it works fine.  My dates in the DB happen to be 10/10/2012 and are valid.  IsDate should weed out anything that is not valid.</p>\n\n<p>In DB the results (when I comment out the last line).  I'm completely stumped.</p>\n\n<pre><code>106 10/10/2012  2012-10-10 00:00:00.000\n115 10/10/2012  2012-10-10 00:00:00.000\n</code></pre>\n\n<p>MORE interesting tidbits.  If I change the last AND line to </p>\n\n<pre><code>AND DateAdd(d, cast(Asset.MaintenanceFreq as int), Convert(datetime, AnsMaint.Answer)) &lt; DateAdd(d, 45, GetDate()) \n</code></pre>\n\n<p>it works.  If I take out the 2nd parameter (the cast as int) and replace it with a number or a zero, it gives me the same error.</p>\n\n<p>I'm stumped.  Any help would be so much appreciated!</p>\n\n<p>Oh, AssetMaint.Answer is a varchar field in the DB nothing I can do about that.</p>\n"},{"tags":["sql","sql-server","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":54,"score":3,"question_id":12974793,"title":"Is there a way to make the Sql Server FullText engine to stop recognizing numbers as numbers?","body":"<p>I have an user input processor that transforms <code>this search</code> into <code>\"this\" AND \"search\"</code>. My processor works great, it breaks the user input into pieces according to what I believe to be <code>word breakers</code>, which include punctuation.</p>\n\n<p>The problem is that, while indexing, Sql Server applies a special approach when it comes to numbers. </p>\n\n<p>if you index the following string:</p>\n\n<pre><code>12,20.1231,213.23,45,345.234.324.556,234.534.345\n</code></pre>\n\n<p>it will find the following index keys:</p>\n\n<pre><code>12\n1231\n20\n213\n23,45 (detected decimal separator)\n234.534.345 (detected thousand separator)\n345.234.324.556 (detected thousand separator)\n</code></pre>\n\n<p>Now, if the user searches for <code>324</code> he/she won't find anything, because <code>324</code> is contained within the last entry, not in the beggining, so it is not going to be found. I'd like it to stop treating numbers as numbers and just index it the way it does with words.</p>\n\n<p>Is there a way to alter this behavior? without implementing too much code?</p>\n"},{"tags":["sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13013477,"title":"SQL Sub-Query performance issue","body":"<p>I'm having performance issues with my SQL sub query.</p>\n\n<p>As a hard-coded query, it takes about 1 second to run:</p>\n\n<pre><code>SELECT   ColumnA\n        ,ColumnB\n        ,ColumnC\nFROM    [LinkedServer].[Database].[Schema].[View]\nWHERE   ColumnA IN \n    (\n        'ABC',\n        'DEF',\n        'HIJ',\n        'KLM'\n    )\n</code></pre>\n\n<p>However, the following code takes over a minute to run:</p>\n\n<pre><code>SELECT   ColumnA\n        ,ColumnB\n        ,ColumnC\nFROM    [LinkedServer].[Database].[Schema].[View]\nWHERE   ColumnA IN \n    (\n        SELECT ColumnA FROM #TempTable\n    )\n</code></pre>\n\n<p>The temp table contains the same 4 rows as the hard-coded example. The view on the linked server contains approx. 700,000 rows (and, unfortunately, is outside of my control). The ColumnA data types are the same and both tables are indexed.</p>\n\n<p>Any ideas on how to improve the performance of this query?</p>\n\n<p>Many thanks.</p>\n"},{"tags":["sql-server","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":50,"score":-1,"question_id":13033689,"title":"I want to know from which network drive my .bat file is pulling the files","body":"<p>I have an SQL SERVER job and the job type is \"Operating System(CmdExec). It is run as SQL Agent Service Account. The command is <code>F:\\Tools2\\SSIS\\MonthlyProcess.bat</code></p>\n\n<p>Can anyone please explain me what this job is doing? This is supposed to be an SSIS job where the files are pushed from the Mainframe server onto a network drive and this <code>.bat</code> file is pulling the flat files from the shared network drive onto the local F drive. </p>\n\n<p>How do I know from which network drive the <code>.bat</code> file is pulling the files and how do I edit the .bat file? Because whenever I try to open the <code>.bat</code> file a command window opens and closes pretty fast.</p>\n"},{"tags":["sql-server","sql-server-2008","primary-key","clustered-index"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":13029413,"title":"Sql Server table structure","body":"<p>I have the following data i want to upload:</p>\n\n<pre><code>(Pair)    (Date)    (Time)       (Bid)   (Ask)\nEurUsd  01/01/2012  18:04:01    1.55037 1.55137\nEurUsd  01/01/2012  18:04:20    1.55018 1.55118\nEurUsd  01/01/2012  18:04:22    1.55031 1.55131\nEurUsd  01/01/2012  18:04:36    1.55045 1.55145\nEurUsd  01/01/2012  18:04:40    1.55058 1.55158\nEurUsd  01/01/2012  18:04:40    1.5508  1.5518\n\nGbpUsd  01/01/2012  18:06:11    1.55097 1.55197\nGbpUsd  01/01/2012  18:06:22    1.55117 1.55217\nGbpUsd  01/01/2012  18:06:24    1.55128 1.55228\nGbpUsd  01/01/2012  18:06:38    1.55098 1.55198\n</code></pre>\n\n<p>The data types are as follows: Nchar(6), Date, Time, Decimal, Decimal.</p>\n\n<p>Unfortunately i cant guarantee that the rows will be unique on a minute basis. I will also be adding data to this table on a Daily basis &amp; other Pairs.</p>\n\n<p>Question 1). What is the best way to set up a PK for the above data. Im assuming i should just set up a new column called \"Id\", of type BigInt, and set its \"Is Identity\" to Yes? Then set the PK to be \"Id\"?</p>\n\n<p>Question 2). Clustered Index, based on \"Pair\",\"Date\", \"Time\"?</p>\n\n<p>Question 3). Im assuming that if i set up an \"Id\" column in the table, i would need to have ColumnMapping on any sqlbulkcopy operation i was using to upload the data? Or is it not possible to load data into the column once its \"Is Identity\" property is set?</p>\n\n<p>Thanks for your time.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","umbraco","ssms"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":95,"score":1,"question_id":13031484,"title":"\"Cannot open database - login failed\" . Works in Management Studio, not code","body":"<p>Oh yes, the famous error:</p>\n\n<blockquote>\n  <p>Cannot open database \"MYDBNAME\" requested by the login. The login failed. Login failed for user 'USERNAME'.</p>\n</blockquote>\n\n<p><strong>Let me explain my situation:</strong></p>\n\n<p>I have a database server, which has a SA account and my user account. The user has the correct mappings to my database (dbowner).</p>\n\n<p>I can open the database with this user, using SQL Management Studio 2008 R2, both on the SQL server itself (using localhost), and on my frontend server.</p>\n\n<p>However, when I run my application, I get the login failed error. </p>\n\n<p>Strange thing is I have a test application and a production application on our frontend server. The test application has test databases on the same database server, and there are no login problems here. The only difference between the two, are the prefix which differs from \"TEST\" to \"PROD\". The test application works, the production however, doesn't. The user mappings and seem it should work on both.</p>\n\n<p>Any ideas?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Our connectionstring:</p>\n\n<pre><code>&lt;add key=\"umbracoDbDSN\" value=\"Server=Websqlsrv01;Database=PROD_Databasename;User ID=umbraco_user;Password=password;Trusted_Connection=False\" /&gt;\n</code></pre>\n"},{"tags":["sql-server","ssis","geospatial","shapefile","dbase"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13021912,"title":"DBASE file reading Limitation","body":"<p>I have a Dbase file (*.dbf) which I am currently reading using Microsoft OLEDG Jet Provier.</p>\n\n<p>Now the issue is that my Dbase file is more then 2GB in size and as per the limitation of Jet Provider(Which only runs on 32 bit) I can only read 2 GB worth of data. Is there any alternative method to read the Dbase file? other then Jet OLEDB provider. I tried all the Microsoft OLEDB providers but all seem to read only 2 GB data.</p>\n\n<p>Cheers,</p>\n"},{"tags":["sql","sql-server"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":103,"score":3,"question_id":13030872,"title":"SQL Server 2008 big INSERT still slow after wrapped in transaction","body":"<p>I have been looking at a big INSERT problem in my query:</p>\n\n<pre><code>INSERT table_name\nSELECT .....;\n</code></pre>\n\n<p>The table has no indexes and needs about 20 million rows to insert into it. I run the query in SQL Server 2008 R2 on one of our servers. The original performance is about 40 minutes. I then read posts here telling me to wrap the <code>INSERT</code> in <code>BEGIN TRANSACTION</code> / <code>COMMIT</code>. I did that, and the time spent dropped to 6 minutes.</p>\n\n<p>However, when I tried to run the transaction wrapped query for next few times, the time went back to 40 minutes, like the <code>TRANSACTION</code> effect is gone. I don't know what happened in the following runs. Any idea? </p>\n\n<p>ADD:</p>\n\n<p>One other <a href=\"http://stackoverflow.com/questions/521887/how-much-does-wrapping-inserts-in-a-transaction-help-performance-on-sql-server\">post</a> says TRANSACTION is intended to be used for data consistency not performance, suggesting batch insert every 5K rows. How can I break up above single INSERT SELECT statement to batches? I am confused.</p>\n\n<p>UPDATE:</p>\n\n<p>Indeed, I find the performance improvement is not from TRANSACTION, but possibly is from server side table caching, as I run next few times and performance are like 5 minutes.</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13033379,"title":"How to alter table add column with named default constraint and named foreign key constraint?","body":"<p>I have two existing tables (TableA and TableB) and I need to add a new column to TableA that has a foreign key to TableB and has a default value that is not null... and both these constraints need to be named. How can I do this?</p>\n"},{"tags":["sql","sql-server","batch-processing"],"answer_count":5,"favorite_count":5,"up_vote_count":17,"down_vote_count":0,"view_count":6879,"score":17,"question_id":2583517,"title":"Run all SQL files in a directory","body":"<p>I have a number of .sql files which I have to run in order to apply changes made by other developers on an SQL Server 2005 database.\nThe files are named according to the following pattern:</p>\n\n<pre><code>0001 - abc.sql\n0002 - abcef.sql\n0003 - abc.sql\n...\n</code></pre>\n\n<p>Is there a way to run all of them in one go?</p>\n"},{"tags":["sql","sql-server","performance"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":126,"score":6,"question_id":12976486,"title":"SQL Server uses scan instead of seek when using a window function and predicate contains a variable","body":"<p>Take a look at this fiddle: <a href=\"http://sqlfiddle.com/#!6/18324/2\" rel=\"nofollow\">http://sqlfiddle.com/#!6/18324/2</a></p>\n\n<p>Expand the very first execution plan, for the queries against view <code>B</code>.<br>\nNotice that the first query executes using index seek, while the second one - using index scan. In my real setup, with thousands of rows, this produces a performance hit that is quite considerable.  </p>\n\n<p>WTF???</p>\n\n<p>The queries are equivalent, aren't they? Why does a literal produce seek and a variable - scan?<br>\nBut more importantly: <strong>how can I work around this</strong>?  </p>\n\n<p><a href=\"http://stackoverflow.com/questions/4459425/sql-server-query-fast-with-literal-but-slow-with-variable\">This post</a> comes closest to the problem, and the solution that works from there is using <code>option(recompile)</code> (thank you, Martin Smith). However, that does not work for me, because my queries are being generated by my ORM library (which is Entity Framework) and I cannot amend them manually.<br>\nRather what I'm looking for is a way to reformulate the <code>B</code> view so that the problem would not occur.</p>\n\n<p>While fiddling with this problem, I have noticed that it is always the \"Segment\" block in the execution plan that loses the predicate. To verify this, I reformulated the query in terms of a subquery with <code>min</code> function (see view <code>D</code>). And voila! - both queries against the <code>D</code> view produce identical plans.</p>\n\n<p>The bad news, however, is that I cannot use this <code>min</code>-powered trick, because in my real setup, the column <code>Y</code> is actually <strong>several columns</strong>, so that I can order by them, but I cannot take a <code>min()</code> of them.<br>\nSo the second question would be: <strong>can anyone come up with a trick that is similar to min-powered subquery, but works for several columns?</strong></p>\n\n<p><strong>NOTE 1</strong>: this is definitely not related to the tipping point, because there are just 2 records in the table.<br>\n<strong>NOTE 2</strong>: it also doesn't have to do with the presence of a view. See an example with view <code>C</code>: the server is happily using seek in that case.</p>\n"},{"tags":["sql","sql-server","batch","execute","sql-scripts"],"answer_count":5,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":4102,"score":3,"question_id":8847233,"title":"How to run multiple SQL scripts using a batch file?","body":"<p>I have a case where i have got 10+ <code>SQL script</code>.</p>\n\n<p>I don't want to go and run all my scripts 1 by 1.</p>\n\n<p>Is there a way that i can run all my scripts in succession in <code>SQL Management studio</code>.</p>\n\n<p>I found <a href=\"http://dotnetanalysis.blogspot.com/2011/04/run-multiple-sql-scripts.html\" rel=\"nofollow\">this</a> post. Creating a batch file seems easier.</p>\n\n<p>This is all you need:</p>\n\n<pre><code>@echo off\nECHO %USERNAME% started the batch process at %TIME%  &gt;output.txt\n\n\nfor %%f in (*.sql) do (\n (\nsqlcmd.exe  -S servername -E   -d databasename -i %%f &gt;&gt;output.txt\n)\n\n\npause\n</code></pre>\n\n<p>Replacing servername and databasename, but it seems to be not working.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql","sql-server","casting"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":53,"score":4,"question_id":13031980,"title":"Cast function failing from derived table SQL Server 2008","body":"<p>I've got one table with alphanumeric codes.  In this particular instance, I am not concerned with the codes that are alphanumeric in nature, only those that contains integers.  I wrote a small query to find a the subset of codes that I needed:</p>\n\n<pre><code> select CAST(icd as float) as icd\n\nfrom\n(\nselect i.icd\n    from icd as i\n    where icd like '952%' or icd like '806%' or icd like '3440%' or icd like '3441'\n)t\n</code></pre>\n\n<p>This returns me a list of the codes I needed.  However, when I try to use a where clause like:</p>\n\n<p><code>where icd between 80600 and 80610</code> the query fails, telling me that it can't convert the varchar datatype to int.  However, if I do something like </p>\n\n<pre><code>select CAST(icd as float) as icd,icd+10\n\nfrom\n(\nselect i.icd\n    from icd as i\n    where icd like '952%' or icd like '806%' or icd like '3440%' or icd like '3441'\n)t\n</code></pre>\n\n<p>I can add ten to each code and it runs, meaning that they are in fact integers.  I want to use the <code>where</code> clause like this because codes 80600-80610 should be labeled X and 80611-80620 they should be labeled Y.  I can do this manually for each code, but I'd like to be more extensible than that.</p>\n\n<p>How can I make sure that SQL Server only looks at the derived table when using this where clause, instead of failing?</p>\n"},{"tags":["sql","sql-server","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":13029849,"title":"Insert multiple records from joining temporary tables","body":"<p>I need to insert multiple return records from a joining select command to a temporary table. I used the below command . The select statement return two value but when i insert using the below command then the (<code>#TempTableValue</code>) temporary table have nothing.All other field declaration is ok and the joining select command is returning value properly. </p>\n\n<pre><code>INSERT into #TempTableValue DEFAULT values\nSELECT #temp1.id,#temp1.DestFieldName,#temp2.FieldValues \nFROM #temp2\nINNER JOIN #temp1\nON #temp2.FieldName=#temp1.SourceFieldName\n\nselect * from #TempTableValue\n</code></pre>\n\n<p>But the last select command return all Null value. What is the problem here?</p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":5,"up_vote_count":22,"down_vote_count":0,"view_count":9139,"score":22,"question_id":1515969,"title":"Exporting data In SQL Server as INSERT INTO","body":"<p>I am using SQL Server 2008 Management Studio and have a table I want to migrate to a different db server.</p>\n\n<p>Is there any option to export the data as an insert into SQL script?? </p>\n"},{"tags":["sql-server","ssis","ssis-data-transformations"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":621,"score":1,"question_id":11120264,"title":"Passing a value to T-SQL procedure and getting an output value from the procedure using execute sql task SSIS","body":"<p>I have a scenario like this:</p>\n\n<p>I need to pass <code>@id</code> to the stored procedure and get the <code>@key</code> from the procedure using SSIS <code>Execute SQL task</code>:</p>\n\n<pre><code>create PROCEDURE lProcedurename\n(@ID int ,\n@key int  output\n)\nwith execute as caller\nas\nset nocount on;\nbegin\nBEGIN TRY\nset @key=999\nEND TRY\nbegin catch\n----some codes\nend catch\nend\n</code></pre>\n\n<p>Please find the execute sql task properties</p>\n\n<p>result set as single row</p>\n\n<p>I have already given the execute sql statement (ssis execute sql task level) as </p>\n\n<pre><code>exec lProcedurename  @ID = ? ,  @key = ?\n</code></pre>\n\n<p><strong>parameter mapping as</strong> </p>\n\n<pre><code>variablename ,direction, data type, parametername ,parameter size\nuser::id input long  o  -1\nuser::key output long 1 -1\n</code></pre>\n\n<p><strong>result set as</strong></p>\n\n<pre><code>resultname,variablename\n0   user::key\n</code></pre>\n\n<p>But when I run the package it errors.. Please let me know is the property setting is correct ?</p>\n\n<hr>\n\n<p>please see the error</p>\n\n<p>*SSIS package \"package1.dtsx\" starting.\nError: 0x0 at CMD Audit OnPreExecute: No result rowset is associated with the execution of this query.\nError: 0xC002F309 at CMD Audit OnPreExecute, Execute SQL Task: An error occurred while assigning a value to variable \"key\": \"Exception from HRESULT: 0xC0015005\".\nTask failed: CMD Audit OnPreExecute</p>\n\n<hr>\n\n<p><strong>for another run of the same package  i can see another error as</strong>\nSSIS package \"package1.dtsx\" starting.\nError: 0xC001405B at Event Package On Error: A deadlock was detected while trying to lock variable \"User::key\" for read access. A lock could not be acquired after 16 attempts and timed out.\nError: 0xC00291EA at Event Package On Error, SQL Task: Variable \"User::key\" does not exist.\nError: 0xC0024107 at Event Package On Error: There were errors during task validation.\nWarning: 0x80019002 at OnError: SSIS Warning Code DTS_W_MAXIMUMERRORCOUNTREACHED.  The Execution method succeeded, but the number of errors raised (5) reached the maximum allowed (1); resulting in failure. This occurs when the number of errors reaches the number specified in MaximumErrorCount. Change the MaximumErrorCount or fix the errors.\nError: 0x0 at testing: No result rowset is associated with the execution of this query.\nWarning: 0x80019002 at OnError: SSIS Warning Code DTS_W_MAXIMUMERRORCOUNTREACHED.  The Execution method succeeded, but the number of errors raised (5) reached the maximum allowed (1); resulting in failure. This occurs when the number of errors reaches the number specified in MaximumErrorCount. Change the MaximumErrorCount or fix the errors.*</p>\n\n<p>Please be noted that the user::key variable has already been defined </p>\n"}]}
{"total":54452,"page":17,"pagesize":100,"questions":[{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":50,"score":3,"question_id":13031850,"title":"How to find the average value in a column of dates in SQL Server","body":"<p>I have a table of 5000 records with a date column.  </p>\n\n<p>How do I find the average of those dates.  I've tried <code>AVG(datefield)</code>, but it says <code>Operand data type datetime is invalid for avg operator</code></p>\n"},{"tags":["c#","sql-server","sql-server-2008-r2","console-application"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":13031112,"title":"Console application can't connect to sql server instance from server, but can from local machine","body":"<p>I have a few asp.net web applications running on a dedicated server.. For one of the websites, I am doing a maintenance task of upgrading all user uploaded images to new naming convention. </p>\n\n<p>I wrote a small, simple console application to do that job. I put the connection string in my app.config like so: </p>\n\n<pre><code>&lt;add key=\"CS\" value=\"Data Source=1.1.1.1;Initial Catalog=MyDatabase;User ID=usr; Password=pwd\" /&gt;\n</code></pre>\n\n<p><sup>Of course, the details here are dummy they are not actually <code>MyDatabase</code> etc... but I do connect to the sql server using an IP address</sup></p>\n\n<p>All my web applications have same format, same details in their <code>web.config</code> files, with the exception of just the database name. Everything works fine too.</p>\n\n<p>I can run the console application from my local dev machine, with the production database, and it connects fine, no problem.  (ran a test query on a test DB successfully)</p>\n\n<p>Now, I need to access the hard disk to rename files etc... so I want to run this console application on the server.. I FTP the app to my server and try to run it there.. it errors out saying: </p>\n\n<pre><code>A network-related or instance-specific error occurred while establishing\na connection to SQL Server. The server was not found or was not accessible. \nVerify that the instance name is correct and that SQL Server is configured \nto allow remote connections. (provider: SQL Network Interfaces,\nerror : 26 - Error Locating Server/Instance Specified)\n</code></pre>\n\n<p>Like I mentioned earlier, same connection is running fine from my dev machine, this only happens when I try to run the console application in the server.. </p>\n\n<p>I've tried searching but couldn't find a similar case anywhere..  esp. as all my web applications that use the same value works fine.. do I need to tell the application to use something? </p>\n\n<p>Many thanks</p>\n"},{"tags":["sql","sql-server","qtsql"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13031013,"title":"How do i use alias in where clause?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/8370114/referring-to-a-column-alias-in-a-where-clause\">Referring to a Column Alias in a WHERE Clause</a>  </p>\n</blockquote>\n\n\n\n<pre><code>   SELECT\nTrade.TradeId, \nIsnull(Securities.SecurityType,'Other') SecurityType, \nTableName,\nCASE \nWHEN \nSecurityTrade.SecurityId IS NOT NULL  \nTHEN \nSecurityTrade.SecurityId\nELSE \nTrade.SecurityId\nEND AS PricingSecurityID,\nsum(Trade.Quantity)OVER(Partition by Securities.SecurityType, SecurityTrade.SecurityId,Trade.Price, Buy,Long ) as sumQuantity,\n--added porfolio id for Getsumofqantity\nTrade.PortfolioId,\n\nTrade.Price,\ncase\nwhen (Buy = 1 and Long = 1) then 1\nwhen (Buy = 0 and Long = 0) then 1\nelse 0\nend Position\nfrom\nFireball_Reporting..Trade\n\nwhere porfolioid =5 and Position =1   \n</code></pre>\n\n<p>i want to use  Position =1   in my where clause which is an alias of case</p>\n\n<pre><code>case\nwhen (Buy = 1 and Long = 1) then 1\nwhen (Buy = 0 and Long = 0) then 1\nelse 0\nend Position\n</code></pre>\n\n<p>How can i use it in where clause?</p>\n\n<p>I tried directly use that CASE statement in where clause but failed\nplease help me</p>\n\n<pre><code>WHERE Trade.SecurityId = @SecurityId AND PortfolioId = @GHPortfolioID AND\n                (case when (Buy = 1 and Long = 1) then 1 when (Buy = 0 and Long = 0) then 1 else 0 end Position = 1)\n</code></pre>\n"},{"tags":["sql-server","vba","vbscript","export-to-excel","dts"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":86,"score":0,"question_id":12990367,"title":"How to generate an excel(.XLS) file with a VB script?","body":"<p>I want to create an excel file with <code>.xls</code> by using VBScript.</p>\n\n<p>Because I want to create a DTS package for our requirement. DTS accepts excel files which has <code>.xls</code> extension only.</p>\n\n<p>Any help?</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13031310,"title":"Custom questions in a .NET survey application","body":"<p>I am trying to find the best solution for creating a survey application which allows the users to choose their questions within an administrator section.</p>\n\n<p>If I have a front end web page which the questions are asked, and when they answer them, I save the answers in a database. Now this is great if the columns in my \"FinishedSurvey\" table match the questions. However, what I want is to be able to allow the users to choose their questions so that when they log on, they see their questions and when submitting, those answers are saved alongside those questions for future retrievable.</p>\n\n<p>This question moves into any application where you require people to be allowed to change what is store in a database without you knowing.</p>\n\n<p>I have done things like this in the past where I have say 20 int columns and 20 varchar columns with generic names which a config file maps to a particular customers configuration. Say varCharColumn1 is mapped to \"What is your name?\". However this is messy, not really expandable, and is wasting storage.</p>\n\n<p>This application will have thousands of users, all asking different questions with different methods of input and different formats of answers. Some may require drop downs with set answers, calendars, free text with 10 characters, free text with 1000 characters, and numbers.</p>\n\n<p>There is probably a simple answer or approach, or even a technology I am not famiular with to do just this, however I can't really think of an easy way.</p>\n\n<p>This particular application is a ASP.NET 4.0 web site with MsSQL database.</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":42,"score":-2,"question_id":13031293,"title":"how to compare two sum of column from two table in access or sql","body":"<p>Table A</p>\n\n<pre><code>SupplierId NetAmt\n1          400\n2          400\n3          300\n2          200\n</code></pre>\n\n<p>Table B</p>\n\n<pre><code>SupplierId RecdAmt\n2          200\n2          200\n2          200\n</code></pre>\n\n<p>So the Query should show </p>\n\n<pre><code>1   400\n3   300\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server","oracle10g","web-security"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":13029593,"title":"session id in the user table in database - Should i use asp.net session id or create one through sequence","body":"<p>I am designing an in house application in asp.net 4.0 and have to use the window authentication.  Database and application both are on different servers.</p>\n\n<p><strong>Environment</strong></p>\n\n<p>Asp.net 4.0, Vb.net 4.0, Oracle 10g, window server 2003 and IIS 6.0</p>\n\n<p><strong>Scenario</strong></p>\n\n<p>When user lands on the first page, system will assign a session id for this user and this id will be saved in the database in the user table under LAST_SESSION_ID column. So every time he access the application (or on new session) system will overwrite this LAST_SESSION_ID column.  I will be keeping the session id in the session variable and pass it to oracle store procedure on every DML transaction and will compare this id with the value in LAST_SESSION_ID column, if they are same then it means users session is still active.</p>\n\n<p><strong>Questions</strong></p>\n\n<blockquote>\n  <ul>\n  <li>I like to know if I should create the unique session id in the oracle database (through sequence) or use the one generated by asp.net session HttpContext.Current.Session.SessionID? To get the unique asp.net session id I would have to set the webconfig file with the following settings and I dont know if it is a good idea as I havent used this technique before.</li>\n  </ul>\n</blockquote>\n\n<p></p>\n\n<blockquote>\n  <ul>\n  <li>Is there any better solution to above scenario? For an example the system I am designing is for 200-300 users (Timesheet APP) and this is an in house application so security is not a big concern. Instead of authenticating the session in the store procedure cant I just check the session before user send the request to database server?</li>\n  </ul>\n</blockquote>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13031023,"title":"SQL Server for xml raw dynamic row name","body":"<p>The select:<br />\n<code>\nselect top 2 name, crdate from sys.sysobjects where xtype = 'u' for xml raw('object')\n</code>\n<br /><br /> produces a result similar to this</p>\n\n<pre><code>&lt;object name=\"table_name1\" crdate=\"2010-05-03T09:34:08.150\" /&gt;\n&lt;object name=\"table_name2\" crdate=\"2011-04-17T11:19:18.157\" /&gt;\n</code></pre>\n\n<p>Is there any way to put a variable (like @RowName) in place of the word \"object\"?<br />\nThanks in advance</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":13014587,"title":"how to check for a non-existent parameter","body":"<p>There is this 3rd party software that passes queries to SQL Server, however, I'm having issues when a parameter does not exist. It resolves the empty string without any quotes, thus giving me an invalid SELECT statement.\ne.g. </p>\n\n<pre><code>-- parameter exists\nSelect ISNULL('param','') as param1 \n\n-- parameter doesn't exist\nSelect ISNULL(,'') as param1\n</code></pre>\n\n<p>I know beforehand if the expected parameter is supposed to be string or numeric. When the parameter is numeric, I intend to enclose it in quotes and check if it's a zero-length string. But how do you do the same for strings?</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13030484,"title":"Data mixing SQL Server","body":"<p>I have three tables and a range of two dates:</p>\n\n<pre><code>Services\nServicesClients\nServicesClientsDone\n\n\n@StartDate\n@EndDate\n</code></pre>\n\n<p>Services:</p>\n\n<pre><code>ID | Name\n1  | Supervisor\n2  | Monitor\n3  | Manufacturer\n</code></pre>\n\n<p>ServicesClients:</p>\n\n<pre><code>IDServiceClient | IDClient | IDService\n1               | 1        | 1\n2               | 1        | 2\n3               | 2        | 2\n4               | 2        | 3\n</code></pre>\n\n<p>ServicesClientsDone:</p>\n\n<pre><code>IDServiceClient | Period \n1               | 201208\n3               | 201210\n</code></pre>\n\n<p>Period = YYYYMM </p>\n\n<p>I need to insert into ServicesClientsDone the months range from @StartDate up @EndDate. I have also a temporary table (#Periods) with the following list:</p>\n\n<pre><code>Period\n201208\n201209\n201210\n</code></pre>\n\n<p>The query I need is to give me back the following list:</p>\n\n<pre><code>IDServiceClient | Period\n1               | 201209\n1               | 201210\n2               | 201208\n2               | 201209\n2               | 201210\n3               | 201208\n3               | 201209\n4               | 201208\n4               | 201209\n4               | 201210\n</code></pre>\n\n<p>Which are client services but the ranks of the temporary table, not those who are already inserted</p>\n\n<p>This is what i have:</p>\n\n<p>Table periods:</p>\n\n<pre><code>DECLARE @i int\nDECLARE @mm int\nDECLARE @yyyy int,\nDECLARE @StartDate datetime\nDECLARE @EndDate datetime\n\nset @EndDate = (SELECT GETDATE())\nset @StartDate = (SELECT DATEADD(MONTH, -3,GETDATE()))\n\nCREATE TABLE #Periods (Period int)\n\nset @i = 0\n\nWHILE @i &lt;= DATEDIFF(MONTH, @StartDate , @EndDate )\nBEGIN\n    SET @mm= DATEPART(MONTH, DATEADD(MONTH, @i, @FechaInicio))\n    SET @yyyy= DATEPART(YEAR, DATEADD(MONTH, @i, @FechaInicio))\n\n    INSERT INTO #Periods (Period) \n        VALUES (CAST(@yyyy as varchar(4)) + RIGHT('00'+CONVERT(varchar(6), @mm), 2))\n\n    SET @i = @i + 1;\nEND\n</code></pre>\n\n<p>Relation between ServicesClients and Services:</p>\n\n<pre><code>SELECT s.Name, sc.IDClient FROM Services\n    JOIN ServicesClients AS sc\n      ON sc.IDService = s.ID\n</code></pre>\n\n<p>Services already done and when:</p>\n\n<pre><code>SELECT s.Name, scd.Period FROM Services\n    JOIN ServicesClients AS sc\n      ON sc.IDService = s.ID\n    JOIN ServicesClientsDone AS scd\n      ON scd.IDServiceClient = sc.IDServiceClient\n</code></pre>\n\n<p>The question is: How can i do to get the list between services installed on clients and date range without the services already done?</p>\n"},{"tags":["sql-server","asp.net-mvc","asp.net-mvc-3"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13028791,"title":"MVC Refactoring Approach? How to introduce more generic functionality?","body":"<p>I am developing a complex wizard driven document creation application. I understand the initial domain's requirement and thus can create an explicit database model for this using explicit column names. Also I am a slight novice with MVC. I know that I will need to make the application more generic ie the Wizard will change, different attributes will need to be stored. My current view/instinct is to implement what is known at present using the most traditional techniques that the tools MVC/EF most closely support then refactor to support the more generic functionality at a later date using technologies such as XML features in SQL Server and WF Foundation etc. Doing all this now seems a big step.</p>\n\n<p>So my question is about the virtue of keeping it simple to start with then refactor in the more sophisticated features later on, rather than building it generic to start with.</p>\n\n<p>Thoughts and wisdom great appreciated.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","asp.net","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":663,"score":2,"question_id":6816359,"title":"how to switch to SQL server state for sessions.... I get an error","body":"<p>Because of some In Proc problems I try to switch to SQL State session.</p>\n\n<p>I checked my CMS database and I see the tables like aspnet_XXX already exists. To be sure I also created the DEFAULT database \"aspnetdb\" and  compared the tables aspnet_xxx  and checked whether they already exists in my CMS_DB_DEV or not... and all of them are already exists.</p>\n\n<p>Then I went to web.config and I configured via IIS the sessionstate connectionstring and it looks like below: </p>\n\n<pre><code>  &lt;system.web&gt;\n      &lt;sessionState allowCustomSqlDatabase=\"true\" \n                    cookieless=\"UseCookies\" mode=\"SQLServer\"   \n                    sqlConnectionString=\"Server=localhost;Database=cms_db_dev;User ID=sa;Password=xxxx\" \n                    timeout=\"20\" /&gt;\n</code></pre>\n\n<p>now when I run my application I get the error:</p>\n\n<blockquote>\n  <p>Unable to use SQL Server because ASP.NET version 2.0 Session State is\n  not installed on the SQL server. Please install ASP.NET Session State\n  SQL Server version 2.0 or above.</p>\n</blockquote>\n\n<p>I use W7 pro, IIS 7.5 is installed</p>\n\n<p>I checked these 2 links which mention the problem but no hope:</p>\n\n<p><a href=\"http://support.microsoft.com/kb/317604\" rel=\"nofollow\">http://support.microsoft.com/kb/317604</a></p>\n\n<p><a href=\"http://www.brianstevenson.com/blog/aspstate-concurrently-running-for-net-1011-and-net-20#comment-984\" rel=\"nofollow\">http://www.brianstevenson.com/blog/aspstate-concurrently-running-for-net-1011-and-net-20#comment-984</a></p>\n\n<p>AFter I get this working on my localhost, I'll do the same in Production machine. It seems the tables already exists, so I just need to configure web.config....</p>\n\n<p>I MAY NOT DELETE THE EXISTING tables (like aspnet_xxx), because it's used by Dotnetnuke CMS system... But I can test on my localhost... </p>\n\n<p>so what am I missing ? </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":12,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":21350,"score":7,"question_id":646845,"title":"Sql server 2008 log will not truncate. Driving me CRAZY!","body":"<p>I consider myself a very experienced SQL person. But I'm and failing to do these two things:</p>\n\n<ul>\n<li>Reduce the size of the allocated log.</li>\n<li><p>Truncate the log.</p>\n\n<p>DBCC sqlperf(logspace)</p></li>\n</ul>\n\n<p>returns:</p>\n\n<pre><code>Database Name   Log Size (MB)\tLog Space Used (%)\tStatus\nByBox   \t1964.25\t\t30.0657\t\t\t0\n</code></pre>\n\n<p>The following does not work with SQL 2008</p>\n\n<pre><code>DUMP TRANSACTION ByBox WITH TRUNCATE_ONLY\n</code></pre>\n\n<p>Running the following does nothing either</p>\n\n<pre><code>DBCC SHRINKFILE ('ByBox_1_Log' , 1)\nDBCC shrinkdatabase(N'bybox')\n</code></pre>\n\n<p>I've tried backups. I've also tried setting the properties of the database - 'Recover Model' to both 'FULL' and 'SIMPLE' and a combination of all of the above. Also tried setting the compatibility to SQL 2005 (I use this setting as I want to match our production server) and SQL 2008.</p>\n\n<p>No matter what I try, the log remains at 1964.25Mb, with 30% used, which is still growing.\nI'd like the log to go back down near 0% and reduce the log file size to a say 100Mb which is plenty. My database must hate me, it just ignores everything I ask it to do regarding the log.</p>\n\n<p>One further note, the production database has quite a few replicated tables, which I turn off when I perform a restore on my development box by using the following:</p>\n\n<pre><code>-- Clear out pending replication stuff\nexec sp_removedbreplication\ngo\nEXEC sp_repldone @xactid = NULL, @xact_segno = NULL,\n     @numtrans = 0, @time = 0, @reset = 1\ngo\n</code></pre>\n\n<p>Trying:</p>\n\n<pre><code>SELECT log_reuse_wait, log_reuse_wait_desc\nFROM sys.databases\nWHERE NAME='bybox'\n</code></pre>\n\n<p>Returns</p>\n\n<pre><code>log_reuse_wait  log_reuse_wait_desc\n0   NOTHING\n</code></pre>\n\n<p>Any words of wisdom or things to try are all welcome!</p>\n\n<p><hr /></p>\n\n<p>Looking at <a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqldatabaseengine/thread/9f9ae5c5-3031-4963-bb16-c7ed05d9890a/\">this</a> and setting the recovery model to FULL I have tried the following:</p>\n\n<pre><code>USE master\nGO\n\nEXEC sp_addumpdevice 'disk', 'ByBoxData', N'C:\\&lt;path here&gt;\\bybox.bak'\n\n-- Create a logical backup device, ByBoxLog.\nEXEC sp_addumpdevice 'disk', 'ByBoxLog', N'C:\\&lt;path here&gt;\\bybox_log.bak'\n\n-- Back up the full bybox database.\nBACKUP DATABASE bybox TO ByBoxData\n\n-- Back up the bybox log.\nBACKUP LOG bybox TO ByBoxLog\n</code></pre>\n\n<p>which returned:</p>\n\n<pre><code>Processed 151800 pages for database 'bybox', file 'ByBox_Data' on file 3.\nProcessed 12256 pages for database 'bybox', file 'ByBox_Secondary' on file 3.\nProcessed 1 pages for database 'bybox', file 'ByBox_1_Log' on file 3.\nBACKUP DATABASE successfully processed 164057 pages in 35.456 seconds (36.148 MB/sec).\n\nProcessed 2 pages for database 'bybox', file 'ByBox_1_Log' on file 4.\nBACKUP LOG successfully processed 2 pages in 0.056 seconds (0.252 MB/sec).\n</code></pre>\n\n<p>Perfect! But its not.</p>\n\n<p>And DBCC SHRINKFILE ('ByBox_1_Log' , 1) now returns with</p>\n\n<pre><code>DbId    FileId\tCurrentSize\tMinimumSize\tUsedPages\tEstimatedPages\n7   2\t251425\t251425\t251424\t251424\n</code></pre>\n\n<p>and DBCC SQLPERF(LOGSPACE) still reports 30% usage.\nI think I may have to resign myself to the fact there could well be a bug in SQL Server 2008, or that my log file has been corrupted in some manner. However, my database is in good working order, which leads me to think there is a bug <em>(shudders at the thought)</em>.</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":7375,"score":5,"question_id":10204480,"title":"The backup set holds a backup of a database other than the existing","body":"<p>i am trying to restore Sql server backup file for my database , but its throwing an error as follow:</p>\n\n<p>The backup set holds a backup of a database other than the existing </p>\n\n<p>My database in sql server 2008 and backup file is in 2005 </p>\n\n<p>what can be the problem.</p>\n"},{"tags":["c#","wpf","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":13028807,"title":"Organization of a multi-user application","body":"<p>I have a WPF C# multi-user applicaton which interacts with Sql Server Express database. Currently I  have faced up with the following issue:\n How to organize the application and the database in order for several users on different stations be able to work on it , maybe i should put the database file on a server, and make my application on all other stations refer to that server when they interact with the datatbase? If so, how can I provide security of the database file. \nIs there any scenario in which I could install my application on server and sign it as server and while installing on other machines point that server? \nAny advice on general strategies in such cases would be appreciated.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":38,"score":2,"question_id":13030001,"title":"Issue in replacing single quote in SQL server","body":"<p>I have been seraching solution for this issue .Though this particular question has been discussed many times in this forum, i did not get any proper answer for my problem.</p>\n\n<p>I will be getting data from 3rd party which can contain single quote.This data need to be inserted into data base and when it contains single quote it fails and throws following error:</p>\n\n<pre><code>Msg 105, Level 15, State 1, Line 7\nUnclosed quotation mark after the character string '\n</code></pre>\n\n<p>---Following is c++ code to pass trandata as input along with other parameters and invoke fn_stripsingleQuote10 function from SQL server:</p>\n\n<pre><code>strSQLText = \"declare @returnType as varchar(max)\\n EXEC @returnType = CABINET..fn_stripsingleQuote10 \";\nsqlTxtParams.Format(\"'%s', '%s', '%s', tranData, sing_quote, double_sing_quote);\n\nstrSQLText += sqlTxtParams;\n</code></pre>\n\n<p>----My sql function(fn_stripsingleQuote10) to replace single quote</p>\n\n<pre><code>USE [cabinet]\nGO\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE function [dbo].[fn_stripsingleQuote10](\n @strip varchar(Max),@patern varchar(5),@replace varchar(5)\n )\nreturns varchar(Max) as begin\n\n declare @CleanString varchar(Max)     \n    SET @CleanString=(REPLACE(@strip,@patern, @replace))\n\n return @CleanString\nend\n</code></pre>\n\n<p>sample output:\nex:\ndeclare @returnType as varchar(max) EXEC @returnType = CABINET..fn_stripsingleQuote10 'fsds'd','''',''''''</p>\n\n<p>I feel the way i am invoking the function is not proper.Please provide a solution .</p>\n"},{"tags":["sql-server","ssms"],"answer_count":4,"favorite_count":1,"up_vote_count":13,"down_vote_count":0,"view_count":6754,"score":13,"question_id":5065357,"title":"How to generate an INSERT script for an existing SQL Server table that includes all stored rows?","body":"<p>I'm looking for a way to generate a \"Create and insert all rows\" script with SQL Management Studio 2008 R2.</p>\n\n<p>I know that I can create a \"create table\" script.</p>\n\n<p>I can also create an \"insert in\" script, but that will only generate a single row with placeholders.</p>\n\n<p>Is there a way to generate an insert script that contains all currently stored rows?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","pivot"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":92,"score":4,"question_id":13022718,"title":"Return Columns As Rows based on Number of Months","body":"<p>This seems like a simple thing to accomplish but I'm not sure if I am thinking about it correctly to get the desired results. I'm using a pivot but I think I need something else paired with it.</p>\n\n<p>I have an invoice table that contains monthly invoices for each client. At most, a client will have 12 invoices per year, 1 for each month.</p>\n\n<pre><code>+----------+-------+-------+--------------+--------------+--------------+\n| ClientID | Month | Year  | ColumnValue1 | ColumnValue2 | ColumnValue3 |\n+----------+-------+-------+--------------+--------------+--------------+\n|        1 |     1 |  2012 |           20 |           30 |           50 |\n|        1 |     2 |  2012 |           25 |           35 |           40 |\n|        2 |     1 |  2012 |           28 |           38 |           48 |\n+----------+-------+-------+--------------+--------------+--------------+\n</code></pre>\n\n<p>Now, I want to create a list like below based on each client. There would be a column for each month. So Client 1 would look like:</p>\n\n<pre><code>+--------------+----+----+---+---+---+---+---+---+---+----+----+----+-------+\n|  ColumnName  | 1  | 2  | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | Total |\n+--------------+----+----+---+---+---+---+---+---+---+----+----+----+-------+\n| ColumnValue1 | 20 | 25 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  0 |  0 |  0 |   45  |\n| ColumnValue2 | 30 | 35 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  0 |  0 |  0 |   65  |\n| ColumnValue3 | 50 | 40 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  0 |  0 |  0 |   90  |\n+--------------+----+----+---+---+---+---+---+---+---+----+----+----+-------+\n</code></pre>\n"},{"tags":["asp.net","sql-server","vb.net","ado.net","dbnull"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":128,"score":1,"question_id":13006995,"title":"Write Null in Database if the TextBoxes are Empty","body":"<p>All I want to do is to insert Null with the database when the textbox is empty.</p>\n\n<pre><code> --ACCOUNT\n\n AS\n BEGIN\n-- SET NOCOUNT ON added to prevent extra result sets from\n-- interfering with SELECT statements.\nSET NOCOUNT ON;\nSET IDENTITY_INSERT account ON\n\n\n  INSERT INTO dbo.account\n      ( \n        AccntID                   ,\n        managedby                 ,\n        AccountHolder             ,\n        Description               ,\n        AccountType               ,\n        ContactPerson             ,\n        ContactNumber             ,\n        EmailAddress              ,\n        Address                   ,\n        ClientTYpe                ,\n        SchemeType                ,\n        SalesManager              ,\n        DateCreated               ,\n        Login                     ,\n        Password                  ,\n        Balance                   ,\n        FilterOption              ,\n        Enable22                  ,\n        AllowExtendedConfig                  \n      ) \n-- Insert statements for procedure here\n\n VALUES (@AccntID, @managedby, @AccountHolder, @Description, @AccountType, @ContactPerson, @ContactNumber, @EmailAddress, @Address, @ClientType, @SchemeType, @SalesManager, @DateCreated, @Login, @Password, @Balance, @FilterOption, @Enable22, @AllowExtendedConfig)\nSET IDENTITY_INSERT account OFF\n\n\n\nEND\n</code></pre>\n\n<p>What is the best way to add NULL values to the database when my textboxes are empty</p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13011610,"title":"filtering duplicate string in database","body":"<p>My application sends bulk messages to customers. What I want is:</p>\n\n<p>1.Application should not accept more than 10 duplicate message per day.\n2.should be checked for same sender, same number and on same message.</p>\n\n<p>How can i do it in database?\nThe sent message details are saved in a table and it has columns to store sender id, mobile no, message and datetime</p>\n\n<p>Before insertion, the condition should be checked. </p>\n\n<p>please help me out.</p>\n"},{"tags":["c#","sql-server","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1890,"score":0,"question_id":2136459,"title":"how to query sql server database size","body":"<p>When writing C# code, if I can manage to get a SqlConnection, \nis there any way to perform a query to get the size of the Database?</p>\n\n<p>I searched the internet, seems \"sp_spaceused\" can be used,\nbut it is not a table, it is a procedure.</p>\n\n<p>Can I query a procedure?</p>\n"},{"tags":["sql","sql-server","if-statement","inner-join"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":13025631,"title":"Inner join with if statement","body":"<p>I am trying to build the following sp :</p>\n\n<pre><code>USE [MarMoniApp]\nGO\n/****** Object:  StoredProcedure [dbo].[Desc_by_date]    Script Date: 10/23/2012     09:01:40 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nALTER PROCEDURE [dbo].[Desc_by_date]\n@DateToSearch varchar(50)\nAS\nBEGIN\nselect a.ticker,a.First_T, a.Last_T, a.Size_mln, a.pct_d_vol,a.a_trad,a.coolname,a.recency,b.Analyst\nfrom Order_Desc a\n\nCASE\nWhen a.coolname = 'ELTORO'\nthen (Inner join MarMoniApp.dbo.Namelist b on a.ticker = b.ticker )\nEND\n\nwhere convert(datetime, cast(rtrim(First_T) AS nvarchar)) &gt; DateToSearch \norder by  CONVERT(DATETIME, cast(rtrim(First_T) AS nvarchar) )  DESC\nEND\n</code></pre>\n\n<p>I want to do the inner join only if the \"coolname\" is equal to eltoro, but it seems that my syntax is not correct.</p>\n"},{"tags":["asp.net","sql-server","connection-string"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13027066,"title":"Error on importing excel into sql server through asp.net fileupload","body":"<p>I am trying to import excel sheet's data into a table in sql server database i am getting an error :  The Microsoft Office Access database engine could not find the object 'Sheet1$'.  Make sure the    object exists and that you spell its name and the path name correctly.</p>\n\n<p>BELOW IS MY CODE:</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Web;\nusing System.Web.UI;\nusing System.Web.UI.WebControls;\nusing System.Data.SqlClient;\nusing System.Data;\nusing System.Data.OleDb;\n\npublic partial class abc2 : System.Web.UI.Page\n{\n    protected void Page_Load(object sender, EventArgs e)\n    {\n    }\n\n    protected void btnSend_Click(object sender, EventArgs e)\n    {\n         String strConnection = \"Data Source=DITSEC3;Initial Catalog=test;Integrated Security=True\";\n         //file upload path\n         string path = fileuploadExcel.PostedFile.FileName;\n         //Create connection string to Excel work book\n         string excelConnectionString = @\"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=\" + path + \";Extended Properties=Excel 12.0;Persist Security Info=False\";\n         //Create Connection to Excel work book\n         OleDbConnection excelConnection =new OleDbConnection(excelConnectionString);\n         //Create OleDbCommand to fetch data from Excel\n         OleDbCommand cmd = new OleDbCommand(\"Select [ID],[Name],[Designation] from    [Sheet1$]\",excelConnection);\n         excelConnection.Open();\n         OleDbDataReader dReader;\n         dReader = cmd.ExecuteReader();\n         SqlBulkCopy sqlBulk = new SqlBulkCopy(strConnection);\n         //Give your Destination table name\n         sqlBulk.DestinationTableName = \"Excel_table\";\n         sqlBulk.WriteToServer(dReader);\n         excelConnection.Close();\n    }\n}\n</code></pre>\n"},{"tags":["sql-server","xml","unicode","bom","varbinary"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":13014709,"title":"SqlServer Converting XML to varbinary and parsing it in .NET (C#)","body":"<p>Consider the following code:</p>\n\n<pre><code>[Test]\n    public void StackOverflowQuestionTest()\n    {\n        const string connectionString = \"enter your connection string if you wanna test this code\";\n\n        byte[] result = null;\n        using (var connection = new SqlConnection(connectionString))\n        {\n            connection.Open();\n            using (var sqlCommand = new SqlCommand(\"declare @xml as xml = '&lt;xml/&gt;' SELECT convert(varbinary(max), @xml) as value\"))\n            //using (var sqlCommand = new SqlCommand(\"SELECT convert(varbinary(max), N'&lt;xml/&gt;') as value\"))\n            {\n                sqlCommand.Connection = connection;\n\n                using (SqlDataReader reader = sqlCommand.ExecuteReader())\n                {\n                    while (reader.Read())\n                    {\n                        result = (byte[])reader[\"value\"];\n                    }\n\n                    reader.Close();\n                }\n            }\n        }\n\n        string decodedString = new UnicodeEncoding(false, true).GetString(result);\n        var document = XElement.Parse(decodedString);\n    }\n</code></pre>\n\n<p>If I run this test I get an XmlException with message : \"Data at the root level is invalid. Line 1, position 1.\" As it turns out the problem is \"0xFFFE\" preamble which is considered as invalid character. \nNote that if I use commented string instead, everything works just fine, which is strange as per me. Looks like SqlServer stores XML strings in UCS-2 with a BOM, and at the same time it stores nvarchar values without it.\nThe main question is: how can I decode this byte array to string which will not contain this preamble (BOM)?</p>\n"},{"tags":["sql-server","user-defined-functions","stored-functions"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":286,"score":1,"question_id":10537336,"title":"SQL Server : create function","body":"<p>I am having a little trouble trying to create a function that I can call to generate a 32 character random ID.  I have it working in query editor but it is my understanding that to generate this in multiple lines of results accompanied by existing data from tables I have to create a function and call it.  Here is my code:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[Func_Gen_OID] (@NewOID varchar(32))\nRETURNS VARCHAR(32) AS\nBEGIN\n\nDECLARE @Length int = 32\nDECLARE @Output varchar(32)\nDECLARE @counter smallint\nDECLARE @RandomNumber float\nDECLARE @RandomNumberInt tinyint\nDECLARE @CurrentCharacter varchar(1)\nDECLARE @ValidCharacters varchar(255)\nSET @ValidCharacters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\nDECLARE @ValidCharactersLength int\nSET @ValidCharactersLength = len(@ValidCharacters)\nSET @CurrentCharacter = ''\nSET @RandomNumber = 0\nSET @RandomNumberInt = 0\nSET @Output = ''\n\nSET NOCOUNT ON\n\nSET @counter = 1\n\nWHILE @counter &lt; (@Length + 1)\n\nBEGIN\n\n        SET @RandomNumber = Rand()\n        SET @RandomNumberInt = Convert(tinyint, ((@ValidCharactersLength - 1) * @RandomNumber + 1))\n\n        SELECT @CurrentCharacter = SUBSTRING(@ValidCharacters, @RandomNumberInt, 1)\n\n        SET @counter = @counter + 1\n\n        SET @Output = @Output + @CurrentCharacter\n\nRETURN @Output\nEND\n</code></pre>\n\n<p>Thanks for any and all help!</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008-r2","inner-join"],"answer_count":6,"favorite_count":4,"up_vote_count":25,"down_vote_count":0,"view_count":994,"score":25,"question_id":10297231,"title":"WHERE Clause vs ON when using JOIN","body":"<p>Assuming that I have the following T-SQL code:</p>\n\n<pre><code>SELECT * FROM Foo f\nINNER JOIN Bar b ON b.BarId = f.BarId;\nWHERE b.IsApproved = 1;\n</code></pre>\n\n<p>The following one also returns the same set of rows:</p>\n\n<pre><code>SELECT * FROM Foo f\nINNER JOIN Bar b ON (b.IsApproved = 1) AND (b.BarId = f.BarId);\n</code></pre>\n\n<p>This might not be the best case sample here but is there any performance difference between these two?</p>\n"},{"tags":["sql","sql-server","query-execution-plans","sql-execution-plan"],"answer_count":5,"favorite_count":6,"up_vote_count":16,"down_vote_count":0,"view_count":11670,"score":16,"question_id":1136524,"title":"SQL Server Plans : difference between Index Scan / Index Seek","body":"<p>In a SQL Server Execution plan what is the difference between an Index Scan and an Index Seek</p>\n\n<p>I'm on SQL Server 2005.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":13012902,"title":"SQL Select then Delete","body":"<p>I need to clean out some old data from my database tables. Below shows two tables, <strong>app_status</strong> and <strong>app_personal_details</strong>.</p>\n\n<p><img src=\"http://i.stack.imgur.com/BlqfP.png\" alt=\"enter image description here\"></p>\n\n<p>I have the following query to select all the records (applications) from the <strong>app_status</strong> table which have been created over 12 months from todays date</p>\n\n<pre><code>select status_id  \nfrom dbo.app_status  \nwhere submission_date &lt;= dateadd(month, -12, getdate()) order by 1\n</code></pre>\n\n<p>I then want to delete all the records from the <strong>app_personal_details</strong> table where the application_id exists in the list of retrieved status_id above.</p>\n\n<p>I hope this makes sense. I would like to know a quick way of deleting the data from both tables.</p>\n\n<p>Thanks for your help.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":13027153,"title":"Function which returns table with two different conditions","body":"<p>I have a sql function which returns table with two different conditions.</p>\n\n<p>Example: I have a @temp Table </p>\n\n<pre><code>@temp\n(\nProject Name,\nProject ID,\nTasks,\nAdhoc Tasks\n)\n</code></pre>\n\n<p>Tasks       has to give the count of Tasks where Duration != 0\nAdhoc Tasks has to give the count of Tasks where Duration = 0</p>\n\n<p>My Result:</p>\n\n<pre><code>P Name   PID   Tasks     AdhocTasks\n  A        1      2          12\n  b        2      3          12\n  c        3      6          12\n  d        4      5          12\n</code></pre>\n\n<p>I have Projects e,f,g which has only Adhoc tasks but not displaying\nExpected Result:</p>\n\n<pre><code>P Name   PID   Tasks     AdhocTasks\n  A        1      2         2\n  b        2      3         3\n  c        3      6         1\n  d        4      5         2\n  e        5      0         1\n  f,       6      0         1 \n  g        7      0         2\n</code></pre>\n"},{"tags":["sql-server","tsql","datetime","stored-procedures","date-range"],"answer_count":1,"favorite_count":3,"up_vote_count":3,"down_vote_count":0,"view_count":68,"score":3,"question_id":13024909,"title":"Counting between two dates","body":"<p>I wrote a procedure which takes 3 parametes StartDate, EndDate and TimeRange. According to the TimeRange, my procedure splits dates and counting them seperately. Here is my procedure:</p>\n\n<pre><code>PROCEDURE [dbo].[Procedure1] \n\n    @Start datetime, \n    @Finish datetime,\n    @TimeRange time\nAS\nBEGIN\n\n    SET NOCOUNT ON;\n\n    declare @TimeRanges as TABLE (SessionStart datetime, SessionEnd datetime);\n\n     with TimeRanges as (\n  select @Start as StartTime, @Start + @TimeRange as EndTime\n  union all\n  select StartTime + @TimeRange, EndTime + @TimeRange\n    from TimeRanges\n    where EndTime  &lt; @Finish )\n  select StartTime, EndTime, Count( Test.ScenarioID ) as TotalInboundArrivals\n    from TimeRanges as TR left outer join\n      dbo.Test as Test on TR.StartTime &lt;= Test.SessionStartTime and Test.SessionCloseTime &lt; TR.EndTime\n    where Test.ScenarioID = 24  \n    group by TR.StartTime, TR.EndTime   \nEND\n</code></pre>\n\n<p>For Example,</p>\n\n<pre><code>Start Time: 11:00\nEnd Time: 12:00\nTimeRange : 05:00\n\nThis procudure splits them like\n     TimeRange    TotalCallPeaks\n    11:00 11:05      12\n    11:05 11:10      8\n    11:10 11:15      15 \n    etc..\n</code></pre>\n\n<p>Here is my question: I need maximum calls which happens at the same time. In other words, I need call peaks. Any suggestions or clue will be so useful for me. </p>\n\n<p><img src=\"http://i.stack.imgur.com/ZweIq.jpg\" alt=\"enter image description here\">\nThere are 6 calls happened in this time range but 4 of them are happened at the same time which I want to calculate. Max point shows the max call peaks. 5th and 6th calls are happened in this time range but has no effect on the max call peaks. </p>\n"},{"tags":["sql","sql-server","tsql","triggers","sqlclr"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":184,"score":1,"question_id":8139019,"title":"Feasibility of SQLCLR Trigger or Stored Procedure for Audit Trail?","body":"<p>Disclaimer: I am unable to implement this properly in the application, as the application I'm working on doesn't do data access in a consistent way, and refactoring effort would be too great for the scope of the project and coming deadline.</p>\n\n<p>How would I go with implementing a SQLCLR Trigger for Audit Trail? I would like it to be as simple as possible, <em>and as easy to remove and replace with proper implementation</em> later as possible.</p>\n\n<p>I'm planning to write my audit to a single table (the database is not very write heavy), having columns like:</p>\n\n<ul>\n<li>Timestamp (<code>datetime</code>) - when the change happened?</li>\n<li>Username (<code>varchar</code>) - who made the change?</li>\n<li>AffectedTableName (<code>varchar</code>) - which table has been affected?</li>\n<li>AffectedRowKey (<code>varchar</code>) - this will be either a simple or compound key like (<code>Id=42</code>, <code>A=4,B=2</code>)</li>\n<li>OperationType (<code>char(1)</code>) - either <code>I</code>, <code>U</code> or <code>D</code> for insert, update and delete respectively.</li>\n<li>InsertedXml (<code>xml</code>) - xml-serialized row (<code>SELECT * FROM INSERTED FOR XML AUTO</code>)</li>\n<li>DeletedXml(<code>xml</code>) - xml-serialized row (<code>SELECT * FROM DELETED FOR XML AUTO</code>)</li>\n</ul>\n\n<p>I'm planning to query and resolve this data to a user-readable form in the application. I'm planning to implement this as a database trigger, written using SQLCLR. I can see 2 possible approaches:</p>\n\n<ul>\n<li>Implement this entirely as SqlTrigger method:</li>\n<li>Implement this as a SqlProcedure method taking parameters:\n<ul>\n<li>schemaName</li>\n<li>tableName</li>\n<li>insertedXml</li>\n<li>deletedXml</li>\n</ul></li>\n</ul>\n\n<p>I will appreciate any constructive criticism and suggestions. My limitation is that I have to implement the audit at the database level using triggers, and I want it to be as maintainable (read: removable and replacable) as possible. Also ideally, I don't want to have hundreds of triggers with exactly the same body, in case I have to modify them.</p>\n"},{"tags":["sql-server","postgresql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13024539,"title":"Alternative to SQL Server's sysobjects in PostgreSQL","body":"<p>I am porting a database from SQL Server to PostgreSQL. Is there any alternative to <code>sysobjects</code> in PostgreSQL? If so, then what is it and how can be it used?</p>\n\n<p>My view:</p>\n\n<pre><code>create view int_objects_v as \n  select\n     io.*, soae.\"REQ_TYPE_NAME\", soae.\"REQ_TABLE_NAME\", \n     stc1.\"CODE_DESC\" int_type_name, stc2.\"CODE_DESC\" operation_type_name, \n     s.\"NAME\" target_obj_name \n  from \n     int_objects io  \n  left join \n     req_request_types_v soae on soae.\"ID\" = io.\"SOURCE_OBJ_ID\"  \n  left join \n     std_type_codes_v stc1 on (stc1.\"CODE\" = io.\"INT_TYPE\" \n                               and stc1.\"TYPE\" = 'intr_type') \n  left join\n     std_type_codes_v stc2 on (stc2.\"CODE\" = io.\"OPERATION_TYPE\" \n                               and stc2.\"TYPE\" = 'opr_type') \n  left join \n     sysobjects s on (s.\"ID\" = io.\"TARGET_OBJ_ID\") \n  where \n     io.\"ACTIVE_FLAG\" = '1';\n</code></pre>\n"},{"tags":["sql-server","nhibernate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13024025,"title":"nhibernate joins with no relationship between tables","body":"<pre><code>tableA\n------\nAprimarykey,\nAfield1,\nAfield2,\nAfieldtoMatch  \n\ntableB\n------\nBprimarykey,\nBfield1,\nBfield2,\nBfieldtoMatch   \n</code></pre>\n\n<p>There is no relationship between tables. What would be the classes and the hbm file look like if I want the following results?  </p>\n\n<pre><code>select distinct tableA.Afield1, tableA.Afield2,tableA.AfieldMatch tableB.Bfield1,tableB.Bfield1    \nfrom tableA innerjoin tableB on tableA.AfieldtoMatch=tableB.Bmatchfield\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":13024831,"title":"How to iterate through each row in sql server?","body":"<pre><code>select name from sys.tables where name like '%JPro_VP_Service%'\n</code></pre>\n\n<p>My above query returns 26 table names.</p>\n\n<p>Now I'm trying to write a query to check in every table return from above query.</p>\n\n<pre><code>select * from JPro_VP_Service --consider this is my first table like wise I want to search in 26 tables return from above query\nwhere row_id like '%1-101%' or row_id like '%1-102%'\n</code></pre>\n\n<p>I think I need to write for or cursor to accomplish this can anyone help me how to achieve this?</p>\n"},{"tags":["sql-server","xml","entity-framework","database-design","entity-attribute-value"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13026351,"title":"Database Design to persist changing wizard/workflow data?","body":"<p>I need to create a wizard type web application to acquire data for a report. There are multiple sections so multiple wizard workflows. In addition a workflow could change ie a step could be added.</p>\n\n<p>I am considering the best database design, and started with a traditional \"ER design\" with explicit column names as is always recommended. I have been researching EAV with interest . However I now realise that I do have a problem with an explicit design when a workflow can change. So my current thinking is</p>\n\n<p>1) EAV with the use of Views (with \"instead of\" trigger for updates)\n2) Simply persist each step dataset as XML.</p>\n\n<p>Both present query issues, but I guess 1) is better although one could do string querying on XML using \"Like\" etc.</p>\n\n<p>I am also using MVC 3 and EF5, and would wish to leverage their facilities as much as possible and not \"fight\" the technology.</p>\n\n<p>I may also need to use some form of XML config file to help setup the razor view with the correct controls/layout.</p>\n\n<p>I would really appreciate some wisdom on the above. </p>\n\n<p>Many thanks.</p>\n"},{"tags":["sql-server","scheduled-tasks","rdl"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13022812,"title":"automatically running rdl file and save it into shared folder","body":"<p>I have many report (.rdl) files in my project. All the reports are using stored procedures. currently, if I want to open my report, I must open it using my project (it's C# website). </p>\n\n<p>What the client wants is for them just to open the shared folder to see the reports (they don't want to open the website). Let's say I have 5 rdl file, so in the shared folder there are 5 Excel files (from .rdl file, and converted into Excel files). Plus they want to automatically see the reports at the end of the month. </p>\n\n<p>I want to know how to automatically run .rdl files and save them into the shared folder in Excel format. can anyone help me ? </p>\n"},{"tags":["sql","sql-server","xml","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":45,"score":-4,"question_id":13024510,"title":"XML document could not be created because server memory is low","body":"<p><code>\"XML document could not be created because server memory is low. Use sp_xml_removedocument to release XML documents.\"</code></p>\n\n<p>I am having this error while executing a query. The query is supposed to take data from a table column having xml as text, then extract the data and insert it to new tables.</p>\n"},{"tags":["c#","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":13025446,"title":"\"Failed to convert parameter value from int64 to int32\"","body":"<p>I'm inserting few values into a SQL Server table. When I'm getting the values from the front end they are strings. So I need to convert them to <code>int</code> first, before I can insert them into the table.</p>\n\n<p>I'm using this code:</p>\n\n<pre><code>Int64 x = Convert.ToInt64(some string value);\n</code></pre>\n\n<p>This <code>x</code> I want to insert into the table, into a column of type <code>numeric(18,0)</code>.</p>\n\n<p>When doing this conversion, I get an error </p>\n\n<blockquote>\n  <p><em>Failed to convert parameter value from int64 to int32</em></p>\n</blockquote>\n\n<p>while my all the values are just like 1000 around.</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":89,"score":4,"question_id":12997612,"title":"SQL combining data from multiple rows in two tables into one row","body":"<p>I have data from two tables in a members system as follows:</p>\n\n<pre><code>Table: listuser\nuserid  listid\n===========\n1       5\n1       8\n1       3\n2       5\n2       3\n3       4\n4       4\n5       3\n6       4\n\nTable: list\nid  name\n==============\n3   Members\n4   Non Members\n5   Subscribers\n8   Test\n</code></pre>\n\n<p>What I am trying to achieve is a result as follows:</p>\n\n<pre><code>userid  lists\n===================\n1       Members, Subscribers, Test,\n2       Members, Subscribers\n3       Non Members,\n4       Non Members,\n5       Members,\n6       Non Members,\n</code></pre>\n\n<p>Users can belong between 0 and n lists.\nI have tried a number of approaches, but always end up with multiple rows for userid which is what I am trying to eliminate. I would be very great full for some help.</p>\n"},{"tags":["c#","sql-server","adobe"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":13025251,"title":"c# Process.start very slow","body":"<p>I have provided my client with the service of showing a pdf on a click. The problem is the process of loading a pdf file through Process.start. It is very slow. However, after the first attempt, it loads a lot quicker. </p>\n\n<p>It is also slow in the start in that sometime it hangs the operating system. On the other hand, opening a pdf manually is a lot faster. Kindly please help. </p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13025060,"title":"Join on output result","body":"<p>How come this query fails to run?</p>\n\n<pre><code>select * \nfrom ass \njoin (\n    UPDATE [dsa]\n    SET col1='123'\n    OUTPUT inserted.*) as ds on ass.dsaid = ds.ID\n</code></pre>\n"},{"tags":["java","sql-server","jdbc","driver"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":45,"score":-2,"question_id":13024364,"title":"Migrating to Microsoft JDBC Driver 4.0","body":"<p>My project is using <strong><em>Microsoft JDBC Driver 3.0</em></strong> for SQL server. Since then Microsoft has included the <strong><em>Microsoft JDBC Driver 4.0</em></strong> version and my client has sought for the advantages of the new version over the current. Also they want to know if there any compatibility issues that need to be addressed.</p>\n\n<p>Our current system employs Java 1.6, WAS 7.0, Hibernate 3.0 and MS SQL Server 2000 on Windows Server 2008.</p>\n\n<p>Please let know the advantages and issues of migrating to <strong><em>Microsoft JDBC Driver 4.0</em></strong> version with respect to the above configuration especially <strong>SQL Server 2000</strong>. The client has no thoughts of changing/upgrading the database from SQL Server 2000 as its huge and involves great risk.</p>\n\n<p>Will a driver change to Version 4.0 from 3.0 will have any benefits if the underlying database is still SQL Server 2000.</p>\n"},{"tags":["c#",".net","sql-server","sql-server-2008","ado.net"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13024952,"title":"Attempt to fetch logical page (5:65424) in database 2 failed","body":"<p>I am getting following <code>SqlException</code> on calling a stored procedure -</p>\n\n<blockquote>\n  <p><em>Attempt to fetch logical page (5:65424) in database 2 failed. It belongs to allocation unit 7349876362857938944 not to 4899918190390149120.</em></p>\n  \n  <p><em>System.Data.SqlClient.SqlException occurred<br>\n  Message=\"Attempt to fetch logical page (5:65424) in database 2 failed. It belongs to allocation unit 7349876362857938944 not to 4899918190390149120.</em>  </p>\n  \n  <p>Source=\".Net SqlClient Data Provider\"<br>\n  ErrorCode=-2146232060<br>\n  Class=21<br>\n  LineNumber=257<br>\n  Number=605<br>\n  Procedure=\"ispDisplayCount\"<br>\n  Server=\"10.10.1.1\"<br>\n  State=3  </p>\n  \n  <p>StackTrace:<br>\n  at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)<br>\n  at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException\n  exception, Boolean breakConnection)<br>\n  at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject\n  stateObj)<br>\n  at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream,\n  BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject\n  stateObj)<br>\n  at System.Data.SqlClient.SqlDataReader.ConsumeMetaData()<br>\n  at System.Data.SqlClient.SqlDataReader.get_MetaData()<br>\n  at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds,\n  RunBehavior runBehavior, String resetOptionsString)<br>\n  at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior\n  cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean\n  async)<br>\n  at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior\n  cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String\n  method, DbAsyncResult result)<br>\n  at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior\n  cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String\n  method)<br>\n  at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior\n  behavior, String method)<br>\n  at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior\n  behavior)<br>\n  at System.Data.Common.DbCommand.System.Data.IDbCommand.ExecuteReader(CommandBehavior\n  behavior)<br>\n  at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords,\n  String srcTable, IDbCommand command, CommandBehavior behavior)<br>\n  at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand\n  command, CommandBehavior behavior)<br>\n  at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)<br>\n  at Microsoft.Practices.EnterpriseLibrary.Data.Database.DoLoadDataSet(IDbCommand\n  command, DataSet dataSet, String[] tableNames)<br>\n  at Microsoft.Practices.EnterpriseLibrary.Data.Database.LoadDataSet(DbCommand\n  command, DataSet dataSet, String[] tableNames)<br>\n  at Microsoft.Practices.EnterpriseLibrary.Data.Database.LoadDataSet(DbCommand\n  command, DataSet dataSet, String tableName)<br>\n  at Microsoft.Practices.EnterpriseLibrary.Data.Database.ExecuteDataSet(DbCommand\n  command) in D:\\SVN_Workspace\\Login.cs:line 1205  </p>\n</blockquote>\n\n<p>What does this exception mean and any resolution to above issue?</p>\n"},{"tags":["asp.net","sql-server","independent","localserver","liveserver"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13024928,"title":"How can I set my application to display everything in English on the live server (Despite live server's settings)?","body":"<p>I am having this problem with my ASP.Net application and I have no idea how I can solve it: In order for my date-related parameters to be the same over the whole application, I am taking the date from SQL Server via a stored procedure. </p>\n\n<p>My problem is that when I am testing on the local server, everything works ok (everything is displayed in English as it should be), but when I am publishing it on live (on my company's server), the date-related parameters (ex. month names) are displayed in my country's language (which is not English). I assume it has to do with the settings of the live server. Is there any chance I could somehow set inside my application that the language should be English, despite of localization, settings etc. of the live server ?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server","powershell","maintenance-plan"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13017473,"title":"How running a program or PowerShell script, after the \"SQL Server Maintenance\" plan ended?","body":"<p>I need to execute/launch a PowerShell script after my maintenance plan did some work on my database.</p>\n\n<p>Is this possible?</p>\n"},{"tags":["c#","sql-server","database","primary-key"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":70,"score":3,"question_id":13023668,"title":"Default primary key setting increases value by two","body":"<p>I have just created a database in Visual Studio using a C# Forms application. </p>\n\n<p>I have a number of columns, column A being the primary key. </p>\n\n<p>I have just entered data into the row, and have noticed that the primary key value increases by two (<code>1,3,5,7,9....</code> etc). </p>\n\n<p>Is there a way to alter it to ascend in a regular way (<code>1,2,3,4,5,6,....?</code>)</p>\n\n<p><img src=\"http://i.stack.imgur.com/h1FJ6.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","reporting-services","reportbuilder"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4392,"score":1,"question_id":40322,"title":"I can't see \"Report Builder\" button in the Report Manager on SQL Server 2005","body":"<p>I am a member of all the roles (Browser, Content Manager, My Reports, Publisher, Report Builder). If I login with a Local Administrator account, I can see and use it fine. Any ideas?</p>\n"},{"tags":["sql-server","clustered-index","non-clustered-index"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":13022079,"title":"Can Clustered index change dynamic SQL statement behavior and return different results?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12902281/order-by-suddenly-conflicting-with-varchar-concatenation-in-tsql\">ORDER BY suddenly conflicting with VARCHAR concatenation in TSQL</a>  </p>\n</blockquote>\n\n\n\n<p>recently, I found create clustered index in one table and this clustered index changed the results of a dynamic SQL statement. When the table have clustered index, the statement only returned the last filed result. drop the clustered index from the table or delete the 'ORDER BY fieldnumber', will return the full result (15 fields). The change in behavior was caused by the clustered index in conjunction with the replace calls, as well as the order by, and the declaration of k being 1000 vs max in the sample statement. </p>\n\n<p>Can the Clustered index change dynamic SQL statement behavior and return different results or something else I don't know?\nAny comments are welcome!</p>\n\n<p>--Create the test table </p>\n\n<pre><code>USE [test] \n\nGO \n\nSET ANSI_NULLS ON \n\nGO \n\nSET QUOTED_IDENTIFIER ON \n\nGO \n\nCREATE TABLE [dbo].[test]( \n[companyid] [int] NOT NULL, \n[fieldName] [nvarchar](50) NOT NULL, \n[fieldnumber] [tinyint] NOT NULL, \n[Tagname] [nvarchar](15) NULL \n) ON [PRIMARY] \n\nGO \n</code></pre>\n\n<p>-- insert test data </p>\n\n<pre><code>INSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'Employee Status', 1, N'&lt;CHARACTER_1&gt;') \n\nINSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'Admin Grouping', 2, N'&lt;CHARACTER_2&gt;') \n\nINSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'Department Code', 3, N'&lt;CHARACTER_3&gt;') \n\nINSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'Job Code', 4, N'&lt;CHARACTER_4&gt;') \n\nINSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'FLSA - Exempt', 5, N'&lt;CHARACTER_5&gt;') \n\nINSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'Action Field 06', 6, N'&lt;CHARACTER_6&gt;') \n\nINSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'Action Field 07', 7, N'&lt;CHARACTER_7&gt;') \n\nINSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'Action Field 08', 8, N'&lt;CHARACTER_8&gt;') \n\nINSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'Action Field 09', 9, N'&lt;CHARACTER_9&gt;') \n\nINSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'Action Field 10', 10, N'&lt;CHARACTER_10&gt;') \n\nINSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'ProcessLevel', 11, N'&lt;CHARACTER_11&gt;') \n\nINSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'Department Name', 12, N'&lt;CHARACTER_12&gt;') \n\nINSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'Job Title', 13, N'&lt;CHARACTER_13&gt;') \n\nINSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'Information Field 04', 14, N'&lt;CHARACTER_14&gt;') \n\nINSERT [dbo].[test] ([companyid], [fieldName], [fieldnumber], [Tagname]) VALUES (1, N'Information Field 05', 15, N'&lt;CHARACTER_15&gt;') \n\ngo \n</code></pre>\n\n<p>-- test script </p>\n\n<pre><code>declare @k nvarchar(1000) ---or max \n\nset @k = '' \n\nSELECT @k = @k + REPLACE(REPLACE(TagName,'&lt;',''),'&gt;','') + ',' FROM test WITH (NOLOCK) \nWHERE CompanyID = 1 ORDER BY fieldnumber \n\n\nselect @k as test_result_without_index \n\ngo \n</code></pre>\n\n<p>-- create one clustered index to test the above script </p>\n\n<pre><code>CREATE CLUSTERED INDEX [ix-test] ON [dbo].[test] \n( \n[CompanyID] ASC \n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY] \n\nGO \n</code></pre>\n\n<p>-- test script which with nvarchar(1000)to test the behavior change with clustered index </p>\n\n<pre><code>declare @k nvarchar(1000) ---or max \n\nset @k = '' \n\nSELECT @k = @k + REPLACE(REPLACE(TagName,'&lt;',''),'&gt;','') + ',' FROM test WITH (NOLOCK) \nWHERE CompanyID = 1 ORDER BY fieldnumber \n\n\nselect @k as test_result_with_clustered_index_varchar1000_combine \n\ngo \n</code></pre>\n\n<p>-- test script which with nvarchar(max)to test the behavior no change under nvarchar (max)\n combine with clustered index </p>\n\n<pre><code>declare @k nvarchar(Max) ---or max \n\nset @k = '' \n\nSELECT @k = @k + REPLACE(REPLACE(TagName,'&lt;',''),'&gt;','') + ',' FROM test WITH (NOLOCK) \nWHERE CompanyID = 1 ORDER BY fieldnumber \n\n\nselect @k as test_result_with_clustered_index_and_varcharMax__combine \n\ngo \n</code></pre>\n\n<p>--drop the clustered index</p>\n\n<pre><code>IF EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[test]') AND name = N'ix-test') \n\nDROP INDEX [ix-test] ON [dbo].[test] WITH ( ONLINE = OFF ) \n\nGO \n</code></pre>\n\n<p>-- then create nonclustered index</p>\n\n<pre><code>USE [test] \n\nGO \n\nCREATE NONCLUSTERED INDEX [ix_test] ON [dbo].[test] \n\n( \n[companyid] ASC \n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY] \n\nGO \n</code></pre>\n\n<p>-- test script which with nvarchar(100)to test the behavior no change under nvarchar (100) combine with NONclustered index </p>\n\n<pre><code>declare @k nvarchar(1000) ---or max \n\nset @k = '' \n\nSELECT @k = @k + REPLACE(REPLACE(TagName,'&lt;',''),'&gt;','') + ',' FROM test WITH (NOLOCK) \nWHERE CompanyID = 1 ORDER BY fieldnumber \n\n\nselect @k as test_result_with_nonClustered_index_and_varchar1000_combine \n\ngo \n</code></pre>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12932718,"title":"Send Query result into a Text file in SqlServer","body":"<p>I want to send the result from a scalar variable into a text file,</p>\n\n<p>My Code looks like this </p>\n\n<pre><code> DECLARE @test varchar(10)\n\n SET @test='This is sample text'\n\n EXEC master..xp_cmdshell'bcp ' + @test + ' queryout \"D:\\sample.txt\" -S LocalHost -U \n sa -P 123 -c  -T -t' \n</code></pre>\n\n<p>But this is showing the following errors</p>\n\n<pre><code> output\n usage: bcp {dbtable | query} {in | out | queryout | format} datafile\n [-m maxerrors]            [-f formatfile]          [-e errfile]\n [-F firstrow]             [-L lastrow]             [-b batchsize]\n [-n native type]          [-c character type]      [-w wide character type]\n [-N keep non-text native] [-V file format version] [-q quoted identifier]\n [-C code page specifier]  [-t field terminator]    [-r row terminator]\n [-i inputfile]            [-o outfile]             [-a packetsize]\n [-S server name]          [-U username]            [-P password]\n [-T trusted connection]   [-v version]             [-R regional enable]\n [-k keep null values]     [-E keep identity values]\n [-h \"load hints\"]         [-x generate xml format file]\n NULL\n</code></pre>\n\n<p>Dont know how to give the format assigning a scalar variable value in bcp command\n   Please any one help.</p>\n\n<p>And tried in this way also </p>\n\n<pre><code>  Create table #sample\n  (\n   productid int\n  )\n\n  Insert into #sample(productid) values(1001098)\n\n  EXEC master..xp_cmdshell'bcp \"select * from #sample\" queryout \"D:\\sample.txt\" -S \n  LocalHost -U sa -P 123 -c  -T -t' \n</code></pre>\n\n<p>It gives as Error that</p>\n\n<pre><code>   #sample does not exist (in bcp command line) \n</code></pre>\n\n<p>Can any one please solve this.\n     Thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13021252,"title":"Handling partitions when you don't know the tables affected","body":"<p>I have a little problem :(, I have a data base that reached 1000 partitions for one partition_schema, taking a look on the internet I found that it is the top but it can be increased to 15000. I can't increase it to 15000, the solution that I can do is merge some partitions.</p>\n\n<p>I have a partition by day since 20100101 and actually there is 999, it can't increase anymore, so I want to merge the partitions from one month, but before that I want to do a backup of the information that is going to be affected, BUT I don't know which tables are affected by the function that has 999 ranges.</p>\n\n<p>Q. How can I find out wich tables are affected by the function? or which is the best way to asure that merging the partitions I won't lose data?</p>\n"},{"tags":["sql-server","sqldatatypes"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13021435,"title":"Why does SUM(real) return a float datatype in SQL Server?","body":"<p>If I have a table like this:</p>\n\n<p>Items</p>\n\n<pre><code>Name varchar(50)\nValue real\n</code></pre>\n\n<p>Then I create a view: </p>\n\n<pre><code>select sum(Value) as ValueSum from Items\n</code></pre>\n\n<p>The ValueSum datatype comes out to be a float.  Why doesn't it remain a real datatype?</p>\n\n<p>Also, has this changed between SQL Server 2005 and 2008?  I have an old database backup where ValueSum in a view returns as a real not float.  I can restore the backup and if I look at the view it looks like it is returning a real, but if resave it becomes a float.</p>\n"},{"tags":["sql","sql-server","join","lookup"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":12965149,"title":"lookup tables with temporary fields?","body":"<p>I have a query that produces the following results:</p>\n\n<p><strong>table1:</strong></p>\n\n<pre><code>degree_code  occupation_code  degree_completions  degree_level\n1.0000       20-2021          10                  1\n1.0000       20-2022          10                  1\n1.1051       52-2095          2                   3\n1.1051       52-2095          41                  2\n1.5010       15-1100          2                   3\n</code></pre>\n\n<p>I have another small, lookup table that relates degree_level to custom categories that I need to use:</p>\n\n<p><strong>table2</strong></p>\n\n<pre><code>degree_level  degree_level_recode\n1             AADEGREE\n2             AADEGREE\n3             BACHDEGREE\n</code></pre>\n\n<p>I would like to build the output of of the first query to report the following format:</p>\n\n<pre><code>degree_code  occupation_code  degree_completions  degree_level AADEGREE BACHDEGREE\n1.0000       20-2021          10                  1            10       0\n1.0000       20-2022          10                  1            10       0\n1.1051       52-2095          2                   3            3        0\n1.1051       52-2095          41                  2            0        41\n1.5010       15-1100          2                   3            2        1\n</code></pre>\n\n<p>Basically, create new temporary recode fields in the original query that report the degree_completions underneath them when they match the degree_level_recode, input 0 if no match. This is highly simplified; I will be performing operations on the recode fields against other fields in each element in the query. </p>\n\n<p>I've shown the degree_completions field for reference, but I'd leave it out in the final query for obvious redundancy reasons.</p>\n\n<p>I'm thinking I need to use a CASE statement or something similar for comparison checking, but I'm new to SQL.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>In reference to Cha's answer below, take a revised table1 output (after mapping the recode):</p>\n\n<pre><code>degree_code  degree_level  degree_completions  degree_level_recode\n01.0601      2             11                  LESSCOLL\n01.0601      3             22                  AADEGR\n01.0605      2             3                   LESSCOLL\n</code></pre>\n\n<p>Consider this code (table2 is referenced above the edit):</p>\n\n<pre><code>SELECT degree_code\n    ,degree_level\n    ,[LESSCOL] AS LESSCOL\n    ,[AADEGR] AS AADEGR\n    ,[BACHDEGR] AS BACHDEGR\n    ,[MADEGR] AS MADEGR\n    ,[DOCDEGR] AS DOCDEGR\nFROM \n    (\n    SELECT degree_code\n        ,table1.degree_level\n        ,degree_level_recode\n        ,degree_code\n     FROM table1\n          ,table2 \n     WHERE table1.degree_level = table2.degree_code\n     ) AS p\n     PIVOT\n         (\n         SUM (degree_completions)\n         FOR degree_level_recode IN ([LESSCOL], [AADEGR], . . .)\n         ) AS pvt\n</code></pre>\n\n<p>Which produces these results:</p>\n\n<pre><code>degree_code  degree_level  LESSCOL  AADEGR  BACHDEGR  MADEGR  DOCDEG  \n01.0601      2             NULL     NULL    NULL      NULL    NULL\n01.0601      3             NULL     22      NULL      NULL    NULL\n01.0505      2             NULL     NULL    NULL      NULL    NULL\n</code></pre>\n\n<p>I'm trying to get to:</p>\n\n<pre><code>degree_code  degree_level  LESSCOL  AADEGR  BACHDEGR  MADEGR  DOCDEG  \n01.0601      2             11       NULL    NULL      NULL    NULL\n01.0601      3             NULL     22      NULL      NULL    NULL\n01.0505      2             3        NULL    NULL      NULL    NULL\n</code></pre>\n\n<p>Additionally, replace NULL with 0.</p>\n"},{"tags":["sql-server","crystal-reports-xi","vfp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":13016466,"title":"Dynamically set Crystal Report Viewer parameter default value","body":"<p>We are using the Crystal Report viewer (XI I believe but we can upgrade) with a VFP front end.  </p>\n\n<p>Is there some way to dynamically set the parameter default value at run time?  For example, If the user is viewing an invoice and they try to run a report, I would like it to automatically default to the current invoice.  As it stands right now, they have to type in the invoice number even though they already have the actual invoice already open.</p>\n\n<p>If not, is there a better viewer available that we could use to accomplish this goal?</p>\n"},{"tags":["sql-server","tsql","time","formatting","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12960805,"title":"Substring Time Formatting","body":"<p>Currently I am using this script to pull a time out of a column:</p>\n\n<pre><code>    (RIGHT('0' + ltrim(RIGHT(convert(varchar,cast(SUBSTRING(A.DocSign, CHARINDEX('^', A.DocSign) +1, 19) as datetime), 100), 7)), 7))\n</code></pre>\n\n<p>What this returns is a time formatted like this 10:34AM - It is also converting military time to standard time in this code, and appends it to additional items I am pulling out of columns such as the date, last name, etc. I need the time to display as 10:54:00 AM</p>\n\n<p>So essentially I need to add :00 (always zeros) to the end of any of the times and add a space between the zeros and the AM or PM that is coming in. </p>\n\n<p>I am not very good at formatting, so I am having trouble with this one. Any suggestions?\n(I'm running SQL Server 2008 R2) </p>\n"},{"tags":["sql","sql-server","sql-server-2005","group"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":13020575,"title":"Combining multiple column values into a single column row result","body":"<p>I have a query that pulls in group sale orders for a venue.  My current query pulls all of the info I need, but gives me multiple rows for each order number:</p>\n\n<pre><code>ordCode cltClientName          adrCityDesc  adrStateDesc    adrZipCode  gsnValue2   evShow  shDescr\n739802  Stevens Elementary,    Aberdeen         WA             98520       64        183    Group - Museum Admission\n739802  Stevens Elementary,    Aberdeen         WA             98520       64        237    Extreme Planets\n</code></pre>\n\n<p>What I would like to see is a single row for each order, but with the last column having results separated by comma:</p>\n\n<pre><code>ordCode cltClientName          adrCityDesc  adrStateDesc    adrZipCode  gsnValue2   evShow  shDescr\n739802  Stevens Elementary,    Aberdeen         WA             98520       64        183    Group - Museum Admission, Extreme Planets\n</code></pre>\n\n<p>The Query:</p>\n\n<pre><code>SELECT DISTINCT(ordCode),\n        cltClientName, \n        adrCityDesc,\n        adrStateDesc,\n        adrZipCode,\n        gsnValue2,\n        evShow,\n        shDescr\n\n--COUNT(tiCode)\n  from Orders \n        inner join OrderContacts on orcOrderNumber = ordCode\n        inner join Clients on orcClientID = cltCode\n        inner join ClientAddresses on cltCode = claClientCode\n        inner join Addresses on claAddressCode = adrCode\n        inner join Tickets on tiOrder = ordCode\n        inner join dbo.Events on tiEvent = evCode\n        inner join GroupSaleNotes on ordCode = gsnOrderNumber\n        inner join Shows on evShow = shCode\n WHERE ordOrderTypeTitle = 7 -- Group Sales only\n  and ordOpenDate between '2011-06-01 00:00:00.000' and '2012-05-31 23:59:59.999'\n  and gsnNoteType = '5'\n  and cltIsGroupLeader = '1'\n   --and evShow in (106, 107)\n GROUP BY ordCode, cltClientName, cltCode, adrCityDesc, adrStateDesc,\n      adrZipCode, gsnValue2, evShow, shDescr\nORDER BY adrCityDesc, cltClientName\n</code></pre>\n\n<p>Is there a way to combine this part of the result set?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":13019624,"title":"Why do I get these different results from two SQL queries?","body":"<p>This has been killing me all day =D.  Please help!</p>\n\n<p>Scenario 1:  Two DB's on the same server (A, B) and A has three tables.  Query is executed from B.</p>\n\n<p>Scenario 2: Two DB's one server is linked to the other. (B has link A) and A has three tables.  Query is executed from B.</p>\n\n<p>In scenario 1 (non linked server):</p>\n\n<pre><code>SET @val = ''\nSELECT @val = @val + 'Hello, my name is ' + [name] + '!' + CHAR(10) + CHAR(13)\nFROM A.sys.tables\n</code></pre>\n\n<p>Returns:\nHello, my name is Table1!\nHello, my name is Table2!\nHello, my name is Table3!</p>\n\n<p>In scenario 2 (linked server):</p>\n\n<pre><code>SET @val = ''\nSELECT @val = @val + 'Hello, my name is ' + [name] + '!' + CHAR(10) + CHAR(13)\nFROM LINKED.A.sys.tables\n</code></pre>\n\n<p>Returns:\nHello, my name is Table3!</p>\n\n<p>Why are these different?  If I use openquery() on the linked server the results are the same as scenario 1.  I'm trying to avoid using openquery() if possible.  Thanks!</p>\n"},{"tags":["sql","sql-server","database","insert","relational-database"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":13018016,"title":"Inserting into a relational structure","body":"<p>We're supposed to create relational databases, not flat structures. You create tables with relationships to other tables. You normalize to remove duplication, and de-normalize to improve performance. This all makes sense. But, I'm having trouble finding a good mechanism to insert into a relational structure. Are there no good mechanism for inserting records into a relational structure. Is there something like: </p>\n\n<p><code>INSERT INTO x LEFT JOIN y ON x.id = y.id VALUES(...)?</code></p>\n\n<p>The best I could come up with is a stored proc that does:</p>\n\n<pre><code>INSERT INTO x\nSELECT id FROM x (or @@id)\nINSERT INTO y\n</code></pre>\n\n<p>This seems counter to the whole relational model... </p>\n\n<p>It's the insert equivalent of not having joins. Would we put up with having to do multiple selects and join the results together ourselves?</p>\n"},{"tags":["sql-server","azure","sql-azure"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":177,"score":2,"question_id":2356278,"title":"Is there a definitive list for the differences between the current version of SQL Azure and SQL Server 2008?","body":"<p>I am a relative newbie when it comes to SQL Azure!! I was wondering if there was a definitive list somewhere regarding what is and is not supported by SQL Azure in regards to SQL Server 2008? I have had a look through google but I've noticed some of the blog posts are missing things which I have found through my own testing:</p>\n\n<p>For example, quite a lot is summarised in this blog entry <a href=\"http://www.keepitsimpleandfast.com/2009/12/main-differences-between-sql-azure-and.html\" rel=\"nofollow\">http://www.keepitsimpleandfast.com/2009/12/main-differences-between-sql-azure-and.html</a> </p>\n\n<ul>\n<li>Common Language Runtime (CLR)</li>\n<li>Database file placement</li>\n<li>Database mirroring</li>\n<li>Distributed queries</li>\n<li>Distributed transactions</li>\n<li>Filegroup management</li>\n<li>Global temporary tables</li>\n<li>Spatial data and indexes</li>\n<li>SQL Server configuration options</li>\n<li>SQL Server Service Broker</li>\n<li>System tables</li>\n<li>Trace Flags</li>\n</ul>\n\n<p>which is a repeat of the MSDN page <a href=\"http://msdn.microsoft.com/en-us/library/ff394115.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ff394115.aspx</a></p>\n\n<p>I've noticed from my own testing that the following seem to have issues when migrating from SQL Server 2008 to the Azure:</p>\n\n<ul>\n<li>XML Types (the msdn does mention large custom types - I guess it may include this?? even if the data schema is really small?)</li>\n<li>Multi-part views</li>\n</ul>\n\n<p>I've been using <a href=\"http://sqlazuremw.codeplex.com/\" rel=\"nofollow\">SQL Azure Migration Wizard v3.1.8</a> to migrate local databases into the cloud.</p>\n\n<p>I was wondering if anyone could point to a list or give me any information till when these features are likely to be included in SQL Azure.</p>\n"},{"tags":["php","mysql","sql-server","database"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13018882,"title":"mysql - selecting after sorting","body":"<p>I have a table that looks like</p>\n\n<pre><code> ID |value\n --------\n 1  |  10\n --------\n 2  |  30\n --------\n 3  |  20\n --------\n 4  |  20\n --------\n 5  | 10 \n --------\n</code></pre>\n\n<p>I sort it in descending order and selected first two rows using LIMIT.  </p>\n\n<p>so the selection query returns :</p>\n\n<pre><code> --------\n 2  |  30\n --------\n 3  |  20\n --------\n</code></pre>\n\n<p>Now I want to select the second two rows in the same way of sorting so the result should be :</p>\n\n<pre><code> --------\n 4  |  20\n --------\n 1  |  10\n --------\n</code></pre>\n\n<p>How can I do this ? </p>\n\n<p><em>The query must be a dynamic query</em> \nI mean after selection those two rows I should select the next two rows and so on until the end of the table. </p>\n\n<p><em>Important Declaration</em> </p>\n\n<p>The query must take last ID from the previous selection and generate the next two automatically. Sorry, I forget to say that at the first time I posted the question. </p>\n"},{"tags":["php","mysql","sql-server","database"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":13019482,"title":"mysql - SELECT UNTIL in sql","body":"<p>I want to select rows until I found a certain value and it's not numeric so I cannot use > or &lt;. How can I do this ? </p>\n\n<p>Example : </p>\n\n<pre><code>-----\nValue\n-----\n45\n434\n348\n213\n543\n3445\n343\n123\n34345\n</code></pre>\n\n<p>I want to select all records before 543 (NOT ORDERED BY anything) </p>\n\n<p>Thanks in advance </p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13015914,"title":"Splitting row into row per month and splitting number of days","body":"<p>I have a table of events with a start_date column (EV200_EVT_START_DATE) and end_date column (EV200_EVT_END_DATE). Events could span more than one month.</p>\n\n<p>I also have a table with every day of every year (which i think could help).</p>\n\n<p>I want to be able to split the revenue by month- so essentially i think i need join each event with each corresponding month/year it overlaps. I then need to calculate the number of total days the event runs for and divide the number of event days in the \"joined\" month.</p>\n\n<pre><code>Event Table (EV200_EVENT_MASTER)\n===\nEV200_EVT_START_DATE,EV200_EVT_END_DATE,EV200_EVT_ID\n15/01/2012,17/01/2012,1\n15/01/2012,15/02/2012,2\n15/01/2012,15/03/2012,3\n\nCalendar Table (EV001_MSTR_DATE_SCHED)\n===\nEV001_ISO_DATE\n01/01/2012\n02/01/2012\n...\n01/01/2021\n02/01/2021\n\nOutput (something like)\n===\nEV200_EVT_START_DATE,EV200_EVT_END_DATE,EV200_EVT_ID,Year,Month,Days,Split\n15/01/2012,17/01/2012,1,2012,1,2,1\n15/01/2012,15/02/2012,2,2012,1,17,0.55\n15/01/2012,15/02/2012,2,2012,2,14,0.45\n15/01/2012,15/03/2012,3,2012,1,17,0.28\n15/01/2012,15/03/2012,3,2012,2,29,0.48\n15/01/2012,15/03/2012,3,2012,3,14,0.23\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","triggers"],"answer_count":5,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":29098,"score":1,"question_id":5341584,"title":"SQL Server - after insert trigger - update another column in the same table","body":"<p>I've got this database trigger:</p>\n\n<pre><code>CREATE TRIGGER setDescToUpper\nON part_numbers\n AFTER INSERT,UPDATE\nAS\nDECLARE @PnumPkid int, @PDesc nvarchar(128)\n\nSET @PnumPkid = (SELECT pnum_pkid FROM inserted)\nSET @PDesc = (SELECT UPPER(part_description) FROM inserted)\n\nUPDATE part_numbers set part_description_upper = @PDesc WHERE pnum_pkid=@PnumPkid\n\nGO\n</code></pre>\n\n<p><strong>Is this a bad idea?</strong> That is to update a column on the same table. I want it to fire for both insert and update. </p>\n\n<p>It works, I'm just afraid of a cyclical situation. The update, inside the trigger, fires the trigger, and again and again. <strong>Will that happen?</strong></p>\n\n<p>Please, don't nitpick at the upper case thing. Crazy situation.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":6,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":858,"score":4,"question_id":337601,"title":"Stored Procedures to .sql files","body":"<p>Is there a simple process in SQL 2005 for spitting all of my stored procedures out to individual .sql files.  I'd like to move them into VSS, but am not too excited by the prospect of clicking on each one to get the source, dumping it into a text file and so on.. </p>\n"},{"tags":["sql-server","wcf","ssis"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13019800,"title":"SSIS Package web service task very slow","body":"<p>I have an SSIS package which is using a web service task to call a WCF service. The service call takes between 200ms and 900ms when running it directly (C#, SoapUI, etc.) But when its called from the SSIS package it is consistently taking between 6 and 7 seconds. This is a big problem because the call is being made thousands of times and the package is taking ~8 hours to run. </p>\n\n<p>I have verified the call is returning with the correct results. And have verified that calling the service from the database server with a c# program is fast.</p>\n"},{"tags":["asp.net","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13019248,"title":"Asp.net SQL Server user impersonation","body":"<p>I wonder if somebody could point me in the right direction. We're currently looking to update an ASP.NET application that uses SQL Server 2005 for its db. We need to provide robust and consistent functionality that prevents certain users creating, updating, deleting certain records from the database.</p>\n\n<p>Unfortunately, the application isn't written using OO concepts, instead favouring many data access stored procedures called directly from the web page code behind files. Due to the sheer amount of stored procedures we'd prefer to investigate database triggers to implement our security. </p>\n\n<p>The question is; is it possible for the db trigger to be aware of the specific application user (managed using custom user account tables in the db) which executed the sp? All we'd need is an id. The connection string used to connect to the db is identical for all users (taken from the web.config), is there a way for the connection to some how either impersonate a user, or set a specific variable accessible to the trigger?</p>\n"},{"tags":["sql","sql-server","xml","formatting","xml-formatting"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":13019314,"title":"SQL Server XML Query formatting","body":"<p>When I query SQL Server with a FOR XML statement, I get the expected the result in the following format...that is without proper indentation ---  </p>\n\n<pre><code>&lt;ROOT&gt;&lt;SUBROOT&gt;&lt;A&gt;1111&lt;/A&gt;&lt;/SUBROOT&gt;&lt;SUBROOT&gt;&lt;B&gt;2222&lt;/B&gt;&lt;/SUBROOT&gt;&lt;ROOT&gt;  \n</code></pre>\n\n<p>How do I format this  result or query it to get in the following format?  </p>\n\n<pre><code>&lt;ROOT&gt;\n &lt;SUBROOT&gt;\n  &lt;A&gt;1111&lt;/A&gt;\n &lt;/SUBROOT&gt;\n &lt;SUBROOT&gt;\n  &lt;B&gt;2222&lt;/B&gt;\n &lt;/SUBROOT&gt;\n&lt;ROOT&gt;\n</code></pre>\n"},{"tags":["sql-server","tsql","datediff"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13019233,"title":"DateDiff function SQL Server","body":"<p>How can I subtract 3 months from the <code>GETDATE()</code> function? </p>\n\n<p>What I am trying to do is get the last day of the month 3 months prior to the current month. So if today is 10.22.2012 how can I subtract 3 months from the current date and print the last day of that month, so I am looking to get this date: 07.31.2012?  </p>\n\n<p>Here is what I have so far but it only prints the last day of previous month:</p>\n\n<pre><code>DATEADD(MILLISECOND, -3,\nDATEADD(MONTH, DATEDIFF(MONTH, -4, GETDATE()), 0))\n</code></pre>\n\n<p>Not printing what I need. Any help is greatly appreciated.</p>\n"},{"tags":["sql","sql-server","order"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":58,"score":4,"question_id":13018713,"title":"ordering query results with two columns","body":"<p>I have this table:</p>\n\n<pre><code>Reply_ID | Fk_Post_ID\n   10    |    5\n   9     |    6\n   8     |    5\n   7     |    9\n   6     |    5\n   5     |    9\n   4     |    7\n</code></pre>\n\n<p>I need a query retrieves records in the following order pattern. it searches for the record with the highest reply_ID then retrieves all records having the same Fk_Post_ID. something like this:</p>\n\n<pre><code>Reply_ID | Fk_Post_ID\n   10    |    5\n   8     |    5\n   6     |    5\n   9     |    6\n   7     |    9\n   5     |    9\n   4     |    7\n</code></pre>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":13014802,"title":"EF stored procedure with dynamic number of columns in result set","body":"<p>At first I should note that I'm new in ASP.NET (however, I have some experience with C#) and Entity Framework. I work on a school project and there is quite complicated database containing energy consumption data. Those I need (<code>I</code> import, <code>E</code> export, reactive power <code>C</code> and <code>L</code>) are stored in one column as binary compressed so to get them out I have to use a stored procedure which calls some methods in custom assembly to decompress the column and restore the data.</p>\n\n<p>The stored procedure has 4 arguments:</p>\n\n<pre><code>@identify int,\n@startTime datetime,\n@endTime datetime,\n@args nvarchar(60) -- \"Selector\"\n</code></pre>\n\n<p>The <code>selector</code> is rather special, it's an argument where you specify what you want in the result set, e.g. <code>'i'</code> for Import column only, <code>'i,e'</code> for Import and Export. They designed it like this because it's faster if you need just one column rather then all columns (because of the way the compressed data are stored).</p>\n\n<p>So, I've created an ADO.NET Entity Model called <code>EnergyConsumptionDBModel</code>, imported the stored procedure and created complex type <code>EnergyConsumptionResult</code> for the stored procedure return type as follows:</p>\n\n<pre><code>public partial class EnergyConsumptionResult\n{\n    public System.DateTime Time { get; set; }\n    public double I { get; set; }\n    public double E { get; set; }\n    public double L { get; set; }\n    public double C { get; set; }\n}\n</code></pre>\n\n<p>The column <code>Time</code> is always present in the result set, but the rest depends on the <code>@args</code> argument of the stored procedure. For example if I pick <code>'i,e,c,l'</code> as an argument, it will return columns <code>Time, I, E, C, L</code> and everything is just fine but if I pick for example <code>'i'</code> it returns <code>Time, I</code> which gives me an exception:</p>\n\n<blockquote>\n  <p><em>The data reader is incompatible with the specified 'EnergyConsumptionDBModel.EnergyConsumptionResult'.</em><br>\n  <em>A member of the type, 'E', does not have a corresponding column in the data reader with the same name.</em></p>\n</blockquote>\n\n<p>So the question is, is there some simple way to solve this? Some kind of dynamic result mapping on complex type or is it much more simple to tell my colleague who designed the stored procedure to make it return all columns whatever is in <code>@args</code> but leave the un-used columns empty which is a solution my project leader may not like. Thanks for any help.</p>\n"},{"tags":["sql-server","performance","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":13005076,"title":"SQL Server stored procedure a lot slower than straight query","body":"<p>I have a table with over 100MM records in it. The table has a clustered index and a nonclustered index.</p>\n\n<p>I can run a basic count using T-SQL on the table and it takes 1 second to run. When I put the same exact count query inside of a stored procedure it then takes 12 seconds to run.</p>\n\n<p>I have looked at the execution plan for both the standard query and the stored procedure and they both are using the nonclustered index.</p>\n\n<p>I am not sure why the stored procedure is so slow compared to the standard query.</p>\n\n<p>I have read some stuff about reindexing in a situation like this but I am not sure why I need to do that. Also, it takes a few hours to reindex so I want to make sure that will work.</p>\n\n<p>Any help on this would be great.</p>\n\n<p>Thanks</p>\n\n<p>UPDATE </p>\n\n<p>Here is the stored procedure:</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROCEDURE quickCount \n\n@sYID INT,\n@eYID INT\n\nAS\nBEGIN\n\nSET NOCOUNT ON;\n\n\n    SELECT COUNT(leadID)\n    FROM dbo.leads\n    WHERE yearID &gt;= @sYID\n    AND yearID &lt;= @eYID\n\nEND\nGO\n</code></pre>\n\n<p>and here is the standard query:</p>\n\n<pre><code>SELECT COUNT(leadID)\nFROM leads\nWHERE yearID &gt;= 0\nAND yearID &lt;= 99\n</code></pre>\n\n<p>I did try to run it with no parameters and the SP runs way faster (1 second). So I am assuming that it has something to do with the parameters.</p>\n"},{"tags":["sql-server","vb.net"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13018666,"title":"Load data to a listview control from SQL Server","body":"<p>I am trying to retrieve data from SQL Server into my form. I am trying with the below code. When I  run this I get the first item or row but I am unable load the rest of the items into my listview . Can someone help to solve my issue?</p>\n\n<pre><code>Sub GetInvoiceDetails()\n    Dim Inv As New petClass\n    Dim dt As DataTable = Inv.GetInvoiceDetailsbyNo(txtInvoiceNo.Text)\n    If dt.Rows.Count &gt; 0 Then\n        For Each row In dt.Rows\n            srno += 1\n            Dim lstitem = Lstview.Items.Add(srno)\n            lstitem.SubItems.Add(dt.Rows(0).Item(\"ItemName\").ToString)\n            lstitem.SubItems.Add(dt.Rows(0).Item(\"SellingPrice\".ToString)).ToString()\n        Next\n    End If\n    'clearcontrols\nEnd Sub\n</code></pre>\n"},{"tags":["sql-server","date"],"answer_count":11,"favorite_count":6,"up_vote_count":9,"down_vote_count":0,"view_count":22148,"score":9,"question_id":1378593,"title":"Get a list of dates between two dates using a function","body":"<p>FYI: My question is duplicate of <a href=\"http://stackoverflow.com/questions/510012/get-a-list-of-dates-between-two-dates\">this</a> MySQL question, but intended for SQL Server</p>\n\n<p>Is there a function to write a query that will return a list of days between two dates?</p>\n\n<p>For example, lets say there is a function called ExplodeDates:</p>\n\n<pre><code>SELECT ExplodeDates('2010-01-01', '2010-01-13');\n</code></pre>\n\n<p>This would return a single column table with the values:</p>\n\n<pre><code>2010-01-01\n2010-01-02\n2010-01-03\n2010-01-04\n2010-01-05\n2010-01-06\n2010-01-07\n2010-01-08\n2010-01-09\n2010-01-10\n2010-01-11\n2010-01-12\n2010-01-13\n</code></pre>\n\n<p>Many thanks</p>\n\n<p><strong>Edit:</strong>\nI'm thinking that a calendar/numbers table might be able to help me here...</p>\n\n<p><strong>Update</strong>\nI decided to have a look at the three code answers provided, and the results of the execution - as a % of the total batch - are:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/1378593/get-a-list-of-dates-between-two-dates-using-a-function/1378788#1378788\">Rob Farley's answer</a> : 18%</p>\n\n<p><a href=\"http://stackoverflow.com/questions/1378593/get-a-list-of-dates-between-two-dates-using-a-function/1378866#1378866\">StingyJack's answer</a> : 41%</p>\n\n<p><a href=\"http://stackoverflow.com/questions/1378593/get-a-list-of-dates-between-two-dates-using-a-function/1378712#1378712\">KM's answer</a> : 41%</p>\n\n<p><em>Lower is better</em></p>\n\n<p>I have accepted Rob Farley's answer, as it was the fastest, even though numbers table  solutions (used by both KM and StingyJack in their answers) are something of a favourite of mine. Rob Farley's was two-thirds faster.</p>\n"},{"tags":["sql-server","sql-server-2008","collation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3790,"score":0,"question_id":1121105,"title":"Changing default collation of a SQL Server 2008 instance","body":"<p>When I try to change the default collation of a SQL Server instance using this commandline:</p>\n\n<pre>setup.exe /QUIET /ACTION=REBUILDDATABASE /INSTANCENAME=MSSQLSERVER /SAPWD=********* /SQLCOLLECTION=SQL_Latin1_General_CP1_CI_AS</pre>\n\n<p>I get the following message:</p>\n\n<pre>Microsoft (R) SQL Server 2008 Setup 10.00.1600.22\nCopyright (c) Microsoft Corporation.  All rights reserved.\n\nThe following error occurred:\nThe setting 'SQLCOLLECTION' specified is not recognized.\n\nError result: -2068578301\nResult facility code: 1204\nResult error code: 3\n\nPlease review the summary.txt log for further details</pre>\n\n<p>Is there anything I'm missing ? Do I need to do something special for the setup.exe to find the <code>SQL_Latin1_General_CP1_CI_AS</code> collation?</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","sql-server","tsql","stored-procedures","exception-handling"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":131,"score":1,"question_id":13013565,"title":"Specified cast is not valid when trying Convert.ToInt32(value)","body":"<p>I am trying to run a stored procedure and for some reason it keeps telling me <code>\"Specified cast is not valid\"</code>. the \"<code>hidSelectedExpenseIDs</code>\" is a hidden field that gets populated with a javascript array of id's. </p>\n\n<p>Example: the <code>\"hidSelectedExpenseIDs.Value\"</code> would look like \"123,124,125,126\". Hence why I have the <code>.Split(',')</code> in there.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>public void hasExhistingExpenseInvoice()\n{\n    string[] Expenses = hidSelectedExpenseIDs.Value.Split(',');\n\n    //check if there is an existing invoice. Then report back to the user so the\n    //user knows if he/she has to check overwrite option.\n    bool invoiceExists = false;\n\n    foreach (var expense in Expenses)\n    {\n        var connection = new SqlConnection(ConfigurationManager.ConnectionStrings[\"OSCIDConnectionString\"].ToString());\n        var command = new SqlCommand(\"p_CaseFiles_Expenses_InvoiceExhists\", connection);\n        command.Parameters.Add(new SqlParameter(\"@ExpenseID\", SqlDbType.Int));\n        command.Parameters[\"@ExpenseID\"].Value = Convert.ToInt32(expense);\n        command.CommandType = CommandType.StoredProcedure;\n        try\n        {\n            connection.Open();\n            invoiceExists = (bool)command.ExecuteScalar();\n            if (invoiceExists)\n            {\n                //previous invoice exhists\n                Warning1.Visible = true;\n                Warning1.Text = \"There is an exhisting Invoice.\";\n            }\n        }\n        catch (SqlException sql)\n        {\n            lblStatus.Text = \"Couldn't connect to the Database - Error\";\n            lblStatus.ForeColor = System.Drawing.Color.Red;\n        }\n        catch (Exception ex)//catches exception here\n        {\n            lblStatus.Text = \"An error occured\";\n            lblStatus.ForeColor = System.Drawing.Color.Red;\n        }\n        finally\n        {\n            if (connection.State == ConnectionState.Open)\n                connection.Close();\n        }\n    }\n}\n</code></pre>\n\n<p>this is my stored procedure:</p>\n\n<pre><code>ALTER PROCEDURE dbo.[InvoiceExhists]\n@ExpenseID int\nAS\nBEGIN\n    SELECT InvNumber FROM dbo.Expenses from ExpID = @ExpenseID\nEND\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","reporting-services"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":9321,"score":4,"question_id":1097690,"title":"Converting SQL2008 RDL file to SQL2005","body":"<p>How do I convert a RDL file that was created using the SQL2008 designer to work on SQL2005 Reporting services?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":1,"view_count":75,"score":3,"question_id":13016996,"title":"Best practices for querying tables residing in different database using JOIN statements","body":"<p>Hello and thank you very much for your time. I am using SQL Server 2008. My challenge is as follows:</p>\n\n<p>I have 3 databases <code>Q_DB</code>, <code>CAN_DB</code>, <code>USA_DB</code>. <code>CAN_DB</code> and <code>USA_DB</code> have the same tables but represent two different countries</p>\n\n<p>The <code>Q_DB</code> has tables of queues. One table is called <code>ACCOUNTS</code> and the columns of interest are <code>ACCOUNTID</code> and <code>SERVER</code></p>\n\n<p>I want to query the information on the other two databases from the fields of <code>ACCOUNTS</code>. An example is:</p>\n\n<p><strong>Q_DB.dbo.ACCOUNTS</strong> </p>\n\n<ul>\n<li>ID123    CAN_DB</li>\n<li>ID456    USA_DB</li>\n<li>ID789    CAN_DB</li>\n</ul>\n\n<p>I know I can do it this way, but it I was wondering if there is any other approach to obtain the result. </p>\n\n<pre><code>SELECT ACTNAME, AMTDUE, SHIPCOUNTY  \nFROM CAN_DB.dbo.Accts \nWHERE ACCTID IN(SELECT ACCOUNTID FROM Q_DB.dbo.ACCOUNTS WHERE SERVER IN('CAN_DB')\nUNION ALL\nSELECT ACTNAME, AMTDUE, SHIPCOUNTRY \nFROM USA_DB.dbo.Accts\nWHERE ACCTID IN(SELECT ACCOUNTID FROM Q_DB.dbo.ACCOUNTS WHERE SERVER IN('USA_DB')\n</code></pre>\n\n<p>Any help or opinions or suggestions would be greatly appreciated . Thanks</p>\n"},{"tags":["sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13016781,"title":"Security and Performance implications of \"View Server State\"","body":"<p><a href=\"http://stackoverflow.com/questions/11473907/permission-to-access-sys-dm-db-index-usage-stats\">This question</a> points out that \"View Server State\" permission is required for various DMV's (dynamic management views), but I can't find anything about who you do and do not want to grant the permission to.  </p>\n\n<p>Now of course I understand \"least permissions\", and why you wouldn't want to just grant it to anybody, but I can't find any guideance on how to evaluate whether it SHOULD be granted or not.</p>\n\n<p>So, my question: What are the security and performance implications of granting a user \"View Server State\" permission.  What can they do that they maybe shouldn't be allowed to do...</p>\n"},{"tags":["sql-server","ssis"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":29419,"score":3,"question_id":51589,"title":"How do I fix the multiple-step OLE DB operation errors in SSIS?","body":"<p>I'm attempting to make a DTS package to transfer data between two databases on the same server and I'm getting the following errors. Iv read that the Multiple-step OLE DB operation generated error can occur when you are transferring between different database types and there is loss of precision, but this is not that case here. How do I examine the column meta data?</p>\n\n<blockquote>\n  <p>Error: 0xC0202009 at Data Flow Task,\n  piTech [183]: An OLE DB error has\n  occurred. Error code: 0x80040E21. An\n  OLE DB record is available.  Source:\n  \"Microsoft SQL Native Client\" \n  Hresult: 0x80040E21  Description:\n  \"Multiple-step OLE DB operation\n  generated errors. Check each OLE DB\n  status value, if available. No work\n  was done.\".</p>\n  \n  <p>Error: 0xC0202025 at Data Flow Task,\n  piTech [183]: Cannot create an OLE DB\n  accessor. Verify that the column\n  metadata is valid.</p>\n  \n  <p>Error: 0xC004701A at Data Flow Task,\n  DTS.Pipeline: component \"piTech\" (183)\n  failed the pre-execute phase and\n  returned error code 0xC0202025.</p>\n</blockquote>\n"},{"tags":["sql-server","iis","connection","sql-server-2008-r2","database-connection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":13015851,"title":"IIS cannot connect to Sql Server - Windows Server 2008 Standard","body":"<p>Okay, I've read a bunch of the related questions on here, and been googling, and cannot figure this out. </p>\n\n<p>One of our clients wants us to set their website up on a server, which is also running Sql Server and the site's database; that is, <strong><em>same box</em></strong>. </p>\n\n<p>The website is unable to connect to the database though, yielding the error:  </p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified)</p>\n</blockquote>\n\n<p>I also checked the Windows Event Logs, to see if it gave any further information, but it simply restated the same message with no additional information.</p>\n\n<p>The server is Windows Server 2008 Standard.<br>\nIIS is the included IIS version with that version of Windows.<br>\nSql Server is Sql Server 2008 R2 Standard Edition.<br>\nI have a data-access library I have written to connect to Sql Server. </p>\n\n<ul>\n<li>I have verified <code>Remote Connections</code> are on in Sql Server (though it's the same box).  </li>\n<li>I have verified <code>SQL and Windows Authentication</code> is on to allow Sql logins.  </li>\n<li>I have verified my connection string and data-access layer via a test windows app.  </li>\n<li>I have used PortQryUI to verify the Sql Server is available.  </li>\n</ul>\n\n<p>I have also tried various variations on the connection string, such as:  </p>\n\n<ul>\n<li>MYSERVER\\INSTANCE  </li>\n<li>localhost\\INSTANCE</li>\n<li>127.0.0.1\\INSTANCE</li>\n<li>(local)\\INSTANCE</li>\n<li>tcp:(local)\\INSTANCE</li>\n<li>np:(local)\\INSTANCE</li>\n<li>.\\INSTANCE</li>\n<li>MY.PUB.IP.ADD\\INSTANCE</li>\n</ul>\n\n<p>So Sql Server seems to be set up properly.<br>\nMy test Windows app works fine, confirming my connection string is correct and my data-access layer can connect. </p>\n\n<p>It would seem that this is something to do with IIS specifically, and some setting in there must be blocking the connection. </p>\n\n<p><strong>ADDITIONAL:</strong><br>\nWindows Firewall is not running.<br>\nSql Browser Service is running.<br>\nAll network protocols are enabled in the server configuration.</p>\n\n<p>I am using a <code>System.Data.SqlClient.SqlConnectionStringBuilder</code> object to build my connection string. To verify Sql authentication being used, I put out the ConnectionString being returned by the builder:</p>\n\n<blockquote>\n  <p>Data Source=\"(local)\\INSTANCE\";Initial Catalog=mydb;User ID=myuser;Password=mypassword</p>\n</blockquote>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":7,"favorite_count":1,"up_vote_count":13,"down_vote_count":0,"view_count":21215,"score":13,"question_id":600446,"title":"SQL Server: How do you return the column names from a table?","body":"<p>Please can someone show me how I would return the column names of a table using SQL server 2008?</p>\n\n<p>i.e. a table contains the columns id, name, address, country and I want to return these as data?</p>\n\n<p>Thank you</p>\n"},{"tags":["c#","sql-server","visual-studio-2010","visual-studio"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":40,"score":-4,"question_id":13016592,"title":"Any Recommended Book for Visual Studio C# With MVC 3 or 4 and SQL Server Book?","body":"<p>As in the title, any Recommended Book for Visual Studio C# With MVC 3 or 4 and SQL Server Data Commands Book For Reference? Or any SQL query commands book?</p>\n"},{"tags":["c#","sql-server","wcf","entity-framework","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":100,"score":4,"question_id":12999591,"title":"Better way to call a stored procedure using Entity Framework and return restfully from WCF?","body":"<p>I want to create a WCF service that calls a stored procedure in SQL Server using the Entity Framework and returns the result set to a browser.</p>\n\n<p>I imported the stored procedure using the function import in EF and I built a complex type. </p>\n\n<p>It seems that a complex type from the EF cannot be serialized and returned restfully. The only way I have made this work is to create a concrete class and build it from the complex type returned from EF. This works but it means if I have 30 stored procedures I would need to create 30 concrete classes which is somewhat of a pain.  </p>\n\n<p>Is there a better way to do this?</p>\n\n<p>WCF contract:</p>\n\n<pre><code>[ServiceContract]\npublic interface IService1\n{\n    [OperationContract,WebGet,XmlSerializerFormat]\n    List&lt;People&gt; usp_GetPeople();    \n}\n</code></pre>\n\n<p>Concrete class would need to be created for every procedure:</p>\n\n<pre><code>public class People\n{\n    public int person_id;\n    public string last_name;\n    public string first_name;\n    public string street_addr;\n    public string state_code;\n    public string postal_code;\n\n    public People(int person_id, string last_name, string first_name, string street_addr, string state_code, string postal_code)\n    {\n        this.person_id = person_id;\n        this.last_name = last_name;\n        this.street_addr = street_addr;\n        this.state_code = state_code;\n        this.postal_code = postal_code;\n    }\n\n    public People() { }\n}\n</code></pre>\n\n<p>WCF service:</p>\n\n<pre><code>public class Service1 : IService1\n{\n/// &lt;summary&gt;\n/// Call stored proc and return resultset.\n/// &lt;/summary&gt;\n/// &lt;returns&gt;List of resultset as concrete class People.&lt;/returns&gt;\npublic List&lt;People&gt; usp_GetPeople()\n{\n    try\n    {\n        using (var db = new demoEntities())\n        {\n            var res = db.usp_GetPeople();\n\n            List&lt;People&gt; lst = new List&lt;People&gt;();\n\n            foreach (usp_GetPeople_Result r in res)\n            {\n                People p = new People(r.person_id, r.last_name, r.first_name, r.street_addr, r.state_code, r.postal_code);\n                lst.Add(p);\n            }\n\n            return lst;\n        }\n    }\n    catch (Exception e)\n    {\n        Utility.Log(\"Error in usp_GetPeople. \" + e.ToString());\n        return null;\n    }\n}\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13015871,"title":"Slow performance with SQL Query","body":"<p>I'm having some issues with this query running in a timely manner with my 'LineItemsMap' table grows to about a million lines.  Any suggestions on indexes I could create or just better logic with the query would be greatly appreciated.  </p>\n\n<pre><code>    select \n      Id, \n      [Description],\n      SUM(CASE WHEN t1.compliant = 1  THEN 1 ELSE 0 END) as Compliant,\n      SUM(CASE WHEN t1.compliant = 0  THEN 1 ELSE 0 END) as NonCompliant,\n      LastChecked \nfrom lineitems as t0\n      left outer join lineitemsmap as t1 on t0.id = t1.lineitemid\n      left outer join art_blob as t2 on t2.art_blob_id = t1.blobid\n      left outer join art_asset as t3 on t3.art_asset_id = t2.art_asset_id\n      left outer join lineitemexceptions as t4 on t4.assetid = t3.art_asset_id and t4.lineitemid = t1.lineitemid\nwhere t0.active = 1 and t4.assetid is null\ngroup by t0.id, t0.[description], t0.lastchecked\n</code></pre>\n\n<p>Here is a link to the execute plan saved in XML:  <a href=\"http://codepaste.net/5xcpcw\" rel=\"nofollow\">http://codepaste.net/5xcpcw</a>\nHere is a link to the table structure: <a href=\"http://codepaste.net/pnqx6e\" rel=\"nofollow\">http://codepaste.net/pnqx6e</a></p>\n"},{"tags":["sql-server","transactions","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":13012358,"title":"SSIS transaction management MSSQL","body":"<p>I need to copy data from DB \"source\" to db \"destination\" should the copying fail, I need to roll back on \"destination\". The two connections are defined in the connection manager as OLE DB.</p>\n\n<p>Here is my current attempt which is not working. I tried playing around with the in-built transaction managemen (setting the tasks transaction to <strong>required</strong>) but that only made it impossible to connect to \"destination\".</p>\n\n<p>The destination has set \"RetainSameConnection\" = true, while this is false for \"source\" for no particular reason.</p>\n\n<p>I also set the \"MaxConcurrentExecutables\" = 1 in to hinder SSIS from executing my rollback as the first thing.</p>\n\n<p>Each of the tasks in the sequence is set to \"Isolation level\"=ReadUncommitted and \"transactionOption\"=supported.</p>\n\n<p>The \"failing script\" is a script that always fail in order for me to test the transaction is working.</p>\n\n<p><img src=\"http://i.stack.imgur.com/oPS9k.png\" alt=\"enter image description here\"></p>\n\n<p>The code for the task \"begin tran\" is \"BEGIN TRANSACTION            \" and the connection is set to \"destination\" </p>\n\n<p>The Code for the task \"rollback tran\" is \"rollback transaction\"  and the connection is set to \"destination\" </p>\n\n<p>The rollback fails with \"the rollback transaction request has no corresponding 'BEGIN TRANSACTION'\"</p>\n"},{"tags":["c#","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13015334,"title":"How can I clone an existing table schema to create a new empty table with the same structure, using C#?","body":"<p>I'm connecting to an SQL Server 2008 database.</p>\n\n<p>Using C#, I'd like to create a new table, with a name specified by me, which looks exactly like an existing table in that database.  There are no foreign keys involved.</p>\n\n<p>I have code like </p>\n\n<pre><code>DataTable table = con.GetSchema(\"Tables\");\nforeach (System.Data.DataRow row in table.Rows)\n{\n    foreach (System.Data.DataColumn col in table.Columns)\n</code></pre>\n\n<p>But it doesn't get me very far.  Do I really need to iterate over all the tables myself?  Even if I identify the <code>DataTable</code> how do I clone it?  I looked at <code>DataTable.Clone</code> but I can't see how to set a new name and create that table on the database.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":13013347,"title":"get data for per year","body":"<p>I have a problem with query so I have two tables : Job and Job answers,so to get number of answers of every job I do like that : </p>\n\n<pre><code>and ((month(a.created_at) = 10 and day(a.created_at) &gt;= 1) \n      or (month(a.created_at) between 11 and 12) \n      or (month(a.created_at) between 1 and 8) \n      or (month(a.created_at) = 9 and day (a.created_at) &lt;= 30))\n</code></pre>\n\n<p>Now I have another modification to do is to get a new number of answers of job by per year and between two date ( 1 september and 30 december for every year) [field : created_at] , </p>\n\n<pre><code>     +----------+-------+---------+------+----- +\n     | year     | job title | number of answers |\n     +----------+-------+---------+------+------+\n     | 2008     | Job1      | 58                | \n     | 2010     | Job2      | 45                | \n     | 2012     | Job3      | 122               |\n     +----------+-------+---------+------+------\n</code></pre>\n\n<p>year and date is in created_at field...</p>\n\n<p>Edit : </p>\n\n<p>for 01/10 to 30/9 I do : </p>\n\n<pre><code>  and ( (month(a.created_at) = 10 and day(a.created_at) &gt;= 1) \n        or month(a.created_at)   between 11 and 12 \n        or month(a.created_at) between 1 and 8 \n        or (month(a.created_at) = 9 and day (a.created_at) &lt;= 30))\n</code></pre>\n\n<p>edit 2 : </p>\n\n<pre><code> delimiter $$\nbegin\n\ndeclare @StartDay INT, @EndDay INT, @StartMonth INT, @EndMonth INT\nSelect @StartDay = 01, @StartMonth = 10, @EndDay = 30, @EndMonth = 09\n\nSelect year(a.created_at) as years , jd.JobDomain, count(a.Id) as nb_answer,   a.Job_id,   j.JobTitle \n from JobAppliance a\n inner join Job j on a.Job_id =  j.PublicId\n inner join JobDestination d on j.Id=d.Job_id\n inner join Jjobdomain jd on  j.Id = jd.Job_id\n\n and \n(\n@StartMonth = @EndMonth And \nMonth(a.created_at) = @StartMonth And \nDay(a.created_at) &gt;= @StartDay And \nDay(a.created_at) &lt;= @EndDay\n) Or (\n@StartMonth != @EndMonth And (\n(\n Month(a.created_at) = @StartMonth And\n  Day(a.created_at) &gt;= @StartDay\n) Or (\n  Month(a.created_at) Between @StartMonth + 1 And @EndMonth - 1\n) Or (\n  Month(a.created_at) = @EndMonth And\n  Day(a.created_at) &lt;= @EndDay\n)\n)\n)\n\ngroup by year(a.created_at) , a.Job_id, j.JobTitle;\n\nend$$\ndelimiter ;\n</code></pre>\n\n<p>I have a syntax error in declare?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":66,"score":0,"question_id":13014664,"title":"Converting to HH:MM:SS","body":"<p>I have a SQL server job that goes out and imports a text file.  one line of this job is as follows:</p>\n\n<pre><code>SUBSTRING(Line, 61, 5) AS Col06,\n</code></pre>\n\n<p>This is getting a 5 digit number (the duration of a call) and placing it into a nvarchar(50) field.  I would like to convert this into <code>HH:MM:SS</code>.</p>\n\n<p>Can you assist?  I am quite new to this so explain as if I was stupid.</p>\n"},{"tags":["sql-server","vb.net","crystal-reports","vb.net-2010"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":13006847,"title":"crystal report record forumula id int data types in query using vb.net","body":"<p>Anyone could help me to query record select formula in crystal report viewer code.. i want to sort equal to ID name fields from database which is auto increment and data types is int.\ni use vb.net and mssql server database.</p>\n\n<pre><code>Dim selTXT As Integer = ListView1.SelectedItems(0).Text\nDim strCR_File = Application.StartupPath &amp; \"\\Reports\\CR_Payslip.rpt\"\n\n// this is i want to fix.. it work but null values in report view..\nDim strCR_Formula = \"{tblPayroll.prl_empID}='\" &amp; selTXT &amp; \"'\"\n\nfrmReportViewer.ShowDialog()\n</code></pre>\n"},{"tags":["sql-server","database","stored-procedures","single-threaded"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12975884,"title":"Force a stored procedure to run single threaded","body":"<p>I have a stored procedure running on a multi-core system. It is executed in multi-threaded way. Due to, may be, some thing in the query, execution of some of the threads hangs forever with cx_packet wait and lock. Is there a way to force single threaded execution? (I know that is not the best solution, but is helpful until at least the query is better optimized.)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","optimization"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13013126,"title":"What's the most efficient way to write a single record to an MS SQL 2008 Server using .NET?","body":"<p>I'm writing a command-line tool (to run on Windows 7 boxes) that inserts a single record into a table and then exits.  I'm using C# (.NET 4.5) and SQL Server 2008.</p>\n\n<p>The record of data contains a large (up to 6000 bytes) string, a time-stamp and an auto-incrementing integer ID primary key.  There are no foreign keys attached to the table.</p>\n\n<p>Also, since this is the most common usage scenario for this database I'd like to optimise for it.  Are there any tricks with how I set up the database that will help keep individual insert times low?</p>\n\n<p>[EDIT]\nThe code I'm currently using...</p>\n\n<pre><code>SqlConnection con = new SqlConnection(ConnectionString);\ncon.Open();\nSqlTransaction trans = con.BeginTransaction();\n\nSqlCommand cmd = new SqlCommand(\"INSERT INTO [msglog](message,project,username,computername,updated_at) VALUES (@m,@p,@u,@c,@i,@t)\", con, trans);\ncmd.Parameters.AddWithValue(\"@u\", Username);\ncmd.Parameters.AddWithValue(\"@c\", Computername);\ncmd.Parameters.AddWithValue(\"@m\", msg);\ncmd.Parameters.AddWithValue(\"@p\", ProjectName);\ncmd.Parameters.AddWithValue(\"@t\", DateTime.Now);\ncmd.ExecuteNonQuery();\ntrans.Commit();\n</code></pre>\n"},{"tags":["php","sql","sql-server","linux","webserver"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":1,"view_count":74,"score":2,"question_id":12264672,"title":"SQL Server 2005 extension on Linux","body":"<p>Does anyone know how I can install an Ms SQL extension 2005 on a Linux webserver?\nThe webserver currently has FreeTDS library version, I have no idea on what that means. But when I try to connect it doesn't say \"mssql_connect() does not exist\" But it says \"Unable to connect to server: xx.xx.xx.xx\" </p>\n\n<p>I am supposing that this is because of the version of the extension since I have occured this problem on windows with ntwdblib.dll. But I don't know how to fix this on Linux.</p>\n\n<p>I only need to use the functions. The database is on a windows server so I want to connect to it using mssql_connect().</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":62,"score":-2,"question_id":13014066,"title":"Select appropriate date","body":"<p>I have a first table T1 with a date and some other informations:</p>\n\n<pre><code>--TABLE1\ndate, field1, field2, field3...\n20120801 | info1    | info2    | ...\n20120802 | info1    | info2    | ...\n20120803 | info1    | info2    | ...\n20120804 | info1    | info2    | ...\n20120805 | info1    | info2    | ...\n20120806 | info1    | info2    | ...\n</code></pre>\n\n<p>I have a second table T2 which contains date related informations, with business days and weekend days:</p>\n\n<pre><code>--TABLE2\ndate, businessdayofthemonth, day, field4...\n20120801 | 1    | Wednesday | ...\n20120802 | 2    | Thursday  | ...\n20120803 | 3    | Friday    | ...\n20120804 | NULL | Saturday  | ...\n20120805 | NULL | Sunday    | ...\n20120806 | 4    | Lundi     | ...\n</code></pre>\n\n<p>Now what I am trying to do:\nI want to have for every line of table 1, the date of table 2 which is exactly corresponding to the 3rd business day after a given date &lt;=> (isnumeric(businessdayofthemonth)=1)</p>\n\n<p>for instance if i select the first line of T1:</p>\n\n<pre><code>dateT1   | dateT1+3 | TheDateIWant |\n20120801 | 20120804 | 20120806     | info1 | info2 | ...\n</code></pre>\n\n<p>Hope I explained it correctly , thank you</p>\n\n<p><strong>EDIT:</strong>\nI think i didn't explain this right: I need the date that is exactly 3 business days after a given date which means:</p>\n\n<p>for:</p>\n\n<pre><code>20120803 | 3    | Friday    | ...\n</code></pre>\n\n<p>i want the next 3 business days date:</p>\n\n<pre><code>20120808\n</code></pre>\n\n<p>btw why downvote? i work on a database with litteraly billions of rows, this is only part of the work i do on a 300 lines request over 15 tables, if i post, i tried.</p>\n"},{"tags":["sql","sql-server","performance","query"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":63,"score":1,"question_id":12558483,"title":"SQL query slow calculating cumulative totals","body":"<p>We are storing data readings at 5 minute intervals for a large number of gauges.</p>\n\n<p>The data tables involved are:</p>\n\n<pre><code>Table1 - GaugeData\nColumns - \n    GaugeID (int, primary key)\n    Timestamp (datetime, primary key)\n    Value (decimal)\n\nTable2 - GaugeSummaryData\nColumns - \n    GaugeID (int, primary key)\n    DayTimestamp (date, primary key)\n    DayTotal (decimal) - total for the current date/day\n    CumulativeTotal (decimal) - total up to and including the current date\n</code></pre>\n\n<p>Without changing the table structure in any way, what would be the most efficient way to copy and aggregate data from GaugeData into GaugeSummaryData?</p>\n\n<p>I have attempted this two ways already. Using a cursor takes 40 minutes to copy all data from GaugeData to GaugeSummaryData. Using insert/update statements took 2hrs+.</p>\n\n<p>Could somebody please suggest the most efficient way? Pseudocode or SQL appreciated.</p>\n"},{"tags":["sql-server","vb.net","vb.net-2010"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":151,"score":2,"question_id":13014044,"title":"Sending parameters to stored procedures vb.net","body":"<p>Hello this my first project in vb.net working with ms visual studio 2010, i want to create a class that can send parameters to stored procedures in an transact-sql database, i know how to do it in vb 6 but i'm not sure if this the right way to do it in here.</p>\n\n<pre class=\"lang-vb prettyprint-override\"><code>Imports System.Data.SqlClient\n\nPublic Class ClsLineas\n\nPublic Sub Inserta(ByVal GridLineas As DataGrid, _\n                   ByVal numero As String, _\n                   ByVal tipo As String, _\n                   ByVal estado As String, _\n                   ByVal anexo As Integer, _\n                   ByVal fechaInicio As String, _\n                   ByVal fechaFin As String, _\n                   ByVal pcReg As String, _\n                   ByVal observaciones As String, _\n                   ByVal usuReg As String)\n\n    Dim cnx As SqlConnection = New SqlConnection(ClsCon.connectionString)\n    'ClsCon.connectionString is a class that contains the connection string \n    Dim cmd As SqlCommand = New SqlCommand()\n\n    If cnx.State = ConnectionState.Closed Then cnx.Open()\n\n    cmd.Connection = cnx\n    cmd.CommandText = \"SP_INSERTA_LINEA\"\n    cmd.CommandType = CommandType.StoredProcedure\n\n    Dim prm As New SqlParameter\n\n    prm.ParameterName = \"@TIPO\"\n    prm.SqlDbType = SqlDbType.NVarChar\n    prm.Size = 30\n    prm.Direction = ParameterDirection.Input\n    prm.Value = tipo\n    cmd.Parameters.Add(prm)\n\n    prm.ParameterName = \"@FECHA_INICIO\"\n    prm.SqlDbType = SqlDbType.NVarChar\n    prm.Size = 30\n    prm.Direction = ParameterDirection.Input\n    prm.Value = fechaInicio\n    cmd.Parameters.Add(prm)\n\n    prm.ParameterName = \"@FECHA_FIN\"\n    prm.SqlDbType = SqlDbType.NVarChar\n    prm.Size = 30\n    prm.Direction = ParameterDirection.Input\n    prm.Value = fechaFin\n    cmd.Parameters.Add(prm)\n\n    prm.ParameterName = \"@ESTADO\"\n    prm.SqlDbType = SqlDbType.NVarChar\n    prm.Size = 30\n    prm.Direction = ParameterDirection.Input\n    prm.Value = estado\n    cmd.Parameters.Add(prm)\n\n    prm.ParameterName = \"@NUMERO\"\n    prm.SqlDbType = SqlDbType.NVarChar\n    prm.Size = 15\n    prm.Direction = ParameterDirection.Input\n    prm.Value = numero\n    cmd.Parameters.Add(prm)\n\n    prm.ParameterName = \"@ANEXO\"\n    prm.SqlDbType = SqlDbType.Int\n    prm.Direction = ParameterDirection.Input\n    prm.Value = anexo\n    cmd.Parameters.Add(prm)\n\n    prm.ParameterName = \"@PC_REG\"\n    prm.SqlDbType = SqlDbType.NVarChar\n    prm.Size = 50\n    prm.Direction = ParameterDirection.Input\n    prm.Value = pcReg\n    cmd.Parameters.Add(prm)\n\n    prm.ParameterName = \"@USU_REG\"\n    prm.SqlDbType = SqlDbType.NVarChar\n    prm.Size = 50\n    prm.Direction = ParameterDirection.Input\n    prm.Value = usuReg\n    cmd.Parameters.Add(prm)\n\n    prm.ParameterName = \"@OBSERVACIONES\"\n    prm.SqlDbType = SqlDbType.NVarChar\n    prm.Size = 1000\n    prm.Direction = ParameterDirection.Input\n    prm.Value = observaciones\n    cmd.Parameters.Add(prm)\n\n    prm.ParameterName = \"@ID\"\n    prm.SqlDbType = SqlDbType.Int\n    prm.Direction = ParameterDirection.Output\n    cmd.Parameters.Add(prm)\n\n    Dim adp As SqlDataAdapter = New SqlDataAdapter(cmd)\n\n    Dim DataSet As DataSet = New DataSet(\"Lineas\")\n\n    adp.Fill(DataSet)\n    GridLineas.DataSource = DataSet.Tables(0)\n\nEnd Sub\nEnd class\n</code></pre>\n\n<p>Some of my doubts are:</p>\n\n<p>Do i really need to open the database every time i call the methods of my class?</p>\n\n<p>Are the sqlAdapter and Dataset really needed? In vb 6 you could do something like \"command execute inserta\" after appending the parameters and you where done.</p>\n"},{"tags":["c#","sql-server","oracle","sqlite","database-versioning"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":83,"score":2,"question_id":12478519,"title":"Solution to do Database migrations on Oracle / SqlServer and SqlLite","body":"<p>Im looking for a tool (preferably open-source) that can do Database migrations and versioning inside TFS, and is able to automatically deploy this during an deployment / build.</p>\n\n<h3>Background</h3>\n\n<p>We have developed an application that is frequently updated, sometimes with database changes and sometimes without. The database is running on Oracle 11g, there is also an Sqlite database in place to run tests against. We use NHibernate in combination with Fluent-NHibernate as ORM (Fluent-NHibernate for the mappings).</p>\n\n<h3>Current situation</h3>\n\n<p>At this time the database changes are done by hand. Changing the fluent mappings for database creation and writing a SQL script to alter / drop / create about anything we need.\nTo go to Test / Acceptence / Production we build against a different Config and then Copy the contents to the specific server and run the specific SQL scripts on the database.</p>\n\n<h3>Drawbacks</h3>\n\n<p>The schemaupdate from NHibernate does not allow for destructive updates, so this has to be done by hand if we are looking for an NHibernate solution.</p>\n\n<h3>Preffered situation</h3>\n\n<p>the above is a workable solution but now we have the need to version these changes so that we can go up / rollback (if this is needed) if we deploy a new version by using <a href=\"http://exortech.com/blog/2009/02/01/weekly-release-blog-11-zero-downtime-database-deployment/\" rel=\"nofollow\">Expand/Contract</a>. it is preffered that this is done automatically when we deploy a new version to the database.</p>\n\n<h3>Questions</h3>\n\n<ol>\n<li>Is there a migration tool thas uses Expand and Contract for generating schema's</li>\n<li>Will it work with Oracle 11g, SqLite and SqlServer</li>\n<li>Possibility to keep using NHibernate / Fluent-NHibernate</li>\n<li>Good ways to automatically deploy a specific build (Not a must have, are enough tools to do this but maybe good to have someting that can do all)</li>\n</ol>\n\n<h3>Investigated</h3>\n\n<ul>\n<li><a href=\"https://code.google.com/p/roundhouse/\" rel=\"nofollow\">RoundhousE</a>\n<ul>\n<li>No rollbacks.</li>\n<li>Unable to get it working with our mappings.</li>\n</ul></li>\n<li><a href=\"https://github.com/schambers/fluentmigrator\" rel=\"nofollow\">FluentMigrator</a>\n<ul>\n<li>Cannot combine with NHibernate mappings uses it's own Fluent interface.</li>\n</ul></li>\n<li><a href=\"http://www.red-gate.com/products/oracle-development/\" rel=\"nofollow\">Red-Gate Deployment Suite for Oracle</a>\n<ul>\n<li>Tool cannot be easily integrated with our environment.</li>\n</ul></li>\n</ul>\n\n<p>I hope this is clear, if not feel free to comment</p>\n"},{"tags":["sql","sql-server","database-design","data-warehouse","dimensional-modeling"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":138,"score":3,"question_id":12853932,"title":"How to handle late arriving dimension and NULL business key in Kimball Data Mart?","body":"<p>I'm trying to implement Kimball data mart which uses -1 and -2 rows in dimension table for late arriving dimension and for NULL business key. I have an example code below which creates one staging table for fact and dimension data, two dimension tables and one fact table for data mart. Here is my example code with data in SQL:</p>\n\n<pre><code>--drop table stg_sales\n--go\nCREATE TABLE dbo.stg_sales\n  (\n     stg_sales_id       INT IDENTITY(1, 1) NOT NULL,\n     sales_number       INT NOT NULL,\n     sales_amt          INT NULL,\n     cust_number        INT NULL,\n     cust_firstname     NVARCHAR(50) NULL,\n     cust_lastname      NVARCHAR(100) NULL,\n     cust_address       NVARCHAR(500) NULL,\n     salesperson_number INT NULL,\n     CONSTRAINT pk_stg_sales PRIMARY KEY (stg_sales_id)\n  )\n\ngo\n\nINSERT stg_sales\n       (sales_number,\n        sales_amt,\n        cust_number,\n        cust_firstname,\n        cust_lastname,\n        cust_address,\n        salesperson_number)\nVALUES (123,\n        434,\n        2342,\n        'Jim',\n        'Moriaty',\n        'something',\n        23)\n\nINSERT stg_sales\n       (sales_number,\n        sales_amt,\n        cust_number,\n        cust_firstname,\n        cust_lastname,\n        cust_address,\n        salesperson_number)\nVALUES (124,\n        234,\n        2342,\n        'Jim',\n        'Moriaty',\n        'something',\n        23)\n\nINSERT stg_sales\n       (sales_number,\n        sales_amt,\n        cust_number,\n        cust_firstname,\n        cust_lastname,\n        cust_address,\n        salesperson_number)\nVALUES (125,\n        434,\n        4545,\n        'Joe',\n        'Esk',\n        'someother',\n        24)\n\nINSERT stg_sales\n       (sales_number,\n        sales_amt,\n        cust_number,\n        cust_firstname,\n        cust_lastname,\n        cust_address,\n        salesperson_number)\nVALUES (126,\n        434,\n        5555,\n        'Daniel',\n        'Hart',\n        'Someaddr',\n        NULL) --salesperson_number business key missing here\n\nINSERT stg_sales\n       (sales_number,\n        sales_amt,\n        cust_number,\n        cust_firstname,\n        cust_lastname,\n        cust_address,\n        salesperson_number)\nVALUES (127,\n        333,\n        4444,\n        'Pat',\n        'Smith',\n        'Someaddr',\n        30)\n\nSELECT *\nFROM   stg_sales\n\n--create a dimension and fact tables\n--drop table dbo.dim_customer\n--go\nCREATE TABLE dbo.dim_customer\n  (\n     customer_wid   INT IDENTITY(1, 1) NOT NULL,\n     cust_number    INT NULL,\n     cust_firstname NVARCHAR(50) NULL,\n     cust_lastname  NVARCHAR(100) NULL,\n     cust_address   NVARCHAR(500) NULL,\n     date_insert    DATETIME2 NOT NULL DEFAULT (Getdate()),\n     date_update    DATETIME2 NULL,\n     is_current     BIT NOT NULL\n     CONSTRAINT pk_dim_customer PRIMARY KEY (customer_wid)\n     CONSTRAINT chk_is_current CHECK (is_current IN (0, 1))\n  )\n\ngo\n\nSET IDENTITY_INSERT dbo.dim_customer ON\n\nINSERT dbo.dim_customer\n       (customer_wid,\n        cust_number,\n        cust_firstname,\n        cust_lastname,\n        cust_address,\n        date_insert,\n        date_update,\n        is_current)\nVALUES (-1,\n        -1,\n        'unknown',\n        'unknown',\n        'unknown',\n        Getdate(),\n        Getdate(),\n        1)\n\nINSERT dbo.dim_customer\n       (customer_wid,\n        cust_number,\n        cust_firstname,\n        cust_lastname,\n        cust_address,\n        date_insert,\n        date_update,\n        is_current)\nVALUES (-2,\n        -2,\n        'Error',\n        'Error',\n        'Error',\n        Getdate(),\n        Getdate(),\n        1)\n\nSET IDENTITY_INSERT dbo.dim_customer OFF\n\n--insert data into dimension table\nINSERT dbo.dim_customer\n       (cust_number,\n        cust_firstname,\n        cust_lastname,\n        cust_address,\n        is_current)\nSELECT DISTINCT cust_number,\n                cust_firstname,\n                cust_lastname,\n                cust_address,\n                1 AS is_current\nFROM   dbo.stg_sales\nWHERE  cust_number &lt;&gt; 4444 --left one record off to simulate the situation where you don't have corrensponding row in dim table (late arriving dimension)\nSELECT *\nFROM   dbo.dim_customer\n\nDROP TABLE dbo.dim_salesperson\n\n--create salesperson table\nCREATE TABLE dbo.dim_salesperson\n  (\n     salesperson_wid       INT IDENTITY(1, 1) NOT NULL,\n     salesperson_number    INT NULL,\n     salesperson_firstname NVARCHAR(50) NULL,\n     salesperson_lastname  NVARCHAR(100) NULL,\n     salesperson_address   NVARCHAR(500) NULL,\n     date_insert           DATETIME2 NOT NULL DEFAULT (Getdate()),\n     date_update           DATETIME2 NULL,\n     is_current            BIT NOT NULL\n     CONSTRAINT pk_dim_salesperson PRIMARY KEY (salesperson_wid)\n     CONSTRAINT chk_dim_salesperson_is_current CHECK (is_current IN (0, 1))\n  )\n\ngo\n\nSET IDENTITY_INSERT dbo.dim_salesperson ON\n\nINSERT dbo.dim_salesperson\n       (salesperson_wid,\n        salesperson_number,\n        salesperson_firstname,\n        salesperson_lastname,\n        salesperson_address,\n        date_insert,\n        date_update,\n        is_current)\nVALUES (-1,\n        -1,\n        'Not available',\n        'Not available',\n        'Not available',\n        Getdate(),\n        Getdate(),\n        1)\n\nINSERT dbo.dim_salesperson\n       (salesperson_wid,\n        salesperson_number,\n        salesperson_firstname,\n        salesperson_lastname,\n        salesperson_address,\n        date_insert,\n        date_update,\n        is_current)\nVALUES (-2,\n        -2,\n        'Error',\n        'Error',\n        'Error',\n        Getdate(),\n        Getdate(),\n        1)\n\nSET IDENTITY_INSERT dbo.dim_salesperson OFF\n\n--insert data into salesperson\nINSERT dbo.dim_salesperson\n       (salesperson_number,\n        salesperson_firstname,\n        salesperson_lastname,\n        salesperson_address,\n        is_current)\nVALUES (23,\n        'John',\n        'Fox',\n        'something',\n        1)\n\nINSERT dbo.dim_salesperson\n       (salesperson_number,\n        salesperson_firstname,\n        salesperson_lastname,\n        salesperson_address,\n        is_current)\nVALUES (24,\n        'Hadley',\n        'Fox',\n        'something',\n        1)\n\nINSERT dbo.dim_salesperson\n       (salesperson_number,\n        salesperson_firstname,\n        salesperson_lastname,\n        salesperson_address,\n        is_current)\nVALUES (30,\n        'Ashley',\n        'Fox',\n        'something',\n        1)\n\nSELECT *\nFROM   dbo.dim_salesperson\n\nSELECT *\nFROM   dbo.stg_sales\n\n--create and populate the fact table\n--drop table dbo.f_sales\n--go\nCREATE TABLE dbo.f_sales\n  (\n     sales_number    INT NOT NULL,\n     customer_wid    INT NOT NULL,\n     salesperson_wid INT NOT NULL,\n     sales_amt       INT NULL\n     CONSTRAINT pk_f_sales PRIMARY KEY (sales_number)\n     CONSTRAINT fk_customer_wid FOREIGN KEY (customer_wid) REFERENCES\n     dbo.dim_customer(customer_wid),\n     CONSTRAINT fk_salesperson_wid FOREIGN KEY (salesperson_wid) REFERENCES\n     dbo.dim_salesperson(salesperson_wid)\n  )\n\n--populate the fact table \nINSERT dbo.f_sales\n       (sales_number,\n        customer_wid,\n        salesperson_wid,\n        sales_amt)\nSELECT stg.sales_number,\n       Isnull(dimcust.customer_wid, -1)  AS customer_wid,\n       --this is maybe correct way to assign -1 foreign key when there is no corresponding dimension row in the dim table\n       Isnull(dimsp.salesperson_wid, -2) AS salesperson_wid,\n       --NOT CORRECT, how to assign -2 foreign key when the business key is NULL in the source?\n       stg.sales_amt\nFROM   dbo.stg_sales AS stg\n       LEFT JOIN dbo.dim_customer AS dimcust\n              ON stg.cust_number = dimcust.cust_number\n       LEFT JOIN dbo.dim_salesperson AS dimsp\n              ON stg.salesperson_number = dimsp.salesperson_number\n\nSELECT *\nFROM   dbo.f_sales\n</code></pre>\n\n<p>How can I assign -2 for the rows in which the business key is missing in the source system. You can read more about the theory behind this implementation from Kimball:</p>\n\n<ul>\n<li><a href=\"http://www.kimballgroup.com/2010/10/06/design-tip-128-selecting-default-values-for-nulls/\" rel=\"nofollow\">Kimball Design tip 128</a>  </li>\n<li><a href=\"http://www.kimballgroup.com/2006/04/01/design-tip-78-late-arriving-dimension-rows/\" rel=\"nofollow\">Kimball Design tip 78</a></li>\n</ul>\n\n<p>This is basically what I'm trying to achieve:</p>\n\n<p><a href=\"http://bifuture.blogspot.fi/2011/11/handling-null-in-dimensions-and.html\" rel=\"nofollow\">Handling NULL in dimensions and measures</a></p>\n\n<p>Edit:</p>\n\n<p>I think I can use a <code>COALESCE</code> or <code>ISNULL</code> in the left join, it seems to produce the correct result:</p>\n\n<pre><code>INSERT dbo.f_sales\n       (sales_number,\n        customer_wid,\n        salesperson_wid,\n        sales_amt)\nSELECT stg.sales_number,\n       Isnull(dimcust.customer_wid, -1)  AS customer_wid,\n       --this is maybe correct way to assign -1 foreign key when there is no corresponding dimension row in the dim table\n       dimsp.salesperson_wid,\n       stg.sales_amt\nFROM   dbo.stg_sales AS stg\n       LEFT JOIN dbo.dim_customer AS dimcust\n              ON COALESCE(stg.cust_number, -2) = dimcust.cust_number\n       LEFT JOIN dbo.dim_salesperson AS dimsp\n              ON COALESCE(stg.salesperson_number, -2) = dimsp.salesperson_number\n</code></pre>\n"},{"tags":["sql","sql-server","time-series"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12935944,"title":"SQL Server -- Merging time series data based upon order of values, not timestamp","body":"<p>I hope I can explain this one.</p>\n\n<p>I have various time based readings for different business objects.  Each reading has a timestamp and a value.  The actual time that the data for each business object starts at is different for each object.  (i. e. the data for object 1 was first recorded in June, the data for object 2 was first recorded in August)</p>\n\n<p>What I need to do is aggregate (sum, average, etc.) the values among the different objects based upon the order of the readings (first value, second value) without regard to the actual time each value was </p>\n\n<p>All the data points represent one value for each month.  So there is not a matching problem between business objects.  The second value for each business object is one month later than the first value, etc. etc.  The timestamp for the values have the last day of the month, but this is meaningless to the nature of the data. The year and month are what are important.</p>\n\n<p>I have been dealing with this by loading the whole set of data for each business object and through code merging the data.  But I am wondering if there is a way to do this via SOL.</p>\n\n<p>Anybody got an idea?</p>\n\n<p>Here is some data\nHere is what the data would look like</p>\n\n<pre><code>object ID   Date           Value\n1           2010-01-31      1.0\n1           2010-03-31      2.0\n1           2010-04-30      3.0\n2           2011-06-30     10.0\n2           2011-07-31     11.0\n2           2011-08-31     12.0\n</code></pre>\n\n<p>The desired result would be</p>\n\n<pre><code>month    Sum     Average\n1        11.0     5.5\n2        11.0    11.0 (there is no second month for the first object)\n3        13.0     6.5\n4         3.0     3.0 (there is no fourth month for the second object)\n</code></pre>\n"},{"tags":["sql","sql-server","vb.net","sqlparameters","executenonquery"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":13013486,"title":"SqlParameter and ExecuteNonQuery causing unrepeatable time outs","body":"<p>I recently inherited some code that is having occasional time-out issues. I am mostly familiar with ORM's, so I am having trouble determining if anything is wrong in this code. When it does not time out, it works in a couple of seconds. Time-outs take about a minute.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>Dim sql As String = \"UPDATE VendorInfo SET \" &amp; _\n           \"AbsInkUpdateStatus=@AbsInkUpdateStatus, AccountingNotes=@AccountingNotes, \" &amp; _\n           \"AccountNumber=@AccountNumber, Address_Ship=@Address_Ship, \" &amp; _\n           \"Address0=@Address0, Address1=@Address1, Address2=@Address2, ArtEmail=@ArtEmail, \" &amp; _\n           \"ArtRequirements=@ArtRequirements, City=@City, \" &amp; _\n           \"City_Ship=@City_Ship, CreditLimit=@CreditLimit, DisplayName=@DisplayName, \" &amp; _\n           \"EarlyBy=@EarlyBy, EarlyConfirm=@EarlyConfirm, \" &amp; _\n           \"EarlyHas=@EarlyHas, EarlyNet=@EarlyNet, \" &amp; _\n           \"EarlyNotes=@EarlyNotes, EarlyOn=@EarlyOn, \" &amp; _\n           \"EarlyPercent=@EarlyPercent, Email=@Email, \" &amp; _\n           \"Fax=@Fax, PContactName=@PContactName, \" &amp; _\n           \"Phone=@Phone, Pricing=@Pricing, \" &amp; _\n           \"PromosBy=@PromosBy, PromosConfirm=@PromosConfirm, \" &amp; _\n           \"PromosHas=@PromosHas, PromosNotes=@PromosNotes, \" &amp; _\n           \"PromosOn=@PromosOn, QBName=@QBName, QBTerms=@QBTerms, RebateBy=@RebateBy, \" &amp; _\n           \"RebateConfirm=@RebateConfirm, RebateHas=@RebateHas, \" &amp; _\n           \"RebateNotes=@RebateNotes, RebateOn=@RebateOn, \" &amp; _\n           \"RushPolicy=@RushPolicy, SampleBy=@SampleBy, \" &amp; _\n           \"SampleConfirm=@SampleConfirm, SampleHas=@SampleHas, \" &amp; _\n           \"SampleNotes=@SampleNotes, SampleOn=@SampleOn, \" &amp; _\n           \"SamplePolicy=@SamplePolicy, ShippingBy=@ShippingBy, \" &amp; _\n           \"ShippingConfirm=@ShippingConfirm, ShippingHas=@ShippingHas, \" &amp; _\n           \"ShippingNotes=@ShippingNotes, ShippingOn=@ShippingOn, \" &amp; _\n           \"ShipTo=@ShipTo, [SMP FAX]=@SMP_FAX, \" &amp; _\n           \"SpecialBy=@SpecialBy, SpecialConfirm=@SpecialConfirm, \" &amp; _\n           \"SpecialHas=@SpecialHas, SpecialInstructions=@SpecialInstructions, \" &amp; _\n           \"SpecialNotes=@SpecialNotes, SpecialOn=@SpecialOn, \" &amp; _\n           \"SpecialPricingShort=@SpecialPricingShort, State=@State, \" &amp; _\n           \"State_Ship=@State_Ship, TermsBy=@TermsBy, \" &amp; _\n           \"TermsConfirm=@TermsConfirm, TermsHas=@TermsHas, \" &amp; _\n           \"TermsNotes=@TermsNotes, TermsOn=@TermsOn, \" &amp; _\n           \"TypicalShippingCost=@TypicalShippingCost, UpdateStatus=@UpdateStatus, \" &amp; _\n           \"VendorName=@VendorName, VendorStrength=@VendorStrength, \" &amp; _\n           \"WebPage=@WebPage, ZipCode=@ZipCode, EmailPO=@EmailPO, SendPO=@SendPO, \" &amp; _\n           \"ZipCode_Ship=@ZipCode_Ship WHERE ID=@ID\"\n        Dim p() As SqlParameter = New SqlParameter(74) {}\n        p(0) = MakeSQLParam(\"@AbsInkUpdateStatus\", SqlDbType.VarChar, 50, SS(ht(\"AbsInkUpdateStatus\")))\n        p(1) = MakeSQLParam(\"@AccountingNotes\", SqlDbType.VarChar, 500, SS(ht(\"AccountingNotes\")))\n        p(2) = MakeSQLParam(\"@AccountNumber\", SqlDbType.NVarChar, 35, SS(ht(\"AccountNumber\")))\n        p(3) = MakeSQLParam(\"@Address_Ship\", SqlDbType.NVarChar, 50, SS(ht(\"Address_Ship\")))\n        p(68) = MakeSQLParam(\"@Address0\", SqlDbType.VarChar, 100, SS(ht(\"Address0\")))\n        p(4) = MakeSQLParam(\"@Address1\", SqlDbType.NVarChar, 50, SS(ht(\"Address1\")))\n        p(69) = MakeSQLParam(\"@Address2\", SqlDbType.VarChar, 50, SS(ht(\"Address2\")))\n        p(5) = MakeSQLParam(\"@ArtEmail\", SqlDbType.NVarChar, 100, SS(ht(\"ArtEmail\")))\n        p(6) = MakeSQLParam(\"@ArtRequirements\", SqlDbType.NText, SS(ht(\"ArtRequirements\")))\n        p(7) = MakeSQLParam(\"@City\", SqlDbType.NVarChar, 50, SS(ht(\"City\")))\n        p(8) = MakeSQLParam(\"@City_Ship\", SqlDbType.NVarChar, 50, SS(ht(\"City_Ship\")))\n        p(72) = MakeSQLParam(\"@CreditLimit\", SqlDbType.Float, ht(\"CreditLimit\"))\n        If ((Not ht.ContainsKey(\"EmailPO\")) OrElse IsDBNull(ht(\"EmailPO\")) OrElse String.IsNullOrEmpty(ht(\"EmailPO\"))) Then\n            p(73) = MakeSQLParam(\"@EmailPO\", SqlDbType.Bit, DBNull.Value)\n        Else\n            p(73) = MakeSQLParam(\"@EmailPO\", SqlDbType.Bit, Convert.ToBoolean(ht(\"EmailPO\")))\n        End If\n        If ((Not ht.ContainsKey(\"SendPO\")) OrElse IsDBNull(ht(\"SendPO\")) OrElse String.IsNullOrEmpty(ht(\"SendPO\"))) Then\n            p(74) = MakeSQLParam(\"@SendPO\", SqlDbType.NVarChar, 255, DBNull.Value)\n        Else\n            p(74) = MakeSQLParam(\"@SendPO\", SqlDbType.NVarChar, 255, SS(ht(\"SendPO\")))\n        End If\n        p(9) = MakeSQLParam(\"@DisplayName\", SqlDbType.NVarChar, 255, SS(ht(\"DisplayName\")))\n        p(10) = MakeSQLParam(\"@EarlyBy\", SqlDbType.VarChar, 5, SS(ht(\"EarlyBy\")))\n        p(11) = MakeSQLParam(\"@EarlyConfirm\", SqlDbType.VarChar, 50, SS(ht(\"EarlyConfirm\")))\n        p(12) = MakeSQLParam(\"@EarlyHas\", SqlDbType.VarChar, 10, SS(ht(\"EarlyHas\")))\n        p(13) = MakeSQLParam(\"@EarlyNet\", SqlDbType.VarChar, 10, SS(ht(\"EarlyNet\")))\n        p(14) = MakeSQLParam(\"@EarlyNotes\", SqlDbType.VarChar, 125, SS(ht(\"EarlyNotes\")))\n        p(15) = MakeSQLParam(\"@EarlyOn\", SqlDbType.DateTime, DtoDB(ht(\"EarlyOn\")))\n        p(16) = MakeSQLParam(\"@EarlyPercent\", SqlDbType.Decimal, DBS(ht(\"EarlyPercent\"), True))\n        p(17) = MakeSQLParam(\"@Email\", SqlDbType.NVarChar, 75, SS(ht(\"Email\")))\n        p(18) = MakeSQLParam(\"@Fax\", SqlDbType.NVarChar, 50, SS(ht(\"Fax\")))\n        p(19) = MakeSQLParam(\"@ID\", SqlDbType.Int, ht(\"ID\"))\n        p(20) = MakeSQLParam(\"@PContactName\", SqlDbType.NVarChar, 50, SS(ht(\"PContactName\")))\n        p(21) = MakeSQLParam(\"@Phone\", SqlDbType.NVarChar, 50, SS(ht(\"Phone\")))\n        p(22) = MakeSQLParam(\"@Pricing\", SqlDbType.NVarChar, 255, SS(ht(\"Pricing\")))\n        p(23) = MakeSQLParam(\"@PromosBy\", SqlDbType.VarChar, 5, SS(ht(\"PromosBy\")))\n        p(24) = MakeSQLParam(\"@PromosConfirm\", SqlDbType.VarChar, 50, SS(ht(\"PromosConfirm\")))\n        p(25) = MakeSQLParam(\"@PromosHas\", SqlDbType.VarChar, 10, SS(ht(\"PromosHas\")))\n        p(26) = MakeSQLParam(\"@PromosNotes\", SqlDbType.VarChar, 125, SS(ht(\"PromosNotes\")))\n        p(27) = MakeSQLParam(\"@PromosOn\", SqlDbType.DateTime, DtoDB(ht(\"PromosOn\")))\n        p(70) = MakeSQLParam(\"@QBName\", SqlDbType.VarChar, 41, SS(ht(\"QBName\")))\n        p(71) = MakeSQLParam(\"@QBTerms\", SqlDbType.VarChar, 31, SS(ht(\"QBTerms\")))\n        p(28) = MakeSQLParam(\"@RebateBy\", SqlDbType.VarChar, 5, SS(ht(\"RebateBy\")))\n        p(29) = MakeSQLParam(\"@RebateConfirm\", SqlDbType.VarChar, 50, SS(ht(\"RebateConfirm\")))\n        p(30) = MakeSQLParam(\"@RebateHas\", SqlDbType.VarChar, 10, SS(ht(\"RebateHas\")))\n        p(31) = MakeSQLParam(\"@RebateNotes\", SqlDbType.VarChar, 125, SS(ht(\"RebateNotes\")))\n        p(32) = MakeSQLParam(\"@RebateOn\", SqlDbType.DateTime, DtoDB(ht(\"RebateOn\")))\n        p(33) = MakeSQLParam(\"@RushPolicy\", SqlDbType.NVarChar, 200, SS(ht(\"RushPolicy\")))\n        p(34) = MakeSQLParam(\"@SampleBy\", SqlDbType.VarChar, 5, SS(ht(\"SampleBy\")))\n        p(35) = MakeSQLParam(\"@SampleConfirm\", SqlDbType.VarChar, 50, SS(ht(\"SampleConfirm\")))\n        p(36) = MakeSQLParam(\"@SampleHas\", SqlDbType.VarChar, 10, SS(ht(\"SampleHas\")))\n        p(37) = MakeSQLParam(\"@SampleNotes\", SqlDbType.VarChar, 125, SS(ht(\"SampleNotes\")))\n        p(38) = MakeSQLParam(\"@SampleOn\", SqlDbType.DateTime, DtoDB(ht(\"SampleOn\")))\n        p(39) = MakeSQLParam(\"@SamplePolicy\", SqlDbType.NVarChar, 255, SS(ht(\"SamplePolicy\")))\n        p(40) = MakeSQLParam(\"@ShippingBy\", SqlDbType.VarChar, 5, SS(ht(\"ShippingBy\")))\n        p(41) = MakeSQLParam(\"@ShippingConfirm\", SqlDbType.VarChar, 50, SS(ht(\"ShippingConfirm\")))\n        p(42) = MakeSQLParam(\"@ShippingHas\", SqlDbType.VarChar, 10, SS(ht(\"ShippingHas\")))\n        p(43) = MakeSQLParam(\"@ShippingNotes\", SqlDbType.VarChar, 125, SS(ht(\"ShippingNotes\")))\n        p(44) = MakeSQLParam(\"@ShippingOn\", SqlDbType.DateTime, DtoDB(ht(\"ShippingOn\")))\n        p(45) = MakeSQLParam(\"@ShipTo\", SqlDbType.NVarChar, 100, SS(ht(\"ShipTo\")))\n        p(46) = MakeSQLParam(\"@SMP_FAX\", SqlDbType.NVarChar, 50, SS(ht(\"SMP FAX\")))\n        p(47) = MakeSQLParam(\"@SpecialBy\", SqlDbType.VarChar, 5, SS(ht(\"SpecialBy\")))\n        p(48) = MakeSQLParam(\"@SpecialConfirm\", SqlDbType.VarChar, 50, SS(ht(\"SpecialConfirm\")))\n        p(49) = MakeSQLParam(\"@SpecialHas\", SqlDbType.VarChar, 10, SS(ht(\"SpecialHas\")))\n        p(50) = MakeSQLParam(\"@SpecialInstructions\", SqlDbType.Text, SS(ht(\"SpecialInstructions\")))\n        p(51) = MakeSQLParam(\"@SpecialNotes\", SqlDbType.VarChar, 255, SS(ht(\"SpecialNotes\")))\n        p(52) = MakeSQLParam(\"@SpecialOn\", SqlDbType.DateTime, DtoDB(ht(\"SpecialOn\")))\n        p(53) = MakeSQLParam(\"@SpecialPricingShort\", SqlDbType.VarChar, 80, SS(ht(\"SpecialPricingShort\")))\n        p(54) = MakeSQLParam(\"@State\", SqlDbType.NVarChar, 25, SS(ht(\"State\")))\n        p(55) = MakeSQLParam(\"@State_Ship\", SqlDbType.NVarChar, 25, SS(ht(\"State_Ship\")))\n        p(56) = MakeSQLParam(\"@TermsBy\", SqlDbType.VarChar, 5, SS(ht(\"TermsBy\")))\n        p(57) = MakeSQLParam(\"@TermsConfirm\", SqlDbType.VarChar, 50, SS(ht(\"TermsConfirm\")))\n        p(58) = MakeSQLParam(\"@TermsHas\", SqlDbType.VarChar, 10, SS(ht(\"TermsHas\")))\n        p(59) = MakeSQLParam(\"@TermsNotes\", SqlDbType.VarChar, 125, SS(ht(\"TermsNotes\")))\n        p(60) = MakeSQLParam(\"@TermsOn\", SqlDbType.DateTime, DtoDB(ht(\"TermsOn\")))\n        p(61) = MakeSQLParam(\"@TypicalShippingCost\", SqlDbType.NText, SS(ht(\"TypicalShippingCost\")))\n        p(62) = MakeSQLParam(\"@UpdateStatus\", SqlDbType.VarChar, 50, SS(ht(\"UpdateStatus\")))\n        p(63) = MakeSQLParam(\"@VendorName\", SqlDbType.NVarChar, 100, SS(ht(\"VendorName\")))\n        p(64) = MakeSQLParam(\"@VendorStrength\", SqlDbType.NVarChar, 100, SS(ht(\"VendorStrength\")))\n        p(65) = MakeSQLParam(\"@WebPage\", SqlDbType.NVarChar, 100, SS(ht(\"WebPage\")))\n        p(66) = MakeSQLParam(\"@ZipCode\", SqlDbType.NVarChar, 15, SS(ht(\"ZipCode\")))\n        p(67) = MakeSQLParam(\"@ZipCode_Ship\", SqlDbType.NVarChar, 15, SS(ht(\"ZipCode_Ship\")))\n\n        Dim con As SqlConnection = Nothing\n        Try\n            con = New SqlConnection(ConfigurationManager.AppSettings(\"LeadsConnectionString\"))\n            SqlHelper.ExecuteNonQuery(con, CommandType.Text, sql, p)\n        Catch ex As Exception\n            Throw New Exception(ex.Message &amp; \" UPDATE failed for 'VendorInfo' \" &amp; ht.TableAsString, ex)\n        Finally\n            If (Not con Is Nothing) Then con.Close()\n        End Try\n</code></pre>\n\n<p>SS is \"safe string\" function and MakeSQLParam sets the direction to <code>input</code> and makes sure the size value is not violated.</p>\n\n<p>So my question is: does anyone see something wrong with this code that might cause sluggishness? Or does anyone know of anything else I might want to check that could help with this issue?</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13013463,"title":"How to get the last reading for each day","body":"<p>I have this DB table in which data is constantly being added to. The Data that is being added is sensor data so there are two readings per sensor per hour. I would like to know of a way to get only the last reading of the day for the entire month. For example, </p>\n\n<pre><code>select * from dbo.NewLogTable\nwhere Sensor_ID= '12345'and Date_Reading between '2012-08-01' and '2012-08-31' \nand DateTimeStamp between '23:30:00'and '23:59:00'\norder by DateTimeStamp asc\n</code></pre>\n\n<p>I know this doesn't work but its a pseudo code of what I want. Again the goal here is to get just one reading(the latest) per day for a particular sensor. I have seen plenty of example where the first and last day of the month are displayed, display past x amount of days, etc. Not really like my application. Can anyone help? thanks. </p>\n"},{"tags":["sql-server","search","search-engine"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13013575,"title":"How to select different sets of rows with a number a particular property in MSS QL","body":"<p>This is an example of the search results I may get if I search for \"File Manager\":</p>\n\n<pre><code>row, id, class_name, display_name, version\n1, 15, FileManager, File Manager, 5\n2, 13, FileManager, File Manager, 4\n3, 11, FileManager, File Manager, 3\n4, 10, FileManager, The File Manager, 2\n5, 9, FileManager, The File Manager, 1\n6, 12, ReviewManager, Review Manager, 2\n7, 2, ReviewManager, Review Manager, 1\n8, 5, ExerciseManager, Exercise Manager, 2\n9, 1, ExerciseManager, Exercise Manager, 1\netc\n</code></pre>\n\n<p>I want to do pagination such that I have X results in a page, with similar results group together. i.e. if I want 3 results per page, I should have rows 1 to 9 selected. This is cos based on class_name rows 1-5 are similar results, similar for row 6-7 and row 8-9 => 3 groups. How do I do that? Similarily for the next few pages, how?</p>\n\n<p>I was thinking worse come to worse I will use a cursor to loop through and count, which I think is very inefficient, So I am hoping to see a more efficient method. I thought of using TOP or ROW_NUMBER, but these doesn't make sense cos I don't know which rows to get...</p>\n"}]}
{"total":54452,"page":18,"pagesize":100,"questions":[{"tags":["sql-server","sql-server-2008","reporting-services","reportingservices-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":337,"score":0,"question_id":7307369,"title":"Opening SSRS 2005 reports in SQL Server 2008","body":"<p>We have some reports created in SQL Server 2005. But Recently we converted them into 2008. But now we are not able to open the same report project in 2008. It is showing an error like this : </p>\n\n<blockquote>\n  <p>E://Projects/...Reporting.rptproj cannot be opened because its project\n  type (.rptproj) is not supported by this version of the application.\n  To open it, please use a version that supports this type of projects.</p>\n</blockquote>\n\n<p>We have SQL Server 2008 with SP1 is installed. we are trying to open the reports using SQL Server 2008 Business Intelligence Development Studio.</p>\n"},{"tags":["sql-server","algorithm","database-design","primary-key"],"answer_count":27,"favorite_count":26,"up_vote_count":42,"down_vote_count":0,"view_count":5576,"score":42,"question_id":404040,"title":"How do you like your primary keys?","body":"<p>In a fairly animated discussion in my team I was made to think what most people like as primary keys. We had the following groups-</p>\n\n<ol>\n<li>Int/ BigInt which autoincrement are good enough primary keys.</li>\n<li>There should be at least 3 columns that make up the primary key.</li>\n<li>Id, GUID and human readable row identifiers all should be treated differently.</li>\n</ol>\n\n<p>Whats the best approach for PKs? It would be awesome if you could justify your opinion. Is there a better approach that the above? </p>\n\n<p>EDIT: Anyone has a simple sample/algorithm to generate human readable identifiers for rows that scales well?</p>\n"},{"tags":["sql","sql-server","case","where","dateadd"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13001876,"title":"Is it possible to use values from another table as the interval in a DATEADD function?","body":"<p>I have a table of <strong>events</strong> containing a date (smalldatetime).\nI have a table of <strong>intervals</strong> (int) (days before) for when a reminder should be sent - <code>DATEADD(D, *interval*, GETDATE())</code>.</p>\n\n<p>I'm trying to write an SQL statement to get all the events where a reminder should be sent today (based on <code>GETDATE()</code> from the DATEADD function. This is instead of me first getting all the intervals and running SQL in a loop, passing each interval as a parameter into the DATEADD function.</p>\n\n<p>Any ideas how I'd do this?</p>\n\n<pre><code>**dbo.events**\nid (int) PK\ndate (smalldatetime)\ncustomerID (int)\n\n**dbo.intervals**\nid (int) PK\ndaysBefore (int)\ncustomerID (int)\n</code></pre>\n"},{"tags":["sql","sql-server","join","sum"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":13007221,"title":"SQL wrong sum when using join","body":"<p>I have this query:</p>\n\n<pre><code>SELECT     BLI.EmpID, ShortEmployees.EmpName1 AS EmpName, SUM(BLI.FinalValue) AS Total\nFROM       BLI \nINNER JOIN BSR ON BLI.BLID = BSR.BLID \nINNER JOIN ShortEmployees ON BLI.EmpID = ShortEmployees.EmpID\nWHERE     (CONVERT(varchar, BLI.BLDate, 112) &gt;= CONVERT(varchar, CONVERT(datetime, '1/10/2012', 103), 112)) \nAND (CONVERT(varchar, BLI.BLDate, 112)  &lt;= CONVERT(varchar, CONVERT(datetime, '30/10/2012', 103), 112)) \nAND (BSR.BSTID = 2) \nAND (BLI.State IN (2, 6, 8, 9, 10, 12, 18))\nGROUP BY BLI.EmpID, ShortEmployees.EmpName1\nORDER BY Total DESC\n</code></pre>\n\n<p>I'm expecting the Total to be 42 but I get it triplicated 126!</p>\n\n<p>EDIT: \nMy expectations are wrong, the query returns the right sum.</p>\n"},{"tags":["sql-server","reporting-services"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":4370,"score":3,"question_id":480537,"title":"Reporting Services - Convert 2008 Report Format to the 2005 Format","body":"<p>Is there any way to convert the 2008 Report format back to a 2005 format?\nI don't think I got prompted about my upgrading my reports and now I think they are in the new format. Any way to save my changes and go back a version?</p>\n"},{"tags":["sql","sql-server","tsql","stored-procedures"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":138,"score":1,"question_id":13012200,"title":"How do I loop through a temp table in a stored procedure with no pk","body":"<p><strong>Problem:</strong></p>\n\n<p>I need to loop through the records in one table, pulling the employee number and comparing this employee number against another table to see if they're still active employees. If they are no longer active employees I need to pass the data from this row into another stored proc.</p>\n\n<p><strong>Research:</strong></p>\n\n<p>I've googled around quite a bit and realize that I shouldn't use cursors for this. I did however, find the following examples:</p>\n\n<ol>\n<li><a href=\"http://ask.sqlservercentral.com/questions/7969/loop-through-records-in-a-temporary-table.html\" rel=\"nofollow\">http://ask.sqlservercentral.com/questions/7969/loop-through-records-in-a-temporary-table.html</a></li>\n<li><a href=\"http://eedle.com/2010/11/11/looping-through-records-in-sql-server-stored-procedure/\" rel=\"nofollow\">http://eedle.com/2010/11/11/looping-through-records-in-sql-server-stored-procedure/</a></li>\n</ol>\n\n<p>However, it seems like they use a pk to loop through the records. Employee numbers can be the same for multiple recods in my scenario </p>\n\n<p><strong>Questions:</strong></p>\n\n<ol>\n<li>Is it possible to achieve what I'm attempting without cursors?</li>\n<li>If it is possible, how would I go about fetching each row with a non unique column?</li>\n</ol>\n"},{"tags":["sql-server","query","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13011900,"title":"Need help to get records of current date?","body":"<p>I am trying to write Stored Procedure for getting records for current date, but I am not able to do so. I have created one for record display with latest first &amp; trying to modify the same </p>\n\n<p>Here is the code of same:-</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE PROCEDURE [dbo].[SP_SELECTTODAYRECORDS_Test]\nAS\nBEGIN \n    SELECT col_Source as 'country', \n    col_FirstName +' '+col_LastName as 'name',\n    description as 'state' ,\n    col_county\n    from tbl_Info_Test, tbl_CountySite \n    where col_Pic is not null\n    and col_Source = sourcecountry\n    and ISDATE(col_BookDate) = 1\n    order by CONVERT(datetime, col_BookDate) DESC\nEND\n</code></pre>\n\n<p>Could you please help me out to modify the same. thanks in advance.</p>\n"},{"tags":["sql","sql-server","primary-key","sybase","unique-index"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13012408,"title":"Sybase unique index and primary key","body":"<p>Is possible to add a primary key in a table that already have a unique nonclustered index?</p>\n\n<p>I have a table cargo_car and i need to define cd_cargo_car as a PK. </p>\n\n<p>I tried this:</p>\n\n<pre><code>ALTER TABLE dbo.cargo_car ADD PRIMARY KEY (cd_cargo_car)\n</code></pre>\n\n<p>but i received the error:</p>\n\n<pre><code>Error (1921) An index with the same columns inthe same order alredy exists onthe table\n</code></pre>\n\n<p>This table has many dependences and when i try to drop the index I receive:</p>\n\n<pre><code>Error (3712) Cannot drop index 'cargo_car.XPKcargo_car' because it still has referential integrity constraints.\n</code></pre>\n\n<p>This is the Create script:</p>\n\n<pre><code>CREATE TABLE dbo.cargo_car\n    (\n    cd_cargo_car      SMALLINT NOT NULL,\n    nm_cargo_car      VARCHAR (40) NOT NULL,\n    cd_refini_car     CHAR (4) NOT NULL,\n    cd_reffin_car     CHAR (4) NOT NULL,\n    cd_jornada1_car   CHAR (2) NOT NULL,\n    cd_jornada2_car   CHAR (2) NOT NULL\n\n    )\nGO\n\nCREATE UNIQUE NONCLUSTERED INDEX XPKcargo_car\n    ON dbo.cargo_car  (cd_cargo_car)\nGO\n</code></pre>\n\n<p>Suggestion on how to do this?</p>\n\n<p>Tks</p>\n"},{"tags":["c#",".net","sql-server","linq","sqldatareader"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":13011808,"title":"Does LINQ load all items from SQL Server into memory or chunks only?","body":"<p>I am wondering hoq the LINQ and SqlDataProvider manages to itearate through a  WHOLE table.</p>\n\n<p><strong>For the example below,</strong></p>\n\n<ul>\n<li><p>Are the whole foo items LOADED into the MEMORY at ONCE and CLR\niterates through the foo items in the memory?</p></li>\n<li><p>Or the foo items are loaded from SQL Server in chunks?</p></li>\n<li><p>Or they are LOADED from the SQL SERVER into the MEMORT only ONE foo\nat a time?</p></li>\n<li><p>Or ?</p></li>\n</ul>\n\n<p>&nbsp;</p>\n\n<pre><code>using (var context = new FooEntities())\n{\n    var allItems = from foo in context.Foos\n                   select foo;      \n\n    // Are all foos LOADED into the MEMORY at once?\n    // Or they come from SQL SERVER in chunks?\n    foreach (f in foos)\n        Console.WriteLine(f.ID);\n}\n</code></pre>\n"},{"tags":["php","sql-server","transactions","pdo"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12969221,"title":"pdo driver does not suport transactions on linux","body":"<p>I've been using the DBLib PDO driver for connecting my PHP Symfony project with the MsSQL Database (where I need to query only 2 tables, Propel is set to connect with the MySQL database, which is main)</p>\n\n<p>Unfortunately, I encountered problem, when a need to use transaction occured.</p>\n\n<p>the following code </p>\n\n<pre><code>$pdo = new PDO('dblib:host=IP;dbname=DBNAME', 'login', 'password');\n$pdo -&gt; setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n$pdo -&gt; beginTransaction();\n$sql = \"INSERT INTO DBNAME (Fields) VALUES (Values) \";\n$query = $pdo -&gt; prepare($sql);\n$query -&gt; execute();\n$sql = \"SELECT Field FROM DBNAME\";\n$query = $pdo -&gt; prepare($sql);\n$query -&gt; execute();\n$dane1 = $query -&gt; fetchAll();\n$pdo -&gt; rollBack();\n$sql = \"SELECT Field FROM DBNAME\";\n$query = $pdo -&gt; prepare($sql);\n$query -&gt; execute();\n$dane2 = $query -&gt; fetchAll();\n</code></pre>\n\n<p>I get such an error:</p>\n\n<pre><code>PDOException Object ( [message:protected] =&gt; This driver doesn't support transactions [string:Exception:private] =&gt; [code:protected] =&gt; 0 \n</code></pre>\n\n<p>I've been looking for any other driver that would support the transaction, but unfortunately, i Couldn't find anything except <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=20098\" rel=\"nofollow\">Microsoft Drivers 3.0 for PHP for SQL Server</a>, which doesn't apply to my issue, because my project is working on LAMP environment</p>\n"},{"tags":["sql","sql-server","database","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":7,"view_count":102,"score":-7,"question_id":13005484,"title":"Find missing number in table in SQL Server 2005","body":"<p>I have int datatype  column as No, and want to find those No number which are missing in table.</p>\n\n<p>For example: 1,2,3,7,8,9</p>\n\n<p>Ans = 4,5,6</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","tsql","daterange"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12962604,"title":"time range and date range in TSQL","body":"<p>I want to write a procedure in TSQL that calculates peak times between given date ranges that splitted to time given.</p>\n\n<pre><code>Start time: 10-02-2012 10:00\nEnd time  : 10-02 2012 11:00\ntime range: every 5 minutes\n</code></pre>\n\n<p>so it will be:</p>\n\n<pre><code>10:00 range 1  -&gt; 5 peak times\n10:05 range 2  -&gt; 11 peak times\n.\n.\n.\n11:00 range 11 -&gt; 7 peak times\n</code></pre>\n\n<p>when time range given 30 min then the code will calculate 2 ranges</p>\n\n<p>Should I use Interval? How can i solve this problem? Any Help?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","closures"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":68,"score":2,"question_id":13004825,"title":"Calculate number of cluster when i know about point in each cluster in sql","body":"<p>I'm trying to calculate number of cluster when I know all members of each cluster.</p>\n\n<p>I need a function in SqlServer2008 to solve this problem.</p>\n\n<p>My table has more than 14 million distinct records like this:</p>\n\n<pre><code>CREATE TABLE Test\n(\n   F1 varchar(5),\n   F2 varchar(5)\n)\nINSERT INTO TEST ( F1, F2) VALUES ( 'A', 'B')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'A', 'K')\nINSERT INTO TEST ( F1, F2) VALUES ( 'C', 'H')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'D', 'B')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'F', 'I')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'F', 'B')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'D', 'H' )\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'E', 'G' )\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'G', 'L' )\n</code></pre>\n\n<p>note that:</p>\n\n<pre><code>If A=B AND A=K THEN B=K \nIF E=G AND G=L THEN E=L\n</code></pre>\n\n<p>Now the output of the function should be as below:</p>\n\n<pre><code>ClusterNumber--- point\n1---A\n1---B\n1---k\n1---D\n1---F\n1---I\n1---H\n1---C\n2---E\n2---G\n2---L\n</code></pre>\n\n<p>I guess the solution would be a recursive function, but does not know it!</p>\n"},{"tags":["sql-server","installation","sql-server-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13010612,"title":"Couldn't install SQL Server 2012 on machine with Windows 7 SP1, VS 2010 SP1","body":"<p>I am trying to install SQL Server 2012 RTM on my pc, I have installed Windows 7 SP1, VS 2010 SP1 but it again and again giving this error:</p>\n\n<blockquote>\n  <p><em>A network error occurred while attempting to read from the file:</em><br>\n  D:\\Microsoft SQL Server 2012\n   RTM\\1033_ENU_LP\\x64\\setup\\x64\\sqlncli1.msi<br>\n  Error help link:<br>\n  <a href=\"http://go.microsoft.com/fwlink?LinkId=20476&amp;ProdName=Microsoft+SQL+Server&amp;EvtSrc=setup.rll&amp;EvtID=50000&amp;ProdVer=11.0.2100.60&amp;EvtType=sqlncli.msi%40PublishProduct%401316\" rel=\"nofollow\">http://go.microsoft.com/fwlink?LinkId=20476&amp;ProdName=Microsoft+SQL+Server&amp;EvtSrc=setup.rll&amp;EvtID=50000&amp;ProdVer=11.0.2100.60&amp;EvtType=sqlncli.msi%40PublishProduct%401316</a></p>\n</blockquote>\n\n<p>When I go to the Microsoft link I find </p>\n\n<blockquote>\n  <p>We're sorry<br>\n  There is no additional information about this issue in the\n  Error and Event Log Messages or Knowledge Base databases at this time.\n  You can use the links in the Support area to determine whether any\n  additional information might be available elsewhere.</p>\n</blockquote>\n\n<p>How can resolve this, at first i thought adding current user in Display Replay controller making the problem, then uninstalled everything and again tried installing but couldn't succeed. Can anyone suggest what may be causing these problem and possible resolve for it. \nI have also SQL Server 2008 R2 installed which I want to keep simultaneously with 2012  </p>\n"},{"tags":["sql","sql-server","tsql","stored-procedures","query-optimization"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":13010328,"title":"TSQL Number of reads significantly different after query and stored procedure execution","body":"<p>After query optimization I got results that are ok and I wanted to alter stored procedure, but got much worst results after SP execution, than it was after query execution! </p>\n\n<p>Firstly, I think at number of reads. What can be reason for so different results? </p>\n\n<p>Query is identical like in SP, only difference is that in query I declared parameter, but in SP that was input parameter. Value that is set to parameter is also same. To avoid 'recorded data' first I recompiled SP and after that done DROP and CREATE, but results were also much different.</p>\n\n<p>Query is like this (table and column names are changed because of simplification, and number of columns is reduced):</p>\n\n<pre><code>DECLARE @Var1 varchar(20)    \nSET @Var1 = @Var1 + '%'       \n\nDECLARE @Var2 TIMESTAMP    \nSELECT @Var2 = CONVERT(TIMESTAMP, ID, 0)    \nFROM    \n X_TIMESTAMPS (NOLOCK)    \nWHERE    \n TABLE = 'T1'     \n\n\ndeclare @Var3 varbinary(8)    \nSELECT @Var3 = max(IdTimeStamps)    \nFROM    \n T1 (NOLOCK)     \n\nSELECT o.c1  \n  , o.c2   \n  , o.c3    \n  , v.c4    \n  , v.c5   \n  , p.c6    \n  , p.c7    \n  , va.c8    \n  , isnull(s.c9, '') AS c9    \n  , CASE o.c10    \n     WHEN 1 THEN    \n      0    \n     ELSE    \n      1    \n    END c10   \n  , o.c11    \nFROM    \n T1 o (NOLOCK)    \n JOIN T2 p (NOLOCK)    \n  ON o.c1 = p.c12    \n JOIN T3 i (NOLOCK)    \n  ON (o.c13 = i.c14)    \n JOIN T4 v (NOLOCK)    \n  ON (v.c4 = i.c15)    \n LEFT JOIN T5 s (NOLOCK)    \n  ON (o.c16 = s.c17)    \n JOIN T6 va (NOLOCK)    \n  ON o.c11 = va.c18    \nWHERE    \n o.c1 LIKE @Var1    \n AND o.c2 &gt; @Var2 \n</code></pre>\n\n<p>And procedure is like this:</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[SP1] @Var1 varchar(20) ='' \nWITH RECOMPILE  \nAS        \nBEGIN\n\n    PREVIOUS QUERY WITHOUT DECLARATION FOR @Var1\n\nEND\n</code></pre>\n\n<p>TnX in advance!</p>\n\n<p>Nemanja</p>\n"},{"tags":["java","sql-server","java-ee","tomcat7"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13005460,"title":"The method executeQuery() cannot take arguments on a PreparedStatement or CallableStatement. Error","body":"<p>I am having this kind of error when trying to connect and retrieve data from my database.</p>\n\n<p>The method executeQuery() cannot take arguments on a PreparedStatement or CallableStatement.</p>\n\n<p>My code goes like this.</p>\n\n<pre><code>String search = request.getParameter(\"searchstudent\");\nout.println(search);\n\nString connectionURL = \"jdbc:sqlserver://localhost:1433;databaseName=Chingdb;   integratedSecurity=true;\";\n Connection connection = null;\n PreparedStatement pstatement = null;\n Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");\n ResultSet rs = null;\nint updateQuery = 0;\n\n\nif(request.getParameter(\"editstudent\")!= null){ \n    try {           \n     connection = DriverManager.getConnection(connectionURL, \"root\", \"root\");\n     String queryString = \"SELECT P_ID, lname, fname, mname FROM stu_info Where lname = ?\";\n     pstatement = connection.prepareStatement(queryString);\n     pstatement.setString(1, search);\n     rs = pstatement.executeQuery(queryString);\n        updateQuery = pstatement.executeUpdate();\n        %&gt;\n        &lt;TABLE cellpadding=\"15\" border=\"1\" style=\"background-color: #ffffcc;\"&gt;\n        &lt;%\n        while (rs.next()) {\n        %&gt;\n        &lt;TR&gt;\n        &lt;TD&gt;&lt;%=rs.getInt(1)%&gt;&lt;/TD&gt;\n        &lt;TD&gt;&lt;%=rs.getString(2)%&gt;&lt;/TD&gt;\n        &lt;TD&gt;&lt;%=rs.getString(3)%&gt;&lt;/TD&gt;\n        &lt;TD&gt;&lt;%=rs.getString(4)%&gt;&lt;/TD&gt;\n        &lt;/TR&gt;&lt;/TABLE&gt;\n        &lt;% \n\n        rs.close();\n        pstatement.close();\n        connection.close();\n\n        }\n        }\n\n    catch(Exception e){\n    out.println(e);\n    }\n\n   }\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","cursor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12999239,"title":"Quering current cursor row - without selecting into variables","body":"<p>I'm using a cursor to iterate through dynamic SQL query result set. I'm fully aware that both cursors and dynamic SQL are dubious methods which best be avoided. Please do not address this topics.</p>\n\n<p>I'm fetching entire row in each iteration (and not several columns into corresponding variables). Why? because later on I need to address a dynamically changing column names. But again - that is not the matter on hand.</p>\n\n<p>Is there a way to query the current row? I have failed to do so, so far. For example, this pseudo-code \"supposed\" to do the job (return the <code>ABCD</code> column value for the current row).</p>\n\n<pre><code>SELECT [ABCD] FROM Rows_CURSOR\n</code></pre>\n\n<p>I would appreciate any useful suggestions [just saying \"do not use cursors\" is not a useful comment ;) ].</p>\n\n<p>Thank you in advance.</p>\n"},{"tags":["php","sql-server","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13009724,"title":"TSQL Execute result different in PHP and SSManagement Studio","body":"<p>I'm querying a MSSQL Procedure from PHP and SSManagement Studio and the result is different??</p>\n\n<p>This query is getting the fields starting by tKey from the table. Two columns tKey1 and tKey2 exists</p>\n\n<p>Procedure <code>sp_myProc</code></p>\n\n<pre><code>DECLARE @tKeys VARCHAR(100);\n\nSELECT @tKeys = ISNULL(@tKeys + ',', '') + column_name\nFROM   testweberp.INFORMATION_SCHEMA.columns\nWHERE  table_name = myTable\n       AND LEFT(column_name, 4) = 'tKey'\nORDER  BY ordinal_position;\n\nSELECT @tKeys \n</code></pre>\n\n<p>When I execute the query from SSMS, exec sp_myProc, i get the result: <code>tKey1,tKey2</code></p>\n\n<p>When I execute the query from php, <code>mssql_query(\"exec sp_myProc\",$link)</code>, I get the result: <code>,tKey1,tKey2</code></p>\n\n<p>Yes, there is an extra comma in the result sent to php\nAnd it is not produced by php, because if instead of <code>@tKeys</code>, I return the <code>len(@tKeys)</code>, it is <code>11</code> in SSMS and <code>12</code> in php?</p>\n"},{"tags":["sql-server","sql-server-2005","iis7","asp-classic","adodb"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":103,"score":1,"question_id":12988879,"title":"Error with classic asp database connection after migration of website from IIS6 to IIS7","body":"<p>I have a classic asp site which has the following database connection:</p>\n\n<pre><code>&lt;%\nset objConnection = Server.CreateObject(\"ADODB.Connection\")\nobjConnection.ConnectionString = \"Driver={SQL Server};Server=123.456.789.012;Database=mydatabase;Uid=myuser;Pwd=123xyz;\"\nobjConnection.Open\n%&gt;\n</code></pre>\n\n<p>The site has just been moved from a Windows 2003 server running IIS6 to a Windows 2008 server running IIS7 (both using MSSQL 2005 Express database) and it now gives an error message:</p>\n\n<pre><code>Microsoft OLE DB Provider for ODBC Drivers error '80004005'\n[Microsoft][ODBC SQL Server Driver][DBNETLIB]Invalid connection.\n/inc/dbconnection.asp, line 4 \n</code></pre>\n\n<p>I'm assuming it's because there's a different driver with IIS7?  What would be the updated connection string to get this to work - I've googled and just not found anything that works or makes sense to me (I'm at the edge of my understanding here to be honest!)?</p>\n\n<p>Many thanks for any pointers folks...</p>\n"},{"tags":["c#","asp.net","sql-server","gridview"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2072,"score":1,"question_id":2192118,"title":"Gridview Refresh Problem","body":"<p>I have a gridview in an asp.net page, and get the data by binding it to a SQL Server Table, I use C# and Stored Procedure in SQL server to bind the data. every thing works fine,except when I Delete multiple rows by using Stored Procedure, the gridview still shows the old data. actually I have couple of text boxes that the user can enter the data and an asp button,as soon as user click the button, in code behind I call the Stored procedure and delete the data.</p>\n\n<p>How could I Reload / Refresh the page? after deleting the rows?</p>\n\n<p>Thanks in advance </p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13009152,"title":"Search string which contains specail characters(!,@,#./,comma(,))","body":"<p>I have a column in DB where it may contain data with special characters.\nfor ex:a column,Name may have data as following\nsantosh's\nsantosh/s\nsantosh%s</p>\n\n<p>How to search for these values in DB using like operator.</p>\n\n<pre><code>Select * from table where name like '%santosh%';\n</code></pre>\n\n<p>How to change the above query to search for apostrophe(santosh's) </p>\n"},{"tags":["sql","sql-server","sql-server-2008","gis","geospatial"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12965191,"title":"ST_PointN to get Points from Geometry Column","body":"<p>I have a Shapefile from which I am extracting Geometry column and storing it into Table.\nThis is sample data stored in Geometry column which has 432 points.</p>\n\n<blockquote>\n  <p>0x000000000104AC010000AB3E57ABBBC4384127A08938705B57414F401361C3C43841C9E53F846C5B574190A0F8E1F6C438410F0BB5766E....</p>\n</blockquote>\n\n<p>Now I want to extract each and Every point i.e. 432 points from the Geometry column and store it into another table. For that I am using <code>ST_PointN</code> column but it only gives me 1 point at a time. <code>ST_NumPoint</code> will give me 432 number but not all the points.</p>\n\n<p>How do I extract each and every point from Geometry column and store it into DB?</p>\n\n<p>Cheers,</p>\n"},{"tags":["sql-server","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":69,"score":4,"question_id":12982702,"title":"Slow performance for package with XML destination column","body":"<p>I have done several SSIS packages over the past few months to move data from a legacy database to a SQL Server database. It normally takes 10-20 minutes to process around 5 millions of records depending on the transformation.</p>\n\n<p>The issue I am experiencing with one of my package is a very poor performance because one of the columns in my destination is of the SQL Server XML data type. </p>\n\n<pre><code> Data comes in like this: 5\n A script creates a Unicode string like this: &lt;XmlData&gt;&lt;Value&gt;5&lt;/Value&gt;&lt;/XmlData&gt;\n Destination is simply a column with XML data type\n</code></pre>\n\n<p>This is really slow. Any advice?\nI did a SQL Trace and notice that in behind the scene SSIS is executing on each row a convert before the insert:</p>\n\n<pre><code> declare @p as xml\n set @p=convert(xml,N'&lt;XmlData&gt;&lt;Value&gt;5&lt;/Value&gt;&lt;/XmlData&gt;')\n</code></pre>\n"},{"tags":["sql-server","design-patterns","import"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":41,"score":-1,"question_id":13006674,"title":"Export data from Excel, CSV, SQL to SQL Server","body":"<p>I have to export the data from Excel or SQL  or some other formats into SQL Server.</p>\n\n<ol>\n<li>I'm trying to use factory pattern to create a database connection with Excel or SQL data source</li>\n<li>I'm planning to use adapter pattern to change the source data object to target object. My single row in excel can represent multiple rows in database.</li>\n</ol>\n\n<p>I have very hard time with this can somebody provide me the code or just a high level class diagramm</p>\n"},{"tags":["asp.net","sql-server","c#-4.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":39,"score":-3,"question_id":13008390,"title":"I want to create a search using like keyword in sql select command","body":"<pre><code>  public string[] SelectJournal1(string prefixText)\n        {\n\n            if (prefixText == \"AJO\" || prefixText == \"ajo\") { prefixText = \"AMERICAN JOURNAL OF\"; }\n            else if (prefixText == \"BJO\" || prefixText == \"bjo\") { prefixText = \"BRITISH JOURNAL OF\"; }\n            else if (prefixText == \"IJO\" || prefixText == \"ijo\") { prefixText = \"INTERNATIONAL JOURNAL OF\"; }\n            else if (prefixText == \"JO\" || prefixText == \"jo\") { prefixText = \"JOURNAL OF\"; }\n            else if (prefixText == \"EJO\" || prefixText == \"ejo\") { prefixText = \"EUROPEAN JOURNAL OF\"; }\n\n            DataSet dtst = new DataSet();\n            SqlConnection sqlCon = new SqlConnection(ConfigurationManager.AppSettings[\"ConnectionString\"]);\n            string strSql = \"select (JournalName  +'('+cast(PK as varchar(8))+')' ) as JournalName from dbo.Tbl_ILSM_JournalReg where JournalName like '\" + prefixText + \"%' \";\n            SqlCommand sqlComd = new SqlCommand(strSql, sqlCon);\n            sqlCon.Open();\n            SqlDataAdapter sqlAdpt = new SqlDataAdapter();\n            sqlAdpt.SelectCommand = sqlComd;\n            sqlAdpt.Fill(dtst);\n            string[] cntName = new string[dtst.Tables[0].Rows.Count];\n            int i = 0;\n            try\n            {\n                foreach (DataRow rdr in dtst.Tables[0].Rows)\n                {\n                    cntName.SetValue(rdr[\"JournalName\"].ToString(), i);\n                    i++;\n                }\n            }\n            catch { }\n            finally\n            {\n                sqlCon.Close();\n            }\n            return cntName;\n        }\n</code></pre>\n\n<blockquote>\n  <p>here i want to seach ajo as american journal of. It work fine but now\n  i want to explore it like ajo de search as american journal of de.\n  would you suggest me.</p>\n</blockquote>\n"},{"tags":["php","sql-server","utf-8","character-encoding","iso-8859-1"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13007825,"title":"SQL server uft8 connection","body":"<p>I'm using SQL server with an intranet application written in PHP. For convenience i want to use UTF8 charset for web pages (jquery supports only utf8) however all data stored in my sqlserver db is in iso-8859-1.\nCan I change just the data CONNECTION CHARSET (not data store charset) between sqlserver and PHP? Maybe just with a query header?</p>\n\n<p>Thank you.</p>\n"},{"tags":["c#",".net","sql-server","datetime","time"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":98,"score":0,"question_id":13007390,"title":"String value of 1 day in SQL Server","body":"<p>I need string value of 1 day</p>\n\n<p>\"23:59:59\" is working but cause delays</p>\n\n<p>\"24:00:00\" is not working : Error converting data type varchar to datetime.</p>\n\n<p>\"1.00:00:00\" is not working : Error converting data type varchar to datetime.</p>\n\n<p>here is my code:</p>\n\n<pre><code> PROCEDURE [dbo].[Procedure1] \n\n    @Start datetime, \n    @Finish datetime,\n    @TimeRange datetime\nAS\nBEGIN\n\n    SET NOCOUNT ON;\n\n    declare @TimeRanges as TABLE (SessionStart datetime, SessionEnd datetime);\n\n     with TimeRanges as (\n  select @Start as StartTime, @Start + @TimeRange as EndTime\n  union all\n  select StartTime + @TimeRange, EndTime + @TimeRange\n    from TimeRanges\n    where EndTime &lt; @Finish )\n  select StartTime, EndTime, Count( Test.ScenarioID ) as TotalPeaks\n    from TimeRanges as TR left outer join\n      dbo.Test as Test on TR.StartTime &lt;= Test.SessionStartTime and Test.SessionCloseTime &lt; TR.EndTime\n    group by TR.StartTime, TR.EndTime   \nEND\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":13007830,"title":"How to create a procedure in SQL server that does not allow to alter a particular column of a table?","body":"<p>I want to create a procedure that don't allow me to alter a column of a table.</p>\n\n<p>I have already create a procedure that does not allow me to alter anything in a particular table but now I want to be specific to a particular column.</p>\n\n<p>So now I don't want to be rolling back in case of table alter instead i want to roll back if alter is made to particular column of table.</p>\n"},{"tags":["sql-server","ssis","sql-azure"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13000235,"title":"SQL Import and Export Wizard to SQL Azure DB failing","body":"<p>I'm trying to move data and schema from a hosted SQL Server 2008 instance to a SQL Azure DB and I'm using the SQL Import and Export Wizard in SQL Management Studio.</p>\n\n<p>It almost works, but I get an error:</p>\n\n<p><code>Tables without a clustered index are not supported in this version of SQL Server. Please create a clustered index and try again.</code></p>\n\n<p>This makes no sense, as I have clustered indexes on all my tables. I did see this Q&amp;A on SO but if I switched to <strong>.Net Framework Data Provider for SqlServer</strong> I get a different error:</p>\n\n<p><code>Cannot get the supported data types from the</code>, which is the very problem that A is supposed to solve.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":13006091,"title":"I need to combine multiple rows from a subquery into a string separated by a space","body":"<p>I'm creating an image gallery with albums. The gallery owner can first create one or more albums, and then create images to add to those albums. I'm having to use multiple view templates to pull this off. Regardless, here's what is hanging me up. Here is the core of my stored procedure:</p>\n\n<pre><code>DECLARE @MyString VARCHAR(MAX)\n\nSELECT @MyString = ISNULL(@MyString + ' ', ' ') + CAST(AlbumID AS VARCHAR(10)) + ' '\nFROM BD_AlbumGallery\nWHERE ImageID = PROBLEM HERE... Dont know what to do &lt;---\nORDER BY AlbumID\n\nSELECT a.[ImageID]\n      ,a.ImageFile\n      ,a.[ImageTitle]\n      ,a.[ImageCaption]\n      ,a.[Description]\n      ,a.[Active]\n      ,b.[AlbumID]\n      ,b.[ImageID]\n      ,c.[ListingID]\n      ,c.[Active]\n      ,c.[LevelID]\n      ,c.[Title]\n\n      ,@MyString AS AlbumClass\n\nFROM BD_Gallery A\nJOIN BD_AlbumGallery B\nON a.ImageID = b.ImageID\nJOIN BD_Listing C\nON a.ListingID = c.ListingID\nWHERE a.ListingID = @passedListingID\n  AND a.Active = 1\n  AND c.Active = 1\n  AND c.LevelID &gt; 5\n</code></pre>\n\n<p>So the problem is, the data is retrieved within a LI\nand one at a time of course... guess that's the obvious... to display properly in my gallery template.</p>\n\n<p>The only issue I'm having is I need the @MyString AS AlbumClass to be tied to a.ImageID, or b.ImageID, as they are the same.</p>\n\n<p>The reason is, the albums in the template are defined by a class.</p>\n\n<pre><code>&lt;li class=\"12 24 15 17\"&gt;Rest of my code for a single image result&lt;/li&gt;\n</code></pre>\n\n<p>So the AlbumID's being utilized as class names allows me to assign them to the jQuery dropdown category/album list that's in a template right before this one. I was thinking of a SubQuery. Ultimately, I need the results (for other reasons) to display in one result set.</p>\n\n<p>Please help.. Still trying to push my way through the learning curves.</p>\n\n<p>Thanks!</p>\n\n<ul>\n<li>Patrick</li>\n</ul>\n"},{"tags":["c#","sql-server","datetimepicker"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13006653,"title":"Displaying the time from database in a DateTimePicker","body":"<p>I have a column (datatype is <code>time(7)</code>) in my SQL Server database to store the time. When I try to retrieve that value from the database and display it in a <code>DateTimePicker</code> (format set to display time only), it throws an <code>InvalidCastException</code> error. </p>\n\n<p>This is the line where the casting happens.</p>\n\n<pre><code>r = com.ExecuteReader();\ndtpOutTime.Value = (DateTime)r[\"OutTime\"];\n</code></pre>\n\n<p>I can understand why the error is thrown but I can't figure out a way to correct it.</p>\n\n<p>How can I display only the time from database in a <code>DateTimePicker</code>?</p>\n\n<p>Thank you.</p>\n"},{"tags":["c#","sql-server","vb.net","datepicker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13006355,"title":"Datetime insert in sql shows error when having date as a foreign language","body":"<p>I have made a small application where i save students data. I installed it on my PC and it worked just fine.</p>\n\n<p>I gave it to one of my friend to install it on his system, however his windows is in German language, he installed the software perfectly, but when he was trying to store the data he got the error for date field.</p>\n\n<p>What he explained me on the phone that it was a language error as when i was storing the data on my computer which is in English language, date time appeared like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/93RaR.jpg\" alt=\"enter image description here\"></p>\n\n<p>Now when he installed my app on his computer the <code>Date of birth</code> field was in German Language and so he got an error while mssql insert query.</p>\n\n<p>My question is how to force the application to use the Date time in just English language as a System time and not that the client language date time?</p>\n\n<p>I am using sqlServerCe</p>\n\n<p><strong>EDIT</strong></p>\n\n<pre><code>QueryGrid(\"INSERT INTO students (p_num, p_name, p_fname, p_dob, p_street, p_zip, p_phone, p_email, p_sex, p_comment, p_fax, p_pic, p_regdate, p_idc) VALUES('\" + p_num.Text + \"', '\" + p_name.Text + \"', '\" + p_fname.Text + \"', '\" + p_dob.Value + \"', '\" + p_street.Text + \"', '\" + p_zip.Text + \"', '\" + p_pno.Text + \"', '\" + p_email.Text + \"', '\" + gender + \"', '\" + comment_box.Text + \"', '\" + p_fno.Text + \"', '\" + p_num.Text + \"', '\" + DateTime.Now + \"', '\" + p_idc.Text + \"')\")\nMessageBox.Show(\"Student successfully added in database.\")\n</code></pre>\n\n<p>Now in above code <code>p_dob.Value</code> is my date value. and when i use it on my computer it converts the above <code>Monday, October 22, 2012</code> to <code>10/22/2012 11:31 AM</code> and saves into database, now on my friends system its in German language, so its unable to convert and save.</p>\n"},{"tags":["sql-server","asciiencoding"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13006180,"title":"Searching for extended ascii in SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12972174/extended-ascii-characters-search-in-sql-server\">Extended ascii characters search in SQL Server</a>  </p>\n</blockquote>\n\n\n\n<p>I have table in SQL Server where data may be stored with extended charcaters (<code>,,...</code>) in one of the column.</p>\n\n<p>From my .net database layer, the string is passed in encoded format to the database.</p>\n\n<p>There is column <code>Name</code> in the DB and has value <code>santosh</code>.</p>\n\n<p>Now from my .net code, I will pass <code>'santosh'</code> as '%E2%99%A5' (encoded value for <code>santosh</code>).\nSo now DB has to search for <code>santosh</code> in the column <code>Name</code> by using <code>'%E2%99%A5'</code> string.</p>\n\n<p>For ex:</p>\n\n<pre><code>select * from table where Name='%E2%99%A5';\n</code></pre>\n\n<p>but the above query doesn't work.</p>\n\n<p>Any help?</p>\n"},{"tags":["java","sql-server","resultset","jtds"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":134,"score":0,"question_id":10761315,"title":"getdate() query via resultset throwing no current row exception","body":"<p>I have a problem here, what i wanna do is getting current date and a column from a table. Here is my code so far :</p>\n\n<pre><code>s = con.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);\nrset = s.executeQuery(\"select getdate() as date, tglpengiriman from orders\");\njava.sql.Date date = rset.getDate(\"date\");\njava.sql.Date tglkirim = rset.getDate(\"tglpengiriman\"); \n</code></pre>\n\n<p>And throwing exception \"no current row in ResultSet\" in line 3 of my code above.\nWhat's wrong with my code? Missunderstanding usage of ResultSet, maybe?</p>\n\n<p>Thanks for any answer...</p>\n\n<p>EDIT:\nanswered. Please see post from @Christopher below. Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":37,"score":-1,"question_id":12989275,"title":"How to refactor sql subquery field in sql?","body":"<p>i want to create a sql query which must select sum subquery also make Alacak-Borc process. But i can not.\nhow to make it (Alacak-Borc As BAKIYE) and how to REFACTOR BELOW CODE? thanks...</p>\n"},{"tags":["sql","sql-server","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":13005263,"title":"Retrieve multiple pieces of data from a single SQL Server variable","body":"<p>I have two variables like: </p>\n\n<pre><code>@FieldName \n@values\n</code></pre>\n\n<p>Those two variables hold values like:</p>\n\n<ul>\n<li><code>@FieldName</code> - contains <code>[a],[b],[c],[d]</code></li>\n<li><code>@values</code> - contains <code>5,6,7,8</code></li>\n</ul>\n\n<p>Now I need to retrieve the data of column <code>'b'</code> &amp; <code>'d'</code> only.</p>\n\n<p>How can we get <code>b=6 &amp; d=8</code>? </p>\n\n<p>Thanks in advance.  </p>\n"},{"tags":["sql-server","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":13004820,"title":"SQL Server 2008 R2 devide by zero bug","body":"<p>Please tell me if I am missing something, and if I am loosing my mind</p>\n\n<p>The below query produces a devide by zero error</p>\n\n<pre><code>DECLARE @Test TABLE(\n        ID INT,\n        Val FLOAT\n)\n\nINSERT INTO @Test SELECT 1, 0\n\n;WITH   Grouped AS (\n        SELECT  ID,\n                Val,\n                SUM(Val) OVER (PARTITION BY ID) TotalVal\n        FROM    @Test\n)\n, Filtered AS (\n        SELECT  *\n        FROM    Grouped\n        WHERE   TotalVal != 0\n)\nSELECT  *\nFROM    Filtered\nWHERE   Val / TotalVal &gt; 0.05\n</code></pre>\n\n<h2><a href=\"http://www.sqlfiddle.com/#!3/d41d8/5444\" rel=\"nofollow\">SQL Fiddle DEMO</a></h2>\n\n<p>Where as the below does not produce the same error</p>\n\n<pre><code>DECLARE @Test TABLE(\n        ID INT,\n        Val FLOAT\n)\n\nINSERT INTO @Test SELECT 1, 0\n\n;WITH   Grouped AS (\n        SELECT  ID,\n                Val,\n                SUM(Val) OVER (PARTITION BY ID) TotalVal\n        FROM    @Test\n)\n, Filtered AS (\n        SELECT  *\n        FROM    Grouped\n        WHERE   TotalVal != 0\n)\nSELECT  *,\n        Val / TotalVal Test\nFROM    Filtered\n</code></pre>\n\n<h2><a href=\"http://www.sqlfiddle.com/#!3/d41d8/5445\" rel=\"nofollow\">SQL Fiddle DEMO</a></h2>\n\n<p>From looking at the estimated query plan, the first query tries to optimize the where clause as </p>\n\n<pre><code>[Val]/[Expr1004]&gt;(5.000000000000000e-002) AND [Expr1004]&lt;&gt;(0.000000000000000e+000)\n</code></pre>\n\n<p>where I can see that the <code>TotalVal != 0</code> is after the actual <code>devide by TotalVal</code>.</p>\n\n<p>Is this a known issue? Is there a way (other than using another temp table) to bypass this. I know I can do it using a </p>\n\n<pre><code>CASE WHEN TotalVal = 0 THEN 0 ELSE Val / TotalVal END\n</code></pre>\n\n<p>but that would defeat the purpose of the second CTE statement.</p>\n"},{"tags":["sql-server","ado.net","filestream","sqlclr"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":106,"score":2,"question_id":12986909,"title":"Accessing FILESTREAM from an SQL CLR assembly","body":"<p>I'm trying to stream FILESTREAM data from an unsafe SQL CLR assembly. </p>\n\n<p>The connection string is </p>\n\n<pre><code>Data Source=LAPTOP2\\SQLEXPRESS;Initial Catalog=test;Integrated Security=True;Enlist=False\n</code></pre>\n\n<p>When creating a new <code>SqlFileStream</code> (inside a <code>SqlTransaction</code>, of course), I'm getting: </p>\n\n<blockquote>\n  <p><em>The request is not supported</em> </p>\n</blockquote>\n\n<p>at <code>OpenSqlFilestream</code>.</p>\n\n<p>So I decided to try native <a href=\"http://msdn.microsoft.com/en-us/library/bb933972.aspx\" rel=\"nofollow\"><code>OpenSqlFilestream</code></a>, but then I'm getting an invalid handle (-1) while <code>GetLastWin32Error</code> returns that same:</p>\n\n<blockquote>\n  <p><em>The request is not supported (<code>ERROR_NOT_SUPPORTED</code>)</em>.</p>\n</blockquote>\n\n<p>I have also tried <code>SqlContext.WindowsIdentity.Impersonate()</code> with no apparent effect.</p>\n\n<p>I couldn't find any documentation referencing this restriction. Is it really unsupported? If it is unsupported, is there a good reason? Does anyone know of a workaround?</p>\n"},{"tags":["sql-server","linux","cakephp","ubuntu","debian"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":11985134,"title":"Cakephp2 on linux does not work with Sql Server (mssql)","body":"<p>I am having a hard time installing drivers for ODB Mssql. I need it to let my php communicate with an Sql server (2005).</p>\n\n<p>The driver:\n<a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=28160\" rel=\"nofollow\">http://www.microsoft.com/en-us/download/details.aspx?id=28160</a></p>\n\n<p>Does someone know a alternative solution? Or an working example?\nPlease notice I am using cakePhp version 2+. Not 1.3.. Lots of documentation about this problem has been written for 1.3.</p>\n\n<p>The driver for Mssql from MS is buggy. It needs a lot of libraries and still doesnt survive it's own installer..</p>\n\n<p>My configuration is Ubuntu 12+ (with gui), Lampp (xampp for linux).</p>\n"},{"tags":["sql-server","winforms"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":63,"score":3,"question_id":12987847,"title":"How to decrease the search time in Sql Server","body":"<p>I have created a windows form that uses SQL Server Database. The windows form contains a search grid which brings all the bank account information of a person. The search grid contains a special field \"Number of Account\" which displays the number of Accounts a person have associated with a bank. </p>\n\n<p>There are more than 100,000 records in the table from where the data is fetched. I just wanted to know how should I decrease the response time or the search time while getting the data from the table in the search grid. </p>\n\n<p>When I run the page it takes hell lot of time to get the records displayed in the search grid. Moreover, it does not get the data unless and until I provide a search criteria(To and from Date for searching)</p>\n\n<p>Is their any possible way to decrease the search time so that the data should get displayed in the grid.  </p>\n"},{"tags":["asp.net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13002529,"title":"You do not have permission to use the bulk load statement","body":"<p>Hi I'm getting the error <code>You do not have permission to use the bulk load statement.</code> when I try to execute a stored procedure.</p>\n\n<p>I've seen some websites mentioning about the bulk admin role but I don't see this role.</p>\n\n<p>I'm using sql-server 2008.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["java","sql-server","stored-procedures","try-catch","raiserror"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":94,"score":2,"question_id":12989302,"title":"java is not catching ms sql stored procedure raise error","body":"<p>I have a stored procedure in my SQL Server 2008 database and I am  devloping a java application that use a sqljdbc4 connection. Everything works fine, even procedure call, but there is one thing - in some case java does not catch raised exception throwen  by the procedures and specified when there is call like a select or update (delete insert) </p>\n\n<p>here is an exemple </p>\n\n<pre><code>AS\nBEGIN\n    DECLARE @c INT\n    SELECT @c= COUNT(nomUtilisateur) \n        FROM Utilisateur2\n    PRINT @c\n    RAISERROR(N'error message personalise',18,1)\nEND\n</code></pre>\n\n<p>in this case java catche the exception</p>\n\n<pre><code>try{\n    CallableStatement cll=con.prepareCall(\"EXEC f3 \");\n    cll.execute();\n\n    System.out.println(\"fin EXEC f3 ? \");}\ncatch (SQLException e) {\n    System.out.println(\"sqlerror state: \"+e.getSQLState() +\" |error code: \"\n        + e.getErrorCode()+\" |message: \"+e.getMessage());\n    e.printStackTrace();\n} \n</code></pre>\n\n<p>but when I use a select like this</p>\n\n<pre><code>\nALTER PROCEDURE [dbo].[f3]\nAS\nBEGIN\n    declare @c INT\n    SELECT @c= COUNT(nomUtilisateur) \n        FROM Utilisateur2\n    <b>select * from Utilisateur2</b>\n    PRINT @c\n    RAISERROR(N'error message personalise',18,1)\nEND\n</code></pre>\n\n<p>or an update, java continues excution with out catching the exception. Its like it doesn't  wait for the end of the procedure.</p>\n\n<p>So my question is, am I using the stored procedure incorrectly or is it a bug in jdbc driver or it prefer to use an out parameter and leave this strategy; i Googled this probleme without finding anything. </p>\n\n<p>Personally, I want to use the raised error </p>\n"},{"tags":["sql-server","performance","entity-framework","multi-tenant","parameter-sniffing"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":12979493,"title":"Multi-tenant SQL Server databases and parameter sniffing","body":"<p>I have a multi-tenant database in SQL Server 2012 where each tenant's rows are identified by a <code>tenant_id</code> column (aka the <a href=\"http://msdn.microsoft.com/en-us/library/aa479086.aspx\" rel=\"nofollow\">Shared Database, Shared Schema</a> approach). Some tenants, particularly the newer ones, have very few rows, while others have many.</p>\n\n<p>SQL Server's query optimizer normally builds a query plan based on the parameters provided during its first execution, then re-uses this plan for all future queries even if different parameters are provided. This is known as <a href=\"http://www.sommarskog.se/query-plan-mysteries.html\" rel=\"nofollow\">parameter sniffing</a>.</p>\n\n<p>The problem we have with our database is that SQL Server sometimes builds these plans based on parameters that point to a smaller tenant, which works fine for that tenant, but then when it reapplies the cached plan to a larger tenant it fails catastrophically (usually timing out, in fact). Typically we find out about this situation only when one of our larger tenants contacts us about experiencing time-out errors, then we have to get into the system and manually flush all the query plans to correct it.</p>\n\n<p>There is a query hint you can use to prevent SQL Server from caching query plans (<a href=\"http://www.benjaminnevarez.com/2010/06/how-optimize-for-unknown-works/\" rel=\"nofollow\"><code>OPTIMIZE FOR UNKNOWN</code></a>) but this results in some extra overhead since the query plan is being regenerated every time the query is called. An additional problem is that we're using Entity Framework which offers no ability to specify the <code>OPTIMIZE FOR UNKNOWN</code> hint on queries.</p>\n\n<p>So the question is -- what is the best practice for multi-tenant databases with regard to parameter sniffing? Is there a way to disable parameter sniffing database-wide without having to specify it on every query? If so, is that even the best approach? Should I be partitioning the data in some other way? Is there some other approach I'm not thinking of?</p>\n"},{"tags":["sql-server","asp.net-mvc-3","video-streaming"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":13002394,"title":"How to stream a video from Database to be shown with Html5 in Asp.Net MVC3?","body":"<p>I'm developing for showing videos and I need to save the video on Sql Server and displaying them with Html5 in my views, is it possible to do so? doea it make any diffrence with downloading files? does it cause much overhead on my server? thanks</p>\n"},{"tags":["sql","sql-server","logging","hash"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12978087,"title":"Improve Log Exceptions","body":"<p>I am planning to use <code>log4net</code> in a new web project. In my experience, I see how big the log table can get, also I notice that errors or exceptions are repeated. For instance, I just query a log table that have more than 132.000 records, and I using distinct and found that only 2.500 records are unique (~2%), the others (~98%) are just duplicates. so, I came up with this idea to improve logging.</p>\n\n<p>Having a couple of new columns: <code>counter</code> and <code>updated_dt</code>, that are updated every time try to insert same record.</p>\n\n<p>If want to track the user that cause the exception, need to create a <code>user_log</code> or log_user table, to map N-N relationship.</p>\n\n<p>Create this model may made the system slow and inefficient trying to compare all these long text... Here the trick, we should also has a <code>hash column</code> of binary of 16 or 32, that hash the message and the exception, and configure an index on it. We can use <a href=\"http://msdn.microsoft.com/en-us/library/ms174415.aspx\" rel=\"nofollow\"><code>HASHBYTES</code></a> to help us.\nI am not an expert in DB, but I think that will made the faster way to locate a similar record. And because hashing doesn't guarantee uniqueness, will help to locale those similar record much faster and later compare by message or exception directly to make sure that are unique.</p>\n\n<p>This is a theoretical/practical solution, but will it work or bring more complexity? what aspects I am leaving out or what other considerations need to have? the trigger will do the job of insert or update, but is the trigger the best way to do it?</p>\n"},{"tags":["sql","sql-server","sql-update"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12690611,"title":"Fastest way to modify each row in a table","body":"<p>What's the recommended way of updating a relatively large table (~70 million rows), in order to replace a foreign key column with an id of a <strong>different</strong> table (indirectly linked by the current key)?</p>\n\n<p>Let's say I have three tables:</p>\n\n<pre><code>Person\n  Id long,\n  Group_id long   --&gt; foreign key to Group table\n\nGroup\n  Id long\n  Device_id long  --&gt; foreign key to Device table\n\nDevice\n  Id long\n</code></pre>\n\n<p>I would like to update the <code>Person</code> table to have a direct foreign key to the <code>Device</code> table, i.e.:</p>\n\n<pre><code>Person\n  Id long,\n  Device_Id long  --&gt; foreign key to Device table\n\nDevice\n  Id long\n</code></pre>\n\n<p>The query would look something like this:</p>\n\n<pre><code>-- replace Group_id with Device_id\nupdate p from Person p\n  inner join Group g\n  on g.Id = p.Group_id\nset p.Group_id = g.Device_id\n</code></pre>\n\n<p>I would first drop the FK constraint, and then rename the column afterwards. </p>\n\n<ul>\n<li>Will this work? </li>\n<li>Is there a better way? </li>\n<li>Can I speed it up? (while this query is running, everything else will be offline, server is UPS backed-up, so I'd like to skip any transactional updates)</li>\n</ul>\n"},{"tags":["sql-server","loops","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":44,"score":3,"question_id":12991917,"title":"Stored procedure calling another stored procedure hangs for a long time","body":"<p>I have one stored procedure for which I get what I want for a particular customer. It comes back with 20 rows...</p>\n\n<p>What I need to do is call this stored procedure for 20 customers one or more and then return the entire result set. I have the following but it just hangs and says executing.. I'm wondering what I have wrong...</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[getAllTotals] -- This stored procedure is new\n@pDt1 datetime, @pDt2 datetime, @pStore int\nAS \nBEGIN\n   DECLARE @AccountTbl table (AccountID int );\n   DECLARE @TotalTbl table (AccountID int, col1 varchar(100), col2  varchar(100) );\n\n   DECLARE @accountID  int\n\n   --cache all accountid INTO cursor AccountID_cursor\n   DECLARE AccountID_cursor CURSOR FOR\n       SELECT Storeid   \n       FROM tblStore  \n       WHERE StoreID = 111 OR storeid = 933\n\n   OPEN AccountID_cursor;\n\n   FETCH NEXT FROM AccountID_cursor INTO @accountID;\n\n   WHILE @@FETCH_STATUS = 0\n   BEGIN     \n      --insert total amount info to tmp table @TotalTbl\n      insert @TotalTbl\n         EXEC [dbo].[rptTransactions06192012_royal]\n              @pDt1 = @pDt1, @pDt2 = @pDt2, @pStore = @accountID\n   END\n\n   --Send temp table results to front end as.\n   SELECT * FROM @TotalTbl\nEND\n</code></pre>\n\n<p>Does that make sense?</p>\n\n<p>Thank in advance!!</p>\n\n<p>Anna</p>\n"},{"tags":["sql-server","linux","freetds"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":2688,"score":2,"question_id":7590944,"title":"FreeTDS connection problems on Linux","body":"<p>I'm using FreeTDS 0.91 to connect to a remote MSSQL server but all attempts have borne no fruit thus far.</p>\n\n<p>Upon doing a tsql command on my Unix, I get the following error:</p>\n\n<pre><code>  locale is \"en_US.UTF-8\"\n  locale charset is \"UTF-8\"\n  using default charset \"UTF-8\"\n  Error 20004 (severity 9)\n  Read from the server failed\n  OS error 104, \"Connection reset by peer\"\n  Error 20002 (severity 9)\n  Adaptive Server connection failed\n  There was a problem connecting to the server\n</code></pre>\n\n<p>The freetds.log has the following in it:</p>\n\n<pre><code>16:05:49.144905 20207 (log.c:196):Starting log file for FreeTDS 0.91\n  on 2011-09-28 16:05:49 with debug flags 0xffff.\n  16:05:49.145281 20207 (iconv.c:330):tds_iconv_open(0x3d29320, UTF-8)\n  16:05:49.145426 20207 (iconv.c:187):local name for ISO-8859-1 is ISO-8859-1\n  16:05:49.145448 20207 (iconv.c:187):local name for UTF-8 is UTF-8\n  16:05:49.145459 20207 (iconv.c:187):local name for UCS-2LE is UCS-2LE\n  16:05:49.145469 20207 (iconv.c:187):local name for UCS-2BE is UCS-2BE\n  16:05:49.145479 20207 (iconv.c:349):setting up conversions for client charset \"UTF-8\"\n  16:05:49.145489 20207 (iconv.c:351):preparing iconv for \"UTF-8\" \"UCS-2LE\" conversion\n  16:05:49.145508 20207 (iconv.c:391):preparing iconv for \"ISO-8859-1\" \"UCS-2LE\" conversion\n  16:05:49.145533 20207 (iconv.c:394):tds_iconv_open: done\n  16:05:49.145550 20207 (net.c:205):Connecting to 70.70.218.13 port 2600 (TDS version 7.0)\n  16:05:49.145686 20207 (net.c:270):tds_open_socket: connect(2) returned \"Operation now in progress\"\n  16:05:49.236008 20207 (net.c:310):tds_open_socket() succeeded\n  16:05:49.236061 20207 (util.c:156):Changed query state from DEAD to IDLE\n  16:05:49.236083 20207 (login.c:782):quietly sending TDS 7+ login packet\n  16:05:49.236173 20207 (token.c:328):tds_process_login_tokens()\n  16:05:49.857930 20207 (util.c:331):tdserror(0x3d29080, 0x3d29320, 20004, 104)\n  16:05:49.858072 20207 (util.c:361):tdserror: client library returned TDS_INT_CANCEL(2)\n  16:05:49.858090 20207 (util.c:384):tdserror: returning TDS_INT_CANCEL(2)\n  16:05:49.858114 20207 (util.c:156):Changed query state from IDLE to DEAD\n  16:05:49.858137 20207 (token.c:337):looking for login token, got  0()\n  16:05:49.858155 20207 (token.c:122):tds_process_default_tokens() marker is 0()\n  16:05:49.858168 20207 (token.c:125):leaving tds_process_default_tokens() connection dead\n  16:05:49.858179 20207 (login.c:466):login packet accepted\n  16:05:49.858189 20207 (util.c:331):tdserror(0x3d29080, 0x3d29320, 20002, 0)\n  16:05:49.858209 20207 (util.c:361):tdserror: client library returned TDS_INT_CANCEL(2)\n  16:05:49.858220 20207 (util.c:384):tdserror: returning TDS_INT_CANCEL(2)\n  16:05:49.858232 20207 (mem.c:615):tds_free_all_results()\n</code></pre>\n\n<p>Does this at all seem like it could be an issue with the SQL server, or am I installing or have configured FreeTDS wrong?</p>\n\n<p><p>So lost. Please help. <br /></p>\n\n<hr>\n\n<p>When I connect to the server via telnet, this is the response I get back:</p>\n\n<p>Trying 70.70.218.13...<br />\n  Connected to 70.70.218.13.<br />\n  Escape character is '^]'.<br />\n  ^^<br />\n  Connection closed by foreign host.</p>\n\n<p>Would this mean that the telnet connection to the host was successful?</p>\n\n<p>The SQL database is run on a windows server. Would connecting to the Windows server (just like you would through remote desktop) be the right sort of values to use for the hostname and port? Or would I have to find a direct hostname to the SQL server on the windows server?</p>\n"},{"tags":["asp.net","sql-server"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":102,"score":2,"question_id":13001349,"title":"sql server update Insert statement","body":"<p>i have a stored procedure which first of all checks for some record whether it exists or not. if already exists then executes updates statement (if update statement works fine then returns affected row no else returns a variable with -1000 value) else it selects a variable with value -2000.</p>\n\n<p>Problem is it works fine if i executes it in sql server but when i call it from C# then it returns current_indent('') or only -1 no -1000 or -2000 is returned.</p>\n\n<pre><code>    USE [youfuntube]\n    GO\n    ALTER PROCEDURE [dbo].[usp_change_pass]     \n    @e_mail varchar(60),\n@old_pass varchar(27),\n@new_pass varchar(27)\n    AS\n    BEGIN\ndeclare @exist int;\nSet @exist =0;\n\nSelect @exist=COUNT( userinfo_signup.e_mail) from userinfo_signup where userinfo_signup.e_mail=@e_mail;\nif(@exist&gt;0)\nBEGIN\n    SET @exist=0;\n    SELECT @exist= COUNT ( userinfo_signup.e_mail) from userinfo_signup Where userinfo_signup.e_mail=@e_mail And userinfo_signup.password=@old_pass;\n    if(@exist&gt;0)\n        Begin\n            UPDATE userinfo_signup\n            Set password=@new_pass\n            Where e_mail=@e_mail AND password=@old_pass;\n            Select IDENT_CURRENT( 'userinfo_signup');\n        End\n    ELSE\n        begin\n            Set @exist=-1000;\n            SELECT @exist;\n        end\n    END\nELSE\n    BEGIN\n        SET @exist=-2000;\n        Select @exist;\nEND\n  END\n  GO\n</code></pre>\n"},{"tags":["php","sql-server","linux","freetds"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12990599,"title":"mssql install-setup on linux","body":"<p>i am trying to enable mssql connection in php on linux server\ni tried freetds\ni extract it\nbut when i type</p>\n\n<blockquote>\n  <p>./configure --enable-msdblib --prefix=/usr/local/freetds</p>\n</blockquote>\n\n<p>i get this error in SSH</p>\n\n<pre><code>checking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\nchecking for a thread-safe mkdir -p... /bin/mkdir -p\nchecking for gawk... gawk\nchecking whether make sets $(MAKE)... no\nchecking build system type... i686-pc-linux-gnu\nchecking host system type... i686-pc-linux-gnu\nchecking for style of include used by make... none\nchecking for gcc... no\nchecking for cc... no\nchecking for cl.exe... no\nconfigure: error: in `/var/chroot/home/content/95/9677295/freetds-0.91':\nconfigure: error: no acceptable C compiler found in $PATH\nSee `config.log' for more details.\n</code></pre>\n\n<p>is there a solution for it ?\nalso is there any other way to enable mssql connection in php on linux server to use remote mssql access</p>\n\n<p>Thank You</p>\n"},{"tags":["mysql","sql-server","database","relational-database"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":54,"score":3,"question_id":13000777,"title":"What kind of database to use to store a word list and then search back the words fast if I have a multiset with alowed letters?","body":"<p>I have a huge word list, around 1 million words.  If I use relational DB like MySQL or SQL Server and put all the words in one single column of one table, what performance may I expect? What the database must do is simple: just search for a word that contains some of the given letters (example: A O E P L M N U S). (Like a game of Scrabble) That must produce the result:</p>\n\n<pre><code> maple\n ample\n mole\n lamp\n palm\n mope\n poem\n</code></pre>\n\n<p>and etc...</p>\n\n<p>What do you thinking? Can I expect fast enough response from the DB?\nWhat data base I have to use, is MySQL good choice? I have no others except SQL SERVER 2010.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":12993853,"title":"Join the table valued function in the query","body":"<p>I have one table vwuser. I want join this table with the table valued function fnuserrank(userID). So I need to cross apply with table valued function:</p>\n\n<pre><code>SELECT *\nFROM vwuser AS a\nCROSS APPLY fnuserrank(a.userid)\n</code></pre>\n\n<p>For each userID it generates multiple records. I only want the last record for each empid that does not have a Rank of Term(inated).  How can I do this?</p>\n\n<p>Data:</p>\n\n<pre>\nHistoryID empid  Rank  MonitorDate\n1          A1     E1    2012-8-9\n2          A1     E2    2012-9-12 \n3          A1     Term  2012-10-13\n4          A2     E3     2011-10-09\n5          A2     TERM   2012-11-9 \n</pre>\n\n<p>From this 2nd record and 4th record must be selected.</p>\n"},{"tags":["sql","sql-server","profiling"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":145,"score":0,"question_id":12999965,"title":"Profiler in SQL Server 2012 Express","body":"<p>I use SQL Server 2012 Express. This version doesn't have a profiler (preview query to db), it is accessible in version Standard which is not free.</p>\n\n<p>Do you now any free tool, which has possibility similar to profiler?</p>\n"},{"tags":["sql","sql-server","database"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":12996240,"title":"SQL Server : copy a table into another table in reverse order","body":"<p>I have a table that newer data starts with <code>id=1</code> and increasing the <code>id</code>, we get to the older data, now the problem is, as new data will be added every day, and I want to show the results from new to old, there will be a problem. I want to reverse the order of the table that even after new data are added I can display the data from newer to older one.</p>\n\n<p>Has anyone any clue what should I do?</p>\n"},{"tags":["c++","sql-server","visual-c++","sql-server-2008-r2","reverse-engineering"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":102,"score":1,"question_id":12999978,"title":"How Microsoft protects for example Sql Server binaries from reverse engineering?","body":"<p>I am interested in how Microsoft protects Sql Server binaries from reverse engineering ? \nFor example I also have some C++ dll and I want to protect it from reverse engineering. Is this logical thing to do is dll is compiled to machine code ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":169,"score":2,"question_id":12999631,"title":"Split string by comma in SQL Server 2008","body":"<p>There are two strings <code>a</code> and <code>b</code></p>\n\n<p>The <code>a</code> string contains comma. I would like to split the a string by comma, then go through every element .</p>\n\n<p>IF the <code>b</code> string contains any element which split by comma will return 0</p>\n\n<p>(e.g: a = <code>\"4,6,8\"</code> ; b = <code>\"R3799514\"</code> because the <code>b</code> string contains 4 so return 0)</p>\n\n<p>How to achieve this with a stored procedure? Thanks in advance!</p>\n\n<p>I have seen a split function:</p>\n\n<pre><code>CREATE FUNCTION dbo.Split(@String varchar(8000), @Delimiter char(1))     \nreturns @temptable TABLE (items varchar(8000))     \nas     \nbegin     \ndeclare @idx int     \ndeclare @slice varchar(8000)     \n\nselect @idx = 1     \n    if len(@String)&lt;1 or @String is null  return     \n\nwhile @idx!= 0     \nbegin     \n    set @idx = charindex(@Delimiter,@String)     \n    if @idx!=0     \n        set @slice = left(@String,@idx - 1)     \n    else     \n        set @slice = @String     \n\n    if(len(@slice)&gt;0)\n        insert into @temptable(Items) values(@slice)     \n\n    set @String = right(@String,len(@String) - @idx)     \n    if len(@String) = 0 break     \nend \nreturn     \nend\n\nselect top 10 * from dbo.split('Chennai,Bangalore,Mumbai',',')\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12996905,"title":"Give a user access to extended_properties by not to VIEW DEFINITION","body":"<p>After noting that nobody seemed to have answer for this, I came up with a solution that works for me. So this is an answer, rather than a question.</p>\n"},{"tags":["sql-server","stored-procedures","shared-hosting","execute"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":12987846,"title":"Executing a SQL Server stored procedure in another database server from a stored procedure without having permission to create link server","body":"<p>I have 2 stored procedures, each of them in a separate database on a different physical server. Both these databases are created in a (separate) shared web host and consequently, I do not have server-level access. Both these servers have valid IP addresses and I've created user account with proper permission to run those stored procedure in their corresponding servers. </p>\n\n<p>The question is: I want to execute one of these procedures from another and I am not able to create a linked server (because both databases are in a shared hosting environment). How can I execute the remote stored procedure from inside of the first stored procedure?</p>\n\n<p>(p.s.) I checked out many questions regarding this problem but all of them had supposed that it is possible to create a linked server among these 2 servers.</p>\n"},{"tags":["sql-server","sql-server-2008","insert","updates","multilanguage"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12999108,"title":"How to insert multi language data in SQL Server using N?","body":"<p>I know by using <code>N'...'</code> we can insert multi language data into SQL Server. But I don't know how to use it with parameters. Please help me.. </p>\n\n<p>My code is :</p>\n\n<pre><code>Alter proc proc_T_NewsAddUpdate\n(  \n    @Id bigint,  \n    @Title nvarchar(500),\n    @Description nvarchar(1000),  \n    @image nvarchar(200),  \n    @DateOfNews datetime,  \n    @CreatedBy bigint,  \n    @ModifiedBy bigint,  \n    @IsVisible int,  \n    @IsDeleted int  \n)  \nas  \n    if exists(select 1 from T_LatestNews where ID=@Id)  \n    begin  \n        Update t_LatestNews \n        set Titlle = N@Title, \n            DesCription = N@Description,\n            Image = N@image,\n            dateOfnews = @DateOfNews,\n            modifiedDate = GETDATE(),\n            ModifiedBy = @ModifiedBy,\n            Isvisible = @IsVisible,\n            isdeleted = @IsDeleted \n         where \n            ID=@Id  \n\n        select 1  \n    end  \n    else  \n    begin  \n        insert into t_latestnews (Titlle, Description, Image, dateofnews, CreatedDate, ModifiedDate, CreatedBy, ModifiedBy, isvisible, isdeleted) \n        values(@Title, @Description, @image, @DateOfNews, GETDATE(), GETDATE(), @CreatedBy, @ModifiedBy, @IsVisible, @IsDeleted)  \n\n        select 1  \n    end\n</code></pre>\n"},{"tags":["sql","sql-server","split"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":950,"score":4,"question_id":6440388,"title":"SQL Server split a single column multiple times","body":"<p>I have a database table that has a column with stacked data with two levels with a column that I want to break a part. Here is the example of the data (data changed to protect the innocent :) :</p>\n\n<h3>Table</h3>\n\n<pre><code>ID = varchar(100)\nCarData = varchar(1000)\n\nID       CarData\n1        Nissan:blue:20000,Ford:green:10000\n2        Nissan:steel:20001,Ford:blue:10001,Chevy:blue:10000,Ford:olive:10000\n** Note that cardata can is not fixed, and can have many cars in it\n</code></pre>\n\n<h3>Output Desired:</h3>\n\n<pre><code>ID   Manufacture    Color     Cost\n1    Nissan         Blue      20000\n1    Ford           green     10000\n2    Nissan         steel      20001\n... and on\n</code></pre>\n\n<p>So to say it plainly I need to break the first stacked field which is a comma and create a row for that, then break the second stacked field which is a colon into columns.</p>\n\n<p>Any help would be greatly appreciated.</p>\n"},{"tags":["sql-server","regression","linear"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":43,"score":-1,"question_id":12999178,"title":"How to calculate a trend in SQL Server","body":"<p>I have a database table that has capacity per day that I want to calculate when will I run out of capacity (# of days). Now to make things more difficult capacity can go up and down on a given day if people clean up space. I thought of using Liner Regression but if I understand correctly it does not work well if the numbers are not always going down, but any suggestions or help would be greatly appreciated.</p>\n\n<pre><code>Date         | UnitName      | AvailableCapacity\n10/15/2012   | Unit 1        | 105\n10/16/2012   | Unit 1        | 99\n10/17/2012   | Unit 1        | 103\n10/18/2012   | Unit 1        | 98\n10/19/2012   | Unit 1        | 95\n10/19/2012   | Unit 1        | 92\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12984088,"title":"sql - max from group flag setter","body":"<p>I m trying to achieve flag setting for the condition in my table below</p>\n\n<pre><code>p_id      mon_year      e_id     flag  \n----      ---------     -----    -----\n 1          2011/11       20       0\n 1          2011/11       21       1\n 1          2012/01       22       1\n 1          2012/02       23       0\n 1          2012/02       24       0\n 1          2012/02       25       1\n 2          2011/11       28       0\n 2          2011/11       29       1\n 2          2012/01       30       1\n</code></pre>\n\n<p>grouping by p_id,e_id and mon_year, the flag is set for the last value in the month.</p>\n\n<p>I m confused how can i achieve this</p>\n\n<p>I tried to achieved this by using row_number and partition to seperate out the value. By still looking for to achieved</p>\n\n<p>Output by using row_number query , i have got is as below:</p>\n\n<p>Grouping by </p>\n\n<pre><code>p_id      mon_year      e_id     row\n----      ---------     -----    -----\n 1          2011/11       20       1\n 1          2011/11       21       2\n 1          2012/01       22       1\n 1          2012/02       23       1\n 1          2012/02       24       2\n 1          2012/02       25       3\n 2          2011/11       28       1\n 2          2011/11       29       2\n 2          2012/01       30       1\n</code></pre>\n\n<p>Max of this value would set the flag column. But i m really bugged how to achieve it. Any help would be useful.</p>\n\n<p>Thanks !!</p>\n"},{"tags":["sql-server","sccm"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3291,"score":0,"question_id":10653795,"title":"SCCM 2012 Install / SQL Server 2008 R2 Connect","body":"<p>We are working to install SCCM 2012 using SQL Server 2008 R2 as our Database Target.</p>\n\n<p><strong>About our environment.</strong></p>\n\n<ul>\n<li>SCCM server is part of of \"Domain A\" and SQL Server is Part of \"Domain B\". A two trust is between the two. </li>\n<li>SQL Server is running CU 6 (10.50.1765).</li>\n<li>I've enabled: Named Pipes, TCIP, Disable Dynamic Ports and set the Port to 1433</li>\n<li>SQL Server is running under a named instance</li>\n<li>I granted the SCCM Server full access and as well as the domain account being used to do the install.</li>\n<li>The default collation is set to \"SQL_Latin1_General_CP1_CI_AS</li>\n</ul>\n\n<p>To rule out firewall problems we ran a PS script to test the connectivity to the server\\instance and it checked out ok.</p>\n\n<p>We are getting the error. </p>\n\n<p>Setup is unable to connect to SQL Server with the connection information provided. Verify the following:</p>\n\n<p>The sql server and instance names are entered correctly\nThe specified sql server instance is not configured to use dynamic ports\nIf a firewall is enabled on the SQL Server, inbound rules exists to allow connection to the correct ports.\nThe account used to run Setup has permissions to connect to the specified SQL Server Instance.</p>\n\n<p>Any assistance would be greatly appreciated.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":12998801,"title":"SQL Server : multiple rows with same column values except one","body":"<p>I have data like these:</p>\n\n<pre><code>name_text   ----------c_num---d_type-----unique_id----------------------v_text--r_ticket_id\n29311875_FAD_V100.doc 3560709 Contract 21DABDDF49BA41289F1905D1D6B79ABF 2,01    28600206\n29311875_FAD_V100.doc 3560709 Contract 21DABDDF49BA41289F1905D1D6B79ABF 2,01    28600240\nCopy.docx             3560715 Guide    9D06F8EFF4EC4A2D862F5A0DB3BA357B 2       28600219\n</code></pre>\n\n<p>I want to select just one row which has the bigger value of <code>r_ticket_id</code> column, if <code>name_text</code>, <code>c_num</code>, <code>d_type</code>, <code>unique_id</code>, <code>v_text</code> columns values are equal. </p>\n\n<p>In these case, with select statement just this columns should be fetched.</p>\n\n<pre><code>name_text   ----------c_num---d_type-----unique_id----------------------v_text--r_ticket_id\n29311875_FAD_V100.doc 3560709 Contract 21DABDDF49BA41289F1905D1D6B79ABF 2,01    28600240\nCopy.docx             3560715 Guide    9D06F8EFF4EC4A2D862F5A0DB3BA357B 2       28600219\n</code></pre>\n\n<p>What is the exact SQL query that will do this job?</p>\n"},{"tags":["sql","sql-server","linq","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":61,"score":0,"question_id":12978414,"title":"How to write to DB using Linq","body":"<p>I have a Database with a Table named <code>Fruits</code>. In the table I have 3 columns: <code>Name</code>, <code>Date</code>, <code>Remove</code>.</p>\n\n<p>Now i have inserted 3 rows, with a value like</p>\n\n<pre><code>Apple----20/10/12----N\nMango----21/12/12----Y\nBanana--- 15/07/12----N\nGrapes----18/12/12----Y\n</code></pre>\n\n<p>I want to delete the 2 rows which is marked as 'Y. </p>\n\n<p>This I want to achive using Linq in c# code. Initally I am establishing a connection to the DB using a connection string. I will get the device context DC, and with this I will copy all the rows.</p>\n\n<p>Now I will enumerate the rows marked as <code>N</code> and I will call remove.</p>\n\n<p>Once I do remov, I will do: <code>dc.deleteonSubmit&lt;tableName&gt;(var).</code></p>\n\n<p>After this, I should call <code>dc.submittsavechages();</code> or what to make DB look like:</p>\n\n<pre><code>Mango----21/12/12----Y\nGrapes----18/12/12----Y\n</code></pre>\n\n<p>If I query in sql query analyzer i should get above result. How to do this in LINQ?</p>\n"},{"tags":[".net","sql","sql-server","windows","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":75,"score":-2,"question_id":12997384,"title":"SQL Server 2008 R2 in Windows Server 2008 R2","body":"<p>i want to install SQL Server 2008 R2.\nI clicked on the setup.exe and a message box popup:\n\"Microsoft .NET Framework 3.5 installation has failed.\nSQL Server 2008 Setup requires .NET Framework to be installed.\"</p>\n\n<h1>this is the sqlsetup.txt file in %temp%</h1>\n\n<p>setup launched\nAttempting to determine media source\nMedia Source value not specified on command line argument\nSetup is launched from media directly so default the value to the current folder\nMedia Source: S:\\SQL_Svr_Standard_Edtn_2008_R2_English_MLF_X16-29588\\\nAttemp to determine media layout based on file 'S:\\SQL_Svr_Standard_Edtn_2008_R2_English_MLF_X16-29588\\mediainfo.xml'\nMedia layout is detected as: Full\nNot a slip stream media, so continuing to run setup.exe from media\n/? or /HELP or /Action=HELP specified: false\nHelp display: false\nChecking to see if we need to install .net version 3.5\nDetermining the cluster status of the local maschine\nThe local maschine is not configured as a cluster node\nAttempting to find media for .Net version 3.5\nError: Cannot determine file version of .NET redist: 0x80004005\n.Net Version 3.5 installation failed, so setup will close. Error code: 0x80004005</p>\n\n<h1>Setup closed with exit code: 0x80004005</h1>\n\n<p>thank you very much for any help</p>\n"},{"tags":["c#",".net","sql-server","sql-server-2008-r2"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":97,"score":3,"question_id":12998209,"title":"Retrieve SQL Server database information in C#","body":"<p>I'm trying to create a program which will generate a SQL database schema including tables, view, keys, indexes, triggers, etc... like:</p>\n\n<pre><code>CREATE TABLE TableName(....) ....\nCREATE VIEW ViewName(...) ....\n</code></pre>\n\n<p>I know this is possible because SQL Server Management Studio does it (generate script command). However, how does it do it?</p>\n\n<p><strong>UPDATE</strong>: I forgot to mention about permissions: I'm an owner of database (in most cases) but I'm <strong>not</strong> sys-admin. Would there be any difference?</p>\n"},{"tags":["sql-server","sql-server-2008","database-mail"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12233638,"title":"Database Mail in Sql Server 2008 not working","body":"<p>I am using Database Mail feature of SQL Server 2008 for the first time to send mail.</p>\n\n<p>I followed the steps in <a href=\"http://blog.sqlauthority.com/2008/08/23/sql-server-2008-configure-database-mail-send-email-from-sql-database/\" rel=\"nofollow\">Example</a></p>\n\n<p>All seems good. Send status in </p>\n\n<pre><code>SELECT * FROM sysmail_allitems \n</code></pre>\n\n<p>is sent.</p>\n\n<p>But the recipient hasn't received any mail..</p>\n\n<p>What could be the issue?</p>\n"},{"tags":["sql-server","group-by","concatenation","for-xml-path"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":2,"question_id":12997884,"title":"SQL Server : Group by string concatenation","body":"<p>I have a question. I know that has been asked before. I looked through the related questions but I could not get my SQL script to work.</p>\n\n<p>Here is my query :</p>\n\n<pre><code>SELECT T1.PART_ID, T2.ID, T2.DESCRIPTION\nFROM #TEMP T1 \nINNER JOIN #TEMP2 T2 ON T1.PART_ID = T2.PART_ID\nORDER BY T2.ID\n</code></pre>\n\n<p>Table:</p>\n\n<pre><code>PART_ID |  ID        |    DESCRIPTION\n----------------------------------\n10002   |  1182505   |   Tagfahrlichtschaltung\n80029   | 1182505    |   Bluetooth\n20004   | 1212866    |    Kindersitzbefestigung\n10045   |  1212866   |    Lederlenkradrriegelung\n11908   |  1257946   |    Airbag\n22346   | 1257946    |    Automatic\n</code></pre>\n\n<p>I want have the result like:</p>\n\n<pre><code>ID       | LISTOFPARTS\n-----------------------------\n1182505  |  \"10002 : Tagfahrlichtschaltung ; 80029 : Bluetooth  \"\n1212866  |  \"20004 : Kindersitzbefestigung ; 10045 : Lederlenkradrriegelung\"\n1257946  |  \"11908 : AIRBAG ; 22346 : AUTOMATIC\"\n</code></pre>\n\n<p>I guess it has to be something with XML PATH but I could not get it to work.\nCould anyone rewrite the query so that it returns the results grouped and concatenated in string?</p>\n\n<p>Solutions with or without XML PATH will be appreciated.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server","ssas","mdx","olap"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12983046,"title":"Performing Calculations on a Subset of OLAP data in MDX","body":"<p>I'm trying to figure out a way I can filter out data in my cube so that I can perform time-series calculations such as a moving average using only that subset.</p>\n\n<p>For example, let's say that I have a fact table with the following columns:</p>\n\n<ul>\n<li>DayId (Key)</li>\n<li>HourId (Key)</li>\n<li>Value</li>\n</ul>\n\n<p>I also have a Time dimension with a composite key of <strong>DayId</strong> and <strong>HourId</strong>.  This dimension has a key for every hour over the span of 100 days, so the keys go from (1,1) to (100,24).</p>\n\n<p>In the fact table there is a value for every point in time so it looks like</p>\n\n<pre><code>DayId HourId Value\n1     1       50\n1     2       60\n1     3       75.2\n...   ...     ...\n100   23      87\n100   24      89\n</code></pre>\n\n<p>Now, suppose I want to calculate a daily moving average from the beginning of time through some arbitrary point in the middle of the day.  Basically, I would want to calculate the average using the last point of every day except the last one, which would use a different point in time in the middle of the day.  If I was to do a moving average from day 1 to day 10, ending at noon of the 10th day (HourId 12), the data I would use for my calculation would look like:</p>\n\n<pre><code>DayId HourId Value\n1     24     80\n2     24     90\n3     24     39\n4     24     60\n...   ...    ...\n9     24     10 \n10    12     30\n</code></pre>\n\n<p>In SQL, I could retrieve a set like this pretty easily:</p>\n\n<pre><code>SELECT \n    *\nFROM\n    [FactTable]\nWHERE\n    ((DayId BETWEEN 1 AND 9) AND (HourId = 24))\n    OR ((DayId = 10) AND (HourId = 12))\n</code></pre>\n\n<p>I'm pretty new to OLAP and MDX, so I've really been struggling with the right way to do this.  So far, the best I've been able to do is to perform a sub-select in my <code>FROM</code> clause, and essentially construct a tuple set of only the rows I want:</p>\n\n<pre><code>WITH\n    MEMBER [SMA 10 Value] AS\n    AVG (\n        ([Time].[DayId].Lag(9):[Time].[DayId], [Time].[HourId])\n        , [Value]\n    )\nSELECT\n    {\n      [Value]\n      , [SMA 10 Value]\n    } ON COLUMNS\n    , ([Time].[DayId], [Time].[HourId]) ON ROWS\nFROM\n(\n    SELECT\n        [Measures] ON COLUMNS\n        , {\n            ([Time].[DayId].[1]:[Time].[DayId].[9], [Time].[HourId].[24])\n            , ([Time].[DayId].[10], [Time].[HourId].[12])\n    } ON ROWS\n    FROM\n        [Cube]\n)\n</code></pre>\n\n<p>However, it doesn't seem to quite work right for my calculations.  The moving average seems to be correct over the first 9 days, because their tuples all have the same hour ID, but when I get to the final day, instead of using the values from the previous 9 tuples, it performs the average over the previous 9 days with the 12 Hour ID.</p>\n\n<p>What am I doing wrong here, is there a better way that I can filter my time dimension down to eliminate unwanted rows from my calculations?</p>\n"},{"tags":["sql-server","stored-procedures","timer","return"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":102,"score":5,"question_id":12996705,"title":"SQL Server stored procedure that returns processed records number","body":"<p>I have a Winforms application that executes a stored procedure which examines several rows (around 500k). In order to inform the user about how many rows have already been processed, I would need a stored procedure which returns a value every n rows. For example, every 1000 rows processed (most are <code>INSERT</code>).</p>\n\n<p>Otherwise I would be able only to inform when ALL rows are processed. Any hints how to solve this? </p>\n\n<p>I thought it could be useful to use a trigger or some scheduled task, but I cannot figure out how to implement it.</p>\n"},{"tags":["sql","sql-server","table","delete"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":47,"score":-1,"question_id":12997586,"title":"sql delete result from query","body":"<p>I have two tables, same structure</p>\n\n<ul>\n<li><code>clients</code> contains row 1+2</li>\n<li><code>clients3</code> only row 2</li>\n</ul>\n\n<p>I want to delete row 2 in the <code>clients</code> table</p>\n\n<pre><code> SELECT * \n FROM clients \n WHERE EXISTS (SELECT * FROM clients3 WHERE clients3.id = clients.id))\n</code></pre>\n\n<p>gives me the row 2. But I do not know how to delete.</p>\n\n<pre><code>DELETE * \nFROM clients \nWHERE (SELECT * \n       FROM clients \n       WHERE EXISTS (SELECT * FROM clients3 WHERE clients3.id = clients.id))\n</code></pre>\n\n<p>does not work.   </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12994914,"title":"Insert query to import data from other database from another server","body":"<p>Normally the Insert query to import data would be:</p>\n\n<pre><code>Insert Into mytable\nSelect * From otherDB.dbo.Othertable\n</code></pre>\n\n<p>but problem is otherDB is not within my current server. It is on a different machine hosted online. Can you please tell what changes should be there to import it from different DB?</p>\n"},{"tags":["asp.net","sql-server","database-design","data-structures","content-management-system"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":12928132,"title":"Database design for website (CMS) consideration & suggestion for database driven menus","body":"<p>This question is in reference to my <a href=\"http://stackoverflow.com/questions/12912342/database-design-for-magazine-website-with-flexible-horizontal-menus\">previous question</a>. Based on my requirements I have made some correction to my database, but I am not still sure how I can create sub-menus (Which need to be created from another table rather than the main <code>pg_Pages</code> table.</p>\n\n<p>I keep Page information in <code>pg_Pages</code> from where I can create my menus. My problem is that I can easily create sub-menus for \"About Us\" and \"Multimedia\" since I store those pages in the <code>pg_Pages</code> table, but I need to create sub-menus for <code>News</code> from the <code>News Category</code> table and link them to the proper page Handler. &amp; Issue from <code>magazine</code> table.</p>\n\n<p><strong>Menus Example</strong> \n<img src=\"http://i.stack.imgur.com/B6bMq.png\" alt=\"enter image description here\">\n<strong>Database Sample Tables</strong>\n<img src=\"http://i.stack.imgur.com/IXftI.png\" alt=\"enter image description here\"></p>\n\n<p>Sample Data</p>\n\n<pre><code>pg_Pages Table\nPageID  PageName    LangID  PagePositionNo  PageURL     PageInheritance\n1   Home        1   10      Default.aspx    0\n2   About Us    1   20      Page.aspx   0\n3   PageOne     1   10      Page.aspx   2\n4   PageTwo     1   20      Page.aspx   2\n5   Multimedia  1   30      Page.aspx   0\n6   Video       1   10      Videos.aspx 5\n7   PhotoGallery    1   20      Gallery.aspx    5\n8   News        1   40      News.aspx   0\n9   Issues      1   50      #       0\n10  Publication 1   60      Page.aspx   0\n11  SpanishHome 2   10      Default.aspx    0\n12  SpanisAbout Us  2   20      Page.aspx   0\n------------------------------------------------------------------------------\nMagazine\nMagazineID  MagazineIssueCode   LangID  MagazineTitle   MagazineLiveIssue(CurrentIssue)\n1       101         1   Mag Title       0\n2       102         1   Mag Title       1\n3       101         2   SpanisgMag Title    0\n4       102         2   Mag Title       1\n------------------------------------------------------------------------------\n\nart_Article Table\nArticleID   ArticleTitle    ArticleCatID    MagazineID  Language   TYPE \n1       Article one 100     1       1   Artile\n2       Article two 100     1       1   Artile\n3       Article three   200     1       1   Artile\n4       Article four    300     1       1   Artile\n5       Article Five    100     2       1   Artile\n6       EditorMessage   300     2       1   EditorMessage\n7       Article seven   200     2       2   Somthing\n------------------------------------------------------------------------------\n</code></pre>\n\n<p>I want my design to be flexible enough to read menus from different tables. What approach/changes should I take/do to get it done properly rather than creating a separate table for all the Menus &amp; link them to pages? Please suggest the best approach for this scenario. </p>\n\n<p>I want system to be very flexible and read menu information directly from the database rather than creating static links and firing queries based on <code>IssueID</code> or some other ID.</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2624,"score":2,"question_id":3777309,"title":"Creating jobs in SQL Server 2008","body":"<p>I have created a database in SQL Server 2008 and I have assigned a job to it which get backup from my database once a day. </p>\n\n<p>Now I want to attach my database to SQL Server in another system. </p>\n\n<p>Should I create the job again on the second server or it has been transferred with mdf file itself? </p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":1,"question_id":12996938,"title":"How to get selected fields from sp_spaceused query in mssql","body":"<p>For My query </p>\n\n<blockquote>\n  <p>exec sp_spaceused 'tablbename'</p>\n</blockquote>\n\n<p>It returns</p>\n\n<p>name | rows | reserved | data | index size | unused</p>\n\n<p>But, I need only <strong>reserved</strong> field.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12993149,"title":"SQL Server single stored procedure for insertion","body":"<p>I am trying to create a stored procedure in SQL Server 2008 which can insert data into any table (not table specific). I created one shown below, but during execution of the procedure an exception is thrown i.e. </p>\n\n<blockquote>\n  <p><em>Invalid object name 'dbo.@table'.</em></p>\n</blockquote>\n\n<p>Stored procedure code:</p>\n\n<pre><code>CREATE PROCEDURE dbo.sp_InsertValues\n   @table varchar(15)\n   , @fields varchar(100)\n   , @values varchar(100)   \nAS\nBEGIN\n   INSERT INTO [dbo].[@table] (@fields) VALUES (@values)\nEND\nGO\n</code></pre>\n\n<p>Remember I checked the parameters table, columns and values parameters are not null.</p>\n"},{"tags":["sql-server","non-unicode"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":938,"score":3,"question_id":2543074,"title":"How to use ORDER BY, LOWER in SQL SERVER 2008 with non-unicode data","body":"<p>The question is about Armenian. I'm using sql server 2005, collation \nSQL_Latin1_General_CP1_CI_AS, data mostly is in Armenian and we can't use unicode. </p>\n\n<p>I tested on ms sql 2008 with a windows collation for armenian language ( Cyrillic_General_100_ ), I have found here, ( <a href=\"http://msdn.microsoft.com/en-us/library/ms188046.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms188046.aspx</a> ) but it didn't help.</p>\n\n<p>I have a function, that orders hex values and a lower function, which takes each char in each string and converts it to it's lower form, but it's not acceptable solution, it works really slow, calling that functions on every column of a huge table.</p>\n\n<p>Is there any solution for this issue not using unicode and not working with hex values manually? </p>\n\n<p><strong>UPDATE:</strong> </p>\n\n<p>On the left side are mixed case words, sorted in the right order and with lower case representations on the right side. Hope this will help. Thank You.\nWords are written in unicode. </p>\n\n<ol>\n<li><p>   -> </p></li>\n<li><p> -> </p></li>\n<li><p> -> </p></li>\n<li><p> -> </p></li>\n<li><p> -> </p></li>\n<li><p> -> </p></li>\n<li><p> -> </p></li>\n<li><p> -> </p></li>\n<li><p> -> </p></li>\n<li><p> -> </p></li>\n</ol>\n"},{"tags":["c#","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1368,"score":0,"question_id":4362212,"title":"exception with nvarchar - data was truncated while converting from one data type to another","body":"<p>I'm having a bit of trouble with entering data into several columns of a database, all nvarchar types. I'm getting: </p>\n\n<blockquote>\n  <p>The data was truncated while converting from one data type to another.  Name of function(if known) </p>\n</blockquote>\n\n<pre><code>DBConn.Open();\n\ncmd = new SqlCeCommand(\"INSERT INTO [Employee Table] VALUES ('\"+ social + \"','\" +\n        first + \"','\" + last + \"','\" + mid + \"','\" + address + \"','\" + phone + \"',\"\n            + \"'Employee'\" + \",'\" + city + \"','\" + state + \"','\" + zip + \"','\" + email + \"','\" + userName + \"')\", DBConn);\ncmd.ExecuteNonQuery();\n</code></pre>\n\n<p>Any suggestions on how to avoid the truncating/converting error?</p>\n"},{"tags":["sql","sql-server","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":60,"score":3,"question_id":12996170,"title":"How to split the rows into column","body":"<p>Using <code>SQL Server 2000</code></p>\n\n<p>Table1</p>\n\n<pre><code>ID\n\nA001\nA002\nA003\nA004\nA005\nA006\nA007\n....\n....\nA028\n</code></pre>\n\n<p>From the above table, i want to split the 3 rows into 3 column, order by <code>id</code></p>\n\n<p>Rows display like this</p>\n\n<p>Expected Output</p>\n\n<pre><code>id1 id2 id3\n\nA001 A002 A003\nA004 A005 A006\nA007 A008 A009\n...\n...\nA025 A026 A027\nA028 null null\n</code></pre>\n\n<p>ID is not fixed, id may contain like this also (<code>01A or A001 or 1A1 or etc....</code>)</p>\n\n<p>Table 1 row count is not fixed, it may goes more than 100 rows also. Column 3 is fixed. How to make a query for the above condition.</p>\n\n<p>Need Query Help</p>\n"},{"tags":["sql-server","tracking","change-management"],"answer_count":8,"favorite_count":5,"up_vote_count":8,"down_vote_count":0,"view_count":6534,"score":8,"question_id":299931,"title":"Tracking changes in a SQL server 2005 database","body":"<p>I have been tasked with developing a solution that tracks changes to a database.</p>\n\n<p>For updates I need to capture:</p>\n\n<ul>\n<li>date of update</li>\n<li>old value</li>\n<li>new value</li>\n<li>field affected</li>\n<li>person doing change</li>\n<li>record id</li>\n<li>table record is in</li>\n</ul>\n\n<p>For deletes:</p>\n\n<ul>\n<li>date of delete</li>\n<li>person doing delete</li>\n<li>The title/description/id of record deleted.  The tables I am tracking changes on all have a title or description field.  I'd like to capture this before the record is deleted.</li>\n<li>table record was in</li>\n</ul>\n\n<p>For inserts:</p>\n\n<ul>\n<li>date of insert</li>\n<li>person doing change</li>\n<li>record id</li>\n<li>table record is in</li>\n</ul>\n\n<p>I've thought of a few ways to do this:</p>\n\n<ul>\n<li>I am using stored procedures for any updates/deletes/inserts.  I would create a generic \"tracking\" table.  It would have enough fields to capture all the data.  I would then add another line in each stored proc to the effect of \"Insert record into tracking table\".\n<ul>\n<li>downside: all updates/deletes/inserts are all jumbled in the same table</li>\n<li>lots of NULLed fields</li>\n<li>how do I track batch updates/deletes/inserts? &lt;---- this might not be an issue.  I don't really do any thing like this in the application.</li>\n<li>how do I capture the user making the update.  The database just sees one account.</li>\n<li>edit a lot of existing code to edit.</li>\n</ul></li>\n<li>Lastly, I could create a trigger that is called after updates/deletes/inserts.  Many of the same downsides as the first solution except:  I would have to edit as much code.  I am not sure how I would track updates.  It doesn't look like there's a way using triggers to see recently updated records.</li>\n</ul>\n\n<p>I am using asp.net, C#, sql server 2005, iis6, windows 2003.  I have no budget so sadly I can't buy anything to help me with this.</p>\n\n<p>Thanks for your answers!</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":12995059,"title":"SQL Not Exists in this Query - is it possible","body":"<p>This is my script - it simply looks for the image file associated with a person row.</p>\n\n<p>Now the error will display if there is NO .jpg evident when the query runs:</p>\n\n<blockquote>\n  <p><em>Msg 4860, Level 16, State 1, Line 1<br>\n  Cannot bulk load. The file \"C:\\Dev\\ClientServices\\Defence\\RAN\\Shore\\Config\\Photos\\002054.2009469432270600.001.jpg\" does not exist.</em></p>\n</blockquote>\n\n<p>Is there a way to write this query to </p>\n\n<pre><code>IF not exists then set id_number = '002054.2009469432270427.001' \n</code></pre>\n\n<p>so it will always display this photo for any rows without a picture. </p>\n\n<pre><code>ALTER\nprocedure [dbo].[as_ngn_sp_REP_PH108_photo] (@PMKEYS nvarchar(50)) \nAS\n---exec [as_ngn_sp_REP_PH108_photo] '8550733'\nSET \nNOCOUNT ON\n\nDECLARE @PATH AS NVARCHAR(255)\nDECLARE @ID_NUMBER NVARCHAR(27)\nDECLARE @SQL AS NVARCHAR(MAX)\n\nEXEC DB_GET_DB_SETTING'STAFF PICTURE FILE LOCATION', 0, @PATH OUTPUT \n\nIF RIGHT(@PATH,1) &lt;&gt; '\\'\n\n    SET @PATH = @PATH + '\\' \n\nSELECT @ID_NUMBER = ID_NUMBER FROM aView_person WHERE EXTRA_CODE_1 = @PMKEYS\n\nSET @PATH = @PATH + @ID_NUMBER + '.jpg'\n\nSET @SQL = 'SELECT ''Picture1'' [Picture], BulkColumn FROM OPENROWSET(Bulk ''' + REPLACE(@PATH,'''','''''') + ''', SINGLE_BLOB) AS RAN'\n\nEXEC SP_EXECUTESQL @SQL\n</code></pre>\n"},{"tags":["sql-server","performance","sql-server-2008","indexing"],"answer_count":5,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":951,"score":0,"question_id":488258,"title":"Adding a index on my table for this query","body":"<p>This table gets hit with this query the most, so I want add a index to speed things up, this table will have 5 million rows it in.</p>\n\n<p>My query looks like this:</p>\n\n<p>SELECT someID \nFROM someTable \nWHERE \n    myVarChar = @myVarChar AND\n    MyBit = 0 AND MyBit2 = 1 AND MyBit3 = 0</p>\n\n<p>myVarChar is unique also.</p>\n\n<p>What would the best index be for this type of query?</p>\n\n<p>I currently have a single index that covers all of the 4 columns in the above query.</p>\n\n<p>I am using sql server 2008 standard.</p>\n\n<p>Do I have to reindex every so often or its automatic?</p>\n"},{"tags":["c#",".net","sql-server","winforms","mdf"],"answer_count":5,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":16313,"score":5,"question_id":2054905,"title":"Connecting to sql server database mdf file without installing sql server on client machine?","body":"<p>I am creating a  window application that need to use sql server database.\nI want to install this application to client machine without installing sql server so that my application can still connect to a database i.e mdf file that i will be providing at client system. </p>\n\n<p>How can i connect to a database(mdf) on client machine through my window application without installing sql server. ?\nI dont know is it possible or not.</p>\n\n<p>If possible what will be the connection string in that case. Database need not be used in network. </p>\n\n<p><strong>Client mahine dont need any installation. Every thing needs to be run through pen drive</strong></p>\n"},{"tags":["sql","sql-server","stored-procedures","upsert"],"answer_count":11,"favorite_count":21,"up_vote_count":55,"down_vote_count":0,"view_count":19220,"score":55,"question_id":13540,"title":"Insert Update stored proc on SQL Server","body":"<p>I've written a stored proc that will do an update if a record exists, otherwise it will do an insert. It looks something like this:</p>\n\n<pre><code>update myTable set Col1=@col1, Col2=@col2 where ID=@ID\nif @@rowcount = 0\ninsert into myTable (Col1, Col2) values (@col1, @col2)\n</code></pre>\n\n<p>My logic behind writing it in this way is that the update will perform an implicit select using the where clause and if that returns 0 then the insert will take place.</p>\n\n<p>The alternative to doing it this way would be to do a select and then based on the number of rows returned either do an update or insert. This I considered inefficient because if you are to do an update it will cause 2 selects (the first explicit select call and the second implicit in the where of the update). If the proc were to do an insert then there'd be no difference in efficiency.</p>\n\n<p>Is my logic sound here?\nIs this how you would combine an insert and update into a stored proc?</p>\n"},{"tags":["sql-server","sql-server-2005","export-to-excel","openrowset"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1139,"score":0,"question_id":9640523,"title":"SQL Server 2005 into Excel with OPENROWSET MSG 7399/7303","body":"<p>My patience is at an end with this issue. I run jobs via SSMS or the agent that have been working perfectly fine up until last week that insert data from tables/views into various Excel files.</p>\n\n<p>Most recently, the jobs/code just keep running while never finishing...these jobs use to only take up-to 15-25 seconds to complete but now never end. I've tested the code below on a new sheet and it goes instantaneously! The error I'm getting also doesn't help, the solutions I've found in Google were no help or were already set.</p>\n\n<p>Any ideas what would cause a openrowset export to just bomb out and not do its job?</p>\n\n<p>Code I generally run that works:</p>\n\n<pre><code>INSERT INTO OPENROWSET('Microsoft.ACE.OLEDB.12.0',\n'Excel 12.0;HDR=YES;Database=C:\\Automation\\DYNAMIC\\Output\\File.xlsx;',\n'SELECT * FROM [Data$]')\n\nSELECT *\nFROM [REPORTING].[dbo].[tbl_table]\n</code></pre>\n\n<p>The current error message:</p>\n\n<blockquote>\n  <p>Msg 7399, Level 16, State 1, Line 1<br>\n  The OLE DB provider \"Microsoft.ACE.OLEDB.12.0\" for linked server \"(null)\" reported an error. The provider did not give any information\n  about the error.<br>\n  Msg 7303, Level 16, State 1, Line 1<br>\n  Cannot initialize the data source object of OLE DB provider \"Microsoft.ACE.OLEDB.12.0\" for linked server \"(null)\".</p>\n</blockquote>\n\n<p>System:</p>\n\n<ul>\n<li>SQL Server 2005 32-Bit on Windows XP 32-Bit</li>\n</ul>\n\n<p>Updated/Edited information:</p>\n\n<ul>\n<li><p>Excel sheets contain either functions on a separate tab or Charts extrapolating the data from the [Data$] tab (if any of this helps)</p></li>\n<li><p>I have created a brand new worksheet and tested my insert query and it worked perfectly</p></li>\n<li><p>The source file was not originally created on the server, but instead transferred via Share Drive (I don't think this would matter though)</p></li>\n</ul>\n\n<p>Any help is appreciated!!</p>\n\n<p>Thanks</p>\n"},{"tags":["python","sql-server","django","pyodbc"],"answer_count":4,"favorite_count":7,"up_vote_count":17,"down_vote_count":0,"view_count":6224,"score":17,"question_id":842831,"title":"Using Sql Server with Django in production","body":"<p>Has anybody got recent experience with deploying a Django application with an SQL Server database back end? Our workplace is heavily invested in SQL Server and will not support Django if there isn't a sufficiently developed back end for it.</p>\n\n<p>I'm aware of mssql.django-pyodbc and django-mssql as unofficially supported back ends. Both projects seem to have only one person contributing which is a bit of a worry though the contributions seem to be somewhat regular.</p>\n\n<p>Are there any other back ends for SQL Server that are well supported? Are the two I mentioned here 'good enough' for production? What are your experiences?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":45,"score":0,"question_id":12994735,"title":"add series (row?) number to end of existing column data","body":"<p>I have a large table with a column that contains the same string data \"Dummy\".\nI need to add a sequential count to the end of that string to make it unique.  IE:</p>\n\n<pre><code>Dummy1\nDummy2\nDummy3 \n</code></pre>\n\n<p>For the life of me I cannot get this right.  I do not want a new column, and I do not want a new table.</p>\n"},{"tags":["c#","asp.net","sql-server","visual-studio-2010","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12994000,"title":"Connecting to a remote database using Visual studio","body":"<p>I have domain , database name, database user and password </p>\n\n<p>I want to connect to my database remotely using visual studio 2010, How can I do this ? </p>\n\n<p>thanks in advance </p>\n"},{"tags":["sql-server","sql-server-2008","documentation","schema"],"answer_count":6,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":2009,"score":1,"question_id":1732057,"title":"Tool to Document SQL Server Schema","body":"<p>Can anyone recommend a free (or cheap) program out there which allows me to easily document what certain tables and fields are used for in our applications? Ideally, when we update a fields type, it would automagically update in this tool. Also, showing what fields are indexed etc would be beneficial.</p>\n\n<p>What solutions have you guys / gals used to document your database?</p>\n\n<p>We use MS SQL Server 2008</p>\n"},{"tags":["sql","sql-server","backup"],"answer_count":8,"favorite_count":5,"up_vote_count":11,"down_vote_count":1,"view_count":11808,"score":10,"question_id":3942207,"title":"How to backup remote SQL Server database to local drive?","body":"<p>I need to copy a database from a remote server to a local one. I tried to use SQL Server Management Studio but it only backup to a drive in the remote server.</p>\n\n<p>Some points:</p>\n\n<ul>\n<li>I do not have access to the remote server in a way that i could copy files;</li>\n<li>I do not have access to setup a UNC path to my server;</li>\n</ul>\n\n<p>Any ideas of how can I copy this database? Will I have to use 3rd party tools?</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server","character-encoding","ssms"],"answer_count":14,"favorite_count":3,"up_vote_count":14,"down_vote_count":0,"view_count":25477,"score":14,"question_id":1014447,"title":"How to type a new line character in SQL Server Management Studio","body":"<p>In the \"datagrid\" view of an open table of data, how can I type a new line character into an nvarchar field directly in SSMS?</p>\n\n<p>Is there an alt code?</p>\n"},{"tags":["sql-server","sql-server-2008","triggers","dynamic-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2376,"score":0,"question_id":940189,"title":"Dynamically finding column values in a trigger from INSERT when the column name is a variable","body":"<p>I have a trigger that gets inserts and updates to a view. I need to find the columns that are being modified and get the value into the correct table.</p>\n\n<pre><code>INSERT INTO TempTableAttr_Lot(ID, [% Num]) VALUES(3, 24.0)\n</code></pre>\n\n<p>I am trying to figure out how, in my trigger, to get the value of ID and [% Num] columns.  The problem is that there can be 32 different columns that are set in the insert or update, so I want to loop through looking to see if that column is in the 'inserted' table.</p>\n\n<p>One problem is that if I use exec or execute, to build a dynamic query, inserted is not in scope for this.</p>\n\n<p>The view is dynamic in that if attributes are added then the view is regenerated by a stored procedure, so I can't assume what column names are in the view at any given time, it can grow and shrink.</p>\n\n<p>Ideally I would like to do <code>SET @Value = (SELECT i.[@Name] FROM inserted i)</code> But @Name is not a column name, but a variable in my trigger, so when I tried </p>\n\n<pre><code>DECLARE @ValueTable TABLE ( value sql_variant)\nINSERT INTO @ValueTable EXECUTE('SELECT i.[' + @Name + '] FROM inserted i')\nSET @Value = CONVERT(nvarchar(128), (SELECT DISTINCT * FROM @ValueTable))\n</code></pre>\n\n<p>this didn't work as inserted appears to not be in scope.</p>\n\n<p>For the first loop @Name = 'ID' and for the second it will be 'Col2' which was not inserted, so the value of @Value should be null, and I continue to loop through the possible column names until I finish, and the trigger is processed.</p>\n\n<p>I am calling it a trigger, it is defined as:</p>\n\n<pre><code>CREATE TRIGGER TempTableAttr_LotTrigger \nON  TempTableAttr_Lot \nINSTEAD OF UPDATE, INSERT\n</code></pre>\n\n<p>I am testing with an INSERT command at the moment. I realize that when doing an update I may need to look at the 'deleted' table.</p>\n\n<p>UPDATE: I am assuming only one row is being inserted at the moment, for my test, to see how to get this to work.  This is for an entity-attribute-value database, but I have a view that makes it look relational. When using Integration Service, when the updating is going on, any inserts or updates to the view will call the trigger. I am just trying to understand how to get the information I need so I can update the correct table, with the correct values.</p>\n"},{"tags":["sql-server","reporting-services"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5297,"score":0,"question_id":1953446,"title":"rsExecutionNotFound error in SQL Server Reporting Services","body":"<p>I have a SQL Server Reporting Services 2005 installation that has worked great for a few years now, but has been giving me occasional glitches recently. </p>\n\n<p>I'm using the default reporting services website instead of embedding reports into my application, which has proven a very efficient way to deploy the reports. The OS is Windows Server 2003 and the reports are being viewed on IE8 running XP. </p>\n\n<p>It's not a big deal. Refreshing the browser brings the report right up each time. I guess it might be a cacheing issue. It does scare users, so it would be nice to squash this bug.</p>\n\n<p>Any ideas?</p>\n\n<h2>Server Error in '/Reports' Application.</h2>\n\n<p>Execution 'j0cnbcqzv5lxg1imzqouqxya' cannot be found (rsExecutionNotFound) \nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </p>\n\n<p>Exception Details: Microsoft.Reporting.WebForms.ReportServerException: Execution 'j0cnbcqzv5lxg1imzqouqxya' cannot be found (rsExecutionNotFound)</p>\n\n<p>Source Error: </p>\n\n<p>An unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.  </p>\n\n<p>Stack Trace: </p>\n\n<p>[ReportServerException: Execution 'j0cnbcqzv5lxg1imzqouqxya' cannot be found (rsExecutionNotFound)]\n   Microsoft.Reporting.WebForms.ServerReport.GetExecutionInfo() +289\n   Microsoft.Reporting.WebForms.ServerReport.SetExecutionId(String executionId, Boolean fullReportLoad) +120\n   Microsoft.Reporting.WebForms.ServerReport.LoadFromUrlQuery(NameValueCollection requestParameters, Boolean fullReportLoad) +101\n   Microsoft.Reporting.WebForms.ReportDataOperation..ctor() +321\n   Microsoft.Reporting.WebForms.HttpHandler.GetHandler(String operationType) +458\n   Microsoft.Reporting.WebForms.HttpHandler.ProcessRequest(HttpContext context) +56\n   System.Web.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +181\n   System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously) +75</p>\n\n<p><hr></p>\n\n<p>Version Information: Microsoft .NET Framework Version:2.0.50727.3603; ASP.NET Version:2.0.50727.3082 </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":7,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":15435,"score":3,"question_id":1248423,"title":"how to see active SQL Server connections?","body":"<p>I am using SQL Server 2008 Enterprise. I want to see any active SQL Server connections, and the related information of all the connections, like from which IP address, connect to which DB or something.</p>\n\n<p>Any existing tools to solve this issue?</p>\n\n<p>thanks in advance,\nGeorge</p>\n"},{"tags":["sql","sql-server","database","tsql","exception-handling"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3387,"score":1,"question_id":2481273,"title":"how to rethrow same exception in sql server","body":"<p>I want to rethrow same exception in sql server that has been occured in my try block. \nI am able to throw same message but i want to throw same error.</p>\n\n<pre><code>BEGIN TRANSACTION\n    BEGIN TRY\n            INSERT INTO Tags.tblDomain \n            (DomainName, SubDomainId, DomainCode, Description)\n            VALUES(@DomainName, @SubDomainId, @DomainCode, @Description)\n            COMMIT TRANSACTION\n    END TRY\n\n    BEGIN CATCH\n            declare @severity int; \n            declare @state int;\n\n            select @severity=error_severity(), @state=error_state();\n\n            RAISERROR(@@Error,@ErrorSeverity,@state);\n            ROLLBACK TRANSACTION\n    END CATCH\n</code></pre>\n\n<blockquote>\n  <p><code>RAISERROR(@@Error, @ErrorSeverity, @state);</code></p>\n</blockquote>\n\n<p>This line will show error, but i want functionality something like that.\nThis raises error with error number 50000, but i want erron number to be thrown that i am passing <code>@@error</code>, </p>\n\n<p>I want to capture this error no at frontend</p>\n\n<p>i.e. </p>\n\n<pre><code>catch (SqlException ex)\n{\nif ex.number==2627\nMessageBox.show(\"Duplicate value cannot be inserted\");\n}\n</code></pre>\n\n<p>I want this functionality. which can't be achieved using raiseerror. I dont want to give custom error message at back end.</p>\n\n<p>RAISEERROR should return below mentioned error when i pass ErrorNo to be thrown in catch</p>\n\n<blockquote>\n<pre><code>Msg 2627, Level 14, State 1, Procedure spOTest_DomainInsert,\n</code></pre>\n  \n  <p>Line 14\n      Violation of UNIQUE KEY constraint 'UK_DomainCode'. Cannot insert\n  duplicate key in object\n  'Tags.tblDomain'.\n      The statement has been terminated.</p>\n</blockquote>\n\n<p><strong>EDIT:</strong></p>\n\n<p>What can be the drawback of not using try catch block if i want exception to be handled at frontend considering stored procedure contains multiple queries that need to be executed</p>\n"},{"tags":["sql-server","tsql","transactions","rollback"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2210,"score":4,"question_id":3997271,"title":"SQL Server 2008 Transaction, rollback required?","body":"<p>I have a stored procedure that has a <code>BEGIN TRANSACTION</code> and <code>COMMIT TRANSACTION</code> statement. Within the transaction is a select query <code>WITH(XLOCK, ROWLOCK)</code>. </p>\n\n<p>The transaction can potentially fail due to some calculations that cause an arithmetic overflow error if out of bounds values are supplied. This error would happen before any insert/update statements.</p>\n\n<p>My question is, should I wrap the transaction in a TRY/CATCH and rollback or is this not really required and all locks would be released automatically if the transaction fails? My only concern here is that SQL would not release all locks of the transaction in case the transaction fails.</p>\n\n<p>Thanks,</p>\n\n<p>Tom</p>\n"},{"tags":["sql-server","sql-server-2012"],"answer_count":3,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":165,"score":8,"question_id":12869241,"title":"SQL Server 2012 Web Management Studio - where are all the options?","body":"<p>I just installed SQL Server 2012 Web version, and I noticed that a lot of the options that were in the previous versions of SQL Server Management Studio aren't available in this version.</p>\n\n<p>Simple things like right-clicking on a table and choosing \"Design\", or \"Edit top 200 rows\" and \"Select top 1000 rows\".</p>\n\n<p>Do I need to install something else? Are these options in other places?</p>\n"},{"tags":["sql-server","csv","bulkinsert"],"answer_count":9,"favorite_count":5,"up_vote_count":15,"down_vote_count":0,"view_count":27416,"score":15,"question_id":782353,"title":"SQL Server Bulk insert of CSV file with inconsistent quotes","body":"<p>Is it possible to BULK INSERT (SQL Server) a CSV file in which the fields are only OCCASSIONALLY surrounded by quotes? Specifically, quotes only surround those fields that contain a \",\".</p>\n\n<p>In other words, I have data that looks like this (the first row contain headers):</p>\n\n<pre><code>id, company, rep, employees\n729216,INGRAM MICRO INC.,\"Stuart, Becky\",523\n729235,\"GREAT PLAINS ENERGY, INC.\",\"Nelson, Beena\",114\n721177,GEORGE WESTON BAKERIES INC,\"Hogan, Meg\",253\n</code></pre>\n\n<p>Because the quotes aren't consistent, I can't use '\",\"' as a delimiter, and I don't know how to create a format file that accounts for this.</p>\n\n<p>I tried using ',' as a delimter and loading it into a temporary table where every column is a varchar, then using some kludgy processing to strip out the quotes, but that doesn't work either, because the fields that contain ',' are split into multiple columns.</p>\n\n<p>Unfortunately, I don't have the ability to manipulate the CSV file beforehand.</p>\n\n<p>Is this hopeless?</p>\n\n<p>Many thanks in advance for any advice.</p>\n\n<p>By the way, i saw this post <a href=\"http://stackoverflow.com/questions/96448/sql-bulk-import-from-csv\">SQL bulk import from csv</a>, but in that case, EVERY field was consistently wrapped in quotes. So, in that case, he could use ',' as a delimiter, then strip out the quotes afterwards.</p>\n"},{"tags":["sql","sql-server","tsql","case"],"answer_count":5,"favorite_count":0,"up_vote_count":13,"down_vote_count":0,"view_count":36926,"score":13,"question_id":5487892,"title":"SQL Server: CASE WHEN OR THEN ELSE END => the OR is not supported","body":"<p>The OR in the WHEN part of a CASE statement is not supported, how to solve?</p>\n\n<pre><code>CASE ebv.db_no \n  WHEN 22978 OR 23218 OR 23219 THEN 'WECS 9500' \n  ELSE 'WECS 9520' \nEND as wecs_system \n</code></pre>\n"}]}
{"total":54452,"page":19,"pagesize":100,"questions":[{"tags":["sql","sql-server","ms-access"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":46,"score":0,"question_id":12989935,"title":"Query conversion from sql server to ms access","body":"<p>In my project i have to change my database from SQL server 2005 to MS access.But some of the queries are not working properly with MS Access.can anyone please convert the following query from sql to MS Access</p>\n\n<pre><code>SELECT l.id,\n        REPLACE(SUBSTRING(CONVERT(VARCHAR(20), l.app_date, 13), 1, 11), ' ', '/') AS app_date,\n        l.reason,\n        REPLACE(SUBSTRING(CONVERT(VARCHAR(20), l.fromdate, 13), 1, 11), ' ', '/') AS fromdate,\n        REPLACE(SUBSTRING(CONVERT(VARCHAR(20), l.todate, 13), 1, 11), ' ', '/') AS todate,\n        lt.LeaveDesc,\n        l.noofdays,\n        e.Abbv_name,\n        e1.Abbv_name AS Expr1,\n        l.Typeofleave AS Leave_ID\nFROM leave AS l\nINNER JOIN LeaveTypes AS lt\n        ON l.Typeofleave = lt.TypeofLeave\nLEFT JOIN Employee AS e1\n        ON l.HRby = e1.Emp_id\nLEFT JOIN Employee AS e\n        ON l.approveby = e.Emp_id\nWHERE l.submitby = 2\n        AND submit = 'Y'\n        AND approved IS NULL\n</code></pre>\n\n<p>In the above query leave is a table of my database.Thanks in advance...</p>\n"},{"tags":["sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12992373,"title":"Change the value of one column based on the value of another column","body":"<p>Lets say i have a table like so...</p>\n\n<pre><code>ITEM#     ItemType     SIZE\n1         Car          5.20\n2         Watch        2.00\n3         Watch        7.50\n4         Watch        6.40\n5         Car          5.00\n6         Car          4.30\n</code></pre>\n\n<p>I would like to select all rows but whenever the ItemType = 'Car' I would like the value for SIZE to be returned as null.</p>\n\n<p>I have tried using</p>\n\n<pre><code>CASE When ItemType = 'Car'\nThen SIZE = null\nEND\n</code></pre>\n\n<p>but this does not work.</p>\n\n<p>Many thanks!</p>\n"},{"tags":["sql-server","query","code-efficiency"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12988372,"title":"How can I make this query more efficient by reducing index seeks?","body":"<p>I have a function which I want to be more efficient. I know that most of the cost is in seeking index. I want to know if there is a way to merge these two index seeks into one.</p>\n\n<p>Here is my function</p>\n\n<pre><code>ALTER FUNCTION [dbo].[Search]\n(\n    @Query nvarchar(150)        \n)\nRETURNS @result TABLE \n(\n    ID int,\n    ResultPhrase nvarchar(max),\n    Domain nvarchar(50)\n)\nAS\n\nBEGIN\n\ndeclare  @id int,\n         @OffsetArticle nvarchar(50),\n         @OffsetProfile nvarchar(50),\n         @index int,\n         @domain nvarchar(50),\n         @StringResult nvarchar(max),\n         @substrIndex int,\n         @substrCount int,\n         @field nvarchar(40),\n         @begin int,\n         @end int\n\n        DECLARE pidCursor CURSOR FAST_FORWARD\n        FOR select id,OffsetArticle,OffsetProfile from PerfTest where contains (data,@Query)\n\n        open pidCursor\n        FETCH NEXT FROM pidCursor INTO @id,@OffsetArticle,@OffsetProfile\n\n        while (@@FETCH_STATUS = 0)\n        begin\n\n        select @index = CHARINDEX(@Query,data) from PerfTest where ID=@id\n\n        exec @domain =  dbo.FindDomain @id=@id ,@index=@index, @offsetArticle=@OffsetArticle, @offsetProfile=@OffsetProfile\n\n\n        if(@domain = N'Profile')\n            set @end = SUBSTRING(@offsetProfile,CHARINDEX(N'-',@offsetProfile)+1,len(@offsetProfile)-CHARINDEX(N'-',@offsetProfile))\n            set @begin = SUBSTRING(@offsetProfile,1,CHARINDEX(N'-',@offsetProfile)-1)\n\n        if(@domain = N'Article')\n            set @end = SUBSTRING(@OffsetArticle,CHARINDEX(N'-',@OffsetArticle)+1,len(@OffsetArticle)-CHARINDEX(N'-',@OffsetArticle))\n            set @begin = SUBSTRING(@OffsetArticle,1,CHARINDEX(N'-',@OffsetArticle)-1)\n\n\n\n        if(@index - 20 &lt; CAST(@begin as int))\n            set @substrIndex = @index\n        else\n            set @substrIndex = @index - 20\n\n        if(@index + 150 &gt; CAST(@end as int))\n            set @substrCount = @end\n        else\n            set @substrCount = @index + 150 \n\n\n        select @StringResult = SUBSTRING(data,@substrIndex,@substrCount) from PerfTest where ID=@id\n\n        insert @result (id,ResultPhrase,Domain) values (@id,@StringResult,@domain)\n\n\n        if(@@FETCH_STATUS = 0)\n            FETCH NEXT FROM pidCursor INTO @id,@OffsetArticle,@OffsetProfile\n\n        end\n        CLOSE pidCursor\n        DEALlOCATE pidCursor\n\nRETURN      \nEND\n</code></pre>\n"},{"tags":["sql-server","reporting-services","ssrs-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":12891812,"title":"Interactive sorting requires two hits to work","body":"<p>A small annoyance which is hopefully easily solved.</p>\n\n<p>I've got a simple SSRS tablix with interactive sorting on the first column which is also the only group in the report and made up of strings.</p>\n\n<p>I've added interactive sorting to this column like so:</p>\n\n<p><img src=\"http://i.stack.imgur.com/gd450.png\" alt=\"enter image description here\"></p>\n\n<p>Initially when the report is rendered it is sorted alphabetically; this is done via the sorting property of the Group <code>RepOperName</code>. </p>\n\n<p>Why when I look at report in the web portal when I hit this interactive button the first time nothing happens i.e it is originally sorted A-Z and it stays sorted A-Z; only when I hit it the second time does it become sorted Z-A - how do I get around this so that it goes Z-A the first time I hit the interactive button?</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":12990727,"title":"SQL Server same query, same data, copy of same database but different behaviour","body":"<p>I am puzzled and would appreciate some help fixing this issue. I have a local install of SQL Server 2008 Standard and an install of SQL Server 2008 Express on another machine. Both machines are Windows 7 machines and I believe 64bit. </p>\n\n<p>Weird thing I have noticed is that my queries don't seem to work the very same way on both machines. One one machine, a particular script could display 10 lines of data for output but the other database (on another machine) would display as much as 20 rows for the same script, same data, and same database tables/objects. </p>\n\n<p>How to explain this and what to do to ensure consistency across machines please? </p>\n"},{"tags":["sql-server"],"answer_count":9,"favorite_count":7,"up_vote_count":48,"down_vote_count":0,"view_count":78586,"score":48,"question_id":33409,"title":"How do I check if a SQL Server text column is empty?","body":"<p>I am using SQL Server 2005.  I have a table with a text column and I have many rows in the table where the value of this column is not null, but it is empty.  Trying to compare against '' yields this response:</p>\n\n<blockquote>\n  <p>The data types text and varchar are incompatible in the not equal to operator.</p>\n</blockquote>\n\n<p>Is there a special function to determine whether the value of a text column is not null but empty?</p>\n"},{"tags":["php","sql-server","php-extension","zend-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1369,"score":0,"question_id":6062455,"title":"How to install sqlsrv php driver on zend server?","body":"<p>I downloaded <em>\"Microsoft Drivers for PHP for SQL Server (V 2.0.1)\"</em> from <a href=\"http://www.microsoft.com/downloads/details.aspx?displaylang=en&amp;FamilyID=80e44913-24b4-4113-8807-caae6cf2ca05\" rel=\"nofollow\">Microsoft website</a> and move it to <strong>php_sqlsrv_5.3_nts_vc6.dll</strong> to <em>\"C:\\Program Files\\Zend\\ZendServer\\lib\\phpext\\\"</em> next to <em>\"php5.dll\"</em>.</p>\n\n<p>then go to Zend server Panel \"Server Setup > Extensions\" to turn it on. after restarting php, Zend Server says: \"The system could not load this extension\"!</p>\n\n<p>What should I do?</p>\n\n<p><strong>P.S</strong>: Zend Configured on Apache</p>\n\n<p><strong>edit</strong>: I also tried \"php_sqlsrv_5.3_ntc_vc9.dll\" but it failed either!</p>\n\n<p><img src=\"http://i.stack.imgur.com/xHSEm.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":2355602,"title":"how to pass this information to SQL Server 2008?","body":"<p>Please visit <a href=\"http://www.stumbleupon.com/\" rel=\"nofollow\">http://www.stumbleupon.com/</a></p>\n\n<p>It asks you what interests you.</p>\n\n<p>I would have a similar thing on my website except I would need to have 4 of such non-identical blocks. When a user has not selected anything in a section, it means s/he has selected all of them. 1 of these blocks would have around 10 options while the other 3 would have 2-3 options each.</p>\n\n<p>How do I pass what all a user has selected to SQL Server 2008? Please note I would have 4 sets of multiple params, and these 4 sets are basically 4 different columns in the row all containing integer id's. If and only if one param per section was passed, I would have done something like</p>\n\n<p>select * from table where column1 = @param1, column2 = @param2 and so on.</p>\n\n<p>but that is not the case, because a user could pass multiple values for @param1 and so on.</p>\n\n<p>I can get this done, but I want to know the most efficient way.</p>\n\n<p>If my post is not clear, please let me know. </p>\n\n<p>EDIT: \nBasically, if I am storing articles in the database, I have 4 columns in the row, each integer.  And I want to query these articles based on these 4 columns, but the catch is to pass the multiple values for these columns NOT just one value per column.</p>\n"},{"tags":["sql-server","redgate"],"answer_count":4,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":504,"score":5,"question_id":2187763,"title":"What other products are similar to Redgate's SQL Search?","body":"<p>What other products are similar to Redgate's SQL Search?</p>\n\n<p>Redgate just released \"SQL Search\" in Feb 2010.</p>\n\n<p><a href=\"http://www.red-gate.com/products/SQL_Search/index.htm\" rel=\"nofollow\">http://www.red-gate.com/products/SQL_Search/index.htm</a></p>\n\n<p>I am still amazed this type of search is not already \nbuilt into SQL Server Management Studio.</p>\n\n<p><strong>Updated:</strong>\nIf you are curious. Here is the story how SQL Search got developed.</p>\n\n<p><a href=\"http://www.simple-talk.com/community/blogs/robertchipperfield/archive/2009/11/10/76194.aspx\" rel=\"nofollow\">http://www.simple-talk.com/community/blogs/robertchipperfield/archive/2009/11/10/76194.aspx</a></p>\n\n<p>I agree with some of the post, that it is not fully cooked yet, but after reading it was developed in 1 week, I guess we will have to cut them some slack. :)</p>\n"},{"tags":["sql-server","reporting-services"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2018,"score":1,"question_id":582423,"title":"Disable hyperlinks when exporting SSRS report to excel","body":"<p>I am using the ReportViewer control to render some local reports. These reports have some elements that are links to supreports. Some of these elements contain a lot of data ( to be passed as arguments to subreport). The problem is when i export the report to excel, it wont open in excel because of the cell max character limit. I am wondering if its possible to disable/remove certain columns from this report when exporting to excel. I have tried to use the DeviceInfo setting and trying to disable formulas but that did not help much.</p>\n\n<p>many thanks</p>\n"},{"tags":["sql-server"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":7644,"score":1,"question_id":390362,"title":"Using variable in SQL LIKE statement","body":"<p>I've got a sproc (MSSQL 2k5) that will take a variable for a LIKE claus like so:</p>\n\n<pre><code>DECLARE @SearchLetter2 char(1)\n\nSET @SearchLetter = 't'\nSET @SearchLetter2 = @SearchLetter + '%'\n\nSELECT *\n    FROM BrandNames \n    WHERE [Name] LIKE @SearchLetter2 and IsVisible = 1 \n    --WHERE [Name] LIKE 't%' and IsVisible = 1 \n    ORDER BY [Name]\n</code></pre>\n\n<p>Unfortunately, the line currently running throws a syntax error, while the commented where clause runs just fine.  Can anyone help me get the un-commented line working?</p>\n\n<p>Thanks in advance!</p>\n\n<p>--Joel</p>\n"},{"tags":["php","sql-server","sql-server-2005","sql-server-2005-express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":170,"score":0,"question_id":8228494,"title":"windows 7, php 5.3, when fetching binary data with sqlsrv from mssql the data is doubled","body":"<p>ok, so I have images on a MSSQL 2005 (express) server which I want to write to files.\nwith the same piece of code, on linux it works fine, on windows it writes the data twice in the file</p>\n\n<pre><code>file_put_contents($file, $val);\n$val = basename($file);\n</code></pre>\n\n<p>I know it is not a file_put_contents() problem because I also tried with fwrite\nthe output file in windows has double the size it has in linux</p>\n\n<pre><code>-rw-rw-r-- 1 dimitris dimitris  891768 2011-11-22 16:13 eshop_products__2201.jpg\n-rw-rw-r-- 1 dimitris dimitris  445884 2011-11-21 19:15 eshop_products__2201_linux.jpg\n</code></pre>\n\n<p>I am using the freetds driver for linux and php_pdo_sqlsrv_53_nts_vc9 in windows</p>\n\n<p>any ideas on something I could do to get the correct data in windows? maybe some configuration I missed?</p>\n\n<p>topmost bytes of each file:</p>\n\n<p>windows file:</p>\n\n<pre><code>ASCII (php substr):\nFFD8FFE000104A46494600010100000100010000FFDB0043000302020302020303030304030304050805050404050A070706080C0...etc...\n\nhex:\n00000000:  46 46 44 38 46 46 45 30  30 30 31 30 34 41 34 36  FFD8FFE000104A46\n00000010:  34 39 34 36 30 30 30 31  30 31 30 30 30 30 30 31  4946000101000001\n00000020:  30 30 30 31 30 30 30 30  46 46 44 42 30 30 34 33  00010000FFDB0043\n00000030:  30 30 30 33 30 32 30 32  30 33 30 32 30 32 30 33  0003020203020203\n00000040:  30 33 30 33 30 33 30 34  30 33 30 33 30 34 30 35  0303030403030405\n00000050:  30 38 30 35 30 35 30 34  30 34 30 35 30 41 30 37  0805050404050A07\n00000060:  30 37 30 36 30 38 30 43  30 41 30 43 30 43 30 42  0706080C0A0C0C0B\n</code></pre>\n\n<p>linux file:</p>\n\n<pre><code>ASCII (php substr):\nJFIFC\n\nhex:\n00000000:  ff d8 ff e0 00 10 4a 46  49 46 00 01 01 00 00 01  ......JFIF......\n00000010:  00 01 00 00 ff db 00 43  00 03 02 02 03 02 02 03  .......C........\n00000020:  03 03 03 04 03 03 04 05  08 05 05 04 04 05 0a 07  ................\n00000030:  07 06 08 0c 0a 0c 0c 0b  0a 0b 0b 0d 0e 12 10 0d  ................\n00000040:  0e 11 0e 0b 0b 10 16 10  11 13 14 15 15 15 0c 0f  ................\n00000050:  17 18 16 14 18 12 14 15  14 ff db 00 43 01 03 04  ............C...\n00000060:  04 05 04 05 09 05 05 09  14 0d 0b 0d 14 14 14 14  ................\n00000070:  14 14 14 14 14 14 14 14  14 14 14 14 14 14 14 14  ................\n</code></pre>\n\n<p>The code extracting the file from the database is base on the yii framework, using yii's commands feature (php cli)</p>\n\n<p>Connection strings:</p>\n\n<p>linux</p>\n\n<pre><code>'connectionString' =&gt; 'dblib:host=192.168.56.101;port=1433;dbname=mssqldb',\n</code></pre>\n\n<p>windows</p>\n\n<pre><code>'connectionString' =&gt; 'sqlsrv:Server=192.168.56.101;Database=mssqldb',\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>$rows = $this-&gt;db-&gt;createCommand(\"SELECT * FROM $viewName WHERE 1=1\")-&gt;queryAll();\n\n/*\n * Convert charset and extract photos from view\n */\nforeach ($rows as $row) {\n    // convert charset / export photos\n    foreach ($row as $key =&gt; &amp;$val) {\n        // charset conversion, on fields that do not contain photos\n        // $viewCfg is an array I maintain to know which field does what\n        if (empty($viewCfg['photos']) || !in_array($key, $viewCfg['photos'])) {\n            $val = @iconv(\"Windows-1253\", \"UTF-8\", $val);\n        // grab image in file\n        } else {\n            $id = '';\n            foreach ($viewCfg['keys'] as $fieldName) {\n                $id .= '_' . $row[$fieldName];\n            }\n\n            $file = Yii::app()-&gt;params['pathPhotos'] . '/' . $viewName . '_' . $id . '.jpg';\n\n            if ($val) {\n                if (file_exists($file) &amp;&amp; (file_get_contents($file)!=$val))\n                    unlink($file);\n\n                file_put_contents($file, $val);\n                $val = basename($file);\n            }\n        }\n    }\n// ... do the rest\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","stored-procedures","calculated-columns"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12982418,"title":"How can I roll up rate-of-return into net asset value in SQL?","body":"<p>Given the starting value <code>@pStartingValue</code> and a table which contains <code>rorDate</code> and <code>ror</code> what is the most efficient way to get the NAV at each date using just TSQL?</p>\n\n<p>This mathematically trivial, and simple in code. I have a naive SQL implementation currently that relies on cursors.</p>\n\n<p>On the first date, the NAV is @pStartingValue * ror<br>\nOn every subsequent date, it's the previously calculated nav * ror <strong>or</strong> it's @pStartingValue * every previous ror</p>\n\n<p>How would you efficiently do this only in MSSQL2005+?</p>\n\n<pre><code>DECLARE @rorDate DATE\nDECLARE @getDate CURSOR\nDECLARE @lastNAV as DECIMAL(19,7)\nDECLARE @datedRoR as float\nDECLARE @NAVTotals TABLE\n(\n  NAV DECIMAL(19,7),\n  navDate DATE\n)\n\n\nSET @lastNAV = 100\n\nSET @getDate = CURSOR FOR\n    SELECT \n        p.[DATE]\n    FROM \n        performance p \n    ORDER BY \n        p.[DATE]\n\nOPEN @getDate\nFETCH NEXT\nFROM @getDate INTO @rorDate\nWHILE @@FETCH_STATUS = 0\nBEGIN\n\nSELECT \n    @datedRoR = b.finalNetReturn \nFROM \n    performance b \nWHERE \n    b.date = @rorDate\n\nINSERT INTO @NAVTotals (NAV, navDate)\n  VALUES (@lastNAV * (1 + @datedRoR), @rorDate)\n\nSELECT \n    @lastNAV = c.NAV \nFROM \n    @NAVTotals c \nWHERE \n    c.navDate = @rorDate  \n\n\nFETCH NEXT\nFROM @getDate INTO @rorDate\nEND\nCLOSE @getDate\nDEALLOCATE @getDate\n\nselect * from @NAVTotals\n</code></pre>\n"},{"tags":[".net","sql-server","stored-procedures"],"answer_count":9,"favorite_count":2,"up_vote_count":30,"down_vote_count":0,"view_count":38617,"score":30,"question_id":368642,"title":"Procedure expects parameter which was not supplied","body":"<p>I'm getting the error when accessing a Stored Procedure in SQL Server</p>\n\n<p>Server Error in '/' Application.\nProcedure or function 'ColumnSeek' expects parameter '@template', which was not supplied. </p>\n\n<p>This is happening when I call a Stored Procedure with a parameter through .net's data connection to sql (System.data.SqlClient), even though I am supplying the parameter. Here is my code.</p>\n\n<pre><code>SqlConnection sqlConn = new SqlConnection(connPath);\nsqlConn.Open();\n\n// METADATA RETRIEVAL\nstring sqlCommString = \"QCApp.dbo.ColumnSeek\";\nSqlCommand metaDataComm = new SqlCommand(sqlCommString, sqlConn);\nmetaDataComm.CommandType = CommandType.StoredProcedure;\nSqlParameter sp = metaDataComm.Parameters.Add(\"@template\", SqlDbType.VarChar, 50);\nsp.Value = Template;\n\nSqlDataReader metadr = metaDataComm.ExecuteReader();\n</code></pre>\n\n<p>And my Stored Procedure is:</p>\n\n<pre><code>   USE [QCApp]\n   GO\n   SET ANSI_NULLS ON\n   GO\n   SET QUOTED_IDENTIFIER ON\n   GO\n\n   ALTER PROCEDURE [dbo].[ColumnSeek] \n       @template varchar(50)\n   AS\n   EXEC('SELECT Column_Name, Data_Type FROM [QCApp].[INFORMATION_SCHEMA].[COLUMNS] \n   WHERE TABLE_NAME = ' + @template);\n</code></pre>\n\n<p>I'm trying to figure out what I'm doing wrong here.</p>\n\n<p>Edit: As it turns out, Template was null because I was getting its value from a parameter passed through the URL and I screwed up the url param passing (I was using @ for and instead of &amp;)</p>\n"},{"tags":["c#","sql-server","entity-framework","tsql","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":69,"score":0,"question_id":12990538,"title":"How to convert this SQL query to LINQ to Entities query?","body":"<p>I need help to convert a SQL query to entity query in my C# code.\nThe query combines 4 different tables together which is as follows:</p>\n\n<pre><code>SELECT a.email,\n       a.status,\n       a.createdat,\n       b.unitprice,\n       c.name,\n       d.name,\n       e.name \nFROM Orders a, \n     Orderdetails b, \n     ServiceOptions c, \n     services d, \n     merchants e \nWHERE a.id=b.orderid AND c.id=b.serviceoptionid\n      AND c.serviceid=d.id AND d.merchantid=e.id\n</code></pre>\n"},{"tags":["c#",".net","sql-server","asp.net-mvc","asp.net-web-api"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":12990613,"title":"What are the good practise for storing document with sensitive data","body":"<p>My question is what are the good practise's to store document with sensitive data that might need encryption.</p>\n\n<blockquote>\n  <p>Few thoughts that I have are: 1) Store all document in Sql Server as\n  FILESTREAM (don't know the drawback's of it. 2) Use one of these NoSql\n  Db. But then how safe it will be to keep documents with sensitive data.\n  3) Simple way upload them and store them on disk for every customer\n  with security.</p>\n  \n  <p>The technology I will be using is xUnit, ASP.NET\n  MVC 4, C#, Web API, Entitty Framework and Sql Server 2012</p>\n</blockquote>\n\n<p>Any idea's or opinions will be highly appreciated</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":54,"score":-1,"question_id":12972667,"title":"Query for multiple joins","body":"<p>i have 3 tables named dataset,dataelem and transformdataelem with column names as below:</p>\n\n<pre><code>main.Dataset \n------------\ndatasetID (PK)\napplicationID\n\nmain.Dataelem\n------------- \ndataelemID(PK)\ndatasetID(FK)\ndataelemname\nbiztermID\n\nmain.Transformdataelem\n----------------------\nOutputdataelemID\nInputdataelemID\n</code></pre>\n\n<p>My requirement is:</p>\n\n<p>All tables are referenced.</p>\n\n<p>Extract all the dataelemId rows from dataelem table where applicationID of dataset table is equal to 1044 and biztermid should be null.</p>\n\n<p>Then whatever resultant dataelemIDs from the above query should be matched with outputdataelemID of Transformdataelem table and we should get the respective input dataelemId's.</p>\n\n<p>Again with these matched <code>inputdataelemID</code>'s we should get the <code>dataelemname</code>'s from datelem table.</p>\n"},{"tags":["python","sql-server","python-2.7"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":41,"score":-2,"question_id":12990203,"title":"Which Microsoft SQL library should I download","body":"<p>I want to connect sql server with python... but I don't know which one download...</p>\n\n<p>Here the <a href=\"http://www.microsoft.com/en-us/download/search.aspx?q=sql%20server%20service%20pack\" rel=\"nofollow\">link</a></p>\n"},{"tags":["php","sql","sql-server","linux"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":130,"score":0,"question_id":8332420,"title":"mssql_connect stopped working mysteriously","body":"<p>I have a linux box that overnight decided to start acting up. I have two different errors that have appeared.  </p>\n\n<p>My php script runs the following:</p>\n\n<pre><code>$sql_connect = @mssql_connect($SQLServer, $SQLUser, $SQLPass) or die(\"Some message about this not working\\n\");\n</code></pre>\n\n<p>And I get the error:</p>\n\n<blockquote>\n  <p>PHP Warning:  [IM002][0][Microsoft][ODBC Driver Manager] Data source name not found and no default driver specified in /var/php/autocreate-new-students.php on line 23</p>\n</blockquote>\n\n<p>In a separate script, pointing to a different box, I run the exact same line (different server/user/password information) and the die message echoes back to me.</p>\n\n<p>I verified username/passwords, updates, firewalls, logs, services.. There were absolutely no changes or installs to any box during the time period when it stopped working.</p>\n\n<p>I was thinking there might be a certificate of some kind that expired, but I'm not experienced enough in Linux to investigate.  Any suggestions what may have caused this problem to appear?</p>\n"},{"tags":["sql-server","sql-server-2008","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":109,"score":-1,"question_id":12989306,"title":"SQL Server row values as column names Pivot Table?","body":"<p>I have the following view in SQL Server 2008.</p>\n\n<pre><code>DEPT | EMP_ID | EMP_NAME | P_DATE  | HOURS_WORKED\n</code></pre>\n\n<p>I want the view to be this way:</p>\n\n<pre><code>DEPT | EMP_ID | EMP_NAME | 2012-09-28 | 2012-09-29 | 2012-09-30 | 2012-10-01 ...\n</code></pre>\n\n<p>where the above date column header is P_DATE below which is \"Hours_Worked\" values of that employee on that particular date.</p>\n\n<p>Like</p>\n\n<pre><code>2012-09-28\n\n09:00:00\n\n10:00:00\n</code></pre>\n\n<p>I am not sure whether I could achieve it using Pivot.</p>\n\n<p>Please go to this link for clear understanding : <a href=\"http://imgur.com/a/82eSo\" rel=\"nofollow\" title=\"SQL Server view images\">SQL Server View Snapshots</a></p>\n"},{"tags":["c#",".net","sql-server","windows-xp","cultureinfo"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":1,"question_id":12989737,"title":"CultureInfo.GetCultures Fail","body":"<p>I've been trying to install SQL Server 2008 x86 on a Windows XP SP3 32bit machine with little luck.</p>\n\n<p>I get the error:</p>\n\n<pre><code>The name 'ldl-b.dlldl' contains characters that are not valid for a Culture or Region.\nParameter name: cultureName\n</code></pre>\n\n<p>I have posted the issue to msdn <a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlsetupandupgrade/thread/4372c6b9-9dcf-4475-b3c0-c000d33dcaa3/#18f7fffd-be32-46e4-8520-09a0e5fdd226\" rel=\"nofollow\">here</a>.</p>\n\n<p>When I checked up the exception myself, I noticed that the following code doesn't work on my machine:</p>\n\n<pre><code>CultureInfo[] cultures = CultureInfo.GetCultures(CultureTypes.SpecificCultures);\n</code></pre>\n\n<p>It throws the above exception.</p>\n\n<p>What could be wrong in my machine? Any regional setting issue that I can resolve?</p>\n"},{"tags":["sql-server"],"answer_count":6,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":11353,"score":7,"question_id":738282,"title":"How do you count the number of occurrences of a certain substring in a SQL varchar?","body":"<p>I have a column that has values formatted like a,b,c,d. Is there a way to count the number of commas in that value in T-SQL?</p>\n"},{"tags":["asp.net","sql-server","visual-studio-2010"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12987158,"title":"Modifying SQL Server database table from Server Explorer in Visual Studio.NET","body":"<p>I am using a SQL Server database from Server Explorer in Visual Studio.NET for an ASP.NET application, and I need to change some table fields' data type from <code>int</code> to <code>uniqueidentifier</code>. I get the following error message: </p>\n\n<blockquote>\n  <p>Conversion from 'int' to 'uniqueidentifier' is not supported on the connected database server.</p>\n</blockquote>\n\n<p>Can I get some help how can I do this modification, thanks?</p>\n"},{"tags":["sql-server","oracle","ado.net","microsoft","odp.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12988478,"title":"Is SQL dependency notification an Ansi requirement?","body":"<p>I am considering implementing Oracle dependency notification in a production environment after successful demonstration of the same in Development environment. \nOne of the question that came up during the demonstration was 'Could this technique be implemented on other databases ?'. \nWell , I was not sure, but surfing around I found that ADO.Net too provide the same feature for sql 2005 on wards with less or more functionality.<br>\nJust curious to know if the 'Dependency notifications' is an ANSI requirement or MS is offering this feature to not to be seconded to Oracle ...If it is an ANSI requirement, then it is likely other vendors too offer this ANSI prescribed feature.</p>\n"},{"tags":["sql-server","sql-server-2008","linked-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12458052,"title":"Linked Server Insert-Select Performance","body":"<p>Assume that I have a table on my local which is <code>Local_Table</code> and I have another server and another db and table, which is <code>Remote_Table</code> (table structures are the same).</p>\n\n<p><code>Local_Table</code> has data, <code>Remote_Table</code> doesn't. I want to transfer data from <code>Local_Table</code> to <code>Remote_Table</code> with this query:</p>\n\n<pre><code>Insert into RemoteServer.RemoteDb..Remote_Table\nselect * from Local_Table (nolock)\n</code></pre>\n\n<p>But the performance is quite slow.</p>\n\n<p>However, when I use SQL Server import-export wizard, transfer is really fast.</p>\n\n<p>What am I doing wrong? Why is it fast with Import-Export wizard and slow with insert-select statement? Any ideas?</p>\n"},{"tags":["asp.net","sql","sql-server","asp.net-mvc","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":155,"score":7,"question_id":12983539,"title":"Stored procedures in SQL Server master-child relationships not tables","body":"<p>In college last year I came across something I found very interesting with regard to stored procedures. It was mostly with regard to reducing code repetition for transaction management, error handling, and security. But I have researched it since and cannot find it anywhere. Perhaps I don't know what it is called so I will explain.</p>\n\n<p>Let's say I have a simple table (forget its relationships, just a single table). I have at least 5 possible operations I can do on it namely CRUD, with the R being read the details of one row, or read a list of rows for a given criteria. Again, let's not get into too much detail with complicated stored procedures and let's pretend, for this example, we want nothing but the following 5 operations to be performed:</p>\n\n<ul>\n<li>Create (simple insert)</li>\n<li>Read (one for reading a single row)</li>\n<li>Read multiple (reading a list of rows, simple <code>select * from sometable where some condition</code>, nothing complicated), </li>\n<li>Update (simple update)</li>\n<li>Delete (again, simple delete). </li>\n</ul>\n\n<p>For the purposes of this example, a simple table with 2 or 3 columns, and the most simple procedures you can come up with to do those operations.</p>\n\n<p><strong>The problem</strong>:</p>\n\n<p>My lecturer, when talking to us about transactions, advised us to take these simple procedures, and keep them separate as is normal. But then to write a master procedure which executes each of these. This means we have a master procedure into which we pass a character lets say 'C' for create and so on, and a series of conditions which decide which job to run. Of course, we should pass in the details needed from the master to the child proc which means we need to get them from the user as parameters. This master procedure is already beginning to sound complicated.</p>\n\n<p>His reasoning, do the transaction handling, validation, error handling, and security handling in the master procedure. Then call that master procedure with the required parameters, which does all the checking, and passes the parameters to the child procedure. Below is an example.</p>\n\n<p><img src=\"http://i.stack.imgur.com/nnSly.jpg\" alt=\"enter image description here\"></p>\n\n<p>Simple table, don't go worrying too much about relationships, keys, indexes, constraints, triggers and so on.</p>\n\n<p>For the below two pieces of code, the only real relevant bit is the parts between the try...catch. The rest is boiler plate for the master.</p>\n\n<p>Below is the code for a create procedure:</p>\n\n<pre><code>ALTER proc [Actions].[AreaCreate]\n--External Variables - Input\n@AreaName varchar(50),  @AreaAvailablity bit,   @Description varchar(max),\n\n--External Variables - Output\n@NoOfRecords int output\n\nas\n--Internal Variables\ndeclare @ErrorMessage varchar(max)\n\nBegin try\n    insert  [Tennis3rdYrMVC].[dbo].Areas\n            ([AreaName],    [AreaAvailablity],  [Description])\n    values  (@AreaName,     @AreaAvailablity,   @Description)\n\n    --Show # of records affected so you can detect nulls or empty lists\n    --and handle them as you choose in the code\n    set     @NoOfRecords = @@ROWCOUNT\nEnd try\nBegin Catch\n    set @ErrorMessage = ERROR_MESSAGE()\n    raiserror(@ErrorMessage,16,1)\n    return ERROR_NUMBER()\nEnd Catch\n\n--All Ok\nreturn 0\n</code></pre>\n\n<p>Below is another piece of code for a delete procedure</p>\n\n<pre><code>ALTER proc [Actions].[AreaDelete]\n--External Variables - Input\n@Id int,\n\n--External Variables - Output\n@NoOfRecords int output\n\nas\n--Internal Variables\ndeclare @ErrorMessage varchar(max)\n\nbegin try\n    delete from [Tennis3rdYrMVC].[dbo].Areas\n    where Id = @Id\n\n    --Show # of records affected so you can detect nulls or empty lists\n    --and handle them as you choose in the code\n    set @NoOfRecords=@@ROWCOUNT\nend try\nbegin catch\n    set @ErrorMessage = ERROR_MESSAGE()\n    raiserror(@ErrorMessage,16,1)\n    return ERROR_NUMBER()\nend catch\n\n--All Ok\nreturn 0\n</code></pre>\n\n<p>Finally, the suggested, and complicated master proc.</p>\n\n<pre><code>ALTER proc [Admin].[AreaMaster]\n--External Variables - Input\n@JobType int, -- 1=Create, 2=Read 1, 3=Read Many, 4=Update, 5=Delete\n--Master sprock uses null defaults because not every job requires every field to be present.\n--i.e. We dont need to know the area name of an area we want to delete.\n@Id int                 = null,     @AreaName varchar(50)       = null,\n@AreaAvailablity bit    = null,     @Description varchar(max)   = null,\n\n--External Variables - Output\n@NoOfRecords int = null output --Used to count the number of records affected where needed.\nas\nBEGIN\n    --Internal Variables\n    declare @ErrorMessage varchar(max)\n    declare @return_value int\n\n    -- SET NOCOUNT ON added to reduce network traffic and speed things up a little.\n    SET NOCOUNT ON;\n\n    /*\n    --VALIDATION\n\n    --Logic for ensuring all required values are entered should be done in processing below in\n    --the master sprock, NOT in the children (i.e. why check for valid id in 5 sprocks when you\n    --can do it here in one).\n\n\n    We will do all the processing needed to ensure valid and required values are entered where\n    needed.\n\n    --SECURITY\n    This is also where we put the security code required to stop SQL Injection and other\n    attacks, NOT in the child sprocks. The child sprocks would not be allowed to execute by\n    pages directly.\n\n    */\n\n    --Once all validation is done, call  relevant child sprocks\n\n    --Call AreaCreate Sprock\n    if(@JobType='1')\n    begin\n        exec    @return_value = [Actions].[AreaCreate]\n                @AreaName           = @AreaName,\n                @AreaAvailablity    = @AreaAvailablity,\n                @Description        = @Description,\n                @NoOfRecords        = @NoOfRecords OUTPUT\n\n        --select    @return_value 'Return Value'\n\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem creating area.',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n\n    --Call AreaShowDetail Sprock\n    if(@JobType='2')\n    begin\n        exec    @return_value   = [Actions].[AreaShowDetail]\n                @Id             = @Id,\n                @NoOfRecords    = @NoOfRecords output\n        ----Testing\n        --select    'Return Value' = @return_value\n\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem reading area details.',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n\n    --Call AreaShowList Sprock\n    if(@JobType='3')\n    begin\n        exec    @return_value   = [Actions].[AreasShowList]\n                @NoOfRecords    = @NoOfRecords output\n        ----Testing\n        --select    'Return Value' = @return_value\n\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem reading areas list.',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n\n    --Call AreaUpdate Sprock\n    if(@JobType='4')\n    begin\n        EXEC    @return_value = [Actions].[AreaUpdate]\n                @Id                 = @Id,\n                @AreaName           = @AreaName,\n                @AreaAvailablity    = @AreaAvailablity,\n                @Description        = @Description,\n                @NoOfRecords        = @NoOfRecords OUTPUT\n\n        --select    'Return Value'      = @return_value\n\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem updating area.',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n\n    --Call AreaDelete Sprock\n    if(@JobType='5')\n    begin\n        exec    @return_value   = [Actions].[AreaDelete]\n                @Id             = @Id,\n                @NoOfRecords    = @NoOfRecords output\n\n        --select    'Return Value'  = @return_value\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem deleting area(s).',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n    --All Ok\n    return 0\nEND\n</code></pre>\n\n<p>Is that complicated or what? Now imagine another level which if you have several tables to operate on, will decide which sub master to call, and this MasterMaster for want of a better name must have external parameters for every field in every table. However, the validation, security, and transaction code would be moved up to that level instead.</p>\n\n<p>More importantly, is that the way a professional would do it. And finally, I am using MVC with entity framework. Suppose I have a database like this (I have), and access is only allowed through this master stored procedure (it is). How do I call such a stored procedure from within EF and MVC. Even better, how would I bypass EF all together and get the data into my controller in a way my view will understand. I know how to do this with ASP.Net code behind. But not in MVC.</p>\n\n<p>Any suggestions. Please, feel free to tell me that this is completely crazy as it seems like a hell of a lot of work (what if you have 50 tables (I do). Imagine, 5 simple operations, across 50 tables = 250 child stored procedures + 50 Sub-Sub-Masters, + 5 Sub-Masters + 1 Master. I have my work cut out. Is there a tool that can do this or at least generate a template for me?</p>\n\n<p>So to summarise, My questions are:</p>\n\n<ol>\n<li>Is this overly complicated or is this the professional way to do this?</li>\n<li>What is the term used to describe this Master / child procedural relationship.</li>\n<li>Is there a tool that can automate this process.</li>\n<li>Is there a tool that can help me generate some kind of boilerplate template.</li>\n<li>How can I use this procedure with EF and MVC</li>\n<li>How can I bypass EF altogether and just find a way to call the procedure directly.</li>\n<li>Is there anything like the equivalent of classes, or even methods in T-SQL which can structure this much like a standard piece of code. Meaning that each child procedure is a method, each table has its properties, and the constructor will be the the initial (or altered) representation of the object.</li>\n<li>If 7 does exist, which would be more standard, the way I described (i.e.) splitting everything up, or the idea in 7.</li>\n</ol>\n\n<p>With regard to this point 4 I am talking about something simple, like the one already in SQL Server where you right click a procedure and choose execute and it generates some simple code for testing your procedure, or like the one for making functions.</p>\n\n<p>Thanks for reading this and for any help you can offer.</p>\n"},{"tags":["sql-server","tsql","vbscript","ssms","adodb"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12979025,"title":"SSMS is fast than Provider=SQLNCLI.1","body":"<p>I am using SQL native client in VB script to execute a query.<br>\nConnection string is   </p>\n\n<pre><code>ConCI.Open(\"Provider=SQLNCLI.1;Integrated Security=SSPI;Persist Security Info=False;Initial Catalog=\" &amp; CIDBName &amp; \";Data Source=\" &amp; CIServerName)\n</code></pre>\n\n<p>Query is   </p>\n\n<pre><code>SELECT COUNT(*) \nFROM statementheader WITH (nolock)\nWHERE statementdate &gt;=\n(\n    SELECT procdayend-1 \n    FROM\n    ARSystemAccounts\n) \nAND currentbalance &lt;= 0 \nAND dateoftotaldue IS NOT NULL\nAND systemstatus &lt;&gt; 14\n</code></pre>\n\n<p>SSMS takes 50 to 60 seconds to execute this query but VB script takes ages.<br>\nWhy is it so  and what should I do ?</p>\n"},{"tags":["sql-server",".net-3.5","scheduled-tasks"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":265,"score":1,"question_id":3135361,"title":"Scheduling tasks Advice? .Net, SQL Job?","body":"<p>I am creating a system where users can setup mailings to go out at specific times. Before I being I wanted to get some advice. First, is there already a .Net component that will handle scheduling jobs (either running another application or calling a URL) that will do what I am suggesting (Open Source would be cool)? If there isnt, is it better to schedule a job in SQL and run some sort of script, create a .Net service that will look at an xml file or db for schedules, or have an application create scheduled tasks? There could be a ton of tasks, so I am thinking creating scheduled tasks or SQL jobs might not be a good idea. \nHere may be a typical scenario; a user wants to send a newsletter to their clients. The user creates the newsletter on a Saturday, but doesnt want it to go out until Monday. The user wants that same e-mail to go out every Monday for a month. \nThanks for looking!</p>\n"},{"tags":["sql","sql-server","oracle11g"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12978882,"title":"What is the common sql for sysdate and getdate()","body":"<p>I need to use sysdate in both Oracle and SQL Server, but SQL Server has a GETDATE() function instead.</p>\n\n<p>But I don't want to create 2 separate queries</p>\n\n<p>Is there any specific common syntax which gives same output to sysdate and getdate in SQL Server and oracle  </p>\n"},{"tags":["sql-server","visual-studio-2010","database-project"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":582,"score":0,"question_id":6020447,"title":"Can a VS2010 Database Project create re-runnable deployment scripts?","body":"<p>Im using VS2010 Database Projects as a way of versioning our database code between release versions. So far, the solution provided seems good; however there is one problem I wonder if anyone else has run into.</p>\n\n<p>The upgrade scripts generated from the schema compare view are not re-runnable. As a standard, I normally ensure that all my database release scripts are re-runnable, just in case there should be any issues deploying the release script to a server. </p>\n\n<p>Does anyone know if there is a way to configure VS2010 to create re-runnable upgrade scripts i.e. drop sprocs only if they exist etc.?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-express"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1532,"score":0,"question_id":5956807,"title":"sp_dropserver and sp_addserver not working","body":"<p>I am using SQL Server Express 2008 R2 and I wanted to change the instance name from \"machine name\"\\SQLEXPRESS2008R2 to just \"machine name\".  I ran:</p>\n\n<pre><code>sp_dropserver 'old_name'\n\ngo\n\nsp_addserver 'new_name', 'local'\n\ngo\n</code></pre>\n\n<p>Then restarted the SQL Service.  Now when I look at </p>\n\n<pre><code>Select @@SERVERNAME --this is correct\n</code></pre>\n\n<p>But this isn't correct?</p>\n\n<pre><code>Select serverproperty('ServerName') --This still shows old name\n</code></pre>\n\n<p>So when I try to connect to my instance via SSMS I still have to connect using the old instance name isntead of the new on I just applied? What am I doing wrong? Why is the new name not taking?</p>\n\n<p>Thanks,</p>\n\n<p>S</p>\n"},{"tags":["sql-server","stored-procedures","decrypt"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":2766,"score":0,"question_id":1787629,"title":"Anyway to decrypt an encrypted sql server stored procedure?","body":"<p>I have a couple of ms sql server (2000) stored procedures encrypted by ex-employee long time ago and things were okay until we need to change it a bit.... is there any way at all to retrieve the source? Or rewrite is the only option?</p>\n\n<p>Thanks a lot.</p>\n"},{"tags":["sql-server","delphi","delphi-2009","dbexpress"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1389,"score":1,"question_id":2896922,"title":"DBExpress connecting SQL 2008 at runtime with Delphi 2009","body":"<p><br>\nI'm trying to connect at runtime with SQL Server 2008 with Delphi 2009 using DBExpress, it it's not working. When I set all the properties at design time, it works great, but at RunTime, I'm getting \"unknown driver: mssql\". Below is the code: <br></p>\n\n<pre><code>\n  scnConexao := TSQLConnection.Create(nil);\n  scnConexao.DriverName := 'MSSQL';\n  scnConexao.ConnectionName := 'MSSQLConnection';\n  scnConexao.GetDriverFunc := 'getSQLDriverMSSQL';\n  scnConexao.LibraryName := 'dbxmss.dll';\n  scnConexao.VendorLib := 'oledb';\n  scnConexao.LoginPrompt := False;\n  scnConexao.Params.Add('SchemaOverride=sa.dbo');\n  scnConexao.Params.Add('HostName=DESKTOP');\n  scnConexao.Params.Add('DataBase=DBNAME');\n  scnConexao.Params.Add('OS Authentication=False');\n  scnConexao.Params.Add('User_Name=UserName');\n  scnConexao.Params.Add('Password=Password');\n  scnConexao.Params.Add('MSSQL TransIsolation=ReadCommited');\n  scnConexao.Open;\n</code></pre>\n\n<p>I have included the dbxmss.dll in the same directory as my app, but to no avail. Any help would be greatly appreciated. <br>\nTks</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":3006,"score":3,"question_id":1445125,"title":"How to create Linked Server with non-default port","body":"<p>I want to create a Linked Server in MS SQL Server 2000 to a MS SQL 2005 Server which runs on port x (not the default port 1433). But it doesn't work, as I can't specify the port anywhere!?</p>\n\n<p>Using sqlcmd (specifying port x), I can connect to the server without problems - but I can't set it up as a Linked Server.</p>\n\n<p>How can this be done?</p>\n"},{"tags":["mysql","sql-server","transactions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":457,"score":0,"question_id":6647951,"title":"Distributed Transactions between MSSQL 2000 & MySQL Stopped Working","body":"<p>We have been successfully copying data from a MySQL Slave database into a MSSQL database. The MySQL server is a linked server. I have tried using v3.51 and v5.1.8 of the ODBC connector provided my MySQL.</p>\n\n<p>Simply trying to insert into a temporary table in MSSQL from a table in MySQL using OPENQUERY causes the following error:</p>\n\n<pre><code>Server: Msg 7391, Level 16, State 1, Line 1\nThe operation could not be performed because the OLE DB provider 'MSDASQL' was unable to begin a distributed transaction.\n[OLE/DB provider returned message: [MySQL][ODBC 3.51 Driver]Optional feature not supported]\nOLE DB error trace [OLE/DB Provider 'MSDASQL ' ITransactionJoin::JoinTransaction returned 0x8004d00a].\n</code></pre>\n\n<p>This error started happening when replication between the MySQL master and slave failed. This has since been fixed but the error above persists.</p>\n\n<p>The MSSQL Server is running on a Windows 2003 R2 Server and the MySQL servers are running on CentOS 5 servers, the two servers are in different datacenters and talk to each other via OpenVPN.</p>\n\n<p>Is there something more that needs to be done on the MySQL side? Any suggestions for the MSSQL side? I have already tried restarting DTC as well as rebooting the server.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","database","sql-server-2005","mirroring","transaction-log"],"answer_count":10,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":6820,"score":0,"question_id":1033158,"title":"Shrinking the transaction log of a mirrored SQL Server 2005 database","body":"<p>I've been looking all over the internet and I can't find an acceptable solution to my problem, I'm wondering if there even is a solution without a compromise...</p>\n\n<p>I'm not a DBA, but I'm a one man team working on a huge web site with no extra funding for extra bodies, so I'm doing the best I can.</p>\n\n<p>Our backup plan sucks, and I'm having a really hard time improving it.  Currently, there are two servers running SQL Server 2005.  I have a mirrored database (no witness) that seems to be working well.  I do a full backup at noon and at midnight.  These get backed up to tape by our service provider nightly, and I burn the backup files to dvd weekly to keep old records on hand.  Eventually I'd like to switch to log shipping, since mirroring seems kinda pointless without a witness server.</p>\n\n<p>The issue is that the transaction log is growing non-stop.  From the research I've done, it seems that I can't truncate a log file of a mirrored database.  So how do I stop the file from growing!?</p>\n\n<p>Based on <a href=\"http://www.sqlservercentral.com/Forums/Topic377087-146-1.aspx\" rel=\"nofollow\">this web page</a>, I tried this:</p>\n\n<pre><code>USE dbname\nGO\nCHECKPOINT\nGO\nBACKUP LOG dbname TO DISK='NULL' WITH NOFORMAT, INIT, NAME = N'dbnameLog Backup', SKIP, NOREWIND, NOUNLOAD\nGO\nDBCC SHRINKFILE('dbname_Log', 2048)\nGO\n</code></pre>\n\n<p>But that didn't work.  Everything else I've found says I need to disable the mirror before running the backup log command in order for it to work.</p>\n\n<h2>My Question (TL;DR)</h2>\n\n<p>How can I shrink my transaction log file without disabling the mirror?</p>\n"},{"tags":["c#","sql","sql-server"],"answer_count":4,"favorite_count":4,"up_vote_count":10,"down_vote_count":0,"view_count":15852,"score":10,"question_id":779082,"title":"SQLException : String or binary data would be truncated","body":"<p>I have a C# code which does lot of insert statements in a batch. While executing these statements, I got \"String or binary data would be truncated\" error and transaction roledback. </p>\n\n<p>To find out the which insert statement caused this, I need to insert one by one in the SQLServer until I hit the error.</p>\n\n<p>Is there clever way to findout which statement and which field caused this issue using exception handling? (SqlException)</p>\n\n<p>Thanks,\nVenkat</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12985524,"title":"Merge two database table partitions by their partition number","body":"<p>I have created four partitions in SQL Server using the following functions.</p>\n\n<pre><code>CREATE PARTITION FUNCTION fnYearsRT(DateTime)\nAS RANGE RIGHT FOR VALUES\n('01/01/2005', '01/01/2006', '01/01/2007', '01/01/2008');\n\nCREATE PARTITION SCHEME date_partscheme\n AS PARTITION fnYearsRT\n TO (Filegroup1, Filegroup2, Filegroup3, Filegroup4,Filegroup5)\n\nCREATE TABLE Sales.ReturnsArchive\n  (\n     ReturnID  int  IDENTITY NOT NULL, \n     ProductID  int  NOT NULL, \n     CustomerID  int  NOT NULL, \n     ReturnDate  datetime  NOT NULL,  \n     ReturnReason  char(20)  NULL  \n  ) \n ON date_partscheme (ReturnDate)\n</code></pre>\n\n<p>After inserting data I have the following stats</p>\n\n<pre><code>Partition   COUNT\n2       5151\n3       19353\n4       51237\n5       45576\n</code></pre>\n\n<p>I want to merge partition 2 and 3 but I am unable to decide which range I should give in merge function. </p>\n"},{"tags":["sql","sql-server","oracle","firebird"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":12977720,"title":"Typecasting datetime differences","body":"<p>We use firebird as a local testing database and most of our clients use SQL Server or Oracle.</p>\n\n<p>This works in MS SQL Server, but not in Firebird. (haven't tested it n Oracle yet)</p>\n\n<pre><code>CONVERT(char(8),MAX(p.end_Time)-MIN (p.start_Time),8) as duration\n</code></pre>\n\n<p>is there a way to acoomplish this same thing for (Firebird, Oracle, and MS Sql Server)?</p>\n\n<p>thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","like-keyword"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":23636,"score":3,"question_id":4855754,"title":"How to use like condition with multiple values in sql server 2005?","body":"<p>I need to filter out records based on some text matching in nvarchar(1000) column.\nTable has more than 400 thousands records and growing. For now, I am using Like condition:-</p>\n\n<pre><code>SELECT \n    *\nFROM\n    table_01\nWHERE\n    Text like '%A1%'\n    OR Text like '%B1%'\n    OR Text like '%C1%'\n    OR Text like '%D1%'\n</code></pre>\n\n<p>Is there any preferred work around? </p>\n"},{"tags":["sql","sql-server","xml","query","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":83,"score":0,"question_id":12985491,"title":"SQL Server Query for getting column names of all tables as XML","body":"<p>In my database, I intend to get the - [TableName] as the first column and all columns of that table in a \", \" (comma followed by space - delimiter...as the second column--for all tables in the DB.</p>\n\n<pre><code>Table A | ColumnA1, ColumnA2, ColumnA3  \nTable B | ColumnB1, ColumnB2, ColumnB3\n......................................\n</code></pre>\n\n<p>And retrieve it as an XML</p>\n\n<pre><code>&lt;TableList&gt;  \n&lt;TableName&gt;TableA&lt;/TableName&gt; &lt;Columns&gt; ColumnA1, ColumnA2, ColumnA3&lt;/Columns&gt;  \n&lt;TableName&gt;TableB&lt;/TableName&gt; &lt;Columns&gt; ColumnB1, ColumnB2, ColumnB3&lt;/Columns&gt;  \n&lt;/TableList&gt;\n</code></pre>\n\n<p>How should the SQL Query be written?</p>\n"},{"tags":["php","sql-server","image","resize"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12985993,"title":"Receive image after re sizing from source","body":"<p>How to receive an image file with reduced size from server by direct linking?\nExplained: Actual url= <a href=\"http://domain.com/image.jpg\" rel=\"nofollow\">http://domain.com/image.jpg</a> has h=200, with=200\nI want this file with already reduced from server to 50 by 50.\nNow get file url= <a href=\"http://anotherDomain.com?file=http://domain.com/image.jpg&amp;h=50&amp;w=50\" rel=\"nofollow\">http://anotherDomain.com?file=http://domain.com/image.jpg&amp;h=50&amp;w=50</a></p>\n"},{"tags":["sql-server","indexing","bulkinsert","data-warehouse","data-partitioning"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12978422,"title":"Parallel bulk loading using partition switching of indexed table in SQL Server 2008","body":"<p>This is a follow up to a <a href=\"http://stackoverflow.com/questions/11933163/bulk-inserts-of-heavily-indexed-child-items-sql-server-2008\">previous question</a> of mine after definitely deciding on partition switching as the best way to quickly get data into a heavily indexed fact type table that needs to remain available to readers.</p>\n\n<p>While it seems to be the best way, it is not quite good enough to really satisfy the requirement to allow several (&lt; 5) users to bulk insert at the same time, have the new data indexed and to appear in the indexed views (not necessarily real indexed views, just selects that rely on indices).</p>\n\n<p>The idea of partitioning was that each partition and the index subtree rooted at the partition could, in parallel, be locked as read-only, copied into a working table, new data inserted/updated and the indexes rebuilt then switched back into the main table so readers aren't affected.</p>\n\n<p>The problem is the single working table. Each parallel bulk insert needs its own copy, with the same constraints as the main table to allow switching.</p>\n\n<p>So far I've hit several walls trying to get around this bottleneck:</p>\n\n<ol>\n<li>I tried partitioning the working table using the same partition\nfunction. This doesn't work because you can't disable the indexes on\na partition basis to insert into one while rebuilding the index on\nanother. </li>\n<li>Creating a temporary table as the working table. This\ndoesn't work because, while you can use the same index names, you\ncan't easily dynamically create the constraints and can't switch\nthat in anyway. </li>\n<li>Have a fixed set of named working tables? How can I select one and work with it under an alias so I have just one stored proc?</li>\n<li>Dynamic SQL? I've tried very hard to avoid going that route. It's complicated as it is.</li>\n</ol>\n\n<p>Big challenge but has anyone got any ideas before I accept the bottleneck? Would Sql 2012 help? How do proper data warehouses cope with this?</p>\n"},{"tags":["sql","sql-server","tsql","foreign-keys"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":12981768,"title":"how to update table with foreign key","body":"<p>Actually I have two databases, one is for staging one is in production.\none table, for example called Class(class_id,descr,faculty_id) and the faculty_id reference to another table called Faculty(faculty_id, name,comment).</p>\n\n<p>my story is that i do so much updates on the staging database, Faculty table, change lots of faculty comment and name without changing Class table. I want to copy the staging Faculty table to Production. My original way is to generate script from staging and delete the data table, Faculty in production and run the script in order to copy the staging data table Faculty to production. However i found i cannot delete the Faculty table because the foreign key. but i do not want to write down hundreds of update statement, and also cannot delete the Class data in production, how can i do if i want to copy  the Faculty table to production?</p>\n"},{"tags":["c#","sql-server","linq-to-sql","insert"],"answer_count":5,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":3527,"score":5,"question_id":1074611,"title":"InsertAllOnSubmit only inserts first data record","body":"<p>I noticed a strange behaviour in my Import Service today when I tried to import multiple data records.</p>\n\n<p>When I do it like this, all data records are imported and the auto-incremented value is correct (<a href=\"http://i40.tinypic.com/j7x3xw.gif\">see screenshot</a>):</p>\n\n<pre><code>public void Create(List&lt;Property&gt; properties)\n{\n    foreach (Property prop in properties) {\n    \tdbc.Property.InsertOnSubmit(prop);\n    \tdbc.SubmitChanges();\n    }\n}\n</code></pre>\n\n<p>When I try it like this, only the first data record get's a correct auto-incremented value (<a href=\"http://i41.tinypic.com/wvzhgw.gif\">see screenshot</a>):</p>\n\n<pre><code>foreach (Property prop in properties) {\n    dbc.Property.InsertOnSubmit(prop);\n}\ndbc.SubmitChanges();\n</code></pre>\n\n<p>Same here:</p>\n\n<pre><code>dbc.Property.InsertAllOnSubmit(properties);\ndbc.SubmitChanges();\n</code></pre>\n\n<p>Does anybody have an idea why it's like that? All three variants should import all data records according to my understanding, but the missing auto-incremented values indicate it's not that way.</p>\n\n<p><strong>[EDIT]</strong> Added two screenshots.</p>\n"},{"tags":["mysql","sql-server","import"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":7454,"score":3,"question_id":305886,"title":"Easiest way to import data from My Sql to Sql Server","body":"<p>For a new project I have to import the pre-existing data from MySql.</p>\n\n<p>In <a href=\"http://www.connectionstrings.com/?carrier=mysql\" rel=\"nofollow\">this site</a> I have found many options, some including the installation of drivers. What is the fastest &amp; easiest way to do it?</p>\n\n<p>Update: this would be just a one time import</p>\n"},{"tags":["sql","sql-server","join","group-by","results"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12968803,"title":"SQL sub query with group by","body":"<p>I have the following SQL query:</p>\n\n<pre><code>SELECT \nkvknum.cd_hfdrelnr, \nkvknum.cd_kvkanum,\n    relName.cd_hfdrelnr\nFROM\n(\n    SELECT \n        cd_hfdrelnr, \n        cd_kvkanum\n\nFROM er_105\nWHERE cd_kvkanum IN\n(\n    SELECT cd_kvkanum\n    FROM er_105\n    GROUP BY cd_kvkanum\n    HAVING COUNT(*) &gt; 1 \n)\nAND cd_kvkanum != ''\nORDER BY cd_kvkanum\n) AS kvknum\nLEFT OUTER JOIN\n(\n    SELECT \n        cd_hfdrelnr,\n        cd_relnaam\n    FROM er_101\n) AS relName\nON kvknum.cd_hfdrelnr = relName.cd_hfdrelnr\n</code></pre>\n\n<p>The <code>GROUP BY</code> function is not allowed and it is needed so the same <code>cd_kvkanum</code> values are shown together under each other, is there a work around for this or how is this possible to achieve?</p>\n\n<p>Following error comes with it:</p>\n\n<p>\"Msg 1033, Level 15, State 1, Line 21\nThe ORDER BY clause is invalid in views, inline functions, derived tables, subqueries, and common table expressions, unless TOP or FOR XML is also specified.\nMsg 156, Level 15, State 1, Line 28\nIncorrect syntax near the keyword 'AS'.\"</p>\n\n<p>when I run the following query:</p>\n\n<pre><code>SELECT \n    cd_hfdrelnr, \n    cd_kvkanum\n\nFROM er_105\nWHERE cd_kvkanum IN\n(\n    SELECT cd_kvkanum\n    FROM er_105\n    GROUP BY cd_kvkanum\n    HAVING COUNT(*) &gt; 1 \n)\nAND cd_kvkanum != ''\nORDER BY cd_kvkanum\n</code></pre>\n\n<p>(First subquery of the join) the results look like: <br />\n1235 - 123 <br />\n4652 - 123 <br />\n8569 - 1234 <br />\n4985 - 1234 <br /></p>\n\n<p>Though I want to add cd_relnaam to the result list,\nwhen Just use an JOIN on the query my results are blank...</p>\n\n<p>anybody knows what I do wrong?</p>\n"},{"tags":["sql","sql-server","database","triggers","sql-server-express"],"answer_count":6,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":18093,"score":7,"question_id":642822,"title":"How can I do a BEFORE UPDATED trigger with sql server?","body":"<p>I'm using Sqlserver express and I can't do <code>before updated</code> trigger. There's a other way to do that?</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12984819,"title":"Save Record Index to Column","body":"<p>I'd like to save the index of each record in a table to that record's index column.  So let's say I sorted my records:</p>\n\n<pre><code>select * from Users order by DateTimeCreated\n</code></pre>\n\n<p>Now, let's say I wanted to cache their positions in this sorting.  I would like to do something like this:</p>\n\n<pre><code>update Users set SortedIndex=GETINDEX() order by DateTimeCreated\n</code></pre>\n\n<p>How can I do something like this?  I could code it in C#, but I'd prefer a more efficient way than looping and setting each record individually.  I need this number pre-determined (written on each record) rather than determined at runtime.  Thank you.</p>\n"},{"tags":["sql","sql-server","cursor","row"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":3,"view_count":561,"score":-2,"question_id":3192010,"title":"SQL Server Row by Row operation","body":"<p>I am trying to do some operation in column 'Increment' based on previous row record in column 'Value'</p>\n\n<p>e.g. </p>\n\n<pre><code>row_num| Period | Measure | Decay\n1      | Jan 08 | 10      | \n2      | Feb 08 | 18      | \n3      | Mar 08 | 7       | \n4      | Apr 08 | 67      | \n</code></pre>\n\n<p>i would like to update column 'Decay' based on a formula</p>\n\n<pre><code>row_num| Period | Measure| Decay\n1      | Jan 08 | 10     | = 10             -&gt; first value in 'Measures'\n2      | Feb 08 | 18     | = 10*0.5+18 = 23 -&gt; previous decay record *0.5 + current measure\n3      | Mar 08 | 7      | = 23*0.5+7  = 18.5\n4      | Apr 08 | 67     | = 18.5*0.5+67 = 76.25\n</code></pre>\n\n<p>would cursor be applicable here? how would the syntax be like?\nthank you</p>\n"},{"tags":["c#","sql-server","sqldataadapter","insertcommand"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":12981012,"title":"Is there a more elegant form for assigning NULL to InsertCommand's NVarChar?","body":"<p>This code works for me very well:</p>\n\n<pre><code>if (someStr == null)\n  da.InsertCommand.Parameters.Add(\"@SOMESTR\", SqlDbType.NVarChar).Value = DBNull.Value;\nelse\n  da.InsertCommand.Parameters.Add(\"@SOMESTR\", SqlDbType.NVarChar).Value = someStr;\n</code></pre>\n\n<p>But my intuition tells me that there may be a one-liner version of it. Something like:</p>\n\n<pre><code>  da.InsertCommand.Parameters.Add(\"@SOMESTR\", SqlDbType.NVarChar).Value = someStr==null ? DBNull.Value : someStr ;\n</code></pre>\n\n<p>But the one-liner I just posted above fails of course because <code>DBNull.Value</code> doesn't cast to String.</p>\n\n<p>Is there a way to accomplish the one liner I so desire? </p>\n"},{"tags":["sql-server","excel-vba","vbscript","export-to-excel","dts"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12984679,"title":"Generating and loading an excel (.XLS) file using VB Script in DTS package","body":"<p>I want to load the excel file with database data.So i created a DTS package which transfers the data from database to excel(.xls) file.<strong>Since DTS accepts only .xls extension files</strong>, i am planning to create .xls file only.<br>\n    step1: create the excel(.xls) file with 3 columns(<strong>using VB Script</strong>).\n    step2: map these 3 excel columns with table colmns in transformation task.\n    step3: Load the excel.<br>\n    Now if i run the package, it is throwing error like <strong>destination file is not in expected format</strong>.But file is generated with .XLS extension.if i try to open the excel manually, it is also throwing the same error. But i am able to open the file.If i do save as to the same file, it is showing the file type as .xlsx in the drop down. now i changed it to .xls in the drop down and saved . Now it is working fine.<strong>Why it is showing .xlsx file type even if we created .xls file?Is there any solution to create pure .xls(*<em>which will show .xls in save as</strong>) file which can be used in DTS package?</em>*</p>\n"},{"tags":["sql-server","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12983444,"title":"SQL Server high volume update on one field","body":"<p>I am building a VoIP switch and I am going to be doing an insert using a SQL stored procedure.\nI need to update the user table \"balance field\" each time I update the history table.  Due to it being a switch I can have hundreds of updates each second.\nI wanted to know the best way to update a field with out dead locks and with out wrong info.\nI will be using MS sql server 2012.</p>\n"},{"tags":[".net","sql","sql-server","reporting-services"],"answer_count":6,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":2958,"score":3,"question_id":1593345,"title":"Visual Studio 2005 doesn't support Sql Server 2008","body":"<p>I'm developing Reporting services on VS2005 and have to connect to SQL Server 2008.\nThe following Error occurs:\n\"This server version is not supported.  You must have Microsoft SQL Server 2005 Beta 2 or later.\"</p>\n\n<p>I found on the net a patch for it, but it doesn't work \n(<a href=\"http://www.microsoft.com/downloads/details.aspx?FamilyID=E1109AEF-1AA2-408D-AA0F-9DF094F993BF&amp;displaylang=en\" rel=\"nofollow\">link to patch</a>)</p>\n\n<p>\"The upgrade patch cannot be installed by the Windows Installer Service because the program to be upgraded is missing, or the upgrade patch may update a different version of the program.\" </p>\n\n<p>what else can I do ? :(</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":5,"up_vote_count":8,"down_vote_count":0,"view_count":13459,"score":8,"question_id":868620,"title":"SQL Script to alter ALL Foreign Keys to add ON DELETE CASCADE","body":"<p>I have a SQL 2005 database with approx 250 tables.</p>\n\n<p>I want to temporarily enable ON DELETE CASCADE to all of the Foreign Keys so that I can do a bulk delete easily.</p>\n\n<p>I then want to turn off ON DELETE CASCADE on all Foreign Keys.</p>\n\n<p>The only way I know of doing this, is to use Management Studio to generate a full database create script, do some kind of search and replace to strip out everything but Foreign Keys, save the script, then do some more search and replacing to add the ON DELETE CASCADE.</p>\n\n<p>Then I run the script, do my delete, and then run the other script.</p>\n\n<p>Is there an easier way to produce this script? This method seems far too prone to error and I will have to keep the script up to date with any other changes we make to the database, or re-generate it manually each time I may need to use it.</p>\n\n<p>Is an alternative option to run a select on the system tables to \"generate\" the script for me? Could it even be possible to run an update on a system table that enables and disables ON DELETE CASCADE?</p>\n"},{"tags":["sql-server","command-line","scripting","backup"],"answer_count":10,"favorite_count":13,"up_vote_count":33,"down_vote_count":0,"view_count":63931,"score":33,"question_id":122690,"title":"What is a simple command line program or script to backup SQL server databases?","body":"<p>I've been too lax with performing DB backups on our internal servers. </p>\n\n<p>Is there a simple command line program that I can use to backup certain databases in SQL Server 2005? Or is there a simple VBScript? </p>\n"},{"tags":[".net","sql-server","entity-framework","ews"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12974061,"title":"Use EWS API and SQL Server database as data sources","body":"<p>I am new to EF an am trying to build (what I think) is a rather simple application for my office. I am writing an application to track the projects we bid on. Each biditem will track (through navigation properties) which clients (bidders) we are bidding to (construction industry, so multiple clients per project), and project notes. </p>\n\n<p>I am planning on using EF (with SQL Server) for the bidtracker, but I want to use the EWS Managed API to get/maintain the contact info so that the office only has to maintain one contact list which is available through Outlook. </p>\n\n<p>So, is it possible to have mixed data sources (SQL Server and Exchange server) with Entity Framework? If so, can you point me to a good resource to help me wire it?</p>\n\n<p>Here is a simplified model (the <code>BidItem</code> and <code>Note</code> will be in SQL Server, the <code>Contact</code> will be from Exchange):</p>\n\n<p><img src=\"http://i.stack.imgur.com/29rCE.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","vb.net","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12978959,"title":"Upsert - Efficient Update or Insert in VB.Net, SQL Server","body":"<p>I'm trying to understand how to streamline the process of inserting a record if none exists or updating a record if it already exists. I'm not using stored procedures, although maybe that would be the most efficient way of doing this.</p>\n\n<p>The actual scenario in which this is necessary is saving a user preference/setting to my SettingsUser table.</p>\n\n<p>In MS Access I would typically pull a DAO recordset looking for the specified setting. If the recordset comes back empty then I know I need to add a new record which I can do with the same recordset object. On the other hand, if it isn't empty, I can just update the setting's value right away. In theory, this is only two database operations.</p>\n\n<p>What is the recommended way of doing this in .NET?</p>\n"},{"tags":["sql-server","sql-server-2012","circular-dependency","computed-columns","schemabinding"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12982529,"title":"Schema bound and computed columns dependency loop","body":"<p>Well this isn't good.</p>\n\n<p>I have a schema-bound function called \"GetFriendlyProductItem\" which returns a human-readable name for a product from the ProductItems table.</p>\n\n<p>The ProductItems table in turn, has a computed column called \"Name\" which uses this function to generate the value in this column.</p>\n\n<p>The problem is that I need to make a change to ProductItems. I cannot, because GetFriendlyProductItem uses it and it is schema-bound. I tried to alter GetFriendlyProductItem so that it is no longer schema-bound. This raises the error that I cannot alter it because it is being used in the computed column in the ProductItems.</p>\n\n<p>How can I make modifications to the ProductItems table when I have this loop of dependency preventing it?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":896,"score":2,"question_id":7475845,"title":"Getting Number of weeks in a Month from a Datetime Column","body":"<p>I have a table called FcData and the data looks like:</p>\n\n<pre><code>Op_Date\n\n2011-02-14 11:53:40.000\n2011-02-17 16:02:19.000\n2010-02-14 12:53:40.000\n2010-02-17 14:02:19.000\n</code></pre>\n\n<p>I am looking to get the Number of weeks in That Month from Op_Date. So I am looking for output like:</p>\n\n<pre><code> Op_Date                       Number of Weeks\n\n    2011-02-14 11:53:40.000       5   \n    2011-02-17 16:02:19.000       5\n    2010-02-14 12:53:40.000       5\n    2010-02-17 14:02:19.000       5\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":85,"score":6,"question_id":12979095,"title":"joining a pivot with another complex table","body":"<p>my pivot query generates:</p>\n\n<pre><code>+-----------+----+----+---+---+---+---+---+\n| client_id | 1  | 2  | 3 | 4 | 5 | 6 | 7 |\n+-----------+----+----+---+---+---+---+---+\n|    216436 |  9 |  0 | 0 | 0 | 0 | 0 | 0 |\n|    110522 | 76 |  3 | 0 | 0 | 0 | 0 | 0 |\n|    214981 |  0 |  1 | 0 | 0 | 0 | 0 | 0 |\n|    216360 | 52 |  1 | 0 | 0 | 0 | 0 | 0 |\n|    102574 |  1 |  0 | 0 | 0 | 0 | 0 | 0 |\n|    211754 | 97 | 14 | 2 | 0 | 0 | 0 | 0 |\n|    210734 |  8 |  4 | 0 | 0 | 0 | 0 | 0 |\n|    100123 |  1 |  0 | 0 | 0 | 0 | 0 | 0 |\n|    101840 |  2 |  0 | 0 | 0 | 0 | 0 | 0 |\n+-----------+----+----+---+---+---+---+---+\n</code></pre>\n\n<p>here's the query:</p>\n\n<pre><code>   select client_id,\n   [1],[2],[3],[4],[5],[6],[7] -- these are timestested (the amount of times tested)\n   from\n   (   SELECT DISTINCT CLIENT_ID\n   , PATIENT_ID\n   , count(*) over (partition by client_id, patient_id) AS patientcount\n\n   from f_accession_daily) as SourceTable\n   PIVOT\n   (\n   count(patient_id)\n   for patientcount in ([1],[2],[3],[4],[5],[6],[7])\n   ) as pivottable\n</code></pre>\n\n<p><strong>I need to bring the max/min dates for every time tested, (for [1], [2], [3], etc)</strong> from this table:</p>\n\n<pre><code>+-----------+-------------+-------+------------+------------+\n| client_id | TimesTested | count | maxRecDate | minRecDate |\n+-----------+-------------+-------+------------+------------+\n|    100034 |           2 |     1 | 6/25/2008  | 6/23/2008  |\n|    100034 |           1 |    20 | 6/30/2008  | 6/19/2008  |\n|    100038 |           3 |     1 | 7/25/2008  | 7/23/2008  |\n|    100038 |           1 |     4 | 7/25/2008  | 7/1/2008   |\n|    100050 |           1 |    15 | 8/11/2008  | 7/14/2008  |\n|    100060 |           1 |     2 | 8/12/2008  | 7/29/2008  |\n|    100070 |           1 |     3 | 8/15/2008  | 8/15/2008  |\n|    100049 |           1 |     3 | 8/22/2008  | 7/11/2008  |\n|    100029 |           3 |     2 | 8/25/2008  | 6/18/2008  |\n+-----------+-------------+-------+------------+------------+\n</code></pre>\n\n<p>the above table is generated by:</p>\n\n<pre><code>SELECT a.client_id AS client_id\n,a.patientcount TimesTested\n   , count(a.patientcount)/a.patientcount AS count\n   , max(f.received_date) AS maxRecDate\n   , min(f.received_date) AS minRecDate\nFROM\n(\n   SELECT DISTINCT CLIENT_ID\n   , PATIENT_ID\n   , count(*) over (partition by client_id, patient_id) AS patientcount\n\n   from f_accession_daily\n\n) AS a\nJOIN F_ACCESSION_DAILY AS f ON a.CLIENT_ID = f.CLIENT_ID\n   AND a.PATIENT_ID = f.PATIENT_ID\n\nGROUP BY a.CLIENT_ID, a.patientcount\n</code></pre>\n\n<p><strong>the resulting table that i need to get:</strong></p>\n\n<pre><code>+-----------+----+----------+-----------+----+----------+-----------+---+----------+-----------+---+----------+-----------+-----+\n| client_id | 1  | maxdate1 | mindate1  | 2  | maxdate2 | mindate2  | 3 | maxdate3 | mindate3  | 4 | maxdate4 | mindate4  |  5  |\n+-----------+----+----------+-----------+----+----------+-----------+---+----------+-----------+---+----------+-----------+-----+\n|    216436 |  9 | 1/1/2011 | 1/23/1985 |  0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 | etc |\n|    110522 | 76 | 1/1/2011 | 1/23/1984 |  3 | 1/1/2011 | 1/23/1984 | 0 | 1/1/2011 | 1/23/1984 | 0 | 2/1/2011 | 1/23/1984 |     |\n|    214981 |  0 | 1/1/2013 | 1/23/1985 |  1 | 1/1/2013 | 1/23/1985 | 0 | 1/1/2013 | 1/23/1985 | 0 | 1/1/2013 | 1/23/1985 |     |\n|    216360 | 52 | 1/1/2011 | 1/23/1985 |  1 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 |     |\n|    102574 |  1 | 1/1/2011 | 1/23/1985 |  0 | 1/1/2014 | 1/23/1980 | 0 | 2/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 |     |\n|    211754 | 97 | 1/1/2012 | 1/23/1985 | 14 | 1/1/2012 | 1/23/1985 | 2 | 1/1/2012 | 1/23/1985 | 0 | 1/1/2012 | 1/23/1985 |     |\n|    210734 |  8 | 1/1/2011 | 1/23/1984 |  4 | 1/1/2011 | 1/23/1984 | 0 | 1/1/2011 | 1/23/1984 | 0 | 1/1/2011 | 1/23/1984 |     |\n|    100123 |  1 | 1/1/2011 | 1/23/1985 |  0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1987 |     |\n|    101840 |  2 | 1/1/2011 | 1/23/1985 |  0 | 1/1/2011 | 1/23/1980 | 0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 |     |\n+-----------+----+----------+-----------+----+----------+-----------+---+----------+-----------+---+----------+-----------+-----+\n</code></pre>\n\n<p><strong>how do i join the two tables? the speed does not matter! thank you very much for your kind help.</strong></p>\n"},{"tags":[".net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12982417,"title":"issue with a Exec master .. cmdshell statement in sql server","body":"<p>I am having trouble getting an exe to work from an exec master cmdshell statement in sql server. </p>\n\n<p>The EXE works fine when I double click it. But when I try to run it with this command in SQL server it does not execute.</p>\n\n<pre><code>EXEC master..xp_cmdshell 'Path\\Program.exe'\n</code></pre>\n\n<p>The program itself is very simple--it is just supposed to send an email alert using an in-house DLL. If it hits an error, it should write that error to a file in the current directory. (Eventually, I want it to set it up to run via a trigger when records are inserted into a particular table). </p>\n\n<p>When I run the program with the statement above, the program does not print out an error message (as shown below) or send an email. How can I tell if it is executing? Hitting an error? What could be going on? The program itself is working properly when I run it via double clicking the path\\program.exe.</p>\n\n<pre><code>Imports System.IO\n\nModule Module1\n\n    Sub Main()\n        Try\n            EmailSenderDLL.EmailSender.send(15, \"Alert Text.\")\n        Catch e As Exception\n            File.WriteAllText(Directory.GetCurrentDirectory() &amp; \"\\\" &amp; Now.Year &amp; Now.Month &amp; Now.Day &amp; Now.Millisecond, e.Message &amp; vbNewLine &amp; e.StackTrace)\n        End Try\n\n    End Sub\n\nEnd Module\n</code></pre>\n\n<p>What steps can I take to fix this?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":217,"score":0,"question_id":7711336,"title":"SQL Server Rounding Issue","body":"<p>I'm using SQL Server 2005. And I'm using ROUND T-SQL function to round a decimal column value. But it seems that the rounded value is incorrect.</p>\n\n<pre><code>    PRINT ROUND(1890.124854, 2) =&gt; 1890.120000\n</code></pre>\n\n<p>As shown the ROUND function is returning 1890.12 where as it should be 1890.13. Does anyone encountered this and what should be the correct way of rounding so that I get the expected value 1890.13..?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","select"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":77,"score":0,"question_id":12976038,"title":"Deselect column from Select * statement in SQL server","body":"<p>I want to select all the columns but the column name given in <code>DISTINCT</code> is repeated twice.<br>\nFor Intance,</p>\n\n<pre><code>SELECT DISTICT emp_name,* FROM EMPLOYEE\n</code></pre>\n\n<p>In above case, column <code>emp_name</code> is getting selected twice.\nHow can I avoid it?</p>\n\n<p><strong>UPDATE</strong>:<br>\nHow to apply <code>DISTINCT</code> on selected column while returning multiple columns?\nFOR instance:  </p>\n\n<pre><code>SELECT DISTINCT(emp_name), emp_address, doj FROM EMPLOYEE\n</code></pre>\n\n<p>In above example <code>DISTINCT</code> must be applied on <code>emp_name</code>.</p>\n"},{"tags":["php","sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":95,"score":1,"question_id":7168127,"title":"Deleting all unactivated accounts","body":"<p>I have a question about deleting all unactivated accounts that has been registered over 24 hours. I am using MSSQL.</p>\n\n<p>Database Setup:</p>\n\n<pre><code>account | usrActivated | regTime\ntest           0         1314223187\n</code></pre>\n\n<p>SQL Query:</p>\n\n<pre><code>$time = 24 * (60 * 60);\nDROP FROM ACCOUNT_TBL_DETAIL WHERE usrActivated=0 AND regTime &lt; $time\n</code></pre>\n\n<p>Would this work if I execute a query like this? Deleting unactivated account which are older than 24 hours.</p>\n"},{"tags":["java","sql","sql-server","sql-server-2008","jdbc"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":5953,"score":0,"question_id":6403636,"title":"Connecting SQL Server 2008 to Java: Login failed for user error","body":"<p>I am trying to connect my Java code to a Microsoft SQL Server 2008 R2 Express database.  I have downloaded the Microsoft SQL Server JDBC Driver 3.0 and added the sqljdbc4.jar to my classpath.  I am using Netbeans and have included the sqljdbc4.jar in my project also.</p>\n\n<p>I created a database in the SQL Server Management Studio called TestDB1 and added some columns and values that I will use for testing.  I changed from Windows Authentication Mode by right clicking on the server JACOB=PC\\SQLEXPRESS->Properties->Secuity and changing from Windows Authentication Mode to SQL Server and Windows Authentication Mode.  </p>\n\n<p>I then created a new login by right clicking on the Login folder in the window explorer under JACOB-PC/SQLEXPRESS->Secuity Folder->Logins Folder and added a new login.  I gave it the name jhaip2, switched to SQL Server authentication and the set the password to jacob.  Enforce password policy and enforce password expiration are unchecked.  The default database is set to TestDB1.  Then under TestDB1->Secuity->Users->jhaip2->Database role membership I set jhaip2 to db_owner (I couldn't log in to the database in the management studio without doing this, probably not the right thing to do?).  I then restarted the server.</p>\n\n<p>Now for my java code, it is basically a direct copy of the JDBC Driver 3.0 Sample code except without windows authentication.</p>\n\n<pre><code>package databasetest1;\n\nimport java.sql.*;\n\npublic class connectURL {\n\n   public static void main(String[] args) {\n\n      // Create a variable for the connection string.\n      String connectionUrl = \"jdbc:sqlserver://localhost:1433;\" + \"databaseName=TestDB1;\";\n\n      // Declare the JDBC objects.\n      Connection con = null;\n      Statement stmt = null;\n      ResultSet rs = null;\n\n      try {\n         // Establish the connection.\n         Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");\n         System.out.println(\"Driver okay\");\n         con = DriverManager.getConnection(connectionUrl,\"jhaip2\",\"jacob\");\n         System.out.println(\"Connection Made\");\n\n      }\n\n      // Handle any errors that may have occurred.\n      catch (Exception e) {\n         e.printStackTrace();\n      }\n      finally {\n         if (rs != null) try { rs.close(); } catch(Exception e) {}\n         if (stmt != null) try { stmt.close(); } catch(Exception e) {}\n         if (con != null) try { con.close(); } catch(Exception e) {}\n      }\n   }\n}\n</code></pre>\n\n<p>When I run, it prints out \"Driver okay\" so I am assuming my driver is set up correctly.  Then it prints the error:</p>\n\n<pre><code>com.microsoft.sqlserver.jdbc.SQLServerException: Login failed for user 'jhaip2'.\n</code></pre>\n\n<p>It does not matter what username I use, it always fails.  I have a feeling I am setting up the user wrong.  If anyone could give me some help on how to properly set up a user or any guidance in how to simply connect to a SQL Server database in Java, I would appreciate it.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12982277,"title":"condensing a dataset on nulls","body":"<p>My query returns a table that looks like this (please note that I am posting a very simplified version of the output):</p>\n\n<pre><code>+-------+------+------+------+------+\n|       |  1   |  2   |  3   |  4   |\n+-------+------+------+------+------+\n| 14234 | 3    | null | null | null |\n| 14234 | null | null | 32   | null |\n| 33334 | 4    | null | null | 5    |\n| 33334 | null | 3    | null | null |\n+-------+------+------+------+------+\n</code></pre>\n\n<p>and i would like to reformat it to look like this:</p>\n\n<pre><code>+-------+---+------+------+------+\n|       | 1 |  2   |  3   |  4   |\n+-------+---+------+------+------+\n| 14234 | 3 | null | 32   | null |\n| 33334 | 4 | 3    | null | 5    |\n+-------+---+------+------+------+\n</code></pre>\n\n<p>as you can see the rows have been put together (condensed), i don't know what the right terminology would be. </p>\n\n<p>is there a quick way to do this with sql server?</p>\n\n<p>here's the original query:</p>\n\n<pre><code>;WITH \nPivotQuery as (\n    select client_id,\n       [1],[2],[3],[4],[5],[6],[7]\n       from\n       (   SELECT DISTINCT CLIENT_ID\n       , PATIENT_ID\n       , count(*) over (partition by client_id, patient_id) AS patientcount\n\n       from f_accession_daily) as SourceTable\n       PIVOT\n       (\n       count(patient_id)\n       for patientcount in ([1],[2],[3],[4],[5],[6],[7])\n       ) as pivottable),\n\nMinMaxTimes as (\n    SELECT a.client_id AS client_id\n    ,a.patientcount TimesTested\n       , count(a.patientcount)/a.patientcount AS count\n       , max(f.received_date) AS maxRecDate\n       , min(f.received_date) AS minRecDate\n    FROM\n    (\n       SELECT DISTINCT CLIENT_ID\n       , PATIENT_ID\n       , count(*) over (partition by client_id, patient_id) AS patientcount\n\n       from f_accession_daily\n\n    ) AS a\n    JOIN F_ACCESSION_DAILY AS f ON a.CLIENT_ID = f.CLIENT_ID\n       AND a.PATIENT_ID = f.PATIENT_ID\n\n    GROUP BY a.CLIENT_ID, a.patientcount),\n\nmaxDates as (\nSELECT client_id, [1] maxdate1, [2] maxdate2, [3] maxdate3, [4] maxdate4, [5] maxdate5, [6] maxdate6, [7] maxdate7\nFROM MinMaxTimes t\nPIVOT (max(maxRecDate)\nfor TimesTested IN ([1], [2], [3], [4], [5], [6], [7])\n) as p),\n\nminDates as (\nSELECT client_id, [1] mindate1, [2] mindate2, [3] mindate3, [4] mindate4, [5] mindate5, [6] mindate6, [7] mindate7\nFROM MinMaxTimes t\nPIVOT (max(minRecDate)\nfor TimesTested IN ([1], [2], [3], [4], [5], [6], [7])\n) as p)\n\nSELECT i.client_id, \n    p.[1], maxdate1, mindate1, \n    p.[2], maxdate2, mindate2, \n    p.[3], maxdate3, mindate3, \n    p.[4], maxdate4, mindate4, \n    p.[5], maxdate5, mindate5, \n    p.[6], maxdate6, mindate6, \n    p.[7], maxdate7, mindate7   \nFROM PivotQuery p\nLEFT OUTER JOIN maxDates a ON p.client_id = a.client_id\nLEFT OUTER JOIN mindates i ON a.client_id = i.client_id\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":67,"score":0,"question_id":12981816,"title":"What does a select statement inside a select statement mean?","body":"<p>What does a Transact SQL statement <code>Select</code> statement inside a <code>from</code> mean? </p>\n\n<p>I mean something like this </p>\n\n<pre><code> .. from ( \n    select .. \n )\n</code></pre>\n\n<p>Also, I need to know if the statement is bad for performance.  Can you provide me a link to the official documentation about this topic in Transact SQL?</p>\n"},{"tags":["sql","sql-server","database","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":67,"score":3,"question_id":12982045,"title":"are there loops in t-sql ? is using them a good idea?","body":"<p>Pardon me if I'm asking this, but I'm not a SQL Server nor SQL developer.</p>\n\n<p>i have a CSV that i import into a table let's call it T that i create on the fly in SQL Server 2005.</p>\n\n<p>what i would like to do is to run some queries against other tables based on the data imported into the table T i created.\nexample :</p>\n\n<pre><code>select * \nfrom TableX \nwhere customerID = [this should contain the customerID from the table T]\n</code></pre>\n\n<p>and then if i find it, i need to update the same table T, if not i move along... until the last record in that csv file. Any idea will be appreciated.</p>\n"},{"tags":["sql-server","tsql","pivot","unpivot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12980980,"title":"SQL Pivoting a column","body":"<p>suppose I have a temp table created and the structure/data looks like this</p>\n\n<pre><code>  Type        Lang    N_cnt        Pcnt      T1      T2       T3      T4\n============================================================================\nClassroomA      1      165897      1232     6439    1135     4516     1756\nClassroomA      2      175127      1254     6439    1135     1285     1953\nClassroomB      1      179515      1284     6439    1762     3945     1957\nClassroomB      2      159683      2041     6439    1575     4745     1955\n</code></pre>\n\n<p>I wanna pivot the <code>T1</code>, <code>T2</code>, <code>T3</code>, <code>T4</code> columns such that I get this result</p>\n\n<pre><code>   Type       SubType   Lang      N_cnt            P_cnt   \n==============================================================\nClassroomA      NULL     1       165897          1232  \nNULL            \"T1\"     1   6439/165897     6439/1232       \nNULL            \"T2\"     1       *calculation*   *calculation*\nNULL            \"T3\"     1       *calculation*   *calculation*\nNULL            \"T4\"     1       *calculation*   *calculation*\nClassroomA      NULL     2       175127          1254  \nNULL            \"T1\"     2       6439/175127     6439/1254       \nNULL            \"T2\"     2       *calculation*   *calculation*\nNULL            \"T3\"     2       *calculation*   *calculation*\nNULL            \"T4\"     2       *calculation*   *calculation*\n</code></pre>\n\n<p>Note that where it says <code>calculation</code> thats where I will be taking the value of <code>T{x}</code> and doing some calucation with it (I do an example for the first <code>T1</code>). I would also like to add that in reality I have about ten over these <code>T</code> variables.</p>\n\n<p>Any ideas how to pivot the columns?</p>\n"},{"tags":["sql-server","ssms","sql-management-studio"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":36,"score":2,"question_id":12979067,"title":"What determines the number of tables SQL Server Management Studio can import in parallel","body":"<p>In the following screenshot, SSMS only copies rows for ONE given table at a time :</p>\n\n<p><img src=\"http://i.stack.imgur.com/OUPyE.png\" alt=\"http://imgur.com/Kq72I\"></p>\n\n<p>It is clearly able to perform multiple copies at a time (in which case you would see several \"Copying rows\" lines).</p>\n\n<p>What determines the level of parallelism whiles SSMS copies tables ?</p>\n"},{"tags":["sql","sql-server","ms-access"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12980961,"title":"Access as front-end for SQL Server Issues","body":"<p>I have recently converted my Access (2010) database to SQL server (2008) and am attempting to use Access as the front-end. The issues I am having are with sorting and filtering columns within Access. Sorting essentially doesn't work for most columns - does not end up with alphabetically/numerically ordered rows. Also filtering columns will not work consistently either. It will sometimes perform the first filter correctly, but when I change the criteria it will not work and typically shows 0 rows.</p>\n\n<p>I have looked around, but can't seem to find anyone else running into this issue. Are these known bugs with this configuration?</p>\n\n<p>Also, are there any other alternatives similar to Access as a front-end for SQL server? My users require similar functionality that Access provides - filter, sorting, editing data, and they do not want to write any SQL to do this. I would like to not have to create a custom front-end, but I am starting to think this may be my only option.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server","reporting-services","crystal-reports","migration"],"answer_count":9,"favorite_count":2,"up_vote_count":17,"down_vote_count":0,"view_count":19492,"score":17,"question_id":16396,"title":"Easy way for Crystal Reports to MS SQL Server Reporting Services conversion","body":"<p>Is there a way to easily convert Crystal Reports reports to Reporting Services RDL format? \nWe have quite a few reports that will be needing conversion soon.</p>\n\n<p>I know about the manual process (which is basically rebuilding all your reports from scratch in SSRS), but my searches pointed to a few possibilities with automatic conversion \"acceleration\" with several consulting firms. (As described on <a href=\"http://www.microsoft.com/sql/technologies/reporting/partners/crystal-migration.mspx\" rel=\"nofollow\">http://www.microsoft.com/sql/technologies/reporting/partners/crystal-migration.mspx</a>).</p>\n\n<p>Do any of you have any valid experiences or recomendations regarding this particular issue?\nAre there any tools around that I do not know about?</p>\n"},{"tags":["sql","sql-server","excel","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12981683,"title":"How do I run data flow task successfully if certain files in the data flow doesn't exist","body":"<p>I have a data flow task that imports excel files. I cant use a for each loop to go through the excel files as the metadata for each excel file is completely different.</p>\n\n<p>So in the data flow task I have 10 separate source files and use a union component to combine them then import it to SQL. </p>\n\n<p>Problem i am facing now is sometimes certain excel files that i am importing might not exist so when my package runs it will fail as the file doesn't exist. So is there any way for me to create a check that allows the package run to skip the source file that doesn't exist and run the rest of the source files?</p>\n\n<p>I am using SSIS 2005.</p>\n"},{"tags":["sql","sql-server","index"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":39,"score":0,"question_id":12981171,"title":"View content of a SQL Server index","body":"<p>If one wants to view the contents of an index, what's the best way to do it without using a third party tool? </p>\n\n<p>Thanks,\nFaraz</p>\n\n<p>-- EDIT: It's probably more of an academic question than a real requirement... I've seen questions soliciting such academic information so gave it a go.</p>\n"},{"tags":["c#","sql-server","sdk","fingerprint"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12981570,"title":"Issues after upgrading griaule Fingerprint SDK 2007 to 2009","body":"<p>Hello i have the issue sometimes after upgrading (like the title says) that sometimes an user check his/her fingerprint and another person is showed on screen.</p>\n\n<p>I used this example as base: <a href=\"http://www.griaulebiometrics.com/page/en-us/tutorials/csharp-sqlserver-authentication-using-fingerprintsdk/the-code-itself\" rel=\"nofollow\">http://www.griaulebiometrics.com/page/en-us/tutorials/csharp-sqlserver-authentication-using-fingerprintsdk/the-code-itself</a></p>\n\n<p>And modified like this:</p>\n\n<pre><code>/* Aca ocurre toda la magia de detectar el empleado, es la funcion mas importante de toda la aplicacion */\n    private void grFingerXCtrlAuth_ImageAcquired(object sender, AxGrFingerXLib._IGrFingerXCtrlEvents_ImageAcquiredEvent e)\n    {\n        int bloqueo = tiempo_bloqueo();\n\n        Desactivar_Tiempo();\n        if (this.WindowState == FormWindowState.Minimized)\n        {\n            this.WindowState = FormWindowState.Normal;\n        }\n        if (this.Focused == false)\n        {\n            this.Focus();\n        }\n\n        activado_timer = 0;\n        int idempleado = 0;\n        string nombre_e = \"\";\n        string apellido_e = \"\";\n        byte[] foto_e = null;\n        int existe = 0;\n        string nombredia = \"\";\n        string nombredia2 = \"\";\n        DateTime cumple = Convert.ToDateTime(\"1900-01-01\");\n        int horarioX = 0;\n\n        System.Drawing.Image handle = null;\n        IntPtr hdc = GetDC(System.IntPtr.Zero);\n        grFingerXCtrl.CapRawImageToHandle(ref e.rawImage, e.width, e.height,\n                                            hdc.ToInt32(), ref handle);\n\n        if (whichForm.Equals(\"FormAuth\")) //do the action related to the FormAuth\n        {\n\n            rawImage.Image = handle; //put the just added image in our picture box\n            rawImage.Update();\n\n            //set the parameters in the FingerprintOPFormUSerMgt class\n            fingerprintOP.rawImage.img = e.rawImage;\n            fingerprintOP.rawImage.height = (int)e.height;\n            fingerprintOP.rawImage.width = (int)e.width;\n            fingerprintOP.rawImage.Res = e.res;\n\n            //finally , we extract the template and try to validate the user\n            fingerprintOP.extractTemplate();\n\n            //Aqui debo comparar la huella con las que existen en la base de datos\n            //Llamo la conexion SQL\n            SqlConnection Wdcon_usuario = new SqlConnection(WDcon);\n            SqlCommand usuario = new SqlCommand();\n            SqlDataReader usuarioDR = null;\n\n            //Instancio la conexion SQL\n            usuario.Connection = Wdcon_usuario;\n\n            //Registro el Query SQL\n            usuario.CommandText = \"SELECT * FROM tabela WHERE (activo = @act) ORDER BY id_huella DESC\";\n            usuario.Parameters.AddWithValue(\"@act\", true);\n\n            //Abro la conexion\n            Wdcon_usuario.Open();\n\n            //Ejecuto la consulta\n            usuarioDR = usuario.ExecuteReader();\n\n\n            bool matched = false;\n            //Empiezo el ciclo\n            while (usuarioDR.Read())\n            {\n                //Verifico si existe la huella en la BD\n                matched = fingerprintOP.authenticate(usuarioDR[\"ID\"].ToString(), ds);\n                if (matched == true)\n                {\n                    existe = 1;\n                    //Cargo los datos del usuario\n                    //MessageBox.Show(\"Hasta aqui llego 1\");\n                    //MessageBox.Show(usuarioDR[\"ID\"].ToString());\n                    idempleado = Convert.ToInt32(usuarioDR[\"ID\"]);\n                    nombre_e = usuarioDR[\"Name\"].ToString();\n                    apellido_e = usuarioDR[\"apellidos\"].ToString();\n                    foto_e = (byte[])usuarioDR[\"foto\"];\n                    cumple = (DateTime)usuarioDR[\"fecha_nacimiento\"];\n                    horarioX = (int)usuarioDR[\"horario\"];\n\n                    //MessageBox.Show(\"Hasta aqui llego 2\");\n\n                    DateTime horario = DateTime.Now; //Te devuelve la hora actual\n\n                    nombredia = horario.DayOfWeek.ToString();\n\n                    switch (nombredia)\n                    {\n                        case \"Monday\":\n                            //your code here\n                            nombredia2 = \"Lunes\";\n                            break;\n                        case \"Tuesday\":\n                            //your code here\n                            nombredia2 = \"Martes\";\n                            break;\n                        case \"Wednesday\":\n                            //your code here\n                            nombredia2 = \"Miercoles\";\n                            break;\n                        case \"Thursday\":\n                            //your code here\n                            nombredia2 = \"Jueves\";\n                            break;\n                        case \"Friday\":\n                            //your code here\n                            nombredia2 = \"Viernes\";\n                            break;\n                        case \"Saturday\":\n                            //your code here\n                            nombredia2 = \"Sabado\";\n                            break;\n                        case \"Sunday\":\n                            //your code here\n                            nombredia2 = \"Domingo\";\n                            break;\n                    }\n\n\n                    int dia1 = horario.Day;\n                    string dia2 = horario.Day.ToString();\n                    if (dia1 &lt; 10)\n                    {\n                        dia2 = \"0\" + horario.Day.ToString();\n                    }\n\n                    int mes1 = horario.Month;\n                    string mes2 = horario.Month.ToString();\n                    if (mes1 &lt; 10)\n                    {\n                        mes2 = \"0\" + horario.Month.ToString();\n                    }\n\n                    string fecha = dia2 + \"/\" + mes2 + \"/\" + horario.Year.ToString();\n\n                    int hora = horario.Hour;\n                    string hora2 = hora.ToString();\n                    if (hora &lt; 10)\n                    {\n                        hora2 = \"0\" + hora2;\n                    }\n\n                    int minutos = horario.Minute;\n                    string minutos2 = minutos.ToString();\n                    if (minutos &lt; 10)\n                    {\n                        minutos2 = \"0\" + minutos2;\n                    }\n\n                    int segundos = horario.Second;\n                    string segundos2 = segundos.ToString();\n                    if (segundos &lt; 10)\n                    {\n                        segundos2 = \"0\" + segundos2;\n                    }\n\n\n                    txtHora.Text = hora2 + \":\" + minutos2 + \":\" + segundos2;\n                    //MessageBox.Show(\"Hasta aqui llego 3\");\n                    txtNombre.Text = nombre_e;\n                    txtDiaSemana.Text = nombredia2;\n                    txtFecha.Text = fecha;\n                    txtID.Text = idempleado.ToString();\n                    txtApellido.Text = apellido_e.ToString();\n                    if (foto_e != null)\n                    {\n                        MemoryStream Buffer = new MemoryStream(foto_e);\n                        Bitmap Img = new Bitmap(Buffer);\n                        this.picEmpleado.Image = Img;\n                    }\n                    else\n                    {\n                        this.picEmpleado.Image = null;\n                    }\n                    picEmpleado.Visible = true;\n                    picEmpleado.Enabled = true;\n                    //MessageBox.Show(\"Hasta aqui llego 4\");\n\n                }\n\n            }\n\n            if (existe == 0)\n            {\n                activado_timer = 0;\n                txtUbicacion.Visible = false;\n                txtHora.Text = \"\";\n                txtNombre.Text = \"\";\n                txtFecha.Text = \"\";\n                txtID.Text = \"\";\n                txtDiaSemana.Text = \"\";\n                txtApellido.Text = \"\";\n                labelMensajes.Text = \"Empleado no Encontrado\";\n                picEmpleado.Visible = false;\n                txtIngresoManual.Text = \"\";\n                txtIngresoManual.Text = \"\";\n                labelCumple.Text = \"\";\n                Activar_Tiempo();\n            }\n            if (existe == 1)\n            {\n                bool dejarpasar = true;\n                int razon = 0;\n                bool tarde = Llego_Tarde(horarioX, DateTime.Now, Convert.ToInt64(idempleado), Existe_Movimiento2(horarioX, Convert.ToInt64(idempleado)));\n                /*\n                    * razon = 1 -&gt; No se permite el acceso en da Feriados\n                    * razon = 2 -&gt; Usuario de encuentra denegado\n                    * razon = 3 -&gt; Llegada Tarde\n                    */\n                if ((Permite_movimientos_feriados() == false) &amp;&amp; (dia_feriado() == true))\n                {\n                    dejarpasar = false;\n                    razon = 1;\n                }\n                if (buscar_denegado(idempleado) == true)\n                {\n                    dejarpasar = false;\n                    razon = 2;\n                }\n                if ((PermitirLlegadaTarde() == false) &amp;&amp; (tarde == true))\n                {\n                    dejarpasar = false;\n                    razon = 3;\n                }\n                if ((configuracion_bloqueo() == true) &amp;&amp; (Verifica_Horario_Empleado(Convert.ToInt64(idempleado), horarioX, DateTime.Now, nombredia2) == false))\n                {\n                    dejarpasar = false;\n                    razon = 4;\n                }\n                if ((total_restriccion(idempleado) == false) &amp;&amp; (buscar_restriccion_empleado(idempleado)==true))\n                {\n                    dejarpasar = false;\n                    razon = 5;\n                }\n                TimeSpan dif = DateTime.Now - UltimoMovimiento2(idempleado);\n                double dif2 = dif.TotalSeconds;\n                if (dif2 &lt;= Convert.ToDouble(bloqueo))\n                {\n                    dejarpasar = false;\n                    razon = 7;\n                }\n                /*\n                DateTime newdatetime = new DateTime();\n                DateTime ultimomovimiento = UltimoMovimiento();\n                if (ultimomovimiento == newdatetime)\n                {\n                    ultimomovimiento = DateTime.Now;\n                }\n                if (DateTime.Now &lt; ultimomovimiento)\n                {\n                    dejarpasar = false;\n                    razon = 6;\n                }\n                    */\n                if (dejarpasar == false)\n                {\n                    switch (razon)\n                    {\n                        case 1:\n                            txtUbicacion.Enabled = true;\n                            txtUbicacion.Visible = true;\n                            picEmpleado.Visible = true;\n                            txtUbicacion.BackColor = System.Drawing.Color.Red;\n                            txtUbicacion.ForeColor = System.Drawing.Color.White;\n                            txtUbicacion.Visible = true;\n                            txtUbicacion.Text = \"DIA FERIADO\";\n                            labelMensajes.Text = \"No se permite el ingreso en das Feriados\";\n                            Activar_Tiempo();\n                            break;\n                        case 2:\n                            txtUbicacion.Enabled = true;\n                            txtUbicacion.Visible = true;\n                            picEmpleado.Visible = true;\n                            txtUbicacion.BackColor = System.Drawing.Color.Red;\n                            txtUbicacion.ForeColor = System.Drawing.Color.White;\n                            txtUbicacion.Visible = true;\n                            txtUbicacion.Text = \"DENEGADO\";\n                            labelMensajes.Text = \"Por favor ponganse en contacto con su supervisor, esta Denegado\";\n                            Activar_Tiempo();\n                            break;\n                        case 3:\n                            txtUbicacion.Enabled = true;\n                            txtUbicacion.Visible = true;\n                            picEmpleado.Visible = true;\n                            txtUbicacion.BackColor = System.Drawing.Color.Red;\n                            txtUbicacion.ForeColor = System.Drawing.Color.White;\n                            txtUbicacion.Visible = true;\n                            txtUbicacion.Text = \"TARDE\";\n                            labelMensajes.Text = \"Por favor ponganse en contacto con su supervisor, ha llegado Tarde\";\n                            Activar_Tiempo();\n                            break;\n                        case 4:\n                            txtUbicacion.Enabled = true;\n                            txtUbicacion.Visible = true;\n                            picEmpleado.Visible = true;\n                            txtUbicacion.BackColor = System.Drawing.Color.Red;\n                            txtUbicacion.ForeColor = System.Drawing.Color.White;\n                            txtUbicacion.Visible = true;\n                            txtUbicacion.Text = \"INVALIDO\";\n                            labelMensajes.Text = \"No puede entrar ni salir fuera del Horario Estipulado\";\n                            Activar_Tiempo();\n                            break;\n                        case 5:\n                            txtUbicacion.Enabled = true;\n                            txtUbicacion.Visible = true;\n                            picEmpleado.Visible = true;\n                            txtUbicacion.BackColor = System.Drawing.Color.Red;\n                            txtUbicacion.ForeColor = System.Drawing.Color.White;\n                            txtUbicacion.Visible = true;\n                            txtUbicacion.Text = \"INVALIDO\";\n                            labelMensajes.Text = \"No puede acceder en este Equipo\";\n                            Activar_Tiempo();\n                            break;\n                        case 6:\n                            txtUbicacion.Enabled = true;\n                            txtUbicacion.Visible = true;\n                            picEmpleado.Visible = true;\n                            txtUbicacion.BackColor = System.Drawing.Color.Red;\n                            txtUbicacion.ForeColor = System.Drawing.Color.White;\n                            txtUbicacion.Visible = true;\n                            txtUbicacion.Text = \"INVALIDO\";\n                            labelMensajes.Text = \"Ultimo Movimiento tiene Hora mayor a la actual\";\n                            Activar_Tiempo();\n                            break;\n                        case 7:\n                            txtUbicacion.Enabled = true;\n                            txtUbicacion.Visible = true;\n                            picEmpleado.Visible = true;\n                            txtUbicacion.BackColor = System.Drawing.Color.Orange;\n                            txtUbicacion.ForeColor = System.Drawing.Color.White;\n                            txtUbicacion.Visible = true;\n                            txtUbicacion.Text = \"BLOQUEADO\";\n                            labelMensajes.Text = \"Debe Esperar \" + (Convert.ToDouble(bloqueo) - dif2).ToString(\"F\") + \" segundos para volver a marcar\";\n                            Activar_Tiempo();\n                            break;\n                    }\n                }\n                else\n                {\n                    bool dentroempresa = false;\n                    txtUbicacion.ForeColor = System.Drawing.Color.Black;\n                    txtIngresoManual.Text = \"\";\n                    txtUbicacion.Visible = true;\n                    if (Detectar_Ubicacion(idempleado) == 1)\n                    {\n                        dentroempresa = true;\n                    }\n                    if (Detectar_Ubicacion(idempleado) == 0)\n                    {\n                        dentroempresa = false;\n                    }\n\n                    if (dentroempresa == true)\n                    {\n                        txtUbicacion.Text = \"ENTRADA\";\n                        txtUbicacion.BackColor = System.Drawing.Color.Aquamarine;\n                    }\n                    else\n                    {\n                        txtUbicacion.Text = \"SALIDA\";\n                        txtUbicacion.BackColor = System.Drawing.Color.Yellow;\n                    }\n\n                    //Limpio el listado\n                    listaEmpleados.Items.Clear();\n                    //Realizo las operaciones de empleados\n                    Operaciones_Empleados();\n\n                    string fecha2 = cumple.Month.ToString();\n                    string fecha3 = cumple.Day.ToString();\n                    string fecha = fecha2 + \"-\" + fecha3;\n                    Cumpelanos(fecha);\n                    Mensajes_Empleados(idempleado);\n                    //Abro la puerta en caso de que esta este configurada\n                    if (configuracion_puerta() == true)\n                    {\n\n                        try\n                        {\n                            byte[] mBuffer = new byte[1];\n                            mBuffer[0] = 0x1; //ASCII nmero 1.\n                            serialPort1.Write(mBuffer, 0, mBuffer.Length);\n                        }\n                        catch\n                        {\n                            MessageBox.Show(\"La puerta no se puede abrir debido a que este equipo no posee puerto serial, si no desea que salga este mensaje, quite la opcion de abrir puertas en la configuracion.\");\n                        }\n\n                    }\n                    Activar_Tiempo();\n                    DateTime HoraLlegada = Convert.ToDateTime(txtHora.Text);\n                    Comprobar_horario(horarioX, HoraLlegada, idempleado, dentroempresa);\n\n\n                    if (dentroempresa == true)\n                    {\n                        txtUbicacion.Text = \"ENTRADA\";\n                        txtUbicacion.BackColor = System.Drawing.Color.Aquamarine;\n                    }\n                    else\n                    {\n                        txtUbicacion.Text = \"SALIDA\";\n                        txtUbicacion.BackColor = System.Drawing.Color.Yellow;\n                    }\n                    if (foto_e != null)\n                    {\n                        MemoryStream Buffer = new MemoryStream(foto_e);\n                        Bitmap Img = new Bitmap(Buffer);\n                        this.picEmpleado.Image = Img;\n                    }\n                    else\n                    {\n                        this.picEmpleado.Image = null;\n                    }\n                    picEmpleado.Visible = true;\n                    //Registro la entrada(1) y/o salida(0)\n                    Cargar_Movimiento(idempleado);\n                    //Limpio el listado\n                    listaEmpleados.Items.Clear();\n                    //Realizo las operaciones de empleados\n                    Operaciones_Empleados();\n\n                    string fechaM = cumple.Month.ToString();\n                    string fechaD = cumple.Day.ToString();\n                    string fechaC = fechaM + \"-\" + fechaD;\n                    Cumpelanos(fechaC);\n                    Mensajes_Empleados(idempleado);\n                    //Abro la puerta en caso de que esta este configurada\n                    if (configuracion_puerta() == true)\n                    {\n                        try\n                        {\n                            byte[] mBuffer = new byte[1];\n                            mBuffer[0] = 0x1; //ASCII nmero 1.\n                            serialPort1.Write(mBuffer, 0, mBuffer.Length);\n                        }\n                        catch\n                        {\n                            MessageBox.Show(\"La puerta no se puede abrir debido a que este equipo no posee puerto serial, si no desea que salga este mensaje, quite la opcion de abrir puertas en la configuracion.\");\n                        }\n\n                    }\n                    Activar_Tiempo();\n                    Comprobar_horario(horarioX, HoraLlegada, idempleado, dentroempresa);\n                }\n            }\n            //Cierro la conexion\n            Wdcon_usuario.Close();\n            //Termino la sentencia SQL\n        }\n        else\n        {\n            formUserMgt.onImageAcquired(handle, e.rawImage, (int)e.height, (int)e.width, e.res);//do the action related to the FormUserMgt\n        }\n\n    }\n</code></pre>\n\n<p>How can i avoid this issue?</p>\n"},{"tags":["java","sql-server","hibernate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12981051,"title":"hibernate to MSSQL server Connection refused: connect","body":"<p>Im trying to run a java desktop application which accesses a MSSQL server using hibernate, but when trying to connect, it throws an exception and i really dont know what to do, here is my config file</p>\n\n<pre><code>&lt;?xml version='1.0' encoding='UTF-8'?&gt;\n&lt;!DOCTYPE hibernate-configuration PUBLIC\n      \"-//Hibernate/Hibernate Configuration DTD 3.0//EN\"\n      \"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd\"&gt;\n\n&lt;!-- Generated by MyEclipse Hibernate Tools.                   --&gt;\n&lt;hibernate-configuration&gt;\n\n&lt;session-factory&gt;\n&lt;property name=\"connection.username\"&gt;&lt;/property&gt;\n&lt;property name=\"connection.password\"&gt;&lt;/property&gt;\n&lt;property name=\"connection.url\"&gt;\n    jdbc:jtds:sqlserver://localhost/databasename;useNTLMv2=true\n&lt;/property&gt;\n\n&lt;property name=\"dialect\"&gt;\n    ba.fit.utilities.FDialect_SqlServer\n&lt;/property&gt;\n&lt;property name=\"myeclipse.connection.profile\"&gt;nova 3&lt;/property&gt;\n\n\n&lt;property name=\"connection.driver_class\"&gt;\n    net.sourceforge.jtds.jdbc.Driver\n&lt;/property&gt;\n\n&lt;!-- JDBC connection pool (use the built-in) --&gt;\n&lt;property name=\"connection.pool_size\"&gt;1&lt;/property&gt;\n\n&lt;!-- Opcije printanja SQL koda u konzolnom prozoru--&gt;\n&lt;property name=\"show_sql\"&gt;true&lt;/property&gt;\n&lt;property name=\"format_sql\"&gt;false&lt;/property&gt;\n&lt;property name=\"use_sql_comments\"&gt;false&lt;/property&gt;\n\n\n&lt;!--vrijednost \"update\" kreira tabele ako nepostoje, ali ih nece mijenjati ako ima potrebe--&gt;\n&lt;property name=\"hibernate.hbm2ddl.auto\"&gt;update&lt;/property&gt;\n\n\n&lt;!-- Enable Hibernate's automatic session context management --&gt;\n&lt;property name=\"current_session_context_class\"&gt;thread&lt;/property&gt;\n\n&lt;!-- Disable the second-level cache --&gt;\n&lt;property name=\"cache.provider_class\"&gt;\n    org.hibernate.cache.NoCacheProvider\n&lt;/property&gt;\n\n&lt;!-- mapirane klase koje trebaju biti \"persistence\" --&gt;\n&lt;!-- \n\n--&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.Administrator\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.BiografijaPosloprimca\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.BiografijaPoslodavca\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.Drzava\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.Grad\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.Kategorija\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.KategorijaBiografija\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.OcjenePoslodavca\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.OcjenePosloprimca\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.Poslodavac\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.Posloprimaoc\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.Projekt\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.ProjektKategorija\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.Racun\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.StatusTuzbe\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.StrucnaSprema\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.Tuzba\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.Uplatnica\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.ZahtjevZaRadNaProjektu\" /&gt;\n&lt;mapping class=\"ba.fit.Tomo_seminar.model.RadnoVrijeme\" /&gt;\n\n\n\n\n\n&lt;/session-factory&gt;\n\n&lt;/hibernate-configuration&gt;\n</code></pre>\n\n<p>but i get this exception</p>\n\n<pre><code>20:52:43,562  WARN SettingsFactory:109 - Could not obtain connection metadata\njava.sql.SQLException: Network error IOException: Connection refused: connect\nat net.sourceforge.jtds.jdbc.ConnectionJDBC2.&lt;init&gt;(ConnectionJDBC2.java:410)\nat net.sourceforge.jtds.jdbc.ConnectionJDBC3.&lt;init&gt;(ConnectionJDBC3.java:50)\nat net.sourceforge.jtds.jdbc.Driver.connect(Driver.java:184)\nat java.sql.DriverManager.getConnection(Unknown Source)\nat java.sql.DriverManager.getConnection(Unknown Source)\nat org.hibernate.connection.DriverManagerConnectionProvider.getConnection(DriverManagerConnectionProvider.java:110)\nat org.hibernate.cfg.SettingsFactory.buildSettings(SettingsFactory.java:76)\nat org.hibernate.cfg.Configuration.buildSettings(Configuration.java:1933)\nat org.hibernate.cfg.Configuration.buildSessionFactory(Configuration.java:1216)\nat org.hibernate.cfg.AnnotationConfiguration.buildSessionFactory(AnnotationConfiguration.java:915)\nat ba.fit.utilities.HibernateUtil.&lt;clinit&gt;(HibernateUtil.java:24)\nat ba.fit.Tomo_seminar.persistence.PosloprimaocDAO.pronadji(PosloprimaocDAO.java:17)\nat ba.fit.Tomo_seminar.services.servLogin.LoginPosloprimaoc(servLogin.java:31)\nat ba.fit.imeprojekta.ui.gui.v1.FrmLogin.do_btnLogin_widgetSelected(FrmLogin.java:142)\nat ba.fit.imeprojekta.ui.gui.v1.FrmLogin$1.widgetSelected(FrmLogin.java:92)\nat org.eclipse.swt.widgets.TypedListener.handleEvent(Unknown Source)\nat org.eclipse.swt.widgets.EventTable.sendEvent(Unknown Source)\nat org.eclipse.swt.widgets.Widget.sendEvent(Unknown Source)\nat org.eclipse.swt.widgets.Display.runDeferredEvents(Unknown Source)\nat org.eclipse.swt.widgets.Display.readAndDispatch(Unknown Source)\nat ba.fit.imeprojekta.ui.gui.v1.FrmLogin.main(FrmLogin.java:44)\nCaused by: java.net.ConnectException: Connection refused: connect\nat java.net.TwoStacksPlainSocketImpl.socketConnect(Native Method)\nat java.net.AbstractPlainSocketImpl.doConnect(Unknown Source)\nat java.net.AbstractPlainSocketImpl.connectToAddress(Unknown Source)\nat java.net.AbstractPlainSocketImpl.connect(Unknown Source)\nat java.net.PlainSocketImpl.connect(Unknown Source)\nat java.net.SocksSocketImpl.connect(Unknown Source)\nat java.net.Socket.connect(Unknown Source)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nat java.lang.reflect.Method.invoke(Unknown Source)\nat net.sourceforge.jtds.jdbc.SharedSocket.createSocketForJDBC3(SharedSocket.java:307)\nat net.sourceforge.jtds.jdbc.SharedSocket.&lt;init&gt;(SharedSocket.java:257)\nat net.sourceforge.jtds.jdbc.ConnectionJDBC2.&lt;init&gt;(ConnectionJDBC2.java:311)\n... 20 more\n20:52:46,015 ERROR SchemaUpdate:134 - could not get database metadata\njava.sql.SQLException: Network error IOException: Connection refused: connect\nat net.sourceforge.jtds.jdbc.ConnectionJDBC2.&lt;init&gt;(ConnectionJDBC2.java:410)\nat net.sourceforge.jtds.jdbc.ConnectionJDBC3.&lt;init&gt;(ConnectionJDBC3.java:50)\nat net.sourceforge.jtds.jdbc.Driver.connect(Driver.java:184)\nat java.sql.DriverManager.getConnection(Unknown Source)\nat java.sql.DriverManager.getConnection(Unknown Source)\nat org.hibernate.connection.DriverManagerConnectionProvider.getConnection(DriverManagerConnectionProvider.java:110)\nat org.hibernate.tool.hbm2ddl.SuppliedConnectionProviderConnectionHelper.prepare(SuppliedConnectionProviderConnectionHelper.java:27)\nat org.hibernate.tool.hbm2ddl.SchemaUpdate.execute(SchemaUpdate.java:127)\nat org.hibernate.impl.SessionFactoryImpl.&lt;init&gt;(SessionFactoryImpl.java:314)\nat org.hibernate.cfg.Configuration.buildSessionFactory(Configuration.java:1218)\nat org.hibernate.cfg.AnnotationConfiguration.buildSessionFactory(AnnotationConfiguration.java:915)\nat ba.fit.utilities.HibernateUtil.&lt;clinit&gt;(HibernateUtil.java:24)\nat ba.fit.Tomo_seminar.persistence.PosloprimaocDAO.pronadji(PosloprimaocDAO.java:17)\nat ba.fit.Tomo_seminar.services.servLogin.LoginPosloprimaoc(servLogin.java:31)\nat ba.fit.imeprojekta.ui.gui.v1.FrmLogin.do_btnLogin_widgetSelected(FrmLogin.java:142)\nat ba.fit.imeprojekta.ui.gui.v1.FrmLogin$1.widgetSelected(FrmLogin.java:92)\nat org.eclipse.swt.widgets.TypedListener.handleEvent(Unknown Source)\nat org.eclipse.swt.widgets.EventTable.sendEvent(Unknown Source)\nat org.eclipse.swt.widgets.Widget.sendEvent(Unknown Source)\nat org.eclipse.swt.widgets.Display.runDeferredEvents(Unknown Source)\nat org.eclipse.swt.widgets.Display.readAndDispatch(Unknown Source)\nat ba.fit.imeprojekta.ui.gui.v1.FrmLogin.main(FrmLogin.java:44)\nCaused by: java.net.ConnectException: Connection refused: connect\nat java.net.TwoStacksPlainSocketImpl.socketConnect(Native Method)\nat java.net.AbstractPlainSocketImpl.doConnect(Unknown Source)\nat java.net.AbstractPlainSocketImpl.connectToAddress(Unknown Source)\nat java.net.AbstractPlainSocketImpl.connect(Unknown Source)\nat java.net.PlainSocketImpl.connect(Unknown Source)\nat java.net.SocksSocketImpl.connect(Unknown Source)\nat java.net.Socket.connect(Unknown Source)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nat java.lang.reflect.Method.invoke(Unknown Source)\nat net.sourceforge.jtds.jdbc.SharedSocket.createSocketForJDBC3(SharedSocket.java:307)\nat net.sourceforge.jtds.jdbc.SharedSocket.&lt;init&gt;(SharedSocket.java:257)\nat net.sourceforge.jtds.jdbc.ConnectionJDBC2.&lt;init&gt;(ConnectionJDBC2.java:311)\n... 21 more\n20:52:46,015 ERROR SchemaUpdate:165 - could not complete schema update\njava.sql.SQLException: Network error IOException: Connection refused: connect\nat net.sourceforge.jtds.jdbc.ConnectionJDBC2.&lt;init&gt;(ConnectionJDBC2.java:410)\nat net.sourceforge.jtds.jdbc.ConnectionJDBC3.&lt;init&gt;(ConnectionJDBC3.java:50)\nat net.sourceforge.jtds.jdbc.Driver.connect(Driver.java:184)\nat java.sql.DriverManager.getConnection(Unknown Source)\nat java.sql.DriverManager.getConnection(Unknown Source)\nat org.hibernate.connection.DriverManagerConnectionProvider.getConnection(DriverManagerConnectionProvider.java:110)\nat org.hibernate.tool.hbm2ddl.SuppliedConnectionProviderConnectionHelper.prepare(SuppliedConnectionProviderConnectionHelper.java:27)\nat org.hibernate.tool.hbm2ddl.SchemaUpdate.execute(SchemaUpdate.java:127)\nat org.hibernate.impl.SessionFactoryImpl.&lt;init&gt;(SessionFactoryImpl.java:314)\nat org.hibernate.cfg.Configuration.buildSessionFactory(Configuration.java:1218)\nat org.hibernate.cfg.AnnotationConfiguration.buildSessionFactory(AnnotationConfiguration.java:915)\nat ba.fit.utilities.HibernateUtil.&lt;clinit&gt;(HibernateUtil.java:24)\nat ba.fit.Tomo_seminar.persistence.PosloprimaocDAO.pronadji(PosloprimaocDAO.java:17)\nat ba.fit.Tomo_seminar.services.servLogin.LoginPosloprimaoc(servLogin.java:31)\nat ba.fit.imeprojekta.ui.gui.v1.FrmLogin.do_btnLogin_widgetSelected(FrmLogin.java:142)\nat ba.fit.imeprojekta.ui.gui.v1.FrmLogin$1.widgetSelected(FrmLogin.java:92)\nat org.eclipse.swt.widgets.TypedListener.handleEvent(Unknown Source)\nat org.eclipse.swt.widgets.EventTable.sendEvent(Unknown Source)\nat org.eclipse.swt.widgets.Widget.sendEvent(Unknown Source)\nat org.eclipse.swt.widgets.Display.runDeferredEvents(Unknown Source)\nat org.eclipse.swt.widgets.Display.readAndDispatch(Unknown Source)\nat ba.fit.imeprojekta.ui.gui.v1.FrmLogin.main(FrmLogin.java:44)\nCaused by: java.net.ConnectException: Connection refused: connect\nat java.net.TwoStacksPlainSocketImpl.socketConnect(Native Method)\nat java.net.AbstractPlainSocketImpl.doConnect(Unknown Source)\nat java.net.AbstractPlainSocketImpl.connectToAddress(Unknown Source)\nat java.net.AbstractPlainSocketImpl.connect(Unknown Source)\nat java.net.PlainSocketImpl.connect(Unknown Source)\nat java.net.SocksSocketImpl.connect(Unknown Source)\nat java.net.Socket.connect(Unknown Source)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nat java.lang.reflect.Method.invoke(Unknown Source)\nat net.sourceforge.jtds.jdbc.SharedSocket.createSocketForJDBC3(SharedSocket.java:307)\nat net.sourceforge.jtds.jdbc.SharedSocket.&lt;init&gt;(SharedSocket.java:257)\nat net.sourceforge.jtds.jdbc.ConnectionJDBC2.&lt;init&gt;(ConnectionJDBC2.java:311)\n... 21 more\n20:52:47,328  WARN JDBCExceptionReporter:71 - SQL Error: 0, SQLState: 08S01\n20:52:47,328 ERROR JDBCExceptionReporter:72 - Network error IOException: Connection refused: connect\n</code></pre>\n"},{"tags":["sql-server","oracle","stored-procedures","plsql"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":64,"score":2,"question_id":12980854,"title":"Oracle DB: Return second query if first query is empty","body":"<p>I am writing an Oracle stored procedure to return the results of a database query.  If the query does not produce any results, a second query must be run in its place.</p>\n\n<p>In SQL Server, I can accomplish this using something similar to the following:</p>\n\n<pre><code>INSERT INTO @TableVar\nSELECT &lt;joinQuery1&gt;;\n\nIF (SELECT COUNT(*) FROM @TableVar) &gt; 0\nBEGIN\n    SELECT * FROM @TableVar;  -- returns &lt;joinQuery1&gt;\nEND\nELSE\n    SELECT &lt;joinQuery2&gt;;  --returns &lt;joinQuery2&gt;\nEND\n</code></pre>\n\n<p>However, I can not wrap my head around how to accomplish the same task in Oracle.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12980705,"title":"how to get rows data on the column side","body":"<p>I have a employee table with salary according to number of years as follows:</p>\n\n<pre><code>Employee_table\n-----------------------------------------------------------------------------\nemp_ID -  FirstName- LstName   salary  ...    year -  \n001   -   xx     -     yy   -   03212         2000       \n001   -   xx     -     yy   -   04212         2001        \n002   -   xxx     -    yyy  -   03425         2000         \n002   -   xxx     -    yyy  -   04425         2001          \n003   -   xxxx    -    yyyy  -  03429         2000         \n003   -   xxxx   -     yyyy  -  04429         2001         \n------------------------------------------------------------------------------\n</code></pre>\n\n<p>And I want to write a query which will give me the employee data with year on the column side as:</p>\n\n<pre><code>tblResults\n---------------------------------------------------------------------\nemp_ID   2000       2001          ....     ....            \n---------------------------------------------------------------------\n01        03212     04212   \n02        03425   - 04425    \n03        03429     04429   \n</code></pre>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":12978308,"title":"SQl Server Query against Server Group","body":"<p>So I am using the tsql  code to run through a bunch of servers, and look in each database for the users. My issue that on a specific server, there are databases I do not have access to and do not need to use. When the query runs on them it stops on the entire server and moves to the next one. I have been trying to find a way to exclude certain databses from the search.</p>\n\n<p>What I am trying to do is </p>\n\n<p>for example on server A excluded these databses B,C,D, and so on . I have tried where &lt;> and != and does not work or I have the wrong syntax</p>\n\n<pre><code>USE MASTER\n\nIf OBJECT_ID('#TDB', 'U') &gt; 0\nDrop Table #TDB\n\nDECLARE @dbname varchar(200),\n        @sql varchar(max)\n\nCREATE TABLE #TDB (\nDataBaseName nvarchar(200), \nUserName nvarchar(200)\n)\n\nDECLARE db_cursor CURSOR FOR\nSELECT name\nFROM master.dbo.sysdatabases WHERE DBID&gt;4\nOPEN db_cursor\nFETCH NEXT FROM db_cursor INTO @dbname\nWHILE @@FETCH_STATUS = 0\n\nBEGIN\n\nSET @sql='insert into #TDb(DataBaseName,UserName)\nselect '''+@dbname+''' DataBaseName,[user_name] UserName FROM '+@dbname+'.[dbo].[USERS] where'+@dbname+'&lt;&gt;[APSSWATCH]' \n\nEXEC(@sql)\n\nFETCH NEXT FROM db_cursor INTO @dbname\n\nEND\n\nCLOSE db_cursor\nDEALLOCATE db_cursor\n\nSELECT * FROM #TDB ORDER BY DataBaseName,UserName\nDROP TABLE #TDB\n</code></pre>\n"},{"tags":["sql","sql-server","delete"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12980363,"title":"Delete from statement using aggregates in HAVING clause SQL Server 2008","body":"<p>I have a table that looks like the following <img src=\"http://i.stack.imgur.com/fk2OW.jpg\" alt=\"enter image description here\"></p>\n\n<p>where what should be a unique identifier,drg, is not, so I started on the personal challenge of fixing it.  I could do this easily a myriad of ways but I'm trying to do some things in a different fashion to learn some new techniques.  What needs to be deleted from the table is any row whose drg is <strong>not</strong> unique and whose eff_date is *<em>less than *</em> the max eff_date.</p>\n\n<p>To find what I needed I used</p>\n\n<pre><code>select d1.drg, MAX(d1.eff_date) as maxEffDate,d2.drgdesc\n    from drgtable d1\n    inner join drgtable d2 on d1.drg=d2.drg \n    group by d1.drg,d2.drgdesc\n    having MAX(d1.eff_date) = MAX(d2.eff_date)\n</code></pre>\n\n<p>Instead of just selecting this into a new table and dropping the old one, I'd like to do it in a delete statement.  </p>\n\n<p>My though process on the strange looking query below was to find the rows that weren't in the table from the above query I used and delete them.  I got close, but am stuck.  Also, if there's a way easier way to do this, please let me know.  Thanks</p>\n\n<p>--the purpose of this was to find the rows in d3 that were not in d4 and delete them.  didn't quite get that far</p>\n\n<pre><code>delete from \ndrgtable\nwhere \n(\nselect * from drgtable as d3\nleft join \n(\nselect d1.drg, MAX(d1.eff_date) as maxEffDate,d2.drgdesc\n    from drgtable d1\n    inner join drgtable d2 on d1.drg=d2.drg \n    group by d1.drg,d2.drgdesc\n    having MAX(d1.eff_date) = MAX(d2.eff_date)\n\n) d4 on d4.drg =d3.drg and d4.maxEffDate = d3.eff_date and d3.drgdesc = d4.drgdesc\n) \n</code></pre>\n"},{"tags":["sql-server","spring","hibernate","junit","rollback"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":12713973,"title":"Junit test not rolling back transaction on sqlserver","body":"<p>I have created an integration test of a service that is not rolling back the transaction after completion. I know this from looking at the db and from my the error I get when I run the test a second time. I've been googling this issue all morning and feel I have everything set properly. This is a hibernate/jpa app writing to SQLServer 2008. I am not sure where else to look. Snippet below.</p>\n\n<pre><code>@RunWith(SpringJUnit4ClassRunner.class)\n@TestExecutionListeners({\n        DependencyInjectionTestExecutionListener.class,\n        DirtiesContextTestExecutionListener.class,\n        TransactionalTestExecutionListener.class })\n@TransactionConfiguration(defaultRollback=true)\n@Transactional // extend transactional boundary to test class so that automatic rollback works properly\n@ContextConfiguration(locations = {\n        \"file:./src/main/resources/AghostMobile.Service-business.service-context.xml\",\n        \"file:./src/main/resources/AghostMobile.Service-service-context.xml\",\n        \"file:./src/main/resources/AghostMobile.Service-dao-context.xml\"})\npublic class ColorSchemeMigrationServiceIntTest {\n\n    /**\n     * The service being tested, injected by Spring\n     *\n     */\n    @Autowired\n    ColorSchemeMigrationService service;\n\n    /**\n     * The helper services, injected by Spring.\n     *\n     */\n    @Autowired\n    protected WebsitecolorpaletteuserdefinedService userPaletteService;\n    @Test\n    public void testSaveColorPalette() {\n        Integer mobileWebsiteId = Integer.valueOf(386);\n        Integer custId = Integer.valueOf(15);\n        Integer siteId = Integer.valueOf(2);\n        String user = \"Test\";\n\n        Websitecolorpaletteuserdefined palette = service.translateColorScheme(mobileWebsiteId, custId, siteId, user);\n\n        service.saveColorPalette(palette);\n\n        Websitecolorpaletteuserdefined response = userPaletteService.findWebsitecolorpaletteuserdefinedByCustIdAndSiteId(custId, siteId);\n\n        assertNotNull(\"User palette not found.\", response);\n        assertEquals(\"CustId is not the expected value.\", custId, response.getCustId());\n        assertEquals(\"SiteId is not the expected value.\", siteId, response.getSiteId());\n    }\n</code></pre>\n\n<p>Currently, I have the following beans defined:</p>\n\n<pre><code>&lt;!-- ******************************************************************** --&gt;\n&lt;!-- Setup the transaction manager --&gt;\n&lt;!-- ******************************************************************** --&gt;\n    &lt;!-- Using Atomikos Transaction Manager --&gt;\n    &lt;bean id=\"atomikosTransactionManager\" class=\"com.atomikos.icatch.jta.UserTransactionManager\" init-method=\"init\"\n        destroy-method=\"close\"&gt;\n        &lt;property name=\"forceShutdown\" value=\"true\" /&gt;\n        &lt;property name=\"startupTransactionService\" value=\"true\" /&gt;\n        &lt;property name=\"transactionTimeout\" value=\"60\" /&gt;\n    &lt;/bean&gt;\n\n    &lt;bean id=\"atomikosUserTransaction\" class=\"com.atomikos.icatch.jta.UserTransactionImp\" /&gt;\n    &lt;!-- Configure the Spring framework to use JTA transactions from Atomikos --&gt;\n    &lt;bean id=\"transactionManager\" class=\"org.springframework.transaction.jta.JtaTransactionManager\"&gt;\n        &lt;property name=\"transactionManager\" ref=\"atomikosTransactionManager\" /&gt;\n        &lt;property name=\"userTransaction\" ref=\"atomikosUserTransaction\" /&gt;\n        &lt;property name=\"transactionSynchronizationName\" value=\"SYNCHRONIZATION_ON_ACTUAL_TRANSACTION\" /&gt;\n    &lt;/bean&gt;\n&lt;!-- ******************************************************************** --&gt;\n&lt;!-- Setup a data source --&gt;\n&lt;!-- ******************************************************************** --&gt;\n&lt;!-- Using Apache DBCP Data Sources --&gt;\n&lt;bean name=\"hostDataSource\" class=\"org.apache.commons.dbcp.BasicDataSource\" destroy-method=\"close\" &gt;\n    &lt;property name=\"driverClassName\" value=\"${My_JDTs_to_AgHost_Host_scheme.connection.driver_class}\" /&gt;\n    &lt;property name=\"username\" value=\"${My_JDTs_to_AgHost_Host_scheme.connection.username}\" /&gt;\n    &lt;property name=\"password\" value=\"${My_JDTs_to_AgHost_Host_scheme.connection.password}\" /&gt;\n    &lt;property name=\"url\" value=\"${My_JDTs_to_AgHost_Host_scheme.connection.url}\" /&gt;\n    &lt;property name=\"maxIdle\" value=\"${My_JDTs_to_AgHost_Host_scheme.minPoolSize}\" /&gt;\n    &lt;property name=\"maxActive\" value=\"${My_JDTs_to_AgHost_Host_scheme.maxPoolSize}\" /&gt;\n&lt;/bean&gt;\n\n&lt;!-- ******************************************************************** --&gt;\n&lt;!-- Setup each persistence unit --&gt;\n&lt;!-- ******************************************************************** --&gt;\n            &lt;!-- Configure a JPA vendor adapter --&gt;\n            &lt;bean id=\"My_JDTs_to_AgHost_Host_schemeJPAVendorAdapter\" class=\"org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter\"&gt;\n                &lt;property name=\"showSql\" value=\"${My_JDTs_to_AgHost_Host_scheme.show_sql}\" /&gt;\n                &lt;property name=\"generateDdl\" value=\"${My_JDTs_to_AgHost_Host_scheme.generateDdl}\" /&gt;\n                &lt;property name=\"databasePlatform\" value=\"${My_JDTs_to_AgHost_Host_scheme.dialect}\" /&gt;\n            &lt;/bean&gt;\n            &lt;!-- EntityManager Factory that brings together the persistence unit, datasource, and JPA Vendor --&gt;\n            &lt;bean id=\"My_JDTs_to_AgHost_Host_scheme\" class=\"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean\"&gt;\n                &lt;property name=\"dataSource\" ref=\"hostDataSource\" /&gt;\n                &lt;property name=\"persistenceUnitName\" value=\"My_JDTs_to_AgHost_Host_scheme\" /&gt;\n                &lt;property name=\"jpaVendorAdapter\" ref=\"My_JDTs_to_AgHost_Host_schemeJPAVendorAdapter\" /&gt;\n                    &lt;property name=\"jpaPropertyMap\"&gt;\n                        &lt;map&gt;\n                                    &lt;entry key=\"hibernate.transaction.manager_lookup_class\" value=\"com.atomikos.icatch.jta.hibernate3.TransactionManagerLookup\" /&gt;\n                                    &lt;!-- &lt;entry key=\"hibernate.transaction.factory_class\" value=\"org.hibernate.transaction.JTATransactionFactory\" /&gt; --&gt;\n                                    &lt;entry key=\"hibernate.connection.release_mode\" value=\"on_close\" /&gt;\n                        &lt;/map&gt;\n                    &lt;/property&gt;\n            &lt;/bean&gt;\n</code></pre>\n\n<p>This does allow me to update my data, but does not rollback my transaction. So, I am using a transaction manager,  org.springframework.jdbc.datasource.DataSourceTransactionManager. I replaced the three beans in the \"Setup transaction manager\" block with:</p>\n\n<pre><code>    &lt;bean id=\"transactionManager\"\n        class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"&gt;\n        &lt;property name=\"dataSource\" ref=\"hostDataSource\" /&gt;\n    &lt;/bean&gt;\n</code></pre>\n\n<p>This left me with tests failing with <em>IllegalStateException: This method needs a transaction for the calling thread and none exists.</em> The exception also stated:</p>\n\n<pre><code>Possible causes: either you didn't start a transaction,\nit rolledback due to timeout, or it was committed already.\nACTIONS: You can try one of the following: \n1. Make sure you started a transaction for the thread.\n2. Make sure you didn't terminate it yet.\n3. Increase the transaction timeout to avoid automatic rollback of long transactions;\n   check [http://www.atomikos.com/Documentation/JtaProperties][1] for how to do this.\n</code></pre>\n\n<p>I'll admit to not having read that document yet and will do so after posting these updates. I have also found this thread, which looked promising: <a href=\"http://stackoverflow.com/questions/10897015/persistence-unit-different-hibernate-transaction-manager-lookup-class-property\">persistence-unit, different hibernate.transaction.manager_lookup_class property</a>. You can see that commented out in bean My_JDTs_to_AgHost_Host_scheme. This failed pretty miserably. But, perhaps I didn't use it properly.</p>\n\n<p>I also found this thread: <a href=\"http://stackoverflow.com/questions/3128111/spring-jta-jpa-dao-integration-test-doesnt-rollback\">Spring/JTA/JPA DAO integration test doesn&#39;t rollback?</a>. This looks quite promising, but again I am not sure how to use what it is telling me.</p>\n"},{"tags":["sql-server","database","metadata","database-administration","database-table"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":51,"score":5,"question_id":12980032,"title":"SQL Server - Table Metadata","body":"<p>I have a 1000 tables in the SQL Server Database.  </p>\n\n<p>If I wanted to add a brief description of what each table does in my application, should I be creating another table to maintain that information? Or is there a better way to this?</p>\n\n<p>For example ; If there is a table <code>[PurchaseOrdersConcrete]</code> and I want to note  that - <em>This table stores all POs from Fortune500 companies.</em></p>\n\n<p>Should  I create another meta-data table for this purpose, or is there a - <code>Notes</code> - column somwhere in SQL Server already ... (say in <code>sys.tables</code>)?</p>\n"},{"tags":["sql-server","stored-procedures","batch-file"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":115,"score":1,"question_id":12980353,"title":"Execute stored procedure from batch file","body":"<p>How would you execute a stored procedure in a sql server (windows authentication) from a batch file?</p>\n"},{"tags":["c#","sql-server","database"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12650438,"title":"How to save data to a database when it's attached as service-based database?","body":"<p>I attached the service-based database to my windows application and I used the following code to save the data, it is working correctly, but when I close the application and open again the data which I saved was cleared automatically.</p>\n\n<p>How to save the data permanently...</p>\n\n<pre><code>string c = Application.StartupPath + \"\\\\Stock.mdf\";\nSqlConnection con = new SqlConnection(@\"AttachDbFilename='\"+c+\"';Integrated Security=True;Connect Timeout=30;User Instance=True\");\n\ncon.Open();\n\nSqlCommand cmd = new SqlCommand(\"Insert into Codedetails values('TF','\" + txt_productcode.Text + \"','\" + txt_productname.Text + \"','\" + txt_brandcode.Text + \"','\" + txt_brandname.Text + \"')\", con);\ncmd.ExecuteNonQuery();\ncon.Close();\n</code></pre>\n"},{"tags":["sql","sql-server","database","tsql","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":83,"score":1,"question_id":12976131,"title":"Dynamic use of T-SQL schemas","body":"<p>Is there a way which I can omit the schema of objects used in a stored procedure and these objects aren't bound to the schema of stored procedure but the schema of logged used in manner that the same stored procedure produce different results for user in different schemas?</p>\n\n<p>For better understanding what I'm trying to do, below I'll try to explain better.</p>\n\n<p>Supposing the following database:</p>\n\n<pre><code>CREATE TABLE [dbo].[SampleTable01] (...)\n\nCREATE TABLE [dbo].[SampleTable02] (...)\n\nCREATE TABLE [dbo].[SampleTable03] (...)\n\nCREATE TABLE [dbo].[SampleTable04] (...)\n</code></pre>\n\n<p>In this database, the number following the name of the table represents the owner of the table (it is a legacy system and I can't change that).</p>\n\n<p>To integrate that into .net Entity Framework, I come with a solution of creating synonyms in different schemas, so changing the connections string I can change the objects used without changing my database context or my programming logic. </p>\n\n<p>Like this.</p>\n\n<pre><code>CREATE SCHEMA [s01]\nCREATE SYNONYM [s01].[SampleTable] FOR [dbo].[SampleTable01]\n\n...\n\nCREATE SCHEMA [s04]\nCREATE SYNONYM [s04].[SampleTable] FOR [dbo].[SampleTable04]\n</code></pre>\n\n<p>This solutions is working pretty well, but I need to duplicate all the stored procedures used, because the stored procedures are bound to a specific object.</p>\n\n<p>When I create the following stored procedure:</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[usp_SampleProc] AS\nSELECT * FROM [SampleTable]\n</code></pre>\n\n<p>The stored procedure will produce an error, because the <code>[SampleTable]</code> doesn't exists in the schema <code>[dbo]</code>.</p>\n\n<p>What I'm doing is duplicating the stored procedures to match the schema from the logged user. </p>\n\n<p>So I'm doing this:</p>\n\n<pre><code>CREATE PROCEDURE [s01].[usp_SampleProc] AS\nSELECT * FROM [s01].[SampleTable]\n\n...\n\nCREATE PROCEDURE [s04].[usp_SampleProc] AS\nSELECT * FROM [s04].[SampleTable]\n</code></pre>\n\n<p>A user in <code>[s01]</code> schema will get values from <code>[s01].[SampleTable]</code> and a user in <code>[s04]</code> schema will get values from <code>[s04].[SampleTable]</code>, when executing <code>[usp_SampleProc]</code> without specifying the schema, which is my expected result.</p>\n\n<p>So far so good, this isn't productive in my real scenario. I have thousand of tables, hundreds of procedures and dozen of schemas (I know this is ugly, but I integrating a legacy system with .net, and so far, it is the best solution which I come).</p>\n\n<p>So, the question again:</p>\n\n<p>Is there a way which I can omit the schema of objects used in the stored procedure and these objects aren't bound to the schema of the stored procedure but the schema of the logged in user in manner that the same stored procedure produces different results for users in different schemas?</p>\n"},{"tags":["sql-server","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12979008,"title":"Utilizing SQL datepart to indentify consecutive periods of time","body":"<p>I have a stored procedure that works correctly, but don't understand the theory behind why it works. I'm indentifying a consecutive period of time by utilizing a datepart and dense rank (found solution through help elsewhere). </p>\n\n<pre><code>        select \n            c.bom\n            ,h.x\n            ,h.z\n            ,datepart(year, c.bom) * 12 + datepart(month, c.bom) -- this is returning a integer value for the year and month, allowing us to increment the number by one for each month\n            - dense_rank() over ( partition by h.x order by datepart(year, c.bom) * 12 + datepart(month, c.bom)) as grp -- this row does a dense rank and subtracts out the integer date and rank so that consecutive months (ie consecutive integers) are grouped as the same integer\n\n        from \n            #c c\n\n            inner join test.vw_info_h h\n            on h.effective_date &lt;= c.bom\n            and (h.expiration_date is null or h.expiration_date &gt; c.bom)\n</code></pre>\n\n<p>I understand in theory what is happening with the grouping functionality.</p>\n\n<p><strong>How does multiplying year * 12 + month work? Why do we multiply the year? What is happening in the backend?</strong></p>\n"},{"tags":["sql-server","transactional-replication"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12964618,"title":"Transactional Replication Stopping At Distributor","body":"<p>My publisher is dutifully pumping data into the distributor but that is where it is stopping. I'm new to the realm of replication. I know that I can easily solve this by dropping and recreating everything but it seems there must be a more elegant solution.</p>\n\n<ul>\n<li>I sent through a tracer token from the publisher to one of the subscribers. The token made it to the distributor in several milliseconds but didnt go past that</li>\n<li>Im getting these 2 errors when I look at the subscribers</li>\n<li>The server \"blah\" is not configured as a distributor (sp_helpdistributor says it is)</li>\n<li>The process could not connect to distributor \"blah\"</li>\n<li>The publisher to distributor history looks good and says \"No replicated transactions available\"</li>\n</ul>\n"},{"tags":["php","sql-server","apache","inconsistency"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":12965705,"title":"2 identical installations of apache/php return different results from the same SQL Server database","body":"<p>I wrote the code on my development machine WinXPsp3, which has apache standalone 2.2.21. The query worked fine.</p>\n\n<p>I then copied the php over my production machine WinXPsp3, which had apache 2.2 windows installation with php 5.3.5 windows installation, and is the SQL Server machine, but the query crashed.</p>\n\n<p>I uninstalled apache and php on the production machine and copied my stand-alone version over from the development machine, but when I started apache, I got an error that MSCPV100.dll was missing.\nI installed MS C++ Redist, and that problem went away.</p>\n\n<p>The query is as follows:\n<PRE>\n    SELECT TOP (50) \n    [ID], \n    (SELECT Case \n    WHEN [Location] is null then 'Unknown' \n    WHEN [Location]='' THEN 'Unknown' \n    ELSE UPPER([Location]) END\n     + ', ' as [text()] FROM dbo.[OtherTable] \n    WHERE [OtherTable].[Key]=[Table].[ID] FOR XML path('')) AS Locations \n    FROM Table</PRE></p>\n\n<p>(any mis-formatting here is not reflective of my actual query, as it works on other apache installations)</p>\n\n<p>The query is choking on the lower-case \"AS\" before [text()] with \"Incorrect Syntax near the Keyword 'as'\".</p>\n\n<p>The query was originally in uppercase, and had many more fields, so I used lower case until I found out which \"AS\" the failure description was talking about.</p>\n\n<p>I tried replacing the \"[]\" around text() with \"''\", but that didn't help.</p>\n\n<p>The facts I know to be true:</p>\n\n<ul>\n<li><p>The apache installations are identical.</p></li>\n<li><p>The php installations are identical.</p></li>\n<li><p>The query works fine when hosted through the identical installation<br>\nof apache on a different machine.</p></li>\n<li><p>Other queries are working fine on the production machine after the<br>\napache/php upgrade.</p></li>\n</ul>\n\n<p>This information leads me to believe that there's something awry with the production machine, and not apache, sql server, php, or the query. Any ideas as to what that might be?</p>\n\n<p>A couple of things I didn't mention:</p>\n\n<p>The PHP connection type is odbc.</p>\n\n<p>The SQL Server ODBC drivers on both machines are 2000.85.1132.0, but the production machine also has SQL Server Native Client 10.0 version 2007.100.2531.00.</p>\n"},{"tags":["sql-server","sql-server-2008","audit"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":231,"score":5,"question_id":3933881,"title":"Is their an elegant way to track the modification of all columns of one table in SQL Server 2008","body":"<p>There is a table in my database containing 100 columns. I want to create a trigger to audit the modification for every update operation. </p>\n\n<p>What I can think is to create the update clause for all columns but they are all similar scripts. So is there any elegant way to do that?</p>\n"},{"tags":["mysql","sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12979206,"title":"sql server version of mysql_fetch_assoc","body":"<p>I have a short PHP script that interacts with a database. The script is currently written for MySQL but needs to be converted to SQL Server. I don't have experience with SQL Server and think I have done most of it correctly but in one line of the script is:</p>\n\n<p><code>@mysql_fetch_assoc($result)</code></p>\n\n<p>What is the SQL Server equivalent of this?<br /></p>\n\n<p>Do I need to edit the query line at all?</p>\n\n<pre><code>$query = 'SELECT * FROM location WHERE dType=\"' . $ajax_var . '\" AND oType=\"' . $ajax_var2 . '\"';\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":12962044,"title":"sp_send_dbmail Error In Microsoft SQL Agent Job","body":"<p>Im trying to send an email from a scheduled SQL Agent job using sp_send_dbmail and receive the following error:</p>\n\n<p>Msg 22050, Level 16, State 1, Line 0\nError formatting query, probably invalid parameters\nMsg 14661, Level 16, State 1, Procedure sp_send_dbmail, Line 504\nQuery execution failed: Msg 15404, Level 16, State 19, Server MyServer, Line 1\nCould not obtain information about Windows NT group/user 'MyDomain\\sqlagent', error code 0x5.</p>\n\n<p>Here is the code from the job step:</p>\n\n<pre><code>DECLARE @SQL NVARCHAR(400)\nSELECT @SQL = 'SELECT COUNT(staff_id) FROM Staff'\n\nEXEC msdb.dbo.sp_send_dbmail\n@recipients = 'me@myemail.com',\n@subject = 'Email Alert',\n@body = 'Test',\n@query = @SQL,\n@execute_query_database = 'MyDB'\n</code></pre>\n\n<p>SQL Agent is running under a domain account [MyDomain\\sqlagent].  I granted this user db_owner permission in the MyDB database in addition to adding it as a member of the DatabaseMailUserRole in msdb.  Still no luck.  If I remove the @query and @execute_query_database parameters it will send a test email.  However, I need to attach the results from the query.</p>\n\n<p>Any help is appreciated, thanks.</p>\n"},{"tags":["sql","sql-server","bulkinsert"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":12977425,"title":"SQL Server 2008 Import RawData Into Table based on Filename","body":"<p>I have a table with ZIP files saved as RawData.  I've extracted the ZIP files using BCP, then unzipped them using 7-zip.  The Unzipped files are RTF files that are given the ID number for the name.  For example 56.rtf, 65.rtf, etc.  My question is how do I import the raw RTF data into a row in a table based on the file name?  I've been playing with BULK INSERT and that gets the data into a table with one column, but how do I know which row in the table corresponds to which file so it can be retrieved with a query? I'm fairly new at this so try to keep it as simple as possible. </p>\n"},{"tags":["sql-server","join","ssas"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12978521,"title":"SSAS Selective NonEmpty","body":"<p>I have a SSAS 2012 cube with several dimensions, one of which is a Time dimension. I also have a Client dimension which joins to a Product dimension. Product joins to a fact table that contains a date.</p>\n\n<p>I can filter to a Client and see his Products and related fact information.</p>\n\n<p>I have the requirement that I always want to see <em>all</em> the dates in the time dimension whether I have fact rows for them or not.</p>\n\n<p>I've experimented with NONEMPTY (being a newbie to MDX) but I only ever see the effect of this giving me a full outer join, i.e. it will show me products unrelated to the client I've selected.</p>\n\n<p>It's like I need to tell it to show all dates only but still honor the other joins.</p>\n\n<p>Any advice would be very gratefully received.</p>\n"},{"tags":["sql","sql-server","matlab","floating-point"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12964833,"title":"MATLAB dealing with approximation-- singles to doubles","body":"<p>I am pulling financial data into Matlab from SQL, where it is unfortunately stored as a 'Real' (which is an approximate data-type).</p>\n\n<p>For example, a value got loaded into SQL as \"96.194\" which is the correct value (this could have any number of decimals 1-5). I know in SQL it is stored as something like 96.19400024 because it is an approximation, but SQL Server somehow knows to display it as 96.194.</p>\n\n<p>When I pull it into matlab, it gets pulled in as 96.194, which is what I want. Unfortunately, it turns out it's not <em>actually</em> 96.194, as demonstrated:</p>\n\n<pre><code>&gt;&gt;price\nprice =\n           96.194\n\n&gt;&gt; price==96.194\nans =\n     0\n\n&gt;&gt; class(price)\nans =\nsingle\n\n&gt;&gt; double(price)\nans =\n          96.1940002441406\n</code></pre>\n\n<p>So my question is, is there a way to convert a single to a double exactly as it appears as a single (i.e. truncate all the decimals which are the approximation? Note: I cannot just round it because I don't know how many decimals it's supposed to have.</p>\n"},{"tags":["sql-server","sql-server-2008","logging","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12976938,"title":"Log of stored procedure parameters?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10279470/tracing-a-stored-procedures-parameters-handling\">Tracing a stored procedures parameters handling</a>  </p>\n</blockquote>\n\n\n\n<p>Is there any out-of-the-box functionality within SQL Server 2008 that will allow me to see a log of procedures executed, and the parameters passed?  </p>\n\n<p>We have a stored procedure whose return is used to determine if a user can log in to our application or not, and the stored procedure is returning some unexpected results. I'm trying to troubleshoot by seeing if the user ID is getting garbled as it's passed to the stored procedure, but I can't quite seem to find where I could go to check that.</p>\n\n<p>Does such a log/viewer exist?</p>\n"},{"tags":["javascript","asp.net","sql-server","vb.net","google-maps-api-3"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":4,"view_count":61,"score":-4,"question_id":12978455,"title":"On Page Load, Draw Google Map, Get Bounds, Continue To Load Using Bounds Data In DB Query, Load Markers","body":"<p>I am using ASP.net, vb.net, SQL Server 2008, and google maps API V3. I am building an application where I am doing a search on a map and I need to get the bounds(North,East,South,West Corners) of a google map to complete my query send to my database so I can build the markers on my google map. My thoughts are that I would need to load the map while my page load event fires in the code behind, get the bounds during that, use those bounds in my code behind to finish my query to the database, return the query, then finally build the markers into the map. Now I don't know if this is possible, whether or not the map can load before my code behind or if there is a way to make the map load in my code behind. Then how would I get the variables of the bounds into my code behind. Lastly how do I make the map wait till the SQL query is loaded to load the markers. Code examples would help me out a lot.\nTHANKS!</p>\n"},{"tags":["sql-server","ssas","mdx","olap"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12975973,"title":"How Exactly Is NONEMPTY Working Here?","body":"<p>I have a cube with two measure groups, one in MOLAP format and the other in ROLAP format.  I've also created a calculated member (<code>[C]</code>) from a single column in each of the member groups (<code>[A]</code> <strong>MOLAP</strong> and <code>[B]</code> <strong>ROLAP</strong>).  All I want is for <code>[C]</code> to return me the value of <code>[A]</code> if it is not empty, otherwise return <code>[B]</code>.  This is achieved pretty easily with a <code>CASE</code> statement:</p>\n\n<pre><code>WITH MEMBER [C] AS\n    CASE\n        WHEN ISEMPTY([A]) THEN [B]\n        ELSE [A]\n    END\n</code></pre>\n\n<p>This works great, and running the following query displays the results exactly like I would expect them to be displayed, where <code>[C]</code> is <code>[B]</code> only when <code>[A]</code> is empty.</p>\n\n<pre><code>SELECT\n    { [A]\n    , [B]\n    , [C]\n    } ON COLUMNS\n    , [Time].CHILDREN ON ROWS\nFROM    \n    [Cube]\n</code></pre>\n\n<p>However,  there are some cases where both <code>[A]</code> and <code>[B]</code> are empty, and I would like to filter them out of the result set.  Normally, I would be able to just wrap the <code>[Time]</code> dimension in <code>NONEMPTY</code> to achieve this:</p>\n\n<pre><code>SELECT\n    { [A]\n    , [B]\n    , [C]\n    } ON COLUMNS\n    , NONEMPTY([Time].CHILDREN) ON ROWS\nFROM    \n    [Cube]\n</code></pre>\n\n<p>But when I try this with the above query, the results filter out all of the rows where <code>[A]</code> is empty, regardless of whether or not <code>[B]</code> is empty.  Rows where <code>[B]</code> is empty are not filtered out.</p>\n\n<p>I would expect that NONEMPTY would either:</p>\n\n<ol>\n<li>Filter out only rows where <code>[C]</code> is empty (<code>[A]</code> and <code>[B]</code> are empty) <strong>OR</strong></li>\n<li>Filter out all rows where <code>[A]</code> OR <code>[B]</code> is empty</li>\n</ol>\n\n<p>Why is <code>NONEMPTY</code> only taking <code>[A]</code> in to account here?</p>\n"},{"tags":["sql","sql-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12977598,"title":"limit select based on group","body":"<p>What I have is 2 tables.  table A looks like:</p>\n\n<pre><code>actID; jobnumber; actTypeID; completeDate\n1;    2000;       3;      2012-09-04\n2;    2000;       4;      2012-09-05\n3;    2001;       2;      2012-09-10\n4;    2001;       4;      2012-09-05\n5;    2001;       5;      2012-09-05\n6;    2002;       1;      2012-09-12\n</code></pre>\n\n<p>Table B looks like:</p>\n\n<pre><code>actTypeID;  actType;  projStatus;\n1;     Pick;    Build;\n2;     Bid;     Estimate;\n3;     PMQC;    QC;\n4;     Equipment Test;    QC;\n5;     Assembly;    Build;\n</code></pre>\n\n<p>What I need to do is include the <code>projStatus</code> and <code>actType</code> in this:</p>\n\n<pre><code>SELECT jobnumber,\n    max(completedate) completedate\nFROM tableA\nGROUP BY jobnumber\n</code></pre>\n\n<p>without increasing the number of records returned, ie get this set back:</p>\n\n<pre><code>jobnumber; actType; projStatus; completedate;\n2000;  EquipmentTest; QC;       2012-09-05;\n2001;  Bid;           Estimate; 2012-09-10;\n2002;  Pick;          Build;    2012-09-12;\n</code></pre>\n\n<p>I'm on SQL server 2005 right now, soon to be 2008.  I feel like I'm missing the trick to this.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":96,"score":1,"question_id":12976538,"title":"Removing duplicate combinations from result set in SQL Server","body":"<p>I have a table with two columns with data like this:</p>\n\n<pre><code>1,2\n1,3\n1,4\n2,1\n2,2\n3,1\n</code></pre>\n\n<p>I want to select just unique combinations, so out of those I would end up with:</p>\n\n<pre><code>1,2\n1,3\n1,4\n2,2\n</code></pre>\n\n<p>because 1,2 is the same combination as 2,1 etc</p>\n\n<p>How would I go about that in a SQL statement?</p>\n\n<p>In reality, my table has a third column and I want to add a where clause based on that third column so that only those rows are considered</p>\n"}]}
{"total":54452,"page":20,"pagesize":100,"questions":[{"tags":["sql-server","null","alter-table"],"answer_count":9,"favorite_count":11,"up_vote_count":127,"down_vote_count":1,"view_count":93896,"score":126,"question_id":689746,"title":"Altering a column: null to not null","body":"<p>I have a table that has several nullable integer columns.  This is undesirable for several reasons, so I am looking to update all nulls to 0 and then set these columns to \"NOT NULL.\"  Aside from changing nulls to 0, data must be preserved.</p>\n\n<p>I am looking for the <strong>specific sql syntax</strong> to alter a column (call it ColumnA) to \"not null.\"  Assume the data has been updated to not contain nulls.</p>\n\n<p>Using sql server 2000.</p>\n"},{"tags":["sql","sql-server","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12976940,"title":"Transfer data in SQL Server 2008 R2","body":"<p>I have two databases on separate servers (dev and production) I need to move my data from dev to production from multiple tables without affecting the pre-existing data on production. Any idea if SQL Manager support something like this or am I going to have to write a script for it?</p>\n\n<p>My situation in detail:</p>\n\n<p>I have a tool which allow me to create surveys for my company. The tool is located on dev and also on production. Since I don't want to add test data in my production db I am using the dev version of the tool to create my surveys and test them locally. The tool is tied to few tables in my db such as surveys, questions, anwers, results, etc. </p>\n\n<p>My current setup: When I am done with a survey and it is ready to launch, I have to use the production version of the tool to manually redo all of the previous work that i did on production. This is not ideal at all not only because of the time that I have to spend doing it but also risking making mistakes during the manual copying.</p>\n\n<p>What I need to do:\nThose tables that I mentioned above, already have production data in them and they are available for my company to use. When I create a new survey I need to transfer only the specific records of the new survey (from all tables) from dev to production without affecting anything that I had there from before.</p>\n"},{"tags":["sql","sql-server"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":70,"score":3,"question_id":12977514,"title":"NULL check in Sql","body":"<p>Please suggest whats the difference between:</p>\n\n<p>1) <code>WHERE student.name = ISNULL(@name, student.name)</code></p>\n\n<p>And</p>\n\n<p>2) <code>WHERE (student.name = @name OR @name IS NULL)</code></p>\n\n<p>Actually I had a issue bug assigned against my name where some of the records where skipped when I used the first method. But got corrected when I replaced it with eg 2.</p>\n"},{"tags":["sql","sql-server","triggers","talend"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12974832,"title":"SQL Server: Can I use EXEC to run an external Application?","body":"<p>Hello and thank you for your time, </p>\n\n<p>I have been searching everywhere online for an example, where a SQL trigger will run an external application, but I have had no luck. All I am seeing is that the EXEC will execute a SQL procedure. </p>\n\n<p>The reason I need this is, I have a SQL Server 2010 with many tables and when an update or insert occurs on certain tables I need my Talend job to run and update the Salesforce tables. </p>\n\n<p>Currently the Talend jobs are running through A task scheduler but the company wants the information to move right away. </p>\n\n<p>Currently this is my code </p>\n\n<pre><code>CREATE TRIGGER UP_ACCOUNT ON ARCUS\nAFTER INSERT, UPDATE\nAS \n\nIF(exists(SELECT IDCUST FROM inserted WHERE IDCUST IS NOT NULL))\n    BEGIN \n        EXEC [name_of_application]\n    END\n</code></pre>\n\n<p>I still need to do all the checks to make sure this will not crash anything, but the EXEC statement does not seem to want to execute external commands. Any suggestions would be greatly appreciated. </p>\n\n<p>Thank you </p>\n"},{"tags":["sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12977215,"title":"Export production database for developers","body":"<p>We're developing a web application backed by SQL Server.  There will only ever be one instance, so the canonical method of creating the baseline database on a development machine is to copy down the production database.</p>\n\n<p>We keep all pending database changes as SQL scripts, so at any time the developer can get a copy of production and then apply all the applicable SQL scripts.</p>\n\n<p>The production database contains sensitive information that shouldn't be on development machines.  I'm looking for a good way to export the database and package it for developers in a format that's easy to import.</p>\n\n<p>I've answered this question with the way I do it now, but I'm hoping there's a better way.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12967467,"title":"Using Table valued function the code","body":"<pre><code>&lt;pre&gt;\nI have 3 tables and one table valued function: EmpHistory,EmpRank,Emp and fnEmpRank.\nThe sample data are given as follows:\nEmpHistory\nEmpHistID  EmpID  RankID  MonitorDate  RankName\n1          aba     JPR     2008-10-06   Junior Prof\n2          aba     JPR     2009-11-07   Junior Prof\n3          aba     TERM    2012-2-08    Termoinated Prof\n4          aba     ASST    2012-6-22     lab Assistant\n5          aba     ASST    2012-7-2      Lab Assistant\n6          aba     TSST    2012-8-4      Terminated Assistant\n\nEmpRank\nRankID    RankName\nJPR       Junior Professor\nSPR       Senior Professor\nASST      Junior Assistant\nSASST     Senior Assistant\nPL        Principal\n\nEmployee\nEmpID    EmpStartDate\naba       2008-10-06\nabc01     2007-09-23\nsdh        2009-7-26\nsbs        2012-2-8\n\n\nThe fnEmpRank function takes the emproleID and gives the employee history same as the empHistory Table. There is also empoyeerole table which has employeeroleid column.\n\nNow my problem is: I want the second last professor rank of the employee i.e in this case I want Junior Professor row(i.e) 2nd row from emphistory table). Currntly my code is using emphistory table but now intead of that table I want to use fnEmpRank as it gives the same data. I am also giving the sample code.\n\n\nselect\na.EmpID,\na.StartDate,\nJ.RankID,\nc.MonitorDate,\nfrom dbo.vwEmployee A(nolock)\nINNER join dbo.EmpHistory c(nolock) on c.Empid = a.EmpID\nand c.EmpHistoryID = (select max(c1.EmpHistoryID)\n            from dbo.EmpHistory c1(nolock)\n            where c1.Empid = c.EmpID\n            and c1.MonitorDate = \n                    (\n</code></pre>\n\n<p>I have 3 tables and one table valued function: EmpHistory,EmpRank,Emp and fnEmpRank.\n    The sample data are given as follows:</p>\n\n<p>create table EmpHistory(\nEmpHistID int,\nEmpID varchar,\nRankID varchar,\nMonitordate Date,\nRankname varchar)</p>\n\n<p>insert into EmpHistory\nselect 1,'aba','JPR','2008-10-6','Junior Professor'</p>\n\n<p>insert into EmpHistory\nselect 2,'aba','JPR','2009-11-7','Junior Professor'</p>\n\n<p>insert into EmpHistory\nselect 3,'aba','TERM','2012-2-8','Terminated Prof'</p>\n\n<p>insert into EmpHistory\nselect 4,'aba','ASST','2012-6-22','Lab Assistant'</p>\n\n<p>insert into EmpHistory\nselect 5,'aba','ASST','2012-7-2','Lab Assistant'</p>\n\n<p>insert into EmpHistory\nselect 1,'aba','JPR','2012-8-4','Terminated Assistant'</p>\n\n<p>create table EmpRank(\nRankID varchar,\nRankName varchar\n)</p>\n\n<p>insert into EmpRank\nselect 'JPR','Junior Professor'</p>\n\n<p>insert into EmpRank\nselect 'SPR','Senior Professor'</p>\n\n<p>insert into EmpRank\nselect 'ASST','Junior Assistant'</p>\n\n<p>insert into EmpRank\nselect 'SASST','Senior Assistant'</p>\n\n<p>insert into EmpRank\nselect 'PL','Principal'</p>\n\n<p>create table Employee(\nEmpID varchar,\nEmpStartDate date\n)</p>\n\n<p>insert into Employee\nselect 'aba','2008-10-06'</p>\n\n<p>insert into Employee\nselect 'abc01','2007-9-23'</p>\n\n<p>insert into Employee\nselect 'sdh','2009-7-26'</p>\n\n<p>insert into Employee\nselect 'sbs','2012-2-8'</p>\n\n<pre><code>The fnEmpRank function takes the emproleID and gives the employee history same as the empHistory Table. There is also empoyeerole table which has employeeroleid column.\n\nNow my problem is: I want the second last professor rank of the employee i.e in this case I want Junior Professor row(i.e) 2nd row from emphistory table). Currntly my code is using emphistory table but now intead of that table I want to use fnEmpRank as it gives the same data. I am also giving the sample code.\n\n\nselect\na.EmpID,\na.StartDate,\nJ.RankID,\nc.MonitorDate,\nfrom dbo.vwEmployee A(nolock)\nINNER join dbo.EmpHistory c(nolock) on c.Empid = a.EmpID\nand c.EmpHistoryID = (select max(c1.EmpHistoryID)\n            from dbo.EmpHistory c1(nolock)\n            where c1.Empid = c.EmpID\n            and c1.MonitorDate = \n                    (\n                    SELECT MAX(C2.MonitorDate)\n                    FROM dbo.EmpHistory C2\n                    WHERE C2.EmpID = C1.EmpID\n                    )\n\n                    )\njoin dbo.EmpRank d(nolock) on d.RankID = a.RankID\nleft join dbo.EmpHistory f(nolock) on f.EmpID = a.EmpID\n    and f.EmpHistoryID = (select max(g.EmpHistoryID)\n                from dbo.EmpHistory g(nolock)\n                where g.EmpID = a.EmpID\n                AND G.RankID not like 'T%'\n                and g.EmpHistoryID &amp;lt; c.EmpHistoryID)\nleft join dbo.EmpRank h(nolock) on h.RankID = f.RankID\n\nLEFT JOIN dbo.EmpHistory J(NOLOCK) ON J.EmpID = A.EmpID \n    AND J.EmpHistoryID = (\n        SELECT max(K.EmpHistoryID )\n        FROM dbo.EmpHistory K(NOLOCK) \n        WHERE K.EmpID = J.EmpID\n        AND K.AgentRankID NOT LIKE 'T%'\n        AND K.MonitorDate = (\n            SELECT max(M.MonitorDate )\n            FROM dbo.EmpHistory M(NOLOCK)\n            WHERE M.EmpID = J.EmpID \n            AND M.RankID NOT LIKE 'T%'\n        )\n    )\n\nwhere\nA.Prof=1\n c.RankID like 'T%'\nAND c.RankID &lt;&gt;'TSST'\nAND A.StartDate is not null\n\nHere there is one more problem: Even if the Employee is terminated from professor to Assitant, A.Prof values is still 1 and basically Assistant dont have the start dates but when professor are transformed to Assitant, they still contain the start date. How can I handle this in the code. Basically this code assumes that that if emp has the start date then he is the professor. Can any one help me?\n\n\n                    SELECT MAX(C2.MonitorDate)\n                    FROM dbo.EmpHistory C2\n                    WHERE C2.EmpID = C1.EmpID\n                    )\n\n                    )\njoin dbo.EmpRank d(nolock) on d.RankID = a.RankID\nleft join dbo.EmpHistory f(nolock) on f.EmpID = a.EmpID\n    and f.EmpHistoryID = (select max(g.EmpHistoryID)\n                from dbo.EmpHistory g(nolock)\n                where g.EmpID = a.EmpID\n                AND G.RankID not like 'T%'\n                and g.EmpHistoryID &lt; c.EmpHistoryID)\nleft join dbo.EmpRank h(nolock) on h.RankID = f.RankID\n\nLEFT JOIN dbo.EmpHistory J(NOLOCK) ON J.EmpID = A.EmpID \n    AND J.EmpHistoryID = (\n        SELECT max(K.EmpHistoryID )\n        FROM dbo.EmpHistory K(NOLOCK) \n        WHERE K.EmpID = J.EmpID\n        AND K.AgentRankID NOT LIKE 'T%'\n        AND K.MonitorDate = (\n            SELECT max(M.MonitorDate )\n            FROM dbo.EmpHistory M(NOLOCK)\n            WHERE M.EmpID = J.EmpID \n            AND M.RankID NOT LIKE 'T%'\n        )\n    )\n\nwhere\nA.Prof=1\n c.RankID like 'T%'\nAND c.RankID &lt;&gt;'TSST'\nAND A.StartDate is not null\n\nHere there is one more problem: Even if the Employee is terminated from professor to Assitant, A.Prof values is still 1 and basically Assistant dont have the start dates but when professor are transformed to Assitant, they still contain the start date. How can I handle this in the code. Basically this code assumes that that if emp has the start date then he is the professor. Can any one help me?\n&lt;/pre&gt;\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":787,"score":1,"question_id":2548594,"title":"DBCC SHRINKFILE 1 sproc for multiple databases","body":"<p>I have a need to execute DBCC SHRINKFILE for multiple db's within the same sproc.\nI <em>could</em> create multiple sprocs so it runs within the given context, but I was curious if there were alternatives?</p>\n"},{"tags":["c#","sql-server","ado.net","pagination"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12974627,"title":"Distinct Pagination with ROW_NUMBER() and Total Count in ASP.Net","body":"<p>In Asp.net, I am trying to achieve pagination using following code:</p>\n\n<pre><code>String query=\"SELECT * \"+\n             \"FROM (SELECT Distinct emp_name, emp_address, \"+\n             \"         ROW_NUMBER() OVER(ORDER BY emp_id) AS rownum\"+\n             \"       FROM Employee\"+\n             \"     )as Person \"+\n             \"WHERE rownum&gt;\"+ start +\" and rownum &lt;=\"+ end +\";\n\nSqlCommand cmd = new SqlCommand(query, conn);\nconn.Open();\n\nSqlDataReader reader = cmd.ExecuteReader();\n</code></pre>\n\n<p>Above code does not retrieve <code>Distinct</code> rows.<br>\nHow can I adjust my <code>query</code> to get <code>distinct</code> <strong>emp_name</strong> and <code>order by</code> <strong>emp_id</strong> along with total number of entries in single <code>ExecuteReader()</code>?  </p>\n\n<p>Currently I am calling <code>ExecuteReader()</code> twice first for data and and second for total count.   </p>\n\n<p>I followed <a href=\"http://stackoverflow.com/questions/8160694/sql-server-distinct-pagination-with-row-number-not-distinct\">SQL Server DISTINCT pagination with ROW_NUMBER() not distinct</a> but was unable to understand how to implement it in my code. Please help.</p>\n"},{"tags":["c#","sql-server","raiseerror"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12975245,"title":"Exception is not raised","body":"<p>I have a stored procedure that contains the following code:</p>\n\n<pre><code>IF @somevar IS NULL\nBEGIN\nRAISERROR (N'Station %d does not exist.', -- Message text.\n       10, -- Severity,\n       7, -- State,\n       @id); \nEND\n</code></pre>\n\n<p>I want to catch the SqlException in C# code. But that exception is not raised. What am I doing wrong? </p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","visual-studio","tfs2010"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12975369,"title":"TFS 2010 confirmation of merge via SQL query","body":"<p>In TFS 2010, how do I confirm if a branch was merged by running a SQL query?</p>\n"},{"tags":["sql","sql-server","vb.net","ado"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12971845,"title":"Open Connection, Connection String, what's my database name?","body":"<p>I've been given a VBcode by my company to work on.\nI have an SQL file that I have to run in order to create the tables in my database.\nThe connection string that I have to open a connection with on my vb.net is the following:</p>\n\n<pre><code>\"Provider=SQLOLEDB.1;Integrated Security=SSPI;Persist Security Info=False;Initial Catalog=Test;Data Source=DATOR06\"\n</code></pre>\n\n<p>I need to know what the name of their database is so I can create something similar in my own local PC.</p>\n"},{"tags":["c#","sql-server","ssis","ssis-data-transformations"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":117,"score":0,"question_id":12975280,"title":"Creating Excel file using SSIS","body":"<p>I have strange problem while creating an SSIS package which convert CSV file into excel file using Excel Interop assembly. Problem is strange because when I executing it directly through IDE or through File system then its working fine but as well as I am scheduled it through SQL Server 2008r2 then it gives exception that object reference not set. I am using SQL SERVER 2008 R2 with Microsoft Office 2010 Installed on my system. All task are done on locally.\nHere is my code for creating excel file.</p>\n\n<pre><code>public string ConvertCSVToExcel(string csvFilePath, string sheetName)\n    {\n        ScriptMain.errorLog.Append(\"Convert CSV To Excel Method Is Called.\");\n\n        Microsoft.Office.Interop.Excel.Application objExcelApplication = null;\n        Microsoft.Office.Interop.Excel.Workbook objExcelWorkBook = null;\n        Microsoft.Office.Interop.Excel.Worksheet objExcelWorkSheet = null;\n        Microsoft.Office.Interop.Excel.Sheets objExcelSheets = null;\n\n        try\n        {\n            string tempExcelFilePath = this.CreateTempFilePath(csvFilePath);\n\n            ScriptMain.errorLog.Append(tempExcelFilePath);\n\n            this.DeleteFileIfExists(tempExcelFilePath);\n\n            ScriptMain.errorLog.Append(\"File Deleted\");\n\n            objExcelApplication = new Microsoft.Office.Interop.Excel.Application();\n            objExcelWorkBook = objExcelApplication.Workbooks.Open(csvFilePath, Missing.Value, Missing.Value, Missing.Value, Missing.Value,\n            Missing.Value, Missing.Value, Missing.Value, Missing.Value, Missing.Value, Missing.Value, Missing.Value, Missing.Value, Missing.Value, Missing.Value);\n\n            ScriptMain.errorLog.Append(\"Creating object of Excel Addons.\");\n\n            objExcelSheets = objExcelWorkBook.Sheets;\n            objExcelWorkSheet = objExcelSheets.get_Item(1) as Microsoft.Office.Interop.Excel.Worksheet;\n\n            ScriptMain.errorLog.Append(\"Creating WorkSheet Object\");\n\n            objExcelWorkSheet.Name = sheetName;\n\n            objExcelWorkBook.SaveAs(tempExcelFilePath, XlFileFormat.xlOpenXMLWorkbook, Missing.Value, Missing.Value, Missing.Value, Missing.Value, XlSaveAsAccessMode.xlExclusive\n                , Missing.Value, Missing.Value, Missing.Value, Missing.Value, Missing.Value);\n\n            ScriptMain.errorLog.Append(\"Saving WorkSheet.\");\n\n            objExcelWorkBook.Close(false , false , false);\n\n            ScriptMain.errorLog.Append(\"Closing WorkSheet Object\");\n\n            return tempExcelFilePath;\n        }\n        catch\n        {\n            throw;\n        }\n        finally\n        {\n            Marshal.ReleaseComObject(objExcelWorkSheet);\n            Marshal.ReleaseComObject(objExcelSheets);\n            Marshal.ReleaseComObject(objExcelWorkBook);\n            Marshal.ReleaseComObject(objExcelApplication);\n        }\n    }\n</code></pre>\n\n<p>Here </p>\n\n<pre><code>\"objExcelApplication = new Microsoft.Office.Interop.Excel.Application();\n                objExcelWorkBook = objExcelApplication.Workbooks.Open(csvFilePath, Missing.Value, Missing.Value, Missing.Value, Missing.Value,\n                Missing.Value, Missing.Value, Missing.Value, Missing.Value, Missing.Value, Missing.Value, Missing.Value, Missing.Value, Missing.Value, Missing.Value);\"\n</code></pre>\n\n<p>above line giving me exception. I am not able to find out reason behind this. I am looking for some helpful links or points.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12975252,"title":"Carriage returns in job history message?","body":"<p>Is this at all possible? It would be nice to be able to use carriage returns in the job history message from print/raiseerror statements. I've tried all the usual stuff (CHAR(13) + CHAR(10), \\n\\r, etc...) to no avail, and I can't find anything on google. It would be nice aesthetically more than anything, like say using a print statement in your proc like \"Objects Created: \" and be able to read that in the job history a little more clearly than a giant blob of text, and I don't really want to write the job history to a log file.</p>\n\n<p>It may very well not be possible, but the distribution REPL-LogReader and some other jobs are tantalizingly able to show output with new lines, so the job history GUI must be able to process that somehow right?</p>\n\n<p>I'm using SSMS with SQL Server 2008. Thanks!</p>\n"},{"tags":["sql-server","sql-server-2008","powershell","smo"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12971267,"title":"How to set database options using SQL Server SMO and powershell from a hash?","body":"<p>Using SQL Server 2008 R2 and Powershell 2.0</p>\n\n<p>I have created a hash of options that I want to set in a SQL Server database like so:</p>\n\n<pre><code>$dbopts = @{\n    \"AutoCreateStatistics\"=$true;\n    \"AutoUpdateStatistics\"=$true;\n    \"AutoShrink\"=$false;\n    };\n</code></pre>\n\n<p>I want to set these options on a SQL Server database using SMO. I created a function which accepts a SMO Database object and the DatabaseOptions hash as inputs. </p>\n\n<pre><code>function setDatabaseOptions {\n    param ($db, $opts);\n\n    foreach ($opt in $db.DatabaseOptions) {\n        # what to write here?\n\n    }\n\n}\n</code></pre>\n\n<p>I want to set the options in the hash to the database. Not sure the best way to do this. Any suggestions? An example, to set an option explicitly you would do</p>\n\n<p><code>$db.DatabaseOptions.AutoCreateStatistics = $true</code></p>\n"},{"tags":["sql-server","memory-management","ssms"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12971270,"title":"SQL Server 'System.OutOfMemoryException' Error","body":"<p>I have been given a script by my senior to run and utilize it, on Microsoft SQL Server Management Studio. It output the error of </p>\n\n<blockquote>\n  <p><em>There is insufficient system memory in resource pool 'internal' to\n  run this query.</em></p>\n</blockquote>\n\n<p>And after investigation the script, I found out that the script is too large, as a developer I have no idea why it wasn't split in the first place. Is there no other solution but to split the script into small amounts?</p>\n\n<p>Isn't there any other way i could run the script without having to manually interfere.\nThe computer where i have to run this script is a 32 bit OS, 3 GB usable ram, you can imagine how slow it is, it causes SQL Server to crash as well.</p>\n"},{"tags":["sql-server","vba","ms-access-2007"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12378467,"title":"Using DCount with Access VBA when table is linked from SQL server","body":"<p>I'm having issues with DCount in an Access 2007 database linking to a SQL 2005 table.</p>\n\n<p>The following code works fine if the table, \"<code>tblPART_CandD_MASTER</code>\", is local</p>\n\n<pre><code>DCount(\"*\", \"tblPART_CandD_MASTER\", (\"[InvalidContract] =0 and [MissingContract] =0  and DateTimeSubmittedtoDB = #\" &amp; Me.txtDateTime &amp; \"#\"))\n</code></pre>\n\n<p>I have moved all of my local tables to a SQL 2005 server. Now, the code above returns zero every time.</p>\n\n<p>If I break the code apart in the following ways it also works:</p>\n\n<pre><code>DCount(\"*\", \"tblPART_CandD_MASTER\", (\"[InvalidContract] =0 and [MissingContract] =0\"))\n\nDCount(\"*\", \"tblPART_CandD_MASTER\", (\"DateTimeSubmittedtoDB = #\" &amp; Me.txtDateTime &amp; \"#\"))\n</code></pre>\n\n<p>As the above two lines of code work, I'm frustrated as to why this wont work:</p>\n\n<pre><code>DCount(\"*\", \"tblPART_CandD_MASTER\", (\"[InvalidContract] =0 and [MissingContract] =0  and DateTimeSubmittedtoDB = #\" &amp; Me.txtDateTime &amp; \"#\"))\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12972320,"title":"How to do an inner join on row number in sql server","body":"<p>SQL Server 2008</p>\n\n<p>Two tables:</p>\n\n<p>Table A has following data:</p>\n\n<pre><code>RowA\nRowB\nRowC\nRowD\n</code></pre>\n\n<p>Table B has following data:</p>\n\n<pre><code>Row4\nRow3\nRow2\nRow1\n</code></pre>\n\n<p>I want to get the following output:</p>\n\n<pre><code>RowA Row1\nRowB Row2\nRowC Row3\nRowD Row4\n</code></pre>\n\n<p>The only common value between the two tables is the row number</p>\n\n<p>I can get the data individually of course:</p>\n\n<pre><code>SELECT val\nFROM A\nORDER BY val\n\nSELECT val\nFROM B\nORDER BY val\n</code></pre>\n\n<p>But how do I join on the row number?</p>\n\n<p>And what if I don't have an order-by, but just want the rows in the order they come out?</p>\n\n<pre><code>RowA Row4\nRowB Row3\nRowC Row2\nRowD Row1\n</code></pre>\n\n<p>as in the join of</p>\n\n<pre><code>SELECT val\nFROM A\n\nSELECT val\nFROM B\n</code></pre>\n"},{"tags":["asp.net","sql-server","drop-down-menu"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":12974141,"title":"SQL Server query order by column containing string","body":"<p>I'm filling my ASP.NET dropdownlist from a column (<code>nvarchar</code>) in my SQL Server database.</p>\n\n<p>Is there any way that I can bring rows containing a keyword to the beginnning of my returned result set? </p>\n\n<p>For instance I have these records in my table:</p>\n\n<pre><code>abc\nabc1\nabcd2\nabcXYZ3\nadfdf3XYZ\nabcd5\n</code></pre>\n\n<p>I want to have rows containg <code>XYZ</code> at the top of my dropdownlist, i.e:</p>\n\n<pre><code>abcXYZ3\nadfdf3XYZ\nabc\nabc1\nabcd2\nabcd5\n</code></pre>\n\n<p>Is it possible to create a SQL query for this purpose, for instance something like this:</p>\n\n<pre><code>select * \nfrom myTable \norder by (mycolumn LIKE '%XYZ%')\n</code></pre>\n\n<p>How can I get my desired result? If it is not possible in SQL Server, how can I do it in my C# code?</p>\n"},{"tags":["c#","sql-server","sqldataadapter","output"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12974430,"title":"SqlDataAdapter->SelectCommand and using Print in SQL","body":"<p>MSSQL has a PRINT command which lets me write output from stored procedures and sql text queries. The problem is that this output is not returned when calling through SqlDataAdapater using Fill method.</p>\n\n<p>I am not sure why but if Print is not possible to use then maybe there is an alternative pipe:ing output to result?</p>\n"},{"tags":["sql-server","unicode","collation"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":626,"score":3,"question_id":10530290,"title":"using unicode text in sql server 2008","body":"<p>I want to use unicode text in my site. I have nvarchar(max) data type in database to store the data. When I save unicode text into database, it works fine. However when i try to perform some sql operation the unicode text is changed to \"?????\"\nEg, the query below</p>\n\n<pre><code>declare @unicodetext nvarchar(250)\nset @unicodetext=''\nselect @unicodetext\n</code></pre>\n\n<p>results</p>\n\n<p><img src=\"http://i.stack.imgur.com/Wq89z.png\" alt=\"sqlunicode\"></p>\n\n<p>What is the solution for this?\nThanks</p>\n"},{"tags":["sql","sql-server","database"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":121,"score":1,"question_id":9926986,"title":"Speedup SQL query with join and like","body":"<p>Is there a possibility to speedup a SQL-query like the following one? </p>\n\n<pre><code>SELECT....\nFROM A, B, C\nWHERE \nA.a = B.a AND\nB.b like '%'+C.a+'%' \n</code></pre>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12973803,"title":"views much slower than select into","body":"<p>Let's head straight to the example:</p>\n\n<p>Query 1:</p>\n\n<pre><code>Select * \nInto #temp_v1 \nFrom View1\n\nSelect * \nInto #temp_v2\nFrom View2\n\nselect *\nFrom #temp_v1 v1\nwhere not exists (\n    Select * From #temp_v2 where key = v1.key\n)\n</code></pre>\n\n<p>This is much faster than </p>\n\n<p>Query 2:</p>\n\n<pre><code>select *\nFrom View1 v1\nwhere not exists (\n    Select * From View2 where key = v1.key\n)\n</code></pre>\n\n<p>Now, obviously, I have simplified the example. View1 is a view of views and and more comparisons are needed that make it difficult to use a join. </p>\n\n<p>My question is really not how I should rather write my SQL, but how come SQL Server can execute query 1 in 3 seconds, and query 2 in 10 minutes.</p>\n\n<p>And more importantly is there a magic option that I can give the optimizer to create an execution plan like query 1.</p>\n"},{"tags":["c#","sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12970866,"title":"Insert query refinement - SQL Server","body":"<p>I'm working with an ASP.NET MVC3 application and I have a database table for bus journeys which lists them with start and end dates, and the days of operation.  Here is a snippet below:</p>\n\n<pre><code>JourneyID   StartDate   EndDate     Monday  Tuesday Wednesday   etc\n676         02 Jan 2012 01 Mar 2012 True    False   True        etc\n696         02 Jan 2012 01 Mar 2012 False   False   True        etc\n650         02 Jan 2012 25 Mar 2012 True    True    True        etc\n</code></pre>\n\n<p>So if the date of 2 Jan 2012 is a Monday, and Monday is set to true, then there is a journey on that day.</p>\n\n<p>I'm trying to insert these into a new table row for each day that they run, so that would become:</p>\n\n<pre><code>JourneyID   Date\n676         02 Jan 2012\n676         04 Jan 2012\n696         04 Jan 2012\n650         02 Jan 2012\n650         03 Jan 2012\n</code></pre>\n\n<p>The query to do this that is currently on the system is quite slow - it uses nested while loops in t-sql. There was also a version in C# but that was slightly slower - although it did use a similar process (It used the nested loop process, then saved items to be inserted in a generic list, then bulk inserted them)</p>\n\n<p>The process in use currently loops through every journey, and within each journey, loops through every date between the start and end date to check what day it falls on and if that day is set to true. This can take a long time to perform.</p>\n\n<p>Can anyone think of a more efficient way to perform this insert?  It can currently loop through about 100,000 journeys an hour, but there could potentially be millions of journeys so it could take a long time.</p>\n"},{"tags":["sql","sql-server","xml","tsql","xsd"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":79,"score":3,"question_id":12973696,"title":"TSQL Modify xml with namespaces","body":"<p>I'm trying to modify predefined xml (xsd to be more specific) in TSQL.\nI want to insert enumeration restriction to one of the xsd elements.</p>\n\n<p>The task is to fill xsd restrictions based on a query\nexample:</p>\n\n<pre><code>create table #list(value nvarchar(100))\ninsert into #list values('item 1')\ninsert into #list values('item 2')\ninsert into #list values('item 3')\ninsert into #list values('item 4')\ninsert into #list values('item 5')\ninsert into #list values('item 6')\n\ndeclare @enumeration as xml\n;with xmlnamespaces('http://www.w3.org/2001/XMLSchema' as xs)\nselect @enumeration = (\n    select value as '@value'\n    from #list for xml path('xs:enumeration')\n)\n\ndeclare @schema xml\nset @schema =\n'&lt;xs:schema xmlns=\"\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:msdata=\"urn:schemas-microsoft-com:xml-msdata\" id=\"test\"&gt;\n    &lt;xs:element name=\"test\" msdata:IsDataSet=\"true\" msdata:MainDataTable=\"Example\" msdata:UseCurrentLocale=\"true\"&gt;\n        &lt;xs:complexType&gt;\n            &lt;xs:choice maxOccurs=\"unbounded\"&gt;\n                &lt;xs:element name=\"Example\"&gt;\n                    &lt;xs:complexType&gt;\n                        &lt;xs:sequence&gt;\n                            &lt;xs:element name=\"myList\" minOccurs=\"1\" nillable=\"false\"&gt;\n                                &lt;xs:simpleType&gt;\n                                    &lt;xs:restriction base=\"xs:string\"&gt;\n                                        &lt;xs:maxLength value=\"50\" /&gt;\n                                    &lt;/xs:restriction&gt;\n                                &lt;/xs:simpleType&gt;\n                            &lt;/xs:element&gt;\n                        &lt;/xs:sequence&gt;\n                    &lt;/xs:complexType&gt;\n                &lt;/xs:element&gt;\n            &lt;/xs:choice&gt;\n        &lt;/xs:complexType&gt;\n    &lt;/xs:element&gt;\n&lt;/xs:schema&gt;'\n\nset @schema.modify\n    ('insert sql:variable(\"@enumeration\")\n    into (//xs:element[@name=''myList'']/xs:simpleType/xs:restriction)[1]')\n\nselect @schema\n</code></pre>\n\n<p>The problem is that code outputs unnecessary xmlns attribute</p>\n\n<pre><code>&lt;xs:enumeration xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" value=\"item 1\" /&gt;\n</code></pre>\n\n<p>Can anyone help ?</p>\n"},{"tags":["java","sql-server","system-administration"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":46,"score":-2,"question_id":12968407,"title":"Change default port number of Sql server 2008 through commad line","body":"<p>I want to change the default port number 1433 to another in SQL server 2008. Is there any command line option for this? I know that how to change the port number through SQL Server Configuration Manager but I need to change this from my java application.</p>\n\n<p>Any idea about this</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":12972647,"title":"Optimizing JOIN with UNION is not working","body":"<p>I have a query :</p>\n\n<pre><code>SELECT * FROM foo f1\nJOIN foo f2 ON f1.ID = f2.ParentID or f1.ID = f2.ChildID\nAND f2.CreateTime &gt; 'YYYY-MM-DD 00:00:00.000'\n</code></pre>\n\n<p>I tried to optimize it to get better performance so I wrote :</p>\n\n<pre><code>SELECT * FROM foo f1\nJOIN foo f2 ON f1.ID = f2.ParentID\nAND f2.CreateTime &gt; 'YYYY-MM-DD 00:00:00.000'\n\nUNION\n\nSELECT * FROM foo f1\nJOIN foo f2 ON f1.ID = f2.ChildID\nAND f2.CreateTime &gt; 'YYYY-MM-DD 00:00:00.000'\n</code></pre>\n\n<p>But I am getting different results! Any idea why?</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql-server","datetime","select"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12946577,"title":"Selecting records from a particular time in SQL","body":"<p>I want to select records from SQL server table 'employeelogdetails' which has field 'logintime' (which registers time in GMT when employee swipes the access card while entering or leaving office) which is datetime datetype. Now I want to select records say from yesterday 17 October 2012, 14:00 GMT </p>\n\n<pre><code>SELECT * FROM EMPLOYEELOGDETAILS WHERE LOGINTIME &gt; ' ..........' LOGINTIME DESC\n</code></pre>\n\n<p>Don't know how to go forward guys, have been trying this for a while</p>\n\n<p>Help me out</p>\n"},{"tags":["sql-server","tsql","date-range"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12972635,"title":"Date range advanced count calculation in TSQL","body":"<p>I am working on call center project and I have to calculate the call arrivals at the same time between specific time ranges.\nI have to write a procedure which has parameters StartTime, EndTime and Interval</p>\n\n<p>For Example:</p>\n\n<pre><code>Start Time: 11:00\nEnd Time: 12:00\nInterval: 20 minutes\n</code></pre>\n\n<p>so program should divide the 1-hour time range into 3 parts and each part should count the arrivals which started and finished in this range OR arrivals which started and haven't finished yet</p>\n\n<p>Should be like this:</p>\n\n<pre><code>11:00 - 11:20 15 calls at the same time(TimePeaks)\n11:20 - 11:40 21 calls ...\n11:40 - 12:00  8 calls ...\n</code></pre>\n\n<p>Any suggestions how to calculate them? </p>\n"},{"tags":["sql-server","extended-ascii"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12972174,"title":"Extended ascii characters search in SQL Server","body":"<p>I have a table where one column may contain data which includes extended\nASCII characters (like <code>,,....</code>)</p>\n\n<p>When I search for the same using <code>select</code> query the result set doesn't fetch exactly\nfor ex:</p>\n\n<pre><code>create table testasci(id int,name varchar(20))\n\ninsert into testasci values(1, 'santosh');\ninsert into testasci values(2, 'santosh');\ninsert into testasci values(3, 'santosh');\ninsert into testasci values(4, 'santosh2');\ninsert into testasci values(5, 'santosh');\ninsert into testasci values(6, 'santosh3');\n</code></pre>\n\n<p>When I search for any name with extended ASCII character like the following </p>\n\n<pre><code>select * from testasci where name = 'santosh'\n</code></pre>\n\n<p>result set displays id2, id3.</p>\n\n<p>That too with question mark (<code>?</code>) symbol instead of the original character.</p>\n\n<p>Any help? My result set should display only <code>id2</code> for the above search query</p>\n"},{"tags":["sql-server","business-intelligence"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":3,"view_count":52,"score":-2,"question_id":12898818,"title":"Date information","body":"<p>I need to create a table (SQL SERVER) with date time information about the day in question whether or not weekend, or semester/quarter which he finds himself.</p>\n\n<p>It's possible get this kind of information(CSV or something ) on the web?!</p>\n\n<p>Thanks in advance </p>\n\n<p>OK I found the solution here</p>\n\n<p><a href=\"http://sqldusty.wordpress.com/2012/04/12/create-date-dimension-script/\" rel=\"nofollow\">http://sqldusty.wordpress.com/2012/04/12/create-date-dimension-script/</a></p>\n\n<p>This create a table with date time, this solve my problem! </p>\n"},{"tags":["sql","sql-server","sql-server-2005","synchronization"],"answer_count":6,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1171,"score":4,"question_id":1085783,"title":"SQL Server 2005 - Syncing development/production databases","body":"<p>I've got a rather large SQL Server 2005 database that is under constant development. Every so often, I either get a new developer or need to deploy wide-scale schema changes to the production server.</p>\n\n<p>My main concern is deploying schema + data updates to developer machines from the \"master\" development copy.</p>\n\n<p>Is there some built-in functionality or tools for publishing schema + data in such a fashion? I'd like it to take as little time as possible. Can it be done from within SSMS?</p>\n\n<p>Thanks in advance for your time</p>\n"},{"tags":["sql-server","wcf","sql-server-2008","iis6","database-connection"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12970916,"title":"Can't connect to SQL Server from WCF service but I can from Management Studio","body":"<p>I'm trying to connect a .NET Framework 4.0 WCF REST service on an IIS6 to a SQL Server 2008 R2 database with this connection string:</p>\n\n<pre><code>&lt;add name=\"EReportEntities\" \n     connectionString=\"metadata=res://*/EReportModel.csdl|res://*/EReportModel.ssdl|res://*/EReportModel.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Server=localhost;Database=ADM;User Id=sa;Password=XXXXXXXX;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" \n     providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>But I can't. I get:</p>\n\n<pre><code>Event Type: Failure Audit\nEvent Source:   MSSQLSERVER\nEvent Category: (4)\nEvent ID:   18456\nDate:       10/19/2012\nTime:       10:47:48 AM\nUser:       N/A\nComputer:   UNILEVER\nDescription:\nLogin failed for user 'sa'. [CLIENT: &lt;local machine&gt;]\n\nFor more information, see Help and Support Center at http://go.microsoft.com/fwlink/events.asp.\nData:\n0000: 18 48 00 00 0e 00 00 00   .H......\n0008: 09 00 00 00 55 00 4e 00   ....U.N.\n0010: 49 00 4c 00 45 00 56 00   I.L.E.V.\n0018: 45 00 52 00 00 00 07 00   E.R.....\n0020: 00 00 6d 00 61 00 73 00   ..m.a.s.\n0028: 74 00 65 00 72 00 00 00   t.e.r...\n</code></pre>\n\n<p>But, if I use sa user to login on SQL Server Management Studio I can login.</p>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["sql-server","vb.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12969244,"title":"SQL Server Database Connection Pooling?","body":"<p>I am getting the following exception in the website which has to a large extent deal with data entry operations. It also has Indexes defined on the tables in the associated database. The database calls are made via <code>SQLHelper</code>. For e.g. <code>SQLHelper.ExecuteNonQuery()</code> etc. I cannot see anywhere that the <code>Close()</code> or <code>Dispose()</code> method of the <code>SQLConnection</code> is invoked. So I am assuming that <code>SQLHelper</code> must be taking care of it as I have also read about it on various sites. Also, to check the code in combination with <code>Close()</code> or <code>Dispose()</code> is also very tedious as <code>SQLHelper</code> is used in many places and there are many classes where business logic is defined. The exception that I am getting is:</p>\n\n<blockquote>\n  <p>The record was not updated Timeout expired. The timeout period elapsed prior to obtaining a connection from the pool. This may have occurred because all pooled connections were in use and max pool size was reached.</p>\n</blockquote>\n\n<p>For now I have tested the code with putting <code>GC.Collect</code> in the <code>Application_EndRequest</code> Method of <code>Global.asax</code> and everything as of now is working fine. But I know that it is strictly not recommend to use the same.</p>\n\n<p>Any help will be GREATLY appreciated as I am stuck @ present.. </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12970785,"title":"WMI query - Reporting services and Analysis Services","body":"<p>I want to get configuration value of Native XML Web services, reporting services and Analysis Services. That means they are enabled or disabled.. through WMI Query</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":12121,"score":4,"question_id":719869,"title":"How to spread tempdb over multiple files?","body":"<p>This blog <a href=\"http://blogs.msdn.com/sqlserverstorageengine/archive/2009/01/04/managing-tempdb-in-sql-server-tempdb-configuration.aspx\" rel=\"nofollow\">http://blogs.msdn.com/sqlserverstorageengine/archive/2009/01/04/managing-tempdb-in-sql-server-tempdb-configuration.aspx</a> states that it is a good idea to \"Spread TempDB across at least as many equal sized files as there are COREs or CPUs.\"</p>\n\n<p>So my basic question is how do i actually configure my SQL server to do that. So I right click the tempdb, choose properties, files and then add a file for each CPU? How does it know that it should spread the tempdb across these files? is there a flag I should set?</p>\n\n<p>Have I misunderstood the article?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12966848,"title":"getting the minimum and maximum date in the same query","body":"<p>I have a working query that gives me the maxdate:</p>\n\n<pre><code>SELECT a.client_id AS client_id\n   , a.patientcount AS patientcount\n   , received_date AS maxRecDate\nFROM\n(\n   SELECT DISTINCT CLIENT_ID\n   , PATIENT_ID\n   , count(*) over (partition by client_id, patient_id) AS patientcount\n   from f_accession_daily\n) AS a\nJOIN F_ACCESSION_DAILY AS f ON a.CLIENT_ID = f.CLIENT_ID\n   AND a.PATIENT_ID = f.PATIENT_ID\nGROUP BY f.RECEIVED_DATE, a.CLIENT_ID, a.patientcount\nHAVING f.RECEIVED_DATE = MAX(f.received_date)\n</code></pre>\n\n<p>In the same query I would also like to return min(f.received_date).</p>\n\n<p>Is there a way to do this? perhaps with the subquery?</p>\n"},{"tags":["sql-server","function"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12969549,"title":"SQL Power function incorrect for high numbers","body":"<p>If I try to execute this query:</p>\n\n<pre><code>SELECT POWER(CONVERT(DECIMAL(30,0), 64), 10)\n</code></pre>\n\n<p>I receive:</p>\n\n<pre><code>1152921504606847000\n</code></pre>\n\n<p>That isn't correct. The correct result is:</p>\n\n<pre><code>1152921504606846976\n</code></pre>\n\n<p>How can I receive the correct result?</p>\n"},{"tags":["c#","sql-server","nhibernate"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":108,"score":1,"question_id":12962400,"title":"SQL not available after a failed insert with NHibernate","body":"<p>I have an integration test that tries to insert a row with a column that is a duplicate of a unique column that another row has. To insert the row, I call this code which is found in my entities repository:</p>\n\n<pre><code>using (var transaction = rb.unitOfWork.Session.BeginTransaction())\n        {\n            try\n            {\n                ret = (Key)rb.unitOfWork.Session.Save(entity);\n                transaction.Commit();\n                rb.unitOfWork.Session.Clear();\n            }\n            catch\n            {\n                transaction.Rollback();\n                rb.unitOfWork.Session.Clear();\n                throw;\n            }\n        }\n</code></pre>\n\n<p>When this code is run with the duplicate entity, I can see the insert come through on NHibernate Profiler. Right after that statement, I see these warnings and errors:</p>\n\n<blockquote>\n  <p>-- statement #1\n  WARN: \n  System.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ_<em>Contract</em>_C51D43DA5070F446'. Cannot insert duplicate key in object 'dbo.Contracts'. The duplicate key value is (1005171).\n  The statement has been terminated.\n     at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)\n     at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\n     at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning()\n     at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)\n     at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)\n     at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)\n     at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)\n     at System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(DbAsyncResult result, String methodName, Boolean sendToPipe)\n     at System.Data.SqlClient.SqlCommand.ExecuteNonQuery()\n     at System.Data.SqlClient.SqlCommand.ExecuteBatchRPCCommand()\n     at System.Data.SqlClient.SqlCommandSet.ExecuteNonQuery()\n     at NHibernate.AdoNet.SqlClientSqlCommandSet.ExecuteNonQuery()\n     at NHibernate.AdoNet.SqlClientBatchingBatcher.DoExecuteBatch(IDbCommand ps)</p>\n  \n  <p>-- statement #2\n  ERROR: \n  Violation of UNIQUE KEY constraint 'UQ_<em>Contract</em>_C51D43DA5070F446'. Cannot insert duplicate key in object 'dbo.Contracts'. The duplicate key value is (1005171).\n  The statement has been terminated.</p>\n  \n  <p>-- statement #3\n  ERROR: \n  could not execute batch command.[SQL: SQL not available]Could not synchronize database state with session</p>\n  \n  <p>-- statement #4\n  rollback transaction</p>\n</blockquote>\n\n<p>After this test, I do a lot of Query testing and everything seems to be working fine until I hit an update statement for the same repository. Here is the code that gets called:</p>\n\n<pre><code>using (var transaction = rb.unitOfWork.Session.BeginTransaction())\n        {\n            rb.unitOfWork.Session.SaveOrUpdate(entity);\n            transaction.Commit();\n            rb.unitOfWork.Session.Clear();\n        }\n        rb.unitOfWork.Session.Evict(entity);\n</code></pre>\n\n<p>Checking the profiler shows that the update gets called, bur right after that, I get these statements:</p>\n\n<blockquote>\n  <p>-- statement #1\n  WARN: \n  System.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ_<em>Contract</em>_C51D43DA5070F446'. Cannot insert duplicate key in object 'dbo.Contracts'. The duplicate key value is (1005171).\n  The statement has been terminated.\n     at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)\n     at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\n     at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning()\n     at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)\n     at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)\n     at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)\n     at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)\n     at System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(DbAsyncResult result, String methodName, Boolean sendToPipe)\n     at System.Data.SqlClient.SqlCommand.ExecuteNonQuery()\n     at System.Data.SqlClient.SqlCommand.ExecuteBatchRPCCommand()\n     at System.Data.SqlClient.SqlCommandSet.ExecuteNonQuery()\n     at NHibernate.AdoNet.SqlClientSqlCommandSet.ExecuteNonQuery()\n     at NHibernate.AdoNet.SqlClientBatchingBatcher.DoExecuteBatch(IDbCommand ps)</p>\n  \n  <p>-- statement #2\n  ERROR: \n  Violation of UNIQUE KEY constraint 'UQ_<em>Contract</em>_C51D43DA5070F446'. Cannot insert duplicate key in object 'dbo.Contracts'. The duplicate key value is (1005171).\n  The statement has been terminated.</p>\n  \n  <p>-- statement #3\n  ERROR: \n  could not execute batch command.[SQL: SQL not available]Could not synchronize database state with session</p>\n</blockquote>\n\n<p>From what I can see, it seems like the insert statement put NHibernate into a failed state. The update code above throws a GenericADOException that says SQL Not Available. I must be doing something wrong here. Should I be handling the exception differently?</p>\n"},{"tags":["sql-server","xml"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":4296,"score":1,"question_id":2988122,"title":"How to query on XML column In SQL Server 2008","body":"<p>I am using SQL Server 2008</p>\n\n<p>I have a table with xml data looks like:</p>\n\n<pre><code>ID           xml_col  \n1            &lt;Attribute id=\"7\"&gt;1.0&lt;/Attribute&gt;&lt;Attribute id=\"8\"&gt;AAA&lt;/Attribute&gt;  \n2            &lt;Attribute id=\"7\"&gt;2.0&lt;/Attribute&gt;&lt;Attribute id=\"8\"&gt;BBB&lt;/Attribute&gt;  \n3            &lt;Attribute id=\"7\"&gt;3.0&lt;/Attribute&gt;&lt;Attribute id=\"8\"&gt;AAA&lt;/Attribute&gt;  \n4            &lt;Attribute id=\"7\"&gt;1.0&lt;/Attribute&gt;&lt;Attribute id=\"8\"&gt;BBB&lt;/Attribute&gt;  \n5            &lt;Attribute id=\"7\"&gt;1.0&lt;/Attribute&gt;&lt;Attribute id=\"8\"&gt;AAA&lt;/Attribute&gt;  \n6            &lt;Attribute id=\"7\"&gt;7.0&lt;/Attribute&gt;&lt;Attribute id=\"8\"&gt;CCC&lt;/Attribute&gt;  \n</code></pre>\n\n<p>I want to get those records that </p>\n\n<pre><code>'when attribute=17 then value =1'+ 'when attribute=8 then value='AAA''\n</code></pre>\n\n<p>How can i create the query and how to build xml indexes?</p>\n\n<p>Thank you very much.</p>\n"},{"tags":["sql-server","winforms","database-connection","desktop-application","database-security"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":91,"score":3,"question_id":12108368,"title":"Why to close database connection in a desktop application","body":"<p>When user logs in. I Open connection 'conn' which is a public static member my dbclass which has all functions related to database. Then <strong>conn remains open until application is closed</strong></p>\n\n<p>It does not degrade the application performance measurably but <strong>enhances the database queries performance</strong> remarkably.</p>\n\n<p><strong>Is there any security issue</strong>? If the database is centralized and two or 3 PC's using it with independent applications, Then what security issue can be there due to opening connection on log in?</p>\n\n<p>Or any other problem to be faced in future? </p>\n\n<p><strong>Edit</strong> in reply to first comment</p>\n\n<p>I checked by timespan.totalmilliseconds. It takes bit lesser than twice time when involves open and executing query than just executing query when connection is already open</p>\n\n<p><strong>Edit ---  The Actual answer required</strong>.</p>\n\n<p>If some one with good reason tells me that no there is no security issue or with a good reason tells yes this one is the major security issue. That will be accepted answer after waiting others responses.</p>\n\n<p><strong>By Google search i did not find any article/answer which would be to the point to my question.</strong></p>\n"},{"tags":["sql-server","sql-server-2008","database-replication"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":12968668,"title":"SQL Server merge replication (subscription does not exist)","body":"<p>I have setup a merge replication for almost 21 servers. Everything was OK, but after few days all subscriptions failed.</p>\n\n<p>In the subscription servers, although I have subscription in the subscription menu.</p>\n\n<p>Messages stating <code>the subscription does not exist</code>.</p>\n"},{"tags":["c#","sql-server","sqlclr"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12969490,"title":"Error in Calling SQL CLR function","body":"<p>I am writing a CLR function to parse a table column and write the results into another table. Basic requirement is parsing the <code>Detail</code> column, which contains a <code>Time</code> part and an <code>ID</code> part. Results will be the time difference between two Ids.</p>\n\n<p>Ex: Time1,Id1;Time2,Id2;Time3,Id3... and so on\nTime2-Time1 is time taken by Id1 in seconds.</p>\n\n<p>Same function is working in normal console application but CLR function is throwing the exception when I call it from SQL server. \nError is</p>\n\n<p><em>A .NET Framework error occurred during execution of user-defined routine or aggregate \"Function1\": \nSystem.Security.HostProtectionException: Attempted to perform an operation that was forbidden by the CLR host.\nThe protected resources (only available with full trust) were: All\nThe demanded resources were: UI\nSystem.Security.HostProtectionException: \n   at UserDefinedFunctions.Function1(String msisdn, String promptdetails)</em></p>\n\n<p>My code is:\n    SqlConnection conn = new SqlConnection();\n        SqlCommand cmd = new SqlCommand();</p>\n\n<pre><code>    int count = 0;\n    string PromptPart = string.Empty;\n    string PrevPromptPart = string.Empty;\n    DateTime TimePart;\n    TimePart = new DateTime();\n    DateTime PrevTimePart;\n    PrevTimePart = new DateTime();\n    TimeSpan difference;\n\n    try\n    {\n        count++;\n        conn.ConnectionString = \"Context Connection=true\";\n        cmd.Connection = conn;\n\n        String[] string1 = promptdetails.Split(\";\".ToCharArray());\n        foreach (var item1 in string1)\n        {\n            count++;\n            String[] string2 = item1.Split(\",\".ToCharArray());\n            PromptPart = string2[1];\n            TimePart = DateTime.ParseExact(string2[0], \"M/d/yyyy h:mm:ss tt\", System.Globalization.CultureInfo.InvariantCulture);\n            if (count &gt; 1)\n            {\n                StringBuilder sbQuery = new StringBuilder(1024);\n                sbQuery.Append(\"INSERT INTO [Shami].[DBO].[data] (MSISDN,PromptID1,PromptID2,TimeDifference) VALUES\");\n                sbQuery.Append(\"('\");\n                sbQuery.Append(msisdn);\n                sbQuery.Append(\"',\");\n                difference = TimePart.Subtract(PrevTimePart);\n                sbQuery.Append(\"'\");\n                sbQuery.Append(PrevPromptPart);\n                sbQuery.Append(\"','\");\n                sbQuery.Append(PromptPart);\n                sbQuery.Append(\"',\");\n                sbQuery.Append(difference.Seconds);\n                sbQuery.Append(\")\");\n                string sub = string.Empty;\n                sub = sbQuery.ToString();\n                try\n                {\n                    conn.Open();\n                    cmd = new SqlCommand(sub);\n                    SqlContext.Pipe.ExecuteAndSend(cmd);\n                }\n                catch (Exception ie)\n                {\n                    Console.WriteLine(\"Error..\");\n                }\n            }\n            if (count &lt;= 1)\n            {\n                StringBuilder sbQuery = new StringBuilder(1024);\n                sbQuery.Append(\"INSERT INTO [Shami].[DBO].[data] (MSISDN,PromptID1,PromptID2,TimeDifference) VALUES\");\n                sbQuery.Append(\"('\");\n                sbQuery.Append(msisdn);\n                sbQuery.Append(\"',\");\n                sbQuery.Append(\"'_'\");\n                sbQuery.Append(\",\");\n                sbQuery.Append(PromptPart);\n                sbQuery.Append(\",\");\n                sbQuery.Append(\"'0'\");\n                sbQuery.Append(\")\");\n                string sub = string.Empty;\n                sub = sbQuery.ToString();\n                try\n                {\n                    conn.Open();\n                    cmd = new SqlCommand(sub);\n                    SqlContext.Pipe.ExecuteAndSend(cmd);\n                }\n                catch (Exception ie)\n                {\n                    Console.WriteLine(\"Error..\");\n                }\n            }\n            PrevPromptPart = PromptPart;\n            PrevTimePart = TimePart;\n        }\n\n\n\n    }\n    catch (Exception)\n    { ;}\n    finally\n    {\n        conn.Close();\n        conn.Dispose();\n        cmd.Dispose();\n    }\n    return msisdn;\n</code></pre>\n\n<p>Please let me know where I'm going wrong. I can't debug in CLR.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","cursor","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12965080,"title":"Is there a way to set ODBC Connection options in a DSN?","body":"<p>My application (a testcase automation tool) does not support calling ODBC's <a href=\"http://msdn.microsoft.com/en-us/library/ms130794.aspx\" rel=\"nofollow\">SQLSetStatmentOption</a>. I need to set the cursor option <a href=\"http://msdn.microsoft.com/en-us/library/ms131361.aspx\" rel=\"nofollow\">SQL_SOPT_SS_CURSOR_OPTIONS to SQL_CO_FFO_AF</a>. Right now I connect to the server using a connection string (no DSN). I am using <a href=\"http://msdn.microsoft.com/en-us/library/ms131291.aspx\" rel=\"nofollow\">sqlsrv32.dll or Sqlncl10.dll</a>.</p>\n\n<p>Is there a way to set the cursor option in a DSN (or other layer) between my tool and the MSSQL server?  The tool handles creating the cursor (or results set) and iterating through the result set in a way that seems to obscure any ability to manage it directly. It does allow for calling SQLSetConnectAttr() but as far as I can tell there's no way to set a cursor option in there.</p>\n\n<p>All of this is an attempt to speed up retrieving data over a remote connection. In SQL Management Studio I get comparable response times to the local or remote DB, but in the automation tool the remote queries take hundreds of times longer, probably because it seems to be making a round trip to the sever for every row.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12966509,"title":"converting normal query into fancy or partition/over query","body":"<p>My query:</p>\n\n<pre><code>with cte as (\n        select client_id,COUNT(patient_id) PatientCount from\n        (\n            select client_id,patient_id\n            from F_ACCESSION_DAILY\n            group by CLIENT_ID,PATIENT_ID\n            having COUNT(ACCESSION_ID)=2\n        ) a\n        group by CLIENT_ID\n)\n</code></pre>\n\n<p>works, but is not so useful to me. because although i can JOIN easily on this query, I will actually need to repeat this <code>WITH</code> statement many times because i need to be able to differentiate between:</p>\n\n<pre><code>having count(Accession_id)=2\n</code></pre>\n\n<p>and</p>\n\n<pre><code>having count(Accession_id)=3\n</code></pre>\n\n<p>and</p>\n\n<pre><code>having count(accession_id)=4\n</code></pre>\n\n<p>and so on until around 100</p>\n\n<p>i was thinking to do something more like this:</p>\n\n<pre><code>select distinct client_id, patient_id, count(*) over (partition by client_id, patient_id,accession_id) patientcount\n    from f_accession_daily\n</code></pre>\n\n<p>but i am stuck!</p>\n\n<p>i was wondering if you can point me into the right direction on how to convert the initial query into something <strong>more useable when having count(Accession)=many different values</strong>?</p>\n\n<p>thanks so much for your guidance.</p>\n"},{"tags":["sql-server","transaction-log"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12969546,"title":"SQL Server transaction log","body":"<p>Is it possible to have SQL Server 2008 R2 reset the transaction log for certain databases when the database is backed up?</p>\n\n<p>Scenario:</p>\n\n<p>Auto backup job in SQL Server takes a backup of database XYZ and also of it's transaction log. When this backup has completed SQL Server will reset the transaction log (log file size will be increased to starting point)</p>\n\n<p>Thank you.</p>\n"},{"tags":["c#","sql-server","connection-string","sql-server-2008-express"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":26625,"score":2,"question_id":997169,"title":"c# 2008 SQL Server Express Connection String","body":"<p>I have a 2008 SQL Server Express installed on one of my machines and I'm attempting to establish a remote connection... when I use the MS SQL Server Management Studio I can log into the database without any problems at all (with the same credentials), but when I try to create a connection string in my C# application I get an exception:</p>\n\n<blockquote>\n  <p>A network-related or instance-specific\n  error occurred while establishing a\n  connection to SQL Server.  The server\n  was not found or was not accessible. \n  Verify that the instance name is\n  correct and that SQL Server is\n  configured to allow remote\n  connections.</p>\n</blockquote>\n\n<p>Here is what my connection string looks like (the private information is changed):</p>\n\n<pre><code>\"Data Source=\"MACHINENAME\\\\SQLEXPRESS\";User ID=\"Admin\";Password=\"the_password\";Initial Catalog=\"MyDatabase\";Integrated Security=True;Connect Timeout=120\");\n</code></pre>\n\n<p>As I said, <strong>I can login using the Management Studio with the same settings</strong>: same user id, password and data source name, but it fails when I attempt to open a connection with the above connection string. </p>\n\n<p>Note:</p>\n\n<ol>\n<li><p>I have enabled the remote connectivity on the server, disabled the firewall, enabled TCP/IP connection to the server, turned on the SQL Browser.</p></li>\n<li><p>The connection string works fine when I'm on the same machine.</p></li>\n<li><p>I looked up the Integrated Security option and I set it to false just to make sure that it's not attempting to use the Windows Login, but it still fails.</p></li>\n<li><p>The database is setup to allow both windows login and database login.</p></li>\n<li><p>I changing the Integrated Security option to SSPI, True, and finally False, all 3 gave me the same error as above.</p></li>\n</ol>\n\n<p>Can anybody tell me if I'm doing something wrong?</p>\n\n<p>UPDATE, here is my exact code (this time only the password is removed, and I've added a picture of management studio running on the same machine):</p>\n\n<pre><code>string _connectionString =\n            //string.Format(\"Server=%s;User ID=%s;Password=%s;Database=%s;Connect Timeout=120\", // Same problem\n            //string.Format(\"Server=%s;User ID=%s;Password=%s;Database=%s;Integrated Security=False;Connect Timeout=120\", // Same problem\n            string.Format(\"Data Source=%s;User ID=%s;Password=%s;Initial Catalog=%s;Integrated Security=False;Connect Timeout=120\", // Same problem\n            \"GANTCHEVI\\\\SQLEXPRESS\",\n            \"FinchAdmin\",\n            \"the_password\",\n            \"Finch\");\n</code></pre>\n\n<p><img src=\"http://s113.photobucket.com/albums/n202/ozpowermo/?action=view&amp;current=ManagementStudio.jpg\" alt=\"Connected Via Management Studio: See Picture\" /></p>\n\n<p><a href=\"http://s113.photobucket.com/albums/n202/ozpowermo/?action=view&amp;current=ManagementStudio.jpg\" rel=\"nofollow\">http://s113.photobucket.com/albums/n202/ozpowermo/?action=view&amp;current=ManagementStudio.jpg</a></p>\n\n<p><strong>I FIGURED IT OUT:</strong></p>\n\n<p>When using the \"Data Source=\" label one should use the \"User Id\", if you use User ID it doesn't seem like it works!</p>\n\n<pre><code>string _connectionString = \"Data Source=GANTCHEVI\\\\SQLEXPRESS;Initial Catalog=Finch;Integrated Security=False;User Id=FinchAdmin;Password=the_password;Connect Timeout=0\";\"\n</code></pre>\n"},{"tags":["sql-server","base64","converter"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12950135,"title":"SQL Convert a number base10 to base64","body":"<p>I've tried to convert a <code>base10</code> number in <code>base64</code> for compression. </p>\n\n<p>Is there any function for do it in SQL Server?</p>\n"},{"tags":["sql","sql-server","tsql","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12967911,"title":"ORDER BY items must appear in the select list if the statement contains a UNION, INTERSECT or EXCEPT operator","body":"<p>Below is my stored procedure, but upon executing it the following error occured:</p>\n\n<blockquote>\n  <p>Msg 104, Level 16, State 1, Procedure ACEsp_AuditInvoice, Line 84\n  ORDER BY items must appear in the select list if the statement\n  contains a UNION, INTERSECT or EXCEPT operator.</p>\n</blockquote>\n\n<p>Please review my stored procedure, and tell me how I will avoid the error above.\nThanks in advance </p>\n\n<pre><code>USE [FAC]\nGO\n/****** Object:  StoredProcedure [dbo].[ACEsp_AuditInvoice]    Script Date: 10/18/2012 09:26:49 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\n-- =============================================\n-- Author:      Ryan\n-- Create date: 18 Oct 2012\n\n-- version: 12.10\n-- Description: Originated from ACEsp_InvVsListPrice, modified for invoice auditing \n-- parameter by date, month and year\n-- Additional 10 columns for invoice auditing\n-- =============================================\n\n--[dbo].[ACEsp_AuditInvoice] '2012-09-17','2012-09-17','SEPTEMBER','2012'\n\nALTER PROCEDURE [dbo].[ACEsp_AuditInvoice] \n    -- Add the parameters for the stored procedure here\n    @dtfrom datetime,\n    @dtto datetime,\n    @MNTH varchar(12),\n    @YR INT\n    --@prcMakro varchar(15)\nWITH RECOMPILE\n\nAS\n\ncreate table #brand (\n    [CODE] [char](15) COLLATE SQL_Latin1_General_CP1_CI_AS ,\n    [IVBRAND] [char](255) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL \n)\n\ncreate table #SubCat (\n    [CODE] [char](15) COLLATE SQL_Latin1_General_CP1_CI_AS ,\n    [IVSUBCAT] [char](255) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL    \n)\n\nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;\n    DECLARE @SDFROM VARCHAR(20)\n    DECLARE @SDTO VARCHAR(20)\n\n    SET @SDFROM = CONVERT(VARCHAR(10), @DTFROM, 101) + ' 00:00:00'\n    SET @DTFROM = CAST(@SDFROM AS DATETIME)\n\n    SET @SDTO = CONVERT(VARCHAR(10), @DTTO, 101) + ' 23:59:59'\n    SET @DTTO = CAST(@SDTO AS DATETIME)\n\n\n    insert into #brand\n    select USCATVAL, Image_URL\n    from IV40600\n    where USCATNUM = 2\n\n    insert into #SubCat\n    select USCATVAL, Image_URL\n    from IV40600\n    where USCATNUM = 4\n\n    -- Insert statements for procedure here\n    select 'posted' as Trx, d.quantity, d.qtytoinv, d.qtycance, (d.qtytoinv - d.qtyfulfi) 'qtyfulfivar', \n        (u.equomqty * d.qtyfulfi) 'qtybaseuom', \n        (d.XTNDPRCE - \n        (d.qtyfulfi*u.equomqty) *       \n            isnull(p.psitmval, \n                ISNULL((SELECT psitmval from iv10402 \n                        WHERE prcShid = 'BASE PRICE' \n                        AND itemnmbr = d.itemnmbr \n                        AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                    WHERE prcShid = 'BASE PRICE' \n                                                    AND itemnmbr = d.itemnmbr \n                                                    AND UOFM = D.UOFM))\n                )) 'variance',\n\n        CASE(d.qtyfulfi*u.equomqty) *       \n            isnull(p.psitmval, \n                ISNULL((SELECT psitmval from iv10402 \n                        WHERE prcShid = 'BASE PRICE' \n                        AND itemnmbr = d.itemnmbr \n                        AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                    WHERE prcShid = 'BASE PRICE' \n                                                    AND itemnmbr = d.itemnmbr \n                                                    AND UOFM = D.UOFM))\n                )\n            WHEN 0 THEN 0\n            ELSE\n            (d.XTNDPRCE /  \n            ((d.qtyfulfi*u.equomqty) *      \n            isnull(p.psitmval, \n                ISNULL((SELECT psitmval from iv10402 \n                        WHERE prcShid = 'BASE PRICE' \n                        AND itemnmbr = d.itemnmbr \n                        AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                    WHERE prcShid = 'BASE PRICE' \n                                                    AND itemnmbr = d.itemnmbr \n                                                    AND UOFM = D.UOFM))\n                )))-1\n            end as 'percentvar',\n\n        p.PRCSHID, h.docdate, h.bachnumb, h.ReqShipDate,\n        d.lnitmseq, d.locncode,  d.UNITPRCE, \n        p.psitmval as [LIST PRICE], i.stndcost, d.qtybsuom, c.slprsnid, sp.slprsnfn, \n        sp.sprsnsln, c.salsterr, st.slterdsc, h.custnmbr, h.custname, \n        c.shrtname as 'CUSTOGROUP', c.custclas as 'CUSTOCLAS', c2.ZIP as 'CHANSEG',\n        h.sopnumbe, d.itemnmbr, d.itemdesc, \n        case i.itemtype\n            WHEN 1 THEN 'SALES INVENTORY'\n            WHEN 2 THEN 'DISCONTINUED'\n            WHEN 3 THEN 'KITS'\n        end as 'ITEMTYPE',\n        d.qtyfulfi, d.uofm, d.XTNDPRCE, u.equivuom 'BASEUOM', u.equomqty 'PACKING', \n        d.qtyfulfi*u.equomqty 'bqty',\n\n        isnull( (SELECT TOP 1 LISTPRICE FROM tbl_disco_historical_baseuom HH  WHERE HH.ITEMNMBR = D.ITEMNMBR AND HH.BASEUOM = U2.BASEUOFM AND HH.LEFFECTDATE &gt;= H.DOCDATE ORDER BY HH.LEFFECTDATE DESC),\n            isnull(p.psitmval, \n                    ISNULL((SELECT psitmval from iv10402 \n                            WHERE prcShid = 'BASE PRICE' \n                            AND itemnmbr = d.itemnmbr \n                            AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                        WHERE prcShid = 'BASE PRICE' \n                                                        AND itemnmbr = d.itemnmbr \n                                                        AND UOFM = D.UOFM))\n                    )) as 'BASE PRICE  LIST PRICE PER BUOM',\n\n        isnull(p.psitmval*d.qtyfulfi*u.equomqty,\n                    ISNULL((SELECT psitmval from iv10402 \n                         WHERE prcShid = 'BASE PRICE' \n                         AND itemnmbr = d.itemnmbr \n                         AND UOFM = U.EQUIVUOM ), (SELECT psitmval from iv10402 \n                                                    WHERE prcShid = 'BASE PRICE' \n                                                    AND itemnmbr = d.itemnmbr \n                                                    AND UOFM = D.UOFM))\n                * d.qtyfulfi*u.equomqty\n               )\n                AS 'EXTND PRICE by BASE PRICE-BUOM',    \n        p1.psitmval as 'MAKRO PRICE  LIST PRICE', \n        p1.psitmval*d.qtyfulfi as 'EXTND PRICE BY MAKRO',\n        d.qtyfulfi*u.equomqty AS 'QTYBASEUOM', \n        ISNULL(\n        (SELECT TOP 1 LISTPRICE FROM tbl_disco_historical_baseuom HH  WHERE HH.ITEMNMBR = D.ITEMNMBR AND HH.BASEUOM = U2.BASEUOFM AND HH.LEFFECTDATE &gt;= H.DOCDATE ORDER BY HH.LEFFECTDATE DESC),\n        isnull(p.psitmval, \n                ISNULL((SELECT psitmval from iv10402 \n                        WHERE prcShid = 'BASE PRICE' \n                        AND itemnmbr = d.itemnmbr \n                        AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                    WHERE prcShid = 'BASE PRICE' \n                                                    AND itemnmbr = d.itemnmbr \n                                                    AND UOFM = D.UOFM))\n                ))\n                as 'BaseUomListPrice',\n\n            (d.qtyfulfi*u.equomqty) *       \n            isnull(p.psitmval, \n                ISNULL((SELECT psitmval from iv10402 \n                        WHERE prcShid = 'BASE PRICE' \n                        AND itemnmbr = d.itemnmbr \n                        AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                    WHERE prcShid = 'BASE PRICE' \n                                                    AND itemnmbr = d.itemnmbr \n                                                    AND UOFM = D.UOFM))\n                )           \n                as 'BaseUomTotalListPrice', \n\n        (d.qtyfulfi*u.equomqty) *       \n            isnull(p.psitmval, \n                ISNULL((SELECT psitmval from iv10402 \n                        WHERE prcShid = 'BASE PRICE' \n                        AND itemnmbr = d.itemnmbr \n                        AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                    WHERE prcShid = 'BASE PRICE' \n                                                    AND itemnmbr = d.itemnmbr \n                                                    AND UOFM = D.UOFM))\n                ) - D.XTNDPRCE AS 'TOTAL DISCOUNT',\n            a.IVBRAND as 'BRAND', b.IVSUBCAT as 'SubCat',\n            dbo.ACEfunc_CUSTOTYPE2(c.CUSTCLAS,c.SALSTERR) AS 'CUSTTYPE', D.MRKDNAMT*d.qtyfulfi AS 'MARKDOWN',\n            cast(i.uscatvls_6 as float) as 'ITEM REPORT SEQUENCE',\n            rtrim(ltrim(cast(uscatvls_1 as varchar(4)))) + '-' + bh.image_url as 'BRAND HANDLER',\n            I.ITMCLSCD 'ITEM CLASS', d.qtyfulfi*u.equomqty/uu.equomqty AS 'CASEQTY',\n            ii.inet1 as 'ABC CAT',\n            ISNULL(APL.PCPRICE,isnull(p.psitmval, \n                    ISNULL((SELECT psitmval from iv10402 \n                            WHERE prcShid = 'BASE PRICE' \n                            AND itemnmbr = d.itemnmbr \n                            AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                        WHERE prcShid = 'BASE PRICE' \n                                                        AND itemnmbr = d.itemnmbr \n                                                        AND UOFM = D.UOFM))\n                    )) as 'APL(SAG) Piece Price', h.docid as 'SOP TYPE ID'\n\n    from sop30200 h\n        inner join sop30300 d on (h.sopnumbe = d.sopnumbe)\n        inner join IV00101 i on (d.itemnmbr = i.itemnmbr)\n        inner join RM00101 c on (h.custnmbr = c.custnmbr)\n        left join RM00102 c2 on (c.custnmbr = c2.custnmbr and c2.adrscode = 'MAIN')\n        left join RM00301 sp on (sp.slprsnid = c.slprsnid)\n        left join RM00303 st on (st.salsterr = c.salsterr)\n        LEFT JOIN iv40202 u on (i.uomschdl = u.uomschdl and d.uofm = u.uofm and u.qtybsuom &lt;&gt; 0)\n        LEFT JOIN iv40201 u2 on (i.uomschdl = u2.uomschdl)\n        left join iv10402 p1 on (d.itemnmbr = p1.itemnmbr and p1.PRCSHID = 'PLMAKRO'\n            and d.uofm = p1.uofm)\n        left join iv10402 p on (d.itemnmbr = p.itemnmbr and p.PRCSHID = 'BASE PRICE'\n            and U.EQUIVUOM = p.uofm)\n        left join #brand a on (i.uscatvls_2 = a.code)\n        left join #SubCat b on (i.uscatvls_4 = b.code)\n        left join iv40600 bh on (i.uscatvls_1 = bh.uscatval AND bh.uscatnum = 1)\n        left join iv40202 uu on (i.uomschdl = uu.uomschdl and i.selnguom = uu.uofm and uu.qtybsuom &lt;&gt; 0)\n        LEFT join sy01200 as ii on (ii.master_id = d.itemnmbr and ii.master_type = 'ITM') \n        LEFT JOIN T0_APL APL ON (D.ITEMNMBR=APL.ITEMNMBR AND APL.MNTH = @MNTH AND APL.YR = @YR)\n\nUNION ALL\n\n    select 'unposted' as Trx, d.quantity, d.qtytoinv, d.qtycance, (d.qtytoinv - d.qtyfulfi) 'qtyfulfivar', \n        (u.equomqty * d.qtyfulfi) 'qtybaseuom', \n        (d.XTNDPRCE - \n        (d.qtyfulfi*u.equomqty) *       \n            isnull(p.psitmval, \n                ISNULL((SELECT psitmval from iv10402 \n                        WHERE prcShid = 'BASE PRICE' \n                        AND itemnmbr = d.itemnmbr \n                        AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                    WHERE prcShid = 'BASE PRICE' \n                                                    AND itemnmbr = d.itemnmbr \n                                                    AND UOFM = D.UOFM))\n                )) 'variance',\n\n        CASE(d.qtyfulfi*u.equomqty) *       \n            isnull(p.psitmval, \n                ISNULL((SELECT psitmval from iv10402 \n                        WHERE prcShid = 'BASE PRICE' \n                        AND itemnmbr = d.itemnmbr \n                        AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                    WHERE prcShid = 'BASE PRICE' \n                                                    AND itemnmbr = d.itemnmbr \n                                                    AND UOFM = D.UOFM))\n                )\n            WHEN 0 THEN 0\n            ELSE\n            (d.XTNDPRCE /  \n            ((d.qtyfulfi*u.equomqty) *      \n            isnull(p.psitmval, \n                ISNULL((SELECT psitmval from iv10402 \n                        WHERE prcShid = 'BASE PRICE' \n                        AND itemnmbr = d.itemnmbr \n                        AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                    WHERE prcShid = 'BASE PRICE' \n                                                    AND itemnmbr = d.itemnmbr \n                                                    AND UOFM = D.UOFM))\n                )))-1\n            end as 'percentvar',\n\n        p.PRCSHID, h.docdate, h.bachnumb, h.ReqShipDate,\n        d.lnitmseq, d.locncode,  d.UNITPRCE, \n        p.psitmval as [LIST PRICE], i.stndcost, d.qtybsuom, c.slprsnid, sp.slprsnfn, \n        sp.sprsnsln, c.salsterr, st.slterdsc, h.custnmbr, h.custname, \n        c.shrtname as 'CUSTOGROUP', c.custclas as 'CUSTOCLAS', c2.ZIP as 'CHANSEG',\n        h.sopnumbe, d.itemnmbr, d.itemdesc, \n        case i.itemtype\n            WHEN 1 THEN 'SALES INVENTORY'\n            WHEN 2 THEN 'DISCONTINUED'\n            WHEN 3 THEN 'KITS'\n        end as 'ITEMTYPE',\n        d.qtyfulfi, d.uofm, d.XTNDPRCE, u.equivuom 'BASEUOM', u.equomqty 'PACKING', \n        d.qtyfulfi*u.equomqty 'bqty',\n\n        isnull( (SELECT TOP 1 LISTPRICE FROM tbl_disco_historical_baseuom HH  WHERE HH.ITEMNMBR = D.ITEMNMBR AND HH.BASEUOM = U2.BASEUOFM AND HH.LEFFECTDATE &gt;= H.DOCDATE ORDER BY HH.LEFFECTDATE DESC),\n            isnull(p.psitmval, \n                    ISNULL((SELECT psitmval from iv10402 \n                            WHERE prcShid = 'BASE PRICE' \n                            AND itemnmbr = d.itemnmbr \n                            AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                        WHERE prcShid = 'BASE PRICE' \n                                                        AND itemnmbr = d.itemnmbr \n                                                        AND UOFM = D.UOFM))\n                    )) as 'BASE PRICE  LIST PRICE PER BUOM',\n\n        isnull(p.psitmval*d.qtyfulfi*u.equomqty,\n                    ISNULL((SELECT psitmval from iv10402 \n                         WHERE prcShid = 'BASE PRICE' \n                         AND itemnmbr = d.itemnmbr \n                         AND UOFM = U.EQUIVUOM ), (SELECT psitmval from iv10402 \n                                                    WHERE prcShid = 'BASE PRICE' \n                                                    AND itemnmbr = d.itemnmbr \n                                                    AND UOFM = D.UOFM))\n                * d.qtyfulfi*u.equomqty\n               )\n                AS 'EXTND PRICE by BASE PRICE-BUOM',    \n        p1.psitmval as 'MAKRO PRICE  LIST PRICE', \n        p1.psitmval*d.qtyfulfi as 'EXTND PRICE BY MAKRO',\n        d.qtyfulfi*u.equomqty AS 'QTYBASEUOM', \n        ISNULL(\n        (SELECT TOP 1 LISTPRICE FROM tbl_disco_historical_baseuom HH  WHERE HH.ITEMNMBR = D.ITEMNMBR AND HH.BASEUOM = U2.BASEUOFM AND HH.LEFFECTDATE &gt;= H.DOCDATE ORDER BY HH.LEFFECTDATE DESC),\n        isnull(p.psitmval, \n                ISNULL((SELECT psitmval from iv10402 \n                        WHERE prcShid = 'BASE PRICE' \n                        AND itemnmbr = d.itemnmbr \n                        AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                    WHERE prcShid = 'BASE PRICE' \n                                                    AND itemnmbr = d.itemnmbr \n                                                    AND UOFM = D.UOFM))\n                ))\n                as 'BaseUomListPrice',\n\n            (d.qtyfulfi*u.equomqty) *       \n            isnull(p.psitmval, \n                ISNULL((SELECT psitmval from iv10402 \n                        WHERE prcShid = 'BASE PRICE' \n                        AND itemnmbr = d.itemnmbr \n                        AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                    WHERE prcShid = 'BASE PRICE' \n                                                    AND itemnmbr = d.itemnmbr \n                                                    AND UOFM = D.UOFM))\n                )           \n                as 'BaseUomTotalListPrice', \n\n        (d.qtyfulfi*u.equomqty) *       \n            isnull(p.psitmval, \n                ISNULL((SELECT psitmval from iv10402 \n                        WHERE prcShid = 'BASE PRICE' \n                        AND itemnmbr = d.itemnmbr \n                        AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                    WHERE prcShid = 'BASE PRICE' \n                                                    AND itemnmbr = d.itemnmbr \n                                                    AND UOFM = D.UOFM))\n                ) - D.XTNDPRCE AS 'TOTAL DISCOUNT',\n            a.IVBRAND as 'BRAND', b.IVSUBCAT as 'SubCat',\n            dbo.ACEfunc_CUSTOTYPE2(c.CUSTCLAS,c.SALSTERR) AS 'CUSTTYPE', D.MRKDNAMT*d.qtyfulfi AS 'MARKDOWN',\n            cast(i.uscatvls_6 as float) as 'ITEM REPORT SEQUENCE',\n            rtrim(ltrim(cast(uscatvls_1 as varchar(4)))) + '-' + bh.image_url as 'BRAND HANDLER',\n            I.ITMCLSCD 'ITEM CLASS', d.qtyfulfi*u.equomqty/uu.equomqty AS 'CASEQTY',\n            ii.inet1 as 'ABC CAT',\n            ISNULL(APL.PCPRICE,isnull(p.psitmval, \n                    ISNULL((SELECT psitmval from iv10402 \n                            WHERE prcShid = 'BASE PRICE' \n                            AND itemnmbr = d.itemnmbr \n                            AND UOFM = U.EQUIVUOM), (SELECT psitmval from iv10402 \n                                                        WHERE prcShid = 'BASE PRICE' \n                                                        AND itemnmbr = d.itemnmbr \n                                                        AND UOFM = D.UOFM))\n                    )) as 'APL(SAG) Piece Price', h.docid as 'SOP TYPE ID'\n\n    from sop10100 h\n        inner join sop10200 d on (h.sopnumbe = d.sopnumbe)\n        inner join IV00101 i on (d.itemnmbr = i.itemnmbr)\n        inner join RM00101 c on (h.custnmbr = c.custnmbr)\n        left join RM00102 c2 on (c.custnmbr = c2.custnmbr and c2.adrscode = 'MAIN')\n        left join RM00301 sp on (sp.slprsnid = c.slprsnid)\n        left join RM00303 st on (st.salsterr = c.salsterr)\n        LEFT JOIN iv40202 u on (i.uomschdl = u.uomschdl and d.uofm = u.uofm and u.qtybsuom &lt;&gt; 0)\n        LEFT JOIN iv40201 u2 on (i.uomschdl = u2.uomschdl)\n        left join iv10402 p1 on (d.itemnmbr = p1.itemnmbr and p1.PRCSHID = 'PLMAKRO'\n            and d.uofm = p1.uofm)\n        left join iv10402 p on (d.itemnmbr = p.itemnmbr and p.PRCSHID = 'BASE PRICE'\n            and U.EQUIVUOM = p.uofm)\n        left join #brand a on (i.uscatvls_2 = a.code)\n        left join #SubCat b on (i.uscatvls_4 = b.code)\n        left join iv40600 bh on (i.uscatvls_1 = bh.uscatval AND bh.uscatnum = 1)\n        left join iv40202 uu on (i.uomschdl = uu.uomschdl and i.selnguom = uu.uofm and uu.qtybsuom &lt;&gt; 0)\n        LEFT join sy01200 as ii on (ii.master_id = d.itemnmbr and ii.master_type = 'ITM') \n        LEFT JOIN T0_APL APL ON (D.ITEMNMBR=APL.ITEMNMBR AND APL.MNTH = @MNTH AND APL.YR = @YR)     \n\n    where\n        h.soptype = 3 and d.CMPNTSEQ = 0 and h.voidstts = 0 and h.pstgstus = 2\n        and h.docdate &gt;= @DTFROM and h.docdate &lt;= @DTTO\n    --order by percentvar, h.custname, d.sopnumbe, d.itemnmbr\n\nEND\n</code></pre>\n"},{"tags":["sql-server","maintenance"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12968327,"title":"Can you set up a SQL server maintenance plan to restore a database?","body":"<p>I am looking to setup a maintenance plan that makes a backup of a database (Database1) and then restores to another database (Database2) to confirm that it is able to restore successfully. </p>\n\n<p>Can I do this as part of a maintenance plan and have SQL server mail me if it fails either the backup or the restore?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","service-broker"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":12968549,"title":"linking multiple queues to same service in SQL service broker","body":"<p>Hi Everyone,\n            I have just started working with SQL service broker. I was wondering if we can <strong>link two service broker queues to same service</strong> such that when a message is sent using that service, it will be delivered to both queues i.e both the queues will contain same copy of a message. Is there any way like this or there is some other way to do this? </p>\n\n<p>Thanks in advance</p>\n\n<p>Pankaj</p>\n"},{"tags":["c#","sql-server","listview","gridview"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12967769,"title":"Create a page in C# for editing data in SQL Server","body":"<p>I am trying to create a page in C# for editing data in SQL Server, and the data is like <code>title</code>, <code>date</code>, <code>description</code> and that's not a big deal</p>\n\n<p>The problem is each row of this has a foreign key to another table that has image URL so each row has like 3 OR more images.</p>\n\n<p>Like I said before I want to create a page which can edit all of these, I made it with listview but it really really bad so I was trying to find another ideas so can you help me in that</p>\n"},{"tags":["sql-server","sqldatatypes","data-type-conversion"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":89,"score":2,"question_id":12967843,"title":"How to convert Nvarchar column to INT","body":"<p>I have a <code>nvarchar</code> column in one of my tables. Now I need to convert that column values to <code>INT</code> type..  </p>\n\n<p>I have tried using   </p>\n\n<pre><code>cast(A.my_NvarcharColumn as INT) \n</code></pre>\n\n<p>and  </p>\n\n<pre><code>convert (int, N'A.my_NvarcharColumn')\n</code></pre>\n\n<p>When I ran my query I am getting errors like   </p>\n\n<blockquote>\n  <p><em>Conversion failed when converting the nvarchar value ' 23454542 ' to\n  data type int.</em>  </p>\n</blockquote>\n\n<p>hi i am posting my entire code snippet  </p>\n\n<pre><code>SELECT A.objID, name, des,  right(Replace(Ltrim(Replace(substring(my_nvarcharcolumn,1,9), '0', ' ')), ' ', '0'),10) AS new_nvarcharcolumn \nINTO #tmp1\nFROM [database].[dbo].[tblname] AS A\nINNER JOIN (SELECT * FROM [database].[dbo].tblname1 WHERE sourceID = 32) AS AI ON source = A.objID\nINNER JOIN [database].[dbo].tblname2 AS I ON I.ObjectID = A.Source\n\nSELECT MAX(m_dAddDate) AS date_Asof, dnum INTO #tmp2 FROM \n(SELECT * FROM [database].[dbo].tblname WHERE senior &lt;&gt; '' AND class = 'SSS') AS A\nGROUP BY dnum\n\nSELECT DISTINCT A.* INTO #tmp3 FROM #tmp1 AS A\nINNER JOIN #tmp2 AS SD ON SD.dnum =cast(A.new_nvarcharcolumn as INT)\nINNER JOIN database.[dbo].tbl4 AS M ON M.dnum = cast(A.new_nvarcharcolumn as INT)  AND SD.date_Asof = M.adddate\n</code></pre>\n"},{"tags":["c#",".net","sql-server","c#-3.0"],"answer_count":3,"favorite_count":3,"up_vote_count":5,"down_vote_count":2,"view_count":434,"score":3,"question_id":6338180,"title":"best practices to implement hashing?","body":"<p>I need to implement hashing <strong>(I am not referring encryption)</strong> to make some data fields <strong>(passwords or some details that do not require getting back in original format, rather only need to match in db)</strong> secure. Can you please suggest me the best practices to implement hashing. I will be using C# and SQL Server and it will be a web site. </p>\n"},{"tags":["sql-server","view","script","ssms","generate"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12964266,"title":"sql server management studio: Generating view script with task -> generate scripts","body":"<p>I'm generating creation script for my Views through the Task option in SQL Server Management Studio 2008.</p>\n\n<p>When I run the script it fails because I have Views depending on other Views that are further down in the script.  For example, View1 depends on View2, but View2 does not get created until further down in the script.  So when the create statement for View1 is running it fails because of View2 does not exist yet.</p>\n\n<p>This is a legacy system and it's not so easy to go through and remove View dependencies.</p>\n\n<p>I can go through the script to move the statements around but I have 100+ views and it's not feasible to do this every time the script is generated.  The script I generate is an evolving script with each version released.</p>\n\n<p>Does anyone know how to get the management studio to create the view scripts with dependencies in consideration?  Or other ways to easily generate the scripts with a few clicks of the mouse?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","connection-string"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12965465,"title":"Cannot open database \"DigitSite.mdf\" requested by the login. The login failed. Login failed for user 'Lenaire-PC\\Lenaire'","body":"<p>Connection String:  </p>\n\n<pre><code>Server=(local);Database=DigitSite.mdf;Integrated Security=true \n</code></pre>\n\n<p>I've tried a bunch of other connection strings and they have the same error or one that doesn't even try to logon to the database I provide.  I'm not sure if this is an IIS issue at this point or a sql issue or a connection string issue.  </p>\n\n<p>In IIS7 the this app pool is set to local system</p>\n\n<p>I have my virtual directory mapped correctly</p>\n\n<p>For Path credentials I've used \"Application user(pass-through authentication) and I've specified a user and neither has worked, In authentication I've turned off anonymous authentication and turned on impersonation</p>\n\n<p>In sql I've made sure that the user I'm trying to login as has the proper security for this database as \"db owner\".  I've tried creating a user to sign in to sql as (sql Server 2008R2) but I get errors when trying to log that user in.  Any suggestions?</p>\n\n<p>This seems to be a common issue but I've literally spent more than 5 hours researching this and screwing with settings so I'm a little at whits end on how to get this to work.  Thanks.</p>\n"},{"tags":["c#","asp.net","sql-server","stored-procedures","sqldatasource"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12966722,"title":"Running a stored procedure in a SqlDataSource on button click","body":"<p>I am building a C# ASP.NET page where I want to call a stored procedure in a database.</p>\n\n<p>I have setup a <code>SqlDataSource</code> which points to the stored procedure. Parameters are obtained from the Web's control directly (TextBox)</p>\n\n<p>I have a button, when the user clicks it it should run the stored procedure, so I was going to add code like this : </p>\n\n<pre><code>mySqlDataSource.run()\n</code></pre>\n\n<p>or </p>\n\n<pre><code>mySqlDataSource.exec()\n</code></pre>\n\n<p>or </p>\n\n<pre><code>mySqlDataSource.storedProcedure()\n</code></pre>\n\n<p>but of course none of these methods exist.</p>\n\n<p>How do I initial the stored procedure? and how do I get the value returned by the stored procedure please?</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql","sql-server","sql-server-2005","join","temporary-tables"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1221,"score":3,"question_id":1326608,"title":"Speeding up temp table joins in SQL Server","body":"<p>I have 2 temp tables #temp1 and #temp. Both have a key and date columns. Both have around 25k rows. And I'm left joining them on the basis of the key and date which are unique on all rows. It's taking around 4 minutes for this join to complete. Is there any way to speed it up or any alternative methods?</p>\n"},{"tags":["sql-server","ssis","temporary-tables"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":891,"score":1,"question_id":1441099,"title":"Using temp tables in SSIS","body":"<p>I've created an ADO.NET connection manager, and a DataReader source with the following SQL Command:</p>\n\n<pre><code>select \n   'test' as testcol\nINTO\n   #tmp\n\nselect * from #tmp\n</code></pre>\n\n<p>If I click the refresh button in the DataReader component, I get SqlException \"Invalid object name #tmp\".  The SQL statment itself is clearly valid and executes properly in sql server management studio. I've also tried setting DelayValidation on the connection manager, to no avail.  </p>\n"},{"tags":["sql-server","tsql","stored-procedures","dynamic-sql","temporary-tables"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":2561,"score":0,"question_id":2917728,"title":"T-SQL Dynamic SQL and Temp Tables","body":"<p>It looks like #temptables created using dynamic SQL via the EXECUTE string method have a different scope and can't be referenced by \"fixed\" SQLs in the same stored procedure.\nHowever, I can reference a temp table created by a dynamic SQL statement in a subsequence dynamic SQL but it seems that a stored procedure does not return a query result to a calling client unless the SQL is fixed.</p>\n\n<p>A simple 2 table scenario:\nI have 2 tables. Let's call them Orders and Items. Order has a Primary key of OrderId and Items has a Primary Key of ItemId. Items.OrderId  is the foreign key to identify the parent Order. An Order can have 1 to n Items.</p>\n\n<p>I want to be able to provide a very flexible \"query builder\" type interface to the user to allow the user to select what Items he want to see. The filter criteria can be based on fields from the Items table and/or from the parent Order table. If an Item meets the filter condition including and condition on the parent Order if one exists, the Item should be return in the query as well as the parent Order.</p>\n\n<p>Usually, I suppose, most people would construct a join between the Item table and the parent Order tables.  I would like to perform 2 separate queries instead. One to return all of the qualifying Items and the other to return all of the distinct parent Orders. The reason is two fold and you may or may not agree.</p>\n\n<p>The first reason is that I need to query all of the columns in the parent Order table and if I did a single query to join the Orders table to the Items table, I would be repoeating the Order information multiple times. Since there are typically a large number of items per Order, I'd like to avoid this because it would result in much more data being transfered to a fat client. Instead, as mentioned, I would like to return the two tables individually in a dataset and use the two tables within to populate a custom Order and child Items client objects. (I don't know enough about LINQ or Entity Framework yet. I build my objects by hand). The second reason I would like to return two tables instead of one is because I already have another procedure that returns all of the Items for a given OrderId along with the parent Order and I would like to use the same 2-table approach so that I could reuse the client code to populate my custom Order and Client objects from the 2 datatables returned.</p>\n\n<p>What I was hoping to do was this:</p>\n\n<p>Construct a dynamic SQL string on the Client which joins the orders table to the Items table and filters appropriate on each table as specified by the custom filter created on the Winform fat-client app. The SQL build on the client would have looked something like this:</p>\n\n<p>TempSQL = \"</p>\n\n<pre><code>INSERT INTO #ItemsToQuery\n   OrderId, ItemsId\nFROM\n   Orders, Items \nWHERE\n   Orders.OrderID = Items.OrderId AND\n   /* Some unpredictable Order filters go here */\n  AND\n   /* Some unpredictable Items filters go here */\n\"\n</code></pre>\n\n<p>Then, I would call a stored procedure, </p>\n\n<pre><code>CREATE PROCEDURE GetItemsAndOrders(@tempSql as text)\n   Execute (@tempSQL) --to create the #ItemsToQuery table\n\nSELECT * FROM Items WHERE Items.ItemId IN (SELECT ItemId FROM #ItemsToQuery)\n\nSELECT * FROM Orders WHERE Orders.OrderId IN (SELECT DISTINCT OrderId FROM #ItemsToQuery)\n</code></pre>\n\n<p>The problem with this approach is that #ItemsToQuery table, since it was created by dynamic SQL, is inaccessible from the following 2 static SQLs and if I change the static SQLs to dynamic, no results are passed back to the fat client.</p>\n\n<p>3 around come to mind but I'm look for a better one:</p>\n\n<p>1) The first SQL could be performed by executing the dynamically constructed SQL from the client. The results could then be passed as a table to a modified version of the above stored procedure. I am familiar with passing table data as XML. If I did this, the stored proc could then insert the data into a temporary table using a static SQL that, because it was created by dynamic SQL, could then be queried without issue. (I could also investigate into passing the new Table type param instead of XML.) However, I would like to avoid passing up potentially large lists to a stored procedure.</p>\n\n<p>2) I could perform all the queries from the client. </p>\n\n<p>The first would be something like this:</p>\n\n<p>SELECT Items.* FROM Orders, Items WHERE Order.OrderId = Items.OrderId AND (dynamic filter)\nSELECT Orders.* FROM Orders, Items WHERE Order.OrderId = Items.OrderId AND (dynamic filter)</p>\n\n<p>This still provides me with the ability to reuse my client sided object-population code because the Orders and Items continue to be returned in two different tables.</p>\n\n<p>I have a feeling to, that I might have some options using a Table data type within my stored proc, but that is also new to me and I would appreciate a little bit of spoon feeding on that one.</p>\n\n<p>If you even scanned this far in what I wrote, I am surprised, but if so, I woul dappreciate any of your thoughts on how to accomplish this best.</p>\n"},{"tags":["sql-server","tsql","full-text-search","temporary-tables"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":660,"score":0,"question_id":4847057,"title":"TSQL - Optimizing Full Text Search query with temp table","body":"<p>To make it short I have a full text search query that does a company search on a single table.  Once the search is complete I pull extra stats from the result such as Top 5 titles, top 5 locations etc...</p>\n\n<p>How can this query be optimized it currently takes about 5 seconds to execute on &lt; 25,000 rows and based on the execution plan its mostly on the last 3 select statements.</p>\n\n<p>SQL SERVER: 2005.  I can upgrade to 2008 but I've heard there are more performance issues with SQL 2008.  </p>\n\n<p>Help is greatly appreciated.</p>\n\n<hr>\n\n<pre><code>CREATE PROCEDURE [usp_Company_Search]\n\n\n @KeywordNear as varchar(250),\n @LocationNear as varchar(250) = null,\n @PageIndex as int,\n @Pagesize as int\n\nAS\n\nBEGIN\n\nDECLARE @tbl TABLE\n(\n row int,\n [Rank] int,\n CompanyID int,\n CompanyDesc  text,\n Title nvarchar(150),\n Company nvarchar(150),\n Category nvarchar(50),\n Source nvarchar(50),\n URI nvarchar(250),\n Location varchar(60),\n DateCreated nvarchar(50)\n)\n\n IF (@LocationNear is not null) BEGIN\n\n  WITH CompanySearch as \n   (\n    SELECT ROW_NUMBER() OVER (ORDER BY rs.rank desc) as row,\n      rs.Rank as [Rank], \n      J.CompanyID,\n      J.CompanyDesc, \n      J.Title, \n      J.Company, \n      J.Category, \n      J.Source, \n      J.URI, \n      J.Location,\n      J.DateCreated\n    FROM Company J\n     INNER JOIN\n      CONTAINSTABLE (Company,RawStripped, @KeywordNear) rs\n      ON J.Companyid = rs.[KEY] AND\n      CONTAINS (Location, @LocationNear) \n   )\n\n    insert into @tbl select * from CompanySearch\n\n       SELECT\n     CompanySearch.[Rank], \n     CompanySearch.CompanyID,\n     CompanySearch.CompanyDesc, \n     CompanySearch.Title, \n     CompanySearch.Company, \n     CompanySearch.Category, \n     CompanySearch.Source, \n     CompanySearch.URI, \n     CompanySearch.Location,\n     CompanySearch.DateCreated\n    FROM @tbl as CompanySearch\n    WHERE CompanySearch.row between (@PageIndex - 1) * @PageSize + 1 and @PageIndex*@PageSize\n  END\n ELSE \n  BEGIN\n  WITH CompanySearch as \n    (\n     SELECT ROW_NUMBER() OVER (ORDER BY rs.rank desc) as row,\n       rs.Rank, \n       J.CompanyID,\n       J.CompanyDesc, \n       J.Title, \n       J.Company, \n       J.Category, \n       J.Source, \n       J.URI, \n       J.Location,\n       J.DateCreated\n     FROM Company J\n      INNER JOIN\n       CONTAINSTABLE (Company,RawStripped, @KeywordNear) rs\n       ON J.Companyid = rs.[KEY] \n    )\n\n    insert into @tbl select * from CompanySearch\n\n        SELECT\n      CompanySearch.Rank, \n      CompanySearch.CompanyID,\n      CompanySearch.CompanyDesc, \n      CompanySearch.Title, \n      CompanySearch.Company, \n      CompanySearch.Category, \n      CompanySearch.Source, \n      CompanySearch.URI, \n      CompanySearch.Location,\n      CompanySearch.DateCreated\n     FROM @tbl as CompanySearch\n     WHERE CompanySearch.row between (@PageIndex - 1) * @PageSize + 1 and @PageIndex*@PageSize\n\n END\n\n   SELECT Max(row) as RecordCount from @tbl\n   select top 5 title, count(title) as cnt from @tbl group by title order by cnt desc\n   SELECT top 5 Location, count(location) as cnt from @tbl group by location order by cnt desc\n   SELECT top 5 Company, count(company) as cnt from @tbl group by company order by cnt desc\n\n\nEND\n</code></pre>\n"},{"tags":["sql-server","dynamic-sql","temporary-tables","table-variable","sp-executesql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":6268,"score":1,"question_id":6100314,"title":"Dynamic query results into a temp table or table variable","body":"<p>I have a stored procedure that uses sp_executesql to generate a result set, the number of columns in the result can vary but will be in the form of Col1 Col2 Col3 etc.</p>\n\n<p>I need to get the result into a temp table or table variable so I can work with it. The problem is I need to define the columns of the temp table, which I cant do dynamically using sp_executesql as the scope of the temp table is lost after the command is executed.</p>\n\n<p>I have toyed with the idea of using Global Temp tables, as the scope allows it to be created dynamically, however, there is a very good chance the Global Temps would get updated by the concurrent executions of this process.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql-server","temporary-tables"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":671,"score":3,"question_id":6991511,"title":"SQL Server Temp table vs Table Variable","body":"<p>Our client's database admins have requested that we don't use temp tables within our reporting stored procedures (<code>#Table</code>), but instead, make use of table variables.</p>\n\n<p>Are table variables less efficient than temp tables?</p>\n\n<p>Also, if I create a table as <code>#table</code>, as opposed to <code>##table</code>, the one with one <code>#</code> is a session table, as opposed to the <code>##</code> which is global, right? When the <code>stored procedure</code> is completed, and you don't do a <code>DROP TABLE #table</code> ... does <code>#table</code> still exist? If it's session based, then will I ever have access to it again?</p>\n"},{"tags":["c#","java","sql","sql-server","java-ee"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":1,"question_id":12615602,"title":"How pass structure datatype to MS SQL database from Java","body":"<p>I am trying to call a stored procedure whose one parameter is <code>sqlstructure</code> type of MS SQL.I have passed <code>String[] array</code> but it threw this exception<br/></p>\n\n<pre><code>WARNING: #{reportingCharts.getGraphValuesOnLocationBasis}: org.springframework.jdbc.UncategorizedSQLException: PreparedStatementCallback; uncategorized SQLException for SQL [{CALL dbo.up_Chart_SelectPersonCountByRankLocation(?,?,?,?,?)}]; SQL state [null]; error code [0]; The conversion from UNKNOWN to UNKNOWN is unsupported.; nested exception is com.microsoft.sqlserver.jdbc.SQLServerException: The conversion from UNKNOWN to UNKNOWN is unsupported.\njavax.faces.FacesException: #{reportingCharts.getGraphValuesOnLocationBasis}: org.springframework.jdbc.UncategorizedSQLException: PreparedStatementCallback; uncategorized SQLException for SQL [{CALL dbo.up_Chart_SelectPersonCountByRankLocation(?,?,?,?,?)}]; SQL state [null]; error code [0]; The conversion from UNKNOWN to UNKNOWN is unsupported.; nested exception is com.microsoft.sqlserver.jdbc.SQLServerException: The conversion from UNKNOWN to UNKNOWN is unsupported.\n</code></pre>\n\n<p>So I think it is not accepting the <code>array</code> as a parameter for structure.<br/>Unfortunately nowhere I can find an example about how to use it in java.<br/>How can i pass my this array/list to this stored procedure? OR what would be the alternate for c#  <code>SqlDbType.Structured</code> in java?</p>\n"},{"tags":["mysql","sql","sql-server","oracle","null"],"answer_count":8,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":201,"score":2,"question_id":12853944,"title":"Why in SQL NULL can't match with NULL?","body":"<p>I'm new to SQL concepts, while studying NULL expression I wonder why NULL can't match with NULL can anyone tell me a realworld example to simply this concept?</p>\n"},{"tags":["sql","sql-server","tsql","temporary-tables"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":64,"score":-1,"question_id":12966555,"title":"Couldn't create temp table from select query if result empty","body":"<p>I want to crate a temp table from select query (My table has many columns, therefore I don't want to create the temp table manually)\nI use the following query:</p>\n\n<pre><code>SELECT * INTO #TempTable\nFROM MyTable\nWHERE ...\n</code></pre>\n\n<p>If this query return empty rows, it won't create <code>#TempTable</code>. Hence, I cannot use this <code>#TempTable</code> for the next queries.</p>\n\n<p>Is there a way to resolve this?</p>\n"},{"tags":["sql-server"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":40,"score":3,"question_id":12965596,"title":"Group By include non-aggregate field","body":"<p>I have a table with duplicate values in <code>field2</code> and <code>field1</code> has values I want to preserve in a query. </p>\n\n<pre><code>field1  field2\n Bob       2\n Bob       2\n Bob       3\n Bob       3\n</code></pre>\n\n<p>This query uses a group by clause:</p>\n\n<pre><code>select field2\nrom table\ngroup by field2\n</code></pre>\n\n<p>As we all know I cannot include <code>field1</code> in the select. I need to include <code>field1</code> in my output. Not sure how to accomplish this.</p>\n"},{"tags":["sql-server","stored-procedures","priority"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":830,"score":3,"question_id":2304366,"title":"Running a SQL Server 2008 Sproc at Lower Priority","body":"<p>We have a high volume web application based on ASP.NET 3.5 and SQL 2008 where we hope to maintain high availability levels 24x7 without the need for a maintenance window.  </p>\n\n<p>Over time, we have become reliant upon some stored procs which perform housekeeping operations to purge data which is no longer needed, compile some metrics, etc.  Our problem is that these sprocs consume almost all the CPU on the servers while they are running resulting in a significant impact on the site's responsiveness.</p>\n\n<p>Is there a way to run these sprocs at a lower priority?  It really does not matter how long they take to complete, so long as we can reduce the impact on the CPU of the database server.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":12036030,"title":"SQL - find total records that occur before another","body":"<p>I have the following schema and want to find the number of clients that have a typeId of 10 appearing first.  The answer with the following data would be 2 (client id 1000 and 1003 have a 10 on the 1st January and an 11 on 2nd January.</p>\n\n<pre><code>CREATE TABLE Event (ClientId int, TypeId int, Date smalldatetime)\nINSERT Event (ClientId , TypeId, Date) VALUES (1000, 10, '1 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1000, 11, '2 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1001, 11, '1 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1001, 10, '2 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1002, 11, '1 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1003, 10, '1 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1003, 11, '2 JAN 12')\n</code></pre>\n\n<p>I have tried a few queries with ROW_NUMBER() but have got a bit lost.</p>\n"},{"tags":["sql","sql-server","datetime","concatenation"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":342,"score":2,"question_id":11792836,"title":"SQL Server : concatenate YEAR and MONTH","body":"<p>I have a <code>group by YEAR(mydate),MONTH(mydate)</code></p>\n\n<p>I want to select them as a unique field like</p>\n\n<pre><code>SELECT SUM(Price),YEAR(mydate) + '/' + MONTH(mydate)\nFROM MyTable\nGROUP BY YEAR(mydate), MONTH(mydate)\n</code></pre>\n\n<p>or something like this.</p>\n\n<p><code>mydate</code> is <code>smalldatetime</code>.</p>\n\n<p>Is it possible?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":4,"favorite_count":10,"up_vote_count":15,"down_vote_count":0,"view_count":1656,"score":15,"question_id":1038506,"title":"Efficient way of getting @@rowcount from a query using row_number","body":"<p>I have an expensive query using the row_number over() functionality in SQL Server 2005.  I return only a sub list of those records as the query is paginated.  However, I would like to also return the total number of records, not just the paginated subset.  Running the query effectively twice to get the count is out of the question.</p>\n\n<p>Selecting count(*) is also out of the question as the performance is absolutely terrible when I've tried this.</p>\n\n<p>What I'd really love is @@ROW_NUMBERROWCOUNT :-)</p>\n"},{"tags":["sql-server","tsql","sql-server-2005","declarative"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12965114,"title":"How can I do this without a cursor or loop?","body":"<p>I hear to use Declarative programming but I have no idea how to do something like this in sql server 2005\n(I typed this up really fast so I'm not sure if all the syntax is correct but I think you'll understand what I'm looking for)</p>\n\n<pre><code>declare curs cursor for\nselect @Name, @Description, @Id FROM TableA\nopen curs\nwhile(1=1) \nbegin\n    fetch next from curs into\n        @Name,\n        @Description,\n        @Id\n    if(@@fetch_status&lt;&gt;0) break\n\n    set @recordCount = (SELECT COUNT(*) As RecordCount FROM Class1 WHERE          \n            Class1Id = @Id)\n    if(@recordCount &gt; 0)\n    begin\n\n        if(@Name = 'BAD NAME') CONTINUE\n        UPDATE Class1 SET \n            Name = @Name\n            , Description = @Description\n            WHERE Class1Id = @Id\n    end\n    else\n    begin\n        INSERT INTO Class1 (Class1Id, Name, Description)\n        VALUES (@Id, @Name, @Description)\n    end\n\nend\nclose curs\ndeallocate curs\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12965181,"title":"How to create generic column in database table?","body":"<p>I have a table with a large number of very specific columns which are mostly \"Strings\". I believe this hardcoding of names will give me grief later on when rules changes. I am investigating the option of using a second table where each row is a column from the master table which could each have a lookup key for its name.</p>\n\n<p>I know this may seem anti ER best practice, but it would be flexible. I could use views with subselects ie Select (SQL1), (SQL2) etc from Table1. Not sure if one can update a multitable view though in SQLServer. </p>\n\n<p>Thoughts on the above greatly appreciated.</p>\n\n<p>Thanks,</p>\n\n<p>Ed</p>\n"},{"tags":["sql","sql-server","join","gis","latitude-longitude"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":2,"question_id":12964554,"title":"How to select using lat/lng radius with a SQL join","body":"<p>I have a <a href=\"http://weblogs.asp.net/jimjackson/archive/2009/02/13/calculating-distances-between-latitude-and-longitude-t-sql-haversine.aspx\" rel=\"nofollow\">SQL function</a> that calculates the distance between two points using their lat/lng coordinates. Using this function, I can shortlist a set of locations from a large set (<em>GEOCODES table</em>) based on their distance for a given point like so:</p>\n\n<pre><code>DECLARE @LAT1 float, @LNG1 float,\nSET @LAT1 = '34.169540'\nSET @LNG1 = '-92.590990'\n\nSELECT E.* FROM GEOCODES E\nWHERE dbo.fnGetDistance(E.lat, E.lng, @LAT1, @LNG1, 'miles') &lt; '20'\n</code></pre>\n\n<p>I have a second table (<em>GEOMILES</em>) with distances between points in the form:</p>\n\n<pre><code>LOCATION1  | STATE1  |  LOCATION2  |  STATE2  | DISTANCE\n-----------+---------+-------------+----------+---------\nNew York   |   NY    |    Boston   |   MA     |   220\n</code></pre>\n\n<p>What I'm trying to achieve is a <code>SELECT</code> query that returns a distance of 220 if a departure point is within 20 miles of New York, and an arrival point is within 20 miles of Boston. So far, I have this but it returns nothing when I know from checking manually that the lat/lng points etc add up. Any help is much appreciated!</p>\n\n<pre><code>DECLARE @FROM_LOC VARCHAR(100), @FROM_STA VARCHAR(2), @TO_LOC VARCHAR(100), @TO_STA VARCHAR(2)\n\nSET @FROM_LOC = 'NEWARK'\nSET @FROM_STA = 'NJ'\n\nSET @TO_LOC = 'MEDFORD'\nSET @TO_STA = 'MA'      \n\nSELECT G.DIST FROM GEOMILES G, GEOCODES E\nJOIN GEOCODES C ON C.asciiname = @FROM_LOC AND C.admin1 = @FROM_STA\nJOIN GEOCODES D ON D.asciiname = @TO_LOC AND D.admin1 = @TO_STA\nWHERE dbo.fnGetDistance(E.lat, E.lng, C.lat, C.lng, 'miles') &lt; '20'\nAND dbo.fnGetDistance(E.lat, E.lng, D.lat, D.lng, 'miles') &lt; '20'\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12964650,"title":"can you join on a stored procedure?","body":"<p>I have a bunch of <code>WITH</code> statements:</p>\n\n<pre><code>;with OneAccession as (\n        select client_id,COUNT(patient_id) PatientCount from\n        (\n            select client_id,patient_id\n            from F_ACCESSION_DAILY\n            group by CLIENT_ID,PATIENT_ID\n            having COUNT(ACCESSION_ID)=1\n        ) a\n        group by CLIENT_ID\n    )\n    ,\n\n    TwoAccessions as (\n    select client_id,COUNT(patient_id) PatientCount from\n        (\n            select client_id,patient_id\n            from F_ACCESSION_DAILY\n            group by CLIENT_ID,PATIENT_ID\n            having COUNT(ACCESSION_ID)=2\n        ) a\n    group by client_id\n    )\n\n    ,\n\n    ThreeAccessions as (\n    select client_id,COUNT(patient_id) PatientCount from\n    (\n        select client_id,patient_id\n        from F_ACCESSION_DAILY\n        group by CLIENT_ID,PATIENT_ID\n        having COUNT(ACCESSION_ID)=3\n    ) a\n    group by client_id\n    )\netc\n</code></pre>\n\n<p>And I join these statements on </p>\n\n<pre><code>select * from myTable\njoin OneAccession\non...\njoin TwoACcessions\non...\njoin ThreeAccessions\n</code></pre>\n\n<p>Instead of having all those <code>with</code> statements, can i just create a stored proc? I would just pass the value of <code>having count(accession_id)=**@myParam**</code> and do this:</p>\n\n<pre><code>select * from myTable\njoin storedproc(1)\non...\njoin storedproc(2)\non...\netc...\n</code></pre>\n\n<p><strong>Is there an issue on joining on a stored Proc?</strong> Is my methodology OK?</p>\n"},{"tags":["sql","sql-server","multiple","locks"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":12964747,"title":"Microsoft SQL Server multiple locks","body":"<p>I'm currently running Microsoft SQL Express Server.\nWhen one user performs a query without committing it, it locks the entire table.\nThe problem is that malicious users might \"ruin\" the database by doing so on purpose.\nHow can I prevent this from happening?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":68,"score":0,"question_id":12944646,"title":"how to create a subquery in sql using count based on outer query","body":"<p>I hope someone can help me with this query. Basically I have two queries that I want to \"combine\". I want the second query as an extra column along with the first query.\nThe first one is this :</p>\n\n<pre><code>SELECT t_Item_Storage_Location.Storage_Loc_Nbr, \nt_Storage_Location.Storage_Loc_Type_Code, \nCount(t_Load.Load_Id) AS CurrentLoadCount,\nt_load.MMM_Id_Nbr\n\nFROM t_Load INNER JOIN (t_Storage_Location INNER JOIN t_Item_Storage_Location ON \nt_Storage_Location.Storage_Loc_Nbr = t_Item_Storage_Location.Storage_Loc_Nbr) ON \n(t_Load.Storage_Loc_Nbr = t_Item_Storage_Location.Storage_Loc_Nbr) \nAND (t_Load.MMM_Id_Nbr = t_Item_Storage_Location.MMM_Id_Nbr)\n\n\nwhere ((((t_Item_Storage_Location.MMM_Id_Nbr) Between '702004%' And '702011%') \nAND ((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%A') \nAND ((t_Storage_Location.Storage_Loc_Type_Code)='CD') \nAND ((t_Load.Active_Status_Ind)='A') \nAND ((t_Load.QC_Status_Code) Like 'R%') \nAND ((t_Load.MMM_Facility_Code)='MC')) \nOR (((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%B'))\nOR (((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%C')) \nOR (((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%D')) \nOR (((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%E'))\n\n)\nGROUP BY t_Item_Storage_Location.MMM_Id_Nbr,\nt_Item_Storage_Location.Storage_Loc_Nbr, \nt_Storage_Location.Storage_Loc_Type_Code,\nt_Load.MMM_Facility_Code,\nt_load.MMM_Id_Nbr\n\nHAVING\nCount(t_Load.Load_Id)&lt;4\n</code></pre>\n\n<p>The second one, is based on the t_load.MMM_Id_Nbr of the first one. Basically I want a count of all the loads with that mmm_id_nbr.</p>\n\n<pre><code>SELECT count(Load_ID) as LoadCount, MMM_Id_Nbr, storage_Loc_Nbr\nFROM t_load \nWHERE QC_Status_Code like 'R%' and mmm_Facility_Code ='MC' and Active_Status_Ind='A'\nGROUP by MMM_Id_Nbr, storage_loc_Nbr\n</code></pre>\n"},{"tags":["sql-server","xpath","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":92,"score":5,"question_id":12963951,"title":"Select XML element in SQL Server","body":"<p>I have some XML that I need to parse using SQL Server 2008.  I think I'm close to getting what I want, but I don't have the correct syntax (I believe).</p>\n\n<p>I have the following:</p>\n\n<pre><code>DECLARE @doc XML\nSET @doc = '&lt;ROOT&gt;          \n    &lt;InvoiceDetail&gt;\n        &lt;OrderId&gt;1000000&lt;/OrderId&gt;\n        &lt;OrderTypeId&gt;2&lt;/OrderTypeId&gt;\n        &lt;Id&gt;2000&lt;/Id&gt;\n        &lt;InvoiceItems&gt;\n            &lt;InvoiceItem&gt;\n                &lt;LineId&gt;1&lt;/LineId&gt;\n                &lt;Cd&gt;123456&lt;/Cd&gt;\n                &lt;Description&gt;Item 1&lt;/Description&gt;\n                &lt;Quantity&gt;1&lt;/Quantity&gt;\n                &lt;UnitPrice&gt;99.990000&lt;/UnitPrice&gt;\n            &lt;/InvoiceItem&gt;\n            &lt;InvoiceItem&gt;\n                &lt;LineId&gt;2&lt;/LineId&gt;\n                &lt;Cd&gt;234567&lt;/Cd&gt;\n                &lt;Description&gt;Item 2&lt;/Description&gt;\n                &lt;Quantity&gt;1&lt;/Quantity&gt;\n                &lt;UnitPrice&gt;89.990000&lt;/UnitPrice&gt;\n            &lt;/InvoiceItem&gt;\n        &lt;/InvoiceItems&gt;\n    &lt;/InvoiceDetail&gt;\n    &lt;InvoiceDetail&gt;\n        &lt;OrderId&gt;1200000&lt;/OrderId&gt;\n        &lt;OrderTypeId&gt;1&lt;/OrderTypeId&gt;\n        &lt;Id&gt;3000&lt;/Id&gt;\n        &lt;InvoiceItems&gt;\n            &lt;InvoiceItem&gt;\n                &lt;LineId&gt;1&lt;/LineId&gt;\n                &lt;Cd&gt;234567&lt;/Cd&gt;\n                &lt;Description&gt;Item 2&lt;/Description&gt;\n                &lt;Quantity&gt;1&lt;/Quantity&gt;\n                &lt;UnitPrice&gt;89.990000&lt;/UnitPrice&gt;\n            &lt;/InvoiceItem&gt;\n            &lt;InvoiceItem&gt;\n                &lt;LineId&gt;2&lt;/LineId&gt;\n                &lt;Cd&gt;345678&lt;/Cd&gt;\n                &lt;Description&gt;Item 3&lt;/Description&gt;\n                &lt;Quantity&gt;1&lt;/Quantity&gt;\n                &lt;UnitPrice&gt;79.990000&lt;/UnitPrice&gt;\n            &lt;/InvoiceItem&gt;\n        &lt;/InvoiceItems&gt;\n    &lt;/InvoiceDetail&gt;\n&lt;/ROOT&gt;'\n\nSELECT \n      Invoices.Node.value('@OrderId', 'VARCHAR(10)') 'OrderID'\n    , Invoices.Node.value('@Id', 'INT') 'InvoiceId'\n    , Items.Cd.value('.', 'VARCHAR(14)') 'ItemId'\nFROM \n    @doc.nodes('//InvoiceDetail') Invoices(Node)\n    CROSS APPLY Invoices.Node.nodes('./InvoiceItems/InvoiceItem/Cd') Items(Cd)\n</code></pre>\n\n<p>I get the following results:</p>\n\n<pre><code>NULL    NULL    123456\nNULL    NULL    234567\nNULL    NULL    234567\nNULL    NULL    345678\n</code></pre>\n\n<p>I'm trying to get the following:</p>\n\n<pre><code>1000000 2000    123456\n1000000 2000    234567\n1200000 3000    234567\n1200000 3000    345678\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["c#","asp.net","sql-server","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":105,"score":2,"question_id":12866684,"title":"What is the easy way to find all stored procedures, which are used in some specific asp.net page?","body":"<p>I need to find all SPs, which are used in particular page. Problem, that they aren't called directly from page, but from other assemblies in other projects. So, I need to analyse all code to find them. I just think maybe some other method exists? Just run this page in application and catch all moments when SQL server is calling? Using VS 2010, MSSQL 2008, C#, web forms.</p>\n"},{"tags":["sql-server","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":346,"score":0,"question_id":1705086,"title":"Set below query into asc or desc order?","body":"<pre><code>SELECT * FROM (SELECT ROW_NUMBER()\nover\n     (\n        ORDER BY\n          CASE WHEN @SortExpression ='Country_id' THEN Country_id END,\n          CASE WHEN @SortExpression ='Country_name' THEN Country_name END,\n          CASE WHEN @SortExpression ='Country_region' THEN Country_region END,\n          CASE WHEN @SortExpression ='Country_area' THEN Country_area END,\n          CASE WHEN @SortExpression ='Country_Population' THEN Country_Population END,\n        CASE WHEN @SortExpression ='Country_gdp' THEN Country_gdp END\n     )as num ,* From Country_Profile123 ) as tbl\n      WHERE num BETWEEN @column AND @column1\n</code></pre>\n\n<p>I solved half of the problem (that is the paging and sorting), what I'm trying to do now is the sorting order.</p>\n"},{"tags":["sql","sql-server","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12264669,"title":"Sql query- needs to extract records based on Datefield","body":"<p>I need to extract data from Table1 and insert it into Table2 on Last monday of every month. Basic version of my Tables are something like this..</p>\n\n<p>Table1 (ID,Name,EffectiveDate)</p>\n\n<p>Table2 (ID,Name,EffectiveDate,ProcessDate)</p>\n\n<p>I want to extract only those records where Effectivedate has been 4 months from current date (For Example: if EffectiveDate is 1st January then it should be extracted after 1st April...). Actually Table2 is being used for Reporting purpose so we have 'processDate' field that we can use while Filtering.</p>\n\n<p>Any help would be appreciated..thanks</p>\n\n<p>EDIT:</p>\n\n<p>well, i know we can do something like this </p>\n\n<p>EffectiveDate &lt; DATEADD(MM,-4,GetDate())</p>\n"},{"tags":["sql-server","foreign-keys","indexes"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":58,"score":-1,"question_id":12962027,"title":"Query to get foreign key indexes","body":"<p>I am looking for a query in sql server that will show me a list of all foreign key indexes in my database. I have a bunch of indexes within my database and some are on the foreign keys of the tables and I am looking to drop all my indexes except for those against the foreign keys and primary keys.</p>\n"},{"tags":["sql","sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":12961619,"title":"SQL AND OR evaluating to different results","body":"<p>I have a problem when using AND and OR in SQL.</p>\n\n<p>This returns a single record:</p>\n\n<pre><code>SELECT DISTINCT s.SupplierName, r.ReturnID, r.Reason\nFROM tblSupplierProducts sp, tblReturns r,tblSuppliers s\nWHERE sp.SupplierID=s.SupplierID\nAND sp.ProductID=r.productID\nAND r.Reason LIKE 'Unreadable disk' \n</code></pre>\n\n<p>This also returns a single record:</p>\n\n<pre><code>SELECT DISTINCT s.SupplierName, r.ReturnID, r.Reason\nFROM tblSupplierProducts sp, tblReturns r,tblSuppliers s\nWHERE sp.SupplierID=s.SupplierID\nAND sp.ProductID=r.productID\nAND r.Reason LIKE 'Scratched CD'\n</code></pre>\n\n<p>But when I do this:</p>\n\n<pre><code>SELECT DISTINCT s.SupplierName, r.ReturnID, r.Reason\nFROM tblSupplierProducts sp, tblReturns r,tblSuppliers s\nWHERE sp.SupplierID=s.SupplierID\nAND sp.ProductID=r.productID\nAND r.Reason LIKE 'Unreadable disk' \nOR r.Reason LIKE 'Scratched CD'\n</code></pre>\n\n<p>The 'Unreadable disk' results are present and correct\nbut the 'Scratched CD' is not ( it has the same value for every different supplier)\nIf i swap them like this:</p>\n\n<pre><code>SELECT DISTINCT s.SupplierName, r.ReturnID, r.Reason\nFROM tblSupplierProducts sp, tblReturns r,tblSuppliers s\nWHERE sp.SupplierID=s.SupplierID\nAND sp.ProductID=r.productID\nAND r.Reason LIKE  'Scratched CD'\nOR r.Reason LIKE 'Unreadable disk'\n</code></pre>\n\n<p>my first result is correct ('Scratched CD') while 'Unreadable disk' returns trhe same value for multiple suppliers.</p>\n\n<p>It seems the AND OR is messing up the query why?</p>\n"},{"tags":["sql","sql-server","database","tsql"],"answer_count":3,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":94,"score":5,"question_id":12958536,"title":"T-SQL ORDER BY according to a condition","body":"<p>I am writing some sort of resources management system.</p>\n\n<p>A resource is an instance of a definition. A definition is the  metadata, basically it contains the properties.</p>\n\n<p>This is in general my DB:</p>\n\n<pre><code>TypeDefinition\nid    name\n===============\n1     CPU\n\n\nPropertyDefinition\nid    name       typeDefinitionId   valueType\n================================================\n1     frequency  1                  int\n2     status     1                  string\n\n\nTypeInstance\nid    name     typeDefinitionId\n=================================\n1     CPU#1    1  \n2     CPU#2    1\n\n\nPropertyInstanceValue\nid   propertyDefinitionId  typeInstanceId   valueType   intValue  StringValue FloatValue\n========================================================================================\n1    1                     1                int         10\n2    2                     1                string                Pending\n3    1                     2                int         20\n4    2                     2                string                Approved\n</code></pre>\n\n<p><em><strong>REQUIREMENT:</em></strong></p>\n\n<p>order all resources according to a <strong>specific property value</strong>.</p>\n\n<p>For example:  order all resources according to their <strong>status</strong> --> Meaning CPU#2 will appear before CPU#1 because Approved is before Pending.</p>\n\n<p>If we were to order according to <strong>frequency</strong>, CPU#1 will appear before CPU#2 because 10 is before 20.</p>\n\n<p>So I need to sort each time according to a different column (intValue / stringValue/ FloatValue / etc), depending on the property's valueType.</p>\n\n<p>Any suggestion?</p>\n\n<p><em><strong>LIMITATION:</em></strong></p>\n\n<p>PIVOT is currently the only option we've thought of, but it's not really possible since the DB is huge and I need the query to be as fast as possible.</p>\n\n<p>Thanks a lot in advance,</p>\n\n<p>Michal.</p>\n"},{"tags":["sql-server","ssis","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":164,"score":1,"question_id":12958244,"title":"How to control SSIS package flow based on record count returned by a query?","body":"<p>I'm trying to first check if there are any new records to process before I execute my package.  I have a bit field called \"processed\" in a SQL Server 2008 R2 table that has a value of 1 if processed and 0 if not.  </p>\n\n<p>I want to query it thus: </p>\n\n<pre><code>select count(processed) from dbo.AR_Sale where processed = 0\n</code></pre>\n\n<p>If the result is 0 I want to send an e-mail saying the records are not there.  If greater than zero, I want to proceed with package execution. I am new to SSIS and can't seem to figure out what tool to use for this.  </p>\n\n<p>My package has a data flow item with an OLE DB connection inside it to the database. The connection uses a query to return the records.  Unfortunately, the query completes successfully (as it should) even if there are no records to process.  Here is the query:</p>\n\n<pre><code>Select * from dbo.AR_Sale where processed = 0\n</code></pre>\n\n<p>I copy these records to a data warehouse and then run another query to update the source table by changing the processed field from 0 to 1.<br>\nAny help would be greatly appreciated.</p>\n"},{"tags":["sql","sql-server","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12962057,"title":"SQL Query relationship coding","body":"<p>Need some help making this work please.  Some help please to ensure I always return just one row per <strong>ProductID</strong>. My Product Table contains base information on Products which can be properties in this case.  It links to the Properties table via a ProductCode. </p>\n\n<p>What I would like is to have the query return just the one row which it really should. Essentially, the row should display the PropertyLabel whether or not there are values in the PropertyProductValues table for that particular propertyLabel. The code below returns a bunch of rows which really it shouldn't, or I don't want it to. And I would appreciate help fine tuning this please. thanks in Advance. </p>\n\n<pre><code>Create Table Product \n{\n    ProductID uniqueidentifier, \n    ProductName Varchar(50),\n    ProductCode Varchar(50)\n\n}\n\nCreate Table Properties\n{\n     PropertyID uniqueidentifier, \n     PropertyProductcode Varchar(50)\n\n}\n\nCreate Table PropertyProductValues\n{\n    ID uniqueidentifier,\n    PropertyID  uniqueidentifier,\n    ProductID    uniqueidentifier,\n    PropertyLabel Varchar(50),\n    UnitID uniqueidentifier\n\n}\n\nCreate Table unit\n{\n    UnitID uniqueidentifier,\n    Unit Varchar(50)\n}\n\n   Select productid , PropertyLabel\nPropertyValue\nPropertyUnit \nfrom Product \ninner join Properties on ProductCode =  PropertyProductCode\nleft join PropertyProductValues on Properties.PropertyID = ProductProductValues.PropertyID \nleft join Unit on PropertyValues.UnitID = Unit.UnitID\n    Where ltrim(rtrim(lower(PropertyLabel))) = lower('Special')\n</code></pre>\n\n<h2>Sample Data</h2>\n\n<pre><code>Product Table \nb0359c76-8622-4006-82f2-1b4c91a8f6b3   Brown Building   YSHJT\naba475c4-5a5c-483a-9faa-67f67ff9672d   Sket Building       GTJHD54\n8f645348-8871-4fad-8c85-9fc6a1169b33    HOUSE 9           DGFS345\n\n\nProperties Table\n\n27c6485b-f7a5-4243-9304-71939230964d     DGFS345\n88e911e5-bf40-4f14-89cc-4ed2984c342e     GTJHD54\nd217cc14-6fcb-4251-a6d7-8fd1b3398a32      YSHJT\n689cfd9d-bc87-4e23-afb3-d6cbf1e961f6       FFFSRW\nbf7ae151-2e3f-4e0a-bf8b-d44ef30cf276        WYSJD\n\nPropertyProductValues Table\n\n6cf47434-c834-455d-a606-3d10cb9f7ab3       b0359c76-8622-4006-82f2-1b4c91a8f6b3    b0359c76-8622-4006-82f2-1b4c91a8f6b3       Storey           \n82ee0f80-afe4-45c2-877c-e79ce286170f         27c6485b-f7a5-4243-9304-71939230964d   b0359c76-8622-4006-82f2-1b4c91a8f6b3       Bedrooms     \n5ff7f809-6b1f-4d6c-a125-29ce67f097d7         27c6485b-f7a5-4243-9304-71939230964d    8f645348-8871-4fad-8c85-9fc6a1169b33        Bathrooms\n7f634b81-1212-4223-af42-29b4dc2bafcc         27c6485b-f7a5-4243-9304-71939230964d     aba475c4-5a5c-483a-9faa-67f67ff9672d        Material\ncae10884-edf0-4340-bde6-5207e28a07cc         689cfd9d-bc87-4e23-afb3-d6cbf1e961f6         b0359c76-8622-4006-82f2-1b4c91a8f6b3      Basement\n83943759-39d7-406e-92ea-4202a9b1d716        bf7ae151-2e3f-4e0a-bf8b-d44ef30cf276         b0359c76-8622-4006-82f2-1b4c91a8f6b3      Storey\nc045d0ff-34db-4427-9fb7-fd41fc92f310          bf7ae151-2e3f-4e0a-bf8b-d44ef30cf276         aba475c4-5a5c-483a-9faa-67f67ff9672d         balcony\n\nUnit Table \n\nUNITID                                       UNIT\n3a4a5216-0704-495e-b0a7-560787e0847a         kg\n6b4493f6-c2e4-4682-b71d-93cb1893eb73          m\n2f2b4fee-9e69-4a71-a098-36e2da71471e          l\n55c8e5bf-edde-4977-ab7b-8827e337a31e          oz\n19528647-bd9f-48e0-ba86-b722d5b8ab0e          cm\ncee5cd46-1ae4-4b49-8b1c-9b3e0bd5270f          mm\n</code></pre>\n"},{"tags":["sql-server"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12961950,"title":"SQL Server query to non normalized table","body":"<p>I have an unnormalized table of customer orders. I want count how many products are sold and display it in table by type.</p>\n\n<pre><code>OnlineSalesKey  SalesOrderNumber  ProductKey\n--------------------------------------------\n     1              20121018         778\n     2              20121018         774\n     3              20121018         665\n     4              20121019         772\n     5              20121019         778\n     9              20121019         434\n    10              20121019         956\n    11              20121020         772\n    12              20121020         965\n    15              20121020         665\n    16              20121020         778\n    17              20121021         665\n</code></pre>\n\n<p>My query:</p>\n\n<pre><code>SELECT \n    s.ProductKey, COUNT (*) As Purchased \nFROM\n    Sales s\nGROUP BY \n    s.ProductKey\n</code></pre>\n\n<p><strong>Question #1.</strong> </p>\n\n<p>That query does a job. But now I want display and take into account only those orders where more than one item is purchased. Not sure how do i do that in one query.  Any ideas?</p>\n\n<p><strong>Question #2</strong></p>\n\n<p>Is it possible to normalize results and get back data separated by semi column? </p>\n\n<pre><code>20121018 | 778; 774; 665\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server","performance","sql-server-2008","tsql","insert"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":120,"score":1,"question_id":12956286,"title":"Optimal insert/update batch for SQL Server","body":"<p>I'm making frequent inserts and updates in large batches from c# code and I need to do it as fast as possible, please help me find all ways to speed up this process.</p>\n\n<ol>\n<li>Build command text using <code>StringBuilder</code>, separate statements with <code>;</code> </li>\n<li>Don't use <code>String.Format</code> or <code>StringBuilder.AppendFormat</code>, it's slower then multiple <code>StringBuilder.Append</code> calls</li>\n<li>Reuse <code>SqlCommand</code> and <code>SqlConnection</code></li>\n<li>Don't use <code>SqlParameter</code>s (limits batch size)</li>\n<li>Use <code>insert into table values(..),values(..),values(..)</code> syntax (1000 rows per statement)</li>\n<li>Use as few indexes and constraints as possible</li>\n<li>Use simple recovery model if possible</li>\n<li>?</li>\n</ol>\n\n<p>Here are questions to help update the list above</p>\n\n<ol>\n<li>What is optimal number of statements per command (per one <code>ExecuteNonQuery()</code> call)?</li>\n<li>Is it good to have inserts and updates in the same batch, or it is better to execute them separately?</li>\n</ol>\n\n<p>My data is being received by tcp, so please don't suggest any Bulk Insert commands that involve reading data from file or external table. </p>\n\n<p>Insert/Update statements rate is about 10/3.</p>\n"},{"tags":["sql","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":46,"score":-1,"question_id":12961852,"title":"selecting data in sql server","body":"<p>i have a table with a parent-child relationship like:</p>\n\n<pre><code>country1\n    state1\n       city1\n       city2\n          part1\n          part2\n     state2\n       city1\n       city2\n          part1\n          part2\ncountry2\n    state1\n       city1\n       city2\n          part1\n          part2\n</code></pre>\n\n<p>What I want is that if I run a <code>SELECT</code> command with a <code>WHERE</code> condition, it will return data like:</p>\n\n<pre><code>state1\n  city1\n  city2\n    part1\n    part2\n</code></pre>\n\n<p>or</p>\n\n<pre><code> city2\n          part1\n          part2\n</code></pre>\n\n<p>It means I want to select only the downward hierachical data </p>\n"},{"tags":["sql-server","query","coldfusion"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12961444,"title":"MS-SQL sort output in descending order","body":"<p>I have this MS-SQL query with thousands of row records in database:<br /></p>\n\n<pre><code>SELECT DISTINCT TOP 7 DATENAME(MM, mydatetime) + ' ' + CAST(DAY(mydatetime) AS VARCHAR(2)) as thedate\n    , MONTH(mydatetime)\n    , DAY(mydatetime)\n    , COUNT(Page) as totalcount\n    , count(DISTINCT Page) as visitors\n  FROM someTable\n  WHERE Page LIKE '%AEC%'\n  GROUP BY DATENAME(MM, mydatetime) + ' ' + CAST(DAY(mydatetime) AS VARCHAR(2))\n    , MONTH(mydatetime)\n    , DAY(mydatetime)\n  ORDER BY MONTH(mydatetime) DESC\n    , DAY(mydatetime) DESC\n</code></pre>\n\n<p>It will output this:<br/></p>\n\n<pre><code>thedate     | totalcount | visitors\n-----------------------------------\nOctober 17  |     4      |    1\nOctober 15  |     1      |    1\nOctober 12  |     1      |    1\nOctober 3   |     3      |    3\nOctober 2   |     42     |    22\nSeptember 28|     2      |    1\nSeptember 21|     14     |    10\n</code></pre>\n\n<p>My problem is that I simply cant output this in descending order so it will look like this:</p>\n\n<pre><code>thedate     | totalcount | visitors\n-----------------------------------\nSeptember 21|     14     |    10\nSeptember 28|     2      |    1\nOctober 2   |     42     |    22\nOctober 3   |     3      |    3\nOctober 12  |     1      |    1\nOctober 15  |     1      |    1\nOctober 17  |     4      |    1\n</code></pre>\n\n<p>So any help is greatly appreciated. </p>\n"},{"tags":["c#","sql-server","database","table"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":571,"score":0,"question_id":9734352,"title":"Check SQL Server table and rows in table, if null create","body":"<p>I need a way to check if a table exist in my database from my C# class, and if that table got the rows needed.\nIf it doesn't exist or some of the rows are missing, I need to add those.</p>\n\n<p>I've used this method but don't know how to get the missing functions in there.\n( <a href=\"http://stackoverflow.com/questions/464474/check-if-a-sql-table-exists\">Check if a SQL table exists</a> )</p>\n\n<p>I'm working with SQL Server and C#</p>\n"},{"tags":["c#","sql-server","crystal-reports-2010"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":12071224,"title":"Empty Reports in crystal report from datasets in c#?","body":"<p>I am working on crystal report, i am using data set in c#, i create them by wizard, after that i choose the crystal report and created a report through the same dataset, and wrote following code.</p>\n\n<pre><code>    String temp = \"c:\\\\a.pdf\";\n\n    DataSet1 ad = new DataSet1();\n\n    ReportDocument d = new ReportDocument();\n\n    d.Load(\"c:\\\\CrystalReport2.rpt\");\n\n    d.SetDataSource(ad.Tables[0]);\n\n    d.Refresh();\n</code></pre>\n\n<p>At table[0] my employee tables lies. Problem is i am getting empty reports.. although my table is pretty much populated with records.</p>\n"},{"tags":["sql-server","csv","bulkinsert"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":121,"score":1,"question_id":12902110,"title":"Bulk Insert Correctly Quoted CSV File in SQL Server","body":"<p>I'm trying to import a correctly quoted CSV file, meaning data is only quoted if it contains a comma, e.g.:</p>\n\n<blockquote>\n  <p>41, Terminator, Black\n  42, \"Monsters, Inc.\", Blue</p>\n</blockquote>\n\n<p>I observe that the first row imports correctly, but the second row errors in a manner that suggests the quoted comma was treated as a field separator.</p>\n\n<p>I have seen suggestions such as this one</p>\n\n<p><a href=\"http://stackoverflow.com/questions/96448/sql-bulk-import-from-csv\">SQL Bulk import from CSV</a></p>\n\n<p>to change the field terminator</p>\n\n<blockquote>\n  <p>FIELDTERMINATOR='\",\"'</p>\n</blockquote>\n\n<p>However, my CSV file only quotes fields that need it, so I do not believe that suggestion would work.</p>\n\n<p>Can SQL Server's BULK IMPORT statement import a correctly quoted CSV file?  How?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":28,"score":-2,"question_id":12961115,"title":"TVF doesn't give any data","body":"<p>I have one table valued function. It gives no data when executed. But when I execute only the query of that table valued function by giving the same parameter, then I get the data. Why is this?</p>\n\n<p>I am executing TVF as follows:</p>\n\n<pre><code>select *\n  from fn_name(param1,param2,param3)\n</code></pre>\n"},{"tags":["asp.net","sql-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12959427,"title":"troubles with connection to database","body":"<p>When I start site from visual studio(F5) - it works normal in browser. \nBut when I start it from IIS Manager - it always shows standart IIS page with languages.</p>\n\n<p>Site uses database DB.mdf. In web config connection string is</p>\n\n<p><code>Data source=.\\MSSQLSERVER2;Database=DB;Integrated security=true</code></p>\n\n<p>The database is in App_Data.</p>\n\n<p>In IIS manager  in ASP.NET->Connectionstring for my site I've create new connectionstring - same as the connection string in web.config with name CName.</p>\n\n<p>Where is a problem? The path to my site is the path to catalog which contains App_Data catalog.</p>\n"},{"tags":["sql","sql-server"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":467,"score":1,"question_id":5827946,"title":"Transfer Data from One table to Another Table based on a condition","body":"<p>I have a table name SOURCETABLE with fields RollID, SMSID, FName, Lname.\nThe Destination table is DestTable with field ID, FirstName , LastName.\nMy task is to creat DestTable from the data of SOURCETABLE with following condition:</p>\n\n<pre><code>If RollID = NULL\n   ID = SMSID\nelse\n   ID = RollID\nend if\n</code></pre>\n\n<p>Fname will go to Firstname and Lname will go to LastName</p>\n\n<p>What statement I should write?</p>\n"},{"tags":["php","sql","sql-server","freetds","unixodbc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":170,"score":0,"question_id":10597898,"title":"PHP + UnixODBC + FreeTDS - SELECT [field] AS [name] does not work","body":"<p>I have a unix server which has PHP 5.2.13 installed, and it has access to two SQL servers (one is running MSSQL SERVER 2000 and the other MSSQL 2005).</p>\n\n<p>It uses FreeTDS - details:</p>\n\n<ul>\n<li>Version: freetds v0.82</li>\n<li>freetds.conf directory: /usr/local/etc</li>\n<li>MS db-lib source compatibility: no</li>\n<li>Sybase binary compatibility: no</li>\n<li>Thread safety: yes</li>\n<li>iconv library: yes</li>\n<li>TDS version: 8.0</li>\n<li>iODBC: no</li>\n<li>unixodbc: yes</li>\n</ul>\n\n<p>And I'm using unixODBC-2.3.1</p>\n\n<p>The MSSQL 2000 server is fine, I can run all SQL statements and use mssql_num_rows and mssql_fetch_assoc much as you would with MySQL.</p>\n\n<p>However, the MSSQL 2005 server won't work with mssql_num_rows or mssql_fetch_assoc - you have to use odbc_fetch_row.</p>\n\n<p>That's not really an issue, I assum it's just due to the different server installs.</p>\n\n<p>However, I have a huge issue with the MSSQL 2005 server: I cannot select a field AS another name!</p>\n\n<p>For example:</p>\n\n<pre><code>SELECT\n   [EnquiryID] AS \"The_Key\"\n   FROM [db].[dbo].[table]\n</code></pre>\n\n<p>Works fine in my admin application (ie: NOT PHP), but if I run the same in my PHP environment, I get:</p>\n\n<pre><code>stdClass Object\n(\n    [PK_EnquiryID] =&gt; 1\n)\n</code></pre>\n\n<p>You can see it should be <code>[The_Key] =&gt; 1</code></p>\n\n<p>Has anyone any idea how we can get round this, please?  I'm tearing my hair out!</p>\n\n<p>Cheers</p>\n\n<p>Neil</p>\n"},{"tags":["php","sql","sql-server","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":98,"score":2,"question_id":12200072,"title":"PHP ODBC not accepting alias on column name with space","body":"<p>Basically, I need to get some data out of a SQL Server 2005, using PHP.</p>\n\n<p>Previously we used the <code>mssql_*</code> functions, however due to various server issues we are only now able to use <code>odbc_*</code> functions.</p>\n\n<p>The table has various columns whose names have spaces in them, and before it is suggested.... no I cannot change them as this is a totally separate piece of software in another language and it would break it, I am just getting stats out of it.</p>\n\n<p>Anywho, I had previously been accessing these columns by putting their names in square brackets, e.g. [column name] and it worked fine under the <code>mssql_*</code> functions, however when I do this:</p>\n\n<pre><code>$sql = \"select top 1 [assessment name] as AssessmentName from bksb_Assessments\";\n$result = odbc_exec($db, $sql);\nwhile($row = odbc_fetch_array($result))\n{\n    var_dump($row);\n}\n</code></pre>\n\n<p>It prints the results out as:</p>\n\n<blockquote>\n  <p>'assessment name' => string 'Mathematics E3 Diagnostic' (length=25)</p>\n</blockquote>\n\n<p>So as you can see it is totally ignoring the alias I've given it and still calling it [assessment name].</p>\n\n<p>But if I run the exact same thing in SQL Server Management Studio Express, it works fine and uses the alias.</p>\n\n<p>I've tried various different combinations, such as quoting the alias, quoting the column, different brackets, etc... but no luck so far.</p>\n\n<p>This isn't a huge issue, as I can change what my script uses to look for \"assessment name\" in the result array instead of the alias, but it's just a bit annoying that I couldn't work out <strong>why</strong> this was happening...</p>\n\n<p>Cheers! :)</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Actually i don't think the square brackets make a difference, just trying to alias any column isn't working with through php odbc, however I can still do something like CAST(whatever) AS 'alias' and that works fine... just not selecting a column as an alias...? :/</p>\n"},{"tags":["sql-server","sql-server-2008","import-from-excel"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":2,"question_id":12942687,"title":"Horizontal data into Vertical","body":"<p>I have horizontal table (Table1) and I need it to transform it into (Table2)</p>\n\n<p><strong>Table1:</strong></p>\n\n<pre><code>CEO     SALESMAN    PRODUCT(1)  PRODUCT(2)  PRODUCT(3)  PRODUCT(4)  PRODUCT(5)  ... PRODUCT(N)\n------  ----------  ----------  ----------  ----------  ----------  ----------      ----------\nMIKE    ANDERSON    76787,00    19388,00    0,00        2723,00     217,00          6581,00\nJOHN    ANGELA      0,00        0,00        73088,00    0,00        0,00            0,00\nJACK    JEFF        24716,00    0,00        2995,00     0,00        0,00            0,00\nSTUART  MICHAEL     0,00        23338,00    42656,00    0,00        0,00            0,00\n</code></pre>\n\n<p><strong>Table2:</strong></p>\n\n<pre><code>CEO     SALESMAN    PRODUCTS    VALUE\n------- ----------- ----------  --------\nMIKE    ANDERSON    PRODUCT(1)  76787,00\nJOHN    ANGELA      PRODUCT(1)  0,00\nJACK    JEFF        PRODUCT(1)  24716,00\nSTUART  MICHAEL     PRODUCT(1)  0,00\nMIKE    ANDERSON    PRODUCT(2)  19388,00\nJOHN    ANGELA      PRODUCT(2)  0,00\nJACK    JEFF        PRODUCT(2)  0,00\nSTUART  MICHAEL     PRODUCT(2)  23338,00\nMIKE    ANDERSON    PRODUCT(3)  0,00\nJOHN    ANGELA      PRODUCT(3)  73088,00\nJACK    JEFF        PRODUCT(3)  2995,00\nSTUART  MICHAEL     PRODUCT(3)  42656,00\nMIKE    ANDERSON    PRODUCT(4)  2723,00\nJOHN    ANGELA      PRODUCT(4)  0,00\nJACK    JEFF        PRODUCT(4)  0,00\nSTUART  MICHAEL     PRODUCT(4)  0,00\nMIKE    ANDERSON    PRODUCT(5)  217,00\nJOHN    ANGELA      PRODUCT(5)  0,00\nJACK    JEFF        PRODUCT(5)  0,00\nSTUART  MICHAEL     PRODUCT(5)  0,00\nMIKE    ANDERSON    ...     ...\nJOHN    ANGELA      ...     ...\nJACK    JEFF        ...     ...\nSTUART  MICHAEL     ...     ...\nMIKE    ANDERSON    PRODUCT(N)  6581,00\nJOHN    ANGELA      PRODUCT(N)  0,00\nJACK    JEFF        PRODUCT(N)  0,00\nSTUART  MICHAEL     PRODUCT(N)  0,00\n</code></pre>\n\n<p>What I've tried so far is to BULK INSERT Table1 into a temporary table and then work with this data until I get what I want. The problem is the N in PRODUCT() columns is variable so I can't create a temporary table with fixed columns and I need a dynamic query that somehow can read the quantity of products columns and work with it.</p>\n\n<p><strong>BULK INSERT</strong></p>\n\n<pre><code>BULK INSERT #temp\nFROM '\\\\path\\file.csv'\nWITH\n(\nFIRSTROW = 1,\nFIELDTERMINATOR= ';',\nROWTERMINATOR = '\\n',\nCODEPAGE='RAW'\n);\n</code></pre>\n\n<p><strong>Temporary table:</strong></p>\n\n<pre><code>CREATE TABLE    #temp(\ncol1    varchar(100)    null,\ncol2    varchar(100)    null,\ncol3    varchar(100)    null,\ncol4    varchar(100)    null,\ncol5    varchar(100)    null,\n...\ncol397  varchar(100)    null,\ncol398  varchar(100)    null,\ncol399  varchar(100)    null,\ncol400  varchar(100)    null\n)\n</code></pre>\n\n<p>When I run the BULK INSERT I get this error:</p>\n\n<pre><code>Msg 4832, Level 16, State 1, Line 1\nBulk load: An unexpected end of file was encountered in the data file.\nMsg 7399, Level 16, State 1, Line 1\nThe OLE DB provider \"BULK\" for linked server \"(null)\" reported an error. The provider did not give any information about the error.\nMsg 7330, Level 16, State 2, Line 1\nCannot fetch a row from OLE DB provider \"BULK\" for linked server \"(null)\".\n</code></pre>\n\n<p>This happens because I created a temporary table with fixed 400 columns and there were 127 product columns.</p>\n\n<p>I'm trying to avoid things like these:</p>\n\n<pre><code>DECLARE @NUM_ROWS INT\n\nSET     @NUM_ROWS = 123\n\nIF @NUM_ROWS = 1\nBEGIN\nCREATE TABLE    #temp(\ncol1    varchar(100)    null\n)\nEND\n\nIF @NUM_ROWS = 2\nBEGIN\nCREATE TABLE    #temp(\ncol1    varchar(100)    null,\ncol2    varchar(100)    null,\n)\nEND\n\n...\n\nIF @NUM_ROWS = 400\nBEGIN\nCREATE TABLE    #temp(\ncol1    varchar(100)    null,\ncol2    varchar(100)    null,\n...\ncol4    varchar(100)    null,\n)\nEND\n\nBULK INSERT #temp\nFROM '\\\\path\\file.csv'\nWITH\n(\nFIRSTROW = 1,\nFIELDTERMINATOR= ';',\nROWTERMINATOR = '\\n',\nCODEPAGE='RAW'\n);\n</code></pre>\n\n<p><strong>@NUM_ROWS</strong> would be the number of columns I would create the temp table.</p>\n\n<p>Does anyone know a way I can import this .csv file into SQL Server dynamically? By dynamically I mean creating a temporary table with the number of columns of PRODUCTS I'm bulk inserting. Or a workaround to avoid that error I posted above.</p>\n"},{"tags":["sql-server","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":52,"score":3,"question_id":12960437,"title":"Different SELECT statement from what I was familiar with","body":"<p>Why are these statements valid [am Using SQL2008 R2]</p>\n\n<pre><code>Select* FROM TableName\n</code></pre>\n\n<p>and</p>\n\n<pre><code>Select *From TableName\n</code></pre>\n\n<p>I have known it this way <code>Select * From TableName</code></p>\n"},{"tags":["c#","sql-server","clr",".net-assembly"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":63,"score":3,"question_id":12951638,"title":"Replace string in file using a SQL procedure","body":"<p>I have a method to remove string from file written in C# for SQL Server:</p>\n\n<pre><code>[SqlProcedure]\npublic static void fileReplace(string path, string patternToReplace, string stringForReplace)\n{\n    using (SqlConnection connection = new SqlConnection(\"context connection=true\"))\n    {\n        connection.Open();\n        try\n        {\n            File.WriteAllText(path, Regex.Replace(File.ReadAllText(path), patternToReplace, stringForReplace));\n        }\n        catch (Exception e)\n        {\n        }\n    }\n}\n</code></pre>\n\n<p>Assembly and procedure in SQL Server are created like this:</p>\n\n<pre><code>CREATE ASSEMBLY FileUtils \n  FROM '&lt;path&gt;\\&lt;name&gt;.dll'\n  WITH PERMISSION_SET = EXTERNAL_ACCESS\nGO\n\nCREATE PROCEDURE fileReplace (\n         @path             nvarchar(max)  \n       , @patterToReplace  nvarchar(max)  \n       , @stringForReplace nvarchar(max)  \n      )\nAS EXTERNAL NAME FileUtils.FileUtils.fileReplace;\nGO\n</code></pre>\n\n<p>The method in C# is working correct, but when I call it from SQL Server, nothing happens (file doesn't change). What's wrong?</p>\n"}]}
